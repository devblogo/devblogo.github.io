<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">
<meta name="referrer" content="never">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="../../lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="../../lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="../../css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="../../images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="../../images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="../../images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="../../images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">





  <link rel="alternate" href="../../atom.xml" title="开发者博客 – IT技术 尽在开发者博客" type="application/atom+xml">






<meta property="og:type" content="website">
<meta property="og:title" content="开发者博客 – IT技术 尽在开发者博客">
<meta property="og:url" content="https://dev.newban.cn/page/45/index.html">
<meta property="og:site_name" content="开发者博客 – IT技术 尽在开发者博客">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="开发者博客 – IT技术 尽在开发者博客">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>
<!--谷歌广告验证代码-->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-2626449904708114",
          enable_page_level_ads: true
     });
</script>
<!--谷歌广告验证代码-->



  <link rel="canonical" href="https://dev.newban.cn/page/45/">





  <title>开发者博客 – IT技术 尽在开发者博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">开发者博客 – IT技术 尽在开发者博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">开发者博客 – 科技是第一生产力</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="http://dev.newban.cn/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="https://dev.newban.cn/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7340197367515578378.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7340197367515578378.html" itemprop="url">如果iconfont停止服务了，我们怎么办</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-02-28T09:50:36+08:00">
                2024-02-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/9d9b0890fa0fe742ad1771f22fea3001a66210f000e7b188489bfea67744a753" alt="&#x4E16;&#x754C;&#x6700;&#x5927;&#x7684;&#x65E0;&#x8F90;&#x6469;&#x5929;&#x8F6E;.webp"></p>
<h2 id="&#x524D;&#x8A00;"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00;</h2><p>&#x4E2A;&#x4EBA;&#x4E00;&#x76F4;&#x90FD;&#x6BD4;&#x8F83;&#x559C;&#x6B22;&#x963F;&#x91CC;&#x5927;&#x4F6C;&#x63D0;&#x4F9B;&#x7684;&#x4E00;&#x4E9B;&#x7EC4;&#x4EF6;&#x670D;&#x52A1;&#x4EC0;&#x4E48;&#x7684;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x53EA;&#x8BF4;&#x56FE;&#x6807;&#x7BA1;&#x7406;&#x5427;&#xFF0C;&#x6700;&#x5F00;&#x59CB;&#x7684;&#x65F6;&#x5019;&#x6211;&#x662F;&#x4F7F;&#x7528;&#x7684;<a href="/external_links/3d03404d59e5656529e414bbf80b04e4.html" target="blank" rel="noopener">icomoon.io</a> &#x540E;&#x9762;&#x53D1;&#x73B0;<a href="/external_links/14b9e6faed15376ced2bf66eed9a10f2.html" target="blank" rel="noopener">www.iconfont.cn/</a> &#x5728;&#x4EE5;&#x524D;&#x5F00;&#x53D1;&#x662F;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x4E3A;&#x4E86;&#x56FE;&#x7247;&#x7684;&#x8BF7;&#x6C42;&#x5C11;&#x70B9;&#xFF0C;&#x63D0;&#x5347;&#x7F51;&#x7AD9;&#x7684;&#x6027;&#x80FD;&#x4F1A;&#x628A;&#x8FD9;&#x4E9B;&#x5C0F;&#x56FE;&#x6807;&#x505A;&#x5230;&#x4E00;&#x5F20;&#x56FE;&#x4E0A;&#x9762;&#x4E13;&#x4E1A;&#x53EB;&#x6CD5;&#x662F;&#x96EA;&#x78A7;&#x56FE;&#xFF0C;&#x540E;&#x6765;&#x968F;&#x7740;&#x524D;&#x7AEF;&#x53D1;&#x5C55;&#x6709;&#x4E86;&#x5B57;&#x4F53;&#x56FE;&#x6807;&#xFF0C;&#x4E0D;&#x5570;&#x55E6;&#x4E86;&#x5427;&#xFF0C;&#x56DE;&#x5230;&#x6B63;&#x9898;&#xFF0C;&#x7531;&#x4E8E;&#x4E0A;&#x6B21;icofont&#x5B98;&#x7F51;&#x6302;&#x4E86;&#x4E4B;&#x540E;&#xFF0C;&#x5BFC;&#x81F4;&#x6211;&#x7684;&#x9879;&#x76EE;&#x65E0;&#x6CD5;&#x8FDB;&#x884C;&#x6B63;&#x5E38;&#x8FED;&#x4EE3;&#xFF0C;&#x6211;&#x5C31;&#x51B3;&#x5B9A;&#x8981;&#x81EA;&#x5DF1;&#x5F04;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x56FE;&#x6807;&#x7BA1;&#x7406;&#x3002;</p>
<h2 id="&#x9700;&#x6C42;"><a href="#&#x9700;&#x6C42;" class="headerlink" title="&#x9700;&#x6C42;"></a>&#x9700;&#x6C42;</h2><p>&#x4E00;&#x822C;&#x4F7F;&#x7528;&#x9700;&#x8981;&#x7684;&#x662F;&#x628A;&#x8BBE;&#x8BA1;&#x505A;&#x597D;&#x7684;&#x56FE;&#x6807;&#x6216;&#x8005;&#x5176;&#x4ED6;&#x5730;&#x65B9;&#x4E0B;&#x8F7D;&#x7684;svg&#x56FE;&#x6807;&#x4E0A;&#x4F20;&#x5230;&#x670D;&#x52A1;&#x5668;&#x7136;&#x540E;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#xFF0C;&#x5E76;&#x4E14;&#x6253;&#x5305;&#x6210;&#x4E00;&#x4E2A;js&#x6587;&#x4EF6;&#x52A0;&#x8F7D;&#x5230;&#x9879;&#x76EE;&#x4E2D;&#x3002;</p>
<h2 id="&#x51C6;&#x5907;"><a href="#&#x51C6;&#x5907;" class="headerlink" title="&#x51C6;&#x5907;"></a>&#x51C6;&#x5907;</h2><p>&#x90FD;&#x8BF4;&#x5929;&#x4E0B;&#x6587;&#x7AE0;&#x4E00;&#x5927;&#x6284;&#xFF0C;&#x6211;&#x4E5F;&#x662F;&#x53BB;&#x6284;iconfont,&#x6211;&#x628A;iconfont&#x7684;&#x4F7F;&#x7528;demo&#x6253;&#x5F00;&#x7814;&#x7A76;&#x4E86;&#x4E00;&#x4E0B;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/0f739810422d023d39af2170d02b486277da490fb604be02c0a11f6664cc2e2b" alt="image.png"></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/2795407031b00527c974856d8311a823f66914cae4ccaf6845349f6f22c44112" alt="image.png"></p>
<p>&#x6211;&#x8FD9;&#x91CC;&#x53EA;&#x8BF4;Symbol&#xFF0C;&#x901A;&#x8FC7;&#x5206;&#x6790;&#x770B;&#x5230;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5728;&#x9879;&#x76EE;&#x4E2D;&#x5F15;&#x5165;./iconfont.js</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/a9ebcba6c0a3ac94fcdf9f6fbb8f5cfc234b3444f02419bb5c733f22d2763812" alt="image.png"></p>
<p>iconfont&#x628A;&#x6211;&#x4EEC;&#x4E0A;&#x4F20;&#x7684;&#x56FE;&#x6807;&#x8FDB;&#x884C;&#x4E86;&#x5220;&#x51CF;&#x4F18;&#x5316;,&#x6700;&#x5916;&#x5C42;&#x5C31;&#x4E00;&#x4E2A;svg&#x6807;&#x7B7E;&#x91CC;&#x9762;&#x4F7F;&#x7528;&#x4E86;&#x4E00;&#x4E2A;symbol&#x6807;&#x7B7E;&#x6765;&#x5305;&#x88F9;&#x4E4B;&#x524D;&#x7684;&#x56FE;&#x6807;&#x5185;&#x5BB9;&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A;symbol&#x7684;id&#x90FD;&#x5BF9;&#x5E94;&#x4E4B;&#x524D;&#x7684;svg&#x56FE;&#x6807;&#x540D;&#x79F0;&#x3002;</p>
<blockquote>
<p>iconfont&#x4E5F;&#x6CA1;&#x6709;&#x5F00;&#x6E90;,&#x5177;&#x4F53;&#x600E;&#x4E48;&#x505A;&#x7684;&#x54B1;&#x4E5F;&#x4E0D;&#x77E5;&#x9053;&#xFF0C;&#x53EA;&#x80FD;&#x77E5;&#x9053;&#x76EE;&#x524D;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#x4E86;&#xFF0C;&#x7136;&#x540E;&#x5C31;&#x6309;&#x7167;&#x81EA;&#x5DF1;&#x7406;&#x89E3;&#x5F00;&#x59CB;&#x5F00;&#x53D1;&#x5B9E;&#x73B0;&#x4E86;</p>
</blockquote>
<h2 id="&#x524D;&#x7AEF;&#x5F00;&#x53D1;"><a href="#&#x524D;&#x7AEF;&#x5F00;&#x53D1;" class="headerlink" title="&#x524D;&#x7AEF;&#x5F00;&#x53D1;"></a>&#x524D;&#x7AEF;&#x5F00;&#x53D1;</h2><p>&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x77E5;&#x9053;&#xFF0C;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x524D;&#x7AEF;&#x9700;&#x8981;&#x7684;&#x662F;&#x628A;&#x8BBE;&#x8BA1;&#x7A3F;&#x7684;svg&#x56FE;&#x53D8;&#x6210;symbol&#x91CC;&#x9762;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x6253;&#x5F00;svg&#x56FE;<br>&#x53EF;&#x4EE5;&#x7B80;&#x5355;&#x6D4B;&#x8BD5;&#x4E0B;&#xFF0C;&#x76F4;&#x63A5;&#x628A;&#x5185;&#x5BB9;&#x590D;&#x5236;&#x7136;&#x540E;&#x7C98;&#x8D34;&#x5E26;&#x4E86;iconfont.js&#x4E2D;&#xFF0C;&#x7136;&#x540E;&#x8FD0;&#x884C;demo&#x56FE;&#x6807;&#x6B63;&#x5E38;&#x663E;&#x793A;&#x5C31;&#x8BF4;&#x660E;&#x662F;ok&#x7684;&#xFF0C;&#x4E0D;&#x7136;&#x5C31;&#x662F;&#x8FD9;&#x6837;&#x505A;&#x662F;&#x4E0D;&#x884C;&#x7684;&#x3002;<br><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/251bbeaed0fbe470cd8e42560c67f28672aa99c558cf00c745c04ae00e7e4754" alt="image.png"></p>
<p>&#x901A;&#x8FC7;&#x56FE;&#x7247;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x73B0;&#x5728;&#x9700;&#x8981;&#x7684;&#x5C31;&#x662F;&#x628A;svg&#x91CC;&#x9762;&#x7684;path&#x6539;&#x6210;&#x7528;symblo&#x6765;&#x5305;&#x88F9;&#xFF0C;&#x5728;&#x5F00;&#x53D1;&#x4E2D;svg&#x56FE;&#x6211;&#x4EEC;&#x662F;&#x901A;&#x8FC7;&#x6587;&#x6863;&#x6D41;&#x4E0A;&#x4F20;&#x4E0A;&#x6765;&#x7684;&#xFF0C;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x5C31;&#x9700;&#x8981;&#x5BF9;&#x6587;&#x6863;&#x6D41;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#xFF0C;&#x5148;&#x628A;&#x6587;&#x6863;&#x6D41;&#x53D8;&#x6210;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x7136;&#x540E;js&#x64CD;&#x4F5C;&#x5B57;&#x7B26;&#x4E32;&#x62FC;&#x63A5;&#x8FBE;&#x5230;&#x76EE;&#x7684;&#x3002;</p>
<ol>
<li>&#x4F7F;&#x7528;&#x5230;FileReader&#x548C;readAsText&#x83B7;&#x53D6;&#x5230;&#x5B57;&#x7B26;&#x4E32;</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">js&#x590D;&#x5236;&#x4EE3;&#x7801; const fileParse = (file) =&gt; {</span><br><span class="line">   return new Promise((resolve) =&gt; {</span><br><span class="line">     const fileReader = new FileReader();</span><br><span class="line">     fileReader.readAsText(file, &quot;UTF-8&quot;);</span><br><span class="line">     fileReader.onload = (e) =&gt; {</span><br><span class="line">       resolve({ content: e.target?.result, name: file.name })</span><br><span class="line">     }</span><br><span class="line">   })</span><br><span class="line"> }</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>&#x5B57;&#x7B26;&#x64CD;&#x4F5C;&#x62FC;&#x63A5;&#x6211;&#x4F7F;&#x7528;&#x7684;&#x662F;cheerio</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">js&#x590D;&#x5236;&#x4EE3;&#x7801;  const handleUploadSvg = ($, result) =&gt; {</span><br><span class="line">    let index = result.indexOf(&apos;&lt;svg&apos;);</span><br><span class="line">    const str = result.slice(index);</span><br><span class="line">    const svgNode = $(str);</span><br><span class="line"></span><br><span class="line">    $(&apos;svg&apos;).attr(&apos;viewBox&apos;, svgNode.attr(&apos;viewBox&apos;));</span><br><span class="line">    const findPath = svgNode.find(&apos;path&apos;);</span><br><span class="line">    if (!findPath.length) {</span><br><span class="line">      message.error(&apos;&#x56FE;&#x6807;&#x9519;&#x8BEF;&#xFF0C;&#x4E0D;&#x5B58;&#x5728;path&apos;)</span><br><span class="line">      return &apos;&apos;;</span><br><span class="line">    };</span><br><span class="line">    findPath.each((i, el) =&gt; {</span><br><span class="line">      $(el).removeAttr(&apos;id&apos;);</span><br><span class="line">    });</span><br><span class="line">    const gDom = svgNode.find(&apos;g&apos;);</span><br><span class="line"></span><br><span class="line">    gDom.each((i, el) =&gt; {</span><br><span class="line">      const path = $(el).children(&apos;path&apos;);</span><br><span class="line">      const fill = $(el).attr(&apos;fill&apos;);</span><br><span class="line">      if (fill &amp;&amp; fill !== &apos;none&apos; &amp;&amp; path.length &amp;&amp; !$(path[0])?.attr?.(&apos;fill&apos;)) {</span><br><span class="line">        $(path[0])?.attr?.(&apos;fill&apos;, fill)</span><br><span class="line">      }</span><br><span class="line">    });</span><br><span class="line">    removeArrtId($, gDom);</span><br><span class="line"></span><br><span class="line">    if (gDom.length) {</span><br><span class="line">      $(&apos;svg&apos;).html(svgNode.html());</span><br><span class="line">    } else {</span><br><span class="line">      $(&apos;svg&apos;).html(svgNode.find(&apos;path&apos;));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    return $.html(&quot;svg&quot;)</span><br><span class="line">  }</span><br></pre></td></tr></table></figure>

<p>&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x64CD;&#x4F5C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x4E00;&#x4E2A;&#x65B0;&#x7684;svg&#x6E90;&#x7801;&#xFF0C;&#x56FE;&#x6807;&#x663E;&#x793A;&#x8FD8;&#x662F;flow</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/1893028f19b515a865dfda14764f9ced0099b87b24c3376b98dd14e7ad136564" alt="image.png"></p>
<p>&#x7136;&#x540E;&#x6211;&#x628A;&#x8FD9;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x4F20;&#x9001;&#x7ED9;&#x540E;&#x7AEF;&#x5C31;&#x884C;&#x4E86;</p>
<h2 id="&#x540E;&#x7AEF;&#x5F00;&#x53D1;"><a href="#&#x540E;&#x7AEF;&#x5F00;&#x53D1;" class="headerlink" title="&#x540E;&#x7AEF;&#x5F00;&#x53D1;"></a>&#x540E;&#x7AEF;&#x5F00;&#x53D1;</h2><p>&#x540E;&#x7AEF;&#x8981;&#x505A;&#x7684;&#x5C31;&#x662F;&#x628A;&#x6211;&#x4E0A;&#x4F20;&#x4E0A;&#x6765;&#x7684;svg&#x5B57;&#x7B26;&#x4E32;&#x62FC;&#x63A5;&#x5230;&#x4E00;&#x8D77;&#xFF0C;&#x7136;&#x540E;&#x4EE5;iconfont.js&#x4E00;&#x6837;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;get&#x63A5;&#x53E3;&#x8FD4;&#x56DE;&#x7ED9;&#x6211;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;,<br>&#x901A;&#x8FC7;&#x6D4F;&#x89C8;&#x5668;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x5230;&#x5C31;&#x8BF4;&#x660E;ok&#x4E86;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/361da9b48b1dd012185535ee3877e20fdb975f7811e33a439b207bf83ed8dc3c" alt="image.png"></p>
<p>&#x5176;&#x4ED6;&#x4E24;&#x79CD;&#x9700;&#x8981;&#x7528;&#x5230;&#x4E9B;&#x7B2C;&#x4E09;&#x65B9;&#x5E93;&#x5F53;&#x65F6;&#x4E5F;&#x6709;&#x987A;&#x4FBF;&#x7814;&#x7A76;&#x770B;&#x5230;&#x4E86;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x9700;&#x8981;&#x6211;&#x518D;&#x5199;&#x4E00;&#x7BC7;&#x3002;</p>
<p>&#x6587;&#x7AE0;&#x4E2D;&#x4F1A;&#x6709;&#x4E9B;&#x4E0D;&#x600E;&#x4E48;&#x6E05;&#x6670;&#x6216;&#x8005;&#x6709;&#x95EE;&#x9898;&#x7684;&#x5730;&#x65B9;&#x8FD8;&#x671B;&#x5404;&#x4F4D;&#x5927;&#x4F6C;&#x89C1;&#x8C05;&#xFF0C;&#x521A;&#x521A;&#x5F00;&#x59CB;&#x51B3;&#x5B9A;&#x5199;&#x4E00;&#x4E9B;&#x6280;&#x672F;&#x76F8;&#x5173;&#x6587;&#x7AE0;&#xFF0C;&#x8FD8;&#x5F88;&#x751F;&#x758F;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/a8b7cc75dbc41fafcd798693371e5fc9.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7340197367515414538.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7340197367515414538.html" itemprop="url">零基础入门AI：一键本地运行各种开源大语言模型 - Olla</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-02-28T09:33:08+08:00">
                2024-02-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="&#x4EC0;&#x4E48;&#x662F;-Ollama&#xFF1F;"><a href="#&#x4EC0;&#x4E48;&#x662F;-Ollama&#xFF1F;" class="headerlink" title="&#x4EC0;&#x4E48;&#x662F; Ollama&#xFF1F;"></a>&#x4EC0;&#x4E48;&#x662F; Ollama&#xFF1F;</h1><p>Ollama &#x662F;&#x4E00;&#x4E2A;&#x53EF;&#x4EE5;&#x5728;&#x672C;&#x5730;&#x90E8;&#x7F72;&#x548C;&#x7BA1;&#x7406;&#x5F00;&#x6E90;&#x5927;&#x8BED;&#x8A00;&#x6A21;&#x578B;&#x7684;&#x6846;&#x67B6;&#xFF0C;&#x7531;&#x4E8E;&#x5B83;&#x6781;&#x5927;&#x7684;&#x7B80;&#x5316;&#x4E86;&#x5F00;&#x6E90;&#x5927;&#x8BED;&#x8A00;&#x6A21;&#x578B;&#x7684;&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;&#x7EC6;&#x8282;&#xFF0C;&#x4E00;&#x7ECF;&#x63A8;&#x51FA;&#x5C31;&#x5E7F;&#x53D7;&#x597D;&#x8BC4;&#xFF0C;&#x76EE;&#x524D;&#x5DF2;&#x5728;github&#x4E0A;&#x83B7;&#x5F97;&#x4E86;46k star&#x3002;</p>
<p>&#x4E0D;&#x7BA1;&#x662F;&#x8457;&#x540D;&#x7684;&#x7F8A;&#x9A7C;&#x7CFB;&#x5217;&#xFF0C;&#x8FD8;&#x662F;&#x6700;&#x65B0;&#x7684;AI&#x65B0;&#x8D35;Mistral&#xFF0C;&#x7B49;&#x7B49;&#x5404;&#x79CD;&#x5F00;&#x6E90;&#x5927;&#x8BED;&#x8A00;&#x6A21;&#x578B;&#xFF0C;&#x90FD;&#x53EF;&#x4EE5;&#x7528;Ollama&#x5B9E;&#x73B0;&#x4E00;&#x952E;&#x5B89;&#x88C5;&#x5E76;&#x8FD0;&#x884C;&#xFF0C;&#x652F;&#x6301;&#x7684;&#x66F4;&#x591A;&#x6A21;&#x578B;&#x7684;&#x5217;&#x8868;&#x53EF;&#x4EE5;&#x67E5;&#x770B;Ollama&#x5B98;&#x7F51;&#x3002;</p>
<table>
<thead>
<tr>
<th>Model</th>
<th>Parameters</th>
<th>Size</th>
<th>Download</th>
</tr>
</thead>
<tbody><tr>
<td>Llama 2</td>
<td>7B</td>
<td>3.8GB</td>
<td><code>ollama run llama2</code></td>
</tr>
<tr>
<td>Mistral</td>
<td>7B</td>
<td>4.1GB</td>
<td><code>ollama run mistral</code></td>
</tr>
</tbody></table>
<p>&#x672C;&#x6587;&#x5C31;&#x8BA9;&#x6211;&#x4EEC;&#x4E00;&#x8D77;&#x5165;&#x95E8;Ollama&#x3002;</p>
<h1 id="&#x5982;&#x4F55;&#x5B89;&#x88C5;-Ollama&#x6846;&#x67B6;&#xFF1F;"><a href="#&#x5982;&#x4F55;&#x5B89;&#x88C5;-Ollama&#x6846;&#x67B6;&#xFF1F;" class="headerlink" title="&#x5982;&#x4F55;&#x5B89;&#x88C5; Ollama&#x6846;&#x67B6;&#xFF1F;"></a>&#x5982;&#x4F55;&#x5B89;&#x88C5; Ollama&#x6846;&#x67B6;&#xFF1F;</h1><p>Ollama&#x652F;&#x6301;&#x5404;&#x4E2A;&#x5E73;&#x53F0;&#xFF1A;Mac&#x3001;Windows &#x548C; Linux&#xFF0C;&#x4E5F;&#x63D0;&#x4F9B;&#x4E86;docker image&#x3002;<br>&#x5728;Ollama&#x5B98;&#x7F51;&#x6216;&#x8005;Github&#x53EF;&#x4EE5;&#x4E0B;&#x8F7D;&#xFF0C;&#x7136;&#x540E;&#x4E00;&#x952E;&#x5B89;&#x88C5;Ollama&#x6846;&#x67B6;&#xFF1A;</p>
<ul>
<li><a href="/external_links/234177bbf722239043d3336e8c156bfe.html" target="blank" rel="noopener">macOS</a></li>
<li><a href="/external_links/923a8018b1049b9d03e348d8b242f346.html" target="blank" rel="noopener">Windows</a></li>
<li>Linux: <code>curl -fsSL https://ollama.com/install.sh | sh</code></li>
</ul>
<p>&#x7531;&#x4E8E;Ollama&#x521A;&#x652F;&#x6301;windows&#x4E0D;&#x4E45;&#xFF0C;&#x5728;windows&#x4E0A;&#x7684;&#x76F8;&#x5173;&#x914D;&#x7F6E;&#x8FD8;&#x4E0D;&#x591F;&#x5B8C;&#x5584;&#xFF0C;&#x4EE5;&#x4E0B;&#x6211;&#x5C06;&#x4E3B;&#x8981;&#x4EE5;Linux&#x4E0A;&#x8FD0;&#x884C;Ollama&#x6765;&#x4E3E;&#x4F8B;&#x8BF4;&#x660E;&#x3002;</p>
<h1 id="&#x8FD0;&#x884C;-Ollama-&#x670D;&#x52A1;"><a href="#&#x8FD0;&#x884C;-Ollama-&#x670D;&#x52A1;" class="headerlink" title="&#x8FD0;&#x884C; Ollama &#x670D;&#x52A1;"></a>&#x8FD0;&#x884C; Ollama &#x670D;&#x52A1;</h1><p>&#x5728;Ollama&#x5B89;&#x88C5;&#x5B8C;&#x6210;&#x540E;&#xFF0C; &#x4E00;&#x822C;&#x4F1A;&#x81EA;&#x52A8;&#x542F;&#x52A8; Ollama &#x670D;&#x52A1;&#xFF0C;&#x800C;&#x4E14;&#x4F1A;&#x81EA;&#x52A8;&#x8BBE;&#x7F6E;&#x4E3A;&#x5F00;&#x673A;&#x81EA;&#x542F;&#x52A8;&#x3002;&#x5B89;&#x88C5;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5982;&#x4E0B;&#x547D;&#x4EE4;&#x67E5;&#x770B;&#x662F;&#x5426;Ollama&#x662F;&#x5426;&#x6B63;&#x5E38;&#x542F;&#x52A8;&#x3002;&#x5982;&#x4E0B;&#x4F8B;&#x5B50;&#x4E2D;&#x663E;&#x793A;&#x201C;Active: active (running)&#x201D;&#x8868;&#x793A;Ollama&#x5DF2;&#x7ECF;&#x6B63;&#x5E38;&#x542F;&#x52A8;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">yaml&#x590D;&#x5236;&#x4EE3;&#x7801;$ systemctl status ollama</span><br><span class="line">&#x25CF; ollama.service - Ollama Service</span><br><span class="line">     Loaded: loaded (/etc/systemd/system/ollama.service; enabled; vendor preset: enabled)</span><br><span class="line">    Drop-In: /etc/systemd/system/ollama.service.d</span><br><span class="line">             &#x2514;&#x2500;environment.conf</span><br><span class="line">     Active: active (running) since Thu 2024-03-07 09:09:39 HKT; 4 days ago</span><br><span class="line">   Main PID: 19975 (ollama)</span><br><span class="line">      Tasks: 29 (limit: 69456)</span><br><span class="line">     Memory: 1.1G</span><br><span class="line">        CPU: 14min 44.702s</span><br><span class="line">     CGroup: /system.slice/ollama.service</span><br><span class="line">             &#x2514;&#x2500;19975 /usr/local/bin/ollama serve</span><br></pre></td></tr></table></figure>

<p>&#x5728;Linux&#x4E0A;&#xFF0C;&#x5982;&#x679C;Ollama&#x672A;&#x542F;&#x52A8;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x5982;&#x4E0B;&#x547D;&#x4EE4;&#x542F;&#x52A8; Ollama &#x670D;&#x52A1;&#xFF1A;<code>ollama serve</code>&#xFF0C;&#x6216;&#x8005; <code>sudo systemctl start ollama</code>&#x3002;</p>
<p>&#x901A;&#x8FC7;&#x5206;&#x6790;Linux&#x7684;&#x5B89;&#x88C5;&#x811A;&#x672C;install.sh&#xFF0C;&#x5C31;&#x4F1A;&#x770B;&#x5230;&#x5176;&#x4E2D;&#x5DF2;&#x7ECF;&#x5C06;<code>ollama serve</code>&#x914D;&#x7F6E;&#x4E3A;&#x4E00;&#x4E2A;&#x7CFB;&#x7EDF;&#x670D;&#x52A1;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>systemctl</code>&#x6765; start / stop ollama&#x8FDB;&#x7A0B;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;    status &quot;Creating ollama systemd service...&quot;</span><br><span class="line">    cat &lt;&lt;EOF | $SUDO tee /etc/systemd/system/ollama.service &gt;/dev/null</span><br><span class="line">[Unit]</span><br><span class="line">Description=Ollama Service</span><br><span class="line">After=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=$BINDIR/ollama serve</span><br><span class="line">User=ollama</span><br><span class="line">Group=ollama</span><br><span class="line">Restart=always</span><br><span class="line">RestartSec=3</span><br><span class="line">Environment=&quot;PATH=$PATH&quot;</span><br></pre></td></tr></table></figure>

<p>&#x542F;&#x52A8;Ollama&#x670D;&#x52A1;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x5F53;&#x524D;&#x7684;Ollama&#x7248;&#x672C;&#xFF0C;&#x4EE5;&#x53CA;&#x5E38;&#x7528;&#x547D;&#x4EE4;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">sql&#x590D;&#x5236;&#x4EE3;&#x7801;~$ ollama -v</span><br><span class="line">ollama version is 0.1.20</span><br><span class="line">~$ ollama --help</span><br><span class="line">Large language model runner</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line">  ollama [flags]</span><br><span class="line">  ollama [command]</span><br><span class="line"></span><br><span class="line">Available Commands:</span><br><span class="line">  serve       Start ollama</span><br><span class="line">  create      Create a model from a Modelfile</span><br><span class="line">  show        Show information for a model</span><br><span class="line">  run         Run a model</span><br><span class="line">  pull        Pull a model from a registry</span><br><span class="line">  push        Push a model to a registry</span><br><span class="line">  list        List models</span><br><span class="line">  cp          Copy a model</span><br><span class="line">  rm          Remove a model</span><br><span class="line">  help        Help about any command</span><br><span class="line"></span><br><span class="line">Flags:</span><br><span class="line">  -h, --help      help for ollama</span><br><span class="line">  -v, --version   Show version information</span><br><span class="line"></span><br><span class="line">Use &quot;ollama [command] --help&quot; for more information about a command.</span><br></pre></td></tr></table></figure>

<h1 id="&#x5982;&#x4F55;&#x4E0B;&#x8F7D;&#x5E76;&#x8FD0;&#x884C;&#x5927;&#x8BED;&#x8A00;&#x6A21;&#x578B;&#xFF1F;"><a href="#&#x5982;&#x4F55;&#x4E0B;&#x8F7D;&#x5E76;&#x8FD0;&#x884C;&#x5927;&#x8BED;&#x8A00;&#x6A21;&#x578B;&#xFF1F;" class="headerlink" title="&#x5982;&#x4F55;&#x4E0B;&#x8F7D;&#x5E76;&#x8FD0;&#x884C;&#x5927;&#x8BED;&#x8A00;&#x6A21;&#x578B;&#xFF1F;"></a>&#x5982;&#x4F55;&#x4E0B;&#x8F7D;&#x5E76;&#x8FD0;&#x884C;&#x5927;&#x8BED;&#x8A00;&#x6A21;&#x578B;&#xFF1F;</h1><p>&#x81F3;&#x6B64;&#xFF0C;&#x5DF2;&#x7ECF;&#x5B8C;&#x6210;Ollama&#x6846;&#x67B6;&#x7684;&#x5B89;&#x88C5;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x4E00;&#x6761;&#x547D;&#x4EE4;&#x5728;&#x672C;&#x5730;&#x8FD0;&#x884C;&#x5927;&#x8BED;&#x8A00;&#x6A21;&#x578B;&#x3002;&#x4EE5;&#x8457;&#x540D;&#x7684;&#x7F8A;&#x9A7C;&#x4E3E;&#x4F8B;&#xFF1A;<code>ollama run llama2</code>&#x3002;</p>
<p>&#x5982;&#x679C;&#x8FD8;&#x6CA1;&#x6709;&#x4E0B;&#x8F7D;&#x8FC7;&#x6307;&#x5B9A;&#x7684;&#x5927;&#x8BED;&#x8A00;&#x6A21;&#x578B;&#xFF0C;&#x8FD9;&#x6761;&#x547D;&#x4EE4;&#x5C06;&#x4F1A;&#x5148;&#x6267;&#x884C;<code>ollama pull llama2</code>&#xFF0C;&#x5C06;&#x5927;&#x8BED;&#x8A00;&#x6A21;&#x578B;&#x4E0B;&#x8F7D;&#x5230;&#x672C;&#x5730;&#xFF0C;&#x518D;&#x5728;&#x672C;&#x5730;&#x8FD0;&#x884C;&#x5927;&#x8BED;&#x8A00;&#x6A21;&#x578B;&#x3002;</p>
<p>&#x4E0B;&#x8F7D;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x8FD0;&#x884C;&#x6548;&#x679C;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">less&#x590D;&#x5236;&#x4EE3;&#x7801;:~$ ollama run llama2</span><br><span class="line">&gt;&gt;&gt; who are you?</span><br><span class="line"></span><br><span class="line">I am LLaMA, an AI assistant developed by Meta AI that can understand and respond to human input in a conversational manner. I am trained on a massive dataset of text from the internet and can </span><br><span class="line">generate human-like responses to a wide range of topics and questions. I can be used to create chatbots, virtual assistants, and other applications that require natural language understanding and</span><br><span class="line">generation capabilities.</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; Send a message (/? for help)</span><br></pre></td></tr></table></figure>

<h1 id="REST-API"><a href="#REST-API" class="headerlink" title="REST API"></a>REST API</h1><p>Ollama&#x8FD8;&#x63D0;&#x4F9B;&#x4E86;API&#x63A5;&#x53E3;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vbnet&#x590D;&#x5236;&#x4EE3;&#x7801;curl http://localhost:11434/api/generate -d &apos;{</span><br><span class="line">  &quot;model&quot;: &quot;llama2&quot;,</span><br><span class="line">  &quot;prompt&quot;:&quot;Why is the sky blue?&quot;,</span><br><span class="line">  &quot;stream&quot;: false</span><br><span class="line">}&apos;</span><br></pre></td></tr></table></figure>

<p>&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">json&#x590D;&#x5236;&#x4EE3;&#x7801;{</span><br><span class="line">    &quot;model&quot;: &quot;llama2&quot;,</span><br><span class="line">    &quot;created_at&quot;: &quot;2024-02-26T04:35:10.787352404Z&quot;,</span><br><span class="line">    &quot;response&quot;: &quot;The sky appears blue because of a phenomenon called Rayleigh scattering, which occurs when sunlight enters Earth&apos;s atmosphere. The sunlight encounters tiny molecules of gases such as nitrogen and oxygen, which scatter the light in all directions. The shorter wavelengths of light, such as blue and violet, are scattered more than the longer wavelengths, such as red and orange. This is known as Rayleigh scattering, named after Lord Rayleigh, who first described the phenomenon in the late 19th century. As a result of this scattering, the light that reaches our eyes from the sun appears blue, especially when viewed from a distance. The closer we get to the horizon, the more the blue color appears to fade, as the light has to travel through more of the atmosphere, which scatters the shorter wavelengths even more. It&apos;s worth noting that the exact shade of blue can vary depending on the time of day and atmospheric conditions. For example, during sunrise and sunset, when the sun is low in the sky, the sky can take on a more orange or red hue due to the scattering of light by atmospheric particles. So, to summarize, the sky appears blue because of the way light interacts with the tiny molecules of gases in Earth&apos;s atmosphere, particularly nitrogen and oxygen.&quot;,</span><br><span class="line">    &quot;done&quot;: true,</span><br><span class="line">    &quot;total_duration&quot;: 7001870820,</span><br><span class="line">    &quot;load_duration&quot;: 4930376,</span><br><span class="line">    &quot;prompt_eval_duration&quot;: 60907000,</span><br><span class="line">    &quot;eval_count&quot;: 309,</span><br><span class="line">    &quot;eval_duration&quot;: 6931593000</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4F7F;&#x7528;API&#x63A5;&#x53E3;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x66F4;&#x591A;&#x7075;&#x6D3B;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x6BD4;&#x5982;&#x4E0E;IDE&#x63D2;&#x4EF6;&#x914D;&#x5408;&#xFF0C;&#x5B9E;&#x73B0;&#x672C;&#x5730;&#x7684;&#x7F16;&#x7A0B;&#x52A9;&#x624B;&#xFF0C;&#x53EF;&#x53C2;&#x8003;&#x5982;&#x4E0B;&#x6587;&#x7AE0;&#xFF1A;<br><a href="https://dev.newban.cn/7340461584643112971">&#x96F6;&#x57FA;&#x7840;&#x5165;&#x95E8;AI&#xFF1A;&#x642D;&#x5EFA;&#x672C;&#x5730;&#x7684;&#x7F16;&#x7A0B;&#x52A9;&#x624B;</a></p>
<h1 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h1><h2 id="&#x5982;&#x4F55;&#x67E5;&#x770B;&#x8FD0;&#x884C;&#x7684;&#x65E5;&#x5FD7;&#xFF1F;"><a href="#&#x5982;&#x4F55;&#x67E5;&#x770B;&#x8FD0;&#x884C;&#x7684;&#x65E5;&#x5FD7;&#xFF1F;" class="headerlink" title="&#x5982;&#x4F55;&#x67E5;&#x770B;&#x8FD0;&#x884C;&#x7684;&#x65E5;&#x5FD7;&#xFF1F;"></a>&#x5982;&#x4F55;&#x67E5;&#x770B;&#x8FD0;&#x884C;&#x7684;&#x65E5;&#x5FD7;&#xFF1F;</h2><p>&#x5728;Linux&#x4E0A;&#x8FD0;&#x884C;&#x547D;&#x4EE4;<code>journalctl -u ollama</code>&#xFF0C;&#x5373;&#x53EF;&#x67E5;&#x770B;&#x8FD0;&#x884C;&#x65E5;&#x5FD7;&#x3002;</p>
<h2 id="&#x5982;&#x4F55;&#x914D;&#x7F6E;&#x672C;&#x5730;&#x5927;&#x6A21;&#x578B;&#x5BF9;&#x5C40;&#x57DF;&#x7F51;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#xFF1F;"><a href="#&#x5982;&#x4F55;&#x914D;&#x7F6E;&#x672C;&#x5730;&#x5927;&#x6A21;&#x578B;&#x5BF9;&#x5C40;&#x57DF;&#x7F51;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#xFF1F;" class="headerlink" title="&#x5982;&#x4F55;&#x914D;&#x7F6E;&#x672C;&#x5730;&#x5927;&#x6A21;&#x578B;&#x5BF9;&#x5C40;&#x57DF;&#x7F51;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#xFF1F;"></a>&#x5982;&#x4F55;&#x914D;&#x7F6E;&#x672C;&#x5730;&#x5927;&#x6A21;&#x578B;&#x5BF9;&#x5C40;&#x57DF;&#x7F51;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#xFF1F;</h2><p>&#x5728;Linux&#x4E0A;&#x521B;&#x5EFA;&#x5982;&#x4E0B;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x914D;&#x7F6E;&#x73AF;&#x5883;&#x53D8;&#x91CF; <code>OLLAMA_HOST</code> &#x6765;&#x6307;&#x5B9A;&#x5BF9;&#x5C40;&#x57DF;&#x7F51;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x7684;&#x5730;&#x5740;&#xFF0C;&#x518D;&#x91CD;&#x542F;Ollama&#x670D;&#x52A1;&#x5373;&#x53EF;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;:~$ cat /etc/systemd/system/ollama.service.d/environment.conf</span><br><span class="line">[Service]</span><br><span class="line">Environment=OLLAMA_HOST=0.0.0.0:11434</span><br></pre></td></tr></table></figure>

<p>&#x5982;&#x6B64;&#x914D;&#x7F6E;&#x540E;&#xFF0C;&#x5373;&#x53EF;&#x7531;&#x4E00;&#x53F0;GPU&#x670D;&#x52A1;&#x5668;&#x4E3A;&#x672C;&#x5730;&#x5C40;&#x57DF;&#x7F51;&#x63D0;&#x4F9B;&#x5927;&#x8BED;&#x8A00;&#x6A21;&#x578B;&#x7684;&#x670D;&#x52A1;&#x3002;</p>
<h2 id="&#x672C;&#x5730;&#x6709;&#x591A;&#x5F20;GPU&#xFF0C;&#x5982;&#x4F55;&#x7528;&#x6307;&#x5B9A;&#x7684;GPU&#x6765;&#x8FD0;&#x884C;Ollama&#xFF1F;"><a href="#&#x672C;&#x5730;&#x6709;&#x591A;&#x5F20;GPU&#xFF0C;&#x5982;&#x4F55;&#x7528;&#x6307;&#x5B9A;&#x7684;GPU&#x6765;&#x8FD0;&#x884C;Ollama&#xFF1F;" class="headerlink" title="&#x672C;&#x5730;&#x6709;&#x591A;&#x5F20;GPU&#xFF0C;&#x5982;&#x4F55;&#x7528;&#x6307;&#x5B9A;&#x7684;GPU&#x6765;&#x8FD0;&#x884C;Ollama&#xFF1F;"></a>&#x672C;&#x5730;&#x6709;&#x591A;&#x5F20;GPU&#xFF0C;&#x5982;&#x4F55;&#x7528;&#x6307;&#x5B9A;&#x7684;GPU&#x6765;&#x8FD0;&#x884C;Ollama&#xFF1F;</h2><p>&#x5728;Linux&#x4E0A;&#x521B;&#x5EFA;&#x5982;&#x4E0B;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x914D;&#x7F6E;&#x73AF;&#x5883;&#x53D8;&#x91CF; <code>CUDA_VISIBLE_DEVICES</code> &#x6765;&#x6307;&#x5B9A;&#x8FD0;&#x884C;Ollama&#x7684;GPU&#xFF0C;&#x518D;&#x91CD;&#x542F;Ollama&#x670D;&#x52A1;&#x5373;&#x53EF;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;:~$ cat /etc/systemd/system/ollama.service.d/environment.conf</span><br><span class="line">[Service]</span><br><span class="line">Environment=CUDA_VISIBLE_DEVICES=1,2</span><br></pre></td></tr></table></figure>

<h2 id="&#x4E0B;&#x8F7D;&#x7684;&#x5927;&#x6A21;&#x578B;&#x5B58;&#x50A8;&#x5728;&#x54EA;&#x4E2A;&#x8DEF;&#x5F84;&#xFF1F;"><a href="#&#x4E0B;&#x8F7D;&#x7684;&#x5927;&#x6A21;&#x578B;&#x5B58;&#x50A8;&#x5728;&#x54EA;&#x4E2A;&#x8DEF;&#x5F84;&#xFF1F;" class="headerlink" title="&#x4E0B;&#x8F7D;&#x7684;&#x5927;&#x6A21;&#x578B;&#x5B58;&#x50A8;&#x5728;&#x54EA;&#x4E2A;&#x8DEF;&#x5F84;&#xFF1F;"></a>&#x4E0B;&#x8F7D;&#x7684;&#x5927;&#x6A21;&#x578B;&#x5B58;&#x50A8;&#x5728;&#x54EA;&#x4E2A;&#x8DEF;&#x5F84;&#xFF1F;</h2><p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4E0D;&#x540C;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5B58;&#x50A8;&#x7684;&#x8DEF;&#x5F84;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li>macOS: <code>~/.ollama/models</code></li>
<li>Linux: <code>/usr/share/ollama/.ollama/models</code></li>
<li>Windows: <code>C:\Users&lt;username&gt;.ollama\models</code></li>
</ul>
<h2 id="&#x5982;&#x4F55;&#x4FEE;&#x6539;&#x5927;&#x6A21;&#x578B;&#x5B58;&#x50A8;&#x7684;&#x8DEF;&#x5F84;&#xFF1F;"><a href="#&#x5982;&#x4F55;&#x4FEE;&#x6539;&#x5927;&#x6A21;&#x578B;&#x5B58;&#x50A8;&#x7684;&#x8DEF;&#x5F84;&#xFF1F;" class="headerlink" title="&#x5982;&#x4F55;&#x4FEE;&#x6539;&#x5927;&#x6A21;&#x578B;&#x5B58;&#x50A8;&#x7684;&#x8DEF;&#x5F84;&#xFF1F;"></a>&#x5982;&#x4F55;&#x4FEE;&#x6539;&#x5927;&#x6A21;&#x578B;&#x5B58;&#x50A8;&#x7684;&#x8DEF;&#x5F84;&#xFF1F;</h2><p>Linux&#x5E73;&#x53F0;&#x5B89;&#x88C5;Ollama&#x65F6;&#xFF0C;&#x9ED8;&#x8BA4;&#x5B89;&#x88C5;&#x65F6;&#x4F1A;&#x521B;&#x5EFA;&#x7528;&#x6237;ollama&#xFF0C;&#x518D;&#x5C06;&#x6A21;&#x578B;&#x6587;&#x4EF6;&#x5B58;&#x50A8;&#x5230;&#x8BE5;&#x7528;&#x6237;&#x7684;&#x76EE;&#x5F55;<code>/usr/share/ollama/.ollama/models</code>&#x3002;&#x4F46;&#x7531;&#x4E8E;&#x5927;&#x6A21;&#x578B;&#x6587;&#x4EF6;&#x5F80;&#x5F80;&#x7279;&#x522B;&#x5927;&#xFF0C;&#x6709;&#x65F6;&#x9700;&#x8981;&#x5C06;&#x5927;&#x6A21;&#x578B;&#x6587;&#x4EF6;&#x5B58;&#x50A8;&#x5230;&#x4E13;&#x95E8;&#x7684;&#x6570;&#x636E;&#x76D8;&#xFF0C;&#x6B64;&#x65F6;&#x5C31;&#x9700;&#x8981;&#x4FEE;&#x6539;&#x5927;&#x6A21;&#x578B;&#x6587;&#x4EF6;&#x7684;&#x5B58;&#x50A8;&#x8DEF;&#x5F84;&#x3002;</p>
<p>&#x5B98;&#x65B9;&#x63D0;&#x4F9B;&#x7684;&#x65B9;&#x6CD5;&#x662F;&#x8BBE;&#x7F6E;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x201C;OLLAMA_MODELS&#x201D;&#xFF0C;&#x4F46;&#x6211;&#x5728;Linux&#x4E0A;&#x5C1D;&#x8BD5;&#x540E;&#xFF0C;&#x5E76;&#x6CA1;&#x6709;&#x6210;&#x529F;&#x3002;</p>
<p>&#x5206;&#x6790;Linux&#x7248;&#x7684;&#x5B89;&#x88C5;&#x811A;&#x672C;install.sh&#x540E;&#xFF0C;&#x6211;&#x53D1;&#x73B0;&#x662F;&#x7531;&#x4E8E;&#x5176;&#x4E2D;&#x521B;&#x5EFA;&#x4E86;&#x7528;&#x6237;ollama&#x548C;&#x7528;&#x6237;&#x7EC4;ollama&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x5927;&#x6A21;&#x578B;&#x5B58;&#x50A8;&#x5230;&#x4E86;&#x8BE5;&#x7528;&#x6237;&#x7684;&#x76EE;&#x5F55;<code>/usr/share/ollama/.ollama/models</code>&#xFF0C;&#x800C;&#x6211;&#x7684;&#x5E10;&#x6237;&#x5BF9;ollama&#x5E10;&#x6237;&#x7684;&#x4E00;&#x4E9B;&#x64CD;&#x4F5C;&#x5E76;&#x4E0D;&#x80FD;&#x751F;&#x6548;&#xFF0C;&#x5373;&#x4F7F;&#x6211;&#x518D;&#x624B;&#x52A8;&#x5C06;&#x6211;&#x7684;&#x5E10;&#x6237;&#x6DFB;&#x52A0;&#x8FDB;ollama&#x7528;&#x6237;&#x7EC4;&#xFF0C;&#x4E5F;&#x4ECD;&#x7136;&#x4F1A;&#x6709;&#x4E00;&#x4E9B;&#x6743;&#x9650;&#x95EE;&#x9898;&#xFF0C;&#x5BFC;&#x81F4;&#x5BF9;ollama&#x5E10;&#x6237;&#x7684;&#x76EE;&#x5F55;&#x64CD;&#x4F5C;&#x4E0D;&#x751F;&#x6548;&#x3002;</p>
<p>&#x7531;&#x4E8E;&#x65B0;&#x5EFA;&#x7684;ollama&#x5E10;&#x6237;&#x5E76;&#x6CA1;&#x6709;&#x7ED9;&#x6211;&#x5E26;&#x6765;&#x989D;&#x5916;&#x7684;&#x4FBF;&#x5229;&#xFF0C;&#x6700;&#x540E;&#x6211;&#x7528;&#x4EE5;&#x4E0B;&#x6B65;&#x9AA4;&#x6765;&#x5B9E;&#x73B0;&#x4FEE;&#x6539;&#x5927;&#x6A21;&#x578B;&#x6587;&#x4EF6;&#x7684;&#x5B58;&#x50A8;&#x8DEF;&#x5F84;&#xFF1A;</p>
<ol>
<li>&#x4FEE;&#x6539;&#x5B89;&#x88C5;&#x6587;&#x4EF6; install.sh&#xFF0C;&#x53D6;&#x6D88;&#x5176;&#x4E2D;&#x521B;&#x5EFA;&#x7528;&#x6237;ollama&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x53C2;&#x8003;&#x5982;&#x4E0B;&#xFF1A;</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">shell&#x590D;&#x5236;&#x4EE3;&#x7801;# if ! id ollama &gt;/dev/null 2&gt;&amp;1; then </span><br><span class="line">    # status &quot;Creating ollama user...&quot; </span><br><span class="line">    # $SUDO useradd -r -s /bin/false -m -d /usr/share/ollama ollama </span><br><span class="line"># fi </span><br><span class="line"># status &quot;Adding current user to ollama group...&quot; </span><br><span class="line"># $SUDO usermod -a -G ollama $(whoami)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>&#x4FEE;&#x6539;&#x5B89;&#x88C5;&#x6587;&#x4EF6; install.sh&#xFF0C;&#x4F7F;&#x7528;&#x6211;&#x7684;&#x5E10;&#x6237;&#x6765;&#x542F;&#x52A8;ollama&#x670D;&#x52A1;&#xFF0C;&#x53C2;&#x8003;&#x5982;&#x4E0B;&#xFF1A;</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;    status &quot;Creating ollama systemd service...&quot;</span><br><span class="line">    cat &lt;&lt;EOF | $SUDO tee /etc/systemd/system/ollama.service &gt;/dev/null</span><br><span class="line">[Unit]</span><br><span class="line">Description=Ollama Service</span><br><span class="line">After=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=$BINDIR/ollama serve</span><br><span class="line">User=&lt;myusername&gt;</span><br><span class="line">Group=&lt;myusername&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>&#x4FEE;&#x6539;&#x5B89;&#x88C5;&#x6587;&#x4EF6; install.sh&#xFF0C;&#x6DFB;&#x52A0;&#x5982;&#x4E0B;&#x914D;&#x7F6E;&#x4E2D;&#x6307;&#x5B9A;&#x73AF;&#x5883;&#x53D8;&#x91CF;<code>OLLAMA_MODELS</code>&#x6307;&#x5B9A;&#x5B58;&#x50A8;&#x8DEF;&#x5F84;&#xFF0C;&#x518D;&#x7528;&#x6B64;&#x5B89;&#x88C5;&#x6587;&#x4EF6;&#x6765;&#x5B89;&#x88C5;ollama&#x3002;</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;Environment=&quot;OLLAMA_MODELS=/home/paco/lab/LLM/ollama/OLLAMA_MODELS&quot;</span><br></pre></td></tr></table></figure>

<p>&#x6216;&#x8005;&#x5728;&#x5B89;&#x88C5;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x521B;&#x5EFA;&#x5982;&#x4E0B;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x914D;&#x7F6E;&#x73AF;&#x5883;&#x53D8;&#x91CF;<code>OLLAMA_MODELS</code>&#x6765;&#x6307;&#x5B9A;&#x5B58;&#x50A8;&#x8DEF;&#x5F84;&#xFF0C;&#x518D;&#x91CD;&#x542F;Ollama&#x670D;&#x52A1;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;:~$ cat /etc/systemd/system/ollama.service.d/environment.conf</span><br><span class="line">[Service]</span><br><span class="line">Environment=OLLAMA_MODELS=&lt;path&gt;/OLLAMA_MODELS</span><br></pre></td></tr></table></figure>

<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/62d4adc0d7ba6b2eb79e434743543698.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7339827208086896676.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7339827208086896676.html" itemprop="url">【Android 13源码分析】WindowContaine</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-02-27T11:38:46+08:00">
                2024-02-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x5728;&#x5B89;&#x5353;&#x6E90;&#x7801;&#x7684;&#x8BBE;&#x8BA1;&#x4E2D;&#xFF0C;&#x5C06;&#x5C06;&#x5C4F;&#x5E55;&#x5206;&#x4E3A;&#x4E86;37&#x5C42;&#xFF0C;&#x4E0D;&#x540C;&#x7684;&#x7A97;&#x53E3;&#x5C06;&#x5728;&#x4E0D;&#x540C;&#x7684;&#x5C42;&#x7EA7;&#x4E2D;&#x663E;&#x793A;&#x3002;<br>&#x5BF9;&#x8FD9;&#x4E00;&#x5757;&#x7684;&#x6982;&#x5FF5;&#x4EE5;&#x53CA;&#x76F8;&#x5173;&#x6E90;&#x7801;&#x505A;&#x4E86;&#x8BE6;&#x7EC6;&#x5206;&#x6790;&#xFF0C;&#x6574;&#x7406;&#x51FA;&#x4EE5;&#x4E0B;&#x51E0;&#x7BC7;&#x3002;</p>
<p><a href="https://dev.newban.cn/7339827208086896676">&#x3010;Android 13&#x6E90;&#x7801;&#x5206;&#x6790;&#x3011;WindowContainer&#x7A97;&#x53E3;&#x5C42;&#x7EA7;-1-&#x521D;&#x8BC6;&#x7A97;&#x53E3;&#x5C42;&#x7EA7;&#x6811;</a></p>
<p><a href="https://dev.newban.cn/7338808893529423883">&#x3010;Android 13&#x6E90;&#x7801;&#x5206;&#x6790;&#x3011;WindowContainer&#x7A97;&#x53E3;&#x5C42;&#x7EA7;-2-&#x6784;&#x5EFA;&#x6D41;&#x7A0B;</a></p>
<p><a href="https://dev.newban.cn/7338808893529440267">&#x3010;Android 13&#x6E90;&#x7801;&#x5206;&#x6790;&#x3011;WindowContainer&#x7A97;&#x53E3;&#x5C42;&#x7EA7;-3-&#x5B9E;&#x4F8B;&#x5206;&#x6790;</a></p>
<p>&#x5F53;&#x524D;&#x4E3A;&#x7B2C;&#x4E00;&#x7BC7;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x57FA;&#x7840;&#x77E5;&#x8BC6;&#x4ECB;&#x7ECD;&#x3002;</p>
<p>&#x6253;&#x5F00;&#x201C;&#x7535;&#x8BDD;&#x5E94;&#x7528;&#x201D;&#xFF0C;&#x7136;&#x540E;&#x6309;&#x97F3;&#x91CF;&#x952E;&#x51FA;&#x73B0;&#x4E00;&#x4E0B;&#x754C;&#x9762;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/0bfdf1b1987164b58313dc6a2180ce52f72ff2decf911cee7d6ed3d3179aac10" alt="&#x7535;&#x8BDD;&#x5E94;&#x7528;&#x6309;&#x97F3;&#x91CF;&#x622A;&#x56FE;.png"></p>
<p>&#x63D0;&#x51FA;2&#x4E2A;&#x95EE;&#x9898;&#xFF1A;</p>
<ol>
<li>&#x4E3A;&#x4EC0;&#x4E48;&#x97F3;&#x91CF;&#x7A97;&#x53E3;&#x4F1A;&#x6321;&#x4F4F;&#x5E94;&#x7528;&#x7A97;&#x53E3;&#xFF1F;</li>
<li>&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x7BA1;&#x6253;&#x5F00;&#x54EA;&#x4E2A;&#x5E94;&#x7528;&#x90FD;&#x80FD;&#x770B;&#x5230;&#x5BFC;&#x822A;&#x680F;&#x548C;&#x72B6;&#x6001;&#x680F;&#xFF1F;</li>
</ol>
<p>&#x518D;&#x770B;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x56FE;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/6a43758d3f1edcfff62e4e99143ffbfa9d4a492b6fdee20cc8bb08569e3047c2" alt="&#x97F3;&#x91CF;&#x622A;&#x56FE;&#x5C4F;&#x5E55;&#x5206;&#x7EA7;.png"></p>
<p>&#x5DE6;&#x8FB9;&#x662F;&#x5C06;&#x7B2C;&#x4E00;&#x5F20;&#x622A;&#x56FE;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;&#x7A97;&#x53E3;&#x63D0;&#x51FA;&#x6765;&#x753B;&#x4E86;&#x7684;&#x6A21;&#x62DF;&#x56FE;&#xFF0C; &#x60F3;&#x8C61;&#x4E00;&#x4E0B;&#x6BCF;&#x4E2A;&#x7A97;&#x53E3;&#x5176;&#x5B9E;&#x90FD;&#x662F;&#x5168;&#x5C4F;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x4ED6;&#x7684;&#x524D;&#x540E;&#x987A;&#x5E8F;&#x82E5;&#x53F3;&#x56FE;&#xFF08;&#x6CE8;&#x610F;&#x989C;&#x8272;&#x662F;&#x5BF9;&#x5E94;&#x7684;&#xFF09;&#x3002; &#x5982;&#x679C;&#x8BF4;&#x662F;&#x6309;&#x53F3;&#x8FB9;&#x7684;&#x8FD9;&#x79CD;&#x5C42;&#x7EA7;&#x6392;&#x5E8F;&#xFF0C;&#x90A3;&#x4E48;&#x97F3;&#x91CF;&#x952E;&#x7684;&#x7A97;&#x53E3;&#x548C;&#x72B6;&#x6001;&#x680F;&#x7684;&#x7A97;&#x53E3;&#x5C31;&#x4F1A;&#x6321;&#x4F4F;Activity&#x7684;&#x7A97;&#x53E3;&#x3002;</p>
<p>&#x5728;&#x5B89;&#x5353;&#x4E2D;&#x7A97;&#x53E3;&#x662F;&#x6709;&#x5148;&#x540E;&#x987A;&#x5E8F;&#x7684;&#xFF0C;&#x8D8A;&#x9760;&#x8FD1;&#x7528;&#x6237;&#x7684;&#x5C31;&#x8D8A;&#x9760;&#x524D;&#xFF0C;&#x5C31;&#x80FD;&#x6321;&#x4F4F;&#x5E95;&#x4E0B;&#x7684;&#x7A97;&#x53E3;&#x3002; &#x76EE;&#x524D;&#x8BF4;&#x8FD9;&#x4E48;&#x4E00;&#x4E2A;&#x7ED3;&#x8BBA;&#x53EF;&#x80FD;&#x4E3A;&#x65F6;&#x8FC7;&#x65E9;&#xFF0C;&#x540E;&#x9762;&#x7684;&#x5185;&#x5BB9;&#x5C06;&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;&#x3002;</p>
<ol>
<li><h1 id="&#x57FA;&#x7840;&#x77E5;&#x8BC6;&#x4ECB;&#x7ECD;"><a href="#&#x57FA;&#x7840;&#x77E5;&#x8BC6;&#x4ECB;&#x7ECD;" class="headerlink" title="&#x57FA;&#x7840;&#x77E5;&#x8BC6;&#x4ECB;&#x7ECD;"></a>&#x57FA;&#x7840;&#x77E5;&#x8BC6;&#x4ECB;&#x7ECD;</h1></li>
</ol>
<h2 id="1-1-&#x4E09;&#x7EF4;&#x7A7A;&#x95F4;&#x6982;&#x5FF5;"><a href="#1-1-&#x4E09;&#x7EF4;&#x7A7A;&#x95F4;&#x6982;&#x5FF5;" class="headerlink" title="1.1 &#x4E09;&#x7EF4;&#x7A7A;&#x95F4;&#x6982;&#x5FF5;"></a>1.1 &#x4E09;&#x7EF4;&#x7A7A;&#x95F4;&#x6982;&#x5FF5;</h2><h3 id="1-1-1-&#x4E09;&#x7EF4;&#x7A7A;&#x95F4;&#x6982;&#x5FF5;&#x2013;&#x6E38;&#x620F;3D&#x4E16;&#x754C;"><a href="#1-1-1-&#x4E09;&#x7EF4;&#x7A7A;&#x95F4;&#x6982;&#x5FF5;&#x2013;&#x6E38;&#x620F;3D&#x4E16;&#x754C;" class="headerlink" title="1.1.1 &#x4E09;&#x7EF4;&#x7A7A;&#x95F4;&#x6982;&#x5FF5;&#x2013;&#x6E38;&#x620F;3D&#x4E16;&#x754C;"></a>1.1.1 &#x4E09;&#x7EF4;&#x7A7A;&#x95F4;&#x6982;&#x5FF5;&#x2013;&#x6E38;&#x620F;3D&#x4E16;&#x754C;</h3><p>&#x4E0B;&#x9762;2&#x4E2A;&#x56FE;&#x6765;&#x81EA;Unity3d&#x5B98;&#x7F51;&#x5F00;&#x53D1;&#x6587;&#x6863;:<br><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/684d0b6d91c3af9505bbf3daa36f0404ecec21f56df189ded8ef965076960efc" alt="unity&#x6444;&#x50CF;&#x5934;-1.png"><br>&#x6211;&#x4EEC;&#x73A9;&#x7684;&#x738B;&#x8005;&#x8363;&#x8000;&#xFF0C;&#x539F;&#x795E;&#x7B49;&#x6E38;&#x620F;&#x7684;&#x5F00;&#x53D1;&#xFF0C;&#x90FD;&#x662F;&#x7C7B;&#x4F3C;&#x5728;&#x8FD9;&#x4E48;&#x4E00;&#x4E2A;3D&#x573A;&#x666F;&#x4E0B;&#x8FDB;&#x884C;&#x7684;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x5C06;&#x4F7F;&#x7528;3D&#x5EFA;&#x6A21;&#x5DE5;&#x5177;&#x6765;&#x521B;&#x5EFA;&#x5730;&#x5F62;&#x3001;&#x5EFA;&#x7B51;&#x3001;&#x690D;&#x88AB;&#x7B49;&#x5730;&#x56FE;&#x5143;&#x7D20;&#xFF0C;&#x5E76;&#x901A;&#x8FC7;&#x6750;&#x8D28;&#x548C;&#x8D34;&#x56FE;&#x6765;&#x589E;&#x5F3A;&#x5730;&#x56FE;&#x7684;&#x89C6;&#x89C9;&#x6548;&#x679C;&#x3002;</p>
<p>&#x6BD4;&#x5982;&#x8FD9;&#x5F20;&#x56FE;&#x7247;&#x91CC;&#x653E;&#x4E86;3&#x4E2A;&#x989C;&#x8272;&#x7684;&#x67F1;&#x5B50;&#x3002; &#x9664;&#x4E86;&#x8FD9;&#x4E9B;&#x7269;&#x4F53;&#x5916;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x6444;&#x50CF;&#x673A;&#xFF08;Camera&#xFF09;&#xFF0C;&#x5B83;&#x662F;&#x7528;&#x6765;&#x6355;&#x6349;&#x753B;&#x9762;&#x7684;&#xFF0C; &#x6BD5;&#x7ADF;&#x624B;&#x673A;&#x5C4F;&#x5E55;&#x662F;2D&#x7684;&#xFF0C;&#x7B80;&#x5355;&#x6765;&#x8BF4;&#x8FD9;&#x4E2A;&#x6444;&#x50CF;&#x673A;&#x80FD;&#x6355;&#x6349;&#x5230;&#x7684;&#x753B;&#x9762;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x624B;&#x673A;&#x5C4F;&#x5E55;&#x4E0A;&#x663E;&#x793A;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x6BD4;&#x5982;&#x8FD9;&#x5F20;&#x56FE;&#x7247;&#x6355;&#x6349;&#x5230;&#x7684;&#x753B;&#x9762;&#x662F;&#x53F3;&#x4E0B;&#x89D2;&#x7684;&#x5185;&#x5BB9;&#x3002;</p>
<p>&#x50CF;&#x6211;&#x4EEC;&#x73A9;&#x6E38;&#x620F;&#x79FB;&#x52A8;&#x89D2;&#x8272;&#xFF0C;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x901A;&#x8FC7;&#x8F6C;&#x52A8;&#x8FD9;&#x4E2A;&#x6444;&#x50CF;&#x673A;&#xFF08;Camera&#xFF09;&#x6765;&#x5B8C;&#x6210;&#x7684;&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x8FD9;&#x79CD;&#x56FE;&#x4F1A;&#x66F4;&#x52A0;&#x50CF;&#x4E00;&#x4E2A;&#x6E38;&#x620F;&#x7684;&#x753B;&#x9762;&#x4E00;&#x4E9B;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/1b45aaaee5276f1c7eceaeb3c31f16754347479755fca7363791f1aab241ea15" alt="unity&#x6444;&#x50CF;&#x5934;-2.png"></p>
<p>&#x901A;&#x8FC7;&#x770B;&#x6E38;&#x620F;&#x5730;&#x56FE;&#x7684;3D&#x5F00;&#x53D1;&#x573A;&#x666F;&#xFF0C;&#x5C31;&#x662F;&#x5E0C;&#x671B;&#x80FD;&#x72D7;&#x66F4;&#x52A0;&#x751F;&#x52A8;&#x7684;&#x7406;&#x89E3;&#x5230;&#x5728;2D&#x7684;&#x624B;&#x673A;&#x5C4F;&#x5E55;&#x4E0B;&#xFF0C;&#x5176;&#x5B9E;&#x6709;&#x4E00;&#x4E2A;3D&#x7684;&#x7A7A;&#x95F4;&#xFF0C;&#x867D;&#x7136;&#x6211;&#x4EEC;&#x7684;&#x5B89;&#x5353;&#x5F00;&#x53D1;&#x4E0D;&#x4F1A;&#x50CF;&#x6E38;&#x620F;&#x5F00;&#x53D1;&#x90A3;&#x4E48;&#x590D;&#x6742;&#xFF0C;&#x4F46;&#x662F;&#x539F;&#x7406;&#x4E5F;&#x662F;&#x4E00;&#x6837;&#x7684;&#x3002;</p>
<h3 id="1-1-2-&#x4E09;&#x7EF4;&#x7A7A;&#x95F4;&#x6982;&#x5FF5;&#x2013;Android&#x7684;&#x4E09;&#x7EF4;&#x5750;&#x6807;&#x7CFB;"><a href="#1-1-2-&#x4E09;&#x7EF4;&#x7A7A;&#x95F4;&#x6982;&#x5FF5;&#x2013;Android&#x7684;&#x4E09;&#x7EF4;&#x5750;&#x6807;&#x7CFB;" class="headerlink" title="1.1.2 &#x4E09;&#x7EF4;&#x7A7A;&#x95F4;&#x6982;&#x5FF5;&#x2013;Android&#x7684;&#x4E09;&#x7EF4;&#x5750;&#x6807;&#x7CFB;"></a>1.1.2 &#x4E09;&#x7EF4;&#x7A7A;&#x95F4;&#x6982;&#x5FF5;&#x2013;Android&#x7684;&#x4E09;&#x7EF4;&#x5750;&#x6807;&#x7CFB;</h3><p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/46f7a8ddac7e6efd382929c1ee53e4253d97b0fa5c615398de931fcb04c400dc" alt="Android&#x4E09;&#x7EF4;&#x5750;&#x6807;&#x7CFB;.png"><br>Android&#x5750;&#x6807;&#x7CFB;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x4E09;&#x7EF4;&#x5750;&#x6807;&#xFF0C;Z&#x8F74;&#x5411;&#x4E0A;&#xFF0C;X&#x8F74;&#x5411;&#x53F3;&#xFF0C;Y&#x8F74;&#x5411;&#x4E0B;&#x3002;</p>
<p>&#x7ECF;&#x5E38;&#x542C;&#x5230;&#x7684; Z-Order &#x4E5F;&#x5C31;&#x662F;&#x6307;&#x7A97;&#x53E3;&#x5728;Z&#x8F74;&#x7684;&#x6392;&#x5E8F;&#xFF0C;&#x79BB;&#x7528;&#x6237;&#x8D8A;&#x8FD1;&#xFF0C;Z&#x503C;&#x8D8A;&#x5927;&#x3002;&#x5E76;&#x4E14;&#x80FD;&#x591F;&#x906E;&#x6321;&#x4F4F;&#x540E;&#x9762;&#x7684;&#x7A97;&#x53E3;&#x3002;</p>
<p>&#x4E3A;&#x4E86;&#x518D;&#x52A0;&#x6DF1;&#x4E00;&#x4E0B;&#x5B89;&#x5353;&#x7A97;&#x53E3;&#x7684;&#x5C42;&#x7EA7;&#x5173;&#x7CFB;&#xFF0C;&#x4E0B;&#x9762;&#x770B;&#x4E00;&#x5F20;&#x5E94;&#x7528;&#x5F00;&#x53D1;&#x7684;View&#x5C42;&#x7EA7;&#x7684;3D&#x89C6;&#x89D2;&#x3002;</p>
<p><strong>&#x6CE8;&#x610F;&#xFF0C;&#x4E0B;&#x9762;&#x7684;&#x56FE;&#x7247;&#x662F;View&#xFF0C;&#x4E0D;&#x662F;&#x672C;&#x6B21;&#x8981;&#x8BB2;&#x7684;&#x7A97;&#x53E3;&#xFF0C;&#x53EA;&#x662F;&#x4E3A;&#x4E86;&#x52A0;&#x6DF1;&#x4E00;&#x4E0B;&#x5C42;&#x7EA7;&#x5370;&#x8C61;</strong></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/4333d3f8b3420080e77562e8da1d3ac916e68fb515a07bdd52cc76f1b793a1b8" alt="APP37&#x5C42;-2.png"></p>
<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5728;&#x5E03;&#x5C40;&#x4E86;&#x5199;&#x4E86;37&#x5C42;&#x7EA6;&#x675F;&#x5E03;&#x5C40;&#xFF0C;&#x5176;&#x5B9E;&#x7B2C;3&#x5C42;&#x52A0;&#x4E86;&#x4E00;&#x4E2A;&#x6309;&#x94AE;&#x3002; &#x53F3;&#x4E0A;&#x89D2;&#x6211;&#x4EEC;&#x624B;&#x673A;&#x5C4F;&#x5E55;&#x4E0A;&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x6309;&#x94AE;&#x7684;&#x754C;&#x9762;&#xFF0C;&#x4F46;&#x662F;&#x53F3;&#x4E0B;&#x89D2;&#x901A;&#x8FC7;Android Studio&#x81EA;&#x5E26;&#x7684;&#x5DE5;&#x5177;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#xFF0C;&#x6574;&#x4E2A;View&#x6811;&#x662F;&#x6709;&#x5F88;&#x591A;&#x5C42;&#x7684;&#xFF08;&#x4EE3;&#x7801;&#x5199;&#x4E86;37&#x5C42;&#xFF09;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x770B;&#x5230;&#x7684;View&#x5C42;&#x7EA7;&#x5176;&#x5B9E;&#x548C;&#x540E;&#x9762;&#x8981;&#x8BB2;&#x5C31;&#x7A97;&#x53E3;&#x5206;&#x5C42;&#xFF0C;&#x662F;&#x6709;&#x76F8;&#x4F3C;&#x4E4B;&#x5904;&#x7684;&#x3002; &#x5C06;&#x8FD9;&#x91CC;&#x662F;37&#x5C42;&#x60F3;&#x8C61;&#x5C42;&#x5B89;&#x5353;&#x5728;&#x7A97;&#x53E3;&#x7684;&#x5206;&#x5C42;&#x4E5F;&#x662F;&#x53EF;&#x4EE5;&#x7684;&#x3002;</p>
<h2 id="1-2-ViewTree"><a href="#1-2-ViewTree" class="headerlink" title="1.2 ViewTree"></a>1.2 ViewTree</h2><p>&#x4E3A;&#x4E86;&#x540E;&#x7EED;&#x65B9;&#x4FBF;&#x7406;&#x89E3;&#x7A97;&#x53E3;&#x6811;&#xFF0C; &#x5148;&#x4ECB;&#x7ECD;&#x4E00;&#x4E0B;&#x5B89;&#x5353;&#x5F00;&#x53D1;&#x90FD;&#x77E5;&#x9053;&#x7684;View&#x6811;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/bc3174df54b9dc0a8fd6bcb36a8989fc46b1ef0262438711719d796a91807469" alt="&#x7EA2;&#x7EFF;&#x5E03;&#x5C40;.png"></p>
<p>XML&#x91CC;&#x5982;&#x56FE;&#x5199;&#x4E0B;2&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x7EA2;&#x7EFF;&#x5E03;&#x5C40;&#xFF0C;&#x663E;&#x793A;&#x7684;UI&#x6548;&#x679C;&#x7EFF;&#x8272;&#x7684;&#x4F1A;&#x6321;&#x4F4F;&#x4E00;&#x90E8;&#x5206;&#x7EA2;&#x8272;&#x7684;&#x3002;&#x4F46;&#x662F;&#x7528;&#x5DE5;&#x5177;&#x5176;&#x5B9E;&#x53EF;&#x4EE5;&#x53D1;&#x9001;&#x7EA2;&#x8272;&#x63A7;&#x4EF6;&#x5176;&#x5B9E;&#x4E5F;&#x662F;&#x5B8C;&#x6210;&#x7ED8;&#x5236;&#x7684;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/fa55458a8d4aad5e94e5396d0c18bb839fa1e3239398294a7d5a95366e0acec7" alt="&#x7EA2;&#x7EFF;&#x5E03;&#x5C40;&#x56FE;&#x5C42;.png"></p>
<p>&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x5728;&#x540C;&#x4E00;&#x5C42;&#x7EA7;&#x4E0B;&#xFF0C;&#x5728;ViewGropu&#x5B69;&#x5B50;View&#x6570;&#x7EC4;&#x8FD9;&#x4E2A;&#x96C6;&#x5408;&#x4E2D;&#xFF0C;&#x4E0B;&#x6807;&#x8D8A;&#x5927;&#x7684;View&#x4F1A;&#x6321;&#x4F4F;&#x540E;&#x9762;&#x7684;View&#x3002;&#x4E5F;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x5C42; &#x5C42;&#x7EA7;&#x8D8A;&#x9760;&#x524D;&#xFF0C;&#x5C31;&#x4F1A;&#x5F53;&#x521D;&#x540E;&#x9762;&#x7684;View&#x3002;</p>
<p>&#x7EE7;&#x7EED;&#x589E;&#x52A0;&#x51E0;&#x4E2A;View</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/253796b457ab58c149694d50717b5b61a630c7b36cdcb093c4553b55b836a874" alt="&#x7EA2;&#x7EFF;&#x5E03;&#x5C40;&#x65B0;&#x589E;.png"></p>
<ol>
<li>&#x63A7;&#x4EF6;B&#x4E0B;&#x65B0;&#x589E;&#x63A7;&#x4EF6;D&#xFF0C;D&#x4E0B;&#x9762;&#x653E;&#x4E86;&#x4E00;&#x4E2A;&#x6587;&#x672C;&#x63A7;&#x4EF6;G</li>
<li>&#x63A7;&#x4EF6;C&#x4E0B;&#x9762;&#x65B0;&#x589E;&#x4E86;&#x4E00;&#x4E2A;&#x6587;&#x672C;&#x63A7;&#x4EF6;F</li>
</ol>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/b9749901732a861f381c9b5c1bd7d8b66350caee2dfdc4357c4e0a91a6bdf53a" alt="&#x65B0;&#x589E;&#x63A7;&#x4EF6;&#x540E;&#x7684;&#x4E09;&#x7EF4;&#x89C6;&#x89D2;.jpg"></p>
<p>&#x5DE6;&#x8FB9;&#x770B;&#x5230;&#x5BF9;View&#x505A;&#x4E86;&#x5C42;&#x7EA7;&#x5904;&#x7406;&#xFF0C;&#x8FD9;&#x4E2A;&#x5C31;&#x662F;ViewTree&#xFF0C;&#x53EF;&#x4EE5;&#x5C06;&#x5176;&#x753B;&#x6210;&#x6811;&#x56FE;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/913c4d949ec3ed1ee1a505b2cff7759f0a1aac98e76023d5d7f621ff6a9b6fd1" alt="Tree.png"></p>
<p>&#x8FD9;&#x4E2A;&#x5C31;&#x662F;View&#x5C42;&#x7684;View&#x6811;&#xFF0C;&#x80FD;&#x6784;&#x5EFA;&#x51FA;View&#x6811;&#x7684;&#x539F;&#x56E0;&#x662F;&#x56E0;&#x4E3A;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x5B9A;&#x4E49;&#x4E86;ViewGroup&#x8FD9;&#x4E2A;&#x7C7B;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">csharp&#x590D;&#x5236;&#x4EE3;&#x7801;# View</span><br><span class="line"></span><br><span class="line">   // &#x7236;&#x5BB9;&#x5668;</span><br><span class="line">   protected ViewParent mParent;</span><br><span class="line">	</span><br><span class="line"># ViewGroup</span><br><span class="line">    // &#x6240;&#x6709;&#x5B50;View</span><br><span class="line">    private View[] mChildren;</span><br><span class="line"></span><br><span class="line">    public void addView(View child, int index) {</span><br><span class="line">        ......</span><br><span class="line">        // &#x5185;&#x90E8;&#x5B9E;&#x73B0;&#x662F;&#x901A;&#x8FC7;addInArray &#x5C06;View&#x6DFB;&#x52A0;&#x5230;&#x6570;&#x7EC4;mChildren&#x4E2D;</span><br><span class="line">        addView(child, index, params);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void removeView(View view) {</span><br><span class="line">        ......// &#x672C;&#x8D28;&#x8FD8;&#x662F;&#x4ECE;mChildren&#x79FB;&#x9664;</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/1362892eaec0dbc6e04dae46f5f936f0a85ab13230761ebbcb35138af222531a" alt="&#x5B89;&#x5353;&#x5E38;&#x89C1;&#x5E03;&#x5C40;.png"></p>
<p>&#x5E94;&#x7528;&#x5E03;&#x5C40;&#x7528;&#x7684;&#x573A;&#x666F;&#x7684;&#x51E0;&#x4E2A;&#x7C7B;&#xFF0C;&#x4ED6;&#x4EEC;&#x90FD;&#x6709;&#x4E00;&#x4E2A;&#x5171;&#x540C;&#x7684;&#x7236;&#x7C7B;&#x2013;ViewGroup&#x3002;</p>
<p>ViewGroup&#x7EE7;&#x627F;&#x4E86;View,&#x6240;&#x4EE5;&#x6709;&#x7236;&#x4EB2;&#xFF08;mParent&#xFF09;&#xFF0C;&#x81EA;&#x8EAB;&#x5185;&#x90E8;&#x53C8;&#x7EF4;&#x62A4;&#x4E86;&#x4E00;&#x4E2A;View&#x6570;&#x7EC4;&#xFF08;mChildren&#xFF09;&#x8868;&#x793A;&#x5B83;&#x7684;&#x5B69;&#x5B50;&#x4EEC;&#x3002; &#x4E0A;&#x6709;&#x7236;&#x4EB2;&#x4E0B;&#x6709;&#x4E00;&#x7FA4;&#x5B69;&#x5B50;&#xFF0C;&#x6240;&#x4EE5;&#x80FD;&#x6784;&#x5EFA;&#x51FA;&#x4E00;&#x4E2A;ViewTree&#x3002;</p>
<p>&#x5982;&#x679C;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x5B69;&#x5B50;&#xFF0C;&#x90A3;&#x662F;&#x7EBF;&#x6027;&#x7ED3;&#x6784;&#xFF0C;&#x56E0;&#x6B64;&#x5B69;&#x5B50;&#x5FC5;&#x987B;&#x662F;&#x591A;&#x4E2A;&#xFF0C;&#x6240;&#x4EE5;ViewGroup&#x4E5F;&#x662F;&#x4E00;&#x4E2A;View&#x7684;&#x5BB9;&#x5668;&#x7C7B;&#x3002; <strong>&#x6709;&#x8FD9;&#x4E48;&#x4E00;&#x4E2A;&#x7C7B;&#x7684;&#x5B58;&#x5728;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5D4C;&#x5957;&#x6765;&#x884C;&#x7A0B;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x590D;&#x6742;&#x7684;ViewTree&#x7ED3;&#x6784;</strong><br>&#x8FD9;&#x4E5F;&#x662F;&#x5E94;&#x7528;&#x5F00;&#x53D1;&#x8005;&#x80FD;&#x5199;&#x51FA;&#x5404;&#x79CD;&#x4E30;&#x5BCC;UI&#x7684;&#x57FA;&#x7840;&#x3002;</p>
<p><strong>&#x5728;&#x7A97;&#x53E3;&#x8FD9;&#x4E00;&#x7EA7;&#x522B;&#x7684;&#x5F00;&#x53D1;&#x4E2D;&#xFF0C;&#x4E5F;&#x6709;&#x7A97;&#x53E3;&#x6811;&#xFF0C;&#x4E5F;&#x6709;&#x5BF9;&#x5E94;&#x7684;&#x5BB9;&#x5668;&#x7ED3;&#x6784;&#x3002;</strong> &#x540E;&#x9762;&#x4F1A;&#x8BE6;&#x7EC6;&#x89E3;&#x91CA;&#x7A97;&#x53E3;&#x5BB9;&#x5668;&#x7C7B;&#xFF0C;&#x5728;&#x4ECB;&#x7ECD;&#x4E4B;&#x524D;&#x5148;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;&#x4EC0;&#x4E48;&#x662F;&#x7A97;&#x53E3;&#x3002;</p>
<p>ViewTree&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x4E5F;&#x662F;&#x771F;&#x5B9E;&#x5B58;&#x5728;&#x7684;&#xFF0C;&#x5728;Activity&#x4E2D;&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x4EE3;&#x7801;&#x5BF9;&#x5E94;ViewTree&#x7684;&#x53D8;&#x5316;&#x505A;&#x76D1;&#x542C;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scss&#x590D;&#x5236;&#x4EE3;&#x7801;    View.getViewTreeObserver().addOnGlobalLayoutListener(</span><br><span class="line">        ......</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<h2 id="1-3-&#x4EC0;&#x4E48;&#x662F;&#x7A97;&#x53E3;"><a href="#1-3-&#x4EC0;&#x4E48;&#x662F;&#x7A97;&#x53E3;" class="headerlink" title="1.3 &#x4EC0;&#x4E48;&#x662F;&#x7A97;&#x53E3;"></a>1.3 &#x4EC0;&#x4E48;&#x662F;&#x7A97;&#x53E3;</h2><p>&#x4ECE;&#x89C6;&#x89C9;&#x4E0A;&#xFF0C;&#x7528;&#x6237;&#x5728;&#x624B;&#x673A;&#x5C4F;&#x5E55;&#x4E0A;&#x770B;&#x5230;&#x7684;&#x201C;&#x4E00;&#x5757;&#x533A;&#x57DF;&#x201D;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x7A97;&#x53E3;&#xFF0C;&#x6BD4;&#x5982;&#x524D;&#x9762;&#x770B;&#x5230;&#x7684;&#x8FD9;&#x5F20;&#x56FE;&#xFF0C;&#x6BCF;&#x4E00;&#x5757;&#x90FD;&#x662F;&#x4E00;&#x4E2A;&#x7A97;&#x53E3;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/b9a975f09e999fd59e7c4a194e27d83e5140104002ca8249feab191c8fb5089f" alt="&#x622A;&#x56FE;&#x5BF9;&#x5E94;&#x7A97;&#x53E3;.png"></p>
<p>&#x4ECE;&#x4EE3;&#x7801;&#x4E0A;&#x6765;&#x8BF4;&#xFF0C;&#x5E94;&#x7528;&#x7AEF;&#x7684;&#x7A97;&#x53E3;&#x6307;&#x7684;&#x662F;Window&#xFF0C; framework&#x5C42;&#x7684;&#x7A97;&#x53E3;&#x6307;&#x7684;&#x662F;WindowState</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/75167c702d35c3fc8423356665209a9f46d0b9e2960401371b2f891855f67760" alt="&#x7A97;&#x53E3;&#x4E3E;&#x4F8B;-2.png"></p>
<p>&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x7528;&#x4E0D;&#x4E00;&#x6837;&#x7684;&#x7C7B;&#x6765;&#x8868;&#x793A;&#x201C;&#x7A97;&#x53E3;&#x201D;&#x5462;&#xFF1F;</p>
<p>&#x6BD4;&#x5982;&#x8BF4;&#x6709;&#x4E00;&#x4E2A;&#x4EBA;&#xFF0C;&#x4ED6;&#x662F;&#x552F;&#x4E00;&#x7684;&#xFF0C;&#x8EAB;&#x4EFD;&#x8BC1;&#x53F7;&#x662F;&#x4ED6;&#x7684;&#x552F;&#x4E00;&#x8868;&#x793A;&#xFF0C;&#x4F46;&#x662F;&#x4ED6;&#x5728;&#x4E0D;&#x540C;&#x7684;&#x7CFB;&#x7EDF;&#x4E2D;&#xFF0C;&#x4FDD;&#x5B58;&#x7684;&#x4ED6;&#x7684;&#x6570;&#x636E;&#x662F;&#x4E0D;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x6BD4;&#x5982;&#x5728;&#x516C;&#x53F8;&#xFF0C;&#x516C;&#x53F8;&#x7CFB;&#x7EDF;&#x5BF9;&#x8FD9;&#x4E2A;&#x4EBA;&#x4FDD;&#x5B58;&#x7684;&#x4E2A;&#x4EBA;&#x57FA;&#x672C;&#x4FE1;&#x606F;&#xFF0C;&#x5728;&#x4EA4;&#x8B66;&#x7CFB;&#x7EDF;&#xFF0C;&#x4FDD;&#x5B58;&#x7684;&#x662F;&#x8FD9;&#x4E2A;&#x4EBA;&#x7684;&#x8F66;&#x8F86;&#x4FE1;&#x606F;&#x548C;&#x8FDD;&#x7AE0;&#x4FE1;&#x606F;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/47854e640b833696f8437ee48dbe52c1284da94bf8039ff7dabc013ad6070baa" alt="&#x7A97;&#x53E3;&#x4E3E;&#x4F8B;-1.png"></p>
<p>&#x5728;&#x751F;&#x6D3B;&#x4E2D;&#xFF0C;&#x4E0D;&#x540C;&#x7CFB;&#x7EDF;&#x5BF9;&#x4E00;&#x4E2A;&#x4EBA;&#x5173;&#x6CE8;&#x4FDD;&#x5B58;&#x7684;&#x6570;&#x636E;&#x662F;&#x4E0D;&#x4E00;&#x6837;&#xFF0C;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x4E5F;&#x662F;&#x4E00;&#x6837;&#x7684;&#x3002;&#x5E94;&#x7528;&#x5F00;&#x53D1;&#x8005;&#x4E3A;&#x4E86;&#x964D;&#x4F4E;&#x6A21;&#x5757;&#x7684;&#x4F9D;&#x8D56;&#xFF0C;&#x4E5F;&#x4F1A;&#x6709;&#x8FD9;&#x79CD;&#x8BBE;&#x8BA1;&#x3002;</p>
<ol start="2">
<li><h1 id="&#x521D;&#x8BC6;&#x7A97;&#x53E3;&#x5C42;&#x7EA7;&#x6811;"><a href="#&#x521D;&#x8BC6;&#x7A97;&#x53E3;&#x5C42;&#x7EA7;&#x6811;" class="headerlink" title="&#x521D;&#x8BC6;&#x7A97;&#x53E3;&#x5C42;&#x7EA7;&#x6811;"></a>&#x521D;&#x8BC6;&#x7A97;&#x53E3;&#x5C42;&#x7EA7;&#x6811;</h1></li>
</ol>
<h1 id="2-1-&#x7A97;&#x53E3;&#x5BB9;&#x5668;&#x7C7B;&#x4ECB;&#x7ECD;"><a href="#2-1-&#x7A97;&#x53E3;&#x5BB9;&#x5668;&#x7C7B;&#x4ECB;&#x7ECD;" class="headerlink" title="2.1 &#x7A97;&#x53E3;&#x5BB9;&#x5668;&#x7C7B;&#x4ECB;&#x7ECD;"></a>2.1 &#x7A97;&#x53E3;&#x5BB9;&#x5668;&#x7C7B;&#x4ECB;&#x7ECD;</h1><p>&#x524D;&#x9762;&#x770B;&#x5230;&#x4E86;&#x4E00;&#x4E9B;View&#x6811;&#x6784;&#x5EFA;&#x7684;&#x7C7B;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x8BF4;&#x7684;&#x5E38;&#x89C1;&#x5E03;&#x5C40;&#xFF0C;&#x73B0;&#x5728;&#x5217;&#x4E3E;&#x6784;&#x5EFA;&#x7A97;&#x53E3;&#x6811;&#x7528;&#x7684;&#x7684;&#x51E0;&#x4E2A;&#x5BB9;&#x5668;&#x7C7B;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/5fb012d51982fdfb98eec31e6e8a107148c9e0b024866c32f117148cee075b57" alt="&#x7C7B;-WindowContainer.png"></p>
<p><strong>WindowContainer&#xFF1A;</strong></p>
<p>&#x7C7B;&#x4F3C;ViewGroup&#x7684;&#x5B58;&#x5728;&#xFF0C;&#x662F;&#x7A97;&#x53E3;&#x5BB9;&#x5668;&#x7684;&#x57FA;&#x7C7B;&#xFF0C;&#x540E;&#x9762;&#x4ECB;&#x7ECD;&#x7684;&#x5176;&#x4ED6;&#x7A97;&#x53E3;&#x5BB9;&#x5668;&#x7C7B;&#x90FD;&#x662F;&#x5B83;&#x7684;&#x5B50;&#x7C7B;&#x3002;</p>
<p>&#x6709;&#x6CDB;&#x578B;&#x9650;&#x5236;&#xFF0C;&#x8BF4;&#x660E;&#x5BB9;&#x5668;&#x7684;&#x5185;&#x5BB9;&#x662F;&#x6709;&#x9650;&#x5236;&#x7684;</p>
<p>mParent&#xFF1A; &#x4FDD;&#x5B58;&#x5F53;&#x524D;&#x5BB9;&#x5668;&#x7684;&#x7236;&#x7A97;&#x53E3;&#x5F15;&#x7528;&#x3002;</p>
<p>mChildren &#xFF1A;&#x4FDD;&#x5B58;&#x5F53;&#x524D;&#x7A97;&#x53E3;&#x7684;&#x6240;&#x6709;&#x5B69;&#x5B50;&#x7A97;&#x53E3;&#x5BB9;&#x5668;&#x96C6;&#x5408;&#xFF08;&#x6709;&#x6CDB;&#x578B;&#xFF09;&#x3002;&#x6839;&#x636E;&#x6CE8;&#x91CA;&#xFF0C;&#x5217;&#x8868;&#x540E;&#x9762;&#x7684;&#x5B50;&#x5BB9;&#x5668;&#xFF0C;z-order &#x8D8A;&#x5927;&#xFF0C;&#x79BB;&#x5C4F;&#x5E55;&#x8D8A;&#x8FD1;&#x3002;</p>
<p>&#x7236;&#x7C7B;&#x4E3A;ConfigurationContainer&#xFF0C;&#x5C01;&#x88C5;&#x4E86;&#x914D;&#x7F6E;&#x7684;&#x5904;&#x7406;&#xFF0C;&#x5F53;&#x524D;&#x7C7B;&#x5C01;&#x88C5;&#x4E86;&#x5BB9;&#x5668;&#x7684;&#x64CD;&#x4F5C;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/b9b16f97860e405122738bf83833ce356255fcf9258e36496fedb4124024a9e3" alt="&#x7C7B;-RootWindowContainer.png"></p>
<p><strong>RootWindowContainer&#xFF1A;</strong></p>
<p>&#x6839;&#x7A97;&#x53E3;&#x5BB9;&#x5668;&#xFF0C;&#x4E5F;&#x662F;&#x7A97;&#x53E3;&#x5C42;&#x7EA7;&#x6811;&#x7684;&#x6839;&#x3002;&#x7BA1;&#x7406;DisplayContent</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/b69d052943551f9f86e4a947e818b6c83a82dda21304ee266bf920f019189413" alt="&#x7C7B;-DisplayContent.png"></p>
<p><strong>DisplayContent&#xFF1A;</strong></p>
<p>&#x4EE3;&#x8868;&#x4E00;&#x4E2A;&#x5C4F;&#x5E55;&#xFF0C;Android&#x662F;&#x652F;&#x6301;&#x591A;&#x5C4F;&#x5E55;&#x7684;&#x3002;</p>
<p>&#x7EE7;&#x627F;&#x5173;&#x7CFB;&#x4E3A;&#xFF1A;<br>DisplayContent-&gt;RootDisplayArea-&gt;DisplayArea.Dimmable-&gt;DisplayArea-&gt;WindowContainer</p>
<p>&#x5B69;&#x5B50;&#x4E3A;DisplayArea&#xFF08;&#x8FD9;&#x4E2A;&#x89C4;&#x5219;&#x5B9A;&#x4E49;&#x5728;DisplayArea&#x7684;&#x5B50;&#x7C7B;Dimmable&#x4E2D;&#xFF09;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/9dbda08e336b67374f85a30d81fa8ceecd2b9fdfbe6ed2e12162b6ac494cc426" alt="&#x7C7B;-WindowState.png"></p>
<p><strong>WindowState&#xFF1A;</strong></p>
<p>&#x4EE3;&#x8868;&#x4E00;&#x4E2A;&#x7A97;&#x53E3;&#xFF0C;&#x672C;&#x8EAB;&#x4E5F;&#x662F;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;&#x6BD4;&#x5982;&#x5B50;&#x7A97;&#x53E3;&#x5C31;&#x662F;&#x5B83;&#x7684;&#x5B69;&#x5B50;&#xFF08;Popupwindow&#x573A;&#x666F;&#xFF09;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/6a036471a584b84ebac4169f91b90dac6acd3f9064e42eccea95d9335bf461ab" alt="&#x7C7B;-DisplayArea.png"></p>
<p><strong>DisplayArea&#xFF1A;</strong><br>&#x6CE8;&#x91CA;&#xFF1A;DisplayContent&#x4E0B;&#x7684;&#x7A97;&#x53E3;&#x5BB9;&#x5668;&#x96C6;&#x5408;&#x3002;</p>
<p>&#x8BF4;&#x4EBA;&#x8BDD;&#xFF1A;&#x8868;&#x793A;&#x4E00;&#x5757;&#x663E;&#x793A;&#x533A;&#x57DF;&#xFF0C;&#x662F;DisplayContent&#x7684;&#x5B50;&#x5BB9;&#x5668;&#x3002;DisplayContent&#x4E0B;&#x5B89;&#x5353;&#x76EE;&#x524D;&#x8BBE;&#x8BA1;&#x4E3A;&#x5206;&#x4E86;37&#x5C42;&#xFF0C;&#x6BCF;&#x4E00;&#x5C42;&#x90FD;&#x662F;&#x4E00;&#x4E2A;DisplayArea&#x3002;</p>
<p>&#x6709;&#x4E09;&#x4E2A;&#x76F4;&#x63A5;&#x5B50;&#x7C7B;&#xFF0C;TaskDisplayArea&#xFF0C;DisplayArea.Tokens&#x548C;DisplayArea.Tokens&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/e83c1a75ded77b7fd74184d636e896cb83b61353dec086dacf3e7a1b832a534e" alt="&#x7C7B;-TaskDisplayArea.png"></p>
<p><strong>TaskDisplayArea&#xFF1A;</strong></p>
<p>&#x6CE8;&#x91CA;&#xFF1A;&#x5B69;&#x5B50;&#x53EF;&#x4EE5;&#x662F;Task&#xFF0C;&#x6216;&#x8005;&#x662F;TaskDisplayArea&#x3002;&#xFF08;&#x4E0D;&#x8FC7;&#x76EE;&#x524D;&#x770B;&#x5230;&#x7684;&#x5B69;&#x5B50;&#x90FD;&#x662F;Task&#x7C7B;&#x578B;&#xFF09;&#x3002;</p>
<p>&#x5BF9;&#x5E94;&#x5C42;&#x7EA7;&#x6811;&#x7684;&#x7B2C;&#x4E8C;&#x5C42;&#xFF0C;&#x4E13;&#x95E8;&#x7528;&#x6765;&#x5B58;&#x653E;&#x5E94;&#x7528;&#x7684;&#x7A97;&#x53E3;&#x56FE;&#x5C42;&#xFF0C;&#x975E;&#x5E38;&#x91CD;&#x8981;&#xFF0C;APP&#x7684;&#x7A97;&#x53E3;&#x90FD;&#x5728;&#x8FD9;&#x3002;&#x4E5F;&#x662F;&#x7A97;&#x53E3;&#x5C42;&#x7EA7;&#x6811;&#x770B;&#x7684;&#x91CD;&#x70B9;&#x533A;&#x57DF;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/58ee650388936667e6303a3ad31aecdafe7a0a8979f929ea9c57ef71c440c47c" alt="&#x7C7B;-DisplayArea.Token.png"></p>
<p><strong>DisplayArea.Token&#xFF1A;</strong></p>
<p>DisplayArea&#x7684;&#x5B50;&#x7C7B;&#xFF0C;&#x5E76;&#x4E14;&#x662F;&#x5176;&#x5185;&#x90E8;&#x7C7B;&#xFF0C;&#x8868;&#x793A;WindowToken&#x7684;&#x5BB9;&#x5668;&#x3002;WindowToken&#x7684;&#x5B50;&#x7C7B;&#x662F;WindowState</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/c0cf42b1f2b13fd462b4cebd8c1b50b81bad98ce503619a77465e1864aff6d6a" alt="&#x7C7B;-DisplayArea.Dimmable.png"></p>
<p><strong>DisplayArea.Dimmable&#xFF1A;</strong></p>
<p>DisplayArea&#x7684;&#x5B50;&#x7C7B;&#xFF0C;&#x5E76;&#x4E14;&#x662F;&#x5176;&#x5185;&#x90E8;&#x7C7B;&#xFF0C;DisplayContent&#x7684;&#x7236;&#x7C7B;&#xFF0C;&#x5E26;&#x6A21;&#x7CCA;&#x6548;&#x679C;&#x3002;&#x5B69;&#x5B50;&#x662F;DisplayArea&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/ea701248b9534deb2bfd01e8aa4105bd5e36a13051ba5fd3f330b24241f35404" alt="&#x7C7B;-ImeContainer.png"></p>
<p><strong>ImeContainer&#xFF1A;</strong></p>
<p>&#x8F93;&#x5165;&#x6CD5;&#x5BB9;&#x5668;&#xFF0C;&#x7236;&#x7C7B;&#x662F;DisplayArea.Token&#xFF0C;&#x90A3;&#x4E48;&#x5B69;&#x5B50;&#x4E5F;&#x662F;WindowToken&#x3002;&#x8F93;&#x5165;&#x6CD5;&#x4E13;&#x7528;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/19eb83697d4af74c9adfb8d51d0c48306324567694e27887c736f1ca718a7829" alt="&#x7C7B;-Task.png"></p>
<p><strong>Task&#xFF1A;</strong></p>
<p>&#x7236;&#x7C7B;TaskFragment&#x7EE7;&#x627F;WindowContainer&#xFF0C;&#x6CDB;&#x578B;&#x6CA1;&#x6709;&#x9650;&#x5236;&#x5B69;&#x5B50;&#x7684;&#x7C7B;&#x578B;&#x3002;&#x4F46;&#x662F;&#x5B9E;&#x9645;&#x60C5;&#x51B5;&#x4E0B;&#x5B69;&#x5B50;&#x662F;Task&#x548C;ActivityRecord&#x7C7B;&#x578B;&#x3002;</p>
<p>&#x5F00;&#x53D1;&#x8FC7;&#x7A0B;&#x4E2D;&#x7ECF;&#x5E38;&#x89C1;&#x5230;&#x7684;&#x7C7B;&#xFF0C;&#x4E5F;&#x662F;&#x5E94;&#x7528;&#x5F00;&#x53D1;&#xFF0C;&#x591A;&#x7A97;&#x53E3;&#x5F00;&#x53D1;&#x7ECF;&#x5E38;&#x4F1A;&#x9047;&#x5230;&#x7684;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/847900364c6a1e7be51767260c369c97b82447db9ee34ee49febb56a0cd67393" alt="&#x7C7B;-WindowToken.png"></p>
<p><strong>WindowToken&#xFF1A;</strong></p>
<p>&#x7406;&#x5668;&#x4E2D;&#x4E00;&#x7EC4;&#x76F8;&#x5173;&#x7A97;&#x53E3;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x662F;&#x7A97;&#x53E3;&#x7684;Token,&#x800C;&#x7A97;&#x53E3;&#x7684;&#x5B9A;&#x4E49;WindowState&#x3002;&#x4E00;&#x822C;&#x5728;&#x7A97;&#x53E3;&#x5C42;&#x7EA7;&#x6811;&#x4E2D;WindowToken&#x4E0B;&#x9762;&#x5C31;&#x4F1A;&#x6302;&#x8F7D;&#x4E00;&#x4E2A;WindowState&#x3002;</p>
<p>&#x58C1;&#x7EB8;&#x7528;&#x5230;&#x7684;WallpaperWindowToken&#x4E5F;&#x662F;&#x5176;&#x5B50;&#x7C7B;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/27203f4fd618569d02bd7fb7ebb0b22f945e4f4b7a5b4fb5011f4392692b1af2" alt="&#x7C7B;-ActivityRecord.png"></p>
<p><strong>ActivityRecord&#xFF1A;</strong></p>
<p>&#x5BF9;&#x5E94;&#x7740;&#x4E00;&#x4E2A;Activity&#x3002;</p>
<p>&#x662F;WindowToken&#x7684;&#x5B50;&#x7C7B;&#xFF0C;&#x6240;&#x4EE5;&#x5B69;&#x5B50;&#x4E5F;&#x662F;WindowState&#x3002; &#x4ECE;&#x5E94;&#x7528;&#x5F00;&#x53D1;&#x89D2;&#x5EA6;&#xFF0C;&#x4E00;&#x4E2A;Activity&#x4E0B;&#x4E5F;&#x6709;&#x4E00;&#x4E2A;Window&#x3002;&#x5E76;&#x4E14;&#x4E00;&#x822C;&#x4F5C;&#x4E3A;&#x662F;Task&#x7684;&#x5B69;&#x5B50;&#x3002;</p>
<h2 id="2-2-Feature&#x4ECB;&#x7ECD;"><a href="#2-2-Feature&#x4ECB;&#x7ECD;" class="headerlink" title="2.2 Feature&#x4ECB;&#x7ECD;"></a>2.2 Feature&#x4ECB;&#x7ECD;</h2><p>&#x4E3A;&#x4EC0;&#x4E48;&#x6709;&#x8FD9;&#x4E2A;Feature(&#x7279;&#x5F81;)&#x5462;&#xFF1F;</p>
<p>AOSP&#x65E2;&#x7136;&#x5C06;&#x5C4F;&#x5E55;&#x5206;&#x4E86;37&#x5C42;&#xFF0C;&#x90A3;&#x8BF4;&#x660E;&#x56FE;&#x5C42;&#x4E4B;&#x95F4;&#x662F;&#x6709;&#x533A;&#x522B;&#x7684;&#xFF0C;&#x6709;&#x4E0D;&#x4E00;&#x6837;&#x7684;&#x7279;&#x6027;&#xFF0C;&#x8FD9;&#x4E2A;&#x5C31;&#x662F;Feature&#xFF0C;&#x6BD4;&#x5982;&#x8FD9;&#x4E00;&#x5C42;&#x662F;&#x4E0D;&#x662F;&#x652F;&#x6301;&#x5355;&#x624B;&#x64CD;&#x4F5C;&#x3002;<br>&#x8FD9;&#x91CC;&#x5217;&#x4E3E;5&#x4E2A;&#x5E38;&#x89C1;&#x7684;Feature&#xFF0C;&#x5DF2;&#x7ECF;&#x5B83;&#x4EEC;&#x6240;&#x5728;&#x7684;&#x5C42;&#x7EA7;&#x3002;</p>
<p><strong>WindowedMagnification</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&#x62E5;&#x6709;&#x7279;&#x5F81;&#x7684;&#x5C42;&#x7EA7;&#xFF1A; 0-31</span><br><span class="line">&#x7279;&#x5F81;&#x63CF;&#x8FF0;&#xFF1A; &#x652F;&#x6301;&#x7A97;&#x53E3;&#x7F29;&#x653E;&#x7684;&#x4E00;&#x5757;&#x533A;&#x57DF;&#xFF0C;&#x4E00;&#x822C;&#x662F;&#x901A;&#x8FC7;&#x8F85;&#x52A9;&#x670D;&#x52A1;&#x8FDB;&#x884C;&#x7F29;&#x5C0F;&#x6216;&#x653E;&#x5927;</span><br></pre></td></tr></table></figure>

<p><strong>HideDisplayCutout</strong></p>
<p>&#x62E5;&#x6709;&#x7279;&#x5F81;&#x7684;&#x5C42;&#x7EA7;&#xFF1A; 0-14 16 18-23 26-35<br>&#x7279;&#x5F81;&#x63CF;&#x8FF0;&#xFF1A;&#x9690;&#x85CF;&#x526A;&#x5207;&#x533A;&#x57DF;&#xFF0C;&#x5373;&#x5728;&#x9ED8;&#x8BA4;&#x663E;&#x793A;&#x8BBE;&#x5907;&#x4E0A;&#x9690;&#x85CF;&#x4E0D;&#x89C4;&#x5219;&#x5F62;&#x72B6;&#x7684;&#x5C4F;&#x5E55;&#x533A;&#x57DF;&#xFF0C;&#x6BD4;&#x5982;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x6253;&#x5F00;&#x8FD9;&#x4E2A;&#x529F;&#x80FD;&#x540E;&#xFF0C;&#x6709;&#x8FD9;&#x4E2A;&#x529F;&#x80FD;&#x7684;&#x56FE;&#x5C42;&#x5C31;&#x4E0D;&#x4F1A;&#x5EF6;&#x4F38;&#x5230;&#x5218;&#x6D77;&#x5C4F;&#x533A;&#x57DF;&#x3002;</p>
<p><strong>OneHanded</strong></p>
<p>&#x62E5;&#x6709;&#x7279;&#x5F81;&#x7684;&#x5C42;&#x7EA7;&#xFF1A;0-23 26-32 34-35<br>&#x7279;&#x5F81;&#x63CF;&#x8FF0;&#xFF1A;&#x8868;&#x793A;&#x652F;&#x6301;&#x5355;&#x624B;&#x64CD;&#x4F5C;&#x7684;&#x56FE;&#x5C42;&#xFF0C;&#x8FD9;&#x4E2A;&#x529F;&#x80FD;&#x5728;&#x624B;&#x673A;&#x4E0A;&#x8FD8;&#x662F;&#x633A;&#x5E38;&#x89C1;&#x7684;</p>
<p><strong>FullscreenMagnification</strong></p>
<p>&#x62E5;&#x6709;&#x7279;&#x5F81;&#x7684;&#x5C42;&#x7EA7;&#xFF1A;0-12 15-23 26-27 29-31 33-35<br>&#x7279;&#x5F81;&#x63CF;&#x8FF0;&#xFF1A;&#x652F;&#x6301;&#x5168;&#x5C4F;&#x5E55;&#x7F29;&#x653E;&#x7684;&#x56FE;&#x5C42;&#xFF0C;&#x548C;&#x4E0A;&#x9762;&#x7684;&#x4E0D;&#x540C;&#xFF0C;&#x8FD9;&#x4E2A;&#x662F;&#x5168;&#x5C4F;&#x7F29;&#x653E;&#xFF0C;&#x524D;&#x9762;&#x90A3;&#x4E2A;&#x53EF;&#x4EE5;&#x5C40;&#x90E8;</p>
<p><strong>ImePlaceholder</strong></p>
<p>&#x62E5;&#x6709;&#x7279;&#x5F81;&#x7684;&#x5C42;&#x7EA7;&#xFF1A; 13-14<br>&#x7279;&#x5F81;&#x63CF;&#x8FF0;&#xFF1A;&#x8F93;&#x5165;&#x6CD5;&#x76F8;&#x5173;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/f61bc505951d3ea0915deacd3627fc160f36ff19f4010d6a7607fd956bcce076" alt="Feature&#x6574;&#x7406;.png"></p>
<h1 id="3-WMS&#x7684;&#x5C42;&#x7EA7;&#x7ED3;&#x6784;&#x6811;"><a href="#3-WMS&#x7684;&#x5C42;&#x7EA7;&#x7ED3;&#x6784;&#x6811;" class="headerlink" title="3 WMS&#x7684;&#x5C42;&#x7EA7;&#x7ED3;&#x6784;&#x6811;"></a>3 WMS&#x7684;&#x5C42;&#x7EA7;&#x7ED3;&#x6784;&#x6811;</h1><p>&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#x6765;&#x770B;&#x83B7;&#x53D6;&#x5230;&#x8BBE;&#x5907;&#x5F53;&#x524D;&#x7684;&#x5C42;&#x7EA7;&#x7ED3;&#x6784;&#x6811;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;adb shell dumpsys activity containers</span><br></pre></td></tr></table></figure>

<p>&#x5728;&#x5F00;&#x5B8C;&#x673A;&#x540E;&#x7684;launcher&#x5C31;&#x6267;&#x884C;&#x4E86;dump&#x547D;&#x4EE4;&#xFF0C;&#x7136;&#x540E;&#x5C31;&#x80FD;&#x5F97;&#x5230;&#x4E0B;&#x9762;&#x8FD9;&#x4E48;&#x4E00;&#x6BB5;&#x8F93;&#x51FA;&#xFF0C;&#x4E4D;&#x4E00;&#x770B;&#x5F88;&#x5BB9;&#x6613;&#x529D;&#x9000;&#xFF0C;&#x4F46;&#x662F;&#x5B9E;&#x9645;&#x4E0A;&#x8FD9;&#x4E9B;&#x4E1C;&#x897F;&#x90FD;&#x662F;&#x6709;&#x89C4;&#x5F8B;&#xFF0C;&#x800C;&#x4E14;&#x5F88;&#x7B80;&#x5355;&#x3002;&#x76EE;&#x524D;&#x53EF;&#x4EE5;&#x5148;&#x4E0D;&#x770B;&#xFF0C;&#x7A0D;&#x540E;&#x518D;&#x8BE6;&#x7EC6;&#x89E3;&#x91CA;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">less&#x590D;&#x5236;&#x4EE3;&#x7801;ACTIVITY MANAGER CONTAINERS (dumpsys activity containers)</span><br><span class="line">ROOT type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">  #0 Display 0 name=&quot;Built-in Screen&quot; type=undefined mode=fullscreen override-mode=fullscreen requested-bounds=[0,0][720,1600] bounds=[0,0][720,1600]</span><br><span class="line">   #2 Leaf:36:36 type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">    #1 WindowToken{451b2bd type=2024 android.os.BinderProxy@4526826} type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">     #0 47e1803 ScreenDecorOverlayBottom type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">    #0 WindowToken{69b9325 type=2024 android.os.BinderProxy@3a8ab1c} type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">     #0 799b2ab ScreenDecorOverlay type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">   #1 HideDisplayCutout:32:35 type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">    #2 OneHanded:34:35 type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">     #0 FullscreenMagnification:34:35 type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">      #0 Leaf:34:35 type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">    #1 FullscreenMagnification:33:33 type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">     #0 Leaf:33:33 type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">    #0 OneHanded:32:32 type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">     #0 Leaf:32:32 type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">   #0 WindowedMagnification:0:31 type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">    #6 HideDisplayCutout:26:31 type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">     #0 OneHanded:26:31 type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">      #2 FullscreenMagnification:29:31 type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">       #0 Leaf:29:31 type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">      #1 Leaf:28:28 type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">      #0 FullscreenMagnification:26:27 type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">       #0 Leaf:26:27 type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">    #5 Leaf:24:25 type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">     #1 WindowToken{922c2bc type=2024 android.os.BinderProxy@d50168e} type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">      #0 48a6245 pip-dismiss-overlay type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">     #0 WindowToken{1a3a19a type=2019 android.os.BinderProxy@1ec36bc} type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">      #0 50a3d66 NavigationBar0 type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">    #4 HideDisplayCutout:18:23 type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">     #0 OneHanded:18:23 type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">      #0 FullscreenMagnification:18:23 type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">       #0 Leaf:18:23 type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">    #3 OneHanded:17:17 type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">     #0 FullscreenMagnification:17:17 type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">      #0 Leaf:17:17 type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">       #0 WindowToken{7472fe2 type=2040 android.os.BinderProxy@1bfb9c4} type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">        #0 4b26f73 NotificationShade type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">    #2 HideDisplayCutout:16:16 type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">     #0 OneHanded:16:16 type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">      #0 FullscreenMagnification:16:16 type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">       #0 Leaf:16:16 type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">    #1 OneHanded:15:15 type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">     #0 FullscreenMagnification:15:15 type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">      #0 Leaf:15:15 type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">       #0 WindowToken{3da7d5c type=2000 android.os.BinderProxy@e2c682e} type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">        #0 7619865 StatusBar type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">    #0 HideDisplayCutout:0:14 type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">     #0 OneHanded:0:14 type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">      #1 ImePlaceholder:13:14 type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">       #0 ImeContainer type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">        #0 WindowToken{1397896 type=2011 android.os.Binder@23bebb1} type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">         #0 d0c3c51 InputMethod type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">      #0 FullscreenMagnification:0:12 type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">       #2 Leaf:3:12 type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">        #0 WindowToken{82fa61a type=2038 android.os.BinderProxy@2f86adc} type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">         #0 33a873c ShellDropTarget type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">       #1 DefaultTaskDisplayArea type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">        #2 Task=1 type=home mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">         #0 Task=7 type=home mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">          #0 ActivityRecord{bd2b1d4 u0 com.android.launcher3/.uioverrides.QuickstepLauncher} t7} type=home mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">           #1 ae1df9b com.android.launcher3/com.android.launcher3.uioverrides.QuickstepLauncher type=home mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">           #0 b9fa2f0 com.android.launcher3/com.android.launcher3.uioverrides.QuickstepLauncher type=home mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">        #1 Task=2 type=undefined mode=fullscreen override-mode=fullscreen requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">        #0 Task=3 type=undefined mode=fullscreen override-mode=fullscreen requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">         #1 Task=6 type=undefined mode=multi-window override-mode=multi-window requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">         #0 Task=5 type=undefined mode=multi-window override-mode=multi-window requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">       #0 Leaf:0:1 type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">        #0 WallpaperWindowToken{4b4c99a token=android.os.Binder@9258e45} type=undefined mode=fullscreen override-mode=fullscreen requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">         #0 f3495ce com.android.systemui.ImageWallpaper type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br></pre></td></tr></table></figure>

<p>&#x5148;&#x770B;&#x770B;&#x70B9;&#x51FB;&#x684C;&#x9762;&#x7684;&#x201C;&#x7535;&#x8BDD;&#x201C;&#x8FDB;&#x5165;&#x7535;&#x8BDD;&#x754C;&#x9762;&#x540E;&#xFF0C;&#x518D;&#x6267;&#x884C;&#x8FD9;&#x4E2A;dump&#x547D;&#x4EE4;&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/a2de342a5b0a0c54ac1ae08106717c440903d1609590d1847f3d6375a97a9950" alt="&#x542F;&#x52A8;Activity&#x540E;&#x5C42;&#x7EA7;&#x7ED3;&#x6784;&#x6811;&#x5BF9;&#x6BD4;.png"></p>
<p>tips: com.google.android.dialer &#x8FD9;&#x4E2A;&#x5305;&#x540D;&#x662F;&#x201D;&#x7535;&#x8BDD;&#x201D;&#x8FD9;&#x4E2A;&#x5E94;&#x7528;<br>&#x8FD9;&#x4E2A;&#x533A;&#x522B;&#x5C31;&#x6BD4;&#x8F83;&#x597D;&#x770B;&#x51FA;&#x6765;&#x4E86;&#xFF0C;&#x5728;#1 DefaultTaskDisplayArea&#x4E0B;&#x591A;&#x4E86;&#x4E00;&#x4E9B;&#x4E1C;&#x897F;&#x3002;&#x770B;&#x5230;&#x91CC;&#x9762;&#x4E5F;&#x77E5;&#x9053;&#x8FD9;&#x4E2A;&#x662F;&#x589E;&#x52A0;&#x4E00;&#x4E9B;&#x4E0E;&#x201C;&#x7535;&#x8BDD;&#x201D;&#x8FD9;&#x4E2A;&#x5E94;&#x7528;&#x7684;Activity&#x76F8;&#x5173;&#x7684;&#x4E1C;&#x897F;&#x3002;<br>&#x7136;&#x540E;&#x518D;&#x6309;&#x4E00;&#x4E0B;&#x97F3;&#x91CF;&#x952E;&#x76D8;&#xFF0C;&#x770B;&#x4E00;&#x4E0B;&#x533A;&#x522B;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/743831234a33a00fb8aa44af7b15bc263a22bb4f912acf5b7be54c8d3184e4c8" alt="&#x6309;&#x97F3;&#x91CF;&#x6309;&#x94AE;&#x540E;&#x5C42;&#x7EA7;&#x7ED3;&#x6784;&#x6811;&#x5BF9;&#x6BD4;.png"></p>
<p>&#x5728;&#x5176;&#x4ED6;&#x7684;&#x573A;&#x666F;&#x6BD4;&#x5982;&#x6309;power&#x51FA;&#x73B0;&#x7684;&#x5F39;&#x7A97;&#xFF0C; &#x51FA;&#x73B0;toast&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6216;&#x8005;&#x8FDB;&#x5165;&#x5206;&#x5C4F;&#x90FD;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;dump&#xFF0C;&#x5BF9;&#x6BD4;&#x4E00;&#x4E0B;&#x5DEE;&#x5F02;&#x3002;<br>&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x6709;&#x4EE5;&#x4E0B;&#x4FE1;&#x606F;&#xFF1A;</p>
<ol>
<li>&#x5F00;&#x5B8C;&#x673A;&#x5C42;&#x7EA7;&#x7ED3;&#x6784;&#x6811;&#x5C31;&#x5B58;&#x5728;</li>
<li>&#x754C;&#x9762;&#x4E0A;&#x6709;&#x76F8;&#x5173;&#x7684;Window&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x90FD;&#x4F1A;&#x5728;&#x5C42;&#x7EA7;&#x7ED3;&#x6784;&#x6811;&#x4E0A;&#x4F53;&#x73B0;</li>
<li>&#x4E0D;&#x540C;&#x7684;window&#x4F1A;&#x88AB;&#x6302;&#x5728;&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x8FD9;&#x4E2A;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x5C42;&#x7EA7;&#x7ED3;&#x6784;&#x6811;&#x7684;&#x5173;&#x952E;&#x3002;<br>&#x5F53;&#x7136;&#x54EA;&#x4E2A;Window&#x5E94;&#x8BE5;&#x6302;&#x5728;&#x5230;&#x90A3;&#x4E00;&#x5C42;&#xFF0C;&#x600E;&#x4E48;&#x4E2A;&#x5148;&#x540E;&#x987A;&#x5E8F;&#xFF0C;&#x8FD9;&#x4E2A;&#x6211;&#x4EEC;&#x5176;&#x5B9E;&#x65E0;&#x9700;&#x8FC7;&#x4E8E;&#x5728;&#x610F;&#xFF0C;&#x8FD9;&#x4E2A;&#x662F;&#x4EA7;&#x54C1;&#x8BBE;&#x8BA1;&#x3002;</li>
</ol>
<p>tips: &#x53EF;&#x4EE5;&#x8BD5;&#x8BD5;&#x4E0D;&#x540C;Activity&#x542F;&#x52A8;&#x6A21;&#x5F0F;&#x540E;&#x7684;&#x533A;&#x522B;</p>
<h2 id="3-1-&#x7B80;&#x5355;&#x5206;&#x6790;&#x5C42;&#x7EA7;&#x7ED3;&#x6784;&#x6811;"><a href="#3-1-&#x7B80;&#x5355;&#x5206;&#x6790;&#x5C42;&#x7EA7;&#x7ED3;&#x6784;&#x6811;" class="headerlink" title="3.1 &#x7B80;&#x5355;&#x5206;&#x6790;&#x5C42;&#x7EA7;&#x7ED3;&#x6784;&#x6811;"></a>3.1 &#x7B80;&#x5355;&#x5206;&#x6790;&#x5C42;&#x7EA7;&#x7ED3;&#x6784;&#x6811;</h2><p>&#x73B0;&#x5728;&#x6765;&#x5206;&#x6790;&#x4E0A;&#x9762;&#x90A3;&#x4E00;&#x56E2;&#x8F93;&#x51FA;&#x4FE1;&#x606F;&#x600E;&#x4E48;&#x770B;&#x3002;&#xFF08;&#x4ECE;&#x4E0A;&#x5230;&#x4E0B;&#xFF0C;&#x4ECE;&#x5DE6;&#x5F80;&#x53F3;&#xFF09;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">css&#x590D;&#x5236;&#x4EE3;&#x7801;ROOT type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br><span class="line">  #0 Display 0 name=&quot;Built-in Screen&quot; type=undefined mode=fullscreen override-mode=fullscreen requested-bounds=[0,0][720,1600] bounds=[0,0][720,1600]</span><br></pre></td></tr></table></figure>

<p>&#x4E0A;&#x9762;&#x7684;ROOT &#x8868;&#x793A;&#x6839;&#x8282;&#x70B9;&#xFF0C;&#x6682;&#x65F6;&#x53EF;&#x4EE5;&#x5FFD;&#x7565;&#x3002;&#x4E0B;&#x9762;&#x7684; #0 Display 0 name=&#x201D;Built-in Screen&#x201D;&#x8868;&#x793A;&#x5F53;&#x524D;&#x7684;&#x624B;&#x673A;&#x7684;&#x7B2C;0&#x4E2A;&#x5C4F;&#x5E55;&#xFF0C;&#x76EE;&#x524D;&#x4E5F;&#x53EF;&#x5FFD;&#x7565;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x4E0B;&#x9762;&#x90A3;&#x4E00;&#x90E8;&#x5206;&#x5185;&#x5BB9;&#x3002;<br>&#x4E0B;&#x9762;&#x7684;&#x5185;&#x5BB9;&#x867D;&#x7136;&#x5F88;&#x957F;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x4E0D;&#x8981;&#x770B;&#x5168;&#x90E8;&#xFF0C;&#x6293;&#x4F4F;&#x51E0;&#x4E2A;&#x70B9;&#x5C31;&#x591F;&#x4E86;&#xFF0C;&#x4EE5;&#x524D;&#x9762;&#x8FD9;&#x6BB5;&#x4E3A;&#x4F8B;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">less&#x590D;&#x5236;&#x4EE3;&#x7801; #2 Leaf:36:36 type=undefined mode=fullscreen override-mode=undefined requested-bounds=[0,0][0,0] bounds=[0,0][720,1600]</span><br></pre></td></tr></table></figure>

<p><strong>1. &#x770B;&#x6240;&#x5728;&#x4F4D;&#x7F6E; #X</strong></p>
<p>&#x6BCF;&#x4E00;&#x884C;&#x6700;&#x524D;&#x9762;&#x90FD;&#x662F; &#x201C;#+&#x6570;&#x5B57;&#x201D;&#x7684;&#x5F62;&#x5F0F;&#x6253;&#x5934;&#xFF0C;&#x6BD4;&#x5982;&#x73B0;&#x5728;&#x770B;&#x7684;&#x662F; &#x201C;#2 Leaf:36:36&#x201D;&#x8FD9;&#x91CC;&#x7684;&#x6570;&#x5B57;&#x8868;&#x793A;&#x8FD9;&#x4E2A;&#x56FE;&#x5C42;&#x5728;&#x5F53;&#x524D;&#x7236;&#x5BB9;&#x5668;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x4ECE;0&#x5F00;&#x59CB;&#x3002;&#x5176;&#x5B9E;&#x548C;ViewGrop&#x6216;&#x8BB8;childView&#x7684;&#x4E00;&#x6837;&#x7684;&#x3002;<br>&#x5F53;&#x524D;&#x8FD9;&#x4E2A;&#x4E3A;#2 &#x6240;&#x4EE5;&#x4ED6;&#x7684;&#x7236;&#x5BB9;&#x5668;&#x4E00;&#x5171;&#x6709;3&#x4E2A;&#x5B50;&#x5BB9;&#x5668;&#xFF0C;&#x5F53;&#x524D;&#x8FD9;&#x4E2A;&#x5904;&#x4E8E;&#x7B2C;&#x4E09;&#x4E2A;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6700;&#x4E0A;&#x9762;&#x3002;&#x90A3;&#x4E48;&#x548C;&#x4ED6;&#x540C;&#x7EA7;&#x7684;&#x53E6;&#x5916;2&#x4E2A;&#x600E;&#x4E48;&#x627E;&#x5462;&#xFF1F;<br>&#x9700;&#x8981;&#x5F80;&#x4E0B;&#x770B;&#xFF0C;&#x627E;&#x5230;&#x548C;&#x5F53;&#x524D; #2 &#x524D;&#x9762;&#x7A7A;&#x683C;&#x4E00;&#x6837;&#x591A;&#x7684;#1 &#x548C;#0 &#x5C31;&#x662F;&#x4ED6;&#x540C;&#x7EA7;&#x7684;2&#x4E2A;&#x5BB9;&#x5668;&#x4E86;&#xFF0C;&#x6309;&#x7167;&#x89C4;&#x5219;&#x80FD;&#x80FD;&#x627E;&#x4E0B;&#x9762;&#x8FD9;2&#x4E2A;&#x4E0E;&#x4ED6;&#x540C;&#x7EA7;&#x7684;&#x3002;<br>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x8BF4;&#x7684;&#x540C;&#x7EA7;&#x5E76;&#x4E0D;&#x662F;&#x5728;&#x540C;&#x4E00;&#x56FE;&#x5C42;&#xFF0C;&#x800C;&#x662F;&#x5728;&#x5C42;&#x7EA7;&#x6811;&#x8FD9;&#x4E2A;&#x6811;&#x7684;&#x7ED3;&#x6784;&#x662F;&#x540C;&#x7EA7;&#x5173;&#x7CFB;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bash&#x590D;&#x5236;&#x4EE3;&#x7801;#1 HideDisplayCutout:32:35</span><br><span class="line">#0 WindowedMagnification:0:31</span><br></pre></td></tr></table></figure>

<p><strong>2. &#x5C42;&#x7EA7;name &#x540D;&#x5B57;+&#x8D77;&#x59CB;&#x5C42;&#x7EA7;&#xFF1A;&#x7ED3;&#x675F;&#x5C42;&#x7EA7;</strong><br>&#x6307;&#x7684;&#x662F; &#x201C;Leaf:36:36&#x201D; &#x8FD9;&#x4E00;&#x6BB5;&#x4FE1;&#x606F;&#xFF0C;&#x8FD9;&#x4E2A;&#x7684;&#x683C;&#x5F0F;&#x4E3A;&#x201C;&#x5BB9;&#x5668;&#x540D; &#x8D77;&#x59CB;&#x5C42;&#x7EA7;:&#x7ED3;&#x675F;&#x5C42;&#x7EA7;&#x201D;<br>&#x4F53;&#x73B0;&#x5728;&#x5F53;&#x524D;&#x5C31;&#x662F;&#x8FD9;&#x4E2A; #2 &#x7684;&#x5BB9;&#x5668;&#x53EB; &#x201C;Leaf&#x201D;,&#x8868;&#x793A;&#x4E00;&#x4E2A;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#xFF0C;&#x6BD4;&#x8F83;&#x7279;&#x6B8A;&#xFF0C;&#x4E3B;&#x8981;&#x770B;&#x540E;&#x9762;&#x7684;&#x9891;&#x7E41;&#x51FA;&#x73B0;&#x7684;HideDisplayCutout&#xFF0C;ImePlaceholder&#xFF0C;OneHanded&#x7B49;&#x8FD9;&#x4E9B;&#xFF0C;&#x90FD;&#x6709;&#x5177;&#x4F53;&#x7684;&#x610F;&#x4E49;&#xFF0C;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x6240;&#x6709;&#x7684;&#x4E1C;&#x897F;&#x5728;&#x6E90;&#x7801;&#x4E2D;&#x90FD;&#x80FD;&#x627E;&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x4EE3;&#x7801;&#xFF0C; &#x50CF;&#x63D0;&#x5230;&#x7684;HideDisplayCutout&#xFF0C;ImePlaceholder&#xFF0C;OneHanded&#x5728;&#x6E90;&#x7801;&#x4E2D;&#x79F0;&#x4E4B;&#x4E3A;Feature&#xFF08;&#x7279;&#x5F81;&#xFF09;&#xFF0C;&#x5373;&#x8868;&#x793A;&#x5F53;&#x524D;&#x8FD9;&#x4E2A;&#x5BB9;&#x5668;&#x6709;&#x5177;&#x6709;&#x8FD9;&#x4E2A;&#x7279;&#x5F81;&#xFF0C;&#x6682;&#x65F6;&#x77E5;&#x9053;&#x5C31;&#x53EF;&#x4EE5;&#xFF0C;&#x540E;&#x9762;&#x4F1A;&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;&#x6E90;&#x7801;&#x5BF9;&#x8FD9;&#x4E9B;Feature&#x7684;&#x5177;&#x4F53;&#x5B9A;&#x4E49;&#x3002;<br>&#x7136;&#x540E;&#x5C31;&#x662F;&#x540E;&#x9762;&#x7684;&#x8D77;&#x59CB;&#x5C42;&#x7EA7;:&#x7ED3;&#x675F;&#x5C42;&#x7EA7;&#xFF0C;&#x56E0;&#x4E3A;&#x867D;&#x7136;&#x4E00;&#x5171;&#x662F;&#x5206;&#x4E3A;37&#x5C42;&#xFF0C;&#x4F46;&#x662F;&#x5E76;&#x4E0D;&#x662F;&#x8BF4;&#x6709;37&#x4E2A;Feature&#xFF0C;&#x6BD4;&#x5982;&#x201C;#1 ImePlaceholder:13:14 &#x201D; ImePlaceholder&#x770B;&#x7740;&#x5C31;&#x662F;&#x548C;&#x8F93;&#x5165;&#x6CD5;&#x76F8;&#x5173;&#xFF0C;&#x90A3;&#x5C31;&#x4EE3;&#x8868;&#x7740;13&#xFF0C;14&#x90FD;&#x662F;&#x548C;&#x8F93;&#x5165;&#x6CD5;&#x76F8;&#x5173;&#x7684;window&#x3002;<br>android 13&#x76EE;&#x524D;&#x4E00;&#x5171;&#x4E5F;&#x53EA;&#x6709;5&#x4E2A;Feature&#x3002;</p>
<p>&#x53E6;&#x5916;&#x63D0;&#x4E00;&#x4E0B;&#x8FD9;&#x91CC;&#x7684; &#x201C;Leaf&#x201D;&#x4EE3;&#x8868;&#x7684;&#x4E0D;&#x662F;Feature&#xFF0C;&#x800C;&#x4E14;&#x8BF4;&#x5F53;&#x524D;&#x662F;&#x67D0;&#x4E2A;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#xFF0C;&#x4E0B;&#x9762;&#x662F;&#x8981;&#x6302;&#x7740;&#x5177;&#x4F53;Window&#x7684;&#x3002;</p>
<p><strong>3. &#x770B;&#x5176;&#x4ED6;&#x5C5E;&#x6027;&#xFF0C;&#x6BD4;&#x5982;type&#xFF0C;mode</strong></p>
<p>&#x77E5;&#x9053;&#x4E0A;&#x9762;&#x8FD9;4&#x70B9;&#x57FA;&#x672C;&#x4E0A;&#x5C31;&#x80FD;&#x770B;&#x5230;&#x5C42;&#x7EA7;&#x7ED3;&#x6784;&#x6811;&#x7684;&#x4FE1;&#x606F;&#x4E86;&#xFF0C;&#x5185;&#x5BB9;&#x867D;&#x7136;&#x5F88;&#x591A;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x5176;&#x5B9E;&#x4E3B;&#x8981;&#x5173;&#x5FC3;&#x7684;&#x8FD8;&#x662F;&#x4E0B;&#x9762;&#x201C;#1 DefaultTaskDisplayArea&#x201D;&#x7684;&#x90E8;&#x5206;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x91CC;&#x653E;&#x7684;&#x624D;&#x662F;&#x5E94;&#x7528;&#x76F8;&#x5173;&#x7684;&#x7A97;&#x53E3;&#xFF0C;&#x5176;&#x4ED6;&#x7684;&#x4E00;&#x822C;&#x90FD;&#x662F;&#x7CFB;&#x7EDF;&#x7A97;&#x53E3;&#x3002;&#x50CF;&#x5E94;&#x7528;&#x64CD;&#x4F5C;&#xFF0C;&#x5206;&#x5C4F;&#xFF0C;&#x5C0F;&#x7A97;&#xFF0C;&#x81EA;&#x7531;&#x7A97;&#x53E3;&#x64CD;&#x4F5C;&#x5BFC;&#x81F4;&#x5C42;&#x7EA7;&#x6539;&#x53D8;&#x90FD;&#x4F53;&#x73B0;&#x5728;&#x8FD9;&#x4E00;&#x5C42;&#xFF0C;<br>&#x53E6;&#x5916;&#x53EF;&#x4EE5;&#x7559;&#x610F;&#x4E00;&#x4E0B;&#x5982;&#x679C;&#x662F; WindowToken +WindowState&#x7684;&#x90FD;&#x662F;&#x7CFB;&#x7EDF;&#x7A97;&#x53E3;&#xFF0C;&#x6BD4;&#x5982;&#x4E0B;&#x9762;&#x8FD9;&#x79CD;&#x5F62;&#x5F0F;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bash&#x590D;&#x5236;&#x4EE3;&#x7801;        #0 WindowToken{1397896</span><br><span class="line">            #0 d0c3c51 InputMethod</span><br></pre></td></tr></table></figure>

<p>d0c3c51 &#x8FD9;&#x4E2A;&#x5E94;&#x8BE5;&#x662F;WindowState&#x7684;&#x5BF9;&#x8C61;&#x540D;&#xFF0C;&#x540E;&#x9762;&#x7684;InputMethod&#x662F;&#x5177;&#x4F53;&#x7684;&#x7A97;&#x53E3;&#x540D;<br>&#x800C; ActivityRecord+WindowState&#x5C31;&#x662F;&#x5E94;&#x7528;&#x4E86;&#x6BD4;&#x5982;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bash&#x590D;&#x5236;&#x4EE3;&#x7801;         #0 ActivityRecord{91c971c</span><br><span class="line">            #0 9c20028 com.google.android.dialer</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x4E9B;&#x6709;&#x4E2A;&#x5370;&#x8C61;&#x5C31;&#x884C;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x786C;&#x80CC;&#xFF0C;&#x4EE5;&#x540E;&#x770B;&#x7684;&#x591A;&#x4E86;&#x81EA;&#x7136;&#x5C31;&#x6709;&#x611F;&#x89C9;&#x4E86;&#x3002;</p>
<h2 id="3-2-&#x5C42;&#x7EA7;&#x7ED3;&#x6784;&#x6811;&#x53EF;&#x89C6;&#x5316;"><a href="#3-2-&#x5C42;&#x7EA7;&#x7ED3;&#x6784;&#x6811;&#x53EF;&#x89C6;&#x5316;" class="headerlink" title="3.2 &#x5C42;&#x7EA7;&#x7ED3;&#x6784;&#x6811;&#x53EF;&#x89C6;&#x5316;"></a>3.2 &#x5C42;&#x7EA7;&#x7ED3;&#x6784;&#x6811;&#x53EF;&#x89C6;&#x5316;</h2><p>&#x5355;&#x770B;&#x5C42;&#x7EA7;&#x6811;&#x53EF;&#x80FD;&#x8FC7;&#x4E8E;&#x67AF;&#x71E5;&#xFF0C;&#x5728;&#x521A;&#x5F00;&#x59CB;&#x5B66;&#x4E60;&#x7684;&#x65F6;&#x5019;&#x4E00;&#x822C;&#x90FD;&#x4F1A;&#x6839;&#x636E;&#x4FE1;&#x606F;&#x753B;&#x51FA;&#x4E00;&#x4E2A;&#x5C42;&#x7EA7;&#x7ED3;&#x6784;&#x56FE;&#x3002;<br>&#x9996;&#x5148;&#x6839;&#x636E;&#x524D;&#x9762;&#x770B;dump&#x5185;&#x5BB9;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x5148;&#x753B;&#x51FA;&#x4E00;&#x90E8;&#x5206;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/7f064a2c04c81528b399c510416a80f2f18f50e59877a88efb553bc46e0cbbdb" alt="&#x5C42;&#x7EA7;&#x7ED3;&#x6784;&#x6811;&#x7B2C;&#x4E00;&#x5C42;.png"></p>
<p>&#x8FD9;&#x91CC;&#x662F;DisplayContent&#x4E0B;&#x7684;3&#x4E2A;&#x5B69;&#x5B50;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5DF2;&#x7ECF;&#x8986;&#x76D6;&#x4E86; 0-36&#x5C42;&#x3002;<br>&#x7136;&#x540E;&#x6309;&#x7167;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x5C06;&#x6240;&#x6709;&#x7684;&#x5185;&#x5BB9;&#x90FD;&#x753B;&#x51FA;&#x6765;&#x5C31;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x4E0B;&#x9762;&#x8FD9;&#x5B8C;&#x6574;&#x7684;&#x6811;&#x56FE;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/34c6fd44361be2fc984c575531209401ee4bd6c7c282209a2144eadb8c0320c3" alt="&#x5C42;&#x7EA7;&#x7ED3;&#x6784;&#x6811;.png"></p>
<p><strong>&#x5F3A;&#x70C8;&#x5EFA;&#x8BAE;&#x60F3;&#x5B66;&#x8FD9;&#x4E00;&#x5757;&#x7684;&#x540C;&#x5B66;&#x4E00;&#x5B9A;&#x8981;&#x624B;&#x52A8;&#x753B;&#x51FA;&#x8FD9;&#x4E48;&#x4E00;&#x4E2A;&#x56FE;</strong></p>
<p>android&#x7248;&#x672C;&#x76F8;&#x540C;&#xFF0C;&#x753B;&#x51FA;&#x6765;&#x7684;&#x56FE;&#x57FA;&#x672C;&#x4E0A;&#x90FD;&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x53EA;&#x4F1A;&#x6839;&#x636E;&#x51FA;&#x73B0;&#x4E0D;&#x540C;&#x7684;Window&#x5728;&#x54CD;&#x5E94;&#x7684;Leaf,&#x4E5F;&#x5C31;&#x662F;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x4F1A;&#x6709;&#x4E0D;&#x540C;&#x3002;<br>&#x8FD9;&#x91CC;&#x5C06;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x7684;&#x989C;&#x8272;&#x6D82;&#x4E0A;&#x4E86;&#xFF0C;&#x53D1;&#x73B0;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x4E0B;&#x8981;&#x4E48;&#x4E3A;&#x7A7A;&#xFF0C;&#x8981;&#x4E48;&#x5C31;&#x662F; WindowToken&#xFF0C;&#x9664;&#x4E86;&#x6700;&#x5E95;&#x5C42;&#x7684;&#x58C1;&#x7EB8;&#xFF0C;&#x5176;&#x5B9E;&#x58C1;&#x7EB8;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x4E0B;&#x7684;WallpaperWindowToken&#x8FD9;&#x4E2A;&#x7C7B;&#xFF0C;&#x4E5F;&#x662F;&#x7EE7;&#x627F;&#x7684;WindowToken&#x3002;</p>
<p>&#x53EF;&#x80FD;&#x4E4B;&#x524D;&#x901A;&#x8FC7;&#x6587;&#x672C;&#x7684;&#x5F62;&#x5F0F;&#x8FD8;&#x6709;&#x70B9;&#x964C;&#x751F;&#xFF0C;&#x4F46;&#x662F;&#x8F6C;&#x6362;&#x6210;&#x56FE;&#x7247;&#x540E;&#xFF0C;&#x4E00;&#x4E9B;&#x5E38;&#x89C1;&#x7684;&#x4E1C;&#x897F;&#x5C31;&#x90FD;&#x6E05;&#x695A;&#x4E86;&#xFF0C;&#x6BD4;&#x5982;launcher,StatusBar,NavigationBar,Wallpaper</p>
<p>&#x7A97;&#x53E3;&#x6811;&#x548C;View&#x6811;&#x8FD8;&#x662F;&#x6709;&#x5DEE;&#x8DDD;&#x7684;&#xFF0C;View&#x6811;&#x4E0A;&#x90FD;&#x662F;View&#xFF0C;&#x800C;&#x7A97;&#x53E3;&#x6811;&#x4E0A;&#x53EA;&#x6709;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x4E0A;&#x6302;&#x7740;&#x7A97;&#x53E3;&#xFF0C;&#x5176;&#x4ED6;&#x5927;&#x90FD;&#x90FD;&#x662F;&#x4E00;&#x4E9B;&#x5BB9;&#x5668;&#x548C;&#x4E00;&#x4E9B;&#x3002;</p>
<p>&#x7A97;&#x53E3;&#x6811;&#x662F;&#x56FA;&#x5B9A;37&#x5C42;&#x7684;&#xFF0C; &#x7136;&#x540E;&#x5404;&#x4E2A;&#x56FE;&#x5C42;&#x90FD;&#x6709;&#x81EA;&#x5DF1;&#x652F;&#x6301;&#x7684;Feature&#x8FD9;&#x4E9B;&#x90FD;&#x662F;&#x4EE3;&#x7801;&#x4E2D;&#x56FA;&#x5B9A;&#x597D;&#x7684;&#x3002; &#x5B9E;&#x9645;&#x5F00;&#x53D1;&#x4E2D;&#xFF0C;&#x5F00;&#x53D1;&#x4E2D;&#x518D;&#x5C06;&#x81EA;&#x5DF1;&#x7684;&#x7A97;&#x53E3;&#x6839;&#x636E;&#x9700;&#x6C42;&#x6302;&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x4E0A;&#xFF0C;&#x8FD9;&#x4E2A;&#x548C;View&#x6811;&#x662F;&#x6709;&#x533A;&#x522B;&#x7684;&#x3002;</p>
<h2 id="3-3-&#x4E3A;&#x4EC0;&#x4E48;&#x8FD9;&#x4E48;&#x8BBE;&#x8BA1;"><a href="#3-3-&#x4E3A;&#x4EC0;&#x4E48;&#x8FD9;&#x4E48;&#x8BBE;&#x8BA1;" class="headerlink" title="3.3 &#x4E3A;&#x4EC0;&#x4E48;&#x8FD9;&#x4E48;&#x8BBE;&#x8BA1;"></a>3.3 &#x4E3A;&#x4EC0;&#x4E48;&#x8FD9;&#x4E48;&#x8BBE;&#x8BA1;</h2><p><strong>&#x65B9;&#x4FBF;&#x7BA1;&#x7406;</strong><br>&#x5728;&#x5199;&#x5E94;&#x7528;&#x7684;&#x65F6;&#x5019;&#x4E5F;&#x4F1A;&#x8FD9;&#x6837;&#x5B9A;&#x4E49;&#xFF0C;&#x8FD9;&#x6837;&#x5982;&#x679C;&#x8BF4;&#x67D0;&#x4E2A;&#x4E1A;&#x52A1;&#x7684;View&#x65E0;&#x8BBA;&#x600E;&#x4E48;&#x5199;&#xFF0C;&#x4ED6;&#x5C31;&#x53EA;&#x80FD;&#x5728;&#x81EA;&#x5DF1;&#x6240;&#x5728;&#x7684;&#x201C;&#x5C42;&#x7EA7;&#x201D;&#x4E0A;&#x663E;&#x793A;&#xFF0C;&#x4E0D;&#x4F1A;&#x5F71;&#x54CD;&#x5230;&#x5176;&#x4ED6;&#x3002;</p>
<p>&#x7A97;&#x53E3;&#x8FD9;&#x6837;&#x8BBE;&#x8BA1;&#x7684;&#x539F;&#x56E0;&#x53EF;&#x80FD;&#x8FD8;&#x6709;&#x5176;&#x4ED6;&#x7684;&#x8003;&#x8651;&#xFF0C;&#x5728;&#x8FDC;&#x53E4;&#x65F6;&#x671F;&#x7A97;&#x53E3;&#x7684;&#x987A;&#x5E8F;&#x597D;&#x50CF;&#x662F;&#x7ECF;&#x8FC7;&#x89C4;&#x5219;&#x8BA1;&#x7B97;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x79CD;&#x8BA1;&#x7B97;&#x5F88;&#x9EBB;&#x70E6;&#x51FA;&#x4E86;&#x95EE;&#x9898;&#x4E5F;&#x4E0D;&#x597D;&#x5B9A;&#x4F4D;&#x3002;</p>
<p>&#x73B0;&#x5728;&#x7684;&#x8FD9;&#x79CD;&#x8BBE;&#x8BA1;&#x5C31;&#x5F88;&#x5408;&#x7406;&#xFF0C;&#x7B26;&#x5408;&#x201C;&#x5355;&#x4E00;&#x539F;&#x5219;&#x201D;&#xFF0C;&#x5404;&#x4E2A;&#x7C7B;&#x578B;&#x7684;&#x7A97;&#x53E3;&#x5728;&#x81EA;&#x5DF1;&#x7684;&#x5C42;&#x7EA7;&#x4E0A;&#xFF0C;&#x4E0D;&#x4F1A;&#x5F71;&#x54CD;&#x5230;&#x5176;&#x4ED6;&#x3002;</p>
<p><strong>&#x65B9;&#x4FBF;&#x529F;&#x80FD;&#x5F00;&#x53D1;</strong><br>&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x4F18;&#x70B9;&#x6211;&#x8BA4;&#x4E3A;&#x662F;&#x8FD9;&#x79CD;&#x8BBE;&#x8BA1;&#x4E3A;&#x5C0F;&#x7A97;&#xFF0C;&#x5206;&#x5C4F;&#x8FD9;&#x79CD;&#x529F;&#x80FD;&#x63D0;&#x4F9B;&#x4E86;&#x5F00;&#x53D1;&#x7684;&#x4FBF;&#x5229;&#xFF0C;&#x56E0;&#x4E3A;&#x53EA;&#x9700;&#x8981;&#x5C06;&#x5BF9;&#x5E94;&#x7684;&#x7A97;&#x53E3;&#x79FB;&#x52A8;&#x5230;&#x6240;&#x5728;&#x7684;Task&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;</p>
<p>&#x50CF;&#x73B0;&#x5728;&#x7684;Activity&#x542F;&#x52A8;&#xFF0C;&#x5728;system_service&#x8FDB;&#x7A0B;&#x7684;&#x5904;&#x7406;&#x7684;&#x5F88;&#x591A;&#x903B;&#x8F91;&#x90FD;&#x662F;&#x56F4;&#x7ED5;&#x7740;&#x8FD9;&#x4E2A;&#x5C42;&#x7EA7;&#x6811;&#x6765;&#x505A;&#x7684;&#x3002;<br>&#x6BD4;&#x5982;&#x770B;&#x4E00;&#x773C;&#x201C;&#x7535;&#x8BDD;&#x201D;&#x548C;&#x201C;&#x77ED;&#x4FE1;&#x201D;2&#x4E2A;&#x5E94;&#x7528;&#x8FDB;&#x884C;&#x5206;&#x5C4F;&#x64CD;&#x4F5C;&#x7684;&#x524D;&#x540E;&#x5BF9;&#x6BD4;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/649464f62949ca7a6eee126a5893d57b98df0eb6f75bf12e9e206e8875fa454e" alt="&#x5206;&#x5C4F;&#x524D;&#x540E;&#x5BB9;&#x5668;&#x5BF9;&#x6BD4;.png"></p>
<p>&#x901A;&#x8FC7;&#x5BF9;&#x6BD4;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;</p>
<ol>
<li>Task=5,6 &#x8FD9;2&#x4E2A;Task&#x662F;&#x5206;&#x5C4F;&#x7528;&#x5230;&#x7684;Task,&#x5B83;&#x4EEC;&#x6709;&#x5171;&#x540C;&#x7684;&#x7236;&#x4EB2;&#x2013; Task =4&#x3002; &#x8FD9;3&#x4E2A;Task &#x5728;&#x5F00;&#x673A;&#x7684;&#x65F6;&#x5019;&#x5C31;&#x521B;&#x5EFA;&#x597D;&#x4E86;&#xFF0C;&#x9ED8;&#x8BA4;&#x5728;DefaultTaskDisplayArea&#x5B69;&#x5B50;&#x91CC;&#x662F;&#x6700;&#x540E;&#x9762;&#x3002;</li>
<li>&#x542F;&#x52A8;&#x5206;&#x5C4F;&#x540E;&#x5176;&#x5B9E;&#x5BF9;&#x5E94;&#x7A97;&#x53E3;&#x5BB9;&#x5668;&#x8FD9;&#x8FB9;&#x505A;&#x4E86;2&#x4EF6;&#x4E8B;<ol>
<li>&#x5C06;Task=4 &#x79FB;&#x5230;&#x6808;&#x9876;</li>
<li>&#x5C06;2&#x4E2A;&#x5206;&#x5C4F;&#x5E94;&#x7528;&#x7684;Task&#x5206;&#x522B;&#x79FB;&#x5230;&#x5230;Task5,6 &#x4E0B;</li>
</ol>
</li>
</ol>
<p>&#x8FD9;&#x6837;&#x5206;&#x5C4F;&#x5C31;&#x5B8C;&#x6210;&#x4E86;&#x3002;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/88c35e9a0596d0163dc5e878784264b6.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7339709247750242355.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7339709247750242355.html" itemprop="url">一次线上Xxl-Job定时任务调度失败的排查与解决 问题 调</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-02-26T14:55:33+08:00">
                2024-02-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="&#x95EE;&#x9898;"><a href="#&#x95EE;&#x9898;" class="headerlink" title="&#x95EE;&#x9898;"></a>&#x95EE;&#x9898;</h1><p><strong>&#x573A;&#x666F;</strong>&#xFF1A;&#x6BCF;&#x9694;&#x4E00;&#x5206;&#x949F;&#x6267;&#x884C;&#x4E00;&#x6B21;&#x7684;&#x5B9A;&#x65F6;&#x4EFB;&#x52A1;<br><strong>&#x73B0;&#x8C61;</strong>&#xFF1A;&#x7B2C;&#x4E00;&#x6B21;&#x8C03;&#x5EA6;&#x6210;&#x529F;&#x540E;&#xFF0C;&#x7B2C;&#x4E8C;&#x6B21;&#x8C03;&#x5EA6;<strong>&#x5FC5;&#x4F1A;&#x5931;&#x8D25;</strong>&#x3002;&#x4F46;&#x662F;&#x7B49;&#x5F85;&#x7B2C;&#x4E09;&#x6B21;&#x8C03;&#x5EA6;&#x540E;&#xFF0C;&#x7B2C;&#x4E8C;&#x6B21;&#x7684;&#x6267;&#x884C;&#x7ED3;&#x679C;<strong>&#x5374;&#x662F;&#x7B2C;&#x4E09;&#x6B21;&#x8C03;&#x5EA6;</strong>&#x7684;&#x65F6;&#x95F4;&#x3002;<br><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/46e29915a414c58b224dcdb26e9c7424ab3cdbabdc9fb241091bc2bf08835149" alt="image.png"><br>&#x5947;&#x602A;&#x7684;&#x662F;&#xFF0C;&#x53EA;&#x6709;&#x6BCF;&#x9694;&#x4E00;&#x5206;&#x949F;&#x6267;&#x884C;&#x4E00;&#x6B21;&#x7684;&#x4EFB;&#x52A1;&#x624D;&#x4F1A;&#x8FD9;&#x6837;&#xFF0C;&#x5176;&#x4ED6;&#x95F4;&#x9694;&#x4E00;&#x79D2;&#x6216;&#x8005;&#x4E00;&#x5C0F;&#x65F6;&#x7684;&#x53C8;&#x4E0D;&#x4F1A;&#x6709;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;<br>&#x67D0;&#x6B21;&#x8C03;&#x5EA6;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#xFF1A;<br><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/74c68d742c9a35f9ea1952af67564d6ddb12983a609dc40e4c41dfb367813204" alt="image.png"></p>
<h1 id="&#x8C03;&#x5EA6;&#x4E2D;&#x5FC3;&#x8C03;&#x5EA6;&#x539F;&#x7406;"><a href="#&#x8C03;&#x5EA6;&#x4E2D;&#x5FC3;&#x8C03;&#x5EA6;&#x539F;&#x7406;" class="headerlink" title="&#x8C03;&#x5EA6;&#x4E2D;&#x5FC3;&#x8C03;&#x5EA6;&#x539F;&#x7406;"></a>&#x8C03;&#x5EA6;&#x4E2D;&#x5FC3;&#x8C03;&#x5EA6;&#x539F;&#x7406;</h1><blockquote>
<p>&#x7EBF;&#x4E0A;xxl-job&#x7248;&#x672C;&#xFF1A;2.2.0-SNAPSHOT</p>
</blockquote>
<p>&#x5728;&#x6392;&#x67E5;&#x539F;&#x56E0;&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x770B;&#x4E86;&#x4E00;&#x4E0B;&#x8FD9;&#x4E2A;&#x7248;&#x672C;&#x7684;&#x6E90;&#x7801;&#xFF0C;&#x5BF9;&#x4EFB;&#x52A1;&#x7684;&#x8C03;&#x5EA6;&#x4EE5;&#x53CA;&#x6267;&#x884C;&#x6709;&#x4E86;&#x4E00;&#x4E9B;&#x4E86;&#x89E3;&#x3002;<br><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/9d652178e4dfa167f6dc55bd5a3ed10e2f41a32cdf15303049e1000c36453559" alt="image.png"><br>&#x6267;&#x884C;&#x5668;&#x5185;&#x90E8;&#x4F1A;&#x5F00;&#x542F;&#x4E00;&#x4E2A;http&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x7528;&#x4E8E;&#x63A5;&#x53D7;&#x8C03;&#x5EA6;&#x4E2D;&#x5FC3;&#x7684;&#x8C03;&#x5EA6;&#x8BF7;&#x6C42;&#x3002;&#x6BCF;&#x6B21;&#x7684;&#x8C03;&#x5EA6;&#x8BF7;&#x6C42;&#x90FD;&#x4F1A;&#x590D;&#x7528;Http&#x8FDE;&#x63A5;&#xFF0C;&#x907F;&#x514D;&#x591A;&#x6B21;&#x8FDE;&#x63A5;&#x6D88;&#x8017;&#x8D44;&#x6E90;&#x3002;<br>&#x8C03;&#x5EA6;&#x6B65;&#x9AA4;&#xFF1A;</p>
<ol>
<li>&#x8C03;&#x5EA6;&#x4E2D;&#x5FC3;&#x4ECE;&#x8FDE;&#x63A5;&#x6C60;&#x4E2D;&#x83B7;&#x53D6;&#x8FDE;&#x63A5;</li>
<li>&#x8C03;&#x5EA6;&#x4E2D;&#x5FC3;&#x53D1;&#x9001;&#x8C03;&#x5EA6;&#x8BF7;&#x6C42;&#xFF08;&#x5E26;&#x6709;<strong>RequestId</strong>&#xFF0C;<strong>JobLogId</strong>&#xFF09;&#xFF0C;&#x5E76;&#x963B;&#x585E;&#x7EBF;&#x7A0B;&#x7B49;&#x5F85;&#x6267;&#x884C;&#x5668;&#x54CD;&#x5E94;</li>
<li>&#x6267;&#x884C;&#x5668;&#x8FD4;&#x56DE;&#x8C03;&#x5EA6;&#x54CD;&#x5E94;&#xFF0C;&#x5E76;&#x5F02;&#x6B65;&#x6267;&#x884C;&#x5B9A;&#x65F6;&#x4EFB;&#x52A1;</li>
<li>&#x8C03;&#x5EA6;&#x4E2D;&#x5FC3;&#x6536;&#x5230;&#x8C03;&#x5EA6;&#x54CD;&#x5E94;&#xFF0C;&#x6839;&#x636E;&#x56DE;&#x4F20;&#x7684;<strong>RequestId</strong>&#xFF0C;&#x56DE;&#x5199;&#x6570;&#x636E;&#x5E93;&#x8C03;&#x53D6;&#x72B6;&#x6001;&#x3002;</li>
<li>&#x6267;&#x884C;&#x5668;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#x540E;&#xFF0C;&#x56DE;&#x8C03;&#x8C03;&#x5EA6;&#x4E2D;&#x5FC3;&#x66F4;&#x65B0;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x72B6;&#x6001;&#x63A5;&#x53E3;&#xFF0C;&#x6839;&#x636E;<strong>JobLogId</strong>&#x56DE;&#x5199;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x60C5;&#x51B5;&#x3002;</li>
</ol>
<h1 id="&#x6839;&#x636E;&#x5F02;&#x5E38;&#x5806;&#x8F7D;&#x5B9A;&#x4F4D;&#x95EE;&#x9898;"><a href="#&#x6839;&#x636E;&#x5F02;&#x5E38;&#x5806;&#x8F7D;&#x5B9A;&#x4F4D;&#x95EE;&#x9898;" class="headerlink" title="&#x6839;&#x636E;&#x5F02;&#x5E38;&#x5806;&#x8F7D;&#x5B9A;&#x4F4D;&#x95EE;&#x9898;"></a>&#x6839;&#x636E;&#x5F02;&#x5E38;&#x5806;&#x8F7D;&#x5B9A;&#x4F4D;&#x95EE;&#x9898;</h1><p>&#x6839;&#x636E;&#x5F02;&#x5E38;&#x5806;&#x6808;<code>XxlRpcFutureResponse.java:117</code>&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x627E;&#x5230;&#x5BF9;&#x5E94;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#x7684;&#x4F4D;&#x7F6E;&#x3002;&#x4F4D;&#x4E8E;&#x8C03;&#x5EA6;&#x8BF7;&#x6C42;&#x53D1;&#x9001;&#x540E;&#xFF0C;&#x4ECE;Future&#x83B7;&#x53D6;&#x5F02;&#x6B65;&#x7ED3;&#x679C;&#x7684;get&#x65B9;&#x6CD5;&#x3002;<br><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/fbe2df9ba6d1125d6f80e711f24fa09178f8172aa56e1bdb8ec941ecbc424089" alt="image.png"><br>futureResponse&#x7684;get&#x65B9;&#x6CD5;&#x7684;&#x903B;&#x8F91;&#x662F;<strong>&#x4F11;&#x7720;&#x8C03;&#x5EA6;&#x7EBF;&#x7A0B;</strong>&#xFF08;&#x9ED8;&#x8BA4;&#x4F11;&#x7720;1&#x79D2;&#xFF09;&#xFF0C;&#x7B49;&#x5F85;&#x6267;&#x884C;&#x5668;&#x54CD;&#x5E94;&#x8C03;&#x5EA6;&#x8BF7;&#x6C42;&#x3002;&#x7EBF;&#x7A0B;&#x88AB;&#x5524;&#x9192;&#x540E;&#x53BB;&#x68C0;&#x67E5;&#x672C;&#x6B21;&#x8C03;&#x5EA6;&#x662F;&#x5426;&#x5B8C;&#x6210;&#xFF0C;&#x8981;&#x662F;&#x6CA1;&#x6709;&#x5B8C;&#x6210;&#xFF0C;&#x5C31;&#x629B;&#x51FA;&#x8C03;&#x5EA6;&#x5931;&#x8D25;&#x7684;&#x9519;&#x8BEF;&#x3002;<br><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/5cae64badedbbff247722d4bf89db7816aa1c941c5cf3da721b2696cda9b7808" alt="image.png"><br>&#x4ECE;&#x4E0A;&#x9762;&#x903B;&#x8F91;&#x53EF;&#x4EE5;&#x63A8;&#x65AD;&#x51FA;&#x8C03;&#x5EA6;&#x4E2D;&#x5FC3;&#x662F;<strong>&#x6210;&#x529F;&#x53D1;&#x9001;&#x8C03;&#x7528;&#x8BF7;&#x6C42;</strong>&#x51FA;&#x53BB;&#x4E86;&#xFF0C;&#x56E0;&#x4E3A;&#x6267;&#x884C;&#x5668;<strong>&#x6CA1;&#x6709;&#x54CD;&#x5E94;</strong>&#x5BFC;&#x81F4;&#x7684;&#x8C03;&#x5EA6;&#x5931;&#x8D25;&#x9519;&#x8BEF;&#x3002;<br>&#x90A3;&#x4E48;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x6267;&#x884C;&#x5668;&#x6CA1;&#x6709;&#x54CD;&#x5E94;&#x8C03;&#x5EA6;&#x8BF7;&#x6C42;&#x5462;&#xFF1F;&#x6211;&#x4EEC;&#x5C31;&#x5F97;&#x53BB;&#x770B;&#x770B;&#x6267;&#x884C;&#x5668;&#x90A3;&#x8FB9;&#x7684;&#x60C5;&#x51B5;&#x4E86;&#x3002;</p>
<hr>
<p>&#x7531;&#x4E8E;xxl-job&#x4E2D;&#x5904;&#x7406;&#x8C03;&#x5EA6;&#x8BF7;&#x6C42;&#x7684;Netty&#x5904;&#x7406;&#x5668;&#x5E76;&#x6CA1;&#x6709;&#x6253;&#x5370;&#x5177;&#x4F53;&#x7684;&#x65E5;&#x5FD7;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x8981;&#x4F7F;&#x7528;<strong>Arthas</strong>&#x6765;&#x89C2;&#x5BDF;Netty&#x8C03;&#x5EA6;&#x8BF7;&#x6C42;&#x5904;&#x7406;&#x7684;&#x6267;&#x884C;&#x60C5;&#x51B5;&#x4E86;&#x3002;<br><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/e38c821dbfe0ce4953745dc7a2d99c0fd46e2783b2bdd04736c68c6f1ccc4b39" alt="image.png"></p>
<h1 id="&#x4F7F;&#x7528;Arthas&#x89C2;&#x5BDF;&#x8C03;&#x7528;&#x8BF7;&#x6C42;&#x6267;&#x884C;&#x60C5;&#x51B5;"><a href="#&#x4F7F;&#x7528;Arthas&#x89C2;&#x5BDF;&#x8C03;&#x7528;&#x8BF7;&#x6C42;&#x6267;&#x884C;&#x60C5;&#x51B5;" class="headerlink" title="&#x4F7F;&#x7528;Arthas&#x89C2;&#x5BDF;&#x8C03;&#x7528;&#x8BF7;&#x6C42;&#x6267;&#x884C;&#x60C5;&#x51B5;"></a>&#x4F7F;&#x7528;Arthas&#x89C2;&#x5BDF;&#x8C03;&#x7528;&#x8BF7;&#x6C42;&#x6267;&#x884C;&#x60C5;&#x51B5;</h1><p>&#x4F7F;&#x7528;arthas&#x7684;watch&#x547D;&#x4EE4;&#x89C2;&#x5BDF;&#x6267;&#x884C;&#x5668;&#x63A5;&#x6536;&#x8C03;&#x7528;&#x8BF7;&#x6C42;&#x60C5;&#x51B5;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arduino&#x590D;&#x5236;&#x4EE3;&#x7801;watch com.xxl.rpc.remoting.net.impl.netty_http.server.NettyHttpServerHandler channelRead0 &apos;{params}&apos; -x 2</span><br></pre></td></tr></table></figure>

<h2 id="&#x5206;&#x6790;&#x65E5;&#x5FD7;"><a href="#&#x5206;&#x6790;&#x65E5;&#x5FD7;" class="headerlink" title="&#x5206;&#x6790;&#x65E5;&#x5FD7;"></a>&#x5206;&#x6790;&#x65E5;&#x5FD7;</h2><p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/a317821e506c9a2b834451b8513d4be513489eaa02e7a22fc37fd67852136a6b" alt="image.png"><br>&#x6574;&#x7406;&#x4E00;&#x4E0B;&#x65E5;&#x5FD7;&#xFF0C;&#x5728;&#x95EE;&#x9898;&#x4EA7;&#x751F;&#x7684;&#x8FD9;&#x6BB5;&#x65F6;&#x95F4;&#x5185;&#xFF0C;&#x6267;&#x884C;&#x5668;&#x8FD9;&#x8FB9;&#x7684;Netty&#x7684;&#x8C03;&#x5EA6;&#x8BF7;&#x6C42;&#x5904;&#x7406;&#x5668;&#x53EA;&#x6536;&#x5230;&#x4E86;&#x4E09;&#x4E2A;&#x8BF7;&#x6C42;</p>
<table>
<thead>
<tr>
<th>&#x65F6;&#x95F4;&#x70B9;</th>
<th>channel&#x8FDC;&#x7A0B;&#x5730;&#x5740;&#x4FE1;&#x606F;</th>
<th>&#x8BF7;&#x6C42;&#x4FE1;&#x606F;</th>
</tr>
</thead>
<tbody><tr>
<td>18:02:00</td>
<td>R:/127.0.0.6:41163</td>
<td>POST / HTTP/1.1;content-length: 626</td>
</tr>
<tr>
<td>18:02:30</td>
<td>R:/127.0.0.6:41163</td>
<td>POST / HTTP/1.1;content-length: 159</td>
</tr>
<tr>
<td>18:04:00</td>
<td>R:/127.0.0.6:52551</td>
<td>POST / HTTP/1.1;content-length: 626</td>
</tr>
</tbody></table>
<p>&#x8C03;&#x7528;&#x65E5;&#x5FD7;&#x4E2D;&#xFF0C;&#x6709;&#x4E24;&#x4E2A;&#x70B9;&#x6BD4;&#x8F83;&#x5947;&#x602A;</p>
<ol>
<li><strong>18:02:30&#x6536;&#x5230;&#x4E86;&#x4E00;&#x6B21;&#x8BF7;&#x6C42;</strong></li>
</ol>
<p>&#x5728;&#x8FD9;&#x4E2A;&#x65F6;&#x95F4;&#x70B9;&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x6536;&#x5230;&#x4E00;&#x6B21;&#x8BF7;&#x6C42;&#x7684;&#x5462;&#xFF1F;&#x800C;&#x4E14;&#x8FD9;&#x4E2A;&#x8BF7;&#x6C42;&#x7684;&#x8BF7;&#x6C42;&#x5927;&#x5C0F;&#x4E0E;&#x6B63;&#x5E38;&#x7684;&#x8C03;&#x7528;&#x8BF7;&#x6C42;&#x7684;&#x5927;&#x5C0F;&#x8FD8;&#x4E00;&#x6837;&#xFF0C;&#x4EC5;&#x6709;159&#x5B57;&#x8282;&#x3002;&#x8FD9;&#x4E48;&#x5C0F;&#x7684;&#x8BF7;&#x6C42;&#x4F53;&#xFF0C;&#x8BA9;&#x6211;&#x60F3;&#x5230;&#x4E86;&#x4E00;&#x4E2A;&#x4E1C;&#x897F;&#xFF1A;<strong>&#x5FC3;&#x8DF3;&#x5305;</strong>&#x3002;<br>&#x5728;RPC&#x6846;&#x67B6;&#x4E2D;&#xFF0C;&#x4E3A;&#x4E86;&#x76D1;&#x6D4B;&#x901A;&#x4FE1;&#x901A;&#x9053;&#x7684;&#x6B63;&#x5E38;&#x4EE5;&#x53CA;&#x8282;&#x70B9;&#x7684;&#x5065;&#x5EB7;&#xFF0C;&#x4F1A;&#x5B9A;&#x65F6;&#x5411;&#x8282;&#x70B9;&#x53D1;&#x9001;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x5305;&#xFF0C;&#x7528;&#x4E8E;&#x5224;&#x65AD;&#x901A;&#x9053;&#x662F;&#x5426;&#x6B63;&#x5E38;&#x8FDE;&#x63A5;&#x3002;<br>&#x867D;&#x7136;&#x8C03;&#x5EA6;&#x4E2D;&#x5FC3;&#x4E0E;&#x6267;&#x884C;&#x5668;&#x7528;&#x7684;&#x662F;Http&#x8BF7;&#x6C42;&#xFF0C;&#x4F46;&#x662F;<code>xxl-job</code>&#x4E3A;&#x4E86;&#x51CF;&#x5C11;&#x8D44;&#x6E90;&#x6D6A;&#x8D39;&#xFF0C;&#x4F7F;&#x7528;&#x4E86;&#x8FDE;&#x63A5;&#x6C60;&#xFF0C;&#x4E8E;&#x662F;&#x4E5F;&#x5F15;&#x5165;&#x4E86;&#x5FC3;&#x8DF3;&#x76D1;&#x6D4B;&#x3002;&#x5F53;&#x901A;&#x9053;&#x5728;30&#x79D2;&#x5185;&#x6CA1;&#x6709;&#x8BFB;&#x5199;&#x64CD;&#x4F5C;&#x65F6;&#xFF0C;&#x5C31;&#x53D1;&#x9001;&#x4E00;&#x4E2A;&#x5FC3;&#x8DF3;&#x8BF7;&#x6C42;&#x3002;<br><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/8b2fd3532d537fd84248b36df0dca42612d44b247faa06990d0f113b366770fe" alt="image.png"><br>&#x5728;&#x6267;&#x884C;&#x5668;&#x4E5F;&#x80FD;&#x770B;&#x5230;&#x5FC3;&#x8DF3;&#x8BF7;&#x6C42;&#x7684;&#x65E5;&#x5FD7;&#x3002;<br><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/884995201d3d59a366d733f33d72eb281593a3efab2da03d53495d2e497b87b5" alt="image.png"><br>&#x4F46;&#x662F;&#x8FD9;&#x4E2A;&#x5FC3;&#x8DF3;&#x8BF7;&#x6C42;&#x6709;&#x70B9;&#x5947;&#x602A;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x53EA;&#x5728;18:02:30&#x5206;&#x6536;&#x5230;&#x5462;&#xFF1F;18:03:30&#x6CA1;&#x6709;&#x6536;&#x5230;&#x5462;&#xFF1F;<br>&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x5C31;&#x8DDF;&#x4E0B;&#x9762;&#x7684;&#x95EE;&#x9898;&#x6709;&#x6240;&#x5173;&#x8054;&#x4E86;&#x3002;</p>
<ol start="2">
<li><strong>channel&#x8FDC;&#x7A0B;&#x5730;&#x5740;&#x7684;IP&#x4E0D;&#x592A;&#x5BF9;&#x52B2;&#xFF0C;&#x5C45;&#x7136;&#x662F;&#x672C;&#x5730;&#x5730;&#x5740;&#x5E76;&#x975E;&#x662F;&#x8C03;&#x5EA6;&#x4E2D;&#x5FC3;&#x7684;&#x5730;&#x5740;</strong></li>
</ol>
<p>&#x7ECF;&#x6211;&#x4E86;&#x89E3;&#x540E;&#xFF0C;&#x516C;&#x53F8;&#x7684;K8S&#x73AF;&#x5883;&#x4E2D;&#x5F15;&#x5165;&#x4E86;<code>Istio</code>&#x8FDB;&#x884C;&#x670D;&#x52A1;&#x6CBB;&#x7406;&#xFF0C;&#x5176;&#x4E2D;&#x8FDB;&#x51FA;Pod&#x7684;&#x6D41;&#x91CF;&#x90FD;&#x4F1A;&#x88AB;Envoy&#x4EE3;&#x7406;&#xFF0C;&#x6240;&#x4EE5;<code>127.0.0.6</code>&#x6B63;&#x662F;<strong>Envoy</strong>&#x7684;IP&#x5730;&#x5740;&#x3002;<br><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/0181dd02a783bcfaee162117f9ab7d499b519cfe688730538d04ca122ef4e432" alt="image.png"></p>
<blockquote>
<p>Envoy&#x662F;&#x4E00;&#x4E2A;&#x7531;Lyft&#x5F00;&#x53D1;&#x7684;&#x9AD8;&#x6027;&#x80FD;&#x3001;&#x53EF;&#x6269;&#x5C55;&#x7684;&#x4EE3;&#x7406;&#xFF08;Proxy&#xFF09;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x7528;&#x4E8E;&#x5904;&#x7406;&#x5FAE;&#x670D;&#x52A1;&#x67B6;&#x6784;&#x4E2D;&#x7684;&#x7F51;&#x7EDC;&#x901A;&#x4FE1;&#x3002;&#x5B83;&#x88AB;&#x8BBE;&#x8BA1;&#x6210;&#x53EF;&#x7528;&#x4E8E;&#x591A;&#x79CD;&#x4E0D;&#x540C;&#x7684;&#x90E8;&#x7F72;&#x573A;&#x666F;&#xFF0C;&#x5E76;&#x63D0;&#x4F9B;&#x4E86;&#x4E30;&#x5BCC;&#x7684;&#x529F;&#x80FD;&#x96C6;&#xFF0C;&#x5982;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x3001;&#x6D41;&#x91CF;&#x8DEF;&#x7531;&#x3001;&#x6545;&#x969C;&#x6062;&#x590D;&#x3001;&#x5B89;&#x5168;&#x8BA4;&#x8BC1;&#x7B49;&#x3002;</p>
</blockquote>
<h2 id="&#x5B9A;&#x65F6;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x60C5;&#x51B5;"><a href="#&#x5B9A;&#x65F6;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x60C5;&#x51B5;" class="headerlink" title="&#x5B9A;&#x65F6;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x60C5;&#x51B5;"></a>&#x5B9A;&#x65F6;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x60C5;&#x51B5;</h2><p>&#x6536;&#x96C6;&#x65E5;&#x5FD7;&#x7684;&#x65F6;&#x95F4;&#x6BB5;&#x6B63;&#x597D;&#x5904;&#x4E8E;&#x95EE;&#x9898;&#x53D1;&#x751F;&#x7684;&#x4E00;&#x4E2A;&#x533A;&#x95F4;&#x5185;&#xFF0C;&#x8FD9;&#x4E2A;&#x65F6;&#x95F4;&#x6BB5;&#x5185;&#x5B9A;&#x65F6;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x60C5;&#x51B5;&#xFF1A;<br><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/0dfc5d12ff0206a066739f33d0c64c25a4a540a61402218e41ab4ad0f41ea319" alt="image.png"></p>
<ol>
<li>18:02&#x5206;&#x7684;&#x4EFB;&#x52A1;&#x6B63;&#x5E38;&#x8C03;&#x5EA6;&#x5E76;&#x6267;&#x884C;&#x6210;&#x529F;&#x4E86;&#x3002;</li>
<li>18:03&#x5206;&#x7684;&#x4EFB;&#x52A1;&#x8C03;&#x5EA6;&#x5931;&#x8D25;&#xFF0C;&#x4F46;&#x662F;&#x7531;&#x4E8E;&#x6267;&#x884C;&#x65F6;&#x95F4;&#x7684;&#x56DE;&#x586B;&#x662F;&#x7531;&#x6267;&#x884C;&#x5668;&#x9488;&#x5BF9;JobLogId&#x6765;&#x8FDB;&#x884C;&#x5339;&#x914D;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x80FD;&#x5F97;&#x51FA;&#x4E00;&#x4E2A;&#x7ED3;&#x8BBA;03&#x5206;&#x53D1;&#x9001;&#x7684;&#x8C03;&#x5EA6;&#x8BF7;&#x6C42;&#xFF0C;&#x6267;&#x884C;&#x5668;&#x5728;04&#x5206;&#x6536;&#x5230;&#x4E86;&#x5E76;&#x89E6;&#x53D1;&#x4E86;&#x5B9A;&#x65F6;&#x4EFB;&#x52A1;&#x3002;</li>
<li>18:04&#x5206;&#x7684;&#x4EFB;&#x52A1;&#x8C03;&#x5EA6;&#x5931;&#x8D25;&#xFF0C;&#x5E76;&#x4E14;&#x6CA1;&#x6709;&#x6267;&#x884C;&#x60C5;&#x51B5;&#x3002;</li>
</ol>
<h2 id="&#x603B;&#x7ED3;"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3;</h2><p>&#x622A;&#x81F3;&#x76EE;&#x524D;&#x80FD;&#x5F97;&#x5230;&#x7684;&#x4FE1;&#x606F;&#x603B;&#x7ED3;&#x4E00;&#x4E0B;</p>
<ol>
<li>&#x8C03;&#x5EA6;&#x4E2D;&#x5FC3;&#x4F1A;&#x5728;&#x901A;&#x9053;30&#x79D2;&#x5185;&#x6CA1;&#x6709;&#x8BFB;&#x5199;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5411;&#x5404;&#x4E2A;&#x6267;&#x884C;&#x5668;&#x53D1;&#x9001;&#x4E00;&#x4E2A;<strong>&#x5FC3;&#x8DF3;&#x8BF7;&#x6C42;</strong>&#x3002;</li>
<li>&#x8C03;&#x5EA6;&#x4E2D;&#x5FC3;&#x53D1;&#x9001;&#x5FC3;&#x8DF3;&#x8BF7;&#x6C42;&#x540E;&#xFF0C;&#x540E;&#x7EED;&#x7684;&#x8C03;&#x5EA6;&#x8BF7;&#x6C42;&#x90FD;<strong>&#x65E0;&#x6CD5;&#x8FDB;&#x5165;&#x6267;&#x884C;&#x5668;</strong>&#x4E2D;&#x3002;</li>
<li>&#x56E0;&#x4E3A;&#x6267;&#x884C;&#x5668;&#x670D;&#x52A1;&#x90E8;&#x7F72;&#x5728;K8S&#x4E2D;&#xFF0C;&#x800C;&#x4E14;K8S&#x4E2D;&#x5F15;&#x5165;&#x4E86;<code>Istio</code>&#xFF0C;&#x5BFC;&#x81F4;&#x8FDB;&#x5165;Pod&#x7684;&#x6D41;&#x91CF;&#x90FD;&#x4F1A;&#x88AB;<strong>Envoy&#x4EE3;&#x7406;</strong>&#x3002;</li>
<li>&#x8BE5;&#x95EE;&#x9898;&#x7684;&#x7B2C;&#x4E8C;&#x6B21;&#x8C03;&#x5EA6;&#x867D;&#x7136;&#x5931;&#x8D25;&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x4F1A;&#x5728;&#x7B2C;&#x4E09;&#x6B21;&#x8C03;&#x5EA6;&#x65F6;&#x88AB;&#x6267;&#x884C;&#x5668;&#x6210;&#x529F;&#x63A5;&#x6536;&#x5E76;&#x5904;&#x7406;&#x3002;</li>
</ol>
<p>&#x597D;&#x50CF;&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x7A81;&#x7834;&#x70B9;&#xFF0C;&#x5E76;&#x6CA1;&#x6709;&#x627E;&#x5230;&#x771F;&#x6B63;&#x8C03;&#x5EA6;&#x5931;&#x8D25;&#x7684;&#x95EE;&#x9898;&#x3002;&#x4E0D;&#x8FC7;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7740;&#x91CD;&#x53BB;&#x770B;&#x770B;<strong>Envoy</strong>&#xFF0C;&#x56E0;&#x4E3A;&#x76EE;&#x524D;&#x8FDB;&#x5165;&#x5230;Pod&#x7684;&#x6D41;&#x91CF;&#x90FD;&#x4F1A;&#x88AB;&#x5B83;&#x7ED9;&#x4EE3;&#x7406;&#xFF0C;&#x53BB;&#x89C2;&#x5BDF;&#x4E00;&#x4E0B;&#x8C03;&#x5EA6;&#x5931;&#x8D25;&#x53D1;&#x751F;&#x65F6;Envoy&#x7684;&#x65E5;&#x5FD7;&#x3002;</p>
<h1 id="Envoy&#x65E5;&#x5FD7;"><a href="#Envoy&#x65E5;&#x5FD7;" class="headerlink" title="Envoy&#x65E5;&#x5FD7;"></a>Envoy&#x65E5;&#x5FD7;</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">csharp&#x590D;&#x5236;&#x4EE3;&#x7801;[2024-02-21T18:02:00.026Z] &quot;POST / HTTP/1.1&quot; 200 - via_upstream - &quot;-&quot; 626 176 1 0 &quot;-&quot; &quot;-&quot; &quot;d9313e61-6530-4c08-aae2-fd864930ea31&quot; &quot;ebc-portal.ebc-bpm.svc.cluster.local&quot; &quot;10.64.195.45:7666&quot; inbound|7666|| 127.0.0.6:48733 10.64.195.45:7666 10.64.217.207:45584 - default</span><br><span class="line">[2024-02-21T18:02:30.055Z] &quot;POST / HTTP/1.1&quot; 503 UC upstream_reset_before_response_started{connection_termination} - &quot;-&quot; 159 95 90031 - &quot;-&quot; &quot;-&quot; &quot;3de88bd6-41cf-4078-a381-3542b460dd90&quot; &quot;ebc-portal.ebc-bpm.svc.cluster.local&quot; &quot;10.64.195.45:7666&quot; inbound|7666|| 127.0.0.6:48733 10.64.195.45:7666 10.64.217.207:45584 - default</span><br><span class="line">[2024-02-21T18:04:00.087Z] &quot;POST / HTTP/1.1&quot; 200 - via_upstream - &quot;-&quot; 626 176 1 0 &quot;-&quot; &quot;-&quot; &quot;25dac8f9-8364-42bd-8fdd-d08285ed1632&quot; &quot;ebc-portal.ebc-bpm.svc.cluster.local&quot; &quot;10.64.195.45:7666&quot; inbound|7666|| 127.0.0.6:39739 10.64.195.45:7666 10.64.217.207:45584 - default</span><br><span class="line">[2024-02-21T18:04:00.088Z] &quot;POST / HTTP/1.1&quot; 0 DC downstream_remote_disconnect - &quot;-&quot; 159 0 1 - &quot;-&quot; &quot;-&quot; &quot;bfa7dcee-123f-4582-9368-84edcb8476c7&quot; &quot;ebc-portal.ebc-bpm.svc.cluster.local&quot; &quot;10.64.195.45:7666&quot; inbound|7666|| 127.0.0.6:39739 10.64.195.45:7666 10.64.217.207:45584 - default</span><br></pre></td></tr></table></figure>

<p>&#x4E0A;&#x9762;&#x6BD4;&#x8F83;&#x5F02;&#x5E38;&#x7684;&#x65E5;&#x5FD7;&#x4FE1;&#x606F;&#x6709;&#x4E24;&#x6BB5;&#x5206;&#x522B;&#x662F;18:02:30&#x4EE5;&#x53CA;&#x7B2C;&#x4E8C;&#x4E2A;18:04:00&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x54CD;&#x5E94;&#x7801;&#x90FD;&#x4E0D;&#x662F;&#x6B63;&#x5E38;&#x7684;<code>200</code>&#xFF0C;&#x6211;&#x4EEC;&#x6765;&#x5206;&#x6790;&#x4E00;&#x4E0B;&#x5F02;&#x5E38;&#x7684;&#x539F;&#x56E0;&#x3002;</p>
<h2 id="&#x5F02;&#x5E38;&#x65E5;&#x5FD7;&#x4E00;"><a href="#&#x5F02;&#x5E38;&#x65E5;&#x5FD7;&#x4E00;" class="headerlink" title="&#x5F02;&#x5E38;&#x65E5;&#x5FD7;&#x4E00;"></a>&#x5F02;&#x5E38;&#x65E5;&#x5FD7;&#x4E00;</h2><blockquote>
<p>[2024-02-21T18:02:30.055Z] &#x201C;POST / HTTP/1.1&#x201D; 503 UC upstream_reset_before_response_started{connection_termination} - &#x201C;-&#x201C; 159 95 90031 - &#x201C;-&#x201C; &#x201C;-&#x201C; &#x201C;3de88bd6-41cf-4078-a381-3542b460dd90&#x201D; &#x201C;ebc-portal.ebc-bpm.svc.cluster.local&#x201D; &#x201C;10.64.195.45:7666&#x201D; inbound|7666|| 127.0.0.6:48733 10.64.195.45:7666 10.64.217.207:45584 - default</p>
</blockquote>
<p>&#x63D0;&#x53D6;&#x4E00;&#x4E0B;&#x6BD4;&#x8F83;&#x5173;&#x952E;&#x7684;&#x65E5;&#x5FD7;&#x7FFB;&#x8BD1;&#x4E00;&#x4E0B;&#x3002;</p>
<ul>
<li>&#x201C;2024-02-21T18:02:30&#x201D;&#xFF1A;&#x8BF7;&#x6C42;&#x5230;&#x8FBE;Envoy&#x65F6;&#x95F4;</li>
<li>&#x201C;503&#x201D; &#x672C;&#x6B21;&#x8BF7;&#x6C42;&#x6700;&#x7EC8;&#x7684;&#x54CD;&#x5E94;&#x7801;</li>
<li>&#x201C;UC upstream_reset_before_response_started{connection_termination}&#x201D;&#xFF1A;<code>UC</code>&#x4EE3;&#x8868;<strong>Upstream Connection</strong>&#xFF0C;&#x4E0A;&#x6E38;&#x670D;&#x52A1;&#x51FA;&#x73B0;&#x95EE;&#x9898;&#xFF0C;&#x5177;&#x4F53;&#x7684;&#x95EE;&#x9898;&#x4FE1;&#x606F;&#x4E3A;&#x4E0A;&#x6E38;&#x670D;&#x52A1;&#x5728;&#x54CD;&#x5E94;&#x4E4B;&#x524D;&#x91CD;&#x7F6E;&#x4E86;&#xFF0C;&#x56E0;&#x4E3A;<strong>&#x8FDE;&#x63A5;&#x88AB;&#x7EC8;&#x6B62;</strong>&#x4E86;&#x3002;</li>
<li>&#x201C;159 95 90031 -&#x201C;&#xFF1A;159&#x662F;&#x8BF7;&#x6C42;&#x4F53;&#x5927;&#x5C0F;&#xFF0C;&#x8BF4;&#x660E;&#x662F;&#x5FC3;&#x8DF3;&#x8BF7;&#x6C42;&#xFF1B;95&#x662F;&#x54CD;&#x5E94;&#x4F53;&#x5927;&#x5C0F;&#xFF1B;90031&#x662F;&#x8BF7;&#x6C42;&#x4ECE; Envoy &#x5230;&#x76EE;&#x6807;&#x670D;&#x52A1;&#x7684;&#x6301;&#x7EED;&#x65F6;&#x95F4;</li>
</ul>
<p>&#x8FD9;&#x4E2A;&#x8BF7;&#x6C42;&#x6BD4;&#x8F83;&#x5F02;&#x5E38;&#x7684;&#x70B9;&#x6709;&#x4E09;&#x4E2A;&#xFF1A;</p>
<ol>
<li><strong>&#x8FD4;&#x56DE;&#x4E86;</strong><code>503</code><strong>&#x54CD;&#x5E94;&#x7801;</strong></li>
</ol>
<p>&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x8FD4;&#x56DE;503&#x54CD;&#x5E94;&#x7801;&#x5462;&#xFF1F;&#x6211;&#x770B;&#x4E86;&#x4E00;&#x4E0B;&#x6267;&#x884C;&#x5668;&#x7684;Netty&#x8C03;&#x5EA6;&#x8BF7;&#x6C42;&#x5904;&#x7406;&#x5668;&#x4E2D;&#xFF0C;&#x5E76;&#x6CA1;&#x6709;&#x8FD4;&#x56DE;503&#x72B6;&#x6001;&#x7801;&#x7684;&#x4EE3;&#x7801;&#x3002;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;503&#x54CD;&#x5E94;&#x7801;&#x5C31;&#x53EF;&#x80FD;&#x662F;Envoy&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#x8FD4;&#x56DE;&#x7684;&#x3002;<br>&#x6211;&#x4FEE;&#x6539;&#x4E86;&#x4E00;&#x4E0B;Envoy&#x65E5;&#x5FD7;&#x7B49;&#x7EA7;&#xFF0C;&#x627E;&#x5230;&#x672C;&#x6B21;&#x5FC3;&#x8DF3;&#x8BF7;&#x6C42;Debug&#x7B49;&#x7EA7;&#x7684;&#x65E5;&#x5FD7;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">lua&#x590D;&#x5236;&#x4EE3;&#x7801;2024-02-21T18:02:30.846361Z debug envoy router [C32432][S12678816626782510759] cluster &apos;inbound|7666||&apos; match for URL &apos;/&apos;</span><br><span class="line">2024-02-21T18:02:30.846396Z debug envoy router [C32432][S12678816626782510759] router decoding headers:</span><br><span class="line">&apos;:authority&apos;, &apos;ebc-portal.ebc-bpm.svc.cluster.local&apos;</span><br><span class="line">&apos;:path&apos;, &apos;/&apos;</span><br><span class="line">&apos;:method&apos;, &apos;POST&apos;</span><br><span class="line">&apos;:scheme&apos;, &apos;http&apos;</span><br><span class="line">&apos;content-length&apos;, &apos;159&apos;</span><br><span class="line">&apos;x-forwarded-proto&apos;, &apos;http&apos;</span><br><span class="line">&apos;x-request-id&apos;, &apos;ab261a30-679c-403d-be2b-12b161810f28&apos;</span><br><span class="line">2024-02-21T18:02:30.846434Z debug envoy router [C32432][S12678816626782510759] pool ready</span><br><span class="line">2024-02-21T18:02:30.846469Z debug envoy http [C32432][S12678816626782510759] request end stream</span><br><span class="line">2024-02-21T18:04:00.877035Z debug envoy router [C32432][S12678816626782510759] upstream reset: reset reason: connection termination, transport failure reason:</span><br><span class="line">2024-02-21T18:04:00.877095Z debug envoy http [C32432][S12678816626782510759] Sending local reply with details upstream_reset_before_response_started{connection_termination}</span><br><span class="line">2024-02-21T18:04:00.877148Z debug envoy http [C32432][S12678816626782510759] encoding headers via codec (end_stream=false):</span><br><span class="line">&apos;:status&apos;, &apos;503&apos;</span><br><span class="line">&apos;content-length&apos;, &apos;95&apos;</span><br><span class="line">&apos;content-type&apos;, &apos;text/plain&apos;</span><br><span class="line">&apos;date&apos;, &apos;Mon, 21 Feb 2024 18:04:00 GMT&apos;</span><br><span class="line">&apos;server&apos;, &apos;istio-envoy&apos;</span><br></pre></td></tr></table></figure>

<p>&#x4ECE;&#x8FD9;&#x884C;&#x65E5;&#x5FD7;&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x5230;</p>
<blockquote>
<p>Sending local reply with details upstream_reset_before_response_started{connection_termination}</p>
</blockquote>
<p>&#x672C;&#x6B21;&#x5FC3;&#x8DF3;&#x8BF7;&#x6C42;&#x4ECE;<code>18:02:30</code>&#x8BF7;&#x6C42;&#x8FDB;&#x6765;&#xFF0C;<code>18:04:00</code>Envoy&#x53D1;&#x73B0;&#x4E0A;&#x6E38;&#x670D;&#x52A1;&#x5668;&#x8FDE;&#x63A5;&#x7EC8;&#x6B62;&#xFF0C;&#x4E8E;&#x662F;&#x81EA;&#x5DF1;&#x6784;&#x9020;&#x4E86;&#x4E00;&#x4E2A;<code>503</code>&#x54CD;&#x5E94;&#x7801;&#x7684;&#x54CD;&#x5E94;&#x4F53;&#x8FD4;&#x56DE;&#x7ED9;&#x8C03;&#x5EA6;&#x4E2D;&#x5FC3;&#x3002;</p>
<ol start="2">
<li><strong>&#x8BF7;&#x6C42;&#x65F6;&#x95F4;90031&#x6BEB;&#x79D2;</strong></li>
</ol>
<p>&#x672C;&#x6B21;&#x5FC3;&#x8DF3;&#x8BF7;&#x6C42;&#x65F6;&#x95F4;&#x592A;&#x957F;&#x4E86;&#xFF0C;&#x627E;&#x4E86;&#x4E00;&#x4E0B;&#x6267;&#x884C;&#x5668;&#x4E2D;Netty&#x8C03;&#x5EA6;&#x8BF7;&#x6C42;&#x5904;&#x7406;&#x5668;&#x5BF9;&#x4E8E;&#x5FC3;&#x8DF3;&#x8BF7;&#x6C42;&#x7684;&#x5904;&#x7406;&#xFF0C;&#x53D1;&#x73B0;<code>xxl-job</code>&#x5728;&#x8FD9;&#x4E2A;&#x7248;&#x672C;&#x4E2D;&#xFF0C;&#x662F;<strong>&#x4E0D;&#x4F1A;&#x5BF9;&#x5FC3;&#x8DF3;&#x505A;&#x4EFB;&#x4F55;&#x5904;&#x7406;</strong>&#x7684;&#x3002;<br><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/60de4ed4e6f3629832b3b7cafa3b481280b0e68ea6552d816e36d7952553ec66" alt="image.png"><br>&#x5BFC;&#x81F4;&#x4E00;&#x76F4;&#x4E0D;&#x4F1A;&#x8FD4;&#x56DE;Http&#x54CD;&#x5E94;&#xFF0C;&#x800C;&#x4E14;&#x5728;Envoy&#x4E2D;&#x8981;&#x662F;&#x6CA1;&#x6709;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x6CA1;&#x6709;&#x6536;&#x5230;&#x54CD;&#x5E94;&#x7684;&#x8BDD;&#xFF0C;&#x4F1A;&#x8BA4;&#x4E3A;&#x8BE5;&#x8BF7;&#x6C42;&#x4ECD;&#x5728;&#x5904;&#x7406;&#x4E2D;&#x7684;&#x3002;&#x76F4;&#x5230;&#x8FBE;&#x5230;Envoy&#x7684;&#x8BF7;&#x6C42;&#x8D85;&#x65F6;&#x624D;&#x4F1A;&#x53D6;&#x6D88;&#x8FD9;&#x6B21;&#x8BF7;&#x6C42;&#x3002;</p>
<ol start="3">
<li><strong>&#x4E0A;&#x6E38;&#x670D;&#x52A1;&#x7EC8;&#x6B62;&#x4E86;&#x8FDE;&#x63A5;</strong></li>
</ol>
<p>&#x5728;&#x8FD9;&#x4E2A;&#x65F6;&#x95F4;&#x70B9;<code>2024-02-21T18:04:00</code>&#x6267;&#x884C;&#x5668;&#x4E2D;&#x6253;&#x5370;&#x4E86;&#x4E00;&#x884C;&#x65E5;&#x5FD7;&#xFF0C;&#x63D0;&#x793A;&#x6267;&#x884C;&#x5668;&#x5173;&#x95ED;&#x4E86;&#x7A7A;&#x95F2;&#x8FDE;&#x63A5;&#x3002;<br><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/4e56ddebd4f494e50df4f9c3714a8073191872c454f714a636960af763bee2ec" alt="image.png"><br>&#x627E;&#x4E86;&#x4E00;&#x4E0B;&#x8BE5;&#x884C;&#x65E5;&#x5FD7;&#x5728;&#x6E90;&#x7801;&#x4E2D;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x53D1;&#x73B0;&#x8FD9;&#x4E2A;&#x5173;&#x95ED;&#x8FDE;&#x63A5;&#x7684;&#x524D;&#x63D0;&#x662F;90&#x79D2;&#x5185;&#x901A;&#x9053;<strong>&#x6CA1;&#x6709;&#x8FDB;&#x884C;&#x8BFB;&#x5199;</strong>&#xFF0C;&#x7136;&#x540E;&#x6267;&#x884C;&#x5668;&#x89C9;&#x5F97;&#x8BE5;&#x8FDE;&#x63A5;&#x901A;&#x9053;&#x5DF2;&#x7ECF;&#x5F02;&#x5E38;&#x4E86;&#xFF0C;&#x8FD9;&#x4E5F;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;Envoy&#x4F1A;&#x63D0;&#x793A;&#x4E0A;&#x6E38;&#x670D;&#x52A1;&#x7EC8;&#x6B62;&#x4E86;&#x8FDE;&#x63A5;&#x7684;&#x539F;&#x56E0;&#x3002;<br><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/e6a63c93545b16a49b3bf2022bb28b91e07bf8ff8084ae603f3b541485d7a2ff" alt="image.png"></p>
<h2 id="&#x5F02;&#x5E38;&#x65E5;&#x5FD7;&#x4E8C;"><a href="#&#x5F02;&#x5E38;&#x65E5;&#x5FD7;&#x4E8C;" class="headerlink" title="&#x5F02;&#x5E38;&#x65E5;&#x5FD7;&#x4E8C;"></a>&#x5F02;&#x5E38;&#x65E5;&#x5FD7;&#x4E8C;</h2><blockquote>
<p>[2024-02-21T18:04:00.088Z] &#x201C;POST / HTTP/1.1&#x201D; 0 DC downstream_remote_disconnect - &#x201C;-&#x201C; 159 0 1 - &#x201C;-&#x201C; &#x201C;-&#x201C; &#x201C;bfa7dcee-123f-4582-9368-84edcb8476c7&#x201D; &#x201C;ebc-portal.ebc-bpm.svc.cluster.local&#x201D; &#x201C;10.64.195.45:7666&#x201D; inbound|7666|| 127.0.0.6:39739 10.64.195.45:7666 10.64.217.207:45584 - default</p>
</blockquote>
<ul>
<li>&#x201C;2024-02-21T18:04:00&#x201D;&#xFF1A;&#x8BF7;&#x6C42;&#x5230;&#x8FBE;Envoy&#x65F6;&#x95F4;</li>
<li>&#x201C;0&#x201D;&#xFF1A;&#x672C;&#x6B21;&#x8BF7;&#x6C42;&#x6700;&#x7EC8;&#x7684;&#x54CD;&#x5E94;&#x7801;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x672C;&#x6B21;&#x8C03;&#x5EA6;&#x4E2D;&#x5FC3;&#x7684;&#x8BF7;&#x6C42;&#x5E76;&#x6CA1;&#x6709;&#x5B8C;&#x6210;</li>
<li>&#x201C;DC downstream_remote_disconnect&#x201D;&#xFF1A;<code>DC</code>&#x4EE3;&#x8868;<strong>Downstream Connection</strong>&#xFF0C;&#x4E0B;&#x6E38;&#x670D;&#x52A1;&#x51FA;&#x73B0;&#x95EE;&#x9898;&#xFF0C;&#x5177;&#x4F53;&#x7684;&#x95EE;&#x9898;&#x4FE1;&#x606F;&#x4E3A;<strong>&#x4E0B;&#x6E38;&#x8FDC;&#x7A0B;&#x670D;&#x52A1;&#x7EC8;&#x6B62;&#x4E86;&#x8FDE;&#x63A5;</strong>&#x3002;</li>
<li>&#x201C;159 0 1 - &#x201C;&#xFF1A;159&#x662F;&#x8BF7;&#x6C42;&#x4F53;&#x5927;&#x5C0F;&#xFF0C;&#x8BF4;&#x660E;&#x662F;&#x5FC3;&#x8DF3;&#x8BF7;&#x6C42;&#xFF1B;0&#x662F;&#x54CD;&#x5E94;&#x4F53;&#x5927;&#x5C0F;&#xFF1B;1&#x662F;&#x8BF7;&#x6C42;&#x4ECE; Envoy &#x5230;&#x76EE;&#x6807;&#x670D;&#x52A1;&#x7684;&#x6301;&#x7EED;&#x65F6;&#x95F4;&#x3002;</li>
</ul>
<p>&#x5728;&#x8FD9;&#x884C;&#x65E5;&#x5FD7;&#x4E2D;&#xFF0C;&#x4E0B;&#x6E38;&#x670D;&#x52A1;&#x6307;&#x7684;&#x6B63;&#x662F;&#x8C03;&#x5EA6;&#x4E2D;&#x5FC3;&#xFF0C;&#x6B64;&#x523B;&#x67E5;&#x770B;&#x4E00;&#x4E0B;&#x8C03;&#x5EA6;&#x4E2D;&#x5FC3;&#x6253;&#x5370;&#x7684;&#x65E5;&#x5FD7;&#xFF0C;&#x53D1;&#x73B0;&#x629B;&#x51FA;&#x4E86;&#x4E00;&#x4E2A;<code>XxlRpcException</code>&#x7684;&#x5F02;&#x5E38;&#xFF0C;&#x4ECE;&#x8FD9;&#x4E2A;&#x5F02;&#x5E38;&#x4FE1;&#x606F;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x662F;&#x56E0;&#x4E3A;&#x6536;&#x5230;&#x4E86;&#x4E00;&#x4E2A;<strong>&#x65E0;&#x6548;&#x54CD;&#x5E94;&#x7801;</strong>&#x5BFC;&#x81F4;&#x7684;&#x3002;<br><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/837e1ccb79e06233a08ca2f4bc535c12dcc4188272d1c0d22598fd940ea84ec5" alt="image.png"><br>&#x7167;&#x846B;&#x82A6;&#x753B;&#x74E2;&#xFF0C;&#x6211;&#x4E5F;&#x627E;&#x5230;&#x8FD9;&#x4E2A;&#x5F02;&#x5E38;&#x4F4D;&#x4E8E;&#x6E90;&#x7801;&#x7684;&#x4F4D;&#x7F6E;&#xFF1A;<br><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/a034e9595862a445807f1626c63c485e82f1e23fc6b3f1a86b4b2c8b21fb2483" alt="output.png"><br>&#x8FD9;&#x4E2A;&#x5F02;&#x5E38;&#x7684;&#x629B;&#x51FA;&#x662F;&#x7531;&#x4E8E;&#x6267;&#x884C;&#x5668;&#x8FD4;&#x56DE;&#x4E86;&#x975E;<code>200</code>&#x72B6;&#x6001;&#x7801;&#x7684;&#x54CD;&#x5E94;&#xFF0C;&#x7ED3;&#x5408;<strong>&#x5F02;&#x5E38;&#x65E5;&#x5FD7;&#x4E00;</strong>&#x4E2D;Envoy&#x751F;&#x6210;&#x7684;<code>503</code>&#x54CD;&#x5E94;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x63A8;&#x65AD;&#x51FA;&#xFF0C;&#x6B63;&#x662F;&#x7531;&#x4E8E;&#x8FD9;&#x4E2A;<code>503</code>&#x54CD;&#x5E94;&#xFF0C;&#x5BFC;&#x81F4;&#x8C03;&#x5EA6;&#x4E2D;&#x5FC3;&#x5173;&#x95ED;&#x4E86;&#x4E0E;&#x6267;&#x884C;&#x5668;&#x7684;&#x8FDE;&#x63A5;&#x901A;&#x9053;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x8BE5;&#x8FDE;&#x63A5;&#x901A;&#x9053;&#x662F;&#x4E0E;<strong>Pod&#x4E2D;Envoy</strong>&#x7684;&#x8FDE;&#x63A5;&#x901A;&#x9053;&#x3002;</p>
<h1 id="&#x539F;&#x56E0;"><a href="#&#x539F;&#x56E0;" class="headerlink" title="&#x539F;&#x56E0;"></a>&#x539F;&#x56E0;</h1><p>&#x7ECF;&#x8FC7;&#x4E86;&#x4E0A;&#x9762;&#x5BF9;&#x4E8E;&#x8BE5;&#x95EE;&#x9898;&#x7684;&#x7EC6;&#x81F4;&#x5206;&#x6790;&#x6392;&#x67E5;&#xFF0C;&#x7EC8;&#x4E8E;&#x627E;&#x5230;&#x4E86;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x4EA7;&#x751F;&#x7684;&#x539F;&#x56E0;&#x4E86;&#x3002;<br>&#x7531;&#x4E8E;&#x8BE5;&#x7248;&#x672C;<code>xxl-job</code>&#x5728;Http&#x534F;&#x8BAE;&#x4E0B;&#x7684;RPC&#x8C03;&#x7528;&#x4E2D;&#xFF0C;<strong>&#x7F3A;&#x5C11;&#x5FC3;&#x8DF3;&#x8BF7;&#x6C42;&#x7684;&#x54CD;&#x5E94;</strong>&#x5BFC;&#x81F4;&#x7684;&#xFF0C;&#x5E76;&#x4E14;&#x4E24;&#x4E2A;&#x670D;&#x52A1;&#x4E4B;&#x95F4;&#x7684;&#x6D41;&#x7A0B;&#x88AB;Envoy&#x7ED9;&#x4EE3;&#x7406;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x4EA7;&#x751F;&#x4E86;&#x8BE5;&#x95EE;&#x9898;&#x3002;<br>&#x670D;&#x52A1;&#x8FC1;&#x79FB;&#x81F3;K8S&#x540E;&#xFF0C;&#x5F15;&#x8FDB;&#x4E86;Istio&#x670D;&#x52A1;&#x6CBB;&#x7406;&#xFF0C;&#x7ED9;&#x6BCF;&#x4E2A;Pod&#x90FD;&#x5BFC;&#x5165;&#x4E86;&#x4E00;&#x4E2A;&#x65B0;&#x5BB9;&#x5668;Envoy&#xFF0C;&#x7528;&#x4E8E;&#x4EE3;&#x7406;&#x8FDB;&#x51FA;Pod&#x7684;&#x6D41;&#x91CF;&#x3002;<br>Envoy&#x5728;&#x8F6C;&#x53D1;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x5230;&#x540E;&#x7AEF;&#x670D;&#x52A1;&#x540E;&#xFF0C;&#x4F1A;&#x7B49;&#x5F85;&#x540E;&#x7AEF;&#x670D;&#x52A1;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x54CD;&#x5E94;&#x3002;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#x4E0A;&#x6709;&#x591A;&#x4E2A;&#x8BF7;&#x6C42;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x4E9B;&#x8BF7;&#x6C42;&#x4F1A;&#x88AB;&#x963B;&#x585E;&#xFF0C;&#x76F4;&#x5230;&#x524D;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x7684;&#x54CD;&#x5E94;&#x8FD4;&#x56DE;&#x3002;&#x5E76;&#x4E14;&#x7531;&#x4E8E;&#x8C03;&#x5EA6;&#x4E2D;&#x5FC3;<strong>&#x4F7F;&#x7528;&#x8FDE;&#x63A5;&#x6C60;</strong>&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x6BCF;&#x6B21;&#x90FD;<strong>&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;</strong>&#xFF0C;&#x5C31;&#x4F1A;&#x5BFC;&#x81F4;&#x8BF7;&#x6C42;&#x5728;Envoy&#x963B;&#x585E;&#x4E86;&#x3002;<br>&#x5F53;&#x8C03;&#x5EA6;&#x4E2D;&#x5FC3;&#x53D1;&#x9001;&#x4E00;&#x4E2A;&#x5FC3;&#x8DF3;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x8BE5;&#x8BF7;&#x6C42;&#x88AB;Envoy&#x8F6C;&#x53D1;&#x7ED9;&#x6267;&#x884C;&#x5668;&#x540E;&#xFF0C;Envoy&#x4F1A;&#x7B49;&#x5F85;&#x6267;&#x884C;&#x5668;&#x8FD4;&#x56DE;&#x54CD;&#x5E94;&#x7ED3;&#x679C;&#x3002;&#x7531;&#x4E8E;&#x6267;&#x884C;&#x5668;&#x6536;&#x5230;&#x5FC3;&#x8DF3;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;<strong>&#x4E0D;&#x4F1A;&#x8FDB;&#x884C;&#x4EFB;&#x4F55;&#x64CD;&#x4F5C;</strong>&#xFF0C;&#x5BFC;&#x81F4;Envoy&#x4E2D;&#x5FC3;&#x4F1A;&#x4E00;&#x76F4;&#x7B49;&#x5F85;&#x5FC3;&#x8DF3;&#x54CD;&#x5E94;&#xFF0C;<strong>&#x963B;&#x585E;</strong>&#x540E;&#x7EED;&#x7684;&#x8C03;&#x5EA6;&#x8BF7;&#x6C42;&#x3002;<br>&#x7531;&#x4E8E;Envoy&#x963B;&#x585E;&#x4E86;&#x540E;&#x7EED;&#x6B63;&#x5E38;&#x7684;&#x8C03;&#x5EA6;&#x8BF7;&#x6C42;&#xFF0C;&#x5BFC;&#x81F4;&#x6267;&#x884C;&#x5668;&#x4E0E;&#x8C03;&#x5EA6;&#x4E2D;&#x5FC3;&#x7684;&#x8FDE;&#x63A5;&#x5728;90S&#x5185;&#x6CA1;&#x6709;<strong>&#x8FDB;&#x884C;&#x8BFB;&#x5199;&#x64CD;&#x4F5C;</strong>&#xFF0C;&#x4E8E;&#x662F;&#x6267;&#x884C;&#x5668;&#x5C31;&#x4F1A;&#x5C06;&#x8BE5;&#x8FDE;&#x63A5;&#x901A;&#x9053;&#x5173;&#x95ED;&#x3002;<br><strong>&#x8C03;&#x5EA6;&#x5931;&#x8D25;&#x8DEF;&#x5F84;&#xFF1A;</strong></p>
<ol>
<li>&#x8C03;&#x5EA6;&#x4E2D;&#x5FC3;&#x4E0E;&#x6267;&#x884C;&#x5668;&#x6B63;&#x5E38;&#x8FDE;&#x63A5;&#x3002;</li>
<li>&#x7B2C;&#x4E00;&#x6B21;&#x8C03;&#x5EA6;&#xFF0C;&#x6210;&#x529F;&#x8C03;&#x5EA6;&#x5E76;&#x6267;&#x884C;&#x5B9A;&#x65F6;&#x4EFB;&#x52A1;&#x3002;</li>
<li>&#x7ECF;&#x8FC7;30S&#x540E;&#xFF0C;&#x8C03;&#x5EA6;&#x4E2D;&#x5FC3;&#x53D1;&#x9001;&#x4E00;&#x4E2A;&#x5FC3;&#x8DF3;&#x8BF7;&#x6C42;&#x5230;&#x6267;&#x884C;&#x5668;&#x3002;</li>
<li>Envoy&#x4EE3;&#x7406;&#x5FC3;&#x8DF3;&#x8BF7;&#x6C42;&#x5E76;&#x8F6C;&#x53D1;&#x5230;&#x6267;&#x884C;&#x5668;&#x3002;</li>
<li>&#x6267;&#x884C;&#x5668;&#x5FFD;&#x7565;&#x5FC3;&#x8DF3;&#x8BF7;&#x6C42;&#xFF0C;&#x4E0D;&#x4F1A;&#x8FD4;&#x56DE;Http&#x54CD;&#x5E94;&#x3002;&#x5BFC;&#x81F4;Envoy&#x963B;&#x585E;&#x672C;&#x6761;Http&#x8FDE;&#x63A5;&#xFF0C;&#x4EE5;&#x81F3;&#x4E8E;&#x540E;&#x7EED;&#x7684;&#x8C03;&#x5EA6;&#x8BF7;&#x6C42;&#x65E0;&#x6CD5;&#x8FDB;&#x5165;&#x6267;&#x884C;&#x5668;&#x3002;</li>
<li>&#x6267;&#x884C;&#x5668;90&#x79D2;&#x540E;&#x53D1;&#x73B0;&#x548C;&#x8C03;&#x5EA6;&#x4E2D;&#x5FC3;&#x7684;Http&#x8FDE;&#x63A5;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x8BFB;&#x5199;&#x64CD;&#x4F5C;&#xFF0C;&#x4E8E;&#x662F;&#x5173;&#x95ED;&#x8BE5;&#x6761;Http&#x8FDE;&#x63A5;&#x3002;</li>
<li>Envoy&#x7B49;&#x5F85;&#x5FC3;&#x8DF3;&#x54CD;&#x5E94;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53D1;&#x73B0;&#x8F6C;&#x53D1;&#x7684;&#x8BF7;&#x6C42;&#x88AB;&#x5F02;&#x5E38;&#x5173;&#x95ED;&#xFF0C;&#x4E8E;&#x662F;&#x81EA;&#x5DF1;&#x6784;&#x9020;&#x4E86;&#x4E00;&#x4E2A;503&#x7684;&#x54CD;&#x5E94;&#x53D1;&#x9001;&#x7ED9;&#x8C03;&#x5EA6;&#x4E2D;&#x5FC3;&#x3002;&#x6784;&#x9020;&#x5B8C;503&#x54CD;&#x5E94;&#x540E;&#xFF0C;&#x6309;&#x987A;&#x5E8F;&#x5904;&#x7406;&#x8BE5;&#x901A;&#x9053;&#x540E;&#x7EED;&#x8BF7;&#x6C42;&#xFF0C;&#x6B64;&#x65F6;&#x7B2C;&#x4E8C;&#x6B21;&#x8C03;&#x5EA6;&#x88AB;&#x8F6C;&#x53D1;&#x5230;&#x6267;&#x884C;&#x5668;&#x4E2D;&#xFF0C;&#x7B2C;&#x4E8C;&#x6B21;&#x8C03;&#x5EA6;&#x88AB;&#x6267;&#x884C;&#x5668;&#x6B63;&#x5E38;&#x5904;&#x7406;&#x3002;</li>
<li>&#x8C03;&#x5EA6;&#x4E2D;&#x5FC3;&#x6536;&#x5230;503&#x7684;&#x54CD;&#x5E94;&#x540E;&#xFF0C;&#x5185;&#x90E8;Netty&#x7684;&#x5904;&#x7406;&#x5668;&#x4F1A;&#x629B;&#x51FA;&#x4E00;&#x4E2A;XxlRpcException&#x7684;&#x5F02;&#x5E38;&#xFF0C;&#x5BFC;&#x81F4;&#x5728;&#x8C03;&#x5EA6;&#x4E2D;&#x5FC3;&#x4E5F;&#x4F1A;&#x5173;&#x95ED;&#x4E0E;&#x6267;&#x884C;&#x5668;&#x7684;http&#x8FDE;&#x63A5;&#xFF0C;&#x5BFC;&#x81F4;&#x7B2C;&#x4E09;&#x6B21;&#x8C03;&#x5EA6;&#x5931;&#x8D25;&#x3002;</li>
</ol>
<h1 id="&#x89E3;&#x51B3;&#x529E;&#x6CD5;"><a href="#&#x89E3;&#x51B3;&#x529E;&#x6CD5;" class="headerlink" title="&#x89E3;&#x51B3;&#x529E;&#x6CD5;"></a>&#x89E3;&#x51B3;&#x529E;&#x6CD5;</h1><p>&#x8BE5;&#x95EE;&#x9898;&#x7684;&#x6839;&#x56E0;&#x662F;&#x7531;&#x4E8E;&#x5728;&#x8BE5;&#x7248;&#x672C;<code>xxl-job</code>&#x5728;Http&#x534F;&#x8BAE;&#x4E0B;&#x7684;RPC&#x8C03;&#x7528;&#x4E2D;&#xFF0C;<strong>&#x7F3A;&#x5C11;&#x5FC3;&#x8DF3;&#x8BF7;&#x6C42;&#x7684;&#x54CD;&#x5E94;</strong>&#x5BFC;&#x81F4;&#x7684;&#xFF0C;&#x5E76;&#x4E14;&#x4E24;&#x4E2A;&#x670D;&#x52A1;&#x4E4B;&#x95F4;&#x7684;&#x6D41;&#x7A0B;&#x88AB;Envoy&#x7ED9;&#x4EE3;&#x7406;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x4EA7;&#x751F;&#x4E86;&#x8BE5;&#x95EE;&#x9898;&#x3002;<br>&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x6709;&#x4E24;&#x4E2A;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#xFF1A;</p>
<ol>
<li>&#x5728;&#x6267;&#x884C;&#x5668;&#x7AEF;&#x589E;&#x52A0;&#x5FC3;&#x8DF3;&#x8BF7;&#x6C42;&#x54CD;&#x5E94;</li>
<li>&#x8C03;&#x5EA6;&#x4E2D;&#x5FC3;&#x548C;&#x6267;&#x884C;&#x5668;&#x4E4B;&#x95F4;&#x7684;&#x6D41;&#x91CF;&#x4E0D;&#x518D;&#x7ECF;&#x8FC7;Envoy&#x4EE3;&#x7406;</li>
</ol>
<p>&#x7531;&#x4E8E;<code>xxl-job</code>&#x5728;&#x8BE5;&#x7248;&#x672C;&#x4E0B;&#x7684;<code>xxl-rpc</code>&#x5DF2;&#x7ECF;&#x4E24;&#x5E74;&#x6CA1;&#x6709;&#x66F4;&#x65B0;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x53EA;&#x80FD;&#x770B;&#x770B;&#x600E;&#x4E48;&#x5C06;&#x4E24;&#x4E2A;&#x670D;&#x52A1;&#x4E4B;&#x95F4;&#x7684;&#x6D41;&#x91CF;&#x4E0D;&#x8D70;Envoy&#x4EE3;&#x7406;&#x3002;<br>&#x6B64;&#x65F6;Istio&#x670D;&#x52A1;&#x6CBB;&#x7406;&#x4E2D;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x89D2;&#x8272;<code>Sidecar</code>&#x51FA;&#x73B0;&#x4E86;&#x3002;</p>
<h2 id="Sidecar"><a href="#Sidecar" class="headerlink" title="Sidecar"></a>Sidecar</h2><blockquote>
<p>Sidecar&#x7684;&#x4F5C;&#x7528;&#xFF1A;<br>&#x53EF;&#x4EE5;&#x62E6;&#x622A;Pod&#x4E2D;&#x7684;&#x6240;&#x6709;&#x5165;&#x53E3;&#x548C;&#x51FA;&#x53E3;&#x6D41;&#x91CF;&#xFF0C;&#x7136;&#x540E;&#x6839;&#x636E;Istio&#x7684;&#x8DEF;&#x7531;&#x89C4;&#x5219;&#x5C06;&#x6D41;&#x91CF;&#x8DEF;&#x7531;&#x5230;&#x6B63;&#x786E;&#x7684;&#x670D;&#x52A1;&#x3002;</p>
</blockquote>
<p>&#x5728;k8s&#x4E2D;&#x7684;<code>Istio</code>&#x521B;&#x5EFA;&#x4E00;&#x4E2A;<code>Sidecar</code>&#xFF0C;&#x8BBE;&#x7F6E;&#x8C03;&#x7528;&#x6267;&#x884C;&#x5668;xxl-job&#x7684;http&#x7AEF;&#x53E3;&#x7684;&#x6D41;&#x91CF;&#x4E0D;&#x7ECF;&#x8FC7;&#x4EFB;&#x4F55;<code>Istio</code>&#x529F;&#x80FD;&#x3002;<br>&#x4F8B;&#x5B50;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">yaml&#x590D;&#x5236;&#x4EE3;&#x7801;apiVersion: networking.istio.io/v1beta1</span><br><span class="line">kind: Sidecar</span><br><span class="line">metadata:</span><br><span class="line">  name: direct-xxl-job-my-app</span><br><span class="line">  namespace: ebc-bpm</span><br><span class="line">spec:</span><br><span class="line">  # &#x5165;&#x53E3;&#x6D41;&#x91CF;&#x8BBE;&#x7F6E;</span><br><span class="line">  ingress:</span><br><span class="line">  # &#x76F4;&#x63A5;&#x8F6C;&#x53D1;&#x5230;Pod&#x5BB9;&#x5668;&#x7684;7679&#x63A5;&#x53E3;</span><br><span class="line">  - defaultEndpoint: 127.0.0.1:7679</span><br><span class="line">    port:</span><br><span class="line">      name: direct-access-port</span><br><span class="line">      number: 7679</span><br><span class="line">      protocol: TCP</span><br><span class="line">  # &#x5BF9;&#x5E94;&#x7684;&#x5DE5;&#x4F5C;&#x8D1F;&#x8F7D;</span><br><span class="line">  workloadSelector:</span><br><span class="line">    labels:</span><br><span class="line">      app: my-app</span><br></pre></td></tr></table></figure>

<p>&#x4E0A;&#x9762;&#x7684;&#x8FD9;&#x4E2A;Sidecar&#x914D;&#x7F6E;&#x7684;&#x4F5C;&#x7528;&#x5C31;&#x662F;&#x5C06;&#x5E26;&#x6709;&#x6807;&#x7B7E;<code>app=my-app</code>&#x5E94;&#x7528;&#x7684;<strong>7679&#x7AEF;&#x53E3;TCP&#x5165;&#x53E3;&#x6D41;&#x91CF;</strong>&#x91CD;&#x5B9A;&#x5411;&#x5230;Pod&#x4E2D;&#x7684;<strong>7679&#x7AEF;&#x53E3;</strong>&#xFF0C;&#x4E0D;&#x518D;&#x7ECF;&#x8FC7;<code>Envoy</code>&#x7684;&#x4EE3;&#x7406;&#x3002;<br>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;K8S&#x73AF;&#x5883;&#x4E2D;&#xFF0C;&#x914D;&#x7F6E;Sidecar&#x6765;&#x63A7;&#x5236;&#x6D41;&#x91CF;&#x662F;&#x5426;&#x88AB;Enovy&#x4EE3;&#x7406;&#xFF0C;&#x5C31;&#x80FD;&#x6709;&#x6548;&#x7684;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x4E86;&#x3002;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/192792911a11f4c8d4d1c7133811ade1.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7339416321908457481.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7339416321908457481.html" itemprop="url">Rust Web 框架入门和对比 最适合使用的 Rust W</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-02-26T10:50:45+08:00">
                2024-02-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/2d0f81a938c7e92358157d61e064f93f5284a29870998d3f4c5f81e5d1fb031b" alt="&#x5728;&#x8FD9;&#x91CC;&#x63D2;&#x5165;&#x56FE;&#x7247;&#x63CF;&#x8FF0;"></p>
<h1 id="&#x6700;&#x9002;&#x5408;&#x4F7F;&#x7528;&#x7684;-Rust-Web-&#x6846;&#x67B6;"><a href="#&#x6700;&#x9002;&#x5408;&#x4F7F;&#x7528;&#x7684;-Rust-Web-&#x6846;&#x67B6;" class="headerlink" title="&#x6700;&#x9002;&#x5408;&#x4F7F;&#x7528;&#x7684; Rust Web &#x6846;&#x67B6;"></a>&#x6700;&#x9002;&#x5408;&#x4F7F;&#x7528;&#x7684; Rust Web &#x6846;&#x67B6;</h1><p>&#x5728; Web &#x5F00;&#x53D1;&#x7684;&#x53D8;&#x5316;&#x7684;&#x6D6A;&#x6F6E;&#x4E2D;&#xFF0C;Rust &#x5DF2;&#x6210;&#x4E3A;&#x6784;&#x5EFA;&#x5B89;&#x5168;&#x548C;&#x9AD8;&#x6027;&#x80FD;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x9996;&#x9009;&#x8BED;&#x8A00;&#x3002;&#x968F;&#x7740; Rust &#x7684;&#x6D41;&#x884C;&#xFF0C;&#x4E00;&#x7CFB;&#x5217;&#x65E8;&#x5728;&#x5229;&#x7528;&#x5176;&#x4F18;&#x52BF;&#x7684; Web &#x6846;&#x67B6;&#x4E5F;&#x5728;&#x4E0D;&#x65AD;&#x51FA;&#x73B0;&#x3002;&#x672C;&#x6587;&#x6BD4;&#x8F83;&#x4E86;&#x4E00;&#x4E9B;&#x6700;&#x597D;&#x7684; Rust &#x6846;&#x67B6;&#xFF0C;&#x91CD;&#x70B9;&#x4ECB;&#x7ECD;&#x4E86;&#x5B83;&#x4EEC;&#x5404;&#x81EA;&#x7684;&#x4F18;&#x70B9;&#x548C;&#x7F3A;&#x70B9;&#xFF0C;&#x4EE5;&#x5E2E;&#x52A9;&#x60A8;&#x4E3A;&#x9879;&#x76EE;&#x505A;&#x51FA;&#x660E;&#x667A;&#x7684;&#x51B3;&#x7B56;&#x3002;&#x5B83;&#x8FD8;&#x9700;&#x8981;&#x7559;&#x5FC3;&#x9700;&#x8981;&#x5173;&#x6CE8;&#x7684;&#x6846;&#x67B6;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x53EF;&#x80FD;&#x4F1A;&#x6539;&#x53D8;&#x6211;&#x4EEC;&#x5728; Rust &#x4E2D;&#x6784;&#x5EFA; Web &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x65B9;&#x5F0F;&#x3002;</p>
<p>&#x7531;&#x4E8E;&#x5927;&#x591A;&#x6570; Web &#x6846;&#x67B6;&#x4E4D;&#x4E00;&#x770B;&#x5728;&#x4F7F;&#x7528;&#x4E0A;&#x975E;&#x5E38;&#x76F8;&#x4F3C;&#xFF0C;&#x4F46;&#x5B9E;&#x9645;&#x5DEE;&#x5F02;&#x66F4;&#x52A0;&#x7EC6;&#x5FAE;&#x548C;&#x7410;&#x788E;&#x3002;&#x6211;&#x5E0C;&#x671B;&#x5F3A;&#x8C03;&#x6587;&#x672C;&#x4E2D;&#x6700;&#x91CD;&#x8981;&#x7684;&#x5DEE;&#x5F02;&#xFF0C;&#x4F46;&#x4E3A;&#x4E86;&#x8BA9;&#x60A8;&#x6709;&#x66F4;&#x597D;&#x7684;&#x60F3;&#x6CD5;&#xFF0C;&#x6211;&#x8FD8;&#x5C55;&#x793A;&#x4E86;&#x6BCF;&#x4E2A;&#x6846;&#x67B6;&#x7684;&#x793A;&#x4F8B;&#x4EE3;&#x7801;&#xFF0C;&#x8FD9;&#x4E9B;&#x6846;&#x67B6;&#x7684;&#x4F5C;&#x7528;&#x4E0D;&#x4EC5;&#x4EC5;&#x662F;&#x7B80;&#x5355;&#x7684; hello world&#x3002;&#x6240;&#x6709;&#x793A;&#x4F8B;&#x5747;&#x53D6;&#x81EA;&#x5404;&#x81EA;&#x7684; GitHub &#x5B58;&#x50A8;&#x5E93;&#x3002;</p>
<p>&#x53E6;&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x8FD9;&#x4E2A;&#x5217;&#x8868;&#x7EDD;&#x4E0D;&#x662F;&#x8BE6;&#x5C3D;&#x7684;&#xFF0C;&#x6211;&#x80AF;&#x5B9A;&#x9519;&#x8FC7;&#x4E86;&#x4E00;&#x4E9B;&#x73B0;&#x6709;&#x7684;&#x6846;&#x67B6;&#x3002;&#x5982;&#x679C;&#x60A8;&#x60F3;&#x5305;&#x542B;&#x60A8;&#x6700;&#x559C;&#x6B22;&#x7684;&#x6846;&#x67B6;&#xFF0C;&#x8BF7;&#x5728; Twitter &#x6216; Mastodon &#x4E0A;&#x4E0E;&#x6211;&#x8054;&#x7CFB;&#x3002;</p>
<h2 id="&#x6D41;&#x884C;&#x7684;-Rust-&#x6846;&#x67B6;"><a href="#&#x6D41;&#x884C;&#x7684;-Rust-&#x6846;&#x67B6;" class="headerlink" title="&#x6D41;&#x884C;&#x7684; Rust &#x6846;&#x67B6;"></a>&#x6D41;&#x884C;&#x7684; Rust &#x6846;&#x67B6;</h2><h3 id="Axum"><a href="#Axum" class="headerlink" title="Axum"></a>Axum</h3><p>Axum &#x662F;&#x4E00;&#x4E2A;&#x5728; Rust &#x751F;&#x6001;&#x7CFB;&#x7EDF;&#x4E2D;&#x5177;&#x6709;&#x7279;&#x6B8A;&#x5730;&#x4F4D;&#x7684; Web &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6846;&#x67B6;&#x3002;&#x5B83;&#x662F; Tokio &#x9879;&#x76EE;&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x8BE5;&#x9879;&#x76EE;&#x662F;&#x4F7F;&#x7528; Rust &#x7F16;&#x5199;&#x5F02;&#x6B65;&#x7F51;&#x7EDC;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x8FD0;&#x884C;&#x65F6;&#x3002; Axum &#x4E0D;&#x4EC5;&#x4F7F;&#x7528; Tokio &#x4F5C;&#x4E3A;&#x5176;&#x5F02;&#x6B65;&#x8FD0;&#x884C;&#x65F6;&#xFF0C;&#x800C;&#x4E14;&#x8FD8;&#x4E0E; Tokio &#x751F;&#x6001;&#x7CFB;&#x7EDF;&#x4E2D;&#x7684;&#x5176;&#x4ED6;&#x5E93;&#x96C6;&#x6210;&#xFF0C;&#x5229;&#x7528; Hyper &#x4F5C;&#x4E3A;&#x5176; HTTP &#x670D;&#x52A1;&#x5668;&#xFF0C;&#x5E76;&#x4F7F;&#x7528; Tower &#x4F5C;&#x4E3A;&#x4E2D;&#x95F4;&#x4EF6;&#x3002;&#x8FD9;&#x6837;&#xFF0C;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x5C31;&#x80FD;&#x591F;&#x91CD;&#x7528; Tokio &#x751F;&#x6001;&#x7CFB;&#x7EDF;&#x4E2D;&#x7684;&#x73B0;&#x6709;&#x5E93;&#x548C;&#x5DE5;&#x5177;&#x3002;</p>
<p>Axum &#x8FD8;&#x81F4;&#x529B;&#x4E8E;&#x5728;&#x4E0D;&#x4F9D;&#x8D56;&#x5B8F;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x63D0;&#x4F9B;&#x4E00;&#x6D41;&#x7684;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x4F53;&#x9A8C;&#xFF0C;&#x800C;&#x662F;&#x5229;&#x7528; Rust &#x7684;&#x7C7B;&#x578B;&#x7CFB;&#x7EDF;&#x6765;&#x63D0;&#x4F9B;&#x5B89;&#x5168;&#x4E14;&#x7B26;&#x5408;&#x4EBA;&#x4F53;&#x5DE5;&#x7A0B;&#x5B66;&#x7684; API&#x3002;&#x8FD9;&#x662F;&#x901A;&#x8FC7;&#x4F7F;&#x7528;&#x7279;&#x5F81;&#x6765;&#x5B9A;&#x4E49;&#x6846;&#x67B6;&#x7684;&#x6838;&#x5FC3;&#x62BD;&#x8C61;&#x6765;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x4F8B;&#x5982; <code>Handler</code> &#x7279;&#x5F81;&#xFF0C;&#x5B83;&#x7528;&#x4E8E;&#x5B9A;&#x4E49;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x6838;&#x5FC3;&#x903B;&#x8F91;&#x3002;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x5141;&#x8BB8;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x8F7B;&#x677E;&#x5730;&#x4ECE;&#x8F83;&#x5C0F;&#x7684;&#x7EC4;&#x4EF6;&#x7EC4;&#x200B;&#x200B;&#x6210;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x8FD9;&#x4E9B;&#x7EC4;&#x4EF6;&#x53EF;&#x4EE5;&#x5728;&#x591A;&#x4E2A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#x91CD;&#x590D;&#x4F7F;&#x7528;&#x3002;</p>
<p>Axum &#x4E2D;&#x7684;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x662F;&#x4E00;&#x4E2A;&#x63A5;&#x53D7;&#x8BF7;&#x6C42;&#x5E76;&#x8FD4;&#x56DE;&#x54CD;&#x5E94;&#x7684;&#x51FD;&#x6570;&#x3002;&#x8FD9;&#x4E0E;&#x5176;&#x4ED6;&#x540E;&#x7AEF;&#x6846;&#x67B6;&#x7C7B;&#x4F3C;&#xFF0C;&#x4F46;&#x5229;&#x7528; Axum &#x7684; <code>FromRequest</code> trait&#xFF0C;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x5E94;&#x4ECE;&#x8BF7;&#x6C42;&#x4E2D;&#x63D0;&#x53D6;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x3002;&#x8FD4;&#x56DE;&#x7C7B;&#x578B;&#x9700;&#x8981;&#x5B9E;&#x73B0; <code>IntoResponse</code> trait&#xFF0C;&#x5E76;&#x4E14;&#x5DF2;&#x7ECF;&#x6709;&#x8BB8;&#x591A;&#x7C7B;&#x578B;&#x5B9E;&#x73B0;&#x4E86;&#x6B64;trait&#xFF0C;&#x5305;&#x62EC;&#x5141;&#x8BB8;&#x8F7B;&#x677E;&#x66F4;&#x6539;&#x7684;&#x5143;&#x7EC4;&#x7C7B;&#x578B;&#xFF0C;&#x4F8B;&#x5982;&#x54CD;&#x5E94;&#x7684;&#x72B6;&#x6001;&#x4EE3;&#x7801;&#x3002;</p>
<p>&#x5982;&#x679C;&#x60A8;&#x66FE;&#x7ECF;&#x4F7F;&#x7528;&#x8FC7; Rust &#x7684;&#x7C7B;&#x578B;&#x7CFB;&#x7EDF;&#x3001;&#x6CDB;&#x578B;&#xFF0C;&#x5C24;&#x5176;&#x662F;trait&#x4E2D;&#x7684;&#x5F02;&#x6B65;&#x65B9;&#x6CD5;&#xFF08;&#x6216;&#x66F4;&#x5177;&#x4F53;&#x5730;&#x8BF4;&#xFF1A;&#x8FD4;&#x56DE;&#x7684; <code>Future</code> &#xFF09;&#xFF0C;&#x60A8;&#x5C31;&#x4F1A;&#x77E5;&#x9053;&#x5F53;&#x60A8;&#x4E0D;&#x6EE1;&#x8DB3; trait &#x7EA6;&#x675F;(bound) &#x65F6;&#xFF0C;Rust &#x7684;&#x9519;&#x8BEF;&#x6D88;&#x606F;&#x4F1A;&#x53D8;&#x5F97;&#x591A;&#x4E48;&#x590D;&#x6742;&#x3002;&#x5C24;&#x5176;&#x662F;&#x5F53;&#x60A8;&#x5C1D;&#x8BD5;&#x9002;&#x914D; &#x62BD;&#x8C61; trait &#x7EA6;&#x675F;(bound)&#x65F6;&#xFF0C;&#x7ECF;&#x5E38;&#x4F1A;&#x53D1;&#x751F;&#x8FD9;&#x6837;&#x7684;&#x60C5;&#x51B5;&#xFF1A;&#x60A8;&#x4F1A;&#x770B;&#x5230;&#x4E00;&#x5835;&#x96BE;&#x4EE5;&#x7834;&#x8BD1;&#x7684;&#x6587;&#x672C;&#x5899;&#x3002;&#x6539;&#x53D8;&#x51E0;&#x884C;&#x7684;&#x987A;&#x5E8F;&#xFF0C;&#x5C31;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x4F5C;&#x7528;&#x4E86;&#xFF01; Axum &#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x5E26;&#x6709;&#x8F85;&#x52A9;&#x5B8F;&#x7684;&#x5E93;&#xFF0C;&#x53EF;&#x4EE5;&#x5C06;&#x9519;&#x8BEF;&#x5B9A;&#x4F4D;&#x5230;&#x5B9E;&#x9645;&#x53D1;&#x751F;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x4ECE;&#x800C;&#x66F4;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#x51FA;&#x4E86;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#x3002;</p>
<p>Axum &#x505A;&#x4E86;&#x5F88;&#x591A;&#x6B63;&#x786E;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x5E76;&#x4E14;&#x5F88;&#x5BB9;&#x6613;&#x542F;&#x52A8;&#x6267;&#x884C;&#x5927;&#x91CF;&#x64CD;&#x4F5C;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x60A8;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x4E00;&#x4E9B;&#x4E8B;&#x9879;&#x3002;&#x8BE5;&#x7248;&#x672C;&#x4ECD;&#x4F4E;&#x4E8E; 1.0&#xFF0C;Axum &#x56E2;&#x961F;&#x53EF;&#x4EE5;&#x4ECE;&#x6839;&#x672C;&#x4E0A;&#x66F4;&#x6539;&#x7248;&#x672C;&#x4E4B;&#x95F4;&#x7684; API&#xFF0C;&#x8FD9;&#x53EF;&#x80FD;&#x4F1A;&#x5BFC;&#x81F4;&#x60A8;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5D29;&#x6E83;&#x3002;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#xFF0C;&#x8FD9;&#x5C31;&#x662F; 0.x &#x7248;&#x672C;&#x7684;&#x5904;&#x7406;&#x65B9;&#x5F0F;&#xFF0C;&#x4F46;&#x6709;&#x4E9B;&#x66F4;&#x6539;&#x4F3C;&#x4E4E;&#x975E;&#x5E38;&#x5FAE;&#x5999;&#xFF0C;&#x4F46;&#x9700;&#x8981;&#x60A8;&#x5F00;&#x53D1;&#x4E00;&#x79CD;&#x4E0D;&#x540C;&#x7684;&#x601D;&#x7EF4;&#x6A21;&#x578B;&#x6765;&#x4E86;&#x89E3;&#x5E95;&#x5C42;&#x7684;&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x3002;&#x5982;&#x679C;&#x60A8;&#x5305;&#x542B;&#x4E00;&#x4E2A; <code>Timeout</code> &#x5C42;&#xFF08;&#x5185;&#x7F6E;&#x5728; Tower &#x4E2D;&#xFF09;&#xFF0C;&#x5B83;&#x5728;&#x4E00;&#x4E2A;&#x7248;&#x672C;&#x4E2D;&#x53EF;&#x4EE5;&#x8F7B;&#x677E;&#x5DE5;&#x4F5C;&#xFF0C;&#x5728;&#x53E6;&#x4E00;&#x4E2A;&#x7248;&#x672C;&#x4E2D;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x6355;&#x83B7;&#x6240;&#x6709;&#x9519;&#x8BEF;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#xFF0C;&#x5728;&#x4E0B;&#x4E00;&#x4E2A;&#x7248;&#x672C;&#x4E2D;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x7ED1;&#x5B9A;&#x9519;&#x8BEF;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x3002;&#x8FD9;&#x4E0D;&#x662F;&#x4EC0;&#x4E48;&#x5927;&#x95EE;&#x9898;&#xFF0C;&#x4F46;&#x5F53;&#x60A8;&#x5C1D;&#x8BD5;&#x5B8C;&#x6210;&#x5DE5;&#x4F5C;&#x6216;&#x4F7F;&#x7528;&#x6700;&#x65B0;&#x7248;&#x672C;&#x542F;&#x52A8;&#x9879;&#x76EE;&#x5E76;&#x4E14;&#x4E8B;&#x60C5;&#x7A81;&#x7136;&#x53D1;&#x751F;&#x53D8;&#x5316;&#x65F6;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x4EE4;&#x4EBA;&#x6CAE;&#x4E27;&#x3002;&#x6B64;&#x5916;&#xFF0C;&#x867D;&#x7136;&#x60A8;&#x80FD;&#x591F;&#x5229;&#x7528;&#x6574;&#x4E2A; Tokio &#x751F;&#x6001;&#x7CFB;&#x7EDF;&#xFF0C;&#x4F46;&#x6709;&#x65F6;&#x60A8;&#x9700;&#x8981;&#x5904;&#x7406;&#x7C98;&#x5408;&#x7C7B;&#x578B;&#x548C;&#x7279;&#x5F81;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x76F4;&#x63A5;&#x4F7F;&#x7528; Tokio &#x51FD;&#x6570;&#x3002;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#x662F;&#x4F7F;&#x7528;&#x4EFB;&#x4F55;&#x4E0E;&#x6D41;&#x548C;&#xFF08;&#x7F51;&#x7EDC;&#xFF09;&#x5957;&#x63A5;&#x5B57;&#x76F8;&#x5173;&#x7684;&#x5185;&#x5BB9;&#x3002;</p>
<p>&#x597D;&#x7684;&#x4F8B;&#x5B50;&#x4F1A;&#x6709;&#x6240;&#x5E2E;&#x52A9;&#xFF0C;&#x4F46;&#x60A8;&#x9700;&#x8981;&#x6301;&#x7EED;&#x8DDF;&#x8E2A;&#x3002;</p>
<p>&#x5C3D;&#x7BA1;&#x5982;&#x6B64;&#xFF0C;Axum &#x662F;&#x6211;&#x4E2A;&#x4EBA;&#x6700;&#x559C;&#x6B22;&#x7684;&#xFF0C;&#x4E5F;&#x662F;&#x6211;&#x7528;&#x4E8E; Shuttle Launchpad &#x7684;&#x6846;&#x67B6;&#x3002;&#x6211;&#x559C;&#x6B22;&#x5B83;&#x7684;&#x8868;&#x73B0;&#x529B;&#x548C;&#x80CC;&#x540E;&#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x901A;&#x8FC7;&#x7406;&#x89E3;&#x6B63;&#x786E;&#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x6211;&#x60F3;&#x89E3;&#x51B3;&#x7684;&#x95EE;&#x9898;&#x90FD;&#x662F;&#x6211;&#x65E0;&#x6CD5;&#x51ED;&#x76F4;&#x89C9;&#x5B8C;&#x6210;&#x7684;&#x3002;&#x5982;&#x679C;&#x60A8;&#x60F3;&#x4E86;&#x89E3; Axum &#x6982;&#x5FF5;&#xFF0C;&#x8BF7;&#x67E5;&#x770B;&#x6211;&#x7684; Tokio + &#x5FAE;&#x670D;&#x52A1;&#x7814;&#x8BA8;&#x4F1A;&#x4E0A;&#x7684;&#x5E7B;&#x706F;&#x7247;&#x3002;</p>
<h4 id="Axum-Example"><a href="#Axum-Example" class="headerlink" title="Axum Example"></a>Axum Example</h4><p>Axum &#x4ED3;&#x5E93;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x7B80;&#x77ED;&#x793A;&#x4F8B;&#x663E;&#x793A;&#x4E86;&#x4E00;&#x4E2A; WebSocket &#x5904;&#x7406;&#x7A0B;&#x5E8F;&#xFF0C;&#x8BE5;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x4F1A;&#x56DE;&#x663E;&#x5B83;&#x6536;&#x5230;&#x7684;&#x4EFB;&#x4F55;&#x6D88;&#x606F;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">rust&#x590D;&#x5236;&#x4EE3;&#x7801;#[tokio::main]</span><br><span class="line">async fn main() {</span><br><span class="line">    let listener = tokio::net::TcpListener::bind(&quot;127.0.0.1:3000&quot;)</span><br><span class="line">        .await</span><br><span class="line">        .unwrap();</span><br><span class="line">    println!(&quot;listening on {}&quot;, listener.local_addr().unwrap());</span><br><span class="line">    axum::serve(listener, app()).await.unwrap();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">fn app() -&gt; Router {</span><br><span class="line">    // WebSocket routes can generally be tested in two ways:</span><br><span class="line">    //</span><br><span class="line">    // - Integration tests where you run the server and connect with a real WebSocket client.</span><br><span class="line">    // - Unit tests where you mock the socket as some generic send/receive type</span><br><span class="line">    //</span><br><span class="line">    // Which version you pick is up to you. Generally we recommend the integration test version</span><br><span class="line">    // unless your app has a lot of setup that makes it hard to run in a test.</span><br><span class="line">    Router::new()</span><br><span class="line">        .route(&quot;/integration-testable&quot;, get(integration_testable_handler))</span><br><span class="line">        .route(&quot;/unit-testable&quot;, get(unit_testable_handler))</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// A WebSocket handler that echos any message it receives.</span><br><span class="line">//</span><br><span class="line">// This one we&apos;ll be integration testing so it can be written in the regular way.</span><br><span class="line">async fn integration_testable_handler(ws: WebSocketUpgrade) -&gt; Response {</span><br><span class="line">    ws.on_upgrade(integration_testable_handle_socket)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">async fn integration_testable_handle_socket(mut socket: WebSocket) {</span><br><span class="line">    while let Some(Ok(msg)) = socket.recv().await {</span><br><span class="line">        if let Message::Text(msg) = msg {</span><br><span class="line">            if socket</span><br><span class="line">                .send(Message::Text(format!(&quot;You said: {msg}&quot;)))</span><br><span class="line">                .await</span><br><span class="line">                .is_err()</span><br><span class="line">            {</span><br><span class="line">                break;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="Axum&#x603B;&#x7ED3;"><a href="#Axum&#x603B;&#x7ED3;" class="headerlink" title="Axum&#x603B;&#x7ED3;"></a>Axum&#x603B;&#x7ED3;</h4><ul>
<li>Macro-free API.</li>
<li>&#x5229;&#x7528; Tokio&#x3001;Tower &#x548C; Hyper &#x5EFA;&#x7ACB;&#x5F3A;&#x5927;&#x7684;&#x751F;&#x6001;&#x7CFB;&#x7EDF;&#x3002;</li>
<li>&#x5F88;&#x68D2;&#x7684;&#x5F00;&#x53D1;&#x8005;&#x7ECF;&#x9A8C;&#x3002;</li>
<li>&#x4ECD;&#x5904;&#x4E8E; 0.x &#x7248;&#x672C;&#xFF0C;&#x56E0;&#x6B64;&#x53EF;&#x80FD;&#x4F1A;&#x53D1;&#x751F;&#x91CD;&#x5927;&#x66F4;&#x6539;&#x3002;</li>
</ul>
<h3 id="Actix-Web-Actix"><a href="#Actix-Web-Actix" class="headerlink" title="Actix Web Actix"></a>Actix Web Actix</h3><p>Actix Web &#x662F; Rust &#x7684; Web &#x6846;&#x67B6;&#x4E4B;&#x4E00;&#xFF0C;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x4E86;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#xFF0C;&#x56E0;&#x6B64;&#x975E;&#x5E38;&#x53D7;&#x6B22;&#x8FCE;&#x3002;&#x4E0E;&#x4EFB;&#x4F55;&#x4F18;&#x79C0;&#x7684;&#x5F00;&#x6E90;&#x9879;&#x76EE;&#x4E00;&#x6837;&#xFF0C;&#x5B83;&#x7ECF;&#x5386;&#x4E86;&#x591A;&#x6B21;&#x8FED;&#x4EE3;&#xFF0C;&#x4F46;&#x5B83;&#x5DF2;&#x7ECF;&#x8FBE;&#x5230;&#x4E86; 0 &#x4EE5;&#x4E0A;&#x7684;&#x4E3B;&#x8981;&#x7248;&#x672C;&#xFF0C;&#x5E76;&#x4FDD;&#x6301;&#x4E86;&#x7A33;&#x5B9A;&#x6027;&#x4FDD;&#x8BC1;&#xFF1A;&#x5728;&#x4E3B;&#x8981;&#x7248;&#x672C;&#x5185;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x786E;&#x4FDD;&#x6CA1;&#x6709;&#x91CD;&#x5927;&#x66F4;&#x6539;&#x3002;</p>
<p>&#x5F53;&#x6211;&#x4EEC;&#x8C08;&#x8BBA; Actix Web &#x65F6;&#xFF0C;&#x5F88;&#x5BB9;&#x6613;&#x5047;&#x8BBE;&#x5B83;&#x662F;&#x57FA;&#x4E8E; <code>actix</code> actor &#x8FD0;&#x884C;&#x65F6;&#x7684;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x5DF2;&#x7ECF;&#x6709; 4 &#x5E74;&#x591A;&#x6CA1;&#x6709;&#x53D1;&#x751F;&#x4E86;&#xFF1B; Actix Web &#x4E2D;&#x552F;&#x4E00;&#x9700;&#x8981; actor &#x7684;&#x5269;&#x4F59;&#x90E8;&#x5206;&#x662F; WebSocket&#xFF0C;&#x4F46;&#x6211;&#x4EEC;&#x6B63;&#x5728;&#x52AA;&#x529B;&#x5B8C;&#x5168;&#x5220;&#x9664;&#x5176;&#x4F7F;&#x7528;&#xFF0C;&#x56E0;&#x4E3A; <code>actix</code> <strong>&#x65E0;&#x6CD5;&#x4E0E;&#x73B0;&#x4EE3;&#x5F02;&#x6B65; Rust</strong> &#x4E16;&#x754C;&#x5F88;&#x597D;&#x5730;&#x914D;&#x5408;&#x3002;&#x66F4;&#x5E7F;&#x6CDB;&#x7684; Actix &#x9879;&#x76EE;&#x548C; GitHub org &#x63D0;&#x4F9B;&#x4E86;&#x8BB8;&#x591A;&#x7528;&#x4E8E;&#x6784;&#x5EFA;&#x5E76;&#x53D1;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x5E93;&#xFF0C;&#x4ECE;&#x8F83;&#x4F4E;&#x7EA7;&#x522B;&#x7684; TCP &#x670D;&#x52A1;&#x5668;&#x6784;&#x5EFA;&#x5668;&#xFF0C;&#x5230; HTTP / Web &#x5C42;&#xFF0C;&#x4E00;&#x76F4;&#x5230;&#x9759;&#x6001;&#x6587;&#x4EF6;&#x63D0;&#x4F9B;&#x7A0B;&#x5E8F;&#x548C;&#x4F1A;&#x8BDD;&#x7BA1;&#x7406;crate&#x3002;</p>
<p>&#x4E4D;&#x4E00;&#x770B;&#xFF0C;Actix Web &#x770B;&#x8D77;&#x6765;&#x4E0E; Rust &#x4E2D;&#x7684;&#x5176;&#x4ED6; Web &#x6846;&#x67B6;&#x975E;&#x5E38;&#x719F;&#x6089;&#x3002;&#x60A8;&#x4F7F;&#x7528;&#x5B8F;&#x6765;&#x5B9A;&#x4E49; HTTP &#x65B9;&#x6CD5;&#x548C;&#x8DEF;&#x7531;&#xFF08;&#x5982; Rocket&#xFF09;&#xFF0C;&#x5E76;&#x4F7F;&#x7528;&#x63D0;&#x53D6;&#x5668;&#x4ECE;&#x8BF7;&#x6C42;&#x4E2D;&#x83B7;&#x53D6;&#x6570;&#x636E;&#xFF08;&#x5982; Axum&#xFF09;&#x3002;&#x4E0E; Axum &#x7684;&#x76F8;&#x4F3C;&#x4E4B;&#x5904;&#x662F;&#x60CA;&#x4EBA;&#x7684;&#xFF0C;&#x5728;&#x6982;&#x5FF5;&#x548C;&#x7279;&#x5F81;&#x7684;&#x547D;&#x540D;&#x65B9;&#x5F0F;&#x4E0A;&#x4E5F;&#x662F;&#x5982;&#x6B64;&#x3002;&#x6700;&#x5927;&#x7684;&#x533A;&#x522B;&#x662F; Actix Web &#x5E76;&#x6CA1;&#x6709;&#x5C06;&#x81EA;&#x5DF1;&#x4E0E; Tokio &#x751F;&#x6001;&#x7CFB;&#x7EDF;&#x8054;&#x7CFB;&#x5F97;&#x592A;&#x7D27;&#x5BC6;&#x3002;&#x867D;&#x7136; Tokio &#x4ECD;&#x7136;&#x662F; Actix Web &#x4E0B;&#x7684;&#x8FD0;&#x884C;&#x65F6;&#xFF0C;&#x4F46;&#x8BE5;&#x6846;&#x67B6;&#x5177;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x62BD;&#x8C61;&#x548C;&#x7279;&#x5F81;&#xFF0C;&#x4EE5;&#x53CA;&#x81EA;&#x5DF1;&#x7684;crate&#x751F;&#x6001;&#x7CFB;&#x7EDF;&#x3002;&#x8FD9;&#x6709;&#x4F18;&#x70B9;&#x4E5F;&#x6709;&#x7F3A;&#x70B9;&#x3002;&#x4E00;&#x65B9;&#x9762;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x786E;&#x5B9A;&#x4E8B;&#x7269;&#x901A;&#x5E38;&#x53EF;&#x4EE5;&#x5F88;&#x597D;&#x5730;&#x534F;&#x540C;&#x5DE5;&#x4F5C;&#xFF0C;&#x53E6;&#x4E00;&#x65B9;&#x9762;&#xFF0C;&#x60A8;&#x53EF;&#x80FD;&#x4F1A;&#x9519;&#x8FC7; Tokio &#x751F;&#x6001;&#x7CFB;&#x7EDF;&#x4E2D;&#x5DF2;&#x7ECF;&#x63D0;&#x4F9B;&#x7684;&#x8BB8;&#x591A;&#x4E8B;&#x7269;&#x3002;</p>
<p>&#x8BA9;&#x6211;&#x611F;&#x5230;&#x5947;&#x602A;&#x7684;&#x4E00;&#x4EF6;&#x4E8B;&#x662F; Actix Web &#x5B9E;&#x73B0;&#x4E86;&#x81EA;&#x5DF1;&#x7684; Service trait&#xFF0C;&#x5B83;&#x4E0E; Tower &#x7684;&#x57FA;&#x672C;&#x76F8;&#x540C;&#xFF0C;&#x4F46;&#x4ECD;&#x7136;&#x4E0D;&#x517C;&#x5BB9;&#x3002;&#x8FD9;&#x610F;&#x5473;&#x7740; Tower &#x751F;&#x6001;&#x7CFB;&#x7EDF;&#x4E2D;&#x7684;&#x5927;&#x591A;&#x6570;&#x53EF;&#x7528;&#x4E2D;&#x95F4;&#x4EF6;&#x4E0D;&#x9002;&#x7528;&#x4E8E; Actix&#x3002;</p>
<p>&#x540C;&#x6837;&#x6709;&#x8DA3;&#x7684;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x60A8;&#x9700;&#x8981;&#x5728; Actix Web &#x4E2D;&#x81EA;&#x884C;&#x5B9E;&#x73B0;&#x4E00;&#x4E9B;&#x7279;&#x6B8A;&#x4EFB;&#x52A1;&#xFF0C;&#x60A8;&#x53EF;&#x80FD;&#x4F1A;&#x9047;&#x5230;&#x8FD0;&#x884C;&#x6846;&#x67B6;&#x4E2D;&#x6240;&#x6709;&#x5185;&#x5BB9;&#x7684; Actor &#x6A21;&#x578B;&#x3002;&#x8FD9;&#x53EF;&#x80FD;&#x4F1A;&#x589E;&#x52A0;&#x4E00;&#x4E9B;&#x60A8;&#x53EF;&#x80FD;&#x4E0D;&#x60F3;&#x5904;&#x7406;&#x7684;&#x590D;&#x6742;&#x6027;&#x3002;</p>
<p>&#x4F46; Actix Web &#x5468;&#x56F4;&#x7684;&#x793E;&#x533A;&#x63D0;&#x4F9B;&#x4E86;&#x8FD9;&#x4E00;&#x70B9;&#x3002;&#x8BE5;&#x6846;&#x67B6;&#x652F;&#x6301; HTTP/2 &#x548C; Websocket &#x5347;&#x7EA7;&#xFF0C;&#x5B83;&#x5177;&#x6709; Web &#x6846;&#x67B6;&#x4E2D;&#x6700;&#x5E38;&#x89C1;&#x4EFB;&#x52A1;&#x7684;&#x5305;&#x548C;&#x6307;&#x5357;&#xFF0C;&#x4F18;&#x79C0;&#x7684;&#xFF08;&#x6211;&#x7684;&#x610F;&#x601D;&#x662F;&#x4F18;&#x79C0;&#x7684;&#xFF09;&#x6587;&#x6863;&#xFF0C;&#x800C;&#x4E14;&#x901F;&#x5EA6;&#x5F88;&#x5FEB;&#x3002; Actix Web &#x7684;&#x6D41;&#x884C;&#x662F;&#x6709;&#x539F;&#x56E0;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x60A8;&#x9700;&#x8981;&#x4FDD;&#x6301;&#x7248;&#x672C;&#x4FDD;&#x8BC1;&#xFF0C;&#x5B83;&#x53EF;&#x80FD;&#x662F;&#x60A8;&#x73B0;&#x5728;&#x7684;&#x6700;&#x4F73;&#x9009;&#x62E9;&#x3002;</p>
<h4 id="Actix-Web-Example"><a href="#Actix-Web-Example" class="headerlink" title="Actix Web Example"></a>Actix Web Example</h4><p>Actix Web &#x4E2D;&#x7684;&#x7B80;&#x5355; WebSocket &#x56DE;&#x663E;&#x670D;&#x52A1;&#x5668;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">rust&#x590D;&#x5236;&#x4EE3;&#x7801;use actix::{Actor, StreamHandler};</span><br><span class="line">use actix_web::{web, App, Error, HttpRequest, HttpResponse, HttpServer};</span><br><span class="line">use actix_web_actors::ws;</span><br><span class="line"></span><br><span class="line">/// Define HTTP actor</span><br><span class="line">struct MyWs;</span><br><span class="line"></span><br><span class="line">impl Actor for MyWs {</span><br><span class="line">    type Context = ws::WebsocketContext&lt;Self&gt;;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">/// Handler for ws::Message message</span><br><span class="line">impl StreamHandler&lt;Result&lt;ws::Message, ws::ProtocolError&gt;&gt; for MyWs {</span><br><span class="line">    fn handle(&amp;mut self, msg: Result&lt;ws::Message, ws::ProtocolError&gt;, ctx: &amp;mut Self::Context) {</span><br><span class="line">        match msg {</span><br><span class="line">            Ok(ws::Message::Ping(msg)) =&gt; ctx.pong(&amp;msg),</span><br><span class="line">            Ok(ws::Message::Text(text)) =&gt; ctx.text(text),</span><br><span class="line">            Ok(ws::Message::Binary(bin)) =&gt; ctx.binary(bin),</span><br><span class="line">            _ =&gt; (),</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">async fn index(req: HttpRequest, stream: web::Payload) -&gt; Result&lt;HttpResponse, Error&gt; {</span><br><span class="line">    let resp = ws::start(MyWs {}, &amp;req, stream);</span><br><span class="line">    println!(&quot;{:?}&quot;, resp);</span><br><span class="line">    resp</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">#[actix_web::main]</span><br><span class="line">async fn main() -&gt; std::io::Result&lt;()&gt; {</span><br><span class="line">    HttpServer::new(|| App::new().route(&quot;/ws/&quot;, web::get().to(index)))</span><br><span class="line">        .bind((&quot;127.0.0.1&quot;, 8080))?</span><br><span class="line">        .run()</span><br><span class="line">        .await</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="Actix-Web-&#x603B;&#x7ED3;"><a href="#Actix-Web-&#x603B;&#x7ED3;" class="headerlink" title="Actix Web &#x603B;&#x7ED3;"></a>Actix Web &#x603B;&#x7ED3;</h4><ul>
<li>&#x5F3A;&#x5927;&#x3001;&#x72EC;&#x7ACB;&#x7684;&#x751F;&#x6001;&#x7CFB;&#x7EDF;&#x3002;</li>
<li>Actor model based.</li>
<li>&#x901A;&#x8FC7;&#x4E3B;&#x8981;&#x7248;&#x672C;&#x4FDD;&#x8BC1;&#x5B9E;&#x73B0;&#x7A33;&#x5B9A;&#x7684; API&#x3002;</li>
<li>&#x5F88;&#x68D2;&#x7684;&#x6587;&#x6863;&#x3002;</li>
</ul>
<h3 id="Rocket"><a href="#Rocket" class="headerlink" title="Rocket"></a>Rocket</h3><p>Rocket &#x957F;&#x671F;&#x4EE5;&#x6765;&#x4E00;&#x76F4;&#x662F; Rust Web &#x6846;&#x67B6;&#x751F;&#x6001;&#x7CFB;&#x7EDF;&#x4E2D;&#x7684;&#x660E;&#x661F;&#xFF0C;&#x5B83;&#x5BF9;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x4F53;&#x9A8C;&#x7684;&#x6001;&#x5EA6;&#x6BEB;&#x65E0;&#x6B49;&#x610F;&#xFF0C;&#x5BF9;&#x719F;&#x6089;&#x7684;&#x73B0;&#x6709;&#x6982;&#x5FF5;&#x7684;&#x4F9D;&#x8D56;&#xFF0C;&#x4EE5;&#x53CA;&#x63D0;&#x4F9B;&#x5305;&#x542B;&#x4E30;&#x5BCC;&#x5185;&#x7F6E;&#x529F;&#x80FD;&#x7684;&#x4F53;&#x9A8C;&#x7684;&#x96C4;&#x5FC3;&#x52C3;&#x52C3;&#x7684;&#x76EE;&#x6807;&#x3002;</p>
<p>&#x5F53;&#x60A8;&#x8FDB;&#x5165;&#x4ED6;&#x4EEC;&#x6F02;&#x4EAE;&#x7684;&#x7F51;&#x7AD9;&#x65F6;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5B83;&#x7684;&#x91CE;&#x5FC3;&#xFF1A;&#x57FA;&#x4E8E;&#x5B8F;&#x7684;&#x8DEF;&#x7531;&#x3001;&#x5185;&#x7F6E;&#x8868;&#x5355;&#x5904;&#x7406;&#x3001;&#x5BF9;&#x6570;&#x636E;&#x5E93;&#x548C;&#x72B6;&#x6001;&#x7BA1;&#x7406;&#x7684;&#x652F;&#x6301;&#xFF0C;&#x4EE5;&#x53CA;&#x5B83;&#x81EA;&#x5DF1;&#x7684;&#x6A21;&#x677F;&#x7248;&#x672C;&#xFF01; Rocket &#x786E;&#x5B9E;&#x5C1D;&#x8BD5;&#x5B8C;&#x6210;&#x6784;&#x5EFA; Web &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6240;&#x9700;&#x7684;&#x4E00;&#x5207;&#x3002;</p>
<p>&#x7136;&#x800C;&#xFF0C;Rocket&#x7684;&#x91CE;&#x5FC3;&#x5374;&#x4ED8;&#x51FA;&#x4E86;&#x4EE3;&#x4EF7;&#x3002;&#x867D;&#x7136;&#x4ECD;&#x5728;&#x79EF;&#x6781;&#x5F00;&#x53D1;&#x4E2D;&#xFF0C;&#x4F46;&#x53D1;&#x5E03;&#x5E76;&#x4E0D;&#x50CF;&#x4EE5;&#x524D;&#x90A3;&#x4E48;&#x9891;&#x7E41;&#x3002;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x8BE5;&#x6846;&#x67B6;&#x7684;&#x7528;&#x6237;&#x4F1A;&#x9519;&#x8FC7;&#x5F88;&#x591A;&#x91CD;&#x8981;&#x7684;&#x4E1C;&#x897F;&#x3002;</p>
<p>&#x6B64;&#x5916;&#xFF0C;&#x7531;&#x4E8E;&#x91C7;&#x7528;&#x4E86;&#x5305;&#x542B;&#x4E30;&#x5BCC;&#x5185;&#x7F6E;&#x529F;&#x80FD;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x60A8;&#x8FD8;&#x9700;&#x8981;&#x4E86;&#x89E3; Rocket &#x662F;&#x5982;&#x4F55;&#x5DE5;&#x4F5C;&#x7684;&#x3002; Rocket &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6709;&#x751F;&#x547D;&#x5468;&#x671F;&#xFF0C;&#x6784;&#x5EFA;&#x5757;&#x4EE5;&#x7279;&#x5B9A;&#x65B9;&#x5F0F;&#x8FDE;&#x63A5;&#xFF0C;&#x5982;&#x679C;&#x51FA;&#x73B0;&#x95EE;&#x9898;&#xFF0C;&#x60A8;&#x9700;&#x8981;&#x4E86;&#x89E3;&#x95EE;&#x9898;&#x6240;&#x5728;&#x3002;</p>
<p>Rocket &#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x68D2;&#x7684;&#x6846;&#x67B6;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x60F3;&#x5F00;&#x59CB; Rust Web &#x5F00;&#x53D1;&#xFF0C;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x4E0D;&#x9519;&#x7684;&#x9009;&#x62E9;&#x3002;&#x5C31;&#x6211;&#x4E2A;&#x4EBA;&#x800C;&#x8A00;&#xFF0C;&#x6211;&#x5BF9; Rocket &#x60C5;&#x6709;&#x72EC;&#x949F;&#xFF0C;&#x5E0C;&#x671B;&#x5B83;&#x7684;&#x53D1;&#x5C55;&#x80FD;&#x591F;&#x52A0;&#x5FEB;&#x3002;&#x5BF9;&#x4E8E;&#x6211;&#x4EEC;&#x8BB8;&#x591A;&#x4EBA;&#x6765;&#x8BF4;&#xFF0C;Rocket &#x662F;&#x7B2C;&#x4E00;&#x4E2A;&#x8FDB;&#x5165; Rust &#x7684;&#x4EBA;&#xFF0C;&#x7528;&#x5B83;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#x4ECD;&#x7136;&#x5F88;&#x6709;&#x8DA3;&#x3002;&#x5C3D;&#x7BA1;&#x5982;&#x6B64;&#xFF0C;&#x6211;&#x901A;&#x5E38;&#x4F9D;&#x8D56; Rocket &#x4E2D;&#x4E0D;&#x53EF;&#x7528;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4E0D;&#x4F1A;&#x5728;&#x751F;&#x4EA7;&#x4E2D;&#x4F7F;&#x7528;&#x5B83;&#x3002;</p>
<h4 id="Rocket-Example"><a href="#Rocket-Example" class="headerlink" title="Rocket Example"></a>Rocket Example</h4><p>Rocket &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x4E00;&#x4E2A;&#x7B80;&#x77ED;&#x793A;&#x4F8B;&#xFF0C;&#x7528;&#x4E8E;&#x5904;&#x7406;&#x793A;&#x4F8B;&#x5B58;&#x50A8;&#x5E93;&#x4E2D;&#x7684;&#x8868;&#x5355;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">rust&#x590D;&#x5236;&#x4EE3;&#x7801;#[derive(Debug, FromForm)]</span><br><span class="line">struct Password&lt;&apos;v&gt; {</span><br><span class="line">    #[field(validate = len(6..))]</span><br><span class="line">    #[field(validate = eq(self.second))]</span><br><span class="line">    first: &amp;&apos;v str,</span><br><span class="line">    #[field(validate = eq(self.first))]</span><br><span class="line">    second: &amp;&apos;v str,</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">#[derive(Debug, FromForm)]</span><br><span class="line">#[allow(dead_code)]</span><br><span class="line">struct Submission&lt;&apos;v&gt; {</span><br><span class="line">    #[field(validate = len(1..))]</span><br><span class="line">    title: &amp;&apos;v str,</span><br><span class="line">    date: Date,</span><br><span class="line">    #[field(validate = len(1..=250))]</span><br><span class="line">    r#abstract: &amp;&apos;v str,</span><br><span class="line">    #[field(validate = ext(ContentType::PDF))]</span><br><span class="line">    file: TempFile&lt;&apos;v&gt;,</span><br><span class="line">    ready: bool,</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">#[derive(Debug, FromForm)]</span><br><span class="line">#[allow(dead_code)]</span><br><span class="line">struct Account&lt;&apos;v&gt; {</span><br><span class="line">    #[field(validate = len(1..))]</span><br><span class="line">    name: &amp;&apos;v str,</span><br><span class="line">    password: Password&lt;&apos;v&gt;,</span><br><span class="line">    #[field(validate = contains(&apos;@&apos;).or_else(msg!(&quot;invalid email address&quot;)))]</span><br><span class="line">    email: &amp;&apos;v str,</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">#[derive(Debug, FromForm)]</span><br><span class="line">#[allow(dead_code)]</span><br><span class="line">struct Submit&lt;&apos;v&gt; {</span><br><span class="line">    account: Account&lt;&apos;v&gt;,</span><br><span class="line">    submission: Submission&lt;&apos;v&gt;,</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">#[get(&quot;/&quot;)]</span><br><span class="line">fn index() -&gt; Template {</span><br><span class="line">    Template::render(&quot;index&quot;, &amp;Context::default())</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// NOTE: We use `Contextual` here because we want to collect all submitted form</span><br><span class="line">// fields to re-render forms with submitted values on error. If you have no such</span><br><span class="line">// need, do not use `Contextual`. Use the equivalent of `Form&lt;Submit&lt;&apos;_&gt;&gt;`.</span><br><span class="line">#[post(&quot;/&quot;, data = &quot;&lt;form&gt;&quot;)]</span><br><span class="line">fn submit&lt;&apos;r&gt;(form: Form&lt;Contextual&lt;&apos;r, Submit&lt;&apos;r&gt;&gt;&gt;) -&gt; (Status, Template) {</span><br><span class="line">    let template = match form.value {</span><br><span class="line">        Some(ref submission) =&gt; {</span><br><span class="line">            println!(&quot;submission: {:#?}&quot;, submission);</span><br><span class="line">            Template::render(&quot;success&quot;, &amp;form.context)</span><br><span class="line">        }</span><br><span class="line">        None =&gt; Template::render(&quot;index&quot;, &amp;form.context),</span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">    (form.context.status(), template)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">#[launch]</span><br><span class="line">fn rocket() -&gt; _ {</span><br><span class="line">    rocket::build()</span><br><span class="line">        .mount(&quot;/&quot;, routes![index, submit])</span><br><span class="line">        .attach(Template::fairing())</span><br><span class="line">        .mount(&quot;/&quot;, FileServer::from(relative!(&quot;/static&quot;)))</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="Rocket-&#x603B;&#x7ED3;"><a href="#Rocket-&#x603B;&#x7ED3;" class="headerlink" title="Rocket &#x603B;&#x7ED3;"></a>Rocket &#x603B;&#x7ED3;</h4><ul>
<li>&#x4E30;&#x5BCC;&#x7684;&#x5185;&#x7F6E;&#x529F;&#x80FD;&#x3002;</li>
<li>Great developer experience.</li>
<li>&#x4E0D;&#x50CF;&#x4EE5;&#x524D;&#x90A3;&#x6837;&#x79EF;&#x6781;&#x53D1;&#x5C55;&#x3002;</li>
<li>&#x5BF9;&#x4E8E;&#x521D;&#x5B66;&#x8005;&#x6765;&#x8BF4;&#x4ECD;&#x7136;&#x662F;&#x4E00;&#x4E2A;&#x4E0D;&#x9519;&#x7684;&#x9009;&#x62E9;&#x3002;</li>
</ul>
<h2 id="&#x9C9C;&#x4E3A;&#x4EBA;&#x77E5;&#x4F46;&#x4ECD;&#x7136;&#x4EE4;&#x4EBA;&#x5174;&#x594B;&#x7684;-Rust-&#x6846;&#x67B6;"><a href="#&#x9C9C;&#x4E3A;&#x4EBA;&#x77E5;&#x4F46;&#x4ECD;&#x7136;&#x4EE4;&#x4EBA;&#x5174;&#x594B;&#x7684;-Rust-&#x6846;&#x67B6;" class="headerlink" title="&#x9C9C;&#x4E3A;&#x4EBA;&#x77E5;&#x4F46;&#x4ECD;&#x7136;&#x4EE4;&#x4EBA;&#x5174;&#x594B;&#x7684; Rust &#x6846;&#x67B6;"></a>&#x9C9C;&#x4E3A;&#x4EBA;&#x77E5;&#x4F46;&#x4ECD;&#x7136;&#x4EE4;&#x4EBA;&#x5174;&#x594B;&#x7684; Rust &#x6846;&#x67B6;</h2><h3 id="Warp"><a href="#Warp" class="headerlink" title="Warp"></a>Warp</h3><p>hello&#xFF0C;Warp&#xFF01;&#x4F60;&#x662F;&#x4E00;&#x5934;&#x7F8E;&#x4E3D;&#x3001;&#x5947;&#x602A;&#x3001;&#x5F3A;&#x5927;&#x7684;&#x91CE;&#x517D;&#x3002; Warp &#x662F;&#x4E00;&#x4E2A;&#x6784;&#x5EFA;&#x5728; Tokio &#x4E4B;&#x4E0A;&#x7684; Web &#x6846;&#x67B6;&#xFF0C;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x597D;&#x7684;&#x6846;&#x67B6;&#x3002;&#x5B83;&#x4E5F;&#x4E0E;&#x6211;&#x4EEC;&#x8FC4;&#x4ECA;&#x4E3A;&#x6B62;&#x770B;&#x5230;&#x7684;&#x5176;&#x4ED6;&#x6846;&#x67B6;&#x6709;&#x5F88;&#x5927;&#x4E0D;&#x540C;&#x3002;</p>
<p>Warp &#x4E0E; Axum &#x6709;&#x4E00;&#x4E9B;&#x5171;&#x540C;traits&#xFF08;&#x54C8;&#x54C8;&#xFF01;&#xFF09;&#xFF1A;&#x5B83;&#x57FA;&#x4E8E; Tokio &#x548C; Hyper &#x6784;&#x5EFA;&#xFF0C;&#x5E76;&#x4F7F;&#x7528; Tower &#x4E2D;&#x95F4;&#x4EF6;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x5B83;&#x7684;&#x65B9;&#x6CD5;&#x5374;&#x975E;&#x5E38;&#x4E0D;&#x540C;&#x3002; Warp &#x662F;&#x5EFA;&#x7ACB;&#x5728; <code>Filter</code> trait&#x4E4B;&#x4E0A;&#x7684;&#x3002;</p>
<p>&#x5728; Warp &#x4E2D;&#xFF0C;&#x60A8;&#x6784;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#x4E8E;&#x4F20;&#x5165;&#x8BF7;&#x6C42;&#x7684;&#x8FC7;&#x6EE4;&#x5668;&#x7BA1;&#x9053;&#xFF0C;&#x5E76;&#x4E14;&#x8BF7;&#x6C42;&#x901A;&#x8FC7;&#x7BA1;&#x9053;&#x4F20;&#x9012;&#xFF0C;&#x76F4;&#x5230;&#x5230;&#x8FBE;&#x672B;&#x5C3E;&#x3002;&#x8FC7;&#x6EE4;&#x5668;&#x53EF;&#x4EE5;&#x94FE;&#x63A5;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x7EC4;&#x5408;&#x3002;&#x8FD9;&#x4F7F;&#x60A8;&#x53EF;&#x4EE5;&#x6784;&#x5EFA;&#x975E;&#x5E38;&#x590D;&#x6742;&#x4F46;&#x4ECD;&#x7136;&#x6613;&#x4E8E;&#x7406;&#x89E3;&#x7684;&#x7BA1;&#x9053;&#x3002;</p>
<p>Warp &#x4E5F;&#x6BD4; Axum &#x66F4;&#x63A5;&#x8FD1; Tokio &#x751F;&#x6001;&#x7CFB;&#x7EDF;&#xFF0C;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x60A8;&#x53EF;&#x4EE5;&#x5904;&#x7406;&#x66F4;&#x591A;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x7C98;&#x5408;&#x7279;&#x5F81;&#x7684; Tokio &#x7ED3;&#x6784;&#x548C;&#x6982;&#x5FF5;&#x3002;</p>
<p>Warp &#x91C7;&#x7528;&#x975E;&#x5E38;&#x5B9E;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5982;&#x679C;&#x8FD9;&#x662F;&#x60A8;&#x7684;&#x7F16;&#x7A0B;&#x98CE;&#x683C;&#xFF0C;&#x60A8;&#x4E00;&#x5B9A;&#x4F1A;&#x559C;&#x6B22; Warp &#x7684;&#x8868;&#x73B0;&#x529B;&#x548C;&#x53EF;&#x7EC4;&#x5408;&#x6027;&#x3002;&#x5F53;&#x4F60;&#x67E5;&#x770B;&#x4E00;&#x6BB5; Warp &#x4EE3;&#x7801;&#x65F6;&#xFF0C;&#x5B83;&#x901A;&#x5E38;&#x8BFB;&#x8D77;&#x6765;&#x5C31;&#x50CF;&#x4E00;&#x4E2A;&#x6B63;&#x5728;&#x53D1;&#x751F;&#x7684;&#x6545;&#x4E8B;&#xFF0C;&#x8FD9;&#x5728; Rust &#x4E2D;&#x8D77;&#x4F5C;&#x7528;&#x662F;&#x6709;&#x8DA3;&#x548C;&#x4EE4;&#x4EBA;&#x60CA;&#x5947;&#x7684;&#x3002;</p>
<p>&#x4E0D;&#x8FC7;&#xFF0C;&#x60A8;&#x53EF;&#x80FD;&#x60F3;&#x5728; RRust Analyzer&#x8BBE;&#x7F6E;&#x4E2D;&#x5173;&#x95ED; &#x7C7B;&#x578B;&#x5D4C;&#x5957; (inlay) &#x63D0;&#x793A;&#x3002;&#x7531;&#x4E8E;&#x6240;&#x6709;&#x8FD9;&#x4E9B;&#x4E0D;&#x540C;&#x7684;&#x51FD;&#x6570;&#x548C;&#x8FC7;&#x6EE4;&#x5668;&#x90FD;&#x88AB;&#x94FE;&#x63A5;&#x5728;&#x4E00;&#x8D77;&#xFF0C;Warp &#x4E2D;&#x7684; &#x7C7B;&#x578B; &#x53D8;&#x5F97;&#x975E;&#x5E38;&#x957F;&#x4E14;&#x975E;&#x5E38;&#x590D;&#x6742;&#xFF0C;&#x800C;&#x4E14;&#x4E5F;&#x96BE;&#x4EE5;&#x7834;&#x8BD1;&#x3002;&#x9519;&#x8BEF;&#x6D88;&#x606F;&#x4E5F;&#x662F;&#x5982;&#x6B64;&#xFF0C;&#x5B83;&#x53EF;&#x80FD;&#x662F;&#x96BE;&#x4EE5;&#x7406;&#x89E3;&#x7684;&#x4E00;&#x5806;&#x6D88;&#x606F;&#x3002;</p>
<p>&#x6B64;&#x5916;&#xFF0C;&#x867D;&#x7136;&#x8FC7;&#x6EE4;&#x5668;&#x6982;&#x5FF5;&#x5728;&#x60A8;&#x5B8C;&#x6210;&#x540E;&#x5F88;&#x68D2;&#xFF0C;&#x4F46;&#x6709;&#x65F6;&#x60A8;&#x5E0C;&#x671B;&#x62E5;&#x6709;&#x4E0E;&#x6240;&#x6709;&#x5176;&#x4ED6;&#x6846;&#x67B6;&#x4E00;&#x8D77;&#x83B7;&#x5F97;&#x7684;&#x58F0;&#x660E;&#x6027;&#x8DEF;&#x7531;&#x5668;&#x3001;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x548C;&#x63D0;&#x53D6;&#x5668;&#x6837;&#x5F0F;&#x3002;</p>
<p>Warp &#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x68D2;&#x7684;&#x6846;&#x67B6;&#xFF0C;&#x6211;&#x559C;&#x6B22;&#x5B83;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x5B83;&#x4E0D;&#x662F;&#x6700;&#x9002;&#x5408;&#x521D;&#x5B66;&#x8005;&#x7684;&#x6846;&#x67B6;&#xFF0C;&#x4E5F;&#x4E0D;&#x662F;&#x6700;&#x6D41;&#x884C;&#x7684;&#x6846;&#x67B6;&#x3002;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x60A8;&#x53EF;&#x80FD;&#x5F88;&#x96BE;&#x627E;&#x5230;&#x5E2E;&#x52A9;&#x548C;&#x8D44;&#x6E90;&#x3002;&#x4F46;&#x5BF9;&#x4E8E;&#x5FEB;&#x901F;&#x4E14;&#x5C0F;&#x578B;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6765;&#x8BF4;&#xFF0C;&#x5B83;&#x5F88;&#x6709;&#x8DA3;&#xFF0C;&#x800C;&#x4E14;&#x5B83;&#x7684;&#x5B9E;&#x9A8C;&#x98CE;&#x683C;&#x53EF;&#x80FD;&#x4F1A;&#x7ED9;&#x60A8;&#x5E26;&#x6765;&#x65B0;&#x7684;&#x60F3;&#x6CD5;&#xFF01;</p>
<h4 id="Warp-Example"><a href="#Warp-Example" class="headerlink" title="Warp Example"></a>Warp Example</h4><p>&#x6765;&#x81EA;&#x793A;&#x4F8B;&#x5B58;&#x50A8;&#x5E93;&#x7684; websocket &#x804A;&#x5929;&#x7684;&#x6F14;&#x793A;&#x793A;&#x4F8B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">rust&#x590D;&#x5236;&#x4EE3;&#x7801;static NEXT_USER_ID: AtomicUsize = AtomicUsize::new(1);</span><br><span class="line"></span><br><span class="line">/// Our state of currently connected users.</span><br><span class="line">///</span><br><span class="line">/// - Key is their id</span><br><span class="line">/// - Value is a sender of `warp::ws::Message`</span><br><span class="line">type Users = Arc&lt;RwLock&lt;HashMap&lt;usize, mpsc::UnboundedSender&lt;Message&gt;&gt;&gt;&gt;;</span><br><span class="line"></span><br><span class="line">#[tokio::main]</span><br><span class="line">async fn main() {</span><br><span class="line">    let users = Users::default();</span><br><span class="line">    // Turn our &quot;state&quot; into a new Filter...</span><br><span class="line">    let users = warp::any().map(move || users.clone());</span><br><span class="line"></span><br><span class="line">    // GET /chat -&gt; websocket upgrade</span><br><span class="line">    let chat = warp::path(&quot;chat&quot;)</span><br><span class="line">        // The `ws()` filter will prepare Websocket handshake...</span><br><span class="line">        .and(warp::ws())</span><br><span class="line">        .and(users)</span><br><span class="line">        .map(|ws: warp::ws::Ws, users| {</span><br><span class="line">            // This will call our function if the handshake succeeds.</span><br><span class="line">            ws.on_upgrade(move |socket| user_connected(socket, users))</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">    // GET / -&gt; index html</span><br><span class="line">    let index = warp::path::end().map(|| warp::reply::html(INDEX_HTML));</span><br><span class="line"></span><br><span class="line">    let routes = index.or(chat);</span><br><span class="line"></span><br><span class="line">    warp::serve(routes).run(([127, 0, 0, 1], 3030)).await;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">async fn user_connected(ws: WebSocket, users: Users) {</span><br><span class="line">    // Use a counter to assign a new unique ID for this user.</span><br><span class="line">    let my_id = NEXT_USER_ID.fetch_add(1, Ordering::Relaxed);</span><br><span class="line"></span><br><span class="line">    eprintln!(&quot;new chat user: {}&quot;, my_id);</span><br><span class="line"></span><br><span class="line">    // Split the socket into a sender and receive of messages.</span><br><span class="line">    let (mut user_ws_tx, mut user_ws_rx) = ws.split();</span><br><span class="line"></span><br><span class="line">    let (tx, rx) = mpsc::unbounded_channel();</span><br><span class="line">    let mut rx = UnboundedReceiverStream::new(rx);</span><br><span class="line"></span><br><span class="line">    tokio::task::spawn(async move {</span><br><span class="line">        while let Some(message) = rx.next().await {</span><br><span class="line">            user_ws_tx</span><br><span class="line">                .send(message)</span><br><span class="line">                .unwrap_or_else(|e| {</span><br><span class="line">                    eprintln!(&quot;websocket send error: {}&quot;, e);</span><br><span class="line">                })</span><br><span class="line">                .await;</span><br><span class="line">        }</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    // Save the sender in our list of connected users.</span><br><span class="line">    users.write().await.insert(my_id, tx);</span><br><span class="line"></span><br><span class="line">    // Return a `Future` that is basically a state machine managing</span><br><span class="line">    // this specific user&apos;s connection.</span><br><span class="line"></span><br><span class="line">    // Every time the user sends a message, broadcast it to</span><br><span class="line">    // all other users...</span><br><span class="line">    while let Some(result) = user_ws_rx.next().await {</span><br><span class="line">        let msg = match result {</span><br><span class="line">            Ok(msg) =&gt; msg,</span><br><span class="line">            Err(e) =&gt; {</span><br><span class="line">                eprintln!(&quot;websocket error(uid={}): {}&quot;, my_id, e);</span><br><span class="line">                break;</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line">        user_message(my_id, msg, &amp;users).await;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    // user_ws_rx stream will keep processing as long as the user stays</span><br><span class="line">    // connected. Once they disconnect, then...</span><br><span class="line">    user_disconnected(my_id, &amp;users).await;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">async fn user_message(my_id: usize, msg: Message, users: &amp;Users) {</span><br><span class="line">    // Skip any non-Text messages...</span><br><span class="line">    let msg = if let Ok(s) = msg.to_str() {</span><br><span class="line">        s</span><br><span class="line">    } else {</span><br><span class="line">        return;</span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">    let new_msg = format!(&quot;&lt;User#{}&gt;: {}&quot;, my_id, msg);</span><br><span class="line"></span><br><span class="line">    // New message from this user, send it to everyone else (except same uid)...</span><br><span class="line">    for (&amp;uid, tx) in users.read().await.iter() {</span><br><span class="line">        if my_id != uid {</span><br><span class="line">            if let Err(_disconnected) = tx.send(Message::text(new_msg.clone())) {</span><br><span class="line">                // The tx is disconnected, our `user_disconnected` code</span><br><span class="line">                // should be happening in another task, nothing more to</span><br><span class="line">                // do here.</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">async fn user_disconnected(my_id: usize, users: &amp;Users) {</span><br><span class="line">    eprintln!(&quot;good bye user: {}&quot;, my_id);</span><br><span class="line"></span><br><span class="line">    // Stream closed up, so remove from the user list</span><br><span class="line">    users.write().await.remove(&amp;my_id);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="Warp-&#x603B;&#x7ED3;"><a href="#Warp-&#x603B;&#x7ED3;" class="headerlink" title="Warp &#x603B;&#x7ED3;"></a>Warp &#x603B;&#x7ED3;</h4><ul>
<li>Functional approach. &#x51FD;&#x6570;&#x5F0F;&#x65B9;&#x6CD5;&#x3002;</li>
<li>Very expressive. &#x975E;&#x5E38;&#x5BCC;&#x6709;&#x8868;&#x73B0;&#x529B;&#x3002;</li>
<li>&#x9760;&#x8FD1; Tokio&#x3001;Tower &#x548C; Hyper&#xFF0C;&#x62E5;&#x6709;&#x5F3A;&#x5927;&#x7684;&#x751F;&#x6001;&#x7CFB;&#x7EDF;&#x3002;</li>
<li>&#x4E0D;&#x662F;&#x6700;&#x9002;&#x5408;&#x521D;&#x5B66;&#x8005;&#x7684;&#x6846;&#x67B6;&#x3002;</li>
</ul>
<h3 id="Tide"><a href="#Tide" class="headerlink" title="Tide"></a>Tide</h3><p>Tide &#x662F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x7B80;&#x7EA6;&#x7684; Web &#x6846;&#x67B6;&#xFF0C;&#x6784;&#x5EFA;&#x5728; <code>async-std</code> &#x8FD0;&#x884C;&#x65F6;&#x4E4B;&#x4E0A;&#x3002;&#x7B80;&#x7EA6;&#x7684;&#x65B9;&#x6CD5;&#x610F;&#x5473;&#x7740;&#x60A8;&#x5C06;&#x83B7;&#x5F97;&#x975E;&#x5E38;&#x5C0F;&#x7684; API &#x8868;&#x9762;&#x3002; Tide &#x4E2D;&#x7684;&#x5904;&#x7406;&#x51FD;&#x6570;&#x662F; <code>async fn</code> &#xFF0C;&#x5B83;&#x63A5;&#x53D7; <code>Request</code> &#x5E76;&#x8FD4;&#x56DE; <code>Response</code> &#x7684; <code>tide::Result</code> &#x3002;&#x63D0;&#x53D6;&#x6570;&#x636E;&#x6216;&#x53D1;&#x9001;&#x6B63;&#x786E;&#x7684;&#x54CD;&#x5E94;&#x683C;&#x5F0F;&#x53D6;&#x51B3;&#x4E8E;&#x60A8;&#x3002;</p>
<p>&#x867D;&#x7136;&#x8FD9;&#x5BF9;&#x60A8;&#x6765;&#x8BF4;&#x53EF;&#x80FD;&#x662F;&#x66F4;&#x591A;&#x7684;&#x5DE5;&#x4F5C;&#xFF0C;&#x4F46;&#x5B83;&#x4E5F;&#x66F4;&#x76F4;&#x63A5;&#xFF0C;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x60A8;&#x53EF;&#x4EE5;&#x5B8C;&#x5168;&#x63A7;&#x5236;&#x6B63;&#x5728;&#x53D1;&#x751F;&#x7684;&#x4E8B;&#x60C5;&#x3002;&#x5BF9;&#x4E8E;&#x67D0;&#x4E9B;&#x60C5;&#x51B5;&#xFF0C;&#x80FD;&#x591F;&#x5982;&#x6B64;&#x63A5;&#x8FD1; HTTP &#x8BF7;&#x6C42;&#x548C;&#x54CD;&#x5E94;&#x662F;&#x4E00;&#x4EF6;&#x4EE4;&#x4EBA;&#x9AD8;&#x5174;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x5E76;&#x4E14;&#x4F7F;&#x4E8B;&#x60C5;&#x53D8;&#x5F97;&#x66F4;&#x5BB9;&#x6613;&#x3002;</p>
<p>&#x5B83;&#x7684;&#x4E2D;&#x95F4;&#x4EF6;&#x65B9;&#x6CD5;&#x4E0E;&#x60A8;&#x4ECE; Tower &#x4E2D;&#x4E86;&#x89E3;&#x5230;&#x7684;&#x7C7B;&#x4F3C;&#xFF0C;&#x4F46; Tide &#x516C;&#x5F00;&#x4E86;&#x5F02;&#x6B65;&#x7279;&#x5F81;&#x7BB1;&#xFF0C;&#x4F7F;&#x5B9E;&#x65BD;&#x53D8;&#x5F97;&#x66F4;&#x52A0;&#x5BB9;&#x6613;&#x3002;&#x7531;&#x4E8E; Tide &#x662F;&#x7531;&#x4E5F;&#x53C2;&#x4E0E; Rust &#x5F02;&#x6B65;&#x751F;&#x6001;&#x7CFB;&#x7EDF;&#x7684;&#x4EBA;&#x4EEC;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x60A8;&#x53EF;&#x4EE5;&#x671F;&#x671B;&#x50CF;&#x6700;&#x8FD1;&#x767B;&#x9646; Nightly &#x7684;&#x7279;&#x5F81;&#x4E2D;&#x7684;&#x9002;&#x5F53;&#x5F02;&#x6B65;&#x65B9;&#x6CD5;&#x4E4B;&#x7C7B;&#x7684;&#x4E1C;&#x897F;&#x5F88;&#x5FEB;&#x5C31;&#x4F1A;&#x88AB;&#x91C7;&#x7528;&#x3002;</p>
<h4 id="Tide-Example"><a href="#Tide-Example" class="headerlink" title="Tide Example"></a>Tide Example</h4><p>&#x6765;&#x81EA;&#x793A;&#x4F8B;&#x5B58;&#x50A8;&#x5E93;&#x7684;&#x7528;&#x6237;&#x4F1A;&#x8BDD;&#x793A;&#x4F8B;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">rust&#x590D;&#x5236;&#x4EE3;&#x7801;#[async_std::main]</span><br><span class="line">async fn main() -&gt; Result&lt;(), std::io::Error&gt; {</span><br><span class="line">    femme::start();</span><br><span class="line">    let mut app = tide::new();</span><br><span class="line">    app.with(tide::log::LogMiddleware::new());</span><br><span class="line"></span><br><span class="line">    app.with(tide::sessions::SessionMiddleware::new(</span><br><span class="line">        tide::sessions::MemoryStore::new(),</span><br><span class="line">        std::env::var(&quot;TIDE_SECRET&quot;)</span><br><span class="line">            .expect(</span><br><span class="line">                &quot;Please provide a TIDE_SECRET value of at \                      least 32 bytes in order to run this example&quot;,</span><br><span class="line">            )</span><br><span class="line">            .as_bytes(),</span><br><span class="line">    ));</span><br><span class="line"></span><br><span class="line">    app.with(tide::utils::Before(</span><br><span class="line">        |mut request: tide::Request&lt;()&gt;| async move {</span><br><span class="line">            let session = request.session_mut();</span><br><span class="line">            let visits: usize = session.get(&quot;visits&quot;).unwrap_or_default();</span><br><span class="line">            session.insert(&quot;visits&quot;, visits + 1).unwrap();</span><br><span class="line">            request</span><br><span class="line">        },</span><br><span class="line">    ));</span><br><span class="line"></span><br><span class="line">    app.at(&quot;/&quot;).get(|req: tide::Request&lt;()&gt;| async move {</span><br><span class="line">        let visits: usize = req.session().get(&quot;visits&quot;).unwrap();</span><br><span class="line">        Ok(format!(&quot;you have visited this website {} times&quot;, visits))</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    app.at(&quot;/reset&quot;)</span><br><span class="line">        .get(|mut req: tide::Request&lt;()&gt;| async move {</span><br><span class="line">            req.session_mut().destroy();</span><br><span class="line">            Ok(tide::Redirect::new(&quot;/&quot;))</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">    app.listen(&quot;127.0.0.1:8080&quot;).await?;</span><br><span class="line"></span><br><span class="line">    Ok(())</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="Tide-&#x603B;&#x7ED3;"><a href="#Tide-&#x603B;&#x7ED3;" class="headerlink" title="Tide &#x603B;&#x7ED3;"></a>Tide &#x603B;&#x7ED3;</h4><ul>
<li>Minimalistic approach. &#x7B80;&#x7EA6;&#x7684;&#x65B9;&#x6CD5;&#x3002;</li>
<li>Uses <code>async-std</code> runtime. &#x4F7F;&#x7528; <code>async-std</code> &#x8FD0;&#x884C;&#x65F6;&#x3002;</li>
<li>Simple handler functions.  </li>
</ul>
<p>&#x7B80;&#x5355;&#x7684;&#x5904;&#x7406;&#x51FD;&#x6570;&#x3002;</p>
<ul>
<li>Playground of async features.</li>
</ul>
<h3 id="Poem"><a href="#Poem" class="headerlink" title="Poem"></a>Poem</h3><blockquote>
<p>A program is like a poem, you cannot write a poem without writing it. &#x2014; Dijkstra</p>
</blockquote>
<p>Poem &#x7684;&#x81EA;&#x8FF0;&#x6587;&#x4EF6;&#x7528;&#x8FD9;&#x4E9B;&#x8BDD;&#x5411;&#x60A8;&#x81F4;&#x610F;&#x3002; Poem &#x58F0;&#x79F0;&#x662F;&#x4E00;&#x4E2A;&#x529F;&#x80FD;&#x9F50;&#x5168;&#x4E14;&#x6613;&#x4E8E;&#x4F7F;&#x7528;&#x7684; Web &#x6846;&#x67B6;&#x3002;&#x5927;&#x80C6;&#x7684;&#x4E3B;&#x5F20;&#xFF0C;&#x4F46;Poem&#x4F3C;&#x4E4E;&#x5151;&#x73B0;&#x4E86;&#x3002;&#x4E4D;&#x4E00;&#x770B;&#xFF0C;&#x5B83;&#x7684;&#x7528;&#x6CD5;&#x4E0E; Axum &#x975E;&#x5E38;&#x76F8;&#x4F3C;&#xFF0C;&#x552F;&#x4E00;&#x7684;&#x533A;&#x522B;&#x662F;&#x60A8;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x76F8;&#x5E94;&#x7684;&#x5B8F;&#x6765;&#x6807;&#x8BB0;&#x5904;&#x7406;&#x51FD;&#x6570;&#x3002;&#x5B83;&#x8FD8;&#x57FA;&#x4E8E; Tokio &#x548C; Hyper &#x6784;&#x5EFA;&#xFF0C;&#x4E0E; Tower &#x4E2D;&#x95F4;&#x4EF6;&#x5B8C;&#x5168;&#x517C;&#x5BB9;&#xFF0C;&#x540C;&#x65F6;&#x4ECD;&#x7136;&#x66B4;&#x9732;&#x81EA;&#x5DF1;&#x7684;&#x4E2D;&#x95F4;&#x4EF6;&#x7279;&#x5F81;&#x3002;</p>
<p>Poem &#x7684;&#x4E2D;&#x95F4;&#x4EF6;&#x7279;&#x6027;&#x4E5F;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x6613;&#x7528;&#x3002;&#x60A8;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4E3A;&#x6240;&#x6709;&#x6216;&#x7279;&#x5B9A;&#x7684; <code>Endpoint</code> &#x5B9E;&#x73B0;&#x8BE5;&#x7279;&#x5F81;&#xFF08;Poem &#x8868;&#x8FBE;&#x53EF;&#x4EE5;&#x5904;&#x7406; HTTP &#x8BF7;&#x6C42;&#x7684;&#x6240;&#x6709;&#x5185;&#x5BB9;&#x7684;&#x65B9;&#x5F0F;&#xFF09;&#xFF0C;&#x6216;&#x8005;&#x60A8;&#x53EA;&#x7F16;&#x5199;&#x4E00;&#x4E2A;&#x63A5;&#x53D7; <code>Endpoint</code> &#x4F5C;&#x4E3A;&#x7684;&#x5F02;&#x6B65;&#x51FD;&#x6570;&#x8303;&#x56F4;&#x3002;&#x5728;&#x4E0E;&#x5854;&#x548C;&#x670D;&#x52A1;&#x7279;&#x5F81;&#x6253;&#x4EA4;&#x9053;&#x5E76;&#x6709;&#x65F6;&#x6323;&#x624E;&#x4E86;&#x8FD9;&#x4E48;&#x957F;&#x65F6;&#x95F4;&#x4E4B;&#x540E;&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x80A1;&#x65B0;&#x9C9C;&#x7A7A;&#x6C14;&#x3002;</p>
<p>Poem &#x4E0D;&#x4EC5;&#x4E0E;&#x66F4;&#x5E7F;&#x6CDB;&#x7684;&#x751F;&#x6001;&#x7CFB;&#x7EDF;&#x4E2D;&#x7684;&#x8BB8;&#x591A;&#x529F;&#x80FD;&#x517C;&#x5BB9;&#xFF0C;&#x800C;&#x4E14;&#x5B83;&#x672C;&#x8EAB;&#x4E5F;&#x5145;&#x6EE1;&#x4E86;&#x529F;&#x80FD;&#xFF0C;&#x5305;&#x62EC;&#x5BF9; OpenAPI &#x548C; Swagger &#x6587;&#x6863;&#x7684;&#x5B8C;&#x5168;&#x652F;&#x6301;&#x3002;&#x800C;&#x4E14;&#x5B83;&#x4E0D;&#x4EC5;&#x9650;&#x4E8E;&#x57FA;&#x4E8E;HTTP&#x7684;Web&#x670D;&#x52A1;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x57FA;&#x4E8E;Tonic&#x7684;gRPC&#x670D;&#x52A1;&#xFF0C;&#x751A;&#x81F3;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;Lambda&#x51FD;&#x6570;&#xFF0C;&#x800C;&#x65E0;&#x9700;&#x5207;&#x6362;&#x6846;&#x67B6;&#x3002;&#x6DFB;&#x52A0;&#x5BF9; OpenTelemetry&#x3001;Redis&#x3001;Prometheus &#x7B49;&#x7684;&#x652F;&#x6301;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x52FE;&#x9009;&#x4F01;&#x4E1A;&#x7EA7;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x73B0;&#x4EE3; Web &#x6846;&#x67B6;&#x7684;&#x6240;&#x6709;&#x6846;&#x3002;</p>
<p>Poem &#x4ECD;&#x5904;&#x4E8E; 0.x &#x7248;&#x672C;&#xFF0C;&#x4F46;&#x5982;&#x679C;&#x5B83;&#x4FDD;&#x6301;&#x52BF;&#x5934;&#x5E76;&#x63D0;&#x4F9B;&#x53EF;&#x9760;&#x7684; 1.0&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x503C;&#x5F97;&#x5173;&#x6CE8;&#x7684;&#x6846;&#x67B6;&#xFF01;</p>
<h4 id="Poem-Example"><a href="#Poem-Example" class="headerlink" title="Poem Example"></a>Poem Example</h4><p>&#x6765;&#x81EA;&#x793A;&#x4F8B;&#x5B58;&#x50A8;&#x5E93;&#x7684; websocket &#x804A;&#x5929;&#x7684;&#x7F29;&#x5199;&#x7248;&#x672C;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">rust&#x590D;&#x5236;&#x4EE3;&#x7801;#[handler]</span><br><span class="line">fn ws(</span><br><span class="line">    Path(name): Path&lt;String&gt;,</span><br><span class="line">    ws: WebSocket,</span><br><span class="line">    sender: Data&lt;&amp;tokio::sync::broadcast::Sender&lt;String&gt;&gt;,</span><br><span class="line">) -&gt; impl IntoResponse {</span><br><span class="line">    let sender = sender.clone();</span><br><span class="line">    let mut receiver = sender.subscribe();</span><br><span class="line">    ws.on_upgrade(move |socket| async move {</span><br><span class="line">        let (mut sink, mut stream) = socket.split();</span><br><span class="line"></span><br><span class="line">        tokio::spawn(async move {</span><br><span class="line">            while let Some(Ok(msg)) = stream.next().await {</span><br><span class="line">                if let Message::Text(text) = msg {</span><br><span class="line">                    if sender.send(format!(&quot;{name}: {text}&quot;)).is_err() {</span><br><span class="line">                        break;</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">        tokio::spawn(async move {</span><br><span class="line">            while let Ok(msg) = receiver.recv().await {</span><br><span class="line">                if sink.send(Message::Text(msg)).await.is_err() {</span><br><span class="line">                    break;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">    })</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">#[tokio::main]</span><br><span class="line">async fn main() -&gt; Result&lt;(), std::io::Error&gt; {</span><br><span class="line">    let app = Route::new().at(&quot;/&quot;, get(index)).at(</span><br><span class="line">        &quot;/ws/:name&quot;,</span><br><span class="line">        get(ws.data(tokio::sync::broadcast::channel::&lt;String&gt;(32).0)),</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    Server::new(TcpListener::bind(&quot;127.0.0.1:3000&quot;))</span><br><span class="line">        .run(app)</span><br><span class="line">        .await</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="Poem-&#x603B;&#x7ED3;"><a href="#Poem-&#x603B;&#x7ED3;" class="headerlink" title="Poem &#x603B;&#x7ED3;"></a>Poem &#x603B;&#x7ED3;</h4><ul>
<li>&#x5E9E;&#x5927;&#x7684;&#x529F;&#x80FD;&#x96C6;&#x3002;</li>
<li>&#x4E0E; Tokio &#x751F;&#x6001;&#x7CFB;&#x7EDF;&#x517C;&#x5BB9;&#x3002;</li>
<li>&#x4FBF;&#x4E8E;&#x4F7F;&#x7528;&#x3002;</li>
<li>&#x9002;&#x7528;&#x4E8E; gRPC &#x548C; Lambda&#x3002;</li>
</ul>
<h2 id="&#x9700;&#x8981;&#x5173;&#x6CE8;&#x7684;"><a href="#&#x9700;&#x8981;&#x5173;&#x6CE8;&#x7684;" class="headerlink" title="&#x9700;&#x8981;&#x5173;&#x6CE8;&#x7684;"></a>&#x9700;&#x8981;&#x5173;&#x6CE8;&#x7684;</h2><h3 id="Pavex"><a href="#Pavex" class="headerlink" title="Pavex"></a>Pavex</h3><p>&#x6700;&#x521D;&#x6211;&#x8BF4;&#x8FC7;&#x6240;&#x6709; Rust Web &#x6846;&#x67B6;&#x4E4D;&#x4E00;&#x770B;&#x90FD;&#x975E;&#x5E38;&#x76F8;&#x4F3C;&#x3002;&#x4ED6;&#x4EEC;&#x5728;&#x7EC6;&#x5FAE;&#x5DEE;&#x522B;&#x4E0A;&#x6709;&#x6240;&#x4E0D;&#x540C;&#xFF0C;&#x6709;&#x65F6;&#x751A;&#x81F3;&#x6BD4;&#x5176;&#x4ED6;&#x4EBA;&#x505A;&#x5F97;&#x66F4;&#x597D;&#x3002;</p>
<p>Pavex &#x662F;&#x8BE5;&#x89C4;&#x5219;&#x7684;&#x4F8B;&#x5916;&#x3002;&#x76EE;&#x524D;&#xFF0C;Pavex &#x7684;&#x5B9E;&#x65BD;&#x8005;&#x6B63;&#x662F; Luca Palmieri&#xFF0C;&#x4ED6;&#x662F;&#x5E7F;&#x53D7;&#x6B22;&#x8FCE;&#x7684;&#x300A;&#x96F6;&#x5230;&#x751F;&#x4EA7;&#x300B;&#x4E00;&#x4E66;&#x7684;&#x4F5C;&#x8005;&#x3002;&#x53EF;&#x4EE5;&#x6BEB;&#x65E0;&#x7591;&#x95EE;&#x5730;&#x8BF4;&#xFF0C;Luca &#x77E5;&#x9053;&#x4ED6;&#x5728;&#x505A;&#x4EC0;&#x4E48;&#xFF0C;&#x4ED6;&#x6240;&#x6709;&#x7684;&#x60F3;&#x6CD5;&#x548C;&#x7ECF;&#x9A8C;&#x90FD;&#x878D;&#x5165;&#x5230;&#x4E86; Pavex &#x4E2D;&#x3002;</p>
<p>Pavex &#x6709;&#x7740;&#x663E;&#x7740;&#x7684;&#x4E0D;&#x540C;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x5C06;&#x81EA;&#x5DF1;&#x89C6;&#x4E3A;&#x6784;&#x5EFA; Rust API &#x7684;&#x4E13;&#x7528;&#x7F16;&#x8BD1;&#x5668;&#x3002;&#x5B83;&#x9700;&#x8981;&#x5BF9;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5E94;&#x8BE5;&#x6267;&#x884C;&#x7684;&#x64CD;&#x4F5C;&#x8FDB;&#x884C;&#x9AD8;&#x7EA7;&#x63CF;&#x8FF0;&#xFF0C;&#x7F16;&#x8BD1;&#x5668;&#x4F1A;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x72EC;&#x7ACB;&#x7684; API Server SDK &#x5305;&#xFF0C;&#x53EF;&#x4F9B;&#x914D;&#x7F6E;&#x548C;&#x542F;&#x52A8;&#x3002;</p>
<p>Pavex &#x4ECD;&#x5904;&#x4E8E;&#x65E9;&#x671F;&#x9636;&#x6BB5;&#xFF0C;&#x4F46;&#x5B83;&#x7EDD;&#x5BF9;&#x662F;&#x4E00;&#x4E2A;&#x503C;&#x5F97;&#x5173;&#x6CE8;&#x7684;&#x9879;&#x76EE;&#x3002;&#x67E5;&#x770B; Luca &#x7684;&#x535A;&#x5BA2;&#x6587;&#x7AE0;&#x4E86;&#x89E3;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#x3002;</p>
<h2 id="&#x603B;&#x7ED3;"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3;</h2><p>&#x6B63;&#x5982;&#x60A8;&#x6240;&#x770B;&#x5230;&#x7684;&#xFF0C;Rust Web &#x6846;&#x67B6;&#x7684;&#x4E16;&#x754C;&#x975E;&#x5E38;&#x591A;&#x6837;&#x5316;&#x3002;&#x6CA1;&#x6709;&#x4E00;&#x79CD;&#x4E07;&#x80FD;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;&#x60A8;&#x9700;&#x8981;&#x9009;&#x62E9;&#x6700;&#x9002;&#x5408;&#x60A8;&#x9700;&#x6C42;&#x7684;&#x6846;&#x67B6;&#x3002;&#x5982;&#x679C;&#x60A8;&#x521A;&#x521A;&#x5F00;&#x59CB;&#xFF0C;&#x6211;&#x5EFA;&#x8BAE;&#x60A8;&#x4F7F;&#x7528; Actix &#x6216; Axum&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x662F;&#x6700;&#x9002;&#x5408;&#x521D;&#x5B66;&#x8005;&#x7684;&#x6846;&#x67B6;&#xFF0C;&#x5E76;&#x4E14;&#x6709;&#x5F88;&#x68D2;&#x7684;&#x6587;&#x6863;&#x3002;&#x5C31;&#x6211;&#x4E2A;&#x4EBA;&#x800C;&#x8A00;&#xFF0C;&#x6211;&#x5BF9; Pavex &#x5C06;&#x5E26;&#x6765;&#x4EC0;&#x4E48;&#x611F;&#x5174;&#x8DA3;&#xFF0C;&#x8BF4;&#x5B9E;&#x8BDD;&#xFF0C;&#x5728;&#x6210;&#x4E3A; Axum &#x7684;&#x957F;&#x671F;&#x7528;&#x6237;&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x771F;&#x7684;&#x5F88;&#x60F3;&#x770B;&#x770B; Poem&#x3002;</p>
<p><a href="/external_links/24fa49b5b8a06e4c03ef3ab56bfc3ed8.html" target="blank" rel="noopener">&#x539F;&#x6587;&#x5730;&#x5740;:Best Rust Web Frameworks to Use in 2023</a></p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/275c76e627f1fb57697726e2bffca3ff.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7339024907718967359.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7339024907718967359.html" itemprop="url">古茗是如何将小程序编译速度提升3倍的</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-02-26T08:00:00+08:00">
                2024-02-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/eba7d30e33978f5740b33ecfe8720c0bcdb3e4e6e7e8d9d0f798c0f3ceefc32c" alt="unclechong"></p>
<h2 id="&#x80CC;&#x666F;"><a href="#&#x80CC;&#x666F;" class="headerlink" title="&#x80CC;&#x666F;"></a>&#x80CC;&#x666F;</h2><p>&#x968F;&#x7740;&#x4E1A;&#x52A1;&#x7684;&#x53D1;&#x5C55;&#xFF0C;&#x5C0F;&#x7A0B;&#x5E8F;&#x7684;&#x4EE3;&#x7801;&#x91CF;&#x4E5F;&#x5728;&#x98DE;&#x901F;&#x81A8;&#x80C0;&#xFF0C;&#x53E4;&#x8317;&#x6700;&#x5927;&#x7684; B &#x7AEF;&#x5C0F;&#x7A0B;&#x5E8F;&#x9875;&#x9762;&#x5DF2;&#x7ECF;&#x8D85;&#x8FC7; 260+&#xFF0C;dev &#x6A21;&#x5F0F;&#x4E0B; <code>dist</code> &#x76EE;&#x5F55;&#x8FD1; 35M&#xFF0C;&#x6027;&#x80FD;&#x7A0D;&#x5DEE;&#x7684;&#x8BBE;&#x5907;&#x4ECE; &#x300E;&#x4EE3;&#x7801;&#x6539;&#x52A8; - Taro &#x70ED;&#x66F4;&#x65B0; - &#x5C0F;&#x7A0B;&#x5E8F;IDE build - &#x9875;&#x9762;reload&#x300F;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x8D85;&#x8FC7; 13s&#xFF1B;&#x800C;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x5728;&#x65E5;&#x5E38;&#x9700;&#x6C42;&#x5F00;&#x53D1;&#x65F6;&#x6BCF;&#x5929;&#x53EF;&#x80FD;&#x91CD;&#x590D;&#x4E0A;&#x767E;&#x6B21;&#xFF0C;&#x8FD9;&#x4F1A;&#x6781;&#x5927;&#x7684;&#x964D;&#x4F4E;&#x5F00;&#x53D1;&#x6548;&#x7387;&#x3002;</p>
<h2 id="&#x6784;&#x5EFA;&#x73B0;&#x72B6;&#x5206;&#x6790;"><a href="#&#x6784;&#x5EFA;&#x73B0;&#x72B6;&#x5206;&#x6790;" class="headerlink" title="&#x6784;&#x5EFA;&#x73B0;&#x72B6;&#x5206;&#x6790;"></a>&#x6784;&#x5EFA;&#x73B0;&#x72B6;&#x5206;&#x6790;</h2><p>&#x5148;&#x804A;&#x4E0B;&#x4E1A;&#x52A1;&#x573A;&#x666F;&#xFF0C;&#x6211;&#x4EEC;&#x7684; B &#x7AEF;&#x5C0F;&#x7A0B;&#x5E8F;&#x90FD;&#x8DD1;&#x5728;&#x9489;&#x9489;&#x5C0F;&#x7A0B;&#x5E8F;&#x5185;&#xFF0C;&#x5C0F;&#x7A0B;&#x5E8F;&#x7684;&#x8FD0;&#x884C;&#x65F6;&#x4E3A; <code>Taro</code> + <code>React</code>&#xFF0C;debug &#x5DE5;&#x5177;&#x662F;<a href="/external_links/aa0f40f81c1f74a0900c839ab72934a7.html" target="blank" rel="noopener">&#x652F;&#x4ED8;&#x5B9D;&#x5C0F;&#x7A0B;&#x5E8F;&#x5F00;&#x53D1;&#x8005;&#x5DE5;&#x5177;</a>&#xFF08;&#x4EE5;&#x4E0B;&#x7B80;&#x79F0;IDE&#xFF09;&#xFF0C;&#x5148;&#x6807;&#x8BB0;&#x4E00;&#x4E0B;&#x5B83;&#x65B9;&#x4FBF;&#x540E;&#x9762;&#x5BF9;&#x5B83;&#x5F00;&#x5927;&#x62DB;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/d773ede81d3699b8cc4516fd047f150f25b3d215a0bcd4ae87c65d76ebe76bad" alt="image.png"></p>
<p>&#x7528;&#x8FC7;&#x5C0F;&#x7A0B;&#x5E8F;&#x591A;&#x7AEF;&#x6846;&#x67B6;&#x7684;&#x5C0F;&#x4F19;&#x4F34;&#x5E94;&#x8BE5;&#x90FD;&#x6E05;&#x695A;&#xFF0C;&#x901A;&#x5E38;&#x90FD;&#x662F;&#x7531;&#x6846;&#x67B6;&#x5C42;&#x8FDB;&#x884C;&#x4E00;&#x6B21;&#x6784;&#x5EFA;&#xFF0C;&#x5C06;&#x8FD0;&#x884C;&#x65F6;&#x4EE3;&#x7801;&#x7F16;&#x8BD1;&#x6210;&#x5BF9;&#x5E94;&#x5E73;&#x53F0;&#x7684; <code>DSL</code> &#x5E76;&#x4E14;&#x8F93;&#x51FA; <code>dist</code> &#x5305;&#xFF0C;&#x5728;&#x7531;&#x5BF9;&#x5E94;&#x5E73;&#x53F0;&#x5BF9; <code>dist</code> &#x5305;&#x5728;&#x8FDB;&#x884C;&#x4E00;&#x6B21;&#x5168;&#x91CF;&#x6784;&#x5EFA;&#xFF0C;&#x6700;&#x7EC8;&#x8F93;&#x51FA;&#x79BB;&#x7EBF;&#x5305;&#x3002;</p>
<p>&#x5982;&#x679C;&#x662F; watch &#x6A21;&#x5F0F; <code>IDE</code> &#x8FD8;&#x4F1A;&#x5BF9; <code>dist</code> &#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x5168;&#x91CF;&#x7684;&#x76D1;&#x542C;&#xFF0C;&#x6587;&#x4EF6;&#x6BCF;&#x4E00;&#x6B21;&#x7684;&#x6539;&#x52A8;&#x90FD;&#x4F1A;&#x91CD;&#x65B0;&#x7684;&#x8D70;&#x4E00;&#x904D;&#x8FD9;&#x9053;&#x6D41;&#x7A0B;&#x3002;</p>
<p>&#x76EE;&#x524D;&#x6211;&#x4EEC;&#x7684;&#x6280;&#x672F;&#x6808;&#xFF0C;&#x5C31;&#x662F;&#x5148;&#x7531; <code>Taro</code> &#x6784;&#x5EFA;&#xFF0C;&#x5BF9;&#x5E94;&#x4E0B;&#x56FE;&#x5DE6;&#x4FA7;&#x7684;&#x65E5;&#x5FD7;&#xFF1B;&#x7136;&#x540E;&#x5462; <code>IDE</code> &#x518D;&#x6B21;&#x6784;&#x5EFA;&#xFF0C;&#x4E0B;&#x56FE;&#x6A21;&#x62DF;&#x5668;&#x4E0B;&#x9762;&#x7684; <strong>&#x7F16;&#x8BD1;&#x4E2D;</strong> &#x5C31;&#x662F; <code>IDE</code> &#x6784;&#x5EFA;&#x7684;&#x6807;&#x5FD7;&#xFF1B;<code>IDE</code> &#x6784;&#x5EFA;&#x5B8C;&#x6210;&#x540E;&#x6A21;&#x62DF;&#x5668;&#x5C31;&#x4F1A;&#x81EA;&#x52A8; reload &#x52A0;&#x8F7D;&#x6700;&#x65B0;&#x7684;&#x4EE3;&#x7801;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/6dbb0e8df107820fee9e009d7b1e69eaa6a4fd4187d9fb077072664c5a852f86" alt="&#x89C6;&#x9891;&#x8F6C;Gif_&#x7231;&#x7ED9;&#x7F51;_aigei_com (2).gif"></p>
<p>&#x4EE5;&#x4E0A;&#x5C31;&#x662F;&#x4E00;&#x6B21;&#x5C0F;&#x7A0B;&#x5E8F;&#x70ED;&#x66F4;&#x65B0;&#x5B8C;&#x6574;&#x6D41;&#x7A0B;&#xFF0C;&#x770B;&#x4F3C;&#x633A;&#x5FEB;&#x6CA1;&#x95EE;&#x9898;&#x5BF9;&#x5427;&#xFF0C;&#x6765;&#x6211;&#x4EEC;&#x628A;&#x5242;&#x91CF;&#x52A0;&#x5927;&#x3002;</p>
<h3 id="Taro-&#x6784;&#x5EFA;&#x6CA1;&#x6BDB;&#x75C5;"><a href="#Taro-&#x6784;&#x5EFA;&#x6CA1;&#x6BDB;&#x75C5;" class="headerlink" title="Taro &#x6784;&#x5EFA;&#x6CA1;&#x6BDB;&#x75C5;"></a>Taro &#x6784;&#x5EFA;&#x6CA1;&#x6BDB;&#x75C5;</h3><p>&#x521A;&#x521A;&#x53EA;&#x662F; hello world&#xFF0C;&#x6211;&#x4EEC;&#x4E0A;&#x771F;&#x5B9E;&#x7684;&#x9879;&#x76EE;&#xFF08;&#x9875;&#x9762;&#x505A;&#x4E86;&#x8131;&#x654F;&#xFF09;&#xFF0C;&#x6D4B;&#x8BD5;&#x8BBE;&#x5907;&#x662F;&#x4E00;&#x53F0; M1 Pro&#xFF0C;&#x4EC5;&#x6539;&#x52A8;&#x4E00;&#x884C;&#x4EE3;&#x7801;&#xFF0C;&#x8FDE;&#x7EED;&#x8DD1;&#x4E09;&#x6B21;&#x53D6;&#x6700;&#x5FEB;&#x7684;&#x4E00;&#x6B21;&#xFF0C;&#x4F60;&#x4EEC;&#x770B;&#x8DD1;&#x4E86;&#x51E0;&#x79D2;&#xFF0C;&#x6574;&#x4E2A;&#x6D41;&#x7A0B;&#x8981; <strong>10s+</strong>&#x3002;&#x8FD8;&#x6709;&#x4E9B;&#x540C;&#x5B66;&#x5728;&#x7528;&#x516C;&#x53F8;&#x914D;&#x7684; windows &#x8BBE;&#x5907;&#xFF0C;&#x8FD8;&#x4F1A;&#x66F4;&#x6162;&#x3002;&#x52A8;&#x56FE;&#x4E2D;&#x7684; <code>IDE&#x7248;&#x672C;&#x53F7;</code> &#x5148;&#x5FFD;&#x7565;&#x540E;&#x9762;&#x4F1A;&#x6709;&#x5927;&#x7528;&#x5904;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/2488bf6e27819461ccd50b8a6d743ca31e5e3ea019e94e39183e337bf560424a" alt="a.gif"></p>
<p>&#x4ECE;&#x4E24;&#x5F20;&#x5BF9;&#x6BD4;&#x56FE;&#x53EF;&#x4EE5;&#x76F4;&#x89C2;&#x7684;&#x770B;&#x51FA;&#xFF0C;&#x70ED;&#x66F4;&#x65B0;&#x7684;&#x65F6;&#x95F4;&#x4E3B;&#x8981;&#x82B1;&#x8D39;&#x540E;&#x534A;&#x6BB5; <code>IDE</code> &#x7684;&#x6784;&#x5EFA;&#x4E0A;&#x3002;&#x4ECE;&#x6570;&#x636E;&#x4E0A;&#x770B;&#x4E5F;&#x786E;&#x5B9E;&#x5982;&#x6B64;&#xFF0C;<code>Taro</code> &#x7684;&#x6784;&#x5EFA;&#x65F6;&#x95F4;&#x4ECE; 0.3s+ &#x4E0A;&#x5347;&#x5230; 1.6s+&#xFF0C;<code>IDE</code> &#x7684;&#x6784;&#x5EFA;&#x901F;&#x5EA6;&#x4ECE; 2s &#x5DE6;&#x53F3;&#x5C45;&#x7136;&#x5347;&#x5230;&#x4E86;&#x6050;&#x6016;&#x7684; <strong>9s</strong> &#x591A;&#xFF0C;&#x53EF;&#x6015;&#x2026;</p>
<p><code>Taro 3.5</code> &#x4E4B;&#x524D;&#x7684;&#x7248;&#x672C; <code>webpack</code> &#x8FD8;&#x505C;&#x7559;&#x5728;&#x8001;&#x7248;&#x672C;&#xFF0C;&#x5404;&#x79CD;&#x7F13;&#x5B58;&#x8BBE;&#x7F6E;&#x4E5F;&#x6CA1;&#x6709;&#x4F18;&#x5316;&#xFF0C;&#x70ED;&#x66F4;&#x65B0;&#x8FD8;&#x662F;&#x6709;&#x4E00;&#x4E9B;&#x6162;&#x7684;&#x3002;&#x78B0;&#x5DE7;&#x524D;&#x6BB5;&#x65F6;&#x95F4;&#x521A;&#x521A;&#x5B8C;&#x6210;&#x4E86; <code>Taro</code> &#x7684;&#x5347;&#x7EA7;&#xFF0C;&#x4ECE; <code>3.4.0</code> &#x5347;&#x7EA7;&#x5230; <code>3.6.19</code> &#xFF0C;&#x5728;&#x5347;&#x7EA7;&#x540E;&#x9996;&#x6B21;&#x6784;&#x5EFA;&#x8FD8;&#x6709;&#x70ED;&#x66F4;&#x65B0;&#x901F;&#x5EA6;&#x90FD;&#x5F97;&#x5230;&#x4E86;&#x5F88;&#x5927;&#x7684;&#x63D0;&#x5347;&#xFF0C;&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;&#x4E0B; <strong>200+ &#x9875;&#x9762;&#x7684;&#x5C0F;&#x7A0B;&#x5E8F;&#x70ED;&#x66F4;&#x65B0;&#x65F6;&#x95F4;&#x63A7;&#x5236;&#x5728; 2s &#x5185;</strong>&#xFF0C;&#x8FD9;&#x5BF9;&#x6211;&#x4EEC;&#x6765;&#x8BF4;&#x8DB3;&#x591F;&#xFF01;&#x6240;&#x4EE5; <code>Taro</code> &#x6784;&#x5EFA;&#x8FD9;&#x90E8;&#x5206;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8FC7;&#x3002;</p>
<p>&#x81F3;&#x4E8E; <code>Taro 3.5+</code> &#x6DFB;&#x52A0;&#x54EA;&#x4E9B;&#x9ED1;&#x79D1;&#x6280;&#xFF0C;&#x53EF;&#x4EE5;&#x79FB;&#x6B65;<a href="/external_links/b2fc4bf19718291edef33e781cf250e6.html" target="blank" rel="noopener">Taro v3.5 &#x6B63;&#x5F0F;&#x53D1;&#x5E03;&#xFF1A;&#x5F00;&#x53D1;&#x4F53;&#x9A8C;&#x63D0;&#x5347;</a>&#x3002;&#x542C;&#x8BF4;&#x540E;&#x7EED; 4.0 &#x7248;&#x672C;&#x8FD8;&#x652F;&#x6301;&#x4E86; <code>vite</code> &#x6784;&#x5EFA;&#xFF08;&#x597D;&#x5947;&#x662F;&#x5982;&#x4F55;&#x652F;&#x6301;&#x539F;&#x751F; <code>esm</code> &#x7684;&#xFF09;&#xFF0C;&#x8FD9;&#x91CC;&#x4E5F;&#x63A8;&#x8350;&#x5927;&#x5BB6; <code>Taro</code> &#x7684;&#x7248;&#x672C;&#x81F3;&#x5C11;&#x5728;3.5+&#xFF0C;&#x9664;&#x4E86;&#x6784;&#x5EFA;&#x901F;&#x5EA6;&#x63D0;&#x5347;&#x5916;&#xFF0C;&#x963F;&#x91CC;&#x7CFB;&#x5C0F;&#x7A0B;&#x5E8F;&#x7684;&#x5305;&#x4F53;&#x79EF;&#x4E5F;&#x4F1A;&#x964D;&#x4F4E;&#x975E;&#x5E38;&#x591A;&#xFF0C;<strong>&#x6CE8;&#x610F;&#x662F;&#x963F;&#x91CC;&#x7CFB;</strong>&#xFF0C;&#x56E0;&#x4E3A;&#x6A21;&#x677F;&#x652F;&#x6301;&#x4E86; <code>import</code> &#x8BED;&#x6CD5;&#x6BCF;&#x4E2A;&#x6A21;&#x677F;&#x90FD;&#x4F1A;&#x51CF;&#x5C11;10k&#xFF0C;&#x9875;&#x9762;&#x8D8A;&#x591A;&#x6548;&#x679C;&#x8D8A;&#x660E;&#x663E;&#x8FD9;&#x91CC;&#x4E0D;&#x5C55;&#x5F00;&#x8BF4;&#x4E86;&#x3002;</p>
<p>&#x4F46;&#x662F;&#x8BF7;&#x6CE8;&#x610F;<strong>&#x5347;&#x7EA7;&#x6709;&#x98CE;&#x9669;</strong>&#xFF0C;Breaking change &#x8FD8;&#x662F;&#x6709;&#x4E00;&#x4E9B;&#x7684;&#x3002;&#x4E5F;&#x5DE7;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x6709;&#x4E00;&#x4EFD;&#x5347;&#x7EA7;&#x8E29;&#x5751;&#x8BB0;&#x5F55;&#xFF0C;&#x4EC5;&#x4F9B;&#x53C2;&#x8003;<a href="/external_links/4880a934fe75b2ce00b5ac52dc896ef9.html" target="blank" rel="noopener">Taro 3.6+&#x5347;&#x7EA7;&#x8E29;&#x5751;&#x8BB0;&#x5F55;</a>&#x3002;</p>
<h3 id="IDE-&#x6784;&#x5EFA;&#x6210;&#x4E3A;&#x74F6;&#x9888;"><a href="#IDE-&#x6784;&#x5EFA;&#x6210;&#x4E3A;&#x74F6;&#x9888;" class="headerlink" title="IDE &#x6784;&#x5EFA;&#x6210;&#x4E3A;&#x74F6;&#x9888;"></a>IDE &#x6784;&#x5EFA;&#x6210;&#x4E3A;&#x74F6;&#x9888;</h3><p>&#x90A3; <code>IDE</code> &#x6784;&#x5EFA;&#x90E8;&#x5206;&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x6162;&#x8FD9;&#x4E48;&#x591A;&#x5462;&#xFF1F;</p>
<h4 id="&#x4EE3;&#x7801;&#x91CF;&#x589E;&#x52A0;"><a href="#&#x4EE3;&#x7801;&#x91CF;&#x589E;&#x52A0;" class="headerlink" title="&#x4EE3;&#x7801;&#x91CF;&#x589E;&#x52A0;"></a>&#x4EE3;&#x7801;&#x91CF;&#x589E;&#x52A0;</h4><p><strong>&#x6700;&#x76F4;&#x89C2;&#x7684;&#x56E0;&#x7D20;&#x5C31;&#x4EE3;&#x7801;&#x91CF;&#x589E;&#x591A;&#x4E86;</strong>&#xFF0C;&#x51E0;&#x4E4E;&#x6240;&#x6709;&#x7684;&#x6784;&#x5EFA;&#x5DE5;&#x5177;&#x7684;&#x6784;&#x5EFA;&#x901F;&#x5EA6;&#x90FD;&#x548C;&#x4EE3;&#x7801;&#x91CF;&#x6210;&#x6B63;&#x76F8;&#x5173;&#x3002;&#x524D;&#x9762;&#x804A;&#x5230; <code>IDE</code> &#x4F1A;&#x518D;&#x6B21;&#x5168;&#x91CF;&#x6784;&#x5EFA; <code>Taro</code> &#x8F93;&#x51FA;&#x7684; <code>dist</code> &#x6587;&#x4EF6;&#x5939;&#xFF1A;</p>
<ul>
<li>demo &#x9879;&#x76EE; <code>dist</code> &#x4F53;&#x79EF;&#x4E3A; <strong>2.8M</strong></li>
<li>&#x771F;&#x5B9E;&#x9879;&#x76EE;&#x5728; dev &#x6A21;&#x5F0F;&#x4E0B; <code>Taro</code> &#x8F93;&#x51FA;&#x7684; <code>dist</code> &#x8FD1; <strong>35M</strong> &#x7684;</li>
</ul>
<p>&#x4E0B;&#x56FE;&#x662F;&#x76EE;&#x524D;&#x771F;&#x5B9E;&#x9879;&#x76EE;&#x5728; dev &#x6A21;&#x5F0F;&#x4E0B;&#x7684; <code>dist</code> &#x76EE;&#x5F55;&#xFF0C;&#x5728;&#x7ECF;&#x8FC7;&#x51E0;&#x8F6E;&#x6784;&#x5EFA;&#x914D;&#x7F6E;&#x4F18;&#x5316;&#x540E;&#x505C;&#x7559;&#x5728; <strong>35M</strong> &#x5DE6;&#x53F3;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/7668a2ae02958f9b5070bb05424cdb93db195eea991db8739d4f18b51d1eb83d" alt><br>&#x524D;&#x540E;&#x4EE3;&#x7801;&#x4F53;&#x79EF;&#x81A8;&#x80C0;&#x4E86;&#x5341;&#x51E0;&#x500D;&#xFF0C;&#x6240;&#x4EE5; <code>IDE</code> &#x76F8;&#x6BD4; demo &#x9879;&#x76EE;&#x6784;&#x5EFA;&#x901F;&#x5EA6;&#x6162;&#x662F;&#x5FC5;&#x7136;&#x7684;&#x3002;&#x5373;&#x4F7F;&#x4E0D;&#x7ECF;&#x8FC7; <code>Taro</code> &#x7684;&#x6784;&#x5EFA;&#x76F4;&#x63A5;&#x5728; <code>IDE</code> &#x4E2D;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x518D;&#x89E6;&#x53D1;&#x70ED;&#x66F4;&#x65B0;&#xFF0C;&#x6700;&#x540E;&#x7684;&#x7ED3;&#x679C;&#x4E5F;&#x662F;&#x4E00;&#x6837;&#x7684;&#x6162;&#x3002;</p>
<p>&#x4F30;&#x8BA1;&#x6709;&#x5C0F;&#x4F19;&#x4F34;&#x4F1A;&#x8BF4;&#x4E86;&#x201C;&#x8FD9;&#x4E0D;&#x516C;&#x5E73;&#x201D;&#xFF0C;&#x4F60;&#x8FD9;&#x662F; <code>Taro</code> &#x5E94;&#x7528;&#xFF0C;&#x4E03;&#x8F6C;&#x516B;&#x8F6C;&#x5168;&#x662F;&#x6A21;&#x7248;&#x4EE3;&#x7801;&#xFF0C;&#x5982;&#x679C;&#x7EAF;&#x539F;&#x751F;&#x5C0F;&#x7A0B;&#x5E8F;&#x80AF;&#x5B9A;&#x4E0D;&#x4F1A;&#x8FD9;&#x6837;&#xFF01;&#xFF01;&#xFF01;&#x55EF;~&#xFF0C;&#x6211;&#x731C;&#x53EF;&#x80FD;&#x4F1A;&#x597D;&#x4E00;&#x4E9B;&#x5427;&#x6211;&#x4E5F;&#x6CA1;&#x9A8C;&#x8BC1;&#x8FC7;&#xFF08;&#x6CA1;&#x6709;&#x8FD9;&#x4E48;&#x5927;&#x539F;&#x751F;&#x5C0F;&#x7A0B;&#x5E8F;&#x9879;&#x76EE;&#xFF09;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x89C9;&#x5F97;&#x7ED3;&#x8BBA;&#x5E94;&#x8BE5;&#x4E5F;&#x662F;&#x5927;&#x5DEE;&#x4E0D;&#x5DEE;&#x3002;&#x5982;&#x679C;&#x6709;&#x5C0F;&#x4F19;&#x4F34;&#x80FD;&#x9A8C;&#x8BC1;&#x539F;&#x751F;&#x652F;&#x4ED8;&#x5B9D;&#x5C0F;&#x7A0B;&#x5E8F;&#x6784;&#x5EFA;&#x901F;&#x5EA6;&#x4E0D;&#x4F1A;&#x968F;&#x7740;&#x4EE3;&#x7801;&#x589E;&#x52A0;&#x800C;&#x53D8;&#x6162;&#xFF0C;&#x90A3;&#x6211;&#x8BC4;&#x8BBA;&#x533A;&#x76F4;&#x63A5;&#x9001; 10 &#x676F;&#x53E4;&#x8317;&#x597D;&#x5427;&#x1F604;&#x1F604;&#x1F604;</p>
<h4 id="IDE-&#x7248;&#x672C;&#x5F69;&#x86CB;"><a href="#IDE-&#x7248;&#x672C;&#x5F69;&#x86CB;" class="headerlink" title="IDE &#x7248;&#x672C;&#x5F69;&#x86CB;"></a>IDE &#x7248;&#x672C;&#x5F69;&#x86CB;</h4><p>&#x7EE7;<a href="https://dev.newban.cn/7255480546427371578">&#x4E0A;&#x7BC7;</a>&#x53CB;&#x597D;&#x7684;&#x63A2;&#x8BA8;&#x7684;&#x6587;&#x7AE0;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x81F4;&#x656C;&#x4E0B;&#x652F;&#x4ED8;&#x5B9D;&#x5C0F;&#x7A0B;&#x5E8F;&#x5F00;&#x53D1;&#x8005;&#x5DE5;&#x5177;(IDE)</p>
<p>&#x91CD;&#x70B9;&#x6765;&#x4E86;&#xFF0C;&#x524D;&#x65B9;&#x9AD8;&#x80FD;&#xFF01;&#xFF01;&#xFF01;&#x80FD;&#x770B;&#x5230;&#x7684;&#x90FD;&#x662F;&#x6709;&#x7F18;&#x4EBA;&#xFF0C;<strong>&#x8BF7;&#x5927;&#x5BB6;&#x5C06;&#x652F;&#x4ED8;&#x5B9D;&#x5C0F;&#x7A0B;&#x5E8F;&#x5F00;&#x53D1;&#x8005;&#x5DE5;&#x5177;(IDE) &#x964D;&#x7EA7;&#x5230;3.4.3&#x4E4B;&#x524D;</strong>&#xFF0C;<br>&#x6211;&#x4FDD;&#x4F60;&#x6784;&#x5EFA;&#x901F;&#x5EA6;&#x63D0;&#x5347;30%&#x4EE5;&#x4E0A;&#xFF0C;&#x964D;&#x7EA7;&#x540E;&#x90FD;&#x8BF4;&#x597D;&#xFF0C;Mac Windows&#x771F;&#x7684;&#x90FD;&#x7BA1;&#x7528;&#xFF0C;&#x6CA1;&#x6709;&#x6548;&#x679C;&#x6211;&#x518D;&#x9001;5&#x676F;&#x53E4;&#x8317;&#xFF0C;&#x7BA1;&#x7528;&#x7684;&#x8BDD;&#x8BB0;&#x5F97;&#x56DE;&#x6765;&#x8D4F;&#x4E2A;&#x4E00;&#x952E;&#x4E09;&#x8FDE;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/e3761767f6ac6298a0be245f79fafac16b39820cb00a22719866a2f3468c3f8d" alt><br>&#x65E0;&#x56FE;&#x65E0;&#x8BC1;&#x636E;&#xFF0C;&#x5148;&#x4E0A;&#x56FE;&#x3002;&#x964D;&#x7EA7;&#x540E;&#xFF0C;&#x76F8;&#x540C;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x76F8;&#x540C;&#x7684;&#x6539;&#x52A8;&#xFF0C;<code>IDE</code> &#x76F8;&#x540C;&#x7684;&#x914D;&#x7F6E; <strong>&#x53EA;&#x8981; 4s</strong>&#xFF0C;&#x60CA;&#x4E86;&#xFF01;&#xFF01;&#xFF01;&#x8FD9;&#x4E2A;&#x6587;&#x7AE0;&#x6211;&#x662F;&#x4E0D;&#x662F;&#x4E0D;&#x7528;&#x518D;&#x5199;&#x7684;&#xFF0C;&#x54C8;&#x54C8;&#xFF0C;&#x76F4;&#x63A5;&#x5B8C;&#x7ED3;&#x3002;&#x8FD9;&#x4E5F;&#x89E3;&#x91CA;&#x4E86;&#x4E3A;&#x4EC0;&#x4E48;&#x6211;&#x8981;&#x5728;&#x52A8;&#x56FE;&#x4E0A;&#x9762;&#x52A0; <code>IDE&#x7248;&#x672C;&#x53F7;</code> &#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/70ffbd4c7c3907a51c48dbe9971f1964a3bb261c630fa736bc431a2d8dbdd91c" alt="&#x89C6;&#x9891;&#x8F6C;Gif_&#x7231;&#x7ED9;&#x7F51;_aigei_com (1).gif"></p>
<p>&#x81F3;&#x4E8E;&#x4E3A;&#x4EC0;&#x4E48;&#x6211;&#x4E0D;&#x6E05;&#x695A;&#xFF0C;&#x6211;&#x662F;&#x4EBA;&#x8089;&#x8BD5;&#x51FA;&#x6765;&#x7684;&#xFF0C;&#x8BB0;&#x5F97;&#x90A3;&#x662F;&#x67D0;&#x5929;&#x7684;&#x4E0B;&#x5348;&#x5076;&#x7136;&#x95F4;&#x7684;&#x4E00;&#x4E2A;&#x964D;&#x7EA7;&#x53D1;&#x73B0;&#x4E86;&#x65B0;&#x5927;&#x9646;&#x3002;&#x6709;&#x5B98;&#x65B9;&#x5927;&#x5927;&#x770B;&#x5230;&#x5E0C;&#x671B;&#x89E3;&#x51B3;&#x6211;&#x7684;&#x7591;&#x60D1;&#xFF0C;&#x4F60;&#x4EEC;&#x5230;&#x5E95;&#x505A;&#x4E86;&#x5565; &#x201C;&#x4F18;&#x5316;&#x201D; &#xFF1F;</p>
<p>3.4.3 &#x4E4B;&#x540E;&#x5B98;&#x65B9;&#x53C8;&#x53D1;&#x4E86;&#x597D;&#x591A;&#x65B0;&#x7248;&#x672C;&#xFF0C;&#x751A;&#x81F3;&#x6709;&#x6BD4;&#x8D5B;&#x4E13;&#x7528;&#x7248;&#x672C;&#x1F604;&#xFF08;&#x8868;&#x626C;&#x4E0B; changelog &#x5199;&#x7684;&#x771F;&#x597D;&#x771F;&#x8BE6;&#x7EC6;&#xFF0C;&#x6BD4;&#x9489;&#x9489;&#x5C0F;&#x7A0B;&#x5E8F;&#x6587;&#x6863;&#x5F3A;&#x591A;&#x4E86;&#xFF09;&#xFF0C;&#x65B0;&#x7248;&#x672C;&#x589E;&#x52A0;&#x4E86;&#x5F88;&#x591A;&#x7684; feature &#x4FEE;&#x590D;&#x4E86;&#x5927;&#x91CF;&#x7684;&#x7F3A;&#x9677;&#xFF0C;&#x752D;&#x7BA1;&#x5176;&#x4ED6;&#x5728;&#x7889;&#x5821;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x5C31;&#x4F18;&#x5316;&#x6784;&#x5EFA;&#x901F;&#x5EA6;&#x8FC7;&#x5FEB;&#x8FD9;&#x4E2A;&#x4E00;&#x70B9;&#xFF0C;&#x53CD;&#x6B63;&#x6211;&#x662F;&#x4E0D;&#x4F1A;&#x5347;&#x7EA7;&#x3002;</p>
<h2 id="&#x53EF;&#x884C;&#x65B9;&#x6848;"><a href="#&#x53EF;&#x884C;&#x65B9;&#x6848;" class="headerlink" title="&#x53EF;&#x884C;&#x65B9;&#x6848;"></a>&#x53EF;&#x884C;&#x65B9;&#x6848;</h2><p>&#x90A3;&#x73B0;&#x72B6;&#x5982;&#x6B64;&#xFF0C;&#x6765;&#x5206;&#x6790;&#x4E0B;&#x770B;&#x770B;&#x6709;&#x54EA;&#x4E9B;&#x53EF;&#x884C;&#x7684;&#x65B9;&#x6848;&#x3002;</p>
<h3 id="&#x65B9;&#x6848;&#x4E00;&#xFF1A;&#x5C0F;&#x7A0B;&#x5E8F;&#x4E00;&#x62C6;&#x591A;"><a href="#&#x65B9;&#x6848;&#x4E00;&#xFF1A;&#x5C0F;&#x7A0B;&#x5E8F;&#x4E00;&#x62C6;&#x591A;" class="headerlink" title="&#x65B9;&#x6848;&#x4E00;&#xFF1A;&#x5C0F;&#x7A0B;&#x5E8F;&#x4E00;&#x62C6;&#x591A;"></a>&#x65B9;&#x6848;&#x4E00;&#xFF1A;&#x5C0F;&#x7A0B;&#x5E8F;&#x4E00;&#x62C6;&#x591A;</h3><p>&#x5355;&#x4E00;&#x5C0F;&#x7A0B;&#x5E8F;&#x7684;&#x4EE3;&#x7801;&#x91CF;&#x592A;&#x5927;&#xFF0C;&#x90A3;&#x5C31;&#x6309;&#x4E1A;&#x52A1;&#x57DF;&#x8FDB;&#x884C;&#x62C6;&#x5206;&#xFF0C;&#x4ECE;&#x6E90;&#x5934;&#x6765;&#x964D;&#x4F4E;&#x4EE3;&#x7801;&#x91CF;&#x3002;&#x6BD4;&#x5982;&#x6570;&#x636E;&#x5927;&#x76D8;&#x3001;&#x5546;&#x54C1;&#x7BA1;&#x7406;&#x8FD9;&#x79CD;&#x5173;&#x8054;&#x6027;&#x4E0D;&#x9AD8;&#xFF0C;&#x903B;&#x8F91;&#x53C8;&#x5F88;&#x590D;&#x6742;&#x7684;&#x4E1A;&#x52A1;&#x5C31;&#x5B8C;&#x5168;&#x53EF;&#x4EE5;&#x62C6;&#x6210;&#x72EC;&#x7ACB;&#x7684;&#x4E24;&#x4E2A;&#x5C0F;&#x7A0B;&#x9879;&#x76EE;&#x3002;&#x8FD9;&#x6837;&#x4EE3;&#x7801;&#x91CF;&#x5C31;&#x4F1A;&#x88AB;&#x6253;&#x6563;&#xFF0C;&#x6784;&#x5EFA;&#x901F;&#x5EA6;&#x81EA;&#x7136;&#x800C;&#x7136;&#x5C31;&#x89E3;&#x51B3;&#x4E86;&#x3002;&#x8FD9;&#x4E2A;&#x65B9;&#x6848;&#x76EE;&#x524D;&#x8FD8;&#x6709;&#x4E00;&#x4E9B;&#x963B;&#x529B;&#xFF0C;&#x4F46;&#x786E;&#x5B9E;&#x662F;&#x6211;&#x4EEC;&#x540E;&#x7EED;b&#x7AEF;&#x5C0F;&#x7A0B;&#x5E8F;&#x7684;&#x8FED;&#x4EE3;&#x7684;&#x4E00;&#x4E2A;&#x5927;&#x65B9;&#x5411;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/f8d11403fda5e5afb180df5a2588c623b81645804eaa3a4c8ffcac1ac6b7fd98" alt><br>&#x4ECE;&#x5F00;&#x53D1;&#x7684;&#x89D2;&#x5EA6;&#x770B;&#x8FD9;&#x4E2A;&#x65B9;&#x6848;&#x662F;&#x975E;&#x5E38;&#x5408;&#x7406;&#x7684;&#xFF0C;&#x5C0F;&#x7A0B;&#x5E8F;&#x5C31;&#x662F;&#x8981; <strong>&#x201C;&#x5C0F;&#x201D;</strong>, <strong>&#x201C;&#x5FEB;&#x201D;</strong>&#xFF0C;<strong>&#x201C;&#x8F7B;&#x201D;</strong>&#xFF1B;&#x5C0F;&#x7A0B;&#x5E8F;&#x8D8A;&#x5C0F;&#xFF0C;&#x542F;&#x52A8;&#x4F53;&#x9A8C;&#x3001;&#x5185;&#x5B58;&#x5360;&#x7528;&#x90FD;&#x4F1A;&#x66F4;&#x4F18;&#xFF0C;&#x800C;&#x4E14;&#x5C0F;&#x7A0B;&#x5E8F;&#x7684;&#x67B6;&#x6784;&#x5C42;&#x4E5F;&#x5BF9;&#x53D1;&#x5E03;&#x3001;&#x9884;&#x89C8;&#x7B49;&#x73AF;&#x8282;&#x5BF9;&#x5305;&#x4F53;&#x79EF;&#x505A;&#x4E86;&#x76F8;&#x5E94;&#x7684;&#x9650;&#x5236;&#x3002;&#x4F46;&#x662F;&#x4ECE;&#x4E1A;&#x52A1;&#x7684;&#x89C6;&#x89D2;&#x770B;&#x5C24;&#x5176;&#x662F;&#x64CD;&#x4F5C;&#x4EA4;&#x4E92;&#x5DF2;&#x7ECF;&#x56FA;&#x5316;&#x7684;&#x524D;&#x63D0;&#x4E0B;&#x518D;&#x53BB;&#x6539;&#x9020;&#xFF0C;&#x8FD9;&#x4F1A;&#x5927;&#x5927;&#x63D0;&#x5347;&#x7528;&#x6237;&#x7684;&#x5B66;&#x4E60;&#x6210;&#x672C;&#x3002;</p>
<p>&#x5982;&#x679C;&#x8FDB;&#x884C;&#x5FEB;&#x901F;&#x62C6;&#x5206;&#xFF0C;&#x524D;&#x63D0;&#x662F;&#x5E94;&#x7528;&#x5E95;&#x5C42;&#x7684;&#x57FA;&#x7840;&#x8BBE;&#x65BD;&#x8981;&#x975E;&#x5E38;&#x5065;&#x58EE;&#xFF0C;&#x57FA;&#x7840;&#x7EC4;&#x4EF6;&#x3001;&#x5DE5;&#x5177;&#x5E93;&#x3001;uuc &#x7B49;&#x901A;&#x7528;&#x80FD;&#x529B;&#x4E0D;&#x80FD;&#x518D;&#x6BCF;&#x4E2A;&#x5C0F;&#x7A0B;&#x5E8F;&#x90FD;&#x5197;&#x4F59;&#x4E00;&#x4EFD;&#x3002;&#x9664;&#x6B64;&#x4E4B;&#x5916;&#xFF0C;&#x5E94;&#x7528;&#x95F4;&#x7684;&#x901A;&#x4FE1;&#x3001;&#x4E1A;&#x52A1;&#x62C6;&#x89E3;&#x68B3;&#x7406;&#x3001;&#x7248;&#x672C;&#x7BA1;&#x7406;&#x3001;&#x4EE5;&#x53CA;&#x540E;&#x671F;&#x7684;&#x7EF4;&#x62A4;&#x6210;&#x672C;&#x8FD9;&#x90FD;&#x662F;&#x9700;&#x8981;&#x8003;&#x8651;&#x7684;&#x95EE;&#x9898;&#x3002;</p>
<h3 id="&#x65B9;&#x6848;&#x4E8C;&#xFF1A;&#x7F16;&#x8BD1;&#x6210;-h5"><a href="#&#x65B9;&#x6848;&#x4E8C;&#xFF1A;&#x7F16;&#x8BD1;&#x6210;-h5" class="headerlink" title="&#x65B9;&#x6848;&#x4E8C;&#xFF1A;&#x7F16;&#x8BD1;&#x6210; h5"></a>&#x65B9;&#x6848;&#x4E8C;&#xFF1A;&#x7F16;&#x8BD1;&#x6210; h5</h3><p>&#x65E2;&#x7136; <code>IDE</code> &#x70ED;&#x66F4;&#x65B0;&#x6162;&#xFF0C;&#x90A3;&#x5C31;&#x4E0D;&#x80FD;&#x8DF3;&#x51FA;&#x5B83;&#x5417;&#xFF1F;&#x6D4F;&#x89C8;&#x5668;&#x4E0D;&#x9999;&#x5417;&#xFF1F;</p>
<p>&#x5BF9;&#xFF0C;&#x786E;&#x5B9E;&#x53EF;&#x4EE5;&#xFF0C;&#x4E0D;&#x8981;&#x5FD8;&#x4E86;&#x53E4;&#x8317;&#x6240;&#x6709;&#x7684;&#x5C0F;&#x7A0B;&#x5E8F;&#x90FD;&#x662F;&#x8DD1;&#x5728; <code>Taro</code> &#x91CC;&#x9762;&#x7684;&#xFF0C;<code>Taro</code> &#x591A;&#x7AEF;&#x7684;&#x7279;&#x6027;&#x5929;&#x7136;&#x7684;&#x5C31;&#x53EF;&#x4EE5;&#x628A;&#x4EE3;&#x7801;&#x8F6C;&#x6362;&#x6210;web&#x5E94;&#x7528;&#x7684;&#x54E6;&#x3002;&#x8FD9;&#x6837;&#x786E;&#x5B9E;&#x53EF;&#x4EE5;&#x8DD1;&#x7684;&#x901A;&#xFF0C;&#x5355;&#x7EAF;&#x53EA;&#x662F;&#x7B80;&#x5355;&#x7684;&#x9884;&#x89C8;&#x662F;&#x6CA1;&#x95EE;&#x9898;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x8981;&#x771F;&#x6B63;&#x7684;&#x5E94;&#x7528;&#x5230;&#x5F00;&#x53D1;&#x4E2D;&#x8FD8;&#x6709;&#x6709;&#x4E9B;&#x5C0F;&#x95EE;&#x9898;&#x3002;</p>
<h4 id="API-&#x7684;&#x5DEE;&#x5F02;"><a href="#API-&#x7684;&#x5DEE;&#x5F02;" class="headerlink" title="API &#x7684;&#x5DEE;&#x5F02;"></a>API &#x7684;&#x5DEE;&#x5F02;</h4><p>&#x6D4F;&#x89C8;&#x5668;&#x548C; <code>IDE</code> &#x4E0A;&#x5BF9;&#x4E8E;&#x4E00;&#x4E9B; <code>api</code> &#x7684;&#x9884;&#x89C8;&#x6A21;&#x62DF;&#x5DEE;&#x5F02;&#x6BD4;&#x8F83;&#x5927;&#xFF0C;&#x5E76;&#x4E14;&#x56E0;&#x4E3A;&#x4E00;&#x4E9B;&#x517C;&#x5BB9;&#x95EE;&#x9898;&#x6D4F;&#x89C8;&#x5668;&#x80FD;&#x652F;&#x6301;&#x7684;api&#x6BD4;&#x8F83;&#x5C11;&#xFF0C;&#x5982;&#x679C;&#x5F00;&#x53D1;&#x8FC7;&#x7A0B;&#x4E2D;&#x9700;&#x8981;&#x8C03;&#x8BD5;&#x8FD8;&#x662F;&#x9700;&#x8981;&#x5207;&#x6362;&#x5230; <code>IDE</code> &#x4E2D;&#x3002;</p>
<h4 id="&#x8BBE;&#x8BA1;&#x8FD8;&#x539F;"><a href="#&#x8BBE;&#x8BA1;&#x8FD8;&#x539F;" class="headerlink" title="&#x8BBE;&#x8BA1;&#x8FD8;&#x539F;"></a>&#x8BBE;&#x8BA1;&#x8FD8;&#x539F;</h4><p>&#x5728;&#x5BF9;&#x8BBE;&#x8BA1;&#x7A3F;&#x8FDB;&#x884C;&#x8FD8;&#x539F;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x59CB;&#x7EC8;&#x548C; <code>IDE</code> &#x662F;&#x6709;&#x5DEE;&#x8DDD;&#x7684;&#xFF0C;&#x4E0D;&#x80FD;&#x7CBE;&#x51C6;&#x7684;&#x505A;&#x5230;&#x50CF;&#x7D20;&#x7EA7;&#x8FD8;&#x539F;&#x3002;&#x56E0;&#x4E3A;&#x672C;&#x8EAB;&#x6784;&#x5EFA;&#x7684;&#x4EA7;&#x7269;&#x5C31;&#x662F;&#x4E0D;&#x540C;&#x7684;&#xFF0C;&#x5305;&#x62EC;&#x4E00;&#x4E9B;&#x5176;&#x4ED6;&#x7684;&#x517C;&#x5BB9;&#x95EE;&#x9898;&#x3002;</p>
<h4 id="&#x6D41;&#x7A0B;&#x95EE;&#x9898;"><a href="#&#x6D41;&#x7A0B;&#x95EE;&#x9898;" class="headerlink" title="&#x6D41;&#x7A0B;&#x95EE;&#x9898;"></a>&#x6D41;&#x7A0B;&#x95EE;&#x9898;</h4><p>&#x60F3;&#x8C61;&#x4E00;&#x4E0B;&#xFF0C;&#x524D;&#x7AEF;&#x5728;&#x5F00;&#x53D1;&#x7684;&#x65F6;&#x5019;&#x4EE5;&#x6D4F;&#x89C8;&#x5668;&#x4E3A;&#x51C6;&#xFF0C;&#x5728;&#x63D0;&#x6D4B;&#x548C;&#x6700;&#x7EC8;&#x4E0A;&#x7EBF;&#x7684;&#x65F6;&#x5019;&#x53C8;&#x4EE5;&#x5C0F;&#x7A0B;&#x5E8F;&#x5BB9;&#x5668;&#x4E3A;&#x51C6;&#xFF0C;&#x9B3C;&#x77E5;&#x9053;&#x8FD9;&#x91CC;&#x9762;&#x4F1A;&#x6709;&#x591A;&#x5C11;&#x5751;&#xFF0C;&#x5F00;&#x53D1;&#x90FD;&#x662F;&#x597D;&#x597D;&#x7684;&#xFF0C;&#x5230; <code>IDE</code> &#x4E2D;&#x5C31;&#x5404;&#x79CD;&#x95EE;&#x9898;&#xFF0C;&#x8981;&#x77E5;&#x9053;&#x5C0F;&#x7A0B;&#x5E8F;&#x5BB9;&#x5668;&#x53EF;&#x662F;&#x5404;&#x79CD;&#x5B9A;&#x5236;&#x7684;&#x9ED1;&#x76D2;&#x3002;&#x5C31;&#x76EE;&#x524D;&#x6211;&#x4EEC;&#x53EA;&#x7528;&#x5C0F;&#x7A0B;&#x5E8F;&#x73AF;&#x5883;&#x90FD;&#x4F1A;&#x51FA;&#x73B0; <code>IDE</code> &#x5230;&#x771F;&#x673A;&#x7684;&#x5404;&#x79CD;&#x517C;&#x5BB9;&#x95EE;&#x9898;&#xFF0C;&#x66F4;&#x4E0D;&#x8981;&#x8BF4;&#x6D4F;&#x89C8;&#x5668;&#x5230;&#x771F;&#x673A;&#x5C0F;&#x7A0B;&#x5E8F;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x89C9;&#x5F97;&#x4ECE;&#x6D41;&#x7A0B;&#x4E0A;&#x548C;&#x7EF4;&#x62A4;&#x7684;&#x6210;&#x672C;&#x4E0A;&#x8003;&#x8651;&#x8FD8;&#x662F;&#x8981;&#x4EE5;&#x5C0F;&#x7A0B;&#x5E8F;&#x73AF;&#x5883;&#x4E3A;&#x51C6;&#x3002;</p>
<p>&#x73B0;&#x5728; <code>Taro</code> &#x8F6C; web &#x7684;&#x573A;&#x666F;&#x6211;&#x4EEC;&#x4E5F;&#x5728;&#x4F7F;&#x7528;&#xFF0C;&#x4F46;&#x8FD8;&#x662F;&#x4EC5;&#x9650;&#x4E8E;&#x6587;&#x6863;&#x4E2D;&#x7684; demo &#x9884;&#x89C8;&#xFF0C;&#x57FA;&#x7840;&#x7EC4;&#x4EF6;&#x7684;&#x5F00;&#x53D1;&#x9884;&#x89C8;&#x3002;</p>
<h3 id="&#x65B9;&#x6848;&#x4E09;&#xFF1A;&#x52A8;&#x6001;&#x6784;&#x5EFA;"><a href="#&#x65B9;&#x6848;&#x4E09;&#xFF1A;&#x52A8;&#x6001;&#x6784;&#x5EFA;" class="headerlink" title="&#x65B9;&#x6848;&#x4E09;&#xFF1A;&#x52A8;&#x6001;&#x6784;&#x5EFA;"></a>&#x65B9;&#x6848;&#x4E09;&#xFF1A;&#x52A8;&#x6001;&#x6784;&#x5EFA;</h3><p>&#x90A3;&#x80FD;&#x4E0D;&#x80FD; <strong>&#x201D;&#x6E10;&#x8FDB;&#x5F0F;&#x201C;</strong> &#x6784;&#x5EFA;&#x5462;&#xFF1F;&#x6BD4;&#x5982;&#x521D;&#x59CB;&#x5316;&#x7684;&#x65F6;&#x5019;&#x53EA;&#x6784;&#x5EFA;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x8BBF;&#x95EE;&#x5230;&#x54EA;&#x4E2A;&#x9875;&#x9762;&#x5728;&#x52A8;&#x6001;&#x5206;&#x6790;&#x8FD9;&#x4E2A;&#x9875;&#x9762;&#x7684;&#x4F9D;&#x8D56;&#x7136;&#x540E;&#x518D;&#x8FDB;&#x884C;&#x6784;&#x5EFA;&#xFF0C;&#x6C38;&#x8FDC;&#x53EA;&#x6784;&#x5EFA;&#x9700;&#x8981;&#x7684;&#x3002;</p>
<p><code>IDE</code> &#x80AF;&#x5B9A;&#x662F;&#x505A;&#x4E0D;&#x5230;&#x4E86;&#xFF0C;&#x5B83;&#x662F;&#x63A5;&#x6536; <code>Taro</code> &#x8F93;&#x51FA;&#x7684; <code>dist</code> &#xFF0C;&#x8F93;&#x51FA;&#x591A;&#x5C11;&#x5C31;&#x6784;&#x5EFA;&#x591A;&#x5C11;&#xFF0C;&#x8981;&#x60F3;&#x5B9E;&#x73B0;&#x53EA;&#x80FD;&#x5728; <code>Taro</code> &#x8FD9;&#x8FB9;&#x60F3;&#x529E;&#x6CD5;&#x3002;</p>
<p>&#x90A3;&#x5C31;&#x51CF;&#x5C11; <code>Taro</code> &#x4FA7;&#x6784;&#x5EFA;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x8FD9;&#x6837;&#x4E0D;&#x4EC5;&#x80FD;&#x964D;&#x4F4E; <code>IDE</code> &#x7684;&#x6784;&#x5EFA;&#x901F;&#x5EA6;&#xFF0C;<code>Taro</code> &#x7684;&#x6784;&#x5EFA;&#x901F;&#x5EA6;&#x4E5F;&#x4F1A;&#x968F;&#x4E4B;&#x964D;&#x4F4E;&#x3002;</p>
<p>&#x5B9E;&#x9645;&#x5728;&#x8FD9;&#x4E4B;&#x524D;&#x6211;&#x4EEC;&#x5C31;&#x662F;&#x8FD9;&#x6837;&#x505A;&#x7684;&#xFF0C;&#x53EA;&#x4E0D;&#x8FC7;&#x662F;&#x624B;&#x52A8;&#x6321;&#x1F604;&#x3002;&#x5728;&#x8FD9;&#x4E4B;&#x524D;&#x5148;&#x6765;&#x7B80;&#x5355;&#x7684;&#x4E86;&#x89E3;&#x4E0B; <code>Taro</code> &#x7684;&#x6784;&#x5EFA;&#x6D41;&#x7A0B;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/b43bf5cb207a63f4fa961cc56d2cdf2572ce7525d1f350a155fd96fe55790006" alt="image.png"></p>
<p><code>app.config.js</code> &#x5C31;&#x662F;&#x5C0F;&#x7A0B;&#x5E8F;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x8FD9;&#x91CC;&#x9762;&#x5305;&#x62EC;&#x8DEF;&#x7531;&#x4FE1;&#x606F;&#xFF0C;<code>Taro</code> &#x4F1A;&#x904D;&#x5386;&#x8FD9;&#x4EFD;&#x8DEF;&#x7531;&#x914D;&#x7F6E;&#xFF0C;&#x5E76;&#x4E14;&#x9010;&#x4E00;&#x63A8;&#x5230; <code>webpack</code> &#x7684;&#x76D1;&#x542C;&#x961F;&#x5217;&#x91CC;&#x9762;&#xFF0C;&#x88AB;&#x76D1;&#x542C;&#x7684;&#x6587;&#x4EF6;&#x540E;&#x6BCF;&#x6B21;&#x6539;&#x52A8;&#x4EE3;&#x7801; <code>Taro</code> &#x5C31;&#x4F1A;&#x91CD;&#x65B0;&#x6784;&#x5EFA;&#x751F;&#x6210;&#x65B0;&#x7684; <code>dist</code>&#x3002;&#x5E76;&#x4E14;&#x8FD9;&#x4EFD;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF08;<code>app.config.js</code>&#xFF09;&#x4E5F;&#x4F1A;&#x88AB;&#x63A8;&#x9001;&#x5230; <code>Taro</code> &#x7684;&#x6784;&#x5EFA;&#x76D1;&#x542C;&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x52A8;&#x6001;&#x4FEE;&#x6539;&#x8FD9;&#x4EFD;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF08;<code>app.config.js</code>&#xFF09;&#xFF0C;<code>Taro</code> &#x4F1A;&#x91CD;&#x65B0;&#x8D70;&#x4E00;&#x904D;&#x6574;&#x4E2A;&#x6D41;&#x7A0B;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/2090d3ecd88551d360ad5800c958e8b549750b413bad1c6799a7d392f40e336e" alt="image.png"></p>
<p>&#x90A3;&#x4E48;&#x4E4B;&#x524D;&#x7684;&#x624B;&#x52A8;&#x6321;&#x64CD;&#x4F5C;&#x5C31;&#x662F;&#x624B;&#x52A8;&#x53BB;&#x8FD9;&#x4EFD;&#x914D;&#x7F6E;&#x8868;&#xFF08;<code>app.config.js</code>&#xFF09;&#x91CC;&#x6CE8;&#x91CA;&#x6389;&#x4E00;&#x4E9B;&#x5F53;&#x524D;&#x4E0D;&#x9700;&#x8981;&#x7684;&#x8DEF;&#x7531;&#xFF0C;&#x53EA;&#x4FDD;&#x7559;&#x672C;&#x6B21;&#x5F00;&#x53D1;&#x9700;&#x8981;debug&#x7684;&#x8DEF;&#x7531;&#xFF0C;&#x8FD9;&#x6837;<code>Taro</code> &#x5C31;&#x53EA;&#x662F;&#x6784;&#x5EFA;&#x653E;&#x5F00;&#x7684;&#x8DEF;&#x7531;&#xFF0C;&#x751F;&#x6210;&#x7684; <code>dist</code> &#x6587;&#x4EF6;&#x5C31;&#x5C0F;&#x5F88;&#x591A;&#xFF0C;<code>IDE</code> &#x7684;&#x6784;&#x5EFA;&#x538B;&#x529B;&#x4E5F;&#x4F1A;&#x76F8;&#x5BF9;&#x5C0F;&#x5F88;&#x591A;&#x3002;&#x4F46;&#x662F;&#x624B;&#x52A8;&#x9664;&#x4E86;&#x64CD;&#x4F5C;&#x7E41;&#x7410;&#x8FD8;&#x4F1A;&#x4EA7;&#x751F;&#x5F88;&#x591A;&#x95EE;&#x9898;&#xFF0C;&#x6BD4;&#x5982;&#x6CE8;&#x91CA;&#x9519;&#x4E86;&#xFF0C;&#x6216;&#x8005;&#x628A;&#x6CE8;&#x91CA;&#x63D0;&#x4EA4;&#x4E0A;&#x53BB;&#x4E86;&#xFF0C;&#x53C8;&#x6216;&#x8005;&#x9700;&#x8981;&#x8DF3;&#x8F6C;&#x5230;&#x88AB;&#x6CE8;&#x91CA;&#x7684;&#x8DEF;&#x7531;&#x65F6;&#x5C31;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x6784;&#x5EFA;&#x7B49;&#x3002;</p>
<p>&#x6240;&#x4EE5;&#x8FD9;&#x6761;&#x8DEF;&#x80AF;&#x5B9A;&#x662F;&#x53EF;&#x884C;&#x7684;&#xFF0C;&#x6838;&#x5FC3;&#x7684;&#x95EE;&#x9898;&#x5C31;&#x662F;&#x5982;&#x4F55;&#x53D8;&#x6210;&#x81EA;&#x52A8;&#x6321;&#xFF0C;&#x52A8;&#x6001;&#x6309;&#x9700;&#x6784;&#x5EFA;&#x3002;</p>
<h2 id="&#x8054;&#x60F3;&#x5230;&#x5355;&#x9875;&#x5E94;&#x7528;&#xFF08;SPA&#xFF09;"><a href="#&#x8054;&#x60F3;&#x5230;&#x5355;&#x9875;&#x5E94;&#x7528;&#xFF08;SPA&#xFF09;" class="headerlink" title="&#x8054;&#x60F3;&#x5230;&#x5355;&#x9875;&#x5E94;&#x7528;&#xFF08;SPA&#xFF09;"></a>&#x8054;&#x60F3;&#x5230;&#x5355;&#x9875;&#x5E94;&#x7528;&#xFF08;SPA&#xFF09;</h2><p>&#x6211;&#x4EEC;&#x4ECE;&#x5C0F;&#x7A0B;&#x5E8F;&#x7684;&#x89C6;&#x89D2;&#x8DF3;&#x51FA;&#x6765;&#x5148;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x4E00;&#x4E2A;&#x4F20;&#x7EDF;&#x7684;web&#x5355;&#x9875;&#x5E94;&#x7528;&#x60F3;&#x8981;&#x63D0;&#x5347;&#x70ED;&#x66F4;&#x65B0;&#x7684;&#x901F;&#x5EA6;&#x53EF;&#x4EE5;&#x505A;&#x54EA;&#x4E9B;&#x4E8B;&#x60C5;&#x5462;&#xFF1F;</p>
<ol>
<li>&#x5C11;&#x76D1;&#x542C;&#xFF0C;&#x4E0A;&#x5404;&#x79CD;&#x61D2;&#x52A0;&#x8F7D;&#x2026;</li>
<li>&#x5C11;&#x7F16;&#x8BD1;&#xFF0C;&#x4E0A;&#x5404;&#x79CD;&#x7F13;&#x5B58;&#x8FD8;&#x6709; esm&#x3001;umd&#x3001;cdn&#x2026;</li>
<li>&#x5176;&#x4ED6;<ul>
<li>&#x5347;&#x7EA7;&#x786C;&#x4EF6;</li>
<li>&#x591A;&#x7EBF;&#x7A0B;</li>
<li>&#x4F7F;&#x7528; native &#x8BED;&#x8A00;&#xFF1F;swc&#x3001;esbuild&#x2026;</li>
</ul>
</li>
</ol>
<p>&#x5728;&#x56DE;&#x5230;&#x5C0F;&#x7A0B;&#x5E8F; <code>IDE</code> &#x7684;&#x573A;&#x666F;&#x4E0A;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x8003;&#x8651;&#x6784;&#x5EFA;&#x76F8;&#x5173;&#x7684;&#x4F18;&#x5316;&#xFF08;&#x6784;&#x5EFA;&#x76F8;&#x5173;&#x5DF2;&#x7ECF;&#x88AB; <code>IDE</code> &#x6536;&#x655B;&#x4E86;&#xFF09;&#xFF0C;&#x4E5F;&#x53EA;&#x80FD;&#x4ECE; <strong>&#x5C11;&#x76D1;&#x542C;</strong> &#x8FD9;&#x4E00;&#x70B9;&#x5165;&#x624B;&#x3002;</p>
<h2 id="&#x6700;&#x7EC8;&#x5B9E;&#x73B0;"><a href="#&#x6700;&#x7EC8;&#x5B9E;&#x73B0;" class="headerlink" title="&#x6700;&#x7EC8;&#x5B9E;&#x73B0;"></a>&#x6700;&#x7EC8;&#x5B9E;&#x73B0;</h2><p>&#x6765;&#x770B;&#x4E0B;&#x6700;&#x7EC8;&#x65B9;&#x6848;&#x81EA;&#x52A8;&#x6321;&#x7684;&#x6574;&#x4E2A;&#x6D41;&#x7A0B;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/cb29946f6eec9d77b49771d346b52a183690e07a4dfd44d41c5064f5bd2913b3" alt="image.png"></p>
<p>&#x6838;&#x5FC3;&#x7684;&#x5173;&#x952E;&#x6B65;&#x9AA4;&#x4EE5;&#x4E0B;&#x51E0;&#x70B9;&#xFF1A;</p>
<h3 id="&#x52AB;&#x6301;-app-config-js"><a href="#&#x52AB;&#x6301;-app-config-js" class="headerlink" title="&#x52AB;&#x6301; app.config.js"></a>&#x52AB;&#x6301; app.config.js</h3><p>&#x5728; <code>Taro</code> &#x6784;&#x5EFA;&#x662F;&#x751F;&#x6210;&#x4E34;&#x65F6;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6; <code>temp.app.config.js</code>&#xFF0C;&#x4EC5;&#x4FDD;&#x7559;&#x6700;&#x57FA;&#x672C;&#x7684;&#x8DEF;&#x7531;&#x4FE1;&#x606F;&#xFF08;tabbar&#x3001;&#x767B;&#x5F55;&#x548C;&#x843D;&#x5730;&#x9875;&#xFF09;&#xFF0C;&#x5176;&#x4ED6;&#x914D;&#x7F6E;&#x4FDD;&#x6301;&#x4E0E; <code>app.config.js</code> &#x4E00;&#x81F4;&#x3002;</p>
<p>&#x5E76;&#x4E14;&#x66FF;&#x6362; <code>Taro</code> &#x7684; <code>app.config.js</code> &#x7684;&#x5F15;&#x7528;&#x6307;&#x5411;&#x6362;&#x6210; <code>temp.app.config.js</code>&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x80FD;&#x4FDD;&#x8BC1;&#x9879;&#x76EE;&#x521D;&#x59CB;&#x5316;&#x6784;&#x5EFA;&#x4E3A;&#x6700;&#x5C0F;&#x4F53;&#x79EF;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/82225e28b4440e20a869536746a24708cc1efdf4c4946e47a76efda977b205e6" alt="image.png"></p>
<h3 id="&#x542F;&#x52A8;&#x672C;&#x5730;&#x670D;&#x52A1;&#x7BA1;&#x7406;&#x4E34;&#x65F6;&#x914D;&#x7F6E;"><a href="#&#x542F;&#x52A8;&#x672C;&#x5730;&#x670D;&#x52A1;&#x7BA1;&#x7406;&#x4E34;&#x65F6;&#x914D;&#x7F6E;" class="headerlink" title="&#x542F;&#x52A8;&#x672C;&#x5730;&#x670D;&#x52A1;&#x7BA1;&#x7406;&#x4E34;&#x65F6;&#x914D;&#x7F6E;"></a>&#x542F;&#x52A8;&#x672C;&#x5730;&#x670D;&#x52A1;&#x7BA1;&#x7406;&#x4E34;&#x65F6;&#x914D;&#x7F6E;</h3><p>&#x5728; <code>Taro</code> &#x5B8C;&#x6210;&#x540E;&#x542F;&#x52A8;&#x672C;&#x5730; <code>node</code> &#x670D;&#x52A1;&#xFF0C;&#x4E13;&#x95E8;&#x7528;&#x4E8E;&#x5BF9;&#x4E34;&#x65F6;&#x914D;&#x7F6E;&#xFF08;<code>temp.app.config.js</code>&#xFF09;&#x8FDB;&#x884C; <code>CRUD</code>&#x3002;</p>
<p>&#x5E76;&#x5BF9;&#x5916;&#x66B4;&#x9732;&#x4E00;&#x4E2A;http&#x7684;&#x63A5;&#x53E3; <code>http://localhost:xxxx/update?target=/pages/xxx/a</code>&#xFF0C;&#x8FD9;&#x4E2A;&#x63A5;&#x53E3;&#x4F1A;&#x505A;&#x5982;&#x4E0B;&#x51E0;&#x4EF6;&#x4E8B;&#x60C5;</p>
<ol>
<li>&#x63A5;&#x53E3;&#x63A5;&#x6536;&#x4E00;&#x4E2A; <code>path</code> &#x53C2;&#x6570;</li>
<li>&#x7528; <code>path</code> &#x53BB;&#x539F;&#x914D;&#x7F6E;&#xFF08;<code>app.config.js</code>&#xFF09;&#x67E5;&#x627E;&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x5B8C;&#x6574;&#x8DEF;&#x7531;&#x4FE1;&#x606F;&#xFF0C;&#x56E0;&#x4E3A;&#x8DEF;&#x7531;&#x53EF;&#x80FD;&#x4E3A;<a href="/external_links/7ea42bf009ac761423f60785d96c6b92.html" target="blank" rel="noopener">&#x5206;&#x5305;&#x8DEF;&#x7531;</a></li>
<li>&#x5C06;&#x5339;&#x914D;&#x5230;&#x7684;&#x7ED3;&#x679C;&#x66F4;&#x65B0;&#x5230;&#x4E34;&#x65F6;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF08;<code>temp.app.config.js</code>&#xFF09;</li>
</ol>
<h3 id="&#x6821;&#x9A8C;&#x7EC6;&#x8282;"><a href="#&#x6821;&#x9A8C;&#x7EC6;&#x8282;" class="headerlink" title="&#x6821;&#x9A8C;&#x7EC6;&#x8282;"></a>&#x6821;&#x9A8C;&#x7EC6;&#x8282;</h3><p>&#x56E0;&#x4E3A;&#x53EF;&#x80FD;&#x4F1A;&#x5B58;&#x5728;&#x5206;&#x5305;&#x7684;&#x573A;&#x666F;&#xFF0C;&#x6211;&#x4EEC;&#x5F00;&#x53D1;&#x7684;&#x7684;&#x573A;&#x666F;&#x5927;&#x90E8;&#x5206;&#x4F1A;&#x5728;&#x4E00;&#x4E2A;&#x5206;&#x5305;&#x5185;&#x5B8C;&#x6210;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x8DEF;&#x7531;&#x6BD4;&#x5BF9;&#x547D;&#x4E2D;&#x540E;&#x4F1A;&#x76F4;&#x63A5;&#x6784;&#x5EFA;&#x4E00;&#x4E2A;&#x5B8C;&#x6574;&#x7684;&#x5206;&#x5305;&#x3002;</p>
<p>&#x6BD4;&#x5982;&#x4E00;&#x4E2A;&#x5206;&#x5305;&#x4E2D; &#x6709; <code>/package/a</code>&#xFF0C;<code>/package/b</code>&#xFF0C;<code>/package/c</code> &#x4E09;&#x4E2A;&#x9875;&#x9762;&#xFF0C;&#x5F53;&#x8BBF;&#x95EE; <code>/package/a</code> &#x65F6;&#xFF0C;&#x4F1A;&#x76F4;&#x63A5;&#x5C06;&#x8FD9;&#x4E2A;&#x4E09;&#x4E2A;&#x9875;&#x9762;&#x4E00;&#x6B21;&#x6027;&#x6784;&#x5EFA;&#xFF0C;&#x4E0D;&#x7136; <code>package/a</code> &#x8DF3;&#x8F6C; <code>package/b</code> &#x518D;&#x8DF3;&#x8F6C; <code>package/c</code> &#x5C31;&#x4F1A;&#x6784;&#x5EFA;&#x4E09;&#x6B21;&#x3002;&#x5F53;&#x7136;&#x8FD9;&#x4E5F;&#x662F;&#x4E00;&#x4E2A;&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;&#xFF0C;&#x53EF;&#x4EE5;&#x5173;&#x95ED;&#x3002;</p>
<h3 id="&#x62E6;&#x622A;api"><a href="#&#x62E6;&#x622A;api" class="headerlink" title="&#x62E6;&#x622A;api"></a>&#x62E6;&#x622A;api</h3><ul>
<li>&#x62E6;&#x622A;&#x8DF3;&#x8F6C;api <code>Taro.navigateTo</code>&#xFF1A;&#x6211;&#x4EEC;&#x628A;&#x89E6;&#x53D1;&#x52A8;&#x6001;&#x6784;&#x5EFA;&#x7684;&#x65F6;&#x673A;&#x6807;&#x5B9A;&#x5728;&#x8DF3;&#x8F6C;&#x65F6;&#xFF0C;&#x5728;&#x8DF3;&#x8F6C;&#x65F6;&#x4F1A;&#x6821;&#x9A8C;&#x5F53;&#x524D;&#x7684;&#x8DEF;&#x7531;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x88AB;&#x6784;&#x5EFA;&#x8FC7;&#xFF0C;&#x68C0;&#x9A8C;&#x7684;&#x903B;&#x8F91;&#x5C31;&#x662F;&#x7528;&#x5F53;&#x524D;&#x8DF3;&#x8F6C;&#x8DEF;&#x7531;&#x53BB;&#x4E34;&#x65F6;&#x914D;&#x7F6E;&#xFF08;<code>temp.app.config.js</code>&#xFF09;&#x67E5;&#x627E;&#x662F;&#x5426;&#x5B58;&#x5728;&#xFF0C;&#x4E0D;&#x5B58;&#x5728;&#x65F6;&#x53D1;&#x8D77;<code>http://localhost:xxxx/update?target=/pages/xxx/a</code>&#x8BF7;&#x6C42;&#xFF1B;&#x5982;&#x679C;&#x5B58;&#x5728;&#x7684;&#x8BDD;&#x76F4;&#x63A5;&#x8D70; <code>Taro.navigateTo</code> &#x539F;&#x903B;&#x8F91;&#x5C31;&#x597D;&#x3002;</li>
<li>&#x62E6;&#x622A; <code>Taro DidMount</code>&#xFF1A;&#x5F53; <code>http://localhost:xxxx/update?target=/pages/xxx/a</code> &#x66F4;&#x65B0;&#x5B8C;&#x4E34;&#x65F6;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF08;<code>temp.app.config.js</code>&#xFF09;&#x540E;&#xFF0C;<code>Taro</code> &#x4F1A;&#x76D1;&#x542C;&#x5230;&#x4E34;&#x65F6;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF08;<code>temp.app.config.js</code>&#xFF09;&#x7684;&#x6539;&#x52A8;&#xFF0C;&#x5E76;&#x89E6;&#x53D1;&#x91CD;&#x65B0;&#x6784;&#x5EFA;&#x3002;&#x5C0F;&#x7A0B;&#x5E8F;reload&#x540E;&#x8FDB;&#x5165;&#x5230; <code>DidMount</code>&#xFF0C;<code>DidMount</code> &#x5728;&#x91CD;&#x5B9A;&#x5411;&#x5230;&#x76EE;&#x6807;&#x8DF3;&#x8F6C;&#x9875;&#x9762;</li>
</ul>
<h3 id="&#x7EDF;&#x4E00;&#x5C01;&#x88C5;"><a href="#&#x7EDF;&#x4E00;&#x5C01;&#x88C5;" class="headerlink" title="&#x7EDF;&#x4E00;&#x5C01;&#x88C5;"></a>&#x7EDF;&#x4E00;&#x5C01;&#x88C5;</h3><p>&#x56E0;&#x4E3A;&#x96F6;&#x96F6;&#x6563;&#x6563;&#x7684;&#x903B;&#x8F91;&#x5F88;&#x591A;&#xFF0C;&#x6240;&#x4EE5;&#x57FA;&#x4E8E; <code>Taro</code> &#x7684;<a href="/external_links/7b673b640184753eb3ecb22d4321f634.html" target="blank" rel="noopener">&#x63D2;&#x4EF6;&#x673A;&#x5236;</a> &#x5C06;&#x4E0A;&#x8FF0;&#x7684;&#x6240;&#x6709;&#x903B;&#x8F91;&#x5305;&#x88C5;&#x6210;&#x4E86; <code>Taro Plugin</code>&#x3002;&#x5F00;&#x542F;&#x540C;&#x5176;&#x4ED6;&#x7684; <code>Taro Plugin</code> &#x662F;&#x4E00;&#x6837;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x53EA;&#x8981;&#x5728;&#x7F16;&#x8BD1;&#x914D;&#x7F6E;&#x4E2D;&#x6DFB;&#x52A0;&#x6B64;&#x63D2;&#x4EF6;&#x5C31; ok &#x4E86;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">js&#x590D;&#x5236;&#x4EE3;&#x7801;/**</span><br><span class="line"> * &#x4F2A;&#x4EE3;&#x7801;&#xFF0C;Taro&#x7684;&#x6784;&#x5EFA;&#x914D;&#x7F6E;&#x6587;&#x4EF6; https://docs.taro.zone/docs/config-detail</span><br><span class="line"> * config/index.js</span><br><span class="line"> */</span><br><span class="line">module.exports =  {</span><br><span class="line">  ...</span><br><span class="line">  plugins: [&apos;taro-plugin-xxx&apos;],</span><br><span class="line">  ...</span><br><span class="line">};</span><br></pre></td></tr></table></figure>

<p>&#x57FA;&#x4E8E;&#x6B64;&#x540E;&#x7EED;&#x4E5F;&#x4F1A;&#x5728;&#x8FD9;&#x4E2A;&#x63D2;&#x4EF6;&#x4E2D;&#x6DFB;&#x52A0;&#x5176;&#x4ED6;&#x7684;&#x80FD;&#x529B;&#xFF0C;&#x6BD4;&#x5982;&#x6536;&#x655B;&#x5176;&#x4ED6;&#x63D2;&#x4EF6;&#x3001;&#x6536;&#x655B; patch-package&#x3001;&#x5185;&#x7F6E;&#x901A;&#x7528;&#x9875;&#x9762;&#x7B49;&#x3002;</p>
<h2 id="&#x53EF;&#x89C6;&#x5316;&#x62D3;&#x5C55;"><a href="#&#x53EF;&#x89C6;&#x5316;&#x62D3;&#x5C55;" class="headerlink" title="&#x53EF;&#x89C6;&#x5316;&#x62D3;&#x5C55;"></a>&#x53EF;&#x89C6;&#x5316;&#x62D3;&#x5C55;</h2><p>&#x65B9;&#x6848;&#x5185;&#x6D4B;&#x7684;&#x65F6;&#x5019;&#x53D1;&#x73B0;&#x4E86;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x5728;&#x5F00;&#x53D1;&#x65F6;&#x4E00;&#x65E6;&#x9700;&#x8981; debug &#x7684;&#x9875;&#x9762;&#x4F1A;&#x8DE8;&#x591A;&#x4E2A;&#x5206;&#x5305;&#x65F6;&#xFF0C;&#x6BD4;&#x5982;&#x4E00;&#x8FDE;&#x8DF3;&#x8F6C; 3 &#x4E2A;&#x5206;&#x5305;&#x90A3;&#x4E48;&#x5C31;&#x4F1A;&#x91CD;&#x65B0;&#x6784;&#x5EFA;&#x4E09;&#x6B21;&#xFF0C;&#x6240;&#x4EE5;&#x6709;&#x5FC5;&#x8981;&#x914D;&#x5408;&#x8FD9;&#x5957;&#x65B9;&#x6848;&#x5F00;&#x53D1;&#x4E00;&#x4E2A;&#x53EF;&#x89C6;&#x5316;&#x5DE5;&#x5177;&#x6765;&#x7CBE;&#x7EC6;&#x5316;&#x7BA1;&#x7406;&#x8DEF;&#x7531;&#xFF0C;&#x76F4;&#x63A5;&#x52FE;&#x52FE;&#x52FE;&#x5C31;&#x80FD;&#x5B8C;&#x6210;&#x4E0B;&#x4E00;&#x6B21;&#x7684;&#x6784;&#x5EFA;&#x3002;</p>
<p>&#x6240;&#x4EE5; <code>vscode</code> &#x63D2;&#x4EF6;&#x6765;&#x4E86;&#xFF0C;&#x53EF;&#x4EE5;&#x7CBE;&#x7EC6;&#x5316;&#x63A7;&#x5236;&#x5355;&#x4E2A;&#x8DEF;&#x7531;&#xFF0C;&#x4E0A;&#x8FF0;&#x7684;&#x573A;&#x666F;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x641C;&#x7D22;&#x548C;&#x52FE;&#x9009;&#x63D0;&#x524D;&#x5C06;&#x4E09;&#x4E2A;&#x5206;&#x5305;&#x52FE;&#x9009;&#x597D;&#xFF0C;&#x7136;&#x540E;&#x63D0;&#x4EA4;&#xFF0C;&#x8FD9;&#x6837;&#x4E00;&#x6B21;&#x6784;&#x5EFA;&#x5C31;&#x597D;&#x4E86;&#x3002;&#x5E76;&#x4E14;&#x4F1A;&#x548C;&#x4E34;&#x65F6;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF08;<code>temp.app.config.js</code>&#xFF09;&#x6570;&#x636E;&#x5171;&#x4EAB;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/e0211353bf6143f9bb2cec4ae1e75c263ee9772c35f53c5d035132fc27da81af" alt><br>&#x7981;&#x7528;&#x7684;&#x9009;&#x9879;&#x4E3A;&#x9ED8;&#x8BA4;&#x6700;&#x5C0F;&#x8DEF;&#x7531;&#x96C6;&#x5408;&#x3002;</p>
<h2 id="&#x95EE;&#x9898;"><a href="#&#x95EE;&#x9898;" class="headerlink" title="&#x95EE;&#x9898;"></a>&#x95EE;&#x9898;</h2><p>&#x8FD8;&#x662F;&#x7559;&#x4E86;&#x4E00;&#x4E9B;&#x5751;&#x7684;&#xFF1A;</p>
<ul>
<li>&#x56E0;&#x4E3A;&#x662F;&#x672C;&#x5730; <code>node</code> &#x670D;&#x52A1;&#xFF0C;&#x5728;&#x771F;&#x673A;&#x9884;&#x89C8;&#x65F6;&#x8BBF;&#x95EE;&#x6CA1;&#x6709;&#x88AB;&#x6784;&#x5EFA;&#x7684;&#x8DEF;&#x7531;&#x4E0D;&#x80FD;&#x89E6;&#x53D1;&#x52A8;&#x6001;&#x6784;&#x5EFA;&#xFF0C;&#x9700;&#x8981;&#x63D0;&#x524D;&#x6784;&#x5EFA;&#x540E;&#x771F;&#x673A;&#x624D;&#x80FD;&#x6B63;&#x5E38;&#x8BBF;&#x95EE;</li>
<li>&#x76F8;&#x5BF9;&#x9ED1;&#x76D2;&#xFF0C;&#x52AB;&#x6301; <code>app.config.js</code> &#x5F15;&#x7528;&#x4EE5;&#x53CA;&#x590D;&#x5199; <code>Taro</code> &#x76F8;&#x5173;&#x7684;api&#x90FD;&#x9700;&#x8981;&#x4FEE;&#x6539;&#x6E90;&#x7801;&#x624D;&#x80FD;&#x5F97;&#x4EE5;&#x5B9E;&#x73B0;</li>
</ul>
<h2 id="&#x603B;&#x7ED3;"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3;</h2><p>&#x8FD9;&#x5957;&#x65B9;&#x6848;&#x76EE;&#x524D;&#x56E2;&#x961F;&#x5185;&#x9875;&#x9762;&#x8FC7;&#x767E;&#x7684;&#x5C0F;&#x7A0B;&#x5E8F;&#x90FD;&#x5DF2;&#x7ECF;&#x63A5;&#x5165;&#x4E86;&#xFF0C;&#x5728;&#x914D;&#x5408; <code>IDE</code> &#x964D;&#x7EA7;&#xFF0C;&#x8FD9;&#x4E00;&#x5957; &#x201C;&#x7EC4;&#x5408;&#x62F3;&#x201D; &#x4E0B;&#x6765;&#x70ED;&#x66F4;&#x65B0;&#x901F;&#x5EA6;&#x5927;&#x7EA6;&#x63D0;&#x5347; 3 &#x500D;&#xFF0C;&#x6211;&#x81EA;&#x5DF1;&#x65E5;&#x5E38;&#x5F00;&#x53D1;&#x6574;&#x4E2A;&#x70ED;&#x66F4;&#x65B0;&#x7684;&#x6D41;&#x7A0B;&#x57FA;&#x672C;&#x63A7;&#x5236;&#x5728; 3s &#x5DE6;&#x53F3;&#x3002;</p>
<p>&#x4E3A;&#x4E86;&#x5B9E;&#x73B0;&#x8FD9;&#x5957;&#x65B9;&#x6848;&#x524D;&#x671F;&#x5927;&#x91CF;&#x7684; <code>Taro</code> &#x7684;&#x6E90;&#x7801;&#xFF0C;&#x53D1;&#x73B0;&#x4E86;&#x5F88;&#x591A;&#x6709;&#x610F;&#x601D;&#x7684;&#x9ED1;&#x79D1;&#x6280;&#xFF0C;&#x4E5F;&#x7B97;&#x662F;&#x610F;&#x6599;&#x4E4B;&#x5916;&#x7684;&#x6536;&#x83B7;&#xFF0C;&#x4E5F;&#x53C2;&#x4E0E;&#x4E86;&#x5171;&#x5EFA;&#xFF0C;&#x5F88;&#x5E86;&#x5E78;&#x80FD;&#x53C2;&#x4E0E;&#x5230;&#x8FD9;&#x6837;&#x7684;&#x5F00;&#x6E90;&#x6846;&#x67B6;&#xFF0C;<code>Taro</code> &#x8FD9;&#x4E48;&#x591A;&#x5E74;&#x8FD8;&#x5728;&#x4E00;&#x76F4;&#x575A;&#x6301;&#x8FED;&#x4EE3;&#x7EF4;&#x62A4;&#x4E5F;&#x662F;&#x771F;&#x7684;&#x5F88;&#x4E0D;&#x5BB9;&#x6613;&#xFF0C;<strong>&#x81F4;&#x656C;</strong>&#xFF01;</p>
<h2 id="&#x6700;&#x540E;"><a href="#&#x6700;&#x540E;" class="headerlink" title="&#x6700;&#x540E;"></a>&#x6700;&#x540E;</h2><p>&#x1F31F; &#x62DB;&#x8058;&#x4FE1;&#x606F;&#xFF1A;</p>
<ul>
<li><a href="/external_links/0452f0c3e491d6cd0ba36a50fb45e1de.html" target="blank" rel="noopener">25 / 26 &#x5C4A;&#x524D;&#x7AEF;&#x5F00;&#x53D1;&#x5B9E;&#x4E60;&#x751F;</a></li>
</ul>
<p>&#x1F4DA; &#x5C0F;&#x8317;&#x6587;&#x7AE0;&#x63A8;&#x8350;&#xFF1A;</p>
<ul>
<li><a href="https://dev.newban.cn/7329034439408500763">&#x9489;&#x9489;&#x5C0F;&#x7A0B;&#x5E8F;&#x5B9E;&#x73B0;&#x7B7E;&#x540D;&#x677F;</a></li>
<li><a href="https://dev.newban.cn/7323436080312893476">JSPDF + html2canvas A4&#x5206;&#x9875;&#x622A;&#x65AD;</a></li>
<li><a href="https://dev.newban.cn/7321779224338448411">Formily JSON Schema &#x6E32;&#x67D3;&#x6D41;&#x7A0B;&#x53CA;&#x6848;&#x4F8B;&#x6D45;&#x6790;</a></li>
</ul>
<p>&#x5173;&#x6CE8;&#x516C;&#x4F17;&#x53F7;&#x300C;<a href="/external_links/f40b7034b31e24ca9725d4bcf11e27fb.html" target="blank" rel="noopener">Goodme&#x524D;&#x7AEF;&#x56E2;&#x961F;</a>&#x300D;&#xFF0C;&#x83B7;&#x53D6;&#x66F4;&#x591A;&#x5E72;&#x8D27;&#x5B9E;&#x8DF5;&#xFF0C;&#x6B22;&#x8FCE;&#x4EA4;&#x6D41;&#x5206;&#x4EAB;~</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/280c780d17fa407404f9c68a0ba0d08e.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7339210740455440419.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7339210740455440419.html" itemprop="url">Vue 3 的 setup语法糖到底是什么东西？ 前言 vu</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-02-26T07:58:15+08:00">
                2024-02-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x672C;&#x6587;&#x662F; <a href="/external_links/c0d1ddea52f9ca897a53426f8b9f07b0.html" target="blank" rel="noopener">vue3&#x7F16;&#x8BD1;&#x539F;&#x7406;&#x63ED;&#x79D8;</a> &#x7684;&#x7B2C; 2 &#x7BC7;&#xFF0C;&#x548C;&#x8BE5;&#x7CFB;&#x5217;&#x7684;&#x5176;&#x4ED6;&#x6587;&#x7AE0;&#x4E00;&#x8D77;&#x670D;&#x7528;&#x6548;&#x679C;&#x66F4;&#x4F73;&#x3002;</p>
<ol>
<li><a href="https://dev.newban.cn/7335721246931189795">vue3&#x7684;&#x5B8F;&#x5230;&#x5E95;&#x662F;&#x4EC0;&#x4E48;&#x4E1C;&#x897F;&#xFF1F;</a></li>
<li><a href="https://dev.newban.cn/7339210740455440419">Vue 3 &#x7684; setup&#x8BED;&#x6CD5;&#x7CD6;&#x5230;&#x5E95;&#x662F;&#x4EC0;&#x4E48;&#x4E1C;&#x897F;&#xFF1F;</a></li>
<li><a href="https://dev.newban.cn/7343139078486982710">&#x770B;&#x4E0D;&#x61C2;&#x6765;&#x6253;&#x6211;&#xFF0C;vue3&#x7684;.vue&#x6587;&#x4EF6;(SFC)&#x7F16;&#x8BD1;&#x8FC7;&#x7A0B;</a></li>
<li><a href="https://dev.newban.cn/7345129748006354978">&#x4E3A;&#x4EC0;&#x4E48;defineProps&#x5B8F;&#x51FD;&#x6570;&#x4E0D;&#x9700;&#x8981;&#x4ECE;vue&#x4E2D;import&#x5BFC;&#x5165;&#xFF1F;</a></li>
<li><a href="https://dev.newban.cn/7347670979635314703">&#x5929;&#x5929;&#x7528;defineEmits&#x5B8F;&#x51FD;&#x6570;&#xFF0C;&#x7ADF;&#x7136;&#x4E0D;&#x77E5;&#x9053;&#x7F16;&#x8BD1;&#x540E;&#x662F;vue2&#x7684;&#x9009;&#x9879;&#x5F0F;API&#xFF1F;</a></li>
<li><a href="https://dev.newban.cn/7349936384512131107">&#x9762;&#x8BD5;&#x5B98;&#xFF1A;&#x53EA;&#x77E5;&#x9053;v-model&#x662F;:modelValue&#x548C;@onUpdate&#x8BED;&#x6CD5;&#x7CD6;&#xFF0C;&#x90A3;&#x4F60;&#x53EF;&#x4EE5;&#x8D70;&#x4E86;</a></li>
<li><a href="https://dev.newban.cn/7354960709010260005">defineModel&#x662F;&#x5426;&#x7834;&#x574F;&#x4E86;vue3&#x7684;&#x5355;&#x5411;&#x6570;&#x636E;&#x6D41;&#x5462;&#xFF1F;</a></li>
<li><a href="https://dev.newban.cn/7356154581208072226">&#x770B;&#x4E0D;&#x61C2;&#x6765;&#x6253;&#x6211;&#xFF0C;vue3&#x5982;&#x4F55;&#x5C06;template&#x7F16;&#x8BD1;&#x6210;render&#x51FD;&#x6570;</a></li>
<li><a href="https://dev.newban.cn/7358709354425090083">&#x9762;&#x8BD5;&#x5B98;&#xFF1A;&#x6765;&#x8BF4;&#x8BF4;vue3&#x662F;&#x600E;&#x4E48;&#x5904;&#x7406;&#x5185;&#x7F6E;&#x7684;v-for&#x3001;v-model&#x7B49;&#x6307;&#x4EE4;&#xFF1F;</a></li>
<li><a href="https://dev.newban.cn/7360663978647404559">&#x9762;&#x8BD5;&#x5B98;&#xFF1A;&#x5728;&#x539F;&#x751F;input&#x4E0A;&#x9762;&#x4F7F;&#x7528;v-model&#x548C;&#x7EC4;&#x4EF6;&#x4E0A;&#x9762;&#x4F7F;&#x7528;&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;&#xFF1F;</a></li>
</ol>
<h1 id="&#x524D;&#x8A00;"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00;</h1><p>&#x6211;&#x4EEC;&#x6BCF;&#x5929;&#x5199;<code>vue3</code>&#x9879;&#x76EE;&#x7684;&#x65F6;&#x5019;&#x90FD;&#x4F1A;&#x4F7F;&#x7528;<code>setup</code>&#x8BED;&#x6CD5;&#x7CD6;&#xFF0C;&#x4F46;&#x662F;&#x4F60;&#x6709;&#x6CA1;&#x6709;&#x601D;&#x8003;&#x8FC7;&#x4E0B;&#x9762;&#x51E0;&#x4E2A;&#x95EE;&#x9898;&#x3002;<code>setup</code>&#x8BED;&#x6CD5;&#x7CD6;&#x7ECF;&#x8FC7;&#x7F16;&#x8BD1;&#x540E;&#x662F;&#x4EC0;&#x4E48;&#x6837;&#x5B50;&#x7684;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#x5728;<code>setup</code>&#x9876;&#x5C42;&#x5B9A;&#x4E49;&#x7684;&#x53D8;&#x91CF;&#x53EF;&#x4EE5;&#x5728;<code>template</code>&#x4E2D;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;<code>import</code>&#x4E00;&#x4E2A;&#x7EC4;&#x4EF6;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#xFF0C;&#x65E0;&#x9700;&#x4F7F;&#x7528;<code>components</code> &#x9009;&#x9879;&#x6765;&#x663E;&#x5F0F;&#x6CE8;&#x518C;&#x7EC4;&#x4EF6;&#xFF1F;</p>
<h1 id="vue-&#x6587;&#x4EF6;&#x5982;&#x4F55;&#x6E32;&#x67D3;&#x5230;&#x6D4F;&#x89C8;&#x5668;&#x4E0A;"><a href="#vue-&#x6587;&#x4EF6;&#x5982;&#x4F55;&#x6E32;&#x67D3;&#x5230;&#x6D4F;&#x89C8;&#x5668;&#x4E0A;" class="headerlink" title="vue &#x6587;&#x4EF6;&#x5982;&#x4F55;&#x6E32;&#x67D3;&#x5230;&#x6D4F;&#x89C8;&#x5668;&#x4E0A;"></a>vue &#x6587;&#x4EF6;&#x5982;&#x4F55;&#x6E32;&#x67D3;&#x5230;&#x6D4F;&#x89C8;&#x5668;&#x4E0A;</h1><p>&#x8981;&#x56DE;&#x7B54;&#x4E0A;&#x9762;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x4EEC;&#x5148;&#x6765;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;&#x4ECE;&#x4E00;&#x4E2A;<code>vue</code>&#x6587;&#x4EF6;&#x5230;&#x6E32;&#x67D3;&#x5230;&#x6D4F;&#x89C8;&#x5668;&#x8FD9;&#x4E00;&#x8FC7;&#x7A0B;&#x7ECF;&#x5386;&#x4E86;&#x4EC0;&#x4E48;&#xFF1F;</p>
<p>&#x6211;&#x4EEC;&#x7684;<code>vue</code>&#x4EE3;&#x7801;&#x4E00;&#x822C;&#x90FD;&#x662F;&#x5199;&#x5728;&#x540E;&#x7F00;&#x540D;&#x4E3A;vue&#x7684;&#x6587;&#x4EF6;&#x4E0A;&#xFF0C;&#x663E;&#x7136;&#x6D4F;&#x89C8;&#x5668;&#x662F;&#x4E0D;&#x8BA4;&#x8BC6;vue&#x6587;&#x4EF6;&#x7684;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x53EA;&#x8BA4;&#x8BC6;html&#x3001;css&#x3001;jss&#x7B49;&#x6587;&#x4EF6;&#x3002;&#x6240;&#x4EE5;&#x7B2C;&#x4E00;&#x6B65;&#x5C31;&#x662F;&#x901A;&#x8FC7;<code>webpack</code>&#x6216;&#x8005;<code>vite</code>&#x5C06;&#x4E00;&#x4E2A;vue&#x6587;&#x4EF6;&#x7F16;&#x8BD1;&#x4E3A;&#x4E00;&#x4E2A;&#x5305;&#x542B;<code>render</code>&#x51FD;&#x6570;&#x7684;<code>js</code>&#x6587;&#x4EF6;&#x3002;&#x7136;&#x540E;&#x6267;&#x884C;<code>render</code>&#x51FD;&#x6570;&#x751F;&#x6210;&#x865A;&#x62DF;DOM&#xFF0C;&#x518D;&#x8C03;&#x7528;&#x6D4F;&#x89C8;&#x5668;&#x7684;<code>DOM API</code>&#x6839;&#x636E;&#x865A;&#x62DF;DOM&#x751F;&#x6210;&#x771F;&#x5B9E;DOM&#x6302;&#x8F7D;&#x5230;&#x6D4F;&#x89C8;&#x5668;&#x4E0A;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/6bec8ac96422cd7a80aa986d3ccb82f24f2edd0d48aeb6c4b0a690aef1352f95" alt="progress.png"></p>
<p><a href="/external_links/0dd90e10a2d0a625248e2f5baf67e451.html" target="blank" rel="noopener">&#x5173;&#x6CE8;&#x516C;&#x4F17;&#x53F7;&#xFF1A;&#x3010;&#x524D;&#x7AEF;&#x6B27;&#x9633;&#x3011;&#xFF0C;&#x89E3;&#x9501;&#x6211;&#x66F4;&#x591A;vue&#x539F;&#x7406;&#x6587;&#x7AE0;&#x3002;&#x8FD8;&#x53EF;&#x4EE5;&#x52A0;&#x6211;&#x5FAE;&#x4FE1;&#xFF0C;&#x8BA9;&#x4F60;&#x7684;&#x670B;&#x53CB;&#x5708;&#x591A;&#x4E00;&#x4F4D;&#x5BF9;vue&#x6709;&#x6DF1;&#x5165;&#x7406;&#x89E3;&#x7684;&#x4EBA;&#x3002;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5FAE;&#x4FE1;&#x7ED9;&#x6211;&#x8BF4;&#x4F60;&#x60F3;&#x770B;&#x54EA;&#x4E9B;vue&#x539F;&#x7406;&#x6587;&#x7AE0;&#xFF0C;&#x6211;&#x4F1A;&#x6839;&#x636E;&#x5927;&#x5BB6;&#x7684;&#x53CD;&#x9988;&#x8FDB;&#x884C;&#x521B;&#x4F5C;&#x3002;</a></p>
<h1 id="setup&#x7F16;&#x8BD1;&#x540E;&#x7684;&#x6837;&#x5B50;"><a href="#setup&#x7F16;&#x8BD1;&#x540E;&#x7684;&#x6837;&#x5B50;" class="headerlink" title="setup&#x7F16;&#x8BD1;&#x540E;&#x7684;&#x6837;&#x5B50;"></a><code>setup</code>&#x7F16;&#x8BD1;&#x540E;&#x7684;&#x6837;&#x5B50;</h1><p>&#x5728;<code>javascript</code>&#x6807;&#x51C6;&#x4E2D;<code>script</code>&#x6807;&#x7B7E;&#x662F;&#x4E0D;&#x652F;&#x6301;<code>setup</code>&#x5C5E;&#x6027;&#x7684;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x6839;&#x672C;&#x5C31;&#x4E0D;&#x8BA4;&#x8BC6;<code>setup</code>&#x5C5E;&#x6027;&#x3002;&#x6240;&#x4EE5;&#x5F88;&#x660E;&#x663E;<code>setup</code>&#x662F;&#x4F5C;&#x7528;&#x4E8E;&#x7F16;&#x8BD1;&#x65F6;&#x9636;&#x6BB5;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x4ECE;vue&#x6587;&#x4EF6;&#x7F16;&#x8BD1;&#x4E3A;js&#x6587;&#x4EF6;&#x8FD9;&#x4E00;&#x8FC7;&#x7A0B;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;demo&#xFF0C;&#x8FD9;&#x4E2A;&#x662F;<code>index.vue</code>&#x6E90;&#x4EE3;&#x7801;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">xml&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;template&gt;</span><br><span class="line">  &lt;h1&gt;{{ title }}&lt;/h1&gt;</span><br><span class="line">  &lt;h1&gt;{{ msg }}&lt;/h1&gt;</span><br><span class="line">  &lt;Child /&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">import { ref } from &quot;vue&quot;;</span><br><span class="line">import Child from &quot;./child.vue&quot;;</span><br><span class="line"></span><br><span class="line">const msg = ref(&quot;Hello World!&quot;);</span><br><span class="line">const title = &quot;title&quot;;</span><br><span class="line">if (msg.value) {</span><br><span class="line">  const content = &quot;content&quot;;</span><br><span class="line">  console.log(content);</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E2A;&#x540D;&#x4E3A;<code>msg</code>&#x7684;<code>ref</code>&#x54CD;&#x5E94;&#x5F0F;&#x53D8;&#x91CF;&#x548C;&#x975E;&#x54CD;&#x5E94;&#x5F0F;&#x7684;<code>title</code>&#x53D8;&#x91CF;&#xFF0C;&#x8FD8;&#x6709;<code>import</code>&#x4E86;<code>child.vue</code>&#x7EC4;&#x4EF6;&#x3002;</p>
<p>&#x8FD9;&#x4E2A;&#x662F;<code>child.vue</code>&#x7684;&#x6E90;&#x4EE3;&#x7801;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xml&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;template&gt;</span><br><span class="line">  &lt;div&gt;i am child&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<p>&#x6211;&#x4EEC;&#x63A5;&#x4E0B;&#x6765;&#x770B;<code>index.vue</code>&#x7F16;&#x8BD1;&#x540E;&#x7684;&#x6837;&#x5B50;&#xFF0C;&#x4EE3;&#x7801;&#x6211;&#x5DF2;&#x7ECF;&#x505A;&#x8FC7;&#x4E86;&#x7B80;&#x5316;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">javascript&#x590D;&#x5236;&#x4EE3;&#x7801;import { ref } from &quot;vue&quot;;</span><br><span class="line">import Child from &quot;./Child.vue&quot;;</span><br><span class="line"></span><br><span class="line">const title = &quot;title&quot;;</span><br><span class="line"></span><br><span class="line">const __sfc__ = {</span><br><span class="line">  __name: &quot;index&quot;,</span><br><span class="line">  setup() {</span><br><span class="line">    const msg = ref(&quot;Hello World!&quot;);</span><br><span class="line">    if (msg.value) {</span><br><span class="line">      const content = &quot;content&quot;;</span><br><span class="line">      console.log(content);</span><br><span class="line">    }</span><br><span class="line">    const __returned__ = { title, msg, Child };</span><br><span class="line">    return __returned__;</span><br><span class="line">  },</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">import {</span><br><span class="line">  toDisplayString as _toDisplayString,</span><br><span class="line">  createElementVNode as _createElementVNode,</span><br><span class="line">  createVNode as _createVNode,</span><br><span class="line">  Fragment as _Fragment,</span><br><span class="line">  openBlock as _openBlock,</span><br><span class="line">  createElementBlock as _createElementBlock,</span><br><span class="line">} from &quot;vue&quot;;</span><br><span class="line">function render(_ctx, _cache, $props, $setup, $data, $options) {</span><br><span class="line">  return (</span><br><span class="line">    _openBlock(),</span><br><span class="line">    _createElementBlock(</span><br><span class="line">      _Fragment,</span><br><span class="line">      null,</span><br><span class="line">      [</span><br><span class="line">        _createElementVNode(&quot;h1&quot;, null, _toDisplayString($setup.title)),</span><br><span class="line">        _createElementVNode(</span><br><span class="line">          &quot;h1&quot;,</span><br><span class="line">          null,</span><br><span class="line">          _toDisplayString($setup.msg),</span><br><span class="line">          1 /* TEXT */</span><br><span class="line">        ),</span><br><span class="line">        _createVNode($setup[&quot;Child&quot;]),</span><br><span class="line">      ],</span><br><span class="line">      64 /* STABLE_FRAGMENT */</span><br><span class="line">    )</span><br><span class="line">  );</span><br><span class="line">}</span><br><span class="line">__sfc__.render = render;</span><br><span class="line">export default __sfc__;</span><br></pre></td></tr></table></figure>

<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;<code>index.vue</code>&#x7F16;&#x8BD1;&#x540E;&#x7684;&#x4EE3;&#x7801;&#x4E2D;&#x5DF2;&#x7ECF;&#x6CA1;&#x6709;&#x4E86;<code>template</code>&#x6807;&#x7B7E;&#x548C;<code>script</code>&#x6807;&#x7B7E;&#xFF0C;&#x53D6;&#x800C;&#x4EE3;&#x4E4B;&#x662F;<code>render</code>&#x51FD;&#x6570;&#x548C;<code>__sfc__</code>&#x5BF9;&#x8C61;&#x3002;&#x5E76;&#x4E14;&#x4F7F;&#x7528;<code>__sfc__.render = render</code>&#x5C06;<code>render</code>&#x51FD;&#x6570;&#x6302;&#x5230;<code>__sfc__</code>&#x5BF9;&#x8C61;&#x4E0A;&#xFF0C;&#x7136;&#x540E;&#x5C06;<code>__sfc__</code>&#x5BF9;&#x8C61;<code>export default</code>&#x51FA;&#x53BB;&#x3002;</p>
<p>&#x770B;&#x5230;&#x8FD9;&#x91CC;&#x4F60;&#x5E94;&#x8BE5;&#x77E5;&#x9053;&#x4E86;&#x5176;&#x5B9E;&#x4E00;&#x4E2A;<code>vue</code>&#x7EC4;&#x4EF6;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x666E;&#x901A;&#x7684;js&#x5BF9;&#x8C61;&#xFF0C;<code>import</code>&#x4E00;&#x4E2A;<code>vue</code>&#x7EC4;&#x4EF6;&#xFF0C;&#x5B9E;&#x9645;&#x5C31;&#x662F;<code>import</code>&#x8FD9;&#x4E2A;<code>js</code>&#x5BF9;&#x8C61;&#x3002;&#x8FD9;&#x4E2A;js&#x5BF9;&#x8C61;&#x4E2D;&#x5305;&#x542B;<code>render</code>&#x65B9;&#x6CD5;&#x548C;<code>setup</code>&#x65B9;&#x6CD5;&#x3002;</p>
<h2 id="&#x7F16;&#x8BD1;&#x540E;&#x7684;setup&#x65B9;&#x6CD5;"><a href="#&#x7F16;&#x8BD1;&#x540E;&#x7684;setup&#x65B9;&#x6CD5;" class="headerlink" title="&#x7F16;&#x8BD1;&#x540E;&#x7684;setup&#x65B9;&#x6CD5;"></a>&#x7F16;&#x8BD1;&#x540E;&#x7684;<code>setup</code>&#x65B9;&#x6CD5;</h2><p>&#x6211;&#x4EEC;&#x5148;&#x6765;&#x770B;&#x770B;&#x8FD9;&#x4E2A;<code>setup</code>&#x65B9;&#x6CD5;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x89C9;&#x5F97;&#x548C;&#x6211;&#x4EEC;&#x6E90;&#x4EE3;&#x7801;&#x4E2D;&#x7684;<code>setup</code>&#x8BED;&#x6CD5;&#x7CD6;&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#x5F88;&#x76F8;&#x4F3C;&#xFF1F;&#x6CA1;&#x9519;&#xFF0C;&#x8FD9;&#x4E2A;<code>setup</code>&#x65B9;&#x6CD5;&#x5185;&#x7684;&#x4EE3;&#x7801;&#x5C31;&#x662F;&#x7531;<code>setup</code>&#x8BED;&#x6CD5;&#x7CD6;&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#x7F16;&#x8BD1;&#x540E;&#x6765;&#x7684;&#x3002;</p>
<p><code>setup</code>&#x8BED;&#x6CD5;&#x7CD6;&#x539F;&#x59CB;&#x4EE3;&#x7801;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">import { ref } from &quot;vue&quot;;</span><br><span class="line">import Child from &quot;./child.vue&quot;;</span><br><span class="line"></span><br><span class="line">const msg = ref(&quot;Hello World!&quot;);</span><br><span class="line">const title = &quot;title&quot;;</span><br><span class="line">if (msg.value) {</span><br><span class="line">  const content = &quot;content&quot;;</span><br><span class="line">  console.log(content);</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p><code>setup</code>&#x7F16;&#x8BD1;&#x540E;&#x7684;&#x4EE3;&#x7801;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;import { ref } from &quot;vue&quot;;</span><br><span class="line">import Child from &quot;./Child.vue&quot;;</span><br><span class="line"></span><br><span class="line">const title = &quot;title&quot;;</span><br><span class="line"></span><br><span class="line">const __sfc__ = {</span><br><span class="line">  __name: &quot;index&quot;,</span><br><span class="line">  setup() {</span><br><span class="line">    const msg = ref(&quot;Hello World!&quot;);</span><br><span class="line">    if (msg.value) {</span><br><span class="line">      const content = &quot;content&quot;;</span><br><span class="line">      console.log(content);</span><br><span class="line">    }</span><br><span class="line">    const __returned__ = { title, msg, Child };</span><br><span class="line">    return __returned__;</span><br><span class="line">  },</span><br><span class="line">};</span><br></pre></td></tr></table></figure>

<p>&#x7ECF;&#x8FC7;&#x5206;&#x6790;&#x6211;&#x4EEC;&#x53D1;&#x73B0;<code>title</code>&#x53D8;&#x91CF;&#x7531;&#x4E8E;&#x4E0D;&#x662F;&#x54CD;&#x5E94;&#x5F0F;&#x53D8;&#x91CF;&#xFF0C;&#x6240;&#x4EE5;&#x7F16;&#x8BD1;&#x540E;<code>title</code>&#x53D8;&#x91CF;&#x88AB;&#x63D0;&#x5230;&#x4E86;<code>js</code>&#x6587;&#x4EF6;&#x7684;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#x4E0A;&#x9762;&#x53BB;&#x4E86;&#x3002;&#x800C;<code>msg</code>&#x53D8;&#x91CF;&#x662F;&#x54CD;&#x5E94;&#x5F0F;&#x53D8;&#x91CF;&#xFF0C;&#x6240;&#x4EE5;&#x4F9D;&#x7136;&#x8FD8;&#x662F;&#x5728;<code>setup</code>&#x65B9;&#x6CD5;&#x4E2D;&#x3002;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;&#x770B;<code>setup</code>&#x7684;&#x8FD4;&#x56DE;&#x503C;&#xFF0C;&#x8FD4;&#x56DE;&#x503C;&#x662F;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#xFF0C;&#x5BF9;&#x8C61;&#x4E2D;&#x5305;&#x542B;<code>title</code>&#x3001;<code>msg</code>&#x3001;<code>Child</code>&#x5C5E;&#x6027;&#xFF0C;&#x975E;<code>setup</code>&#x9876;&#x5C42;&#x4E2D;&#x5B9A;&#x4E49;&#x7684;<code>content</code>&#x53D8;&#x91CF;&#x5C31;&#x4E0D;&#x5728;&#x8FD4;&#x56DE;&#x503C;&#x5BF9;&#x8C61;&#x4E2D;&#x3002;</p>
<p>&#x770B;&#x5230;&#x8FD9;&#x91CC;&#xFF0C;&#x53EF;&#x4EE5;&#x56DE;&#x7B54;&#x6211;&#x4EEC;&#x524D;&#x9762;&#x63D0;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#x3002;</p>
<p><strong><code>setup</code>&#x8BED;&#x6CD5;&#x7CD6;&#x7ECF;&#x8FC7;&#x7F16;&#x8BD1;&#x540E;&#x662F;&#x4EC0;&#x4E48;&#x6837;&#x5B50;&#x7684;&#xFF1F;</strong></p>
<p><code>setup</code>&#x8BED;&#x6CD5;&#x7CD6;&#x7F16;&#x8BD1;&#x540E;&#x4F1A;&#x53D8;&#x6210;&#x4E00;&#x4E2A;<code>setup</code>&#x65B9;&#x6CD5;&#xFF0C;&#x7F16;&#x8BD1;&#x540E;<code>setup</code>&#x65B9;&#x6CD5;&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#x548C;<code>script</code>&#x6807;&#x7B7E;&#x4E2D;&#x7684;&#x6E90;&#x4EE3;&#x7801;&#x5F88;&#x76F8;&#x4F3C;&#x3002;&#x65B9;&#x6CD5;&#x4F1A;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#xFF0C;&#x5BF9;&#x8C61;&#x7531;<code>setup</code>&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x9876;&#x5C42;&#x53D8;&#x91CF;&#x548C;<code>import</code>&#x5BFC;&#x5165;&#x7684;&#x5185;&#x5BB9;&#x7EC4;&#x6210;&#x3002;</p>
<h2 id="&#x7531;template&#x7F16;&#x8BD1;&#x540E;&#x7684;render&#x51FD;&#x6570;"><a href="#&#x7531;template&#x7F16;&#x8BD1;&#x540E;&#x7684;render&#x51FD;&#x6570;" class="headerlink" title="&#x7531;template&#x7F16;&#x8BD1;&#x540E;&#x7684;render&#x51FD;&#x6570;"></a>&#x7531;<code>template</code>&#x7F16;&#x8BD1;&#x540E;&#x7684;<code>render</code>&#x51FD;&#x6570;</h2><p>&#x6211;&#x4EEC;&#x5148;&#x6765;&#x770B;&#x770B;&#x539F;&#x672C;<code>template</code>&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xml&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;template&gt;</span><br><span class="line">  &lt;h1&gt;{{ title }}&lt;/h1&gt;</span><br><span class="line">  &lt;h1&gt;{{ msg }}&lt;/h1&gt;</span><br><span class="line">  &lt;Child /&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<p>&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;&#x770B;&#x7531;<code>template</code>&#x7F16;&#x8BD1;&#x6210;&#x7684;<code>render</code>&#x51FD;&#x6570;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">php&#x590D;&#x5236;&#x4EE3;&#x7801;import {</span><br><span class="line">  toDisplayString as _toDisplayString,</span><br><span class="line">  createElementVNode as _createElementVNode,</span><br><span class="line">  createVNode as _createVNode,</span><br><span class="line">  Fragment as _Fragment,</span><br><span class="line">  openBlock as _openBlock,</span><br><span class="line">  createElementBlock as _createElementBlock,</span><br><span class="line">} from &quot;vue&quot;;</span><br><span class="line">function render(_ctx, _cache, $props, $setup, $data, $options) {</span><br><span class="line">  return (</span><br><span class="line">    _openBlock(),</span><br><span class="line">    _createElementBlock(</span><br><span class="line">      _Fragment,</span><br><span class="line">      null,</span><br><span class="line">      [</span><br><span class="line">        _createElementVNode(&quot;h1&quot;, null, _toDisplayString($setup.title)),</span><br><span class="line">        _createElementVNode(</span><br><span class="line">          &quot;h1&quot;,</span><br><span class="line">          null,</span><br><span class="line">          _toDisplayString($setup.msg),</span><br><span class="line">          1 /* TEXT */</span><br><span class="line">        ),</span><br><span class="line">        _createVNode($setup[&quot;Child&quot;]),</span><br><span class="line">      ],</span><br><span class="line">      64 /* STABLE_FRAGMENT */</span><br><span class="line">    )</span><br><span class="line">  );</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x6211;&#x4EEC;&#x8FD9;&#x6B21;&#x4E3B;&#x8981;&#x770B;&#x5728;<code>render</code>&#x51FD;&#x6570;&#x4E2D;&#x5982;&#x4F55;&#x8BBF;&#x95EE;<code>setup</code>&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x9876;&#x5C42;&#x53D8;&#x91CF;<code>title</code>&#x3001;<code>msg</code>&#xFF0C;<code>createElementBlock</code>&#x548C;<code>createElementVNode</code>&#x7B49;&#x521B;&#x5EFA;&#x865A;&#x62DF;DOM&#x7684;&#x51FD;&#x6570;&#x4E0D;&#x5728;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x7684;&#x8BA8;&#x8BBA;&#x8303;&#x56F4;&#x5185;&#x3002;&#x4F60;&#x53EA;&#x9700;&#x8981;&#x77E5;&#x9053;<code>createElementVNode(&quot;h1&quot;, null, _toDisplayString($setup.title))</code>&#x4E3A;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;<code>h1</code>&#x6807;&#x7B7E;&#x7684;&#x865A;&#x62DF;DOM&#x5C31;&#x884C;&#x4E86;&#x3002;</p>
<p>&#x5728;<code>render</code>&#x51FD;&#x6570;&#x4E2D;&#x6211;&#x4EEC;&#x53D1;&#x73B0;&#x8BFB;&#x53D6;<code>title</code>&#x53D8;&#x91CF;&#x7684;&#x503C;&#x662F;&#x901A;&#x8FC7;<code>$setup.title</code>&#x8BFB;&#x53D6;&#x5230;&#x7684;&#xFF0C;&#x8BFB;&#x53D6;<code>msg</code>&#x53D8;&#x91CF;&#x7684;&#x503C;&#x662F;&#x901A;&#x8FC7;<code>$setup.msg</code>&#x8BFB;&#x53D6;&#x5230;&#x7684;&#x3002;&#x8FD9;&#x4E2A;<code>$setup</code>&#x5BF9;&#x8C61;&#x5C31;&#x662F;&#x8C03;&#x7528;<code>render</code>&#x51FD;&#x6570;&#x65F6;&#x4F20;&#x5165;&#x7684;&#x7B2C;&#x56DB;&#x4E2A;&#x53D8;&#x91CF;&#xFF0C;&#x6211;&#x60F3;&#x4F60;&#x5E94;&#x8BE5;&#x731C;&#x51FA;&#x6765;&#x4E86;&#xFF0C;&#x8FD9;&#x4E2A;<code>$setup</code>&#x5BF9;&#x8C61;&#x548C;&#x524D;&#x9762;&#x7684;<code>setup</code>&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x7684;&#x5BF9;&#x8C61;&#x6709;&#x5173;&#x7CFB;&#x3002;</p>
<p>&#x90A3;&#x4E48;&#x95EE;&#x9898;&#x6765;&#x4E86;&#xFF0C;&#x5728;&#x6267;&#x884C;<code>render</code>&#x51FD;&#x6570;&#x7684;&#x65F6;&#x5019;&#x662F;&#x5982;&#x4F55;&#x5C06;<code>setup</code>&#x65B9;&#x6CD5;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x4F5C;&#x4E3A;&#x7B2C;&#x56DB;&#x4E2A;&#x53D8;&#x91CF;&#x4F20;&#x9012;&#x7ED9;<code>render</code>&#x51FD;&#x6570;&#x7684;&#x5462;&#xFF1F;&#x6211;&#x5728;&#x4E0B;&#x4E00;&#x8282;&#x4F1A;&#x4E00;&#x6B65;&#x4E00;&#x6B65;&#x7684;&#x5E26;&#x4F60;&#x901A;&#x8FC7;<code>debug</code>&#x6E90;&#x7801;&#x7684;&#x65B9;&#x5F0F;&#x53BB;&#x641E;&#x6E05;&#x695A;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x4EEC;&#x5E26;&#x7740;&#x95EE;&#x9898;&#x53BB;<code>debug</code>&#x6E90;&#x7801;&#x5176;&#x5B9E;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x3002;</p>
<h1 id="debug&#x6E90;&#x7801;&#x641E;&#x6E05;&#x695A;&#x662F;&#x5982;&#x4F55;&#x8C03;&#x7528;render&#x51FD;&#x6570;"><a href="#debug&#x6E90;&#x7801;&#x641E;&#x6E05;&#x695A;&#x662F;&#x5982;&#x4F55;&#x8C03;&#x7528;render&#x51FD;&#x6570;" class="headerlink" title="debug&#x6E90;&#x7801;&#x641E;&#x6E05;&#x695A;&#x662F;&#x5982;&#x4F55;&#x8C03;&#x7528;render&#x51FD;&#x6570;"></a><code>debug</code>&#x6E90;&#x7801;&#x641E;&#x6E05;&#x695A;&#x662F;&#x5982;&#x4F55;&#x8C03;&#x7528;<code>render</code>&#x51FD;&#x6570;</h1><p>&#x6709;&#x7684;&#x5C0F;&#x4F19;&#x4F34;&#x770B;&#x5230;&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x770B;&#x6E90;&#x7801;&#x5C31;&#x89C9;&#x5F97;&#x5934;&#x5927;&#x4E86;&#xFF0C;&#x522B;&#x7740;&#x6025;&#xFF0C;&#x5176;&#x5B9E;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x6211;&#x4F1A;&#x4E00;&#x6B65;&#x4E00;&#x6B65;&#x7684;&#x5E26;&#x7740;&#x4F60;&#x53BB;debug&#x6E90;&#x7801;&#x3002;</p>
<p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x5C06;<code>Enable JavaScript source maps</code>&#x7ED9;&#x53D6;&#x6D88;&#x52FE;&#x9009;&#x4E86;&#xFF0C;&#x4E0D;&#x7136;&#x5728;debug&#x6E90;&#x7801;&#x7684;&#x65F6;&#x5019;&#x65AD;&#x70B9;&#x5C31;&#x4F1A;&#x8D70;&#x5230;<code>vue</code>&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x8D70;&#x5230;&#x7F16;&#x8BD1;&#x4F1A;&#x7684;js&#x6587;&#x4EF6;&#x4E2D;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/ba4c68fb95db5a9aaaea02de5a8de57e3d11bbb8759b0b5bcd325d80dc7ddb12" alt="sourceMap.png"></p>
<p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5728;&#x8BBE;&#x7F6E;&#x91CC;&#x9762;&#x7684;Ignore List&#x770B;&#x770B;<code>node_modules</code>&#x6587;&#x4EF6;&#x5939;&#x662F;&#x5426;&#x88AB;&#x5FFD;&#x7565;&#x3002;&#x65B0;&#x7248;&#x8C37;&#x6B4C;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x4F1A;&#x9ED8;&#x8BA4;&#x6392;&#x9664;&#x6389;<code>node_modules</code>&#x6587;&#x4EF6;&#x5939;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5C06;&#x8FD9;&#x4E2A;&#x53D6;&#x6D88;&#x52FE;&#x9009;&#x3002;&#x5982;&#x679C;&#x5FFD;&#x7565;&#x4E86;<code>node_modules</code>&#x6587;&#x4EF6;&#x5939;&#xFF0C;&#x90A3;&#x4E48;<code>debug</code>&#x7684;&#x65F6;&#x5019;&#x65AD;&#x70B9;&#x5C31;&#x4E0D;&#x4F1A;&#x8D70;&#x5230;<code>node_modules</code>&#x4E2D;<code>vue</code>&#x7684;&#x6E90;&#x7801;&#x4E2D;&#x53BB;&#x4E86;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/b6bf5c371f2af60a0b7e2e1dcf9ec27dcade4a9b5473fdda72eb334eff8a452c" alt="ignoreList.png"></p>
<p>&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x627E;&#x5230;vue&#x6587;&#x4EF6;&#x7F16;&#x8BD1;&#x540E;&#x7684;js&#x4EE3;&#x7801;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x5728;<code>network</code>&#x9762;&#x677F;&#x4E2D;&#x627E;&#x5230;&#x8FD9;&#x4E2A;<code>vue</code>&#x6587;&#x4EF6;&#x7684;<code>http</code>&#x8BF7;&#x6C42;&#xFF0C;&#x7136;&#x540E;&#x5728;<code>Response</code>&#x4E0B;&#x53F3;&#x952E;&#x9009;&#x62E9;<code>Open in Sources panel</code>&#xFF0C;&#x5C31;&#x4F1A;&#x81EA;&#x52A8;&#x5728;<code>sources</code>&#x9762;&#x677F;&#x81EA;&#x52A8;&#x6253;&#x5F00;&#x5BF9;&#x5E94;&#x7F16;&#x8BD1;&#x540E;&#x7684;js&#x6587;&#x4EF6;&#x4EE3;&#x7801;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/4f854fb4cfad4abfbde695d7a65b825735b25538aece513a2bb18f7583cd65d3" alt="network.png"></p>
<p>&#x627E;&#x5230;&#x7F16;&#x8BD1;&#x540E;&#x7684;js&#x6587;&#x4EF6;&#xFF0C;&#x6211;&#x4EEC;&#x60F3;<code>debug</code>&#x770B;&#x770B;&#x662F;&#x5982;&#x4F55;&#x8C03;&#x7528;<code>render</code>&#x51FD;&#x6570;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x7ED9;render&#x51FD;&#x6570;&#x52A0;&#x4E00;&#x4E2A;&#x65AD;&#x70B9;&#x3002;&#x7136;&#x540E;&#x5237;&#x65B0;&#x9875;&#x9762;&#xFF0C;&#x53D1;&#x73B0;&#x4EE3;&#x7801;&#x5DF2;&#x7ECF;&#x8D70;&#x5230;&#x4E86;&#x65AD;&#x70B9;&#x7684;&#x5730;&#x65B9;&#x3002;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;&#x770B;&#x53F3;&#x8FB9;&#x7684;Call Stack&#x8C03;&#x7528;&#x6808;&#xFF0C;&#x53D1;&#x73B0;<code>render</code>&#x51FD;&#x6570;&#x662F;&#x7531;&#x4E00;&#x4E2A;<code>vue</code>&#x6E90;&#x7801;&#x4E2D;&#x7684;<code>renderComponentRoot</code>&#x51FD;&#x6570;&#x8C03;&#x7528;&#x7684;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/b539d4db60f54251a9b4bad7f42d31a441a54ae241700dca19fdcaec35c2728f" alt="render.png"></p>
<p>&#x70B9;&#x51FB;Call Stack&#x4E2D;&#x7684;<code>renderComponentRoot</code>&#x51FD;&#x6570;&#x5C31;&#x53EF;&#x4EE5;&#x8DF3;&#x8F6C;&#x5230;<code>renderComponentRoot</code>&#x51FD;&#x6570;&#x7684;&#x6E90;&#x7801;&#xFF0C;&#x6211;&#x4EEC;&#x53D1;&#x73B0;<code>renderComponentRoot</code>&#x51FD;&#x6570;&#x4E2D;&#x8C03;&#x7528;<code>render</code>&#x51FD;&#x6570;&#x7684;&#x4EE3;&#x7801;&#x4E3B;&#x8981;&#x662F;&#x4E0B;&#x9762;&#x8FD9;&#x6837;&#x7684;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">javascript&#x590D;&#x5236;&#x4EE3;&#x7801;function renderComponentRoot(instance) {</span><br><span class="line">  const {</span><br><span class="line">    props,</span><br><span class="line">    data,</span><br><span class="line">    setupState,</span><br><span class="line">    // &#x7701;&#x7565;...</span><br><span class="line">  } = instance;</span><br><span class="line"></span><br><span class="line">  render2.call(</span><br><span class="line">    thisProxy,</span><br><span class="line">    proxyToUse,</span><br><span class="line">    renderCache,</span><br><span class="line">    props,</span><br><span class="line">    setupState,</span><br><span class="line">    data,</span><br><span class="line">    ctx</span><br><span class="line">  )</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x524D;&#x9762;&#x7684;<code>$setup</code>&#x5B9E;&#x9645;&#x5C31;&#x662F;&#x7531;<code>setupState</code>&#x8D4B;&#x503C;&#x7684;&#xFF0C;&#x800C;<code>setupState</code>&#x662F;&#x5F53;&#x524D;vue&#x5B9E;&#x4F8B;&#x4E0A;&#x9762;&#x7684;&#x4E00;&#x4E2A;&#x5C5E;&#x6027;&#x3002;&#x90A3;&#x4E48;<code>setupState</code>&#x5C5E;&#x6027;&#x662F;&#x5982;&#x4F55;&#x88AB;&#x8D4B;&#x503C;&#x5230;<code>vue</code>&#x5B9E;&#x4F8B;&#x4E0A;&#x9762;&#x7684;&#x5462;&#xFF1F;</p>
<p>&#x6211;&#x4EEC;&#x9700;&#x8981;&#x7ED9;<code>setup</code>&#x51FD;&#x6570;&#x52A0;&#x4E00;&#x4E2A;&#x65AD;&#x70B9;&#xFF0C;&#x7136;&#x540E;&#x5237;&#x65B0;&#x9875;&#x9762;&#x8FDB;&#x5165;&#x65AD;&#x70B9;&#x3002;&#x901A;&#x8FC7;&#x5206;&#x6790;Call Stack&#x8C03;&#x7528;&#x6808;&#xFF0C;&#x6211;&#x4EEC;&#x53D1;&#x73B0;<code>setup</code>&#x51FD;&#x6570;&#x662F;&#x7531;<code>vue</code>&#x4E2D;&#x7684;&#x4E00;&#x4E2A;<code>setupStatefulComponent</code>&#x51FD;&#x6570;&#x8C03;&#x7528;&#x6267;&#x884C;&#x7684;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/fec9c65b548826ebcae014d8ed15cf097a37bf30f77cc6a8b6d7f01780b27013" alt="setup.png"></p>
<p>&#x70B9;&#x51FB;Call Stack&#x8C03;&#x7528;&#x6808;&#x4E2D;&#x7684;<code>setupStatefulComponent</code>&#xFF0C;&#x8FDB;&#x5165;&#x5230;<code>setupStatefulComponent</code>&#x7684;&#x6E90;&#x7801;&#x3002;&#x6211;&#x4EEC;&#x770B;&#x5230;<code>setupStatefulComponent</code>&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#x4E3B;&#x8981;&#x662F;&#x8FD9;&#x6837;&#x7684;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">scss&#x590D;&#x5236;&#x4EE3;&#x7801;function setupStatefulComponent(instance) {</span><br><span class="line">  const { setup } = Component;</span><br><span class="line">  // &#x7701;&#x7565;</span><br><span class="line">  const setupResult = callWithErrorHandling(</span><br><span class="line">    setup,</span><br><span class="line">    instance</span><br><span class="line">  );</span><br><span class="line">  handleSetupResult(instance, setupResult);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><code>setup</code>&#x51FD;&#x6570;&#x662F;<code>Component</code>&#x4E0A;&#x9762;&#x7684;&#x4E00;&#x4E2A;&#x5C5E;&#x6027;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x9F20;&#x6807;&#x653E;&#x5230;<code>Component</code>&#x4E0A;&#x9762;&#xFF0C;&#x770B;&#x770B;&#x8FD9;&#x4E2A;<code>Component</code>&#x662F;&#x4EC0;&#x4E48;&#x4E1C;&#x897F;&#xFF1F;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/dfe860b9d1989d620d3f96bc6fbb0f7864f20042251d29d81978376328cf0a5a" alt="component.png"></p>
<p>&#x770B;&#x5230;&#x8FD9;&#x4E2A;<code>Component</code>&#x5BF9;&#x8C61;&#x4E2D;&#x65E2;&#x6709;<code>render</code>&#x65B9;&#x6CD5;&#x4E5F;&#x6709;<code>setup</code>&#x65B9;&#x6CD5;&#x662F;&#x4E0D;&#x662F;&#x611F;&#x89C9;&#x5F88;&#x719F;&#x6089;&#xFF0C;&#x6CA1;&#x9519;&#x8FD9;&#x4E2A;<code>Component</code>&#x5BF9;&#x8C61;&#x5B9E;&#x9645;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x7684;<code>vue</code>&#x6587;&#x4EF6;&#x7F16;&#x8BD1;&#x540E;&#x7684;js&#x5BF9;&#x8C61;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;const __sfc__ = {</span><br><span class="line">  __name: &quot;index&quot;,</span><br><span class="line">  setup() {</span><br><span class="line">    const msg = ref(&quot;Hello World!&quot;);</span><br><span class="line">    if (msg.value) {</span><br><span class="line">      const content = &quot;content&quot;;</span><br><span class="line">      console.log(content);</span><br><span class="line">    }</span><br><span class="line">    const __returned__ = { title, msg, Child };</span><br><span class="line">    return __returned__;</span><br><span class="line">  },</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">__sfc__.render = render;</span><br></pre></td></tr></table></figure>

<p>&#x4ECE;Component&#x5BF9;&#x8C61;&#x4E2D;&#x62FF;&#x5230;<code>setup</code>&#x51FD;&#x6570;&#xFF0C;&#x7136;&#x540E;&#x6267;&#x884C;<code>setup</code>&#x51FD;&#x6570;&#x5F97;&#x5230;<code>setupResult</code>&#x5BF9;&#x8C61;&#x3002;&#x7136;&#x540E;&#x518D;&#x8C03;&#x7528;<code>handleSetupResult(instance, setupResult);</code></p>
<p>&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;&#x770B;<code>handleSetupResult</code>&#x51FD;&#x6570;&#x662F;&#x4EC0;&#x4E48;&#x6837;&#x7684;&#xFF0C;&#x4E0B;&#x9762;&#x662F;&#x6211;&#x7B80;&#x5316;&#x540E;&#x7684;&#x4EE3;&#x7801;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">scss&#x590D;&#x5236;&#x4EE3;&#x7801;function handleSetupResult(instance, setupResult) {</span><br><span class="line">  if (isFunction(setupResult)) {</span><br><span class="line">    // &#x7701;&#x7565;</span><br><span class="line">  } else if (isObject(setupResult)) {</span><br><span class="line">    instance.setupState = proxyRefs(setupResult);</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x6211;&#x4EEC;&#x7684;<code>setup</code>&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x662F;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x4F1A;&#x6267;&#x884C;<code>instance.setupState = proxyRefs(setupResult)</code>&#xFF0C;&#x5C06;setup&#x6267;&#x884C;&#x540E;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x7ECF;&#x8FC7;<code>new Proxy</code>&#x5904;&#x7406;&#x540E;&#x8D4B;&#x503C;&#x5230;vue&#x5B9E;&#x4F8B;&#x7684;setupState&#x5C5E;&#x6027;&#x4E0A;&#xFF0C;&#x800C;<code>new Proxy</code>&#x4E2D;&#x7684;<code>get</code>&#x5C31;&#x662F;&#x7528;&#x4E8E;&#x5904;&#x7406;&#x5728;<code>template</code>&#x4E2D;&#x4F7F;&#x7528;<code>ref</code>&#x4E0D;&#x9700;&#x8981;&#x4F7F;&#x7528;<code>.value</code>&#x7684;&#x5199;&#x6CD5;&#x3002;</p>
<p>&#x770B;&#x5230;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x6574;&#x4E2A;&#x6D41;&#x7A0B;&#x5DF2;&#x7ECF;&#x53EF;&#x4EE5;&#x4E32;&#x8D77;&#x6765;&#x4E86;&#xFF0C;&#x9996;&#x5148;&#x4F1A;&#x6267;&#x884C;&#x7531;<code>setup</code>&#x8BED;&#x6CD5;&#x7CD6;&#x7F16;&#x8BD1;&#x540E;&#x7684;<code>setup</code>&#x51FD;&#x6570;&#x3002;&#x7136;&#x540E;&#x5C06;<code>setup</code>&#x51FD;&#x6570;&#x4E2D;&#x7531;&#x9876;&#x5C42;&#x53D8;&#x91CF;&#x548C;<code>import</code>&#x5BFC;&#x5165;&#x7EC4;&#x6210;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x5BF9;&#x8C61;&#x7ECF;&#x8FC7;<code>Proxy</code>&#x5904;&#x7406;&#x540E;&#x8D4B;&#x503C;&#x7ED9;<code>vue</code>&#x5B9E;&#x4F8B;&#x7684;<code>setupState</code>&#x5C5E;&#x6027;&#xFF0C;&#x7136;&#x540E;&#x6267;&#x884C;<code>render</code>&#x51FD;&#x6570;&#x7684;&#x65F6;&#x5019;&#x4ECE;<code>vue</code>&#x5B9E;&#x4F8B;&#x4E2D;&#x53D6;&#x51FA;<code>setupState</code>&#x5C5E;&#x6027;&#x4E5F;&#x5C31;&#x662F;<code>setup</code>&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x3002;&#x8FD9;&#x6837;&#x5728;<code>render</code>&#x51FD;&#x6570;&#x4E5F;&#x5C31;&#x662F;<code>template</code>&#x6A21;&#x7248;&#x5C31;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x5230;<code>setup</code>&#x4E2D;&#x7684;&#x9876;&#x5C42;&#x53D8;&#x91CF;&#x548C;<code>import</code>&#x5BFC;&#x5165;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/6d6c78cd19b4b99cdd8e414022990a38084f5979143f67009bcc83d4394ee199" alt="setup-progress.png"></p>
<p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x56DE;&#x7B54;&#x524D;&#x9762;&#x63D0;&#x7684;&#x53E6;&#x5916;&#x4E24;&#x4E2A;&#x95EE;&#x9898;&#x4E86;&#xFF1A;</p>
<p><strong>&#x4E3A;&#x4EC0;&#x4E48;&#x5728;<code>setup</code>&#x9876;&#x5C42;&#x5B9A;&#x4E49;&#x7684;&#x53D8;&#x91CF;&#x53EF;&#x4EE5;&#x5728;<code>template</code>&#x4E2D;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#xFF1F;</strong></p>
<p>&#x56E0;&#x4E3A;&#x5728;<code>setup</code>&#x8BED;&#x6CD5;&#x7CD6;&#x9876;&#x5C42;&#x5B9A;&#x4E49;&#x7684;&#x53D8;&#x91CF;&#x7ECF;&#x8FC7;&#x7F16;&#x8BD1;&#x540E;&#x4F1A;&#x88AB;&#x52A0;&#x5165;&#x5230;<code>setup</code>&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x503C;&#x5BF9;&#x8C61;<code>__returned__</code>&#x4E2D;&#xFF0C;&#x800C;&#x975E;<code>setup</code>&#x9876;&#x5C42;&#x5B9A;&#x4E49;&#x7684;&#x53D8;&#x91CF;&#x4E0D;&#x4F1A;&#x52A0;&#x5165;&#x5230;<code>__returned__</code>&#x5BF9;&#x8C61;&#x4E2D;&#x3002;<code>setup</code>&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x503C;&#x7ECF;&#x8FC7;<code>Proxy</code>&#x5904;&#x7406;&#x540E;&#x4F1A;&#x88AB;&#x585E;&#x5230;<code>vue</code>&#x5B9E;&#x4F8B;&#x7684;<code>setupState</code>&#x5C5E;&#x6027;&#x4E0A;&#xFF0C;&#x6267;&#x884C;<code>render</code>&#x51FD;&#x6570;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x5C06;<code>vue</code>&#x5B9E;&#x4F8B;&#x4E0A;&#x7684;<code>setupState</code>&#x5C5E;&#x6027;&#x4F20;&#x9012;&#x7ED9;<code>render</code>&#x51FD;&#x6570;&#xFF0C;&#x6240;&#x4EE5;&#x5728;<code>render</code>&#x51FD;&#x6570;&#x4E2D;&#x5C31;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x5230;<code>setup</code>&#x9876;&#x5C42;&#x5B9A;&#x4E49;&#x7684;&#x53D8;&#x91CF;&#x548C;<code>import</code>&#x5BFC;&#x5165;&#x3002;&#x800C;<code>render</code>&#x51FD;&#x6570;&#x5B9E;&#x9645;&#x5C31;&#x662F;&#x7531;<code>template</code>&#x7F16;&#x8BD1;&#x5F97;&#x6765;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x8BF4;&#x5728;<code>template</code>&#x4E2D;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x5230;<code>setup</code>&#x9876;&#x5C42;&#x5B9A;&#x4E49;&#x7684;&#x53D8;&#x91CF;&#x548C;<code>import</code>&#x5BFC;&#x5165;&#x3002;&#x3002;</p>
<p><strong>&#x4E3A;&#x4EC0;&#x4E48;<code>import</code>&#x4E00;&#x4E2A;&#x7EC4;&#x4EF6;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#xFF0C;&#x65E0;&#x9700;&#x4F7F;&#x7528;<code>components</code> &#x9009;&#x9879;&#x6765;&#x663E;&#x5F0F;&#x6CE8;&#x518C;&#x7EC4;&#x4EF6;&#xFF1F;</strong></p>
<p>&#x56E0;&#x4E3A;&#x5728;<code>setup</code>&#x8BED;&#x6CD5;&#x7CD6;&#x4E2D;<code>import</code>&#x5BFC;&#x5165;&#x7684;&#x7EC4;&#x4EF6;&#x5BF9;&#x8C61;&#x7ECF;&#x8FC7;&#x7F16;&#x8BD1;&#x540E;&#x540C;&#x6837;&#x4E5F;&#x4F1A;&#x88AB;&#x52A0;&#x5165;&#x5230;<code>setup</code>&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x503C;&#x5BF9;&#x8C61;<code>__returned__</code>&#x4E2D;&#xFF0C;&#x540C;&#x7406;&#x5728;<code>template</code>&#x4E2D;&#x4E5F;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x5230;<code>setup</code>&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x5BF9;&#x8C61;&#xFF0C;&#x4E5F;&#x5C31;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x5BFC;&#x5165;&#x7684;&#x7EC4;&#x4EF6;&#x4E86;&#x3002;</p>
<h1 id="&#x603B;&#x7ED3;"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3;</h1><p><code>setup</code>&#x8BED;&#x6CD5;&#x7CD6;&#x7ECF;&#x8FC7;&#x7F16;&#x8BD1;&#x540E;&#x5C31;&#x53D8;&#x6210;&#x4E86;<code>setup</code>&#x51FD;&#x6570;&#xFF0C;&#x800C;<code>setup</code>&#x51FD;&#x6570;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x662F;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#xFF0C;&#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;&#x5C31;&#x662F;&#x7531;&#x5728;<code>setup</code>&#x9876;&#x5C42;&#x5B9A;&#x4E49;&#x7684;&#x53D8;&#x91CF;&#x548C;<code>import</code>&#x5BFC;&#x5165;&#x7EC4;&#x6210;&#x7684;&#x3002;<code>vue</code>&#x5728;&#x521D;&#x59CB;&#x5316;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x6267;&#x884C;<code>setup</code>&#x51FD;&#x6570;&#xFF0C;&#x7136;&#x540E;&#x5C06;<code>setup</code>&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x503C;&#x7ECF;&#x8FC7;<code>Proxy</code>&#x5904;&#x7406;&#x540E;&#x585E;&#x5230;<code>vue</code>&#x5B9E;&#x4F8B;&#x7684;<code>setupState</code>&#x5C5E;&#x6027;&#x4E0A;&#x3002;&#x6267;&#x884C;<code>render</code>&#x51FD;&#x6570;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x5C06;<code>vue</code>&#x5B9E;&#x4F8B;&#x4E0A;&#x7684;<code>setupState</code>&#x5C5E;&#x6027;&#xFF08;&#x4E5F;&#x5C31;&#x662F;<code>setup</code>&#x51FD;&#x6570;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#xFF09;&#x4F20;&#x9012;&#x7ED9;<code>render</code>&#x51FD;&#x6570;&#xFF0C;&#x6240;&#x4EE5;&#x5728;<code>render</code>&#x51FD;&#x6570;&#x4E2D;&#x5C31;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x5230;<code>setup</code>&#x9876;&#x5C42;&#x5B9A;&#x4E49;&#x7684;&#x53D8;&#x91CF;&#x548C;<code>import</code>&#x5BFC;&#x5165;&#x3002;&#x800C;<code>render</code>&#x51FD;&#x6570;&#x5B9E;&#x9645;&#x5C31;&#x662F;&#x7531;<code>template</code>&#x7F16;&#x8BD1;&#x5F97;&#x6765;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x8BF4;&#x5728;<code>template</code>&#x4E2D;&#x5C31;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x5230;<code>setup</code>&#x9876;&#x5C42;&#x5B9A;&#x4E49;&#x7684;&#x53D8;&#x91CF;&#x548C;<code>import</code>&#x5BFC;&#x5165;&#x3002;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/1ce8d14677c354ad46e6aa777e2a2a5f.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7338808893529440267.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7338808893529440267.html" itemprop="url">【Android 13源码分析】WindowContaine</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-02-25T20:55:22+08:00">
                2024-02-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x5728;&#x5B89;&#x5353;&#x6E90;&#x7801;&#x7684;&#x8BBE;&#x8BA1;&#x4E2D;&#xFF0C;&#x5C06;&#x5C06;&#x5C4F;&#x5E55;&#x5206;&#x4E3A;&#x4E86;37&#x5C42;&#xFF0C;&#x4E0D;&#x540C;&#x7684;&#x7A97;&#x53E3;&#x5C06;&#x5728;&#x4E0D;&#x540C;&#x7684;&#x5C42;&#x7EA7;&#x4E2D;&#x663E;&#x793A;&#x3002;<br>&#x5BF9;&#x8FD9;&#x4E00;&#x5757;&#x7684;&#x6982;&#x5FF5;&#x4EE5;&#x53CA;&#x76F8;&#x5173;&#x6E90;&#x7801;&#x505A;&#x4E86;&#x8BE6;&#x7EC6;&#x5206;&#x6790;&#xFF0C;&#x6574;&#x7406;&#x51FA;&#x4EE5;&#x4E0B;&#x51E0;&#x7BC7;&#x3002;</p>
<p><a href="https://dev.newban.cn/7339827208086896676">&#x3010;Android 13&#x6E90;&#x7801;&#x5206;&#x6790;&#x3011;WindowContainer&#x7A97;&#x53E3;&#x5C42;&#x7EA7;-1-&#x521D;&#x8BC6;&#x7A97;&#x53E3;&#x5C42;&#x7EA7;&#x6811;</a></p>
<p><a href="https://dev.newban.cn/7338808893529423883">&#x3010;Android 13&#x6E90;&#x7801;&#x5206;&#x6790;&#x3011;WindowContainer&#x7A97;&#x53E3;&#x5C42;&#x7EA7;-2-&#x6784;&#x5EFA;&#x6D41;&#x7A0B;</a></p>
<p><a href="https://dev.newban.cn/7338808893529440267">&#x3010;Android 13&#x6E90;&#x7801;&#x5206;&#x6790;&#x3011;WindowContainer&#x7A97;&#x53E3;&#x5C42;&#x7EA7;-3-&#x5B9E;&#x4F8B;&#x5206;&#x6790;</a></p>
<p>&#x5F53;&#x524D;&#x4E3A;&#x7B2C;&#x4E09;&#x7BC7;&#xFF0C;&#x4EE5;&#x5E94;&#x7528;&#x7A97;&#x53E3;&#x548C;&#x7CFB;&#x7EDF;&#x7A97;&#x53E3;2&#x5927;&#x7C7B;&#x578B;&#x7A97;&#x53E3;&#x7684;&#x6302;&#x8F7D;&#x4E3A;&#x4F8B;&#x4ECB;&#x7ECD;&#x7A97;&#x53E3;&#x662F;&#x5982;&#x4F55;&#x6302;&#x8F7D;&#x5230;&#x5C42;&#x7EA7;&#x6811;&#x4E2D;&#x7684;&#x3002;<br>&#x8FD9;&#x7BC7;&#x770B;&#x5B8C;&#x5BF9;AOSP&#x4E2D;&#x6574;&#x4E2A;&#x7A97;&#x53E3;&#x6811;&#x5C31;&#x6709;&#x4E86;&#x6BD4;&#x8F83;&#x5B8C;&#x6574;&#x7684;&#x4E86;&#x89E3;&#x3002;</p>
<ol>
<li><h1 id="&#x5E94;&#x7528;&#x7A97;&#x53E3;&#x6302;&#x8F7D;"><a href="#&#x5E94;&#x7528;&#x7A97;&#x53E3;&#x6302;&#x8F7D;" class="headerlink" title="&#x5E94;&#x7528;&#x7A97;&#x53E3;&#x6302;&#x8F7D;"></a>&#x5E94;&#x7528;&#x7A97;&#x53E3;&#x6302;&#x8F7D;</h1></li>
</ol>
<p>&#x5E94;&#x7528;&#x542F;&#x52A8;&#x6D41;&#x7A0B;&#x4E2D;&#x4F1A;&#x89E6;&#x53D1;ActivityRecord&#xFF0C;Task&#xFF0C;WindowState&#x7684;&#x521B;&#x5EFA;&#x4E0E;&#x6302;&#x8F7D;&#xFF0C;&#x5176;&#x4E2D;WindowState&#x7684;&#x5904;&#x7406;&#x4E0A;&#x5728;addWindow&#x6D41;&#x7A0B;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/686ffa1fd70245c8a85976f3ae3ab26f2b53247f5775327b4fc0c9944c3805cc" alt="&#x4F01;&#x4E1A;&#x5FAE;&#x4FE1;&#x622A;&#x56FE;_17089400658325.png"></p>
<h2 id="1-1-ActivityRecord&#x7684;&#x521B;&#x5EFA;"><a href="#1-1-ActivityRecord&#x7684;&#x521B;&#x5EFA;" class="headerlink" title="1.1 ActivityRecord&#x7684;&#x521B;&#x5EFA;"></a>1.1 ActivityRecord&#x7684;&#x521B;&#x5EFA;</h2><p>&#x542F;&#x52A8;&#x6D41;&#x7A0B;&#x5F00;&#x59CB;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x6267;&#x884C;&#x5230;ActivityStarter::executeRequest&#xFF0C;&#x5728;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x91CC;&#x4F1A;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;ActivityRecord</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">scss&#x590D;&#x5236;&#x4EE3;&#x7801;# ActivityStarter</span><br><span class="line">  private int executeRequest(Request request) {</span><br><span class="line">        ......</span><br><span class="line">        final ActivityRecord r = new ActivityRecord.Builder(mService)</span><br><span class="line">                .setCaller(callerApp)</span><br><span class="line">                .setLaunchedFromPid(callingPid)</span><br><span class="line">                .setLaunchedFromUid(callingUid)</span><br><span class="line">                .setLaunchedFromPackage(callingPackage)</span><br><span class="line">                .setLaunchedFromFeature(callingFeatureId)</span><br><span class="line">                .setIntent(intent)</span><br><span class="line">                .setResolvedType(resolvedType)</span><br><span class="line">                .setActivityInfo(aInfo)</span><br><span class="line">                .setConfiguration(mService.getGlobalConfiguration())</span><br><span class="line">                .setResultTo(resultRecord)</span><br><span class="line">                .setResultWho(resultWho)</span><br><span class="line">                .setRequestCode(requestCode)</span><br><span class="line">                .setComponentSpecified(request.componentSpecified)</span><br><span class="line">                .setRootVoiceInteraction(voiceSession != null)</span><br><span class="line">                .setActivityOptions(checkedOptions)</span><br><span class="line">                .setSourceRecord(sourceRecord)</span><br><span class="line">                .build();</span><br><span class="line">        ......</span><br><span class="line">        // &#x7EE7;&#x7EED;&#x6267;&#x884C;startActivityUnchecked</span><br><span class="line">        mLastStartActivityResult = startActivityUnchecked(r, sourceRecord, voiceSession,</span><br><span class="line">                request.voiceInteractor, startFlags, true /* doResume */, checkedOptions,</span><br><span class="line">                inTask, inTaskFragment, restrictedBgActivity, intentGrants);</span><br><span class="line">        ......</span><br><span class="line">  }</span><br></pre></td></tr></table></figure>

<p>tips: ActivityRecord&#x7684;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x4F1A;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;Token,&#x8FD9;&#x4E2A;token&#x5C31;&#x662F;&#x9605;&#x8BFB;&#x6E90;&#x7801;&#x7ECF;&#x5E38;&#x770B;&#x5230;&#x770B;&#x5230;&#x4EE3;&#x8868;activity&#x7684;&#x90A3;&#x4E2A;token&#x3002;</p>
<h2 id="1-2-Task&#x7684;&#x521B;&#x5EFA;&#x4E0E;&#x6302;&#x8F7D;"><a href="#1-2-Task&#x7684;&#x521B;&#x5EFA;&#x4E0E;&#x6302;&#x8F7D;" class="headerlink" title="1.2 Task&#x7684;&#x521B;&#x5EFA;&#x4E0E;&#x6302;&#x8F7D;"></a>1.2 Task&#x7684;&#x521B;&#x5EFA;&#x4E0E;&#x6302;&#x8F7D;</h2><p>&#x6D41;&#x7A0B;&#x5F00;&#x59CB;&#x4F1A;&#x6267;&#x884C;&#x5230;ActivityStarter::startActivityInner&#x65B9;&#x6CD5;&#xFF0C;&#x5728;&#x8FD9;&#x91CC;&#x4F1A;&#x6267;&#x884C;ActivityStarter::getOrCreateRootTask&#x65B9;&#x6CD5;&#x6765;&#x521B;&#x5EFA;&#xFF08;&#x83B7;&#x53D6;&#xFF09;&#x4E00;&#x4E2A;Task</p>
<p><strong>&#x8C03;&#x7528;&#x94FE;&#x5982;&#x4E0B;&#xFF1A;</strong></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/ac53ed5faec4ea73d84ecfa56f714c75a466096d9d84bd4afec1568b73419d2f" alt="&#x4F01;&#x4E1A;&#x5FAE;&#x4FE1;&#x622A;&#x56FE;_17089401943071.png"></p>
<p><strong>&#x4E3B;&#x6D41;&#x7A0B;&#x4EE3;&#x7801;</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line">less&#x590D;&#x5236;&#x4EE3;&#x7801;# ActivityStarter</span><br><span class="line">    private Task getOrCreateRootTask(ActivityRecord r, int launchFlags, Task task,</span><br><span class="line">            ActivityOptions aOptions) {</span><br><span class="line">        final boolean onTop =</span><br><span class="line">                (aOptions == null || !aOptions.getAvoidMoveToFront()) &amp;&amp; !mLaunchTaskBehind;</span><br><span class="line">        final Task sourceTask = mSourceRecord != null ? mSourceRecord.getTask() : null;</span><br><span class="line">        return mRootWindowContainer.getOrCreateRootTask(r, aOptions, task, sourceTask, onTop,</span><br><span class="line">                mLaunchParams, launchFlags);</span><br><span class="line">    }</span><br><span class="line">// onTop &#x8868;&#x793A;&#x662F;&#x5426;&#x8981;&#x79FB;&#x5230;&#x5230;&#x5F53;&#x524D;&#x6808;&#x9876;&#xFF0C;&#x90A3;&#x80AF;&#x5B9A;&#x662F;&#x8981;&#x7684;&#xFF0C;&#x65B0;&#x542F;&#x52A8;&#x7684;Activity&#x5F53;&#x524D;&#x8981;&#x518D;&#x6700;&#x4E0A;&#x9762;&#xFF0C;&#x8FD9;&#x91CC; aOptions &#x4E3A;null&#xFF0C;&#x6240;&#x4EE5;&#x4E3A;true</span><br><span class="line">// sourceTask &#x8868;&#x793A;&#x4ECE;&#x54EA;&#x91CC;&#x542F;&#x52A8;&#x7684;&#xFF0C;&#x5F53;&#x524D;launch&#x6240;&#x5728;&#x7684;Task &#x5C31;&#x662F;sourceTask</span><br><span class="line"></span><br><span class="line"># RootWindowContainer</span><br><span class="line">    Task getOrCreateRootTask(@Nullable ActivityRecord r, @Nullable ActivityOptions options,</span><br><span class="line">            @Nullable Task candidateTask, boolean onTop) {</span><br><span class="line">        return getOrCreateRootTask(r, options, candidateTask, null /* sourceTask */, onTop,</span><br><span class="line">                null /* launchParams */, 0 /* launchFlags */);</span><br><span class="line">    }</span><br><span class="line">    Task getOrCreateRootTask(@Nullable ActivityRecord r,</span><br><span class="line">            @Nullable ActivityOptions options, @Nullable Task candidateTask,</span><br><span class="line">            @Nullable Task sourceTask, boolean onTop,</span><br><span class="line">            @Nullable LaunchParamsController.LaunchParams launchParams, int launchFlags) {</span><br><span class="line">            ......</span><br><span class="line">            final int activityType = resolveActivityType(r, options, candidateTask);</span><br><span class="line">            if (taskDisplayArea != null) {</span><br><span class="line">                if (canLaunchOnDisplay(r, taskDisplayArea.getDisplayId())) {</span><br><span class="line">                    // &#x91CD;&#x70B9;*1. &#x4F20;&#x9012;&#x5230;TaskDisplayArea</span><br><span class="line">                    return taskDisplayArea.getOrCreateRootTask(r, options, candidateTask,</span><br><span class="line">                            sourceTask, launchParams, launchFlags, activityType, onTop);</span><br><span class="line">                } else {</span><br><span class="line">                    taskDisplayArea = null;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            ......</span><br><span class="line">    }</span><br><span class="line">// &#x7ECF;&#x8FC7;&#x540C;&#x540D;&#x8C03;&#x7528;&#x540E;&#xFF0C;&#x903B;&#x8F91;&#x8FDB;&#x5165;&#x5230;  TaskDisplayArea</span><br><span class="line"></span><br><span class="line"># TaskDisplayArea</span><br><span class="line">    Task getOrCreateRootTask(int windowingMode, int activityType, boolean onTop,</span><br><span class="line">            @Nullable Task candidateTask, @Nullable Task sourceTask,</span><br><span class="line">            @Nullable ActivityOptions options, int launchFlags) {</span><br><span class="line">            if(....) {</span><br><span class="line">                // &#x62FF;&#x5230;&#x4E4B;&#x524D;&#x521B;&#x5EFA;&#x7684;Task</span><br><span class="line">                return candidateTask.getRootTask();</span><br><span class="line">            }</span><br><span class="line">            ......// &#x7B2C;&#x4E00;&#x6B21;&#x663E;&#x793A;&#x6240;&#x4EE5;&#x662F;&#x65B0;&#x5EFA;Task</span><br><span class="line">            return new Task.Builder(mAtmService)</span><br><span class="line">                .setWindowingMode(windowingMode)</span><br><span class="line">                .setActivityType(activityType)</span><br><span class="line">                .setOnTop(onTop)</span><br><span class="line">                .setParent(this)  // &#x4E3B;&#x8981;&#x8FD9;&#x4E2A;this&#x88AB;&#x8BBE;&#x7F6E;&#x4E3A;Parent&#x3002;&#x6240;&#x4EE5;&#x76F4;&#x63A5;&#x6302;&#x8F7D;&#x5230;&#x4E86;DefaultTaskDisplayArea&#x4E0B;</span><br><span class="line">                .setSourceTask(sourceTask)</span><br><span class="line">                .setActivityOptions(options)</span><br><span class="line">                .setLaunchFlags(launchFlags)</span><br><span class="line">                .build();</span><br><span class="line">    }</span><br><span class="line">// &#x770B;&#x65B9;&#x6CD5;&#x540D;&#x662F;&#x83B7;&#x53D6;&#x6216;&#x521B;&#x5EFA;Task, &#x8FD9;&#x8FB9;&#x662F;&#x65B0;&#x542F;&#x52A8;&#x7684;Activity&#x6240;&#x4EE5;&#x9700;&#x8981;&#x521B;&#x5EFA;Task&#x3002;&#x5982;&#x679C;&#x662F;&#x4EE5;&#x9ED8;&#x8BA4;&#x542F;&#x52A8;&#x65B9;&#x5F0F;&#x6253;&#x5F00;&#x5E94;&#x7528;&#x5185;&#x7684;&#x53E6;&#x4E00;&#x4E2A;Activity&#xFF0C;&#x5C31;&#x8D70;&#x7684;&#x662F;&#x4E0A;&#x9762;&#x7684; return candidateTask.getRootTask();</span><br><span class="line">&#x63A5;&#x4E0B;&#x6765;&#x5C31;&#x662F;&#x771F;&#x6B63;&#x89E6;&#x53D1;Task&#x7684;&#x521B;&#x5EFA;&#x3002;</span><br><span class="line">// &#x53E6;&#x5916;&#x8BBE;&#x7F6E;&#x7684;parent&#x5C31;&#x662F;&#x5C42;&#x7EA7;&#x7ED3;&#x6784;&#x6811;&#x5E94;&#x7528;&#x6240;&#x5728;&#x7684;&#x540D;&#x4E3A;&#x201C;DefaultTaskDisplayArea&#x201D;&#x7684;TaskDisplayArea</span><br><span class="line"># Task</span><br><span class="line">    # Task.Builder</span><br><span class="line">        Task build() {</span><br><span class="line">            if (mParent != null &amp;&amp; mParent instanceof TaskDisplayArea) {</span><br><span class="line">                validateRootTask((TaskDisplayArea) mParent);</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            if (mActivityInfo == null) {</span><br><span class="line">                mActivityInfo = new ActivityInfo();</span><br><span class="line">                mActivityInfo.applicationInfo = new ApplicationInfo();</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            mUserId = UserHandle.getUserId(mActivityInfo.applicationInfo.uid);</span><br><span class="line">            mTaskAffiliation = mTaskId;</span><br><span class="line">            mLastTimeMoved = System.currentTimeMillis();</span><br><span class="line">            mNeverRelinquishIdentity = true;</span><br><span class="line">            mCallingUid = mActivityInfo.applicationInfo.uid;</span><br><span class="line">            mCallingPackage = mActivityInfo.packageName;</span><br><span class="line">            mResizeMode = mActivityInfo.resizeMode;</span><br><span class="line">            mSupportsPictureInPicture = mActivityInfo.supportsPictureInPicture();</span><br><span class="line">            if (mActivityOptions != null) {</span><br><span class="line">                mRemoveWithTaskOrganizer = mActivityOptions.getRemoveWithTaskOranizer();</span><br><span class="line">            }</span><br><span class="line">            // &#x91CD;&#x70B9;* 1. &#x521B;&#x5EFA;task</span><br><span class="line">            final Task task = buildInner();</span><br><span class="line">            task.mHasBeenVisible = mHasBeenVisible;</span><br><span class="line"></span><br><span class="line">            // Set activity type before adding the root task to TaskDisplayArea, so home task can</span><br><span class="line">            // be cached, see TaskDisplayArea#addRootTaskReferenceIfNeeded().</span><br><span class="line">            if (mActivityType != ACTIVITY_TYPE_UNDEFINED) {</span><br><span class="line">                task.setActivityType(mActivityType);</span><br><span class="line">            }</span><br><span class="line">            // &#x91CD;&#x70B9;* 2. &#x5165;&#x6808; &#x8FD9;&#x91CC;&#x7684; mOnTop&#x4E3A;true</span><br><span class="line">            if (mParent != null) {</span><br><span class="line">                if (mParent instanceof Task) {</span><br><span class="line">                    final Task parentTask = (Task) mParent;</span><br><span class="line">                    parentTask.addChild(task, mOnTop ? POSITION_TOP : POSITION_BOTTOM,</span><br><span class="line">                            (mActivityInfo.flags &amp; FLAG_SHOW_FOR_ALL_USERS) != 0);</span><br><span class="line">                } else {</span><br><span class="line">                    mParent.addChild(task, mOnTop ? POSITION_TOP : POSITION_BOTTOM);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            // Set windowing mode after attached to display area or it abort silently.</span><br><span class="line">            if (mWindowingMode != WINDOWING_MODE_UNDEFINED) {</span><br><span class="line">                task.setWindowingMode(mWindowingMode, true /* creating */);</span><br><span class="line">            }</span><br><span class="line">            // &#x8FD4;&#x56DE;</span><br><span class="line">            return task;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        // &#x521B;&#x5EFA;</span><br><span class="line">        Task buildInner() {</span><br><span class="line">            return new Task(mAtmService, mTaskId, mIntent, mAffinityIntent, mAffinity,</span><br><span class="line">                    mRootAffinity, mRealActivity, mOrigActivity, mRootWasReset, mAutoRemoveRecents,</span><br><span class="line">                    mAskedCompatMode, mUserId, mEffectiveUid, mLastDescription, mLastTimeMoved,</span><br><span class="line">                    mNeverRelinquishIdentity, mLastTaskDescription, mLastSnapshotData,</span><br><span class="line">                    mTaskAffiliation, mPrevAffiliateTaskId, mNextAffiliateTaskId, mCallingUid,</span><br><span class="line">                    mCallingPackage, mCallingFeatureId, mResizeMode, mSupportsPictureInPicture,</span><br><span class="line">                    mRealActivitySuspended, mUserSetupComplete, mMinWidth, mMinHeight,</span><br><span class="line">                    mActivityInfo, mVoiceSession, mVoiceInteractor, mCreatedByOrganizer,</span><br><span class="line">                    mLaunchCookie, mDeferTaskAppear, mRemoveWithTaskOrganizer);</span><br><span class="line">        }</span><br></pre></td></tr></table></figure>

<p><strong>&#x5C0F;&#x7ED3;&#xFF1A;</strong><br>&#x6700;&#x540E;&#x63CF;&#x8FF0;&#x4E00;&#x4E0B;&#x6700;&#x540E;&#x521B;&#x5EFA;&#x7684;2&#x4E2A;&#x91CD;&#x70B9;&#x90E8;&#x5206;&#xFF1A;</p>
<ol>
<li>&#x770B;&#x5230;&#x901A;&#x8FC7;buildInner &#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;task&#xFF0C;&#x800C;buildInner &#x4E5F;&#x5F88;&#x7B80;&#x5355;&#x7C97;&#x66B4;&#xFF0C;&#x901A;&#x8FC7;&#x5404;&#x4E2A;&#x53D8;&#x91CF;&#x76F4;&#x63A5;new Task &#x5BF9;&#x8C61;&#x3002;</li>
<li>mParent &#x4E0D;&#x4E3A;null&#xFF0C; &#x662F; &#x56E0;&#x4E3A;&#x5728;&#x521B;&#x5EFA;&#x7684;&#x65F6;&#x5019; setParent&#xFF08;this&#xFF09;,&#x5F53;&#x524D;&#x7684;&#x8FD9;&#x4E2A;this&#xFF0C;&#x5C31;&#x662F; getDefaultTaskDisplayArea&#x8FD4;&#x56DE;&#x7684;&#x4E5F;&#x5C31;&#x662F;&#x5E94;&#x7528;Activity&#x5B58;&#x5728;&#x7684;&#x201D;DefaultTaskDisplayArea&#x201D;&#x3002;</li>
</ol>
<p>&#x5728; RootWindowContainer::getOrCreateRootTask &#x4F53;&#x73B0;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/4be1f4b687c09204c9d46c0bc3e632542c766fd21f55254fd3be4df5065a3af4" alt="&#x521B;&#x5EFA;Task-getOrCreateRootTask.png"><br>&#x6CE8;&#x610F;log&#x91CC;&#x7684; #17 &#x7684;&#x8FD9;&#x4E2A;Task&#xFF0C;&#x4E0E;&#x524D;&#x9762;&#x7684;&#x5C42;&#x7EA7;&#x7ED3;&#x6784;&#x6811;&#x65B0;&#x589E;&#x7684;Task,&#x662F;&#x5BF9;&#x5E94;&#x7684;&#x4E0A;&#x7684;&#x3002;&#x800C;&#x4E14;this= DefaultTaskDisplayArea &#x8BF4;&#x660E;&#x4E5F;&#x786E;&#x5B9E;&#x662F;&#x5F80;DefaultTaskDisplayArea&#x91CC;&#x6DFB;&#x52A0;&#x4E86;&#x3002;</p>
<h2 id="1-3-ActivityRecord&#x7684;&#x6302;&#x8F7D;"><a href="#1-3-ActivityRecord&#x7684;&#x6302;&#x8F7D;" class="headerlink" title="1.3 ActivityRecord&#x7684;&#x6302;&#x8F7D;"></a>1.3 ActivityRecord&#x7684;&#x6302;&#x8F7D;</h2><p><strong>&#x8C03;&#x7528;&#x94FE;</strong><br>ActivityStarer::setNewTask<br>ActivityStarer::addOrReparentStartingActivity<br><strong>&#x4E3B;&#x6D41;&#x7A0B;&#x4EE3;&#x7801;</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;# ActivityStarer</span><br><span class="line">    private void setNewTask(Task taskToAffiliate) {</span><br><span class="line">        // &#x4E3A;true</span><br><span class="line">        final boolean toTop = !mLaunchTaskBehind &amp;&amp; !mAvoidMoveToFront;</span><br><span class="line">        // &#x5C31;&#x662F;mTargetRootTask,&#x4E5F;&#x5C31;&#x662F;&#x521A;&#x521A;&#x521B;&#x5EFA;&#x7684;Task</span><br><span class="line">        final Task task = mTargetRootTask.reuseOrCreateTask(</span><br><span class="line">                mNewTaskInfo != null ? mNewTaskInfo : mStartActivity.info,</span><br><span class="line">                mNewTaskIntent != null ? mNewTaskIntent : mIntent, mVoiceSession,</span><br><span class="line">                mVoiceInteractor, toTop, mStartActivity, mSourceRecord, mOptions);</span><br><span class="line">        task.mTransitionController.collectExistenceChange(task);</span><br><span class="line">        // ActivityRecord&#x7684;&#x6302;&#x8F7D;</span><br><span class="line">        addOrReparentStartingActivity(task, &quot;setTaskFromReuseOrCreateNewTask&quot;);</span><br><span class="line">        // &#x9700;&#x8981;&#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x7684;&#x65E5;&#x5FD7;&#x6253;&#x5370;</span><br><span class="line">        ProtoLog.v(WM_DEBUG_TASKS, &quot;Starting new activity %s in new task %s&quot;,</span><br><span class="line">                mStartActivity, mStartActivity.getTask());</span><br><span class="line"></span><br><span class="line">        // mLaunchTaskBehind &#x4E3A;false&#xFF0C;&#x6240;&#x4EE5;taskToAffiliate &#x4E3A;null </span><br><span class="line">        if (taskToAffiliate != null) {</span><br><span class="line">            mStartActivity.setTaskToAffiliateWith(taskToAffiliate);</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x91CC;&#x7684;task &#x548C;mTargetRootTask&#x662F;&#x540C;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#xFF0C; &#x8FDB;&#x6E90;&#x7801;&#x8DDF;&#x5230;&#x6D41;&#x7A0B;&#x4E5F;&#x662F;&#x4E00;&#x6837;&#x3002;<br>&#x7136;&#x540E;&#x8FDB;&#x5165; addOrReparentStartingActivity</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">less&#x590D;&#x5236;&#x4EE3;&#x7801;# ActivityStarer</span><br><span class="line">    private void addOrReparentStartingActivity(@NonNull Task task, String reason) {</span><br><span class="line">        //  newParent = task &#x90FD;&#x662F;&#x521A;&#x521A;&#x521B;&#x5EFA;&#x7684;Task</span><br><span class="line">        TaskFragment newParent = task;</span><br><span class="line">        ......</span><br><span class="line">        if (mStartActivity.getTaskFragment() == null</span><br><span class="line">                || mStartActivity.getTaskFragment() == newParent) {</span><br><span class="line">            // &#x91CD;&#x70B9;&#xFF0C; &#x5C06; ActivityRecord&#x6302;&#x5728;&#x5230;&#x65B0;&#x521B;&#x5EFA;&#x7684;Task&#x4E2D;&#xFF0C;&#x5E76;&#x4E14;&#x662F;&#x9876;&#x90E8;</span><br><span class="line">            newParent.addChild(mStartActivity, POSITION_TOP);</span><br><span class="line">        } else {</span><br><span class="line">            mStartActivity.reparent(newParent, newParent.getChildCount() /* top */, reason);</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x91CC;&#x7684;&#x903B;&#x8F91;&#x8BBE;&#x8BA1;&#x5230;&#x7684;Task&#x5C31;&#x662F;&#x4E0A;&#x4E00;&#x6B65;&#x521B;&#x5EFA;&#x7684;Task&#xFF0C;mStartActivity&#x5219;&#x662F;&#x201C;&#x7535;&#x8BDD;&#x201D;&#x5728;&#x4E4B;&#x524D;&#x903B;&#x8F91;&#x521B;&#x5EFA;&#x7684;ActivityRecord.<br><strong>setNewTask&#x7684;&#x5806;&#x6808;&#x4FE1;&#x606F;&#x5982;&#x4E0B;</strong></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/86d22d5ca219191fd2dfa601b0613d6f4b9c3d30170f80663b9df0cfe60f4e90" alt="AcvtivityRecord&#x6302;&#x5728;&#x5230;Task.png"><br>&#x53E6;&#x5916;&#x8FD9;&#x6BB5;&#x903B;&#x8F91;&#x91CC;&#x6709;&#x4E2A;ProtoLog&#x6253;&#x5370;&#xFF0C;&#x65E5;&#x5FD7;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/9128e5fa0000d3d0a69706aca8ad4143c3d3c3ab1d3f99408c0b2c37af45246f" alt="setNewTask&#x7684;ProtoLog.png"></p>
<h2 id="1-4-WindowState&#x7684;&#x521B;&#x5EFA;&#x4E0E;&#x6302;&#x8F7D;"><a href="#1-4-WindowState&#x7684;&#x521B;&#x5EFA;&#x4E0E;&#x6302;&#x8F7D;" class="headerlink" title="1.4 WindowState&#x7684;&#x521B;&#x5EFA;&#x4E0E;&#x6302;&#x8F7D;"></a>1.4 WindowState&#x7684;&#x521B;&#x5EFA;&#x4E0E;&#x6302;&#x8F7D;</h2><p>WindowManagerService::addWindow<br>WindowState::init &#x2013; WindowState&#x7684;&#x521B;&#x5EFA;<br>WindowToken::addWindow &#x2013; WindowState&#x7684;&#x6302;&#x8F7D;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;#  WindowManagerService</span><br><span class="line"></span><br><span class="line">    public int addWindow(Session session, IWindow client, LayoutParams attrs, int viewVisibility,</span><br><span class="line">            int displayId, int requestUserId, InsetsVisibilities requestedVisibilities,</span><br><span class="line">            InputChannel outInputChannel, InsetsState outInsetsState,</span><br><span class="line">            InsetsSourceControl[] outActiveControls) {</span><br><span class="line">                ......// token&#x5904;&#x7406;</span><br><span class="line">                // &#x521B;&#x5EFA;WindowState</span><br><span class="line">                final WindowState win = new WindowState(this, session, client, token, parentWindow,</span><br><span class="line">                            appOp[0], attrs, viewVisibility, session.mUid, userId,</span><br><span class="line">                            session.mCanAddInternalSystemWindow);</span><br><span class="line">                ......</span><br><span class="line">                // 7. &#x7A97;&#x53E3;&#x6DFB;&#x52A0;&#x8FDB;&#x5BB9;&#x5668;</span><br><span class="line">                win.attach();</span><br><span class="line">                ......</span><br><span class="line">                win.mToken.addWindow(win);</span><br><span class="line">                ......</span><br><span class="line">            }</span><br></pre></td></tr></table></figure>

<p>&#x201C;win.mToken&#x201D;&#x7A97;&#x53E3;&#x7684;token&#x662F;ActyivityRecord</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">typescript&#x590D;&#x5236;&#x4EE3;&#x7801;# ActivityRecord</span><br><span class="line">    @Override</span><br><span class="line">    void addWindow(WindowState w) {</span><br><span class="line">        super.addWindow(w);</span><br><span class="line">        ......</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>&#x76F4;&#x63A5;&#x8C03;&#x7528;&#x5176;&#x7236;&#x7C7B;&#x65B9;&#x6CD5;&#xFF0C;ActivityRecord&#x662F;WindowToken</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">scss&#x590D;&#x5236;&#x4EE3;&#x7801;# WindowToken</span><br><span class="line">    void addWindow(final WindowState win) {</span><br><span class="line">        ProtoLog.d(WM_DEBUG_FOCUS,</span><br><span class="line">                &quot;addWindow: win=%s Callers=%s&quot;, win, Debug.getCallers(5));</span><br><span class="line"></span><br><span class="line">        if (win.isChildWindow()) {</span><br><span class="line">            // Child windows are added to their parent windows.</span><br><span class="line">            return;</span><br><span class="line">        }</span><br><span class="line">        // This token is created from WindowContext and the client requests to addView now, create a</span><br><span class="line">        // surface for this token.</span><br><span class="line">        // &#x771F;&#x6B63;&#x6DFB;&#x52A0;&#x8FDB;&#x5B50;&#x5BB9;&#x5668;&#xFF0C;&#x8C03;&#x7528;&#x7684;&#x662F;WindowContainer&#x7684;&#x65B9;&#x6CD5;</span><br><span class="line">        if (!mChildren.contains(win)) {</span><br><span class="line">            ProtoLog.v(WM_DEBUG_ADD_REMOVE, &quot;Adding %s to %s&quot;, win, this);</span><br><span class="line">            // &#x5B9A;&#x4E49;&#x5728;WindowContainer&#x4E2D;&#xFF0C;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x6302;&#x8F7D;&#x5230;&#x7236;&#x5BB9;&#x5668;&#x4E0B;&#x4E86;</span><br><span class="line">            addChild(win, mWindowComparator);</span><br><span class="line">            mWmService.mWindowsChanged = true;</span><br><span class="line">            // TODO: Should we also be setting layout needed here and other places?</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><h1 id="&#x7CFB;&#x7EDF;&#x7A97;&#x53E3;&#x6302;&#x8F7D;"><a href="#&#x7CFB;&#x7EDF;&#x7A97;&#x53E3;&#x6302;&#x8F7D;" class="headerlink" title="&#x7CFB;&#x7EDF;&#x7A97;&#x53E3;&#x6302;&#x8F7D;"></a>&#x7CFB;&#x7EDF;&#x7A97;&#x53E3;&#x6302;&#x8F7D;</h1></li>
</ol>
<h2 id="2-1-WindowToken-WindowState&#x7684;&#x521B;&#x5EFA;&#x4E0E;&#x6302;&#x8F7D;"><a href="#2-1-WindowToken-WindowState&#x7684;&#x521B;&#x5EFA;&#x4E0E;&#x6302;&#x8F7D;" class="headerlink" title="2.1 WindowToken,WindowState&#x7684;&#x521B;&#x5EFA;&#x4E0E;&#x6302;&#x8F7D;"></a>2.1 WindowToken,WindowState&#x7684;&#x521B;&#x5EFA;&#x4E0E;&#x6302;&#x8F7D;</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;    public int addWindow(Session session, IWindow client, LayoutParams attrs, int viewVisibility,</span><br><span class="line">            int displayId, int requestUserId, InsetsVisibilities requestedVisibilities,</span><br><span class="line">            InputChannel outInputChannel, InsetsState outInsetsState,</span><br><span class="line">            InsetsSourceControl[] outActiveControls) {</span><br><span class="line">            ......</span><br><span class="line">            // &#x7CFB;&#x7EDF;&#x5E94;&#x7528;&#x83B7;&#x53D6;&#x4E0D;&#x5230;token</span><br><span class="line">            WindowToken token = displayContent.getWindowToken(</span><br><span class="line">                    hasParent ? parentWindow.mAttrs.token : attrs.token);</span><br><span class="line">            ......</span><br><span class="line">            if (token == null) {</span><br><span class="line">                ......</span><br><span class="line">                } else {</span><br><span class="line">                    final IBinder binder = attrs.token != null ? attrs.token : client.asBinder();</span><br><span class="line">                    token = new WindowToken.Builder(this, binder, type)</span><br><span class="line">                            .setDisplayContent(displayContent)</span><br><span class="line">                            .setOwnerCanManageAppTokens(session.mCanAddInternalSystemWindow)</span><br><span class="line">                            .setRoundedCornerOverlay(isRoundedCornerOverlay)</span><br><span class="line">                            .build();</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            // &#x521B;&#x5EFA;WindowState</span><br><span class="line">                final WindowState win = new WindowState(this, session, client, token, parentWindow,</span><br><span class="line">                            appOp[0], attrs, viewVisibility, session.mUid, userId,</span><br><span class="line">                            session.mCanAddInternalSystemWindow);</span><br><span class="line">            ......</span><br><span class="line">            // &#x7A97;&#x53E3;&#x6DFB;&#x52A0;&#x8FDB;&#x5BB9;&#x5668;</span><br><span class="line">            win.attach();</span><br><span class="line">            ......</span><br><span class="line">            win.mToken.addWindow(win);</span><br><span class="line">            ......</span><br></pre></td></tr></table></figure>

<p>WindowState&#x7684;&#x521B;&#x5EFA;&#x548C;&#x5E94;&#x7528;&#x7A97;&#x53E3;&#x4E00;&#x6837;&#xFF0C;&#x533A;&#x522B;&#x5728;&#x4E0E;WindowToken&#xFF0C;&#x7CFB;&#x7EDF;&#x7A97;&#x53E3;&#x6267;&#x884C;addWindow&#x65B9;&#x6CD5;&#x662F;&#x6CA1;&#x6709;token&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x4F1A;&#x6267;&#x884C;&#x521B;&#x5EFA;&#x903B;&#x8F91;&#x3002;<br>&#x5728;&#x521B;&#x5EFA;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x6839;&#x636E;&#x7A97;&#x53E3;&#x7C7B;&#x578B;&#x9009;&#x62E9;&#x6302;&#x8F7D;&#x7684;&#x5C42;&#x7EA7;&#x3002;</p>
<h2 id="2-2-WindowToken&#x7684;&#x6302;&#x8F7D;"><a href="#2-2-WindowToken&#x7684;&#x6302;&#x8F7D;" class="headerlink" title="2.2 WindowToken&#x7684;&#x6302;&#x8F7D;"></a>2.2 WindowToken&#x7684;&#x6302;&#x8F7D;</h2><p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/0e29f6a66c3b53dc816ea9ea7f47cb4dfa6a2f1a5f3463333b9c1a8f262c561a" alt="&#x4F01;&#x4E1A;&#x5FAE;&#x4FE1;&#x622A;&#x56FE;_1708940254526.png"></p>
<p>WindowToken&#x7684;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;# WindowToken</span><br><span class="line">    protected WindowToken(WindowManagerService service, IBinder _token, int type,</span><br><span class="line">            boolean persistOnEmpty, DisplayContent dc, boolean ownerCanManageAppTokens,</span><br><span class="line">            boolean roundedCornerOverlay, boolean fromClientToken, @Nullable Bundle options) {</span><br><span class="line">        super(service);</span><br><span class="line">        token = _token;</span><br><span class="line">        windowType = type;</span><br><span class="line">        ......</span><br><span class="line">        if (dc != null) {</span><br><span class="line">            // &#x6DFB;&#x52A0;token</span><br><span class="line">            dc.addWindowToken(token, this);</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>&#x521B;&#x5EFA;WindowToken&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x7531;DisplayContent&#x6267;&#x884C;&#x6302;&#x8F7D;&#x903B;&#x8F91;&#xFF0C;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">scss&#x590D;&#x5236;&#x4EE3;&#x7801;# DisplayContent</span><br><span class="line">    DisplayAreaPolicy mDisplayAreaPolicy;</span><br><span class="line"></span><br><span class="line">    void addWindowToken(IBinder binder, WindowToken token) {</span><br><span class="line">        ......</span><br><span class="line">        // &#x653E;&#x5165;&#x96C6;&#x5408;</span><br><span class="line">        mTokenMap.put(binder, token);</span><br><span class="line"></span><br><span class="line">        if (token.asActivityRecord() == null) {</span><br><span class="line">            ......</span><br><span class="line">            // &#x627E;&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x4F4D;&#x7F6E;&#x6302;&#x8F7D;</span><br><span class="line">            final DisplayArea.Tokens da = findAreaForToken(token).asTokens();</span><br><span class="line">            da.addChild(token);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    DisplayArea findAreaForToken(WindowToken windowToken) {</span><br><span class="line">        // &#x6839;&#x636E;type&#x67E5;&#x627E;</span><br><span class="line">        return findAreaForWindowType(windowToken.getWindowType(), windowToken.mOptions,</span><br><span class="line">                windowToken.mOwnerCanManageAppTokens, windowToken.mRoundedCornerOverlay);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    DisplayArea findAreaForWindowType(int windowType, Bundle options,</span><br><span class="line">            boolean ownerCanManageAppToken, boolean roundedCornerOverlay) {</span><br><span class="line">        // &#x5E94;&#x7528;&#x7C7B;&#x578B;</span><br><span class="line">        if (windowType &gt;= FIRST_APPLICATION_WINDOW &amp;&amp; windowType &lt;= LAST_APPLICATION_WINDOW) {</span><br><span class="line">            return mDisplayAreaPolicy.getTaskDisplayArea(options);</span><br><span class="line">        }</span><br><span class="line">        // &#x8F93;&#x5165;&#x6CD5;&#x7A97;&#x53E3;</span><br><span class="line">        if (windowType == TYPE_INPUT_METHOD || windowType == TYPE_INPUT_METHOD_DIALOG) {</span><br><span class="line">            return getImeContainer();</span><br><span class="line">        }</span><br><span class="line">        // &#x5176;&#x4ED6;&#x7C7B;&#x578B;</span><br><span class="line">        return mDisplayAreaPolicy.findAreaForWindowType(windowType, options,</span><br><span class="line">                ownerCanManageAppToken, roundedCornerOverlay);</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>&#x72B6;&#x6001;&#x680F;&#x4E0D;&#x5C5E;&#x4E8E;&#x5E94;&#x7528;&#x7A97;&#x53E3;&#xFF0C;&#x8D70;&#x540E;&#x9762;&#x7684;&#x903B;&#x8F91;&#xFF0C;DisplayAreaPolicy&#x662F;&#x4E2A;&#x63A5;&#x53E3;&#xFF0C;&#x771F;&#x6B63;&#x7684;&#x5B9E;&#x73B0;&#x662F;DisplayAreaPolicyBuilder&#x7684;&#x5185;&#x90E8;&#x7C7B;Result</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">scala&#x590D;&#x5236;&#x4EE3;&#x7801;# DisplayAreaPolicyBuilder</span><br><span class="line"></span><br><span class="line">   static class Result extends DisplayAreaPolicy {</span><br><span class="line">        final BiFunction&lt;Integer, Bundle, RootDisplayArea&gt; mSelectRootForWindowFunc;</span><br><span class="line">        ......</span><br><span class="line">        @Override</span><br><span class="line">        public DisplayArea.Tokens findAreaForWindowType(int type, Bundle options,</span><br><span class="line">                boolean ownerCanManageAppTokens, boolean roundedCornerOverlay) {</span><br><span class="line">            return mSelectRootForWindowFunc.apply(type, options).findAreaForWindowTypeInLayer(type,</span><br><span class="line">                    ownerCanManageAppTokens, roundedCornerOverlay);</span><br><span class="line">        }</span><br><span class="line">        ......</span><br><span class="line">   }</span><br></pre></td></tr></table></figure>

<p>mSelectRootForWindowFunc&#x662F;&#x4E00;&#x4E2A;&#x5B58;&#x653E;RootDisplayArea&#x7684;map&#xFF0C;&#x6240;&#x4EE5;&#x540E;&#x7EED;&#x903B;&#x8F91;&#x5728;RootDisplayArea&#x4E2D;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;// &#x6839;&#x636E;type &#x627E;&#x5230;&#x5728;&#x5BB9;&#x5668;&#x6811;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C; &#x5982;&#x679C;&#x662F;&#x5E94;&#x7528;&#x6216;&#x8005;&#x8F93;&#x5165;&#x6CD5;&#x90FD;&#x8D70;&#x4E0D;&#x5230;&#x8FD9;</span><br><span class="line"># RootDisplayArea</span><br><span class="line">    // &#x8FD9;&#x4E2A;&#x5C31;&#x662F;&#x5C42;&#x7EA7;&#x6811;&#x7684;</span><br><span class="line">    private DisplayArea.Tokens[] mAreaForLayer;</span><br><span class="line">    @Nullable</span><br><span class="line">    DisplayArea.Tokens findAreaForWindowTypeInLayer(int windowType, boolean ownerCanManageAppTokens,</span><br><span class="line">            boolean roundedCornerOverlay) {</span><br><span class="line">        // &#x83B7;&#x53D6;&#x5230;type</span><br><span class="line">        int windowLayerFromType = mWmService.mPolicy.getWindowLayerFromTypeLw(windowType,</span><br><span class="line">                ownerCanManageAppTokens, roundedCornerOverlay);</span><br><span class="line">        if (windowLayerFromType == APPLICATION_LAYER) {</span><br><span class="line">            throw new IllegalArgumentException(</span><br><span class="line">                    &quot;There shouldn&apos;t be WindowToken on APPLICATION_LAYER&quot;);</span><br><span class="line">        }</span><br><span class="line">        // &#x6839;&#x636E;type&#x67E5;&#x627E;&#x5BF9;&#x5E94;&#x7684;&#x4F4D;&#x7F6E;</span><br><span class="line">        return mAreaForLayer[windowLayerFromType];</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p><strong>getWindowLayerFromTypeLw</strong>&#x4F1A;&#x6839;&#x636E;type&#x627E;&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x5C42;&#x7EA7;&#xFF0C;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;int&#x3002;<br>&#x7136;&#x540E;&#x6839;&#x636E;&#x8FD9;&#x4E2A;&#x503C;&#x53BB;mAreaForLayer&#x62FF;&#x5230;&#x5BF9;&#x5E94;&#x7684;DisplayArea.Tokens&#xFF0C;&#x5C06;&#x7CFB;&#x7EDF;&#x7A97;&#x53E3;&#x7684;WindowToken&#x6302;&#x8F7D;&#x8FDB;&#x53BB;<br>mAreaForLayer&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x5F00;&#x59CB;&#x6784;&#x5EFA;&#x5C42;&#x7EA7;&#x6811;&#x7684;&#x90A3;&#x4E2A;&#x96C6;&#x5408;&#x3002;</p>
<h2 id="2-2-1-mAreaForLayer&#x7684;&#x8D4B;&#x503C;"><a href="#2-2-1-mAreaForLayer&#x7684;&#x8D4B;&#x503C;" class="headerlink" title="2.2.1 mAreaForLayer&#x7684;&#x8D4B;&#x503C;"></a>2.2.1 mAreaForLayer&#x7684;&#x8D4B;&#x503C;</h2><p>&#x5728;&#x5F00;&#x673A;&#x6784;&#x5EFA;&#x7A97;&#x53E3;&#x5C42;&#x7EA7;&#x6811;&#x7684;&#x903B;&#x8F91;&#xFF0C;&#x6700;&#x540E;&#x4F1A;&#x6267;&#x884C;&#x5230;RootDisplayArea::onHierarchyBuilt&#x5C06;&#x5C42;&#x7EA7;&#x6811;&#x7684;&#x96C6;&#x5408;&#x4F20;&#x9012;&#x51FA;&#x53BB;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">less&#x590D;&#x5236;&#x4EE3;&#x7801;# DisplayAreaPolicyBuilder.HierarchyBuilder</span><br><span class="line"></span><br><span class="line">        private final RootDisplayArea mRoot;</span><br><span class="line"></span><br><span class="line">        private void build(@Nullable List&lt;HierarchyBuilder&gt; displayAreaGroupHierarchyBuilders) {</span><br><span class="line">            ......// &#x5C42;&#x7EA7;&#x6811;&#x7684;&#x6784;&#x5EFA;</span><br><span class="line">            // &#x901A;&#x77E5;&#x6839;&#x8282;&#x70B9;&#x5DF2;&#x7ECF;&#x5B8C;&#x6210;&#x4E86;&#x6240;&#x6709;DisplayArea&#x7684;&#x6DFB;&#x52A0; &#xFF08;&#x5C06;displayAreaForLayer&#x4FDD;&#x5B58;&#x5728;RootDisplayArea&#x6210;&#x5458;&#x53D8;&#x91CF;roomAreaForLayer&#x4E2D;&#xFF0C;&#x4F9B;&#x540E;&#x9762;&#x903B;&#x8F91;&#x4F7F;&#x7528;&#xFF09;</span><br><span class="line">            mRoot.onHierarchyBuilt(mFeatures, displayAreaForLayer, featureAreas);</span><br><span class="line">        }</span><br></pre></td></tr></table></figure>

<p><strong>RootDisplayArea&#x4E0B;&#x7684;mAreaForLayer&#x53D8;&#x91CF;&#x8D4B;&#x503C;</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;# RootDisplayArea</span><br><span class="line">    private DisplayArea.Tokens[] mAreaForLayer;</span><br><span class="line"></span><br><span class="line">    void onHierarchyBuilt(ArrayList&lt;Feature&gt; features, DisplayArea.Tokens[] areaForLayer,</span><br><span class="line">            Map&lt;Feature, List&lt;DisplayArea&lt;WindowContainer&gt;&gt;&gt; featureToDisplayAreas) {</span><br><span class="line">        if (mHasBuiltHierarchy) {</span><br><span class="line">            throw new IllegalStateException(&quot;Root should only build the hierarchy once&quot;);</span><br><span class="line">        }</span><br><span class="line">        mHasBuiltHierarchy = true;</span><br><span class="line">        mFeatures = Collections.unmodifiableList(features);</span><br><span class="line">        // &#x8D4B;&#x503C;</span><br><span class="line">        mAreaForLayer = areaForLayer;</span><br><span class="line">        mFeatureToDisplayAreas = featureToDisplayAreas;</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p><strong>&#x6240;&#x4EE5;mAreaForLayer&#x4FDD;&#x5B58;&#x4E86;&#x5C42;&#x7EA7;&#x6811;&#x5404;&#x4E2A;&#x5C42;&#x7EA7;&#x7684;&#x5BF9;&#x8C61;</strong>&#x56E0;&#x6B64;&#x6839;&#x636E;index&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x5230;&#x5BF9;&#x5E94;&#x7684;DisplayArea.Tokens&#xFF0C;&#x5E76;&#x6267;&#x884C;&#x7CFB;&#x7EDF;&#x7A97;&#x53E3;WindowToken&#x7684;&#x6302;&#x8F7D;&#x3002;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/2a42a80a738cca0fe0d2a73890dab716.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7338808893529423883.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7338808893529423883.html" itemprop="url">【Android 13源码分析】WindowContaine</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-02-25T20:48:29+08:00">
                2024-02-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x5728;&#x5B89;&#x5353;&#x6E90;&#x7801;&#x7684;&#x8BBE;&#x8BA1;&#x4E2D;&#xFF0C;&#x5C06;&#x5C06;&#x5C4F;&#x5E55;&#x5206;&#x4E3A;&#x4E86;37&#x5C42;&#xFF0C;&#x4E0D;&#x540C;&#x7684;&#x7A97;&#x53E3;&#x5C06;&#x5728;&#x4E0D;&#x540C;&#x7684;&#x5C42;&#x7EA7;&#x4E2D;&#x663E;&#x793A;&#x3002;<br>&#x5BF9;&#x8FD9;&#x4E00;&#x5757;&#x7684;&#x6982;&#x5FF5;&#x4EE5;&#x53CA;&#x76F8;&#x5173;&#x6E90;&#x7801;&#x505A;&#x4E86;&#x8BE6;&#x7EC6;&#x5206;&#x6790;&#xFF0C;&#x6574;&#x7406;&#x51FA;&#x4EE5;&#x4E0B;&#x51E0;&#x7BC7;&#x3002;</p>
<p><a href="https://dev.newban.cn/7339827208086896676">&#x3010;Android 13&#x6E90;&#x7801;&#x5206;&#x6790;&#x3011;WindowContainer&#x7A97;&#x53E3;&#x5C42;&#x7EA7;-1-&#x521D;&#x8BC6;&#x7A97;&#x53E3;&#x5C42;&#x7EA7;&#x6811;</a></p>
<p><a href="https://dev.newban.cn/7338808893529423883">&#x3010;Android 13&#x6E90;&#x7801;&#x5206;&#x6790;&#x3011;WindowContainer&#x7A97;&#x53E3;&#x5C42;&#x7EA7;-2-&#x6784;&#x5EFA;&#x6D41;&#x7A0B;</a></p>
<p><a href="https://dev.newban.cn/7338808893529440267">&#x3010;Android 13&#x6E90;&#x7801;&#x5206;&#x6790;&#x3011;WindowContainer&#x7A97;&#x53E3;&#x5C42;&#x7EA7;-3-&#x5B9E;&#x4F8B;&#x5206;&#x6790;</a></p>
<p><a href="/external_links/43f6cecf30d279e335b6491ab2aadbfa.html" target="blank" rel="noopener">&#x3010;Android 13&#x6E90;&#x7801;&#x5206;&#x6790;&#x3011;WindowContainer&#x7A97;&#x53E3;&#x5C42;&#x7EA7;-4-Surface&#x6811;</a></p>
<p>&#x5F53;&#x524D;&#x4E3A;&#x7B2C;&#x4E8C;&#x7BC7;&#xFF0C;&#x7B2C;&#x4E00;&#x7BC7;&#x5BF9;&#x7A97;&#x53E3;&#x6811;&#x6709;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x8BA4;&#x8BC6;&#x540E;&#xFF0C;&#x672C;&#x7BC7;&#x4ECB;&#x7ECD;&#x7A97;&#x53E3;&#x6811;&#x7684;&#x6784;&#x5EFA;&#x4EE3;&#x7801;&#x6D41;&#x7A0B;&#x3002;<br>&#x6574;&#x4E2A;&#x8FC7;&#x7A0B;&#x4F1A;&#x76F8;&#x5BF9;&#x65E0;&#x804A;&#xFF0C;&#x4F46;&#x662F;&#x4E0D;&#x8BB2;&#x4EE3;&#x7801;&#x7684;&#x6280;&#x672F;&#x6587;&#x7AE0;&#x5C31;&#x662F;&#x800D;&#x6D41;&#x6C13;&#x3002;</p>
<ol>
<li><h1 id="dump&#x5185;&#x5BB9;&#x7684;&#x6253;&#x5370;"><a href="#dump&#x5185;&#x5BB9;&#x7684;&#x6253;&#x5370;" class="headerlink" title="dump&#x5185;&#x5BB9;&#x7684;&#x6253;&#x5370;"></a>dump&#x5185;&#x5BB9;&#x7684;&#x6253;&#x5370;</h1></li>
</ol>
<p>&#x5148;&#x770B;dump&#x7684;&#x6570;&#x636E;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x662F;&#x5982;&#x4F55;&#x5B9A;&#x4E49;&#x7684;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">typescript&#x590D;&#x5236;&#x4EE3;&#x7801;# WindowManagerService</span><br><span class="line">    RootWindowContainer mRoot;</span><br><span class="line"></span><br><span class="line">    private void doDump(FileDescriptor fd, PrintWriter pw, String[] args, boolean useProto) {</span><br><span class="line">        ......</span><br><span class="line">            // containers</span><br><span class="line">            } else if (&quot;containers&quot;.equals(cmd)) {</span><br><span class="line">                synchronized (mGlobalLock) {</span><br><span class="line">                    mRoot.dumpChildrenNames(pw, &quot; &quot;);</span><br><span class="line">                    pw.println(&quot; &quot;);</span><br><span class="line">                    mRoot.forAllWindows(w -&gt; {pw.println(w);}, true /* traverseTopToBottom */);</span><br><span class="line">                }</span><br><span class="line">                return;</span><br><span class="line">            } else if (&quot;trace&quot;.equals(cmd)) {</span><br><span class="line">        ......</span><br><span class="line">    }</span><br><span class="line">    //  &#x6253;&#x5370;&#x7684;name</span><br><span class="line">    @Override</span><br><span class="line">    String getName() {</span><br><span class="line">        return &quot;ROOT&quot;;</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>dumpChildrenNames&#x7684;&#x5B9E;&#x73B0;&#x5728;WindowContainer&#x7684;&#x7236;&#x7C7B;ConfigurationContainer&#x4E2D;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">scss&#x590D;&#x5236;&#x4EE3;&#x7801;# ConfigurationContainer</span><br><span class="line">    public void dumpChildrenNames(PrintWriter pw, String prefix) {</span><br><span class="line">        final String childPrefix = prefix + &quot; &quot;;</span><br><span class="line">        pw.println(getName()</span><br><span class="line">                + &quot; type=&quot; + activityTypeToString(getActivityType())</span><br><span class="line">                + &quot; mode=&quot; + windowingModeToString(getWindowingMode())</span><br><span class="line">                + &quot; override-mode=&quot; + windowingModeToString(getRequestedOverrideWindowingMode())</span><br><span class="line">                + &quot; requested-bounds=&quot; + getRequestedOverrideBounds().toShortString()</span><br><span class="line">                + &quot; bounds=&quot; + getBounds().toShortString());</span><br><span class="line">        for (int i = getChildCount() - 1; i &gt;= 0; --i) {</span><br><span class="line">            final E cc = getChildAt(i);</span><br><span class="line">            // &#x6253;&#x5370; # &#x52A0;&#x89D2;&#x6807;</span><br><span class="line">            pw.print(childPrefix + &quot;#&quot; + i + &quot; &quot;);</span><br><span class="line">            cc.dumpChildrenNames(pw, childPrefix);</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x4ECE;RootWindowContainer&#x5F00;&#x59CB;&#x9012;&#x5F52;&#x6253;&#x5370;&#x3002; &#x8FD9;&#x4E5F;&#x5C31;&#x662F;dump&#x5230;&#x7684;&#x7A97;&#x53E3;&#x5BB9;&#x5668;&#x5C42;&#x7EA7;&#x6811;&#x7684;&#x5185;&#x5BB9;&#x3002;&#x6BD4;&#x5982;&#x6700;&#x5F00;&#x59CB;&#x7684;RootWindowContainer::getName&#x8FD4;&#x56DE;&#x7684;&#x5185;&#x5BB9;&#x5C31;&#x662F; &#x201C;ROOT&#x201D;&#x3002;</p>
<ol start="2">
<li><h1 id="&#x5C42;&#x7EA7;&#x6811;&#x7684;&#x6784;&#x5EFA;"><a href="#&#x5C42;&#x7EA7;&#x6811;&#x7684;&#x6784;&#x5EFA;" class="headerlink" title="&#x5C42;&#x7EA7;&#x6811;&#x7684;&#x6784;&#x5EFA;"></a>&#x5C42;&#x7EA7;&#x6811;&#x7684;&#x6784;&#x5EFA;</h1></li>
</ol>
<h2 id="2-1-&#x8C03;&#x7528;&#x94FE;"><a href="#2-1-&#x8C03;&#x7528;&#x94FE;" class="headerlink" title="2.1 &#x8C03;&#x7528;&#x94FE;"></a>2.1 &#x8C03;&#x7528;&#x94FE;</h2><p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/505ffd37563bc4907d9606911bf93b9d21746bfa142b60dc2e65b6a642aad415" alt="&#x4F01;&#x4E1A;&#x5FAE;&#x4FE1;&#x622A;&#x56FE;_17089403239745.png"></p>
<h2 id="2-2-&#x524D;&#x671F;&#x7684;&#x4E00;&#x4E9B;&#x8C03;&#x7528;&#x94FE;"><a href="#2-2-&#x524D;&#x671F;&#x7684;&#x4E00;&#x4E9B;&#x8C03;&#x7528;&#x94FE;" class="headerlink" title="2.2 &#x524D;&#x671F;&#x7684;&#x4E00;&#x4E9B;&#x8C03;&#x7528;&#x94FE;"></a>2.2 &#x524D;&#x671F;&#x7684;&#x4E00;&#x4E9B;&#x8C03;&#x7528;&#x94FE;</h2><p>&#x8C03;&#x7528;&#x94FE;&#x524D;&#x9762;&#x8FD9;&#x6BB5;&#x53EF;&#x4EE5;&#x77E5;&#x9053;&#xFF0C;&#x5728;&#x7CFB;&#x7EDF;&#x542F;&#x52A8;&#x7684;&#x65F6;&#x5019;&#x5C31;&#x89E6;&#x53D1;&#x4E86;&#x8FD9;&#x6BB5;&#x903B;&#x8F91;&#xFF0C;&#x8FD9;&#x4E5F;&#x5C31;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x521A;&#x8FDB;&#x5165;launcher&#x5C31;&#x53EF;&#x4EE5;dump&#x51FA;&#x6574;&#x4E2A;&#x7ED3;&#x6784;&#x6811;&#x7684;&#x539F;&#x56E0;&#x3002;<br>setWindowManager &#x65B9;&#x6CD5;&#x4F20;&#x9012;&#x7684;&#x53C2;&#x6570;&#x662F;WMS&#xFF0C; WMS&#x7684;&#x542F;&#x52A8;&#x662F;tartOtherServices&#x4E2D;&#xFF0C;&#x800C;RootWindowContainer&#x5219;&#x662F;WMS&#x7684;&#x4E00;&#x4E2A;&#x6210;&#x5458;&#x53D8;&#x91CF;&#xFF0C;RootWindowContainer&#x662F;&#x5C42;&#x7EA7;&#x6811;&#x4E2D;&#x7684;&#x8DDF;&#x5BB9;&#x5668;&#xFF0C;&#x5728;WMS&#x6784;&#x5EFA;&#x51FD;&#x6570;&#x4E2D;&#x521B;&#x5EFA;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">csharp&#x590D;&#x5236;&#x4EE3;&#x7801;# WindowManagerService</span><br><span class="line">    // The root of the device window hierarchy.</span><br><span class="line">    RootWindowContainer mRoot;</span><br><span class="line">    // WMS&#x6784;&#x9020;&#x51FD;&#x6570;</span><br><span class="line">    private WindowManagerService(......) {</span><br><span class="line">        ......</span><br><span class="line">        mRoot = new RootWindowContainer(this);</span><br><span class="line">        ......</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>&#x7EE7;&#x7EED;&#x770B;&#x6784;&#x5EFA;&#x6D41;&#x7A0B;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;# RootWindowContainer</span><br><span class="line">    void setWindowManager(WindowManagerService wm) {</span><br><span class="line">        mWindowManager = wm;</span><br><span class="line">        mDisplayManager = mService.mContext.getSystemService(DisplayManager.class);</span><br><span class="line">        mDisplayManager.registerDisplayListener(this, mService.mUiHandler);</span><br><span class="line">        mDisplayManagerInternal = LocalServices.getService(DisplayManagerInternal.class);</span><br><span class="line"></span><br><span class="line">        final Display[] displays = mDisplayManager.getDisplays();</span><br><span class="line">        //  &#x904D;&#x5386;&#x6BCF;&#x4E2A;&#x5C4F;&#x5E55;</span><br><span class="line">        for (int displayNdx = 0; displayNdx &lt; displays.length; ++displayNdx) {</span><br><span class="line">            final Display display = displays[displayNdx];</span><br><span class="line">            // &#x91CD;&#x70B9;*1&#xFF1A;&#x4E3A;&#x6BCF;&#x4E00;&#x4E2A; Display &#x6302;&#x8F7D;&#x4E00;&#x4E2A; DisplayContent &#x8282;&#x70B9;</span><br><span class="line">            final DisplayContent displayContent = new DisplayContent(display, this);</span><br><span class="line">            addChild(displayContent, POSITION_BOTTOM);</span><br><span class="line">            if (displayContent.mDisplayId == DEFAULT_DISPLAY) {</span><br><span class="line">                mDefaultDisplay = displayContent;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    </span><br><span class="line">        // &#x91CD;&#x70B9;*2  TaskDisplayArea&#x76F8;&#x5173;</span><br><span class="line">        final TaskDisplayArea defaultTaskDisplayArea = getDefaultTaskDisplayArea();</span><br><span class="line">        defaultTaskDisplayArea.getOrCreateRootHomeTask(ON_TOP);</span><br><span class="line">        positionChildAt(POSITION_TOP, defaultTaskDisplayArea.mDisplayContent,</span><br><span class="line">                false /* includingParents */);</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>&#x91CD;&#x70B9;&#x89E3;&#x6790;&#xFF1A;</p>
<ol>
<li>&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x4E5F;&#x5C31;&#x80FD;&#x770B;&#x51FA;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x8BF4;&#x4E00;&#x4E2A;DisplayContent&#x5C31;&#x4EE3;&#x8868;&#x7740;1&#x4E2A;&#x5C4F;&#x5E55;&#x4E86;&#x3002;</li>
<li>&#x5904;&#x7406;TaskDisplayArea&#x76F8;&#x5173;&#xFF08;&#x8FD9;&#x91CC;&#x7A97;&#x53E3;&#x5C42;&#x7EA7;&#x6811;&#x5DF2;&#x7ECF;&#x6784;&#x5EFA;&#x5B8C;&#x6210;&#x4E86;&#xFF09;<br>&#x4E0A;&#x7BC7;&#x770B;&#x5C42;&#x7EA7;&#x6811;&#x77E5;&#x9053;TaskDisplayArea&#x5C31;&#x662F;&#x653E;&#x5E94;&#x7528;&#x76F8;&#x5173;&#x5BB9;&#x5668;&#x7684;&#xFF0C;&#x76EE;&#x524D;&#x5148;&#x4E0D;&#x770B;&#x8FD9;&#x5757;&#xFF0C;&#x5148;&#x8DDF;&#x8E2A;DisplayContent&#x4E0B;&#x7684;&#x903B;&#x8F91;&#xFF0C; &#x73B0;&#x5728;&#x9700;&#x8981;&#x770B;DisplayContent&#x7684;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#xFF0C;&#x56E0;&#x4E3A;&#x91CC;&#x9762;&#x5F00;&#x59CB;&#x6784;&#x9020;&#x8FD9;&#x4E2A;&#x5C4F;&#x5E55;&#x4E0B;&#x5C42;&#x7EA7;&#x6811;&#x3002;&#xFF08;&#x4E0D;&#x8003;&#x8651;&#x591A;&#x5C4F;&#x5E55;&#x7684;&#x60C5;&#x51B5;&#xFF09;</li>
</ol>
<ol start="3">
<li><h1 id="DisplayContent-&#x5F00;&#x59CB;&#x6784;&#x9020;&#x5F53;&#x524D;&#x5C4F;&#x5E55;&#x7684;&#x5C42;&#x7EA7;&#x6811;"><a href="#DisplayContent-&#x5F00;&#x59CB;&#x6784;&#x9020;&#x5F53;&#x524D;&#x5C4F;&#x5E55;&#x7684;&#x5C42;&#x7EA7;&#x6811;" class="headerlink" title="DisplayContent &#x5F00;&#x59CB;&#x6784;&#x9020;&#x5F53;&#x524D;&#x5C4F;&#x5E55;&#x7684;&#x5C42;&#x7EA7;&#x6811;"></a>DisplayContent &#x5F00;&#x59CB;&#x6784;&#x9020;&#x5F53;&#x524D;&#x5C4F;&#x5E55;&#x7684;&#x5C42;&#x7EA7;&#x6811;</h1></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">scss&#x590D;&#x5236;&#x4EE3;&#x7801;# DisplayContent</span><br><span class="line">    // 2&#x4E2A;&#x53C2;&#x6570;&#x4E3A;Display&#x548C;&#x8DDF;&#x5BB9;&#x5668;</span><br><span class="line">    DisplayContent(Display display, RootWindowContainer root) {</span><br><span class="line">        ......</span><br><span class="line">        // &#x521B;&#x5EFA;&#x4E8B;&#x52A1;</span><br><span class="line">        final Transaction pendingTransaction = getPendingTransaction();</span><br><span class="line">        // &#x91CD;&#x70B9;&#x5F00;&#x59CB;&#x6784;&#x5EFA;&#x5C42;&#x7EA7;&#x6811;</span><br><span class="line">        configureSurfaces(pendingTransaction);</span><br><span class="line">        // &#x6267;&#x884C;&#x4E8B;&#x52A1;</span><br><span class="line">        pendingTransaction.apply();</span><br><span class="line">        ......</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private void configureSurfaces(Transaction transaction) {</span><br><span class="line">        // &#x6784;&#x5EFA;&#x4E00;&#x4E2A;SurfaceControl</span><br><span class="line">        final SurfaceControl.Builder b = mWmService.makeSurfaceBuilder(mSession)</span><br><span class="line">                .setOpaque(true)</span><br><span class="line">                .setContainerLayer()</span><br><span class="line">                .setCallsite(&quot;DisplayContent&quot;);</span><br><span class="line">        // &#x8BBE;&#x7F6E;&#x540D;&#x5B57;&#x540E;&#x6784;&#x5EFA; &#xFF08;Display 0 name=&quot;XXX&quot;&#xFF09;</span><br><span class="line">        mSurfaceControl = b.setName(getName()).setContainerLayer().build();</span><br><span class="line"></span><br><span class="line">        // &#x91CD;&#x70B9;* &#x8BBE;&#x7F6E;&#x7B56;&#x7565;&#x5E76;&#x6784;&#x5EFA;&#x663E;&#x793A;&#x533A;&#x57DF;&#x5C42;&#x6B21;&#x7ED3;&#x6784;</span><br><span class="line">        if (mDisplayAreaPolicy == null) {</span><br><span class="line">            // WMS&#x7684;getDisplayAreaPolicyProvider&#x65B9;&#x6CD5;&#x6309;&#x8FD4;&#x56DE; DisplayAreaPolicy.Provider</span><br><span class="line">            // &#x7136;&#x540E;&#x5176; instantiate&#x7684;&#x5B9E;&#x73B0; &#x76EE;&#x524D;&#x53EA;&#x6709;DisplayAreaPolicy&#x7684;&#x5185;&#x90E8;&#x7C7B;DefaultProvider</span><br><span class="line">            </span><br><span class="line">            mDisplayAreaPolicy = mWmService.getDisplayAreaPolicyProvider().instantiate(</span><br><span class="line">                    mWmService, this /* content */, this /* root */,</span><br><span class="line">                    mImeWindowsContainer);</span><br><span class="line">        }</span><br><span class="line">        // &#x4E8B;&#x52A1;&#x76F8;&#x5173;&#x8BBE;&#x7F6E;</span><br><span class="line">        transaction</span><br><span class="line">                .setLayer(mSurfaceControl, 0)</span><br><span class="line">                .setLayerStack(mSurfaceControl, mDisplayId)</span><br><span class="line">                .show(mSurfaceControl)</span><br><span class="line">                .setLayer(mOverlayLayer, Integer.MAX_VALUE)</span><br><span class="line">                .show(mOverlayLayer);</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x4E00;&#x5757;&#x6211;&#x4EEC;&#x76EE;&#x524D;&#x53EF;&#x4EE5;&#x5FFD;&#x7565;transaction&#x7684;&#x4EE3;&#x7801;&#x53EA;&#x9700;&#x8981;&#x5173;&#x5FC3;&#x4E2D;&#x95F4;&#x201C;getDisplayAreaPolicyProvider&#x201D;&#x8FD9;&#x4E00;&#x5757;&#x5C31;&#x597D;&#x4E86;&#xFF0C;&#x8FD9;&#x6BB5;&#x662F;&#x5C42;&#x7EA7;&#x6811;&#x7684;&#x4E3B;&#x6D41;&#x7A0B;&#x3002;</p>
<p>tips:</p>
<ol>
<li>&#x65B9;&#x6CD5;&#x6700;&#x5F00;&#x59CB;&#x7684; setName&#x8BBE;&#x7F6E;name&#x5728;&#x5C42;&#x7EA7;&#x6811;&#x662F;&#x80FD;&#x627E;&#x5230;&#x5BF9;&#x5E94;&#x540D;&#x5B57;&#x7684;</li>
<li>&#x6CE8;&#x610F;instantiate&#x5012;&#x6570;&#x7B2C;3&#x7B2C;4&#x90FD;&#x4E2A;&#x53C2;&#x6570;&#x4F20;&#x9012;&#x7684;&#x90FD;&#x662F;this&#xFF0C;&#x4E5F;&#x5C31;&#x662F;DisplayContent&#xFF0C; &#x56E0;&#x4E3A; DisplayContent&#x8FD9;&#x662F;&#x7684;&#x7236;&#x7C7B;&#x662F;RootDisplayArea</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">csharp&#x590D;&#x5236;&#x4EE3;&#x7801;# DisplayContent</span><br><span class="line">    String getName() {</span><br><span class="line">        return &quot;Display &quot; + mDisplayId + &quot; name=\&quot;&quot; + mDisplayInfo.name + &quot;\&quot;&quot;;</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>mDisplayId &#x5982;&#x679C;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x5C4F;&#x5E55;&#x5C31;&#x662F; 0 &#xFF0C;&#x6240;&#x4EE5;dump&#x5230;&#x5C42;&#x7EA7;&#x6811;&#x4E2D;&#x7684;&#x8FD9;&#x53E5;&#x4FE1;&#x606F;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&#x590D;&#x5236;&#x4EE3;&#x7801;  #0 Display 0 name=&quot;Built-in Screen&quot;</span><br></pre></td></tr></table></figure>

<p>&#x5C31;&#x662F;&#x5728;&#x8FD9;&#x91CC;&#x8BBE;&#x7F6E;&#x7684;&#xFF0C;&#x540E;&#x9762;&#x7684;&#x201D;Built-in Screen&#x201D;&#x5BF9;&#x5E94;&#x7684;&#x5E94;&#x8BE5;&#x5C31;&#x662F;mDisplayInfo.name&#x4E86;&#x3002;<br>&#x63A5;&#x4E0B;&#x6765;&#x7EE7;&#x7EED;&#x770B;&#x4E3B;&#x6D41;&#x7A0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">scss&#x590D;&#x5236;&#x4EE3;&#x7801;# DisplayAreaPolicy.Provider</span><br><span class="line">        @Override</span><br><span class="line">        public DisplayAreaPolicy instantiate(WindowManagerService wmService,</span><br><span class="line">                DisplayContent content, RootDisplayArea root,</span><br><span class="line">                DisplayArea.Tokens imeContainer) {</span><br><span class="line"></span><br><span class="line">            // &#x91CD;&#x70B9;*1. &#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x540D;&#x4E3A; &quot;DefaultTaskDisplayArea&quot; &#x7684;&#x5BF9;&#x8C61;&#x4F5C;&#x4E3A;&#x5E94;&#x7528;&#x7A97;&#x53E3;&#x7684;&#x9ED8;&#x8BA4;&#x5BB9;&#x5668;&#xFF08;&#x7B2C;&#x4E09;&#x4E2A;&#x53C2;&#x6570;Feature&#x4E3A;FEATURE_DEFAULT_TASK_CONTAINER&#xFF09;</span><br><span class="line">            final TaskDisplayArea defaultTaskDisplayArea = new TaskDisplayArea(content, wmService,</span><br><span class="line">                    &quot;DefaultTaskDisplayArea&quot;, FEATURE_DEFAULT_TASK_CONTAINER);</span><br><span class="line">            final List&lt;TaskDisplayArea&gt; tdaList = new ArrayList&lt;&gt;();</span><br><span class="line">            //  &#x5B9E;&#x9645;&#x4E0A;&#x53EA;&#x6709;1&#x4E2A;&#x5143;&#x7D20;</span><br><span class="line">            tdaList.add(defaultTaskDisplayArea);</span><br><span class="line"></span><br><span class="line">            // Define the features that will be supported under the root of the whole logical</span><br><span class="line">            // display. The policy will build the DisplayArea hierarchy based on this.</span><br><span class="line">            // &#x4F20;&#x9012;RootDisplayArea&#xFF08;DisplayContent&#xFF09;&#x6784;&#x5EFA;&#x51FA;&#x4E00;&#x4E2A;&#x5C42;&#x7EA7;&#x6811;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;</span><br><span class="line">            final HierarchyBuilder rootHierarchy = new HierarchyBuilder(root);</span><br><span class="line">            // Set the essential containers (even if the display doesn&apos;t support IME).</span><br><span class="line">            // &#x8BBE;&#x7F6E;&#x8F93;&#x5165;&#x6CD5;&#x5BB9;&#x5668;</span><br><span class="line">            rootHierarchy.setImeContainer(imeContainer).setTaskDisplayAreas(tdaList);</span><br><span class="line"></span><br><span class="line">            // &#x8FD9;&#x4E2A;&#x6761;&#x4EF6;&#x6EE1;&#x8DB3;&#xFF0C;&#x80AF;&#x5B9A;&#x662F;&#x88AB;&#x4FE1;&#x4EFB;&#x7684;</span><br><span class="line">            if (content.isTrusted()) {</span><br><span class="line">                // &#x91CD;&#x70B9;* 2 &#x914D;&#x7F6E;&#x5C42;&#x7EA7;&#x7684;&#x652F;&#x6301;&#x7684;Feature</span><br><span class="line">                configureTrustedHierarchyBuilder(rootHierarchy, wmService, content);</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            // Instantiate the policy with the hierarchy defined above. This will create and attach</span><br><span class="line">            // all the necessary DisplayAreas to the root.</span><br><span class="line">            // &#x91CD;&#x70B9;* 3 &#x771F;&#x6B63;&#x5F00;&#x59CB;&#x6784;&#x5EFA;&#x5C42;&#x7EA7;&#x6811;</span><br><span class="line">            return new DisplayAreaPolicyBuilder().setRootHierarchy(rootHierarchy).build(wmService);</span><br><span class="line">        }</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x662F;&#x5728;DisplayContent&#x6784;&#x9020;&#x51FD;&#x6570;&#x6389;&#x8FDB;&#x6765;&#x7684;&#xFF0C;&#x6CE8;&#x610F;&#x6700;&#x540E;2&#x4E2A;&#x53C2;&#x6570;&#xFF0C;root&#x8868;&#x793A;&#x8DDF;&#x5BB9;&#x5668;&#xFF0C;imeContainer&#x5219;&#x662F;&#x8F93;&#x5165;&#x6CD5;&#x5BB9;&#x5668;&#xFF0C;&#x5728;DisplayContent&#x4E2D;&#x4F20;&#x8FC7;&#x6765;&#x7684;&#xFF0C;&#x7136;&#x540E;&#x88AB;&#x901A;&#x8FC7;setImeContainer&#x8BBE;&#x7F6E;&#x7ED9;&#x4E86;HierarchyBuilder&#x3002;<br>&#x91CD;&#x70B9;&#x5206;&#x6790;&#xFF1A;</p>
<ol>
<li>&#x201C;DefaultTaskDisplayArea&#x201D; &#x7EC8;&#x4E8E;&#x51FA;&#x73B0;&#x4E86;&#xFF0C; &#x53EF;&#x4EE5;&#x770B;&#x5230;&#x786E;&#x5B9E;&#x662F;TaskDisplayArea&#x5BF9;&#x8C61;&#xFF0C;&#x7136;&#x540E;FEATURE_DEFAULT_TASK_CONTAINER&#x8FD9;&#x4E2A;ID&#x7684;&#x503C;&#x5C31;&#x662F;1&#xFF0C; &#x90A3;&#x4E5F;&#x5C31;&#x662F;&#x5728;&#x7B2C;&#x4E8C;&#x5C42;,&#x548C;&#x5C42;&#x7EA7;&#x6811;&#x662F;&#x5BF9;&#x5E94;&#x7684;&#xFF0C;&#x7136;&#x540E;&#x6784;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;List&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x4E2A;&#x96C6;&#x5408;&#x5C31;&#x8FD9;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x3002;</li>
<li>&#x914D;&#x7F6E;&#x5C42;&#x7EA7;&#x7684;&#x652F;&#x6301;&#x7684;Feature</li>
<li>&#x5F00;&#x59CB;&#x771F;&#x6B63;&#x7684;&#x6784;&#x5EFA;</li>
</ol>
<h2 id="3-1-&#x914D;&#x7F6E;Feature"><a href="#3-1-&#x914D;&#x7F6E;Feature" class="headerlink" title="3.1 &#x914D;&#x7F6E;Feature"></a>3.1 &#x914D;&#x7F6E;Feature</h2><p>&#x53D1;&#x73B0;&#x5C42;&#x7EA7;&#x6811;&#x4E2D;&#x4E00;&#x5171;&#x5C31;&#x51FA;&#x73B0;&#x4E86;5&#x4E2A;Feature&#x5C31;&#x662F;&#x5728;&#x5F53;&#x524D;&#x65B9;&#x6CD5;&#x4E2D;&#x914D;&#x7F6E;&#x7684;&#xFF0C;&#x5206;&#x522B;&#x5982;&#x4E0B;&#xFF1A;<br>WindowedMagnification<br>HideDisplayCutout<br>OneHanded<br>FullscreenMagnification<br>ImePlaceholder</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">less&#x590D;&#x5236;&#x4EE3;&#x7801;# DisplayAreaPolicy.Provider</span><br><span class="line">        private void configureTrustedHierarchyBuilder(HierarchyBuilder rootHierarchy,</span><br><span class="line">                WindowManagerService wmService, DisplayContent content) {</span><br><span class="line">            // WindowedMagnification should be on the top so that there is only one surface</span><br><span class="line">            // to be magnified.</span><br><span class="line">            rootHierarchy.addFeature(new Feature.Builder(wmService.mPolicy, &quot;WindowedMagnification&quot;,</span><br><span class="line">                    FEATURE_WINDOWED_MAGNIFICATION)</span><br><span class="line">                    .upTo(TYPE_ACCESSIBILITY_MAGNIFICATION_OVERLAY)</span><br><span class="line">                    .except(TYPE_ACCESSIBILITY_MAGNIFICATION_OVERLAY)</span><br><span class="line">                    // Make the DA dimmable so that the magnify window also mirrors the dim layer.</span><br><span class="line">                    .setNewDisplayAreaSupplier(DisplayArea.Dimmable::new)</span><br><span class="line">                    .build());</span><br><span class="line">            if (content.isDefaultDisplay) {</span><br><span class="line">                // Only default display can have cutout.</span><br><span class="line">                // See LocalDisplayAdapter.LocalDisplayDevice#getDisplayDeviceInfoLocked.</span><br><span class="line">                rootHierarchy.addFeature(new Feature.Builder(wmService.mPolicy, &quot;HideDisplayCutout&quot;,</span><br><span class="line">                        FEATURE_HIDE_DISPLAY_CUTOUT)</span><br><span class="line">                        .all()</span><br><span class="line">                        .except(TYPE_NAVIGATION_BAR, TYPE_NAVIGATION_BAR_PANEL, TYPE_STATUS_BAR,</span><br><span class="line">                                TYPE_NOTIFICATION_SHADE)</span><br><span class="line">                        .build())</span><br><span class="line">                        .addFeature(new Feature.Builder(wmService.mPolicy, &quot;OneHanded&quot;,</span><br><span class="line">                                FEATURE_ONE_HANDED)</span><br><span class="line">                                .all()</span><br><span class="line">                                .except(TYPE_NAVIGATION_BAR, TYPE_NAVIGATION_BAR_PANEL,</span><br><span class="line">                                        TYPE_SECURE_SYSTEM_OVERLAY)</span><br><span class="line">                                .build());</span><br><span class="line">            }</span><br><span class="line">            rootHierarchy</span><br><span class="line">                    .addFeature(new Feature.Builder(wmService.mPolicy, &quot;FullscreenMagnification&quot;,</span><br><span class="line">                            FEATURE_FULLSCREEN_MAGNIFICATION)</span><br><span class="line">                            .all()</span><br><span class="line">                            .except(TYPE_ACCESSIBILITY_MAGNIFICATION_OVERLAY, TYPE_INPUT_METHOD,</span><br><span class="line">                                    TYPE_INPUT_METHOD_DIALOG, TYPE_MAGNIFICATION_OVERLAY,</span><br><span class="line">                                    TYPE_NAVIGATION_BAR, TYPE_NAVIGATION_BAR_PANEL)</span><br><span class="line">                            .build())</span><br><span class="line">                    .addFeature(new Feature.Builder(wmService.mPolicy, &quot;ImePlaceholder&quot;,</span><br><span class="line">                            FEATURE_IME_PLACEHOLDER)</span><br><span class="line">                            .and(TYPE_INPUT_METHOD, TYPE_INPUT_METHOD_DIALOG)</span><br><span class="line">                            .build());</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x91CC;&#x6267;&#x884C;&#x4E86;5&#x6B21;addFeature&#xFF0C;&#x6BCF;&#x6B21;&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;Feature&#x521A;&#x597D;&#x662F;5&#x4E2A;&#x3002;Feature.Builder&#x6784;&#x9020;&#x4E00;&#x4E2A;Feature&#x5BF9;&#x8C61;&#xFF0C;&#x4EE3;&#x7801;&#x5982;&#x4E0B;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;# DisplayAreaPolicy.Feature.Builder</span><br><span class="line">            Builder(WindowManagerPolicy policy, String name, int id) {</span><br><span class="line">                mPolicy = policy;</span><br><span class="line">                mName = name;</span><br><span class="line">                mId = id;</span><br><span class="line">                mLayers = new boolean[mPolicy.getMaxWindowLayer() + 1];</span><br><span class="line">            }</span><br></pre></td></tr></table></figure>

<p>&#x6CE8;&#x610F;&#x540E;&#x9762;2&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x7B2C;&#x4E8C;&#x4E2A;&#x4E3A;name&#xFF0C;&#x5C31;&#x662F;&#x540D;&#x5B57;&#xFF0C;&#x540E;&#x9762;&#x7684;&#x662F;ID&#xFF0C;&#x6839;&#x636E;&#x4F7F;&#x7528;&#x7684;&#x5730;&#x65B9;&#x80AF;&#x5B9A;&#x662F;&#x5B9A;&#x4E49;&#x4E86;&#x5BF9;&#x5E94;ID&#x7684;&#x3002;<br>&#x7559;&#x610F;&#x4E0B;mLayers&#xFF0C;mPolicy.getMaxWindowLayer()&#x8FD4;&#x56DE;36&#x6240;&#x4EE5;&#x662F;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E2A;&#x957F;&#x5EA6;&#x4E3A;37&#x7684;boolean&#x7C7B;&#x578B;&#x6570;&#x7EC4;&#xFF0C;&#x5982;&#x679C;&#x4E3A;ture&#x8868;&#x793A;&#x8FD9;&#x4E2A;&#x56FE;&#x5C42;&#x652F;&#x6301;&#x8FD9;&#x4E2A;Feature&#xFF0C;&#x4E3A;false&#x53CD;&#x4E4B;&#x3002;</p>
<p>5&#x4E2A;Feature&#x5BF9;&#x5E94;&#x7684;ID&#x5982;&#x4E0B;&#xFF0C;&#x5E76;&#x4E14;&#x6709;&#x76F8;&#x5E94;&#x7684;&#x6CE8;&#x91CA;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">php&#x590D;&#x5236;&#x4EE3;&#x7801;# DisplayAreaOrganizer</span><br><span class="line">    /**</span><br><span class="line">     * Display area that can be magnified in</span><br><span class="line">     * ......</span><br><span class="line">     */</span><br><span class="line">    public static final int FEATURE_WINDOWED_MAGNIFICATION = FEATURE_SYSTEM_FIRST + 4;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Display area for hiding display cutout feature</span><br><span class="line">     * @hide</span><br><span class="line">     */</span><br><span class="line">    public static final int FEATURE_HIDE_DISPLAY_CUTOUT = FEATURE_SYSTEM_FIRST + 6;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Display area for one handed feature</span><br><span class="line">     */</span><br><span class="line">    public static final int FEATURE_ONE_HANDED = FEATURE_SYSTEM_FIRST + 3;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Display area that can be magnified in</span><br><span class="line">     * ......</span><br><span class="line">     */</span><br><span class="line">    public static final int FEATURE_FULLSCREEN_MAGNIFICATION = FEATURE_SYSTEM_FIRST + 5;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Display area that the IME container can be placed in. Should be enabled on every root</span><br><span class="line">     * hierarchy if IME container may be reparented to that hierarchy when the IME target changed.</span><br><span class="line">     * @hide</span><br><span class="line">     */</span><br><span class="line">    public static final int FEATURE_IME_PLACEHOLDER = FEATURE_SYSTEM_FIRST + 7;</span><br></pre></td></tr></table></figure>

<p>&#x6839;&#x636E;&#x6CE8;&#x91CA;&#x80FD;&#x77E5;&#x9053;&#x8FD9;&#x4E2A;Feature&#x4EE3;&#x8868;&#x8FD9;&#x4E2A;&#x56FE;&#x5C42;&#x5177;&#x4F53;&#x7528;&#x4E8E;&#x4EC0;&#x4E48;&#x7279;&#x5F81;&#x4E86;&#x3002;</p>
<p>&#x7136;&#x540E;&#x8FD8;&#x770B;&#x5230;all(),and(),except()&#x7B49;&#x65B9;&#x6CD5;&#x3002;</p>
<h3 id="3-1-1-all&#xFF0C;and&#xFF0C;except&#x65B9;&#x6CD5;"><a href="#3-1-1-all&#xFF0C;and&#xFF0C;except&#x65B9;&#x6CD5;" class="headerlink" title="3.1.1 all&#xFF0C;and&#xFF0C;except&#x65B9;&#x6CD5;"></a>3.1.1 all&#xFF0C;and&#xFF0C;except&#x65B9;&#x6CD5;</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">typescript&#x590D;&#x5236;&#x4EE3;&#x7801;# DisplayAreaPolicy.Feature.Builder</span><br><span class="line"></span><br><span class="line">     Builder all() {</span><br><span class="line">        Arrays.fill(mLayers, true);</span><br><span class="line">        return this;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    Builder and(int... types) {</span><br><span class="line">        for (int i = 0; i &lt; types.length; i++) {</span><br><span class="line">            int type = types[i];</span><br><span class="line">            set(type, true);</span><br><span class="line">        }</span><br><span class="line">        return this;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    Builder except(int... types) {</span><br><span class="line">        for (int i = 0; i &lt; types.length; i++) {</span><br><span class="line">            int type = types[i];</span><br><span class="line">            set(type, false);</span><br><span class="line">        }</span><br><span class="line">        return this;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    Builder upTo(int typeInclusive) {</span><br><span class="line">        // &#x6839;&#x636E;&#x4F20;&#x5165;&#x7684;type&#x8BA1;&#x7B97;&#x5230;&#x56FE;&#x5C42;</span><br><span class="line">        final int max = layerFromType(typeInclusive, false);</span><br><span class="line">        for (int i = 0; i &lt; max; i++) {</span><br><span class="line">            mLayers[i] = true;</span><br><span class="line">        }</span><br><span class="line">        set(typeInclusive, true);</span><br><span class="line">        return this;</span><br><span class="line">    </span><br><span class="line">    }</span><br><span class="line">    private void set(int type, boolean value) {</span><br><span class="line">        mLayers[layerFromType(type, true)] = value;</span><br><span class="line">        ......</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private int layerFromType(int type, boolean internalWindows) {</span><br><span class="line">        return mPolicy.getWindowLayerFromTypeLw(type, internalWindows);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    Feature build() {</span><br><span class="line">        // &#x9ED8;&#x8BA4;&#x4E3A;true</span><br><span class="line">        if (mExcludeRoundedCorner) {</span><br><span class="line">            // Always put the rounded corner layer to the top most layer.</span><br><span class="line">            mLayers[mPolicy.getMaxWindowLayer()] = false;</span><br><span class="line">        }</span><br><span class="line">        return new Feature(mName, mId, mLayers.clone(), mNewDisplayAreaSupplier);</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>mLayers&#x524D;&#x9762;&#x8BF4;&#x8FC7;&#x662F;&#x4E00;&#x4E2A;&#x957F;&#x5EA6;&#x4E3A;37&#x7684;&#x6570;&#x7EC4;,set&#x65B9;&#x6CD5;&#x5C31;&#x662F;&#x5C06;&#x53C2;&#x6570;&#x7684;&#x8FD9;&#x4E2A;&#x56FE;&#x5C42;&#xFF0C;&#x5BF9;&#x5E94;&#x7684;boolean&#x8BBE;&#x7F6E;&#x4E3A;true&#xFF0C; &#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#x5C31;&#x662F;&#x6307;&#x5B9A;&#x67D0;&#x4E2A;&#x56FE;&#x5C42;&#x662F;&#x5426;&#x652F;&#x6301;&#x8FD9;&#x4E2A;Feature&#x3002;<br><strong>all()</strong>&#xFF1A;&#x5C06;&#x6240;&#x6709;&#x6570;&#x7EC4;&#x6240;&#x6709;&#x503C;&#x90FD;&#x8BBE;&#x4E3A;true&#xFF0C;&#x8868;&#x793A;&#x6BCF;&#x4E2A;&#x56FE;&#x5C42;&#x90FD;&#x652F;&#x6301;&#x8FD9;&#x4E2A;Feature<br><strong>and()</strong>: &#x5C06;&#x6307;&#x5B9A;&#x67D0;&#x4E2A;&#x56FE;&#x5C42;&#x652F;&#x6301;&#x8FD9;&#x4E2A;Feature<br><strong>except&#xFF08;&#xFF09;</strong>&#xFF1A;&#x5C06;&#x6307;&#x5B9A;&#x67D0;&#x4E2A;&#x56FE;&#x5C42;&#x4E0D;&#x652F;&#x6301;&#x8FD9;&#x4E2A;Feature<br><strong>upTo()</strong>: &#x5C06;&#x652F;&#x6301;Feature&#x7684;&#x56FE;&#x5C42;&#x8BBE;&#x7F6E;&#x4E3A;&#x4ECE;0&#x5230;typeInclusive<br><strong>build()</strong>&#xFF1A;&#x5C06;&#x6570;&#x7EC4;&#x7684;&#x6700;&#x540E;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x8BBE;&#x7F6E;&#x4E3A;false&#xFF0C;&#x5254;&#x9664;&#x6700;&#x540E;&#x4E00;&#x5C42;</p>
<p>&#x8FD9;&#x91CC;&#x7684;&#x51E0;&#x4E2A;&#x65B9;&#x6CD5;&#x90FD;&#x4F1A;&#x8C03;&#x7528;&#x5230;layerFromType&#xFF0C;&#x6839;&#x636E;layerFromType&#x65B9;&#x6CD5;&#x7684;&#x8C03;&#x7528;&#x77E5;&#x9053;&#x5177;&#x4F53;&#x903B;&#x8F91;&#x5728;WindowManagerPolicy::getWindowLayerFromTypeLw&#x65B9;&#x6CD5;&#x63A7;&#x5236;&#x7684;.<br>&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x6709;&#x70B9;&#x957F;&#x662F;&#x56E0;&#x4E3A;&#x597D;&#x591A;case&#xFF0C;&#x4F46;&#x662F;&#x603B;&#x4F53;&#x903B;&#x8F91;&#x5E76;&#x4E0D;&#x590D;&#x6742;,&#x4E3B;&#x8981;&#x5173;&#x6CE8;&#x4F20;&#x5165;&#x7684;WindowType&#x548C;&#x8FD4;&#x56DE;&#x7684;Layertype&#xFF0C;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x8FD4;&#x56DE;&#x5C42;&#x7EA7;&#x6811;&#x4E2D;&#x6240;&#x5728;&#x7684;&#x56FE;&#x5C42;&#x3002;</p>
<h3 id="3-1-2-&#x91CD;&#x70B9;&#xFF1A;getWindowLayerFromTypeLw&#x65B9;&#x6CD5;-&#xFF08;&#x51B3;&#x5B9A;&#x7A97;&#x53E3;&#x6302;&#x8F7D;&#x5728;&#x90A3;&#x4E00;&#x5C42;&#xFF09;"><a href="#3-1-2-&#x91CD;&#x70B9;&#xFF1A;getWindowLayerFromTypeLw&#x65B9;&#x6CD5;-&#xFF08;&#x51B3;&#x5B9A;&#x7A97;&#x53E3;&#x6302;&#x8F7D;&#x5728;&#x90A3;&#x4E00;&#x5C42;&#xFF09;" class="headerlink" title="3.1.2 &#x91CD;&#x70B9;&#xFF1A;getWindowLayerFromTypeLw&#x65B9;&#x6CD5; &#xFF08;&#x51B3;&#x5B9A;&#x7A97;&#x53E3;&#x6302;&#x8F7D;&#x5728;&#x90A3;&#x4E00;&#x5C42;&#xFF09;"></a>3.1.2 &#x91CD;&#x70B9;&#xFF1A;getWindowLayerFromTypeLw&#x65B9;&#x6CD5; &#xFF08;&#x51B3;&#x5B9A;&#x7A97;&#x53E3;&#x6302;&#x8F7D;&#x5728;&#x90A3;&#x4E00;&#x5C42;&#xFF09;</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;# WindowManagerPolicy</span><br><span class="line">    default int getWindowLayerFromTypeLw(int type, boolean canAddInternalSystemWindow,</span><br><span class="line">            boolean roundedCornerOverlay) {</span><br><span class="line">        // Always put the rounded corner layer to the top most.</span><br><span class="line">        // &#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#x4E3A;false,&#x8FD9;&#x91CC;&#x5FFD;&#x7565;</span><br><span class="line">        if (roundedCornerOverlay &amp;&amp; canAddInternalSystemWindow) {</span><br><span class="line">            return getMaxWindowLayer();</span><br><span class="line">        }</span><br><span class="line">        // &#x6839;&#x636E;&#x8FD9;2&#x4E2A;type&#x540D;&#x5B57;&#x4E5F;&#x77E5;&#x9053;&#x8868;&#x793A; APP&#x56FE;&#x5C42;&#xFF0C;&#x5BF9;&#x5E94;&#x7684;&#x503C;&#x662F;1-99&#xFF0C;&#x5982;&#x679C;&#x5904;&#x4E8E;&#x8FD9;&#x76F4;&#x63A5;&#x5C31;&#x8FD4;&#x56DE;APPLICATION_LAYER =2</span><br><span class="line">        if (type &gt;= FIRST_APPLICATION_WINDOW &amp;&amp; type &lt;= LAST_APPLICATION_WINDOW) {</span><br><span class="line">            return APPLICATION_LAYER;</span><br><span class="line">        }</span><br><span class="line">        // &#x7136;&#x540E;&#x5F00;&#x59CB;&#x6839;&#x636E;&#x5404;&#x4E2A;WindowType&#xFF0C;&#x53BB;&#x8FD4;&#x56DE;&#x5176;&#x5728;&#x5C42;&#x7EA7;&#x6811;&#x4E2D;&#x6240;&#x5728;&#x7684;&#x56FE;&#x5C42;</span><br><span class="line">        switch (type) {</span><br><span class="line">            case TYPE_WALLPAPER:</span><br><span class="line">                // wallpaper is at the bottom, though the window manager may move it.</span><br><span class="line">                return  1;</span><br><span class="line">            case TYPE_PRESENTATION:</span><br><span class="line">            case TYPE_PRIVATE_PRESENTATION:</span><br><span class="line">            case TYPE_DOCK_DIVIDER:</span><br><span class="line">            case TYPE_QS_DIALOG:</span><br><span class="line">            case TYPE_PHONE:</span><br><span class="line">                return  3;</span><br><span class="line">            case TYPE_SEARCH_BAR:</span><br><span class="line">                return  4;</span><br><span class="line">            case TYPE_INPUT_CONSUMER:</span><br><span class="line">                return  5;</span><br><span class="line">            case TYPE_SYSTEM_DIALOG:</span><br><span class="line">                return  6;</span><br><span class="line">            case TYPE_TOAST:</span><br><span class="line">                // toasts and the plugged-in battery thing</span><br><span class="line">                return  7;</span><br><span class="line">            case TYPE_PRIORITY_PHONE:</span><br><span class="line">                // SIM errors and unlock.  Not sure if this really should be in a high layer.</span><br><span class="line">                return  8;</span><br><span class="line">            case TYPE_SYSTEM_ALERT:</span><br><span class="line">                // like the ANR / app crashed dialogs</span><br><span class="line">                // Type is deprecated for non-system apps. For system apps, this type should be</span><br><span class="line">                // in a higher layer than TYPE_APPLICATION_OVERLAY.</span><br><span class="line">                return  canAddInternalSystemWindow ? 12 : 9;</span><br><span class="line">            case TYPE_APPLICATION_OVERLAY:</span><br><span class="line">                return  11;</span><br><span class="line">            case TYPE_INPUT_METHOD:</span><br><span class="line">                // on-screen keyboards and other such input method user interfaces go here.</span><br><span class="line">                return  13;</span><br><span class="line">            case TYPE_INPUT_METHOD_DIALOG:</span><br><span class="line">                // on-screen keyboards and other such input method user interfaces go here.</span><br><span class="line">                return  14;</span><br><span class="line">            case TYPE_STATUS_BAR:</span><br><span class="line">                return  15;</span><br><span class="line">            case TYPE_STATUS_BAR_ADDITIONAL:</span><br><span class="line">                return  16;</span><br><span class="line">            case TYPE_NOTIFICATION_SHADE:</span><br><span class="line">                return  17;</span><br><span class="line">            case TYPE_STATUS_BAR_SUB_PANEL:</span><br><span class="line">                return  18;</span><br><span class="line">            case TYPE_KEYGUARD_DIALOG:</span><br><span class="line">                return  19;</span><br><span class="line">            case TYPE_VOICE_INTERACTION_STARTING:</span><br><span class="line">                return  20;</span><br><span class="line">            case TYPE_VOICE_INTERACTION:</span><br><span class="line">                // voice interaction layer should show above the lock screen.</span><br><span class="line">                return  21;</span><br><span class="line">            case TYPE_VOLUME_OVERLAY:</span><br><span class="line">                // the on-screen volume indicator and controller shown when the user</span><br><span class="line">                // changes the device volume</span><br><span class="line">                return  22;</span><br><span class="line">            case TYPE_SYSTEM_OVERLAY:</span><br><span class="line">                // the on-screen volume indicator and controller shown when the user</span><br><span class="line">                // changes the device volume</span><br><span class="line">                return  canAddInternalSystemWindow ? 23 : 10;</span><br><span class="line">            case TYPE_NAVIGATION_BAR:</span><br><span class="line">                // the navigation bar, if available, shows atop most things</span><br><span class="line">                return  24;</span><br><span class="line">            case TYPE_NAVIGATION_BAR_PANEL:</span><br><span class="line">                // some panels (e.g. search) need to show on top of the navigation bar</span><br><span class="line">                return  25;</span><br><span class="line">            case TYPE_SCREENSHOT:</span><br><span class="line">                // screenshot selection layer shouldn&apos;t go above system error, but it should cover</span><br><span class="line">                // navigation bars at the very least.</span><br><span class="line">                return  26;</span><br><span class="line">            case TYPE_SYSTEM_ERROR:</span><br><span class="line">                // system-level error dialogs</span><br><span class="line">                return  canAddInternalSystemWindow ? 27 : 9;</span><br><span class="line">            case TYPE_MAGNIFICATION_OVERLAY:</span><br><span class="line">                // used to highlight the magnified portion of a display</span><br><span class="line">                return  28;</span><br><span class="line">            case TYPE_DISPLAY_OVERLAY:</span><br><span class="line">                // used to simulate secondary display devices</span><br><span class="line">                return  29;</span><br><span class="line">            case TYPE_DRAG:</span><br><span class="line">                // the drag layer: input for drag-and-drop is associated with this window,</span><br><span class="line">                // which sits above all other focusable windows</span><br><span class="line">                return  30;</span><br><span class="line">            case TYPE_ACCESSIBILITY_OVERLAY:</span><br><span class="line">                // overlay put by accessibility services to intercept user interaction</span><br><span class="line">                return  31;</span><br><span class="line">            case TYPE_ACCESSIBILITY_MAGNIFICATION_OVERLAY:</span><br><span class="line">                return 32;</span><br><span class="line">            case TYPE_SECURE_SYSTEM_OVERLAY:</span><br><span class="line">                return  33;</span><br><span class="line">            case TYPE_BOOT_PROGRESS:</span><br><span class="line">                return  34;</span><br><span class="line">            case TYPE_POINTER:</span><br><span class="line">                // the (mouse) pointer layer</span><br><span class="line">                return  35;</span><br><span class="line">            default:</span><br><span class="line">                Slog.e(&quot;WindowManager&quot;, &quot;Unknown window type: &quot; + type);</span><br><span class="line">                return 3;</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>&#x4EE3;&#x7801;&#x5F88;&#x957F;&#x4E0D;&#x7528;&#x4E00;&#x4E2A;&#x4E2A;&#x770B;&#xFF0C;&#x76F4;&#x63A5;&#x6839;&#x636E;&#x53C2;&#x6570;&#x627E;&#x5C31;&#x597D;&#xFF0C;&#x6BD4;&#x5982;&#x5F53;&#x53C2;&#x6570;&#x662F;TYPE_ACCESSIBILITY_MAGNIFICATION_OVERLAY&#xFF0C;&#x90A3;&#x5BF9;&#x4E8E;&#x7684;&#x8FD4;&#x56DE;&#x5C31;&#x662F;32&#x3002;<br>&#x540E;&#x9762;&#x770B;&#x5230;&#x7684;&#x5BF9;&#x5E94;&#x7684;TYPE&#xFF0C;&#x76F4;&#x63A5;&#x590D;&#x5236;WindowManagerPolicy&#x7C7B;&#x4E0B;&#x641C;&#x7D22;&#x5373;&#x53EF;&#x3002;</p>
<p>&#x73B0;&#x5728;&#x518D;&#x91CD;&#x65B0;&#x770B;&#x770B;configureTrustedHierarchyBuilder&#x65B9;&#x6CD5;&#x91CC;5&#x4E2A;Feature&#x5230;&#x5E95;&#x662F;&#x4EC0;&#x4E48;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">less&#x590D;&#x5236;&#x4EE3;&#x7801;# DisplayAreaPolicy.Provider</span><br><span class="line">        private void configureTrustedHierarchyBuilder(HierarchyBuilder rootHierarchy,</span><br><span class="line">                WindowManagerService wmService, DisplayContent content) {</span><br><span class="line">            // WindowedMagnification should be on the top so that there is only one surface</span><br><span class="line">            // to be magnified.</span><br><span class="line">            rootHierarchy.addFeature(new Feature.Builder(wmService.mPolicy, &quot;WindowedMagnification&quot;,</span><br><span class="line">                    FEATURE_WINDOWED_MAGNIFICATION)</span><br><span class="line">                    .upTo(TYPE_ACCESSIBILITY_MAGNIFICATION_OVERLAY) // 0-32</span><br><span class="line">                    .except(TYPE_ACCESSIBILITY_MAGNIFICATION_OVERLAY)// 32</span><br><span class="line">                    // Make the DA dimmable so that the magnify window also mirrors the dim layer.</span><br><span class="line">                    .setNewDisplayAreaSupplier(DisplayArea.Dimmable::new)</span><br><span class="line">                    .build()); // 0-31</span><br><span class="line">            if (content.isDefaultDisplay) {</span><br><span class="line">                // Only default display can have cutout.</span><br><span class="line">                // See LocalDisplayAdapter.LocalDisplayDevice#getDisplayDeviceInfoLocked.</span><br><span class="line">                rootHierarchy.addFeature(new Feature.Builder(wmService.mPolicy, &quot;HideDisplayCutout&quot;,</span><br><span class="line">                        FEATURE_HIDE_DISPLAY_CUTOUT)</span><br><span class="line">                        .all() //  0-36</span><br><span class="line">                        .except(TYPE_NAVIGATION_BAR, TYPE_NAVIGATION_BAR_PANEL, TYPE_STATUS_BAR,</span><br><span class="line">                                TYPE_NOTIFICATION_SHADE)//  24 25  15  17</span><br><span class="line">                        .build())// 0-14   16  18-23 26-35</span><br><span class="line">                        .addFeature(new Feature.Builder(wmService.mPolicy, &quot;OneHanded&quot;,</span><br><span class="line">                                FEATURE_ONE_HANDED)</span><br><span class="line">                                .all()</span><br><span class="line">                                .except(TYPE_NAVIGATION_BAR, TYPE_NAVIGATION_BAR_PANEL,</span><br><span class="line">                                        TYPE_SECURE_SYSTEM_OVERLAY)//24  25  33</span><br><span class="line">                                .build());// 0-23   26-32  34-35</span><br><span class="line">            }</span><br><span class="line">            rootHierarchy</span><br><span class="line">                    .addFeature(new Feature.Builder(wmService.mPolicy, &quot;FullscreenMagnification&quot;,</span><br><span class="line">                            FEATURE_FULLSCREEN_MAGNIFICATION)</span><br><span class="line">                            .all() // 0-36</span><br><span class="line">                            .except(TYPE_ACCESSIBILITY_MAGNIFICATION_OVERLAY, TYPE_INPUT_METHOD,</span><br><span class="line">                                    TYPE_INPUT_METHOD_DIALOG, TYPE_MAGNIFICATION_OVERLAY,</span><br><span class="line">                                    TYPE_NAVIGATION_BAR, TYPE_NAVIGATION_BAR_PANEL)// 32  13   14  28  24 25</span><br><span class="line">                            .build())// 0-12 15-23  26-27 29-31 33-35</span><br><span class="line">                    .addFeature(new Feature.Builder(wmService.mPolicy, &quot;ImePlaceholder&quot;,</span><br><span class="line">                            FEATURE_IME_PLACEHOLDER)</span><br><span class="line">                            .and(TYPE_INPUT_METHOD, TYPE_INPUT_METHOD_DIALOG)// 13-14</span><br><span class="line">                            .build());// 13-14</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<h2 id="3-2-Feature&#x603B;&#x7ED3;"><a href="#3-2-Feature&#x603B;&#x7ED3;" class="headerlink" title="3.2 Feature&#x603B;&#x7ED3;"></a>3.2 Feature&#x603B;&#x7ED3;</h2><p><strong>WindowedMagnification</strong>&#xFF1A;<br>&#x62E5;&#x6709;&#x7279;&#x5F81;&#x7684;&#x5C42;&#x7EA7;&#xFF1A; 0-31<br>&#x7279;&#x5F81;&#x63CF;&#x8FF0;&#xFF1A; &#x652F;&#x6301;&#x7A97;&#x53E3;&#x7F29;&#x653E;&#x7684;&#x4E00;&#x5757;&#x533A;&#x57DF;&#xFF0C;&#x4E00;&#x822C;&#x662F;&#x901A;&#x8FC7;&#x8F85;&#x52A9;&#x670D;&#x52A1;&#x8FDB;&#x884C;&#x7F29;&#x5C0F;&#x6216;&#x653E;&#x5927;</p>
<p><strong>HideDisplayCutout</strong>&#xFF1A;<br>&#x62E5;&#x6709;&#x7279;&#x5F81;&#x7684;&#x5C42;&#x7EA7;&#xFF1A; 0-14 16 18-23 26-35<br>&#x7279;&#x5F81;&#x63CF;&#x8FF0;&#xFF1A;&#x9690;&#x85CF;&#x526A;&#x5207;&#x533A;&#x57DF;&#xFF0C;&#x5373;&#x5728;&#x9ED8;&#x8BA4;&#x663E;&#x793A;&#x8BBE;&#x5907;&#x4E0A;&#x9690;&#x85CF;&#x4E0D;&#x89C4;&#x5219;&#x5F62;&#x72B6;&#x7684;&#x5C4F;&#x5E55;&#x533A;&#x57DF;&#xFF0C;&#x6BD4;&#x5982;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x6253;&#x5F00;&#x8FD9;&#x4E2A;&#x529F;&#x80FD;&#x540E;&#xFF0C;&#x6709;&#x8FD9;&#x4E2A;&#x529F;&#x80FD;&#x7684;&#x56FE;&#x5C42;&#x5C31;&#x4E0D;&#x4F1A;&#x5EF6;&#x4F38;&#x5230;&#x5218;&#x6D77;&#x5C4F;&#x533A;&#x57DF;&#x3002;</p>
<p><strong>OneHanded</strong>&#xFF1A;<br>&#x62E5;&#x6709;&#x7279;&#x5F81;&#x7684;&#x5C42;&#x7EA7;&#xFF1A;0-23 26-32 34-35<br>&#x7279;&#x5F81;&#x63CF;&#x8FF0;&#xFF1A;&#x8868;&#x793A;&#x652F;&#x6301;&#x5355;&#x624B;&#x64CD;&#x4F5C;&#x7684;&#x56FE;&#x5C42;&#xFF0C;&#x8FD9;&#x4E2A;&#x529F;&#x80FD;&#x5728;&#x624B;&#x673A;&#x4E0A;&#x8FD8;&#x662F;&#x633A;&#x5E38;&#x89C1;&#x7684;</p>
<p><strong>FullscreenMagnification</strong>&#xFF1A;<br>&#x62E5;&#x6709;&#x7279;&#x5F81;&#x7684;&#x5C42;&#x7EA7;&#xFF1A;0-12 15-23 26-27 29-31 33-35<br>&#x7279;&#x5F81;&#x63CF;&#x8FF0;&#xFF1A;&#x652F;&#x6301;&#x5168;&#x5C4F;&#x5E55;&#x7F29;&#x653E;&#x7684;&#x56FE;&#x5C42;&#xFF0C;&#x548C;&#x4E0A;&#x9762;&#x7684;&#x4E0D;&#x540C;&#xFF0C;&#x8FD9;&#x4E2A;&#x662F;&#x5168;&#x5C4F;&#x7F29;&#x653E;&#xFF0C;&#x524D;&#x9762;&#x90A3;&#x4E2A;&#x53EF;&#x4EE5;&#x5C40;&#x90E8;</p>
<p><strong>ImePlaceholder</strong>&#xFF1A;<br>&#x62E5;&#x6709;&#x7279;&#x5F81;&#x7684;&#x5C42;&#x7EA7;&#xFF1A; 13-14<br>&#x7279;&#x5F81;&#x63CF;&#x8FF0;&#xFF1A;&#x8F93;&#x5165;&#x6CD5;&#x76F8;&#x5173;</p>
<p>&#x518D;&#x653E;&#x4E0A;&#x4E4B;&#x524D;&#x753B;&#x7684;&#x5C42;&#x7EA7;&#x6811;&#x66F4;&#x52A0;&#x6E05;&#x6670;&#x4E86;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/ba727d9fe298a3fb72ab48f7c67ba8e1218e8178a1374b13e88d0ddd92293758" alt="&#x5C42;&#x7EA7;&#x7ED3;&#x6784;&#x6811;.png"></p>
<h2 id="3-3-&#x6784;&#x5EFA;&#x5C42;&#x7EA7;&#x6811;-DisplayAreaPolicyBuilder-build"><a href="#3-3-&#x6784;&#x5EFA;&#x5C42;&#x7EA7;&#x6811;-DisplayAreaPolicyBuilder-build" class="headerlink" title="3.3 &#x6784;&#x5EFA;&#x5C42;&#x7EA7;&#x6811; DisplayAreaPolicyBuilder::build"></a>3.3 &#x6784;&#x5EFA;&#x5C42;&#x7EA7;&#x6811; DisplayAreaPolicyBuilder::build</h2><p>&#x4E0A;&#x9762;&#x53EA;&#x662F;&#x5C06;5&#x4E2A;Feature&#x6DFB;&#x52A0;&#x5230;&#x4E86;rootHierarchy&#x7684;mFeatures&#x8FD9;&#x4E2A;&#x96C6;&#x5408;&#x4E2D;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">csharp&#x590D;&#x5236;&#x4EE3;&#x7801;# HierarchyBuilder</span><br><span class="line">    private final ArrayList&lt;DisplayAreaPolicyBuilder.Feature&gt; mFeatures = new ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        HierarchyBuilder addFeature(DisplayAreaPolicyBuilder.Feature feature) {</span><br><span class="line">            mFeatures.add(feature);</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br></pre></td></tr></table></figure>

<p>DisplayAreaPolicyBuilder::setRootHierarchy&#x65B9;&#x6CD5;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x5C31;&#x662F;&#x628A;&#x6DFB;&#x52A0;&#x4E86;ImeContainer&#x548C;5&#x4E2A;Feature&#x7684;HierarchyBuilder&#x8BBE;&#x7F6E;&#x7ED9;DisplayAreaPolicyBuilder</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;# DisplayAreaPolicyBuilder</span><br><span class="line">    DisplayAreaPolicyBuilder setRootHierarchy(HierarchyBuilder rootHierarchyBuilder) {</span><br><span class="line">        mRootHierarchyBuilder = rootHierarchyBuilder;</span><br><span class="line">        return this;</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>&#x7136;&#x540E;&#x5F00;&#x59CB;&#x6267;&#x884C;DisplayAreaPolicyBuilder::build</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">scss&#x590D;&#x5236;&#x4EE3;&#x7801;# DisplayAreaPolicyBuilder</span><br><span class="line">    // &#x8FD9;&#x4E2A;&#x53EF;&#x4EE5;&#x5FFD;&#x7565;&#xFF0C;&#x6CA1;&#x6709;&#x503C;</span><br><span class="line">    private final ArrayList&lt;HierarchyBuilder&gt; mDisplayAreaGroupHierarchyBuilders =</span><br><span class="line">            new ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    Result build(WindowManagerService wmService) {</span><br><span class="line">        //  &#x5BF9;&#x8F93;&#x5165;&#x53C2;&#x6570;&#x8FDB;&#x884C;&#x9A8C;&#x8BC1;&#xFF0C;&#x786E;&#x4FDD;&#x5B83;&#x4EEC;&#x662F;&#x6709;&#x6548;&#x7684;</span><br><span class="line">        validate();</span><br><span class="line"></span><br><span class="line">        // Attach DA group roots to screen hierarchy before adding windows to group hierarchies.</span><br><span class="line">        // &#x91CD;&#x70B9;&#xFF1A;&#x6784;&#x5EFA;&#x5C42;&#x7EA7;&#x6811;</span><br><span class="line">        mRootHierarchyBuilder.build(mDisplayAreaGroupHierarchyBuilders);</span><br><span class="line">        // &#x56E0;&#x4E3A;mDisplayAreaGroupHierarchyBuilders&#x6CA1;&#x6709;&#x503C;&#xFF0C;&#x540E;&#x9762;&#x7684;&#x90FD;&#x53EF;&#x4EE5;&#x5FFD;&#x7565;</span><br><span class="line">        ......</span><br><span class="line">        return new Result(wmService, mRootHierarchyBuilder.mRoot, displayAreaGroupRoots,</span><br><span class="line">                mSelectRootForWindowFunc);</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><h1 id="&#x5C42;&#x7EA7;&#x7ED3;&#x6784;&#x6811;&#x6784;&#x9020;"><a href="#&#x5C42;&#x7EA7;&#x7ED3;&#x6784;&#x6811;&#x6784;&#x9020;" class="headerlink" title="&#x5C42;&#x7EA7;&#x7ED3;&#x6784;&#x6811;&#x6784;&#x9020;"></a>&#x5C42;&#x7EA7;&#x7ED3;&#x6784;&#x6811;&#x6784;&#x9020;</h1></li>
</ol>
<p>&#x8FD9;&#x4E2A;mRootHierarchyBuilder&#x5C31;&#x662F;&#x4E0A;&#x4E00;&#x5C0F;&#x8282;&#x64CD;&#x4F5C;&#x7684;RootHierarchyBuilder&#xFF0C;&#x7136;&#x540E;&#x6267;&#x884C;&#x5176;build&#x65B9;&#x6CD5;&#xFF0C;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x975E;&#x5E38;&#x91CD;&#x8981;&#xFF01;&#xFF01;&#xFF01;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/ab156fd832b1a7d846cf887df8a39c270a4859cdb765d376f9d442dc926bc8f5" alt="&#x5C42;&#x7EA7;&#x6811;&#x6784;&#x9020;&#x56FE;.png"></p>
<p>&#x5728;&#x6784;&#x9020;&#x5C42;&#x7EA7;&#x6811;&#x4E00;&#x5171;&#x5206;&#x4E3A;2&#x6B65;&#xFF1A;</p>
<ol>
<li>&#x6784;&#x5EFA;PendingArea&#x6811;<ol>
<li>&#x6784;&#x5EFA;Feature&#x76F8;&#x5173;</li>
<li>&#x6784;&#x5EFA;Leaf&#x76F8;&#x5173;</li>
</ol>
</li>
<li>&#x6839;&#x636E;PendingArea&#x6811;&#x6784;&#x5EFA;&#x6700;&#x7EC8;&#x7684;DisplayAreas&#x6811;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5C42;&#x7EA7;&#x6811;</li>
</ol>
<p>&#x901A;&#x8FC7;2&#x4E2A;&#x7C7B;&#x7684;&#x540D;&#x5B57;&#x4E5F;&#x80FD;&#x611F;&#x89C9;&#x5230;&#x4E00;&#x4E9B;&#x5173;&#x7CFB;&#xFF0C;&#x6BD5;&#x7ADF;&#x53EB;Pending&#x3002;&#x65E2;&#x7136;&#x8981;&#x5148;&#x6784;&#x9020;PendingPendingArea&#xFF0C;&#x90A3;&#x80AF;&#x5B9A;&#x9700;&#x8981;&#x5148;&#x770B;&#x770B;PendingArea&#x8FD9;&#x4E2A;&#x6570;&#x636E;&#x7ED3;&#x6784;</p>
<h2 id="4-1-&#x6570;&#x636E;&#x7ED3;&#x6784;-PendingArea&#x7B80;&#x4ECB;"><a href="#4-1-&#x6570;&#x636E;&#x7ED3;&#x6784;-PendingArea&#x7B80;&#x4ECB;" class="headerlink" title="4.1 &#x6570;&#x636E;&#x7ED3;&#x6784; PendingArea&#x7B80;&#x4ECB;"></a>4.1 &#x6570;&#x636E;&#x7ED3;&#x6784; PendingArea&#x7B80;&#x4ECB;</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;# DisplayAreaPolicyBuilder.PendingArea</span><br><span class="line"></span><br><span class="line">    static class PendingArea {</span><br><span class="line">        final int mMinLayer; // &#x6700;&#x5C0F;&#x5C42;&#x7EA7;</span><br><span class="line">        final ArrayList&lt;PendingArea&gt; mChildren = new ArrayList&lt;&gt;();// &#x6709;Children&#x8BF4;&#x660E;&#x4E5F;&#x662F;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;</span><br><span class="line">        final Feature mFeature; //  &#x5F53;&#x524D;&#x652F;&#x6301;&#x7684;Feature</span><br><span class="line">        final PendingArea mParent; // &#x6709;&#x7236;&#x4EB2;</span><br><span class="line">        int mMaxLayer; // &#x6700;&#x5927;&#x5C42;&#x7EA7;</span><br><span class="line">        // &#x4ECE;&#x8FD9;&#x51E0;&#x4E2A;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x5176;&#x5B9E;&#x80FD;&#x611F;&#x89C9;&#x5230;&#x548C;&#x4E0A;&#x4E00;&#x7BC7;&#x753B;&#x7684;&#x5C42;&#x7EA7;&#x6811;&#x7684;&#x56FE;&#x6709;&#x70B9;&#x90A3;&#x5473;&#x4E86;</span><br><span class="line">        @Nullable DisplayArea mExisting; // &#x5F53;&#x524D;&#x5B58;&#x5728;&#x7684;&#x5BB9;&#x5668;</span><br><span class="line">        boolean mSkipTokens = false; // &#x53EA;&#x6709;&#x8F93;&#x5165;&#x6CD5;&#x548C;&#x5E94;&#x7528;&#x4F1A;&#x4E3A;true</span><br><span class="line"></span><br><span class="line">        PendingArea(Feature feature, int minLayer, PendingArea parent) {</span><br><span class="line">            mMinLayer = minLayer;</span><br><span class="line">            mFeature = feature;</span><br><span class="line">            mParent = parent;</span><br><span class="line">        }</span><br><span class="line">        ......</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>PendingArea&#x540E;&#x9762;&#x8FD8;&#x6709;&#x4E00;&#x4E9B;&#x65B9;&#x6CD5;&#xFF0C;&#x7B49;&#x540E;&#x9762;&#x4F1A;&#x518D;&#x6B21;&#x5177;&#x4F53;&#x5206;&#x6790;&#xFF0C;&#x5F53;&#x524D;&#x53EA;&#x6709;PendingArea&#x8FD9;&#x4E2A;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x662F;&#x4EC0;&#x4E48;&#x6837;&#x5C31;&#x597D;&#x4E86;&#x3002;</p>
<h2 id="4-2-&#x6784;&#x5EFA;PendingArea&#x6811;"><a href="#4-2-&#x6784;&#x5EFA;PendingArea&#x6811;" class="headerlink" title="4.2 &#x6784;&#x5EFA;PendingArea&#x6811;"></a>4.2 &#x6784;&#x5EFA;PendingArea&#x6811;</h2><p>&#x4E0B;&#x9762;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x6BD4;&#x8F83;&#x957F;&#x6211;&#x518D;&#x4EE3;&#x7801;&#x91CC;&#x52A0;&#x4E86;&#x5F88;&#x591A;&#x6CE8;&#x91CA;&#xFF0C;&#x5176;&#x5B9E;&#x8FD9;&#x4E00;&#x5757;&#x5C31;&#x662F;java&#x7684;&#x5FAA;&#x73AF;&#x5BF9;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x7684;&#x5904;&#x7406;&#x3002;&#x5C31;&#x548C;&#x521A;&#x5B66;java&#x7684;&#x65F6;&#x5019;&#x770B;2&#x4E2A;for&#x5FAA;&#x73AF;&#x4E00;&#x6837;&#x3002;<br>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x5176;&#x5B9E;&#x662F;&#x6784;&#x5EFA;&#x6574;&#x4E2A;&#x6811;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5148;&#x770B;&#x4E00;&#x773C;&#xFF0C;&#x540E;&#x9762;&#x4F1A;&#x518D;&#x5177;&#x4F53;&#x5206;&#x6790;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;# DisplayAreaPolicyBuilder.HierarchyBuilder</span><br><span class="line"></span><br><span class="line">        private final RootDisplayArea mRoot;</span><br><span class="line"></span><br><span class="line">        private void build(@Nullable List&lt;HierarchyBuilder&gt; displayAreaGroupHierarchyBuilders) {</span><br><span class="line">            final WindowManagerPolicy policy = mRoot.mWmService.mPolicy;</span><br><span class="line">            // &#x5B9A;&#x4E49;&#x6700;&#x5927;&#x5C42;&#x7EA7;&#x6570;  37 = 36+1 </span><br><span class="line">            final int maxWindowLayerCount = policy.getMaxWindowLayer() + 1;</span><br><span class="line">            // &#x5B58;&#x50A8;&#x6BCF;&#x4E2A;&#x7A97;&#x53E3;&#x5C42;&#x7EA7;&#x5BF9;&#x5E94;&#x7684; DisplayArea.Tokens,&#x4E00;&#x5171;37&#x4E2A;&#xFF0C;&#x540E;&#x7EED;&#x7A97;&#x53E3;&#x6302;&#x8F7D;&#x4E5F;&#x662F;&#x5728;&#x8FD9;&#x4E2A;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x4E0A;&#x627E;</span><br><span class="line">            // &#x5728;&#x65B9;&#x6CD5;&#x5E95;&#x90E8;&#x6267;&#x884C;instantiateChildren&#x7684;&#x65F6;&#x5019;&#x8C03;&#x7528;</span><br><span class="line">            final DisplayArea.Tokens[] displayAreaForLayer =</span><br><span class="line">                    new DisplayArea.Tokens[maxWindowLayerCount];</span><br><span class="line"></span><br><span class="line">            // &#x5B58;&#x50A8;&#x6BCF;&#x4E2A;&#x7279;&#x6027;&#x5BF9;&#x5E94;&#x7684; DisplayArea &#x5217;&#x8868;</span><br><span class="line">            // mFeatures&#x5C31;&#x662F;&#x5728;configureTrustedHierarchyBuilder&#x914D;&#x7F6E;&#x7684;Feature&#x5927;&#x5C0F;&#xFF0C;&#x5F88;&#x660E;&#x663E;&#x4E00;&#x5171;&#x662F;5&#x4E2A;</span><br><span class="line">            final Map&lt;Feature, List&lt;DisplayArea&lt;WindowContainer&gt;&gt;&gt; featureAreas =</span><br><span class="line">                    new ArrayMap&lt;&gt;(mFeatures.size());</span><br><span class="line">            for (int i = 0; i &lt; mFeatures.size(); i++) {</span><br><span class="line">                // &#x4E3A;&#x6BCF;&#x4E2A;feature&#xFF0C;&#x521B;&#x5EFA;&#x5176;&#x5BF9;&#x5E94;&#x7684;DisplayArea&#x5217;&#x8868;</span><br><span class="line">                featureAreas.put(mFeatures.get(i), new ArrayList&lt;&gt;());</span><br><span class="line">            }</span><br><span class="line">            // &#x5230;&#x8FD9;&#x91CC;featureAreas&#x91CC;&#x4E00;&#x5171;&#x662F;5&#x4E2A;&#x503C;&#xFF0C;key&#x5C31;&#x662F;&#x4E0A;&#x8282;&#x63D0;&#x5230;&#x7684;5&#x4E2A;Feature&#xFF0C;value&#x76EE;&#x524D;&#x5C31;&#x662F;&#x4E2A;&#x7A7A;&#x7684;List</span><br><span class="line"></span><br><span class="line">            // -------&#x6784;&#x5EFA;PendingArea&#x6811;----</span><br><span class="line">            // *1 &#x521B;&#x5EFA; PendingArea &#x6570;&#x7EC4;&#xFF0C;&#x7528;&#x4E8E;&#x4E34;&#x65F6;&#x5B58;&#x50A8;&#x6BCF;&#x4E2A;&#x7A97;&#x53E3;&#x5C42;&#x7EA7;&#x5BF9;&#x5E94;&#x7684; PendingArea&#xFF0C;&#x4E5F;&#x662F;37&#x4E2A;</span><br><span class="line">            // &#x540E;&#x9762;&#x9700;&#x8981;&#x5173;&#x6CE8;&#x8FD9;&#x4E2A;areaForLayer&#x6210;&#x5458;&#x7684;&#x53D8;&#x5316;</span><br><span class="line">            PendingArea[] areaForLayer = new PendingArea[maxWindowLayerCount];</span><br><span class="line">            // &#x5148;&#x521B;&#x5EFA;&#x4E2A;PendingArea &#x518D;&#x8BA9;areaForLayer&#x7684;37&#x4E2A;&#x6570;&#x636E;&#x90FD;&#x9ED8;&#x8BA4;&#x4E3A;root&#x7684;PendingArea</span><br><span class="line">            // &#x6CE8;&#x610F;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;feature&#x4E3A;null</span><br><span class="line">            final PendingArea root = new PendingArea(null, 0, null);</span><br><span class="line">            Arrays.fill(areaForLayer, root);</span><br><span class="line"></span><br><span class="line">            // 2. &#x6784;&#x5EFA;Features&#x7684;&#x6811;</span><br><span class="line">            // mFeatures.size&#x4E3A;5&#xFF0C;&#x6240;&#x4EE5;&#x6709;5&#x4E2A;&#x5927;&#x5FAA;&#x73AF;</span><br><span class="line">            final int size = mFeatures.size();</span><br><span class="line">            for (int i = 0; i &lt; size; i++) {</span><br><span class="line">                // &#x62FF;&#x5230;&#x5F53;&#x524D;&#x9700;&#x8981;&#x5904;&#x7406;&#x7684;Feature</span><br><span class="line">                final Feature feature = mFeatures.get(i);</span><br><span class="line">                PendingArea featureArea = null;</span><br><span class="line">                // &#x5185;&#x90E8;&#x5FAA;&#x73AF;&#xFF0C;37&#x6B21;</span><br><span class="line">                for (int layer = 0; layer &lt; maxWindowLayerCount; layer++) {</span><br><span class="line">                    // &#x5982;&#x679C;&#x8FD9;&#x4E2A;&#x5C42;&#x7EA7;&#xFF0C;&#x652F;&#x6301;&#x5F53;&#x524D;Feature</span><br><span class="line">                    if (feature.mWindowLayers[layer]) {</span><br><span class="line">                        //&#x5224;&#x65AD;&#x662F;&#x5426;&#x590D;&#x7528; PendingArea &#xFF08;&#x540C;&#x4E00;&#x4E2A;feature&#x624D;&#x590D;&#x7528;&#xFF0C;&#x5426;&#x5219;&#x521B;&#x5EFA;&#x65B0;&#x7684;&#xFF09;</span><br><span class="line">                        if (featureArea == null || featureArea.mParent != areaForLayer[layer]) {</span><br><span class="line">                            // &#x521B;&#x5EFA;&#x65B0;&#x7684; PendingArea&#xFF0C;&#x4F5C;&#x4E3A;&#x4E0A;&#x4E00;&#x5C42;&#x7EA7;&#x7684;&#x5B50;&#x8282;&#x70B9;&#xFF0C;&#x7528;&#x4E8E;&#x5F53;&#x524D;&#x5C42;&#x7EA7;&#xFF0C;&#x5E76;&#x4E14;&#x53CC;&#x5411;&#x5954;&#x8D74;&#xFF0C;&#x8BBE;&#x7F6E;&#x4E3A;&#x5404;&#x81EA;&#x7684;&#x5B69;&#x5B50;&#x6216;&#x8005;&#x7236;&#x4EB2;</span><br><span class="line">                            // &#x6CE8;&#x610F;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;feature</span><br><span class="line">                            featureArea = new PendingArea(feature, layer, areaForLayer[layer]);</span><br><span class="line">                            areaForLayer[layer].mChildren.add(featureArea);</span><br><span class="line">                        }</span><br><span class="line">                        areaForLayer[layer] = featureArea;</span><br><span class="line">                    } else {</span><br><span class="line">                        // &#x5982;&#x679C;&#x8BE5;&#x7279;&#x6027;&#x4E0D;&#x5E94;&#x7528;&#x4E8E;&#x5F53;&#x524D;&#x7A97;&#x53E3;&#x5C42;&#x7EA7;&#xFF0C;&#x5219;featureArea&#x7F6E;&#x4E3A;&#x7A7A;&#x3002;&#x7528;&#x4E8E;&#x4E0A;&#x9762;if&#x7684;&#x5224;&#x65AD;</span><br><span class="line">                        featureArea = null;</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            // &#x5230;&#x8FD9;&#x91CC;&#xFF0C;areaForLayer&#x8FD9;&#x4E2A;37&#x5C42;&#x5C31;&#x6309;&#x7167;feature&#x5206;&#x7C7B;&#xFF0C;&#x6709;&#x81EA;&#x5DF1;&#x5BF9;&#x5E94;&#x7684;PendingArea&#x4E86;&#x3002;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            // 3. &#x6784;&#x5EFA;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x76F8;&#x5173;&#x7684;PendingArea&#xFF0C;&#x6CE8;&#x610F;&#x8FD8;&#x662F;&#x64CD;&#x4F5C;areaForLayer&#x6570;&#x7EC4;&#xFF0C;&#x4F46;&#x662F;&#x64CD;&#x4F5C;&#x7684;&#x662F;&#x5185;&#x90E8;&#x5143;&#x7D20;&#x7684;mChildren&#x7684;&#x503C;</span><br><span class="line"></span><br><span class="line">            // &#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x7528;&#x7684; PendingArea</span><br><span class="line">            PendingArea leafArea = null;</span><br><span class="line">            int leafType = LEAF_TYPE_TOKENS;// &#x5B9A;&#x4E49;leafType</span><br><span class="line">           </span><br><span class="line">            for (int layer = 0; layer &lt; maxWindowLayerCount; layer++) {</span><br><span class="line">                //  &#x83B7;&#x53D6;&#x6BCF;&#x5C42;&#x7684;type&#xFF0C;&#x4ECE;&#x8FD9;&#x770B;type&#x662F;&#x548C;&#x6240;&#x5728;&#x5C42;&#x7EA7;&#x6709;&#x5173;&#x7CFB;&#x7684;</span><br><span class="line">                int type = typeOfLayer(policy, layer);</span><br><span class="line">                // // &#x68C0;&#x67E5;&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x590D;&#x7528;&#x524D;&#x4E00;&#x4E2A;&#x5C42;&#x7EA7;&#x7684; Tokens&#xFF0C;&#x548C;&#x524D;&#x9762;&#x7684;&#x5FAA;&#x73AF;&#x7C7B;&#x4F3C;</span><br><span class="line">                if (leafArea == null || leafArea.mParent != areaForLayer[layer]</span><br><span class="line">                        || type != leafType) {</span><br><span class="line">                    // &#x521B;&#x5EFA;PendingArea&#xFF0C;&#x6CE8;&#x610F;&#x53C2;&#x6570;,featur&#x4E3A;null</span><br><span class="line">                    leafArea = new PendingArea(null /* feature */, layer, areaForLayer[layer]);</span><br><span class="line">                    // &#x6CE8;&#x610F;&#x662F;&#x6DFB;&#x52A0;&#x5230;&#x5B69;&#x5B50;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x8DDF;&#x4E0A;&#x4E00;&#x6B21;&#x5FAA;&#x73AF;&#x76F4;&#x63A5;&#x4FEE;&#x6539;areaForLayer</span><br><span class="line">                    areaForLayer[layer].mChildren.add(leafArea);</span><br><span class="line">                    leafType = type;</span><br><span class="line">                    // &#x5E94;&#x7528;&#x7C7B;&#x578B;&#x5904;&#x7406;</span><br><span class="line">                    if (leafType == LEAF_TYPE_TASK_CONTAINERS) {</span><br><span class="line">                        // &#x6DFB;&#x52A0; TaskDisplayArea &#x5230;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5C42;&#x7EA7;</span><br><span class="line">                        addTaskDisplayAreasToApplicationLayer(areaForLayer[layer]);</span><br><span class="line">                         // &#x6DFB;&#x52A0; DisplayAreaGroup &#x5230;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5C42;&#x7EA7;</span><br><span class="line">                        addDisplayAreaGroupsToApplicationLayer(areaForLayer[layer],</span><br><span class="line">                                displayAreaGroupHierarchyBuilders);</span><br><span class="line">                        // &#x8DF3;&#x8FC7;&#x521B;&#x5EFA; Tokens&#xFF0C;&#x5373;&#x4E0D;&#x521B;&#x5EFA; Tokens&#xFF0C;&#x5373;&#x4F7F;&#x6CA1;&#x6709; Task</span><br><span class="line">                        leafArea.mSkipTokens = true;</span><br><span class="line">                    } else if (leafType == LEAF_TYPE_IME_CONTAINERS) {</span><br><span class="line">                        // &#x8F93;&#x5165;&#x6CD5;&#x5904;&#x7406;</span><br><span class="line">                        leafArea.mExisting = mImeContainer;</span><br><span class="line">                         // &#x8DF3;&#x8FC7;</span><br><span class="line">                        leafArea.mSkipTokens = true;</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">                leafArea.mMaxLayer = layer;</span><br><span class="line">            }</span><br><span class="line">            // &#x8BA1;&#x7B97;&#x6839;&#x8282;&#x70B9;&#x7684;&#x6700;&#x5927;&#x5C42;&#x7EA7;</span><br><span class="line">            root.computeMaxLayer();</span><br><span class="line">            // -------&#x6784;&#x5EFA;DisplayAreas&#x6811;----</span><br><span class="line">            // 4. &#x6839;&#x636E;&#x4E4B;&#x524D;&#x5B9A;&#x4E49;&#x7684;PendingArea&#x751F;&#x6210;&#x6700;&#x540E;&#x7684; DisplayAreas &#x6811;</span><br><span class="line">            // &#x6CE8;&#x610F;&#x53C2;&#x6570;</span><br><span class="line">            // We built a tree of PendingAreas above with all the necessary info to represent the</span><br><span class="line">            // hierarchy, now create and attach real DisplayAreas to the root.</span><br><span class="line">            root.instantiateChildren(mRoot, displayAreaForLayer, 0, featureAreas);</span><br><span class="line"></span><br><span class="line">            // &#x901A;&#x77E5;&#x6839;&#x8282;&#x70B9;&#x5DF2;&#x7ECF;&#x5B8C;&#x6210;&#x4E86;&#x6240;&#x6709;DisplayArea&#x7684;&#x6DFB;&#x52A0; &#xFF08;&#x5C06;displayAreaForLayer&#x4FDD;&#x5B58;&#x5728;RootDisplayArea&#x6210;&#x5458;&#x53D8;&#x91CF;roomAreaForLayer&#x4E2D;&#xFF0C;&#x4F9B;&#x540E;&#x9762;&#x903B;&#x8F91;&#x4F7F;&#x7528;&#xFF09;</span><br><span class="line">            mRoot.onHierarchyBuilt(mFeatures, displayAreaForLayer, featureAreas);</span><br><span class="line">        }</span><br></pre></td></tr></table></figure>

<h3 id="4-2-1-&#x6784;&#x5EFA;Feature&#x76F8;&#x5173;"><a href="#4-2-1-&#x6784;&#x5EFA;Feature&#x76F8;&#x5173;" class="headerlink" title="4.2.1 &#x6784;&#x5EFA;Feature&#x76F8;&#x5173;"></a>4.2.1 &#x6784;&#x5EFA;Feature&#x76F8;&#x5173;</h3><p>&#x8FD9;&#x8FB9;&#x6839;&#x636E;&#x5177;&#x4F53;&#x7684;&#x6267;&#x884C;&#x753B;&#x4E86;&#x51E0;&#x5F20;&#x56FE;&#xFF0C;&#x5148;&#x770B;&#x4E0A;&#x9762;Features&#x7684;&#x5FAA;&#x73AF;&#x903B;&#x8F91;&#xFF0C;&#x5728;&#x6267;&#x884C;&#x5FAA;&#x73AF;&#x524D;&#x6570;&#x7EC4;areaForLayer&#x548C;&#x6267;&#x884C;&#x7B2C;&#x4E00;&#x6B21;&#x5927;&#x5FAA;&#x73AF;&#x540E;&#x96C6;&#x5408;&#x5982;&#x4E0B;<br>&#x7B2C;&#x4E00;&#x4E2A;Feature&#x662F;WindowedMagnification&#x62E5;&#x6709;&#x7279;&#x5F81;&#x7684;&#x5C42;&#x7EA7; 0-31&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5176; &#x524D;&#x9762;32&#x4E2A;&#x4E3A;true&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/12d17d8bd62b6415714eb6493faef11d7d094ceed9bf13f84dd41f31c5b624fb" alt="&#x7B2C;&#x4E00;&#x6B21;&#x5927;&#x5FAA;&#x73AF;&#x7ED3;&#x675F;&#x6570;&#x7EC4;.png"><br>&#x5728;&#x5C42;&#x7EA7;&#x6811;&#xFF0C;&#x5982;&#x679C;&#x67D0;&#x4E00;&#x5757;&#x90FD;&#x662F;&#x652F;&#x6301;&#x540C;&#x4E00;Feature&#x7684;&#x8BDD;&#xFF0C;&#x53EF;&#x4EE5;&#x5199;&#x6210; &#x201C;name &#x8D77;&#x59CB;&#x5C42;&#xFF1A;&#x7ED3;&#x675F;&#x5C42; &#x201D;&#x7684;&#x5F62;&#x5F0F;&#xFF0C;&#x8F6C;&#x6362;&#x540E;&#x5982;&#x4E0B;<br>&#x8F6C;&#x6362;&#x6210;&#x5C42;&#x7EA7;&#x6811;&#x7684;&#x65B9;&#x5F0F;&#x5C31;&#x662F;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/59644ec8286d365c46056df50878893b6e39c590ca61d05486a2310682da6225" alt="&#x7B2C;&#x4E00;&#x6B21;&#x5927;&#x5FAA;&#x73AF;&#x7ED3;&#x675F;&#x6570;&#x7EC4;-&#x8F6C;&#x6362;.png"><br>&#x7136;&#x540E;&#x7B2C;&#x4E8C;&#x4E2A;&#x5927;&#x5FAA;&#x73AF;</p>
<p>&#x7B2C;&#x4E8C;Feature&#x662F;HideDisplayCutout&#x62E5;&#x6709;&#x7279;&#x5F81;&#x7684;&#x5C42;&#x7EA7; 0-14 16 18-23 26-35</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/242b1f2f2f58f9301331c1948bae63bf861d127333016ae2a9268a9a3dba1fd0" alt="&#x7B2C;&#x4E8C;&#x6B21;&#x5927;&#x5FAA;&#x73AF;&#x7ED3;&#x675F;&#x6570;&#x7EC4;.png"><br>&#x592A;&#x957F;&#x4E86;&#x6240;&#x4EE5;&#x7B2C;24&#x5F00;&#x59CB;&#x6362;&#x5230;&#x4E86;&#x4E0B;&#x4E00;&#x6392;&#xFF0C; &#x89C4;&#x5F8B;&#x5C31;&#x662F;&#x7ED3;&#x5408;&#x4E0A;&#x4E00;&#x6B21;&#x7684;&#x5FAA;&#x73AF;&#xFF0C;0-31&#x4EE5;&#x5185;&#xFF0C;HideDisplayCutout&#x7684;&#x7236;&#x4EB2;&#x90FD;&#x662F;&#x4E0A;&#x4E00;&#x6B21;&#x5FAA;&#x73AF;&#x7684;WindowedMagnification&#xFF0C;&#x7136;&#x540E;32&#x4E4B;&#x540E;&#x7684;&#x7236;&#x4EB2;&#x5C31;&#x662F;&#x9ED8;&#x8BA4;&#x7684;root&#x4E86;&#x3002;<br>&#x518D;&#x8F6C;&#x6210;&#x5C42;&#x7EA7;&#x6811;&#x7684;&#x8868;&#x793A;&#x5F62;&#x5F0F;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/a58740bfaec54d8f0624b244c883b6a7abeefcda8556731dff7e356e5673b13e" alt="&#x7B2C;&#x4E8C;&#x6B21;&#x5927;&#x5FAA;&#x73AF;&#x7ED3;&#x675F;&#x6570;&#x7EC4;-&#x8F6C;&#x6362;.png"><br>&#x6309;&#x7167;&#x8FD9;&#x4E2A;&#x89C4;&#x5219;Feature 5&#x6B21;&#x5168;&#x6267;&#x884C;&#x5B8C;&#x540E;&#xFF0C;&#x5C42;&#x7EA7;&#x6811;&#x7684;&#x56FE;&#x5C31;&#x662F;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#xFF0C;&#x4E0D;&#x8FC7;&#x505A;&#x4E86;&#x4E0B;&#x987A;&#x5E8F;&#x7684;&#x8C03;&#x6574;&#xFF0C;&#x4ECE;&#x5C0F;&#x5230;&#x8FBE;&#x6392;&#x5E8F;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/3134947b7e307c59426e5dd8091b7df09679d27010ccea6fb32892c19fa1da28" alt="&#x7B2C;&#x4E00;&#x6B21;&#x5927;&#x5FAA;&#x73AF;&#x7ED3;&#x675F;.png"></p>
<h3 id="4-2-2-&#x6784;&#x5EFA;Leaf&#x76F8;&#x5173;"><a href="#4-2-2-&#x6784;&#x5EFA;Leaf&#x76F8;&#x5173;" class="headerlink" title="4.2.2 &#x6784;&#x5EFA;Leaf&#x76F8;&#x5173;"></a>4.2.2 &#x6784;&#x5EFA;Leaf&#x76F8;&#x5173;</h3><p>&#x5728;&#x6784;&#x5EFA;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53C8;&#x6709;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x4E1C;&#x897F;&#xFF0C;leafType&#xFF0C;&#x5BF9;&#x5E94;&#x7684;&#x5C31;&#x662F;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x7684;&#x7C7B;&#x578B;,&#x9ED8;&#x8BA4;&#x662F;LEAF_TYPE_TOKENS&#xFF0C;&#x4E00;&#x5171;&#x4E5F;&#x53EA;&#x5B9A;&#x4E49;&#x4E86;3&#x4E2A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">php&#x590D;&#x5236;&#x4EE3;&#x7801;# DisplayAreaPolicyBuilder.HierarchyBuilder</span><br><span class="line">        private static final int LEAF_TYPE_TASK_CONTAINERS = 1; // APP</span><br><span class="line">        private static final int LEAF_TYPE_IME_CONTAINERS = 2; // &#x8F93;&#x5165;&#x6CD5;</span><br><span class="line">        private static final int LEAF_TYPE_TOKENS = 0; // &#x9ED8;&#x8BA4;</span><br></pre></td></tr></table></figure>

<p>&#x7136;&#x540E;&#x662F;&#x901A;&#x8FC7;typeOfLayer&#x65B9;&#x6CD5;&#x6839;&#x636E;&#x5F53;&#x524D;&#x5C42;&#x7EA7;&#x8FD4;&#x56DE;type</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">csharp&#x590D;&#x5236;&#x4EE3;&#x7801;# DisplayAreaPolicyBuilder.HierarchyBuilder</span><br><span class="line"></span><br><span class="line">        private static int typeOfLayer(WindowManagerPolicy policy, int layer) {</span><br><span class="line">            if (layer == APPLICATION_LAYER) {</span><br><span class="line">                return LEAF_TYPE_TASK_CONTAINERS;</span><br><span class="line">            } else if (layer == policy.getWindowLayerFromTypeLw(TYPE_INPUT_METHOD)</span><br><span class="line">                    || layer == policy.getWindowLayerFromTypeLw(TYPE_INPUT_METHOD_DIALOG)) {</span><br><span class="line">                return LEAF_TYPE_IME_CONTAINERS;</span><br><span class="line">            } else {</span><br><span class="line">                return LEAF_TYPE_TOKENS;</span><br><span class="line">            }</span><br><span class="line">        }</span><br></pre></td></tr></table></figure>

<p>&#x903B;&#x8F91;&#x8FD8;&#x662F;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#x7684;&#x9664;&#x4E86;&#x8F93;&#x5165;&#x6CD5;&#xFF08;13-14&#xFF09;&#x548C;&#x5E94;&#x7528;&#xFF08;2&#xFF09;&#x6240;&#x5728;&#x7684;&#x5C42;&#x7EA7;&#xFF0C;&#x5747;&#x8FD4;&#x56DE;LEAF_TYPE_TOKENS&#x3002;<br>&#x7ECF;&#x8FC7;&#x7B2C;&#x4E8C;&#x4E2A;for&#x5FAA;&#x73AF;&#x540E;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x7ED9;&#x6BCF;&#x4E2A;Feature &#x90FD;&#x52A0;&#x4E0A;&#x4E86;&#x4E00;&#x4E2A;Leaf &#xFF0C; &#x7136;&#x540E;&#x5BF9;&#x8F93;&#x5165;&#x6CD5;&#x548C;&#x5E94;&#x7528;&#x56FE;&#x505A;&#x4E86;&#x5355;&#x72EC;&#x7684;&#x5904;&#x7406;&#x3002;<br>&#x5148;&#x770B;&#x8F93;&#x5165;&#x6CD5;&#x7684;&#xFF0C; &#x662F;&#x628A;mExisting&#x8BBE;&#x7F6E;&#x4E3A;&#x4E86;&#x6700;&#x5F00;&#x59CB;&#x4ECE;DisplayConten&#x4F20;&#x8FDB;&#x6765;&#x7684;mImeContainer&#xFF0C;&#x7136;&#x540E;mSkipTokens&#x8BBE;&#x7F6E;&#x4E3A;false&#xFF0C;&#x8868;&#x793A;&#x540E;&#x7EED;&#x7684;&#x64CD;&#x4F5C;&#x53EF;&#x4EE5;&#x8DF3;&#x8FC7;&#x3002;<br>&#x7136;&#x540E;&#x770B;&#x5BF9;&#x5E94;&#x7528;&#x56FE;&#x5C42;&#x7684;&#x5904;&#x7406;&#xFF0C;&#x9664;&#x4E86;&#x4E5F;&#x5C06;mSkipTokens&#x8BBE;&#x7F6E;&#x4E3A;false&#x5916;&#x8FD8;&#x6267;&#x884C;&#x4E86;2&#x4E2A;&#x65B9;&#x6CD5;&#x5176;&#x4E2D;&#x7B2C;&#x4E8C;&#x500B;&#x65B9;&#x6CD5;&#x3002;<strong>addDisplayAreaGroupsToApplicationLayer</strong>&#x56E0;&#x4E3A;&#x5185;&#x90E8;&#x4F9D;&#x8D56;displayAreaGroupHierarchyBuilders&#xFF0C;&#x800C;&#x76EE;&#x524D;&#x4E5F;&#x6CA1;&#x770B;&#x5230;&#x5BF9;&#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;&#x64CD;&#x4F5C;&#x7684;&#x5730;&#x65B9;&#xFF0C;&#x6240;&#x4EE5;&#x957F;&#x5EA6;&#x4E3A;0&#xFF0C;&#x53EF;&#x4EE5;&#x5FFD;&#x7565;&#xFF0C;&#x6240;&#x4EE5;&#x53EA;&#x770B;</p>
<p><strong>addTaskDisplayAreasToApplicationLayer</strong>&#x65B9;&#x6CD5;&#x5373;&#x53EF;</p>
<p><strong>addTaskDisplayAreasToApplicationLayer</strong></p>
<p>mTaskDisplayAreas&#x770B;&#x5230;&#x5E94;&#x8BE5;&#x8054;&#x60F3;&#x5230;&#x524D;&#x9762;&#x521B;&#x5EFA;&#x7684;name&#x4E3A;&#x201C;DefaultTaskDisplayArea&#x201D;&#x7684;&#x90A3;&#x4E00;&#x4E2A;TaskDisplayArea&#xFF0C;&#x4E8B;&#x5B9E;&#x4E0A;&#x4E5F;&#x5C31;&#x662F;&#x5728;&#x90A3;&#x521B;&#x5EFA;&#x7684;&#xFF0C;&#x8FD9;&#x4E2A;&#x662F;&#x548C;&#x5E94;&#x7528;&#x6700;&#x76F8;&#x5173;&#x7684;&#x56FE;&#x5C42;&#xFF0C;<br>&#x4ECE;&#x4EE3;&#x7801;&#x4E0A;&#x770B;&#x4E5F;&#x80FD;&#x8BC1;&#x660E;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;# DisplayAreaPolicyBuilder.HierarchyBuilder</span><br><span class="line">    private final ArrayList&lt;TaskDisplayArea&gt; mTaskDisplayAreas = new ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    HierarchyBuilder setTaskDisplayAreas(List&lt;TaskDisplayArea&gt; taskDisplayAreas) {</span><br><span class="line">        mTaskDisplayAreas.clear();</span><br><span class="line">        mTaskDisplayAreas.addAll(taskDisplayAreas);</span><br><span class="line">        return this;</span><br><span class="line">    }</span><br><span class="line">    private void addTaskDisplayAreasToApplicationLayer(PendingArea parentPendingArea) {</span><br><span class="line">        // &#x5DF2;&#x77E5;&#x957F;&#x5EA6;&#x4E3A;1&#xFF0C;</span><br><span class="line">        final int count = mTaskDisplayAreas.size();</span><br><span class="line">            </span><br><span class="line">        for (int i = 0; i &lt; count; i++) {</span><br><span class="line">            PendingArea leafArea =</span><br><span class="line">                    new PendingArea(null /* feature */, APPLICATION_LAYER, parentPendingArea);</span><br><span class="line">            // &#x6240;&#x4EE5;&#x5C31;&#x662F;&#x628A;&#x201C;DefaultTaskDisplayArea&#x201D;&#x8FD9;&#x4E2A;&#x8BBE;&#x7F6E;&#x4E3A;mExisting</span><br><span class="line">            leafArea.mExisting = mTaskDisplayAreas.get(i);</span><br><span class="line">            leafArea.mMaxLayer = APPLICATION_LAYER;</span><br><span class="line">            // parentPendingArea.mChildren&#x672C;&#x6765;&#x4E3A;&#x5927;&#x5BB6;&#x90FD;&#x4E00;&#x6837;&#x7684;Leaf&#xFF0C;&#x53C8;&#x6DFB;&#x52A0;&#x4E86;&#x4E00;&#x4E2A;DefaultTaskDisplayArea</span><br><span class="line">            parentPendingArea.mChildren.add(leafArea);</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x6BB5;&#x5BF9;&#x5E94;&#x7528;&#x56FE;&#x5C42;&#x7684;&#x5904;&#x7406;&#x975E;&#x5E38;&#x7684;&#x91CD;&#x8981;&#x4E86;&#xFF0C;&#x7279;&#x522B;&#x6700;&#x4E0B;&#x9762;&#x5BF9;parentPendingArea.mChildren&#x518D;&#x6B21;&#x6DFB;&#x52A0;DefaultTaskDisplayArea&#x7684;&#x64CD;&#x4F5C;</p>
<p>&#x7ECF;&#x8FC7;&#x8FD9;&#x4E2A;&#x5FAA;&#x73AF;&#x7684;&#x5904;&#x7406;&#xFF0C;&#x6BCF;&#x4E2A;Feature&#x4E0B;&#x9762;&#x90FD;&#x6709;&#x4E86;&#x5BF9;&#x5E94;&#x7684;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#xFF0C;&#x5982;&#x56FE;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/8ea9936ccf20753657bbcf9556ed9f99c5b7bec031631ea05e56f327b01aaaad" alt="&#x6DFB;&#x52A0;&#x53F6;&#x5B50;&#x8282;&#x70B9;.png"><br>&#x7B2C;&#x4E8C;&#x5C42;&#x5E94;&#x7528;&#x5C42;&#x76EE;&#x524D;&#x662F;&#x6709;2&#x4E2A;&#x5B69;&#x5B50;&#x7684;&#xFF0C;&#x4E00;&#x4E2A;&#x662F;Lead,&#x53E6;&#x4E00;&#x4E2A;&#x5C31;&#x662F;DefaultTaskDisplayArea&#x3002;<br>&#x5230;&#x76EE;&#x524D;&#x4E3A;&#x6B62;&#xFF0C;&#x5C42;&#x7EA7;&#x6811;&#x96CF;&#x5F62;&#x662F;&#x6709;&#x4E86;&#x3002;&#x4F46;&#x662F;&#x6BD4;&#x8F83;&#x8FD8;&#x662F;&#x4E00;&#x4E2A;PendingArea&#x6570;&#x7EC4;&#xFF0C;&#x53E6;&#x5916; Leaf 0:1 &#x8FD9;&#x79CD;&#x76EE;&#x524D;&#x5728;&#x4EE3;&#x7801;&#x4E0A;&#x4E5F;&#x8FD8;&#x6CA1;&#x6709;&#x5F97;&#x5230;&#x4F53;&#x73B0;&#x3002;</p>
<h2 id="4-3-&#x771F;&#x6B63;DisplayAreas&#x6811;-PendingArea-instantiateChildren"><a href="#4-3-&#x771F;&#x6B63;DisplayAreas&#x6811;-PendingArea-instantiateChildren" class="headerlink" title="4.3 &#x771F;&#x6B63;DisplayAreas&#x6811; PendingArea::instantiateChildren"></a>4.3 &#x771F;&#x6B63;DisplayAreas&#x6811; PendingArea::instantiateChildren</h2><p>&#x5176;&#x5B9E;&#x4ECE;PendingArea::instantiateChildren&#x4E0A;&#x9762;&#x6E90;&#x7801;&#x7ED9;&#x7684;2&#x4E2A;&#x6CE8;&#x91CA;&#x4E5F;&#x77E5;&#x9053;&#xFF0C;&#x524D;&#x9762;&#x7684;2&#x4E2A;&#x5FAA;&#x73AF;&#xFF0C;&#x53EA;&#x662F;&#x6784;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;PendingAreas&#x6811;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x624D;&#x662F;&#x771F;&#x6B63;&#x6784;&#x5EFA;&#x5C42;&#x7EA7;&#x6811;&#xFF08;DisplayAreas&#xFF09;<br>&#x5E76;&#x628A;&#x8FD9;&#x4E2A;&#x6811;&#x6DFB;&#x52A0;&#x5230;root(DisplayContent)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">scss&#x590D;&#x5236;&#x4EE3;&#x7801;# DisplayAreaPolicyBuilder.PendingArea</span><br><span class="line"></span><br><span class="line">        void instantiateChildren(DisplayArea&lt;DisplayArea&gt; parent, DisplayArea.Tokens[] areaForLayer,</span><br><span class="line">                int level, Map&lt;Feature, List&lt;DisplayArea&lt;WindowContainer&gt;&gt;&gt; areas) {</span><br><span class="line">            // 1. &#x5B50;&#x533A;&#x57DF;&#x6309;&#x7167;&#x5B83;&#x4EEC;&#x7684;&#x6700;&#x5C0F;&#x5C42;&#x7EA7;&#x8FDB;&#x884C;&#x5347;&#x5E8F;&#x6392;&#x5217;</span><br><span class="line">            mChildren.sort(Comparator.comparingInt(pendingArea -&gt; pendingArea.mMinLayer));</span><br><span class="line">            // 2. &#x904D;&#x5386;&#x5B69;&#x5B50;&#x5C06;PendingArea&#x8F6C;&#x6362;&#x6210;DisplayArea</span><br><span class="line">            for (int i = 0; i &lt; mChildren.size(); i++) {</span><br><span class="line">                final PendingArea child = mChildren.get(i);</span><br><span class="line">                final DisplayArea area = child.createArea(parent, areaForLayer);</span><br><span class="line">                if (area == null) {</span><br><span class="line">                    // TaskDisplayArea and ImeContainer can be set at different hierarchy, so it can</span><br><span class="line">                    // be null.</span><br><span class="line">                    continue;</span><br><span class="line">                }</span><br><span class="line">                // &#x5C06;&#x8FD4;&#x56DE;&#x7684;area&#x8BBE;&#x7F6E;&#x4E3A;&#x5B69;&#x5B50;,&#x7B2C;&#x4E00;&#x6B21;&#x6267;&#x884C;&#x7684;&#x65F6;&#x5019;root&#x5C31;&#x662F;DisplayContent</span><br><span class="line">                parent.addChild(area, WindowContainer.POSITION_TOP);</span><br><span class="line">                if (child.mFeature != null) {</span><br><span class="line">                    // &#x8BA9;Feature&#x5BF9;&#x5E94;&#x7684;&#x5BB9;&#x5668;&#x91CC;&#x6DFB;&#x52A0;&#x521B;&#x5EFA;&#x7684;DisplayArea</span><br><span class="line">                    areas.get(child.mFeature).add(area);</span><br><span class="line">                }</span><br><span class="line">                // &#x5F00;&#x59CB;&#x8FED;&#x4EE3;&#x6784;&#x5EFA;</span><br><span class="line">                child.instantiateChildren(area, areaForLayer, level + 1, areas);</span><br><span class="line">            }</span><br><span class="line">        }</span><br></pre></td></tr></table></figure>

<p>&#x5148;&#x89E3;&#x6790;&#x4E00;&#x4E0B;3&#x4E2A;&#x53C2;&#x6570;<br>parent&#xFF1A;&#x6839;&#x636E;&#x4E0A;&#x9762;&#x4EE3;&#x7801;&#x7684;&#x4EE3;&#x7801;&#x903B;&#x8F91;&#xFF0C;root&#x5C31;&#x662F;DisplayContent<br>areaForLayer&#xFF1A; &#x8FD9;&#x4E2A;&#x662F;build&#x65B9;&#x6CD5;&#x5F00;&#x59CB;&#x521B;&#x5EFA;&#x7684;displayAreaForLayer<br>level&#xFF1A;&#x4ECE;&#x54EA;&#x7EA7;&#x5F00;&#x59CB;<br>areas&#xFF1A; &#x8FD9;&#x4E2A;&#x4E5F;&#x662F;build&#x65B9;&#x6CD5;&#x521B;&#x5EFA;&#x7684;map&#x96C6;&#x5408;&#xFF0C;key&#x662F;Feature&#x3002;</p>
<ol>
<li>&#x4E0A;&#x6765;&#x5C31;&#x6267;&#x884C;&#x4E86;&#x4E2A;&#x6392;&#x5E8F;&#xFF0C;&#x8FD9;&#x4E2A;mChildren&#x662F;&#x5565;&#x5462;&#xFF1F;&#x548B;&#x4E00;&#x770B;&#x597D;&#x50CF;&#x4E00;&#x70B9;&#x5370;&#x8C61;&#x90FD;&#x6CA1;&#x6709;&#xFF0C;&#x4F46;&#x662F;&#x6839;&#x636E;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x8C03;&#x7528;&#x5904;&#x770B;&#xFF0C;&#x4ED6;&#x662F;root.instantiateChildren,<br>&#x800C;&#x8FD9;&#x4E2A;root&#x662F;&#x6784;&#x5EFA;PendingAreas&#x6811;&#x65F6;&#x6700;&#x5F00;&#x59CB;&#x521B;&#x5EFA;&#x7684;root&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x4E0A;&#x9762;&#x56FE;&#x7247;PendingAreas&#x6811;&#x91CC;&#x7684; root 0:0&#x3002;&#x6240;&#x4EE5;&#x4ED6;&#x7684;&#x5B69;&#x5B50;&#x5C31;&#x662F;2&#x6B21;&#x5FAA;&#x73AF;&#x5904;&#x7406;&#x540E;&#xFF0C;&#x7236;&#x4EB2;&#x662F;&#x4ED6;&#x7684;PendingArea&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x90A3;&#x4E9B;feature&#x6216;&#x8005;leaf</li>
<li>&#x8FD9;&#x4E00;&#x6B65;&#x5C31;&#x662F;&#x5C06;&#x90A3;&#x4E9B;PendingArea&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x8F6C;&#x6362;&#x4E3A;DisplayArea<br>&#x4E4B;&#x524D;&#x770B;&#x8FC7;PendingArea&#x7684;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x548C;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#xFF0C;&#x73B0;&#x5728;&#x770B;&#x770B;</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">typescript&#x590D;&#x5236;&#x4EE3;&#x7801;# DisplayAreaPolicyBuilder.PendingArea</span><br><span class="line">        @Nullable</span><br><span class="line">        private DisplayArea createArea(DisplayArea&lt;DisplayArea&gt; parent,</span><br><span class="line">                DisplayArea.Tokens[] areaForLayer) {</span><br><span class="line">            // &#x53EA;&#x6709;&#x8F93;&#x5165;&#x6CD5;&#x548C;&#x5E94;&#x7528;&#x5C42;mExisting&#x6709;&#x503C;</span><br><span class="line">            if (mExisting != null) {</span><br><span class="line">                if (mExisting.asTokens() != null) { </span><br><span class="line">                    // &#x53EA;&#x6709;&#x8F93;&#x5165;&#x6CD5;&#x6EE1;&#x8DB3;</span><br><span class="line">                    // Store the WindowToken container for layers</span><br><span class="line">                    fillAreaForLayers(mExisting.asTokens(), areaForLayer);</span><br><span class="line">                }</span><br><span class="line">                // &#x7136;&#x540E;&#x5C06;mExisting&#x4F5C;&#x4E3A;&#x7ED3;&#x679C;&#x8FD4;&#x56DE;</span><br><span class="line">                return mExisting;</span><br><span class="line">            }</span><br><span class="line">            // mSkipTokens&#x4E3A;true&#x5219;&#x8FD4;&#x56DE;&#xFF0C;&#x5E94;&#x7528;&#x548C;IME&#x521B;&#x5EFA;&#x7684;PendingArea</span><br><span class="line">            if (mSkipTokens) {</span><br><span class="line">                return null;</span><br><span class="line">            }</span><br><span class="line">            // 2. &#x5B9A;&#x4E49;DisplayArea&#x7684;type</span><br><span class="line">            DisplayArea.Type type;</span><br><span class="line">            if (mMinLayer &gt; APPLICATION_LAYER) {</span><br><span class="line">                type = DisplayArea.Type.ABOVE_TASKS;</span><br><span class="line">            } else if (mMaxLayer &lt; APPLICATION_LAYER) {</span><br><span class="line">                type = DisplayArea.Type.BELOW_TASKS;</span><br><span class="line">            } else {</span><br><span class="line">                type = DisplayArea.Type.ANY;</span><br><span class="line">            }</span><br><span class="line">            </span><br><span class="line">            if (mFeature == null) {</span><br><span class="line">                // // 3. &#x6784;&#x5EFA;&#x8FD4;&#x56DE;&#x7684;leaf    &#x6CE8;&#x610F;&#x7B2C;&#x4E09;&#x4E2A;&#x53C2;&#x6570;&#x683C;&#x5F0F;</span><br><span class="line">                final DisplayArea.Tokens leaf = new DisplayArea.Tokens(parent.mWmService, type,</span><br><span class="line">                        &quot;Leaf:&quot; + mMinLayer + &quot;:&quot; + mMaxLayer);</span><br><span class="line">                fillAreaForLayers(leaf, areaForLayer); // &#x7ED9;&#x5BF9;&#x5E94;&#x8986;&#x76D6;&#x7684;&#x5C42;&#x7EA7;&#x90FD;&#x9700;&#x8981;&#x8D4B;&#x503C;</span><br><span class="line">                return leaf;</span><br><span class="line">            } else {</span><br><span class="line">                // &#x5BF9;&#x6709;Feature&#x7684;PendingArea&#x8FD4;&#x56DE;&#x6784;&#x5EFA;</span><br><span class="line">                return mFeature.mNewDisplayAreaSupplier.create(parent.mWmService, type,</span><br><span class="line">                        mFeature.mName + &quot;:&quot; + mMinLayer + &quot;:&quot; + mMaxLayer, mFeature.mId);</span><br><span class="line">            }</span><br><span class="line">        }</span><br></pre></td></tr></table></figure>

<p>&#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x7684;&#x53C2;&#x6570;areaForLayer&#x8FD9;&#x4E2A;&#x662F;&#x4E00;&#x4E2A;build&#x65B9;&#x6CD5;&#x521B;&#x5EFA;&#x7684;&#x96C6;&#x5408;&#xFF0C;&#x4E5F;&#x662F;&#x6700;&#x7EC8;&#x5C42;&#x7EA7;&#x6811;&#x7684;&#x4F53;&#x73B0;&#x3002;</p>
<ol>
<li>&#x65B9;&#x6CD5;&#x524D;&#x9762;mExisting.asTokens&#xFF0C; &#x8FD9;&#x4E2A;asTokens&#xFF0C;&#x65B9;&#x6CD5;&#x5B9A;&#x4E49;&#x5728;DisplayArea&#x4E2D;&#x9ED8;&#x8BA4;&#x8FD4;&#x56DE;null&#xFF0C;&#x53EA;&#x6709;DisplayArea.Tokens&#x8FD4;&#x56DE;&#x672C;&#x8EAB;&#x3002; &#x800C;ImeContainer&#x662F;&#x7EE7;&#x627F;DisplayArea.Tokens&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x6709;&#x8FD4;&#x56DE;&#x503C;&#x3002;<br>&#x800C;&#x5BF9;&#x4E8E;&#x5E94;&#x7528;&#x5C42;mExisting&#x662F;TaskDisplayArea&#xFF0C;&#x4E0D;&#x662F;DisplayArea.Tokens&#x7684;&#x5B50;&#x7C7B;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x4E2A;&#x4E0D;&#x6EE1;&#x8DB3;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x53EA;&#x6709;IME&#x7684;PendingArea&#x624D;&#x4F1A;&#x6267;&#x884C;&#x4E0B;&#x9762;fillAreaForLayers&#x7684;&#x903B;&#x8F91;</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;# DisplayAreaPolicyBuilder.PendingArea</span><br><span class="line">        private void fillAreaForLayers(DisplayArea.Tokens leaf, DisplayArea.Tokens[] areaForLayer) {</span><br><span class="line">            for (int i = mMinLayer; i &lt;= mMaxLayer; i++) {</span><br><span class="line">                areaForLayer[i] = leaf;</span><br><span class="line">            }</span><br><span class="line">        }</span><br></pre></td></tr></table></figure>

<p>fillAreaForLayers&#x65B9;&#x6CD5;&#x4E5F;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#xFF0C;&#x5C31;&#x662F;&#x5C06;&#x8FD9;&#x4E2A;PendingArea&#x7684;&#x6240;&#x6709;&#x56FE;&#x5C42;&#x90FD;&#x8BBE;&#x7F6E;&#x4F20;&#x8FDB;&#x6765;&#x7684;leaf&#x3002;&#x90A3;&#x5F53;&#x524D;&#x903B;&#x8F91;&#x53EA;&#x5904;&#x7406;IME&#x7684;&#x8BDD;&#xFF0C;&#x5C31;&#x662F;&#x628A;13&#xFF0C;14&#x5C42;&#x90FD;&#x8BBE;&#x7F6E;&#x8FD9;&#x4E2A;mExisting.<br>&#x53E6;&#x5916;&#x5E94;&#x7528;&#x5C42;&#x4E0D;&#x6267;&#x884C;&#x5230;fillAreaForLayers&#xFF0C;&#x6267;&#x884C;&#x540E;&#x9762;&#x7684;return mExisting&#xFF0C; &#x8FD9;&#x91CC;&#x4E5F;&#x6709;&#x4E2A;&#x5F88;&#x91CD;&#x8981;&#x7684;&#x70B9;&#xFF0C;&#x56E0;&#x4E3A;&#x524D;&#x9762;&#x77E5;&#x9053;&#x5E94;&#x7528;&#x5C42;&#x7684;Feature&#x6709;2&#x4E2A;&#x5B69;&#x5B50;&#xFF0C;&#x4F46;&#x662F;mExisting&#x5374;&#x662F;&#x4E3A;DefaultTaskDisplayArea&#xFF0C;<br><strong>&#x8FD9;&#x4E5F;&#x5C31;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x6700;&#x7EC8;&#x5C42;&#x7EA7;&#x6811;&#x7684;&#x7B2C;&#x4E8C;&#x5C42;&#x53EA;&#x6709;DefaultTaskDisplayArea&#x7684;&#x539F;&#x56E0;</strong></p>
<ol>
<li>&#x5B9A;&#x4E49;&#x4E86;&#x4E2A;DisplayArea&#x7684;type&#xFF0C; &#x4E5F;&#x4E0D;&#x590D;&#x6742;&#xFF0C; &#x5982;&#x679C;&#x5F53;&#x524D;&#x533A;&#x57DF;&#x6700;&#x5C0F;&#x7684;&#x56FE;&#x5C42;&#x90FD;&#x5927;&#x4E8E;&#x5E94;&#x7528;&#x56FE;&#x5C42;&#xFF08;2&#xFF09;&#xFF0C;&#x90A3;type&#x5C31;&#x662F;ABOVE_TASKS&#xFF0C;&#x5982;&#x679C;&#x6700;&#x5927;&#x56FE;&#x5C42;&#x8FD8;&#x5C0F;&#x4E8E;&#x5E94;&#x7528;&#x56FE;&#x5C42;&#xFF08;2&#xFF09;&#x5C31;&#x662F;BELOW_TASKS&#xFF08;&#x8FD9;&#x4E2A;&#x53EA;&#x6709;&#x58C1;&#x7EB8;&#x4E86;&#xFF09;&#xFF0C;<br>&#x5176;&#x4ED6;&#x7684;&#x5C31;&#x662F;ANY&#x3002;&#x76EE;&#x524D;&#x8FD8;&#x4E0D;&#x77E5;&#x9053;&#x5177;&#x4F53;&#x7528;&#x5904;&#xFF0C;&#x6211;&#x8BA4;&#x4E3A;&#x4E86;&#x89E3;&#x5373;&#x53EF;</li>
<li>mFeature == null&#x7684;&#x6761;&#x4EF6;&#xFF0C;&#x5728;&#x4E0A;&#x9762;build&#x65B9;&#x6CD5;&#x91CC;&#x6709;2&#x4E2A;for&#x5FAA;&#x73AF;&#x90FD;&#x521B;&#x5EFA;&#x4E86;PendingArea&#x5BF9;&#x8C61;&#xFF0C;&#x7B2C;&#x4E8C;&#x4E2A;&#x521B;&#x5EFA;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x7684;&#x65F6;&#x5019;&#x662F;&#x6CA1;&#x6709;&#x4F20;&#x9012;mFeature&#x7684;&#x3002;<br>&#x76F4;&#x63A5;&#x521B;&#x5EFA;DisplayArea.Tokens&#xFF0C;&#x6700;&#x91CD;&#x8981;&#x7684;&#x662F;&#x7B2C;&#x4E09;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x662F;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x5C31;&#x662F;&#x6784;&#x5EFA;&#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;name&#xFF0C;&#x770B;&#x683C;&#x5F0F;&#x4E5F;&#x662F;&#x975E;&#x5E38;&#x7684;&#x6E05;&#x695A;&#x3002;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x5C42;&#x7EA7;&#x6811;&#x7684;Leaf&#x8282;&#x70B9;&#xFF0C;&#x6BD4;&#x5982;&#x201C;Leaf:0:1 &#x201D;&#x3002;&#xFF08;&#x8212;&#x670D;&#x4E86;&#xFF09;</li>
<li>&#x8FD9;&#x91CC;&#x5904;&#x7406;&#x7684;&#x662F;&#x7B2C;&#x4E00;&#x6B21;&#x5FAA;&#x73AF;&#x5BF9;Feature&#x6784;&#x5EFA;&#x51FA;&#x6765;&#x7684;PendingArea&#xFF0C;<br>&#x8FD9;&#x91CC;&#x6BD4;&#x8F83;&#x597D;&#x5947;&#x7684;&#x662F;&#x8FD9;&#x4E2A;mNewDisplayAreaSupplier&#x662F;&#x4EC0;&#x4E48;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x9700;&#x8981;&#x770B;Feature&#x7684;&#x5B9A;&#x4E49;&#x4E86;</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">arduino&#x590D;&#x5236;&#x4EE3;&#x7801;# DisplayAreaPolicyBuilder</span><br><span class="line">    static class Feature {</span><br><span class="line">        private final String mName;</span><br><span class="line">        private final int mId;</span><br><span class="line">        private final boolean[] mWindowLayers;</span><br><span class="line">        private final NewDisplayAreaSupplier mNewDisplayAreaSupplier;</span><br><span class="line">        // &#x6784;&#x9020;&#x51FD;&#x6570;</span><br><span class="line">        private Feature(String name, int id, boolean[] windowLayers,</span><br><span class="line">            NewDisplayAreaSupplier newDisplayAreaSupplier) {</span><br><span class="line">            mName = name;</span><br><span class="line">            mId = id;</span><br><span class="line">            mWindowLayers = windowLayers;</span><br><span class="line">            mNewDisplayAreaSupplier = newDisplayAreaSupplier;</span><br><span class="line">        }</span><br><span class="line">            static class Builder {</span><br><span class="line">            ......</span><br><span class="line">            // &#x9ED8;&#x8BA4;&#x4E3A;DisplayArea&#x5BF9;&#x8C61;</span><br><span class="line">            private NewDisplayAreaSupplier mNewDisplayAreaSupplier = DisplayArea::new;</span><br><span class="line">            private boolean mExcludeRoundedCorner = true;</span><br><span class="line">                Feature build() {</span><br><span class="line">                ......</span><br><span class="line">                return new Feature(mName, mId, mLayers.clone(), mNewDisplayAreaSupplier);</span><br><span class="line">            }</span><br><span class="line">            }</span><br><span class="line">    }</span><br><span class="line">     /** Supplier interface to provide a new created {@link DisplayArea}. */</span><br><span class="line">    interface NewDisplayAreaSupplier {</span><br><span class="line">        DisplayArea create(WindowManagerService wms, DisplayArea.Type type, String name,</span><br><span class="line">                int featureId);</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>mNewDisplayAreaSupplier&#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;&#x8D4B;&#x503C;&#x662F;&#x5728;Feature&#x7684;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#xFF0C;&#x800C;&#x6839;&#x636E;&#x4EE3;&#x7801;&#x5206;&#x6790;&#xFF0C;&#x6DFB;&#x52A0;&#x7684;5&#x4E2A;Feature&#x662F;&#x901A;&#x8FC7;Builder&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x5206;&#x6790;&#x7684;<br>mNewDisplayAreaSupplier&#x7684;&#x503C;&#xFF0C;&#x5C31;&#x662F;&#x5B9A;&#x4E49;&#x5728;Feature.Builder&#x4E0B;&#x7684;&#x9ED8;&#x8BA4;&#x503C;<strong>&#x4E5F;&#x5C31;&#x662F;DisplayArea&#x5BF9;&#x8C61;</strong><br>&#x6240;&#x4EE5;&#x8FD9;&#x4E00;&#x6B65;&#x5C31;&#x662F;&#x8FD4;&#x56DE;&#x4E86;&#x4E00;&#x4E2A;DisplayArea&#x5BF9;&#x8C61;&#xFF0C;&#x7136;&#x540E;name&#x5C31;&#x662F; &#x201C;mFeature.mName + &#x201C;:&#x201D; + mMinLayer + &#x201C;:&#x201D; + mMaxLayer&#x201D; &#x6BD4;&#x5982; &#x201C;HideDisplayCutout:32:35&#x201D;</p>
<p>&#x5230;&#x73B0;&#x5728;&#x4E3A;&#x6B62;&#xFF0C;&#x5C42;&#x7EA7;&#x6811;&#x6BCF;&#x4E2A;&#x6210;&#x5458;&#x662F;&#x5982;&#x4F55;&#x6784;&#x5EFA;&#xFF0C;&#x4EE5;&#x53CA;&#x91CC;&#x9762;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x540D;&#x5B57;&#x662F;&#x600E;&#x4E48;&#x6765;&#x7684;&#xFF0C;&#x5C31;&#x5168;&#x90FD;&#x6E05;&#x695A;&#x4E86;&#x3002;<br>&#x540E;&#x9762;&#x8FED;&#x4EE3;&#x4E5F;&#x53EA;&#x662F;&#x65B9;&#x6CD5;&#x7684;&#x9012;&#x5F52;&#x800C;&#x5DF2;&#xFF0C;&#x7ECF;&#x8FC7;&#x4E00;&#x5C42;&#x4E00;&#x5C42;&#x7684;&#x8FED;&#x4EE3;&#x540E;&#xFF0C;&#x6574;&#x4E2A;&#x5C42;&#x7EA7;&#x7ED3;&#x6784;&#x6811;&#x5C31;&#x6784;&#x5EFA;&#x597D;&#x4E86;&#x3002;<br>&#x73B0;&#x5728;&#x7684;&#x5C42;&#x7EA7;&#x6811;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/8784f587aeacdaf13b5af86b78727d244fd9fd4d8bf2ad0bcb9670307d2023db" alt="&#x5F00;&#x673A;&#x540E;&#x7684;&#x5C42;&#x7EA7;&#x6811;.png"><br>&#x8FD9;&#x4E2A;&#x5C42;&#x7EA7;&#x6811;&#x548C;&#x4E0A;&#x4E00;&#x7BC7;&#x770B; &#x4E0D;&#x592A;&#x4E00;&#x6837;&#x90A3;&#x662F;&#x56E0;&#x4E3A;Leaf&#x4E0B;&#x6CA1;&#x6709;&#x5185;&#x5BB9;&#x4E86;&#xFF0C;&#x5E94;&#x7528;&#x5C42;&#x201C;DefaultTask<br>DisplayArea&#x201D;&#x548C;&#x58C1;&#x7EB8;&#x5C42;&#x4E5F;&#x6CA1;&#x6709;&#x5185;&#x5BB9;&#xFF0C;&#x90A3;&#x662F;&#x56E0;&#x4E3A;Leaf&#x540E;&#x9762;&#x7684;&#x5185;&#x5BB9;&#x90FD;&#x662F;&#x5177;&#x4F53;&#x4E1A;&#x52A1;&#x6DFB;&#x52A0;&#x4E0A;&#x53BB;&#x7684;&#x3002;<br>&#x6240;&#x4EE5;&#x5176;&#x5B9E;&#x5BF9;&#x5E94;Window&#x7684;add&#x6D41;&#x7A0B;&#xFF0C;&#x5176;&#x5B9E;&#x4E5F;&#x5C31;&#x662F;&#x771F;&#x6CA1;&#x6DFB;&#x52A0;&#x5230;&#x8FD9;&#x4E2A;&#x5C42;&#x7EA7;&#x6811;&#x7684;&#x6D41;&#x7A0B;&#x3002;&#x540E;&#x9762;&#x5177;&#x4F53;&#x5206;&#x6790;&#x4E1A;&#x52A1;&#x7684;&#x65F6;&#x5019;&#x80AF;&#x5B9A;&#x662F;&#x4F1A;&#x6709;&#x5177;&#x4F53;&#x6848;&#x4F8B;&#x7684;&#x3002;</p>
<ol start="5">
<li><h1 id="&#x5C0F;&#x7ED3;"><a href="#&#x5C0F;&#x7ED3;" class="headerlink" title="&#x5C0F;&#x7ED3;"></a>&#x5C0F;&#x7ED3;</h1></li>
</ol>
<p>&#x7A97;&#x53E3;&#x5C42;&#x7EA7;&#x6811;&#x8FD9;&#x4E00;&#x5757;&#x7684;&#x4EE3;&#x7801;&#x6709;&#x70B9;&#x62BD;&#x8C61;&#xFF0C;&#x4EE3;&#x7801;&#x867D;&#x7136;&#x4E0D;&#x591A;&#x4F46;&#x662F;&#x4E5F;&#x633A;&#x7ED5;&#x3002;&#x6211;&#x5199;&#x7684;&#x4E5F;&#x6C34;&#x5E73;&#x6709;&#x9650;&#xFF0C;&#x5B66;&#x4E60;&#x8FD9;&#x5757;&#x6700;&#x597D;&#x662F;&#x81EA;&#x5DF1;&#x4E5F;&#x80FD;&#x8DDF;&#x7740;&#x753B;&#x51FA;&#x4E00;&#x4E2A;&#x5C42;&#x7EA7;&#x6811;&#x7684;&#x56FE;&#x6765;&#x3002;&#x5F53;&#x7136;&#x5C31;&#x7B97;&#x753B;&#x4E0D;&#x4E86;&#xFF0C;&#x4E5F;&#x95EE;&#x9898;&#x4E0D;&#x5927;&#xFF0C;&#x518D;&#x600E;&#x4E48;&#x4E0D;&#x6D4E;&#x73B0;&#x5728;&#x5BF9;&#x5C42;&#x7EA7;&#x6811;&#x7684;&#x6982;&#x5FF5;&#x80AF;&#x5B9A;&#x4E5F;&#x662F;&#x6709;&#x4E86;&#x89E3;&#x7684;&#xFF0C;&#x4E5F;&#x77E5;&#x9053;&#x600E;&#x4E48;&#x547D;&#x4EE4;&#x770B;&#xFF0C;&#x4EE5;&#x540E;&#x5B9E;&#x9645;&#x4E1A;&#x52A1;&#x7ECF;&#x5E38;&#x4F1A;&#x9700;&#x8981;&#x6BD4;&#x5BF9;&#x5C42;&#x7EA7;&#x6811;&#x7684;&#x53D8;&#x5316;&#xFF0C;&#x770B;&#x5230;&#x591A;&#x4E86;&#xFF0C;&#x81EA;&#x5982;&#x800C;&#x4E14;&#x5C31;&#x6E05;&#x9664;&#x4E86;&#x3002;&#x867D;&#x7136;&#x5C42;&#x7EA7;&#x6811;&#x6253;&#x5370;&#x7684;&#x5185;&#x5BB9;&#x6BD4;&#x8F83;&#x591A;&#xFF0C;&#x4F46;&#x662F;&#x53EA;&#x8981;&#x5173;&#x6CE8;<strong>DefaultTaskDisplayArea</strong>&#x4E0B;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x8FD9;&#x4E00;&#x5757;&#x7684;&#x5185;&#x5BB9;&#x4E5F;&#x5C31;&#x90A3;&#x4E48;&#x70B9;&#x3002;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/099b86bd205748de1c54d6349f77c271.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7338635448304091151.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7338635448304091151.html" itemprop="url">Coze 扣子   AI 养育计划 - "Flutter 大</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-02-24T09:50:26+08:00">
                2024-02-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x6263;&#x5B50;&#xFF08;coze.cn&#xFF09;&#x662F;&#x4E00;&#x6B3E;&#x7528;&#x6765;&#x5F00;&#x53D1;&#x65B0;&#x4E00;&#x4EE3; AI Chat Bot &#x7684;&#x5E94;&#x7528;&#x7F16;&#x8F91;&#x5E73;&#x53F0;&#x3002;&#x5176;&#x4E2D;&#x53EF;&#x4EE5;&#x6784;&#x5EFA;&#x81EA;&#x5DF1;&#x7684;&#x77E5;&#x8BC6;&#x5E93;&#x4EE5;&#x53CA;&#x4F5C;&#x4E3A;&#x8D44;&#x6E90;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x8BA9; AI Bot &#x62E5;&#x6709;&#x6211;&#x6240;&#x6709;&#x6587;&#x7AE0;&#x7684; &#x201C;&#x667A;&#x6167;&#x201D;&#xFF0C;&#x5C82;&#x4E0D;&#x662F;&#x4E00;&#x4F4D; <strong>Flutter &#x5927;&#x5E08;</strong> &#x561B;&#x3002;&#x6BD5;&#x7ADF;&#x8FDE;&#x6211;&#x81EA;&#x5DF1;&#x53EF;&#x80FD;&#x90FD;&#x8BB0;&#x4E0D;&#x6E05;&#xFF0C;&#x5F88;&#x4E45;&#x4EE5;&#x524D;&#x6587;&#x7AE0;&#x91CC;&#x7684;&#x77E5;&#x8BC6;&#x7EC6;&#x8282;&#xFF0C;&#x8BA9;&#x7528;&#x6237;&#x548C;&#x8FD9;&#x79CD; &#x201C;&#x77E5;&#x8BC6;&#x602A;&#x7269;&#x201D; &#x4EA4;&#x6D41;&#xFF0C;&#x80AF;&#x5B9A;&#x80FD;&#x6709;&#x610F;&#x6599;&#x4E4B;&#x5916;&#x7684;&#x80FD;&#x529B;&#x3002;</p>
<blockquote>
<p>&#x53E6;&#x5916;&#x6709;&#x4E00;&#x70B9;&#x5F88;&#x91CD;&#x8981;&#xFF0C;&#x8BA9;&#x8BFB;&#x8005;&#x8BFB;&#x5B8C;&#x6211;&#x6240;&#x6709;&#x7684;&#x6587;&#x7AE0;&#x5E76;&#x7406;&#x89E3;&#x662F;&#x4E00;&#x4EF6;&#x5F88;&#x8270;&#x96BE;&#x7684;&#x4E8B;&#x3002;  </p>
<p>&#x4F46;&#x8BFB;&#x8005;&#x53EF;&#x4EE5;&#x5411;&#x4E00;&#x4E2A;&#x5177;&#x6709;&#x6211;&#x6240;&#x6709;&#x6587;&#x7AE0;&#x77E5;&#x8BC6;&#x7684; <strong>Flutter &#x5927;&#x5E08;</strong> &#x63D0;&#x95EE;&#xFF0C;&#x5E76;&#x83B7;&#x5F97;&#x56DE;&#x7B54;&#xFF0C;&#x4F1A;&#x662F;&#x4E00;&#x4EF6;&#x591A;&#x4E48;&#x68D2;&#x7684;&#x4E8B;&#x3002;</p>
</blockquote>
<hr>
<h4 id="&#x4E00;&#x3001;Flutter-&#x5927;&#x5E08;&#x7684;&#x8BDE;&#x751F;"><a href="#&#x4E00;&#x3001;Flutter-&#x5927;&#x5E08;&#x7684;&#x8BDE;&#x751F;" class="headerlink" title="&#x4E00;&#x3001;Flutter &#x5927;&#x5E08;&#x7684;&#x8BDE;&#x751F;"></a>&#x4E00;&#x3001;Flutter &#x5927;&#x5E08;&#x7684;&#x8BDE;&#x751F;</h4><p>&#x6CE8;&#x518C;&#x767B;&#x5F55;&#x5230;&#x6263;&#x5B50;&#x4E4B;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <strong>&#x521B;&#x5EFA; Bot</strong> &#xFF0C;&#x521B;&#x5EFA;&#x4E00;&#x4F4D; <code>Flutter &#x5927;&#x5E08;</code> &#x7684; &#x201C;&#x5C0F;&#x5A74;&#x513F;&#x201D;&#x3002;&#x5728;&#x6B64;&#x4E3A;&#x8FD9;&#x4E2A; AI Bot &#x8D77;&#x4E2A;&#x5C0F;&#x540D;&#x53EB;&#xFF1A; <strong>Toly</strong></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/e94bb9cacb795ffa521537f9a11782752abfd32f0869552b44b091c3c5982f21" alt="image.png"></p>
<p>&#x521B;&#x5EFA;&#x5B8C;&#x540E;&#x53EF;&#x4EE5;&#x5728;&#x4E2A;&#x4EBA;&#x7A7A;&#x95F4;&#xFF0C;&#x67E5;&#x770B;&#x8FD9;&#x4F4D;&#x5904;&#x4E8E;&#x840C;&#x65B0;&#x9636;&#x6BB5;&#x7684; <code>Flutter &#x5927;&#x5E08; - Toly</code> &#x3002;&#x521B;&#x5EFA;&#x65F6;&#x53EF;&#x4EE5; AI &#x6839;&#x636E;&#x63CF;&#x8FF0;&#x751F;&#x6210;&#x56FE;&#x6807;&#x8FD8;&#x633A;&#x6709;&#x610F;&#x601D;&#x7684;&#xFF0C;&#x867D;&#x7136;&#x4E0D;&#x90A3;&#x4E48;&#x7CBE;&#x786E;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/fbdfbb09cd49364135f5ba105fdf650eca16c88455a7b9074fcec0dce81a533a" alt="image.png"></p>
<hr>
<p>&#x70B9;&#x8FDB;&#x53BB;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6709;&#x4E09;&#x4E2A;&#x4E3B;&#x8981;&#x7684;&#x533A;&#x57DF;&#xFF1A;</p>
<ul>
<li>&#x7F16;&#x6392;&#x533A;&#x57DF; : &#x63D0;&#x793A;&#x8BCD;&#x7684;&#x7F16;&#x6392;&#xFF0C;&#x8BBE;&#x8BA1; Toly &#x7684;&#x4EBA;&#x8BBE;&#x548C;&#x529F;&#x80FD;</li>
<li>&#x8D44;&#x6E90;&#x914D;&#x7F6E;&#x533A;&#x57DF;&#xFF1A;</li>
<li>&#x9884;&#x89C8;&#x8C03;&#x8BD5;&#x533A;&#x57DF;&#xFF1A;</li>
</ul>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/55cda232b72413ff945c3ac5f344e1cca18e025d513d4f46c20babd8650ba00b" alt="image.png"></p>
<hr>
<h4 id="&#x4E8C;&#x3001;&#x5582;&#x517B;&#x672A;&#x6765;&#x7684;-Flutter-&#x5927;&#x5E08;"><a href="#&#x4E8C;&#x3001;&#x5582;&#x517B;&#x672A;&#x6765;&#x7684;-Flutter-&#x5927;&#x5E08;" class="headerlink" title="&#x4E8C;&#x3001;&#x5582;&#x517B;&#x672A;&#x6765;&#x7684; Flutter &#x5927;&#x5E08;"></a>&#x4E8C;&#x3001;&#x5582;&#x517B;&#x672A;&#x6765;&#x7684; <code>Flutter &#x5927;&#x5E08;</code></h4><p>&#x867D;&#x7136;&#x6263;&#x5B50;&#x7684; AI Bot &#x6709;&#x4E00;&#x5B9A;&#x7684;&#x77E5;&#x8BC6;&#x96C6;&#xFF0C;&#x4F46;&#x662F;&#x6BD5;&#x7ADF;&#x5E76;&#x4E0D;&#x662F;&#x4E13;&#x4E1A;&#x7684;&#x3002;&#x73B0;&#x5728;&#x770B;&#x4E00;&#x4E0B;&#x5982;&#x4F55;&#x5582;&#x4ED6;&#x4E00;&#x4E9B;&#x7CBE;&#x786E;&#x7684;&#x3001;&#x9AD8;&#x8D28;&#x91CF;&#x7684;&#x6587;&#x7AE0;&#x3002;&#x7ED9;&#x4E0E;&#x4ED6;&#x4E13;&#x4E1A;&#x7684; &#x201C;&#x8BB0;&#x5FC6;&#x201D; &#x80FD;&#x529B;&#x3002;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF0C;&#x53EF;&#x4EE5;<strong>&#x6784;&#x5EFA;&#x77E5;&#x8BC6;&#x5E93;</strong>&#x6216;&#x8005;<strong>&#x6570;&#x636E;&#x5E93;</strong>&#xFF0C;&#x4F5C;&#x4E3A;&#x4ED6;&#x7684; &#x201C;&#x667A;&#x6167;&#x6E90;&#x6CC9;&#x201D; &#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/4dde68a72affe63d36fc3fdbc7ffb7b6e19d81235f2e866eea8b76be9f5a5411" alt="image.png"></p>
<hr>
<h5 id="1-&#x521B;&#x5EFA;&#x77E5;&#x8BC6;&#x5E93;&#x548C;&#x6536;&#x5F55;&#x6570;&#x636E;"><a href="#1-&#x521B;&#x5EFA;&#x77E5;&#x8BC6;&#x5E93;&#x548C;&#x6536;&#x5F55;&#x6570;&#x636E;" class="headerlink" title="1. &#x521B;&#x5EFA;&#x77E5;&#x8BC6;&#x5E93;&#x548C;&#x6536;&#x5F55;&#x6570;&#x636E;"></a>1. &#x521B;&#x5EFA;&#x77E5;&#x8BC6;&#x5E93;&#x548C;&#x6536;&#x5F55;&#x6570;&#x636E;</h5><p>&#x9996;&#x5148;&#x770B;&#x4E00;&#x4E0B;&#x77E5;&#x8BC6;&#x5E93;&#xFF0C;&#x5728; <code>&#x4E2A;&#x4EBA;&#x7A7A;&#x95F4;</code> &#x9876;&#x90E8;&#x6709; <code>&#x77E5;&#x8BC6;&#x5E93;</code> &#x7684;&#x9009;&#x9879;&#x5361;&#xFF0C;&#x5176;&#x4E2D;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x77E5;&#x8BC6;&#x5E93;&#x3002; &#x77E5;&#x8BC6;&#x5E93;&#x4E2D;&#x53EF;&#x4EE5;&#x5305;&#x542B;&#x5404;&#x4E2A;&#x5206;&#x7C7B;&#x7684;&#x77E5;&#x8BC6;&#x96C6;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/fb9ea746745ba409620e5d0e51efd02d75675ee62e004b0b42af1fc9bcadd86a" alt="image.png"></p>
<p>&#x5BF9;&#x4E8E; Flutter &#x800C;&#x8A00;&#xFF0C;&#x6700;&#x91CD;&#x8981;&#x7684;&#x662F; Widget &#x7EC4;&#x4EF6;&#x7684;&#x4F7F;&#x7528;&#xFF0C;&#x8FD9;&#x91CC;&#x62FF; <code>Flutter &#x7EC4;&#x4EF6;&#x96C6;&#x5F55;</code> &#x77E5;&#x8BC6;&#x5E93;&#x4E3A;&#x4F8B;&#x3002;&#x9700;&#x8981;&#x51C6;&#x5907;&#x77E5;&#x8BC6;&#x96C6;&#xFF0C;&#x521A;&#x597D;&#x672C;&#x4EBA;&#x5199;&#x8FC7;&#x5404;&#x79CD; Flutter &#x7EC4;&#x4EF6;&#x4F7F;&#x7528;&#x7684;&#x4EE5;&#x53CA;&#x6E90;&#x7801;&#x89E3;&#x6790;&#x7684;&#x6587;&#x7AE0;&#xFF0C;&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;&#x7D20;&#x6750;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/26eba5b9fdafbec69bf59f127634069e0b133309b71cdfd7667e3b277d5f5f54" alt="image.png"></p>
<p>&#x6DFB;&#x52A0;&#x6587;&#x7AE0;&#x7684; URL &#x5373;&#x53EF;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/b6ca8dd0be46252f7a79edd6ba6f997ec43372019094674ae1a5cb2438f8edbd" alt="image.png"></p>
<p>&#x7136;&#x540E;&#x4F1A;&#x81EA;&#x52A8;&#x8BBF;&#x95EE;&#x6587;&#x7AE0;&#x94FE;&#x63A5;&#xFF0C;&#x8FDB;&#x884C;&#x5904;&#x7406;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/0838925b650cc693f832370c51a721b36acb0880d5df953a18dfd17a22b83581" alt="image.png"></p>
<p>&#x6700;&#x7EC8;&#x5206;&#x6BB5;&#x60C5;&#x51B5;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/efc8dbcf49022c3cd26f5eec20f0fba525134a2ddf252a3e655eda07768749a6" alt="image.png"></p>
<hr>
<h5 id="2-&#x77E5;&#x8BC6;&#x5E93;&#x7684;&#x4F7F;&#x7528;"><a href="#2-&#x77E5;&#x8BC6;&#x5E93;&#x7684;&#x4F7F;&#x7528;" class="headerlink" title="2. &#x77E5;&#x8BC6;&#x5E93;&#x7684;&#x4F7F;&#x7528;"></a>2. &#x77E5;&#x8BC6;&#x5E93;&#x7684;&#x4F7F;&#x7528;</h5><p>&#x5728; <strong>&#x8BB0;&#x5FC6;</strong> &#x533A;&#x70B9;&#x51FB;&#x52A0;&#x53F7;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x77E5;&#x8BC6;&#x5E93;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/538c3e73d99174ebe515995e3faa238ac12b1bc862242d3067dc45defe2a1aff" alt="image.png"></p>
<p>&#x4E0B;&#x9762;&#x662F;&#x6709;&#x65E0;&#x77E5;&#x8BC6;&#x5E93;&#x65F6;&#x63D0;&#x95EE; <strong>&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;&#x4E00;&#x4E0B; ColorFiltered &#x7EC4;&#x4EF6;&#x7684;&#x6E90;&#x7801;&#x5B9E;&#x73B0;</strong> &#x7684;&#x6548;&#x679C;:</p>
<table>
<thead>
<tr>
<th>&#x65E0;&#x77E5;&#x8BC6;&#x5E93;&#x65F6;</th>
<th>&#x6709;&#x77E5;&#x8BC6;&#x5E93;&#x65F6;</th>
</tr>
</thead>
<tbody><tr>
<td>image.png</td>
<td>image.png</td>
</tr>
</tbody></table>
<p>&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x65E0;&#x77E5;&#x8BC6;&#x5E93;&#x65F6;&#xFF0C;&#x57FA;&#x672C;&#x4E0A;&#x76F8;&#x5F53;&#x4E8E;&#x778E;&#x8BCC;&#x4E86;&#xFF1B;&#x5F53;&#x6DFB;&#x52A0;&#x77E5;&#x8BC6;&#x5E93;&#x540E;&#xFF0C;&#x6709;&#x76F8;&#x5173;&#x7684;&#x77E5;&#x8BC6;&#x70B9;&#xFF0C;&#x4F1A;&#x603B;&#x7ED3;&#x77E5;&#x8BC6;&#x5E93;&#x4E2D;&#x7684;&#x5185;&#x5BB9;&#x8FDB;&#x884C;&#x8F93;&#x51FA;&#x3002;&#x4ECE;&#x800C;&#x56DE;&#x7B54;&#x66F4;&#x52A0;&#x7CBE;&#x51C6;&#xFF0C;&#x6240;&#x4EE5; <strong>&#x77E5;&#x8BC6;&#x5E93;&#x5C31;&#x76F8;&#x5F53;&#x4E8E; Toly &#x7684;&#x5927;&#x8111;</strong>&#x3002;&#x53E6;&#x5916;&#xFF0C;&#x5F53;&#x7528;&#x6237;&#x63D0;&#x95EE;&#x65F6;&#xFF0C;&#x5339;&#x914D;&#x5230;&#x7684; &#x201C;&#x77E5;&#x8BC6;&#x7247;&#x6BB5;&#x201D; &#x5C06;&#x4F1A;&#x547D;&#x4E2D;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/54ebf6dc39b121d75ba9426a18337452fd10ad612623adf1145ecacc6b1359b6" alt="image.png"></p>
<hr>
<h5 id="3-&#x5176;&#x4ED6;&#x5F62;&#x5F0F;&#x7684;&#x77E5;&#x8BC6;"><a href="#3-&#x5176;&#x4ED6;&#x5F62;&#x5F0F;&#x7684;&#x77E5;&#x8BC6;" class="headerlink" title="3. &#x5176;&#x4ED6;&#x5F62;&#x5F0F;&#x7684;&#x77E5;&#x8BC6;"></a>3. &#x5176;&#x4ED6;&#x5F62;&#x5F0F;&#x7684;&#x77E5;&#x8BC6;</h5><p>&#x6587;&#x5B57;&#x4F5C;&#x4E3A;&#x77E5;&#x8BC6;&#x7684;&#x8F7D;&#x4F53;&#xFF0C;&#x4E07;&#x53D8;&#x4E0D;&#x79BB;&#x5176;&#x5B97;&#xFF0C;&#x5728;&#x8BA1;&#x7B97;&#x673A;&#x4E2D;&#x90FD;&#x662F; <code>&#x5B57;&#x7B26;&#x8D44;&#x6E90;</code> &#x3002;&#x9664;&#x4E86;&#x901A;&#x8FC7; URL &#x722C;&#x53D6;&#x7F51;&#x9875;&#x8D44;&#x6E90;&#x4E4B;&#x5916;&#xFF0C;&#x8FD8;&#x6709;&#x5F88;&#x591A;&#x5176;&#x4ED6;&#x7684;&#x5F62;&#x5F0F;&#x3002;</p>
<p>&#x5982;&#x4E0B;&#x7684; <code>&#x6587;&#x672C;&#x5F62;&#x5F0F;</code> &#x548C; <code>&#x8868;&#x683C;&#x5F62;&#x5F0F;</code> , &#x53EF;&#x4EE5;&#x662F; PDF&#x3001;Text&#x3001;DocX &#x3001;Excel &#x7B49;&#x5F62;&#x5F0F;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x662F; json &#x5F62;&#x5F0F;&#x7684; api ; &#x4E5F;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x7F16;&#x8F91;&#x6587;&#x672C;&#x3001;&#x8868;&#x683C;&#x4F5C;&#x4E3A;&#x77E5;&#x8BC6;&#x5E93;&#x3002;</p>
<table>
<thead>
<tr>
<th>&#x6587;&#x672C;&#x5F62;&#x5F0F;</th>
<th>&#x8868;&#x683C;&#x5F62;&#x5F0F;</th>
</tr>
</thead>
<tbody><tr>
<td>image.png</td>
<td>image.png</td>
</tr>
</tbody></table>
<p>&#x6BCF;&#x4E2A;&#x7F51;&#x9875;&#x3001;&#x6587;&#x4EF6;&#x3001;&#x63A5;&#x53E3;&#x5185;&#x5BB9;&#x88AB;&#x79F0;&#x4E4B;&#x4E3A; <strong>&#x5355;&#x5143;</strong>&#xFF0C;&#x6BCF;&#x4E2A;&#x5355;&#x5143;&#x4E2D;&#x4F1A;&#x8FDB;&#x884C;&#x5206;&#x6BB5;&#xFF0C;&#x901A;&#x8FC7; URL &#x6293;&#x53D6;&#x7684;&#x4F1A;&#x81EA;&#x52A8;&#x5206;&#x6BB5;&#x3002;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;&#x6BCF;&#x4E2A; <code>&#x5206;&#x6BB5;</code> &#x5C31;&#x50CF;&#x4E00;&#x4E2A;&#x795E;&#x7ECF;&#x5143;&#xFF0C;&#x9047;&#x5230;&#x95EE;&#x9898;&#x65F6;&#x60F3;&#x5230;&#x4E86;&#xFF0C;&#x5B83;&#x5C31;&#x88AB;&#x547D;&#x4E2D;&#x4E86;&#x4E00;&#x6B21;&#x3002;&#x8FD9;&#x6837;&#x5176;&#x5B9E;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x547D;&#x4E2D;&#x60C5;&#x51B5;&#xFF0C;&#x6765;&#x7EDF;&#x8BA1;&#x54EA;&#x4E9B;&#x795E;&#x7ECF;&#x5143;&#x6BD4;&#x8F83; &#x201C;&#x6D3B;&#x8DC3;&#x201D;&#xFF0C;&#x611F;&#x89C9;&#x4E5F;&#x633A;&#x6709;&#x610F;&#x601D;&#x7684;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/ce98aa57c460c4f32ce64dbce9b00d5e5e4f2834426df98ff85c574233cc6f38" alt="image.png"></p>
<p>&#x4FD7;&#x8BDD;&#x8BF4;&#xFF0C;&#x5C0F;&#x5B69;&#x5C31;&#x662F;&#x56DB;&#x811A;&#x541E;&#x91D1;&#x517D;&#xFF0C;&#x751F;&#x513F;&#x96BE;&#xFF0C;&#x517B;&#x513F;&#x66F4;&#x96BE;&#x3002;&#x63A5;&#x4E0B;&#x6765;&#x5C31;&#x662F;&#x67AF;&#x71E5;&#x4E4F;&#x5473;&#x7684;&#x517B;&#x513F;&#x8FC7;&#x7A0B;&#x4E86;&#xFF0C;&#x5582;&#x98DF;&#x5404;&#x79CD; Flutter &#x9886;&#x57DF;&#x4F18;&#x79C0;&#x7684;&#x77E5;&#x8BC6;&#xFF0C;&#x6765;&#x8BA9; Toly &#x6709;&#x4E00;&#x4E2A;&#x5F3A;&#x5927;&#x7684;&#x77E5;&#x8BC6;&#x5E93;&#x3002;&#x6210;&#x4E3A;&#x771F;&#x6B63;&#x7684; <strong>&#x201C;Flutter &#x5927;&#x5E08;&#x201D;</strong> &#x3002;</p>
<hr>
<h4 id="&#x4E09;&#x3001;&#x8BED;&#x4E49;&#x5316;&#x6570;&#x636E;&#x5E93;&#x7684;&#x652F;&#x6301;"><a href="#&#x4E09;&#x3001;&#x8BED;&#x4E49;&#x5316;&#x6570;&#x636E;&#x5E93;&#x7684;&#x652F;&#x6301;" class="headerlink" title="&#x4E09;&#x3001;&#x8BED;&#x4E49;&#x5316;&#x6570;&#x636E;&#x5E93;&#x7684;&#x652F;&#x6301;"></a>&#x4E09;&#x3001;&#x8BED;&#x4E49;&#x5316;&#x6570;&#x636E;&#x5E93;&#x7684;&#x652F;&#x6301;</h4><p>&#x5728;&#x8BB0;&#x5FC6;&#x4E2D;&#x6709;&#x53E6;&#x4E00;&#x79CD; &#x201C;&#x77E5;&#x8BC6;&#x201D; &#x7684;&#x5B58;&#x50A8;&#x5F62;&#x5F0F; &#x2013; <code>&#x6570;&#x636E;&#x5E93;</code>&#x3002; &#x7528;&#x6237;&#x53EF;&#x901A;&#x8FC7;&#x81EA;&#x7136;&#x8BED;&#x8A00;&#x63D2;&#x5165;&#x548C;&#x67E5;&#x8BE2;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x4F7F;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x4FBF;&#x6377;&#x5730;&#x4E0E; Bot &#x8FDB;&#x884C;&#x4EA4;&#x4E92;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/8dc94fafa8e37687ed00b314a2d4893dd2a69fdf9f26bf23f10ae0be05681986" alt="image.png"></p>
<hr>
<h5 id="1-&#x521B;&#x5EFA;&#x6570;&#x636E;&#x5E93;&#x548C;&#x63D2;&#x5165;&#x5185;&#x5BB9;"><a href="#1-&#x521B;&#x5EFA;&#x6570;&#x636E;&#x5E93;&#x548C;&#x63D2;&#x5165;&#x5185;&#x5BB9;" class="headerlink" title="1. &#x521B;&#x5EFA;&#x6570;&#x636E;&#x5E93;&#x548C;&#x63D2;&#x5165;&#x5185;&#x5BB9;"></a>1. &#x521B;&#x5EFA;&#x6570;&#x636E;&#x5E93;&#x548C;&#x63D2;&#x5165;&#x5185;&#x5BB9;</h5><p>&#x53EF;&#x4EE5;&#x521B;&#x5EFA;&#x8868;&#x683C;&#x6765;&#x8BB0;&#x5F55;&#x53EA;&#x662F;&#xFF0C;&#x6BD4;&#x5982;&#x8FD9;&#x91CC;&#x521B;&#x5EFA; flutter_points &#x7684;&#x8BB0;&#x5F55;&#x8868;&#xFF0C;&#x7531;&#x4E09;&#x4E2A;&#x5B57;&#x6BB5;&#xFF1A;&#x6807;&#x9898;&#x3001;&#x5185;&#x5BB9;&#x548C;&#x7C7B;&#x522B;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/bc90919bf7f921ae8a93fd3d4f351af8bf7295644e89e18d17528367ad8a0d55" alt="image.png"></p>
<hr>
<p>&#x7136;&#x540E;&#x901A;&#x8FC7;&#x81EA;&#x7136;&#x8BED;&#x8A00;&#x7684;&#x63CF;&#x8FF0;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x63D2;&#x5165;&#x5185;&#x5BB9;&#x5230;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#xFF1A;</p>
<blockquote>
<p>&#x540D;&#x79F0;&#xFF1A; Flutter &#x5347;&#x7EA7;&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x5185;&#x5BB9;&#xFF1A; flutter upgrade&#xFF0C;&#x7C7B;&#x522B;&#xFF1A;&#x547D;&#x4EE4;&#x884C;  </p>
<p>&#x540D;&#x79F0;&#xFF1A; &#x67E5;&#x770B; Flutter &#x7248;&#x672C;&#xFF0C;&#x5185;&#x5BB9;&#xFF1A; flutter &#x2013;version&#xFF0C;&#x7C7B;&#x522B;&#xFF1A;&#x547D;&#x4EE4;&#x884C;  </p>
<p>&#x540D;&#x79F0;&#xFF1A; flutter &#x4E09;&#x65B9;&#x5E93;&#x7684;&#x5B98;&#x7F51;&#xFF0C;&#x5185;&#x5BB9;&#xFF1A;<code>https://pub.dev/</code> &#xFF0C;&#x7C7B;&#x522B;&#xFF1A;&#x8D44;&#x6E90;  </p>
<p>&#x540D;&#x79F0;&#xFF1A; flutter &#x5F00;&#x6E90;&#x5730;&#x5740;&#xFF0C;&#x5185;&#x5BB9;&#xFF1A;<code>https://github.com/flutter/flutter</code> &#xFF0C;&#x7C7B;&#x522B;&#xFF1A;&#x8D44;&#x6E90;</p>
</blockquote>
<p>&#x8FD9;&#x6837;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x5C31;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x5185;&#x5BB9;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/dbd475bb44839894c63f2cf7bc7bfb1400028d7bff3a8638689682ecc46b49df" alt="image.png"></p>
<p>&#x901A;&#x8FC7;&#x81EA;&#x7136;&#x8BED;&#x8A00;&#x63CF;&#x8FF0;&#xFF0C;&#x53EF;&#x4EE5;&#x67E5;&#x8BE2;&#x6570;&#x636E;&#xFF0C;&#x8FD8;&#x662F;&#x633A;&#x6709;&#x610F;&#x601D;&#x7684;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/0ef55e7773ef59be03f6a74dd5690de7d465056cb1f1a7513a673957d96f09e0" alt="image.png"></p>
<hr>
<h5 id="2-&#x5220;&#x9664;&#x5185;&#x5BB9;"><a href="#2-&#x5220;&#x9664;&#x5185;&#x5BB9;" class="headerlink" title="2. &#x5220;&#x9664;&#x5185;&#x5BB9;"></a>2. &#x5220;&#x9664;&#x5185;&#x5BB9;</h5><p>&#x540C;&#x6837;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x81EA;&#x7136;&#x8BED;&#x8A00;&#x7684;&#x63CF;&#x8FF0;&#xFF0C;&#x6765;&#x5220;&#x9664;&#x6216;&#x6E05;&#x7A7A;&#x6570;&#x636E;&#x3002;&#x53EF;&#x4EE5;&#x5728;&#x8BE6;&#x60C5;&#x4E2D;&#x770B;&#x51FA;&#xFF0C;&#x6263;&#x5B50;&#x662F;&#x7406;&#x89E3;&#x8BED;&#x4E49;&#x540E;&#x901A;&#x8FC7; sql &#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#x7684;&#x3002;</p>
<table>
<thead>
<tr>
<th>&#x6807;&#x9898;</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>image.png</td>
<td>image.png</td>
</tr>
</tbody></table>
<p>&#x4F46;&#x662F;&#x4E2A;&#x4EBA;&#x611F;&#x89C9;&#x76EE;&#x524D;&#x7684;&#x652F;&#x6301;&#x7A0B;&#x5EA6;&#x4E0D;&#x592A;&#x5B8C;&#x5584;&#xFF0C;&#x53EA;&#x80FD;&#x652F;&#x6301;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x800C;&#x4E14;&#x6709;&#x65F6;&#x5019;&#x8BED;&#x53E5;&#x7684;&#x8BC6;&#x522B;&#x4E0D;&#x592A;&#x7CBE;&#x51C6;&#x3002;&#x5E0C;&#x671B;&#x53EF;&#x4EE5;&#x8BA9;&#x5F00;&#x53D1;&#x8005;&#x81EA;&#x5B9A;&#x4E49;&#x4E00;&#x4E9B;&#x6807;&#x8BC6;&#x7B26;&#x4E4B;&#x7C7B;&#x7684;&#xFF0C;&#x65B9;&#x4FBF;&#x6807;&#x8BC6;&#x3002;&#x6E05;&#x7A7A;&#x6570;&#x636E;&#x5E93;&#x6709;&#x65F6;&#x5019;&#x8FD8;&#x4F1A;&#x51FA;&#x9519;&#xFF0C;&#x4E0D;&#x8FC7;&#x76F8;&#x4FE1;&#x4EE5;&#x540E;&#x4F1A;&#x5B8C;&#x5584;&#x7684;&#x3002;  </p>
<p>&#x53E6;&#x5916;&#xFF0C;&#x4E0D;&#x592A;&#x6E05;&#x695A;&#x8FD9;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x662F;&#x6BCF;&#x4E2A;&#x7528;&#x6237;&#x4E00;&#x4EFD;&#x8FD8;&#x662F;&#x7528;&#x4E00;&#x4E2A;&#xFF0C;&#x5982;&#x679C;&#x5171;&#x7528;&#x4E00;&#x4E2A;&#xFF0C;&#x4E0D;&#x77E5;&#x9053;&#x6709;&#x6CA1;&#x6709;&#x6743;&#x9650;&#x63A7;&#x5236;&#xFF0C;&#x4E0D;&#x7136;&#x4EFB;&#x4F55;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x5220;&#x9664;&#x4E0D;&#x592A;&#x5408;&#x7406;&#x3002;</p>
<hr>
<h4 id="&#x56DB;&#x3001;&#x53D1;&#x5E03;-Bot"><a href="#&#x56DB;&#x3001;&#x53D1;&#x5E03;-Bot" class="headerlink" title="&#x56DB;&#x3001;&#x53D1;&#x5E03; Bot"></a>&#x56DB;&#x3001;&#x53D1;&#x5E03; Bot</h4><p>&#x517B;&#x80B2;&#x5B8C;&#x6210;&#x4E4B;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x53D1;&#x5E03;&#x6765;&#x8BA9;&#x5176;&#x4ED6;&#x7684;&#x4EBA;&#x4F7F;&#x7528;:</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/7c9628b2561a1fd40ed69006aaeab96c7620e2824bb5226684b728c0d826b094" alt="image.png"></p>
<p>&#x76EE;&#x524D;&#x652F;&#x6301; <code>&#x8C46;&#x5305;</code>&#x3001;<code>&#x98DE;&#x4E66;</code>&#x3001;<code>&#x5FAE;&#x4FE1;&#x670D;&#x52A1;&#x53F7;/&#x5BA2;&#x670D;</code>&#xFF0C;&#x90FD;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x7B5B;&#x9009;&#x6216;&#x8005;&#x914D;&#x7F6E;&#xFF0C;&#x8BE6;&#x60C5;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x6587;&#x6863;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/674e84f4684292c553afa1c71987bb8e6ea7115cc679d6088217cb26846efc1d" alt="image.png"></p>
<p>&#x53D1;&#x5E03;&#x5230;&#x98DE;&#x4E66;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x70B9;&#x51FB; <strong>&#x914D;&#x7F6E;</strong> &#x6309;&#x94AE;&#xFF0C;&#x98DE;&#x4E66;&#x767B;&#x5F55;&#x540E;&#x83B7;&#x53D6;&#x5E94;&#x7528;&#x540E;&#x6388;&#x6743;&#x5373;&#x53EF;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/455d6404bbe9fa786bd2695ba5919c5440fb33ca9cfc55d09649854ad20f7e0d" alt="image.png"></p>
<p>&#x53D1;&#x5E03;&#x4E4B;&#x540E;&#xFF0C;&#x522B;&#x4EBA;&#x5C31;&#x53EF;&#x4EE5;&#x5728;&#x98DE;&#x4E66;&#x5E94;&#x7528;&#x4E2D;&#x641C;&#x7D22;&#x5230; <strong>Flutter &#x5927;&#x5E08;</strong> &#x7684;&#x673A;&#x5668;&#x4EBA;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/5c0fa3fb9e521b3d775f7dac0c18217ac7d8c2956502d94d44d273692d4069c4" alt="image.png"></p>
<p>&#x7136;&#x540E;&#x6109;&#x5FEB;&#x5730;&#x73A9;&#x800D;&#x5427; ~</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/8f3cd533180fb63461a9efea9db4f368cdfabeec75d324acc4a8acf8fd540c2b" alt="image.png"></p>
<hr>
<p>&#x5728;&#x6263;&#x5B50;&#x7684; Bots &#x9875;&#x9762;&#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x5B66;&#x4E60;&#x52A9;&#x624B;&#x4E2D;&#x641C;&#x7D22;&#x5230; <strong>Flutter &#x5927;&#x5E08;</strong></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/fa9aab9546e6d841703d444f3ced7563020b1675ee90f13ced36a10a19c7bfa9" alt="image.png"></p>
<p>&#x4F7F;&#x7528;&#x4E2D;&#x53D1;&#x73B0;<code>&#x98DE;&#x4E66;&#x5E94;&#x7528;</code>&#x597D;&#x50CF;&#x4E0D;&#x652F;&#x6301;&#x6570;&#x636E;&#x5E93;&#x7684;&#x80FD;&#x529B;&#xFF0C;&#x5728;<code>&#x6263;&#x5B50;</code> &#x91CC;&#x53EF;&#x4EE5;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/ac9a2cf2da9cc6f9b63f863ea32089a6be167973846217778b801a25084267b2" alt="image.png"></p>
<p>&#x90A3;&#x6263;&#x5B50;&#x7684;&#x521D;&#x4F53;&#x9A8C;&#x5C31;&#x5230;&#x8FD9;&#x91CC;&#xFF0C;&#x603B;&#x5F97;&#x6765;&#x8BF4;&#x77E5;&#x8BC6;&#x5E93;&#x548C;&#x6570;&#x636E;&#x5E93;&#x7684;&#x8BB0;&#x5FC6;&#x80FD;&#x529B;&#x8FD8;&#x662F;&#x8BA9;&#x6211;&#x5F88;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x3002;&#x76EE;&#x524D; &#x201C;Flutter &#x5927;&#x5E08;&#x201D; &#x8FD8;&#x5728;&#x5C0F;&#x767D;&#x9636;&#x6BB5;&#xFF0C;&#x8BA9;&#x6211;&#x6162;&#x6162;&#x517B;&#x80B2;&#x5427; ~</p>
<hr>
<h4 id="&#x6700;&#x540E;&#x5C0F;&#x7ED3;"><a href="#&#x6700;&#x540E;&#x5C0F;&#x7ED3;" class="headerlink" title="&#x6700;&#x540E;&#x5C0F;&#x7ED3;"></a>&#x6700;&#x540E;&#x5C0F;&#x7ED3;</h4><p>&#x6263;&#x5B50;&#x7ED9;&#x6211;&#x4EEC;&#x5E26;&#x6765;&#x4E86;&#x4EC0;&#x4E48;?</p>
<blockquote>
<p>&#x8BA9;&#x666E;&#x901A;&#x4EBA;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x81EA;&#x5B9A;&#x4E49;&#x77E5;&#x8BC6;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x6765; &#x201C;&#x517B;&#x80B2;&#x201D; &#x4E13;&#x4E1A;&#x9886;&#x57DF; AI &#x667A;&#x6167;&#x4F53;&#x7684;&#x673A;&#x4F1A;!</p>
</blockquote>
<hr>
<p>&#x6700;&#x540E;&#x5BF9;&#x6263;&#x5B50;&#x7684;&#x4E00;&#x4E9B;&#x5EFA;&#x8BAE;&#x548C;&#x5C0F;&#x7545;&#x60F3;&#xFF1A;</p>
<ul>
<li>&#x6307;&#x5B9A;&#x683C;&#x5F0F;&#xFF0C;&#x53EF;&#x4EE5;&#x652F;&#x6301;<code>&#x6279;&#x91CF;&#x5BFC;&#x5165;</code> url&#xFF0C;&#x6216;&#x8005;&#x6398;&#x91D1;&#x53EF;&#x4EE5;&#x8BA9;&#x4F5C;&#x8005;&#x5C06;&#x6587;&#x7AE0;&#x3001;&#x4E13;&#x680F;&#x5BFC;&#x51FA;&#x5230; Coze &#x77E5;&#x8BC6;&#x5E93;&#x7684;&#x529F;&#x80FD;&#x3002;</li>
<li>&#x6570;&#x636E;&#x5E93;&#x5E0C;&#x671B;&#x672A;&#x6765;&#x80FD;&#x591F;&#x52A0;&#x5F3A;&#xFF0C;&#x8FD9;&#x662F;&#x4E2A;&#x5F88;&#x4E0D;&#x9519;&#x7684;&#x7279;&#x8272;&#xFF0C;&#x6709;&#x4E86;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x53EF;&#x4EE5;&#x73A9;&#x5F88;&#x591A;&#x82B1;&#x6837;&#x3002;</li>
<li><code>&#x6398;&#x91D1;&#x5C0F;&#x518C;&amp;Coze</code> &#x53EF;&#x4EE5;&#x6253;&#x9020;&#x67D0;&#x672C;&#x5C0F;&#x518C;&#x4E13;&#x6709;&#x7684; Bot &#xFF0C;&#x5582;&#x517B;&#x5C0F;&#x518C;&#x5185;&#x5BB9;&#xFF0C;&#x4EC5;&#x5C0F;&#x518C;&#x8D2D;&#x4E70;&#x8005;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#xFF0C;&#x611F;&#x89C9;&#x4F1A;&#x633A;&#x4E0D;&#x9519;&#x3002;</li>
<li>&#x7F51;&#x9875;&#x6293;&#x53D6;&#x6587;&#x7AE0;&#x65F6;&#xFF0C;&#x56FE;&#x7247;&#x6709;&#x65F6;&#x662F;&#x5F88;&#x91CD;&#x8981;&#x7684;&#x3002;&#x540E;&#x671F;&#x53EF;&#x4EE5;&#x5BF9;<code>&#x56FE;&#x7247;&#x8D44;&#x6E90;&#x8BC6;&#x522B;</code>&#xFF0C;&#x4F5C;&#x4E3A;&#x8D44;&#x6599;&#x3002;&#x6216;&#x4F5C;&#x4E3A;&#x95EE;&#x7B54;&#x4E2D;&#x53EF;&#x4EE5;&#x8F93;&#x51FA;&#x76F8;&#x5173;&#x56FE;&#x7247;&#x3002;</li>
<li>&#x5BF9;&#x77E5;&#x8BC6;&#x5E93;&#x4E2D;&#x7684;&#x5206;&#x6BB5;&#x547D;&#x4E2D;&#x60C5;&#x51B5;&#x63D0;&#x4F9B;&#x4E00;&#x4E9B;&#x7EDF;&#x8BA1;&#x56FE;&#x7684;&#x652F;&#x6301;&#xFF0C;&#x65B9;&#x4FBF;&#x53EF;&#x89C6;&#x5316;&#x5730;&#x67E5;&#x770B;&#x547D;&#x4E2D;&#x60C5;&#x51B5;&#x3002;</li>
</ul>
<p>bot ID: 7338763773840375842</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/550f33e4c3a847969a2c0c518badfa2c.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="../44/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="../../">1</a><span class="space">&hellip;</span><a class="page-number" href="../44/">44</a><span class="page-number current">45</span><a class="page-number" href="../46/">46</a><span class="space">&hellip;</span><a class="page-number" href="../99/">99</a><a class="extend next" rel="next" href="../46/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">开发者博客</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="https://dev.newban.cn/archives/">
              
                  <span class="site-state-item-count">990</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">399</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="../../atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">开发者博客</span>
  <div>
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
  </div>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




  <script type="text/javascript" async src="js/src/mermaid.min.js"></script>
  <script>
  if (window.mermaid) {
        var mermaid_config = {
            startOnLoad: true,
            theme: 'default',
            flowchart:{
                useMaxWidth: false,
                htmlLabels: true
            }                
        }
        mermaid.initialize(mermaid_config);
  }
  </script>
  

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="../../lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="../../lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="../../lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="../../lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="../../lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="../../lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="../../js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="../../js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="../../js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
