<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">
<meta name="referrer" content="never">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="../../lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="../../lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="../../css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="../../images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="../../images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="../../images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="../../images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">





  <link rel="alternate" href="../../atom.xml" title="开发者博客 – IT技术 尽在开发者博客" type="application/atom+xml">






<meta property="og:type" content="website">
<meta property="og:title" content="开发者博客 – IT技术 尽在开发者博客">
<meta property="og:url" content="https://dev.newban.cn/page/163/index.html">
<meta property="og:site_name" content="开发者博客 – IT技术 尽在开发者博客">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="开发者博客 – IT技术 尽在开发者博客">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>
<!--谷歌广告验证代码-->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-2626449904708114",
          enable_page_level_ads: true
     });
</script>
<!--谷歌广告验证代码-->



  <link rel="canonical" href="https://dev.newban.cn/page/163/">





  <title>开发者博客 – IT技术 尽在开发者博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">开发者博客 – IT技术 尽在开发者博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">开发者博客 – 科技是第一生产力</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="http://dev.newban.cn/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="https://dev.newban.cn/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844904008679686152.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844904008679686152.html" itemprop="url">不容错过的 Babel7 知识</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-12-02T09:56:10+08:00">
                2019-12-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x5BF9; <code>Babel</code> &#x7684;&#x914D;&#x7F6E;&#x9879;&#x7684;&#x4F5C;&#x7528;&#x4E0D;&#x90A3;&#x4E48;&#x4E86;&#x89E3;&#xFF0C;&#x662F;&#x5426;&#x4F1A;&#x5F71;&#x54CD;&#x65E5;&#x5E38;&#x5F00;&#x53D1;&#x5462;&#xFF1F;&#x8001;&#x5B9E;&#x8BF4;&#xFF0C;&#x5927;&#x591A;&#x60C5;&#x51B5;&#x4E0B;&#x6CA1;&#x6709;&#x7279;&#x522B;&#x5927;&#x7684;&#x5F71;&#x54CD;&#xFF08;&#x6BD5;&#x7ADF;&#x6709;&#x641C;&#x7D22;&#x5F15;&#x64CE;&#xFF09;&#x3002;</p>
<p>&#x4E0D;&#x8FC7;&#x5462;&#xFF0C;&#x8FD8;&#x662F;&#x60F3;&#x66F4;&#x8FDB;&#x4E00;&#x6B65;&#x4E86;&#x89E3;&#x4E0B;&#xFF0C;&#x4E8E;&#x662F;&#x6700;&#x8FD1;&#x8BA4;&#x771F;&#x9605;&#x8BFB;&#x4E86; <code>Babel</code> &#x7684;&#x6587;&#x6863;&#xFF0C;&#x5916;&#x52A0;&#x4E0D;&#x65AD;&#x7F16;&#x8BD1;&#x9A8C;&#x8BC1;&#xFF0C;&#x8F93;&#x51FA;&#x4E86;&#x672C;&#x7BC7;&#x6587;&#x7AE0;&#xFF0C;&#x4E3A;&#x4E86;&#x66F4;&#x597D;&#x7684;&#x9605;&#x8BFB;&#x4F53;&#x9A8C;&#xFF0C;&#x4FEE;&#x4FEE;&#x6539;&#x6539;&#xFF0C;&#x6700;&#x7EC8;&#x7B97;&#x662F;&#x4EE5;&#x6211;&#x4E2A;&#x4EBA;&#x6BD4;&#x8F83;&#x559C;&#x6B22;&#x7684;&#x65B9;&#x5F0F;&#x63A8;&#x8FDB;&#x4E86;&#x6BCF;&#x4E2A;&#x77E5;&#x8BC6;&#x70B9;&#xFF08;&#x6BCF;&#x4E00;&#x4E2A;&#x914D;&#x7F6E;&#x7684;&#x5F15;&#x5165;&#x90FD;&#x662F;&#x6709;&#x539F;&#x56E0;&#x7684;&#xFF09;&#xFF0C;&#x5E0C;&#x671B;&#x80FD;&#x591F;&#x5E2E;&#x52A9;&#x4F60;&#x5BF9; <code>Babel</code> &#x7684;&#x5404;&#x79CD;&#x914D;&#x7F6E;&#x6709;&#x4E00;&#x4E2A;&#x66F4;&#x6E05;&#x6670;&#x7684;&#x8BA4;&#x8BC6; (&#x5DF2;&#x7ECF;&#x5F88;&#x61C2;&#x7684;&#x5C0F;&#x4F19;&#x4F34;&#xFF0C;&#x65E0;&#x89C6;&#x672C;&#x6587;) &#x3002;</p>
<blockquote>
<p>Babel &#x662F;&#x4E00;&#x4E2A; JS &#x7F16;&#x8BD1;&#x5668;</p>
</blockquote>
<p>Babel &#x662F;&#x4E00;&#x4E2A;&#x5DE5;&#x5177;&#x94FE;&#xFF0C;&#x4E3B;&#x8981;&#x7528;&#x4E8E;&#x5C06; ECMAScript 2015+ &#x7248;&#x672C;&#x7684;&#x4EE3;&#x7801;&#x8F6C;&#x6362;&#x4E3A;&#x5411;&#x540E;&#x517C;&#x5BB9;&#x7684; JavaScript &#x8BED;&#x6CD5;&#xFF0C;&#x4EE5;&#x4FBF;&#x80FD;&#x591F;&#x8FD0;&#x884C;&#x5728;&#x5F53;&#x524D;&#x548C;&#x65E7;&#x7248;&#x672C;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#x6216;&#x5176;&#x4ED6;&#x73AF;&#x5883;&#x4E2D;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x5148;&#x770B;&#x770B; <code>Babel</code> &#x80FD;&#x591F;&#x505A;&#x4EC0;&#x4E48;&#xFF1A;</p>
<ul>
<li>&#x8BED;&#x6CD5;&#x8F6C;&#x6362;</li>
<li>&#x901A;&#x8FC7; <code>Polyfill</code> &#x65B9;&#x5F0F;&#x5728;&#x76EE;&#x6807;&#x73AF;&#x5883;&#x4E2D;&#x6DFB;&#x52A0;&#x7F3A;&#x5931;&#x7684;&#x7279;&#x6027;(<code>@babel/polyfill&#x6A21;&#x5757;</code>)</li>
<li>&#x6E90;&#x7801;&#x8F6C;&#x6362;(codemods)</li>
</ul>
<p>&#x672C;&#x7BC7;&#x6587;&#x7AE0;&#x7684;&#x76EE;&#x7684;&#x662F;&#x641E;&#x660E;&#x767D; <code>Babel</code> &#x7684;&#x4F7F;&#x7528;&#x548C;&#x914D;&#x7F6E;&#xFF0C;&#x641E;&#x6E05;&#x695A; <code>@babel/runtime</code>&#xFF0C;<code>@babel/polyfill</code>&#xFF0C;<code>@babel/plugin-transform-runtime</code> &#x8FD9;&#x4E9B;&#x4F5C;&#x7528;&#x662F;&#x4EC0;&#x4E48;&#xFF0C;&#x63D2;&#x4EF6;&#x548C;&#x9884;&#x8BBE;&#x90FD;&#x662F;&#x7528;&#x6765;&#x5E72;&#x4EC0;&#x4E48;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x4E3A;&#x4EC0;&#x4E48;&#x9700;&#x8981;&#x914D;&#x7F6E;&#x5B83;&#x4EEC;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x8BB2;&#x5982;&#x4F55;&#x8FDB;&#x884C; <code>AST</code> &#x8F6C;&#x6362;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x5BF9; <code>AST</code> &#x8F6C;&#x6362;&#x975E;&#x5E38;&#x611F;&#x5174;&#x8DA3;&#xFF0C;&#x6B22;&#x8FCE;&#x9605;&#x8BFB;&#x6211;&#x4EEC;&#x7684; <a href="/external_links/1cce6ab2d6a1165e7550ad47036e441d.html" target="blank" rel="noopener">RN&#x8F6C;&#x5C0F;&#x7A0B;&#x5E8F;&#x5F15;&#x64CE; Alita</a> &#x7684;&#x6E90;&#x7801;&#xFF0C;&#x5176;&#x4E2D;&#x5E94;&#x7528;&#x4E86;&#x5927;&#x91CF;&#x7684; <code>AST</code> &#x8F6C;&#x6362;&#x3002;</p>
<blockquote>
<p>&#x66F4;&#x591A;&#x6587;&#x7AE0;&#x53EF;&#x6233;&#xFF08;&#x5982;Star&#xFF0C;&#x8C22;&#x8C22;&#x4F60;&#xFF09;&#xFF1A;<a href="/external_links/e1510e84fb16aeb240e6da4864fc6091.html" target="blank" rel="noopener">https://github.com/YvetteLau/Blog</a></p>
</blockquote>
<p>&#x4E3A;&#x4E86;&#x66F4;&#x6E05;&#x6670;&#x7684;&#x4E86;&#x89E3;&#x6BCF;&#x4E00;&#x6B65;&#xFF0C;&#x9996;&#x5148;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x9879;&#x76EE;&#xFF0C;&#x4F8B;&#x5982; <code>babelTemp</code>(&#x4F60;&#x7231;&#x53D6;&#x5565;&#x540D;&#x53D6;&#x5565;&#x540D;)&#xFF0C;&#x4F7F;&#x7528; <code>npm init -y</code> &#x8FDB;&#x884C;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x521B;&#x5EFA; <code>src/index.js</code>&#xFF0C;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF08;&#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x968F;&#x4FBF;&#x5199;&#x70B9;&#x4EC0;&#x4E48;&#xFF09;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">js&#x590D;&#x5236;&#x4EE3;&#x7801;const&#xA0;fn&#xA0;=&#xA0;()&#xA0;=&gt;&#xA0;{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;console.log(&apos;a&apos;);  </span><br><span class="line">};</span><br></pre></td></tr></table></figure>

<p>OK&#xFF0C;&#x521B;&#x5EFA;&#x597D;&#x7684;&#x9879;&#x76EE;&#x5148;&#x653E;&#x5728;&#x4E00;&#x8FB9;&#xFF0C;&#x5148;&#x4E86;&#x89E3;&#x4E0B;&#x7406;&#x8BBA;&#x77E5;&#x8BC6;:</p>
<h3 id="&#x6838;&#x5FC3;&#x5E93;-babel-core"><a href="#&#x6838;&#x5FC3;&#x5E93;-babel-core" class="headerlink" title="&#x6838;&#x5FC3;&#x5E93; @babel/core"></a>&#x6838;&#x5FC3;&#x5E93; @babel/core</h3><p>Babel &#x7684;&#x6838;&#x5FC3;&#x529F;&#x80FD;&#x5305;&#x542B;&#x5728; <code>@babel/core</code> &#x6A21;&#x5757;&#x4E2D;&#x3002;&#x770B;&#x5230; <code>core</code> &#x8FD9;&#x4E2A;&#x8BCD;&#x4E86;&#x5427;&#xFF0C;&#x610F;&#x5473;&#x7740;<strong>&#x6838;&#x5FC3;</strong>&#xFF0C;&#x6CA1;&#x6709;&#x5B83;&#xFF0C;&#x5728; <code>babel</code> &#x7684;&#x4E16;&#x754C;&#x91CC;&#x6CE8;&#x5B9A;&#x5BF8;&#x6B65;&#x96BE;&#x884C;&#x3002;&#x4E0D;&#x5B89;&#x88C5; <code>@babel/core</code>&#xFF0C;&#x65E0;&#x6CD5;&#x4F7F;&#x7528; <code>babel</code> &#x8FDB;&#x884C;&#x7F16;&#x8BD1;&#x3002;</p>
<h3 id="CLI&#x547D;&#x4EE4;&#x884C;&#x5DE5;&#x5177;-babel-cli"><a href="#CLI&#x547D;&#x4EE4;&#x884C;&#x5DE5;&#x5177;-babel-cli" class="headerlink" title="CLI&#x547D;&#x4EE4;&#x884C;&#x5DE5;&#x5177; @babel/cli"></a>CLI&#x547D;&#x4EE4;&#x884C;&#x5DE5;&#x5177; @babel/cli</h3><p><code>babel</code> &#x63D0;&#x4F9B;&#x7684;&#x547D;&#x4EE4;&#x884C;&#x5DE5;&#x5177;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x63D0;&#x4F9B; <code>babel</code> &#x8FD9;&#x4E2A;&#x547D;&#x4EE4;&#xFF0C;&#x9002;&#x5408;&#x5B89;&#x88C5;&#x5728;&#x9879;&#x76EE;&#x91CC;&#x3002;</p>
<p><code>@babel/node</code> &#x63D0;&#x4F9B;&#x4E86; <code>babel-node</code> &#x547D;&#x4EE4;&#xFF0C;&#x4F46;&#x662F; <code>@babel/node</code> &#x66F4;&#x9002;&#x5408;&#x5168;&#x5C40;&#x5B89;&#x88C5;&#xFF0C;&#x4E0D;&#x9002;&#x5408;&#x5B89;&#x88C5;&#x5728;&#x9879;&#x76EE;&#x91CC;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&#x590D;&#x5236;&#x4EE3;&#x7801;npm&#xA0;install&#xA0;--save-dev&#xA0;@babel/core&#xA0;@babel/cli</span><br></pre></td></tr></table></figure>

<p>&#x73B0;&#x5728;&#x4F60;&#x5C31;&#x53EF;&#x4EE5;&#x5728;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528; <code>babel</code> &#x8FDB;&#x884C;&#x7F16;&#x8BD1;&#x5566;&#xFF08;&#x5982;&#x679C;&#x4E0D;&#x5B89;&#x88C5; <code>@babel/core</code>&#xFF0C;&#x4F1A;&#x62A5;&#x9519;&#x5662;&#xFF09;</p>
<p>&#x5C06;&#x547D;&#x4EE4;&#x914D;&#x7F6E;&#x5728; <code>package.json</code> &#x6587;&#x4EF6;&#x7684; <code>scripts</code> &#x5B57;&#x6BB5;&#x4E2D;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">json&#x590D;&#x5236;&#x4EE3;&#x7801;//...  </span><br><span class="line">&quot;scripts&quot;:&#xA0;{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&quot;compiler&quot;:&#xA0;&quot;babel&#xA0;src&#xA0;--out-dir&#xA0;lib&#xA0;--watch&quot;  </span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4F7F;&#x7528; <code>npm run compiler</code> &#x6765;&#x6267;&#x884C;&#x7F16;&#x8BD1;&#xFF0C;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x6CA1;&#x6709;&#x914D;&#x7F6E;&#x4EFB;&#x4F55;&#x63D2;&#x4EF6;&#xFF0C;&#x7F16;&#x8BD1;&#x524D;&#x540E;&#x7684;&#x4EE3;&#x7801;&#x662F;&#x5B8C;&#x5168;&#x4E00;&#x6837;&#x7684;&#x3002;</p>
<p>&#x56E0;&#x4E3A; <code>Babel</code> &#x867D;&#x7136;&#x5F00;&#x7BB1;&#x5373;&#x7528;&#xFF0C;&#x4F46;&#x662F;&#x4EC0;&#x4E48;&#x52A8;&#x4F5C;&#x4E5F;&#x4E0D;&#x505A;&#xFF0C;&#x5982;&#x679C;&#x60F3;&#x8981; <code>Babel</code> &#x505A;&#x4E00;&#x4E9B;&#x5B9E;&#x9645;&#x7684;&#x5DE5;&#x4F5C;&#xFF0C;&#x5C31;&#x9700;&#x8981;&#x4E3A;&#x5176;&#x6DFB;&#x52A0;&#x63D2;&#x4EF6;(<code>plugin</code>)&#x3002;</p>
<h3 id="&#x63D2;&#x4EF6;"><a href="#&#x63D2;&#x4EF6;" class="headerlink" title="&#x63D2;&#x4EF6;"></a>&#x63D2;&#x4EF6;</h3><p><code>Babel</code> &#x6784;&#x5EFA;&#x5728;&#x63D2;&#x4EF6;&#x4E4B;&#x4E0A;&#xFF0C;&#x4F7F;&#x7528;&#x73B0;&#x6709;&#x7684;&#x6216;&#x8005;&#x81EA;&#x5DF1;&#x7F16;&#x5199;&#x7684;&#x63D2;&#x4EF6;&#x53EF;&#x4EE5;&#x7EC4;&#x6210;&#x4E00;&#x4E2A;&#x8F6C;&#x6362;&#x901A;&#x9053;&#xFF0C;<code>Babel</code> &#x7684;&#x63D2;&#x4EF6;&#x5206;&#x4E3A;&#x4E24;&#x79CD;: &#x8BED;&#x6CD5;&#x63D2;&#x4EF6;&#x548C;&#x8F6C;&#x6362;&#x63D2;&#x4EF6;&#x3002;</p>
<blockquote>
<p>&#x8BED;&#x6CD5;&#x63D2;&#x4EF6;</p>
</blockquote>
<p>&#x8FD9;&#x4E9B;&#x63D2;&#x4EF6;&#x53EA;&#x5141;&#x8BB8; <code>Babel</code> <strong>&#x89E3;&#x6790;&#xFF08;parse&#xFF09;</strong> &#x7279;&#x5B9A;&#x7C7B;&#x578B;&#x7684;&#x8BED;&#x6CD5;&#xFF08;&#x4E0D;&#x662F;&#x8F6C;&#x6362;&#xFF09;&#xFF0C;&#x53EF;&#x4EE5;&#x5728; <code>AST</code> &#x8F6C;&#x6362;&#x65F6;&#x4F7F;&#x7528;&#xFF0C;&#x4EE5;&#x652F;&#x6301;&#x89E3;&#x6790;&#x65B0;&#x8BED;&#x6CD5;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">js&#x590D;&#x5236;&#x4EE3;&#x7801;import&#xA0;*&#xA0;as&#xA0;babel&#xA0;from&#xA0;&quot;@babel/core&quot;;  </span><br><span class="line">const&#xA0;code&#xA0;=&#xA0;babel.transformFromAstSync(ast,&#xA0;{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;//&#x652F;&#x6301;&#x53EF;&#x9009;&#x94FE;  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;plugins:&#xA0;[&quot;@babel/plugin-proposal-optional-chaining&quot;],  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;babelrc:&#xA0;false  </span><br><span class="line">}).code;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&#x8F6C;&#x6362;&#x63D2;&#x4EF6;</p>
</blockquote>
<p>&#x8F6C;&#x6362;&#x63D2;&#x4EF6;&#x4F1A;&#x542F;&#x7528;&#x76F8;&#x5E94;&#x7684;&#x8BED;&#x6CD5;&#x63D2;&#x4EF6;(&#x56E0;&#x6B64;&#x4E0D;&#x9700;&#x8981;&#x540C;&#x65F6;&#x6307;&#x5B9A;&#x8FD9;&#x4E24;&#x79CD;&#x63D2;&#x4EF6;)&#xFF0C;&#x8FD9;&#x70B9;&#x5F88;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x542F;&#x7528;&#x76F8;&#x5E94;&#x7684;&#x8BED;&#x6CD5;&#x63D2;&#x4EF6;&#xFF0C;&#x610F;&#x5473;&#x7740;&#x65E0;&#x6CD5;&#x89E3;&#x6790;&#xFF0C;&#x8FDE;&#x89E3;&#x6790;&#x90FD;&#x4E0D;&#x80FD;&#x89E3;&#x6790;&#xFF0C;&#x53C8;&#x4F55;&#x8C08;&#x8F6C;&#x6362;&#x5462;&#xFF1F;</p>
<h4 id="&#x63D2;&#x4EF6;&#x7684;&#x4F7F;&#x7528;"><a href="#&#x63D2;&#x4EF6;&#x7684;&#x4F7F;&#x7528;" class="headerlink" title="&#x63D2;&#x4EF6;&#x7684;&#x4F7F;&#x7528;"></a>&#x63D2;&#x4EF6;&#x7684;&#x4F7F;&#x7528;</h4><p>&#x5982;&#x679C;&#x63D2;&#x4EF6;&#x53D1;&#x5E03;&#x5728; <code>npm</code> &#x4E0A;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x586B;&#x5199;&#x63D2;&#x4EF6;&#x7684;&#x540D;&#x79F0;&#xFF0C; <code>Babel</code> &#x4F1A;&#x81EA;&#x52A8;&#x68C0;&#x67E5;&#x5B83;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x88AB;&#x5B89;&#x88C5;&#x5728; <code>node_modules</code> &#x76EE;&#x5F55;&#x4E0B;&#xFF0C;&#x5728;&#x9879;&#x76EE;&#x76EE;&#x5F55;&#x4E0B;&#x65B0;&#x5EFA; <code>.babelrc</code> &#x6587;&#x4EF6; (&#x4E0B;&#x6587;&#x4F1A;&#x5177;&#x4F53;&#x4ECB;&#x7ECD;&#x914D;&#x7F6E;&#x6587;&#x4EF6;)&#xFF0C;&#x914D;&#x7F6E;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">json&#x590D;&#x5236;&#x4EE3;&#x7801;//.babelrc  </span><br><span class="line">{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&quot;plugins&quot;:&#xA0;[&quot;@babel/plugin-transform-arrow-functions&quot;]  </span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4E5F;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x63D2;&#x4EF6;&#x7684;&#x76F8;&#x5BF9;/&#x7EDD;&#x5BF9;&#x8DEF;&#x5F84;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">json&#x590D;&#x5236;&#x4EE3;&#x7801;{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&quot;plugins&quot;:&#xA0;[&quot;./node_modules/@babel/plugin-transform-arrow-functions&quot;]  </span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x6267;&#x884C; <code>npm run compiler</code>&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x7BAD;&#x5934;&#x51FD;&#x6570;&#x5DF2;&#x7ECF;&#x88AB;&#x7F16;&#x8BD1;OK&#xFF0C; <code>lib/index.js</code> &#x5185;&#x5BB9;&#x5982;&#x4E0B;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">js&#x590D;&#x5236;&#x4EE3;&#x7801;const&#xA0;fn&#xA0;=&#xA0;function&#xA0;()&#xA0;{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;console.log(&apos;a&apos;);  </span><br><span class="line">};</span><br></pre></td></tr></table></figure>

<p>&#x73B0;&#x5728;&#xFF0C;&#x6211;&#x4EEC;&#x4EC5;&#x652F;&#x6301;&#x8F6C;&#x6362;&#x7BAD;&#x5934;&#x51FD;&#x6570;&#xFF0C;&#x5982;&#x679C;&#x60F3;&#x5C06;&#x5176;&#x5B83;&#x7684;&#x65B0;&#x7684;JS&#x7279;&#x6027;&#x8F6C;&#x6362;&#x6210;&#x4F4E;&#x7248;&#x672C;&#xFF0C;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x5176;&#x5B83;&#x5BF9;&#x5E94;&#x7684; <code>plugin</code> &#x3002;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x4E00;&#x4E2A;&#x4E2A;&#x914D;&#x7F6E;&#x7684;&#x8BDD;&#xFF0C;&#x4F1A;&#x975E;&#x5E38;&#x7E41;&#x7410;&#xFF0C;&#x56E0;&#x4E3A;&#x4F60;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x914D;&#x7F6E;&#x51E0;&#x5341;&#x4E2A;&#x63D2;&#x4EF6;&#xFF0C;&#x8FD9;&#x663E;&#x7136;&#x975E;&#x5E38;&#x4E0D;&#x4FBF;&#xFF0C;&#x90A3;&#x4E48;&#x6709;&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x529E;&#x6CD5;&#x53EF;&#x4EE5;&#x7B80;&#x5316;&#x8FD9;&#x4E2A;&#x914D;&#x7F6E;&#x5462;&#xFF1F;</p>
<p>&#x6709;&#xFF01;&#x9884;&#x8BBE;&#xFF01;(&#x611F;&#x8C22;&#x5F3A;&#x5927;&#x7684; <code>Babel</code>)</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/c54521be90e05df1e12b57e7609012e06ca3bb40958f509bdafdbfbbf9abe8d3" alt></p>
<h3 id="&#x9884;&#x8BBE;"><a href="#&#x9884;&#x8BBE;" class="headerlink" title="&#x9884;&#x8BBE;"></a>&#x9884;&#x8BBE;</h3><p>&#x901A;&#x8FC7;&#x4F7F;&#x7528;&#x6216;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; <code>preset</code> &#x5373;&#x53EF;<strong>&#x8F7B;&#x677E;</strong>&#x4F7F;&#x7528;&#x4E00;&#x7EC4;&#x63D2;&#x4EF6;&#x3002;</p>
<blockquote>
<p>&#x5B98;&#x65B9; Preset</p>
</blockquote>
<ul>
<li>@babel/preset-env</li>
<li>@babel/preset-flow</li>
<li>@babel/preset-react</li>
<li>@babel/preset-typescript</li>
</ul>
<p><strong>&#x6CE8;:</strong> &#x4ECE; Babel v7 &#x5F00;&#x59CB;&#xFF0C;&#x6240;&#x6709;&#x9488;&#x5BF9;&#x6807;&#x51C6;&#x63D0;&#x6848;&#x9636;&#x6BB5;&#x7684;&#x529F;&#x80FD;&#x6240;&#x7F16;&#x5199;&#x7684;&#x9884;&#x8BBE;(stage preset)&#x90FD;&#x5DF2;&#x88AB;&#x5F03;&#x7528;&#xFF0C;&#x5B98;&#x65B9;&#x5DF2;&#x7ECF;&#x79FB;&#x9664;&#x4E86; <code>@babel/preset-stage-x</code>&#x3002;</p>
<h4 id="babel-preset-env"><a href="#babel-preset-env" class="headerlink" title="@babel/preset-env"></a>@babel/preset-env</h4><p><code>@babel/preset-env</code> &#x4E3B;&#x8981;&#x4F5C;&#x7528;&#x662F;&#x5BF9;&#x6211;&#x4EEC;&#x6240;&#x4F7F;&#x7528;&#x7684;&#x5E76;&#x4E14;&#x76EE;&#x6807;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x7F3A;&#x5931;&#x7684;&#x529F;&#x80FD;&#x8FDB;&#x884C;&#x4EE3;&#x7801;&#x8F6C;&#x6362;&#x548C;&#x52A0;&#x8F7D; <code>polyfill</code>&#xFF0C;&#x5728;&#x4E0D;&#x8FDB;&#x884C;&#x4EFB;&#x4F55;&#x914D;&#x7F6E;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;<code>@babel/preset-env</code> &#x6240;&#x5305;&#x542B;&#x7684;&#x63D2;&#x4EF6;&#x5C06;&#x652F;&#x6301;&#x6240;&#x6709;&#x6700;&#x65B0;&#x7684;JS&#x7279;&#x6027;(ES2015,ES2016&#x7B49;&#xFF0C;&#x4E0D;&#x5305;&#x542B; stage &#x9636;&#x6BB5;)&#xFF0C;&#x5C06;&#x5176;&#x8F6C;&#x6362;&#x6210;ES5&#x4EE3;&#x7801;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x7684;&#x4EE3;&#x7801;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;&#x53EF;&#x9009;&#x94FE;(&#x76EE;&#x524D;&#xFF0C;&#x4ECD;&#x5728; stage &#x9636;&#x6BB5;)&#xFF0C;&#x90A3;&#x4E48;&#x53EA;&#x914D;&#x7F6E; <code>@babel/preset-env</code>&#xFF0C;&#x8F6C;&#x6362;&#x65F6;&#x4F1A;&#x629B;&#x51FA;&#x9519;&#x8BEF;&#xFF0C;&#x9700;&#x8981;&#x53E6;&#x5916;&#x5B89;&#x88C5;&#x76F8;&#x5E94;&#x7684;&#x63D2;&#x4EF6;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">json&#x590D;&#x5236;&#x4EE3;&#x7801;//.babelrc  </span><br><span class="line">{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&quot;presets&quot;:&#xA0;[&quot;@babel/preset-env&quot;]  </span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x9700;&#x8981;&#x8BF4;&#x660E;&#x7684;&#x662F;&#xFF0C;<code>@babel/preset-env</code> &#x4F1A;&#x6839;&#x636E;&#x4F60;&#x914D;&#x7F6E;&#x7684;&#x76EE;&#x6807;&#x73AF;&#x5883;&#xFF0C;&#x751F;&#x6210;&#x63D2;&#x4EF6;&#x5217;&#x8868;&#x6765;&#x7F16;&#x8BD1;&#x3002;&#x5BF9;&#x4E8E;&#x57FA;&#x4E8E;&#x6D4F;&#x89C8;&#x5668;&#x6216; <code>Electron</code> &#x7684;&#x9879;&#x76EE;&#xFF0C;&#x5B98;&#x65B9;&#x63A8;&#x8350;&#x4F7F;&#x7528; <code>.browserslistrc</code> &#x6587;&#x4EF6;&#x6765;&#x6307;&#x5B9A;&#x76EE;&#x6807;&#x73AF;&#x5883;&#x3002;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x6CA1;&#x6709;&#x5728; <code>Babel</code> &#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;(&#x5982; .babelrc)&#x8BBE;&#x7F6E; <code>targets</code> &#x6216; <code>ignoreBrowserslistConfig</code>&#xFF0C;<code>@babel/preset-env</code> &#x4F1A;&#x4F7F;&#x7528; <code>browserslist</code> &#x914D;&#x7F6E;&#x6E90;&#x3002;</p>
<p>&#x5982;&#x679C;&#x4F60;&#x4E0D;&#x662F;&#x8981;&#x517C;&#x5BB9;&#x6240;&#x6709;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#x548C;&#x73AF;&#x5883;&#xFF0C;&#x63A8;&#x8350;&#x4F60;&#x6307;&#x5B9A;&#x76EE;&#x6807;&#x73AF;&#x5883;&#xFF0C;&#x8FD9;&#x6837;&#x4F60;&#x7684;&#x7F16;&#x8BD1;&#x4EE3;&#x7801;&#x80FD;&#x591F;&#x4FDD;&#x6301;&#x6700;&#x5C0F;&#x3002;</p>
<p>&#x4F8B;&#x5982;&#xFF0C;&#x4EC5;&#x5305;&#x62EC;&#x6D4F;&#x89C8;&#x5668;&#x5E02;&#x573A;&#x4EFD;&#x989D;&#x8D85;&#x8FC7;0.25&#xFF05;&#x7684;&#x7528;&#x6237;&#x6240;&#x9700;&#x7684; <code>polyfill</code> &#x548C;&#x4EE3;&#x7801;&#x8F6C;&#x6362;&#xFF08;&#x5FFD;&#x7565;&#x6CA1;&#x6709;&#x5B89;&#x5168;&#x66F4;&#x65B0;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#xFF0C;&#x5982; IE10 &#x548C; BlackBerry&#xFF09;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">json&#x590D;&#x5236;&#x4EE3;&#x7801;//.browserslistrc  </span><br><span class="line">&gt;&#xA0;0.25%  </span><br><span class="line">not&#xA0;dead</span><br></pre></td></tr></table></figure>

<p>&#x67E5;&#x770B; <a href="/external_links/7338720e55793abf7360ae138010191b.html" target="blank" rel="noopener"><code>browserslist</code> &#x7684;&#x66F4;&#x591A;&#x914D;&#x7F6E;</a></p>
<p>&#x4F8B;&#x5982;&#xFF0C;&#x4F60;&#x5C06; <code>.browserslistrc</code> &#x7684;&#x5185;&#x5BB9;&#x914D;&#x7F6E;&#x4E3A;: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">json&#x590D;&#x5236;&#x4EE3;&#x7801;last&#xA0;2&#xA0;Chrome&#xA0;versions</span><br></pre></td></tr></table></figure>

<p>&#x7136;&#x540E;&#x518D;&#x6267;&#x884C; <code>npm run compiler</code>&#xFF0C;&#x4F60;&#x4F1A;&#x53D1;&#x73B0;&#x7BAD;&#x5934;&#x51FD;&#x6570;&#x4E0D;&#x4F1A;&#x88AB;&#x7F16;&#x8BD1;&#x6210;ES5&#xFF0C;&#x56E0;&#x4E3A; <code>chrome</code> &#x7684;&#x6700;&#x65B0;2&#x4E2A;&#x7248;&#x672C;&#x90FD;&#x80FD;&#x591F;&#x652F;&#x6301;&#x7BAD;&#x5934;&#x51FD;&#x6570;&#x3002;&#x73B0;&#x5728;&#xFF0C;&#x6211;&#x4EEC;&#x5C06; <code>.browserslistrc</code> &#x4ECD;&#x7136;&#x6362;&#x6210;&#x4E4B;&#x524D;&#x7684;&#x914D;&#x7F6E;&#x3002;</p>
<p>&#x5C31;&#x54B1;&#x4EEC;&#x76EE;&#x524D;&#x7684;&#x4EE3;&#x7801;&#x6765;&#x8BF4;&#xFF0C;&#x5F53;&#x524D;&#x7684;&#x914D;&#x7F6E;&#x4F3C;&#x4E4E;&#x5DF2;&#x7ECF;&#x662F;OK&#x7684;&#x4E86;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/0f039575697141fdebefb018ecaf3bbcf0c99662b0a4300789f6564f685f95a8" alt></p>
<p>&#x6211;&#x4EEC;&#x4FEE;&#x6539;&#x4E0B; <code>src/index.js</code>&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">js&#x590D;&#x5236;&#x4EE3;&#x7801;const&#xA0;isHas&#xA0;=&#xA0;[1,2,3].includes(2);  </span><br><span class="line">  </span><br><span class="line">const&#xA0;p&#xA0;=&#xA0;new&#xA0;Promise((resolve,&#xA0;reject)&#xA0;=&gt;&#xA0;{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;resolve(100);  </span><br><span class="line">});</span><br></pre></td></tr></table></figure>

<p>&#x7F16;&#x8BD1;&#x51FA;&#x6765;&#x7684;&#x7ED3;&#x679C;&#x4E3A;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">js&#x590D;&#x5236;&#x4EE3;&#x7801;&quot;use&#xA0;strict&quot;;  </span><br><span class="line">  </span><br><span class="line">var&#xA0;isHas&#xA0;=&#xA0;[1,&#xA0;2,&#xA0;3].includes(2);  </span><br><span class="line">var&#xA0;p&#xA0;=&#xA0;new&#xA0;Promise(function&#xA0;(resolve,&#xA0;reject)&#xA0;{  </span><br><span class="line">&#xA0;&#xA0;resolve(100);  </span><br><span class="line">});</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x4E2A;&#x7F16;&#x8BD1;&#x51FA;&#x6765;&#x7684;&#x4EE3;&#x7801;&#x5728;&#x4F4E;&#x7248;&#x672C;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x4F7F;&#x7528;&#x7684;&#x8BDD;&#xFF0C;&#x663E;&#x7136;&#x662F;&#x6709;&#x95EE;&#x9898;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x4F4E;&#x7248;&#x672C;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x6570;&#x7EC4;&#x5B9E;&#x4F8B;&#x4E0A;&#x6CA1;&#x6709; <code>includes</code> &#x65B9;&#x6CD5;&#xFF0C;&#x4E5F;&#x6CA1;&#x6709; <code>Promise</code> &#x6784;&#x9020;&#x51FD;&#x6570;&#x3002;</p>
<p>&#x8FD9;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;&#x56E0;&#x4E3A;&#x8BED;&#x6CD5;&#x8F6C;&#x6362;&#x53EA;&#x662F;&#x5C06;&#x9AD8;&#x7248;&#x672C;&#x7684;&#x8BED;&#x6CD5;&#x8F6C;&#x6362;&#x6210;&#x4F4E;&#x7248;&#x672C;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x65B0;&#x7684;&#x5185;&#x7F6E;&#x51FD;&#x6570;&#x3001;&#x5B9E;&#x4F8B;&#x65B9;&#x6CD5;&#x65E0;&#x6CD5;&#x8F6C;&#x6362;&#x3002;&#x8FD9;&#x65F6;&#xFF0C;&#x5C31;&#x9700;&#x8981;&#x4F7F;&#x7528; <code>polyfill</code> &#x4E0A;&#x573A;&#x4E86;&#xFF0C;&#x987E;&#x540D;&#x601D;&#x4E49;&#xFF0C;<code>polyfill</code>&#x7684;&#x4E2D;&#x6587;&#x610F;&#x601D;&#x662F;&#x57AB;&#x7247;&#xFF0C;&#x6240;&#x8C13;&#x57AB;&#x7247;&#x5C31;&#x662F;&#x57AB;&#x5E73;&#x4E0D;&#x540C;&#x6D4F;&#x89C8;&#x5668;&#x6216;&#x8005;&#x4E0D;&#x540C;&#x73AF;&#x5883;&#x4E0B;&#x7684;&#x5DEE;&#x5F02;&#xFF0C;&#x8BA9;&#x65B0;&#x7684;&#x5185;&#x7F6E;&#x51FD;&#x6570;&#x3001;&#x5B9E;&#x4F8B;&#x65B9;&#x6CD5;&#x7B49;&#x5728;&#x4F4E;&#x7248;&#x672C;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/bb28b3c39b8d8bfec4f935dd0c3b2e122d79f9ea259bbdc38f03affdd3e18d70" alt></p>
<h3 id="Polyfill"><a href="#Polyfill" class="headerlink" title="Polyfill"></a>Polyfill</h3><p><code>@babel/polyfill</code> &#x6A21;&#x5757;&#x5305;&#x62EC; <code>core-js</code> &#x548C;&#x4E00;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x7684; <code>regenerator runtime</code> &#x6A21;&#x5757;&#xFF0C;&#x53EF;&#x4EE5;&#x6A21;&#x62DF;&#x5B8C;&#x6574;&#x7684; ES2015+ &#x73AF;&#x5883;&#xFF08;&#x4E0D;&#x5305;&#x542B;&#x7B2C;4&#x9636;&#x6BB5;&#x524D;&#x7684;&#x63D0;&#x8BAE;&#xFF09;&#x3002;</p>
<p>&#x8FD9;&#x610F;&#x5473;&#x7740;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x8BF8;&#x5982; <code>Promise</code> &#x548C; <code>WeakMap</code> &#x4E4B;&#x7C7B;&#x7684;&#x65B0;&#x7684;&#x5185;&#x7F6E;&#x7EC4;&#x4EF6;&#x3001; <code>Array.from</code> &#x6216; <code>Object.assign</code> &#x4E4B;&#x7C7B;&#x7684;&#x9759;&#x6001;&#x65B9;&#x6CD5;&#x3001;<code>Array.prototype.includes</code> &#x4E4B;&#x7C7B;&#x7684;&#x5B9E;&#x4F8B;&#x65B9;&#x6CD5;&#x4EE5;&#x53CA;&#x751F;&#x6210;&#x5668;&#x51FD;&#x6570;(&#x524D;&#x63D0;&#x662F;&#x4F7F;&#x7528;&#x4E86; <code>@babel/plugin-transform-regenerator</code> &#x63D2;&#x4EF6;)&#x3002;&#x4E3A;&#x4E86;&#x6DFB;&#x52A0;&#x8FD9;&#x4E9B;&#x529F;&#x80FD;&#xFF0C;<code>polyfill</code> &#x5C06;&#x6DFB;&#x52A0;&#x5230;&#x5168;&#x5C40;&#x8303;&#x56F4;&#x548C;&#x7C7B;&#x4F3C; <code>String</code> &#x8FD9;&#x6837;&#x7684;&#x5185;&#x7F6E;&#x539F;&#x578B;&#x4E2D;(&#x4F1A;&#x5BF9;&#x5168;&#x5C40;&#x73AF;&#x5883;&#x9020;&#x6210;&#x6C61;&#x67D3;&#xFF0C;&#x540E;&#x9762;&#x6211;&#x4EEC;&#x4F1A;&#x4ECB;&#x7ECD;&#x4E0D;&#x6C61;&#x67D3;&#x5168;&#x5C40;&#x73AF;&#x5883;&#x7684;&#x65B9;&#x6CD5;)&#x3002;</p>
<p>&#x8865;&#x5145;&#x8BF4;&#x660E; (2020/01/07)&#xFF1A;V7.4.0 &#x7248;&#x672C;&#x5F00;&#x59CB;&#xFF0C;<code>@babel/polyfill</code> &#x5DF2;&#x7ECF;&#x88AB;&#x5E9F;&#x5F03;(&#x524D;&#x7AEF;&#x53D1;&#x5C55;&#x65E5;&#x65B0;&#x6708;&#x5F02;)&#xFF0C;&#x9700;&#x5355;&#x72EC;&#x5B89;&#x88C5; <code>core-js</code> &#x548C; <code>regenerator-runtime</code> &#x6A21;&#x5757;&#x3002;</p>
<p>&#x9996;&#x5148;&#xFF0C;&#x5B89;&#x88C5; <code>@babel/polyfill</code> &#x4F9D;&#x8D56;: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&#x590D;&#x5236;&#x4EE3;&#x7801;npm&#xA0;install&#xA0;--save&#xA0;@babel/polyfill</span><br></pre></td></tr></table></figure>

<p>&#x6CE8;&#x610F;&#xFF1A;&#x4E0D;&#x4F7F;&#x7528; <code>--save-dev</code>&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x9700;&#x8981;&#x5728;&#x6E90;&#x7801;&#x4E4B;&#x524D;&#x8FD0;&#x884C;&#x7684;&#x57AB;&#x7247;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5C06;&#x5B8C;&#x6574;&#x7684; <code>polyfill</code> &#x5728;&#x4EE3;&#x7801;&#x4E4B;&#x524D;&#x52A0;&#x8F7D;&#xFF0C;&#x4FEE;&#x6539;&#x6211;&#x4EEC;&#x7684; <code>src/index.js</code>: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">js&#x590D;&#x5236;&#x4EE3;&#x7801;import&#xA0;&apos;@babel/polyfill&apos;;  </span><br><span class="line">  </span><br><span class="line">const&#xA0;isHas&#xA0;=&#xA0;[1,2,3].includes(2);  </span><br><span class="line">  </span><br><span class="line">const&#xA0;p&#xA0;=&#xA0;new&#xA0;Promise((resolve,&#xA0;reject)&#xA0;=&gt;&#xA0;{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;resolve(100);  </span><br><span class="line">});</span><br></pre></td></tr></table></figure>

<p><code>@babel/polyfill</code> &#x9700;&#x8981;&#x5728;&#x5176;&#x5B83;&#x4EE3;&#x7801;&#x4E4B;&#x524D;&#x5F15;&#x5165;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x5728; <code>webpack</code> &#x4E2D;&#x8FDB;&#x884C;&#x914D;&#x7F6E;&#x3002;</p>
<p>&#x4F8B;&#x5982;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">js&#x590D;&#x5236;&#x4EE3;&#x7801;entry:&#xA0;[  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;require.resolve(&apos;./polyfills&apos;),  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;path.resolve(&apos;./index&apos;)  </span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p><code>polyfills.js</code> &#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x5982;&#x4E0B;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">js&#x590D;&#x5236;&#x4EE3;&#x7801;//&#x5F53;&#x7136;&#xFF0C;&#x8FD8;&#x53EF;&#x80FD;&#x6709;&#x4E00;&#x4E9B;&#x5176;&#x5B83;&#x7684;&#xA0;polyfill&#xFF0C;&#x4F8B;&#x5982;&#xA0;stage&#xA0;4&#x4E4B;&#x524D;&#x7684;&#x4E00;&#x4E9B;&#xA0;polyfill  </span><br><span class="line">import&#xA0;&apos;@babel/polyfill&apos;;</span><br></pre></td></tr></table></figure>

<p>&#x73B0;&#x5728;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x4EE3;&#x7801;&#x4E0D;&#x7BA1;&#x5728;&#x4F4E;&#x7248;&#x672C;&#x8FD8;&#x662F;&#x9AD8;&#x7248;&#x672C;&#x6D4F;&#x89C8;&#x5668;(&#x6216;node&#x73AF;&#x5883;)&#x4E2D;&#x90FD;&#x80FD;&#x6B63;&#x5E38;&#x8FD0;&#x884C;&#x4E86;&#x3002;&#x4E0D;&#x8FC7;&#xFF0C;&#x5F88;&#x591A;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x672A;&#x5FC5;&#x9700;&#x8981;&#x5B8C;&#x6574;&#x7684; <code>@babel/polyfill</code>&#xFF0C;&#x8FD9;&#x4F1A;&#x5BFC;&#x81F4;&#x6211;&#x4EEC;&#x6700;&#x7EC8;&#x6784;&#x5EFA;&#x51FA;&#x7684;&#x5305;&#x7684;&#x4F53;&#x79EF;&#x589E;&#x5927;&#xFF0C;<code>@babel/polyfill</code>&#x7684;&#x5305;&#x5927;&#x5C0F;&#x4E3A;89K (&#x5F53;&#x524D; <code>@babel/polyfill</code> &#x7248;&#x672C;&#x4E3A; 7.7.0)&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x66F4;&#x671F;&#x671B;&#x7684;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4F7F;&#x7528;&#x4E86;&#x67D0;&#x4E2A;&#x65B0;&#x7279;&#x6027;&#xFF0C;&#x518D;&#x5F15;&#x5165;&#x5BF9;&#x5E94;&#x7684; <code>polyfill</code>&#xFF0C;&#x907F;&#x514D;&#x5F15;&#x5165;&#x65E0;&#x7528;&#x7684;&#x4EE3;&#x7801;&#x3002;</p>
<p>&#x503C;&#x5F97;&#x5E86;&#x5E78;&#x7684;&#x662F;&#xFF0C; <code>Babel</code> &#x5DF2;&#x7ECF;&#x8003;&#x8651;&#x5230;&#x4E86;&#x8FD9;&#x4E00;&#x70B9;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/e6a9dfd0145a9ac282aa8e76fc0b2c797dcd1db87e8133f187a2ec4fa8b11740" alt></p>
<p><code>@babel/preset-env</code> &#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A; <code>useBuiltIns</code> &#x53C2;&#x6570;&#xFF0C;&#x8BBE;&#x7F6E;&#x503C;&#x4E3A; <code>usage</code> &#x65F6;&#xFF0C;&#x5C31;&#x53EA;&#x4F1A;&#x5305;&#x542B;&#x4EE3;&#x7801;&#x9700;&#x8981;&#x7684; <code>polyfill</code> &#x3002;&#x6709;&#x4E00;&#x70B9;&#x9700;&#x8981;&#x6CE8;&#x610F;&#xFF1A;&#x914D;&#x7F6E;&#x6B64;&#x53C2;&#x6570;&#x7684;&#x503C;&#x4E3A; <code>usage</code> &#xFF0C;&#x5FC5;&#x987B;&#x8981;&#x540C;&#x65F6;&#x8BBE;&#x7F6E; <code>corejs</code> (&#x5982;&#x679C;&#x4E0D;&#x8BBE;&#x7F6E;&#xFF0C;&#x4F1A;&#x7ED9;&#x51FA;&#x8B66;&#x544A;&#xFF0C;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x201D;corejs&#x201D;: 2) &#xFF0C;&#x6CE8;&#x610F;: &#x8FD9;&#x91CC;&#x4ECD;&#x7136;&#x9700;&#x8981;&#x5B89;&#x88C5; <code>@babel/polyfill</code>(&#x5F53;&#x524D; <code>@babel/polyfill</code> &#x7248;&#x672C;&#x9ED8;&#x8BA4;&#x4F1A;&#x5B89;&#x88C5; &#x201C;corejs&#x201D;: 2):</p>
<p>&#x9996;&#x5148;&#x8BF4;&#x4E00;&#x4E0B;&#x4F7F;&#x7528; <code>core-js@3</code> &#x7684;&#x539F;&#x56E0;&#xFF0C;<code>core-js@2</code> &#x5206;&#x652F;&#x4E2D;&#x5DF2;&#x7ECF;&#x4E0D;&#x4F1A;&#x518D;&#x6DFB;&#x52A0;&#x65B0;&#x7279;&#x6027;&#xFF0C;&#x65B0;&#x7279;&#x6027;&#x90FD;&#x4F1A;&#x6DFB;&#x52A0;&#x5230; <code>core-js@3</code>&#x3002;&#x4F8B;&#x5982;&#x4F60;&#x4F7F;&#x7528;&#x4E86; <code>Array.prototype.flat()</code>&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x4F7F;&#x7528;&#x7684;&#x662F; <code>core-js@2</code>&#xFF0C;&#x90A3;&#x4E48;&#x5176;&#x4E0D;&#x5305;&#x542B;&#x6B64;&#x65B0;&#x7279;&#x6027;&#x3002;&#x4E3A;&#x4E86;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x66F4;&#x591A;&#x7684;&#x65B0;&#x7279;&#x6027;&#xFF0C;&#x5EFA;&#x8BAE;&#x5927;&#x5BB6;&#x4F7F;&#x7528; <code>core-js@3</code>&#x3002;</p>
<p>&#x5B89;&#x88C5;&#x4F9D;&#x8D56;&#x4F9D;&#x8D56;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&#x590D;&#x5236;&#x4EE3;&#x7801;npm&#xA0;install&#xA0;--save&#xA0;core-js@3</span><br></pre></td></tr></table></figure>

<blockquote>
<p><a href="/external_links/6aa23b443013fb493dfea6c922fdb4d5.html" target="blank" rel="noopener">core-js (&#x70B9;&#x51FB;&#x4E86;&#x89E3;&#x66F4;&#x591A;)</a> : JavaScript &#x7684;&#x6A21;&#x5757;&#x5316;&#x6807;&#x51C6;&#x5E93;&#xFF0C;&#x5305;&#x542B; <code>Promise</code>&#x3001;<code>Symbol</code>&#x3001;<code>Iterator</code>&#x548C;&#x8BB8;&#x591A;&#x5176;&#x4ED6;&#x7684;&#x7279;&#x6027;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x8BA9;&#x4F60;&#x4EC5;&#x52A0;&#x8F7D;&#x5FC5;&#x9700;&#x7684;&#x529F;&#x80FD;&#x3002;</p>
</blockquote>
<p>&#x73B0;&#x5728;&#xFF0C;&#x4FEE;&#x6539; <code>Babel</code> &#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x5982;&#x4E0B;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">js&#x590D;&#x5236;&#x4EE3;&#x7801;//.babelrc  </span><br><span class="line">const&#xA0;presets&#xA0;=&#xA0;[  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;[  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&quot;@babel/env&quot;,  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;{&#xA0;&#xA0;&#xA0;  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&quot;useBuiltIns&quot;:&#xA0;&quot;usage&quot;,  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&quot;corejs&quot;:&#xA0;3  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;]  </span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p><code>Babel</code> &#x4F1A;&#x68C0;&#x67E5;&#x6240;&#x6709;&#x4EE3;&#x7801;&#xFF0C;&#x4EE5;&#x4FBF;&#x67E5;&#x627E;&#x5728;&#x76EE;&#x6807;&#x73AF;&#x5883;&#x4E2D;&#x7F3A;&#x5931;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x7136;&#x540E;&#x4EC5;&#x4EC5;&#x628A;&#x9700;&#x8981;&#x7684; <code>polyfill</code> &#x5305;&#x542B;&#x8FDB;&#x6765;&#x3002;</p>
<p>&#x4F8B;&#x5982;&#xFF0C;<code>src/index.js</code> &#x4EE3;&#x7801;&#x4E0D;&#x53D8;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">js&#x590D;&#x5236;&#x4EE3;&#x7801;const&#xA0;isHas&#xA0;=&#xA0;[1,2,3].includes(2);  </span><br><span class="line">  </span><br><span class="line">const&#xA0;p&#xA0;=&#xA0;new&#xA0;Promise((resolve,&#xA0;reject)&#xA0;=&gt;&#xA0;{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;resolve(100);  </span><br><span class="line">});</span><br></pre></td></tr></table></figure>

<p>&#x6211;&#x4EEC;&#x770B;&#x770B;&#x7F16;&#x8BD1;&#x51FA;&#x6765;&#x7684;&#x6587;&#x4EF6;(<code>lib/index</code>): </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">js&#x590D;&#x5236;&#x4EE3;&#x7801;&quot;use&#xA0;strict&quot;;  </span><br><span class="line">  </span><br><span class="line">require(&quot;core-js/modules/es.array.includes&quot;);  </span><br><span class="line">  </span><br><span class="line">require(&quot;core-js/modules/es.object.to-string&quot;);  </span><br><span class="line">  </span><br><span class="line">require(&quot;core-js/modules/es.promise&quot;);  </span><br><span class="line">  </span><br><span class="line">var&#xA0;isHas&#xA0;=&#xA0;[1,&#xA0;2,&#xA0;3].includes(2);  </span><br><span class="line">var&#xA0;p&#xA0;=&#xA0;new&#xA0;Promise(function&#xA0;(resolve,&#xA0;reject)&#xA0;{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;resolve(100);  </span><br><span class="line">});</span><br></pre></td></tr></table></figure>

<p>&#x540C;&#x6837;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x6211;&#x4EEC;&#x7528; <code>webpack</code> &#x6784;&#x5EFA;&#x4E00;&#x4E0B;(<code>production</code> &#x6A21;&#x5F0F;)&#xFF0C;&#x80FD;&#x770B;&#x5230;&#x6700;&#x7EC8;&#x7684;&#x4EE3;&#x7801;&#x5927;&#x5C0F;&#x4EC5;&#x4E3A;: 20KB&#x3002;&#x800C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x5F15;&#x5165;&#x6574;&#x4E2A; <code>@babel/polyfill</code> &#x7684;&#x8BDD;&#xFF0C;&#x6784;&#x5EFA;&#x51FA;&#x7684;&#x5305;&#x5927;&#x5C0F;&#x4E3A;&#xFF1A;89KB</p>
<p>&#x524D;&#x9762;&#x66FE;&#x63D0;&#x5230;&#xFF0C;&#x5728; <code>useBuiltIns</code> &#x53C2;&#x6570;&#x503C;&#x4E3A; <code>usage</code> &#x65F6;&#xFF0C;&#x4ECD;&#x7136;&#x9700;&#x8981;&#x5B89;&#x88C5; <code>@babel/polyfill</code>&#xFF0C;&#x867D;&#x7136;&#x6211;&#x4EEC;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x8F6C;&#x6362;&#x4E2D;&#x770B;&#x8D77;&#x6765;&#x5E76;&#x6CA1;&#x6709;&#x4F7F;&#x7528;&#x5230;&#xFF0C;&#x4F46;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x6E90;&#x7801;&#x4E2D;&#x4F7F;&#x7528;&#x5230;&#x4E86; <code>async/await</code>&#xFF0C;&#x90A3;&#x4E48;&#x7F16;&#x8BD1;&#x51FA;&#x6765;&#x7684;&#x4EE3;&#x7801;&#x9700;&#x8981; <code>require(&quot;regenerator-runtime/runtime&quot;)</code>&#xFF0C;&#x5728; <code>@babel/polyfill</code> &#x7684;&#x4F9D;&#x8D56;&#x4E2D;&#xFF0C;&#x5F53;&#x7136;&#x5566;&#xFF0C;&#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x53EA;&#x5B89;&#x88C5; <code>regenerator-runtime/runtime</code> &#x53D6;&#x4EE3;&#x5B89;&#x88C5; <code>@babel/polyfill</code>&#x3002;</p>
<p>&#x5230;&#x4E86;&#x8FD9;&#x4E00;&#x6B65;&#xFF0C;&#x5DF2;&#x7ECF;&#x5F88;&#x68D2;&#x68D2;&#x4E86;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x60F3;&#x8DF3;&#x8D77;&#x6765;&#x8F6C;&#x4E2A;&#x5708;&#x5708;&#xFF1F;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/895651b791da20537cc58f13413f9ec8d95cdece61a26a35038180e731d6c781" alt></p>
<p>&#x4E0B;&#x9762;&#x6211;&#x8981;&#x8BF4;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x4E5F;&#x8BB8;&#x4F60;&#x5DF2;&#x7ECF;&#x77E5;&#x9053;&#xFF0C;&#x4E5F;&#x8BB8;&#x4F60;&#x8FD8;&#x4E0D;&#x77E5;&#x9053;&#xFF0C;&#x8FD9;&#x90FD;&#x4E0D;&#x91CD;&#x8981;&#xFF0C;&#x4F46;&#x662F;&#x6B64;&#x523B;&#x8D77;&#xFF0C;&#x4F60;&#x8981;&#x77E5;&#x9053;&#x4E86;: <code>Babel</code> &#x4F1A;&#x4F7F;&#x7528;&#x5F88;&#x5C0F;&#x7684;&#x8F85;&#x52A9;&#x51FD;&#x6570;&#x6765;&#x5B9E;&#x73B0;&#x7C7B;&#x4F3C; <code>_createClass</code> &#x7B49;&#x516C;&#x5171;&#x65B9;&#x6CD5;&#x3002;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5B83;&#x5C06;&#x88AB;&#x6DFB;&#x52A0;(<code>inject</code>)&#x5230;&#x9700;&#x8981;&#x5B83;&#x7684;&#x6BCF;&#x4E2A;&#x6587;&#x4EF6;&#x4E2D;&#x3002;</p>
<p>&#x5047;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x7684; <code>src/index.js</code> &#x662F;&#x8FD9;&#x6837;&#x7684;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">js&#x590D;&#x5236;&#x4EE3;&#x7801;class&#xA0;Point&#xA0;{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;constructor(x,&#xA0;y)&#xA0;{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;this.x&#xA0;=&#xA0;x;  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;this.y&#xA0;=&#xA0;y;  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;};  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;getX()&#xA0;{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;return&#xA0;this.x;  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;}  </span><br><span class="line">}  </span><br><span class="line">  </span><br><span class="line">let&#xA0;cp&#xA0;=&#xA0;new&#xA0;ColorPoint(25,&#xA0;8);</span><br></pre></td></tr></table></figure>

<p>&#x7F16;&#x8BD1;&#x51FA;&#x6765;&#x7684; <code>lib/index.js</code>&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">js&#x590D;&#x5236;&#x4EE3;&#x7801;&quot;use&#xA0;strict&quot;;  </span><br><span class="line">  </span><br><span class="line">require(&quot;core-js/modules/es.object.define-property&quot;);  </span><br><span class="line">  </span><br><span class="line">function&#xA0;_classCallCheck(instance,&#xA0;Constructor)&#xA0;{&#xA0;if&#xA0;(!(instance&#xA0;instanceof&#xA0;Constructor))&#xA0;{&#xA0;throw&#xA0;new&#xA0;TypeError(&quot;Cannot&#xA0;call&#xA0;a&#xA0;class&#xA0;as&#xA0;a&#xA0;function&quot;);&#xA0;}&#xA0;}  </span><br><span class="line">  </span><br><span class="line">function&#xA0;_defineProperties(target,&#xA0;props)&#xA0;{&#xA0;for&#xA0;(var&#xA0;i&#xA0;=&#xA0;0;&#xA0;i&#xA0;&lt;&#xA0;props.length;&#xA0;i++)&#xA0;{&#xA0;var&#xA0;descriptor&#xA0;=&#xA0;props[i];&#xA0;descriptor.enumerable&#xA0;=&#xA0;descriptor.enumerable&#xA0;||&#xA0;false;&#xA0;descriptor.configurable&#xA0;=&#xA0;true;&#xA0;if&#xA0;(&quot;value&quot;&#xA0;in&#xA0;descriptor)&#xA0;descriptor.writable&#xA0;=&#xA0;true;&#xA0;Object.defineProperty(target,&#xA0;descriptor.key,&#xA0;descriptor);&#xA0;}&#xA0;}  </span><br><span class="line">  </span><br><span class="line">function&#xA0;_createClass(Constructor,&#xA0;protoProps,&#xA0;staticProps)&#xA0;{&#xA0;if&#xA0;(protoProps)&#xA0;_defineProperties(Constructor.prototype,&#xA0;protoProps);&#xA0;if&#xA0;(staticProps)&#xA0;_defineProperties(Constructor,&#xA0;staticProps);&#xA0;return&#xA0;Constructor;&#xA0;}  </span><br><span class="line">  </span><br><span class="line">var&#xA0;Point&#xA0;=  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;/*#__PURE__*/  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;function&#xA0;()&#xA0;{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;function&#xA0;Point(x,&#xA0;y)&#xA0;{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;_classCallCheck(this,&#xA0;Point);  </span><br><span class="line">  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;this.x&#xA0;=&#xA0;x;  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;this.y&#xA0;=&#xA0;y;  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}  </span><br><span class="line">  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;_createClass(Point,&#xA0;[{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;key:&#xA0;&quot;getX&quot;,  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;value:&#xA0;function&#xA0;getX()&#xA0;{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;return&#xA0;this.x;  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}]);  </span><br><span class="line">  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;return&#xA0;Point;  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;}();  </span><br><span class="line">  </span><br><span class="line">var&#xA0;cp&#xA0;=&#xA0;new&#xA0;ColorPoint(25,&#xA0;8);</span><br></pre></td></tr></table></figure>

<p>&#x770B;&#x8D77;&#x6765;&#xFF0C;&#x4F3C;&#x4E4E;&#x5E76;&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#xFF0C;&#x4F46;&#x662F;&#x4F60;&#x60F3;&#x4E00;&#x4E0B;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x6709;10&#x4E2A;&#x6587;&#x4EF6;&#x4E2D;&#x90FD;&#x4F7F;&#x7528;&#x4E86;&#x8FD9;&#x4E2A; <code>class</code>&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x610F;&#x5473;&#x7740; <code>_classCallCheck</code>&#x3001;<code>_defineProperties</code>&#x3001;<code>_createClass</code> &#x8FD9;&#x4E9B;&#x65B9;&#x6CD5;&#x88AB; <code>inject</code> &#x4E86;10&#x6B21;&#x3002;&#x8FD9;&#x663E;&#x7136;&#x4F1A;&#x5BFC;&#x81F4;&#x5305;&#x4F53;&#x79EF;&#x589E;&#x5927;&#xFF0C;&#x6700;&#x5173;&#x952E;&#x7684;&#x662F;&#xFF0C;&#x6211;&#x4EEC;&#x5E76;&#x4E0D;&#x9700;&#x8981;&#x5B83; <code>inject</code> &#x591A;&#x6B21;&#x3002;</p>
<p>&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x662F; <code>@babel/plugin-transform-runtime</code> &#x63D2;&#x4EF6;&#x5927;&#x663E;&#x8EAB;&#x624B;&#x7684;&#x65F6;&#x5019;&#x4E86;&#xFF0C;&#x4F7F;&#x7528; <code>@babel/plugin-transform-runtime</code> &#x63D2;&#x4EF6;&#xFF0C;&#x6240;&#x6709;&#x5E2E;&#x52A9;&#x7A0B;&#x5E8F;&#x90FD;&#x5C06;&#x5F15;&#x7528;&#x6A21;&#x5757; <code>@babel/runtime</code>&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x53EF;&#x4EE5;&#x907F;&#x514D;&#x7F16;&#x8BD1;&#x540E;&#x7684;&#x4EE3;&#x7801;&#x4E2D;&#x51FA;&#x73B0;&#x91CD;&#x590D;&#x7684;&#x5E2E;&#x52A9;&#x7A0B;&#x5E8F;&#xFF0C;&#x6709;&#x6548;&#x51CF;&#x5C11;&#x5305;&#x4F53;&#x79EF;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/3f378277183eade13455c37db6555e5ded9da32bf1bd21aef752b2327d776ddb" alt></p>
<h3 id="babel-plugin-transform-runtime"><a href="#babel-plugin-transform-runtime" class="headerlink" title="@babel/plugin-transform-runtime"></a>@babel/plugin-transform-runtime</h3><p><code>@babel/plugin-transform-runtime</code> &#x662F;&#x4E00;&#x4E2A;&#x53EF;&#x4EE5;&#x91CD;&#x590D;&#x4F7F;&#x7528; <code>Babel</code> &#x6CE8;&#x5165;&#x7684;&#x5E2E;&#x52A9;&#x7A0B;&#x5E8F;&#xFF0C;&#x4EE5;&#x8282;&#x7701;&#x4EE3;&#x7801;&#x5927;&#x5C0F;&#x7684;&#x63D2;&#x4EF6;&#x3002;</p>
<blockquote>
<p>&#x6CE8;&#x610F;&#xFF1A;&#x8BF8;&#x5982; <code>Array.prototype.flat()</code> &#x7B49;&#x5B9E;&#x4F8B;&#x65B9;&#x6CD5;&#x5C06;&#x4E0D;&#x8D77;&#x4F5C;&#x7528;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x9700;&#x8981;&#x4FEE;&#x6539;&#x73B0;&#x6709;&#x7684;&#x5185;&#x7F6E;&#x51FD;&#x6570;(&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>@babel/polyfill</code> &#x6765;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;) &#x2014;&#x2014;&gt; &#x5BF9;&#x6B64;&#x9700;&#x8981;&#x8BF4;&#x660E;&#x7684;&#x662F;&#x5982;&#x679C;&#x4F60;&#x914D;&#x7F6E;&#x7684;&#x662F;<code>corejs3</code>&#xFF0C; <strong><code>core-js@3</code> &#x73B0;&#x5728;&#x5DF2;&#x7ECF;&#x652F;&#x6301;&#x539F;&#x578B;&#x65B9;&#x6CD5;&#xFF0C;&#x540C;&#x65F6;&#x4E0D;&#x6C61;&#x67D3;&#x539F;&#x578B;</strong>&#x3002;</p>
</blockquote>
<p>&#x53E6;&#x5916;&#xFF0C;<code>@babel/plugin-transform-runtime</code> &#x9700;&#x8981;&#x548C; <code>@babel/runtime</code> &#x914D;&#x5408;&#x4F7F;&#x7528;&#x3002;</p>
<p>&#x9996;&#x5148;&#x5B89;&#x88C5;&#x4F9D;&#x8D56;&#xFF0C;<code>@babel/plugin-transform-runtime</code> &#x901A;&#x5E38;&#x4EC5;&#x5728;&#x5F00;&#x53D1;&#x65F6;&#x4F7F;&#x7528;&#xFF0C;&#x4F46;&#x662F;&#x8FD0;&#x884C;&#x65F6;&#x6700;&#x7EC8;&#x4EE3;&#x7801;&#x9700;&#x8981;&#x4F9D;&#x8D56; <code>@babel/runtime</code>&#xFF0C;&#x6240;&#x4EE5; <code>@babel/runtime</code> &#x5FC5;&#x987B;&#x8981;&#x4F5C;&#x4E3A;&#x751F;&#x4EA7;&#x4F9D;&#x8D56;&#x88AB;&#x5B89;&#x88C5;&#xFF0C;&#x5982;&#x4E0B; :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell&#x590D;&#x5236;&#x4EE3;&#x7801;npm&#xA0;install&#xA0;--save-dev&#xA0;@babel/plugin-transform-runtime  </span><br><span class="line">npm&#xA0;install&#xA0;--save&#xA0;@babel/runtime</span><br></pre></td></tr></table></figure>

<p>&#x9664;&#x4E86;&#x524D;&#x6587;&#x6240;&#x8BF4;&#x7684;&#xFF0C;<code>@babel/plugin-transform-runtime</code> &#x53EF;&#x4EE5;&#x51CF;&#x5C11;&#x7F16;&#x8BD1;&#x540E;&#x4EE3;&#x7801;&#x7684;&#x4F53;&#x79EF;&#x5916;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x5B83;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x597D;&#x5904;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x4E3A;&#x4EE3;&#x7801;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x6C99;&#x76D2;&#x73AF;&#x5883;&#xFF0C;&#x5982;&#x679C;&#x4F7F;&#x7528; <code>@babel/polyfill</code> &#x53CA;&#x5176;&#x63D0;&#x4F9B;&#x7684;&#x5185;&#x7F6E;&#x7A0B;&#x5E8F;&#xFF08;&#x4F8B;&#x5982; <code>Promise</code> &#xFF0C;<code>Set</code> &#x548C; <code>Map</code> &#xFF09;&#xFF0C;&#x5219;&#x5B83;&#x4EEC;&#x5C06;&#x6C61;&#x67D3;&#x5168;&#x5C40;&#x8303;&#x56F4;&#x3002;&#x867D;&#x7136;&#x8FD9;&#x5BF9;&#x4E8E;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6216;&#x547D;&#x4EE4;&#x884C;&#x5DE5;&#x5177;&#x53EF;&#x80FD;&#x662F;&#x53EF;&#x4EE5;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x5982;&#x679C;&#x4F60;&#x7684;&#x4EE3;&#x7801;&#x662F;&#x8981;&#x53D1;&#x5E03;&#x4F9B;&#x4ED6;&#x4EBA;&#x4F7F;&#x7528;&#x7684;&#x5E93;&#xFF0C;&#x6216;&#x8005;&#x65E0;&#x6CD5;&#x5B8C;&#x5168;&#x63A7;&#x5236;&#x4EE3;&#x7801;&#x8FD0;&#x884C;&#x7684;&#x73AF;&#x5883;&#xFF0C;&#x5219;&#x5C06;&#x6210;&#x4E3A;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#x3002;</p>
<p><code>@babel/plugin-transform-runtime</code> &#x4F1A;&#x5C06;&#x8FD9;&#x4E9B;&#x5185;&#x7F6E;&#x522B;&#x540D;&#x4F5C;&#x4E3A; <code>core-js</code> &#x7684;&#x522B;&#x540D;&#xFF0C;&#x56E0;&#x6B64;&#x60A8;&#x53EF;&#x4EE5;&#x65E0;&#x7F1D;&#x4F7F;&#x7528;&#x5B83;&#x4EEC;&#xFF0C;&#x800C;&#x65E0;&#x9700; <code>polyfill</code>&#x3002;</p>
<p>&#x4FEE;&#x6539; <code>.babelrc</code> &#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x5982;&#x4E0B;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">json&#x590D;&#x5236;&#x4EE3;&#x7801;//.babelrc  </span><br><span class="line">{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&quot;presets&quot;:&#xA0;[  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&quot;@babel/preset-env&quot;,  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&quot;useBuiltIns&quot;:&#xA0;&quot;usage&quot;,  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&quot;corejs&quot;:&#xA0;3  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;]  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;],  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&quot;plugins&quot;:&#xA0;[  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&quot;@babel/plugin-transform-runtime&quot;  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;]  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;]  </span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x91CD;&#x65B0;&#x7F16;&#x8BD1; <code>npm run compiler</code> , &#x73B0;&#x5728;&#xFF0C;&#x7F16;&#x8BD1;&#x51FA;&#x6765;&#x7684;&#x5185;&#x5BB9;&#x4E3A;(<code>lib/index.js</code>):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">js&#x590D;&#x5236;&#x4EE3;&#x7801;&quot;use&#xA0;strict&quot;;  </span><br><span class="line">  </span><br><span class="line">var&#xA0;_interopRequireDefault&#xA0;=&#xA0;require(&quot;@babel/runtime/helpers/interopRequireDefault&quot;);  </span><br><span class="line">  </span><br><span class="line">var&#xA0;_classCallCheck2&#xA0;=&#xA0;_interopRequireDefault(require(&quot;@babel/runtime/helpers/classCallCheck&quot;));  </span><br><span class="line">  </span><br><span class="line">var&#xA0;_createClass2&#xA0;=&#xA0;_interopRequireDefault(require(&quot;@babel/runtime/helpers/createClass&quot;));  </span><br><span class="line">  </span><br><span class="line">var&#xA0;Point&#xA0;=  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;/*#__PURE__*/  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;function&#xA0;()&#xA0;{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;function&#xA0;Point(x,&#xA0;y)&#xA0;{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;(0,&#xA0;_classCallCheck2.default)(this,&#xA0;Point);  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;this.x&#xA0;=&#xA0;x;  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;this.y&#xA0;=&#xA0;y;  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}  </span><br><span class="line">  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;(0,&#xA0;_createClass2.default)(Point,&#xA0;[{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;key:&#xA0;&quot;getX&quot;,  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;value:&#xA0;function&#xA0;getX()&#xA0;{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;return&#xA0;this.x;  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}]);  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;return&#xA0;Point;  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;}();  </span><br><span class="line">  </span><br><span class="line">var&#xA0;cp&#xA0;=&#xA0;new&#xA0;ColorPoint(25,&#xA0;8);</span><br></pre></td></tr></table></figure>

<p>&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x5E2E;&#x52A9;&#x51FD;&#x6570;&#x73B0;&#x5728;&#x4E0D;&#x662F;&#x76F4;&#x63A5;&#x88AB; <code>inject</code> &#x5230;&#x4EE3;&#x7801;&#x4E2D;&#xFF0C;&#x800C;&#x662F;&#x4ECE; <code>@babel/runtime</code> &#x4E2D;&#x5F15;&#x5165;&#x3002;&#x524D;&#x6587;&#x8BF4;&#x4E86;&#x4F7F;&#x7528; <code>@babel/plugin-transform-runtime</code> &#x53EF;&#x4EE5;&#x907F;&#x514D;&#x5168;&#x5C40;&#x6C61;&#x67D3;&#xFF0C;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x770B;&#x662F;&#x5982;&#x4F55;&#x907F;&#x514D;&#x6C61;&#x67D3;&#x7684;&#x3002;</p>
<p>&#x4FEE;&#x6539; <code>src/index.js</code> &#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">js&#x590D;&#x5236;&#x4EE3;&#x7801;let&#xA0;isHas&#xA0;=&#xA0;[1,2,3].includes(2);  </span><br><span class="line">  </span><br><span class="line">new&#xA0;Promise((resolve,&#xA0;reject)&#xA0;=&gt;&#xA0;{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;resolve(100);  </span><br><span class="line">});</span><br></pre></td></tr></table></figure>

<p>&#x7F16;&#x8BD1;&#x51FA;&#x6765;&#x7684;&#x4EE3;&#x7801;&#x5982;&#x4E0B;(<code>lib/index.js</code>):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">js&#x590D;&#x5236;&#x4EE3;&#x7801;&quot;use&#xA0;strict&quot;;  </span><br><span class="line">  </span><br><span class="line">require(&quot;core-js/modules/es.array.includes&quot;);  </span><br><span class="line">  </span><br><span class="line">require(&quot;core-js/modules/es.object.to-string&quot;);  </span><br><span class="line">  </span><br><span class="line">require(&quot;core-js/modules/es.promise&quot;);  </span><br><span class="line">  </span><br><span class="line">var&#xA0;isHas&#xA0;=&#xA0;[1,&#xA0;2,&#xA0;3].includes(2);  </span><br><span class="line">new&#xA0;Promise(function&#xA0;(resolve,&#xA0;reject)&#xA0;{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;resolve(100);  </span><br><span class="line">});</span><br></pre></td></tr></table></figure>

<p><code>Array.prototype</code> &#x4E0A;&#x65B0;&#x589E;&#x4E86; <code>includes</code> &#x65B9;&#x6CD5;&#xFF0C;&#x5E76;&#x4E14;&#x65B0;&#x589E;&#x4E86;&#x5168;&#x5C40;&#x7684; <code>Promise</code> &#x65B9;&#x6CD5;&#xFF0C;&#x6C61;&#x67D3;&#x4E86;&#x5168;&#x5C40;&#x73AF;&#x5883;&#xFF0C;&#x8FD9;&#x8DDF;&#x4E0D;&#x4F7F;&#x7528; <code>@babel/plugin-transform-runtime</code> &#x6CA1;&#x6709;&#x533A;&#x522B;&#x561B;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/2b883eccf780ae0d81233b57ae61fd20d78e971a41d342f3041a0df1f15968a1" alt></p>
<p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x5E0C;&#x671B; <code>@babel/plugin-transform-runtime</code> &#x4E0D;&#x4EC5;&#x4EC5;&#x5904;&#x7406;&#x5E2E;&#x52A9;&#x51FD;&#x6570;&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x80FD;&#x52A0;&#x8F7D; <code>polyfill</code> &#x7684;&#x8BDD;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x7ED9; <code>@babel/plugin-transform-runtime</code> &#x589E;&#x52A0;&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#x3002;</p>
<p>&#x9996;&#x5148;&#x65B0;&#x589E;&#x4F9D;&#x8D56; <code>@babel/runtime-corejs3</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&#x590D;&#x5236;&#x4EE3;&#x7801;npm&#xA0;install&#xA0;@babel/runtime-corejs3&#xA0;--save</span><br></pre></td></tr></table></figure>

<p>&#x4FEE;&#x6539;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x5982;&#x4E0B;(&#x79FB;&#x9664;&#x4E86; <code>@babel/preset-env</code> &#x7684; <code>useBuiltIns</code> &#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x4E0D;&#x7136;&#x4E0D;&#x5C31;&#x91CD;&#x590D;&#x4E86;&#x561B;&#x561B;&#x561B;&#xFF0C;&#x4E0D;&#x4FE1;&#x7684;&#x8BDD;&#xFF0C;&#x4F60;&#x7528; <code>async/await</code> &#x7F16;&#x8BD1;&#x4E0B;&#x8BD5;&#x8BD5;&#x54AF;):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">js&#x590D;&#x5236;&#x4EE3;&#x7801;{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&quot;presets&quot;:&#xA0;[  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&quot;@babel/preset-env&quot;  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;]  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;],  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&quot;plugins&quot;:&#xA0;[  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&quot;@babel/plugin-transform-runtime&quot;,{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&quot;corejs&quot;:&#xA0;3  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;]  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;]  </span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x7136;&#x540E;&#x91CD;&#x65B0;&#x7F16;&#x8BD1;&#xFF0C;&#x770B;&#x4E00;&#x4E0B;&#xFF0C;&#x7F16;&#x8BD1;&#x51FA;&#x6765;&#x7684;&#x7ED3;&#x679C;(<code>lib/index.js</code>): </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">js&#x590D;&#x5236;&#x4EE3;&#x7801;&quot;use&#xA0;strict&quot;;  </span><br><span class="line">  </span><br><span class="line">var&#xA0;_interopRequireDefault&#xA0;=&#xA0;require(&quot;@babel/runtime-corejs3/helpers/interopRequireDefault&quot;);  </span><br><span class="line">  </span><br><span class="line">var&#xA0;_promise&#xA0;=&#xA0;_interopRequireDefault(require(&quot;@babel/runtime-corejs3/core-js-stable/promise&quot;));  </span><br><span class="line">  </span><br><span class="line">var&#xA0;_includes&#xA0;=&#xA0;_interopRequireDefault(require(&quot;@babel/runtime-corejs3/core-js-stable/instance/includes&quot;));  </span><br><span class="line">  </span><br><span class="line">var&#xA0;_context;  </span><br><span class="line">  </span><br><span class="line">var&#xA0;isHas&#xA0;=&#xA0;(0,&#xA0;_includes.default)(_context&#xA0;=&#xA0;[1,&#xA0;2,&#xA0;3]).call(_context,&#xA0;2);  </span><br><span class="line">new&#xA0;_promise.default(function&#xA0;(resolve,&#xA0;reject)&#xA0;{  </span><br><span class="line">&#xA0;&#xA0;resolve(100);  </span><br><span class="line">});</span><br></pre></td></tr></table></figure>

<p>&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x6CA1;&#x6709;&#x76F4;&#x63A5;&#x53BB;&#x4FEE;&#x6539; <code>Array.prototype</code>&#xFF0C;&#x6216;&#x8005;&#x662F;&#x65B0;&#x589E; <code>Promise</code> &#x65B9;&#x6CD5;&#xFF0C;&#x907F;&#x514D;&#x4E86;&#x5168;&#x5C40;&#x6C61;&#x67D3;&#x3002;&#x5982;&#x679C;&#x4E0A;&#x9762; <code>@babel/plugin-transform-runtime</code> &#x914D;&#x7F6E;&#x7684; <code>core-js</code> &#x662F; &#x201C;2&#x201D;&#xFF0C;&#x5176;&#x4E2D;&#x4E0D;&#x5305;&#x542B;&#x5B9E;&#x4F8B;&#x7684; <code>polyfill</code> &#x9700;&#x8981;&#x5355;&#x72EC;&#x5F15;&#x5165;&#x3002;</p>
<blockquote>
<p>&#x5212;&#x91CD;&#x70B9;&#xFF1A;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x914D;&#x7F6E;&#x7684; <code>corejs</code> &#x662F; <code>3</code> &#x7248;&#x672C;&#xFF0C;&#x90A3;&#x4E48;&#x4E0D;&#x7BA1;&#x662F;&#x5B9E;&#x4F8B;&#x65B9;&#x6CD5;&#x8FD8;&#x662F;&#x5168;&#x5C40;&#x65B9;&#x6CD5;&#xFF0C;&#x90FD;&#x4E0D;&#x4F1A;&#x518D;&#x6C61;&#x67D3;&#x5168;&#x5C40;&#x73AF;&#x5883;&#x3002;</p>
</blockquote>
<p>&#x770B;&#x5230;&#x8FD9;&#x91CC;&#xFF0C;&#x4E0D;&#x77E5;&#x9053;&#x5927;&#x5BB6;&#x6709;&#x6CA1;&#x6709;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x7591;&#x95EE;&#xFF1F;&#x7ED9; <code>@babel/plugin-transform-runtime</code> &#x914D;&#x7F6E; <code>corejs</code> &#x662F;&#x5982;&#x6B64;&#x7684;&#x5B8C;&#x7F8E;&#xFF0C;&#x65E2;&#x53EF;&#x4EE5;&#x5C06;&#x5E2E;&#x52A9;&#x51FD;&#x6570;&#x53D8;&#x6210;&#x5F15;&#x7528;&#x7684;&#x5F62;&#x5F0F;&#xFF0C;&#x53C8;&#x53EF;&#x4EE5;&#x52A8;&#x6001;&#x5F15;&#x5165; <code>polyfill</code>&#xFF0C;&#x5E76;&#x4E14;&#x4E0D;&#x4F1A;&#x6C61;&#x67D3;&#x5168;&#x5C40;&#x73AF;&#x5883;&#x3002;&#x4F55;&#x5FC5;&#x8981;&#x7ED9; <code>@babel/preset-env</code> &#x63D0;&#x4F9B; <code>useBuiltIns</code> &#x529F;&#x80FD;&#x5462;&#xFF0C;&#x770B;&#x8D77;&#x6765;&#x4F3C;&#x4E4E;&#x4E0D;&#x9700;&#x8981;&#x5440;&#x3002;</p>
<p>&#x5E26;&#x7740;&#x8FD9;&#x6837;&#x7684;&#x7591;&#x95EE;&#xFF0C;&#x6211;&#x65B0;&#x5EFA;&#x4E86;&#x51E0;&#x4E2A;&#x6587;&#x4EF6;(&#x5185;&#x5BB9;&#x7B80;&#x5355;&#x4E14;&#x57FA;&#x672C;&#x4E00;&#x81F4;&#xFF0C;&#x4F7F;&#x7528;&#x4E86;&#x4E9B;&#x65B0;&#x7279;&#x6027;)&#xFF0C;&#x7136;&#x540E;&#x4F7F;&#x7528; <code>webpack</code> &#x6784;&#x5EFA;&#xFF0C;&#x4EE5;&#x4E0B;&#x662F;&#x6211;&#x5BF9;&#x6BD4;&#x7684;&#x6570;&#x636E;:</p>
<table>
<thead>
<tr>
<th>&#x5E8F;&#x53F7;</th>
<th>.babelrc &#x914D;&#x7F6E;</th>
<th>webpack mode production</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>&#x4E0D;&#x4F7F;&#x7528; <code>@babel/plugin-transform-runtime</code></td>
<td>36KB</td>
</tr>
<tr>
<td>1</td>
<td>&#x4F7F;&#x7528;<code>@babel/plugin-transform-runtime</code>&#xFF0C;&#x5E76;&#x914D;&#x7F6E;&#x53C2;&#x6570; <code>corejs</code>: 3&#x3002;&#x4E0D;&#x4F1A;&#x6C61;&#x67D3;&#x5168;&#x5C40;&#x73AF;&#x5883;</td>
<td>37KB</td>
</tr>
<tr>
<td>2</td>
<td>&#x4F7F;&#x7528;<code>@babel/plugin-transform-runtime</code>&#xFF0C;&#x4E0D;&#x914D;&#x7F6E; <code>corejs</code></td>
<td>22KB</td>
</tr>
</tbody></table>
<p>&#x6211;&#x731C;&#x6D4B;&#x662F; <code>@babel/runtime-corejs3/XXX</code> &#x7684;&#x5305;&#x672C;&#x8EAB;&#x6BD4; <code>core-js/modules/XXX</code> &#x8981;&#x5927;&#x4E00;&#x4E9B;~</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/d4d8414ef1bc418b9a1e3e0f25b8d6bb7b7a5043499d07f8e5b87f678be02223" alt></p>
<h3 id="&#x63D2;&#x4EF6;-&#x9884;&#x8BBE;&#x8865;&#x5145;&#x77E5;&#x8BC6;"><a href="#&#x63D2;&#x4EF6;-&#x9884;&#x8BBE;&#x8865;&#x5145;&#x77E5;&#x8BC6;" class="headerlink" title="&#x63D2;&#x4EF6;/&#x9884;&#x8BBE;&#x8865;&#x5145;&#x77E5;&#x8BC6;"></a>&#x63D2;&#x4EF6;/&#x9884;&#x8BBE;&#x8865;&#x5145;&#x77E5;&#x8BC6;</h3><blockquote>
<p><strong>&#x63D2;&#x4EF6;&#x7684;&#x6392;&#x5217;&#x987A;&#x5E8F;&#x5F88;&#x91CD;&#x8981;&#xFF01;&#xFF01;&#xFF01;</strong></p>
</blockquote>
<p>&#x5982;&#x679C;&#x4E24;&#x4E2A;&#x8F6C;&#x6362;&#x63D2;&#x4EF6;&#x90FD;&#x5C06;&#x5904;&#x7406;&#x201C;&#x7A0B;&#x5E8F;&#xFF08;Program&#xFF09;&#x201D;&#x7684;&#x67D0;&#x4E2A;&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#xFF0C;&#x5219;&#x5C06;&#x6839;&#x636E;&#x8F6C;&#x6362;&#x63D2;&#x4EF6;&#x6216; <code>preset</code> &#x7684;&#x6392;&#x5217;&#x987A;&#x5E8F;&#x4F9D;&#x6B21;&#x6267;&#x884C;&#x3002;</p>
<ul>
<li>&#x63D2;&#x4EF6;&#x5728; Presets &#x524D;&#x8FD0;&#x884C;&#x3002;</li>
<li>&#x63D2;&#x4EF6;&#x987A;&#x5E8F;&#x4ECE;&#x524D;&#x5F80;&#x540E;&#x6392;&#x5217;&#x3002;</li>
<li>Preset &#x987A;&#x5E8F;&#x662F;&#x98A0;&#x5012;&#x7684;&#xFF08;&#x4ECE;&#x540E;&#x5F80;&#x524D;&#xFF09;&#x3002;</li>
</ul>
<p>&#x4F8B;&#x5982;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">json&#x590D;&#x5236;&#x4EE3;&#x7801;{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&quot;plugins&quot;:&#xA0;[&quot;@babel/plugin-proposal-class-properties&quot;,&#xA0;&quot;@babel/plugin-syntax-dynamic-import&quot;]  </span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5148;&#x6267;&#x884C; <code>@babel/plugin-proposal-class-properties</code>&#xFF0C;&#x540E;&#x6267;&#x884C; <code>@babel/plugin-syntax-dynamic-import</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">json&#x590D;&#x5236;&#x4EE3;&#x7801;{  </span><br><span class="line">&#xA0;&#xA0;&quot;presets&quot;:&#xA0;[&quot;@babel/preset-env&quot;,&#xA0;&quot;@babel/preset-react&quot;]  </span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><code>preset</code> &#x7684;&#x6267;&#x884C;&#x987A;&#x5E8F;&#x662F;<strong>&#x98A0;&#x5012;</strong>&#x7684;&#xFF0C;&#x5148;&#x6267;&#x884C; <code>@babel/preset-react</code>&#xFF0C; &#x540E;&#x6267;&#x884C; <code>@babel/preset-env</code>&#x3002;</p>
<h4 id="&#x63D2;&#x4EF6;&#x53C2;&#x6570;"><a href="#&#x63D2;&#x4EF6;&#x53C2;&#x6570;" class="headerlink" title="&#x63D2;&#x4EF6;&#x53C2;&#x6570;"></a>&#x63D2;&#x4EF6;&#x53C2;&#x6570;</h4><p>&#x63D2;&#x4EF6;&#x548C; <code>preset</code> &#x90FD;&#x53EF;&#x4EE5;&#x63A5;&#x53D7;&#x53C2;&#x6570;&#xFF0C;&#x53C2;&#x6570;&#x7531;&#x63D2;&#x4EF6;&#x540D;&#x548C;&#x53C2;&#x6570;&#x5BF9;&#x8C61;&#x7EC4;&#x6210;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;&#x3002;<code>preset</code> &#x8BBE;&#x7F6E;&#x53C2;&#x6570;&#x4E5F;&#x662F;&#x8FD9;&#x79CD;&#x683C;&#x5F0F;&#x3002;</p>
<p>&#x5982;: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">json&#x590D;&#x5236;&#x4EE3;&#x7801;{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&quot;plugins&quot;:&#xA0;[  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&quot;@babel/plugin-proposal-class-properties&quot;,&#xA0;  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;{&#xA0;&quot;loose&quot;:&#xA0;true&#xA0;}  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;]  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;]  </span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h5 id="&#x63D2;&#x4EF6;&#x7684;&#x77ED;&#x540D;&#x79F0;"><a href="#&#x63D2;&#x4EF6;&#x7684;&#x77ED;&#x540D;&#x79F0;" class="headerlink" title="&#x63D2;&#x4EF6;&#x7684;&#x77ED;&#x540D;&#x79F0;"></a>&#x63D2;&#x4EF6;&#x7684;&#x77ED;&#x540D;&#x79F0;</h5><p>&#x5982;&#x679C;&#x63D2;&#x4EF6;&#x540D;&#x79F0;&#x4E3A; <code>@babel/plugin-XXX</code>&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x77ED;&#x540D;&#x79F0;<code>@babel/XXX</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">js&#x590D;&#x5236;&#x4EE3;&#x7801;{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&quot;plugins&quot;:&#xA0;[  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&quot;@babel/transform-arrow-functions&quot;&#xA0;//&#x540C;&#xA0;&quot;@babel/plugin-transform-arrow-functions&quot;  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;]  </span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5982;&#x679C;&#x63D2;&#x4EF6;&#x540D;&#x79F0;&#x4E3A; <code>babel-plugin-XXX</code>&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x77ED;&#x540D;&#x79F0; <code>XXX</code>&#xFF0C;&#x8BE5;&#x89C4;&#x5219;&#x540C;&#x6837;&#x9002;&#x7528;&#x4E8E;&#x5E26;&#x6709; <code>scope</code> &#x7684;&#x63D2;&#x4EF6;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">js&#x590D;&#x5236;&#x4EE3;&#x7801;{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&quot;plugins&quot;:&#xA0;[  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&quot;newPlugin&quot;,&#xA0;//&#x540C;&#xA0;&quot;babel-plugin-newPlugin&quot;  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&quot;@scp/myPlugin&quot;&#xA0;//&#x540C;&#xA0;&quot;@scp/babel-plugin-myPlugin&quot;  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;]  </span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="&#x521B;&#x5EFA;-Preset"><a href="#&#x521B;&#x5EFA;-Preset" class="headerlink" title="&#x521B;&#x5EFA; Preset"></a>&#x521B;&#x5EFA; Preset</h4><blockquote>
<p>&#x53EF;&#x4EE5;&#x7B80;&#x5355;&#x7684;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x63D2;&#x4EF6;&#x6570;&#x7EC4;</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">js&#x590D;&#x5236;&#x4EE3;&#x7801;module.exports&#xA0;=&#xA0;function()&#xA0;{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;return&#xA0;{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;plugins:&#xA0;[  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&quot;A&quot;,  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&quot;B&quot;,  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&quot;C&quot;  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;]  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;}  </span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>preset</code> &#x4E2D;&#x4E5F;&#x53EF;&#x4EE5;&#x5305;&#x542B;&#x5176;&#x4ED6;&#x7684; <code>preset</code>&#xFF0C;&#x4EE5;&#x53CA;&#x5E26;&#x6709;&#x53C2;&#x6570;&#x7684;&#x63D2;&#x4EF6;&#x3002;</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">js&#x590D;&#x5236;&#x4EE3;&#x7801;module.exports&#xA0;=&#xA0;function()&#xA0;{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;return&#xA0;{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;presets:&#xA0;[  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;require(&quot;@babel/preset-env&quot;)  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;],  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;plugins:&#xA0;[  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[require(&quot;@babel/plugin-proposal-class-properties&quot;),&#xA0;{&#xA0;loose:&#xA0;true&#xA0;}],  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;require(&quot;@babel/plugin-proposal-object-rest-spread&quot;)  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;]  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;}  </span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="&#x914D;&#x7F6E;&#x6587;&#x4EF6;"><a href="#&#x914D;&#x7F6E;&#x6587;&#x4EF6;" class="headerlink" title="&#x914D;&#x7F6E;&#x6587;&#x4EF6;"></a>&#x914D;&#x7F6E;&#x6587;&#x4EF6;</h3><p>Babel &#x652F;&#x6301;&#x591A;&#x79CD;&#x683C;&#x5F0F;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002;&#x8FD9;&#x90E8;&#x5206;&#x5185;&#x5BB9;&#x8865;&#x5145;&#x4E86;&#x89E3;&#x4E0B;&#x5373;&#x53EF;&#xFF0C;&#x8C01;&#x7BA1;&#x4F60;&#x7528;&#x54EA;&#x79CD;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x53EA;&#x8981;&#x4F60;&#x7684;&#x914D;&#x7F6E;&#x662F;OK&#x7684;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;(&#x6577;&#x884D;)~</p>
<p>&#x6240;&#x6709;&#x7684; <code>Babel</code> API &#x53C2;&#x6570;&#x90FD;&#x53EF;&#x4EE5;&#x88AB;&#x914D;&#x7F6E;&#xFF0C;&#x4F46;&#x662F;&#x5982;&#x679C;&#x8BE5;&#x53C2;&#x6570;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x7684; JS &#x4EE3;&#x7801;&#xFF0C;&#x90A3;&#x4E48;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x4F7F;&#x7528; JS &#x4EE3;&#x7801;&#x7248;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002;</p>
<blockquote>
<p>&#x6839;&#x636E;&#x4F7F;&#x7528;&#x573A;&#x666F;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x4E0D;&#x540C;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;:</p>
</blockquote>
<p>&#x5982;&#x679C;&#x5E0C;&#x671B;&#x4EE5;&#x7F16;&#x7A0B;&#x7684;&#x65B9;&#x5F0F;&#x521B;&#x5EFA;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x6216;&#x8005;&#x5E0C;&#x671B;&#x7F16;&#x8BD1; <code>node_modules</code> &#x76EE;&#x5F55;&#x4E0B;&#x7684;&#x6A21;&#x5757;&#xFF1A;&#x90A3;&#x4E48; <code>babel.config.js</code> &#x53EF;&#x4EE5;&#x6EE1;&#x8DB3;&#x4F60;&#x7684;&#x9700;&#x6C42;&#x3002;</p>
<p>&#x5982;&#x679C;&#x53EA;&#x662F;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x5E76;&#x4E14;&#x4E2D;&#x7528;&#x4E8E;&#x5355;&#x4E2A;&#x8F6F;&#x4EF6;&#x5305;&#x7684;&#x914D;&#x7F6E;&#xFF1A;&#x90A3;&#x4E48; <code>.babelrc</code> &#x5373;&#x53EF;&#x6EE1;&#x8DB3;&#x4F60;&#x7684;&#x9700;&#x6C42;&#x3002;</p>
<h4 id="babel-config-js"><a href="#babel-config-js" class="headerlink" title="babel.config.js"></a>babel.config.js</h4><p>&#x5728;&#x9879;&#x76EE;&#x6839;&#x76EE;&#x5F55;&#x4E0B;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x540D;&#x4E3A; <code>babel.config.js</code> &#x7684;&#x6587;&#x4EF6;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">js&#x590D;&#x5236;&#x4EE3;&#x7801;module.exports&#xA0;=&#xA0;function(api)&#xA0;{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;api.cache(true);  </span><br><span class="line">  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;const&#xA0;presets&#xA0;=&#xA0;[...];  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;const&#xA0;plugins&#xA0;=&#xA0;[...];  </span><br><span class="line">  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;return&#xA0;{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;presets,  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;plugins  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;};  </span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5177;&#x4F53;&#x7684;&#x914D;&#x7F6E;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#xFF1A;<a href="/external_links/ddf0aca2a015e3d7d65206459ea98613.html" target="blank" rel="noopener">babel.config.js &#x6587;&#x6863;</a></p>
<h4 id="babelrc"><a href="#babelrc" class="headerlink" title=".babelrc"></a>.babelrc</h4><p>&#x5728;&#x9879;&#x76EE;&#x6839;&#x76EE;&#x5F55;&#x4E0B;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x540D;&#x4E3A; <code>.babelrc</code> &#x7684;&#x6587;&#x4EF6;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&quot;presets&quot;:&#xA0;[],  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&quot;plugins&quot;:&#xA0;[]  </span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5177;&#x4F53;&#x7684;&#x914D;&#x7F6E;&#x53EF;&#x4EE5;&#x53C2;&#x8003; <a href="/external_links/ddf0aca2a015e3d7d65206459ea98613.html" target="blank" rel="noopener">.babelrc &#x6587;&#x6863;</a> </p>
<h4 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a>package.json</h4><p>&#x53EF;&#x4EE5;&#x5C06; <code>.babelrc</code> &#x4E2D;&#x7684;&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#x4F5C;&#x4E3A; <code>babel</code> &#x952E;(key) &#x6DFB;&#x52A0;&#x5230; <code>package.json</code> &#x6587;&#x4EF6;&#x4E2D;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">json&#x590D;&#x5236;&#x4EE3;&#x7801;{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&quot;name&quot;:&#xA0;&quot;my-package&quot;,  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&quot;babel&quot;:&#xA0;{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&quot;presets&quot;:&#xA0;[],  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&quot;plugins&quot;:&#xA0;[]  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;}  </span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="babelrc-js"><a href="#babelrc-js" class="headerlink" title=".babelrc.js"></a>.babelrc.js</h4><p>&#x4E0E; <code>.babelrc</code> &#x914D;&#x7F6E;&#x76F8;&#x540C;&#xFF0C;&#x4F46;&#x662F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;JS&#x7F16;&#x5199;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">js&#x590D;&#x5236;&#x4EE3;&#x7801;//&#x53EF;&#x4EE5;&#x5728;&#x5176;&#x4E2D;&#x8C03;&#x7528;&#xA0;Node.js&#xA0;&#x7684;API  </span><br><span class="line">const&#xA0;presets&#xA0;=&#xA0;[];  </span><br><span class="line">const&#xA0;plugins&#xA0;=&#xA0;[];  </span><br><span class="line">  </span><br><span class="line">module.exports&#xA0;=&#xA0;{&#xA0;presets,&#xA0;plugins&#xA0;};</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/4eec87babce9903b4c2420774be46d242eadebbcd89532f3392b05aa14c43602" alt></p>
<p>&#x4E0D;&#x77E5;&#x9053;&#x662F;&#x5426;&#x5168;&#x9762;&#xFF0C;&#x4E0D;&#x8FC7;&#x771F;&#x7684;&#x5199;&#x4E0D;&#x52A8;&#x4E86;&#xFF08;&#x5982;&#x6709;&#x4E0D;&#x5168;&#xFF0C;&#x540E;&#x7EED;&#x518D;&#x8865;&#x5145;&#xFF09;<del>&#x5C31;&#x9171;</del>&#x5982;&#x679C;&#x6709;&#x9519;&#x8BEF;&#xFF0C;&#x6B22;&#x8FCE;&#x6307;&#x6B63;&#x3002;</p>
<blockquote>
<p>&#x53C2;&#x8003;&#x94FE;&#x63A5;</p>
</blockquote>
<ol>
<li><a href="/external_links/a1295bfa381528fbdcd991d3f4b089d4.html" target="blank" rel="noopener">babel&#x6587;&#x6863;</a></li>
<li><a href="/external_links/45cfeaf7f1c929eb1ea97051a4199647.html" target="blank" rel="noopener">babel 7 &#x7684;&#x4F7F;&#x7528;&#x7684;&#x4E2A;&#x4EBA;&#x7406;&#x89E3;</a></li>
<li><a href="https://dev.newban.cn/6844903743121522701">&#x4E00;&#x53E3;(&#x5F88;&#x957F;&#x7684;)&#x6C14;&#x4E86;&#x89E3; babel</a></li>
<li><a href="/external_links/f978841c3e9af5eee2ae4a9841bc9c5f.html" target="blank" rel="noopener">core-js@3&#x5E26;&#x6765;&#x7684;&#x60CA;&#x559C;</a></li>
</ol>
<hr>
<h3 id="&#x5173;&#x6CE8;&#x201C;&#x5C0F;&#x59D0;&#x59D0;&#x201D;&#x7684;&#x516C;&#x4F17;&#x53F7;"><a href="#&#x5173;&#x6CE8;&#x201C;&#x5C0F;&#x59D0;&#x59D0;&#x201D;&#x7684;&#x516C;&#x4F17;&#x53F7;" class="headerlink" title="&#x5173;&#x6CE8;&#x201C;&#x5C0F;&#x59D0;&#x59D0;&#x201D;&#x7684;&#x516C;&#x4F17;&#x53F7;"></a>&#x5173;&#x6CE8;&#x201C;&#x5C0F;&#x59D0;&#x59D0;&#x201D;&#x7684;&#x516C;&#x4F17;&#x53F7;</h3><p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/d0b73024ab4fd2dffc52f09e568bd0d7fa6fb66771951b2aeab2e1e1bcfd2228" alt></p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/60c9a59df45f6e2731f0af1fc202bc7b.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844904001192853511.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844904001192853511.html" itemprop="url">学习 vuex 源码整体架构，打造属于自己的状态管理库</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-11-20T15:15:18+08:00">
                2019-11-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="&#x524D;&#x8A00;"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00;</h2><blockquote>
<p>&#x4F60;&#x597D;&#xFF0C;&#x6211;&#x662F;<a href="/external_links/b223b476cd448b456962ecaf8028b149.html" target="blank" rel="noopener">&#x82E5;&#x5DDD;</a>&#x3002;&#x8FD9;&#x662F;<code>&#x5B66;&#x4E60;&#x6E90;&#x7801;&#x6574;&#x4F53;&#x67B6;&#x6784;</code>&#x7B2C;&#x4E94;&#x7BC7;&#x3002;&#x6574;&#x4F53;&#x67B6;&#x6784;&#x8FD9;&#x8BCD;&#x8BED;&#x597D;&#x50CF;&#x6709;&#x70B9;&#x5927;&#xFF0C;&#x59D1;&#x4E14;&#x5C31;&#x7B97;&#x662F;&#x6E90;&#x7801;&#x6574;&#x4F53;&#x7ED3;&#x6784;&#x5427;&#xFF0C;&#x4E3B;&#x8981;&#x5C31;&#x662F;&#x5B66;&#x4E60;&#x662F;&#x4EE3;&#x7801;&#x6574;&#x4F53;&#x7ED3;&#x6784;&#xFF0C;&#x4E0D;&#x6DF1;&#x7A76;&#x5176;&#x4ED6;&#x4E0D;&#x662F;&#x4E3B;&#x7EBF;&#x7684;&#x5177;&#x4F53;&#x51FD;&#x6570;&#x7684;&#x5B9E;&#x73B0;&#x3002;&#x672C;&#x7BC7;&#x6587;&#x7AE0;&#x5B66;&#x4E60;&#x7684;&#x662F;&#x5B9E;&#x9645;&#x4ED3;&#x5E93;&#x7684;&#x4EE3;&#x7801;&#x3002;</p>
</blockquote>
<p><code>&#x5B66;&#x4E60;&#x6E90;&#x7801;&#x6574;&#x4F53;&#x67B6;&#x6784;</code>&#x7CFB;&#x5217;&#x6587;&#x7AE0;&#x5982;&#x4E0B;&#xFF1A;</p>
<blockquote>
<p>1.<a href="https://dev.newban.cn/6844903902077272071">&#x5B66;&#x4E60; jQuery &#x6E90;&#x7801;&#x6574;&#x4F53;&#x67B6;&#x6784;&#xFF0C;&#x6253;&#x9020;&#x5C5E;&#x4E8E;&#x81EA;&#x5DF1;&#x7684; js &#x7C7B;&#x5E93;</a>  </p>
<p>2.<a href="https://dev.newban.cn/6844903908972691469">&#x5B66;&#x4E60; underscore &#x6E90;&#x7801;&#x6574;&#x4F53;&#x67B6;&#x6784;&#xFF0C;&#x6253;&#x9020;&#x5C5E;&#x4E8E;&#x81EA;&#x5DF1;&#x7684;&#x51FD;&#x6570;&#x5F0F;&#x7F16;&#x7A0B;&#x7C7B;&#x5E93;</a>  </p>
<p>3.<a href="https://dev.newban.cn/6844903939062628360">&#x5B66;&#x4E60; lodash &#x6E90;&#x7801;&#x6574;&#x4F53;&#x67B6;&#x6784;&#xFF0C;&#x6253;&#x9020;&#x5C5E;&#x4E8E;&#x81EA;&#x5DF1;&#x7684;&#x51FD;&#x6570;&#x5F0F;&#x7F16;&#x7A0B;&#x7C7B;&#x5E93;</a>  </p>
<p>4.<a href="https://dev.newban.cn/6844903984457580551">&#x5B66;&#x4E60; sentry &#x6E90;&#x7801;&#x6574;&#x4F53;&#x67B6;&#x6784;&#xFF0C;&#x6253;&#x9020;&#x5C5E;&#x4E8E;&#x81EA;&#x5DF1;&#x7684;&#x524D;&#x7AEF;&#x5F02;&#x5E38;&#x76D1;&#x63A7;SDK</a>  </p>
<p>5.<a href="https://dev.newban.cn/6844904001192853511">&#x5B66;&#x4E60; vuex &#x6E90;&#x7801;&#x6574;&#x4F53;&#x67B6;&#x6784;&#xFF0C;&#x6253;&#x9020;&#x5C5E;&#x4E8E;&#x81EA;&#x5DF1;&#x7684;&#x72B6;&#x6001;&#x7BA1;&#x7406;&#x5E93;</a>  </p>
<p>6.<a href="https://dev.newban.cn/6844904019987529735">&#x5B66;&#x4E60; axios &#x6E90;&#x7801;&#x6574;&#x4F53;&#x67B6;&#x6784;&#xFF0C;&#x6253;&#x9020;&#x5C5E;&#x4E8E;&#x81EA;&#x5DF1;&#x7684;&#x8BF7;&#x6C42;&#x5E93;</a>  </p>
<p>7.<a href="https://dev.newban.cn/6844904088220467213">&#x5B66;&#x4E60; koa &#x6E90;&#x7801;&#x7684;&#x6574;&#x4F53;&#x67B6;&#x6784;&#xFF0C;&#x6D45;&#x6790;koa&#x6D0B;&#x8471;&#x6A21;&#x578B;&#x539F;&#x7406;&#x548C;co&#x539F;&#x7406;</a>  </p>
<p>8.<a href="https://dev.newban.cn/6844904191228411911">&#x5B66;&#x4E60; redux &#x6E90;&#x7801;&#x6574;&#x4F53;&#x67B6;&#x6784;&#xFF0C;&#x6DF1;&#x5165;&#x7406;&#x89E3; redux &#x53CA;&#x5176;&#x4E2D;&#x95F4;&#x4EF6;&#x539F;&#x7406;</a></p>
</blockquote>
<p>&#x611F;&#x5174;&#x8DA3;&#x7684;&#x8BFB;&#x8005;&#x53EF;&#x4EE5;&#x70B9;&#x51FB;&#x9605;&#x8BFB;&#x3002;&#x4E0B;&#x4E00;&#x7BC7;&#x53EF;&#x80FD;&#x662F;&#x5B66;&#x4E60; <code>axios</code> &#x6E90;&#x7801;&#x3002;</p>
<p><strong>&#x5BFC;&#x8BFB;</strong>  </p>
<p>&#x6587;&#x7AE0;&#x6BD4;&#x8F83;&#x8BE6;&#x7EC6;&#x7684;&#x4ECB;&#x7ECD;&#x4E86;<code>vuex</code>&#x3001;<code>vue</code>&#x6E90;&#x7801;&#x8C03;&#x8BD5;&#x65B9;&#x6CD5;&#x548C; <code>Vuex</code> &#x539F;&#x7406;&#x3002;&#x5E76;&#x4E14;&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;&#x4E86; <code>Vuex.use</code> &#x5B89;&#x88C5;&#x548C; <code>new Vuex.Store</code> &#x521D;&#x59CB;&#x5316;&#x3001;<code>Vuex.Store</code> &#x7684;&#x5168;&#x90E8;<code>API</code>&#xFF08;&#x5982;<code>dispatch</code>&#x3001;<code>commit</code>&#x7B49;&#xFF09;&#x7684;&#x5B9E;&#x73B0;&#x548C;&#x8F85;&#x52A9;&#x51FD;&#x6570; <code>mapState</code>&#x3001;<code>mapGetters</code>&#x3001; <code>mapActions</code>&#x3001;<code>mapMutations</code><br><code>createNamespacedHelpers</code>&#x3002;</p>
<h2 id="chrome-&#x6D4F;&#x89C8;&#x5668;&#x8C03;&#x8BD5;-vuex-&#x6E90;&#x7801;&#x65B9;&#x6CD5;"><a href="#chrome-&#x6D4F;&#x89C8;&#x5668;&#x8C03;&#x8BD5;-vuex-&#x6E90;&#x7801;&#x65B9;&#x6CD5;" class="headerlink" title="chrome &#x6D4F;&#x89C8;&#x5668;&#x8C03;&#x8BD5; vuex &#x6E90;&#x7801;&#x65B9;&#x6CD5;"></a>chrome &#x6D4F;&#x89C8;&#x5668;&#x8C03;&#x8BD5; vuex &#x6E90;&#x7801;&#x65B9;&#x6CD5;</h2><p><a href="/external_links/5607a9e0afc9115e8b4430ea6473d3ab.html" target="blank" rel="noopener">Vue&#x6587;&#x6863;&#xFF1A;&#x5728; VS Code &#x4E2D;&#x8C03;&#x8BD5; Vue &#x9879;&#x76EE;</a>  </p>
<p>&#x4ECE;&#x4E0A;&#x6587;&#x4E2D;&#x540C;&#x7406;&#x53EF;&#x5F97;&#x8C03;&#x8BD5; <code>vuex</code> &#x65B9;&#x6CD5;&#xFF0C;&#x8FD9;&#x91CC;&#x8BE6;&#x7EC6;&#x8BF4;&#x4E0B;&#xFF0C;&#x4FBF;&#x4E8E;&#x5E2E;&#x52A9;&#x5230;&#x53EF;&#x80FD;&#x4E0D;&#x77E5;&#x9053;&#x5982;&#x4F55;&#x8C03;&#x8BD5;&#x6E90;&#x7801;&#x7684;&#x8BFB;&#x8005;&#x3002;  </p>
<p>&#x53EF;&#x4EE5;&#x628A;&#x7B14;&#x8005;&#x7684;&#x8FD9;&#x4E2A; <a href="/external_links/cbf521707e717a82a6c95c55c4ba19c4.html" target="blank" rel="noopener">vuex-analysis</a> &#x6E90;&#x7801;&#x5206;&#x6790;&#x4ED3;&#x5E93;<code>fork</code>&#x4E00;&#x4EFD;&#x6216;&#x8005;&#x76F4;&#x63A5;&#x514B;&#x9686;&#x4E0B;&#x6765;&#xFF0C;<br><code>git clone https://github.com/lxchuan12/vuex-analysis.git</code></p>
<blockquote>
<p>&#x5176;&#x4E2D;&#x6587;&#x4EF6;&#x5939;<code>vuex</code>&#xFF0C;&#x662F;&#x514B;&#x9686;&#x5B98;&#x65B9;&#x7684;<code>vuex</code>&#x4ED3;&#x5E93; <code>dev</code>&#x5206;&#x652F;&#x3002;  </p>
<p>&#x622A;&#x81F3;&#x76EE;&#x524D;&#xFF08;2019&#x5E74;11&#x6708;&#xFF09;&#xFF0C;&#x7248;&#x672C;&#x662F;<code>v3.1.2</code>&#xFF0C;&#x6700;&#x540E;&#x4E00;&#x6B21;<code>commit</code>&#x662F;<code>ba2ff3a3</code>&#xFF0C;<code>2019-11-11 11:51 Ben Hutton</code>&#x3002;  </p>
<p>&#x5305;&#x542B;&#x7B14;&#x8005;&#x7684;&#x6CE8;&#x91CA;&#xFF0C;&#x4FBF;&#x4E8E;&#x7406;&#x89E3;&#x3002;</p>
</blockquote>
<p>&#x514B;&#x9686;&#x5B8C;&#x6210;&#x540E;&#xFF0C; &#x5728;<code>vuex/examples/webpack.config.js</code> &#x4E2D;&#x6DFB;&#x52A0;<code>devtool</code>&#x914D;&#x7F6E;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// &#x65B0;&#x589E;devtool&#x914D;&#x7F6E;&#xFF0C;&#x4FBF;&#x4E8E;&#x8C03;&#x8BD5;</span><br><span class="line">devtool: &apos;source-map&apos;,</span><br><span class="line">output: {}</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;git clone https://github.com/lxchuan12/vuex-analysis.git</span><br><span class="line">cd vuex</span><br><span class="line">npm i</span><br><span class="line">npm run dev</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&#x6253;&#x5F00; <a href="/external_links/9825c2a542dd888e55b9b0e06b04f672.html" target="blank" rel="noopener">http://localhost:8080/</a>  </p>
<p>&#x70B9;&#x51FB;&#x4F60;&#x60F3;&#x6253;&#x5F00;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;Shopping Cart =&gt; <a href="/external_links/1e34a2c567d8640129e4fe4241c32277.html" target="blank" rel="noopener">http://localhost:8080/shopping-cart/</a>  </p>
<p>&#x6253;&#x5F00;&#x63A7;&#x5236;&#x9762;&#x677F; source &#x5728;&#x5DE6;&#x4FA7;&#x627E;&#x5230; webapck// . src &#x76EE;&#x5F55; store &#x6587;&#x4EF6; &#x6839;&#x636E;&#x81EA;&#x5DF1;&#x9700;&#x6C42;&#x65AD;&#x70B9;&#x8C03;&#x8BD5;&#x5373;&#x53EF;&#x3002;</p>
</blockquote>
<p>&#x672C;&#x6587;&#x4E3B;&#x8981;&#x5C31;&#x662F;&#x901A;&#x8FC7;<a href="/external_links/53177bd115d4de1b044113f14a9def21.html" target="blank" rel="noopener"><code>Shopping Cart</code></a>&#xFF0C;(&#x8DEF;&#x5F84;<code>vuex/examples/shopping-cart</code>)&#x4F8B;&#x5B50;&#x8C03;&#x8BD5;&#x4EE3;&#x7801;&#x7684;&#x3002;</p>
<h3 id="&#x987A;&#x4FBF;&#x63D0;&#x4E00;&#x4E0B;&#x8C03;&#x8BD5;-vue-&#x6E90;&#x7801;&#xFF08;v2-6-10&#xFF09;&#x7684;&#x65B9;&#x6CD5;"><a href="#&#x987A;&#x4FBF;&#x63D0;&#x4E00;&#x4E0B;&#x8C03;&#x8BD5;-vue-&#x6E90;&#x7801;&#xFF08;v2-6-10&#xFF09;&#x7684;&#x65B9;&#x6CD5;" class="headerlink" title="&#x987A;&#x4FBF;&#x63D0;&#x4E00;&#x4E0B;&#x8C03;&#x8BD5; vue &#x6E90;&#x7801;&#xFF08;v2.6.10&#xFF09;&#x7684;&#x65B9;&#x6CD5;"></a>&#x987A;&#x4FBF;&#x63D0;&#x4E00;&#x4E0B;&#x8C03;&#x8BD5; vue &#x6E90;&#x7801;&#xFF08;v2.6.10&#xFF09;&#x7684;&#x65B9;&#x6CD5;</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;git clone https://github.com/vuejs/vue.git</span><br></pre></td></tr></table></figure>

<p>&#x514B;&#x9686;&#x4E0B;&#x6765;&#x540E;&#x5C06;<code>package.json</code> &#x6587;&#x4EF6;&#x4E2D;&#x7684;<code>script</code> <code>dev</code>&#x547D;&#x4EE4;&#x540E;&#x9762;&#x6DFB;&#x52A0;&#x8FD9;&#x4E2A; <code>--sourcemap</code>&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;{</span><br><span class="line">  &quot;dev&quot;: &quot;rollup -w -c scripts/config.js --environment TARGET:web-full-dev --sourcemap&quot;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;git clone https://github.com/vuejs/vue.git</span><br><span class="line">cd vue</span><br><span class="line">npm i</span><br><span class="line"># &#x5728; dist/vue.js &#x6700;&#x540E;&#x4E00;&#x884C;&#x8FFD;&#x52A0;&#x4E00;&#x884C; //# sourceMappingURL=vue.js.map</span><br><span class="line">npm run dev</span><br><span class="line"># &#x65B0;&#x7EC8;&#x7AEF;&#x7A97;&#x53E3;</span><br><span class="line"># &#x6839;&#x76EE;&#x5F55;&#x4E0B; &#x5168;&#x5C40;&#x5B89;&#x88C5;http-server(&#x4E00;&#x884C;&#x547D;&#x4EE4;&#x542F;&#x52A8;&#x670D;&#x52A1;&#x7684;&#x5DE5;&#x5177;)</span><br><span class="line">npm i -g http-server</span><br><span class="line">hs -p 8100</span><br><span class="line"></span><br><span class="line"># &#x5728;examples &#x6587;&#x4EF6;&#x5939;&#x4E2D;&#x628A;&#x5F15;&#x7528;&#x7684;vuejs&#x7684;index.html &#x6587;&#x4EF6; vue.min.js &#x6539;&#x4E3A; vue.js</span><br><span class="line"># &#x6216;&#x8005;&#x628A;dist&#x6587;&#x4EF6;&#x5939;&#x7684; vue.min.js &#xFF0C;&#x66FF;&#x6362;&#x6210;npm run dev&#x7F16;&#x8BD1;&#x540E;&#x7684;dist/vue.js </span><br><span class="line"></span><br><span class="line"># &#x6D4F;&#x89C8;&#x5668;&#x6253;&#x5F00; open http://localhost:8100/examples/</span><br><span class="line"></span><br><span class="line"># &#x6253;&#x5F00;&#x63A7;&#x5236;&#x9762;&#x677F; source &#x5728;&#x5DE6;&#x4FA7;&#x627E;&#x5230;  src &#x76EE;&#x5F55; &#x5373;vue.js&#x6E90;&#x7801;&#x6587;&#x4EF6; &#x6839;&#x636E;&#x81EA;&#x5DF1;&#x9700;&#x6C42;&#x65AD;&#x70B9;&#x8C03;&#x8BD5;&#x5373;&#x53EF;&#x3002;</span><br></pre></td></tr></table></figure>

<p>&#x672C;&#x5C0F;&#x8282;&#x5927;&#x7BC7;&#x5E45;&#x4ECB;&#x7ECD;&#x8C03;&#x8BD5;&#x65B9;&#x6CD5;&#x3002;&#x662F;&#x56E0;&#x4E3A;&#x771F;&#x7684;&#x5F88;&#x91CD;&#x8981;&#x3002;&#x4F1A;&#x8C03;&#x8BD5;&#x4EE3;&#x7801;&#xFF0C;&#x770B;&#x6E90;&#x7801;&#x5C31;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#x4E86;&#x3002;&#x5173;&#x6CE8;&#x4E3B;&#x7EBF;&#x8C03;&#x8BD5;&#x4EE3;&#x7801;&#xFF0C;&#x5F88;&#x5BB9;&#x6613;&#x770B;&#x61C2;&#x3002;  </p>
<p><strong>&#x5F3A;&#x70C8;&#x5EFA;&#x8BAE;&#x514B;&#x9686;&#x7B14;&#x8005;&#x7684;&#x8FD9;&#x4E2A;&#x4ED3;&#x5E93;&#xFF0C;&#x81EA;&#x5DF1;&#x8C03;&#x8BD5;&#x4EE3;&#x7801;&#xFF0C;&#x5BF9;&#x7740;&#x6CE8;&#x91CA;&#x770B;&#xFF0C;&#x4E0D;&#x8C03;&#x8BD5;&#x4EE3;&#x7801;&#xFF0C;&#x53EA;&#x770B;&#x6587;&#x7AE0;&#x4E0D;&#x5BB9;&#x6613;&#x5438;&#x6536;&#x6D88;&#x5316;</strong>&#x3002;  </p>
<p>&#x7B14;&#x8005;&#x4E5F;&#x770B;&#x4E86;&#x6587;&#x7AE0;&#x672B;&#x5C3E;&#x7B14;&#x8005;&#x63A8;&#x8350;&#x9605;&#x8BFB;&#x7684;&#x6587;&#x7AE0;&#xFF0C;&#x4F46;&#x8FD8;&#x662F;&#x9700;&#x8981;&#x81EA;&#x5DF1;&#x770B;&#x6E90;&#x4EE3;&#x7801;&#xFF0C;&#x624D;&#x77E5;&#x9053;&#x8FD9;&#x4E9B;&#x6587;&#x7AE0;&#x54EA;&#x91CC;&#x5199;&#x5230;&#x4E86;&#xFF0C;&#x54EA;&#x91CC;&#x6CA1;&#x6709;&#x7EC6;&#x5199;&#x3002;   </p>
<p>&#x6B63;&#x6587;&#x5F00;&#x59CB;&#xFF5E;</p>
<h2 id="vuex-&#x539F;&#x7406;"><a href="#vuex-&#x539F;&#x7406;" class="headerlink" title="vuex &#x539F;&#x7406;"></a>vuex &#x539F;&#x7406;</h2><p>&#x7B80;&#x5355;&#x8BF4;&#x660E;&#x4E0B; <code>vuex</code> &#x539F;&#x7406;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;template&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">  count {{$store.state.count}}</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<p>&#x6BCF;&#x4E2A;&#x7EC4;&#x4EF6;&#xFF08;&#x4E5F;&#x5C31;&#x662F;<code>Vue&#x5B9E;&#x4F8B;</code>&#xFF09;&#x5728;<code>beforeCreate</code>&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x4E2D;&#x90FD;&#x6DF7;&#x5165;&#xFF08;Vue.mixin&#xFF09;&#x540C;&#x4E00;&#x4E2A;<code>Store&#x5B9E;&#x4F8B;</code> &#x4F5C;&#x4E3A;&#x5C5E;&#x6027; <code>$store</code>&#xFF0C;<br>&#x4E5F;&#x5C31;&#x662F;&#x4E3A;&#x5565;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>this.$store.dispatch</code> &#x7B49;&#x8C03;&#x7528;&#x65B9;&#x6CD5;&#x7684;&#x539F;&#x56E0;&#x3002;</p>
<p>&#x6700;&#x540E;&#x663E;&#x793A;&#x5728;&#x6A21;&#x677F;&#x91CC;&#x7684;<br><code>$store.state.count</code><br>&#x6E90;&#x7801;&#x662F;&#x8FD9;&#x6837;&#x7684;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;class Store{</span><br><span class="line">  get state () {</span><br><span class="line">    return this._vm._data.$state</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5176;&#x5B9E;&#x5C31;&#x662F;&#xFF1A;<br><code>vm.$store._vm._data.?state.count</code><br>&#x5176;&#x4E2D;<code>vm.$store._vm._data.?state</code> &#x662F; &#x54CD;&#x5E94;&#x5F0F;&#x7684;&#x3002;<br>&#x600E;&#x4E48;&#x5B9E;&#x73B0;&#x54CD;&#x5E94;&#x5F0F;&#x7684;&#xFF1F;&#x5176;&#x5B9E;&#x5C31;&#x662F;<code>new Vue()</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function resetStoreVM (store, state, hot) {</span><br><span class="line">  //  &#x7701;&#x7565;&#x82E5;&#x5E72;&#x4EE3;&#x7801;</span><br><span class="line">  store._vm = new Vue({</span><br><span class="line">    data: {</span><br><span class="line">      $state: state</span><br><span class="line">    },</span><br><span class="line">    computed</span><br><span class="line">  })</span><br><span class="line">  //  &#x7701;&#x7565;&#x82E5;&#x5E72;&#x4EE3;&#x7801;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x91CC;&#x7684; <code>state</code> &#x5C31;&#x662F; &#x7528;&#x6237;&#x5B9A;&#x4E49;&#x7684; <code>state</code>&#x3002;<br>&#x8FD9;&#x91CC;&#x7684; <code>computed</code> &#x5C31;&#x662F;&#x5904;&#x7406;&#x540E;&#x7684;&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x7684; <code>getters</code>&#x3002;<br>&#x800C; <code>class Store</code>&#x4E0A;&#x7684;&#x4E00;&#x4E9B;&#x51FD;&#x6570;&#xFF08;API&#xFF09;&#x4E3B;&#x8981;&#x90FD;&#x662F;&#x56F4;&#x7ED5;&#x4FEE;&#x6539;<code>vm.$store._vm._data.?state</code>&#x548C;<code>computed(getter)</code>&#x670D;&#x52A1;&#x7684;&#x3002;</p>
<h2 id="Vue-use-&#x5B89;&#x88C5;"><a href="#Vue-use-&#x5B89;&#x88C5;" class="headerlink" title="Vue.use &#x5B89;&#x88C5;"></a>Vue.use &#x5B89;&#x88C5;</h2><p>&#x7B14;&#x8005;&#x753B;&#x4E86;&#x4E00;&#x5F20;&#x56FE;&#x8868;&#x793A;&#x4E0B;<code>Vuex</code>&#x5BF9;&#x8C61;&#xFF0C;&#x662F;<code>Vue</code>&#x7684;&#x4E00;&#x4E2A;&#x63D2;&#x4EF6;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/5db3d37e52b3267fc036068424b58a190a1e2945f1598dcb368025e1edb93d7f" alt="Vuex &#x5BF9;&#x8C61;&#x5173;&#x7CFB;&#x56FE;"></p>
<p>Vuex &#x5BF9;&#x8C61;&#x5173;&#x7CFB;&#x56FE;</p>
<blockquote>
<p>&#x770B;&#x5230;&#x8FD9;&#x91CC;&#xFF0C;&#x606D;&#x559C;&#x4F60;&#x5DF2;&#x7ECF;&#x4E86;&#x89E3;&#x4E86;<code>Vuex</code>&#x539F;&#x7406;&#x3002;&#x6587;&#x7AE0;&#x6BD4;&#x8F83;&#x957F;&#xFF0C;&#x5982;&#x679C;&#x6682;&#x65F6;&#x4E0D;&#x60F3;&#x5173;&#x6CE8;&#x6E90;&#x7801;&#x7EC6;&#x8282;&#xFF0C;&#x53EF;&#x4EE5;&#x514B;&#x9686;&#x4E00;&#x4E0B;&#x672C;&#x4ED3;&#x5E93;&#x4EE3;&#x7801;<code>git clone https://github.com/lxchuan12/vuex-analysis.git</code>&#xFF0C;&#x540E;&#x7EED;&#x8C03;&#x8BD5;&#x4EE3;&#x7801;&#xFF0C;&#x70B9;&#x8D5E;&#x6536;&#x85CF;&#x5230;&#x65F6;&#x60F3;&#x770B;&#x4E86;&#x518D;&#x770B;&#x3002;</p>
</blockquote>
<p><a href="/external_links/3fc7f35b87d90cf41b11a86a5e305ee8.html" target="blank" rel="noopener">&#x6587;&#x6863; Vue.use</a><br><code>Vue.use(Vuex)</code></p>
<blockquote>
<p>&#x53C2;&#x6570;&#xFF1A;<br>Object  Function plugin<br>&#x7528;&#x6CD5;&#xFF1A;  </p>
<p>&#x5B89;&#x88C5; Vue.js &#x63D2;&#x4EF6;&#x3002;&#x5982;&#x679C;&#x63D2;&#x4EF6;&#x662F;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#xFF0C;&#x5FC5;&#x987B;&#x63D0;&#x4F9B; <code>install</code> &#x65B9;&#x6CD5;&#x3002;&#x5982;&#x679C;&#x63D2;&#x4EF6;&#x662F;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x5B83;&#x4F1A;&#x88AB;&#x4F5C;&#x4E3A; <code>install</code> &#x65B9;&#x6CD5;&#x3002;<code>install</code> &#x65B9;&#x6CD5;&#x8C03;&#x7528;&#x65F6;&#xFF0C;&#x4F1A;&#x5C06; Vue &#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x4F20;&#x5165;&#x3002;  </p>
<p>&#x8BE5;&#x65B9;&#x6CD5;&#x9700;&#x8981;&#x5728;&#x8C03;&#x7528; <code>new Vue()</code> &#x4E4B;&#x524D;&#x88AB;&#x8C03;&#x7528;&#x3002;  </p>
<p>&#x5F53; <code>install</code> &#x65B9;&#x6CD5;&#x88AB;&#x540C;&#x4E00;&#x4E2A;&#x63D2;&#x4EF6;&#x591A;&#x6B21;&#x8C03;&#x7528;&#xFF0C;&#x63D2;&#x4EF6;&#x5C06;&#x53EA;&#x4F1A;&#x88AB;&#x5B89;&#x88C5;&#x4E00;&#x6B21;&#x3002;</p>
</blockquote>
<p>&#x6839;&#x636E;&#x65AD;&#x70B9;&#x8C03;&#x8BD5;&#xFF0C;&#x6765;&#x770B;&#x4E0B;<code>Vue.use</code>&#x7684;&#x6E90;&#x7801;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function initUse (Vue) {</span><br><span class="line">  Vue.use = function (plugin) {</span><br><span class="line">    var installedPlugins = (this._installedPlugins || (this._installedPlugins = []));</span><br><span class="line">    // &#x5982;&#x679C;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#xFF0C;&#x5219;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;this&#x4E5F;&#x5C31;&#x662F;Vue</span><br><span class="line">    if (installedPlugins.indexOf(plugin) &gt; -1) {</span><br><span class="line">      return this</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    // additional parameters</span><br><span class="line">    var args = toArray(arguments, 1);</span><br><span class="line">    // &#x628A; this&#xFF08;&#x4E5F;&#x5C31;&#x662F;Vue&#xFF09;&#x4F5C;&#x4E3A;&#x6570;&#x7EC4;&#x7684;&#x7B2C;&#x4E00;&#x9879;</span><br><span class="line">    args.unshift(this);</span><br><span class="line">    // &#x5982;&#x679C;&#x63D2;&#x4EF6;&#x7684;install&#x5C5E;&#x6027;&#x662F;&#x51FD;&#x6570;,&#x8C03;&#x7528;&#x5B83;</span><br><span class="line">    if (typeof plugin.install === &apos;function&apos;) {</span><br><span class="line">      plugin.install.apply(plugin, args);</span><br><span class="line">    } else if (typeof plugin === &apos;function&apos;) {</span><br><span class="line">      // &#x5982;&#x679C;&#x63D2;&#x4EF6;&#x662F;&#x51FD;&#x6570;,&#x5219;&#x8C03;&#x7528;&#x5B83;</span><br><span class="line">      // apply(null) &#x4E25;&#x683C;&#x6A21;&#x5F0F;&#x4E0B; plugin &#x63D2;&#x4EF6;&#x51FD;&#x6570;&#x7684; this &#x5C31;&#x662F; null</span><br><span class="line">      plugin.apply(null, args);</span><br><span class="line">    }</span><br><span class="line">    // &#x6DFB;&#x52A0;&#x5230;&#x5DF2;&#x5B89;&#x88C5;&#x7684;&#x63D2;&#x4EF6;</span><br><span class="line">    installedPlugins.push(plugin);</span><br><span class="line">    return this</span><br><span class="line">  };</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="install-&#x51FD;&#x6570;"><a href="#install-&#x51FD;&#x6570;" class="headerlink" title="install &#x51FD;&#x6570;"></a>install &#x51FD;&#x6570;</h3><p><code>vuex/src/store.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;export function install (_Vue) {</span><br><span class="line">  // Vue &#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x5E76;&#x4E14;&#x76F8;&#x7B49;&#xFF0C;&#x8BF4;&#x660E;&#x5DF2;&#x7ECF;Vuex.use&#x8FC7;</span><br><span class="line">  if (Vue &amp;&amp; _Vue === Vue) {</span><br><span class="line">    // &#x7701;&#x7565;&#x4EE3;&#x7801;&#xFF1A;&#x975E;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x62A5;&#x9519;&#xFF0C;vuex&#x5DF2;&#x7ECF;&#x5B89;&#x88C5;</span><br><span class="line">    return</span><br><span class="line">  }</span><br><span class="line">  Vue = _Vue</span><br><span class="line">  applyMixin(Vue)</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x63A5;&#x4E0B;&#x6765;&#x770B; <code>applyMixin</code> &#x51FD;&#x6570;</p>
<h3 id="applyMixin-&#x51FD;&#x6570;"><a href="#applyMixin-&#x51FD;&#x6570;" class="headerlink" title="applyMixin &#x51FD;&#x6570;"></a>applyMixin &#x51FD;&#x6570;</h3><p><code>vuex/src/mixin.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;export default function (Vue) {</span><br><span class="line">  // Vue &#x7248;&#x672C;&#x53F7;</span><br><span class="line">  const version = Number(Vue.version.split(&apos;.&apos;)[0])</span><br><span class="line">  if (version &gt;= 2) {</span><br><span class="line">    // &#x5408;&#x5E76;&#x9009;&#x9879;&#x540E; beforeCreate &#x662F;&#x6570;&#x7EC4;&#x91CC;&#x51FD;&#x6570;&#x7684;&#x5F62;&#x5F0F;  [&#x192;,  &#x192;]</span><br><span class="line">    // &#x6700;&#x540E;&#x8C03;&#x7528;&#x5FAA;&#x73AF;&#x904D;&#x5386;&#x8FD9;&#x4E2A;&#x6570;&#x7EC4;&#xFF0C;&#x8C03;&#x7528;&#x8FD9;&#x4E9B;&#x51FD;&#x6570;&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x79CD;&#x51FD;&#x6570;&#x4E0E;&#x51FD;&#x6570;&#x5408;&#x5E76;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x3002;</span><br><span class="line">    // &#x5047;&#x8BBE;&#x662F;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x6765;&#x8BBE;&#x8BA1;&#xFF0C;&#x4F1A;&#x662F;&#x4EC0;&#x4E48;&#x65B9;&#x6848;&#x5462;&#x3002;</span><br><span class="line">    Vue.mixin({ beforeCreate: vuexInit })</span><br><span class="line">  } else {</span><br><span class="line">    // &#x7701;&#x7565;1.x&#x7684;&#x7248;&#x672C;&#x4EE3;&#x7801; ...</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Vuex init hook, injected into each instances init hooks list.</span><br><span class="line">   */</span><br><span class="line">  function vuexInit () {</span><br><span class="line">    const options = this.$options</span><br><span class="line">    // store injection</span><br><span class="line">    // store &#x6CE8;&#x5165;&#x5230;&#x6BCF;&#x4E00;&#x4E2A;Vue&#x7684;&#x5B9E;&#x4F8B;&#x4E2D;</span><br><span class="line">    if (options.store) {</span><br><span class="line">      this.$store = typeof options.store === &apos;function&apos;</span><br><span class="line">        ? options.store()</span><br><span class="line">        : options.store</span><br><span class="line">    } else if (options.parent &amp;&amp; options.parent.$store) {</span><br><span class="line">      this.$store = options.parent.$store</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x6700;&#x7EC8;&#x6BCF;&#x4E2A;<code>Vue</code>&#x7684;&#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;&#xFF0C;&#x90FD;&#x6709;&#x4E00;&#x4E2A;<code>$store</code>&#x5C5E;&#x6027;&#x3002;&#x4E14;&#x662F;&#x540C;&#x4E00;&#x4E2A;<code>Store</code>&#x5B9E;&#x4F8B;&#x3002;  </p>
<p>&#x7528;&#x8D2D;&#x7269;&#x8F66;&#x7684;&#x4F8B;&#x5B50;&#x6765;&#x4E3E;&#x4F8B;&#x5C31;&#x662F;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;const vm = new Vue({</span><br><span class="line">  el: &apos;#app&apos;,</span><br><span class="line">  store,</span><br><span class="line">  render: h =&gt; h(App)</span><br><span class="line">})</span><br><span class="line">console.log(&apos;vm.$store === vm.$children[0].$store&apos;, vm.$store === vm.$children[0].$store)</span><br><span class="line">// true</span><br><span class="line">console.log(&apos;vm.$store === vm.$children[0].$children[0].$store&apos;, vm.$store === vm.$children[0].$children[0].$store)</span><br><span class="line">// true</span><br><span class="line">console.log(&apos;vm.$store === vm.$children[0].$children[1].$store&apos;, vm.$store === vm.$children[0].$children[1].$store)</span><br><span class="line">// true</span><br></pre></td></tr></table></figure>

<h2 id="Vuex-Store-&#x6784;&#x9020;&#x51FD;&#x6570;"><a href="#Vuex-Store-&#x6784;&#x9020;&#x51FD;&#x6570;" class="headerlink" title="Vuex.Store &#x6784;&#x9020;&#x51FD;&#x6570;"></a>Vuex.Store &#x6784;&#x9020;&#x51FD;&#x6570;</h2><p>&#x5148;&#x770B;&#x6700;&#x7EC8; <code>new Vuex.Store</code> &#x4E4B;&#x540E;&#x7684; <code>Store</code> &#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;&#x5173;&#x7CFB;&#x56FE;&#xFF1A;&#x5148;&#x5927;&#x81F4;&#x6709;&#x4E2A;&#x5370;&#x8C61;&#x3002;<br><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/83330fe308d6dabf2ad452d22695995b8a40638de307368366b2387c433264d8" alt="new Vuex.Store&#x4E4B;&#x540E;&#x7684; Store &#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;&#x5173;&#x7CFB;&#x56FE;"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;export class Store {</span><br><span class="line">  constructor (options = {}) {</span><br><span class="line">    // &#x8FD9;&#x4E2A;&#x6784;&#x9020;&#x51FD;&#x6570;&#x6BD4;&#x8F83;&#x957F;&#xFF0C;&#x8FD9;&#x91CC;&#x7701;&#x7565;&#xFF0C;&#x540E;&#x6587;&#x5206;&#x5F00;&#x7EC6;&#x8FF0;</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;if (!Vue &amp;&amp; typeof window !== &apos;undefined&apos; &amp;&amp; window.Vue) {</span><br><span class="line">  install(window.Vue)</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5982;&#x679C;&#x662F; <code>cdn script</code> &#x65B9;&#x5F0F;&#x5F15;&#x5165;<code>vuex</code>&#x63D2;&#x4EF6;&#xFF0C;&#x5219;&#x81EA;&#x52A8;&#x5B89;&#x88C5;<code>vuex</code>&#x63D2;&#x4EF6;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x7528;<code>Vue.use(Vuex)</code>&#x6765;&#x5B89;&#x88C5;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// asset &#x51FD;&#x6570;&#x5B9E;&#x73B0;</span><br><span class="line">export function assert (condition, msg) {</span><br><span class="line">  if (!condition) throw new Error(`[vuex] ${msg}`)</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;if (process.env.NODE_ENV !== &apos;production&apos;) {</span><br><span class="line">  // &#x53EF;&#x80FD;&#x6709;&#x8BFB;&#x8005;&#x4F1A;&#x95EE;&#xFF1A;&#x4E3A;&#x5565;&#x4E0D;&#x7528; console.assert&#xFF0C;console.assert &#x51FD;&#x6570;&#x62A5;&#x9519;&#x4E0D;&#x4F1A;&#x963B;&#x6B62;&#x540E;&#x7EED;&#x4EE3;&#x7801;&#x6267;&#x884C;</span><br><span class="line">  assert(Vue, `must call Vue.use(Vuex) before creating a store instance.`)</span><br><span class="line">  assert(typeof Promise !== &apos;undefined&apos;, `vuex requires a Promise polyfill in this browser.`)</span><br><span class="line">  assert(this instanceof Store, `store must be called with the new operator.`)</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x6761;&#x4EF6;&#x65AD;&#x8A00;&#xFF1A;&#x4E0D;&#x6EE1;&#x8DB3;&#x76F4;&#x63A5;&#x629B;&#x51FA;&#x9519;&#x8BEF;</p>
<blockquote>
<p>1.&#x5FC5;&#x987B;&#x4F7F;&#x7528; <code>Vue.use(Vuex)</code> &#x521B;&#x5EFA; <code>store</code> &#x5B9E;&#x4F8B;&#x3002;  </p>
<p>2.&#x5F53;&#x524D;&#x73AF;&#x5883;&#x4E0D;&#x652F;&#x6301;<code>Promise</code>&#xFF0C;&#x62A5;&#x9519;&#xFF1A;<code>vuex</code> &#x9700;&#x8981; <code>Promise polyfill</code>&#x3002;  </p>
<p>3.<code>Store</code> &#x51FD;&#x6570;&#x5FC5;&#x987B;&#x4F7F;&#x7528; <code>new</code> &#x64CD;&#x4F5C;&#x7B26;&#x8C03;&#x7528;&#x3002;</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;const {</span><br><span class="line">  // &#x63D2;&#x4EF6;&#x9ED8;&#x8BA4;&#x662F;&#x7A7A;&#x6570;&#x7EC4;</span><br><span class="line">  plugins = [],</span><br><span class="line">  // &#x4E25;&#x683C;&#x6A21;&#x5F0F;&#x9ED8;&#x8BA4;&#x662F;false</span><br><span class="line">  strict = false</span><br><span class="line">} = options</span><br></pre></td></tr></table></figure>

<p>&#x4ECE;&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x7684;<code>new Vuex.Store(options)</code><br>&#x53D6;&#x51FA;<code>plugins</code>&#x548C;<code>strict</code>&#x53C2;&#x6570;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// store internal state</span><br><span class="line">// store &#x5B9E;&#x4F8B;&#x5BF9;&#x8C61; &#x5185;&#x90E8;&#x7684; state</span><br><span class="line">this._committing = false</span><br><span class="line">// &#x7528;&#x6765;&#x5B58;&#x653E;&#x5904;&#x7406;&#x540E;&#x7684;&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x7684;actoins</span><br><span class="line">this._actions = Object.create(null)</span><br><span class="line">// &#x7528;&#x6765;&#x5B58;&#x653E; actions &#x8BA2;&#x9605;</span><br><span class="line">this._actionSubscribers = []</span><br><span class="line">// &#x7528;&#x6765;&#x5B58;&#x653E;&#x5904;&#x7406;&#x540E;&#x7684;&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x7684;mutations</span><br><span class="line">this._mutations = Object.create(null)</span><br><span class="line">// &#x7528;&#x6765;&#x5B58;&#x653E;&#x5904;&#x7406;&#x540E;&#x7684;&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x7684; getters</span><br><span class="line">this._wrappedGetters = Object.create(null)</span><br><span class="line">// &#x6A21;&#x5757;&#x6536;&#x96C6;&#x5668;&#xFF0C;&#x6784;&#x9020;&#x6A21;&#x5757;&#x6811;&#x5F62;&#x7ED3;&#x6784;</span><br><span class="line">this._modules = new ModuleCollection(options)</span><br><span class="line">// &#x7528;&#x4E8E;&#x5B58;&#x50A8;&#x6A21;&#x5757;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x7684;&#x5173;&#x7CFB;</span><br><span class="line">this._modulesNamespaceMap = Object.create(null)</span><br><span class="line">// &#x8BA2;&#x9605;</span><br><span class="line">this._subscribers = []</span><br><span class="line">// &#x7528;&#x4E8E;&#x4F7F;&#x7528; $watch &#x89C2;&#x6D4B; getters</span><br><span class="line">this._watcherVM = new Vue()</span><br><span class="line">// &#x7528;&#x6765;&#x5B58;&#x653E;&#x751F;&#x6210;&#x7684;&#x672C;&#x5730; getters &#x7684;&#x7F13;&#x5B58;</span><br><span class="line">this._makeLocalGettersCache = Object.create(null)</span><br></pre></td></tr></table></figure>

<p>&#x58F0;&#x660E;<code>Store</code>&#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;&#x4E00;&#x4E9B;&#x5185;&#x90E8;&#x53D8;&#x91CF;&#x3002;&#x7528;&#x4E8E;&#x5B58;&#x653E;&#x5904;&#x7406;&#x540E;&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x7684;<code>actions</code>&#x3001;<code>mutations</code>&#x3001;<code>getters</code>&#x7B49;&#x53D8;&#x91CF;&#x3002;</p>
<blockquote>
<p>&#x63D0;&#x4E00;&#x4E0B; <code>Object.create(null)</code> &#x548C; <code>{}</code> &#x7684;&#x533A;&#x522B;&#x3002;&#x524D;&#x8005;&#x6CA1;&#x6709;&#x539F;&#x578B;&#x94FE;&#xFF0C;&#x540E;&#x8005;&#x6709;&#x3002;<br>&#x5373; <code>Object.create(null).__proto__</code>&#x662F; <code>undefined</code><br><code>({}).__proto__</code> &#x662F; <code>Object.prototype</code></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// bind commit and dispatch to self</span><br><span class="line">const store = this</span><br><span class="line">const { dispatch, commit } = this</span><br><span class="line">this.dispatch = function boundDispatch (type, payload) {</span><br><span class="line">  return dispatch.call(store, type, payload)</span><br><span class="line">}</span><br><span class="line">this.commit = function boundCommit (type, payload, options) {</span><br><span class="line">  return commit.call(store, type, payload, options)</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x7ED9;&#x81EA;&#x5DF1; &#x7ED1;&#x5B9A; <code>commit</code> &#x548C; <code>dispatch</code></p>
<blockquote>
<p>&#x4E3A;&#x4F55;&#x8981;&#x8FD9;&#x6837;&#x7ED1;&#x5B9A; ?  </p>
<p>&#x8BF4;&#x660E;&#x8C03;&#x7528; <code>commit</code> &#x548C; <code>dispach</code> &#x7684; <code>this</code> &#x4E0D;&#x4E00;&#x5B9A;&#x662F; <code>store</code> &#x5B9E;&#x4F8B;  </p>
<p>&#x8FD9;&#x662F;&#x786E;&#x4FDD;&#x8FD9;&#x4E24;&#x4E2A;&#x51FD;&#x6570;&#x91CC;&#x7684; <code>this</code> &#x662F; <code>store</code> &#x5B9E;&#x4F8B;</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// &#x4E25;&#x683C;&#x6A21;&#x5F0F;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F;false</span><br><span class="line">this.strict = strict</span><br><span class="line">// &#x6839;&#x6A21;&#x5757;&#x7684;state</span><br><span class="line">const state = this._modules.root.state</span><br><span class="line">// init root module.</span><br><span class="line">// this also recursively registers all sub-modules</span><br><span class="line">// and collects all module getters inside this._wrappedGetters</span><br><span class="line">installModule(this, state, [], this._modules.root)</span><br><span class="line">// initialize the store vm, which is responsible for the reactivity</span><br><span class="line">// (also registers _wrappedGetters as computed properties)</span><br><span class="line">resetStoreVM(this, state)</span><br></pre></td></tr></table></figure>

<p>&#x4E0A;&#x8FF0;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;<br><code>installModule(this, state, [], this._modules.root)</code>  </p>
<blockquote>
<p>&#x521D;&#x59CB;&#x5316; &#x6839;&#x6A21;&#x5757;&#x3002;  </p>
<p>&#x5E76;&#x4E14;&#x4E5F;&#x9012;&#x5F52;&#x7684;&#x6CE8;&#x518C;&#x6240;&#x6709;&#x5B50;&#x6A21;&#x5757;&#x3002;  </p>
<p>&#x5E76;&#x4E14;&#x6536;&#x96C6;&#x6240;&#x6709;&#x6A21;&#x5757;&#x7684; <code>getters</code> &#x653E;&#x5728; <code>this._wrappedGetters</code> &#x91CC;&#x9762;&#x3002;</p>
</blockquote>
<p><code>resetStoreVM(this, state)</code>  </p>
<blockquote>
<p>&#x521D;&#x59CB;&#x5316; <code>store._vm</code> &#x54CD;&#x5E94;&#x5F0F;&#x7684;  </p>
<p>&#x5E76;&#x4E14;&#x6CE8;&#x518C; <code>_wrappedGetters</code> &#x4F5C;&#x4E3A; <code>computed</code> &#x7684;&#x5C5E;&#x6027;</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;plugins.forEach(plugin =&gt; plugin(this))</span><br></pre></td></tr></table></figure>

<p>&#x63D2;&#x4EF6;&#xFF1A;&#x628A;&#x5B9E;&#x4F8B;&#x5BF9;&#x8C61; <code>store</code> &#x4F20;&#x7ED9;&#x63D2;&#x4EF6;&#x51FD;&#x6570;&#xFF0C;&#x6267;&#x884C;&#x6240;&#x6709;&#x63D2;&#x4EF6;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;const useDevtools = options.devtools !== undefined ? options.devtools : Vue.config.devtools</span><br><span class="line">if (useDevtools) {</span><br><span class="line">  devtoolPlugin(this)</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x521D;&#x59CB;&#x5316; <code>vue-devtool</code> &#x5F00;&#x53D1;&#x5DE5;&#x5177;&#x3002;  </p>
<p>&#x53C2;&#x6570; <code>devtools</code> &#x4F20;&#x9012;&#x4E86;&#x53D6; <code>devtools</code> &#x5426;&#x5219;&#x53D6;<code>Vue.config.devtools</code> &#x914D;&#x7F6E;&#x3002;</p>
<p>&#x521D;&#x8BFB;&#x8FD9;&#x4E2A;&#x6784;&#x9020;&#x51FD;&#x6570;&#x7684;&#x5168;&#x90E8;&#x6E90;&#x4EE3;&#x7801;&#x3002;&#x4F1A;&#x53D1;&#x73B0;&#x6709;&#x4E09;&#x4E2A;&#x5730;&#x65B9;&#x9700;&#x8981;&#x91CD;&#x70B9;&#x770B;&#x3002;&#x5206;&#x522B;&#x662F;&#xFF1A;  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;this._modules = new ModuleCollection(options)</span><br><span class="line">installModule(this, state, [], this._modules.root)</span><br><span class="line">resetStoreVM(this, state)</span><br></pre></td></tr></table></figure>

<p>&#x9605;&#x8BFB;&#x65F6;&#x53EF;&#x4EE5;&#x65AD;&#x70B9;&#x8C03;&#x8BD5;&#xFF0C;&#x8D4B;&#x503C;&#x8BED;&#x53E5;<code>this._modules = new ModuleCollection(options)</code>&#xFF0C;&#x5982;&#x679C;&#x6682;&#x65F6;&#x4E0D;&#x60F3;&#x770B;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x770B;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x3002;<code>installModule</code>&#xFF0C;<code>resetStoreVM</code>&#x51FD;&#x6570;&#x5219;&#x53EF;&#x4EE5;&#x65AD;&#x70B9;&#x8C03;&#x8BD5;&#x3002;</p>
<h3 id="class-ModuleCollection"><a href="#class-ModuleCollection" class="headerlink" title="class ModuleCollection"></a>class ModuleCollection</h3><p>&#x6536;&#x96C6;&#x6A21;&#x5757;&#xFF0C;&#x6784;&#x9020;&#x6A21;&#x5757;&#x6811;&#x7ED3;&#x6784;&#x3002;</p>
<blockquote>
<p>&#x6CE8;&#x518C;&#x6839;&#x6A21;&#x5757; &#x53C2;&#x6570; <code>rawRootModule</code> &#x4E5F;&#x5C31;&#x662F; <code>Vuex.Store</code> &#x7684; <code>options</code> &#x53C2;&#x6570;  </p>
<p>&#x672A;&#x52A0;&#x5DE5;&#x8FC7;&#x7684;&#x6A21;&#x5757;&#xFF08;&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#xFF09;&#xFF0C;&#x6839;&#x6A21;&#x5757;</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;export default class ModuleCollection {</span><br><span class="line">  constructor (rawRootModule) {</span><br><span class="line">    // register root module (Vuex.Store options)</span><br><span class="line">    this.register([], rawRootModule, false)</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;/**</span><br><span class="line">  * &#x6CE8;&#x518C;&#x6A21;&#x5757;</span><br><span class="line">  * @param {Array} path &#x8DEF;&#x5F84;</span><br><span class="line">  * @param {Object} rawModule &#x539F;&#x59CB;&#x672A;&#x52A0;&#x5DE5;&#x7684;&#x6A21;&#x5757;</span><br><span class="line">  * @param {Boolean} runtime runtime &#x9ED8;&#x8BA4;&#x662F; true</span><br><span class="line">  */</span><br><span class="line">register (path, rawModule, runtime = true) {</span><br><span class="line">  // &#x975E;&#x751F;&#x4EA7;&#x73AF;&#x5883; &#x65AD;&#x8A00;&#x5224;&#x65AD;&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x6A21;&#x5757;&#x662F;&#x5426;&#x7B26;&#x5408;&#x8981;&#x6C42;</span><br><span class="line">  if (process.env.NODE_ENV !== &apos;production&apos;) {</span><br><span class="line">    assertRawModule(path, rawModule)</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  const newModule = new Module(rawModule, runtime)</span><br><span class="line">  if (path.length === 0) {</span><br><span class="line">    this.root = newModule</span><br><span class="line">  } else {</span><br><span class="line">    const parent = this.get(path.slice(0, -1))</span><br><span class="line">    parent.addChild(path[path.length - 1], newModule)</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  // register nested modules</span><br><span class="line">  // &#x9012;&#x5F52;&#x6CE8;&#x518C;&#x5B50;&#x6A21;&#x5757;</span><br><span class="line">  if (rawModule.modules) {</span><br><span class="line">    forEachValue(rawModule.modules, (rawChildModule, key) =&gt; {</span><br><span class="line">      this.register(path.concat(key), rawChildModule, runtime)</span><br><span class="line">    })</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="class-Module"><a href="#class-Module" class="headerlink" title="class Module"></a>class Module</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// Base data struct for store&apos;s module, package with some attribute and method</span><br><span class="line">// store &#x7684;&#x6A21;&#x5757; &#x57FA;&#x7840;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF0C;&#x5305;&#x62EC;&#x4E00;&#x4E9B;&#x5C5E;&#x6027;&#x548C;&#x65B9;&#x6CD5;</span><br><span class="line">export default class Module {</span><br><span class="line">  constructor (rawModule, runtime) {</span><br><span class="line">    // &#x63A5;&#x6536;&#x53C2;&#x6570; runtime</span><br><span class="line">    this.runtime = runtime</span><br><span class="line">    // Store some children item</span><br><span class="line">    // &#x5B58;&#x50A8;&#x5B50;&#x6A21;&#x5757;</span><br><span class="line">    this._children = Object.create(null)</span><br><span class="line">    // Store the origin module object which passed by programmer</span><br><span class="line">    // &#x5B58;&#x50A8;&#x539F;&#x59CB;&#x672A;&#x52A0;&#x5DE5;&#x7684;&#x6A21;&#x5757;</span><br><span class="line">    this._rawModule = rawModule</span><br><span class="line">    // &#x6A21;&#x5757; state</span><br><span class="line">    const rawState = rawModule.state</span><br><span class="line"></span><br><span class="line">    // Store the origin module&apos;s state</span><br><span class="line">    // &#x539F;&#x59CB;Store &#x53EF;&#x80FD;&#x662F;&#x51FD;&#x6570;&#xFF0C;&#x4E5F;&#x53EF;&#x80FD;&#x662F;&#x662F;&#x5BF9;&#x8C61;&#xFF0C;&#x662F;&#x5047;&#x503C;&#xFF0C;&#x5219;&#x8D4B;&#x503C;&#x7A7A;&#x5BF9;&#x8C61;&#x3002;</span><br><span class="line">    this.state = (typeof rawState === &apos;function&apos; ? rawState() : rawState) || {}</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x7ECF;&#x8FC7;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x6CE8;&#x518C;&#x540E;&#xFF0C;&#x6700;&#x540E;<br><code>this._modules = new ModuleCollection(options)</code><br><code>this._modules</code> &#x7684;&#x503C;&#x662F;&#x8FD9;&#x6837;&#x7684;&#x3002;<br>&#x7B14;&#x8005;&#x753B;&#x4E86;&#x4E00;&#x5F20;&#x56FE;&#x8868;&#x793A;&#xFF1A;<br><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/db958b728e0fa7a59b7add921d26f95a3bd6b7c3c5b45637b4489dd1fd483f95" alt="ModuleCollection"></p>
<h3 id="installModule-&#x51FD;&#x6570;"><a href="#installModule-&#x51FD;&#x6570;" class="headerlink" title="installModule &#x51FD;&#x6570;"></a>installModule &#x51FD;&#x6570;</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function installModule (store, rootState, path, module, hot) {</span><br><span class="line">  // &#x662F;&#x6839;&#x6A21;&#x5757;</span><br><span class="line">  const isRoot = !path.length</span><br><span class="line">  // &#x547D;&#x540D;&#x7A7A;&#x95F4; &#x5B57;&#x7B26;&#x4E32;</span><br><span class="line">  const namespace = store._modules.getNamespace(path)</span><br><span class="line">  if (module.namespaced) {</span><br><span class="line">    // &#x7701;&#x7565;&#x4EE3;&#x7801;&#xFF1A; &#x6A21;&#x5757;&#x547D;&#x540D;&#x7A7A;&#x95F4;map&#x5BF9;&#x8C61;&#x4E2D;&#x5DF2;&#x7ECF;&#x6709;&#x4E86;&#xFF0C;&#x5F00;&#x53D1;&#x73AF;&#x5883;&#x62A5;&#x9519;&#x63D0;&#x793A;&#x91CD;&#x590D;</span><br><span class="line">    // module &#x8D4B;&#x503C;&#x7ED9; _modulesNamespaceMap[namespace]</span><br><span class="line">    store._modulesNamespaceMap[namespace] = module</span><br><span class="line">  }</span><br><span class="line">  // ... &#x540E;&#x7EED;&#x4EE3;&#x7801; &#x79FB;&#x51FA;&#x6765; &#x5F85;&#x8BFB;&#x89E3;&#x91CA;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="&#x6CE8;&#x518C;-state"><a href="#&#x6CE8;&#x518C;-state" class="headerlink" title="&#x6CE8;&#x518C; state"></a>&#x6CE8;&#x518C; state</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// set state</span><br><span class="line">// &#x4E0D;&#x662F;&#x6839;&#x6A21;&#x5757;&#x4E14;&#x4E0D;&#x662F;&#x70ED;&#x91CD;&#x8F7D;</span><br><span class="line">if (!isRoot &amp;&amp; !hot) {</span><br><span class="line">  // &#x83B7;&#x53D6;&#x7236;&#x7EA7;&#x7684;state</span><br><span class="line">  const parentState = getNestedState(rootState, path.slice(0, -1))</span><br><span class="line">  // &#x6A21;&#x5757;&#x540D;&#x79F0;</span><br><span class="line">  // &#x6BD4;&#x5982; cart</span><br><span class="line">  const moduleName = path[path.length - 1]</span><br><span class="line">  // state &#x6CE8;&#x518C;</span><br><span class="line">  store._withCommit(() =&gt; {</span><br><span class="line">    // &#x7701;&#x7565;&#x4EE3;&#x7801;&#xFF1A;&#x975E;&#x751F;&#x4EA7;&#x73AF;&#x5883; &#x62A5;&#x9519; &#x6A21;&#x5757; state &#x91CD;&#x590D;&#x8BBE;&#x7F6E;</span><br><span class="line">    Vue.set(parentState, moduleName, module.state)</span><br><span class="line">  })</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x6700;&#x540E;&#x5F97;&#x5230;&#x7684;&#x662F;&#x7C7B;&#x4F3C;&#x8FD9;&#x6837;&#x7684;&#x7ED3;&#x6784;&#x4E14;&#x662F;&#x54CD;&#x5E94;&#x5F0F;&#x7684;&#x6570;&#x636E; &#x5B9E;&#x4F8B; Store.state &#x6BD4;&#x5982;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;{</span><br><span class="line">  // &#x7701;&#x7565;&#x82E5;&#x5E72;&#x5C5E;&#x6027;&#x548C;&#x65B9;&#x6CD5;</span><br><span class="line">  // &#x8FD9;&#x91CC;&#x7684; state &#x662F;&#x53EA;&#x8BFB;&#x5C5E;&#x6027; &#x53EF;&#x641C;&#x7D22; get state &#x67E5;&#x770B;&#xFF0C;&#x4E0A;&#x6587;&#x5199;&#x8FC7;</span><br><span class="line">  state: {</span><br><span class="line">    cart: {</span><br><span class="line">      checkoutStatus: null,</span><br><span class="line">      items: []</span><br><span class="line">    }</span><br><span class="line"> }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;const local = module.context = makeLocalContext(store, namespace, path)</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>module.context</code> &#x8FD9;&#x4E2A;&#x8D4B;&#x503C;&#x4E3B;&#x8981;&#x662F;&#x7ED9; <code>helpers</code> &#x4E2D; <code>mapState</code>&#x3001;<code>mapGetters</code>&#x3001;<code>mapMutations</code>&#x3001;<code>mapActions</code>&#x56DB;&#x4E2A;&#x8F85;&#x52A9;&#x51FD;&#x6570;&#x4F7F;&#x7528;&#x7684;&#x3002;  </p>
<p>&#x751F;&#x6210;&#x672C;&#x5730;&#x7684;dispatch&#x3001;commit&#x3001;getters&#x548C;state&#x3002;  </p>
<p>&#x4E3B;&#x8981;&#x4F5C;&#x7528;&#x5C31;&#x662F;&#x62B9;&#x5E73;&#x5DEE;&#x5F02;&#x5316;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x7528;&#x6237;&#x518D;&#x4F20;&#x6A21;&#x5757;&#x53C2;&#x6570;&#x3002;</p>
</blockquote>
<h4 id="&#x904D;&#x5386;&#x6CE8;&#x518C;-mutation"><a href="#&#x904D;&#x5386;&#x6CE8;&#x518C;-mutation" class="headerlink" title="&#x904D;&#x5386;&#x6CE8;&#x518C; mutation"></a>&#x904D;&#x5386;&#x6CE8;&#x518C; mutation</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;module.forEachMutation((mutation, key) =&gt; {</span><br><span class="line">  const namespacedType = namespace + key</span><br><span class="line">  registerMutation(store, namespacedType, mutation, local)</span><br><span class="line">})</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;/**</span><br><span class="line"> * &#x6CE8;&#x518C; mutation</span><br><span class="line"> * @param {Object} store &#x5BF9;&#x8C61;</span><br><span class="line"> * @param {String} type &#x7C7B;&#x578B;</span><br><span class="line"> * @param {Function} handler &#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x51FD;&#x6570;</span><br><span class="line"> * @param {Object} local local &#x5BF9;&#x8C61;</span><br><span class="line"> */</span><br><span class="line">function registerMutation (store, type, handler, local) {</span><br><span class="line">  // &#x6536;&#x96C6;&#x7684;&#x6240;&#x6709;&#x7684;mutations&#x627E;&#x5BF9;&#x5E94;&#x7684;mutation&#x51FD;&#x6570;&#xFF0C;&#x6CA1;&#x6709;&#x5C31;&#x8D4B;&#x503C;&#x7A7A;&#x6570;&#x7EC4;</span><br><span class="line">  const entry = store._mutations[type] || (store._mutations[type] = [])</span><br><span class="line">  // &#x6700;&#x540E; mutation</span><br><span class="line">  entry.push(function wrappedMutationHandler (payload) {</span><br><span class="line">    /**</span><br><span class="line">     * mutations: {</span><br><span class="line">     *    pushProductToCart (state, { id }) {</span><br><span class="line">     *        console.log(state);</span><br><span class="line">     *    }</span><br><span class="line">     * }</span><br><span class="line">     * &#x4E5F;&#x5C31;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x7684; mutation &#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x662F;state&#x7684;&#x539F;&#x56E0;&#xFF0C;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#x662F;payload&#x53C2;&#x6570;</span><br><span class="line">     */</span><br><span class="line">    handler.call(store, local.state, payload)</span><br><span class="line">  })</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="&#x904D;&#x5386;&#x6CE8;&#x518C;-action"><a href="#&#x904D;&#x5386;&#x6CE8;&#x518C;-action" class="headerlink" title="&#x904D;&#x5386;&#x6CE8;&#x518C; action"></a>&#x904D;&#x5386;&#x6CE8;&#x518C; action</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;module.forEachAction((action, key) =&gt; {</span><br><span class="line">  const type = action.root ? key : namespace + key</span><br><span class="line">  const handler = action.handler || action</span><br><span class="line">  registerAction(store, type, handler, local)</span><br><span class="line">})</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;/**</span><br><span class="line">* &#x6CE8;&#x518C; mutation</span><br><span class="line">* @param {Object} store &#x5BF9;&#x8C61;</span><br><span class="line">* @param {String} type &#x7C7B;&#x578B;</span><br><span class="line">* @param {Function} handler &#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x51FD;&#x6570;</span><br><span class="line">* @param {Object} local local &#x5BF9;&#x8C61;</span><br><span class="line">*/</span><br><span class="line">function registerAction (store, type, handler, local) {</span><br><span class="line">  const entry = store._actions[type] || (store._actions[type] = [])</span><br><span class="line">  // payload &#x662F;actions&#x51FD;&#x6570;&#x7684;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;</span><br><span class="line">  entry.push(function wrappedActionHandler (payload) {</span><br><span class="line">    /**</span><br><span class="line">     * &#x4E5F;&#x5C31;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x7684;actions&#x4E2D;&#x7684;&#x51FD;&#x6570;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x6709;</span><br><span class="line">     *  { dispatch, commit, getters, state, rootGetters, rootState } &#x7684;&#x539F;&#x56E0;</span><br><span class="line">     * actions: {</span><br><span class="line">     *    checkout ({ commit, state }, products) {</span><br><span class="line">     *        console.log(commit, state);</span><br><span class="line">     *    }</span><br><span class="line">     * }</span><br><span class="line">     */</span><br><span class="line">    let res = handler.call(store, {</span><br><span class="line">      dispatch: local.dispatch,</span><br><span class="line">      commit: local.commit,</span><br><span class="line">      getters: local.getters,</span><br><span class="line">      state: local.state,</span><br><span class="line">      rootGetters: store.getters,</span><br><span class="line">      rootState: store.state</span><br><span class="line">    }, payload)</span><br><span class="line">    /**</span><br><span class="line">     * export function isPromise (val) {</span><br><span class="line">        return val &amp;&amp; typeof val.then === &apos;function&apos;</span><br><span class="line">      }</span><br><span class="line">     * &#x5224;&#x65AD;&#x5982;&#x679C;&#x4E0D;&#x662F;Promise Promise &#x5316;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x4E3A;&#x5565; actions &#x4E2D;&#x5904;&#x7406;&#x5F02;&#x6B65;&#x51FD;&#x6570;</span><br><span class="line">        &#x4E5F;&#x5C31;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x6784;&#x9020;&#x51FD;&#x6570;&#x4E2D;&#x65AD;&#x8A00;&#x4E0D;&#x652F;&#x6301;promise&#x62A5;&#x9519;&#x7684;&#x539F;&#x56E0;</span><br><span class="line">        vuex&#x9700;&#x8981;Promise polyfill</span><br><span class="line">        assert(typeof Promise !== &apos;undefined&apos;, `vuex requires a Promise polyfill in this browser.`)</span><br><span class="line">     */</span><br><span class="line">    if (!isPromise(res)) {</span><br><span class="line">      res = Promise.resolve(res)</span><br><span class="line">    }</span><br><span class="line">    // devtool &#x5DE5;&#x5177;&#x89E6;&#x53D1; vuex:error</span><br><span class="line">    if (store._devtoolHook) {</span><br><span class="line">      // catch &#x6355;&#x83B7;&#x9519;&#x8BEF;</span><br><span class="line">      return res.catch(err =&gt; {</span><br><span class="line">        store._devtoolHook.emit(&apos;vuex:error&apos;, err)</span><br><span class="line">        // &#x629B;&#x51FA;&#x9519;&#x8BEF;</span><br><span class="line">        throw err</span><br><span class="line">      })</span><br><span class="line">    } else {</span><br><span class="line">      // &#x7136;&#x540E;&#x51FD;&#x6570;&#x6267;&#x884C;&#x7ED3;&#x679C;</span><br><span class="line">      return res</span><br><span class="line">    }</span><br><span class="line">  })</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="&#x904D;&#x5386;&#x6CE8;&#x518C;-getter"><a href="#&#x904D;&#x5386;&#x6CE8;&#x518C;-getter" class="headerlink" title="&#x904D;&#x5386;&#x6CE8;&#x518C; getter"></a>&#x904D;&#x5386;&#x6CE8;&#x518C; getter</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;module.forEachGetter((getter, key) =&gt; {</span><br><span class="line">  const namespacedType = namespace + key</span><br><span class="line">  registerGetter(store, namespacedType, getter, local)</span><br><span class="line">})</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;/**</span><br><span class="line"> * &#x6CE8;&#x518C; getter</span><br><span class="line"> * @param {Object} store  Store&#x5B9E;&#x4F8B;</span><br><span class="line"> * @param {String} type &#x7C7B;&#x578B;</span><br><span class="line"> * @param {Object} rawGetter  &#x539F;&#x59CB;&#x672A;&#x52A0;&#x5DE5;&#x7684; getter &#x4E5F;&#x5C31;&#x662F;&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x7684; getter &#x51FD;&#x6570;</span><br><span class="line"> * @examples  &#x6BD4;&#x5982; cartProducts: (state, getters, rootState, rootGetters) =&gt; {}</span><br><span class="line"> * @param {Object} local &#x672C;&#x5730; local &#x5BF9;&#x8C61;</span><br><span class="line"> */</span><br><span class="line">function registerGetter (store, type, rawGetter, local) {</span><br><span class="line">  // &#x7C7B;&#x578B;&#x5982;&#x679C;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#xFF0C;&#x62A5;&#x9519;&#xFF1A;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;</span><br><span class="line">  if (store._wrappedGetters[type]) {</span><br><span class="line">    if (process.env.NODE_ENV !== &apos;production&apos;) {</span><br><span class="line">      console.error(`[vuex] duplicate getter key: ${type}`)</span><br><span class="line">    }</span><br><span class="line">    return</span><br><span class="line">  }</span><br><span class="line">  // &#x5426;&#x5219;&#xFF1A;&#x8D4B;&#x503C;</span><br><span class="line">  store._wrappedGetters[type] = function wrappedGetter (store) {</span><br><span class="line">    /**</span><br><span class="line">     * &#x8FD9;&#x4E5F;&#x5C31;&#x662F;&#x4E3A;&#x5565; getters &#x4E2D;&#x80FD;&#x83B7;&#x53D6;&#x5230;  (state, getters, rootState, rootGetters)  &#x8FD9;&#x4E9B;&#x503C;&#x7684;&#x539F;&#x56E0;</span><br><span class="line">     * getters = {</span><br><span class="line">     *      cartProducts: (state, getters, rootState, rootGetters) =&gt; {</span><br><span class="line">     *        console.log(state, getters, rootState, rootGetters);</span><br><span class="line">     *      }</span><br><span class="line">     * }</span><br><span class="line">     */</span><br><span class="line">    return rawGetter(</span><br><span class="line">      local.state, // local state</span><br><span class="line">      local.getters, // local getters</span><br><span class="line">      store.state, // root state</span><br><span class="line">      store.getters // root getters</span><br><span class="line">    )</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="&#x904D;&#x5386;&#x6CE8;&#x518C;-&#x5B50;&#x6A21;&#x5757;"><a href="#&#x904D;&#x5386;&#x6CE8;&#x518C;-&#x5B50;&#x6A21;&#x5757;" class="headerlink" title="&#x904D;&#x5386;&#x6CE8;&#x518C; &#x5B50;&#x6A21;&#x5757;"></a>&#x904D;&#x5386;&#x6CE8;&#x518C; &#x5B50;&#x6A21;&#x5757;</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;module.forEachChild((child, key) =&gt; {</span><br><span class="line">  installModule(store, rootState, path.concat(key), child, hot)</span><br><span class="line">})</span><br></pre></td></tr></table></figure>

<h3 id="resetStoreVM-&#x51FD;&#x6570;"><a href="#resetStoreVM-&#x51FD;&#x6570;" class="headerlink" title="resetStoreVM &#x51FD;&#x6570;"></a>resetStoreVM &#x51FD;&#x6570;</h3><p><code>resetStoreVM(this, state, hot)</code>  </p>
<blockquote>
<p>&#x521D;&#x59CB;&#x5316; <code>store._vm</code> &#x54CD;&#x5E94;&#x5F0F;&#x7684;  </p>
<p>&#x5E76;&#x4E14;&#x6CE8;&#x518C; <code>_wrappedGetters</code> &#x4F5C;&#x4E3A; <code>computed</code> &#x7684;&#x5C5E;&#x6027;</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function resetStoreVM (store, state, hot) {</span><br><span class="line"></span><br><span class="line">  // &#x5B58;&#x50A8;&#x4E00;&#x4EFD;&#x8001;&#x7684;Vue&#x5B9E;&#x4F8B;&#x5BF9;&#x8C61; _vm</span><br><span class="line">  const oldVm = store._vm</span><br><span class="line"></span><br><span class="line">  // bind store public getters</span><br><span class="line">  // &#x7ED1;&#x5B9A; store.getter</span><br><span class="line">  store.getters = {}</span><br><span class="line">  // reset local getters cache</span><br><span class="line">  // &#x91CD;&#x7F6E; &#x672C;&#x5730;getters&#x7684;&#x7F13;&#x5B58;</span><br><span class="line">  store._makeLocalGettersCache = Object.create(null)</span><br><span class="line">  // &#x6CE8;&#x518C;&#x65F6;&#x6536;&#x96C6;&#x7684;&#x5904;&#x7406;&#x540E;&#x7684;&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x7684; wrappedGetters</span><br><span class="line">  const wrappedGetters = store._wrappedGetters</span><br><span class="line">  // &#x58F0;&#x660E; &#x8BA1;&#x7B97;&#x5C5E;&#x6027; computed &#x5BF9;&#x8C61;</span><br><span class="line">  const computed = {}</span><br><span class="line">  // &#x904D;&#x5386; wrappedGetters &#x8D4B;&#x503C;&#x5230; computed &#x4E0A;</span><br><span class="line">  forEachValue(wrappedGetters, (fn, key) =&gt; {</span><br><span class="line">    // use computed to leverage its lazy-caching mechanism</span><br><span class="line">    // direct inline function use will lead to closure preserving oldVm.</span><br><span class="line">    // using partial to return function with only arguments preserved in closure environment.</span><br><span class="line">    /**</span><br><span class="line">     * partial &#x51FD;&#x6570;</span><br><span class="line">     * &#x6267;&#x884C;&#x51FD;&#x6570; &#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x65B0;&#x51FD;&#x6570;</span><br><span class="line">        export function partial (fn, arg) {</span><br><span class="line">          return function () {</span><br><span class="line">            return fn(arg)</span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">     */</span><br><span class="line">    computed[key] = partial(fn, store)</span><br><span class="line">    // getter &#x8D4B;&#x503C; keys</span><br><span class="line">    Object.defineProperty(store.getters, key, {</span><br><span class="line">      get: () =&gt; store._vm[key],</span><br><span class="line">      // &#x53EF;&#x4EE5;&#x679A;&#x4E3E;</span><br><span class="line">      enumerable: true // for local getters</span><br><span class="line">    })</span><br><span class="line">  })</span><br><span class="line"></span><br><span class="line">  // use a Vue instance to store the state tree</span><br><span class="line">  // suppress warnings just in case the user has added</span><br><span class="line">  // some funky global mixins</span><br><span class="line">  // &#x4F7F;&#x7528;&#x4E00;&#x4E2A; Vue &#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;&#x5B58;&#x50A8; state &#x6811;</span><br><span class="line">  // &#x963B;&#x6B62;&#x8B66;&#x544A; &#x7528;&#x6237;&#x6DFB;&#x52A0;&#x7684;&#x4E00;&#x4E9B;&#x5168;&#x5C40;mixins</span><br><span class="line"></span><br><span class="line">  // &#x58F0;&#x660E;&#x53D8;&#x91CF; silent &#x5B58;&#x50A8;&#x7528;&#x6237;&#x8BBE;&#x7F6E;&#x7684;&#x9759;&#x9ED8;&#x6A21;&#x5F0F;&#x914D;&#x7F6E;</span><br><span class="line">  const silent = Vue.config.silent</span><br><span class="line">  // &#x9759;&#x9ED8;&#x6A21;&#x5F0F;&#x5F00;&#x542F;</span><br><span class="line">  Vue.config.silent = true</span><br><span class="line">  store._vm = new Vue({</span><br><span class="line">    data: {</span><br><span class="line">      $state: state</span><br><span class="line">    },</span><br><span class="line">    computed</span><br><span class="line">  })</span><br><span class="line">  // &#x628A;&#x5B58;&#x50A8;&#x7684;&#x9759;&#x9ED8;&#x6A21;&#x5F0F;&#x914D;&#x7F6E;&#x8D4B;&#x503C;&#x56DE;&#x6765;</span><br><span class="line">  Vue.config.silent = silent</span><br><span class="line"></span><br><span class="line">  // enable strict mode for new vm</span><br><span class="line">  // &#x5F00;&#x542F;&#x4E25;&#x683C;&#x6A21;&#x5F0F; &#x6267;&#x884C;&#x8FD9;&#x53E5;</span><br><span class="line">  // &#x7528; $watch &#x89C2;&#x6D4B; state&#xFF0C;&#x53EA;&#x80FD;&#x4F7F;&#x7528; mutation &#x4FEE;&#x6539; &#x4E5F;&#x5C31;&#x662F; _withCommit &#x51FD;&#x6570;</span><br><span class="line">  if (store.strict) {</span><br><span class="line">    enableStrictMode(store)</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  // &#x5982;&#x679C;&#x5B58;&#x5728;&#x8001;&#x7684; _vm &#x5B9E;&#x4F8B;</span><br><span class="line">  if (oldVm) {</span><br><span class="line">    // &#x70ED;&#x52A0;&#x8F7D;&#x4E3A; true</span><br><span class="line">    if (hot) {</span><br><span class="line">      // dispatch changes in all subscribed watchers</span><br><span class="line">      // to force getter re-evaluation for hot reloading.</span><br><span class="line">      // &#x8BBE;&#x7F6E;  oldVm._data.$state = null</span><br><span class="line">      store._withCommit(() =&gt; {</span><br><span class="line">        oldVm._data.$state = null</span><br><span class="line">      })</span><br><span class="line">    }</span><br><span class="line">    // &#x5B9E;&#x4F8B;&#x9500;&#x6BC1;</span><br><span class="line">    Vue.nextTick(() =&gt; oldVm.$destroy())</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5230;&#x6B64;&#xFF0C;&#x6784;&#x9020;&#x51FD;&#x6570;&#x6E90;&#x4EE3;&#x7801;&#x770B;&#x5B8C;&#x4E86;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x770B; <code>Vuex.Store</code> &#x7684; &#x4E00;&#x4E9B; <code>API</code> &#x5B9E;&#x73B0;&#x3002;</p>
<h2 id="Vuex-Store-&#x5B9E;&#x4F8B;&#x65B9;&#x6CD5;"><a href="#Vuex-Store-&#x5B9E;&#x4F8B;&#x65B9;&#x6CD5;" class="headerlink" title="Vuex.Store &#x5B9E;&#x4F8B;&#x65B9;&#x6CD5;"></a>Vuex.Store &#x5B9E;&#x4F8B;&#x65B9;&#x6CD5;</h2><p><a href="/external_links/aaf7ad1e1281cd61d7432cf5c1e82bd0.html" target="blank" rel="noopener">Vuex API &#x6587;&#x6863;</a></p>
<h3 id="commit"><a href="#commit" class="headerlink" title="commit"></a>commit</h3><p>&#x63D0;&#x4EA4; <code>mutation</code>&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;commit (_type, _payload, _options) {</span><br><span class="line">  // check object-style commit</span><br><span class="line">  // &#x7EDF;&#x4E00;&#x6210;&#x5BF9;&#x8C61;&#x98CE;&#x683C;</span><br><span class="line">  const {</span><br><span class="line">    type,</span><br><span class="line">    payload,</span><br><span class="line">    options</span><br><span class="line">  } = unifyObjectStyle(_type, _payload, _options)</span><br><span class="line"></span><br><span class="line">  const mutation = { type, payload }</span><br><span class="line">  // &#x53D6;&#x51FA;&#x5904;&#x7406;&#x540E;&#x7684;&#x7528;&#x6237;&#x5B9A;&#x4E49; mutation</span><br><span class="line">  const entry = this._mutations[type]</span><br><span class="line">  // &#x7701;&#x7565; &#x975E;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x7684;&#x8B66;&#x544A;&#x4EE3;&#x7801; ...</span><br><span class="line">  this._withCommit(() =&gt; {</span><br><span class="line">    // &#x904D;&#x5386;&#x6267;&#x884C;</span><br><span class="line">    entry.forEach(function commitIterator (handler) {</span><br><span class="line">      handler(payload)</span><br><span class="line">    })</span><br><span class="line">  })</span><br><span class="line">  // &#x8BA2;&#x9605; mutation &#x6267;&#x884C;</span><br><span class="line">  this._subscribers.forEach(sub =&gt; sub(mutation, this.state))</span><br><span class="line"></span><br><span class="line">  // &#x7701;&#x7565; &#x975E;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x7684;&#x8B66;&#x544A;&#x4EE3;&#x7801; ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><code>commit</code> &#x652F;&#x6301;&#x591A;&#x79CD;&#x65B9;&#x5F0F;&#x3002;&#x6BD4;&#x5982;&#xFF1A;  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;store.commit(&apos;increment&apos;, {</span><br><span class="line">  count: 10</span><br><span class="line">})</span><br><span class="line">// &#x5BF9;&#x8C61;&#x63D0;&#x4EA4;&#x65B9;&#x5F0F;</span><br><span class="line">store.commit({</span><br><span class="line">  type: &apos;increment&apos;,</span><br><span class="line">  count: 10</span><br><span class="line">})</span><br></pre></td></tr></table></figure>

<p><code>unifyObjectStyle</code>&#x51FD;&#x6570;&#x5C06;&#x53C2;&#x6570;&#x7EDF;&#x4E00;&#xFF0C;&#x8FD4;&#x56DE; <code>{ type, payload, options }</code>&#x3002;</p>
<h3 id="dispatch"><a href="#dispatch" class="headerlink" title="dispatch"></a>dispatch</h3><p>&#x5206;&#x53D1; <code>action</code>&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;dispatch (_type, _payload) {</span><br><span class="line">  // check object-style dispatch</span><br><span class="line">  // &#x83B7;&#x53D6;&#x5230;type&#x548C;payload&#x53C2;&#x6570;</span><br><span class="line">  const {</span><br><span class="line">    type,</span><br><span class="line">    payload</span><br><span class="line">  } = unifyObjectStyle(_type, _payload)</span><br><span class="line"></span><br><span class="line">  // &#x58F0;&#x660E; action &#x53D8;&#x91CF; &#x7B49;&#x4E8E; type&#x548C;payload&#x53C2;&#x6570;</span><br><span class="line">  const action = { type, payload }</span><br><span class="line">  // &#x5165;&#x53E3;&#xFF0C;&#x4E5F;&#x5C31;&#x662F; _actions &#x96C6;&#x5408;</span><br><span class="line">  const entry = this._actions[type]</span><br><span class="line">  // &#x7701;&#x7565; &#x975E;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x7684;&#x8B66;&#x544A;&#x4EE3;&#x7801; ...</span><br><span class="line">  try {</span><br><span class="line">    this._actionSubscribers</span><br><span class="line">      .filter(sub =&gt; sub.before)</span><br><span class="line">      .forEach(sub =&gt; sub.before(action, this.state))</span><br><span class="line">  } catch (e) {</span><br><span class="line">    if (process.env.NODE_ENV !== &apos;production&apos;) {</span><br><span class="line">      console.warn(`[vuex] error in before action subscribers: `)</span><br><span class="line">      console.error(e)</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  const result = entry.length &gt; 1</span><br><span class="line">    ? Promise.all(entry.map(handler =&gt; handler(payload)))</span><br><span class="line">    : entry[0](payload)</span><br><span class="line"></span><br><span class="line">  return result.then(res =&gt; {</span><br><span class="line">    try {</span><br><span class="line">      this._actionSubscribers</span><br><span class="line">        .filter(sub =&gt; sub.after)</span><br><span class="line">        .forEach(sub =&gt; sub.after(action, this.state))</span><br><span class="line">    } catch (e) {</span><br><span class="line">      if (process.env.NODE_ENV !== &apos;production&apos;) {</span><br><span class="line">        console.warn(`[vuex] error in after action subscribers: `)</span><br><span class="line">        console.error(e)</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">    return res</span><br><span class="line">  })</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="replaceState"><a href="#replaceState" class="headerlink" title="replaceState"></a>replaceState</h3><p>&#x66FF;&#x6362; <code>store</code> &#x7684;&#x6839;&#x72B6;&#x6001;&#xFF0C;&#x4EC5;&#x7528;&#x72B6;&#x6001;&#x5408;&#x5E76;&#x6216;&#x65F6;&#x5149;&#x65C5;&#x884C;&#x8C03;&#x8BD5;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;replaceState (state) {</span><br><span class="line">  this._withCommit(() =&gt; {</span><br><span class="line">    this._vm._data.$state = state</span><br><span class="line">  })</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="watch"><a href="#watch" class="headerlink" title="watch"></a>watch</h3><p>&#x54CD;&#x5E94;&#x5F0F;&#x5730;&#x4FA6;&#x542C; fn &#x7684;&#x8FD4;&#x56DE;&#x503C;&#xFF0C;&#x5F53;&#x503C;&#x6539;&#x53D8;&#x65F6;&#x8C03;&#x7528;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;/**</span><br><span class="line"> * &#x89C2;&#x6D4B;&#x67D0;&#x4E2A;&#x503C;</span><br><span class="line"> * @param {Function} getter &#x51FD;&#x6570;</span><br><span class="line"> * @param {Function} cb &#x56DE;&#x8C03;</span><br><span class="line"> * @param {Object} options &#x53C2;&#x6570;&#x5BF9;&#x8C61;</span><br><span class="line"> */</span><br><span class="line">watch (getter, cb, options) {</span><br><span class="line">  if (process.env.NODE_ENV !== &apos;production&apos;) {</span><br><span class="line">    assert(typeof getter === &apos;function&apos;, `store.watch only accepts a function.`)</span><br><span class="line">  }</span><br><span class="line">  return this._watcherVM.$watch(() =&gt; getter(this.state, this.getters), cb, options)</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="subscribe"><a href="#subscribe" class="headerlink" title="subscribe"></a>subscribe</h3><p>&#x8BA2;&#x9605; <code>store</code> &#x7684; <code>mutation</code>&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;subscribe (fn) {</span><br><span class="line">  return genericSubscribe(fn, this._subscribers)</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// &#x6536;&#x96C6;&#x8BA2;&#x9605;&#x8005;</span><br><span class="line">function genericSubscribe (fn, subs) {</span><br><span class="line">  if (subs.indexOf(fn) &lt; 0) {</span><br><span class="line">    subs.push(fn)</span><br><span class="line">  }</span><br><span class="line">  return () =&gt; {</span><br><span class="line">    const i = subs.indexOf(fn)</span><br><span class="line">    if (i &gt; -1) {</span><br><span class="line">      subs.splice(i, 1)</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="subscribeAction"><a href="#subscribeAction" class="headerlink" title="subscribeAction"></a>subscribeAction</h3><p>&#x8BA2;&#x9605; <code>store</code> &#x7684; <code>action</code>&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;subscribeAction (fn) {</span><br><span class="line">  const subs = typeof fn === &apos;function&apos; ? { before: fn } : fn</span><br><span class="line">  return genericSubscribe(subs, this._actionSubscribers)</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="registerModule"><a href="#registerModule" class="headerlink" title="registerModule"></a>registerModule</h3><p>&#x6CE8;&#x518C;&#x4E00;&#x4E2A;&#x52A8;&#x6001;&#x6A21;&#x5757;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;/**</span><br><span class="line"> * &#x52A8;&#x6001;&#x6CE8;&#x518C;&#x6A21;&#x5757;</span><br><span class="line"> * @param {Array|String} path &#x8DEF;&#x5F84;</span><br><span class="line"> * @param {Object} rawModule &#x539F;&#x59CB;&#x672A;&#x52A0;&#x5DE5;&#x7684;&#x6A21;&#x5757;</span><br><span class="line"> * @param {Object} options &#x53C2;&#x6570;&#x9009;&#x9879;</span><br><span class="line"> */</span><br><span class="line">registerModule (path, rawModule, options = {}) {</span><br><span class="line">  // &#x5982;&#x679C; path &#x662F;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x8F6C;&#x6210;&#x6570;&#x7EC4;</span><br><span class="line">  if (typeof path === &apos;string&apos;) path = [path]</span><br><span class="line"></span><br><span class="line">  // &#x7701;&#x7565; &#x975E;&#x751F;&#x4EA7;&#x73AF;&#x5883; &#x62A5;&#x9519;&#x4EE3;&#x7801;</span><br><span class="line"></span><br><span class="line">  // &#x624B;&#x52A8;&#x8C03;&#x7528; &#x6A21;&#x5757;&#x6CE8;&#x518C;&#x7684;&#x65B9;&#x6CD5;</span><br><span class="line">  this._modules.register(path, rawModule)</span><br><span class="line">  // &#x5B89;&#x88C5;&#x6A21;&#x5757;</span><br><span class="line">  installModule(this, this.state, path, this._modules.get(path), options.preserveState)</span><br><span class="line">  // reset store to update getters...</span><br><span class="line">  // &#x8BBE;&#x7F6E; resetStoreVM</span><br><span class="line">  resetStoreVM(this, this.state)</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="unregisterModule"><a href="#unregisterModule" class="headerlink" title="unregisterModule"></a>unregisterModule</h3><p>&#x5378;&#x8F7D;&#x4E00;&#x4E2A;&#x52A8;&#x6001;&#x6A21;&#x5757;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;/**</span><br><span class="line"> * &#x6CE8;&#x9500;&#x6A21;&#x5757;</span><br><span class="line"> * @param {Array|String} path &#x8DEF;&#x5F84;</span><br><span class="line"> */</span><br><span class="line">unregisterModule (path) {</span><br><span class="line">  // &#x5982;&#x679C; path &#x662F;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x8F6C;&#x6210;&#x6570;&#x7EC4;</span><br><span class="line">  if (typeof path === &apos;string&apos;) path = [path]</span><br><span class="line"></span><br><span class="line">  // &#x7701;&#x7565; &#x975E;&#x751F;&#x4EA7;&#x73AF;&#x5883; &#x62A5;&#x9519;&#x4EE3;&#x7801; ...</span><br><span class="line"></span><br><span class="line">  // &#x624B;&#x52A8;&#x8C03;&#x7528;&#x6A21;&#x5757;&#x6CE8;&#x9500;</span><br><span class="line">  this._modules.unregister(path)</span><br><span class="line">  this._withCommit(() =&gt; {</span><br><span class="line">    // &#x6CE8;&#x9500;&#x8FD9;&#x4E2A;&#x6A21;&#x5757;</span><br><span class="line">    const parentState = getNestedState(this.state, path.slice(0, -1))</span><br><span class="line">    Vue.delete(parentState, path[path.length - 1])</span><br><span class="line">  })</span><br><span class="line">  // &#x91CD;&#x7F6E; Store</span><br><span class="line">  resetStore(this)</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="hotUpdate"><a href="#hotUpdate" class="headerlink" title="hotUpdate"></a>hotUpdate</h3><p>&#x70ED;&#x66FF;&#x6362;&#x65B0;&#x7684; <code>action</code> &#x548C; <code>mutation</code>&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// &#x70ED;&#x52A0;&#x8F7D;</span><br><span class="line">hotUpdate (newOptions) {</span><br><span class="line">  // &#x8C03;&#x7528;&#x7684;&#x662F; ModuleCollection &#x7684; update &#x65B9;&#x6CD5;&#xFF0C;&#x6700;&#x7EC8;&#x8C03;&#x7528;&#x5BF9;&#x5E94;&#x7684;&#x662F;&#x6BCF;&#x4E2A; Module &#x7684; update</span><br><span class="line">  this._modules.update(newOptions)</span><br><span class="line">  // &#x91CD;&#x7F6E; Store</span><br><span class="line">  resetStore(this, true)</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h2 id="&#x7EC4;&#x4EF6;&#x7ED1;&#x5B9A;&#x7684;&#x8F85;&#x52A9;&#x51FD;&#x6570;"><a href="#&#x7EC4;&#x4EF6;&#x7ED1;&#x5B9A;&#x7684;&#x8F85;&#x52A9;&#x51FD;&#x6570;" class="headerlink" title="&#x7EC4;&#x4EF6;&#x7ED1;&#x5B9A;&#x7684;&#x8F85;&#x52A9;&#x51FD;&#x6570;"></a>&#x7EC4;&#x4EF6;&#x7ED1;&#x5B9A;&#x7684;&#x8F85;&#x52A9;&#x51FD;&#x6570;</h2><p>&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#xFF1A;<a href="/external_links/f50c535398a72dfb3c180fa2f65238d8.html" target="blank" rel="noopener"><code>vuex/src/helpers.js</code></a></p>
<h3 id="mapState"><a href="#mapState" class="headerlink" title="mapState"></a>mapState</h3><p>&#x4E3A;&#x7EC4;&#x4EF6;&#x521B;&#x5EFA;&#x8BA1;&#x7B97;&#x5C5E;&#x6027;&#x4EE5;&#x8FD4;&#x56DE; <code>Vuex store</code> &#x4E2D;&#x7684;&#x72B6;&#x6001;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;export const mapState = normalizeNamespace((namespace, states) =&gt; {</span><br><span class="line">  const res = {}</span><br><span class="line">  // &#x975E;&#x751F;&#x4EA7;&#x73AF;&#x5883; &#x5224;&#x65AD;&#x53C2;&#x6570; states  &#x5FC5;&#x987B;&#x662F;&#x6570;&#x7EC4;&#x6216;&#x8005;&#x662F;&#x5BF9;&#x8C61;</span><br><span class="line">  if (process.env.NODE_ENV !== &apos;production&apos; &amp;&amp; !isValidMap(states)) {</span><br><span class="line">    console.error(&apos;[vuex] mapState: mapper parameter must be either an Array or an Object&apos;)</span><br><span class="line">  }</span><br><span class="line">  normalizeMap(states).forEach(({ key, val }) =&gt; {</span><br><span class="line">    res[key] = function mappedState () {</span><br><span class="line">      let state = this.$store.state</span><br><span class="line">      let getters = this.$store.getters</span><br><span class="line">      // &#x4F20;&#x4E86;&#x53C2;&#x6570; namespace</span><br><span class="line">      if (namespace) {</span><br><span class="line">        // &#x7528; namespace &#x4ECE; store &#x4E2D;&#x627E;&#x4E00;&#x4E2A;&#x6A21;&#x5757;&#x3002;</span><br><span class="line">        const module = getModuleByNamespace(this.$store, &apos;mapState&apos;, namespace)</span><br><span class="line">        if (!module) {</span><br><span class="line">          return</span><br><span class="line">        }</span><br><span class="line">        state = module.context.state</span><br><span class="line">        getters = module.context.getters</span><br><span class="line">      }</span><br><span class="line">      return typeof val === &apos;function&apos;</span><br><span class="line">        ? val.call(this, state, getters)</span><br><span class="line">        : state[val]</span><br><span class="line">    }</span><br><span class="line">    // &#x6807;&#x8BB0;&#x4E3A; vuex &#x65B9;&#x4FBF;&#x5728; devtools &#x663E;&#x793A;</span><br><span class="line">    // mark vuex getter for devtools</span><br><span class="line">    res[key].vuex = true</span><br><span class="line">  })</span><br><span class="line">  return res</span><br><span class="line">})</span><br></pre></td></tr></table></figure>

<p>normalizeNamespace &#x6807;&#x51C6;&#x5316;&#x7EDF;&#x4E00;&#x547D;&#x540D;&#x7A7A;&#x95F4;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function normalizeNamespace (fn) {</span><br><span class="line">  return (namespace, map) =&gt; {</span><br><span class="line">    // &#x547D;&#x540D;&#x7A7A;&#x95F4;&#x6CA1;&#x4F20;&#xFF0C;&#x4EA4;&#x6362;&#x53C2;&#x6570;&#xFF0C;namespace &#x4E3A;&#x7A7A;&#x5B57;&#x7B26;&#x4E32;</span><br><span class="line">    if (typeof namespace !== &apos;string&apos;) {</span><br><span class="line">      map = namespace</span><br><span class="line">      namespace = &apos;&apos;</span><br><span class="line">    } else if (namespace.charAt(namespace.length - 1) !== &apos;/&apos;) {</span><br><span class="line">      // &#x5982;&#x679C;&#x662F;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E0D;&#x662F; / &#x6DFB;&#x52A0; /</span><br><span class="line">      // &#x56E0;&#x4E3A; _modulesNamespaceMap &#x5B58;&#x50A8;&#x7684;&#x662F;&#x8FD9;&#x6837;&#x7684;&#x7ED3;&#x6784;&#x3002;</span><br><span class="line">      /**</span><br><span class="line">       * _modulesNamespaceMap:</span><br><span class="line">          cart/: {}</span><br><span class="line">          products/: {}</span><br><span class="line">        }</span><br><span class="line">       * */</span><br><span class="line">      namespace += &apos;/&apos;</span><br><span class="line">    }</span><br><span class="line">    return fn(namespace, map)</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// &#x6821;&#x9A8C;&#x662F;&#x5426;&#x662F;map &#x662F;&#x6570;&#x7EC4;&#x6216;&#x8005;&#x662F;&#x5BF9;&#x8C61;&#x3002;</span><br><span class="line">function isValidMap (map) {</span><br><span class="line">  return Array.isArray(map) || isObject(map)</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;/**</span><br><span class="line"> * Normalize the map</span><br><span class="line"> * &#x6807;&#x51C6;&#x5316;&#x7EDF;&#x4E00; map&#xFF0C;&#x6700;&#x7EC8;&#x8FD4;&#x56DE;&#x7684;&#x662F;&#x6570;&#x7EC4;</span><br><span class="line"> * normalizeMap([1, 2, 3]) =&gt; [ { key: 1, val: 1 }, { key: 2, val: 2 }, { key: 3, val: 3 } ]</span><br><span class="line"> * normalizeMap({a: 1, b: 2, c: 3}) =&gt; [ { key: &apos;a&apos;, val: 1 }, { key: &apos;b&apos;, val: 2 }, { key: &apos;c&apos;, val: 3 } ]</span><br><span class="line"> * @param {Array|Object} map</span><br><span class="line"> * @return {Object}</span><br><span class="line"> */</span><br><span class="line">function normalizeMap (map) {</span><br><span class="line">  if (!isValidMap(map)) {</span><br><span class="line">    return []</span><br><span class="line">  }</span><br><span class="line">  return Array.isArray(map)</span><br><span class="line">    ? map.map(key =&gt; ({ key, val: key }))</span><br><span class="line">    : Object.keys(map).map(key =&gt; ({ key, val: map[key] }))</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><code>module.context</code> &#x8FD9;&#x4E2A;&#x8D4B;&#x503C;&#x4E3B;&#x8981;&#x662F;&#x7ED9; <code>helpers</code> &#x4E2D; <code>mapState</code>&#x3001;<code>mapGetters</code>&#x3001;<code>mapMutations</code>&#x3001;<code>mapActions</code>&#x56DB;&#x4E2A;&#x8F85;&#x52A9;&#x51FD;&#x6570;&#x4F7F;&#x7528;&#x7684;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// &#x5728;&#x6784;&#x9020;&#x51FD;&#x6570;&#x4E2D; installModule &#x4E2D;</span><br><span class="line">const local = module.context = makeLocalContext(store, namespace, path)</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x91CC;&#x5C31;&#x662F;&#x62B9;&#x5E73;&#x5DEE;&#x5F02;&#xFF0C;&#x4E0D;&#x7528;&#x7528;&#x6237;&#x4F20;&#x9012;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF0C;&#x83B7;&#x53D6;&#x5230;&#x5BF9;&#x5E94;&#x7684; commit&#x3001;dispatch&#x3001;state&#x3001;&#x548C; getters</p>
<p>getModuleByNamespace</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function getModuleByNamespace (store, helper, namespace) {</span><br><span class="line">  // _modulesNamespaceMap &#x8FD9;&#x4E2A;&#x53D8;&#x91CF;&#x5728; class Store installModule &#x51FD;&#x6570;&#x4E2D;&#x8D4B;&#x503C;&#x7684;</span><br><span class="line">  const module = store._modulesNamespaceMap[namespace]</span><br><span class="line">  if (process.env.NODE_ENV !== &apos;production&apos; &amp;&amp; !module) {</span><br><span class="line">    console.error(`[vuex] module namespace not found in ${helper}(): ${namespace}`)</span><br><span class="line">  }</span><br><span class="line">  return module</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x770B;&#x5B8C;&#x8FD9;&#x4E9B;&#xFF0C;&#x6700;&#x540E;&#x4E3E;&#x4E2A;&#x4F8B;&#x5B50;&#xFF1A;<br><code>vuex/examples/shopping-cart/components/ShoppingCart.vue</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;computed: {</span><br><span class="line">    ...mapState({</span><br><span class="line">      checkoutStatus: state =&gt; state.cart.checkoutStatus</span><br><span class="line">    }),</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x6CA1;&#x6709;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6700;&#x7EC8;&#x4F1A;&#x8F6C;&#x6362;&#x6210;&#x8FD9;&#x6837;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;computed: {</span><br><span class="line">    checkoutStatus: this.$store.state.checkoutStatus</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5047;&#x8BBE;&#x6709;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x2019;ruochuan&#x2019;&#xFF0C;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;computed: {</span><br><span class="line">    ...mapState(&apos;ruochuan&apos;, {</span><br><span class="line">      checkoutStatus: state =&gt; state.cart.checkoutStatus</span><br><span class="line">    }),</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5219;&#x4F1A;&#x8F6C;&#x6362;&#x6210;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;computed: {</span><br><span class="line">    checkoutStatus: this.$store._modulesNamespaceMap.[&apos;ruochuan/&apos;].context.checkoutStatus</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="mapGetters"><a href="#mapGetters" class="headerlink" title="mapGetters"></a>mapGetters</h3><p>&#x4E3A;&#x7EC4;&#x4EF6;&#x521B;&#x5EFA;&#x8BA1;&#x7B97;&#x5C5E;&#x6027;&#x4EE5;&#x8FD4;&#x56DE; <code>getter</code> &#x7684;&#x8FD4;&#x56DE;&#x503C;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;export const mapGetters = normalizeNamespace((namespace, getters) =&gt; {</span><br><span class="line">  const res = {}</span><br><span class="line">  // &#x7701;&#x7565;&#x4EE3;&#x7801;&#xFF1A;&#x975E;&#x751F;&#x4EA7;&#x73AF;&#x5883; &#x5224;&#x65AD;&#x53C2;&#x6570; getters &#x5FC5;&#x987B;&#x662F;&#x6570;&#x7EC4;&#x6216;&#x8005;&#x662F;&#x5BF9;&#x8C61;</span><br><span class="line">  normalizeMap(getters).forEach(({ key, val }) =&gt; {</span><br><span class="line">    // The namespace has been mutated by normalizeNamespace</span><br><span class="line">    val = namespace + val</span><br><span class="line">    res[key] = function mappedGetter () {</span><br><span class="line">      if (namespace &amp;&amp; !getModuleByNamespace(this.$store, &apos;mapGetters&apos;, namespace)) {</span><br><span class="line">        return</span><br><span class="line">      }</span><br><span class="line">      // &#x7701;&#x7565;&#x4EE3;&#x7801;&#xFF1A;&#x5339;&#x914D;&#x4E0D;&#x5230; getter</span><br><span class="line">      return this.$store.getters[val]</span><br><span class="line">    }</span><br><span class="line">    // mark vuex getter for devtools</span><br><span class="line">    res[key].vuex = true</span><br><span class="line">  })</span><br><span class="line">  return res</span><br><span class="line">})</span><br></pre></td></tr></table></figure>

<p>&#x4E3E;&#x4F8B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;computed: {</span><br><span class="line">  ...mapGetters(&apos;cart&apos;, {</span><br><span class="line">    products: &apos;cartProducts&apos;,</span><br><span class="line">    total: &apos;cartTotalPrice&apos;</span><br><span class="line">  })</span><br><span class="line">},</span><br></pre></td></tr></table></figure>

<p>&#x6700;&#x7EC8;&#x8F6C;&#x6362;&#x6210;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;computed: {</span><br><span class="line">  products: this.$store.getters[&apos;cart/cartProducts&apos;],</span><br><span class="line">  total: this.$store.getters[&apos;cart/cartTotalPrice&apos;],</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="mapActions"><a href="#mapActions" class="headerlink" title="mapActions"></a>mapActions</h3><p>&#x521B;&#x5EFA;&#x7EC4;&#x4EF6;&#x65B9;&#x6CD5;&#x5206;&#x53D1; <code>action</code>&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;export const mapActions = normalizeNamespace((namespace, actions) =&gt; {</span><br><span class="line">  const res = {}</span><br><span class="line">  // &#x7701;&#x7565;&#x4EE3;&#x7801;&#xFF1A; &#x975E;&#x751F;&#x4EA7;&#x73AF;&#x5883; &#x5224;&#x65AD;&#x53C2;&#x6570; actions  &#x5FC5;&#x987B;&#x662F;&#x6570;&#x7EC4;&#x6216;&#x8005;&#x662F;&#x5BF9;&#x8C61;</span><br><span class="line">  normalizeMap(actions).forEach(({ key, val }) =&gt; {</span><br><span class="line">    res[key] = function mappedAction (...args) {</span><br><span class="line">      // get dispatch function from store</span><br><span class="line">      let dispatch = this.$store.dispatch</span><br><span class="line">      if (namespace) {</span><br><span class="line">        const module = getModuleByNamespace(this.$store, &apos;mapActions&apos;, namespace)</span><br><span class="line">        if (!module) {</span><br><span class="line">          return</span><br><span class="line">        }</span><br><span class="line">        dispatch = module.context.dispatch</span><br><span class="line">      }</span><br><span class="line">      return typeof val === &apos;function&apos;</span><br><span class="line">        ? val.apply(this, [dispatch].concat(args))</span><br><span class="line">        : dispatch.apply(this.$store, [val].concat(args))</span><br><span class="line">    }</span><br><span class="line">  })</span><br><span class="line">  return res</span><br><span class="line">})</span><br></pre></td></tr></table></figure>

<h3 id="mapMutations"><a href="#mapMutations" class="headerlink" title="mapMutations"></a>mapMutations</h3><p>&#x521B;&#x5EFA;&#x7EC4;&#x4EF6;&#x65B9;&#x6CD5;&#x63D0;&#x4EA4; <code>mutation</code>&#x3002;<br>mapMutations &#x548C; mapActions &#x7C7B;&#x4F3C;&#xFF0C;&#x53EA;&#x662F; dispatch &#x6362;&#x6210;&#x4E86; commit&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;let commit = this.$store.commit</span><br><span class="line">commit = module.context.commit</span><br><span class="line">return typeof val === &apos;function&apos;</span><br><span class="line">        ? val.apply(this, [commit].concat(args))</span><br><span class="line">        : commit.apply(this.$store, [val].concat(args))</span><br></pre></td></tr></table></figure>

<p><a href="/external_links/f50c535398a72dfb3c180fa2f65238d8.html" target="blank" rel="noopener">vuex/src/helpers</a></p>
<p><code>mapMutations</code>&#x3001;<code>mapActions</code> &#x4E3E;&#x4F8B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;{</span><br><span class="line">  methods: {</span><br><span class="line">    ...mapMutations([&apos;inc&apos;]),</span><br><span class="line">    ...mapMutations(&apos;ruochuan&apos;, [&apos;dec&apos;]),</span><br><span class="line">    ...mapActions([&apos;actionA&apos;])</span><br><span class="line">    ...mapActions(&apos;ruochuan&apos;, [&apos;actionB&apos;])</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x6700;&#x7EC8;&#x8F6C;&#x6362;&#x6210;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;{</span><br><span class="line">  methods: {</span><br><span class="line">    inc(...args){</span><br><span class="line">      return this.$store.dispatch.apply(this.$store, [&apos;inc&apos;].concat(args))</span><br><span class="line">    },</span><br><span class="line">    dec(...args){</span><br><span class="line">      return this.$store._modulesNamespaceMap.[&apos;ruochuan/&apos;].context.dispatch.apply(this.$store, [&apos;dec&apos;].concat(args))</span><br><span class="line">    },</span><br><span class="line">    actionA(...args){</span><br><span class="line">      return this.$store.commit.apply(this.$store, [&apos;actionA&apos;].concat(args))</span><br><span class="line">    }</span><br><span class="line">    actionB(...args){</span><br><span class="line">      return this.$store._modulesNamespaceMap.[&apos;ruochuan/&apos;].context.commit.apply(this.$store, [&apos;actionB&apos;].concat(args))</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x7531;&#x6B64;&#x53EF;&#x89C1;&#xFF1A;&#x8FD9;&#x4E9B;&#x8F85;&#x52A9;&#x51FD;&#x6570;&#x6781;&#x5927;&#x5730;&#x65B9;&#x4FBF;&#x4E86;&#x5F00;&#x53D1;&#x8005;&#x3002;</p>
<h3 id="createNamespacedHelpers"><a href="#createNamespacedHelpers" class="headerlink" title="createNamespacedHelpers"></a>createNamespacedHelpers</h3><p>&#x521B;&#x5EFA;&#x57FA;&#x4E8E;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x7684;&#x7EC4;&#x4EF6;&#x7ED1;&#x5B9A;&#x8F85;&#x52A9;&#x51FD;&#x6570;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;export const createNamespacedHelpers = (namespace) =&gt; ({</span><br><span class="line">  // bind(null) &#x4E25;&#x683C;&#x6A21;&#x5F0F;&#x4E0B;&#xFF0C;napState&#x7B49;&#x7684;&#x51FD;&#x6570; this &#x6307;&#x5411;&#x5C31;&#x662F; null</span><br><span class="line">  mapState: mapState.bind(null, namespace),</span><br><span class="line">  mapGetters: mapGetters.bind(null, namespace),</span><br><span class="line">  mapMutations: mapMutations.bind(null, namespace),</span><br><span class="line">  mapActions: mapActions.bind(null, namespace)</span><br><span class="line">})</span><br></pre></td></tr></table></figure>

<p>&#x5C31;&#x662F;&#x628A;&#x8FD9;&#x4E9B;&#x8F85;&#x52A9;&#x51FD;&#x6570;&#x653E;&#x5728;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x4E2D;&#x3002;</p>
<h2 id="&#x63D2;&#x4EF6;"><a href="#&#x63D2;&#x4EF6;" class="headerlink" title="&#x63D2;&#x4EF6;"></a>&#x63D2;&#x4EF6;</h2><p>&#x63D2;&#x4EF6;&#x90E8;&#x5206;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x662F;&#xFF1A;  </p>
<p><code>vuex/src/plugins/devtool</code>  </p>
<p><code>vuex/src/plugins/logger</code>  </p>
<p>&#x6587;&#x7AE0;&#x6BD4;&#x8F83;&#x957F;&#x4E86;&#xFF0C;&#x8FD9;&#x90E8;&#x5206;&#x5C31;&#x4E0D;&#x518D;&#x53D9;&#x8FF0;&#x3002;&#x5177;&#x4F53;&#x53EF;&#x4EE5;&#x770B;&#x7B14;&#x8005;&#x7684;&#x4ED3;&#x5E93; <a href="/external_links/51328288faf27e6e3765cceb36301698.html" target="blank" rel="noopener">vuex-analysis <code>vuex/src/plugins/</code></a> &#x7684;&#x6E90;&#x7801;&#x6CE8;&#x91CA;&#x3002;</p>
<h2 id="&#x603B;&#x7ED3;"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3;</h2><p>&#x6587;&#x7AE0;&#x6BD4;&#x8F83;&#x8BE6;&#x7EC6;&#x7684;&#x4ECB;&#x7ECD;&#x4E86;<code>vuex</code>&#x3001;<code>vue</code>&#x6E90;&#x7801;&#x8C03;&#x8BD5;&#x65B9;&#x6CD5;&#x548C; <code>Vuex</code> &#x539F;&#x7406;&#x3002;&#x5E76;&#x4E14;&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;&#x4E86; <code>Vuex.use</code> &#x5B89;&#x88C5;&#x548C; <code>new Vuex.Store</code> &#x521D;&#x59CB;&#x5316;&#x3001;<code>Vuex.Store</code> &#x7684;&#x5168;&#x90E8;<code>API</code>&#xFF08;&#x5982;<code>dispatch</code>&#x3001;<code>commit</code>&#x7B49;&#xFF09;&#x7684;&#x5B9E;&#x73B0;&#x548C;&#x8F85;&#x52A9;&#x51FD;&#x6570; <code>mapState</code>&#x3001;<code>mapGetters</code>&#x3001; <code>mapActions</code>&#x3001;<code>mapMutations</code><br><code>createNamespacedHelpers</code>&#x3002;</p>
<p>&#x6587;&#x7AE0;&#x6CE8;&#x91CA;&#xFF0C;&#x5728;<a href="/external_links/cbf521707e717a82a6c95c55c4ba19c4.html" target="blank" rel="noopener">vuex-analysis</a>&#x6E90;&#x7801;&#x4ED3;&#x5E93;&#x91CC;&#x57FA;&#x672C;&#x90FD;&#x6709;&#x6CE8;&#x91CA;&#x5206;&#x6790;&#xFF0C;&#x6C42;&#x4E2A;<code>star</code>&#x3002;&#x518D;&#x6B21;&#x5F3A;&#x70C8;&#x5EFA;&#x8BAE;&#x8981;&#x514B;&#x9686;&#x4EE3;&#x7801;&#x4E0B;&#x6765;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;git clone https://github.com/lxchuan12/vuex-analysis.git</span><br></pre></td></tr></table></figure>

<p>&#x5148;&#x628A; <code>Store</code> &#x5B9E;&#x4F8B;&#x6253;&#x5370;&#x51FA;&#x6765;&#xFF0C;&#x770B;&#x5177;&#x4F53;&#x7ED3;&#x6784;&#xFF0C;&#x518D;&#x7ED3;&#x5408;&#x5B9E;&#x4F8B;&#x65AD;&#x70B9;&#x8C03;&#x8BD5;&#xFF0C;&#x4E8B;&#x534A;&#x529F;&#x500D;&#x3002;</p>
<p><code>Vuex</code> &#x6E90;&#x7801;&#x76F8;&#x5BF9;&#x4E0D;&#x591A;&#xFF0C;&#x6253;&#x5305;&#x540E;&#x4E00;&#x5343;&#x591A;&#x884C;&#xFF0C;&#x975E;&#x5E38;&#x503C;&#x5F97;&#x5B66;&#x4E60;&#xFF0C;&#x4E5F;&#x6BD4;&#x8F83;&#x5BB9;&#x6613;&#x770B;&#x5B8C;&#x3002;</p>
<p>&#x5982;&#x679C;&#x8BFB;&#x8005;&#x53D1;&#x73B0;&#x6709;&#x4E0D;&#x59A5;&#x6216;&#x53EF;&#x6539;&#x5584;&#x4E4B;&#x5904;&#xFF0C;&#x518D;&#x6216;&#x8005;&#x54EA;&#x91CC;&#x6CA1;&#x5199;&#x660E;&#x767D;&#x7684;&#x5730;&#x65B9;&#xFF0C;&#x6B22;&#x8FCE;&#x8BC4;&#x8BBA;&#x6307;&#x51FA;&#x3002;&#x53E6;&#x5916;&#x89C9;&#x5F97;&#x5199;&#x5F97;&#x4E0D;&#x9519;&#xFF0C;&#x5BF9;&#x60A8;&#x6709;&#x4E9B;&#x8BB8;&#x5E2E;&#x52A9;&#xFF0C;&#x53EF;&#x4EE5;&#x70B9;&#x8D5E;&#x3001;&#x8BC4;&#x8BBA;&#x3001;&#x8F6C;&#x53D1;&#x5206;&#x4EAB;&#xFF0C;&#x4E5F;&#x662F;&#x5BF9;&#x7B14;&#x8005;&#x7684;&#x4E00;&#x79CD;&#x652F;&#x6301;&#xFF0C;&#x4E07;&#x5206;&#x611F;&#x8C22;&#x3002;</p>
<h2 id="&#x63A8;&#x8350;&#x9605;&#x8BFB;"><a href="#&#x63A8;&#x8350;&#x9605;&#x8BFB;" class="headerlink" title="&#x63A8;&#x8350;&#x9605;&#x8BFB;"></a>&#x63A8;&#x8350;&#x9605;&#x8BFB;</h2><p><a href="/external_links/451496aad0e0edc147f6e04e4d75df58.html" target="blank" rel="noopener">vuex &#x5B98;&#x65B9;&#x6587;&#x6863;</a>  </p>
<p><a href="/external_links/57491a050c8871fff83b4e1246e8a6b2.html" target="blank" rel="noopener">vuex github &#x4ED3;&#x5E93;</a>  </p>
<p><a href="/external_links/7fa13167fd3d315151cbabeb6f4dd5a5.html" target="blank" rel="noopener">&#x7F8E;&#x56E2;&#x660E;&#x88D4;&#xFF1A;Vuex&#x6846;&#x67B6;&#x539F;&#x7406;&#x4E0E;&#x6E90;&#x7801;&#x5206;&#x6790;</a><strong>&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x5F3A;&#x70C8;&#x63A8;&#x8350;&#xFF0C;&#x6D41;&#x7A0B;&#x56FE;&#x753B;&#x7684;&#x5F88;&#x597D;</strong>  </p>
<p><a href="/external_links/1bb1b17050bca4515937ef5cf5ddb9e8.html" target="blank" rel="noopener">&#x77E5;&#x4E4E;&#x9EC4;&#x8F76;&#xFF1A;Vuex 2.0 &#x6E90;&#x7801;&#x5206;&#x6790;</a><strong>&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x4E5F;&#x5F3A;&#x70C8;&#x63A8;&#x8350;&#xFF0C;&#x8BB2;&#x8FF0;&#x7684;&#x6BD4;&#x8F83;&#x5168;&#x9762;</strong>  </p>
<p><a href="https://dev.newban.cn/6844903486811799559">&#x5C0F;&#x866B;&#x5DE8;&#x87F9;&#xFF1A;Vuex &#x6E90;&#x7801;&#x89E3;&#x6790;&#xFF08;&#x5982;&#x4F55;&#x9605;&#x8BFB;&#x6E90;&#x4EE3;&#x7801;&#x5B9E;&#x8DF5;&#x7BC7;&#xFF09;</a><strong>&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x4E5F;&#x5F3A;&#x70C8;&#x63A8;&#x8350;&#xFF0C;&#x4E3B;&#x8981;&#x8BB2;&#x5982;&#x4F55;&#x9605;&#x8BFB;&#x6E90;&#x4EE3;&#x7801;</strong>  </p>
<p><a href="https://dev.newban.cn/6844903507057704974">&#x67D3;&#x964C;&#xFF1A;Vuex &#x6E90;&#x7801;&#x89E3;&#x6790;</a>  </p>
<p><a href="https://dev.newban.cn/6844903495263322119#heading-8">&#x7F51;&#x6613;&#x8003;&#x62C9;&#x524D;&#x7AEF;&#x56E2;&#x961F;&#xFF1A;Vuex &#x6E90;&#x7801;&#x5206;&#x6790;</a>  </p>
<p><a href="https://dev.newban.cn/6844903676721496071">yck&#xFF1A;Vuex &#x6E90;&#x7801;&#x6DF1;&#x5EA6;&#x89E3;&#x6790;</a>  </p>
<p><a href="https://dev.newban.cn/6844903847001866247">&#x5C0F;&#x751F;&#x65B9;&#x52E4;&#xFF1A;&#x3010;&#x524D;&#x7AEF;&#x8BCD;&#x5178;&#x3011;&#x4ECE;&#x6E90;&#x7801;&#x89E3;&#x8BFB; Vuex &#x6CE8;&#x5165; Vue &#x751F;&#x547D;&#x5468;&#x671F;&#x7684;&#x8FC7;&#x7A0B;</a>  </p>
<h2 id="&#x7B14;&#x8005;&#x53E6;&#x4E00;&#x4E2A;&#x7CFB;&#x5217;"><a href="#&#x7B14;&#x8005;&#x53E6;&#x4E00;&#x4E2A;&#x7CFB;&#x5217;" class="headerlink" title="&#x7B14;&#x8005;&#x53E6;&#x4E00;&#x4E2A;&#x7CFB;&#x5217;"></a>&#x7B14;&#x8005;&#x53E6;&#x4E00;&#x4E2A;&#x7CFB;&#x5217;</h2><p><a href="https://dev.newban.cn/6844903780035592205">&#x9762;&#x8BD5;&#x5B98;&#x95EE;&#xFF1A;JS&#x7684;&#x7EE7;&#x627F;</a>  </p>
<p><a href="https://dev.newban.cn/6844903746984476686">&#x9762;&#x8BD5;&#x5B98;&#x95EE;&#xFF1A;JS&#x7684;this&#x6307;&#x5411;</a>  </p>
<p><a href="https://dev.newban.cn/6844903728147857415">&#x9762;&#x8BD5;&#x5B98;&#x95EE;&#xFF1A;&#x80FD;&#x5426;&#x6A21;&#x62DF;&#x5B9E;&#x73B0;JS&#x7684;call&#x548C;apply&#x65B9;&#x6CD5;</a>  </p>
<p><a href="https://dev.newban.cn/6844903718089916429">&#x9762;&#x8BD5;&#x5B98;&#x95EE;&#xFF1A;&#x80FD;&#x5426;&#x6A21;&#x62DF;&#x5B9E;&#x73B0;JS&#x7684;bind&#x65B9;&#x6CD5;</a>  </p>
<p><a href="https://dev.newban.cn/6844903704663949325">&#x9762;&#x8BD5;&#x5B98;&#x95EE;&#xFF1A;&#x80FD;&#x5426;&#x6A21;&#x62DF;&#x5B9E;&#x73B0;JS&#x7684;new&#x64CD;&#x4F5C;&#x7B26;</a>  </p>
<h2 id="&#x5173;&#x4E8E;"><a href="#&#x5173;&#x4E8E;" class="headerlink" title="&#x5173;&#x4E8E;"></a>&#x5173;&#x4E8E;</h2><p>&#x4F5C;&#x8005;&#xFF1A;&#x5E38;&#x4EE5;<strong>&#x82E5;&#x5DDD;</strong>&#x4E3A;&#x540D;&#x6DF7;&#x8FF9;&#x4E8E;&#x6C5F;&#x6E56;&#x3002;&#x524D;&#x7AEF;&#x8DEF;&#x4E0A; | PPT&#x7231;&#x597D;&#x8005; | &#x6240;&#x77E5;&#x751A;&#x5C11;&#xFF0C;&#x552F;&#x5584;&#x5B66;&#x3002;  </p>
<p><a href="/external_links/b3b2a0a74351efedb8f30b11aad385b9.html" target="blank" rel="noopener">&#x4E2A;&#x4EBA;&#x535A;&#x5BA2;-&#x82E5;&#x5DDD;</a>&#xFF0C;&#x4F7F;&#x7528;<code>vuepress</code>&#x91CD;&#x6784;&#x4E86;&#xFF0C;&#x9605;&#x8BFB;&#x4F53;&#x9A8C;&#x53EF;&#x80FD;&#x66F4;&#x597D;&#x4E9B;  </p>
<p><a href="/external_links/0eaae9aee67b3837a4608f6f57e3fe73.html" target="blank" rel="noopener">&#x6398;&#x91D1;&#x4E13;&#x680F;</a>&#xFF0C;&#x6B22;&#x8FCE;&#x5173;&#x6CE8;~  </p>
<p><a href="/external_links/aa57b6e4783432f5eb4cb3122c7c281d.html" target="blank" rel="noopener"><code>segmentfault</code>&#x524D;&#x7AEF;&#x89C6;&#x91CE;&#x4E13;&#x680F;</a>&#xFF0C;&#x6B22;&#x8FCE;&#x5173;&#x6CE8;~  </p>
<p><a href="/external_links/9d49889ba530cc743d4bc05726fd318e.html" target="blank" rel="noopener">&#x77E5;&#x4E4E;&#x524D;&#x7AEF;&#x89C6;&#x91CE;&#x4E13;&#x680F;</a>&#xFF0C;&#x6B22;&#x8FCE;&#x5173;&#x6CE8;~  </p>
<p><a href="/external_links/7a72f7afa742d06ac5ceb82d817c1bed.html" target="blank" rel="noopener">github blog</a>&#xFF0C;&#x76F8;&#x5173;&#x6E90;&#x7801;&#x548C;&#x8D44;&#x6E90;&#x90FD;&#x653E;&#x5728;&#x8FD9;&#x91CC;&#xFF0C;&#x6C42;&#x4E2A;<code>star</code>^_^~</p>
<h2 id="&#x6B22;&#x8FCE;&#x52A0;&#x5FAE;&#x4FE1;&#x4EA4;&#x6D41;-&#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x53F7;"><a href="#&#x6B22;&#x8FCE;&#x52A0;&#x5FAE;&#x4FE1;&#x4EA4;&#x6D41;-&#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x53F7;" class="headerlink" title="&#x6B22;&#x8FCE;&#x52A0;&#x5FAE;&#x4FE1;&#x4EA4;&#x6D41; &#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x53F7;"></a>&#x6B22;&#x8FCE;&#x52A0;&#x5FAE;&#x4FE1;&#x4EA4;&#x6D41; &#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x53F7;</h2><p>&#x53EF;&#x80FD;&#x6BD4;&#x8F83;&#x6709;&#x8DA3;&#x7684;&#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x53F7;&#xFF0C;&#x957F;&#x6309;&#x626B;&#x7801;&#x5173;&#x6CE8;&#x3002;&#x4E5F;&#x53EF;&#x4EE5;&#x52A0;&#x5FAE;&#x4FE1; <code>ruochuan12</code>&#xFF0C;&#x6CE8;&#x660E;&#x6765;&#x6E90;&#xFF0C;&#x62C9;&#x60A8;&#x8FDB;&#x3010;&#x524D;&#x7AEF;&#x89C6;&#x91CE;&#x4EA4;&#x6D41;&#x7FA4;&#x3011;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/aadeca165d32560f0a5f1eb50f8961e40e01bf2c41721a1f3af6e8acf87d67e9" alt="&#x82E5;&#x5DDD;&#x89C6;&#x91CE;"></p>
<p>&#x82E5;&#x5DDD;&#x89C6;&#x91CE;</p>
<p>&#x672C;&#x6587;&#x4F7F;&#x7528; <a href="/external_links/f4f051239b400ed0d04b60fef623174b.html" target="blank" rel="noopener">mdnice</a> &#x6392;&#x7248;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/4f661b7716a7aec5831c676976d29fc2.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903984457580551.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903984457580551.html" itemprop="url">学习 sentry 源码整体架构，打造属于自己的前端异常监控</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-10-31T13:08:31+08:00">
                2019-10-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="&#x524D;&#x8A00;"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00;</h2><blockquote>
<p>&#x4F60;&#x597D;&#xFF0C;&#x6211;&#x662F;<a href="/external_links/b223b476cd448b456962ecaf8028b149.html" target="blank" rel="noopener">&#x82E5;&#x5DDD;</a>&#x3002;&#x8FD9;&#x662F;<code>&#x5B66;&#x4E60;&#x6E90;&#x7801;&#x6574;&#x4F53;&#x67B6;&#x6784;&#x7CFB;&#x5217;</code>&#x7B2C;&#x56DB;&#x7BC7;&#x3002;&#x6574;&#x4F53;&#x67B6;&#x6784;&#x8FD9;&#x8BCD;&#x8BED;&#x597D;&#x50CF;&#x6709;&#x70B9;&#x5927;&#xFF0C;&#x59D1;&#x4E14;&#x5C31;&#x7B97;&#x662F;&#x6E90;&#x7801;&#x6574;&#x4F53;&#x7ED3;&#x6784;&#x5427;&#xFF0C;&#x4E3B;&#x8981;&#x5C31;&#x662F;&#x5B66;&#x4E60;&#x662F;&#x4EE3;&#x7801;&#x6574;&#x4F53;&#x7ED3;&#x6784;&#xFF0C;&#x4E0D;&#x6DF1;&#x7A76;&#x5176;&#x4ED6;&#x4E0D;&#x662F;&#x4E3B;&#x7EBF;&#x7684;&#x5177;&#x4F53;&#x51FD;&#x6570;&#x7684;&#x5B9E;&#x73B0;&#x3002;&#x6587;&#x7AE0;&#x5B66;&#x4E60;&#x7684;&#x662F;&#x6253;&#x5305;&#x6574;&#x5408;&#x540E;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x4E0D;&#x662F;&#x5B9E;&#x9645;&#x4ED3;&#x5E93;&#x4E2D;&#x7684;&#x62C6;&#x5206;&#x7684;&#x4EE3;&#x7801;&#x3002;</p>
</blockquote>
<p><code>&#x5B66;&#x4E60;&#x6E90;&#x7801;&#x6574;&#x4F53;&#x67B6;&#x6784;&#x7CFB;&#x5217;</code>&#x6587;&#x7AE0;&#x5982;&#x4E0B;&#xFF1A;</p>
<blockquote>
<p>1.<a href="https://dev.newban.cn/6844903902077272071">&#x5B66;&#x4E60; jQuery &#x6E90;&#x7801;&#x6574;&#x4F53;&#x67B6;&#x6784;&#xFF0C;&#x6253;&#x9020;&#x5C5E;&#x4E8E;&#x81EA;&#x5DF1;&#x7684; js &#x7C7B;&#x5E93;</a>  </p>
<p>2.<a href="https://dev.newban.cn/6844903908972691469">&#x5B66;&#x4E60; underscore &#x6E90;&#x7801;&#x6574;&#x4F53;&#x67B6;&#x6784;&#xFF0C;&#x6253;&#x9020;&#x5C5E;&#x4E8E;&#x81EA;&#x5DF1;&#x7684;&#x51FD;&#x6570;&#x5F0F;&#x7F16;&#x7A0B;&#x7C7B;&#x5E93;</a>  </p>
<p>3.<a href="https://dev.newban.cn/6844903939062628360">&#x5B66;&#x4E60; lodash &#x6E90;&#x7801;&#x6574;&#x4F53;&#x67B6;&#x6784;&#xFF0C;&#x6253;&#x9020;&#x5C5E;&#x4E8E;&#x81EA;&#x5DF1;&#x7684;&#x51FD;&#x6570;&#x5F0F;&#x7F16;&#x7A0B;&#x7C7B;&#x5E93;</a>  </p>
<p>4.<a href="https://dev.newban.cn/6844903984457580551">&#x5B66;&#x4E60; sentry &#x6E90;&#x7801;&#x6574;&#x4F53;&#x67B6;&#x6784;&#xFF0C;&#x6253;&#x9020;&#x5C5E;&#x4E8E;&#x81EA;&#x5DF1;&#x7684;&#x524D;&#x7AEF;&#x5F02;&#x5E38;&#x76D1;&#x63A7;SDK</a>  </p>
<p>5.<a href="https://dev.newban.cn/6844904001192853511">&#x5B66;&#x4E60; vuex &#x6E90;&#x7801;&#x6574;&#x4F53;&#x67B6;&#x6784;&#xFF0C;&#x6253;&#x9020;&#x5C5E;&#x4E8E;&#x81EA;&#x5DF1;&#x7684;&#x72B6;&#x6001;&#x7BA1;&#x7406;&#x5E93;</a>  </p>
<p>6.<a href="https://dev.newban.cn/6844904019987529735">&#x5B66;&#x4E60; axios &#x6E90;&#x7801;&#x6574;&#x4F53;&#x67B6;&#x6784;&#xFF0C;&#x6253;&#x9020;&#x5C5E;&#x4E8E;&#x81EA;&#x5DF1;&#x7684;&#x8BF7;&#x6C42;&#x5E93;</a>  </p>
<p>7.<a href="https://dev.newban.cn/6844904088220467213">&#x5B66;&#x4E60; koa &#x6E90;&#x7801;&#x7684;&#x6574;&#x4F53;&#x67B6;&#x6784;&#xFF0C;&#x6D45;&#x6790;koa&#x6D0B;&#x8471;&#x6A21;&#x578B;&#x539F;&#x7406;&#x548C;co&#x539F;&#x7406;</a>  </p>
<p>8.<a href="https://dev.newban.cn/6844904191228411911">&#x5B66;&#x4E60; redux &#x6E90;&#x7801;&#x6574;&#x4F53;&#x67B6;&#x6784;&#xFF0C;&#x6DF1;&#x5165;&#x7406;&#x89E3; redux &#x53CA;&#x5176;&#x4E2D;&#x95F4;&#x4EF6;&#x539F;&#x7406;</a></p>
</blockquote>
<p>&#x611F;&#x5174;&#x8DA3;&#x7684;&#x8BFB;&#x8005;&#x53EF;&#x4EE5;&#x70B9;&#x51FB;&#x9605;&#x8BFB;&#x3002;</p>
<p><strong>&#x5BFC;&#x8BFB;</strong>  </p>
<p>&#x672C;&#x6587;&#x901A;&#x8FC7;&#x68B3;&#x7406;&#x524D;&#x7AEF;&#x9519;&#x8BEF;&#x76D1;&#x63A7;&#x77E5;&#x8BC6;&#x3001;&#x4ECB;&#x7ECD;<code>sentry</code>&#x9519;&#x8BEF;&#x76D1;&#x63A7;&#x539F;&#x7406;&#x3001;<code>sentry</code>&#x521D;&#x59CB;&#x5316;&#x3001;<code>Ajax</code>&#x4E0A;&#x62A5;&#x3001;<code>window.onerror&#x3001;window.onunhandledrejection</code>&#x51E0;&#x4E2A;&#x65B9;&#x9762;&#x6765;&#x5B66;&#x4E60;<code>sentry</code>&#x7684;&#x6E90;&#x7801;&#x3002;</p>
<p>&#x5F00;&#x53D1;&#x5FAE;&#x4FE1;&#x5C0F;&#x7A0B;&#x5E8F;&#xFF0C;&#x60F3;&#x7740;&#x642D;&#x5EFA;&#x5C0F;&#x7A0B;&#x5E8F;&#x9519;&#x8BEF;&#x76D1;&#x63A7;&#x65B9;&#x6848;&#x3002;&#x6700;&#x8FD1;&#x7528;&#x4E86;&#x4E01;&#x9999;&#x56ED; &#x5F00;&#x6E90;&#x7684;<code>Sentry</code> &#x5C0F;&#x7A0B;&#x5E8F; <code>SDK</code><a href="/external_links/e71a41a101259f245a0321d14881b63c.html" target="blank" rel="noopener">sentry-miniapp</a>&#x3002;<br>&#x987A;&#x4FBF;&#x7814;&#x7A76;&#x4E0B;<a href="/external_links/bbf05de69024f708439290c7c71299ed.html" target="blank" rel="noopener"><code>sentry-javascript</code>&#x4ED3;&#x5E93;</a> &#x7684;&#x6E90;&#x7801;&#x6574;&#x4F53;&#x67B6;&#x6784;&#xFF0C;&#x4E8E;&#x662F;&#x6709;&#x4E86;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x3002;</p>
<p>&#x672C;&#x6587;&#x5206;&#x6790;&#x7684;&#x662F;&#x6253;&#x5305;&#x540E;&#x672A;&#x538B;&#x7F29;&#x7684;&#x6E90;&#x7801;&#xFF0C;&#x6E90;&#x7801;&#x603B;&#x884C;&#x6570;&#x4E94;&#x5343;&#x4F59;&#x884C;&#xFF0C;&#x94FE;&#x63A5;&#x5730;&#x5740;&#x662F;&#xFF1A;<a href="/external_links/a1d3f9d06615e1fa9715e3fb51f9b8f8.html" target="blank" rel="noopener">browser.sentry-cdn.com/5.7.1/bundl&#x2026;</a>&#xFF0C; &#x7248;&#x672C;&#x662F;<code>v5.7.1</code>&#x3002;</p>
<p>&#x672C;&#x6587;&#x793A;&#x4F8B;&#x7B49;&#x6E90;&#x4EE3;&#x7801;&#x5728;&#x8FD9;&#x6211;&#x7684;<code>github</code>&#x535A;&#x5BA2;&#x4E2D;<a href="/external_links/81786d509a37300e2afb182ca710abe1.html" target="blank" rel="noopener">github blog sentry</a>&#xFF0C;&#x9700;&#x8981;&#x7684;&#x8BFB;&#x8005;&#x53EF;&#x4EE5;&#x70B9;&#x51FB;&#x67E5;&#x770B;&#xFF0C;&#x5982;&#x679C;&#x89C9;&#x5F97;&#x4E0D;&#x9519;&#xFF0C;&#x53EF;&#x4EE5;&#x987A;&#x4FBF;<code>star</code>&#x4E00;&#x4E0B;&#x3002;</p>
<p>&#x770B;&#x6E90;&#x7801;&#x524D;&#x5148;&#x6765;&#x68B3;&#x7406;&#x4E0B;&#x524D;&#x7AEF;&#x9519;&#x8BEF;&#x76D1;&#x63A7;&#x7684;&#x77E5;&#x8BC6;&#x3002;</p>
<h2 id="&#x524D;&#x7AEF;&#x9519;&#x8BEF;&#x76D1;&#x63A7;&#x77E5;&#x8BC6;"><a href="#&#x524D;&#x7AEF;&#x9519;&#x8BEF;&#x76D1;&#x63A7;&#x77E5;&#x8BC6;" class="headerlink" title="&#x524D;&#x7AEF;&#x9519;&#x8BEF;&#x76D1;&#x63A7;&#x77E5;&#x8BC6;"></a>&#x524D;&#x7AEF;&#x9519;&#x8BEF;&#x76D1;&#x63A7;&#x77E5;&#x8BC6;</h2><p>&#x6458;&#x6284;&#x81EA; <a href="/external_links/39b5258e3b02cba962bdae6377987b78.html" target="blank" rel="noopener">&#x6155;&#x8BFE;&#x7F51;&#x89C6;&#x9891;&#x6559;&#x7A0B;&#xFF1A;&#x524D;&#x7AEF;&#x8DF3;&#x69FD;&#x9762;&#x8BD5;&#x5FC5;&#x5907;&#x6280;&#x5DE7;</a>  </p>
<p><a href="/external_links/0f201563b4324474aed149977c6a889d.html" target="blank" rel="noopener">&#x522B;&#x4EBA;&#x505A;&#x7684;&#x7B14;&#x8BB0;&#xFF1A;&#x524D;&#x7AEF;&#x8DF3;&#x69FD;&#x9762;&#x8BD5;&#x5FC5;&#x5907;&#x6280;&#x5DE7;-4-4 &#x9519;&#x8BEF;&#x76D1;&#x63A7;&#x7C7B;</a></p>
<h3 id="&#x524D;&#x7AEF;&#x9519;&#x8BEF;&#x7684;&#x5206;&#x7C7B;"><a href="#&#x524D;&#x7AEF;&#x9519;&#x8BEF;&#x7684;&#x5206;&#x7C7B;" class="headerlink" title="&#x524D;&#x7AEF;&#x9519;&#x8BEF;&#x7684;&#x5206;&#x7C7B;"></a>&#x524D;&#x7AEF;&#x9519;&#x8BEF;&#x7684;&#x5206;&#x7C7B;</h3><blockquote>
<p><strong>1.&#x5373;&#x65F6;&#x8FD0;&#x884C;&#x9519;&#x8BEF;&#xFF1A;&#x4EE3;&#x7801;&#x9519;&#x8BEF;</strong></p>
</blockquote>
<p><code>try...catch</code></p>
<p><code>window.onerror</code> (&#x4E5F;&#x53EF;&#x4EE5;&#x7528;<code>DOM2</code>&#x4E8B;&#x4EF6;&#x76D1;&#x542C;)</p>
<blockquote>
<p><strong>2.&#x8D44;&#x6E90;&#x52A0;&#x8F7D;&#x9519;&#x8BEF;</strong></p>
</blockquote>
<p><code>object.onerror</code>: <code>dom</code>&#x5BF9;&#x8C61;&#x7684;<code>onerror</code>&#x4E8B;&#x4EF6;</p>
<p><code>performance.getEntries()</code></p>
<p><code>Error</code>&#x4E8B;&#x4EF6;&#x6355;&#x83B7;</p>
<blockquote>
<p>3.<strong>&#x4F7F;&#x7528;<code>performance.getEntries()</code>&#x83B7;&#x53D6;&#x7F51;&#x9875;&#x56FE;&#x7247;&#x52A0;&#x8F7D;&#x9519;&#x8BEF;</strong></p>
</blockquote>
<p><code>var allImgs = document.getElementsByTagName(&apos;image&apos;)</code></p>
<p><code>var loadedImgs = performance.getEntries().filter(i =&gt; i.initiatorType === &apos;img&apos;)</code></p>
<p>&#x6700;&#x540E;<code>allIms</code>&#x548C;<code>loadedImgs</code>&#x5BF9;&#x6BD4;&#x5373;&#x53EF;&#x627E;&#x51FA;&#x56FE;&#x7247;&#x8D44;&#x6E90;&#x672A;&#x52A0;&#x8F7D;&#x9879;&#x76EE;</p>
<h3 id="Error&#x4E8B;&#x4EF6;&#x6355;&#x83B7;&#x4EE3;&#x7801;&#x793A;&#x4F8B;"><a href="#Error&#x4E8B;&#x4EF6;&#x6355;&#x83B7;&#x4EE3;&#x7801;&#x793A;&#x4F8B;" class="headerlink" title="Error&#x4E8B;&#x4EF6;&#x6355;&#x83B7;&#x4EE3;&#x7801;&#x793A;&#x4F8B;"></a>Error&#x4E8B;&#x4EF6;&#x6355;&#x83B7;&#x4EE3;&#x7801;&#x793A;&#x4F8B;</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;window.addEventListener(&apos;error&apos;, function(e) {</span><br><span class="line">  console.log(&apos;&#x6355;&#x83B7;&apos;, e)</span><br><span class="line">}, true) // &#x8FD9;&#x91CC;&#x53EA;&#x6709;&#x6355;&#x83B7;&#x624D;&#x80FD;&#x89E6;&#x53D1;&#x4E8B;&#x4EF6;&#xFF0C;&#x5192;&#x6CE1;&#x662F;&#x4E0D;&#x80FD;&#x89E6;&#x53D1;</span><br></pre></td></tr></table></figure>

<h3 id="&#x4E0A;&#x62A5;&#x9519;&#x8BEF;&#x7684;&#x57FA;&#x672C;&#x539F;&#x7406;"><a href="#&#x4E0A;&#x62A5;&#x9519;&#x8BEF;&#x7684;&#x57FA;&#x672C;&#x539F;&#x7406;" class="headerlink" title="&#x4E0A;&#x62A5;&#x9519;&#x8BEF;&#x7684;&#x57FA;&#x672C;&#x539F;&#x7406;"></a>&#x4E0A;&#x62A5;&#x9519;&#x8BEF;&#x7684;&#x57FA;&#x672C;&#x539F;&#x7406;</h3><p>1.&#x91C7;&#x7528;<code>Ajax</code>&#x901A;&#x4FE1;&#x7684;&#x65B9;&#x5F0F;&#x4E0A;&#x62A5;</p>
<p>2.&#x5229;&#x7528;<code>Image</code>&#x5BF9;&#x8C61;&#x4E0A;&#x62A5; (&#x4E3B;&#x6D41;&#x65B9;&#x5F0F;)</p>
<p><code>Image</code>&#x4E0A;&#x62A5;&#x9519;&#x8BEF;&#x65B9;&#x5F0F;&#xFF1A;<br><code>(new Image()).src = &apos;https://lxchuan12.cn/error?name=&#x82E5;&#x5DDD;&apos;</code></p>
<h2 id="Sentry-&#x524D;&#x7AEF;&#x5F02;&#x5E38;&#x76D1;&#x63A7;&#x57FA;&#x672C;&#x539F;&#x7406;"><a href="#Sentry-&#x524D;&#x7AEF;&#x5F02;&#x5E38;&#x76D1;&#x63A7;&#x57FA;&#x672C;&#x539F;&#x7406;" class="headerlink" title="Sentry &#x524D;&#x7AEF;&#x5F02;&#x5E38;&#x76D1;&#x63A7;&#x57FA;&#x672C;&#x539F;&#x7406;"></a>Sentry &#x524D;&#x7AEF;&#x5F02;&#x5E38;&#x76D1;&#x63A7;&#x57FA;&#x672C;&#x539F;&#x7406;</h2><blockquote>
<p>1.&#x91CD;&#x5199; <code>window.onerror</code> &#x65B9;&#x6CD5;&#x3001;&#x91CD;&#x5199; <code>window.onunhandledrejection</code> &#x65B9;&#x6CD5;</p>
</blockquote>
<p>&#x5982;&#x679C;&#x4E0D;&#x4E86;&#x89E3;<code>onerror&#x548C;onunhandledrejection</code>&#x65B9;&#x6CD5;&#x7684;&#x8BFB;&#x8005;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x76F8;&#x5173;&#x7684;<code>MDN</code>&#x6587;&#x6863;&#x3002;&#x8FD9;&#x91CC;&#x7B80;&#x8981;&#x4ECB;&#x7ECD;&#x4E00;&#x4E0B;&#xFF1A;</p>
<p><a href="/external_links/0f6a75146ee1cc40bdfb15bce51187b2.html" target="blank" rel="noopener">MDN GlobalEventHandlers.onerror</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;window.onerror = function (message, source, lineno, colno, error) {</span><br><span class="line"> console.log(&apos;message, source, lineno, colno, error&apos;, message, source, lineno, colno, error);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&#x53C2;&#x6570;&#xFF1A;  </p>
<p><code>message</code>&#xFF1A;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#xFF08;&#x5B57;&#x7B26;&#x4E32;&#xFF09;&#x3002;&#x53EF;&#x7528;&#x4E8E;<code>HTML onerror=&quot;&quot;</code>&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x4E2D;&#x7684;<code>event</code>&#x3002;  </p>
<p><code>source</code>&#xFF1A;&#x53D1;&#x751F;&#x9519;&#x8BEF;&#x7684;&#x811A;&#x672C;<code>URL</code>&#xFF08;&#x5B57;&#x7B26;&#x4E32;&#xFF09;  </p>
<p><code>lineno</code>&#xFF1A;&#x53D1;&#x751F;&#x9519;&#x8BEF;&#x7684;&#x884C;&#x53F7;&#xFF08;&#x6570;&#x5B57;&#xFF09;  </p>
<p><code>colno</code>&#xFF1A;&#x53D1;&#x751F;&#x9519;&#x8BEF;&#x7684;&#x5217;&#x53F7;&#xFF08;&#x6570;&#x5B57;&#xFF09;  </p>
<p><code>error</code>&#xFF1A;<code>Error</code>&#x5BF9;&#x8C61;&#xFF08;&#x5BF9;&#x8C61;&#xFF09;</p>
</blockquote>
<p><a href="/external_links/9de86fbf69391ce2657936dca3867fe8.html" target="blank" rel="noopener">MDN unhandledrejection</a></p>
<blockquote>
<p>&#x5F53; <code>Promise</code> &#x88AB; <code>reject</code> &#x4E14;&#x6CA1;&#x6709; <code>reject</code> &#x5904;&#x7406;&#x5668;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x89E6;&#x53D1; <code>unhandledrejection</code> &#x4E8B;&#x4EF6;&#xFF1B;&#x8FD9;&#x53EF;&#x80FD;&#x53D1;&#x751F;&#x5728; <code>window</code> &#x4E0B;&#xFF0C;&#x4F46;&#x4E5F;&#x53EF;&#x80FD;&#x53D1;&#x751F;&#x5728; <code>Worker</code> &#x4E2D;&#x3002; &#x8FD9;&#x5BF9;&#x4E8E;&#x8C03;&#x8BD5;&#x56DE;&#x9000;&#x9519;&#x8BEF;&#x5904;&#x7406;&#x975E;&#x5E38;&#x6709;&#x7528;&#x3002;</p>
</blockquote>
<p><code>Sentry</code> &#x6E90;&#x7801;&#x53EF;&#x4EE5;&#x641C;&#x7D22; <code>global.onerror</code> &#x5B9A;&#x4F4D;&#x5230;&#x5177;&#x4F53;&#x4F4D;&#x7F6E;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801; GlobalHandlers.prototype._installGlobalOnErrorHandler = function () {</span><br><span class="line"> // &#x4EE3;&#x7801;&#x6709;&#x5220;&#x51CF;</span><br><span class="line"> // &#x8FD9;&#x91CC;&#x7684; this._global &#x5728;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x5C31;&#x662F; window</span><br><span class="line"> this._oldOnErrorHandler = this._global.onerror;</span><br><span class="line"> this._global.onerror = function (msg, url, line, column, error) {}</span><br><span class="line"> // code ...</span><br><span class="line"> }</span><br></pre></td></tr></table></figure>

<p>&#x540C;&#x6837;&#xFF0C;&#x53EF;&#x4EE5;&#x641C;&#x7D22;<code>global.onunhandledrejection</code> &#x5B9A;&#x4F4D;&#x5230;&#x5177;&#x4F53;&#x4F4D;&#x7F6E;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;GlobalHandlers.prototype._installGlobalOnUnhandledRejectionHandler = function () {</span><br><span class="line"> // &#x4EE3;&#x7801;&#x6709;&#x5220;&#x51CF;</span><br><span class="line"> this._oldOnUnhandledRejectionHandler = this._global.onunhandledrejection;</span><br><span class="line"> this._global.onunhandledrejection = function (e) {}</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<blockquote>
<p>2.&#x91C7;&#x7528;<code>Ajax</code>&#x4E0A;&#x4F20;</p>
</blockquote>
<p>&#x652F;&#x6301; <code>fetch</code> &#x4F7F;&#x7528; <code>fetch</code>&#xFF0C;&#x5426;&#x5219;&#x4F7F;&#x7528;&#x2003;<code>XHR</code>&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;BrowserBackend.prototype._setupTransport = function () {</span><br><span class="line"> // &#x4EE3;&#x7801;&#x6709;&#x5220;&#x51CF;</span><br><span class="line"> if (supportsFetch()) {</span><br><span class="line">  return new FetchTransport(transportOptions);</span><br><span class="line"> }</span><br><span class="line"> return new XHRTransport(transportOptions);</span><br><span class="line">};</span><br></pre></td></tr></table></figure>

<blockquote>
<p>2.1 <code>fetch</code></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;FetchTransport.prototype.sendEvent = function (event) {</span><br><span class="line"> var defaultOptions = {</span><br><span class="line">  body: JSON.stringify(event),</span><br><span class="line">  method: &apos;POST&apos;,</span><br><span class="line">  referrerPolicy: (supportsReferrerPolicy() ? &apos;origin&apos; : &apos;&apos;),</span><br><span class="line"> };</span><br><span class="line"> return this._buffer.add(global$2.fetch(this.url, defaultOptions).then(function (response) { return ({</span><br><span class="line">  status: exports.Status.fromHttpCode(response.status),</span><br><span class="line"> }); }));</span><br><span class="line">};</span><br></pre></td></tr></table></figure>

<blockquote>
<p>2.2 <code>XMLHttpRequest</code></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;XHRTransport.prototype.sendEvent = function (event) {</span><br><span class="line"> var _this = this;</span><br><span class="line"> return this._buffer.add(new SyncPromise(function (resolve, reject) {</span><br><span class="line">  // &#x719F;&#x6089;&#x7684; XMLHttpRequest</span><br><span class="line">  var request = new XMLHttpRequest();</span><br><span class="line">  request.onreadystatechange = function () {</span><br><span class="line">   if (request.readyState !== 4) {</span><br><span class="line">    return;</span><br><span class="line">   }</span><br><span class="line">   if (request.status === 200) {</span><br><span class="line">    resolve({</span><br><span class="line">     status: exports.Status.fromHttpCode(request.status),</span><br><span class="line">    });</span><br><span class="line">   }</span><br><span class="line">   reject(request);</span><br><span class="line">  };</span><br><span class="line">  request.open(&apos;POST&apos;, _this.url);</span><br><span class="line">  request.send(JSON.stringify(event));</span><br><span class="line"> }));</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x63A5;&#x4E0B;&#x6765;&#x4E3B;&#x8981;&#x901A;&#x8FC7;Sentry&#x521D;&#x59CB;&#x5316;&#x3001;&#x5982;&#x4F55;<code>Ajax&#x4E0A;&#x62A5;</code>&#x548C;<code>window.onerror&#x3001;window.onunhandledrejection</code>&#x4E09;&#x6761;&#x4E3B;&#x7EBF;&#x6765;&#x5B66;&#x4E60;&#x6E90;&#x7801;&#x3002;</p>
<blockquote>
<p>&#x5982;&#x679C;&#x770B;&#x5230;&#x8FD9;&#x91CC;&#xFF0C;&#x6682;&#x65F6;&#x4E0D;&#x60F3;&#x5173;&#x6CE8;&#x540E;&#x9762;&#x7684;&#x6E90;&#x7801;&#x7EC6;&#x8282;&#xFF0C;&#x76F4;&#x63A5;&#x770B;&#x540E;&#x6587;&#x5C0F;&#x7ED3;1&#x548C;2&#x7684;&#x4E24;&#x5F20;&#x56FE;&#x3002;&#x6216;&#x8005;&#x53EF;&#x4EE5;&#x70B9;&#x8D5E;&#x6216;&#x6536;&#x85CF;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#xFF0C;&#x540E;&#x7EED;&#x60F3;&#x770B;&#x4E86;&#x518D;&#x770B;&#x3002;</p>
</blockquote>
<h2 id="Sentry-&#x6E90;&#x7801;&#x5165;&#x53E3;&#x548C;&#x51FA;&#x53E3;"><a href="#Sentry-&#x6E90;&#x7801;&#x5165;&#x53E3;&#x548C;&#x51FA;&#x53E3;" class="headerlink" title="Sentry &#x6E90;&#x7801;&#x5165;&#x53E3;&#x548C;&#x51FA;&#x53E3;"></a>Sentry &#x6E90;&#x7801;&#x5165;&#x53E3;&#x548C;&#x51FA;&#x53E3;</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;  var Sentry = (function(exports){</span><br><span class="line"> // code ...</span><br><span class="line"></span><br><span class="line">  var SDK_NAME = &apos;sentry.javascript.browser&apos;;</span><br><span class="line"> var SDK_VERSION = &apos;5.7.1&apos;;</span><br><span class="line"></span><br><span class="line"> // code ...</span><br><span class="line"> // &#x7701;&#x7565;&#x4E86;&#x5BFC;&#x51FA;&#x7684;Sentry&#x7684;&#x82E5;&#x5E72;&#x4E2A;&#x65B9;&#x6CD5;&#x548C;&#x5C5E;&#x6027;</span><br><span class="line"> // &#x53EA;&#x5217;&#x51FA;&#x4E86;&#x5982;&#x4E0B;&#x51E0;&#x4E2A;</span><br><span class="line">  exports.SDK_NAME = SDK_NAME;</span><br><span class="line">  exports.SDK_VERSION = SDK_VERSION;</span><br><span class="line"> // &#x91CD;&#x70B9;&#x5173;&#x6CE8; captureMessage</span><br><span class="line">  exports.captureMessage = captureMessage;</span><br><span class="line"> // &#x91CD;&#x70B9;&#x5173;&#x6CE8; init</span><br><span class="line">  exports.init = init;</span><br><span class="line"></span><br><span class="line">  return exports;</span><br><span class="line">}({}));</span><br></pre></td></tr></table></figure>

<h2 id="Sentry-init-&#x521D;&#x59CB;&#x5316;-&#x4E4B;-init-&#x51FD;&#x6570;"><a href="#Sentry-init-&#x521D;&#x59CB;&#x5316;-&#x4E4B;-init-&#x51FD;&#x6570;" class="headerlink" title="Sentry.init &#x521D;&#x59CB;&#x5316; &#x4E4B; init &#x51FD;&#x6570;"></a>Sentry.init &#x521D;&#x59CB;&#x5316; &#x4E4B; init &#x51FD;&#x6570;</h2><p>&#x521D;&#x59CB;&#x5316;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// &#x8FD9;&#x91CC;&#x7684;dsn&#xFF0C;&#x662F;sentry.io&#x7F51;&#x7AD9;&#x4F1A;&#x751F;&#x6210;&#x7684;&#x3002;</span><br><span class="line">Sentry.init({ dsn: &apos;xxx&apos; });</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// options &#x662F; {dsn: &apos;...&apos;}</span><br><span class="line">function init(options) {</span><br><span class="line"> // &#x5982;&#x679C;options &#x662F;undefined&#xFF0C;&#x5219;&#x8D4B;&#x503C;&#x4E3A; &#x7A7A;&#x5BF9;&#x8C61;</span><br><span class="line"> if (options === void 0) { options = {}; }</span><br><span class="line"> // &#x5982;&#x679C;&#x6CA1;&#x4F20; defaultIntegrations &#x5219;&#x8D4B;&#x503C;&#x9ED8;&#x8BA4;&#x7684;</span><br><span class="line"> if (options.defaultIntegrations === undefined) {</span><br><span class="line">  options.defaultIntegrations = defaultIntegrations;</span><br><span class="line"> }</span><br><span class="line"> // &#x521D;&#x59CB;&#x5316;&#x8BED;&#x53E5;</span><br><span class="line"> if (options.release === undefined) {</span><br><span class="line">  var window_1 = getGlobalObject();</span><br><span class="line">  // &#x8FD9;&#x662F;&#x7ED9;  sentry-webpack-plugin &#x63D2;&#x4EF6;&#x63D0;&#x4F9B;&#x7684;&#xFF0C;webpack&#x63D2;&#x4EF6;&#x6CE8;&#x5165;&#x7684;&#x53D8;&#x91CF;&#x3002;&#x8FD9;&#x91CC;&#x6CA1;&#x7528;&#x8FD9;&#x4E2A;&#x63D2;&#x4EF6;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x4E0D;&#x6DF1;&#x7A76;&#x3002;</span><br><span class="line">  // This supports the variable that sentry-webpack-plugin injects</span><br><span class="line">  if (window_1.SENTRY_RELEASE &amp;&amp; window_1.SENTRY_RELEASE.id) {</span><br><span class="line">   options.release = window_1.SENTRY_RELEASE.id;</span><br><span class="line">  }</span><br><span class="line"> }</span><br><span class="line"> // &#x521D;&#x59CB;&#x5316;&#x5E76;&#x4E14;&#x7ED1;&#x5B9A;</span><br><span class="line"> initAndBind(BrowserClient, options);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="getGlobalObject&#x3001;inNodeEnv-&#x51FD;&#x6570;"><a href="#getGlobalObject&#x3001;inNodeEnv-&#x51FD;&#x6570;" class="headerlink" title="getGlobalObject&#x3001;inNodeEnv &#x51FD;&#x6570;"></a>getGlobalObject&#x3001;inNodeEnv &#x51FD;&#x6570;</h3><p>&#x5F88;&#x591A;&#x5730;&#x65B9;&#x7528;&#x5230;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;<code>getGlobalObject</code>&#x3002;&#x5176;&#x5B9E;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#x4E5F;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#xFF0C;&#x5C31;&#x662F;&#x83B7;&#x53D6;&#x5168;&#x5C40;&#x5BF9;&#x8C61;&#x3002;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x662F;<code>window</code>&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;/**</span><br><span class="line"> * &#x5224;&#x65AD;&#x662F;&#x5426;&#x662F;node&#x73AF;&#x5883;</span><br><span class="line"> * Checks whether we&apos;re in the Node.js or Browser environment</span><br><span class="line"> *</span><br><span class="line"> * @returns Answer to given question</span><br><span class="line"> */</span><br><span class="line">function isNodeEnv() {</span><br><span class="line"> // tslint:disable:strict-type-predicates</span><br><span class="line"> return Object.prototype.toString.call(typeof process !== &apos;undefined&apos; ? process : 0) === &apos;[object process]&apos;;</span><br><span class="line">}</span><br><span class="line">var fallbackGlobalObject = {};</span><br><span class="line">/**</span><br><span class="line"> * Safely get global scope object</span><br><span class="line"> *</span><br><span class="line"> * @returns Global scope object</span><br><span class="line"> */</span><br><span class="line">function getGlobalObject() {</span><br><span class="line"> return (isNodeEnv()</span><br><span class="line"> // &#x662F; node &#x73AF;&#x5883; &#x8D4B;&#x503C;&#x7ED9; global</span><br><span class="line">  ? global</span><br><span class="line">  : typeof window !== &apos;undefined&apos;</span><br><span class="line">   ? window</span><br><span class="line">   // &#x4E0D;&#x662F; window self &#x4E0D;&#x662F;undefined &#x8BF4;&#x660E;&#x662F; Web Worker &#x73AF;&#x5883;</span><br><span class="line">   : typeof self !== &apos;undefined&apos;</span><br><span class="line">    ? self</span><br><span class="line">    // &#x90FD;&#x4E0D;&#x662F;&#xFF0C;&#x8D4B;&#x503C;&#x7ED9;&#x7A7A;&#x5BF9;&#x8C61;&#x3002;</span><br><span class="line">    : fallbackGlobalObject);</span><br></pre></td></tr></table></figure>

<p>&#x7EE7;&#x7EED;&#x770B; <code>initAndBind</code> &#x51FD;&#x6570;</p>
<h2 id="initAndBind-&#x51FD;&#x6570;&#x4E4B;-new-BrowserClient-options"><a href="#initAndBind-&#x51FD;&#x6570;&#x4E4B;-new-BrowserClient-options" class="headerlink" title="initAndBind &#x51FD;&#x6570;&#x4E4B; new BrowserClient(options)"></a>initAndBind &#x51FD;&#x6570;&#x4E4B; new BrowserClient(options)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function initAndBind(clientClass, options) {</span><br><span class="line"> // &#x8FD9;&#x91CC;&#x6CA1;&#x6709;&#x5F00;&#x542F;debug&#x6A21;&#x5F0F;&#xFF0C;logger.enable() &#x8FD9;&#x53E5;&#x4E0D;&#x4F1A;&#x6267;&#x884C;</span><br><span class="line"> if (options.debug === true) {</span><br><span class="line">  logger.enable();</span><br><span class="line"> }</span><br><span class="line"> getCurrentHub().bindClient(new clientClass(options));</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x53EF;&#x4EE5;&#x770B;&#x51FA; <code>initAndBind()</code>&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x662F; <code>BrowserClient</code> &#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#x662F;&#x521D;&#x59CB;&#x5316;&#x540E;&#x7684;<code>options</code>&#x3002;<br>&#x63A5;&#x7740;&#x5148;&#x770B; &#x6784;&#x9020;&#x51FD;&#x6570; <code>BrowserClient</code>&#x3002;<br>&#x53E6;&#x4E00;&#x6761;&#x7EBF; <code>getCurrentHub().bindClient()</code> &#x5148;&#x4E0D;&#x770B;&#x3002;</p>
<h3 id="BrowserClient-&#x6784;&#x9020;&#x51FD;&#x6570;"><a href="#BrowserClient-&#x6784;&#x9020;&#x51FD;&#x6570;" class="headerlink" title="BrowserClient &#x6784;&#x9020;&#x51FD;&#x6570;"></a>BrowserClient &#x6784;&#x9020;&#x51FD;&#x6570;</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;var BrowserClient = /** @class */ (function (_super) {</span><br><span class="line"> // `BrowserClient` &#x7EE7;&#x627F;&#x81EA;`BaseClient`</span><br><span class="line"> __extends(BrowserClient, _super);</span><br><span class="line"> /**</span><br><span class="line">  * Creates a new Browser SDK instance.</span><br><span class="line">  *</span><br><span class="line">  * @param options Configuration options for this SDK.</span><br><span class="line">  */</span><br><span class="line"> function BrowserClient(options) {</span><br><span class="line">  if (options === void 0) { options = {}; }</span><br><span class="line">  // &#x628A;`BrowserBackend`&#xFF0C;`options`&#x4F20;&#x53C2;&#x7ED9;`BaseClient`&#x8C03;&#x7528;&#x3002;</span><br><span class="line">  return _super.call(this, BrowserBackend, options) || this;</span><br><span class="line"> }</span><br><span class="line"> return BrowserClient;</span><br><span class="line">}(BaseClient));</span><br></pre></td></tr></table></figure>

<p><code>&#x4ECE;&#x4EE3;&#x7801;&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x51FA;</code>&#xFF1A;<br><code>BrowserClient</code> &#x7EE7;&#x627F;&#x81EA;<code>BaseClient</code>&#xFF0C;&#x5E76;&#x4E14;&#x628A;<code>BrowserBackend</code>&#xFF0C;<code>options</code>&#x4F20;&#x53C2;&#x7ED9;<code>BaseClient</code>&#x8C03;&#x7528;&#x3002;</p>
<p>&#x5148;&#x770B; <code>BrowserBackend</code>&#xFF0C;&#x8FD9;&#x91CC;&#x7684;<code>BaseClient</code>&#xFF0C;&#x6682;&#x65F6;&#x4E0D;&#x770B;&#x3002;</p>
<p>&#x770B;<code>BrowserBackend</code>&#x4E4B;&#x524D;&#xFF0C;&#x5148;&#x63D0;&#x4E00;&#x4E0B;&#x7EE7;&#x627F;&#x3001;&#x7EE7;&#x627F;&#x9759;&#x6001;&#x5C5E;&#x6027;&#x548C;&#x65B9;&#x6CD5;&#x3002;</p>
<h3 id="extends&#x3001;extendStatics-&#x6253;&#x5305;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;&#x7684;&#x7EE7;&#x627F;"><a href="#extends&#x3001;extendStatics-&#x6253;&#x5305;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;&#x7684;&#x7EE7;&#x627F;" class="headerlink" title="__extends&#x3001;extendStatics &#x6253;&#x5305;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;&#x7684;&#x7EE7;&#x627F;"></a>__extends&#x3001;extendStatics &#x6253;&#x5305;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;&#x7684;&#x7EE7;&#x627F;</h3><p>&#x672A;&#x6253;&#x5305;&#x7684;&#x6E90;&#x7801;&#x662F;&#x4F7F;&#x7528;<code>ES6 extends</code>&#x5B9E;&#x73B0;&#x7684;&#x3002;&#x8FD9;&#x662F;&#x6253;&#x5305;&#x540E;&#x7684;&#x5BF9;<code>ES6</code>&#x7684;<code>extends</code>&#x7684;&#x4E00;&#x79CD;&#x5B9E;&#x73B0;&#x3002;</p>
<p>&#x5982;&#x679C;&#x5BF9;&#x7EE7;&#x627F;&#x8FD8;&#x4E0D;&#x662F;&#x5F88;&#x719F;&#x6089;&#x7684;&#x8BFB;&#x8005;&#xFF0C;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x6211;&#x4E4B;&#x524D;&#x5199;&#x7684;&#x6587;&#x7AE0;&#x3002;<a href="https://dev.newban.cn/6844903780035592205">&#x9762;&#x8BD5;&#x5B98;&#x95EE;&#xFF1A;JS&#x7684;&#x7EE7;&#x627F;</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// &#x7EE7;&#x627F;&#x9759;&#x6001;&#x65B9;&#x6CD5;&#x548C;&#x5C5E;&#x6027;</span><br><span class="line">var extendStatics = function(d, b) {</span><br><span class="line"> // &#x5982;&#x679C;&#x652F;&#x6301; Object.setPrototypeOf &#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528;</span><br><span class="line"> // &#x4E0D;&#x652F;&#x6301;&#xFF0C;&#x5219;&#x4F7F;&#x7528;&#x539F;&#x578B;__proto__ &#x5C5E;&#x6027;&#xFF0C;</span><br><span class="line"> // &#x5982;&#x4F55;&#x8FD8;&#x4E0D;&#x652F;&#x6301;&#xFF08;&#x4F46;&#x6709;&#x53EF;&#x80FD;__proto__&#x4E5F;&#x4E0D;&#x652F;&#x6301;&#xFF0C;&#x6BD5;&#x7ADF;&#x662F;&#x6D4F;&#x89C8;&#x5668;&#x7279;&#x6709;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#xFF09;</span><br><span class="line"> // &#x5219;&#x4F7F;&#x7528;for in &#x904D;&#x5386;&#x539F;&#x578B;&#x94FE;&#x4E0A;&#x7684;&#x5C5E;&#x6027;&#xFF0C;&#x4ECE;&#x800C;&#x8FBE;&#x5230;&#x7EE7;&#x627F;&#x7684;&#x76EE;&#x7684;&#x3002;</span><br><span class="line"> extendStatics = Object.setPrototypeOf ||</span><br><span class="line">  ({ __proto__: [] } instanceof Array &amp;&amp; function (d, b) { d.__proto__ = b; }) ||</span><br><span class="line">  function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };</span><br><span class="line"> return extendStatics(d, b);</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">function __extends(d, b) {</span><br><span class="line"> extendStatics(d, b);</span><br><span class="line"> // &#x7533;&#x660E;&#x6784;&#x9020;&#x51FD;&#x6570;__ &#x5E76;&#x4E14;&#x628A; d &#x8D4B;&#x503C;&#x7ED9; constructor</span><br><span class="line"> function __() { this.constructor = d; }</span><br><span class="line"> // (__.prototype = b.prototype, new __()) &#x8FD9;&#x79CD;&#x9017;&#x53F7;&#x5F62;&#x5F0F;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x6700;&#x7EC8;&#x8FD4;&#x56DE;&#x662F;&#x540E;&#x8005;&#xFF0C;&#x4E5F;&#x5C31;&#x662F; new __()</span><br><span class="line"> // &#x6BD4;&#x5982; (typeof null, 1) &#x8FD4;&#x56DE;&#x7684;&#x662F;1</span><br><span class="line"> // &#x5982;&#x679C; b === null &#x7528;Object.create(b) &#x521B;&#x5EFA; &#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x4E0D;&#x542B;&#x539F;&#x578B;&#x94FE;&#x7B49;&#x4FE1;&#x606F;&#x7684;&#x7A7A;&#x5BF9;&#x8C61; {}</span><br><span class="line"> // &#x5426;&#x5219;&#x4F7F;&#x7528; new __() &#x8FD4;&#x56DE;</span><br><span class="line"> d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4E0D;&#x5F97;&#x4E0D;&#x8BF4;&#x8FD9;&#x6253;&#x5305;&#x540E;&#x7684;&#x4EE3;&#x7801;&#x5341;&#x5206;&#x4E25;&#x8C28;&#xFF0C;&#x4E0A;&#x9762;&#x8BF4;&#x7684;&#x6211;&#x7684;&#x6587;&#x7AE0;&#x300A;&#x9762;&#x8BD5;&#x5B98;&#x95EE;&#xFF1A;<code>JS</code>&#x7684;&#x7EE7;&#x627F;&#x300B;&#x4E2D;&#x6CA1;&#x6709;&#x63D0;&#x5230;&#x4E0D;&#x652F;&#x6301;<code>__proto__</code>&#x7684;&#x60C5;&#x51B5;&#x3002;&#x770B;&#x6765;&#x8FD9;&#x6587;&#x7AE0;&#x53EF;&#x4EE5;&#x8FDB;&#x4E00;&#x6B65;&#x4E25;&#x8C28;&#x4FEE;&#x6B63;&#x4E86;&#x3002;<br>&#x8BA9;&#x6211;&#x60F3;&#x8D77;<code>Vue</code>&#x6E90;&#x7801;&#x4E2D;&#x5BF9;&#x6570;&#x7EC4;&#x68C0;&#x6D4B;&#x4EE3;&#x7406;&#x5224;&#x65AD;&#x662F;&#x5426;&#x652F;&#x6301;<code>__proto__</code>&#x7684;&#x5224;&#x65AD;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// vuejs &#x6E90;&#x7801;&#xFF1A;https://github.com/vuejs/vue/blob/dev/dist/vue.js#L526-L527</span><br><span class="line">// can we use __proto__?</span><br><span class="line">var hasProto = &apos;__proto__&apos; in {};</span><br></pre></td></tr></table></figure>

<p>&#x770B;&#x5B8C;&#x6253;&#x5305;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;&#x7684;&#x7EE7;&#x627F;&#xFF0C;&#x7EE7;&#x7EED;&#x770B; <code>BrowserBackend</code> &#x6784;&#x9020;&#x51FD;&#x6570;</p>
<h3 id="BrowserBackend-&#x6784;&#x9020;&#x51FD;&#x6570;-&#xFF08;&#x6D4F;&#x89C8;&#x5668;&#x540E;&#x7AEF;&#xFF09;"><a href="#BrowserBackend-&#x6784;&#x9020;&#x51FD;&#x6570;-&#xFF08;&#x6D4F;&#x89C8;&#x5668;&#x540E;&#x7AEF;&#xFF09;" class="headerlink" title="BrowserBackend &#x6784;&#x9020;&#x51FD;&#x6570; &#xFF08;&#x6D4F;&#x89C8;&#x5668;&#x540E;&#x7AEF;&#xFF09;"></a>BrowserBackend &#x6784;&#x9020;&#x51FD;&#x6570; &#xFF08;&#x6D4F;&#x89C8;&#x5668;&#x540E;&#x7AEF;&#xFF09;</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;var BrowserBackend = /** @class */ (function (_super) {</span><br><span class="line">    __extends(BrowserBackend, _super);</span><br><span class="line"> function BrowserBackend() {</span><br><span class="line">  return _super !== null &amp;&amp; _super.apply(this, arguments) || this;</span><br><span class="line"> }</span><br><span class="line"> /**</span><br><span class="line">  * &#x8BBE;&#x7F6E;&#x8BF7;&#x6C42;</span><br><span class="line">  */</span><br><span class="line"> BrowserBackend.prototype._setupTransport = function () {</span><br><span class="line">  if (!this._options.dsn) {</span><br><span class="line">   // We return the noop transport here in case there is no Dsn.</span><br><span class="line">   // &#x6CA1;&#x6709;&#x8BBE;&#x7F6E;dsn&#xFF0C;&#x8C03;&#x7528;BaseBackend.prototype._setupTransport &#x8FD4;&#x56DE;&#x7A7A;&#x51FD;&#x6570;</span><br><span class="line">   return _super.prototype._setupTransport.call(this);</span><br><span class="line">  }</span><br><span class="line">  var transportOptions = __assign({}, this._options.transportOptions, { dsn: this._options.dsn });</span><br><span class="line">  if (this._options.transport) {</span><br><span class="line">   return new this._options.transport(transportOptions);</span><br><span class="line">  }</span><br><span class="line">  // &#x652F;&#x6301;Fetch&#x5219;&#x8FD4;&#x56DE; FetchTransport &#x5B9E;&#x4F8B;&#xFF0C;&#x5426;&#x5219;&#x8FD4;&#x56DE; XHRTransport&#x5B9E;&#x4F8B;&#xFF0C;</span><br><span class="line">  // &#x8FD9;&#x4E24;&#x4E2A;&#x6784;&#x9020;&#x51FD;&#x6570;&#x5177;&#x4F53;&#x4EE3;&#x7801;&#x5728;&#x5F00;&#x5934;&#x5DF2;&#x6709;&#x63D0;&#x5230;&#x3002;</span><br><span class="line">  if (supportsFetch()) {</span><br><span class="line">   return new FetchTransport(transportOptions);</span><br><span class="line">  }</span><br><span class="line">  return new XHRTransport(transportOptions);</span><br><span class="line"> };</span><br><span class="line"> // code ...</span><br><span class="line"> return BrowserBackend;</span><br><span class="line">}(BaseBackend));</span><br></pre></td></tr></table></figure>

<p><code>BrowserBackend</code> &#x53C8;&#x7EE7;&#x627F;&#x81EA; <code>BaseBackend</code>&#x3002;</p>
<h4 id="BaseBackend-&#x6784;&#x9020;&#x51FD;&#x6570;-&#xFF08;&#x57FA;&#x7840;&#x540E;&#x7AEF;&#xFF09;"><a href="#BaseBackend-&#x6784;&#x9020;&#x51FD;&#x6570;-&#xFF08;&#x57FA;&#x7840;&#x540E;&#x7AEF;&#xFF09;" class="headerlink" title="BaseBackend &#x6784;&#x9020;&#x51FD;&#x6570; &#xFF08;&#x57FA;&#x7840;&#x540E;&#x7AEF;&#xFF09;"></a>BaseBackend &#x6784;&#x9020;&#x51FD;&#x6570; &#xFF08;&#x57FA;&#x7840;&#x540E;&#x7AEF;&#xFF09;</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;/**</span><br><span class="line"> * This is the base implemention of a Backend.</span><br><span class="line"> * @hidden</span><br><span class="line"> */</span><br><span class="line">var BaseBackend = /** @class */ (function () {</span><br><span class="line"> /** Creates a new backend instance. */</span><br><span class="line"> function BaseBackend(options) {</span><br><span class="line">  this._options = options;</span><br><span class="line">  if (!this._options.dsn) {</span><br><span class="line">   logger.warn(&apos;No DSN provided, backend will not do anything.&apos;);</span><br><span class="line">  }</span><br><span class="line">  // &#x8C03;&#x7528;&#x8BBE;&#x7F6E;&#x8BF7;&#x6C42;&#x51FD;&#x6570;</span><br><span class="line">  this._transport = this._setupTransport();</span><br><span class="line"> }</span><br><span class="line"> /**</span><br><span class="line">  * Sets up the transport so it can be used later to send requests.</span><br><span class="line">  * &#x8BBE;&#x7F6E;&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x7A7A;&#x51FD;&#x6570;</span><br><span class="line">  */</span><br><span class="line"> BaseBackend.prototype._setupTransport = function () {</span><br><span class="line">  return new NoopTransport();</span><br><span class="line"> };</span><br><span class="line"> // code ...</span><br><span class="line"> BaseBackend.prototype.sendEvent = function (event) {</span><br><span class="line">  this._transport.sendEvent(event).then(null, function (reason) {</span><br><span class="line">   logger.error(&quot;Error while sending event: &quot; + reason);</span><br><span class="line">  });</span><br><span class="line"> };</span><br><span class="line"> BaseBackend.prototype.getTransport = function () {</span><br><span class="line">  return this._transport;</span><br><span class="line"> };</span><br><span class="line"> return BaseBackend;</span><br><span class="line">}());</span><br></pre></td></tr></table></figure>

<p>&#x901A;&#x8FC7;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x7EE7;&#x627F;&#x540E;&#xFF0C;&#x56DE;&#x8FC7;&#x5934;&#x6765;&#x770B; <code>BaseClient</code> &#x6784;&#x9020;&#x51FD;&#x6570;&#x3002;</p>
<h4 id="BaseClient-&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF08;&#x57FA;&#x7840;&#x5BA2;&#x6237;&#x7AEF;&#xFF09;"><a href="#BaseClient-&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF08;&#x57FA;&#x7840;&#x5BA2;&#x6237;&#x7AEF;&#xFF09;" class="headerlink" title="BaseClient &#x6784;&#x9020;&#x51FD;&#x6570;&#xFF08;&#x57FA;&#x7840;&#x5BA2;&#x6237;&#x7AEF;&#xFF09;"></a>BaseClient &#x6784;&#x9020;&#x51FD;&#x6570;&#xFF08;&#x57FA;&#x7840;&#x5BA2;&#x6237;&#x7AEF;&#xFF09;</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;var BaseClient = /** @class */ (function () {</span><br><span class="line"> /**</span><br><span class="line">  * Initializes this client instance.</span><br><span class="line">  *</span><br><span class="line">  * @param backendClass A constructor function to create the backend.</span><br><span class="line">  * @param options Options for the client.</span><br><span class="line">  */</span><br><span class="line"> function BaseClient(backendClass, options) {</span><br><span class="line">  /** Array of used integrations. */</span><br><span class="line">  this._integrations = {};</span><br><span class="line">  /** Is the client still processing a call? */</span><br><span class="line">  this._processing = false;</span><br><span class="line">  this._backend = new backendClass(options);</span><br><span class="line">  this._options = options;</span><br><span class="line">  if (options.dsn) {</span><br><span class="line">   this._dsn = new Dsn(options.dsn);</span><br><span class="line">  }</span><br><span class="line">  if (this._isEnabled()) {</span><br><span class="line">   this._integrations = setupIntegrations(this._options);</span><br><span class="line">  }</span><br><span class="line"> }</span><br><span class="line"> // code ...</span><br><span class="line"> return BaseClient;</span><br><span class="line">}());</span><br></pre></td></tr></table></figure>

<h3 id="&#x5C0F;&#x7ED3;1-new-BrowerClient-&#x7ECF;&#x8FC7;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x7EE7;&#x627F;&#x548C;&#x521D;&#x59CB;&#x5316;"><a href="#&#x5C0F;&#x7ED3;1-new-BrowerClient-&#x7ECF;&#x8FC7;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x7EE7;&#x627F;&#x548C;&#x521D;&#x59CB;&#x5316;" class="headerlink" title="&#x5C0F;&#x7ED3;1. new BrowerClient &#x7ECF;&#x8FC7;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x7EE7;&#x627F;&#x548C;&#x521D;&#x59CB;&#x5316;"></a>&#x5C0F;&#x7ED3;1. new BrowerClient &#x7ECF;&#x8FC7;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x7EE7;&#x627F;&#x548C;&#x521D;&#x59CB;&#x5316;</h3><p>&#x53EF;&#x4EE5;&#x8F93;&#x51FA;&#x4E0B;&#x5177;&#x4F53;<code>new clientClass(options)</code>&#x4E4B;&#x540E;&#x7684;&#x7ED3;&#x679C;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function initAndBind(clientClass, options) {</span><br><span class="line"> if (options.debug === true) {</span><br><span class="line">  logger.enable();</span><br><span class="line"> }</span><br><span class="line"> var client = new clientClass(options);</span><br><span class="line"> console.log(&apos;new clientClass(options)&apos;, client);</span><br><span class="line"> getCurrentHub().bindClient(client);</span><br><span class="line"> // &#x539F;&#x6765;&#x7684;&#x4EE3;&#x7801;</span><br><span class="line"> // getCurrentHub().bindClient(new clientClass(options));</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x6700;&#x7EC8;&#x8F93;&#x51FA;&#x5F97;&#x5230;&#x8FD9;&#x6837;&#x7684;&#x6570;&#x636E;&#x3002;&#x6211;&#x753B;&#x4E86;&#x4E00;&#x5F20;&#x56FE;&#x8868;&#x793A;&#x3002;&#x91CD;&#x70B9;&#x5173;&#x6CE8;&#x7684;&#x539F;&#x578B;&#x94FE;&#x7528;&#x989C;&#x8272;&#x6807;&#x6CE8;&#x4E86;&#xFF0C;&#x5176;&#x4ED6;&#x90E8;&#x5206;&#x6536;&#x7F29;&#x4E86;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/83bb6f4ccccab7628c5d5de8c6eb05ae2378a02764baf57595a70bc68238aaf3" alt="sentry new BrowserClient &#x5B9E;&#x4F8B;&#x56FE; By@&#x82E5;&#x5DDD;"></p>
<p>sentry new BrowserClient &#x5B9E;&#x4F8B;&#x56FE; By@&#x82E5;&#x5DDD;</p>
<h2 id="initAndBind-&#x51FD;&#x6570;&#x4E4B;-getCurrentHub-bindClient"><a href="#initAndBind-&#x51FD;&#x6570;&#x4E4B;-getCurrentHub-bindClient" class="headerlink" title="initAndBind &#x51FD;&#x6570;&#x4E4B; getCurrentHub().bindClient()"></a>initAndBind &#x51FD;&#x6570;&#x4E4B; getCurrentHub().bindClient()</h2><p>&#x7EE7;&#x7EED;&#x770B; <code>initAndBind</code> &#x7684;&#x53E6;&#x4E00;&#x6761;&#x7EBF;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function initAndBind(clientClass, options) {</span><br><span class="line"> if (options.debug === true) {</span><br><span class="line">  logger.enable();</span><br><span class="line"> }</span><br><span class="line"> getCurrentHub().bindClient(new clientClass(options));</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x83B7;&#x53D6;&#x5F53;&#x524D;&#x7684;&#x63A7;&#x5236;&#x4E2D;&#x5FC3; <code>Hub</code>&#xFF0C;&#x518D;&#x628A;<code>new BrowserClient()</code> &#x7684;&#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;&#x7ED1;&#x5B9A;&#x5728;<code>Hub</code>&#x4E0A;&#x3002;</p>
<h3 id="getCurrentHub-&#x51FD;&#x6570;"><a href="#getCurrentHub-&#x51FD;&#x6570;" class="headerlink" title="getCurrentHub &#x51FD;&#x6570;"></a>getCurrentHub &#x51FD;&#x6570;</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// &#x83B7;&#x53D6;&#x5F53;&#x524D;Hub &#x63A7;&#x5236;&#x4E2D;&#x5FC3;</span><br><span class="line">function getCurrentHub() {</span><br><span class="line"> // Get main carrier (global for every environment)</span><br><span class="line"> var registry = getMainCarrier();</span><br><span class="line"> // &#x5982;&#x679C;&#x6CA1;&#x6709;&#x63A7;&#x5236;&#x4E2D;&#x5FC3;&#x5728;&#x8F7D;&#x4F53;&#x4E0A;&#xFF0C;&#x6216;&#x8005;&#x5B83;&#x7684;&#x7248;&#x672C;&#x662F;&#x8001;&#x7248;&#x672C;&#xFF0C;&#x5C31;&#x8BBE;&#x7F6E;&#x65B0;&#x7684;&#x3002;</span><br><span class="line"> // If there&apos;s no hub, or its an old API, assign a new one</span><br><span class="line"> if (!hasHubOnCarrier(registry) || getHubFromCarrier(registry).isOlderThan(API_VERSION)) {</span><br><span class="line">  setHubOnCarrier(registry, new Hub());</span><br><span class="line"> }</span><br><span class="line"> // node &#x624D;&#x6267;&#x884C;</span><br><span class="line"> // Prefer domains over global if they are there (applicable only to Node environment)</span><br><span class="line"> if (isNodeEnv()) {</span><br><span class="line">  return getHubFromActiveDomain(registry);</span><br><span class="line"> }</span><br><span class="line"> // &#x8FD4;&#x56DE;&#x5F53;&#x524D;&#x63A7;&#x5236;&#x4E2D;&#x5FC3;&#x6765;&#x81EA;&#x8F7D;&#x4F53;&#x4E0A;&#x3002;</span><br><span class="line"> // Return hub that lives on a global object</span><br><span class="line"> return getHubFromCarrier(registry);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="&#x884D;&#x751F;&#x7684;&#x51FD;&#x6570;-getMainCarrier&#x3001;getHubFromCarrier"><a href="#&#x884D;&#x751F;&#x7684;&#x51FD;&#x6570;-getMainCarrier&#x3001;getHubFromCarrier" class="headerlink" title="&#x884D;&#x751F;&#x7684;&#x51FD;&#x6570; getMainCarrier&#x3001;getHubFromCarrier"></a>&#x884D;&#x751F;&#x7684;&#x51FD;&#x6570; getMainCarrier&#x3001;getHubFromCarrier</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function getMainCarrier() {</span><br><span class="line"> // &#x8F7D;&#x4F53; &#x8FD9;&#x91CC;&#x662F;window</span><br><span class="line"> // &#x901A;&#x8FC7;&#x4E00;&#x7CFB;&#x5217;new BrowerClient() &#x4E00;&#x7CFB;&#x5217;&#x7684;&#x521D;&#x59CB;&#x5316;</span><br><span class="line"> // &#x6302;&#x8F7D;&#x5728;  carrier.__SENTRY__ &#x5DF2;&#x7ECF;&#x6709;&#x4E86;&#x4E09;&#x4E2A;&#x5C5E;&#x6027;&#xFF0C;globalEventProcessors, hub, logger</span><br><span class="line"> var carrier = getGlobalObject();</span><br><span class="line"> carrier.__SENTRY__ = carrier.__SENTRY__ || {</span><br><span class="line">  hub: undefined,</span><br><span class="line"> };</span><br><span class="line"> return carrier;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// &#x83B7;&#x53D6;&#x63A7;&#x5236;&#x4E2D;&#x5FC3; hub &#x4ECE;&#x8F7D;&#x4F53;&#x4E0A;</span><br><span class="line">function getHubFromCarrier(carrier) {</span><br><span class="line"> // &#x5DF2;&#x7ECF;&#x6709;&#x4E86;&#x5219;&#x8FD4;&#x56DE;&#xFF0C;&#x6CA1;&#x6709;&#x5219;new Hub</span><br><span class="line"> if (carrier &amp;&amp; carrier.__SENTRY__ &amp;&amp; carrier.__SENTRY__.hub) {</span><br><span class="line">  return carrier.__SENTRY__.hub;</span><br><span class="line"> }</span><br><span class="line"> carrier.__SENTRY__ = carrier.__SENTRY__ || {};</span><br><span class="line"> carrier.__SENTRY__.hub = new Hub();</span><br><span class="line"> return carrier.__SENTRY__.hub;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="bindClient-&#x7ED1;&#x5B9A;&#x5BA2;&#x6237;&#x7AEF;&#x5728;&#x5F53;&#x524D;&#x63A7;&#x5236;&#x4E2D;&#x5FC3;&#x4E0A;"><a href="#bindClient-&#x7ED1;&#x5B9A;&#x5BA2;&#x6237;&#x7AEF;&#x5728;&#x5F53;&#x524D;&#x63A7;&#x5236;&#x4E2D;&#x5FC3;&#x4E0A;" class="headerlink" title="bindClient &#x7ED1;&#x5B9A;&#x5BA2;&#x6237;&#x7AEF;&#x5728;&#x5F53;&#x524D;&#x63A7;&#x5236;&#x4E2D;&#x5FC3;&#x4E0A;"></a>bindClient &#x7ED1;&#x5B9A;&#x5BA2;&#x6237;&#x7AEF;&#x5728;&#x5F53;&#x524D;&#x63A7;&#x5236;&#x4E2D;&#x5FC3;&#x4E0A;</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;Hub.prototype.bindClient = function (client) {</span><br><span class="line"> // &#x83B7;&#x53D6;&#x6700;&#x540E;&#x4E00;&#x4E2A;</span><br><span class="line"> var top = this.getStackTop();</span><br><span class="line"> // &#x628A; new BrowerClient() &#x5B9E;&#x4F8B; &#x7ED1;&#x5B9A;&#x5230;top&#x4E0A;</span><br><span class="line"> top.client = client;</span><br><span class="line">};</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;Hub.prototype.getStackTop = function () {</span><br><span class="line"> // &#x83B7;&#x53D6;&#x6700;&#x540E;&#x4E00;&#x4E2A;</span><br><span class="line"> return this._stack[this._stack.length - 1];</span><br><span class="line">};</span><br></pre></td></tr></table></figure>

<h3 id="&#x5C0F;&#x7ED3;2-&#x7ECF;&#x8FC7;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x7EE7;&#x627F;&#x548C;&#x521D;&#x59CB;&#x5316;"><a href="#&#x5C0F;&#x7ED3;2-&#x7ECF;&#x8FC7;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x7EE7;&#x627F;&#x548C;&#x521D;&#x59CB;&#x5316;" class="headerlink" title="&#x5C0F;&#x7ED3;2. &#x7ECF;&#x8FC7;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x7EE7;&#x627F;&#x548C;&#x521D;&#x59CB;&#x5316;"></a>&#x5C0F;&#x7ED3;2. &#x7ECF;&#x8FC7;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x7EE7;&#x627F;&#x548C;&#x521D;&#x59CB;&#x5316;</h3><p>&#x518D;&#x56DE;&#x8FC7;&#x5934;&#x6765;&#x770B; <code>initAndBind</code>&#x51FD;&#x6570;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function initAndBind(clientClass, options) {</span><br><span class="line"> if (options.debug === true) {</span><br><span class="line">  logger.enable();</span><br><span class="line"> }</span><br><span class="line"> var client = new clientClass(options);</span><br><span class="line"> console.log(client, options, &apos;client, options&apos;);</span><br><span class="line"> var currentHub = getCurrentHub();</span><br><span class="line"> currentHub.bindClient(client);</span><br><span class="line"> console.log(&apos;currentHub&apos;, currentHub);</span><br><span class="line"> // &#x6E90;&#x4EE3;&#x7801;</span><br><span class="line"> // getCurrentHub().bindClient(new clientClass(options));</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x6700;&#x7EC8;&#x4F1A;&#x5F97;&#x5230;&#x8FD9;&#x6837;&#x7684;<code>Hub</code>&#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;&#x3002;&#x7B14;&#x8005;&#x753B;&#x4E86;&#x4E00;&#x5F20;&#x56FE;&#x8868;&#x793A;&#xFF0C;&#x4FBF;&#x4E8E;&#x67E5;&#x770B;&#x7406;&#x89E3;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/ca77592d1fd72f0663946cfaba55d1b9962a59f62667165c16326ecaeec2d0a7" alt="Hub &#x5B9E;&#x4F8B;&#x5173;&#x7CFB;&#x56FE;"></p>
<p>Hub &#x5B9E;&#x4F8B;&#x5173;&#x7CFB;&#x56FE;</p>
<p>&#x521D;&#x59CB;&#x5316;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x518D;&#x6765;&#x770B;&#x5177;&#x4F53;&#x4F8B;&#x5B50;&#x3002;<br>&#x5177;&#x4F53; <code>captureMessage</code> &#x51FD;&#x6570;&#x7684;&#x5B9E;&#x73B0;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;Sentry.captureMessage(&apos;Hello, &#x82E5;&#x5DDD;!&apos;);</span><br></pre></td></tr></table></figure>

<h2 id="captureMessage-&#x51FD;&#x6570;"><a href="#captureMessage-&#x51FD;&#x6570;" class="headerlink" title="captureMessage &#x51FD;&#x6570;"></a>captureMessage &#x51FD;&#x6570;</h2><p>&#x901A;&#x8FC7;&#x4E4B;&#x524D;&#x7684;&#x9605;&#x8BFB;&#x4EE3;&#x7801;&#xFF0C;&#x77E5;&#x9053;&#x4F1A;&#x6700;&#x7EC8;&#x4F1A;&#x8C03;&#x7528;<code>Fetch</code>&#x63A5;&#x53E3;&#xFF0C;&#x6240;&#x4EE5;&#x76F4;&#x63A5;&#x65AD;&#x70B9;&#x8C03;&#x8BD5;&#x5373;&#x53EF;&#xFF0C;&#x5F97;&#x51FA;&#x5982;&#x4E0B;&#x8C03;&#x7528;&#x6808;&#x3002;<br>&#x63A5;&#x4E0B;&#x6765;&#x63CF;&#x8FF0;&#x8C03;&#x7528;&#x6808;&#x7684;&#x4E3B;&#x8981;&#x6D41;&#x7A0B;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/987e9521fbe434117da0b7459270e5d9bce26830744f7e6c2dc2b8474d39e24f" alt="captureMessage &#x65AD;&#x70B9;&#x8C03;&#x8BD5;&#x56FE;"></p>
<p>captureMessage &#x65AD;&#x70B9;&#x8C03;&#x8BD5;&#x56FE;</p>
<blockquote>
<p>&#x8C03;&#x7528;&#x6808;&#x4E3B;&#x8981;&#x6D41;&#x7A0B;&#xFF1A;</p>
</blockquote>
<p>captureMessage</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function captureMessage(message, level) {</span><br><span class="line"> var syntheticException;</span><br><span class="line"> try {</span><br><span class="line">  throw new Error(message);</span><br><span class="line"> }</span><br><span class="line"> catch (exception) {</span><br><span class="line">  syntheticException = exception;</span><br><span class="line"> }</span><br><span class="line"> // &#x8C03;&#x7528; callOnHub &#x65B9;&#x6CD5;</span><br><span class="line"> return callOnHub(&apos;captureMessage&apos;, message, level, {</span><br><span class="line">  originalException: message,</span><br><span class="line">  syntheticException: syntheticException,</span><br><span class="line"> });</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>=&gt; callOnHub</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;/**</span><br><span class="line"> * This calls a function on the current hub.</span><br><span class="line"> * @param method function to call on hub.</span><br><span class="line"> * @param args to pass to function.</span><br><span class="line"> */</span><br><span class="line">function callOnHub(method) {</span><br><span class="line"> // &#x8FD9;&#x91CC;method &#x4F20;&#x8FDB;&#x6765;&#x7684;&#x662F; &apos;captureMessage&apos;</span><br><span class="line"> // &#x628A;method&#x9664;&#x5916;&#x7684;&#x5176;&#x4ED6;&#x53C2;&#x6570;&#x653E;&#x5230;args&#x6570;&#x7EC4;&#x4E2D;</span><br><span class="line"> var args = [];</span><br><span class="line"> for (var _i = 1; _i &lt; arguments.length; _i++) {</span><br><span class="line">  args[_i - 1] = arguments[_i];</span><br><span class="line"> }</span><br><span class="line"> // &#x83B7;&#x53D6;&#x5F53;&#x524D;&#x63A7;&#x5236;&#x4E2D;&#x5FC3; hub</span><br><span class="line"> var hub = getCurrentHub();</span><br><span class="line"> // &#x6709;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5; &#x628A;args &#x6570;&#x7EC4;&#x5C55;&#x5F00;&#xFF0C;&#x4F20;&#x9012;&#x7ED9; hub[method] &#x6267;&#x884C;</span><br><span class="line"> if (hub &amp;&amp; hub[method]) {</span><br><span class="line">  // tslint:disable-next-line:no-unsafe-any</span><br><span class="line">  return hub[method].apply(hub, __spread(args));</span><br><span class="line"> }</span><br><span class="line"> throw new Error(&quot;No hub defined or &quot; + method + &quot; was not found on the hub, please open a bug report.&quot;);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>=&gt; Hub.prototype.captureMessage</p>
<p>&#x63A5;&#x7740;&#x770B;<code>Hub.prototype</code> &#x4E0A;&#x5B9A;&#x4E49;&#x7684; <code>captureMessage</code> &#x65B9;&#x6CD5;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;Hub.prototype.captureMessage = function (message, level, hint) {</span><br><span class="line"> var eventId = (this._lastEventId = uuid4());</span><br><span class="line"> var finalHint = hint;</span><br><span class="line"> // &#x4EE3;&#x7801;&#x6709;&#x5220;&#x51CF;</span><br><span class="line"> this._invokeClient(&apos;captureMessage&apos;, message, level, __assign({}, finalHint, { event_id: eventId }));</span><br><span class="line"> return eventId;</span><br><span class="line">};</span><br></pre></td></tr></table></figure>

<p>=&gt; Hub.prototype._invokeClient</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;/**</span><br><span class="line"> * Internal helper function to call a method on the top client if it exists.</span><br><span class="line"> *</span><br><span class="line"> * @param method The method to call on the client.</span><br><span class="line"> * @param args Arguments to pass to the client function.</span><br><span class="line"> */</span><br><span class="line">Hub.prototype._invokeClient = function (method) {</span><br><span class="line"> // &#x540C;&#x6837;&#xFF1A;&#x8FD9;&#x91CC;method &#x4F20;&#x8FDB;&#x6765;&#x7684;&#x662F; &apos;captureMessage&apos;</span><br><span class="line"> // &#x628A;method&#x9664;&#x5916;&#x7684;&#x5176;&#x4ED6;&#x53C2;&#x6570;&#x653E;&#x5230;args&#x6570;&#x7EC4;&#x4E2D;</span><br><span class="line"> var _a;</span><br><span class="line"> var args = [];</span><br><span class="line"> for (var _i = 1; _i &lt; arguments.length; _i++) {</span><br><span class="line">  args[_i - 1] = arguments[_i];</span><br><span class="line"> }</span><br><span class="line"> var top = this.getStackTop();</span><br><span class="line"> // &#x83B7;&#x53D6;&#x63A7;&#x5236;&#x4E2D;&#x5FC3;&#x7684; hub&#xFF0C;&#x8C03;&#x7528;&#x5BA2;&#x6237;&#x7AEF;&#x4E5F;&#x5C31;&#x662F;new BrowerClient () &#x5B9E;&#x4F8B;&#x4E2D;&#x7EE7;&#x627F;&#x81EA; BaseClient &#x7684; captureMessage &#x65B9;&#x6CD5;</span><br><span class="line"> // &#x6709;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5; &#x628A;args &#x6570;&#x7EC4;&#x5C55;&#x5F00;&#xFF0C;&#x4F20;&#x9012;&#x7ED9; hub[method] &#x6267;&#x884C;</span><br><span class="line"> if (top &amp;&amp; top.client &amp;&amp; top.client[method]) {</span><br><span class="line">  (_a = top.client)[method].apply(_a, __spread(args, [top.scope]));</span><br><span class="line"> }</span><br><span class="line">};</span><br></pre></td></tr></table></figure>

<p>=&gt; BaseClient.prototype.captureMessage</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;BaseClient.prototype.captureMessage = function (message, level, hint, scope) {</span><br><span class="line"> var _this = this;</span><br><span class="line"> var eventId = hint &amp;&amp; hint.event_id;</span><br><span class="line"> this._processing = true;</span><br><span class="line"> var promisedEvent = isPrimitive(message)</span><br><span class="line">  ? this._getBackend().eventFromMessage(&quot;&quot; + message, level, hint)</span><br><span class="line">  : this._getBackend().eventFromException(message, hint);</span><br><span class="line">  // &#x4EE3;&#x7801;&#x6709;&#x5220;&#x51CF;</span><br><span class="line"> promisedEvent</span><br><span class="line">  .then(function (event) { return _this._processEvent(event, hint, scope); })</span><br><span class="line"> // &#x4EE3;&#x7801;&#x6709;&#x5220;&#x51CF;</span><br><span class="line"> return eventId;</span><br><span class="line">};</span><br></pre></td></tr></table></figure>

<p>&#x6700;&#x540E;&#x4F1A;&#x8C03;&#x7528; <code>_processEvent</code> &#x4E5F;&#x5C31;&#x662F;</p>
<p>=&gt; BaseClient.prototype._processEvent</p>
<p>&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x6700;&#x7EC8;&#x4F1A;&#x8C03;&#x7528;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;_this._getBackend().sendEvent(finalEvent);</span><br></pre></td></tr></table></figure>

<p>&#x4E5F;&#x5C31;&#x662F;</p>
<p>=&gt; BaseBackend.prototype.sendEvent</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;BaseBackend.prototype.sendEvent = function (event) {</span><br><span class="line"> this._transport.sendEvent(event).then(null, function (reason) {</span><br><span class="line">  logger.error(&quot;Error while sending event: &quot; + reason);</span><br><span class="line"> });</span><br><span class="line">};</span><br></pre></td></tr></table></figure>

<p>=&gt; FetchTransport.prototype.sendEvent &#x6700;&#x7EC8;&#x53D1;&#x9001;&#x4E86;&#x8BF7;&#x6C42;</p>
<h3 id="FetchTransport-prototype-sendEvent"><a href="#FetchTransport-prototype-sendEvent" class="headerlink" title="FetchTransport.prototype.sendEvent"></a>FetchTransport.prototype.sendEvent</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;FetchTransport.prototype.sendEvent = function (event) {</span><br><span class="line"> var defaultOptions = {</span><br><span class="line">  body: JSON.stringify(event),</span><br><span class="line">  method: &apos;POST&apos;,</span><br><span class="line">  // Despite all stars in the sky saying that Edge supports old draft syntax, aka &apos;never&apos;, &apos;always&apos;, &apos;origin&apos; and &apos;default</span><br><span class="line">  // https://caniuse.com/#feat=referrer-policy</span><br><span class="line">  // It doesn&apos;t. And it throw exception instead of ignoring this parameter...</span><br><span class="line">  // REF: https://github.com/getsentry/raven-js/issues/1233</span><br><span class="line">  referrerPolicy: (supportsReferrerPolicy() ? &apos;origin&apos; : &apos;&apos;),</span><br><span class="line"> };</span><br><span class="line"> // global$2.fetch(this.url, defaultOptions) &#x4F7F;&#x7528;fetch&#x53D1;&#x9001;&#x8BF7;&#x6C42;</span><br><span class="line"> return this._buffer.add(global$2.fetch(this.url, defaultOptions).then(function (response) { return ({</span><br><span class="line">  status: exports.Status.fromHttpCode(response.status),</span><br><span class="line"> }); }));</span><br><span class="line">};</span><br></pre></td></tr></table></figure>

<p>&#x770B;&#x5B8C; <code>Ajax &#x4E0A;&#x62A5;</code> &#x4E3B;&#x7EBF;&#xFF0C;&#x518D;&#x770B;&#x672C;&#x6587;&#x7684;&#x53E6;&#x5916;&#x4E00;&#x6761;&#x4E3B;&#x7EBF; <code>window.onerror</code> &#x6355;&#x83B7;&#x3002;</p>
<h2 id="window-onerror-&#x548C;-window-onunhandledrejection-&#x6355;&#x83B7;-&#x9519;&#x8BEF;"><a href="#window-onerror-&#x548C;-window-onunhandledrejection-&#x6355;&#x83B7;-&#x9519;&#x8BEF;" class="headerlink" title="window.onerror &#x548C; window.onunhandledrejection &#x6355;&#x83B7; &#x9519;&#x8BEF;"></a>window.onerror &#x548C; window.onunhandledrejection &#x6355;&#x83B7; &#x9519;&#x8BEF;</h2><p>&#x4F8B;&#x5B50;&#xFF1A;&#x8C03;&#x7528;&#x4E00;&#x4E2A;&#x672A;&#x7533;&#x660E;&#x7684;&#x53D8;&#x91CF;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;func();</span><br></pre></td></tr></table></figure>

<p><code>Promise</code> &#x4E0D;&#x6355;&#x83B7;&#x9519;&#x8BEF;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;new Promise(() =&gt; {</span><br><span class="line"> fun();</span><br><span class="line">})</span><br><span class="line">.then(res =&gt; {</span><br><span class="line"> console.log(&apos;then&apos;);</span><br><span class="line">})</span><br></pre></td></tr></table></figure>

<h3 id="captureEvent"><a href="#captureEvent" class="headerlink" title="captureEvent"></a>captureEvent</h3><blockquote>
<p>&#x8C03;&#x7528;&#x6808;&#x4E3B;&#x8981;&#x6D41;&#x7A0B;&#xFF1A;</p>
</blockquote>
<blockquote>
<p>window.onerror</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;GlobalHandlers.prototype._installGlobalOnErrorHandler = function () {</span><br><span class="line"> if (this._onErrorHandlerInstalled) {</span><br><span class="line">  return;</span><br><span class="line"> }</span><br><span class="line"> var self = this; // tslint:disable-line:no-this-assignment</span><br><span class="line"> // &#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x8FD9;&#x91CC;&#x7684; this._global.  &#x5C31;&#x662F;window</span><br><span class="line"> this._oldOnErrorHandler = this._global.onerror;</span><br><span class="line"> this._global.onerror = function (msg, url, line, column, error) {</span><br><span class="line">  var currentHub = getCurrentHub();</span><br><span class="line">  // &#x4EE3;&#x7801;&#x6709;&#x5220;&#x51CF;</span><br><span class="line">  currentHub.captureEvent(event, {</span><br><span class="line">   originalException: error,</span><br><span class="line">  });</span><br><span class="line">  if (self._oldOnErrorHandler) {</span><br><span class="line">   return self._oldOnErrorHandler.apply(this, arguments);</span><br><span class="line">  }</span><br><span class="line">  return false;</span><br><span class="line"> };</span><br><span class="line"> this._onErrorHandlerInstalled = true;</span><br><span class="line">};</span><br></pre></td></tr></table></figure>

<blockquote>
<p>window.onunhandledrejection</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;GlobalHandlers.prototype._installGlobalOnUnhandledRejectionHandler = function () {</span><br><span class="line"> if (this._onUnhandledRejectionHandlerInstalled) {</span><br><span class="line">  return;</span><br><span class="line"> }</span><br><span class="line"> var self = this; // tslint:disable-line:no-this-assignment</span><br><span class="line"> this._oldOnUnhandledRejectionHandler = this._global.onunhandledrejection;</span><br><span class="line"> this._global.onunhandledrejection = function (e) {</span><br><span class="line">  // &#x4EE3;&#x7801;&#x6709;&#x5220;&#x51CF;</span><br><span class="line">  var currentHub = getCurrentHub();</span><br><span class="line">  currentHub.captureEvent(event, {</span><br><span class="line">   originalException: error,</span><br><span class="line">  });</span><br><span class="line">  if (self._oldOnUnhandledRejectionHandler) {</span><br><span class="line">   return self._oldOnUnhandledRejectionHandler.apply(this, arguments);</span><br><span class="line">  }</span><br><span class="line">  return false;</span><br><span class="line"> };</span><br><span class="line"> this._onUnhandledRejectionHandlerInstalled = true;</span><br><span class="line">};</span><br></pre></td></tr></table></figure>

<p>&#x5171;&#x540C;&#x70B9;&#xFF1A;&#x90FD;&#x4F1A;&#x8C03;&#x7528;<code>currentHub.captureEvent</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;currentHub.captureEvent(event, {</span><br><span class="line"> originalException: error,</span><br><span class="line">});</span><br></pre></td></tr></table></figure>

<p>=&gt; Hub.prototype.captureEvent</p>
<p>&#x6700;&#x7EC8;&#x53C8;&#x662F;&#x8C03;&#x7528; <code>_invokeClient</code> &#xFF0C;&#x8C03;&#x7528;&#x6D41;&#x7A0B;&#x8DDF; <code>captureMessage</code> &#x7C7B;&#x4F3C;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x518D;&#x8D58;&#x8FF0;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;this._invokeClient(&apos;captureEvent&apos;)</span><br></pre></td></tr></table></figure>

<p>=&gt; Hub.prototype._invokeClient</p>
<p>=&gt; BaseClient.prototype.captureEvent</p>
<p>=&gt; BaseClient.prototype._processEvent</p>
<p>=&gt; BaseBackend.prototype.sendEvent</p>
<p>=&gt; FetchTransport.prototype.sendEvent</p>
<p>&#x6700;&#x7EC8;&#x540C;&#x6837;&#x662F;&#x8C03;&#x7528;&#x4E86;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x53D1;&#x9001;&#x4E86;&#x8BF7;&#x6C42;&#x3002;</p>
<p>&#x53EF;&#x8C13;&#x662F;&#x6B8A;&#x9014;&#x540C;&#x5F52;&#xFF0C;&#x884C;&#x6587;&#x81F3;&#x6B64;&#x5C31;&#x57FA;&#x672C;&#x5DF2;&#x7ECF;&#x7ED3;&#x675F;&#xFF0C;&#x6700;&#x540E;&#x603B;&#x7ED3;&#x4E00;&#x4E0B;&#x3002;</p>
<h2 id="&#x603B;&#x7ED3;"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3;</h2><p><code>Sentry-JavaScript</code>&#x6E90;&#x7801;&#x9AD8;&#x6548;&#x5229;&#x7528;&#x4E86;<code>JS</code>&#x7684;&#x539F;&#x578B;&#x94FE;&#x673A;&#x5236;&#x3002;&#x53EF;&#x8C13;&#x662F;&#x60CA;&#x8273;&#xFF0C;&#x503C;&#x5F97;&#x5B66;&#x4E60;&#x3002;</p>
<p>&#x672C;&#x6587;&#x901A;&#x8FC7;&#x68B3;&#x7406;&#x524D;&#x7AEF;&#x9519;&#x8BEF;&#x76D1;&#x63A7;&#x77E5;&#x8BC6;&#x3001;&#x4ECB;&#x7ECD;<code>sentry</code>&#x9519;&#x8BEF;&#x76D1;&#x63A7;&#x539F;&#x7406;&#x3001;<code>sentry</code>&#x521D;&#x59CB;&#x5316;&#x3001;<code>Ajax</code>&#x4E0A;&#x62A5;&#x3001;<code>window.onerror&#x3001;window.onunhandledrejection</code>&#x51E0;&#x4E2A;&#x65B9;&#x9762;&#x6765;&#x5B66;&#x4E60;<code>sentry</code>&#x7684;&#x6E90;&#x7801;&#x3002;&#x8FD8;&#x6709;&#x5F88;&#x591A;&#x7EC6;&#x8282;&#x548C;&#x6784;&#x9020;&#x51FD;&#x6570;&#x6CA1;&#x6709;&#x5206;&#x6790;&#x3002;</p>
<p>&#x603B;&#x5171;&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF08;&#x7C7B;&#xFF09;&#x6709;25&#x4E2A;&#xFF0C;&#x63D0;&#x5230;&#x7684;&#x4E3B;&#x8981;&#x6709;9&#x4E2A;&#xFF0C;&#x5206;&#x522B;&#x662F;&#xFF1A;<code>Hub&#x3001;BaseClient&#x3001;BaseBackend&#x3001;BaseTransport&#x3001;FetchTransport&#x3001;XHRTransport&#x3001;BrowserBackend&#x3001;BrowserClient&#x3001;GlobalHandlers</code>&#x3002;</p>
<p>&#x5176;&#x4ED6;&#x6CA1;&#x6709;&#x63D0;&#x5230;&#x7684;&#x5206;&#x522B;&#x662F; <code>SentryError&#x3001;Logger&#x3001;Memo&#x3001;SyncPromise&#x3001;PromiseBuffer&#x3001;Span&#x3001;Scope&#x3001;Dsn&#x3001;API&#x3001;NoopTransport&#x3001;FunctionToString&#x3001;InboundFilters&#x3001;TryCatch&#x3001;Breadcrumbs&#x3001;LinkedErrors&#x3001;UserAgent</code>&#x3002;</p>
<p>&#x8FD9;&#x4E9B;&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF08;&#x7C7B;&#xFF09;&#x4E2D;&#x8FD8;&#x6709;&#x5F88;&#x591A;&#x503C;&#x5F97;&#x5B66;&#x4E60;&#xFF0C;&#x6BD4;&#x5982;&#x540C;&#x6B65;&#x7684;<code>Promise</code>&#xFF08;SyncPromise&#xFF09;&#x3002;<br>&#x6709;&#x5174;&#x8DA3;&#x7684;&#x8BFB;&#x8005;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x8FD9;&#x4E00;&#x5757;&#x5B98;&#x65B9;&#x4ED3;&#x5E93;&#x4E2D;&#x91C7;&#x7528;<code>typescript</code>&#x5199;&#x7684;&#x6E90;&#x7801;<a href="/external_links/f9cdb18aa1d40f2528dc17e618fa4710.html" target="blank" rel="noopener">SyncPromise</a>&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x6253;&#x5305;&#x540E;&#x51FA;&#x6765;&#x672A;&#x538B;&#x7F29;&#x7684;&#x4EE3;&#x7801;&#x3002;</p>
<p>&#x8BFB;&#x6E90;&#x7801;&#x6BD4;&#x8F83;&#x8017;&#x8D39;&#x65F6;&#x95F4;&#xFF0C;&#x5199;&#x6587;&#x7AE0;&#x8BB0;&#x5F55;&#x4E0B;&#x6765;&#x66F4;&#x52A0;&#x8D39;&#x65F6;&#x95F4;&#xFF08;&#x6BD4;&#x5982;&#x5199;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x8DE8;&#x5EA6;&#x5341;&#x51E0;&#x5929;&#x2026;&#xFF09;&#xFF0C;&#x4F46;&#x6536;&#x83B7;&#x4E00;&#x822C;&#x90FD;&#x6BD4;&#x8F83;&#x5927;&#x3002;</p>
<p>&#x5982;&#x679C;&#x8BFB;&#x8005;&#x53D1;&#x73B0;&#x6709;&#x4E0D;&#x59A5;&#x6216;&#x53EF;&#x6539;&#x5584;&#x4E4B;&#x5904;&#xFF0C;&#x518D;&#x6216;&#x8005;&#x54EA;&#x91CC;&#x6CA1;&#x5199;&#x660E;&#x767D;&#x7684;&#x5730;&#x65B9;&#xFF0C;&#x6B22;&#x8FCE;&#x8BC4;&#x8BBA;&#x6307;&#x51FA;&#x3002;&#x53E6;&#x5916;&#x89C9;&#x5F97;&#x5199;&#x5F97;&#x4E0D;&#x9519;&#xFF0C;&#x5BF9;&#x60A8;&#x6709;&#x4E9B;&#x8BB8;&#x5E2E;&#x52A9;&#xFF0C;&#x53EF;&#x4EE5;&#x70B9;&#x8D5E;&#x3001;&#x8BC4;&#x8BBA;&#x3001;&#x8F6C;&#x53D1;&#x5206;&#x4EAB;&#xFF0C;&#x4E5F;&#x662F;&#x5BF9;&#x7B14;&#x8005;&#x7684;&#x4E00;&#x79CD;&#x652F;&#x6301;&#x3002;&#x4E07;&#x5206;&#x611F;&#x8C22;&#x3002;</p>
<h2 id="&#x63A8;&#x8350;&#x9605;&#x8BFB;"><a href="#&#x63A8;&#x8350;&#x9605;&#x8BFB;" class="headerlink" title="&#x63A8;&#x8350;&#x9605;&#x8BFB;"></a>&#x63A8;&#x8350;&#x9605;&#x8BFB;</h2><p><a href="/external_links/1980d30d1c2bdf8efe7f9256feae2de9.html" target="blank" rel="noopener">&#x77E5;&#x4E4E;&#x6EF4;&#x6EF4;&#x4E91;&#xFF1A;&#x8D85;&#x8BE6;&#x7EC6;&#xFF01;&#x642D;&#x5EFA;&#x4E00;&#x4E2A;&#x524D;&#x7AEF;&#x9519;&#x8BEF;&#x76D1;&#x63A7;&#x7CFB;&#x7EDF;</a>  </p>
<p><a href="https://dev.newban.cn/6844903664197320718">&#x6398;&#x91D1;BlackHole1&#xFF1A;JavaScript&#x96C6;&#x6210;Sentry</a>  </p>
<p>&#x4E01;&#x9999;&#x56ED; &#x5F00;&#x6E90;&#x7684;<code>Sentry</code> &#x5C0F;&#x7A0B;&#x5E8F; <code>SDK</code><a href="/external_links/e71a41a101259f245a0321d14881b63c.html" target="blank" rel="noopener">sentry-miniapp</a>  </p>
<p><a href="/external_links/4155f264cde66757ec8361489d7bb0ed.html" target="blank" rel="noopener"><code>sentry</code>&#x5B98;&#x7F51;</a>  </p>
<p><a href="/external_links/bbf05de69024f708439290c7c71299ed.html" target="blank" rel="noopener"><code>sentry-javascript</code>&#x4ED3;&#x5E93;</a>  </p>
<h2 id="&#x7B14;&#x8005;&#x5F80;&#x671F;&#x6587;&#x7AE0;"><a href="#&#x7B14;&#x8005;&#x5F80;&#x671F;&#x6587;&#x7AE0;" class="headerlink" title="&#x7B14;&#x8005;&#x5F80;&#x671F;&#x6587;&#x7AE0;"></a>&#x7B14;&#x8005;&#x5F80;&#x671F;&#x6587;&#x7AE0;</h2><p><a href="https://dev.newban.cn/6844903780035592205">&#x9762;&#x8BD5;&#x5B98;&#x95EE;&#xFF1A;JS&#x7684;&#x7EE7;&#x627F;</a>  </p>
<p><a href="https://dev.newban.cn/6844903746984476686">&#x9762;&#x8BD5;&#x5B98;&#x95EE;&#xFF1A;JS&#x7684;this&#x6307;&#x5411;</a>  </p>
<p><a href="https://dev.newban.cn/6844903728147857415">&#x9762;&#x8BD5;&#x5B98;&#x95EE;&#xFF1A;&#x80FD;&#x5426;&#x6A21;&#x62DF;&#x5B9E;&#x73B0;JS&#x7684;call&#x548C;apply&#x65B9;&#x6CD5;</a>  </p>
<p><a href="https://dev.newban.cn/6844903718089916429">&#x9762;&#x8BD5;&#x5B98;&#x95EE;&#xFF1A;&#x80FD;&#x5426;&#x6A21;&#x62DF;&#x5B9E;&#x73B0;JS&#x7684;bind&#x65B9;&#x6CD5;</a>  </p>
<p><a href="https://dev.newban.cn/6844903704663949325">&#x9762;&#x8BD5;&#x5B98;&#x95EE;&#xFF1A;&#x80FD;&#x5426;&#x6A21;&#x62DF;&#x5B9E;&#x73B0;JS&#x7684;new&#x64CD;&#x4F5C;&#x7B26;</a>  </p>
<p><a href="https://dev.newban.cn/6844903666860687373">&#x524D;&#x7AEF;&#x4F7F;&#x7528;puppeteer &#x722C;&#x866B;&#x751F;&#x6210;&#x300A;React.js &#x5C0F;&#x4E66;&#x300B;PDF&#x5E76;&#x5408;&#x5E76;</a></p>
<h2 id="&#x5173;&#x4E8E;"><a href="#&#x5173;&#x4E8E;" class="headerlink" title="&#x5173;&#x4E8E;"></a>&#x5173;&#x4E8E;</h2><p>&#x4F5C;&#x8005;&#xFF1A;&#x5E38;&#x4EE5;<strong>&#x82E5;&#x5DDD;</strong>&#x4E3A;&#x540D;&#x6DF7;&#x8FF9;&#x4E8E;&#x6C5F;&#x6E56;&#x3002;&#x524D;&#x7AEF;&#x8DEF;&#x4E0A; | PPT&#x7231;&#x597D;&#x8005; | &#x6240;&#x77E5;&#x751A;&#x5C11;&#xFF0C;&#x552F;&#x5584;&#x5B66;&#x3002;  </p>
<p><a href="/external_links/4986b16d5e3b10c7eb3e098161b1cb6c.html" target="blank" rel="noopener">&#x4E2A;&#x4EBA;&#x535A;&#x5BA2;-&#x82E5;&#x5DDD;</a>&#xFF0C;&#x4F7F;&#x7528;<code>vuepress</code>&#x91CD;&#x6784;&#x4E86;&#xFF0C;&#x9605;&#x8BFB;&#x4F53;&#x9A8C;&#x53EF;&#x80FD;&#x66F4;&#x597D;&#x4E9B;  </p>
<p><a href="/external_links/0eaae9aee67b3837a4608f6f57e3fe73.html" target="blank" rel="noopener">&#x6398;&#x91D1;&#x4E13;&#x680F;</a>&#xFF0C;&#x6B22;&#x8FCE;&#x5173;&#x6CE8;~  </p>
<p><a href="/external_links/aa57b6e4783432f5eb4cb3122c7c281d.html" target="blank" rel="noopener"><code>segmentfault</code>&#x524D;&#x7AEF;&#x89C6;&#x91CE;&#x4E13;&#x680F;</a>&#xFF0C;&#x6B22;&#x8FCE;&#x5173;&#x6CE8;~  </p>
<p><a href="/external_links/9d49889ba530cc743d4bc05726fd318e.html" target="blank" rel="noopener">&#x77E5;&#x4E4E;&#x524D;&#x7AEF;&#x89C6;&#x91CE;&#x4E13;&#x680F;</a>&#xFF0C;&#x6B22;&#x8FCE;&#x5173;&#x6CE8;~  </p>
<p><a href="/external_links/7a72f7afa742d06ac5ceb82d817c1bed.html" target="blank" rel="noopener">github blog</a>&#xFF0C;&#x76F8;&#x5173;&#x6E90;&#x7801;&#x548C;&#x8D44;&#x6E90;&#x90FD;&#x653E;&#x5728;&#x8FD9;&#x91CC;&#xFF0C;&#x6C42;&#x4E2A;<code>star</code>^_^~</p>
<h2 id="&#x6B22;&#x8FCE;&#x52A0;&#x5FAE;&#x4FE1;&#x4EA4;&#x6D41;-&#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x53F7;"><a href="#&#x6B22;&#x8FCE;&#x52A0;&#x5FAE;&#x4FE1;&#x4EA4;&#x6D41;-&#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x53F7;" class="headerlink" title="&#x6B22;&#x8FCE;&#x52A0;&#x5FAE;&#x4FE1;&#x4EA4;&#x6D41; &#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x53F7;"></a>&#x6B22;&#x8FCE;&#x52A0;&#x5FAE;&#x4FE1;&#x4EA4;&#x6D41; &#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x53F7;</h2><p>&#x53EF;&#x80FD;&#x6BD4;&#x8F83;&#x6709;&#x8DA3;&#x7684;&#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x53F7;&#xFF0C;&#x957F;&#x6309;&#x626B;&#x7801;&#x5173;&#x6CE8;&#x3002;&#x6B22;&#x8FCE;&#x52A0;&#x7B14;&#x8005;&#x5FAE;&#x4FE1;<code>ruochuan12</code>&#xFF08;&#x6CE8;&#x660E;&#x6765;&#x6E90;&#xFF0C;&#x57FA;&#x672C;&#x6765;&#x8005;&#x4E0D;&#x62D2;&#xFF09;&#xFF0C;&#x62C9;&#x60A8;&#x8FDB;&#x3010;&#x524D;&#x7AEF;&#x89C6;&#x91CE;&#x4EA4;&#x6D41;&#x7FA4;&#x3011;&#xFF0C;&#x957F;&#x671F;&#x4EA4;&#x6D41;&#x5B66;&#x4E60;~</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/aadeca165d32560f0a5f1eb50f8961e40e01bf2c41721a1f3af6e8acf87d67e9" alt="&#x82E5;&#x5DDD;&#x89C6;&#x91CE;"></p>
<p>&#x82E5;&#x5DDD;&#x89C6;&#x91CE;</p>
<p>&#x672C;&#x6587;&#x4F7F;&#x7528; <a href="/external_links/f4f051239b400ed0d04b60fef623174b.html" target="blank" rel="noopener">mdnice</a> &#x6392;&#x7248;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/a857b87ba35a85309e2bc5b275400853.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903983748743175.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903983748743175.html" itemprop="url">面试官："准备用HashMap存1w条数据，构造时传1000</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-10-30T14:09:11+08:00">
                2019-10-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/6c494744b0de747d359b5876eb59403cbb45cad0b766552001badf710a6c01f1" alt></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/0b3f9cc4762e650ee98d622fafd14655b8cdb50b20da78cc67a1d935378c48d2" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;//&#xA0;&#x9884;&#x8BA1;&#x5B58;&#x5165;&#xA0;1w&#xA0;&#x6761;&#x6570;&#x636E;&#xFF0C;&#x521D;&#x59CB;&#x5316;&#x8D4B;&#x503C;&#xA0;10000&#xFF0C;&#x907F;&#x514D;&#xA0;resize&#x3002;  </span><br><span class="line">HashMap&lt;String,String&gt;&#xA0;map&#xA0;=&#xA0;new&#xA0;HashMap&lt;&gt;(10000)  </span><br><span class="line">//&#xA0;for&#xA0;(int&#xA0;i&#xA0;=&#xA0;0;&#xA0;i&#xA0;&lt;&#xA0;10000;&#xA0;i++)</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/2d4544068f120aa23e553d521b69a1fe9b94ee0833c94ce9ab8a8d12479d55cd" alt></p>
<h3 id="Java-&#x96C6;&#x5408;&#x7684;&#x6269;&#x5BB9;"><a href="#Java-&#x96C6;&#x5408;&#x7684;&#x6269;&#x5BB9;" class="headerlink" title="Java &#x96C6;&#x5408;&#x7684;&#x6269;&#x5BB9;"></a>Java &#x96C6;&#x5408;&#x7684;&#x6269;&#x5BB9;</h3><p>HashMap &#x7B97;&#x662F;&#x6211;&#x4EEC;&#x6700;&#x5E38;&#x7528;&#x7684;&#x96C6;&#x5408;&#x4E4B;&#x4E00;&#xFF0C;&#x867D;&#x7136;&#x5BF9;&#x4E8E; Android &#x5F00;&#x53D1;&#x8005;&#xFF0C;Google &#x5B98;&#x65B9;&#x63A8;&#x8350;&#x4E86;&#x66F4;&#x7701;&#x5185;&#x5B58;&#x7684; SparseArray &#x548C; ArrayMap&#xFF0C;&#x4F46;&#x662F; HashMap &#x4F9D;&#x7136;&#x662F;&#x6700;&#x5E38;&#x7528;&#x7684;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x901A;&#x8FC7; HashMap &#x6765;&#x5B58;&#x50A8; Key-Value &#x8FD9;&#x79CD;&#x952E;&#x503C;&#x5BF9;&#x5F62;&#x5F0F;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x5176;&#x5185;&#x90E8;&#x901A;&#x8FC7;&#x54C8;&#x5E0C;&#x8868;&#xFF0C;&#x8BA9;&#x5B58;&#x53D6;&#x6548;&#x7387;&#x6700;&#x597D;&#x65F6;&#x53EF;&#x4EE5;&#x8FBE;&#x5230; O(1)&#xFF0C;&#x800C;&#x53C8;&#x56E0;&#x4E3A;&#x53EF;&#x80FD;&#x5B58;&#x5728;&#x7684; Hash &#x51B2;&#x7A81;&#xFF0C;&#x5F15;&#x5165;&#x4E86;&#x94FE;&#x8868;&#x548C;&#x7EA2;&#x9ED1;&#x6811;&#x7684;&#x7ED3;&#x6784;&#xFF0C;&#x8BA9;&#x6548;&#x7387;&#x6700;&#x5DEE;&#x4E5F;&#x5DEE;&#x4E0D;&#x8FC7; O(logn)&#x3002;</p>
<p>&#x6574;&#x4F53;&#x6765;&#x8BF4;&#xFF0C;HashMap &#x4F5C;&#x4E3A;&#x4E00;&#x6B3E;&#x5DE5;&#x4E1A;&#x7EA7;&#x7684;&#x54C8;&#x5E0C;&#x8868;&#x7ED3;&#x6784;&#xFF0C;&#x6548;&#x7387;&#x8FD8;&#x662F;&#x6709;&#x4FDD;&#x969C;&#x7684;&#x3002;</p>
<p>&#x7F16;&#x7A0B;&#x8BED;&#x8A00;&#x63D0;&#x4F9B;&#x7684;&#x96C6;&#x5408;&#x7C7B;&#xFF0C;&#x867D;&#x7136;&#x5E95;&#x5C42;&#x8FD8;&#x662F;&#x57FA;&#x4E8E;&#x6570;&#x7EC4;&#x3001;&#x94FE;&#x8868;&#x8FD9;&#x79CD;&#x6700;&#x57FA;&#x672C;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF0C;&#x4F46;&#x662F;&#x548C;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x6570;&#x7EC4;&#x4E0D;&#x540C;&#xFF0C;<strong>&#x96C6;&#x5408;&#x5728;&#x5BB9;&#x91CF;&#x4E0D;&#x8DB3;&#x65F6;&#xFF0C;&#x4F1A;&#x89E6;&#x53D1;&#x52A8;&#x6001;&#x6269;&#x5BB9;&#x6765;&#x4FDD;&#x8BC1;&#x6709;&#x8DB3;&#x591F;&#x7684;&#x7A7A;&#x95F4;&#x5B58;&#x50A8;&#x6570;&#x636E;</strong>&#x3002;</p>
<p>&#x52A8;&#x6001;&#x6269;&#x5BB9;&#xFF0C;&#x6D89;&#x53CA;&#x5230;&#x6570;&#x636E;&#x7684;&#x62F7;&#x8D1D;&#xFF0C;&#x662F;&#x4E00;&#x79CD;&#x300C;&#x8F83;&#x91CD;&#x300D;&#x7684;&#x64CD;&#x4F5C;&#x3002;&#x90A3;&#x5982;&#x679C;&#x80FD;&#x591F;&#x63D0;&#x524D;&#x786E;&#x5B9A;&#x96C6;&#x5408;&#x5C06;&#x8981;&#x5B58;&#x50A8;&#x7684;&#x6570;&#x636E;&#x91CF;&#x8303;&#x56F4;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#xFF0C;&#x6307;&#x5B9A;&#x96C6;&#x5408;&#x7684;&#x521D;&#x59CB;&#x5BB9;&#x91CF;&#xFF0C;&#x6765;&#x4FDD;&#x8BC1;&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x64CD;&#x4F5C;&#x4E2D;&#xFF0C;&#x4E0D;&#x81F3;&#x4E8E;&#x89E6;&#x53D1;&#x52A8;&#x6001;&#x6269;&#x5BB9;&#x3002;</p>
<p>&#x8FD9;&#x5C31;&#x5F15;&#x5165;&#x4E86;&#x672C;&#x6587;&#x5F00;&#x7BC7;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x5982;&#x679C;&#x4F7F;&#x7528; HashMap&#xFF0C;&#x5F53;&#x521D;&#x59CB;&#x5316;&#x662F;&#x6784;&#x9020;&#x51FD;&#x6570;&#x6307;&#x5B9A; 1w &#x65F6;&#xFF0C;&#x540E;&#x7EED;&#x6211;&#x4EEC;&#x7ACB;&#x5373;&#x5B58;&#x5165; 1w &#x6761;&#x6570;&#x636E;&#xFF0C;&#x662F;&#x5426;&#x7B26;&#x5408;&#x4E0E;&#x5176;&#x4E0D;&#x4F1A;&#x89E6;&#x53D1;&#x6269;&#x5BB9;&#x5462;&#xFF1F;</p>
<p>&#x5728;&#x5206;&#x6790;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x524D;&#xFF0C;&#x90A3;&#x6211;&#x4EEC;&#x5148;&#x6765;&#x770B;&#x770B;&#xFF0C;HashMap &#x521D;&#x59CB;&#x5316;&#x65F6;&#xFF0C;&#x6307;&#x5B9A;&#x521D;&#x59CB;&#x5BB9;&#x91CF;&#x503C;&#x90FD;&#x505A;&#x4E86;&#x4EC0;&#x4E48;&#xFF1F;</p>
<p>PS&#xFF1A;&#x672C;&#x6587;&#x6240;&#x6D89;&#x53CA;&#x4EE3;&#x7801;&#xFF0C;&#x5747;&#x4EE5; JDK 1.8 &#x4E2D; HashMap &#x7684;&#x6E90;&#x7801;&#x4E3E;&#x4F8B;&#x3002;</p>
<h3 id="HashMap-&#x7684;&#x521D;&#x59CB;&#x5316;"><a href="#HashMap-&#x7684;&#x521D;&#x59CB;&#x5316;" class="headerlink" title="HashMap &#x7684;&#x521D;&#x59CB;&#x5316;"></a>HashMap &#x7684;&#x521D;&#x59CB;&#x5316;</h3><p>&#x5728; HashMap &#x4E2D;&#xFF0C;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x6307;&#x5B9A;&#x521D;&#x59CB;&#x5BB9;&#x91CF;&#x7684;&#x6784;&#x9020;&#x65B9;&#x6CD5; <code>HashMap(int initialCapacity)</code>&#xFF0C;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x6700;&#x7EC8;&#x4F1A;&#x8C03;&#x7528;&#x5230; HashMap &#x53E6;&#x4E00;&#x4E2A;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#xFF0C;&#x5176;&#x4E2D;&#x7684;&#x53C2;&#x6570; loadFactor &#x5C31;&#x662F;&#x9ED8;&#x8BA4;&#x503C; 0.75f&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;public&#xA0;HashMap(int&#xA0;initialCapacity,&#xA0;float&#xA0;loadFactor)&#xA0;{  </span><br><span class="line">&#xA0;&#xA0;if&#xA0;(initialCapacity&#xA0;&lt;&#xA0;0)  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;throw&#xA0;new&#xA0;IllegalArgumentException(&quot;Illegal&#xA0;initial&#xA0;capacity:&#xA0;&quot;&#xA0;+&#xA0;initialCapacity);  </span><br><span class="line">&#xA0;&#xA0;if&#xA0;(initialCapacity&#xA0;&gt;&#xA0;MAXIMUM_CAPACITY)  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;initialCapacity&#xA0;=&#xA0;MAXIMUM_CAPACITY;  </span><br><span class="line">&#xA0;&#xA0;if&#xA0;(loadFactor&#xA0;&lt;=&#xA0;0&#xA0;||&#xA0;Float.isNaN(loadFactor))  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;throw&#xA0;new&#xA0;IllegalArgumentException(&quot;Illegal&#xA0;load&#xA0;factor:&#xA0;&quot;&#xA0;+&#xA0;loadFactor);  </span><br><span class="line">  </span><br><span class="line">&#xA0;&#xA0;this.loadFactor&#xA0;=&#xA0;loadFactor;  </span><br><span class="line">&#xA0;&#xA0;this.threshold&#xA0;=&#xA0;tableSizeFor(initialCapacity);  </span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5176;&#x4E2D;&#x7684;&#x6210;&#x5458;&#x53D8;&#x91CF; <code>threshold</code> &#x5C31;&#x662F;&#x7528;&#x6765;&#x5B58;&#x50A8;&#xFF0C;&#x89E6;&#x53D1; HashMap &#x6269;&#x5BB9;&#x7684;&#x9608;&#x503C;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5F53; HashMap &#x5B58;&#x50A8;&#x7684;&#x6570;&#x636E;&#x91CF;&#x8FBE;&#x5230; <code>threshold</code> &#x65F6;&#xFF0C;&#x5C31;&#x4F1A;&#x89E6;&#x53D1;&#x6269;&#x5BB9;&#x3002;</p>
<p>&#x4ECE;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x7684;&#x903B;&#x8F91;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;HashMap &#x5E76;&#x4E0D;&#x662F;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x5916;&#x90E8;&#x4F20;&#x9012;&#x8FDB;&#x6765;&#x7684; <code>initialCapacity</code>&#xFF0C;&#x800C;&#x662F;&#x7ECF;&#x8FC7;&#x4E86; <code>tableSizeFor()</code> &#x65B9;&#x6CD5;&#x7684;&#x5904;&#x7406;&#xFF0C;&#x518D;&#x8D4B;&#x503C;&#x5230; <code>threshole</code> &#x4E0A;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;static&#xA0;final&#xA0;int&#xA0;tableSizeFor(int&#xA0;cap)&#xA0;{  </span><br><span class="line">&#xA0;&#xA0;int&#xA0;n&#xA0;=&#xA0;cap&#xA0;-&#xA0;1;  </span><br><span class="line">&#xA0;&#xA0;n&#xA0;|=&#xA0;n&#xA0;&gt;&gt;&gt;&#xA0;1;  </span><br><span class="line">&#xA0;&#xA0;n&#xA0;|=&#xA0;n&#xA0;&gt;&gt;&gt;&#xA0;2;  </span><br><span class="line">&#xA0;&#xA0;n&#xA0;|=&#xA0;n&#xA0;&gt;&gt;&gt;&#xA0;4;  </span><br><span class="line">&#xA0;&#xA0;n&#xA0;|=&#xA0;n&#xA0;&gt;&gt;&gt;&#xA0;8;  </span><br><span class="line">&#xA0;&#xA0;n&#xA0;|=&#xA0;n&#xA0;&gt;&gt;&gt;&#xA0;16;  </span><br><span class="line">&#xA0;&#xA0;return&#xA0;(n&#xA0;&lt;&#xA0;0)&#xA0;?&#xA0;1&#xA0;:&#xA0;(n&#xA0;&gt;=&#xA0;MAXIMUM_CAPACITY)&#xA0;?&#xA0;MAXIMUM_CAPACITY&#xA0;:&#xA0;n&#xA0;+&#xA0;1;  </span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5728; <code>tableSizeFor()</code> &#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x901A;&#x8FC7;&#x9010;&#x6B65;&#x4F4D;&#x8FD0;&#x7B97;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x8BA9;&#x8FD4;&#x56DE;&#x503C;&#xFF0C;&#x4FDD;&#x6301;&#x5728; 2 &#x7684; N &#x6B21;&#x5E42;&#x3002;&#x4EE5;&#x65B9;&#x4FBF;&#x5728;&#x6269;&#x5BB9;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5FEB;&#x901F;&#x8BA1;&#x7B97;&#x6570;&#x636E;&#x5728;&#x6269;&#x5BB9;&#x540E;&#x7684;&#x65B0;&#x8868;&#x4E2D;&#x7684;&#x4F4D;&#x7F6E;&#x3002;</p>
<p>&#x90A3;&#x4E48;&#x5F53;&#x6211;&#x4EEC;&#x4ECE;&#x5916;&#x90E8;&#x4F20;&#x9012;&#x8FDB;&#x6765; 1w &#x65F6;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x7ECF;&#x8FC7; <code>tableSizeFor()</code> &#x65B9;&#x6CD5;&#x5904;&#x7406;&#x4E4B;&#x540E;&#xFF0C;&#x5C31;&#x4F1A;&#x53D8;&#x6210; 2 &#x7684; 14 &#x6B21;&#x5E42; 16384&#xFF0C;&#x518D;&#x7B97;&#x4E0A;&#x8D1F;&#x8F7D;&#x56E0;&#x5B50; 0.75f&#xFF0C;&#x5B9E;&#x9645;&#x5728;&#x4E0D;&#x89E6;&#x53D1;&#x6269;&#x5BB9;&#x7684;&#x524D;&#x63D0;&#x4E0B;&#xFF0C;&#x53EF;&#x5B58;&#x50A8;&#x7684;&#x6570;&#x636E;&#x5BB9;&#x91CF;&#x662F; 12288&#xFF08;16384 * 0.75f&#xFF09;&#x3002;</p>
<p>&#x8FD9;&#x79CD;&#x573A;&#x666F;&#x4E0B;&#xFF0C;&#x7528;&#x6765;&#x5B58;&#x653E; 1w &#x6761;&#x6570;&#x636E;&#xFF0C;&#x7EF0;&#x7EF0;&#x6709;&#x4F59;&#x4E86;&#xFF0C;&#x5E76;&#x4E0D;&#x4F1A;&#x89E6;&#x53D1;&#x6211;&#x4EEC;&#x731C;&#x60F3;&#x7684;&#x6269;&#x5BB9;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/1220312befbd38d7451da9a64f9709538d5fd377cd3a6eaca9715ec30ed71b8f" alt></p>
<h3 id="HashMap-&#x7684;-table-&#x521D;&#x59CB;&#x5316;"><a href="#HashMap-&#x7684;-table-&#x521D;&#x59CB;&#x5316;" class="headerlink" title="HashMap &#x7684; table &#x521D;&#x59CB;&#x5316;"></a>HashMap &#x7684; table &#x521D;&#x59CB;&#x5316;</h3><p>&#x5F53;&#x6211;&#x4EEC;&#x628A;&#x521D;&#x59CB;&#x5BB9;&#x91CF;&#xFF0C;&#x8C03;&#x6574;&#x5230; 1000 &#x65F6;&#xFF0C;&#x60C5;&#x51B5;&#x53C8;&#x4E0D;&#x4E00;&#x6837;&#x4E86;&#xFF0C;&#x5177;&#x4F53;&#x60C5;&#x51B5;&#x5177;&#x4F53;&#x5206;&#x6790;&#x3002;</p>
<p>&#x518D;&#x56DE;&#x5230; HashMap &#x7684;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#xFF0C;<code>threshold</code> &#x4E3A;&#x6269;&#x5BB9;&#x7684;&#x9608;&#x503C;&#xFF0C;&#x5728;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x4E2D;&#x7531; <code>tableSizeFor()</code> &#x65B9;&#x6CD5;&#x8C03;&#x6574;&#x540E;&#x76F4;&#x63A5;&#x8D4B;&#x503C;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x6784;&#x9020; HashMap &#x65F6;&#xFF0C;&#x5982;&#x679C;&#x4F20;&#x9012; 1000&#xFF0C;<code>threshold</code> &#x8C03;&#x6574;&#x540E;&#x7684;&#x503C;&#x786E;&#x5B9E;&#x662F; 1024&#xFF0C;&#x4F46; HashMap &#x5E76;&#x4E0D;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x5B83;&#x3002;</p>
<p>&#x4ED4;&#x7EC6;&#x60F3;&#x60F3;&#x5C31;&#x4F1A;&#x77E5;&#x9053;&#xFF0C;&#x521D;&#x59CB;&#x5316;&#x65F6;&#x51B3;&#x5B9A;&#x4E86; <code>threshold</code> &#x503C;&#xFF0C;&#x4F46;&#x5176;&#x88C5;&#x8F7D;&#x56E0;&#x5B50;&#xFF08;loadFactor&#xFF09;&#x5E76;&#x6CA1;&#x6709;&#x53C2;&#x4E0E;&#x8FD0;&#x7B97;&#xFF0C;&#x90A3;&#x5728;&#x540E;&#x9762;&#x5177;&#x4F53;&#x903B;&#x8F91;&#x7684;&#x65F6;&#x5019;&#xFF0C;HashMap &#x662F;&#x5982;&#x4F55;&#x5904;&#x7406;&#x7684;&#x5462;&#xFF1F; </p>
<p>&#x5728; HashMap &#x4E2D;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x90FD;&#x662F;&#x901A;&#x8FC7;&#x6210;&#x5458;&#x53D8;&#x91CF; table &#x6570;&#x7EC4;&#x6765;&#x5B58;&#x50A8;&#x7684;&#xFF0C;&#x5728; JDK 1.7 &#x548C; 1.8 &#x4E2D;&#x867D;&#x7136; table &#x7684;&#x7C7B;&#x578B;&#x6709;&#x6240;&#x4E0D;&#x540C;&#xFF0C;&#x4F46;&#x662F;&#x6570;&#x7EC4;&#x8FD9;&#x79CD;&#x57FA;&#x672C;&#x7ED3;&#x6784;&#x5E76;&#x6CA1;&#x6709;&#x53D8;&#x5316;&#x3002;&#x90A3;&#x4E48; table&#x3001;threshold&#x3001;loadFactor &#x4E09;&#x8005;&#x4E4B;&#x95F4;&#x7684;&#x5173;&#x7CFB;&#xFF0C;&#x5C31;&#x662F;&#xFF1A;</p>
<p><strong>table.size == threshold * loadFactor</strong></p>
<p>&#x90A3;&#x8FD9;&#x4E2A; table &#x662F;&#x5728;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x521D;&#x59CB;&#x5316;&#x7684;&#x5462;&#xFF1F;&#x8FD9;&#x5C31;&#x8981;&#x8BF4;&#x4F1A;&#x5230;&#x6211;&#x4EEC;&#x4E00;&#x76F4;&#x5728;&#x56DE;&#x907F;&#x7684;&#x95EE;&#x9898;&#xFF0C;HashMap &#x7684;&#x6269;&#x5BB9;&#x3002;</p>
<p>&#x5728; HashMap &#x4E2D;&#xFF0C;&#x52A8;&#x6001;&#x6269;&#x5BB9;&#x7684;&#x903B;&#x8F91;&#x5728; <code>resize()</code> &#x65B9;&#x6CD5;&#x4E2D;&#x3002;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4E0D;&#x4EC5;&#x4EC5;&#x627F;&#x62C5;&#x4E86; table &#x7684;&#x6269;&#x5BB9;&#xFF0C;&#x5B83;&#x8FD8;&#x627F;&#x62C5;&#x4E86; table &#x7684;&#x521D;&#x59CB;&#x5316;&#x3002;</p>
<p>&#x5F53;&#x6211;&#x4EEC;&#x9996;&#x6B21;&#x8C03;&#x7528; HashMap &#x7684; <code>put()</code> &#x65B9;&#x6CD5;&#x5B58;&#x6570;&#x636E;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x53D1;&#x73B0; table &#x4E3A; null&#xFF0C;&#x5219;&#x4F1A;&#x8C03;&#x7528; <code>resize()</code> &#x53BB;&#x521D;&#x59CB;&#x5316; table&#xFF0C;&#x5177;&#x4F53;&#x903B;&#x8F91;&#x5728; <code>putVal()</code> &#x65B9;&#x6CD5;&#x4E2D;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;final&#xA0;V&#xA0;putVal(int&#xA0;hash,&#xA0;K&#xA0;key,&#xA0;V&#xA0;value,&#xA0;boolean&#xA0;onlyIfAbsent,boolean&#xA0;evict)&#xA0;{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;Node&lt;K,V&gt;[]&#xA0;tab;&#xA0;Node&lt;K,V&gt;&#xA0;p;&#xA0;int&#xA0;n,&#xA0;i;  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;if&#xA0;((tab&#xA0;=&#xA0;table)&#xA0;==&#xA0;null&#xA0;||&#xA0;(n&#xA0;=&#xA0;tab.length)&#xA0;==&#xA0;0)  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;n&#xA0;=&#xA0;(tab&#xA0;=&#xA0;resize()).length;&#xA0;//&#xA0;&#x8C03;&#x7528;&#xA0;resize()  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;//&#xA0;...  </span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5728; <code>resize()</code> &#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x8C03;&#x6574;&#x4E86;&#x6700;&#x7EC8; <code>threshold</code> &#x503C;&#xFF0C;&#x4EE5;&#x53CA;&#x5B8C;&#x6210;&#x4E86; table &#x7684;&#x521D;&#x59CB;&#x5316;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;final&#xA0;Node&lt;K,V&gt;[]&#xA0;resize()&#xA0;{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;Node&lt;K,V&gt;[]&#xA0;oldTab&#xA0;=&#xA0;table;  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;int&#xA0;oldCap&#xA0;=&#xA0;(oldTab&#xA0;==&#xA0;null)&#xA0;?&#xA0;0&#xA0;:&#xA0;oldTab.length;  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;int&#xA0;oldThr&#xA0;=&#xA0;threshold;  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;int&#xA0;newCap,&#xA0;newThr&#xA0;=&#xA0;0;  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;if&#xA0;(oldCap&#xA0;&gt;&#xA0;0)&#xA0;{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if&#xA0;(oldCap&#xA0;&gt;=&#xA0;MAXIMUM_CAPACITY)&#xA0;{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;threshold&#xA0;=&#xA0;Integer.MAX_VALUE;  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;return&#xA0;oldTab;  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;else&#xA0;if&#xA0;((newCap&#xA0;=&#xA0;oldCap&#xA0;&lt;&lt;&#xA0;1)&#xA0;&lt;&#xA0;MAXIMUM_CAPACITY&#xA0;&amp;&amp;  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;oldCap&#xA0;&gt;=&#xA0;DEFAULT_INITIAL_CAPACITY)  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;newThr&#xA0;=&#xA0;oldThr&#xA0;&lt;&lt;&#xA0;1;&#xA0;  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;}  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;else&#xA0;if&#xA0;(oldThr&#xA0;&gt;&#xA0;0)&#xA0;  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;newCap&#xA0;=&#xA0;oldThr;&#xA0;//&#xA0;&#x2460;  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;else&#xA0;{&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;newCap&#xA0;=&#xA0;DEFAULT_INITIAL_CAPACITY;  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;newThr&#xA0;=&#xA0;(int)(DEFAULT_LOAD_FACTOR&#xA0;*&#xA0;DEFAULT_INITIAL_CAPACITY);  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;}  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;if&#xA0;(newThr&#xA0;==&#xA0;0)&#xA0;{  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;//&#xA0;&#x2461;  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;float&#xA0;ft&#xA0;=&#xA0;(float)newCap&#xA0;*&#xA0;loadFactor;  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;newThr&#xA0;=&#xA0;(newCap&#xA0;&lt;&#xA0;MAXIMUM_CAPACITY&#xA0;&amp;&amp;&#xA0;ft&#xA0;&lt;&#xA0;(float)MAXIMUM_CAPACITY&#xA0;?  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;(int)ft&#xA0;:&#xA0;Integer.MAX_VALUE);  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;}  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;threshold&#xA0;=&#xA0;newThr;&#xA0;//&#xA0;&#x2462;  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;Node&lt;K,V&gt;[]&#xA0;newTab&#xA0;=&#xA0;(Node&lt;K,V&gt;[])new&#xA0;Node[newCap];  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;table&#xA0;=&#xA0;newTab;&#xA0;//&#xA0;&#x2463;  </span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;//&#xA0;....  </span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x6CE8;&#x610F;&#x770B;&#x4EE3;&#x7801;&#x4E2D;&#x7684;&#x6CE8;&#x91CA;&#x6807;&#x8BB0;&#x3002;</p>
<p>&#x56E0;&#x4E3A; <code>resize()</code> &#x8FD8;&#x7CC5;&#x5408;&#x4E86;&#x52A8;&#x6001;&#x6269;&#x5BB9;&#x7684;&#x903B;&#x8F91;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x5C06;&#x521D;&#x59CB;&#x5316; table &#x7684;&#x903B;&#x8F91;&#x7528;&#x6CE8;&#x91CA;&#x6807;&#x8BB0;&#x51FA;&#x6765;&#x4E86;&#x3002;&#x5176;&#x4E2D; xxxCap &#x548C; xxxThr &#x5206;&#x522B;&#x5BF9;&#x5E94;&#x4E86; table &#x7684;&#x5BB9;&#x91CF;&#x548C;&#x52A8;&#x6001;&#x6269;&#x5BB9;&#x7684;&#x9608;&#x503C;&#xFF0C;&#x6240;&#x4EE5;&#x5B58;&#x5728;&#x65E7;&#x548C;&#x65B0;&#x4E24;&#x7EC4;&#x6570;&#x636E;&#x3002;</p>
<p>&#x5F53;&#x6211;&#x4EEC;&#x6307;&#x5B9A;&#x4E86;&#x521D;&#x59CB;&#x5BB9;&#x91CF;&#xFF0C;&#x4E14; table &#x672A;&#x88AB;&#x521D;&#x59CB;&#x5316;&#x65F6;&#xFF0C;oldThr &#x5C31;&#x4E0D;&#x4E3A; 0&#xFF0C;&#x5219;&#x4F1A;&#x8D70;&#x5230;&#x4EE3;&#x7801; <strong>&#x2460;</strong> &#x7684;&#x903B;&#x8F91;&#x3002;&#x5728;&#x5176;&#x4E2D;&#x5C06; <code>newCap</code> &#x8D4B;&#x503C;&#x4E3A; <code>oldThr</code>&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x65B0;&#x521B;&#x5EFA;&#x7684; <code>table</code> &#x4F1A;&#x662F;&#x6211;&#x4EEC;&#x6784;&#x9020;&#x7684; HashMap &#x65F6;&#x6307;&#x5B9A;&#x7684;&#x5BB9;&#x91CF;&#x503C;&#x3002;</p>
<p>&#x4E4B;&#x540E;&#x4F1A;&#x8FDB;&#x5165;&#x4EE3;&#x7801; <strong>&#x2461;</strong> &#x7684;&#x903B;&#x8F91;&#xFF0C;&#x5176;&#x4E2D;&#x5C31;&#x901A;&#x8FC7;&#x88C5;&#x8F7D;&#x56E0;&#x5B50;&#xFF08;loadFactor&#xFF09;&#x8C03;&#x6574;&#x4E86;&#x65B0;&#x7684;&#x9608;&#x503C;&#xFF08;newThr&#xFF09;&#xFF0C;&#x5F53;&#x7136;&#x8FD9;&#x91CC;&#x4E5F;&#x505A;&#x4E86;&#x4E00;&#x4E9B;&#x9650;&#x5236;&#x9700;&#x8981;&#x8BA9; <code>newThr</code> &#x5728;&#x4E00;&#x4E2A;&#x5408;&#x6CD5;&#x7684;&#x8303;&#x56F4;&#x5185;&#x3002;</p>
<p>&#x5728;&#x4EE3;&#x7801; <strong>&#x2462;</strong> &#x4E2D;&#xFF0C;&#x5C06;&#x4F7F;&#x7528; <code>loadFactor</code> &#x8C03;&#x6574;&#x540E;&#x7684;&#x9608;&#x503C;&#xFF0C;&#x91CD;&#x65B0;&#x4FDD;&#x5B58;&#x5230; <code>threshold</code> &#x4E2D;&#x3002;&#x5E76;&#x901A;&#x8FC7; <code>newCap</code> &#x521B;&#x5EFA;&#x65B0;&#x7684;&#x6570;&#x7EC4;&#xFF0C;&#x5C06;&#x5176;&#x6307;&#x5B9A;&#x5230; table &#x4E0A;&#xFF0C;&#x5B8C;&#x6210; table &#x7684;&#x521D;&#x59CB;&#x5316;&#xFF08;&#x4EE3;&#x7801; <strong>&#x2463;</strong>&#xFF09;&#x3002;</p>
<p>&#x5230;&#x8FD9;&#x91CC;&#x4E5F;&#x5C31;&#x6E05;&#x695A;&#x4E86;&#xFF0C;&#x867D;&#x7136;&#x6211;&#x4EEC;&#x5728;&#x521D;&#x59CB;&#x5316;&#x65F6;&#xFF0C;&#x4F20;&#x9012;&#x8FDB;&#x6765;&#x7684; <code>initialCapacity</code> &#x867D;&#x7136;&#x7ECF;&#x8FC7; <code>tableSizeFor()</code> &#x65B9;&#x6CD5;&#x8C03;&#x6574;&#x540E;&#xFF0C;&#x76F4;&#x63A5;&#x8D4B;&#x503C;&#x7ED9; <code>threshold</code>&#xFF0C;&#x4F46;&#x662F;&#x5B83;&#x5B9E;&#x9645;&#x662F; table &#x7684;&#x5C3A;&#x5BF8;&#xFF0C;&#x5E76;&#x4E14;&#x6700;&#x7EC8;&#x4F1A;&#x901A;&#x8FC7; <code>loadFactor</code> &#x91CD;&#x65B0;&#x8C03;&#x6574; <code>threshold</code>&#x3002;</p>
<p>&#x90A3;&#x4E48;&#x56DE;&#x5230;&#x4E4B;&#x524D;&#x7684;&#x95EE;&#x9898;&#x5C31;&#x6709;&#x7B54;&#x6848;&#x4E86;&#xFF0C;&#x867D;&#x7136; HashMap &#x521D;&#x59CB;&#x5BB9;&#x91CF;&#x6307;&#x5B9A;&#x4E3A; 1000&#xFF0C;&#x4F1A;&#x88AB; <code>tableSizeFor()</code> &#x8C03;&#x6574;&#x4E3A; 1024&#xFF0C;&#x4F46;&#x662F;&#x5B83;&#x53EA;&#x662F;&#x8868;&#x793A; table &#x6570;&#x7EC4;&#x4E3A; 1024&#xFF0C;&#x6269;&#x5BB9;&#x7684;&#x91CD;&#x8981;&#x4F9D;&#x636E;&#x6269;&#x5BB9;&#x9608;&#x503C;&#x4F1A;&#x5728; <code>resize()</code> &#x4E2D;&#x8C03;&#x6574;&#x4E3A; 768&#xFF08;1024 * 0.75&#xFF09;&#x3002;</p>
<p>&#x5B83;&#x662F;&#x4E0D;&#x8DB3;&#x4EE5;&#x627F;&#x8F7D; 1000 &#x6761;&#x6570;&#x636E;&#x7684;&#xFF0C;&#x6700;&#x7EC8;&#x5728;&#x5B58;&#x591F; 1k &#x6761;&#x6570;&#x636E;&#x4E4B;&#x524D;&#xFF0C;&#x8FD8;&#x4F1A;&#x89E6;&#x53D1;&#x4E00;&#x6B21;&#x52A8;&#x6001;&#x6269;&#x5BB9;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/f9597596f397b878ecfb38f95f5b2793ec97778fec75d7c4e70a65c1e5b7293e" alt></p>
<p>&#x901A;&#x5E38;&#x5728;&#x521D;&#x59CB;&#x5316; HashMap &#x65F6;&#xFF0C;&#x521D;&#x59CB;&#x5BB9;&#x91CF;&#x90FD;&#x662F;&#x6839;&#x636E;&#x4E1A;&#x52A1;&#x6765;&#x7684;&#xFF0C;&#x800C;&#x4E0D;&#x4F1A;&#x662F;&#x4E00;&#x4E2A;&#x56FA;&#x5B9A;&#x503C;&#xFF0C;&#x4E3A;&#x6B64;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x6709;&#x4E00;&#x4E2A;&#x7279;&#x6B8A;&#x5904;&#x7406;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x5C31;&#x662F;&#x5C06;&#x9884;&#x671F;&#x7684;&#x521D;&#x59CB;&#x5BB9;&#x91CF;&#xFF0C;&#x518D;&#x9664;&#x4EE5; HashMap &#x7684;&#x88C5;&#x8F7D;&#x56E0;&#x5B50;&#xFF0C;&#x9ED8;&#x8BA4;&#x65F6;&#x5C31;&#x662F;&#x9664;&#x4EE5; 0.75&#x3002;</p>
<p>&#x4F8B;&#x5982;&#x60F3;&#x8981;&#x7528; HashMap &#x5B58;&#x653E; 1k &#x6761;&#x6570;&#x636E;&#xFF0C;&#x5E94;&#x8BE5;&#x8BBE;&#x7F6E; 1000 / 0.75&#xFF0C;&#x5B9E;&#x9645;&#x4F20;&#x9012;&#x8FDB;&#x53BB;&#x7684;&#x503C;&#x662F; 1333&#xFF0C;&#x7136;&#x540E;&#x4F1A;&#x88AB; <code>tableSizeFor()</code> &#x65B9;&#x6CD5;&#x8C03;&#x6574;&#x5230; 2048&#xFF0C;&#x8DB3;&#x591F;&#x5B58;&#x50A8;&#x6570;&#x636E;&#x800C;&#x4E0D;&#x4F1A;&#x89E6;&#x53D1;&#x6269;&#x5BB9;&#x3002;</p>
<p>&#x5F53;&#x60F3;&#x7528; HashMap &#x5B58;&#x653E; 1w &#x6761;&#x6570;&#x636E;&#x65F6;&#xFF0C;&#x4F9D;&#x7136;&#x8BBE;&#x7F6E; 10000 / 0.75&#xFF0C;&#x5B9E;&#x9645;&#x4F20;&#x9012;&#x8FDB;&#x53BB;&#x7684;&#x503C;&#x662F; 13333&#xFF0C;&#x4F1A;&#x88AB;&#x8C03;&#x6574;&#x5230; 16384&#xFF0C;&#x548C;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x4F20;&#x9012; 10000 &#x6548;&#x679C;&#x662F;&#x4E00;&#x6837;&#x7684;&#x3002;</p>
<h3 id="&#x5C0F;&#x7ED3;&#x65F6;&#x523B;"><a href="#&#x5C0F;&#x7ED3;&#x65F6;&#x523B;" class="headerlink" title="&#x5C0F;&#x7ED3;&#x65F6;&#x523B;"></a>&#x5C0F;&#x7ED3;&#x65F6;&#x523B;</h3><p>&#x5230;&#x8FD9;&#x91CC;&#xFF0C;&#x5C31;&#x4E86;&#x89E3;&#x6E05;&#x695A;&#x4E86; HashMap &#x7684;&#x521D;&#x59CB;&#x5BB9;&#x91CF;&#xFF0C;&#x5E94;&#x8BE5;&#x5982;&#x4F55;&#x79D1;&#x5B66;&#x7684;&#x8BA1;&#x7B97;&#xFF0C;&#x672C;&#x8D28;&#x4E0A;&#x4F60;&#x4F20;&#x9012;&#x8FDB;&#x53BB;&#x7684;&#x503C;&#x53EF;&#x80FD;&#x5E76;&#x65E0;&#x6CD5;&#x76F4;&#x63A5;&#x5B58;&#x50A8;&#x8FD9;&#x4E48;&#x591A;&#x6570;&#x636E;&#xFF0C;&#x4F1A;&#x6709;&#x4E00;&#x4E2A;&#x52A8;&#x6001;&#x8C03;&#x6574;&#x7684;&#x8FC7;&#x7A0B;&#x3002;&#x5176;&#x4E2D;&#x5C31;&#x9700;&#x8981;&#x5C06;&#x6211;&#x4EEC;&#x9884;&#x671F;&#x7684;&#x503C;&#x8FDB;&#x884C;&#x653E;&#x5927;&#xFF0C;&#x6BD4;&#x8F83;&#x79D1;&#x5B66;&#x7684;&#x5C31;&#x662F;&#x4F9D;&#x636E;&#x88C5;&#x8F7D;&#x56E0;&#x5B50;&#x8FDB;&#x884C;&#x653E;&#x5927;&#x3002;</p>
<p>&#x6700;&#x540E;&#x6211;&#x4EEC;&#x518D;&#x603B;&#x7ED3;&#x4E00;&#x4E0B;&#xFF1A;</p>
<ol>
<li>HashMap &#x6784;&#x9020;&#x65B9;&#x6CD5;&#x4F20;&#x9012;&#x7684; initialCapacity&#xFF0C;&#x867D;&#x7136;&#x5728;&#x5904;&#x7406;&#x540E;&#x88AB;&#x5B58;&#x5165;&#x4E86; loadFactor &#x4E2D;&#xFF0C;&#x4F46;&#x5B83;&#x5B9E;&#x9645;&#x8868;&#x793A; table &#x7684;&#x5BB9;&#x91CF;&#x3002;</li>
<li>&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x4F20;&#x9012;&#x7684; initialCapacity&#xFF0C;&#x6700;&#x7EC8;&#x4F1A;&#x88AB; <code>tableSizeFor()</code> &#x65B9;&#x6CD5;&#x52A8;&#x6001;&#x8C03;&#x6574;&#x4E3A; 2 &#x7684; N &#x6B21;&#x5E42;&#xFF0C;&#x4EE5;&#x65B9;&#x4FBF;&#x5728;&#x6269;&#x5BB9;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8BA1;&#x7B97;&#x6570;&#x636E;&#x5728; newTable &#x4E2D;&#x7684;&#x4F4D;&#x7F6E;&#x3002;</li>
<li>&#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E86; table &#x7684;&#x521D;&#x59CB;&#x5BB9;&#x91CF;&#xFF0C;&#x4F1A;&#x5728;&#x521D;&#x59CB;&#x5316; table &#x65F6;&#xFF0C;&#x5C06;&#x6269;&#x5BB9;&#x9608;&#x503C; threshold &#x91CD;&#x65B0;&#x8C03;&#x6574;&#x4E3A; table.size * loadFactor&#x3002;</li>
<li><strong>HashMap &#x662F;&#x5426;&#x6269;&#x5BB9;&#xFF0C;&#x7531; threshold &#x51B3;&#x5B9A;&#xFF0C;&#x800C; threshold &#x53C8;&#x7531;&#x521D;&#x59CB;&#x5BB9;&#x91CF;&#x548C; loadFactor &#x51B3;&#x5B9A;&#x3002;</strong></li>
<li>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x9884;&#x5148;&#x77E5;&#x9053; HashMap &#x6570;&#x636E;&#x91CF;&#x8303;&#x56F4;&#xFF0C;&#x53EF;&#x4EE5;&#x9884;&#x8BBE; HashMap &#x7684;&#x5BB9;&#x91CF;&#x503C;&#x6765;&#x63D0;&#x5347;&#x6548;&#x7387;&#xFF0C;&#x4F46;&#x662F;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x8981;&#x8003;&#x8651;&#x88C5;&#x8F7D;&#x56E0;&#x5B50;&#x7684;&#x5F71;&#x54CD;&#xFF0C;&#x624D;&#x80FD;&#x4FDD;&#x8BC1;&#x4E0D;&#x4F1A;&#x89E6;&#x53D1;&#x9884;&#x671F;&#x4E4B;&#x5916;&#x7684;&#x52A8;&#x6001;&#x6269;&#x5BB9;&#x3002;</li>
</ol>
<p>HashMap &#x4F5C;&#x4E3A; Java &#x6700;&#x5E38;&#x7528;&#x7684;&#x96C6;&#x5408;&#x4E4B;&#x4E00;&#xFF0C;&#x5E02;&#x9762;&#x4E0A;&#x4F18;&#x79C0;&#x7684;&#x6587;&#x7AE0;&#x5F88;&#x591A;&#xFF0C;&#x4F46;&#x662F;&#x5F88;&#x5C11;&#x6709;&#x4EBA;&#x4ECE;&#x521D;&#x59CB;&#x5BB9;&#x91CF;&#x7684;&#x89D2;&#x5EA6;&#x6765;&#x5206;&#x6790;&#x5176;&#x4E2D;&#x7684;&#x903B;&#x8F91;&#xFF0C;&#x800C;&#x521D;&#x59CB;&#x5BB9;&#x91CF;&#x53C8;&#x662F;&#x96C6;&#x5408;&#x4E2D;&#x6BD4;&#x8F83;&#x5B9E;&#x9645;&#x7684;&#x4F18;&#x5316;&#x70B9;&#x3002;&#x5176;&#x5B9E;&#x4E0D;&#x5C11;&#x4EBA;&#x4E5F;&#x641E;&#x4E0D;&#x6E05;&#x695A;&#xFF0C;&#x5728;&#x8BBE;&#x7F6E; HashMap &#x521D;&#x59CB;&#x5BB9;&#x91CF;&#x65F6;&#xFF0C;&#x662F;&#x5426;&#x5E94;&#x8BE5;&#x8003;&#x8651;&#x88C5;&#x8F7D;&#x56E0;&#x5B50;&#xFF0C;&#x624D;&#x6709;&#x4E86;&#x6B64;&#x6587;&#x3002;</p>
<p>&#x5982;&#x679C;&#x672C;&#x6587;&#x5BF9;&#x4F60;&#x6709;&#x6240;&#x5E2E;&#x52A9;&#xFF0C;<strong>&#x7559;&#x8A00;&#x3001;&#x8F6C;&#x53D1;&#x3001;&#x6536;&#x85CF;</strong>&#x662F;&#x6700;&#x5927;&#x7684;&#x652F;&#x6301;&#xFF0C;&#x8C22;&#x8C22;&#xFF01;</p>
<hr>
<blockquote>
<p>&#x516C;&#x4F17;&#x53F7;&#x540E;&#x53F0;&#x56DE;&#x590D;&#x6210;&#x957F;&#x300E;<strong>&#x6210;&#x957F;</strong>&#x300F;&#xFF0C;&#x5C06;&#x4F1A;&#x5F97;&#x5230;&#x6211;&#x51C6;&#x5907;&#x7684;&#x5B66;&#x4E60;&#x8D44;&#x6599;&#x3002;</p>
</blockquote>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/53607448a90d7a13d120c5ebeb3a3eb657f8af1cacb3260df07cdd38ea7d89bd" alt></p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/f54fb13789bb16830582d72b9478e44c.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903955554648078.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903955554648078.html" itemprop="url">【译】 axios 是如何封装 HTTP 请求的</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-29T15:54:19+08:00">
                2019-09-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>&#x539F;&#x8F7D;&#x4E8E; TutorialDocs &#x7F51;&#x7AD9;&#x7684;&#x6587;&#x7AE0;<a href="/external_links/4c73e1a286400e6cd78cadf1a83fe126.html" target="blank" rel="noopener">&#x300A;How to Implement an HTTP Request Library with Axios&#x300B;</a>&#x3002;</p>
</blockquote>
<h2 id="&#x6982;&#x8FF0;"><a href="#&#x6982;&#x8FF0;" class="headerlink" title="&#x6982;&#x8FF0;"></a>&#x6982;&#x8FF0;</h2><p>&#x524D;&#x7AEF;&#x5F00;&#x53D1;&#x4E2D;&#xFF0C;&#x7ECF;&#x5E38;&#x4F1A;&#x9047;&#x5230;&#x53D1;&#x9001;&#x5F02;&#x6B65;&#x8BF7;&#x6C42;&#x7684;&#x573A;&#x666F;&#x3002;&#x4E00;&#x4E2A;&#x529F;&#x80FD;&#x9F50;&#x5168;&#x7684; HTTP &#x8BF7;&#x6C42;&#x5E93;&#x53EF;&#x4EE5;&#x5927;&#x5927;&#x964D;&#x4F4E;&#x6211;&#x4EEC;&#x7684;&#x5F00;&#x53D1;&#x6210;&#x672C;&#xFF0C;&#x63D0;&#x9AD8;&#x5F00;&#x53D1;&#x6548;&#x7387;&#x3002;</p>
<p>axios &#x5C31;&#x662F;&#x8FD9;&#x6837;&#x4E00;&#x4E2A; HTTP &#x8BF7;&#x6C42;&#x5E93;&#xFF0C;&#x8FD1;&#x5E74;&#x6765;&#x975E;&#x5E38;&#x70ED;&#x95E8;&#x3002;&#x76EE;&#x524D;&#xFF0C;&#x5B83;&#x5728; GitHub &#x4E0A;&#x62E5;&#x6709;&#x8D85;&#x8FC7; 40,000 &#x7684; Star&#xFF0C;&#x8BB8;&#x591A;&#x6743;&#x5A01;&#x4EBA;&#x58EB;&#x90FD;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x5B83;&#x3002;</p>
<p>&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x6709;&#x5FC5;&#x8981;&#x4E86;&#x89E3;&#x4E0B; axios &#x662F;&#x5982;&#x4F55;&#x8BBE;&#x8BA1;&#xFF0C;&#x4EE5;&#x53CA;&#x5982;&#x4F55;&#x5B9E;&#x73B0; HTTP &#x8BF7;&#x6C42;&#x5E93;&#x5C01;&#x88C5;&#x7684;&#x3002;&#x64B0;&#x5199;&#x672C;&#x6587;&#x65F6;&#xFF0C;axios &#x5F53;&#x524D;&#x7248;&#x672C;&#x4E3A; 0.18.0&#xFF0C;&#x6211;&#x4EEC;&#x4EE5;&#x8BE5;&#x7248;&#x672C;&#x4E3A;&#x4F8B;&#xFF0C;&#x6765;&#x9605;&#x8BFB;&#x548C;&#x5206;&#x6790;&#x90E8;&#x5206;&#x6838;&#x5FC3;&#x6E90;&#x4EE3;&#x7801;&#x3002;axios &#x7684;&#x6240;&#x6709;&#x6E90;&#x6587;&#x4EF6;&#x90FD;&#x4F4D;&#x4E8E; <code>lib</code> &#x6587;&#x4EF6;&#x5939;&#x4E2D;&#xFF0C;&#x4E0B;&#x6587;&#x4E2D;&#x63D0;&#x5230;&#x7684;&#x8DEF;&#x5F84;&#x90FD;&#x662F;&#x76F8;&#x5BF9;&#x4E8E; <code>lib</code> &#x6765;&#x8BF4;&#x7684;&#x3002;</p>
<p>&#x672C;&#x6587;&#x6211;&#x4EEC;&#x4E3B;&#x8981;&#x8BA8;&#x8BBA;&#xFF1A;</p>
<ul>
<li>&#x600E;&#x6837;&#x4F7F;&#x7528; axios&#x3002;</li>
<li>axios &#x7684;&#x6838;&#x5FC3;&#x6A21;&#x5757;&#xFF08;&#x8BF7;&#x6C42;&#x3001;&#x62E6;&#x622A;&#x5668;&#x3001;&#x64A4;&#x9500;&#xFF09;&#x662F;&#x5982;&#x4F55;&#x8BBE;&#x8BA1;&#x548C;&#x5B9E;&#x73B0;&#x7684;&#xFF1F;</li>
<li>axios &#x7684;&#x8BBE;&#x8BA1;&#x4F18;&#x70B9;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;</li>
</ul>
<h2 id="&#x5982;&#x4F55;&#x4F7F;&#x7528;-axios"><a href="#&#x5982;&#x4F55;&#x4F7F;&#x7528;-axios" class="headerlink" title="&#x5982;&#x4F55;&#x4F7F;&#x7528; axios"></a>&#x5982;&#x4F55;&#x4F7F;&#x7528; axios</h2><p>&#x8981;&#x7406;&#x89E3; axios &#x7684;&#x8BBE;&#x8BA1;&#xFF0C;&#x9996;&#x5148;&#x9700;&#x8981;&#x770B;&#x4E00;&#x4E0B;&#x5982;&#x4F55;&#x4F7F;&#x7528; axios&#x3002;&#x6211;&#x4EEC;&#x4E3E;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;&#x6765;&#x8BF4;&#x660E;&#x4E0B; axios API &#x7684;&#x4F7F;&#x7528;&#x3002;</p>
<h3 id="&#x53D1;&#x9001;&#x8BF7;&#x6C42;"><a href="#&#x53D1;&#x9001;&#x8BF7;&#x6C42;" class="headerlink" title="&#x53D1;&#x9001;&#x8BF7;&#x6C42;"></a>&#x53D1;&#x9001;&#x8BF7;&#x6C42;</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;axios({</span><br><span class="line">  method:&apos;get&apos;,</span><br><span class="line">  url:&apos;http://bit.ly/2mTM3nY&apos;,</span><br><span class="line">  responseType:&apos;stream&apos;</span><br><span class="line">})</span><br><span class="line">  .then(function(response) {</span><br><span class="line">  response.data.pipe(fs.createWriteStream(&apos;ada_lovelace.jpg&apos;))</span><br><span class="line">});</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5B98;&#x65B9;&#x793A;&#x4F8B;&#x3002;&#x4ECE;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;axios &#x7684;&#x7528;&#x6CD5;&#x4E0E; jQuery &#x7684; <code>ajax</code> &#x65B9;&#x6CD5;&#x975E;&#x5E38;&#x7C7B;&#x4F3C;&#xFF0C;&#x4E24;&#x8005;&#x90FD;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A; Promise &#x5BF9;&#x8C61;&#xFF08;&#x5728;&#x8FD9;&#x91CC;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x6210;&#x529F;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF0C;&#x4F46;&#x8FD8;&#x662F;&#x66F4;&#x63A8;&#x8350;&#x4F7F;&#x7528; <code>Promise</code> &#x6216; <code>await</code>&#xFF09;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x8FDB;&#x884C;&#x540E;&#x7EED;&#x64CD;&#x4F5C;&#x3002;</p>
<p>&#x8FD9;&#x4E2A;&#x5B9E;&#x4F8B;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x6211;&#x89E3;&#x91CA;&#x4E86;&#x3002;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;&#x770B;&#x5982;&#x4F55;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x62E6;&#x622A;&#x5668;&#x51FD;&#x6570;&#x3002;</p>
<h3 id="&#x6DFB;&#x52A0;&#x62E6;&#x622A;&#x5668;&#x51FD;&#x6570;"><a href="#&#x6DFB;&#x52A0;&#x62E6;&#x622A;&#x5668;&#x51FD;&#x6570;" class="headerlink" title="&#x6DFB;&#x52A0;&#x62E6;&#x622A;&#x5668;&#x51FD;&#x6570;"></a>&#x6DFB;&#x52A0;&#x62E6;&#x622A;&#x5668;&#x51FD;&#x6570;</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// &#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x62E6;&#x622A;&#x5668;&#x3002;&#x6CE8;&#x610F;&#xFF0C;&#x8FD9;&#x91CC;&#x9762;&#x6709; 2 &#x4E2A;&#x51FD;&#x6570;&#x2014;&#x2014;&#x5206;&#x522B;&#x662F;&#x6210;&#x529F;&#x548C;&#x5931;&#x8D25;&#x65F6;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF0C;&#x8FD9;&#x6837;&#x8BBE;&#x8BA1;&#x7684;&#x539F;&#x56E0;&#x4F1A;&#x5728;&#x4E4B;&#x540E;&#x4ECB;&#x7ECD;</span><br><span class="line">axios.interceptors.request.use(function (config) {</span><br><span class="line">    // &#x53D1;&#x8D77;&#x8BF7;&#x6C42;&#x524D;&#x6267;&#x884C;&#x4E00;&#x4E9B;&#x5904;&#x7406;&#x4EFB;&#x52A1;</span><br><span class="line">    return config; // &#x8FD4;&#x56DE;&#x914D;&#x7F6E;&#x4FE1;&#x606F;</span><br><span class="line">  }, function (error) {</span><br><span class="line">    // &#x8BF7;&#x6C42;&#x9519;&#x8BEF;&#x65F6;&#x7684;&#x5904;&#x7406;</span><br><span class="line">    return Promise.reject(error);</span><br><span class="line">  });</span><br><span class="line"></span><br><span class="line">// &#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x54CD;&#x5E94;&#x62E6;&#x622A;&#x5668;</span><br><span class="line">axios.interceptors.response.use(function (response) {</span><br><span class="line">    // &#x5904;&#x7406;&#x54CD;&#x5E94;&#x6570;&#x636E;</span><br><span class="line">    return response; // &#x8FD4;&#x56DE;&#x54CD;&#x5E94;&#x6570;&#x636E;</span><br><span class="line">  }, function (error) {</span><br><span class="line">    // &#x54CD;&#x5E94;&#x51FA;&#x9519;&#x540E;&#x6240;&#x505A;&#x7684;&#x5904;&#x7406;&#x5DE5;&#x4F5C;</span><br><span class="line">    return Promise.reject(error);</span><br><span class="line">  });</span><br></pre></td></tr></table></figure>

<p>&#x4ECE;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x77E5;&#x9053;&#xFF1A;&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5BF9;&#x8BF7;&#x6C42;&#x7684;&#x914D;&#x7F6E;&#x53C2;&#x6570;&#xFF08;<code>config</code>&#xFF09;&#x505A;&#x5904;&#x7406;&#xFF1B;&#x5728;&#x8BF7;&#x6C42;&#x5F97;&#x5230;&#x54CD;&#x5E94;&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5BF9;&#x8FD4;&#x56DE;&#x6570;&#x636E;&#x505A;&#x5904;&#x7406;&#x3002;&#x5F53;&#x8BF7;&#x6C42;&#x6216;&#x54CD;&#x5E94;&#x5931;&#x8D25;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x80FD;&#x6307;&#x5B9A;&#x5BF9;&#x5E94;&#x7684;&#x9519;&#x8BEF;&#x5904;&#x7406;&#x51FD;&#x6570;&#x3002;</p>
<h3 id="&#x64A4;&#x9500;-HTTP-&#x8BF7;&#x6C42;"><a href="#&#x64A4;&#x9500;-HTTP-&#x8BF7;&#x6C42;" class="headerlink" title="&#x64A4;&#x9500; HTTP &#x8BF7;&#x6C42;"></a>&#x64A4;&#x9500; HTTP &#x8BF7;&#x6C42;</h3><p>&#x5728;&#x5F00;&#x53D1;&#x4E0E;&#x641C;&#x7D22;&#x76F8;&#x5173;&#x7684;&#x6A21;&#x5757;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x7ECF;&#x5E38;&#x8981;&#x9891;&#x7E41;&#x5730;&#x53D1;&#x9001;&#x6570;&#x636E;&#x67E5;&#x8BE2;&#x8BF7;&#x6C42;&#x3002;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x53D1;&#x9001;&#x4E0B;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x64A4;&#x9500;&#x4E0A;&#x4E2A;&#x8BF7;&#x6C42;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x80FD;&#x64A4;&#x9500;&#x76F8;&#x5173;&#x8BF7;&#x6C42;&#x529F;&#x80FD;&#x975E;&#x5E38;&#x6709;&#x7528;&#x3002;axios &#x64A4;&#x9500;&#x8BF7;&#x6C42;&#x7684;&#x793A;&#x4F8B;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;const CancelToken = axios.CancelToken;</span><br><span class="line">const source = CancelToken.source();</span><br><span class="line"></span><br><span class="line">// &#x4F8B;&#x5B50;&#x4E00;</span><br><span class="line">axios.get(&apos;/user/12345&apos;, {</span><br><span class="line">  cancelToken: source.token</span><br><span class="line">}).catch(function(thrown) {</span><br><span class="line">  if (axios.isCancel(thrown)) {</span><br><span class="line">    console.log(&apos;&#x8BF7;&#x6C42;&#x64A4;&#x9500;&#x4E86;&apos;, thrown.message);</span><br><span class="line">  } else {</span><br><span class="line">    // &#x5904;&#x7406;&#x9519;&#x8BEF;</span><br><span class="line">  }</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">// &#x4F8B;&#x5B50;&#x4E8C;</span><br><span class="line">axios.post(&apos;/user/12345&apos;, {</span><br><span class="line">  name: &apos;&#x65B0;&#x540D;&#x5B57;&apos;</span><br><span class="line">}, {</span><br><span class="line">  cancelToken: source.token</span><br><span class="line">}).</span><br><span class="line"></span><br><span class="line">// &#x64A4;&#x9500;&#x8BF7;&#x6C42; (&#x4FE1;&#x606F;&#x53C2;&#x6570;&#x662F;&#x53EF;&#x9009;&#x7684;)</span><br><span class="line">source.cancel(&apos;&#x7528;&#x6237;&#x64A4;&#x9500;&#x4E86;&#x8BF7;&#x6C42;&apos;);</span><br></pre></td></tr></table></figure>

<p>&#x4ECE;&#x4E0A;&#x4F8B;&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x5728; axios &#x4E2D;&#xFF0C;&#x4F7F;&#x7528;&#x57FA;&#x4E8E; <code>CancelToken</code> &#x7684;&#x64A4;&#x9500;&#x8BF7;&#x6C42;&#x65B9;&#x6848;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x8BE5;&#x63D0;&#x6848;&#x73B0;&#x5DF2;&#x64A4;&#x56DE;&#xFF0C;&#x8BE6;&#x60C5;&#x5982; <a href="/external_links/0b5cc18eb2c8053f2f5005d7f6f55dfe.html" target="blank" rel="noopener">&#x70B9;&#x8FD9;&#x91CC;</a>&#x3002;&#x5177;&#x4F53;&#x7684;&#x64A4;&#x9500;&#x8BF7;&#x6C42;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x6CD5;&#xFF0C;&#x5C06;&#x5728;&#x540E;&#x9762;&#x7684;&#x6E90;&#x4EE3;&#x7801;&#x5206;&#x6790;&#x7684;&#x4E2D;&#x89E3;&#x91CA;&#x3002;</p>
<h2 id="axios-&#x6838;&#x5FC3;&#x6A21;&#x5757;&#x7684;&#x8BBE;&#x8BA1;&#x548C;&#x5B9E;&#x73B0;"><a href="#axios-&#x6838;&#x5FC3;&#x6A21;&#x5757;&#x7684;&#x8BBE;&#x8BA1;&#x548C;&#x5B9E;&#x73B0;" class="headerlink" title="axios &#x6838;&#x5FC3;&#x6A21;&#x5757;&#x7684;&#x8BBE;&#x8BA1;&#x548C;&#x5B9E;&#x73B0;"></a>axios &#x6838;&#x5FC3;&#x6A21;&#x5757;&#x7684;&#x8BBE;&#x8BA1;&#x548C;&#x5B9E;&#x73B0;</h2><p>&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x6211;&#x76F8;&#x4FE1;&#x6BCF;&#x4E2A;&#x4EBA;&#x90FD;&#x5BF9; axios &#x7684;&#x4F7F;&#x7528;&#x6709;&#x4E00;&#x4E2A;&#x5927;&#x81F4;&#x7684;&#x4E86;&#x89E3;&#x4E86;&#x3002;&#x4E0B;&#x9762;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x6839;&#x636E;&#x6A21;&#x5757;&#x5206;&#x6790; axios &#x7684;&#x8BBE;&#x8BA1;&#x548C;&#x5B9E;&#x73B0;&#x3002;&#x4E0B;&#x9762;&#x7684;&#x56FE;&#x7247;&#xFF0C;&#x662F;&#x6211;&#x5728;&#x672C;&#x6587;&#x4E2D;&#x4F1A;&#x4ECB;&#x7ECD;&#x5230;&#x7684;&#x6E90;&#x4EE3;&#x7801;&#x6587;&#x4EF6;&#x3002;&#x5982;&#x679C;&#x60A8;&#x611F;&#x5174;&#x8DA3;&#xFF0C;&#x6700;&#x597D;&#x5728;&#x9605;&#x8BFB;&#x65F6;&#x514B;&#x9686;&#x76F8;&#x5173;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x8FD9;&#x80FD;&#x52A0;&#x6DF1;&#x4F60;&#x5BF9;&#x76F8;&#x5173;&#x6A21;&#x5757;&#x7684;&#x7406;&#x89E3;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/0672db2b755c9a53fb4eb218b410ae1cbd9ce5b72aaa71dfbcfe7ceedd2fcb55" alt></p>
<h3 id="HTTP-&#x8BF7;&#x6C42;&#x6A21;&#x5757;"><a href="#HTTP-&#x8BF7;&#x6C42;&#x6A21;&#x5757;" class="headerlink" title="HTTP &#x8BF7;&#x6C42;&#x6A21;&#x5757;"></a>HTTP &#x8BF7;&#x6C42;&#x6A21;&#x5757;</h3><p>&#x8BF7;&#x6C42;&#x6A21;&#x5757;&#x7684;&#x4EE3;&#x7801;&#x653E;&#x5728;&#x4E86; <code>core/dispatchRequest.js</code> &#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x53EA;&#x5C55;&#x793A;&#x4E86;&#x4E00;&#x4E9B;&#x5173;&#x952E;&#x4EE3;&#x7801;&#x6765;&#x7B80;&#x5355;&#x8BF4;&#x660E;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;module.exports = function dispatchRequest(config) {</span><br><span class="line">    throwIfCancellationRequested(config);</span><br><span class="line"></span><br><span class="line">    // &#x5176;&#x4ED6;&#x6E90;&#x7801;</span><br><span class="line"></span><br><span class="line">    // &#x9ED8;&#x8BA4;&#x9002;&#x914D;&#x5668;&#x662F;&#x4E00;&#x4E2A;&#x6A21;&#x5757;&#xFF0C;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x5F53;&#x524D;&#x73AF;&#x5883;&#x9009;&#x62E9;&#x4F7F;&#x7528; Node &#x6216;&#x8005; XHR &#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x3002;</span><br><span class="line">    var adapter = config.adapter || defaults.adapter; </span><br><span class="line"></span><br><span class="line">    return adapter(config).then(function onAdapterResolution(response) {</span><br><span class="line">        throwIfCancellationRequested(config);</span><br><span class="line"></span><br><span class="line">        // &#x5176;&#x4ED6;&#x6E90;&#x7801;</span><br><span class="line"></span><br><span class="line">        return response;</span><br><span class="line">    }, function onAdapterRejection(reason) {</span><br><span class="line">        if (!isCancel(reason)) {</span><br><span class="line">            throwIfCancellationRequested(config);</span><br><span class="line"></span><br><span class="line">            // &#x5176;&#x4ED6;&#x6E90;&#x7801;</span><br><span class="line"></span><br><span class="line">            return Promise.reject(reason);</span><br><span class="line">        });</span><br><span class="line">};</span><br></pre></td></tr></table></figure>

<p>&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x80FD;&#x591F;&#x77E5;&#x9053; <code>dispatchRequest</code> &#x65B9;&#x6CD5;&#x662F;&#x901A;&#x8FC7; <code>config.adapter</code> &#xFF0C;&#x83B7;&#x5F97;&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x6A21;&#x5757;&#x7684;&#x3002;&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4F20;&#x9012;&#xFF0C;&#x7B26;&#x5408;&#x89C4;&#x8303;&#x7684;&#x9002;&#x914D;&#x5668;&#x51FD;&#x6570;&#x6765;&#x66FF;&#x4EE3;&#x539F;&#x6765;&#x7684;&#x6A21;&#x5757;&#xFF08;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x4F1A;&#x8FD9;&#x6837;&#x505A;&#xFF0C;&#x4F46;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x677E;&#x6563;&#x8026;&#x5408;&#x7684;&#x6269;&#x5C55;&#x70B9;&#xFF09;&#x3002;</p>
<p>&#x5728; <code>defaults.js</code> &#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x76F8;&#x5173;&#x9002;&#x914D;&#x5668;&#x7684;&#x9009;&#x62E9;&#x903B;&#x8F91;&#x2014;&#x2014;&#x6839;&#x636E;&#x5F53;&#x524D;&#x5BB9;&#x5668;&#x7684;&#x4E00;&#x4E9B;&#x72EC;&#x7279;&#x5C5E;&#x6027;&#x548C;&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;&#x6765;&#x786E;&#x5B9A;&#x4F7F;&#x7528;&#x54EA;&#x4E2A;&#x9002;&#x914D;&#x5668;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function getDefaultAdapter() {</span><br><span class="line">    var adapter;</span><br><span class="line">    // &#x53EA;&#x6709;&#x5728; Node.js &#x4E2D;&#x5305;&#x542B; process &#x7C7B;&#x578B;&#x5BF9;&#x8C61;&#x65F6;&#xFF0C;&#x624D;&#x4F7F;&#x7528;&#x5B83;&#x7684;&#x8BF7;&#x6C42;&#x6A21;&#x5757;</span><br><span class="line">    if (typeof process !== &apos;undefined&apos; &amp;&amp; Object.prototype.toString.call(process) === &apos;[object process]&apos;) {</span><br><span class="line">        // Node.js &#x8BF7;&#x6C42;&#x6A21;&#x5757;</span><br><span class="line">        adapter = require(&apos;./adapters/http&apos;);</span><br><span class="line">    } else if (typeof XMLHttpRequest !== &apos;undefined&apos;) {</span><br><span class="line">        // &#x6D4F;&#x89C8;&#x5668;&#x8BF7;&#x6C42;&#x6A21;&#x5757;</span><br><span class="line">        adapter = require(&apos;./adapters/xhr&apos;);</span><br><span class="line">    }</span><br><span class="line">    return adapter;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>axios &#x4E2D;&#x7684; XHR &#x6A21;&#x5757;&#x76F8;&#x5BF9;&#x7B80;&#x5355;&#xFF0C;&#x5B83;&#x662F;&#x5BF9; <code>XMLHTTPRequest</code> &#x5BF9;&#x8C61;&#x7684;&#x5C01;&#x88C5;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x5C31;&#x4E0D;&#x518D;&#x89E3;&#x91CA;&#x4E86;&#x3002;&#x6709;&#x5174;&#x8DA3;&#x7684;&#x540C;&#x5B66;&#xFF0C;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x9605;&#x8BFB;&#x6E90;&#x6E90;&#x7801;&#x770B;&#x770B;&#xFF0C;&#x6E90;&#x7801;&#x4F4D;&#x4E8E; <code>adapters/xhr.js</code> &#x6587;&#x4EF6;&#x4E2D;&#x3002;</p>
<h3 id="&#x62E6;&#x622A;&#x5668;&#x6A21;&#x5757;"><a href="#&#x62E6;&#x622A;&#x5668;&#x6A21;&#x5757;" class="headerlink" title="&#x62E6;&#x622A;&#x5668;&#x6A21;&#x5757;"></a>&#x62E6;&#x622A;&#x5668;&#x6A21;&#x5757;</h3><p>&#x73B0;&#x5728;&#x8BA9;&#x6211;&#x4EEC;&#x770B;&#x770B; axios &#x662F;&#x5982;&#x4F55;&#x5904;&#x7406;&#xFF0C;&#x8BF7;&#x6C42;&#x548C;&#x54CD;&#x5E94;&#x62E6;&#x622A;&#x5668;&#x51FD;&#x6570;&#x7684;&#x3002;&#x8FD9;&#x5C31;&#x6D89;&#x53CA;&#x5230;&#x4E86; axios &#x4E2D;&#x7684;&#x7EDF;&#x4E00;&#x63A5;&#x53E3; &#x2014;&#x2014;<code>request</code> &#x51FD;&#x6570;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;Axios.prototype.request = function request(config) {</span><br><span class="line"></span><br><span class="line">    // &#x5176;&#x4ED6;&#x6E90;&#x7801;</span><br><span class="line"></span><br><span class="line">    var chain = [dispatchRequest, undefined];</span><br><span class="line">    var promise = Promise.resolve(config);</span><br><span class="line"></span><br><span class="line">    this.interceptors.request.forEach(function unshiftRequestInterceptors(interceptor) {</span><br><span class="line">        chain.unshift(interceptor.fulfilled, interceptor.rejected);</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    this.interceptors.response.forEach(function pushResponseInterceptors(interceptor) {</span><br><span class="line">        chain.push(interceptor.fulfilled, interceptor.rejected);</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    while (chain.length) {</span><br><span class="line">        promise = promise.then(chain.shift(), chain.shift());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    return promise;</span><br><span class="line">};</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x662F; axios &#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x7684;&#x63A5;&#x53E3;&#x3002;&#x56E0;&#x4E3A;&#x51FD;&#x6570;&#x5B9E;&#x73B0;&#x4EE3;&#x7801;&#x76F8;&#x5F53;&#x957F;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x4F1A;&#x7B80;&#x5355;&#x5730;&#x8BA8;&#x8BBA;&#x76F8;&#x5173;&#x8BBE;&#x8BA1;&#x601D;&#x60F3;&#xFF1A;</p>
<ol>
<li><code>chain</code> &#x662F;&#x4E00;&#x4E2A;&#x6267;&#x884C;&#x961F;&#x5217;&#x3002;&#x961F;&#x5217;&#x7684;&#x521D;&#x59CB;&#x503C;&#x662F;&#x4E00;&#x4E2A;&#x643A;&#x5E26;&#x914D;&#x7F6E;&#xFF08;<code>config</code>&#xFF09;&#x53C2;&#x6570;&#x7684; Promise &#x5BF9;&#x8C61;&#x3002;</li>
<li>&#x5728;&#x6267;&#x884C;&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x521D;&#x59CB;&#x51FD;&#x6570; <code>dispatchRequest</code> &#x7528;&#x6765;&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#xFF0C;&#x4E3A;&#x4E86;&#x4E0E; <code>dispatchRequest</code>&#x5BF9;&#x5E94;&#xFF0C;&#x6211;&#x4EEC;&#x6DFB;&#x52A0;&#x4E86;&#x4E00;&#x4E2A; <code>undefined</code>&#x3002;&#x6DFB;&#x52A0; <code>undefined</code> &#x7684;&#x539F;&#x56E0;&#x662F;&#x9700;&#x8981;&#x7ED9; Promise &#x63D0;&#x4F9B;&#x6210;&#x529F;&#x548C;&#x5931;&#x8D25;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF0C;&#x4ECE;&#x4E0B;&#x9762;&#x4EE3;&#x7801;&#x91CC;&#x7684; <code>promise = promise.then(chain.shift(), chain.shift());</code> &#x6211;&#x4EEC;&#x5C31;&#x80FD;&#x770B;&#x51FA;&#x6765;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x51FD;&#x6570; <code>dispatchRequest</code> &#x548C; <code>undefiend</code> &#x53EF;&#x4EE5;&#x770B;&#x6210;&#x662F;&#x4E00;&#x5BF9;&#x51FD;&#x6570;&#x3002;</li>
<li>&#x5728;&#x6267;&#x884C;&#x961F;&#x5217; <code>chain</code> &#x4E2D;&#xFF0C;&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x7684; <code>dispatchReqeust</code> &#x51FD;&#x6570;&#x5904;&#x4E8E;&#x4E2D;&#x95F4;&#x4F4D;&#x7F6E;&#x3002;&#x5B83;&#x524D;&#x9762;&#x662F;&#x8BF7;&#x6C42;&#x62E6;&#x622A;&#x5668;&#xFF0C;&#x4F7F;&#x7528; <code>unshift</code> &#x65B9;&#x6CD5;&#x63D2;&#x5165;&#xFF1B;&#x5B83;&#x540E;&#x9762;&#x662F;&#x54CD;&#x5E94;&#x62E6;&#x622A;&#x5668;&#xFF0C;&#x4F7F;&#x7528; <code>push</code> &#x65B9;&#x6CD5;&#x63D2;&#x5165;&#xFF0C;&#x5728; <code>dispatchRequest</code> &#x4E4B;&#x540E;&#x3002;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x8FD9;&#x4E9B;&#x51FD;&#x6570;&#x90FD;&#x662F;&#x6210;&#x5BF9;&#x7684;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x4E00;&#x6B21;&#x4F1A;&#x63D2;&#x5165;&#x4E24;&#x4E2A;&#x3002;</li>
</ol>
<p>&#x6D4F;&#x89C8;&#x4E0A;&#x9762;&#x7684; <code>request</code> &#x51FD;&#x6570;&#x4EE3;&#x7801;&#xFF0C;&#x6211;&#x4EEC;&#x5927;&#x81F4;&#x77E5;&#x9053;&#x4E86;&#x600E;&#x6837;&#x4F7F;&#x7528;&#x62E6;&#x622A;&#x5668;&#x3002;&#x4E0B;&#x4E00;&#x6B65;&#xFF0C;&#x6765;&#x770B;&#x770B;&#x600E;&#x6837;&#x64A4;&#x9500;&#x4E00;&#x4E2A; HTTP &#x8BF7;&#x6C42;&#x3002;</p>
<h3 id="&#x64A4;&#x9500;&#x8BF7;&#x6C42;&#x6A21;&#x5757;"><a href="#&#x64A4;&#x9500;&#x8BF7;&#x6C42;&#x6A21;&#x5757;" class="headerlink" title="&#x64A4;&#x9500;&#x8BF7;&#x6C42;&#x6A21;&#x5757;"></a>&#x64A4;&#x9500;&#x8BF7;&#x6C42;&#x6A21;&#x5757;</h3><p>&#x4E0E;&#x64A4;&#x9500;&#x8BF7;&#x6C42;&#x76F8;&#x5173;&#x7684;&#x6A21;&#x5757;&#x4F4D;&#x4E8E; <code>Cancel/</code> &#x6587;&#x4EF6;&#x5939;&#x4E0B;&#xFF0C;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E0B;&#x76F8;&#x5173;&#x6838;&#x5FC3;&#x4EE3;&#x7801;&#x3002;</p>
<p>&#x9996;&#x5148;&#xFF0C;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E0B;&#x57FA;&#x7840; <code>Cancel</code> &#x7C7B;&#x3002;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x7528;&#x6765;&#x8BB0;&#x5F55;&#x64A4;&#x9500;&#x72B6;&#x6001;&#x7684;&#x7C7B;&#xFF0C;&#x5177;&#x4F53;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function Cancel(message) {</span><br><span class="line">  this.message = message;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">Cancel.prototype.toString = function toString() {</span><br><span class="line">  return &apos;Cancel&apos; + (this.message ? &apos;: &apos; + this.message : &apos;&apos;);</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">Cancel.prototype.__CANCEL__ = true;</span><br></pre></td></tr></table></figure>

<p>&#x4F7F;&#x7528; <code>CancelToken</code> &#x7C7B;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x5411;&#x5B83;&#x4F20;&#x9012;&#x4E00;&#x4E2A; Promise &#x65B9;&#x6CD5;&#xFF0C;&#x7528;&#x6765;&#x5B9E;&#x73B0; HTTP &#x8BF7;&#x6C42;&#x7684;&#x64A4;&#x9500;&#xFF0C;&#x5177;&#x4F53;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function CancelToken(executor) {</span><br><span class="line">    if (typeof executor !== &apos;function&apos;) {</span><br><span class="line">        throw new TypeError(&apos;executor must be a function.&apos;);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    var resolvePromise;</span><br><span class="line">    this.promise = new Promise(function promiseExecutor(resolve) {</span><br><span class="line">        resolvePromise = resolve;</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    var token = this;</span><br><span class="line">    executor(function cancel(message) {</span><br><span class="line">        if (token.reason) {</span><br><span class="line">            // &#x5DF2;&#x7ECF;&#x88AB;&#x64A4;&#x9500;&#x4E86;</span><br><span class="line">            return;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        token.reason = new Cancel(message);</span><br><span class="line">        resolvePromise(token.reason);</span><br><span class="line">    });</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">CancelToken.source = function source() {</span><br><span class="line">    var cancel;</span><br><span class="line">    var token = new CancelToken(function executor(c) {</span><br><span class="line">        cancel = c;</span><br><span class="line">    });</span><br><span class="line">    return {</span><br><span class="line">        token: token,</span><br><span class="line">        cancel: cancel</span><br><span class="line">    };</span><br><span class="line">};</span><br></pre></td></tr></table></figure>

<p><code>adapters/xhr.js</code> &#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x64A4;&#x9500;&#x8BF7;&#x6C42;&#x7684;&#x5730;&#x65B9;&#x662F;&#x8FD9;&#x6837;&#x5199;&#x7684;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;if (config.cancelToken) {</span><br><span class="line">    // &#x7B49;&#x5F85;&#x64A4;&#x9500;</span><br><span class="line">    config.cancelToken.promise.then(function onCanceled(cancel) {</span><br><span class="line">        if (!request) {</span><br><span class="line">            return;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        request.abort();</span><br><span class="line">        reject(cancel);</span><br><span class="line">        // &#x91CD;&#x7F6E;&#x8BF7;&#x6C42;</span><br><span class="line">        request = null;</span><br><span class="line">    });</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x64A4;&#x9500;  HTTP&#x8BF7;&#x6C42;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x7B80;&#x8981;&#x5730;&#x8BA8;&#x8BBA;&#x4E00;&#x4E0B;&#x76F8;&#x5173;&#x7684;&#x5B9E;&#x73B0;&#x903B;&#x8F91;&#xFF1A;</p>
<ol>
<li>&#x5728;&#x9700;&#x8981;&#x64A4;&#x9500;&#x7684;&#x8BF7;&#x6C42;&#x4E2D;&#xFF0C;&#x8C03;&#x7528; <code>CancelToken</code> &#x7C7B;&#x7684; <code>source</code> &#x65B9;&#x6CD5;&#x7C7B;&#x8FDB;&#x884C;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x4F1A;&#x5F97;&#x5230;&#x4E00;&#x4E2A;&#x5305;&#x542B; <code>CancelToken</code> &#x7C7B;&#x5B9E;&#x4F8B; A &#x548C; <code>cancel</code> &#x65B9;&#x6CD5;&#x7684;&#x5BF9;&#x8C61;&#x3002;</li>
<li>&#x5F53; source &#x65B9;&#x6CD5;&#x6B63;&#x5728;&#x8FD4;&#x56DE;&#x5B9E;&#x4F8B; A &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E00;&#x4E2A;&#x5904;&#x4E8E; pending &#x72B6;&#x6001;&#x7684; <code>promise</code> &#x5BF9;&#x8C61;&#x521D;&#x59CB;&#x5316;&#x5B8C;&#x6210;&#x3002;&#x5728;&#x5C06;&#x5B9E;&#x4F8B; A &#x4F20;&#x9012;&#x7ED9; axios &#x4E4B;&#x540E;&#xFF0C;<code>promise</code> &#x5C31;&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;&#x64A4;&#x9500;&#x8BF7;&#x6C42;&#x7684;&#x89E6;&#x53D1;&#x5668;&#x4F7F;&#x7528;&#x4E86;&#x3002;</li>
<li>&#x5F53;&#x8C03;&#x7528;&#x901A;&#x8FC7; <code>source</code> &#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x7684; <code>cancel</code> &#x65B9;&#x6CD5;&#x540E;&#xFF0C;&#x5B9E;&#x4F8B; A &#x4E2D; <code>promise</code> &#x72B6;&#x6001;&#x4ECE; pending &#x53D8;&#x6210; fulfilled&#xFF0C;&#x7136;&#x540E;&#x7ACB;&#x5373;&#x89E6;&#x53D1; <code>then</code> &#x56DE;&#x8C03;&#x51FD;&#x6570;&#x3002;&#x4E8E;&#x662F; axios &#x7684;&#x64A4;&#x9500;&#x65B9;&#x6CD5;&#x2014;&#x2014;<code>request.abort()</code> &#x88AB;&#x89E6;&#x53D1;&#x4E86;&#x3002;</li>
</ol>
<h2 id="axios-&#x8FD9;&#x6837;&#x8BBE;&#x8BA1;&#x7684;&#x597D;&#x5904;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;"><a href="#axios-&#x8FD9;&#x6837;&#x8BBE;&#x8BA1;&#x7684;&#x597D;&#x5904;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;" class="headerlink" title="axios &#x8FD9;&#x6837;&#x8BBE;&#x8BA1;&#x7684;&#x597D;&#x5904;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;"></a>axios &#x8FD9;&#x6837;&#x8BBE;&#x8BA1;&#x7684;&#x597D;&#x5904;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;</h2><h3 id="&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x51FD;&#x6570;&#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;"><a href="#&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x51FD;&#x6570;&#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;" class="headerlink" title="&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x51FD;&#x6570;&#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;"></a>&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x51FD;&#x6570;&#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;</h3><p>&#x5982;&#x524D;&#x51E0;&#x7AE0;&#x6240;&#x8FF0;&#xFF0C;axios &#x4E0D;&#x5C06;&#x7528;&#x6765;&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x7684; <code>dispatchRequest</code> &#x51FD;&#x6570;&#x770B;&#x505A;&#x4E00;&#x4E2A;&#x7279;&#x6B8A;&#x51FD;&#x6570;&#x3002;&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;<code>dispatchRequest</code> &#x4F1A;&#x88AB;&#x653E;&#x5728;&#x961F;&#x5217;&#x7684;&#x4E2D;&#x95F4;&#x4F4D;&#x7F6E;&#xFF0C;&#x4EE5;&#x4FBF;&#x4FDD;&#x8BC1;&#x961F;&#x5217;&#x5904;&#x7406;&#x7684;&#x4E00;&#x81F4;&#x6027;&#x548C;&#x4EE3;&#x7801;&#x7684;&#x53EF;&#x8BFB;&#x6027;&#x3002;</p>
<h3 id="&#x9002;&#x914D;&#x5668;&#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;"><a href="#&#x9002;&#x914D;&#x5668;&#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;" class="headerlink" title="&#x9002;&#x914D;&#x5668;&#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;"></a>&#x9002;&#x914D;&#x5668;&#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;</h3><p>&#x5728;&#x9002;&#x914D;&#x5668;&#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;&#x4E0A;&#xFF0C;<code>http</code> &#x548C; <code>xhr</code> &#x6A21;&#x5757;&#xFF08;&#x4E00;&#x4E2A;&#x662F;&#x5728; Node.js &#x4E2D;&#x7528;&#x6765;&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x7684;&#xFF0C;&#x4E00;&#x4E2A;&#x662F;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x91CC;&#x7528;&#x6765;&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x7684;&#xFF09;&#x5E76;&#x6CA1;&#x6709;&#x5728; <code>dispatchRequest</code> &#x51FD;&#x6570;&#x4E2D;&#x4F7F;&#x7528;&#xFF0C;&#x800C;&#x662F;&#x5404;&#x81EA;&#x4F5C;&#x4E3A;&#x5355;&#x72EC;&#x7684;&#x6A21;&#x5757;&#xFF0C;&#x9ED8;&#x8BA4;&#x901A;&#x8FC7; <code>defaults.js</code> &#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x914D;&#x7F6E;&#x65B9;&#x6CD5;&#x5F15;&#x5165;&#x7684;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5B83;&#x4E0D;&#x4EC5;&#x786E;&#x4FDD;&#x4E86;&#x4E24;&#x4E2A;&#x6A21;&#x5757;&#x4E4B;&#x95F4;&#x7684;&#x4F4E;&#x8026;&#x5408;&#xFF0C;&#x800C;&#x4E14;&#x8FD8;&#x4E3A;&#x5C06;&#x6765;&#x7684;&#x7528;&#x6237;&#x63D0;&#x4F9B;&#x4E86;&#x5B9A;&#x5236;&#x8BF7;&#x6C42;&#x53D1;&#x9001;&#x6A21;&#x5757;&#x7684;&#x7A7A;&#x95F4;&#x3002;</p>
<h3 id="&#x64A4;&#x9500;-HTTP-&#x8BF7;&#x6C42;&#x7684;&#x903B;&#x8F91;"><a href="#&#x64A4;&#x9500;-HTTP-&#x8BF7;&#x6C42;&#x7684;&#x903B;&#x8F91;" class="headerlink" title="&#x64A4;&#x9500; HTTP &#x8BF7;&#x6C42;&#x7684;&#x903B;&#x8F91;"></a>&#x64A4;&#x9500; HTTP &#x8BF7;&#x6C42;&#x7684;&#x903B;&#x8F91;</h3><p>&#x5728;&#x64A4;&#x9500; HTTP &#x8BF7;&#x6C42;&#x7684;&#x903B;&#x8F91;&#x4E2D;&#xFF0C;axios &#x8BBE;&#x8BA1;&#x4F7F;&#x7528; Promise &#x6765;&#x4F5C;&#x4E3A;&#x89E6;&#x53D1;&#x5668;&#xFF0C;&#x5C06; <code>resolve</code> &#x51FD;&#x6570;&#x66B4;&#x9732;&#x5728;&#x5916;&#x9762;&#xFF0C;&#x5E76;&#x5728;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x91CC;&#x4F7F;&#x7528;&#x3002;&#x5B83;&#x4E0D;&#x4EC5;&#x786E;&#x4FDD;&#x4E86;&#x5185;&#x90E8;&#x903B;&#x8F91;&#x7684;&#x4E00;&#x81F4;&#x6027;&#xFF0C;&#x800C;&#x4E14;&#x8FD8;&#x786E;&#x4FDD;&#x4E86;&#x5728;&#x9700;&#x8981;&#x64A4;&#x9500;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x76F4;&#x63A5;&#x66F4;&#x6539;&#x76F8;&#x5173;&#x7C7B;&#x7684;&#x6837;&#x4F8B;&#x6570;&#x636E;&#xFF0C;&#x4EE5;&#x907F;&#x514D;&#x5728;&#x5F88;&#x5927;&#x7A0B;&#x5EA6;&#x4E0A;&#x5165;&#x4FB5;&#x5176;&#x4ED6;&#x6A21;&#x5757;&#x3002;</p>
<h2 id="&#x603B;&#x7ED3;"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3;</h2><p>&#x672C;&#x6587;&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;&#x4E86; axios &#x7684;&#x7528;&#x6CD5;&#x3001;&#x8BBE;&#x8BA1;&#x601D;&#x60F3;&#x548C;&#x5B9E;&#x73B0;&#x65B9;&#x6CD5;&#x3002;&#x5728;&#x9605;&#x8BFB;&#x4E4B;&#x540E;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x4E86;&#x89E3; axios &#x7684;&#x8BBE;&#x8BA1;&#xFF0C;&#x5E76;&#x4E86;&#x89E3;&#x6A21;&#x5757;&#x7684;&#x5C01;&#x88C5;&#x548C;&#x4EA4;&#x4E92;&#x3002;</p>
<p>&#x672C;&#x6587;&#x53EA;&#x4ECB;&#x7ECD;&#x4E86; axios &#x7684;&#x6838;&#x5FC3;&#x6A21;&#x5757;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x5BF9;&#x5176;&#x4ED6;&#x6A21;&#x5757;&#x4EE3;&#x7801;&#x611F;&#x5174;&#x8DA3;&#xFF0C;&#x53EF;&#x4EE5;&#x5230; <a href="/external_links/8f344fe4707096c96d2ef5fa724e2176.html" target="blank" rel="noopener">GitHub</a> &#x4E0A;&#x67E5;&#x770B;&#x3002;</p>
<p>&#xFF08;&#x5B8C;&#xFF09;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/a8e88a0fd99673f745bb87c538b664ab.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903949686800392.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903949686800392.html" itemprop="url">【码上开学】Kotlin 的协程用力瞥一眼</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-23T17:27:34+08:00">
                2019-09-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>&#x672C;&#x671F;&#x4F5C;&#x8005;&#xFF1A;</p>
<p>&#x89C6;&#x9891;&#xFF1A;&#x6254;&#x7269;&#x7EBF;&#xFF08;&#x6731;&#x51EF;&#xFF09;</p>
<p>&#x6587;&#x7AE0;&#xFF1A;<a href="/external_links/310cffc8ed9f8538be06186cf5d988ce.html" target="blank" rel="noopener">LewisLuo&#xFF08;&#x7F57;&#x5B87;&#xFF09;</a></p>
</blockquote>
<p>&#x5927;&#x5BB6;&#x597D;&#xFF0C;&#x6211;&#x662F;&#x6254;&#x7269;&#x7EBF;&#x6731;&#x51EF;&#x3002;</p>
<p>&#x7EC8;&#x4E8E;&#x5230;&#x4E86;&#x534F;&#x7A0B;&#x7684;&#x4E00;&#x671F;&#x4E86;&#x3002;</p>
<p>Kotlin &#x7684;&#x534F;&#x7A0B;&#x662F;&#x5B83;&#x975E;&#x5E38;&#x7279;&#x522B;&#x7684;&#x4E00;&#x5757;&#x5730;&#x65B9;&#xFF1A;&#x5BA3;&#x626C;&#x5B83;&#x7684;&#x4EBA;&#x90FD;&#x5728;&#x8BF4;&#x534F;&#x7A0B;&#x591A;&#x4E48;&#x597D;&#x591A;&#x4E48;&#x68D2;&#xFF0C;&#x4F46;&#x591A;&#x6570;&#x4EBA;&#x4E0D;&#x7BA1;&#x662F;&#x770B;&#x4E86;&#x534F;&#x7A0B;&#x7684;&#x5B98;&#x65B9;&#x6587;&#x6863;&#x8FD8;&#x662F;&#x4E00;&#x4E9B;&#x7F51;&#x7EDC;&#x6587;&#x7AE0;&#x4E4B;&#x540E;&#x53C8;&#x90FD;&#x89C9;&#x5F97;&#x5B8C;&#x5168;&#x770B;&#x4E0D;&#x61C2;&#x3002;&#x800C;&#x4E14;&#x8FD9;&#x4E2A;&#x300C;&#x4E0D;&#x61C2;&#x300D;&#x548C; RxJava &#x662F;&#x5C5E;&#x4E8E;&#x4E00;&#x7C7B;&#x7684;&#xFF1A;&#x7531;&#x4E8E;&#x534F;&#x7A0B;&#x5728;&#x6982;&#x5FF5;&#x4E0A;&#x5BF9;&#x4E8E; Java &#x5F00;&#x53D1;&#x8005;&#x6765;&#x8BF4;&#x5C31;&#x662F;&#x4E2A;&#x65B0;&#x4E1C;&#x897F;&#xFF0C;&#x6240;&#x4EE5;&#x5BF9;&#x4E8E;&#x5927;&#x591A;&#x6570;&#x4EBA;&#x6765;&#x8BF4;&#xFF0C;&#x522B;&#x8BF4;&#x600E;&#x4E48;&#x7528;&#x4E86;&#xFF0C;&#x6211;&#x8FDE;&#x5B83;&#x662F;&#x4E2A;&#x4EC0;&#x4E48;&#x4E1C;&#x897F;&#x90FD;&#x6CA1;&#x770B;&#x660E;&#x767D;&#x3002;</p>
<p>&#x6240;&#x4EE5;&#x4ECA;&#x5929;&#xFF0C;&#x6211;&#x5C31;&#x5148;&#x4ECE;&#x300C;&#x534F;&#x7A0B;&#x662F;&#x4EC0;&#x4E48;&#x300D;&#x8BF4;&#x8D77;&#x3002;&#x9996;&#x5148;&#x8FD8;&#x662F;&#x770B;&#x89C6;&#x9891;&#x3002;<strong>&#x4E0D;&#x8FC7;&#x56E0;&#x4E3A;&#x6211;&#x4E00;&#x76F4;&#x4E0D;&#x77E5;&#x9053;&#x600E;&#x4E48;&#x5728;&#x6398;&#x91D1;&#x53D1;&#x89C6;&#x9891;&#xFF0C;&#x6240;&#x4EE5;&#x4F60;&#x53EF;&#x4EE5;&#x70B9;&#x51FB; <a href="/external_links/e5da25d6b9f9eba1690d92968bd6835e.html" target="blank" rel="noopener">&#x8FD9;&#x91CC;</a> &#x53BB;&#x54D4;&#x54E9;&#x54D4;&#x54E9;&#x770B;&#x89C6;&#x9891;&#xFF0C;&#x53EF;&#x4EE5;&#x70B9;&#x51FB; <a href="/external_links/565219f01d5ab814f3deb302fe7dffd5.html" target="blank" rel="noopener">&#x8FD9;&#x91CC;</a> &#x53BB; YouTube &#x770B;&#x3002;</strong></p>
<p>&#x8FD9;&#x671F;&#x5185;&#x5BB9;&#x4E3B;&#x8981;&#x662F;&#x8BB2;&#x4E00;&#x4E2A;&#x6982;&#x5FF5;&#xFF1A;&#x4EC0;&#x4E48;&#x662F;&#x534F;&#x7A0B;&#x3002;&#x56E0;&#x4E3A;&#x8FD9;&#x4E2A;&#x6982;&#x5FF5;&#x6709;&#x70B9;&#x96BE;&#xFF08;&#x5176;&#x5B9E;&#x770B;&#x5B8C;&#x89C6;&#x9891;&#x4F60;&#x4F1A;&#x53D1;&#x73B0;&#x5B83;&#x8D85;&#x7EA7;&#x7B80;&#x5355;&#xFF09;&#xFF0C;&#x6240;&#x4EE5;&#x4E13;&#x95E8;&#x82B1;&#x4E00;&#x671F;&#x6765;&#x8BB2;&#x89E3;&#x3002;&#x540E;&#x9762;&#x7684;&#x5185;&#x5BB9;&#x4F1A;&#x66F4;&#x52B2;&#x7206;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x559C;&#x6B22;&#x6211;&#x7684;&#x89C6;&#x9891;&#xFF0C;&#x522B;&#x5FD8;&#x4E86;&#x53BB; <a href="/external_links/2a46f7f96801b05a8085e694e1c56d50.html" target="blank" rel="noopener">&#x539F;&#x89C6;&#x9891;</a> &#x70B9;&#x4E2A;&#x8D5E;&#x6295;&#x4E2A;&#x5E01;&#xFF0C;&#x4EE5;&#x53CA;&#x5173;&#x6CE8;&#x8BA2;&#x9605;&#x4E00;&#x4E0B;&#xFF0C;&#x4E0D;&#x9519;&#x8FC7;&#x6211;&#x7684;&#x4EFB;&#x4F55;&#x65B0;&#x89C6;&#x9891;&#xFF01;</p>
<blockquote>
<p>&#x4EE5;&#x4E0B;&#x5185;&#x5BB9;&#x6765;&#x81EA;&#x6587;&#x7AE0;&#x4F5C;&#x8005; <a href="/external_links/310cffc8ed9f8538be06186cf5d988ce.html" target="blank" rel="noopener">LewisLuo</a>&#x3002;</p>
</blockquote>
<p>&#x7801;&#x4E0A;&#x5F00;&#x5B66; Kotlin &#x7CFB;&#x5217;&#x7684;&#x6587;&#x7AE0;&#xFF0C;&#x534F;&#x7A0B;&#x5DF2;&#x7ECF;&#x662F;&#x7B2C;&#x4E94;&#x671F;&#x4E86;&#xFF0C;&#x8FD9;&#x91CC;&#x7B80;&#x5355;&#x8BB2;&#x4E00;&#x4E0B;&#x6211;&#x4EEC;&#xFF08;&#x6254;&#x7269;&#x7EBF;&#x548C;&#x5373;&#x523B; Android &#x56E2;&#x961F;&#xFF09;&#x51FA;&#x54C1;&#x7684; Kotlin &#x4E0A;&#x624B;&#x6307;&#x5357;&#x7CFB;&#x5217;&#x6587;&#x7AE0;&#x7684;&#x4E00;&#x4E9B;&#x8003;&#x91CF;&#xFF1A;</p>
<ul>
<li>&#x5B98;&#x65B9;&#x6587;&#x6863;&#x6709;&#x6307;&#x5B9A;&#x7684;&#x683C;&#x5F0F;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x662F;&#x5B98;&#x65B9;&#x7684;&#xFF0C;&#x5FC5;&#x987B;&#x9762;&#x9762;&#x4FF1;&#x5230;&#xFF0C;&#x5199;&#x4F5C;&#x987A;&#x5E8F;&#x4E0D;&#x662F;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x4E0D;&#x7BA1;&#x4F60;&#x61C2;&#x4E0D;&#x61C2;&#xFF0C;&#x5B83;&#x90FD;&#x5F97;&#x8BB2;&#x3002;</li>
<li>&#x7F51;&#x4E0A;&#x7684;&#x6587;&#x7AE0;&#x5927;&#x90FD;&#x662F;&#x4ECE;&#x4F5C;&#x8005;&#x81EA;&#x8EAB;&#x7684;&#x89D2;&#x5EA6;&#x51FA;&#x53D1;&#xFF0C;&#x771F;&#x6B63;&#x4ECE;&#x8BFB;&#x8005;&#x7684;&#x9700;&#x6C42;&#x51FA;&#x53D1;&#x7684;&#x5C11;&#x4E4B;&#x53C8;&#x5C11;&#xFF0C;&#x65E0;&#x6CD5;&#x6293;&#x4F4F;&#x8BFB;&#x8005;&#x7684;&#x75DB;&#x70B9;&#xFF0C;&#x80FD;&#x591F;&#x8BFB;&#x5B8C;&#x5DF2;&#x5C5E;&#x4E0D;&#x6613;&#x3002;</li>
<li>&#x75B2;&#x52B3;&#x5EA6;&#x662F;&#x8FD9;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x4E00;&#x4E2A;&#x91CD;&#x8981;&#x7684;&#x8861;&#x91CF;&#x6307;&#x6807;&#xFF0C;&#x6587;&#x7AE0;&#x4E2D;&#x5982;&#x679C;&#x8FDE;&#x7EED;&#x51FA;&#x73B0;&#x5927;&#x6BB5;&#x4EE3;&#x7801;&#xFF0C;&#x75B2;&#x52B3;&#x5EA6;&#x4F1A;&#x6025;&#x5267;&#x4E0A;&#x5347;&#xFF0C;&#x4E0D;&#x5BB9;&#x6613;&#x96C6;&#x4E2D;&#x7CBE;&#x795E;&#xFF0C;&#x751A;&#x81F3;&#x4E2D;&#x9014;&#x653E;&#x5F03;&#x3002;</li>
</ul>
<p>&#x6211;&#x4EEC;&#x671F;&#x8BB8;&#x57FA;&#x4E8E;&#x4E0A;&#x8FF0;&#x7684;&#x8003;&#x91CF;&#x548C;&#x539F;&#x5219;&#xFF0C;&#x628A;&#x6280;&#x672F;&#x6587;&#x7AE0;&#x5199;&#x5F97;&#x66F4;&#x52A0;&#x8F7B;&#x677E;&#x6613;&#x8BFB;&#xFF0C;&#x6FC0;&#x53D1;&#x8BFB;&#x8005;&#x5B66;&#x4E60;&#x7684;&#x5174;&#x8DA3;&#xFF0C;&#x771F;&#x6B63;&#x5B9E;&#x73B0;&#x300C;&#x4E0A;&#x624B;&#x300D;&#x3002;</p>
<p>&#x534F;&#x7A0B;&#x5728; Kotlin &#x4E2D;&#x662F;&#x975E;&#x5E38;&#x7279;&#x522B;&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x548C; Java &#x76F8;&#x6BD4;&#xFF0C;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x65B0;&#x9896;&#x7684;&#x6982;&#x5FF5;&#x3002;&#x5BA3;&#x626C;&#x5B83;&#x7684;&#x4EBA;&#x90FD;&#x5728;&#x8BF4;&#x534F;&#x7A0B;&#x662F;&#x591A;&#x4E48;&#x597D;&#x7528;&#xFF0C;&#x4F46;&#x5C31;&#x76EE;&#x524D;&#x800C;&#x8A00;&#x4E0D;&#x7BA1;&#x662F;&#x5B98;&#x65B9;&#x6587;&#x6863;&#x8FD8;&#x662F;&#x7F51;&#x7EDC;&#x4E0A;&#x7684;&#x4E00;&#x4E9B;&#x6587;&#x7AE0;&#x90FD;&#x8BA9;&#x4EBA;&#x96BE;&#x4EE5;&#x8BFB;&#x61C2;&#x3002;</p>
<p>&#x9020;&#x6210;&#x8FD9;&#x79CD;&#x300C;&#x4E0D;&#x61C2;&#x300D;&#x7684;&#x539F;&#x56E0;&#x548C;&#x5927;&#x591A;&#x6570;&#x4EBA;&#x5728;&#x521D;&#x5B66; RxJava &#x65F6;&#x6240;&#x9047;&#x5230;&#x7684;&#x95EE;&#x9898;&#x5176;&#x5B9E;&#x662F;&#x4E00;&#x81F4;&#x7684;&#xFF1A;&#x5BF9;&#x4E8E; Java &#x5F00;&#x53D1;&#x8005;&#x6765;&#x8BF4;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x65B0;&#x4E1C;&#x897F;&#x3002;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x4ECE;&#x300C;&#x534F;&#x7A0B;&#x662F;&#x4EC0;&#x4E48;&#x300D;&#x5F00;&#x59CB;&#x8BF4;&#x8D77;&#x3002;</p>
<h3 id="&#x534F;&#x7A0B;&#x662F;&#x4EC0;&#x4E48;"><a href="#&#x534F;&#x7A0B;&#x662F;&#x4EC0;&#x4E48;" class="headerlink" title="&#x534F;&#x7A0B;&#x662F;&#x4EC0;&#x4E48;"></a>&#x534F;&#x7A0B;&#x662F;&#x4EC0;&#x4E48;</h3><p>&#x534F;&#x7A0B;&#x5E76;&#x4E0D;&#x662F; Kotlin &#x63D0;&#x51FA;&#x6765;&#x7684;&#x65B0;&#x6982;&#x5FF5;&#xFF0C;&#x5176;&#x4ED6;&#x7684;&#x4E00;&#x4E9B;&#x7F16;&#x7A0B;&#x8BED;&#x8A00;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;Go&#x3001;Python &#x7B49;&#x90FD;&#x53EF;&#x4EE5;&#x5728;&#x8BED;&#x8A00;&#x5C42;&#x9762;&#x4E0A;&#x5B9E;&#x73B0;&#x534F;&#x7A0B;&#xFF0C;&#x751A;&#x81F3;&#x662F; Java&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4F7F;&#x7528;&#x6269;&#x5C55;&#x5E93;&#x6765;&#x95F4;&#x63A5;&#x5730;&#x652F;&#x6301;&#x534F;&#x7A0B;&#x3002;</p>
<p>&#x5F53;&#x5728;&#x7F51;&#x4E0A;&#x641C;&#x7D22;&#x534F;&#x7A0B;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x770B;&#x5230;&#xFF1A;</p>
<ul>
<li>Kotlin &#x5B98;&#x65B9;&#x6587;&#x6863;&#x8BF4;&#x300C;&#x672C;&#x8D28;&#x4E0A;&#xFF0C;&#x534F;&#x7A0B;&#x662F;&#x8F7B;&#x91CF;&#x7EA7;&#x7684;&#x7EBF;&#x7A0B;&#x300D;&#x3002;</li>
<li>&#x5F88;&#x591A;&#x535A;&#x5BA2;&#x63D0;&#x5230;&#x300C;&#x4E0D;&#x9700;&#x8981;&#x4ECE;&#x7528;&#x6237;&#x6001;&#x5207;&#x6362;&#x5230;&#x5185;&#x6838;&#x6001;&#x300D;&#x3001;&#x300C;&#x662F;&#x534F;&#x4F5C;&#x5F0F;&#x7684;&#x300D;&#x7B49;&#x7B49;&#x3002;</li>
</ul>
<p>&#x4F5C;&#x4E3A; Kotlin &#x534F;&#x7A0B;&#x7684;&#x521D;&#x5B66;&#x8005;&#xFF0C;&#x8FD9;&#x4E9B;&#x6982;&#x5FF5;&#x5E76;&#x4E0D;&#x662F;&#x90A3;&#x4E48;&#x5BB9;&#x6613;&#x8BA9;&#x4EBA;&#x7406;&#x89E3;&#x3002;&#x8FD9;&#x4E9B;&#x5F80;&#x5F80;&#x662F;&#x4F5C;&#x8005;&#x6839;&#x636E;&#x81EA;&#x5DF1;&#x7684;&#x7ECF;&#x9A8C;&#x603B;&#x7ED3;&#x51FA;&#x6765;&#x7684;&#xFF0C;&#x53EA;&#x770B;&#x7ED3;&#x679C;&#xFF0C;&#x800C;<strong>&#x4E0D;&#x7BA1;&#x8FC7;&#x7A0B;&#x5C31;&#x4E0D;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#x534F;&#x7A0B;</strong>&#x3002;</p>
<p>&#x300C;&#x534F;&#x7A0B; Coroutines&#x300D;&#x6E90;&#x81EA; Simula &#x548C; Modula-2 &#x8BED;&#x8A00;&#xFF0C;&#x8FD9;&#x4E2A;&#x672F;&#x8BED;&#x65E9;&#x5728; 1958 &#x5E74;&#x5C31;&#x88AB; Melvin Edward Conway &#x53D1;&#x660E;&#x5E76;&#x7528;&#x4E8E;&#x6784;&#x5EFA;&#x6C47;&#x7F16;&#x7A0B;&#x5E8F;&#xFF0C;&#x8BF4;&#x660E;<strong>&#x534F;&#x7A0B;&#x662F;&#x4E00;&#x79CD;&#x7F16;&#x7A0B;&#x601D;&#x60F3;</strong>&#xFF0C;&#x5E76;&#x4E0D;&#x5C40;&#x9650;&#x4E8E;&#x7279;&#x5B9A;&#x7684;&#x8BED;&#x8A00;&#x3002;</p>
<p>Go &#x8BED;&#x8A00;&#x4E5F;&#x6709;&#x534F;&#x7A0B;&#xFF0C;&#x53EB; Goroutines&#xFF0C;&#x4ECE;&#x82F1;&#x6587;&#x62FC;&#x5199;&#x5C31;&#x77E5;&#x9053;&#x5B83;&#x548C; Coroutines &#x8FD8;&#x662F;&#x6709;&#x4E9B;&#x5DEE;&#x522B;&#x7684;&#xFF08;&#x8BBE;&#x8BA1;&#x601D;&#x60F3;&#x4E0A;&#x662F;&#x6709;&#x5173;&#x7CFB;&#x7684;&#xFF09;&#xFF0C;&#x5426;&#x5219; Kotlin &#x7684;&#x534F;&#x7A0B;&#x5B8C;&#x5168;&#x53EF;&#x4EE5;&#x53EB; Koroutines &#x4E86;&#x3002;</p>
<p>&#x56E0;&#x6B64;&#xFF0C;&#x5BF9;&#x4E00;&#x4E2A;&#x65B0;&#x672F;&#x8BED;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x77E5;&#x9053;&#x4EC0;&#x4E48;&#x662F;&#x300C;&#x6807;&#x51C6;&#x300D;&#x672F;&#x8BED;&#xFF0C;&#x4EC0;&#x4E48;&#x662F;&#x53D8;&#x79CD;&#x3002;</p>
<p>&#x5F53;&#x6211;&#x4EEC;&#x8BA8;&#x8BBA;&#x534F;&#x7A0B;&#x548C;&#x7EBF;&#x7A0B;&#x7684;&#x5173;&#x7CFB;&#x65F6;&#xFF0C;&#x5F88;&#x5BB9;&#x6613;<strong>&#x9677;&#x5165;&#x4E2D;&#x6587;&#x7684;&#x8BEF;&#x533A;</strong>&#xFF0C;&#x4E24;&#x8005;&#x90FD;&#x6709;&#x4E00;&#x4E2A;&#x300C;&#x7A0B;&#x300D;&#x5B57;&#xFF0C;&#x5C31;&#x89C9;&#x5F97;&#x6709;&#x5173;&#x7CFB;&#xFF0C;&#x5176;&#x5B9E;&#x5C31;&#x82F1;&#x6587;&#x800C;&#x8A00;&#xFF0C;Coroutines &#x548C; Threads &#x5C31;&#x662F;&#x4E24;&#x4E2A;&#x6982;&#x5FF5;&#x3002;</p>
<p>&#x4ECE; Android &#x5F00;&#x53D1;&#x8005;&#x7684;&#x89D2;&#x5EA6;&#x53BB;&#x7406;&#x89E3;&#x5B83;&#x4EEC;&#x7684;&#x5173;&#x7CFB;&#xFF1A;</p>
<ul>
<li>&#x6211;&#x4EEC;&#x6240;&#x6709;&#x7684;&#x4EE3;&#x7801;&#x90FD;&#x662F;&#x8DD1;&#x5728;&#x7EBF;&#x7A0B;&#x4E2D;&#x7684;&#xFF0C;&#x800C;&#x7EBF;&#x7A0B;&#x662F;&#x8DD1;&#x5728;&#x8FDB;&#x7A0B;&#x4E2D;&#x7684;&#x3002;</li>
<li>&#x534F;&#x7A0B;&#x6CA1;&#x6709;&#x76F4;&#x63A5;&#x548C;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5173;&#x8054;&#xFF0C;&#x4F46;&#x5B83;&#x4E0D;&#x662F;&#x7A7A;&#x4E2D;&#x697C;&#x9601;&#xFF0C;&#x5B83;&#x4E5F;&#x662F;&#x8DD1;&#x5728;&#x7EBF;&#x7A0B;&#x4E2D;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x662F;&#x5355;&#x7EBF;&#x7A0B;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x662F;&#x591A;&#x7EBF;&#x7A0B;&#x3002;</li>
<li>&#x5355;&#x7EBF;&#x7A0B;&#x4E2D;&#x7684;&#x534F;&#x7A0B;&#x603B;&#x7684;&#x6267;&#x884C;&#x65F6;&#x95F4;&#x5E76;&#x4E0D;&#x4F1A;&#x6BD4;&#x4E0D;&#x7528;&#x534F;&#x7A0B;&#x5C11;&#x3002;</li>
<li>Android &#x7CFB;&#x7EDF;&#x4E0A;&#xFF0C;&#x5982;&#x679C;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x8FDB;&#x884C;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#xFF0C;&#x4F1A;&#x629B;&#x51FA; <code>NetworkOnMainThreadException</code>&#xFF0C;&#x5BF9;&#x4E8E;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E0A;&#x7684;&#x534F;&#x7A0B;&#x4E5F;&#x4E0D;&#x4F8B;&#x5916;&#xFF0C;&#x8FD9;&#x79CD;&#x573A;&#x666F;&#x4F7F;&#x7528;&#x534F;&#x7A0B;&#x8FD8;&#x662F;&#x8981;&#x5207;&#x7EBF;&#x7A0B;&#x7684;&#x3002;</li>
</ul>
<p>&#x534F;&#x7A0B;&#x8BBE;&#x8BA1;&#x7684;&#x521D;&#x8877;&#x662F;&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x5E76;&#x53D1;&#x95EE;&#x9898;&#xFF0C;&#x8BA9; &#x300C;&#x534F;&#x4F5C;&#x5F0F;&#x591A;&#x4EFB;&#x52A1;&#x300D; &#x5B9E;&#x73B0;&#x8D77;&#x6765;&#x66F4;&#x52A0;&#x65B9;&#x4FBF;&#x3002;&#x8FD9;&#x91CC;&#x5C31;&#x5148;&#x4E0D;&#x5C55;&#x5F00;&#x300C;&#x534F;&#x4F5C;&#x5F0F;&#x591A;&#x4EFB;&#x52A1;&#x300D;&#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x7B49;&#x6211;&#x4EEC;&#x5B66;&#x4F1A;&#x4E86;&#x600E;&#x4E48;&#x7528;&#x518D;&#x8BB2;&#x3002;</p>
<p>&#x89C6;&#x9891;&#x91CC;&#x8BB2;&#x5230;&#xFF0C;&#x534F;&#x7A0B;&#x5C31;&#x662F; Kotlin &#x63D0;&#x4F9B;&#x7684;&#x4E00;&#x5957;&#x7EBF;&#x7A0B;&#x5C01;&#x88C5;&#x7684; API&#xFF0C;&#x4F46;&#x5E76;&#x4E0D;&#x662F;&#x8BF4;&#x534F;&#x7A0B;&#x5C31;&#x662F;&#x4E3A;&#x7EBF;&#x7A0B;&#x800C;&#x751F;&#x7684;&#x3002;</p>
<p>&#x4E0D;&#x8FC7;&#xFF0C;&#x6211;&#x4EEC;&#x5B66;&#x4E60; Kotlin &#x4E2D;&#x7684;&#x534F;&#x7A0B;&#xFF0C;&#x4E00;&#x5F00;&#x59CB;&#x786E;&#x5B9E;&#x53EF;&#x4EE5;&#x4ECE;&#x7EBF;&#x7A0B;&#x63A7;&#x5236;&#x7684;&#x89D2;&#x5EA6;&#x6765;&#x5207;&#x5165;&#x3002;&#x56E0;&#x4E3A;&#x5728; Kotlin &#x4E2D;&#xFF0C;&#x534F;&#x7A0B;&#x7684;&#x4E00;&#x4E2A;&#x5178;&#x578B;&#x7684;&#x4F7F;&#x7528;&#x573A;&#x666F;&#x5C31;&#x662F;&#x7EBF;&#x7A0B;&#x63A7;&#x5236;&#x3002;&#x5C31;&#x50CF; Java &#x4E2D;&#x7684; <code>Executor</code> &#x548C; Android &#x4E2D;&#x7684; <code>AsyncTask</code>&#xFF0C;Kotlin &#x4E2D;&#x7684;&#x534F;&#x7A0B;&#x4E5F;&#x6709;&#x5BF9; Thread API &#x7684;&#x5C01;&#x88C5;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x5199;&#x4EE3;&#x7801;&#x65F6;&#xFF0C;&#x4E0D;&#x7528;&#x5173;&#x6CE8;&#x591A;&#x7EBF;&#x7A0B;&#x5C31;&#x80FD;&#x591F;&#x5F88;&#x65B9;&#x4FBF;&#x5730;&#x5199;&#x51FA;&#x5E76;&#x53D1;&#x64CD;&#x4F5C;&#x3002;</p>
<p>&#x5728; Java &#x4E2D;&#x8981;&#x5B9E;&#x73B0;&#x5E76;&#x53D1;&#x64CD;&#x4F5C;&#x901A;&#x5E38;&#x9700;&#x8981;&#x5F00;&#x542F;&#x4E00;&#x4E2A; <code>Thread</code> &#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;&#x2615;&#xFE0F;</span><br><span class="line">new Thread(new Runnable() {</span><br><span class="line">    @Override</span><br><span class="line">    public void run() {</span><br><span class="line">        ...</span><br><span class="line">    }</span><br><span class="line">}).start();</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x91CC;&#x4EC5;&#x4EC5;&#x53EA;&#x662F;&#x5F00;&#x542F;&#x4E86;&#x4E00;&#x4E2A;&#x65B0;&#x7EBF;&#x7A0B;&#xFF0C;&#x81F3;&#x4E8E;&#x5B83;&#x4F55;&#x65F6;&#x7ED3;&#x675F;&#x3001;&#x6267;&#x884C;&#x7ED3;&#x679C;&#x600E;&#x4E48;&#x6837;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E2D;&#x662F;&#x65E0;&#x6CD5;&#x76F4;&#x63A5;&#x77E5;&#x9053;&#x7684;&#x3002;</p>
<p>Kotlin &#x4E2D;&#x540C;&#x6837;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x7EBF;&#x7A0B;&#x7684;&#x65B9;&#x5F0F;&#x53BB;&#x5199;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">Thread({</span><br><span class="line">    ...</span><br><span class="line">}).start()</span><br></pre></td></tr></table></figure>

<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x548C; Java &#x4E00;&#x6837;&#x4E5F;&#x6446;&#x8131;&#x4E0D;&#x4E86;&#x76F4;&#x63A5;&#x4F7F;&#x7528; <code>Thread</code> &#x7684;&#x90A3;&#x4E9B;&#x56F0;&#x96BE;&#x548C;&#x4E0D;&#x65B9;&#x4FBF;&#xFF1A;</p>
<ul>
<li>&#x7EBF;&#x7A0B;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x6267;&#x884C;&#x7ED3;&#x675F;</li>
<li>&#x7EBF;&#x7A0B;&#x95F4;&#x7684;&#x76F8;&#x4E92;&#x901A;&#x4FE1;</li>
<li>&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x7684;&#x7BA1;&#x7406;</li>
</ul>
<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528; Java &#x7684; <code>Executor</code> &#x7EBF;&#x7A0B;&#x6C60;&#x6765;&#x8FDB;&#x884C;&#x7EBF;&#x7A0B;&#x7BA1;&#x7406;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">val executor = Executors.newCachedThreadPool()</span><br><span class="line">executor.execute({</span><br><span class="line">    ...</span><br><span class="line">})</span><br></pre></td></tr></table></figure>

<p>&#x7528; Android &#x7684; <code>AsyncTask</code> &#x6765;&#x89E3;&#x51B3;&#x7EBF;&#x7A0B;&#x95F4;&#x901A;&#x4FE1;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">object : AsyncTask&lt;T0, T1, T2&gt; { </span><br><span class="line">    override fun doInBackground(vararg args: T0): String { ... }</span><br><span class="line">    override fun onProgressUpdate(vararg args: T1) { ... }</span><br><span class="line">    override fun onPostExecute(t3: T3) { ... }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><code>AsyncTask</code> &#x662F; Android &#x5BF9;&#x7EBF;&#x7A0B;&#x6C60; <code>Executor</code> &#x7684;&#x5C01;&#x88C5;&#xFF0C;&#x4F46;&#x5B83;&#x7684;&#x7F3A;&#x70B9;&#x4E5F;&#x5F88;&#x660E;&#x663E;&#xFF1A;</p>
<ul>
<li>&#x9700;&#x8981;&#x5904;&#x7406;&#x5F88;&#x591A;&#x56DE;&#x8C03;&#xFF0C;&#x5982;&#x679C;&#x4E1A;&#x52A1;&#x591A;&#x5219;&#x5BB9;&#x6613;&#x9677;&#x5165;&#x300C;&#x56DE;&#x8C03;&#x5730;&#x72F1;&#x300D;&#x3002;</li>
<li>&#x786C;&#x662F;&#x628A;&#x4E1A;&#x52A1;&#x62C6;&#x5206;&#x6210;&#x4E86;&#x524D;&#x53F0;&#x3001;&#x4E2D;&#x95F4;&#x66F4;&#x65B0;&#x3001;&#x540E;&#x53F0;&#x4E09;&#x4E2A;&#x51FD;&#x6570;&#x3002;</li>
</ul>
<p>&#x770B;&#x5230;&#x8FD9;&#x91CC;&#x4F60;&#x5F88;&#x81EA;&#x7136;&#x60F3;&#x5230;&#x4F7F;&#x7528; RxJava &#x89E3;&#x51B3;&#x56DE;&#x8C03;&#x5730;&#x72F1;&#xFF0C;&#x5B83;&#x786E;&#x5B9E;&#x53EF;&#x4EE5;&#x5F88;&#x65B9;&#x4FBF;&#x5730;&#x89E3;&#x51B3;&#x4E0A;&#x9762;&#x7684;&#x95EE;&#x9898;&#x3002;</p>
<p>RxJava&#xFF0C;&#x51C6;&#x786E;&#x6765;&#x8BB2;&#x662F; ReactiveX &#x5728; Java &#x4E0A;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x662F;&#x4E00;&#x79CD;&#x54CD;&#x5E94;&#x5F0F;&#x7A0B;&#x5E8F;&#x6846;&#x67B6;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x5B83;&#x63D0;&#x4F9B;&#x7684;&#x300C;Observable&#x300D;&#x7684;&#x7F16;&#x7A0B;&#x8303;&#x5F0F;&#x8FDB;&#x884C;&#x94FE;&#x5F0F;&#x8C03;&#x7528;&#xFF0C;&#x53EF;&#x4EE5;&#x5F88;&#x597D;&#x5730;&#x6D88;&#x9664;&#x56DE;&#x8C03;&#x3002;</p>
<p>&#x4F7F;&#x7528;&#x534F;&#x7A0B;&#xFF0C;&#x540C;&#x6837;&#x53EF;&#x4EE5;&#x50CF; Rx &#x90A3;&#x6837;&#x6709;&#x6548;&#x5730;&#x6D88;&#x9664;&#x56DE;&#x8C03;&#x5730;&#x72F1;&#xFF0C;&#x4E0D;&#x8FC7;&#x65E0;&#x8BBA;&#x662F;&#x8BBE;&#x8BA1;&#x7406;&#x5FF5;&#xFF0C;&#x8FD8;&#x662F;&#x4EE3;&#x7801;&#x98CE;&#x683C;&#xFF0C;&#x4E24;&#x8005;&#x662F;&#x6709;&#x5F88;&#x5927;&#x533A;&#x522B;&#x7684;&#xFF0C;&#x534F;&#x7A0B;&#x5728;&#x5199;&#x6CD5;&#x4E0A;&#x548C;&#x666E;&#x901A;&#x7684;&#x987A;&#x5E8F;&#x4EE3;&#x7801;&#x7C7B;&#x4F3C;&#x3002;</p>
<blockquote>
<p>&#x8FD9;&#x91CC;&#x5E76;&#x4E0D;&#x4F1A;&#x6BD4;&#x8F83; RxJava &#x548C;&#x534F;&#x7A0B;&#x54EA;&#x4E2A;&#x597D;&#xFF0C;&#x6216;&#x8005;&#x8BA8;&#x8BBA;&#x8C01;&#x53D6;&#x4EE3;&#x8C01;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x8FD9;&#x91CC;&#x53EA;&#x7ED9;&#x51FA;&#x4E00;&#x4E2A;&#x5EFA;&#x8BAE;&#xFF0C;&#x4F60;&#x6700;&#x597D;&#x90FD;&#x53BB;&#x4E86;&#x89E3;&#x4E0B;&#xFF0C;&#x56E0;&#x4E3A;&#x534F;&#x7A0B;&#x548C; Rx &#x7684;&#x8BBE;&#x8BA1;&#x601D;&#x60F3;&#x672C;&#x6765;&#x5C31;&#x4E0D;&#x540C;&#x3002;</p>
</blockquote>
<p>&#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x662F;&#x4F7F;&#x7528;&#x534F;&#x7A0B;&#x8FDB;&#x884C;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x83B7;&#x53D6;&#x7528;&#x6237;&#x4FE1;&#x606F;&#x5E76;&#x663E;&#x793A;&#x5230; UI &#x63A7;&#x4EF6;&#x4E0A;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">launch({</span><br><span class="line">    val user = api.getUser() // &#x1F448; &#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#xFF08;IO &#x7EBF;&#x7A0B;&#xFF09;</span><br><span class="line">    nameTv.text = user.name  // &#x1F448; &#x66F4;&#x65B0; UI&#xFF08;&#x4E3B;&#x7EBF;&#x7A0B;&#xFF09;</span><br><span class="line">})</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x91CC;&#x53EA;&#x662F;&#x5C55;&#x793A;&#x4E86;&#x4E00;&#x4E2A;&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#xFF0C;<code>launch</code> &#x5E76;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x9876;&#x5C42;&#x51FD;&#x6570;&#xFF0C;&#x5B83;&#x5FC5;&#x987B;&#x5728;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x4E2D;&#x4F7F;&#x7528;&#xFF0C;&#x6211;&#x4EEC;&#x4E4B;&#x540E;&#x518D;&#x8BB2;&#xFF0C;&#x8FD9;&#x91CC;&#x53EA;&#x5173;&#x5FC3;&#x5B83;&#x5185;&#x90E8;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x7684;&#x5199;&#x6CD5;&#x3002;</p>
<p><code>launch</code> &#x51FD;&#x6570;&#x52A0;&#x4E0A;&#x5B9E;&#x73B0;&#x5728; <code>{}</code> &#x4E2D;&#x5177;&#x4F53;&#x7684;&#x903B;&#x8F91;&#xFF0C;&#x5C31;&#x6784;&#x6210;&#x4E86;&#x4E00;&#x4E2A;&#x534F;&#x7A0B;&#x3002;</p>
<p>&#x901A;&#x5E38;&#x6211;&#x4EEC;&#x505A;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#xFF0C;&#x8981;&#x4E0D;&#x5C31;&#x4F20;&#x4E00;&#x4E2A; callback&#xFF0C;&#x8981;&#x4E0D;&#x5C31;&#x662F;&#x5728; IO &#x7EBF;&#x7A0B;&#x91CC;&#x8FDB;&#x884C;&#x963B;&#x585E;&#x5F0F;&#x7684;&#x540C;&#x6B65;&#x8C03;&#x7528;&#xFF0C;&#x800C;&#x5728;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x4E2D;&#xFF0C;&#x4E0A;&#x4E0B;&#x4E24;&#x4E2A;&#x8BED;&#x53E5;&#x5206;&#x522B;&#x5DE5;&#x4F5C;&#x5728;&#x4E24;&#x4E2A;&#x7EBF;&#x7A0B;&#x91CC;&#xFF0C;&#x4F46;&#x5199;&#x6CD5;&#x4E0A;&#x770B;&#x8D77;&#x6765;&#x548C;&#x666E;&#x901A;&#x7684;&#x5355;&#x7EBF;&#x7A0B;&#x4EE3;&#x7801;&#x4E00;&#x6837;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x7684; <code>api.getUser</code> &#x662F;&#x4E00;&#x4E2A;<strong>&#x6302;&#x8D77;&#x51FD;&#x6570;</strong>&#xFF0C;&#x6240;&#x4EE5;&#x80FD;&#x591F;&#x4FDD;&#x8BC1; <code>nameTv.text</code> &#x7684;&#x6B63;&#x786E;&#x8D4B;&#x503C;&#xFF0C;&#x8FD9;&#x5C31;&#x6D89;&#x53CA;&#x5230;&#x4E86;&#x534F;&#x7A0B;&#x4E2D;&#x6700;&#x8457;&#x540D;&#x7684;&#x300C;&#x975E;&#x963B;&#x585E;&#x5F0F;&#x6302;&#x8D77;&#x300D;&#x3002;&#x8FD9;&#x4E2A;&#x540D;&#x8BCD;&#x770B;&#x8D77;&#x6765;&#x4E0D;&#x662F;&#x90A3;&#x4E48;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#xFF0C;&#x6211;&#x4EEC;&#x540E;&#x7EED;&#x7684;&#x6587;&#x7AE0;&#x4F1A;&#x4E13;&#x95E8;&#x5BF9;&#x8FD9;&#x4E2A;&#x6982;&#x5FF5;&#x8FDB;&#x884C;&#x8BB2;&#x89E3;&#x3002;&#x73B0;&#x5728;&#x5148;&#x628A;&#x8FD9;&#x4E2A;&#x6982;&#x5FF5;&#x653E;&#x4E0B;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x8BB0;&#x4F4F;&#x534F;&#x7A0B;&#x5C31;&#x662F;&#x8FD9;&#x6837;&#x5199;&#x7684;&#x5C31;&#x884C;&#x4E86;&#x3002;</p>
<p>&#x8FD9;&#x79CD;&#x300C;&#x7528;&#x540C;&#x6B65;&#x7684;&#x65B9;&#x5F0F;&#x5199;&#x5F02;&#x6B65;&#x7684;&#x4EE3;&#x7801;&#x300D;&#x770B;&#x8D77;&#x6765;&#x5F88;&#x65B9;&#x4FBF;&#x5427;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x770B;&#x534F;&#x7A0B;&#x5177;&#x4F53;&#x597D;&#x5728;&#x54EA;&#x3002;</p>
<h3 id="&#x534F;&#x7A0B;&#x597D;&#x5728;&#x54EA;"><a href="#&#x534F;&#x7A0B;&#x597D;&#x5728;&#x54EA;" class="headerlink" title="&#x534F;&#x7A0B;&#x597D;&#x5728;&#x54EA;"></a>&#x534F;&#x7A0B;&#x597D;&#x5728;&#x54EA;</h3><h4 id="&#x5F00;&#x59CB;&#x4E4B;&#x524D;"><a href="#&#x5F00;&#x59CB;&#x4E4B;&#x524D;" class="headerlink" title="&#x5F00;&#x59CB;&#x4E4B;&#x524D;"></a>&#x5F00;&#x59CB;&#x4E4B;&#x524D;</h4><p>&#x5728;&#x8BB2;&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5148;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;&#x300C;&#x95ED;&#x5305;&#x300D;&#x8FD9;&#x4E2A;&#x6982;&#x5FF5;&#xFF0C;&#x8C03;&#x7528; Kotlin &#x534F;&#x7A0B;&#x4E2D;&#x7684; API&#xFF0C;&#x7ECF;&#x5E38;&#x4F1A;&#x7528;&#x5230;&#x95ED;&#x5305;&#x5199;&#x6CD5;&#x3002;</p>
<p>&#x5176;&#x5B9E;&#x95ED;&#x5305;&#x5E76;&#x4E0D;&#x662F; Kotlin &#x4E2D;&#x7684;&#x65B0;&#x6982;&#x5FF5;&#xFF0C;&#x5728; Java 8 &#x4E2D;&#x5C31;&#x5DF2;&#x7ECF;&#x652F;&#x6301;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x5148;&#x4EE5; <code>Thread</code> &#x4E3A;&#x4F8B;&#xFF0C;&#x6765;&#x770B;&#x770B;&#x4EC0;&#x4E48;&#x662F;&#x95ED;&#x5305;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">// &#x521B;&#x5EFA;&#x4E00;&#x4E2A; Thread &#x7684;&#x5B8C;&#x6574;&#x5199;&#x6CD5;</span><br><span class="line">Thread(object : Runnable {</span><br><span class="line">    override fun run() {</span><br><span class="line">        ...</span><br><span class="line">    }</span><br><span class="line">})</span><br><span class="line"></span><br><span class="line">// &#x6EE1;&#x8DB3; SAM&#xFF0C;&#x5148;&#x7B80;&#x5316;&#x4E3A;</span><br><span class="line">Thread({</span><br><span class="line">    ...</span><br><span class="line">})</span><br><span class="line"></span><br><span class="line">// &#x4F7F;&#x7528;&#x95ED;&#x5305;&#xFF0C;&#x518D;&#x7B80;&#x5316;&#x4E3A;</span><br><span class="line">Thread {</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5F62;&#x5982; <code>Thread {...}</code> &#x8FD9;&#x6837;&#x7684;&#x7ED3;&#x6784;&#x4E2D; <code>{}</code> &#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x95ED;&#x5305;&#x3002;</p>
<p>&#x5728; Kotlin &#x4E2D;&#x6709;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x8BED;&#x6CD5;&#x7CD6;&#xFF1A;&#x5F53;&#x51FD;&#x6570;&#x7684;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x662F; lambda &#x8868;&#x8FBE;&#x5F0F;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x5C06; lambda &#x5199;&#x5728;&#x62EC;&#x53F7;&#x5916;&#x3002;&#x8FD9;&#x5C31;&#x662F;&#x5B83;&#x7684;&#x95ED;&#x5305;&#x539F;&#x5219;&#x3002;</p>
<p>&#x5728;&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x7C7B;&#x578B;&#x4E3A; <code>Runnable</code> &#x7684;&#x53C2;&#x6570;&#xFF0C;&#x800C; <code>Runnable</code> &#x662F;&#x4E00;&#x4E2A;&#x63A5;&#x53E3;&#xFF0C;&#x4E14;&#x53EA;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E2A;&#x51FD;&#x6570; <code>run</code>&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x6EE1;&#x8DB3;&#x4E86; Kotlin &#x7684; <a href="/external_links/4ae6be8b119b736287a533d0306088db.html" target="blank" rel="noopener">SAM</a>&#xFF0C;&#x53EF;&#x4EE5;&#x8F6C;&#x6362;&#x6210;&#x4F20;&#x9012;&#x4E00;&#x4E2A; lambda &#x8868;&#x8FBE;&#x5F0F;&#xFF08;&#x7B2C;&#x4E8C;&#x6BB5;&#xFF09;&#xFF0C;&#x56E0;&#x4E3A;&#x662F;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x6839;&#x636E;&#x95ED;&#x5305;&#x539F;&#x5219;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5199;&#x6210; <code>Thread {...}</code>&#xFF08;&#x7B2C;&#x4E09;&#x6BB5;&#xFF09; &#x7684;&#x5F62;&#x5F0F;&#x3002;</p>
<p>&#x5BF9;&#x4E8E;&#x4E0A;&#x6587;&#x6240;&#x4F7F;&#x7528;&#x7684; <code>launch</code> &#x51FD;&#x6570;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x95ED;&#x5305;&#x6765;&#x8FDB;&#x884C;&#x7B80;&#x5316; &#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">launch {</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="&#x57FA;&#x672C;&#x4F7F;&#x7528;"><a href="#&#x57FA;&#x672C;&#x4F7F;&#x7528;" class="headerlink" title="&#x57FA;&#x672C;&#x4F7F;&#x7528;"></a>&#x57FA;&#x672C;&#x4F7F;&#x7528;</h4><p>&#x524D;&#x9762;&#x63D0;&#x5230;&#xFF0C;<code>launch</code> &#x51FD;&#x6570;&#x4E0D;&#x662F;&#x9876;&#x5C42;&#x51FD;&#x6570;&#xFF0C;&#x662F;&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x7528;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4E0B;&#x9762;&#x4E09;&#x79CD;&#x65B9;&#x6CD5;&#x6765;&#x521B;&#x5EFA;&#x534F;&#x7A0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">// &#x65B9;&#x6CD5;&#x4E00;&#xFF0C;&#x4F7F;&#x7528; runBlocking &#x9876;&#x5C42;&#x51FD;&#x6570;</span><br><span class="line">runBlocking {</span><br><span class="line">    getImage(imageId)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// &#x65B9;&#x6CD5;&#x4E8C;&#xFF0C;&#x4F7F;&#x7528; GlobalScope &#x5355;&#x4F8B;&#x5BF9;&#x8C61;</span><br><span class="line">//            &#x1F447; &#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8C03;&#x7528; launch &#x5F00;&#x542F;&#x534F;&#x7A0B;</span><br><span class="line">GlobalScope.launch {</span><br><span class="line">    getImage(imageId)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// &#x65B9;&#x6CD5;&#x4E09;&#xFF0C;&#x81EA;&#x884C;&#x901A;&#x8FC7; CoroutineContext &#x521B;&#x5EFA;&#x4E00;&#x4E2A; CoroutineScope &#x5BF9;&#x8C61;</span><br><span class="line">//                                    &#x1F447; &#x9700;&#x8981;&#x4E00;&#x4E2A;&#x7C7B;&#x578B;&#x4E3A; CoroutineContext &#x7684;&#x53C2;&#x6570;</span><br><span class="line">val coroutineScope = CoroutineScope(context)</span><br><span class="line">coroutineScope.launch {</span><br><span class="line">    getImage(imageId)</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<ul>
<li>&#x65B9;&#x6CD5;&#x4E00;&#x901A;&#x5E38;&#x9002;&#x7528;&#x4E8E;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x7684;&#x573A;&#x666F;&#xFF0C;&#x800C;&#x4E1A;&#x52A1;&#x5F00;&#x53D1;&#x4E2D;&#x4E0D;&#x4F1A;&#x7528;&#x5230;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x662F;&#x7EBF;&#x7A0B;&#x963B;&#x585E;&#x7684;&#x3002;</li>
<li>&#x65B9;&#x6CD5;&#x4E8C;&#x548C;&#x4F7F;&#x7528; <code>runBlocking</code> &#x7684;&#x533A;&#x522B;&#x5728;&#x4E8E;&#x4E0D;&#x4F1A;&#x963B;&#x585E;&#x7EBF;&#x7A0B;&#x3002;&#x4F46;&#x5728; Android &#x5F00;&#x53D1;&#x4E2D;&#x540C;&#x6837;&#x4E0D;&#x63A8;&#x8350;&#x8FD9;&#x79CD;&#x7528;&#x6CD5;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x4F1A;&#x548C; app &#x4E00;&#x81F4;&#xFF0C;&#x4E14;&#x4E0D;&#x80FD;&#x53D6;&#x6D88;&#xFF08;&#x4EC0;&#x4E48;&#x662F;&#x534F;&#x7A0B;&#x7684;&#x53D6;&#x6D88;&#x540E;&#x9762;&#x7684;&#x6587;&#x7AE0;&#x4F1A;&#x8BB2;&#xFF09;&#x3002;</li>
<li>&#x65B9;&#x6CD5;&#x4E09;&#x662F;&#x6BD4;&#x8F83;&#x63A8;&#x8350;&#x7684;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>context</code> &#x53C2;&#x6570;&#x53BB;&#x7BA1;&#x7406;&#x548C;&#x63A7;&#x5236;&#x534F;&#x7A0B;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#xFF08;&#x8FD9;&#x91CC;&#x7684; <code>context</code> &#x548C; Android &#x91CC;&#x7684;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x4E1C;&#x897F;&#xFF0C;&#x662F;&#x4E00;&#x4E2A;&#x66F4;&#x901A;&#x7528;&#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x4F1A;&#x6709;&#x4E00;&#x4E2A; Android &#x5E73;&#x53F0;&#x7684;&#x5C01;&#x88C5;&#x6765;&#x914D;&#x5408;&#x4F7F;&#x7528;&#xFF09;&#x3002;</li>
</ul>
<p>&#x5173;&#x4E8E; <code>CoroutineScope</code> &#x548C; <code>CoroutineContext</code> &#x7684;&#x66F4;&#x591A;&#x5185;&#x5BB9;&#x540E;&#x9762;&#x7684;&#x6587;&#x7AE0;&#x518D;&#x8BB2;&#x3002;</p>
<p>&#x534F;&#x7A0B;&#x6700;&#x5E38;&#x7528;&#x7684;&#x529F;&#x80FD;&#x662F;&#x5E76;&#x53D1;&#xFF0C;&#x800C;&#x5E76;&#x53D1;&#x7684;&#x5178;&#x578B;&#x573A;&#x666F;&#x5C31;&#x662F;&#x591A;&#x7EBF;&#x7A0B;&#x3002;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>Dispatchers.IO</code> &#x53C2;&#x6570;&#x628A;&#x4EFB;&#x52A1;&#x5207;&#x5230; IO &#x7EBF;&#x7A0B;&#x6267;&#x884C;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">coroutineScope.launch(Dispatchers.IO) {</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>Dispatchers.Main</code> &#x53C2;&#x6570;&#x5207;&#x6362;&#x5230;&#x4E3B;&#x7EBF;&#x7A0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">coroutineScope.launch(Dispatchers.Main) {</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x6240;&#x4EE5;&#x5728;&#x300C;&#x534F;&#x7A0B;&#x662F;&#x4EC0;&#x4E48;&#x300D;&#x4E00;&#x8282;&#x4E2D;&#x8BB2;&#x5230;&#x7684;&#x5F02;&#x6B65;&#x8BF7;&#x6C42;&#x7684;&#x4F8B;&#x5B50;&#x5B8C;&#x6574;&#x5199;&#x51FA;&#x6765;&#x662F;&#x8FD9;&#x6837;&#x7684;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">coroutineScope.launch(Dispatchers.Main) {   // &#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x5F00;&#x542F;&#x534F;&#x7A0B;</span><br><span class="line">    val user = api.getUser() // IO &#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;</span><br><span class="line">    nameTv.text = user.name  // &#x4E3B;&#x7EBF;&#x7A0B;&#x66F4;&#x65B0; UI</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x800C;&#x901A;&#x8FC7; Java &#x5B9E;&#x73B0;&#x4EE5;&#x4E0A;&#x903B;&#x8F91;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x5E38;&#x9700;&#x8981;&#x8FD9;&#x6837;&#x5199;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;&#x2615;&#xFE0F;</span><br><span class="line">api.getUser(new Callback&lt;User&gt;() {</span><br><span class="line">    @Override</span><br><span class="line">    public void success(User user) {</span><br><span class="line">        runOnUiThread(new Runnable() {</span><br><span class="line">            @Override</span><br><span class="line">            public void run() {</span><br><span class="line">                nameTv.setText(user.name);</span><br><span class="line">            }</span><br><span class="line">        })</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public void failure(Exception e) {</span><br><span class="line">        ...</span><br><span class="line">    }</span><br><span class="line">});</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x79CD;&#x56DE;&#x8C03;&#x5F0F;&#x7684;&#x5199;&#x6CD5;&#xFF0C;&#x6253;&#x7834;&#x4E86;&#x4EE3;&#x7801;&#x7684;&#x987A;&#x5E8F;&#x7ED3;&#x6784;&#x548C;&#x5B8C;&#x6574;&#x6027;&#xFF0C;&#x8BFB;&#x8D77;&#x6765;&#x76F8;&#x5F53;&#x96BE;&#x53D7;&#x3002;</p>
<h4 id="&#x534F;&#x7A0B;&#x7684;&#x300C;1-&#x5230;-0&#x300D;"><a href="#&#x534F;&#x7A0B;&#x7684;&#x300C;1-&#x5230;-0&#x300D;" class="headerlink" title="&#x534F;&#x7A0B;&#x7684;&#x300C;1 &#x5230; 0&#x300D;"></a>&#x534F;&#x7A0B;&#x7684;&#x300C;1 &#x5230; 0&#x300D;</h4><p>&#x5BF9;&#x4E8E;&#x56DE;&#x8C03;&#x5F0F;&#x7684;&#x5199;&#x6CD5;&#xFF0C;&#x5982;&#x679C;&#x5E76;&#x53D1;&#x573A;&#x666F;&#x518D;&#x590D;&#x6742;&#x4E00;&#x4E9B;&#xFF0C;&#x4EE3;&#x7801;&#x7684;&#x5D4C;&#x5957;&#x53EF;&#x80FD;&#x4F1A;&#x66F4;&#x591A;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#x7EF4;&#x62A4;&#x8D77;&#x6765;&#x5C31;&#x975E;&#x5E38;&#x9EBB;&#x70E6;&#x3002;&#x4F46;&#x5982;&#x679C;&#x4F60;&#x4F7F;&#x7528;&#x4E86; Kotlin &#x534F;&#x7A0B;&#xFF0C;&#x591A;&#x5C42;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x53EA;&#x9700;&#x8981;&#x8FD9;&#x4E48;&#x5199;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">coroutineScope.launch(Dispatchers.Main) {       // &#x5F00;&#x59CB;&#x534F;&#x7A0B;&#xFF1A;&#x4E3B;&#x7EBF;&#x7A0B;</span><br><span class="line">    val token = api.getToken()                  // &#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#xFF1A;IO &#x7EBF;&#x7A0B;</span><br><span class="line">    val user = api.getUser(token)               // &#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#xFF1A;IO &#x7EBF;&#x7A0B;</span><br><span class="line">    nameTv.text = user.name                     // &#x66F4;&#x65B0; UI&#xFF1A;&#x4E3B;&#x7EBF;&#x7A0B;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5982;&#x679C;&#x9047;&#x5230;&#x7684;&#x573A;&#x666F;&#x662F;&#x591A;&#x4E2A;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x9700;&#x8981;&#x7B49;&#x5F85;&#x6240;&#x6709;&#x8BF7;&#x6C42;&#x7ED3;&#x675F;&#x4E4B;&#x540E;&#x518D;&#x5BF9; UI &#x8FDB;&#x884C;&#x66F4;&#x65B0;&#x3002;&#x6BD4;&#x5982;&#x4EE5;&#x4E0B;&#x4E24;&#x4E2A;&#x8BF7;&#x6C42;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">api.getAvatar(user, callback)</span><br><span class="line">api.getCompanyLogo(user, callback)</span><br></pre></td></tr></table></figure>

<p>&#x5982;&#x679C;&#x4F7F;&#x7528;&#x56DE;&#x8C03;&#x5F0F;&#x7684;&#x5199;&#x6CD5;&#xFF0C;&#x90A3;&#x4E48;&#x4EE3;&#x7801;&#x53EF;&#x80FD;&#x5199;&#x8D77;&#x6765;&#x65E2;&#x56F0;&#x96BE;&#x53C8;&#x522B;&#x626D;&#x3002;&#x4E8E;&#x662F;&#x6211;&#x4EEC;&#x53EF;&#x80FD;&#x4F1A;&#x9009;&#x62E9;&#x59A5;&#x534F;&#xFF0C;&#x901A;&#x8FC7;&#x5148;&#x540E;&#x8BF7;&#x6C42;&#x4EE3;&#x66FF;&#x540C;&#x65F6;&#x8BF7;&#x6C42;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">api.getAvatar(user) { avatar -&gt;</span><br><span class="line">    api.getCompanyLogo(user) { logo -&gt;</span><br><span class="line">        show(merge(avatar, logo))</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5728;&#x5B9E;&#x9645;&#x5F00;&#x53D1;&#x4E2D;&#x5982;&#x679C;&#x8FD9;&#x6837;&#x5199;&#xFF0C;&#x672C;&#x6765;&#x80FD;&#x591F;&#x5E76;&#x884C;&#x5904;&#x7406;&#x7684;&#x8BF7;&#x6C42;&#x88AB;&#x5F3A;&#x5236;&#x901A;&#x8FC7;&#x4E32;&#x884C;&#x7684;&#x65B9;&#x5F0F;&#x53BB;&#x5B9E;&#x73B0;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x5BFC;&#x81F4;&#x7B49;&#x5F85;&#x65F6;&#x95F4;&#x957F;&#x4E86;&#x4E00;&#x500D;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6027;&#x80FD;&#x5DEE;&#x4E86;&#x4E00;&#x500D;&#x3002;</p>
<p>&#x800C;&#x5982;&#x679C;&#x4F7F;&#x7528;&#x534F;&#x7A0B;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x628A;&#x4E24;&#x4E2A;&#x5E76;&#x884C;&#x8BF7;&#x6C42;&#x5199;&#x6210;&#x4E0A;&#x4E0B;&#x4E24;&#x884C;&#xFF0C;&#x6700;&#x540E;&#x518D;&#x628A;&#x7ED3;&#x679C;&#x8FDB;&#x884C;&#x5408;&#x5E76;&#x5373;&#x53EF;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">coroutineScope.launch(Dispatchers.Main) {</span><br><span class="line">    //            &#x1F447;  async &#x51FD;&#x6570;&#x4E4B;&#x540E;&#x518D;&#x8BB2;</span><br><span class="line">    val avatar = async { api.getAvatar(user) }    // &#x83B7;&#x53D6;&#x7528;&#x6237;&#x5934;&#x50CF;</span><br><span class="line">    val logo = async { api.getCompanyLogo(user) } // &#x83B7;&#x53D6;&#x7528;&#x6237;&#x6240;&#x5728;&#x516C;&#x53F8;&#x7684; logo</span><br><span class="line">    val merged = suspendingMerge(avatar, logo)    // &#x5408;&#x5E76;&#x7ED3;&#x679C;</span><br><span class="line">    //                  &#x1F446;</span><br><span class="line">    show(merged) // &#x66F4;&#x65B0; UI</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x5373;&#x4FBF;&#x662F;&#x6BD4;&#x8F83;&#x590D;&#x6742;&#x7684;&#x5E76;&#x884C;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#xFF0C;&#x4E5F;&#x80FD;&#x591F;&#x901A;&#x8FC7;&#x534F;&#x7A0B;&#x5199;&#x51FA;&#x7ED3;&#x6784;&#x6E05;&#x6670;&#x7684;&#x4EE3;&#x7801;&#x3002;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F; <code>suspendingMerge</code> &#x5E76;&#x4E0D;&#x662F;&#x534F;&#x7A0B; API &#x4E2D;&#x63D0;&#x4F9B;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x800C;&#x662F;&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x4E00;&#x4E2A;&#x53EF;&#x300C;&#x6302;&#x8D77;&#x300D;&#x7684;&#x7ED3;&#x679C;&#x5408;&#x5E76;&#x65B9;&#x6CD5;&#x3002;&#x81F3;&#x4E8E;&#x6302;&#x8D77;&#x5177;&#x4F53;&#x662F;&#x4EC0;&#x4E48;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x4E0B;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;&#x3002;</p>
<p>&#x8BA9;&#x590D;&#x6742;&#x7684;&#x5E76;&#x53D1;&#x4EE3;&#x7801;&#xFF0C;&#x5199;&#x8D77;&#x6765;&#x53D8;&#x5F97;&#x7B80;&#x5355;&#x4E14;&#x6E05;&#x6670;&#xFF0C;&#x662F;&#x534F;&#x7A0B;&#x7684;&#x4F18;&#x52BF;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#xFF0C;&#x4E24;&#x4E2A;&#x6CA1;&#x6709;&#x76F8;&#x5173;&#x6027;&#x7684;&#x540E;&#x53F0;&#x4EFB;&#x52A1;&#xFF0C;&#x56E0;&#x4E3A;&#x7528;&#x4E86;&#x534F;&#x7A0B;&#xFF0C;&#x88AB;&#x5B89;&#x6392;&#x5F97;&#x660E;&#x660E;&#x767D;&#x767D;&#xFF0C;&#x4E92;&#x76F8;&#x4E4B;&#x95F4;&#x914D;&#x5408;&#x5F97;&#x5F88;&#x597D;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x4E4B;&#x524D;&#x8BF4;&#x7684;&#x300C;&#x534F;&#x4F5C;&#x5F0F;&#x4EFB;&#x52A1;&#x300D;&#x3002;</p>
<p>&#x672C;&#x6765;&#x9700;&#x8981;&#x56DE;&#x8C03;&#xFF0C;&#x73B0;&#x5728;&#x76F4;&#x63A5;&#x6CA1;&#x6709;&#x56DE;&#x8C03;&#x4E86;&#xFF0C;&#x8FD9;&#x79CD;&#x4ECE; 1 &#x5230; 0 &#x7684;&#x8BBE;&#x8BA1;&#x601D;&#x60F3;&#x771F;&#x7684;&#x5999;&#x54C9;&#x3002;</p>
<p>&#x5728;&#x4E86;&#x89E3;&#x4E86;&#x534F;&#x7A0B;&#x7684;&#x4F5C;&#x7528;&#x548C;&#x4F18;&#x52BF;&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;&#x770B;&#x534F;&#x7A0B;&#x662F;&#x600E;&#x4E48;&#x4F7F;&#x7528;&#x7684;&#x3002;</p>
<h3 id="&#x534F;&#x7A0B;&#x600E;&#x4E48;&#x7528;"><a href="#&#x534F;&#x7A0B;&#x600E;&#x4E48;&#x7528;" class="headerlink" title="&#x534F;&#x7A0B;&#x600E;&#x4E48;&#x7528;"></a>&#x534F;&#x7A0B;&#x600E;&#x4E48;&#x7528;</h3><h4 id="&#x5728;&#x9879;&#x76EE;&#x4E2D;&#x914D;&#x7F6E;&#x5BF9;-Kotlin-&#x534F;&#x7A0B;&#x7684;&#x652F;&#x6301;"><a href="#&#x5728;&#x9879;&#x76EE;&#x4E2D;&#x914D;&#x7F6E;&#x5BF9;-Kotlin-&#x534F;&#x7A0B;&#x7684;&#x652F;&#x6301;" class="headerlink" title="&#x5728;&#x9879;&#x76EE;&#x4E2D;&#x914D;&#x7F6E;&#x5BF9; Kotlin &#x534F;&#x7A0B;&#x7684;&#x652F;&#x6301;"></a>&#x5728;&#x9879;&#x76EE;&#x4E2D;&#x914D;&#x7F6E;&#x5BF9; Kotlin &#x534F;&#x7A0B;&#x7684;&#x652F;&#x6301;</h4><p>&#x5728;&#x4F7F;&#x7528;&#x534F;&#x7A0B;&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5728; <code>build.gradle</code> &#x6587;&#x4EF6;&#x4E2D;&#x589E;&#x52A0;&#x5BF9; Kotlin &#x534F;&#x7A0B;&#x7684;&#x4F9D;&#x8D56;&#xFF1A;</p>
<ul>
<li>&#x9879;&#x76EE;&#x6839;&#x76EE;&#x5F55;&#x4E0B;&#x7684; <code>build.gradle</code> :</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">groovy&#x590D;&#x5236;&#x4EE3;&#x7801;buildscript {</span><br><span class="line">    ...</span><br><span class="line">    // &#x1F447;</span><br><span class="line">    ext.kotlin_coroutines = &apos;1.3.1&apos;</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<ul>
<li>Module &#x4E0B;&#x7684; <code>build.gradle</code> :</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">groovy&#x590D;&#x5236;&#x4EE3;&#x7801;dependencies {</span><br><span class="line">    ...</span><br><span class="line">    //                                       &#x1F447; &#x4F9D;&#x8D56;&#x534F;&#x7A0B;&#x6838;&#x5FC3;&#x5E93;</span><br><span class="line">    implementation &quot;org.jetbrains.kotlinx:kotlinx-coroutines-core:$kotlin_coroutines&quot;</span><br><span class="line">    //                                       &#x1F447; &#x4F9D;&#x8D56;&#x5F53;&#x524D;&#x5E73;&#x53F0;&#x6240;&#x5BF9;&#x5E94;&#x7684;&#x5E73;&#x53F0;&#x5E93;</span><br><span class="line">    implementation &quot;org.jetbrains.kotlinx:kotlinx-coroutines-android:$kotlin_coroutines&quot;</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>Kotlin &#x534F;&#x7A0B;&#x662F;&#x4EE5;&#x5B98;&#x65B9;&#x6269;&#x5C55;&#x5E93;&#x7684;&#x5F62;&#x5F0F;&#x8FDB;&#x884C;&#x652F;&#x6301;&#x7684;&#x3002;&#x800C;&#x4E14;&#xFF0C;&#x6211;&#x4EEC;&#x6240;&#x4F7F;&#x7528;&#x7684;&#x300C;&#x6838;&#x5FC3;&#x5E93;&#x300D;&#x548C; &#x300C;&#x5E73;&#x53F0;&#x5E93;&#x300D;&#x7684;&#x7248;&#x672C;&#x5E94;&#x8BE5;&#x4FDD;&#x6301;&#x4E00;&#x81F4;&#x3002;</p>
<ul>
<li>&#x6838;&#x5FC3;&#x5E93;&#x4E2D;&#x5305;&#x542B;&#x7684;&#x4EE3;&#x7801;&#x4E3B;&#x8981;&#x662F;&#x534F;&#x7A0B;&#x7684;&#x516C;&#x5171; API &#x90E8;&#x5206;&#x3002;&#x6709;&#x4E86;&#x8FD9;&#x4E00;&#x5C42;&#x516C;&#x5171;&#x4EE3;&#x7801;&#xFF0C;&#x624D;&#x4F7F;&#x5F97;&#x534F;&#x7A0B;&#x5728;&#x5404;&#x4E2A;&#x5E73;&#x53F0;&#x4E0A;&#x7684;&#x63A5;&#x53E3;&#x5F97;&#x5230;&#x7EDF;&#x4E00;&#x3002;</li>
<li>&#x5E73;&#x53F0;&#x5E93;&#x4E2D;&#x5305;&#x542B;&#x7684;&#x4EE3;&#x7801;&#x4E3B;&#x8981;&#x662F;&#x534F;&#x7A0B;&#x6846;&#x67B6;&#x5728;&#x5177;&#x4F53;&#x5E73;&#x53F0;&#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#x3002;&#x56E0;&#x4E3A;&#x591A;&#x7EBF;&#x7A0B;&#x5728;&#x5404;&#x4E2A;&#x5E73;&#x53F0;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#x662F;&#x6709;&#x6240;&#x5DEE;&#x5F02;&#x7684;&#x3002;</li>
</ul>
<p>&#x5B8C;&#x6210;&#x4E86;&#x4EE5;&#x4E0A;&#x7684;&#x51C6;&#x5907;&#x5DE5;&#x4F5C;&#x5C31;&#x53EF;&#x4EE5;&#x5F00;&#x59CB;&#x4F7F;&#x7528;&#x534F;&#x7A0B;&#x4E86;&#x3002;</p>
<h4 id="&#x5F00;&#x59CB;&#x4F7F;&#x7528;&#x534F;&#x7A0B;"><a href="#&#x5F00;&#x59CB;&#x4F7F;&#x7528;&#x534F;&#x7A0B;" class="headerlink" title="&#x5F00;&#x59CB;&#x4F7F;&#x7528;&#x534F;&#x7A0B;"></a>&#x5F00;&#x59CB;&#x4F7F;&#x7528;&#x534F;&#x7A0B;</h4><p>&#x534F;&#x7A0B;&#x6700;&#x7B80;&#x5355;&#x7684;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#xFF0C;&#x5176;&#x5B9E;&#x5728;&#x524D;&#x9762;&#x7AE0;&#x8282;&#x5C31;&#x5DF2;&#x7ECF;&#x770B;&#x5230;&#x4E86;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E00;&#x4E2A; <code>launch</code> &#x51FD;&#x6570;&#x5B9E;&#x73B0;&#x7EBF;&#x7A0B;&#x5207;&#x6362;&#x7684;&#x529F;&#x80FD;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">//               &#x1F447;</span><br><span class="line">coroutineScope.launch(Dispatchers.IO) {</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x4E2A; <code>launch</code> &#x51FD;&#x6570;&#xFF0C;&#x5B83;&#x5177;&#x4F53;&#x7684;&#x542B;&#x4E49;&#x662F;&#xFF1A;&#x6211;&#x8981;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x534F;&#x7A0B;&#xFF0C;&#x5E76;&#x5728;&#x6307;&#x5B9A;&#x7684;&#x7EBF;&#x7A0B;&#x4E0A;&#x8FD0;&#x884C;&#x5B83;&#x3002;&#x8FD9;&#x4E2A;&#x88AB;&#x521B;&#x5EFA;&#x3001;&#x88AB;&#x8FD0;&#x884C;&#x7684;&#x6240;&#x8C13;&#x300C;&#x534F;&#x7A0B;&#x300D;&#x662F;&#x8C01;&#xFF1F;&#x5C31;&#x662F;&#x4F60;&#x4F20;&#x7ED9; <code>launch</code> &#x7684;&#x90A3;&#x4E9B;&#x4EE3;&#x7801;&#xFF0C;&#x8FD9;&#x4E00;&#x6BB5;&#x8FDE;&#x7EED;&#x4EE3;&#x7801;&#x53EB;&#x505A;&#x4E00;&#x4E2A;&#x300C;&#x534F;&#x7A0B;&#x300D;&#x3002;</p>
<p>&#x6240;&#x4EE5;&#xFF0C;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x7528;&#x534F;&#x7A0B;&#xFF1F;&#x5F53;&#x4F60;&#x9700;&#x8981;&#x5207;&#x7EBF;&#x7A0B;&#x6216;&#x8005;&#x6307;&#x5B9A;&#x7EBF;&#x7A0B;&#x7684;&#x65F6;&#x5019;&#x3002;&#x4F60;&#x8981;&#x5728;&#x540E;&#x53F0;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#xFF1F;&#x5207;&#xFF01;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">launch(Dispatchers.IO) {</span><br><span class="line">    val image = getImage(imageId)</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x7136;&#x540E;&#x9700;&#x8981;&#x5728;&#x524D;&#x53F0;&#x66F4;&#x65B0;&#x754C;&#x9762;&#xFF1F;&#x518D;&#x5207;&#xFF01;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">coroutineScope.launch(Dispatchers.IO) {</span><br><span class="line">    val image = getImage(imageId)</span><br><span class="line">    launch(Dispatch.Main) {</span><br><span class="line">        avatarIv.setImageBitmap(image)</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x597D;&#x50CF;&#x6709;&#x70B9;&#x4E0D;&#x5BF9;&#x52B2;&#xFF1F;&#x8FD9;&#x4E0D;&#x8FD8;&#x662F;&#x6709;&#x5D4C;&#x5957;&#x561B;&#x3002;</p>
<p>&#x5982;&#x679C;&#x53EA;&#x662F;&#x4F7F;&#x7528; <code>launch</code> &#x51FD;&#x6570;&#xFF0C;&#x534F;&#x7A0B;&#x5E76;&#x4E0D;&#x80FD;&#x6BD4;&#x7EBF;&#x7A0B;&#x505A;&#x66F4;&#x591A;&#x7684;&#x4E8B;&#x3002;&#x4E0D;&#x8FC7;&#x534F;&#x7A0B;&#x4E2D;&#x5374;&#x6709;&#x4E00;&#x4E2A;&#x5F88;&#x5B9E;&#x7528;&#x7684;&#x51FD;&#x6570;&#xFF1A;<code>withContext</code> &#x3002;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x53EF;&#x4EE5;&#x5207;&#x6362;&#x5230;&#x6307;&#x5B9A;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x5E76;&#x5728;&#x95ED;&#x5305;&#x5185;&#x7684;&#x903B;&#x8F91;&#x6267;&#x884C;&#x7ED3;&#x675F;&#x4E4B;&#x540E;&#xFF0C;&#x81EA;&#x52A8;&#x628A;&#x7EBF;&#x7A0B;&#x5207;&#x56DE;&#x53BB;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#x3002;&#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x5C06;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x5199;&#x6210;&#x8FD9;&#x6837;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">coroutineScope.launch(Dispatchers.Main) {      // &#x1F448; &#x5728; UI &#x7EBF;&#x7A0B;&#x5F00;&#x59CB;</span><br><span class="line">    val image = withContext(Dispatchers.IO) {  // &#x1F448; &#x5207;&#x6362;&#x5230; IO &#x7EBF;&#x7A0B;&#xFF0C;&#x5E76;&#x5728;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x540E;&#x5207;&#x56DE; UI &#x7EBF;&#x7A0B;</span><br><span class="line">        getImage(imageId)                      // &#x1F448; &#x5C06;&#x4F1A;&#x8FD0;&#x884C;&#x5728; IO &#x7EBF;&#x7A0B;</span><br><span class="line">    }</span><br><span class="line">    avatarIv.setImageBitmap(image)             // &#x1F448; &#x56DE;&#x5230; UI &#x7EBF;&#x7A0B;&#x66F4;&#x65B0; UI</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x79CD;&#x5199;&#x6CD5;&#x770B;&#x4E0A;&#x53BB;&#x597D;&#x50CF;&#x548C;&#x521A;&#x624D;&#x90A3;&#x79CD;&#x533A;&#x522B;&#x4E0D;&#x5927;&#xFF0C;&#x4F46;&#x5982;&#x679C;&#x4F60;&#x9700;&#x8981;&#x9891;&#x7E41;&#x5730;&#x8FDB;&#x884C;&#x7EBF;&#x7A0B;&#x5207;&#x6362;&#xFF0C;&#x8FD9;&#x79CD;&#x5199;&#x6CD5;&#x7684;&#x4F18;&#x52BF;&#x5C31;&#x4F1A;&#x4F53;&#x73B0;&#x51FA;&#x6765;&#x3002;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x4E0B;&#x9762;&#x7684;&#x5BF9;&#x6BD4;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">// &#x7B2C;&#x4E00;&#x79CD;&#x5199;&#x6CD5;</span><br><span class="line">coroutineScope.launch(Dispachers.IO) {</span><br><span class="line">    ...</span><br><span class="line">    launch(Dispachers.Main){</span><br><span class="line">        ...</span><br><span class="line">        launch(Dispachers.IO) {</span><br><span class="line">            ...</span><br><span class="line">            launch(Dispacher.Main) {</span><br><span class="line">                ...</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// &#x901A;&#x8FC7;&#x7B2C;&#x4E8C;&#x79CD;&#x5199;&#x6CD5;&#x6765;&#x5B9E;&#x73B0;&#x76F8;&#x540C;&#x7684;&#x903B;&#x8F91;</span><br><span class="line">coroutineScope.launch(Dispachers.Main) {</span><br><span class="line">    ...</span><br><span class="line">    withContext(Dispachers.IO) {</span><br><span class="line">        ...</span><br><span class="line">    }</span><br><span class="line">    ...</span><br><span class="line">    withContext(Dispachers.IO) {</span><br><span class="line">        ...</span><br><span class="line">    }</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x7531;&#x4E8E;&#x53EF;&#x4EE5;&#x201D;&#x81EA;&#x52A8;&#x5207;&#x56DE;&#x6765;&#x201D;&#xFF0C;&#x6D88;&#x9664;&#x4E86;&#x5E76;&#x53D1;&#x4EE3;&#x7801;&#x5728;&#x534F;&#x4F5C;&#x65F6;&#x7684;&#x5D4C;&#x5957;&#x3002;&#x7531;&#x4E8E;&#x6D88;&#x9664;&#x4E86;&#x5D4C;&#x5957;&#x5173;&#x7CFB;&#xFF0C;&#x6211;&#x4EEC;&#x751A;&#x81F3;&#x53EF;&#x4EE5;&#x628A; <code>withContext</code> &#x653E;&#x8FDB;&#x4E00;&#x4E2A;&#x5355;&#x72EC;&#x7684;&#x51FD;&#x6570;&#x91CC;&#x9762;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">launch(Dispachers.Main) {              // &#x1F448; &#x5728; UI &#x7EBF;&#x7A0B;&#x5F00;&#x59CB;</span><br><span class="line">    val image = getImage(imageId)</span><br><span class="line">    avatarIv.setImageBitmap(image)     // &#x1F448; &#x6267;&#x884C;&#x7ED3;&#x675F;&#x540E;&#xFF0C;&#x81EA;&#x52A8;&#x5207;&#x6362;&#x56DE; UI &#x7EBF;&#x7A0B;</span><br><span class="line">}</span><br><span class="line">//                               &#x1F447;</span><br><span class="line">fun getImage(imageId: Int) = withContext(Dispatchers.IO) {</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x5C31;&#x662F;&#x4E4B;&#x524D;&#x8BF4;&#x7684;&#x300C;&#x7528;&#x540C;&#x6B65;&#x7684;&#x65B9;&#x5F0F;&#x5199;&#x5F02;&#x6B65;&#x7684;&#x4EE3;&#x7801;&#x300D;&#x4E86;&#x3002;</p>
<p>&#x4E0D;&#x8FC7;&#x5982;&#x679C;&#x53EA;&#x662F;&#x8FD9;&#x6837;&#x5199;&#xFF0C;&#x7F16;&#x8BD1;&#x5668;&#x662F;&#x4F1A;&#x62A5;&#x9519;&#x7684;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">fun getImage(imageId: Int) = withContext(Dispatchers.IO) {</span><br><span class="line">    // IDE &#x62A5;&#x9519; Suspend function&apos;withContext&apos; should be called only from a coroutine or another suspend funcion</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x610F;&#x601D;&#x662F;&#x8BF4;&#xFF0C;<code>withContext</code> &#x662F;&#x4E00;&#x4E2A; <code>suspend</code> &#x51FD;&#x6570;&#xFF0C;&#x5B83;&#x9700;&#x8981;&#x5728;&#x534F;&#x7A0B;&#x6216;&#x8005;&#x662F;&#x53E6;&#x4E00;&#x4E2A; <code>suspend</code> &#x51FD;&#x6570;&#x4E2D;&#x8C03;&#x7528;&#x3002;</p>
<h3 id="suspend"><a href="#suspend" class="headerlink" title="suspend"></a>suspend</h3><p><code>suspend</code> &#x662F; Kotlin &#x534F;&#x7A0B;&#x6700;&#x6838;&#x5FC3;&#x7684;&#x5173;&#x952E;&#x5B57;&#xFF0C;&#x51E0;&#x4E4E;&#x6240;&#x6709;&#x4ECB;&#x7ECD; Kotlin &#x534F;&#x7A0B;&#x7684;&#x6587;&#x7AE0;&#x548C;&#x6F14;&#x8BB2;&#x90FD;&#x4F1A;&#x63D0;&#x5230;&#x5B83;&#x3002;&#x5B83;&#x7684;&#x4E2D;&#x6587;&#x610F;&#x601D;&#x662F;&#x300C;&#x6682;&#x505C;&#x300D;&#x6216;&#x8005;&#x300C;&#x53EF;&#x6302;&#x8D77;&#x300D;&#x3002;&#x5982;&#x679C;&#x4F60;&#x53BB;&#x770B;&#x4E00;&#x4E9B;&#x6280;&#x672F;&#x535A;&#x5BA2;&#x6216;&#x5B98;&#x65B9;&#x6587;&#x6863;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5927;&#x6982;&#x53EF;&#x4EE5;&#x4E86;&#x89E3;&#x5230;&#xFF1A;&#x300C;&#x4EE3;&#x7801;&#x6267;&#x884C;&#x5230; <code>suspend</code> &#x51FD;&#x6570;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x300E;&#x6302;&#x8D77;&#x300F;&#xFF0C;&#x5E76;&#x4E14;&#x8FD9;&#x4E2A;&#x300E;&#x6302;&#x8D77;&#x300F;&#x662F;&#x975E;&#x963B;&#x585E;&#x5F0F;&#x7684;&#xFF0C;&#x5B83;&#x4E0D;&#x4F1A;&#x963B;&#x585E;&#x4F60;&#x5F53;&#x524D;&#x7684;&#x7EBF;&#x7A0B;&#x3002;&#x300D;</p>
<p>&#x4E0A;&#x9762;&#x62A5;&#x9519;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x5176;&#x5B9E;&#x53EA;&#x9700;&#x8981;&#x5728;&#x524D;&#x9762;&#x52A0;&#x4E00;&#x4E2A; <code>suspend</code> &#x5C31;&#x80FD;&#x591F;&#x7F16;&#x8BD1;&#x901A;&#x8FC7;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">//&#x1F447;</span><br><span class="line">suspend fun getImage(imageId: Int) = withContext(Dispatchers.IO) {</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x672C;&#x7BC7;&#x6587;&#x7AE0;&#x5230;&#x6B64;&#x7ED3;&#x675F;&#xFF0C;&#x800C; <code>suspend</code> &#x5177;&#x4F53;&#x662F;&#x4EC0;&#x4E48;&#xFF0C;&#x300C;&#x975E;&#x963B;&#x585E;&#x5F0F;&#x300D;&#x53C8;&#x662F;&#x600E;&#x4E48;&#x56DE;&#x4E8B;&#xFF0C;&#x51FD;&#x6570;&#x600E;&#x4E48;&#x88AB;&#x6302;&#x8D77;&#xFF0C;&#x8FD9;&#x4E9B;&#x7591;&#x95EE;&#x7684;&#x7B54;&#x6848;&#xFF0C;&#x5C06;&#x5728;&#x4E0B;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;&#x5168;&#x90E8;&#x63ED;&#x6653;&#x3002;</p>
<h2 id="&#x7EC3;&#x4E60;&#x9898;"><a href="#&#x7EC3;&#x4E60;&#x9898;" class="headerlink" title="&#x7EC3;&#x4E60;&#x9898;"></a>&#x7EC3;&#x4E60;&#x9898;</h2><ol>
<li>&#x5F00;&#x542F;&#x4E00;&#x4E2A;&#x534F;&#x7A0B;&#xFF0C;&#x5E76;&#x5728;&#x534F;&#x7A0B;&#x4E2D;&#x6253;&#x5370;&#x51FA;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x540D;&#x3002;</li>
<li>&#x901A;&#x8FC7;&#x534F;&#x7A0B;&#x4E0B;&#x8F7D;&#x4E00;&#x5F20;&#x7F51;&#x7EDC;&#x56FE;&#x7247;&#x5E76;&#x663E;&#x793A;&#x51FA;&#x6765;&#x3002;</li>
</ol>
<h3 id="&#x4F5C;&#x8005;&#x4ECB;&#x7ECD;"><a href="#&#x4F5C;&#x8005;&#x4ECB;&#x7ECD;" class="headerlink" title="&#x4F5C;&#x8005;&#x4ECB;&#x7ECD;"></a>&#x4F5C;&#x8005;&#x4ECB;&#x7ECD;</h3><h4 id="&#x89C6;&#x9891;&#x4F5C;&#x8005;"><a href="#&#x89C6;&#x9891;&#x4F5C;&#x8005;" class="headerlink" title="&#x89C6;&#x9891;&#x4F5C;&#x8005;"></a>&#x89C6;&#x9891;&#x4F5C;&#x8005;</h4><h5 id="&#x6254;&#x7269;&#x7EBF;&#xFF08;&#x6731;&#x51EF;&#xFF09;"><a href="#&#x6254;&#x7269;&#x7EBF;&#xFF08;&#x6731;&#x51EF;&#xFF09;" class="headerlink" title="&#x6254;&#x7269;&#x7EBF;&#xFF08;&#x6731;&#x51EF;&#xFF09;"></a>&#x6254;&#x7269;&#x7EBF;&#xFF08;&#x6731;&#x51EF;&#xFF09;</h5><ul>
<li>&#x7801;&#x4E0A;&#x5F00;&#x5B66;&#x521B;&#x59CB;&#x4EBA;&#x3001;&#x9879;&#x76EE;&#x7BA1;&#x7406;&#x4EBA;&#x3001;&#x5185;&#x5BB9;&#x6A21;&#x5757;&#x89C4;&#x5212;&#x8005;&#x548C;&#x89C6;&#x9891;&#x5185;&#x5BB9;&#x4F5C;&#x8005;&#x3002;</li>
<li><a href="/external_links/09af547ec83d3d2a77693a8c804380a5.html" target="blank" rel="noopener">Android GDE</a>&#xFF08; Google &#x8BA4;&#x8BC1; Android &#x5F00;&#x53D1;&#x4E13;&#x5BB6;&#xFF09;&#xFF0C;&#x524D; Flipboard Android &#x5DE5;&#x7A0B;&#x5E08;&#x3002;</li>
<li>GitHub &#x5168;&#x7403; Java &#x6392;&#x540D;&#x7B2C; 92 &#x4F4D;&#xFF0C;&#x5728; <a href="/external_links/0c109d3518e06b6e2f098f5e0323a506.html" target="blank" rel="noopener">GitHub</a> &#x4E0A;&#x6709; 6.6k followers &#x548C; 9.9k stars&#x3002;</li>
<li>&#x4E2A;&#x4EBA;&#x7684; Android &#x5F00;&#x6E90;&#x5E93; <a href="/external_links/3624b1fccb05bf165e23d141cd5bf0f8.html" target="blank" rel="noopener">MaterialEditText</a> &#x88AB;&#x5168;&#x7403;&#x591A;&#x4E2A;&#x9879;&#x76EE;&#x5F15;&#x7528;&#xFF0C;&#x5176;&#x4E2D;&#x5305;&#x62EC;&#x5728;&#x5168;&#x7403;&#x62E5;&#x6709; 5 &#x4EBF;&#x7528;&#x6237;&#x7684;&#x65B0;&#x95FB;&#x9605;&#x8BFB;&#x8F6F;&#x4EF6; Flipboard &#x3002;</li>
<li>&#x66FE;&#x591A;&#x6B21;&#x5728; Google Developer Group Beijing &#x7EBF;&#x4E0B;&#x5206;&#x4EAB;&#x4F1A;&#x4E2D;&#x62C5;&#x4EFB; Android &#x90E8;&#x5206;&#x7684;&#x8BB2;&#x5E08;&#x3002;</li>
<li>&#x4E2A;&#x4EBA;&#x6280;&#x672F;&#x6587;&#x7AE0;&#x300A;<a href="/external_links/f8df6755c9c5b31848185f8e608e9d6c.html" target="blank" rel="noopener">&#x7ED9; Android &#x5F00;&#x53D1;&#x8005;&#x7684; RxJava &#x8BE6;&#x89E3;</a>&#x300B;&#x53D1;&#x5E03;&#x540E;&#xFF0C;&#x5728;&#x56FD;&#x5185;&#x591A;&#x4E2A;&#x516C;&#x53F8;&#x548C;&#x56E2;&#x961F;&#x5185;&#x90E8;&#x88AB;&#x8F6C;&#x53D1;&#x5206;&#x4EAB;&#x548C;&#x4F5C;&#x4E3A;&#x56E2;&#x961F;&#x6280;&#x672F;&#x4F1A;&#x8BAE;&#x7684;&#x4E3B;&#x8981;&#x8D44;&#x6599;&#x6765;&#x6E90;&#xFF0C;&#x4EE5;&#x53CA;&#x9006;&#x5411;&#x4F20;&#x64AD;&#x5230;&#x4E86;&#x7F8E;&#x56FD;&#x4E00;&#x4E9B;&#x5982; Google &#x3001; Uber &#x7B49;&#x516C;&#x53F8;&#x7684;&#x90E8;&#x5206;&#x534E;&#x4EBA;&#x56E2;&#x961F;&#x3002;</li>
<li>&#x521B;&#x529E;&#x7684; Android &#x9AD8;&#x7EA7;&#x8FDB;&#x9636;&#x6559;&#x5B66;&#x7F51;&#x7AD9; <a href="/external_links/610bdefe7b4ce81503e9457cd986b5ea.html" target="blank" rel="noopener">HenCoder</a> &#x5728;&#x5168;&#x7403;&#x534E;&#x4EBA; Android &#x5F00;&#x53D1;&#x793E;&#x533A;&#x4EAB;&#x6709;&#x76F8;&#x5F53;&#x7684;&#x5F71;&#x54CD;&#x529B;&#x3002;</li>
<li>&#x4E4B;&#x540E;&#x521B;&#x529E; Android &#x9AD8;&#x7EA7;&#x5F00;&#x53D1;&#x6559;&#x5B66;&#x8BFE;&#x7A0B; <a href="/external_links/cd1ffcee34c8e249d2a89bbef6770416.html" target="blank" rel="noopener">HenCoder Plus</a> &#xFF0C;&#x5B66;&#x5458;&#x904D;&#x5E03;&#x5168;&#x7403;&#xFF0C;&#x6709;&#x6765;&#x81EA;&#x963F;&#x91CC;&#x3001;&#x5934;&#x6761;&#x3001;&#x534E;&#x4E3A;&#x3001;&#x817E;&#x8BAF;&#x7B49;&#x77E5;&#x540D;&#x4E00;&#x7EBF;&#x4E92;&#x8054;&#x7F51;&#x516C;&#x53F8;&#xFF0C;&#x4E5F;&#x6709;&#x6765;&#x81EA;&#x4E2D;&#x56FD;&#x53F0;&#x6E7E;&#x3001;&#x65E5;&#x672C;&#x3001;&#x7F8E;&#x56FD;&#x7B49;&#x5730;&#x533A;&#x7684;&#x8D44;&#x6DF1;&#x8F6F;&#x4EF6;&#x5DE5;&#x7A0B;&#x5E08;&#x3002;</li>
</ul>
<h4 id="&#x6587;&#x7AE0;&#x4F5C;&#x8005;"><a href="#&#x6587;&#x7AE0;&#x4F5C;&#x8005;" class="headerlink" title="&#x6587;&#x7AE0;&#x4F5C;&#x8005;"></a>&#x6587;&#x7AE0;&#x4F5C;&#x8005;</h4><h5 id="LewisLuo&#xFF08;&#x7F57;&#x5B87;&#xFF09;"><a href="#LewisLuo&#xFF08;&#x7F57;&#x5B87;&#xFF09;" class="headerlink" title="LewisLuo&#xFF08;&#x7F57;&#x5B87;&#xFF09;"></a>LewisLuo&#xFF08;&#x7F57;&#x5B87;&#xFF09;</h5><p><a href="/external_links/310cffc8ed9f8538be06186cf5d988ce.html" target="blank" rel="noopener">LewisLuo&#xFF08;&#x7F57;&#x5B87;&#xFF09;</a> &#xFF0C;&#x5373;&#x523B; Android &#x5DE5;&#x7A0B;&#x5E08;&#x3002;2019 &#x5E74;&#x52A0;&#x5165;&#x5373;&#x523B;&#xFF0C;&#x53C2;&#x4E0E;&#x5373;&#x523B;&#x65E5;&#x8BB0;&#x529F;&#x80FD;&#x7684;&#x5F00;&#x53D1;&#x548C;&#x8FED;&#x4EE3;&#x53CA;&#x4E2D;&#x53F0;&#x57FA;&#x7840;&#x5EFA;&#x8BBE;&#x3002;&#x66FE;&#x5C31;&#x804C;&#x4E8E; mobike&#xFF0C;&#x8D1F;&#x8D23;&#x56FD;&#x9645;&#x5316;&#x4E1A;&#x52A1;&#x5F00;&#x53D1;&#x3002;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/c73faa1ed22bd4e348d7d6b17751f942.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903949267386376.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903949267386376.html" itemprop="url">基于LiveData实现事件总线思路和方案</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-20T17:58:44+08:00">
                2019-09-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="&#x524D;&#x8A00;"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00;</h3><p>&#x5F53;&#x524D;&#x5E02;&#x9762;&#x4E0A;, &#x6BD4;&#x8F83;&#x5E38;&#x7528;&#x7684;&#x4E8B;&#x4EF6;&#x603B;&#x7EBF;, &#x4ECD;&#x7136;&#x662F;<code>EventBus</code>&#x548C;<code>RxBus</code>, &#x65E9;&#x671F;&#x6211;&#x66FE;&#x7ECF;&#x5199;&#x8FC7;<a href="/external_links/4d6b381b3d294cc319bd4019ee411b24.html" target="blank" rel="noopener">EventBus&#x6E90;&#x7801;&#x89E3;&#x6790;</a>,&#x8FD9;&#x4E24;&#x4E2A;&#x6846;&#x67B6;&#x4E0D;&#x8BBA;&#x662F;&#x54EA;&#x4E2A;, &#x5F00;&#x53D1;&#x8005;&#x90FD;&#x9700;&#x8981;&#x53BB;&#x8003;&#x8651;&#x751F;&#x547D;&#x5468;&#x671F;&#x7684;&#x5904;&#x7406;.&#x800C;&#x7F8E;&#x56E2;&#x7ED9;&#x51FA;&#x4E86;&#x4E2A;<a href="/external_links/bbc67f52ce19d15c0a5bc510636f2271.html" target="blank" rel="noopener">&#x89E3;&#x51B3;&#x65B9;&#x6848;</a>, &#x901A;&#x8FC7;LiveData&#x6765;&#x5B9E;&#x73B0;&#x81EA;&#x5E26;&#x751F;&#x547D;&#x5468;&#x671F;&#x611F;&#x77E5;&#x80FD;&#x529B;&#x7684;&#x4E8B;&#x4EF6;&#x603B;&#x7EBF;&#x6846;&#x67B6;. &#x672C;&#x7BC7;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x64B8;&#x4E00;&#x4E2A;&#x4E8B;&#x4EF6;&#x603B;&#x7EBF;&#x6846;&#x67B6;.</p>
<h3 id="LiveData&#x7684;&#x539F;&#x7406;"><a href="#LiveData&#x7684;&#x539F;&#x7406;" class="headerlink" title="LiveData&#x7684;&#x539F;&#x7406;"></a>LiveData&#x7684;&#x539F;&#x7406;</h3><p>&#x6211;&#x4EEC;&#x8981;&#x7528;<a href="/external_links/cdecb9702831448d483c07b6aa75d8e4.html" target="blank" rel="noopener"><code>LiveData</code></a>&#x505A;&#x4E8B;&#x4EF6;&#x603B;&#x7EBF;, &#x603B;&#x9700;&#x8981;&#x77E5;&#x9053;&#x5B83;&#x662F;&#x4EC0;&#x4E48;, &#x4E3A;&#x4EC0;&#x4E48;&#x53EF;&#x4EE5;&#x7528;&#x5B83;&#x6765;&#x5B9E;&#x73B0;&#x4E8B;&#x4EF6;&#x603B;&#x7EBF;.</p>
<blockquote>
<p>LiveData&#x53EF;&#x5BF9;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x89C2;&#x6D4B;, &#x5E76;&#x5177;&#x6709;&#x751F;&#x547D;&#x5468;&#x671F;&#x611F;&#x77E5;&#x80FD;&#x529B;, &#x8FD9;&#x5C31;&#x610F;&#x5473;&#x7740;&#x5F53;liveData&#x53EA;&#x4F1A;&#x5728;&#x751F;&#x547D;&#x5468;&#x671F;&#x5904;&#x4E8E;&#x6D3B;&#x8DC3;(inActive)&#x7684;&#x72B6;&#x6001;&#x4E0B;&#x624D;&#x4F1A;&#x53BB;&#x6267;&#x884C;&#x89C2;&#x6D4B;&#x52A8;&#x4F5C;, &#x800C;&#x4ED6;&#x7684;&#x80FD;&#x529B;&#x8D4B;&#x4E88;&#x4E0D;&#x80FD;&#x8131;&#x79BB;LifeCycle&#x7684;&#x8303;&#x56F4;.</p>
</blockquote>
<p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x4E0B;<code>LiveData</code>&#x7684;UML&#x56FE;, &#x4FBF;&#x4E8E;&#x5BF9;&#x4ED6;&#x6709;&#x4E2A;&#x5927;&#x6982;&#x7684;&#x7406;&#x89E3;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/2ed7147535ab250796547a062814eca00265e3b781897b289257c8996f8a203a" alt></p>
<p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;,<code>LiveData</code>&#x5185;&#x7EF4;&#x62A4;&#x7684;<code>mVersion</code>&#x8868;&#x793A;&#x7684;&#x662F;&#x53D1;&#x9001;&#x4FE1;&#x606F;&#x7684;&#x7248;&#x672C;,&#x6BCF;&#x6B21;&#x53D1;&#x9001;&#x4E00;&#x6B21;&#x4FE1;&#x606F;, &#x5B83;&#x90FD;&#x4F1A;+1, &#x800C;<code>ObserverWrapper</code>&#x5185;&#x7EF4;&#x62A4;&#x7684;<code>mLastVersion</code>&#x4E3A;&#x8BA2;&#x9605;&#x89E6;&#x53D1;&#x7684;&#x7248;&#x672C;&#x53F7;, &#x5F53;&#x8BA2;&#x9605;&#x52A8;&#x4F5C;&#x751F;&#x6548;&#x7684;&#x65F6;&#x5019;, &#x5B83;&#x7684;&#x7248;&#x672C;&#x53F7;&#x4F1A;&#x548C;&#x53D1;&#x9001;&#x4FE1;&#x606F;&#x7684;&#x7248;&#x672C;&#x53F7;&#x540C;&#x6B65;.&#x4ED6;&#x4EEC;&#x521D;&#x59CB;&#x503C;&#x90FD;&#x4E3A;-1</p>
<h4 id="&#x8BA2;&#x9605;"><a href="#&#x8BA2;&#x9605;" class="headerlink" title="&#x8BA2;&#x9605;"></a>&#x8BA2;&#x9605;</h4><p><code>LiveData</code>&#x5185;&#x90E8;&#x5B58;&#x5728;&#x4E00;&#x4E2A;<code>mObservers</code>&#x7528;&#x6765;&#x4FDD;&#x5B58;&#x76F8;&#x5173;&#x7ED1;&#x5B9A;&#x7684;&#x6240;&#x6709;&#x89C2;&#x5BDF;&#x8005;, &#x901A;&#x8FC7;<code>LiveData#observe</code>&#x4EE5;&#x53CA;<code>LiveData#oberveForever</code>&#x65B9;&#x6CD5;, &#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x8BA2;&#x9605;&#x52A8;&#x4F5C;.&#x5982;&#x679C;&#x9700;&#x8981;&#x4E0E;&#x751F;&#x547D;&#x5468;&#x671F;&#x7ED1;&#x5B9A;, &#x5219;&#x9700;&#x8981;&#x4F20;&#x5165;<code>LifecycleOwner</code>&#x5BF9;&#x8C61;, &#x5C06;&#x6211;&#x4EEC;&#x7684;LiveData&#x6570;&#x636E;&#x89C2;&#x6D4B;&#x8005;(Observer)&#x5305;&#x88C5;&#x6CE8;&#x518C;&#x5230;&#x751F;&#x547D;&#x5468;&#x671F;&#x7684;&#x89C2;&#x6D4B;&#x8005;&#x4E2D;, &#x5F97;&#x4EE5;&#x63A5;&#x6536;&#x5230;&#x751F;&#x547D;&#x5468;&#x671F;&#x7684;&#x53D8;&#x66F4;, &#x5E76;&#x505A;&#x51FA;&#x53CA;&#x65F6;&#x7684;&#x5BF9;&#x5E94;&#x66F4;&#x65B0;&#x6D3B;&#x52A8;, &#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x4E0B;LiveData&#x7684;&#x8BA2;&#x9605;&#x7684;&#x65B9;&#x6CD5;&#x4EE3;&#x7801;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;@MainThread</span><br><span class="line">   public void observe(@NonNull LifecycleOwner owner, @NonNull Observer&lt;? super T&gt; observer) {</span><br><span class="line">       assertMainThread(&quot;observe&quot;);</span><br><span class="line">       // &#x5F53;&#x524D;&#x7ED1;&#x5B9A;&#x7684;&#x7EC4;&#x4EF6;(activity or fragment)&#x72B6;&#x6001;&#x4E3A;DESTROYED&#x7684;&#x65F6;&#x5019;, &#x5219;&#x4F1A;&#x5FFD;&#x89C6;&#x5F53;&#x524D;&#x7684;&#x8BA2;&#x9605;&#x8BF7;&#x6C42;</span><br><span class="line">       if (owner.getLifecycle().getCurrentState() == DESTROYED) {</span><br><span class="line">           return;</span><br><span class="line">       }</span><br><span class="line">       // &#x8F6C;&#x4E3A;&#x5E26;&#x751F;&#x547D;&#x5468;&#x671F;&#x611F;&#x77E5;&#x7684;&#x89C2;&#x5BDF;&#x8005;&#x5305;&#x88C5;&#x7C7B;</span><br><span class="line">       LifecycleBoundObserver wrapper = new LifecycleBoundObserver(owner, observer);</span><br><span class="line">       ObserverWrapper existing = mObservers.putIfAbsent(observer, wrapper);</span><br><span class="line">       // &#x5BF9;&#x5E94;&#x89C2;&#x5BDF;&#x8005;&#x53EA;&#x80FD;&#x4E0E;&#x4E00;&#x4E2A;owner&#x7ED1;&#x5B9A;</span><br><span class="line">       if (existing != null &amp;&amp; !existing.isAttachedTo(owner)) {</span><br><span class="line">           throw new IllegalArgumentException(&quot;Cannot add the same observer&quot;</span><br><span class="line">                   + &quot; with different lifecycles&quot;);</span><br><span class="line">       }</span><br><span class="line">       if (existing != null) {</span><br><span class="line">           return;</span><br><span class="line">       }</span><br><span class="line">       // lifecycle&#x6CE8;&#x518C;</span><br><span class="line">       owner.getLifecycle().addObserver(wrapper);</span><br><span class="line">   }</span><br></pre></td></tr></table></figure>

<p>&#x9488;&#x5BF9;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x76D1;&#x6D4B;&#x751F;&#x547D;&#x5468;&#x671F;&#x7684;&#x89C2;&#x5BDF;&#x8005;, <code>LiveData</code>&#x5C06;&#x5176;&#x5305;&#x88C5;&#x6210;&#x4E86;<code>LifecycleBoundObserver</code>&#x5BF9;&#x8C61;, &#x5B83;&#x7EE7;&#x627F;&#x4E8E;<code>ObserverWrapper</code>, &#x5E76;&#x6700;&#x7EC8;&#x5B9E;&#x73B0;&#x4E86;<code>GenericLifecycleObserver</code>&#x63A5;&#x53E3;, &#x901A;&#x8FC7;&#x5B9E;&#x73B0;<code>GenericLifecycleObserver#onStateChanged</code>&#x65B9;&#x6CD5;&#x83B7;&#x53D6;&#x5230;&#x751F;&#x547D;&#x5468;&#x671F;&#x72B6;&#x6001;&#x53D8;&#x66F4;&#x4E8B;&#x4EF6;.</p>
<h4 id="&#x53D1;&#x9001;&#x4FE1;&#x606F;"><a href="#&#x53D1;&#x9001;&#x4FE1;&#x606F;" class="headerlink" title="&#x53D1;&#x9001;&#x4FE1;&#x606F;"></a>&#x53D1;&#x9001;&#x4FE1;&#x606F;</h4><p><code>LiveData#setValue</code>&#x548C;<code>LiveData#postValue</code>&#x7684;&#x533A;&#x522B;&#x5728;&#x4E8E;&#x4E00;&#x4E2A;&#x662F;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x53D1;&#x9001;&#x4FE1;&#x606F;, &#x800C;post&#x662F;&#x5728;&#x5B50;&#x7EBF;&#x7A0B;&#x53D1;&#x9001;&#x4FE1;&#x606F;, post&#x6700;&#x7EC8;&#x901A;&#x8FC7;&#x6307;&#x5B9A;&#x4E3B;&#x7EBF;&#x7A0B;&#x7684;Handler&#x6267;&#x884C;&#x8C03;&#x7528;setValue, &#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x4E3B;&#x8981;&#x770B;&#x4E0B;<code>LiveData#setValue</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;@MainThread</span><br><span class="line">    protected void setValue(T value) {</span><br><span class="line">        assertMainThread(&quot;setValue&quot;);</span><br><span class="line">        // &#x53D1;&#x9001;&#x7248;&#x672C;+1</span><br><span class="line">        mVersion++;</span><br><span class="line">        mData = value;</span><br><span class="line">        // &#x4FE1;&#x606F;&#x5206;&#x53D1;</span><br><span class="line">        dispatchingValue(null);</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>&#x5F53;&#x8C03;&#x7528;setValue&#x7684;&#x65F6;&#x5019;, &#x5C31;&#x76F8;&#x5F53;&#x4E8E;&#x662F;<code>LiveData</code>&#x5185;&#x90E8;&#x7EF4;&#x62A4;&#x7684;&#x53EF;&#x89C2;&#x6D4B;&#x6570;&#x636E;&#x53D1;&#x751F;&#x53D8;&#x5316;, &#x5219;&#x76F4;&#x63A5;&#x89E6;&#x53D1;&#x4E8B;&#x4EF6;&#x5206;&#x53D1;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;void dispatchingValue(@Nullable ObserverWrapper initiator) {</span><br><span class="line">        // mDispatchingValue&#x7684;&#x5224;&#x65AD;&#x4E3B;&#x8981;&#x662F;&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x5E76;&#x53D1;&#x8C03;&#x7528;dispatchingValue&#x7684;&#x60C5;&#x51B5;</span><br><span class="line">        // &#x5F53;&#x5BF9;&#x5E94;&#x6570;&#x636E;&#x7684;&#x89C2;&#x5BDF;&#x8005;&#x5728;&#x6267;&#x884C;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;, &#x5982;&#x6709;&#x65B0;&#x7684;&#x6570;&#x636E;&#x53D8;&#x66F4;, &#x5219;&#x4E0D;&#x4F1A;&#x518D;&#x6B21;&#x901A;&#x77E5;&#x5230;&#x89C2;&#x5BDF;&#x8005;</span><br><span class="line">        // &#x6240;&#x4EE5;&#x89C2;&#x5BDF;&#x8005;&#x5185;&#x7684;&#x6267;&#x884C;&#x4E0D;&#x5E94;&#x8FDB;&#x884C;&#x8017;&#x65F6;&#x5DE5;&#x4F5C;</span><br><span class="line">        if (mDispatchingValue) {</span><br><span class="line">            mDispatchInvalidated = true;</span><br><span class="line">            return;</span><br><span class="line">        }</span><br><span class="line">        mDispatchingValue = true;</span><br><span class="line">        do {</span><br><span class="line">            mDispatchInvalidated = false;</span><br><span class="line">            if (initiator != null) {</span><br><span class="line">                considerNotify(initiator);</span><br><span class="line">                initiator = null;</span><br><span class="line">            } else {</span><br><span class="line">                for (Iterator&lt;Map.Entry&lt;Observer&lt;? super T&gt;, ObserverWrapper&gt;&gt; iterator =</span><br><span class="line">                        mObservers.iteratorWithAdditions(); iterator.hasNext(); ) {</span><br><span class="line">                    considerNotify(iterator.next().getValue());</span><br><span class="line">                    if (mDispatchInvalidated) {</span><br><span class="line">                        break;</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        } while (mDispatchInvalidated);</span><br><span class="line">        mDispatchingValue = false;</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>&#x6700;&#x7EC8;, &#x4F1A;&#x8D70;&#x5230;<code>considerNotify</code>&#x65B9;&#x6CD5;, &#x5728;&#x4FDD;&#x8BC1;&#x89C2;&#x5BDF;&#x8005;&#x6D3B;&#x8DC3;, &#x5E76;&#x4E14;&#x4ED6;&#x7684;&#x8BA2;&#x9605;&#x751F;&#x6548;&#x6570;&#x5C0F;&#x4E8E;&#x53D1;&#x9001;&#x6570;&#x7684;&#x60C5;&#x51B5;&#x4E0B;, &#x6700;&#x7EC8;&#x89E6;&#x53D1;&#x5230;&#x6211;&#x4EEC;&#x5B9E;&#x73B0;&#x7684;&#x89C2;&#x5BDF;&#x65B9;&#x6CD5;.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;private void considerNotify(ObserverWrapper observer) {</span><br><span class="line">        if (!observer.mActive) {</span><br><span class="line">            return;</span><br><span class="line">        }</span><br><span class="line">        if (!observer.shouldBeActive()) {</span><br><span class="line">            observer.activeStateChanged(false);</span><br><span class="line">            return;</span><br><span class="line">        }</span><br><span class="line">        if (observer.mLastVersion &gt;= mVersion) {</span><br><span class="line">            return;</span><br><span class="line">        }</span><br><span class="line">        observer.mLastVersion = mVersion;</span><br><span class="line">        //noinspection unchecked</span><br><span class="line">        observer.mObserver.onChanged((T) mData);</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;, <code>LiveData#dispatchingValue</code>&#x9664;&#x4E86;&#x5728;&#x6211;&#x4EEC;&#x4E3B;&#x52A8;&#x66F4;&#x65B0;&#x6570;&#x636E;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x89E6;&#x53D1;, &#x5728;&#x6211;&#x4EEC;&#x7684;&#x89C2;&#x5BDF;&#x8005;&#x72B6;&#x6001;&#x53D8;&#x66F4;(inactive-&gt;active)&#x7684;&#x65F6;&#x5019;, &#x4E5F;&#x4F1A;&#x901A;&#x77E5;&#x5230;, &#x8FD9;&#x5C31;&#x5BFC;&#x81F4;&#x4E86;<code>LiveData</code>&#x5FC5;&#x7136;&#x652F;&#x6301;&#x7C98;&#x6027;&#x4E8B;&#x4EF6;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;class LifecycleBoundObserver extends ObserverWrapper implements GenericLifecycleObserver {</span><br><span class="line">  @Override</span><br><span class="line">       public void onStateChanged(LifecycleOwner source, Lifecycle.Event event) {</span><br><span class="line">           if (mOwner.getLifecycle().getCurrentState() == DESTROYED) {</span><br><span class="line">               removeObserver(mObserver);</span><br><span class="line">               return;</span><br><span class="line">           }</span><br><span class="line">           activeStateChanged(shouldBeActive());</span><br><span class="line">       }</span><br><span class="line">}</span><br><span class="line">private abstract class ObserverWrapper {</span><br><span class="line">  void activeStateChanged(boolean newActive) {</span><br><span class="line">            if (newActive == mActive) {</span><br><span class="line">                return;</span><br><span class="line">            }</span><br><span class="line">            // &#x5F53;observer&#x7684;&#x72B6;&#x6001;&#x4ECE;active-&gt;inactive, &#x6216;&#x8005;inactive-&gt;active&#x7684;&#x65F6;&#x5019;&#x8D70;&#x4EE5;&#x4E0B;&#x6D41;&#x7A0B;</span><br><span class="line">            mActive = newActive;</span><br><span class="line">            boolean wasInactive = LiveData.this.mActiveCount == 0;</span><br><span class="line">            LiveData.this.mActiveCount += mActive ? 1 : -1;</span><br><span class="line">            if (wasInactive &amp;&amp; mActive) {</span><br><span class="line">                onActive();</span><br><span class="line">            }</span><br><span class="line">            if (LiveData.this.mActiveCount == 0 &amp;&amp; !mActive) {</span><br><span class="line">              // &#x5F53;&#x524D;liveData&#x7EF4;&#x62A4;&#x7684;&#x89C2;&#x5BDF;&#x8005;&#x90FD;&#x4E0D;&#x6D3B;&#x8DC3;, &#x5E76;&#x4E14;&#x76EE;&#x524D;&#x7684;&#x89C2;&#x5BDF;&#x8005;&#x4E5F;&#x4ECE;active-&gt;inactive, &#x4F1A;&#x89E6;&#x53D1;onInactive&#x7A7A;&#x65B9;&#x6CD5;</span><br><span class="line">              // &#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8986;&#x5199;onInactive&#x6765;&#x5224;&#x65AD;livedata&#x6240;&#x6709;&#x89C2;&#x5BDF;&#x8005;&#x5931;&#x6548;&#x65F6;&#x5019;&#x7684;&#x60C5;&#x51B5;, &#x6BD4;&#x5982;&#x91CA;&#x653E;&#x6389;&#x4E00;&#x4E9B;&#x5927;&#x5185;&#x5B58;&#x5BF9;&#x8C61;</span><br><span class="line">                onInactive();</span><br><span class="line">            }</span><br><span class="line">            // &#x5F53;observer&#x662F;&#x4ECE;inactive-&gt;active&#x7684;&#x65F6;&#x5019;</span><br><span class="line">            // &#x9700;&#x8981;&#x901A;&#x77E5;&#x5230;&#x89C2;&#x5BDF;&#x8005;</span><br><span class="line">            if (mActive) {</span><br><span class="line">                dispatchingValue(this);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="&#x539F;&#x7406;&#x603B;&#x7ED3;"><a href="#&#x539F;&#x7406;&#x603B;&#x7ED3;" class="headerlink" title="&#x539F;&#x7406;&#x603B;&#x7ED3;"></a>&#x539F;&#x7406;&#x603B;&#x7ED3;</h4><p>&#x6211;&#x4EEC;&#x6982;&#x62EC;&#x4E0B;&#x6765;, &#x5173;&#x4E8E;<code>LiveData</code>&#x53EF;&#x4EE5;&#x4E86;&#x89E3;&#x5982;&#x4E0B;:</p>
<ol>
<li><code>LiveData</code>&#x7684;&#x89C2;&#x5BDF;&#x8005;&#x53EF;&#x4EE5;&#x8054;&#x52A8;&#x751F;&#x547D;&#x5468;&#x671F;, &#x4E5F;&#x53EF;&#x4EE5;&#x4E0D;&#x8054;&#x52A8;</li>
<li><code>LiveData</code>&#x7684;&#x89C2;&#x5BDF;&#x8005;&#x53EA;&#x80FD;&#x4E0E;&#x4E00;&#x4E2A;<code>LifecycleOwner</code>&#x7ED1;&#x5B9A;, &#x5426;&#x5219;&#x4F1A;&#x629B;&#x51FA;&#x5F02;&#x5E38;</li>
<li>&#x5F53;&#x89C2;&#x5BDF;&#x8005;&#x7684;active&#x72B6;&#x6001;&#x53D8;&#x66F4;&#x7684;&#x65F6;&#x5019;</li>
<li>active-&gt;inactive : &#x5982;&#x679C;LiveCycler&#x901A;&#x77E5;OnDestroy, &#x5219;&#x79FB;&#x9664;&#x5BF9;&#x5E94;&#x7684;&#x89C2;&#x5BDF;&#x8005;, &#x5207;&#x5F53;&#x6240;&#x6709;&#x89C2;&#x5BDF;&#x8005;&#x90FD;&#x975E;&#x6D3B;&#x8DC3;&#x7684;&#x72B6;&#x6001;&#x4E0B;&#x65F6;, &#x4F1A;&#x89E6;&#x53D1;onInactive</li>
<li>inactive-&gt;active: &#x4F1A;&#x901A;&#x77E5;&#x89C2;&#x5BDF;&#x8005;&#x6700;&#x8FD1;&#x7684;&#x6570;&#x636E;&#x66F4;&#x65B0;(&#x7C98;&#x6027;&#x6D88;&#x606F;)</li>
<li>&#x9664;&#x4E86;&#x89C2;&#x5BDF;&#x8005;&#x72B6;&#x6001;&#x53D8;&#x66F4;&#x65F6;, &#x4F1A;&#x63A5;&#x6536;&#x5230;&#x6570;&#x636E;&#x66F4;&#x65B0;&#x7684;&#x901A;&#x77E5;&#x5916;, &#x8FD8;&#x6709;&#x4E00;&#x79CD;&#x5C31;&#x662F;&#x5728;&#x6D3B;&#x8DC3;&#x7684;&#x60C5;&#x51B5;&#x4E0B;, &#x901A;&#x8FC7;&#x5F00;&#x53D1;&#x8005;&#x4E3B;&#x52A8;&#x66F4;&#x65B0;&#x6570;&#x636E;, &#x4F1A;&#x63A5;&#x6536;&#x5230;&#x6570;&#x636E;&#x66F4;&#x65B0;&#x7684;&#x901A;&#x77E5;.</li>
</ol>
<h3 id="&#x57FA;&#x4E8E;LiveData&#x7684;&#x4E8B;&#x4EF6;&#x603B;&#x7EBF;&#x7684;&#x5B9E;&#x73B0;"><a href="#&#x57FA;&#x4E8E;LiveData&#x7684;&#x4E8B;&#x4EF6;&#x603B;&#x7EBF;&#x7684;&#x5B9E;&#x73B0;" class="headerlink" title="&#x57FA;&#x4E8E;LiveData&#x7684;&#x4E8B;&#x4EF6;&#x603B;&#x7EBF;&#x7684;&#x5B9E;&#x73B0;"></a>&#x57FA;&#x4E8E;LiveData&#x7684;&#x4E8B;&#x4EF6;&#x603B;&#x7EBF;&#x7684;&#x5B9E;&#x73B0;</h3><p>&#x53EF;&#x4EE5;&#x770B;&#x51FA;, <code>LiveData</code>&#x672C;&#x8EAB;&#x5C31;&#x5DF2;&#x7ECF;&#x53EF;&#x89C2;&#x6D4B;&#x6570;&#x636E;&#x66F4;&#x65B0;, &#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x7EF4;&#x62A4;&#x4E00;&#x5F20;eventName-LiveData&#x7684;&#x54C8;&#x5E0C;&#x8868;, &#x5C31;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x4E00;&#x4E2A;&#x57FA;&#x7840;&#x7684;&#x4E8B;&#x4EF6;&#x603B;&#x7EBF;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;class LiveDataBus {</span><br><span class="line">    internal val liveDatas by lazy { mutableMapOf&lt;String, LiveData&lt;*&gt;&gt;() }</span><br><span class="line"></span><br><span class="line">    @Synchronized</span><br><span class="line">    private fun &lt;T&gt;bus(channel: String): LiveData&lt;T&gt;{</span><br><span class="line">        return liveDatas.getOrPut(channel){</span><br><span class="line">            LiveDataEvent&lt;T&gt;(channel)</span><br><span class="line">        } as LiveData&lt;T&gt;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    fun &lt;T&gt; with(channel: String): LiveData&lt;T&gt;{</span><br><span class="line">        return bus(channel)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    companion object{</span><br><span class="line">        private val INSTANCE by lazy { LiveDataBus() }</span><br><span class="line">        @JvmStatic</span><br><span class="line">        fun get() = INSTANCE</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4F46;&#x662F;&#x9664;&#x4E86;&#x7C98;&#x6027;&#x4E8B;&#x4EF6;&#x4EE5;&#x5916;, &#x6211;&#x4EEC;&#x8FD8;&#x9700;&#x8981;&#x975E;&#x7C98;&#x6027;&#x4E8B;&#x4EF6;&#x7684;&#x652F;&#x6301;, &#x8FD9;&#x91CC;&#x6709;&#x4E24;&#x79CD;&#x505A;&#x6CD5;.</p>
<p>&#x7F8E;&#x56E2;&#x662F;&#x6839;&#x636E;&#x8986;&#x5199;observe&#x65B9;&#x6CD5;, &#x53CD;&#x5C04;&#x83B7;&#x53D6;<code>ObserverWrapper.mLastVersion</code>, &#x5728;&#x8BA2;&#x9605;&#x7684;&#x65F6;&#x5019;&#x4F7F;&#x5F97;&#x521D;&#x59CB;&#x5316;&#x7684;<code>ObserverWrapper.mLastVersion</code>&#x7B49;&#x4E8E;<code>LiveData.mVersion</code>, &#x4F7F;&#x5F97;&#x7C98;&#x6027;&#x6D88;&#x606F;&#x65E0;&#x6CD5;&#x901A;&#x8FC7;&#x5B9E;&#x73B0;(&#x8BE6;&#x7EC6;&#x53EF;&#x4EE5;&#x770B;&#x4E0B;<a href="/external_links/bbc67f52ce19d15c0a5bc510636f2271.html" target="blank" rel="noopener">&#x53C2;&#x8003;1</a>&#x7684;&#x6587;&#x7AE0;&#x5185;&#x5BB9;)</p>
<p>&#x8FD9;&#x91CC;&#x6211;&#x7528;&#x4E86;&#x53E6;&#x5916;&#x4E00;&#x79CD;&#x505A;&#x6CD5;,&#x7C98;&#x6027;&#x6D88;&#x606F;&#x6700;&#x7EC8;&#x4F1A;&#x8C03;&#x5230;<code>Observer#onChanged</code>, &#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x5C31;&#x5E72;&#x8106;&#x5C06;&#x5176;&#x518D;&#x8FDB;&#x884C;&#x4E00;&#x5C42;&#x5305;&#x88C5;, &#x5185;&#x90E8;&#x7EF4;&#x62A4;&#x5B9E;&#x9645;&#x7684;&#x8BA2;&#x9605;&#x6D88;&#x606F;&#x6570;, &#x6765;&#x5224;&#x65AD;&#x662F;&#x5426;&#x8981;&#x89E6;&#x53D1;&#x771F;&#x6B63;&#x7684;<code>onChanged</code>&#x65B9;&#x6CD5;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;internal open class ExternalObserverWrapper&lt;T&gt;(val observer: Observer&lt;in T&gt;, val liveData: ExternalLiveData&lt;T&gt;): Observer&lt;T&gt;{</span><br><span class="line">    // &#x65B0;&#x5EFA;&#x89C2;&#x5BDF;&#x8005;&#x5305;&#x88C5;&#x7C7B;&#x7684;&#x65F6;&#x5019;, &#x5185;&#x90E8;&#x5B9E;&#x9645;&#x7684;version&#x76F4;&#x63A5;&#x7B49;&#x4E8E;LiveData&#x7684;version</span><br><span class="line">    private var mLastVersion = liveData.version</span><br><span class="line">    override fun onChanged(t: T) {</span><br><span class="line">        if(mLastVersion &gt;= liveData.version){</span><br><span class="line">            return</span><br><span class="line">        }</span><br><span class="line">        mLastVersion = liveData.version</span><br><span class="line">        observer.onChanged(t)</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x6211;&#x4EEC;&#x9700;&#x8981;&#x8986;&#x5199;observe&#x65B9;&#x6CD5;, &#x5C06;&#x6211;&#x4EEC;&#x5305;&#x88C5;&#x7684;&#x89C2;&#x5BDF;&#x8005;&#x4F20;&#x8FDB;&#x53BB;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;internal class ExternalLiveData&lt;T&gt;(val key: String) : MutableLiveData&lt;T&gt;(){</span><br><span class="line">    @MainThread</span><br><span class="line">    override fun observe(owner: LifecycleOwner, observer: Observer&lt;in T&gt;) {</span><br><span class="line">        super.observe(owner, ExternalObserverWrapper(observer, this, owner))</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;, LiveData&#x7EF4;&#x62A4;&#x7684;&#x89C2;&#x5BDF;&#x8005;&#x96C6;&#x5408;&#x53D8;&#x4E3A;&#x6211;&#x4EEC;&#x5305;&#x88C5;&#x540E;&#x7684;&#x89C2;&#x5BDF;&#x8005;&#x96C6;&#x5408;&#x540E;, &#x90A3;&#x4E48;&#x5BF9;&#x5E94;&#x7684;&#x79FB;&#x9664;&#x89C2;&#x5BDF;&#x8005;&#x65B9;&#x6CD5;, &#x6211;&#x4EEC;&#x4E5F;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x5305;&#x88C5;&#x4F20;&#x5165;, &#x5E76;&#x4E14;&#x9700;&#x8981;&#x989D;&#x5916;&#x7EF4;&#x62A4;&#x4E00;&#x4EFD;&#x771F;&#x6B63;&#x7684;&#x89C2;&#x5BDF;&#x8005;&#x548C;&#x5305;&#x88C5;&#x540E;&#x7684;&#x89C2;&#x5BDF;&#x8005;&#x7684;&#x5BF9;&#x5E94;hash&#x8868;&#x5BF9;&#x8C61;, &#x5E76;&#x5728;&#x89C2;&#x5BDF;&#x8005;&#x88AB;&#x79FB;&#x9664;&#x7684;&#x65F6;&#x5019;&#x5220;&#x9664;&#x5BF9;&#x5E94;&#x7684;&#x5185;&#x5B58;&#x5BF9;&#x8C61;, &#x9632;&#x6B62;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x7684;&#x4EA7;&#x751F;, &#x6700;&#x7EC8;&#x7684;&#x4EE3;&#x7801;&#x5982;&#x4E0B;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;internal class ExternalLiveData&lt;T&gt;(val key: String) : MutableLiveData&lt;T&gt;(){</span><br><span class="line">    internal var mObservers = mutableMapOf&lt;Observer&lt;in T&gt;, ExternalObserverWrapper&lt;T&gt;&gt;()</span><br><span class="line"></span><br><span class="line">    @MainThread</span><br><span class="line">    override fun observe(owner: LifecycleOwner, observer: Observer&lt;in T&gt;) {</span><br><span class="line">        val exist = mObservers.getOrPut(observer){</span><br><span class="line">            LifecycleExternalObserver(observer, this, owner).apply {</span><br><span class="line">                mObservers[observer] = this</span><br><span class="line">                owner.lifecycle.addObserver(this)</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        super.observe(owner, exist)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @MainThread</span><br><span class="line">    override fun observeForever(observer: Observer&lt;in T&gt;) {</span><br><span class="line">        val exist = mObservers.getOrPut(observer){</span><br><span class="line">            AlwaysExternalObserver(observer, this).apply { mObservers[observer] = this }</span><br><span class="line">        }</span><br><span class="line">        super.observeForever(exist)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @MainThread</span><br><span class="line">    fun observeSticky(owner: LifecycleOwner, observer: Observer&lt;in T&gt;) {</span><br><span class="line">        super.observe(owner, observer)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @MainThread</span><br><span class="line">    fun observeStickyForever(observer: Observer&lt;in T&gt;){</span><br><span class="line">        super.observeForever(observer)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @MainThread</span><br><span class="line">    override fun removeObserver(observer: Observer&lt;in T&gt;) {</span><br><span class="line">        val exist = mObservers.remove(observer) ?: observer</span><br><span class="line">        super.removeObserver(exist)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @MainThread</span><br><span class="line">    override fun removeObservers(owner: LifecycleOwner) {</span><br><span class="line">        mObservers.iterator().forEach { item-&gt;</span><br><span class="line">            if(item.value.isAttachedTo(owner)){</span><br><span class="line">                mObservers.remove(item.key)</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        super.removeObservers(owner)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    override fun onInactive() {</span><br><span class="line">        super.onInactive()</span><br><span class="line">        if(!hasObservers()){</span><br><span class="line">            // &#x5F53;&#x5BF9;&#x5E94;liveData&#x6CA1;&#x6709;&#x76F8;&#x5173;&#x7684;&#x89C2;&#x5BDF;&#x8005;&#x7684;&#x65F6;&#x5019;</span><br><span class="line">            // &#x5C31;&#x53EF;&#x4EE5;&#x79FB;&#x9664;&#x6389;&#x7EF4;&#x62A4;&#x7684;LiveData</span><br><span class="line">            LiveDataBus.get().liveDatas.remove(key)</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">internal open class ExternalObserverWrapper&lt;T&gt;(val observer: Observer&lt;in T&gt;, val liveData: ExternalLiveData&lt;T&gt;): Observer&lt;T&gt;{</span><br><span class="line"></span><br><span class="line">    private var mLastVersion = liveData.version</span><br><span class="line">    override fun onChanged(t: T) {</span><br><span class="line">        if(mLastVersion &gt;= liveData.version){</span><br><span class="line">            return</span><br><span class="line">        }</span><br><span class="line">        mLastVersion = liveData.version</span><br><span class="line">        observer.onChanged(t)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    open fun isAttachedTo(owner: LifecycleOwner) = false</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * always active &#x7684;&#x89C2;&#x5BDF;&#x8005;&#x5305;&#x88C5;&#x7C7B;</span><br><span class="line"> * @param T</span><br><span class="line"> * @constructor</span><br><span class="line"> */</span><br><span class="line">internal class AlwaysExternalObserver&lt;T&gt;(observer: Observer&lt;in T&gt;, liveData: ExternalLiveData&lt;T&gt;):</span><br><span class="line">    ExternalObserverWrapper&lt;T&gt;(observer, liveData)</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * &#x7ED1;&#x5B9A;&#x751F;&#x547D;&#x5468;&#x671F;&#x7684;&#x89C2;&#x5BDF;&#x8005;&#x5305;&#x88C5;&#x7C7B;</span><br><span class="line"> * @param T</span><br><span class="line"> * @property owner LifecycleOwner</span><br><span class="line"> * @constructor</span><br><span class="line"> */</span><br><span class="line">internal class LifecycleExternalObserver&lt;T&gt;(observer: Observer&lt;in T&gt;, liveData: ExternalLiveData&lt;T&gt;, val owner: LifecycleOwner): ExternalObserverWrapper&lt;T&gt;(</span><br><span class="line">    observer,</span><br><span class="line">    liveData</span><br><span class="line">), LifecycleObserver{</span><br><span class="line">    /**</span><br><span class="line">     * &#x5F53;&#x7ED1;&#x5B9A;&#x7684;lifecycle&#x9500;&#x6BC1;&#x7684;&#x65F6;&#x5019;</span><br><span class="line">     * &#x79FB;&#x9664;&#x6389;&#x5185;&#x90E8;&#x7EF4;&#x62A4;&#x7684;&#x5BF9;&#x5E94;&#x89C2;&#x5BDF;&#x8005;</span><br><span class="line">     */</span><br><span class="line">    @OnLifecycleEvent(Lifecycle.Event.ON_DESTROY)</span><br><span class="line">    fun onDestroy(){</span><br><span class="line">        liveData.mObservers.remove(observer)</span><br><span class="line">        owner.lifecycle.removeObserver(this)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    override fun isAttachedTo(owner: LifecycleOwner): Boolean {</span><br><span class="line">        return owner == this.owner</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="&#x4E8B;&#x4EF6;&#x7684;&#x7EA6;&#x675F;"><a href="#&#x4E8B;&#x4EF6;&#x7684;&#x7EA6;&#x675F;" class="headerlink" title="&#x4E8B;&#x4EF6;&#x7684;&#x7EA6;&#x675F;"></a>&#x4E8B;&#x4EF6;&#x7684;&#x7EA6;&#x675F;</h4><p>&#x6B63;&#x5982;<a href="/external_links/31dc9262ef518b3eff2b8186e75673f7.html" target="blank" rel="noopener">&#x7F8E;&#x56E2;&#x540E;&#x671F;&#x8BA8;&#x8BBA;&#x7684;&#x6539;&#x8FDB;&#x6587;&#x7AE0;</a>&#x5185;&#x6240;&#x8BF4;, &#x5F53;&#x524D;&#x7684;&#x4E8B;&#x4EF6;&#x603B;&#x7EBF;(&#x4E0D;&#x8BBA;&#x662F;EventBus&#x8FD8;&#x662F;LiveEventBus)&#x90FD;&#x6CA1;&#x6709;&#x5BF9;&#x4E8B;&#x4EF6;&#x8FDB;&#x884C;&#x7EA6;&#x675F;, &#x5047;&#x5982;A&#x540C;&#x5B66;&#x4EE5;&#x201D;event1&#x201D;&#x5B57;&#x7B26;&#x4E32;&#x5B9A;&#x4E49;&#x4E8B;&#x4EF6;&#x540D;&#x5E76;&#x53D1;&#x9001;&#x4E8B;&#x4EF6;, &#x800C;B&#x540C;&#x5B66;&#x52FF;&#x5199;&#x6210;&#x201D;eventl&#x201D;&#x5B57;&#x7B26;&#x4E32;&#x8BA2;&#x9605;&#x4E8B;&#x4EF6;, &#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x4E8B;&#x4EF6;&#x5C31;&#x6C38;&#x8FDC;&#x90FD;&#x63A5;&#x6536;&#x4E0D;&#x5230;&#x4E86;. &#x53E6;&#x5916;&#x5F53;&#x4E0A;&#x6E38;&#x5220;&#x9664;&#x53D1;&#x9001;&#x7684;&#x4E8B;&#x4EF6;&#x76F8;&#x5173;&#x4EE3;&#x7801;, &#x8BA2;&#x9605;&#x65B9;&#x4E5F;&#x65E0;&#x4ECE;&#x611F;&#x77E5;&#x5230;.<br>&#x57FA;&#x4E8E;&#x6B64;, &#x53C2;&#x8003;&#x4E86;Retrofit&#x9488;&#x5BF9;&#x4E8E;&#x8BF7;&#x6C42;&#x7684;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x7684;&#x505A;&#x6CD5;, &#x5C06;&#x4E8B;&#x4EF6;&#x7684;&#x5B9A;&#x4E49;&#x7531;&#x4E8B;&#x4EF6;&#x603B;&#x7EBF;&#x6846;&#x67B6;&#x672C;&#x8EAB;&#x901A;&#x8FC7;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x53BB;&#x5B9E;&#x73B0;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;class LiveDataBus {</span><br><span class="line">  fun &lt;E&gt; of(clz: Class&lt;E&gt;): E {</span><br><span class="line">        if(!clz.isInterface){</span><br><span class="line">            throw IllegalArgumentException(&quot;API declarations must be interfaces.&quot;)</span><br><span class="line">        }</span><br><span class="line">        if(0 &lt; clz.interfaces.size){</span><br><span class="line">            throw IllegalArgumentException(&quot;API interfaces must not extend other interfaces.&quot;)</span><br><span class="line">        }</span><br><span class="line">        return Proxy.newProxyInstance(clz.classLoader, arrayOf(clz), InvocationHandler { _, method, _-&gt;</span><br><span class="line">            return@InvocationHandler get().with(</span><br><span class="line">                // &#x4E8B;&#x4EF6;&#x540D;&#x4EE5;&#x96C6;&#x5408;&#x7C7B;&#x540D;_&#x4E8B;&#x4EF6;&#x65B9;&#x6CD5;&#x540D;&#x5B9A;&#x4E49;</span><br><span class="line">                // &#x4EE5;&#x6B64;&#x4FDD;&#x8BC1;&#x4E8B;&#x4EF6;&#x7684;&#x552F;&#x4E00;&#x6027;</span><br><span class="line">                &quot;${clz.canonicalName}_${method.name}&quot;,</span><br><span class="line">                (method.genericReturnType as ParameterizedType).actualTypeArguments[0].javaClass)</span><br><span class="line">        }) as E</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5F00;&#x53D1;&#x8005;&#x9700;&#x8981;&#x5148;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x4E8B;&#x4EF6;, &#x624D;&#x53EF;&#x4EE5;&#x5BF9;&#x5B83;&#x8FDB;&#x884C;&#x76F8;&#x5173;&#x7684;&#x53D1;&#x9001;&#x548C;&#x8BA2;&#x9605;&#x7684;&#x5DE5;&#x4F5C;.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;interface LiveEvents {</span><br><span class="line">    /**</span><br><span class="line">     * &#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x4E8B;&#x4EF6;</span><br><span class="line">     * @return LiveEventObserver&lt;Boolean&gt; &#x4E8B;&#x4EF6;&#x7C7B;&#x578B;</span><br><span class="line">     */</span><br><span class="line">    fun event1(): LiveEventObserver&lt;Boolean&gt;</span><br><span class="line">    fun event2(): LiveEventObserver&lt;MutableList&lt;String&gt;&gt;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x7136;&#x540E;&#x5F00;&#x53D1;&#x8005;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x65B9;&#x5F0F;&#x53BB;&#x53D1;&#x9001;&#x548C;&#x8BA2;&#x9605;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;private fun sendEvent(){</span><br><span class="line">        LiveDataBus</span><br><span class="line">            .get()</span><br><span class="line">            .of(LiveEvents::class.java)</span><br><span class="line">            .event1()</span><br><span class="line">            .post(true)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">private fun observe(){</span><br><span class="line">    LiveDataBus</span><br><span class="line">        .get()</span><br><span class="line">        .of(LiveEvents::class.java)</span><br><span class="line">        .event1()</span><br><span class="line">        .observe(this, Observer {</span><br><span class="line">            Log.i(LOG, it.toString())</span><br><span class="line">        })</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="&#x53C2;&#x8003;"><a href="#&#x53C2;&#x8003;" class="headerlink" title="&#x53C2;&#x8003;"></a>&#x53C2;&#x8003;</h3><ol>
<li><a href="/external_links/bbc67f52ce19d15c0a5bc510636f2271.html" target="blank" rel="noopener">Android&#x6D88;&#x606F;&#x603B;&#x7EBF;&#x7684;&#x6F14;&#x8FDB;&#x4E4B;&#x8DEF;&#xFF1A;&#x7528;LiveDataBus&#x66FF;&#x4EE3;RxBus&#x3001;EventBus</a></li>
<li><a href="/external_links/31dc9262ef518b3eff2b8186e75673f7.html" target="blank" rel="noopener">Android&#x7EC4;&#x4EF6;&#x5316;&#x65B9;&#x6848;&#x53CA;&#x7EC4;&#x4EF6;&#x6D88;&#x606F;&#x603B;&#x7EBF;modular-event&#x5B9E;&#x6218;</a></li>
<li><a href="/external_links/78e06644e46a26514b4097d79ac647f6.html" target="blank" rel="noopener">&#x7528;LiveData&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x4E8B;&#x4EF6;&#x603B;&#x7EBF;</a></li>
</ol>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/cb481a2b66dc9f7280d53ed4b7ebc90e.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903939062628360.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903939062628360.html" itemprop="url">学习 lodash 源码整体架构，打造属于自己的函数式编程类</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-10T12:26:17+08:00">
                2019-09-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="&#x524D;&#x8A00;"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00;</h2><blockquote>
<p>&#x4F60;&#x597D;&#xFF0C;&#x6211;&#x662F;<a href="/external_links/b223b476cd448b456962ecaf8028b149.html" target="blank" rel="noopener">&#x82E5;&#x5DDD;</a>&#x3002;&#x8FD9;&#x662F;<code>&#x5B66;&#x4E60;&#x6E90;&#x7801;&#x6574;&#x4F53;&#x67B6;&#x6784;&#x7CFB;&#x5217;</code>&#x7B2C;&#x4E09;&#x7BC7;&#x3002;&#x6574;&#x4F53;&#x67B6;&#x6784;&#x8FD9;&#x8BCD;&#x8BED;&#x597D;&#x50CF;&#x6709;&#x70B9;&#x5927;&#xFF0C;&#x59D1;&#x4E14;&#x5C31;&#x7B97;&#x662F;&#x6E90;&#x7801;&#x6574;&#x4F53;&#x7ED3;&#x6784;&#x5427;&#xFF0C;&#x4E3B;&#x8981;&#x5C31;&#x662F;&#x5B66;&#x4E60;&#x662F;&#x4EE3;&#x7801;&#x6574;&#x4F53;&#x7ED3;&#x6784;&#xFF0C;&#x4E0D;&#x6DF1;&#x7A76;&#x5176;&#x4ED6;&#x4E0D;&#x662F;&#x4E3B;&#x7EBF;&#x7684;&#x5177;&#x4F53;&#x51FD;&#x6570;&#x7684;&#x5B9E;&#x73B0;&#x3002;&#x672C;&#x7BC7;&#x6587;&#x7AE0;&#x5B66;&#x4E60;&#x7684;&#x662F;&#x6253;&#x5305;&#x6574;&#x5408;&#x540E;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x4E0D;&#x662F;&#x5B9E;&#x9645;&#x4ED3;&#x5E93;&#x4E2D;&#x7684;&#x62C6;&#x5206;&#x7684;&#x4EE3;&#x7801;&#x3002;</p>
</blockquote>
<p><code>&#x5B66;&#x4E60;&#x6E90;&#x7801;&#x6574;&#x4F53;&#x67B6;&#x6784;&#x7CFB;&#x5217;</code>&#x6587;&#x7AE0;&#x5982;&#x4E0B;&#xFF1A;</p>
<blockquote>
<p>1.<a href="https://dev.newban.cn/6844903902077272071">&#x5B66;&#x4E60; jQuery &#x6E90;&#x7801;&#x6574;&#x4F53;&#x67B6;&#x6784;&#xFF0C;&#x6253;&#x9020;&#x5C5E;&#x4E8E;&#x81EA;&#x5DF1;&#x7684; js &#x7C7B;&#x5E93;</a>  </p>
<p>2.<a href="https://dev.newban.cn/6844903908972691469">&#x5B66;&#x4E60; underscore &#x6E90;&#x7801;&#x6574;&#x4F53;&#x67B6;&#x6784;&#xFF0C;&#x6253;&#x9020;&#x5C5E;&#x4E8E;&#x81EA;&#x5DF1;&#x7684;&#x51FD;&#x6570;&#x5F0F;&#x7F16;&#x7A0B;&#x7C7B;&#x5E93;</a>  </p>
<p>3.<a href="https://dev.newban.cn/6844903939062628360">&#x5B66;&#x4E60; lodash &#x6E90;&#x7801;&#x6574;&#x4F53;&#x67B6;&#x6784;&#xFF0C;&#x6253;&#x9020;&#x5C5E;&#x4E8E;&#x81EA;&#x5DF1;&#x7684;&#x51FD;&#x6570;&#x5F0F;&#x7F16;&#x7A0B;&#x7C7B;&#x5E93;</a>  </p>
<p>4.<a href="https://dev.newban.cn/6844903984457580551">&#x5B66;&#x4E60; sentry &#x6E90;&#x7801;&#x6574;&#x4F53;&#x67B6;&#x6784;&#xFF0C;&#x6253;&#x9020;&#x5C5E;&#x4E8E;&#x81EA;&#x5DF1;&#x7684;&#x524D;&#x7AEF;&#x5F02;&#x5E38;&#x76D1;&#x63A7;SDK</a>  </p>
<p>5.<a href="https://dev.newban.cn/6844904001192853511">&#x5B66;&#x4E60; vuex &#x6E90;&#x7801;&#x6574;&#x4F53;&#x67B6;&#x6784;&#xFF0C;&#x6253;&#x9020;&#x5C5E;&#x4E8E;&#x81EA;&#x5DF1;&#x7684;&#x72B6;&#x6001;&#x7BA1;&#x7406;&#x5E93;</a>  </p>
<p>6.<a href="https://dev.newban.cn/6844904019987529735">&#x5B66;&#x4E60; axios &#x6E90;&#x7801;&#x6574;&#x4F53;&#x67B6;&#x6784;&#xFF0C;&#x6253;&#x9020;&#x5C5E;&#x4E8E;&#x81EA;&#x5DF1;&#x7684;&#x8BF7;&#x6C42;&#x5E93;</a>  </p>
<p>7.<a href="https://dev.newban.cn/6844904088220467213">&#x5B66;&#x4E60; koa &#x6E90;&#x7801;&#x7684;&#x6574;&#x4F53;&#x67B6;&#x6784;&#xFF0C;&#x6D45;&#x6790;koa&#x6D0B;&#x8471;&#x6A21;&#x578B;&#x539F;&#x7406;&#x548C;co&#x539F;&#x7406;</a>  </p>
<p>8.<a href="https://dev.newban.cn/6844904191228411911">&#x5B66;&#x4E60; redux &#x6E90;&#x7801;&#x6574;&#x4F53;&#x67B6;&#x6784;&#xFF0C;&#x6DF1;&#x5165;&#x7406;&#x89E3; redux &#x53CA;&#x5176;&#x4E2D;&#x95F4;&#x4EF6;&#x539F;&#x7406;</a></p>
</blockquote>
<p>&#x611F;&#x5174;&#x8DA3;&#x7684;&#x8BFB;&#x8005;&#x53EF;&#x4EE5;&#x70B9;&#x51FB;&#x9605;&#x8BFB;&#x3002;</p>
<p><code>underscore</code>&#x6E90;&#x7801;&#x5206;&#x6790;&#x7684;&#x6587;&#x7AE0;&#x6BD4;&#x8F83;&#x591A;&#xFF0C;&#x800C;<code>lodash</code>&#x6E90;&#x7801;&#x5206;&#x6790;&#x7684;&#x6587;&#x7AE0;&#x6BD4;&#x8F83;&#x5C11;&#x3002;&#x539F;&#x56E0;&#x4E4B;&#x4E00;&#x53EF;&#x80FD;&#x662F;&#x7531;&#x4E8E;<code>lodash</code>&#x6E90;&#x7801;&#x884C;&#x6570;&#x592A;&#x591A;&#x3002;&#x6CE8;&#x91CA;&#x52A0;&#x8D77;&#x6765;&#x4E00;&#x4E07;&#x591A;&#x884C;&#x3002;</p>
<p>&#x5206;&#x6790;<code>lodash</code>&#x6574;&#x4F53;&#x4EE3;&#x7801;&#x7ED3;&#x6784;&#x7684;&#x6587;&#x7AE0;&#x6BD4;&#x8F83;&#x5C11;&#xFF0C;&#x7B14;&#x8005;&#x5229;&#x7528;&#x8C37;&#x6B4C;&#x3001;&#x5FC5;&#x5E94;&#x3001;<code>github</code>&#x7B49;&#x641C;&#x7D22;&#x90FD;&#x6CA1;&#x6709;&#x627E;&#x5230;&#xFF0C;&#x53EF;&#x80FD;&#x662F;&#x627E;&#x7684;&#x65B9;&#x5F0F;&#x4E0D;&#x5BF9;&#x3002;&#x4E8E;&#x662F;&#x6253;&#x7B97;&#x81EA;&#x5DF1;&#x5199;&#x4E00;&#x7BC7;&#x3002;&#x5E73;&#x5E38;&#x5F00;&#x53D1;&#x5927;&#x591A;&#x6570;&#x4EBA;&#x90FD;&#x4F1A;&#x4F7F;&#x7528;<code>lodash</code>&#xFF0C;&#x800C;&#x4E14;&#x90FD;&#x6216;&#x591A;&#x6216;&#x5C11;&#x77E5;&#x9053;&#xFF0C;<code>lodash</code>&#x6BD4;<code>underscore</code>&#x6027;&#x80FD;&#x597D;&#xFF0C;&#x6027;&#x80FD;&#x597D;&#x7684;&#x4E3B;&#x8981;&#x539F;&#x56E0;&#x662F;&#x4F7F;&#x7528;&#x4E86;&#x60F0;&#x6027;&#x6C42;&#x503C;&#x8FD9;&#x4E00;&#x7279;&#x6027;&#x3002;</p>
<p>&#x672C;&#x6587;&#x7AE0;&#x5B66;&#x4E60;&#x7684;<code>lodash</code>&#x7684;&#x7248;&#x672C;&#x662F;&#xFF1A;<code>v4.17.15</code>&#x3002;<code>unpkg.com</code>&#x5730;&#x5740; <a href="/external_links/dc70643c05ab331c5f357e26f0048072.html" target="blank" rel="noopener">https://unpkg.com/lodash@4.17.15/lodash.js</a></p>
<p>&#x6587;&#x7AE0;&#x7BC7;&#x5E45;&#x53EF;&#x80FD;&#x6BD4;&#x8F83;&#x957F;&#xFF0C;&#x53EF;&#x4EE5;&#x5148;&#x6536;&#x85CF;&#x518D;&#x770B;&#xFF0C;&#x6240;&#x4EE5;&#x7B14;&#x8005;&#x4F7F;&#x7528;&#x4E86;&#x5C55;&#x5F00;&#x6536;&#x7F29;&#x7684;&#x5F62;&#x5F0F;&#x3002;</p>
<p><strong>&#x5BFC;&#x8BFB;&#xFF1A;</strong></p>
<blockquote>
<p>&#x6587;&#x7AE0;&#x4E3B;&#x8981;&#x5B66;&#x4E60;&#x4E86;<code>runInContext()</code> &#x5BFC;&#x51FA;<code>_</code> <code>lodash</code>&#x51FD;&#x6570;&#x4F7F;&#x7528;<code>baseCreate</code>&#x65B9;&#x6CD5;&#x539F;&#x578B;&#x7EE7;&#x627F;<code>LodashWrapper</code>&#x548C;<code>LazyWrapper</code>&#xFF0C;<code>mixin</code>&#x6302;&#x8F7D;&#x65B9;&#x6CD5;&#x5230;<code>lodash.prototype</code>&#x3001;&#x540E;&#x6587;&#x7528;&#x7ED3;&#x5408;&#x4F8B;&#x5B50;&#x89E3;&#x91CA;<code>lodash.prototype.value(wrapperValue)</code>&#x548C;<code>Lazy.prototype.value(lazyValue)</code>&#x60F0;&#x6027;&#x6C42;&#x503C;&#x7684;&#x6E90;&#x7801;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x3002;</p>
</blockquote>
<h2 id="&#x533F;&#x540D;&#x51FD;&#x6570;&#x6267;&#x884C;"><a href="#&#x533F;&#x540D;&#x51FD;&#x6570;&#x6267;&#x884C;" class="headerlink" title="&#x533F;&#x540D;&#x51FD;&#x6570;&#x6267;&#x884C;"></a>&#x533F;&#x540D;&#x51FD;&#x6570;&#x6267;&#x884C;</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;;(function() {</span><br><span class="line"></span><br><span class="line">}.call(this));</span><br></pre></td></tr></table></figure>

<p>&#x66B4;&#x9732; lodash</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;var _ = runInContext();</span><br></pre></td></tr></table></figure>

<h2 id="runInContext-&#x51FD;&#x6570;"><a href="#runInContext-&#x51FD;&#x6570;" class="headerlink" title="runInContext &#x51FD;&#x6570;"></a>runInContext &#x51FD;&#x6570;</h2><p>&#x8FD9;&#x91CC;&#x7684;&#x7B80;&#x7248;&#x6E90;&#x7801;&#xFF0C;&#x53EA;&#x5173;&#x6CE8;&#x51FD;&#x6570;&#x5165;&#x53E3;&#x548C;&#x8FD4;&#x56DE;&#x503C;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;var runInContext = (function runInContext(context) {</span><br><span class="line"> // &#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x5904;&#x7406;context&#x4E3A;window</span><br><span class="line"> // ...</span><br><span class="line"> function lodash(value) {}{</span><br><span class="line">  // ...</span><br><span class="line">  return new LodashWrapper(value);</span><br><span class="line"> }</span><br><span class="line"> // ...</span><br><span class="line"> return lodash;</span><br><span class="line">});</span><br></pre></td></tr></table></figure>

<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x7533;&#x660E;&#x4E86;&#x4E00;&#x4E2A;<code>runInContext</code>&#x51FD;&#x6570;&#x3002;&#x91CC;&#x9762;&#x6709;&#x4E00;&#x4E2A;<code>lodash</code>&#x51FD;&#x6570;&#xFF0C;&#x6700;&#x540E;&#x5904;&#x7406;&#x8FD4;&#x56DE;&#x8FD9;&#x4E2A;<code>lodash</code>&#x51FD;&#x6570;&#x3002;</p>
<p>&#x518D;&#x770B;<code>lodash</code>&#x51FD;&#x6570;&#x4E2D;&#x7684;&#x8FD4;&#x56DE;&#x503C; <code>new LodashWrapper(value)</code>&#x3002;</p>
<h3 id="LodashWrapper-&#x51FD;&#x6570;"><a href="#LodashWrapper-&#x51FD;&#x6570;" class="headerlink" title="LodashWrapper &#x51FD;&#x6570;"></a>LodashWrapper &#x51FD;&#x6570;</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function LodashWrapper(value, chainAll) {</span><br><span class="line"> this.__wrapped__ = value;</span><br><span class="line"> this.__actions__ = [];</span><br><span class="line"> this.__chain__ = !!chainAll;</span><br><span class="line"> this.__index__ = 0;</span><br><span class="line"> this.__values__ = undefined;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8BBE;&#x7F6E;&#x4E86;&#x8FD9;&#x4E9B;&#x5C5E;&#x6027;&#xFF1A;</p>
<p><code>__wrapped__</code>&#xFF1A;&#x5B58;&#x653E;&#x53C2;&#x6570;<code>value</code>&#x3002;</p>
<p><code>__actions__</code>&#xFF1A;&#x5B58;&#x653E;&#x5F85;&#x6267;&#x884C;&#x7684;&#x51FD;&#x6570;&#x4F53;<code>func</code>&#xFF0C; &#x51FD;&#x6570;&#x53C2;&#x6570; <code>args</code>&#xFF0C;&#x51FD;&#x6570;&#x6267;&#x884C;&#x7684;<code>this</code> &#x6307;&#x5411; <code>thisArg</code>&#x3002;</p>
<p><code>__chain__</code>&#x3001;<code>undefined</code>&#x4E24;&#x6B21;&#x53D6;&#x53CD;&#x8F6C;&#x6210;&#x5E03;&#x5C14;&#x503C;<code>false</code>&#xFF0C;&#x4E0D;&#x652F;&#x6301;&#x94FE;&#x5F0F;&#x8C03;&#x7528;&#x3002;&#x548C;<code>underscore</code>&#x4E00;&#x6837;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F;&#x4E0D;&#x652F;&#x6301;&#x94FE;&#x5F0F;&#x8C03;&#x7528;&#x7684;&#x3002;</p>
<p><code>__index__</code>&#xFF1A;&#x7D22;&#x5F15;&#x503C; &#x9ED8;&#x8BA4; 0&#x3002;</p>
<p><code>__values__</code>&#xFF1A;&#x4E3B;&#x8981;<code>clone</code>&#x65F6;&#x4F7F;&#x7528;&#x3002;</p>
<p>&#x63A5;&#x7740;&#x5F80;&#x4E0B;&#x641C;&#x7D22;&#x6E90;&#x7801;&#xFF0C;<code>LodashWrapper</code>&#xFF0C;<br>&#x4F1A;&#x53D1;&#x73B0;&#x8FD9;&#x4E24;&#x884C;&#x4EE3;&#x7801;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;LodashWrapper.prototype = baseCreate(baseLodash.prototype);</span><br><span class="line">LodashWrapper.prototype.constructor = LodashWrapper;</span><br></pre></td></tr></table></figure>

<p>&#x63A5;&#x7740;&#x5F80;&#x4E0A;&#x627E;<code>baseCreate&#x3001;baseLodash</code>&#x8FD9;&#x4E24;&#x4E2A;&#x51FD;&#x6570;&#x3002;</p>
<h3 id="baseCreate-&#x539F;&#x578B;&#x7EE7;&#x627F;"><a href="#baseCreate-&#x539F;&#x578B;&#x7EE7;&#x627F;" class="headerlink" title="baseCreate &#x539F;&#x578B;&#x7EE7;&#x627F;"></a>baseCreate &#x539F;&#x578B;&#x7EE7;&#x627F;</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;//  &#x7ACB;&#x5373;&#x6267;&#x884C;&#x533F;&#x540D;&#x51FD;&#x6570;</span><br><span class="line">// &#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x7528;&#x4E8E;&#x8BBE;&#x7F6E;&#x539F;&#x578B; &#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;&#x662F; __proto__</span><br><span class="line">var baseCreate = (function() {</span><br><span class="line"> // &#x8FD9;&#x53E5;&#x653E;&#x5728;&#x51FD;&#x6570;&#x5916;&#xFF0C;&#x662F;&#x4E3A;&#x4E86;&#x4E0D;&#x7528;&#x6BCF;&#x6B21;&#x8C03;&#x7528;baseCreate&#x90FD;&#x91CD;&#x590D;&#x7533;&#x660E; object</span><br><span class="line"> // underscore &#x6E90;&#x7801;&#x4E2D;&#xFF0C;&#x628A;&#x8FD9;&#x53E5;&#x653E;&#x5728;&#x5F00;&#x5934;&#x5C31;&#x7533;&#x660E;&#x4E86;&#x4E00;&#x4E2A;&#x7A7A;&#x51FD;&#x6570; `Ctor`</span><br><span class="line"> function object() {}</span><br><span class="line"> return function(proto) {</span><br><span class="line">  // &#x5982;&#x679C;&#x4F20;&#x5165;&#x7684;&#x53C2;&#x6570;&#x4E0D;&#x662F;object&#x4E5F;&#x4E0D;&#x662F;function &#x662F;null</span><br><span class="line">  // &#x5219;&#x8FD4;&#x56DE;&#x7A7A;&#x5BF9;&#x8C61;&#x3002;</span><br><span class="line">  if (!isObject(proto)) {</span><br><span class="line">   return {};</span><br><span class="line">  }</span><br><span class="line">  // &#x5982;&#x679C;&#x652F;&#x6301;Object.create&#x65B9;&#x6CD5;&#xFF0C;&#x5219;&#x8FD4;&#x56DE; Object.create</span><br><span class="line">  if (objectCreate) {</span><br><span class="line">   // Object.create</span><br><span class="line">   return objectCreate(proto);</span><br><span class="line">  }</span><br><span class="line">  // &#x5982;&#x679C;&#x4E0D;&#x652F;&#x6301;Object.create &#x7528; ployfill new</span><br><span class="line">  object.prototype = proto;</span><br><span class="line">  var result = new object;</span><br><span class="line">  // &#x8FD8;&#x539F; prototype</span><br><span class="line">  object.prototype = undefined;</span><br><span class="line">  return result;</span><br><span class="line"> };</span><br><span class="line">}());</span><br><span class="line"></span><br><span class="line">// &#x7A7A;&#x51FD;&#x6570;</span><br><span class="line">function baseLodash() {</span><br><span class="line"> // No operation performed.</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// Ensure wrappers are instances of `baseLodash`.</span><br><span class="line">lodash.prototype = baseLodash.prototype;</span><br><span class="line">// &#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x6709;&#x8FD9;&#x4E00;&#x53E5;&#xFF1F;&#x56E0;&#x4E3A;&#x4E0A;&#x4E00;&#x53E5;&#x628A;lodash.prototype.construtor &#x8BBE;&#x7F6E;&#x4E3A;Object&#x4E86;&#x3002;&#x8FD9;&#x4E00;&#x53E5;&#x4FEE;&#x6B63;constructor</span><br><span class="line">lodash.prototype.constructor = lodash;</span><br><span class="line"></span><br><span class="line">LodashWrapper.prototype = baseCreate(baseLodash.prototype);</span><br><span class="line">LodashWrapper.prototype.constructor = LodashWrapper;</span><br></pre></td></tr></table></figure>

<p>&#x7B14;&#x8005;&#x753B;&#x4E86;&#x4E00;&#x5F20;&#x56FE;&#xFF0C;&#x8868;&#x793A;&#x8FD9;&#x4E2A;&#x5173;&#x7CFB;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/bea6b378f9862a2b08e738d1c23a2d46e565fb3c7d10c53c3b6519063cddea03" alt="lodash &#x539F;&#x578B;&#x5173;&#x7CFB;&#x56FE;"></p>
<p>lodash &#x539F;&#x578B;&#x5173;&#x7CFB;&#x56FE;</p>
<h4 id="&#x884D;&#x751F;&#x7684;-isObject-&#x51FD;&#x6570;"><a href="#&#x884D;&#x751F;&#x7684;-isObject-&#x51FD;&#x6570;" class="headerlink" title="&#x884D;&#x751F;&#x7684; isObject &#x51FD;&#x6570;"></a>&#x884D;&#x751F;&#x7684; isObject &#x51FD;&#x6570;</h4><p>&#x5224;&#x65AD;<code>typeof value</code>&#x4E0D;&#x7B49;&#x4E8E;<code>null</code>&#xFF0C;&#x5E76;&#x4E14;&#x662F;<code>object</code>&#x6216;&#x8005;<code>function</code>&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function isObject(value) {</span><br><span class="line"> var type = typeof value;</span><br><span class="line"> return value != null &amp;&amp; (type == &apos;object&apos; || type == &apos;function&apos;);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="Object-create-&#x7528;&#x6CD5;&#x4E3E;&#x4F8B;"><a href="#Object-create-&#x7528;&#x6CD5;&#x4E3E;&#x4F8B;" class="headerlink" title="Object.create() &#x7528;&#x6CD5;&#x4E3E;&#x4F8B;"></a>Object.create() &#x7528;&#x6CD5;&#x4E3E;&#x4F8B;</h3><p><a href="https://dev.newban.cn/6844903704663949325">&#x9762;&#x8BD5;&#x5B98;&#x95EE;&#xFF1A;&#x80FD;&#x5426;&#x6A21;&#x62DF;&#x5B9E;&#x73B0;JS&#x7684;new&#x64CD;&#x4F5C;&#x7B26;</a> &#x4E4B;&#x524D;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x5199;&#x8FC7;&#x7684;&#x4E00;&#x6BB5;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x6536;&#x7F29;&#x8D77;&#x6765;&#x4E86;&#x3002;</p>
<p> &#x70B9;&#x51FB; &#x67E5;&#x770B; Object.create() &#x7528;&#x6CD5;&#x4E3E;&#x4F8B;<br>&#x7B14;&#x8005;&#x4E4B;&#x524D;&#x6574;&#x7406;&#x7684;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;&#x4E2D;&#x4E5F;&#x6709;&#x8BB2;&#x8FC7;&#xFF0C;&#x53EF;&#x4EE5;&#x7FFB;&#x770B;<a href="/external_links/84711cef8960f5830459654ed5582f98.html" target="blank" rel="noopener">JavaScript &#x5BF9;&#x8C61;&#x6240;&#x6709;API&#x89E3;&#x6790;</a></p>
<p><a href="/external_links/5bd3fa02efcbbadcc1f3b7a5967b3330.html" target="blank" rel="noopener">MDN Object.create()</a></p>
<p><code>Object.create(proto, [propertiesObject])</code><br>&#x65B9;&#x6CD5;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x5BF9;&#x8C61;&#xFF0C;&#x4F7F;&#x7528;&#x73B0;&#x6709;&#x7684;&#x5BF9;&#x8C61;&#x6765;&#x63D0;&#x4F9B;&#x65B0;&#x521B;&#x5EFA;&#x7684;&#x5BF9;&#x8C61;&#x7684;__proto__&#x3002;<br>&#x5B83;&#x63A5;&#x6536;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x4E0D;&#x8FC7;&#x7B2C;&#x4E8C;&#x4E2A;&#x53EF;&#x9009;&#x53C2;&#x6570;&#x662F;&#x5C5E;&#x6027;&#x63CF;&#x8FF0;&#x7B26;&#xFF08;&#x4E0D;&#x5E38;&#x7528;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F;<code>undefined</code>&#xFF09;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;var anotherObject = {</span><br><span class="line">    name: &apos;&#x82E5;&#x5DDD;&apos;</span><br><span class="line">};</span><br><span class="line">var myObject = Object.create(anotherObject, {</span><br><span class="line">    age: {</span><br><span class="line">        value&#xFF1A;18,</span><br><span class="line">    },</span><br><span class="line">});</span><br><span class="line">// &#x83B7;&#x5F97;&#x5B83;&#x7684;&#x539F;&#x578B;</span><br><span class="line">Object.getPrototypeOf(anotherObject) === Object.prototype; // true &#x8BF4;&#x660E;anotherObject&#x7684;&#x539F;&#x578B;&#x662F;Object.prototype</span><br><span class="line">Object.getPrototypeOf(myObject); // {name: &quot;&#x82E5;&#x5DDD;&quot;} // &#x8BF4;&#x660E;myObject&#x7684;&#x539F;&#x578B;&#x662F;{name: &quot;&#x82E5;&#x5DDD;&quot;}</span><br><span class="line">myObject.hasOwnProperty(&apos;name&apos;); // false; &#x8BF4;&#x660E;name&#x662F;&#x539F;&#x578B;&#x4E0A;&#x7684;&#x3002;</span><br><span class="line">myObject.hasOwnProperty(&apos;age&apos;); // true &#x8BF4;&#x660E;age&#x662F;&#x81EA;&#x8EAB;&#x7684;</span><br><span class="line">myObject.name; // &apos;&#x82E5;&#x5DDD;&apos;</span><br><span class="line">myObject.age; // 18;</span><br></pre></td></tr></table></figure>

<p>&#x5BF9;&#x4E8E;&#x4E0D;&#x652F;&#x6301;<code>ES5</code>&#x7684;&#x6D4F;&#x89C8;&#x5668;&#xFF0C;<code>MDN</code>&#x4E0A;&#x63D0;&#x4F9B;&#x4E86;<code>ployfill</code>&#x65B9;&#x6848;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;if (typeof Object.create !== &quot;function&quot;) {</span><br><span class="line">    Object.create = function (proto, propertiesObject) {</span><br><span class="line">        if (typeof proto !== &apos;object&apos; &amp;&amp; typeof proto !== &apos;function&apos;) {</span><br><span class="line">            throw new TypeError(&apos;Object prototype may only be an Object: &apos; + proto);</span><br><span class="line">        } else if (proto === null) {</span><br><span class="line">            throw new Error(&quot;This browser&apos;s implementation of Object.create is a shim and doesn&apos;t support &apos;null&apos; as the first argument.&quot;);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        if (typeof propertiesObject != &apos;undefined&apos;) throw new Error(&quot;This browser&apos;s implementation of Object.create is a shim and doesn&apos;t support a second argument.&quot;);</span><br><span class="line"></span><br><span class="line">        function F() {}</span><br><span class="line">        F.prototype = proto;</span><br><span class="line">        return new F();</span><br><span class="line">    };</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><code>lodash</code>&#x4E0A;&#x6709;&#x5F88;&#x591A;&#x65B9;&#x6CD5;&#x548C;&#x5C5E;&#x6027;&#xFF0C;&#x4F46;&#x5728;<code>lodash.prototype</code>&#x4E5F;&#x6709;&#x5F88;&#x591A;&#x4E0E;<code>lodash</code>&#x4E0A;&#x76F8;&#x540C;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x80AF;&#x5B9A;&#x4E0D;&#x662F;&#x5728;<code>lodash.prototype</code>&#x4E0A;&#x91CD;&#x65B0;&#x5199;&#x4E00;&#x904D;&#x3002;&#x800C;&#x662F;&#x901A;&#x8FC7;<code>mixin</code>&#x6302;&#x8F7D;&#x7684;&#x3002;</p>
<h2 id="mixin"><a href="#mixin" class="headerlink" title="mixin"></a>mixin</h2><h3 id="mixin-&#x5177;&#x4F53;&#x7528;&#x6CD5;"><a href="#mixin-&#x5177;&#x4F53;&#x7528;&#x6CD5;" class="headerlink" title="mixin &#x5177;&#x4F53;&#x7528;&#x6CD5;"></a>mixin &#x5177;&#x4F53;&#x7528;&#x6CD5;</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;_.mixin([object=lodash], source, [options={}])</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&#x6DFB;&#x52A0;&#x6765;&#x6E90;&#x5BF9;&#x8C61;&#x81EA;&#x8EAB;&#x7684;&#x6240;&#x6709;&#x53EF;&#x679A;&#x4E3E;&#x51FD;&#x6570;&#x5C5E;&#x6027;&#x5230;&#x76EE;&#x6807;&#x5BF9;&#x8C61;&#x3002; &#x5982;&#x679C; object &#x662F;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x90A3;&#x4E48;&#x51FD;&#x6570;&#x65B9;&#x6CD5;&#x5C06;&#x88AB;&#x6DFB;&#x52A0;&#x5230;&#x539F;&#x578B;&#x94FE;&#x4E0A;&#x3002;</p>
</blockquote>
<blockquote>
<p>&#x6CE8;&#x610F;: &#x4F7F;&#x7528; _.runInContext &#x6765;&#x521B;&#x5EFA;&#x539F;&#x59CB;&#x7684; lodash &#x51FD;&#x6570;&#x6765;&#x907F;&#x514D;&#x4FEE;&#x6539;&#x9020;&#x6210;&#x7684;&#x51B2;&#x7A81;&#x3002;</p>
</blockquote>
<p><strong>&#x6DFB;&#x52A0;&#x7248;&#x672C;</strong></p>
<blockquote>
<p>0.1.0</p>
</blockquote>
<p><strong>&#x53C2;&#x6570;</strong></p>
<blockquote>
<p>[object=lodash] (Function|Object): &#x76EE;&#x6807;&#x5BF9;&#x8C61;&#x3002;</p>
</blockquote>
<blockquote>
<p>source (Object): &#x6765;&#x6E90;&#x5BF9;&#x8C61;&#x3002;</p>
</blockquote>
<blockquote>
<p>[options={}] (Object): &#x9009;&#x9879;&#x5BF9;&#x8C61;&#x3002;</p>
</blockquote>
<blockquote>
<p>[options.chain=true] (boolean): &#x662F;&#x5426;&#x5F00;&#x542F;&#x94FE;&#x5F0F;&#x64CD;&#x4F5C;&#x3002;</p>
</blockquote>
<p><strong>&#x8FD4;&#x56DE;</strong></p>
<blockquote>
<p>(*): &#x8FD4;&#x56DE; object.</p>
</blockquote>
<h3 id="mixin-&#x6E90;&#x7801;"><a href="#mixin-&#x6E90;&#x7801;" class="headerlink" title="mixin &#x6E90;&#x7801;"></a>mixin &#x6E90;&#x7801;</h3><p>&#x70B9;&#x51FB;&#x8FD9;&#x91CC;&#x5C55;&#x5F00;mixin&#x6E90;&#x7801;&#xFF0C;&#x540E;&#x6587;&#x6CE8;&#x91CA;&#x89E3;&#x6790;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function mixin(object, source, options) {</span><br><span class="line"> var props = keys(source),</span><br><span class="line">  methodNames = baseFunctions(source, props);</span><br><span class="line"></span><br><span class="line"> if (options == null &amp;&amp;</span><br><span class="line">  !(isObject(source) &amp;&amp; (methodNames.length || !props.length))) {</span><br><span class="line">  options = source;</span><br><span class="line">  source = object;</span><br><span class="line">  object = this;</span><br><span class="line">  methodNames = baseFunctions(source, keys(source));</span><br><span class="line"> }</span><br><span class="line"> var chain = !(isObject(options) &amp;&amp; &apos;chain&apos; in options) || !!options.chain,</span><br><span class="line">  isFunc = isFunction(object);</span><br><span class="line"></span><br><span class="line"> arrayEach(methodNames, function(methodName) {</span><br><span class="line">  var func = source[methodName];</span><br><span class="line">  object[methodName] = func;</span><br><span class="line">  if (isFunc) {</span><br><span class="line">   object.prototype[methodName] = function() {</span><br><span class="line">    var chainAll = this.__chain__;</span><br><span class="line">    if (chain || chainAll) {</span><br><span class="line">     var result = object(this.__wrapped__),</span><br><span class="line">      actions = result.__actions__ = copyArray(this.__actions__);</span><br><span class="line"></span><br><span class="line">     actions.push({ &apos;func&apos;: func, &apos;args&apos;: arguments, &apos;thisArg&apos;: object });</span><br><span class="line">     result.__chain__ = chainAll;</span><br><span class="line">     return result;</span><br><span class="line">    }</span><br><span class="line">    return func.apply(object, arrayPush([this.value()], arguments));</span><br><span class="line">   };</span><br><span class="line">  }</span><br><span class="line"> });</span><br><span class="line"></span><br><span class="line"> return object;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x63A5;&#x4E0B;&#x6765;&#x5148;&#x770B;&#x884D;&#x751F;&#x7684;&#x51FD;&#x6570;&#x3002;<br><strong>&#x5176;&#x5B9E;&#x770B;&#x5230;&#x5177;&#x4F53;&#x5B9A;&#x4E49;&#x7684;&#x51FD;&#x6570;&#x4EE3;&#x7801;&#x5C31;&#x5927;&#x6982;&#x77E5;&#x9053;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x529F;&#x80FD;&#x3002;&#x4E3A;&#x4E86;&#x4E0D;&#x5F71;&#x54CD;&#x4E3B;&#x7EBF;&#xFF0C;&#x5BFC;&#x81F4;&#x6587;&#x7AE0;&#x7BC7;&#x5E45;&#x8FC7;&#x957F;&#x3002;&#x5177;&#x4F53;&#x6E90;&#x7801;&#x5728;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x5C55;&#x5F00;&#x3002;</strong></p>
<p>&#x611F;&#x5174;&#x8DA3;&#x7684;&#x8BFB;&#x8005;&#x53EF;&#x4EE5;&#x81EA;&#x884C;&#x770B;&#x8FD9;&#x4E9B;&#x51FD;&#x6570;&#x884D;&#x751F;&#x7684;&#x5176;&#x4ED6;&#x51FD;&#x6570;&#x7684;&#x6E90;&#x7801;&#x3002;</p>
<h3 id="mixin-&#x884D;&#x751F;&#x7684;&#x51FD;&#x6570;-keys"><a href="#mixin-&#x884D;&#x751F;&#x7684;&#x51FD;&#x6570;-keys" class="headerlink" title="mixin &#x884D;&#x751F;&#x7684;&#x51FD;&#x6570; keys"></a>mixin &#x884D;&#x751F;&#x7684;&#x51FD;&#x6570; keys</h3><p>&#x5728; <code>mixin</code> &#x51FD;&#x6570;&#x4E2D; &#x5176;&#x5B9E;&#x6700;&#x7EC8;&#x8C03;&#x7528;&#x7684;&#x5C31;&#x662F; <code>Object.keys</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function keys(object) {</span><br><span class="line"> return isArrayLike(object) ? arrayLikeKeys(object) : baseKeys(object);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="mixin-&#x884D;&#x751F;&#x7684;&#x51FD;&#x6570;-baseFunctions"><a href="#mixin-&#x884D;&#x751F;&#x7684;&#x51FD;&#x6570;-baseFunctions" class="headerlink" title="mixin &#x884D;&#x751F;&#x7684;&#x51FD;&#x6570; baseFunctions"></a>mixin &#x884D;&#x751F;&#x7684;&#x51FD;&#x6570; baseFunctions</h3><p>&#x8FD4;&#x56DE;&#x51FD;&#x6570;&#x6570;&#x7EC4;&#x96C6;&#x5408;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function baseFunctions(object, props) {</span><br><span class="line"> return arrayFilter(props, function(key) {</span><br><span class="line">  return isFunction(object[key]);</span><br><span class="line"> });</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="mixin-&#x884D;&#x751F;&#x7684;&#x51FD;&#x6570;-isFunction"><a href="#mixin-&#x884D;&#x751F;&#x7684;&#x51FD;&#x6570;-isFunction" class="headerlink" title="mixin &#x884D;&#x751F;&#x7684;&#x51FD;&#x6570; isFunction"></a>mixin &#x884D;&#x751F;&#x7684;&#x51FD;&#x6570; isFunction</h3><p>&#x5224;&#x65AD;&#x53C2;&#x6570;&#x662F;&#x5426;&#x662F;&#x51FD;&#x6570;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function isFunction(value) {</span><br><span class="line"> if (!isObject(value)) {</span><br><span class="line">  return false;</span><br><span class="line"> }</span><br><span class="line"> // The use of `Object#toString` avoids issues with the `typeof` operator</span><br><span class="line"> // in Safari 9 which returns &apos;object&apos; for typed arrays and other constructors.</span><br><span class="line"> var tag = baseGetTag(value);</span><br><span class="line"> return tag == funcTag || tag == genTag || tag == asyncTag || tag == proxyTag;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="mixin-&#x884D;&#x751F;&#x7684;&#x51FD;&#x6570;-arrayEach"><a href="#mixin-&#x884D;&#x751F;&#x7684;&#x51FD;&#x6570;-arrayEach" class="headerlink" title="mixin &#x884D;&#x751F;&#x7684;&#x51FD;&#x6570; arrayEach"></a>mixin &#x884D;&#x751F;&#x7684;&#x51FD;&#x6570; arrayEach</h3><p>&#x7C7B;&#x4F3C; [].forEarch</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function arrayEach(array, iteratee) {</span><br><span class="line"> var index = -1,</span><br><span class="line">  length = array == null ? 0 : array.length;</span><br><span class="line"></span><br><span class="line"> while (++index &lt; length) {</span><br><span class="line">  if (iteratee(array[index], index, array) === false) {</span><br><span class="line">   break;</span><br><span class="line">  }</span><br><span class="line"> }</span><br><span class="line"> return array;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="mixin-&#x884D;&#x751F;&#x7684;&#x51FD;&#x6570;-arrayPush"><a href="#mixin-&#x884D;&#x751F;&#x7684;&#x51FD;&#x6570;-arrayPush" class="headerlink" title="mixin &#x884D;&#x751F;&#x7684;&#x51FD;&#x6570; arrayPush"></a>mixin &#x884D;&#x751F;&#x7684;&#x51FD;&#x6570; arrayPush</h3><p>&#x7C7B;&#x4F3C; [].push</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function arrayPush(array, values) {</span><br><span class="line"> var index = -1,</span><br><span class="line">  length = values.length,</span><br><span class="line">  offset = array.length;</span><br><span class="line"></span><br><span class="line"> while (++index &lt; length) {</span><br><span class="line"> array[offset + index] = values[index];</span><br><span class="line"> }</span><br><span class="line"> return array;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="mixin-&#x884D;&#x751F;&#x7684;&#x51FD;&#x6570;-copyArray"><a href="#mixin-&#x884D;&#x751F;&#x7684;&#x51FD;&#x6570;-copyArray" class="headerlink" title="mixin &#x884D;&#x751F;&#x7684;&#x51FD;&#x6570; copyArray"></a>mixin &#x884D;&#x751F;&#x7684;&#x51FD;&#x6570; copyArray</h3><p>&#x62F7;&#x8D1D;&#x6570;&#x7EC4;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function copyArray(source, array) {</span><br><span class="line"> var index = -1,</span><br><span class="line">  length = source.length;</span><br><span class="line"></span><br><span class="line"> array || (array = Array(length));</span><br><span class="line"> while (++index &lt; length) {</span><br><span class="line">  array[index] = source[index];</span><br><span class="line"> }</span><br><span class="line"> return array;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="mixin-&#x6E90;&#x7801;&#x89E3;&#x6790;"><a href="#mixin-&#x6E90;&#x7801;&#x89E3;&#x6790;" class="headerlink" title="mixin &#x6E90;&#x7801;&#x89E3;&#x6790;"></a>mixin &#x6E90;&#x7801;&#x89E3;&#x6790;</h3><p><code>lodash</code> &#x6E90;&#x7801;&#x4E2D;&#x4E24;&#x6B21;&#x8C03;&#x7528; <code>mixin</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// Add methods that return wrapped values in chain sequences.</span><br><span class="line">lodash.after = after;</span><br><span class="line">// code ... &#x7B49; 153 &#x4E2A;&#x652F;&#x6301;&#x94FE;&#x5F0F;&#x8C03;&#x7528;&#x7684;&#x65B9;&#x6CD5;</span><br><span class="line"></span><br><span class="line">// Add methods to `lodash.prototype`.</span><br><span class="line">// &#x628A;lodash&#x4E0A;&#x7684;&#x9759;&#x6001;&#x65B9;&#x6CD5;&#x8D4B;&#x503C;&#x5230; lodash.prototype &#x4E0A;</span><br><span class="line">mixin(lodash, lodash);</span><br><span class="line"></span><br><span class="line">// Add methods that return unwrapped values in chain sequences.</span><br><span class="line">lodash.add = add;</span><br><span class="line">// code ... &#x7B49; 152 &#x4E2A;&#x4E0D;&#x652F;&#x6301;&#x94FE;&#x5F0F;&#x8C03;&#x7528;&#x7684;&#x65B9;&#x6CD5;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// &#x8FD9;&#x91CC;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x8FC7;&#x6EE4; after &#x7B49;&#x652F;&#x6301;&#x94FE;&#x5F0F;&#x8C03;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x83B7;&#x53D6;&#x5230; lodash &#x4E0A;&#x7684; add &#x7B49; &#x6DFB;&#x52A0;&#x5230;lodash.prototype &#x4E0A;&#x3002;</span><br><span class="line">mixin(lodash, (function() {</span><br><span class="line"> var source = {};</span><br><span class="line"> // baseForOwn &#x8FD9;&#x91CC;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x904D;&#x5386;lodash&#x4E0A;&#x7684;&#x9759;&#x6001;&#x65B9;&#x6CD5;&#xFF0C;&#x6267;&#x884C;&#x56DE;&#x8C03;&#x51FD;&#x6570;</span><br><span class="line"> baseForOwn(lodash, function(func, methodName) {</span><br><span class="line">  // &#x7B2C;&#x4E00;&#x6B21; mixin &#x8C03;&#x7528;&#x4E86;&#x6240;&#x4EE5;&#x8D4B;&#x503C;&#x5230;&#x4E86;lodash.prototype</span><br><span class="line">  // &#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x7528; Object.hasOwnProperty &#x6392;&#x9664;&#x4E0D;&#x5728;lodash.prototype &#x4E0A;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x4E5F;&#x5C31;&#x662F; add &#x7B49; 152 &#x4E2A;&#x4E0D;&#x652F;&#x6301;&#x94FE;&#x5F0F;&#x8C03;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#x3002;</span><br><span class="line">  if (!hasOwnProperty.call(lodash.prototype, methodName)) {</span><br><span class="line">   source[methodName] = func;</span><br><span class="line">  }</span><br><span class="line"> });</span><br><span class="line"> return source;</span><br><span class="line">// &#x6700;&#x540E;&#x4E00;&#x4E2A;&#x53C2;&#x6570;options &#x7279;&#x610F;&#x6CE8;&#x660E;&#x4E0D;&#x652F;&#x6301;&#x94FE;&#x5F0F;&#x8C03;&#x7528;</span><br><span class="line">}()), { &apos;chain&apos;: false });</span><br></pre></td></tr></table></figure>

<p>&#x7ED3;&#x5408;&#x4E24;&#x6B21;&#x8C03;&#x7528;<code>mixin</code> &#x4EE3;&#x5165;&#x5230;&#x6E90;&#x7801;&#x89E3;&#x6790;&#x5982;&#x4E0B;</p>
<p>&#x70B9;&#x51FB;&#x8FD9;&#x91CC;&#x5C55;&#x5F00;mixin&#x6E90;&#x7801;&#x53CA;&#x6CE8;&#x91CA;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function mixin(object, source, options) {</span><br><span class="line"> // source &#x5BF9;&#x8C61;&#x4E2D;&#x53EF;&#x4EE5;&#x679A;&#x4E3E;&#x7684;&#x5C5E;&#x6027;</span><br><span class="line"> var props = keys(source),</span><br><span class="line">  // source &#x5BF9;&#x8C61;&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#x540D;&#x79F0;&#x6570;&#x7EC4;</span><br><span class="line">  methodNames = baseFunctions(source, props);</span><br><span class="line"></span><br><span class="line"> if (options == null &amp;&amp;</span><br><span class="line">  !(isObject(source) &amp;&amp; (methodNames.length || !props.length))) {</span><br><span class="line">  // &#x5982;&#x679C; options &#x6CA1;&#x4F20;&#x4E3A; undefined  undefined == null &#x4E3A;true</span><br><span class="line">  // &#x4E14; &#x5982;&#x679C;source &#x4E0D;&#x4E3A; &#x5BF9;&#x8C61;&#x6216;&#x8005;&#x4E0D;&#x662F;&#x51FD;&#x6570;</span><br><span class="line">  // &#x4E14; source&#x5BF9;&#x8C61;&#x7684;&#x51FD;&#x6570;&#x51FD;&#x6570;&#x957F;&#x5EA6; &#x6216;&#x8005; source &#x5BF9;&#x8C61;&#x7684;&#x5C5E;&#x6027;&#x957F;&#x5EA6;&#x4E0D;&#x4E3A;0</span><br><span class="line">  // &#x628A; options &#x8D4B;&#x503C;&#x4E3A; source</span><br><span class="line">  options = source;</span><br><span class="line">  // &#x628A; source &#x8D4B;&#x503C;&#x4E3A; object</span><br><span class="line">  source = object;</span><br><span class="line">  // &#x628A; object &#x8D4B;&#x503C;&#x4E3A; this &#x4E5F;&#x5C31;&#x662F; _ (lodash)</span><br><span class="line">  object = this;</span><br><span class="line">  // &#x83B7;&#x53D6;&#x5230;&#x6240;&#x6709;&#x7684;&#x65B9;&#x6CD5;&#x540D;&#x79F0;&#x6570;&#x7EC4;</span><br><span class="line">  methodNames = baseFunctions(source, keys(source));</span><br><span class="line"> }</span><br><span class="line"> // &#x662F;&#x5426;&#x652F;&#x6301; &#x94FE;&#x5F0F;&#x8C03;&#x7528;</span><br><span class="line"> // options  &#x4E0D;&#x662F;&#x5BF9;&#x8C61;&#x6216;&#x8005;&#x4E0D;&#x662F;&#x51FD;&#x6570;&#xFF0C;&#x662F;null&#x6216;&#x8005;&#x5176;&#x4ED6;&#x503C;</span><br><span class="line"> // &#x5224;&#x65AD;options&#x662F;&#x5426;&#x662F;&#x5BF9;&#x8C61;&#x6216;&#x8005;&#x51FD;&#x6570;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x662F;&#x6216;&#x8005;&#x51FD;&#x6570;&#x5219;&#x4E0D;&#x4F1A;&#x6267;&#x884C; &apos;chain&apos; in options &#x4E5F;&#x5C31;&#x4E0D;&#x4F1A;&#x62A5;&#x9519;</span><br><span class="line"> //  &#x4E14; chain &#x5728; options&#x7684;&#x5BF9;&#x8C61;&#x6216;&#x8005;&#x539F;&#x578B;&#x94FE;&#x4E2D;</span><br><span class="line"> // &#x77E5;&#x8BC6;&#x70B9; in [MDN in :  https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/in</span><br><span class="line"> // &#x5982;&#x679C;&#x6307;&#x5B9A;&#x7684;&#x5C5E;&#x6027;&#x5728;&#x6307;&#x5B9A;&#x7684;&#x5BF9;&#x8C61;&#x6216;&#x5176;&#x539F;&#x578B;&#x94FE;&#x4E2D;&#xFF0C;&#x5219;in &#x8FD0;&#x7B97;&#x7B26;&#x8FD4;&#x56DE;true&#x3002;</span><br><span class="line"></span><br><span class="line"> // &#x6216;&#x8005; options.chain &#x8F6C;&#x5E03;&#x5C14;&#x503C;</span><br><span class="line"> var chain = !(isObject(options) &amp;&amp; &apos;chain&apos; in options) || !!options.chain,</span><br><span class="line">  // object &#x662F;&#x51FD;&#x6570;</span><br><span class="line">  isFunc = isFunction(object);</span><br><span class="line"></span><br><span class="line"> // &#x5FAA;&#x73AF; &#x65B9;&#x6CD5;&#x540D;&#x79F0;&#x6570;&#x7EC4;</span><br><span class="line"> arrayEach(methodNames, function(methodName) {</span><br><span class="line">  // &#x51FD;&#x6570;&#x672C;&#x8EAB;</span><br><span class="line">  var func = source[methodName];</span><br><span class="line">  // object &#x901A;&#x5E38;&#x662F; lodash  &#x4E5F;&#x8D4B;&#x503C;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x3002;</span><br><span class="line">  object[methodName] = func;</span><br><span class="line">  if (isFunc) {</span><br><span class="line">   // &#x5982;&#x679C;object&#x662F;&#x51FD;&#x6570; &#x8D4B;&#x503C;&#x5230;  object prototype  &#x4E0A;&#xFF0C;&#x901A;&#x5E38;&#x662F;lodash</span><br><span class="line">   object.prototype[methodName] = function() {</span><br><span class="line">    // &#x5B9E;&#x4F8B;&#x4E0A;&#x7684;__chain__ &#x5C5E;&#x6027; &#x662F;&#x5426;&#x652F;&#x6301;&#x94FE;&#x5F0F;&#x8C03;&#x7528;</span><br><span class="line">    // &#x8FD9;&#x91CC;&#x7684; this &#x662F; new LodashWrapper &#x5B9E;&#x4F8B; &#x7C7B;&#x4F3C;&#x5982;&#x4E0B;</span><br><span class="line">    /**</span><br><span class="line">     {</span><br><span class="line">     __actions__: [],</span><br><span class="line">     __chain__: true</span><br><span class="line">     __index__: 0</span><br><span class="line">     __values__: undefined</span><br><span class="line">     __wrapped__: []</span><br><span class="line">     }</span><br><span class="line">     **/</span><br><span class="line"></span><br><span class="line">    var chainAll = this.__chain__;</span><br><span class="line">    // options &#x4E2D;&#x7684; chain &#x5C5E;&#x6027; &#x662F;&#x5426;&#x652F;&#x6301;&#x94FE;&#x5F0F;&#x8C03;&#x7528;</span><br><span class="line">    // &#x4E24;&#x8005;&#x6709;&#x4E00;&#x4E2A;&#x7B26;&#x5408;&#x94FE;&#x5F0F;&#x8C03;&#x7528;  &#x6267;&#x884C;&#x4E0B;&#x9762;&#x7684;&#x4EE3;&#x7801;</span><br><span class="line">    if (chain || chainAll) {</span><br><span class="line">     // &#x901A;&#x5E38;&#x662F; lodash</span><br><span class="line">     var result = object(this.__wrapped__),</span><br><span class="line">     // &#x590D;&#x5236; &#x5B9E;&#x4F8B;&#x4E0A;&#x7684; __action__ &#x5230; result.__action__ &#x548C; action &#x4E0A;</span><br><span class="line">     actions = result.__actions__ = copyArray(this.__actions__);</span><br><span class="line"></span><br><span class="line">     // action &#x6DFB;&#x52A0; &#x51FD;&#x6570; &#x548C; args &#x548C; this &#x6307;&#x5411;&#xFF0C;&#x5EF6;&#x8FDF;&#x8BA1;&#x7B97;&#x8C03;&#x7528;&#x3002;</span><br><span class="line">     actions.push({ &apos;func&apos;: func, &apos;args&apos;: arguments, &apos;thisArg&apos;: object });</span><br><span class="line">     //&#x5B9E;&#x4F8B;&#x4E0A;&#x7684;__chain__ &#x5C5E;&#x6027;  &#x8D4B;&#x503C;&#x7ED9; result &#x7684; &#x5C5E;&#x6027; __chain__</span><br><span class="line">     result.__chain__ = chainAll;</span><br><span class="line">     // &#x6700;&#x540E;&#x8FD4;&#x56DE;&#x8FD9;&#x4E2A;&#x5B9E;&#x4F8B;</span><br><span class="line">     return result;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    // &#x90FD;&#x4E0D;&#x652F;&#x6301;&#x94FE;&#x5F0F;&#x8C03;&#x7528;&#x3002;&#x76F4;&#x63A5;&#x8C03;&#x7528;</span><br><span class="line">    // &#x628A;&#x5F53;&#x524D;&#x5B9E;&#x4F8B;&#x7684; value &#x548C; arguments &#x5BF9;&#x8C61; &#x4F20;&#x9012;&#x7ED9; func &#x51FD;&#x6570;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x8C03;&#x7528;&#x3002;&#x8FD4;&#x56DE;&#x8C03;&#x7528;&#x7ED3;&#x679C;&#x3002;</span><br><span class="line">    return func.apply(object, arrayPush([this.value()], arguments));</span><br><span class="line">   };</span><br><span class="line">  }</span><br><span class="line"> });</span><br><span class="line"></span><br><span class="line"> // &#x6700;&#x540E;&#x8FD4;&#x56DE;&#x5BF9;&#x8C61; object</span><br><span class="line"> return object;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5C0F;&#x7ED3;&#xFF1A;&#x7B80;&#x5355;&#x8BF4;&#x5C31;&#x662F;&#x628A;<code>lodash</code>&#x4E0A;&#x7684;&#x9759;&#x6001;&#x65B9;&#x6CD5;&#x8D4B;&#x503C;&#x5230;<code>lodash.prototype</code>&#x4E0A;&#x3002;&#x5206;&#x4E24;&#x6B21;&#x7B2C;&#x4E00;&#x6B21;&#x662F;&#x652F;&#x6301;&#x94FE;&#x5F0F;&#x8C03;&#x7528;&#xFF08;<code>lodash.after</code>&#x7B49; <code>153</code>&#x4E2A;&#x652F;&#x6301;&#x94FE;&#x5F0F;&#x8C03;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#xFF09;&#xFF0C;&#x7B2C;&#x4E8C;&#x6B21;&#x662F;&#x4E0D;&#x652F;&#x6301;&#x94FE;&#x5F0F;&#x8C03;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#xFF08;<code>lodash.add</code>&#x7B49;<code>152</code>&#x4E2A;&#x4E0D;&#x652F;&#x6301;&#x94FE;&#x5F0F;&#x8C03;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#xFF09;&#x3002;</p>
<h2 id="lodash-&#x7A76;&#x7ADF;&#x5728;-&#x548C;-prototype&#x6302;&#x8F7D;&#x4E86;&#x591A;&#x5C11;&#x65B9;&#x6CD5;&#x548C;&#x5C5E;&#x6027;"><a href="#lodash-&#x7A76;&#x7ADF;&#x5728;-&#x548C;-prototype&#x6302;&#x8F7D;&#x4E86;&#x591A;&#x5C11;&#x65B9;&#x6CD5;&#x548C;&#x5C5E;&#x6027;" class="headerlink" title="lodash &#x7A76;&#x7ADF;&#x5728;_&#x548C;_.prototype&#x6302;&#x8F7D;&#x4E86;&#x591A;&#x5C11;&#x65B9;&#x6CD5;&#x548C;&#x5C5E;&#x6027;"></a>lodash &#x7A76;&#x7ADF;&#x5728;_&#x548C;_.prototype&#x6302;&#x8F7D;&#x4E86;&#x591A;&#x5C11;&#x65B9;&#x6CD5;&#x548C;&#x5C5E;&#x6027;</h2><p>&#x518D;&#x6765;&#x770B;&#x4E0B;<code>lodash</code>&#x7A76;&#x7ADF;&#x6302;&#x8F7D;&#x5728;<code>_</code>&#x51FD;&#x6570;&#x5BF9;&#x8C61;&#x4E0A;&#x6709;&#x591A;&#x5C11;&#x9759;&#x6001;&#x65B9;&#x6CD5;&#x548C;&#x5C5E;&#x6027;&#xFF0C;&#x548C;&#x6302;&#x8F7D;<code>_.prototype</code>&#x4E0A;&#x6709;&#x591A;&#x5C11;&#x65B9;&#x6CD5;&#x548C;&#x5C5E;&#x6027;&#x3002;</p>
<p>&#x4F7F;&#x7528;<code>for in</code>&#x5FAA;&#x73AF;&#x4E00;&#x8BD5;&#x4FBF;&#x77E5;&#x3002;&#x770B;&#x5982;&#x4E0B;&#x4EE3;&#x7801;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;var staticMethods = [];</span><br><span class="line">var staticProperty = [];</span><br><span class="line">for(var name in _){</span><br><span class="line"> if(typeof _[name] === &apos;function&apos;){</span><br><span class="line">  staticMethods.push(name);</span><br><span class="line"> }</span><br><span class="line"> else{</span><br><span class="line">  staticProperty.push(name);</span><br><span class="line"> }</span><br><span class="line">}</span><br><span class="line">console.log(staticProperty); // [&quot;templateSettings&quot;, &quot;VERSION&quot;] 2&#x4E2A;</span><br><span class="line">console.log(staticMethods); // [&quot;after&quot;, &quot;ary&quot;, &quot;assign&quot;, &quot;assignIn&quot;, &quot;assignInWith&quot;, ...] 305&#x4E2A;</span><br></pre></td></tr></table></figure>

<p>&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x4E0A;&#x6587;&#x63D0;&#x53CA;&#x7684; <code>lodash.after</code> &#x7B49;<code>153</code>&#x4E2A;&#x652F;&#x6301;&#x94FE;&#x5F0F;&#x8C03;&#x7528;&#x7684;&#x51FD;&#x6570; &#x3001;<code>lodash.add</code> &#x7B49; <code>152</code>&#x4E0D;&#x652F;&#x6301;&#x94FE;&#x5F0F;&#x8C03;&#x7528;&#x7684;&#x51FD;&#x6570;&#x8D4B;&#x503C;&#x800C;&#x6765;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;var prototypeMethods = [];</span><br><span class="line">var prototypeProperty = [];</span><br><span class="line">for(var name in _.prototype){</span><br><span class="line"> if(typeof _.prototype[name] === &apos;function&apos;){</span><br><span class="line">  prototypeMethods.push(name);</span><br><span class="line"> }</span><br><span class="line"> else{</span><br><span class="line">  prototypeProperty.push(name);</span><br><span class="line"> }</span><br><span class="line">}</span><br><span class="line">console.log(prototypeProperty); // []</span><br><span class="line">console.log(prototypeMethods); // [&quot;after&quot;, &quot;all&quot;, &quot;allKeys&quot;, &quot;any&quot;, &quot;assign&quot;, ...] 317&#x4E2A;</span><br></pre></td></tr></table></figure>

<p>&#x76F8;&#x6BD4;<code>lodash</code>&#x4E0A;&#x7684;&#x9759;&#x6001;&#x65B9;&#x6CD5;&#x591A;&#x4E86;<code>12</code>&#x4E2A;&#xFF0C;&#x8BF4;&#x660E;&#x9664;&#x4E86; <code>mixin</code> &#x5916;&#xFF0C;&#x8FD8;&#x6709;<code>12</code>&#x4E2A;&#x5176;&#x4ED6;&#x5F62;&#x5F0F;&#x8D4B;&#x503C;&#x800C;&#x6765;&#x3002;</p>
<p>&#x652F;&#x6301;&#x94FE;&#x5F0F;&#x8C03;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#x6700;&#x540E;&#x8FD4;&#x56DE;&#x662F;&#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;&#xFF0C;&#x83B7;&#x53D6;&#x6700;&#x540E;&#x7684;&#x5904;&#x7406;&#x7684;&#x7ED3;&#x679C;&#x503C;&#xFF0C;&#x6700;&#x540E;&#x9700;&#x8981;&#x8C03;&#x7528;<code>value</code>&#x65B9;&#x6CD5;&#x3002;</p>
<p>&#x7B14;&#x8005;&#x753B;&#x4E86;&#x4E00;&#x5F20;&#x8868;&#x793A;<code>lodash</code>&#x7684;&#x65B9;&#x6CD5;&#x548C;&#x5C5E;&#x6027;&#x6302;&#x8F7D;&#x5173;&#x7CFB;&#x56FE;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/263834b3df04d87e9c4b71138e1945febe9d739f836208608852b58185519fb3" alt="&#x7684;&#x65B9;&#x6CD5;&#x548C;&#x5C5E;&#x6027;&#x6302;&#x8F7D;&#x5173;&#x7CFB;"></p>
<p><code>lodash</code>&#x7684;&#x65B9;&#x6CD5;&#x548C;&#x5C5E;&#x6027;&#x6302;&#x8F7D;&#x5173;&#x7CFB;</p>
<h2 id="&#x8BF7;&#x51FA;&#x8D2F;&#x7A7F;&#x4E0B;&#x6587;&#x7684;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;"><a href="#&#x8BF7;&#x51FA;&#x8D2F;&#x7A7F;&#x4E0B;&#x6587;&#x7684;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;" class="headerlink" title="&#x8BF7;&#x51FA;&#x8D2F;&#x7A7F;&#x4E0B;&#x6587;&#x7684;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;"></a>&#x8BF7;&#x51FA;&#x8D2F;&#x7A7F;&#x4E0B;&#x6587;&#x7684;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;var result = _.chain([1, 2, 3, 4, 5])</span><br><span class="line">.map(el =&gt; {</span><br><span class="line"> console.log(el); // 1, 2, 3</span><br><span class="line"> return el + 1;</span><br><span class="line">})</span><br><span class="line">.take(3)</span><br><span class="line">.value();</span><br><span class="line">// lodash&#x4E2D;&#x8FD9;&#x91CC;&#x7684;`map`&#x4EC5;&#x6267;&#x884C;&#x4E86;`3`&#x6B21;&#x3002;</span><br><span class="line">// &#x5177;&#x4F53;&#x529F;&#x80FD;&#x4E5F;&#x5F88;&#x7B80;&#x5355; &#x6570;&#x7EC4; 1-5 &#x52A0;&#x4E00;&#xFF0C;&#x6700;&#x540E;&#x83B7;&#x53D6;&#x5176;&#x4E2D;&#x4E09;&#x4E2A;&#x503C;&#x3002;</span><br><span class="line">console.log(&apos;result:&apos;, result);</span><br></pre></td></tr></table></figure>

<p><strong>&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x8FD9;&#x91CC;<code>lodash</code>&#x806A;&#x660E;&#x7684;&#x77E5;&#x9053;&#x4E86;&#x6700;&#x540E;&#x9700;&#x8981;&#x51E0;&#x4E2A;&#x503C;&#xFF0C;&#x5C31;&#x6267;&#x884C;&#x51E0;&#x6B21;<code>map</code>&#x5FAA;&#x73AF;&#xFF0C;&#x5BF9;&#x4E8E;&#x5F88;&#x5927;&#x7684;&#x6570;&#x7EC4;&#xFF0C;&#x63D0;&#x5347;&#x6027;&#x80FD;&#x5F88;&#x6709;&#x5E2E;&#x52A9;&#x3002;</strong>  </p>
<p>&#x800C;<code>underscore</code>&#x6267;&#x884C;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x5176;&#x4E2D;<code>map</code>&#x6267;&#x884C;&#x4E86;5&#x6B21;&#x3002;<br>&#x5982;&#x679C;&#x662F;&#x5E73;&#x5E38;&#x5B9E;&#x73B0;&#x8BE5;&#x529F;&#x80FD;&#x4E5F;&#x7B80;&#x5355;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;var result = [1, 2, 3, 4, 5].map(el =&gt; el + 1).slice(0, 3);</span><br><span class="line">console.log(&apos;result:&apos;, result);</span><br></pre></td></tr></table></figure>

<p>&#x800C;&#x76F8;&#x6BD4;<code>lodash</code>&#x8FD9;&#x91CC;&#x7684;<code>map</code>&#x6267;&#x884C;&#x4E86;<code>5</code>&#x6B21;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// &#x4E0D;&#x4F7F;&#x7528; map&#x3001;slice</span><br><span class="line">var result = [];</span><br><span class="line">var arr = [1, 2, 3, 4, 5];</span><br><span class="line">for (var i = 0; i &lt; 3; i++){</span><br><span class="line"> result[i] = arr[i] + 1;</span><br><span class="line">}</span><br><span class="line">console.log(result, &apos;result&apos;);</span><br></pre></td></tr></table></figure>

<p>&#x7B80;&#x5355;&#x8BF4;&#x8FD9;&#x91CC;&#x7684;<code>map</code>&#x65B9;&#x6CD5;&#xFF0C;&#x6DFB;&#x52A0; <code>LazyWrapper</code> &#x7684;&#x65B9;&#x6CD5;&#x5230; <code>lodash.prototype</code>&#x5B58;&#x50A8;&#x4E0B;&#x6765;&#xFF0C;&#x6700;&#x540E;&#x8C03;&#x7528; <code>value</code>&#x65F6;&#x518D;&#x8C03;&#x7528;&#x3002;<br>&#x5177;&#x4F53;&#x770B;&#x4E0B;&#x6587;&#x6E90;&#x7801;&#x5B9E;&#x73B0;&#x3002;</p>
<h2 id="&#x6DFB;&#x52A0;-LazyWrapper-&#x7684;&#x65B9;&#x6CD5;&#x5230;-lodash-prototype"><a href="#&#x6DFB;&#x52A0;-LazyWrapper-&#x7684;&#x65B9;&#x6CD5;&#x5230;-lodash-prototype" class="headerlink" title="&#x6DFB;&#x52A0; LazyWrapper &#x7684;&#x65B9;&#x6CD5;&#x5230; lodash.prototype"></a>&#x6DFB;&#x52A0; <code>LazyWrapper</code> &#x7684;&#x65B9;&#x6CD5;&#x5230; <code>lodash.prototype</code></h2><p>&#x4E3B;&#x8981;&#x662F;&#x5982;&#x4E0B;&#x65B9;&#x6CD5;&#x6DFB;&#x52A0;&#x5230;&#x5230; <code>lodash.prototype</code> &#x539F;&#x578B;&#x4E0A;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// &quot;constructor&quot;</span><br><span class="line">[&quot;drop&quot;, &quot;dropRight&quot;, &quot;take&quot;, &quot;takeRight&quot;, &quot;filter&quot;, &quot;map&quot;, &quot;takeWhile&quot;, &quot;head&quot;, &quot;last&quot;, &quot;initial&quot;, &quot;tail&quot;, &quot;compact&quot;, &quot;find&quot;, &quot;findLast&quot;, &quot;invokeMap&quot;, &quot;reject&quot;, &quot;slice&quot;, &quot;takeRightWhile&quot;, &quot;toArray&quot;, &quot;clone&quot;, &quot;reverse&quot;, &quot;value&quot;]</span><br></pre></td></tr></table></figure>

<p>&#x70B9;&#x51FB;&#x8FD9;&#x91CC;&#x5C55;&#x5F00;&#x5177;&#x4F53;&#x6E90;&#x7801;&#x53CA;&#x6CE8;&#x91CA;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// Add `LazyWrapper` methods to `lodash.prototype`.</span><br><span class="line">// baseForOwn &#x8FD9;&#x91CC;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x904D;&#x5386;LazyWrapper.prototype&#x4E0A;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x6267;&#x884C;&#x56DE;&#x8C03;&#x51FD;&#x6570;</span><br><span class="line">baseForOwn(LazyWrapper.prototype, function(func, methodName) {</span><br><span class="line"> // &#x68C0;&#x6D4B;&#x51FD;&#x6570;&#x540D;&#x79F0;&#x662F;&#x5426;&#x662F;&#x8FED;&#x4EE3;&#x5668;&#x4E5F;&#x5C31;&#x662F;&#x5FAA;&#x73AF;</span><br><span class="line"> var checkIteratee = /^(?:filter|find|map|reject)|While$/.test(methodName),</span><br><span class="line">  // &#x68C0;&#x6D4B;&#x51FD;&#x6570;&#x540D;&#x79F0;&#x662F;&#x5426;head&#x548C;last</span><br><span class="line">  // &#x987A;&#x4FBF;&#x63D0;&#x4E00;&#x4E0B; ()&#x8FD9;&#x4E2A;&#x662F;&#x6355;&#x83B7;&#x5206;&#x7EC4; &#x800C;&#x52A0;&#x4E0A; ?:  &#x5219;&#x662F;&#x975E;&#x6355;&#x83B7;&#x5206;&#x7EC4; &#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x4E0D;&#x7528;&#x4E8E;&#x5176;&#x4ED6;&#x64CD;&#x4F5C;</span><br><span class="line">  isTaker = /^(?:head|last)$/.test(methodName),</span><br><span class="line">  // lodashFunc &#x662F; &#x6839;&#x636E; isTaker &#x7EC4;&#x5408; takeRight take methodName</span><br><span class="line">  lodashFunc = lodash[isTaker ? (&apos;take&apos; + (methodName == &apos;last&apos; ? &apos;Right&apos; : &apos;&apos;)) : methodName],</span><br><span class="line">  // &#x6839;&#x636E;isTaker &#x548C; &#x662F; find &#x5224;&#x65AD;&#x7ED3;&#x679C;&#x662F;&#x5426; &#x5305;&#x88C5;</span><br><span class="line">  retUnwrapped = isTaker || /^find/.test(methodName);</span><br><span class="line"></span><br><span class="line"> // &#x5982;&#x679C;&#x4E0D;&#x5B58;&#x5728;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x5C31;&#x4E0D;&#x5F80;&#x4E0B;&#x6267;&#x884C;</span><br><span class="line"> if (!lodashFunc) {</span><br><span class="line">  return;</span><br><span class="line"> }</span><br><span class="line"> // &#x628A; lodash.prototype &#x65B9;&#x6CD5;&#x8D4B;&#x503C;&#x5230;lodash.prototype</span><br><span class="line"> lodash.prototype[methodName] = function() {</span><br><span class="line">  // &#x53D6;&#x5B9E;&#x4F8B;&#x4E2D;&#x7684;__wrapped__ &#x503C; &#x4F8B;&#x5B50;&#x4E2D;&#x5219;&#x662F; [1,2,3,4,5]</span><br><span class="line">  var value = this.__wrapped__,</span><br><span class="line">   // &#x5982;&#x679C;&#x662F;head&#x548C;last &#x65B9;&#x6CD5; isTaker &#x8FD4;&#x56DE; [1], &#x5426;&#x5219;&#x662F;arguments&#x5BF9;&#x8C61;</span><br><span class="line">   args = isTaker ? [1] : arguments,</span><br><span class="line">   // &#x5982;&#x679C;value &#x662F;LayeWrapper&#x7684;&#x5B9E;&#x4F8B;</span><br><span class="line">   isLazy = value instanceof LazyWrapper,</span><br><span class="line">   // &#x8FED;&#x4EE3;&#x5668; &#x5FAA;&#x73AF;</span><br><span class="line">   iteratee = args[0],</span><br><span class="line">   // &#x4F7F;&#x7528;useLazy isLazy value&#x6216;&#x8005;&#x662F;&#x6570;&#x7EC4;</span><br><span class="line">   useLazy = isLazy || isArray(value);</span><br><span class="line"></span><br><span class="line">  var interceptor = function(value) {</span><br><span class="line">   // &#x51FD;&#x6570;&#x6267;&#x884C; value args &#x7EC4;&#x5408;&#x6210;&#x6570;&#x7EC4;&#x53C2;&#x6570;</span><br><span class="line">   var result = lodashFunc.apply(lodash, arrayPush([value], args));</span><br><span class="line">   // &#x5982;&#x679C;&#x662F; head &#x548C; last (isTaker) &#x652F;&#x6301;&#x94FE;&#x5F0F;&#x8C03;&#x7528; &#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570; &#x5426;&#x5219; &#x8FD4;&#x56DE;result</span><br><span class="line">   return (isTaker &amp;&amp; chainAll) ? result[0] : result;</span><br><span class="line">  };</span><br><span class="line"></span><br><span class="line">  // useLazy true &#x5E76;&#x4E14; &#x51FD;&#x6570;checkIteratee &#x4E14;&#x8FED;&#x4EE3;&#x5668;&#x662F;&#x51FD;&#x6570;&#xFF0C;&#x4E14;&#x8FED;&#x4EE3;&#x5668;&#x53C2;&#x6570;&#x4E2A;&#x6570;&#x4E0D;&#x7B49;&#x4E8E;1</span><br><span class="line">  if (useLazy &amp;&amp; checkIteratee &amp;&amp; typeof iteratee == &apos;function&apos; &amp;&amp; iteratee.length != 1) {</span><br><span class="line">   // Avoid lazy use if the iteratee has a &quot;length&quot; value other than `1`.</span><br><span class="line">   // useLazy &#x8D4B;&#x503C;&#x4E3A; false</span><br><span class="line">   // isLazy &#x8D4B;&#x503C;&#x4E3A; false</span><br><span class="line">   isLazy = useLazy = false;</span><br><span class="line">  }</span><br><span class="line">  // &#x53D6;&#x5B9E;&#x4F8B;&#x4E0A;&#x7684; __chain__</span><br><span class="line">  var chainAll = this.__chain__,</span><br><span class="line">   // &#x5B58;&#x50A8;&#x7684;&#x5F85;&#x6267;&#x884C;&#x7684;&#x51FD;&#x6570; __actions__ &#x4E8C;&#x6B21;&#x53D6;&#x53CD;&#x662F;&#x5E03;&#x5C14;&#x503C; &#x4E5F;&#x5C31;&#x662F;&#x7B49;&#x4E8E;0&#x6216;&#x8005;&#x5927;&#x4E8E;0&#x4E24;&#x79CD;&#x7ED3;&#x679C;</span><br><span class="line">   isHybrid = !!this.__actions__.length,</span><br><span class="line">   // &#x662F;&#x5426;&#x4E0D;&#x5305;&#x88C5; &#x7528;&#x7ED3;&#x679C;&#x662F;&#x5426;&#x4E0D;&#x5305;&#x88C5; &#x4E14; &#x4E0D;&#x652F;&#x6301;&#x94FE;&#x5F0F;&#x8C03;&#x7528;</span><br><span class="line">   isUnwrapped = retUnwrapped &amp;&amp; !chainAll,</span><br><span class="line">   // &#x662F;&#x5426;&#x4EC5;Lazy &#x7528;isLazy &#x548C; &#x5B58;&#x50A8;&#x7684;&#x51FD;&#x6570;</span><br><span class="line">   onlyLazy = isLazy &amp;&amp; !isHybrid;</span><br><span class="line"></span><br><span class="line">  // &#x7ED3;&#x679C;&#x4E0D;&#x5305;&#x88C5; &#x4E14; useLazy &#x4E3A; true</span><br><span class="line">  if (!retUnwrapped &amp;&amp; useLazy) {</span><br><span class="line">   // &#x5B9E;&#x4F8B; new LazyWrapper &#x8FD9;&#x91CC;&#x7684;this &#x662F; new LodashWrapper()</span><br><span class="line">   value = onlyLazy ? value : new LazyWrapper(this);</span><br><span class="line">   // result &#x6267;&#x884C;&#x51FD;&#x6570;&#x7ED3;&#x679C;</span><br><span class="line">   var result = func.apply(value, args);</span><br><span class="line"></span><br><span class="line">   /*</span><br><span class="line">   *</span><br><span class="line">   // _.thru(value, interceptor)</span><br><span class="line">   // &#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x7C7B;&#x4F3C; _.tap&#xFF0C; &#x9664;&#x4E86;&#x5B83;&#x8FD4;&#x56DE; interceptor &#x7684;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x3002;&#x8BE5;&#x65B9;&#x6CD5;&#x7684;&#x76EE;&#x7684;&#x662F;&quot;&#x4F20;&#x9012;&quot; &#x503C;&#x5230;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#x94FE;&#x5E8F;&#x5217;&#x4EE5;&#x53D6;&#x4EE3;&#x4E2D;&#x95F4;&#x7ED3;&#x679C;&#x3002;</span><br><span class="line">   _([1, 2, 3])</span><br><span class="line">   .tap(function(array) {</span><br><span class="line">    // &#x6539;&#x53D8;&#x4F20;&#x5165;&#x7684;&#x6570;&#x7EC4;</span><br><span class="line">    array.pop();</span><br><span class="line">   })</span><br><span class="line">   .reverse()</span><br><span class="line">   .value();</span><br><span class="line">   // =&gt; [2, 1]</span><br><span class="line">   */</span><br><span class="line"></span><br><span class="line">   // thisArg &#x6307;&#x5411;undefined &#x6216;&#x8005;null &#x975E;&#x4E25;&#x683C;&#x6A21;&#x5F0F;&#x4E0B;&#x662F;&#x6307;&#x5411;window&#xFF0C;&#x4E25;&#x683C;&#x6A21;&#x5F0F;&#x662F;undefined &#x6216;&#x8005;nll</span><br><span class="line">   result.__actions__.push({ &apos;func&apos;: thru, &apos;args&apos;: [interceptor], &apos;thisArg&apos;: undefined });</span><br><span class="line">   // &#x8FD4;&#x56DE;&#x5B9E;&#x4F8B; lodashWrapper</span><br><span class="line">   return new LodashWrapper(result, chainAll);</span><br><span class="line">  }</span><br><span class="line">  // &#x4E0D;&#x5305;&#x88C5; &#x4E14; onlyLazy &#x4E3A; true</span><br><span class="line">  if (isUnwrapped &amp;&amp; onlyLazy) {</span><br><span class="line">   // &#x6267;&#x884C;&#x51FD;&#x6570;</span><br><span class="line">   return func.apply(this, args);</span><br><span class="line">  }</span><br><span class="line">  // &#x4E0A;&#x9762;&#x90FD;&#x6CA1;&#x6709;&#x6267;&#x884C;&#xFF0C;&#x6267;&#x884C;&#x5230;&#x8FD9;&#x91CC;&#x4E86;</span><br><span class="line">  // &#x6267;&#x884C; thru &#x51FD;&#x6570;&#xFF0C;&#x56DE;&#x8C03;&#x51FD;&#x6570; &#x662F; interceptor</span><br><span class="line">  result = this.thru(interceptor);</span><br><span class="line">  return isUnwrapped ? (isTaker ? result.value()[0] : result.value()) : result;</span><br><span class="line"> };</span><br><span class="line">});</span><br></pre></td></tr></table></figure>

<p>&#x5C0F;&#x7ED3;&#x4E00;&#x4E0B;&#xFF0C;&#x5199;&#x4E86;&#x8FD9;&#x4E48;&#x591A;&#x6CE8;&#x91CA;&#xFF0C;&#x7B80;&#x5355;&#x8BF4;&#xFF1A;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x7528;<code>LazyWrapper.prototype</code> &#x6539;&#x5199;&#x539F;&#x5148;&#x5728;<code>lodash.prototype</code>&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x5224;&#x65AD;&#x51FD;&#x6570;&#x662F;&#x5426;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x60F0;&#x6027;&#x6C42;&#x503C;&#xFF0C;&#x9700;&#x8981;&#x65F6;&#x518D;&#x8C03;&#x7528;&#x3002;</p>
<p><strong>&#x8BFB;&#x8005;&#x53EF;&#x4EE5;&#x65AD;&#x70B9;&#x8C03;&#x8BD5;&#x4E00;&#x4E0B;&#xFF0C;&#x5584;&#x7528;&#x65AD;&#x70B9;&#x8FDB;&#x5165;&#x51FD;&#x6570;&#x529F;&#x80FD;&#xFF0C;&#x5BF9;&#x7740;&#x6CE8;&#x91CA;&#x770B;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x66F4;&#x52A0;&#x6E05;&#x6670;&#x3002;</strong></p>
<p>&#x70B9;&#x51FB;&#x67E5;&#x770B;&#x65AD;&#x70B9;&#x8C03;&#x8BD5;&#x7684;&#x90E8;&#x5206;&#x622A;&#x56FE;<br><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/d115547f954ef044e01e787af84558d70e635f9b47979e75b0ab21cf83d9de8e" alt="&#x4F8B;&#x5B50;&#x7684;chain&#x548C;map&#x6267;&#x884C;&#x540E;&#x7684;debugger&#x622A;&#x56FE;"></p>
<p>&#x4F8B;&#x5B50;&#x7684;chain&#x548C;map&#x6267;&#x884C;&#x540E;&#x7684;debugger&#x622A;&#x56FE;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/0ea3edf4a014bf64da54e1f7e6ed11417f00da5e7910686e3baf4b11db1d4d87" alt="&#x4F8B;&#x5B50;&#x7684;chain&#x548C;map&#x6267;&#x884C;&#x540E;&#x7684;&#x7ED3;&#x679C;&#x622A;&#x56FE;"></p>
<p>&#x4F8B;&#x5B50;&#x7684;chain&#x548C;map&#x6267;&#x884C;&#x540E;&#x7684;&#x7ED3;&#x679C;&#x622A;&#x56FE;</p>
<p>&#x94FE;&#x5F0F;&#x8C03;&#x7528;&#x6700;&#x540E;&#x90FD;&#x662F;&#x8FD4;&#x56DE;&#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;&#xFF0C;&#x5B9E;&#x9645;&#x7684;&#x5904;&#x7406;&#x6570;&#x636E;&#x7684;&#x51FD;&#x6570;&#x90FD;&#x6CA1;&#x6709;&#x8C03;&#x7528;&#xFF0C;&#x800C;&#x662F;&#x88AB;&#x5B58;&#x50A8;&#x5B58;&#x50A8;&#x4E0B;&#x6765;&#x4E86;&#xFF0C;&#x6700;&#x540E;&#x8C03;&#x7528;<code>value</code>&#x65B9;&#x6CD5;&#xFF0C;&#x624D;&#x6267;&#x884C;&#x8FD9;&#x4E9B;&#x51FD;&#x6570;&#x3002;</p>
<h2 id="lodash-prototype-value-&#x5373;-wrapperValue"><a href="#lodash-prototype-value-&#x5373;-wrapperValue" class="headerlink" title="lodash.prototype.value &#x5373; wrapperValue"></a>lodash.prototype.value &#x5373; wrapperValue</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function baseWrapperValue(value, actions) {</span><br><span class="line"> var result = value;</span><br><span class="line"> // &#x5982;&#x679C;&#x662F;lazyWrapper&#x7684;&#x5B9E;&#x4F8B;&#xFF0C;&#x5219;&#x8C03;&#x7528;LazyWrapper.prototype.value &#x65B9;&#x6CD5;&#xFF0C;&#x4E5F;&#x5C31;&#x662F; lazyValue &#x65B9;&#x6CD5;</span><br><span class="line"> if (result instanceof LazyWrapper) {</span><br><span class="line">  result = result.value();</span><br><span class="line"> }</span><br><span class="line"> // &#x7C7B;&#x4F3C; [].reduce()&#xFF0C;&#x628A;&#x4E0A;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x4F20;&#x9012;&#x7ED9;&#x4E0B;&#x4E00;&#x4E2A;&#x51FD;&#x6570;</span><br><span class="line"> return arrayReduce(actions, function(result, action) {</span><br><span class="line">  return action.func.apply(action.thisArg, arrayPush([result], action.args));</span><br><span class="line"> }, result);</span><br><span class="line">}</span><br><span class="line">function wrapperValue() {</span><br><span class="line"> return baseWrapperValue(this.__wrapped__, this.__actions__);</span><br><span class="line">}</span><br><span class="line">lodash.prototype.toJSON = lodash.prototype.valueOf = lodash.prototype.value = wrapperValue;</span><br></pre></td></tr></table></figure>

<p>&#x5982;&#x679C;&#x662F;&#x60F0;&#x6027;&#x6C42;&#x503C;&#xFF0C;&#x5219;&#x8C03;&#x7528;&#x7684;&#x662F; <code>LazyWrapper.prototype.value</code> &#x5373; <code>lazyValue</code>&#x3002;</p>
<h2 id="LazyWrapper-prototype-value-&#x5373;-lazyValue-&#x60F0;&#x6027;&#x6C42;&#x503C;"><a href="#LazyWrapper-prototype-value-&#x5373;-lazyValue-&#x60F0;&#x6027;&#x6C42;&#x503C;" class="headerlink" title="LazyWrapper.prototype.value &#x5373; lazyValue &#x60F0;&#x6027;&#x6C42;&#x503C;"></a>LazyWrapper.prototype.value &#x5373; lazyValue &#x60F0;&#x6027;&#x6C42;&#x503C;</h2><p>&#x70B9;&#x51FB;&#x8FD9;&#x91CC;&#x5C55;&#x5F00;lazyValue&#x6E90;&#x7801;&#x53CA;&#x6CE8;&#x91CA;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function LazyWrapper(value) {</span><br><span class="line"> // &#x53C2;&#x6570; value</span><br><span class="line"> this.__wrapped__ = value;</span><br><span class="line"> // &#x6267;&#x884C;&#x7684;&#x51FD;&#x6570;</span><br><span class="line"> this.__actions__ = [];</span><br><span class="line"> this.__dir__ = 1;</span><br><span class="line"> // &#x8FC7;&#x6EE4;</span><br><span class="line"> this.__filtered__ = false;</span><br><span class="line"> // &#x5B58;&#x50A8;&#x8FED;&#x4EE3;&#x5668;&#x51FD;&#x6570;</span><br><span class="line"> this.__iteratees__ = [];</span><br><span class="line"> // &#x9ED8;&#x8BA4;&#x6700;&#x5927;&#x53D6;&#x503C;&#x4E2A;&#x6570;</span><br><span class="line"> this.__takeCount__ = MAX_ARRAY_LENGTH;</span><br><span class="line"> // &#x5177;&#x4F53;&#x53D6;&#x503C;&#x591A;&#x5C11;&#x4E2A;&#xFF0C;&#x5B58;&#x50A8;&#x51FD;&#x6570;&#x548C;&#x7C7B;&#x578B;</span><br><span class="line"> this.__views__ = [];</span><br><span class="line">}</span><br><span class="line">/**</span><br><span class="line">* Extracts the unwrapped value from its lazy wrapper.</span><br><span class="line">*</span><br><span class="line">* @private</span><br><span class="line">* @name value</span><br><span class="line">* @memberOf LazyWrapper</span><br><span class="line">* @returns {*} Returns the unwrapped value.</span><br><span class="line">*/</span><br><span class="line">function lazyValue() {</span><br><span class="line"> // this.__wrapped__ &#x662F; new LodashWrapper &#x5B9E;&#x4F8B; &#x6240;&#x4EE5;&#x6267;&#x884C;.value &#x83B7;&#x53D6;&#x539F;&#x59CB;&#x503C;</span><br><span class="line"> var array = this.__wrapped__.value(),</span><br><span class="line">  //</span><br><span class="line">  dir = this.__dir__,</span><br><span class="line">  // &#x662F;&#x5426;&#x662F;&#x51FD;&#x6570;</span><br><span class="line">  isArr = isArray(array),</span><br><span class="line">  // &#x662F;&#x5426;&#x4ECE;&#x53F3;&#x8FB9;&#x5F00;&#x59CB;</span><br><span class="line">  isRight = dir &lt; 0,</span><br><span class="line">  // &#x6570;&#x7EC4;&#x7684;&#x957F;&#x5EA6;&#x3002;&#x5982;&#x679C;&#x4E0D;&#x662F;&#x6570;&#x7EC4;&#xFF0C;&#x5219;&#x662F;0</span><br><span class="line">  arrLength = isArr ? array.length : 0,</span><br><span class="line">  // &#x83B7;&#x53D6; take(3) &#x4E0A;&#x8FF0;&#x4F8B;&#x5B50;&#x4E2D; &#x5219;&#x662F; start: 0&#xFF0C;end: 3</span><br><span class="line">  view = getView(0, arrLength, this.__views__),</span><br><span class="line">  start = view.start,</span><br><span class="line">  end = view.end,</span><br><span class="line">  // &#x957F;&#x5EA6; 3</span><br><span class="line">  length = end - start,</span><br><span class="line">  // &#x5982;&#x679C;&#x662F;&#x662F;&#x4ECE;&#x53F3;&#x5F00;&#x59CB;</span><br><span class="line">  index = isRight ? end : (start - 1),</span><br><span class="line">  // &#x5B58;&#x50A8;&#x7684;&#x8FED;&#x4EE3;&#x5668;&#x6570;&#x7EC4;</span><br><span class="line">  iteratees = this.__iteratees__,</span><br><span class="line">  // &#x8FED;&#x4EE3;&#x5668;&#x6570;&#x7EC4;&#x957F;&#x5EA6;</span><br><span class="line">  iterLength = iteratees.length,</span><br><span class="line">  // &#x7ED3;&#x679C;resIndex</span><br><span class="line">  resIndex = 0,</span><br><span class="line">  // &#x6700;&#x540E;&#x83B7;&#x53D6;&#x51E0;&#x4E2A;&#x503C;&#xFF0C;&#x4E5F;&#x5C31;&#x662F; 3</span><br><span class="line">  takeCount = nativeMin(length, this.__takeCount__);</span><br><span class="line"></span><br><span class="line"> // &#x5982;&#x679C;&#x4E0D;&#x662F;&#x6570;&#x7EC4;&#xFF0C;&#x6216;&#x8005; &#x4E0D;&#x662F;&#x4ECE;&#x53F3;&#x5F00;&#x59CB; &#x5E76;&#x4E14; &#x53C2;&#x6570;&#x6570;&#x7EC4;&#x957F;&#x5EA6;&#x7B49;&#x4E8E;take&#x7684;&#x957F;&#x5EA6; takeCount&#x7B49;&#x4E8E;&#x957F;&#x5EA6;</span><br><span class="line"> // &#x5219;&#x76F4;&#x63A5;&#x8C03;&#x7528; baseWrapperValue &#x4E0D;&#x9700;&#x8981;</span><br><span class="line"> if (!isArr || (!isRight &amp;&amp; arrLength == length &amp;&amp; takeCount == length)) {</span><br><span class="line">  return baseWrapperValue(array, this.__actions__);</span><br><span class="line"> }</span><br><span class="line"> var result = [];</span><br><span class="line"></span><br><span class="line"> // &#x6807;&#x7B7E;&#x8BED;&#x53E5; label</span><br><span class="line"> // MDN label &#x94FE;&#x63A5;</span><br><span class="line"> // https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/label</span><br><span class="line"> // &#x6807;&#x8BB0;&#x8BED;&#x53E5;&#x53EF;&#x4EE5;&#x548C; break &#x6216; continue &#x8BED;&#x53E5;&#x4E00;&#x8D77;&#x4F7F;&#x7528;&#x3002;&#x6807;&#x8BB0;&#x5C31;&#x662F;&#x5728;&#x4E00;&#x6761;&#x8BED;&#x53E5;&#x524D;&#x9762;&#x52A0;&#x4E2A;&#x53EF;&#x4EE5;&#x5F15;&#x7528;&#x7684;&#x6807;&#x8BC6;&#x7B26;&#xFF08;identifier&#xFF09;&#x3002;</span><br><span class="line"> outer:</span><br><span class="line"> while (length-- &amp;&amp; resIndex &lt; takeCount) {</span><br><span class="line">  index += dir;</span><br><span class="line"></span><br><span class="line">  var iterIndex = -1,</span><br><span class="line">   // &#x6570;&#x7EC4;&#x7B2C;&#x4E00;&#x9879;</span><br><span class="line">   value = array[index];</span><br><span class="line"></span><br><span class="line">  while (++iterIndex &lt; iterLength) {</span><br><span class="line">   // &#x8FED;&#x4EE3;&#x5668;&#x6570;&#x7EC4; {iteratee: function{}, typy: 2}</span><br><span class="line">   var data = iteratees[iterIndex],</span><br><span class="line">    iteratee = data.iteratee,</span><br><span class="line">    type = data.type,</span><br><span class="line">    // &#x7ED3;&#x679C; &#x8FED;&#x4EE3;&#x5668;&#x6267;&#x884C;&#x7ED3;&#x679C;</span><br><span class="line">    computed = iteratee(value);</span><br><span class="line"></span><br><span class="line">   if (type == LAZY_MAP_FLAG) {</span><br><span class="line">    // &#x5982;&#x679C; type &#x662F; map &#x7C7B;&#x578B;&#xFF0C;&#x7ED3;&#x679C; computed &#x8D4B;&#x503C;&#x7ED9;value</span><br><span class="line">    value = computed;</span><br><span class="line">   } else if (!computed) {</span><br><span class="line">    if (type == LAZY_FILTER_FLAG) {</span><br><span class="line">     // &#x9000;&#x51FA;&#x5F53;&#x524D;&#x8FD9;&#x6B21;&#x5FAA;&#x73AF;&#xFF0C;&#x8FDB;&#x884C;&#x4E0B;&#x4E00;&#x6B21;&#x5FAA;&#x73AF;</span><br><span class="line">     continue outer;</span><br><span class="line">    } else {</span><br><span class="line">     // &#x9000;&#x51FA;&#x6574;&#x4E2A;&#x5FAA;&#x73AF;</span><br><span class="line">     break outer;</span><br><span class="line">    }</span><br><span class="line">   }</span><br><span class="line">  }</span><br><span class="line">  // &#x6700;&#x7EC8;&#x6570;&#x7EC4;</span><br><span class="line">  result[resIndex++] = value;</span><br><span class="line"> }</span><br><span class="line"> // &#x8FD4;&#x56DE;&#x6570;&#x7EC4; &#x4F8B;&#x5B50;&#x4E2D;&#x5219;&#x662F; [2, 3, 4]</span><br><span class="line"> return result;</span><br><span class="line">}</span><br><span class="line">// Ensure `LazyWrapper` is an instance of `baseLodash`.</span><br><span class="line">LazyWrapper.prototype = baseCreate(baseLodash.prototype);</span><br><span class="line">LazyWrapper.prototype.constructor = LazyWrapper;</span><br><span class="line"></span><br><span class="line">LazyWrapper.prototype.value = lazyValue;</span><br></pre></td></tr></table></figure>

<p>&#x7B14;&#x8005;&#x753B;&#x4E86;&#x4E00;&#x5F20; <code>lodash</code>&#x548C;<code>LazyWrapper</code>&#x7684;&#x5173;&#x7CFB;&#x56FE;&#x6765;&#x8868;&#x793A;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/1bd6e3f9cf96117f468f606189a6c5597ffbcc25b9c75a1dd71a6a4a585f8f37" alt="&#x548C;&#x7684;&#x5173;&#x7CFB;&#x56FE;"></p>
<p><code>lodash</code>&#x548C;<code>LazyWrapper</code>&#x7684;&#x5173;&#x7CFB;&#x56FE;</p>
<p>&#x5C0F;&#x7ED3;&#xFF1A;<code>lazyValue</code>&#x7B80;&#x5355;&#x8BF4;&#x5B9E;&#x73B0;&#x7684;&#x529F;&#x80FD;&#x5C31;&#x662F;&#x628A;&#x4E4B;&#x524D;&#x8BB0;&#x5F55;&#x7684;&#x9700;&#x8981;&#x6267;&#x884C;&#x51E0;&#x6B21;&#xFF0C;&#x628A;&#x8BB0;&#x5F55;&#x5B58;&#x50A8;&#x7684;&#x51FD;&#x6570;&#x6267;&#x884C;&#x51E0;&#x6B21;&#xFF0C;&#x4E0D;&#x4F1A;&#x6709;&#x591A;&#x5C11;&#x9879;&#x6570;&#x636E;&#x5C31;&#x6267;&#x884C;&#x591A;&#x5C11;&#x6B21;&#xFF0C;&#x800C;&#x662F;&#x6839;&#x636E;&#x9700;&#x8981;&#x51E0;&#x9879;&#xFF0C;&#x6267;&#x884C;&#x51E0;&#x9879;&#x3002;<br>&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x4EE5;&#x4E0B;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;<code>map</code>&#x51FD;&#x6570;&#x53EA;&#x4F1A;&#x6267;&#x884C;<code>3</code>&#x6B21;&#x3002;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x7528;&#x60F0;&#x6027;&#x6C42;&#x503C;&#xFF0C;&#x90A3;&#x4E48;<code>map</code>&#x51FD;&#x6570;&#x4F1A;&#x6267;&#x884C;<code>5</code>&#x6B21;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;var result = _.chain([1, 2, 3, 4, 5])</span><br><span class="line">.map(el =&gt; el + 1)</span><br><span class="line">.take(3)</span><br><span class="line">.value();</span><br></pre></td></tr></table></figure>

<h2 id="&#x603B;&#x7ED3;"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3;</h2><p>&#x884C;&#x6587;&#x81F3;&#x6B64;&#xFF0C;&#x57FA;&#x672C;&#x63A5;&#x8FD1;&#x5C3E;&#x58F0;&#xFF0C;&#x6700;&#x540E;&#x603B;&#x7ED3;&#x4E00;&#x4E0B;&#x3002;</p>
<blockquote>
<p>&#x6587;&#x7AE0;&#x4E3B;&#x8981;&#x5B66;&#x4E60;&#x4E86;<code>runInContext()</code> &#x5BFC;&#x51FA;<code>_</code> <code>lodash</code>&#x51FD;&#x6570;&#x4F7F;&#x7528;<code>baseCreate</code>&#x65B9;&#x6CD5;&#x539F;&#x578B;&#x7EE7;&#x627F;<code>LodashWrapper</code>&#x548C;<code>LazyWrapper</code>&#xFF0C;<code>mixin</code>&#x6302;&#x8F7D;&#x65B9;&#x6CD5;&#x5230;<code>lodash.prototype</code>&#x3001;&#x540E;&#x6587;&#x7528;&#x7ED3;&#x5408;&#x4F8B;&#x5B50;&#x89E3;&#x91CA;<code>lodash.prototype.value(wrapperValue)</code>&#x548C;<code>Lazy.prototype.value(lazyValue)</code>&#x60F0;&#x6027;&#x6C42;&#x503C;&#x7684;&#x6E90;&#x7801;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x3002;</p>
</blockquote>
<p><strong>&#x5206;&#x4EAB;&#x4E00;&#x4E2A;&#x53EA;&#x77E5;&#x9053;&#x51FD;&#x6570;&#x540D;&#x627E;&#x6E90;&#x7801;&#x5B9A;&#x4F4D;&#x51FD;&#x6570;&#x7533;&#x660E;&#x4F4D;&#x7F6E;&#x7684;<code>VSCode</code> &#x6280;&#x5DE7;</strong>&#xFF1A;<code>Ctrl + p</code>&#x3002;&#x8F93;&#x5165; <code>@functionName</code> &#x5B9A;&#x4F4D;&#x51FD;&#x6570;<code>functionName</code>&#x5728;&#x6E90;&#x7801;&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x5177;&#x4F53;&#x4F4D;&#x7F6E;&#x3002;&#x5982;&#x679C;&#x77E5;&#x9053;&#x8C03;&#x7528;&#x4F4D;&#x7F6E;&#xFF0C;&#x90A3;&#x76F4;&#x63A5;&#x6309;<code>alt+&#x9F20;&#x6807;&#x5DE6;&#x952E;</code>&#x5373;&#x53EF;&#x8DF3;&#x8F6C;&#x5230;&#x51FD;&#x6570;&#x7533;&#x660E;&#x7684;&#x4F4D;&#x7F6E;&#x3002;</p>
<p>&#x5982;&#x679C;&#x8BFB;&#x8005;&#x53D1;&#x73B0;&#x6709;&#x4E0D;&#x59A5;&#x6216;&#x53EF;&#x6539;&#x5584;&#x4E4B;&#x5904;&#xFF0C;&#x518D;&#x6216;&#x8005;&#x54EA;&#x91CC;&#x6CA1;&#x5199;&#x660E;&#x767D;&#x7684;&#x5730;&#x65B9;&#xFF0C;&#x6B22;&#x8FCE;&#x8BC4;&#x8BBA;&#x6307;&#x51FA;&#x3002;&#x53E6;&#x5916;&#x89C9;&#x5F97;&#x5199;&#x5F97;&#x4E0D;&#x9519;&#xFF0C;&#x5BF9;&#x60A8;&#x6709;&#x4E9B;&#x8BB8;&#x5E2E;&#x52A9;&#xFF0C;&#x53EF;&#x4EE5;&#x70B9;&#x8D5E;&#x3001;&#x8BC4;&#x8BBA;&#x3001;&#x8F6C;&#x53D1;&#x5206;&#x4EAB;&#xFF0C;&#x4E5F;&#x662F;&#x5BF9;&#x7B14;&#x8005;&#x7684;&#x4E00;&#x79CD;&#x652F;&#x6301;&#x3002;&#x4E07;&#x5206;&#x611F;&#x8C22;&#x3002;</p>
<h2 id="&#x63A8;&#x8350;&#x9605;&#x8BFB;"><a href="#&#x63A8;&#x8350;&#x9605;&#x8BFB;" class="headerlink" title="&#x63A8;&#x8350;&#x9605;&#x8BFB;"></a>&#x63A8;&#x8350;&#x9605;&#x8BFB;</h2><p><a href="/external_links/6b6782b27cb1c8f20bcba48271cea0fc.html" target="blank" rel="noopener">lodash &#x4ED3;&#x5E93;</a> | <a href="/external_links/d1c9f89bcdd86b8b82ca2e2752935957.html" target="blank" rel="noopener">lodash &#x5B98;&#x65B9;&#x6587;&#x6863;</a> | <a href="/external_links/5cfe2cd3ec1e5ba55ca7a299d9dbde6d.html" target="blank" rel="noopener">lodash &#x4E2D;&#x6587;&#x6587;&#x6863;</a>  </p>
<p><a href="/external_links/bb088b63b51e58b6d58703a1115e97b7.html" target="blank" rel="noopener">&#x6253;&#x9020;&#x4E00;&#x4E2A;&#x7C7B;&#x4F3C;&#x4E8E;lodash&#x7684;&#x524D;&#x7AEF;&#x5DE5;&#x5177;&#x5E93;</a>  </p>
<p><a href="https://dev.newban.cn/6844903661450035207">&#x60F0;&#x6027;&#x6C42;&#x503C;&#x2014;&#x2014;lodash&#x6E90;&#x7801;&#x89E3;&#x8BFB;</a>  </p>
<p><a href="/external_links/f1f21c1600ce3a0cd56f88807fb595a6.html" target="blank" rel="noopener">luobo tang&#xFF1A;lazy.js &#x60F0;&#x6027;&#x6C42;&#x503C;&#x5B9E;&#x73B0;&#x5206;&#x6790;</a>  </p>
<p><a href="/external_links/d82d1bf1be41ba30feb3a2630b09aa7b.html" target="blank" rel="noopener">lazy.js github &#x4ED3;&#x5E93;</a>  </p>
<p><a href="/external_links/dc70643c05ab331c5f357e26f0048072.html" target="blank" rel="noopener">&#x672C;&#x6587;&#x7AE0;&#x5B66;&#x4E60;&#x7684;<code>lodash</code>&#x7684;&#x7248;&#x672C;<code>v4.17.15</code> <code>unpkg.com</code>&#x94FE;&#x63A5;</a>  </p>
<h2 id="&#x7B14;&#x8005;&#x5F80;&#x671F;&#x6587;&#x7AE0;"><a href="#&#x7B14;&#x8005;&#x5F80;&#x671F;&#x6587;&#x7AE0;" class="headerlink" title="&#x7B14;&#x8005;&#x5F80;&#x671F;&#x6587;&#x7AE0;"></a>&#x7B14;&#x8005;&#x5F80;&#x671F;&#x6587;&#x7AE0;</h2><p><a href="https://dev.newban.cn/6844903780035592205">&#x9762;&#x8BD5;&#x5B98;&#x95EE;&#xFF1A;JS&#x7684;&#x7EE7;&#x627F;</a>  </p>
<p><a href="https://dev.newban.cn/6844903746984476686">&#x9762;&#x8BD5;&#x5B98;&#x95EE;&#xFF1A;JS&#x7684;this&#x6307;&#x5411;</a>  </p>
<p><a href="https://dev.newban.cn/6844903728147857415">&#x9762;&#x8BD5;&#x5B98;&#x95EE;&#xFF1A;&#x80FD;&#x5426;&#x6A21;&#x62DF;&#x5B9E;&#x73B0;JS&#x7684;call&#x548C;apply&#x65B9;&#x6CD5;</a>  </p>
<p><a href="https://dev.newban.cn/6844903718089916429">&#x9762;&#x8BD5;&#x5B98;&#x95EE;&#xFF1A;&#x80FD;&#x5426;&#x6A21;&#x62DF;&#x5B9E;&#x73B0;JS&#x7684;bind&#x65B9;&#x6CD5;</a>  </p>
<p><a href="https://dev.newban.cn/6844903704663949325">&#x9762;&#x8BD5;&#x5B98;&#x95EE;&#xFF1A;&#x80FD;&#x5426;&#x6A21;&#x62DF;&#x5B9E;&#x73B0;JS&#x7684;new&#x64CD;&#x4F5C;&#x7B26;</a>  </p>
<p><a href="https://dev.newban.cn/6844903666860687373">&#x524D;&#x7AEF;&#x4F7F;&#x7528;puppeteer &#x722C;&#x866B;&#x751F;&#x6210;&#x300A;React.js &#x5C0F;&#x4E66;&#x300B;PDF&#x5E76;&#x5408;&#x5E76;</a></p>
<h2 id="&#x5173;&#x4E8E;"><a href="#&#x5173;&#x4E8E;" class="headerlink" title="&#x5173;&#x4E8E;"></a>&#x5173;&#x4E8E;</h2><p>&#x4F5C;&#x8005;&#xFF1A;&#x5E38;&#x4EE5;<strong>&#x82E5;&#x5DDD;</strong>&#x4E3A;&#x540D;&#x6DF7;&#x8FF9;&#x4E8E;&#x6C5F;&#x6E56;&#x3002;&#x524D;&#x7AEF;&#x8DEF;&#x4E0A; | PPT&#x7231;&#x597D;&#x8005; | &#x6240;&#x77E5;&#x751A;&#x5C11;&#xFF0C;&#x552F;&#x5584;&#x5B66;&#x3002;  </p>
<p><a href="/external_links/4986b16d5e3b10c7eb3e098161b1cb6c.html" target="blank" rel="noopener">&#x4E2A;&#x4EBA;&#x535A;&#x5BA2;-&#x82E5;&#x5DDD;</a>&#xFF0C;&#x4F7F;&#x7528;<code>vuepress</code>&#x91CD;&#x6784;&#x4E86;&#xFF0C;&#x9605;&#x8BFB;&#x4F53;&#x9A8C;&#x53EF;&#x80FD;&#x66F4;&#x597D;&#x4E9B;  </p>
<p><a href="/external_links/0eaae9aee67b3837a4608f6f57e3fe73.html" target="blank" rel="noopener">&#x6398;&#x91D1;&#x4E13;&#x680F;</a>&#xFF0C;&#x6B22;&#x8FCE;&#x5173;&#x6CE8;~  </p>
<p><a href="/external_links/aa57b6e4783432f5eb4cb3122c7c281d.html" target="blank" rel="noopener"><code>segmentfault</code>&#x524D;&#x7AEF;&#x89C6;&#x91CE;&#x4E13;&#x680F;</a>&#xFF0C;&#x6B22;&#x8FCE;&#x5173;&#x6CE8;~  </p>
<p><a href="/external_links/9d49889ba530cc743d4bc05726fd318e.html" target="blank" rel="noopener">&#x77E5;&#x4E4E;&#x524D;&#x7AEF;&#x89C6;&#x91CE;&#x4E13;&#x680F;</a>&#xFF0C;&#x6B22;&#x8FCE;&#x5173;&#x6CE8;~  </p>
<p><a href="/external_links/7a72f7afa742d06ac5ceb82d817c1bed.html" target="blank" rel="noopener">github blog</a>&#xFF0C;&#x76F8;&#x5173;&#x6E90;&#x7801;&#x548C;&#x8D44;&#x6E90;&#x90FD;&#x653E;&#x5728;&#x8FD9;&#x91CC;&#xFF0C;&#x6C42;&#x4E2A;<code>star</code>^_^~</p>
<h2 id="&#x6B22;&#x8FCE;&#x52A0;&#x5FAE;&#x4FE1;&#x4EA4;&#x6D41;-&#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x53F7;"><a href="#&#x6B22;&#x8FCE;&#x52A0;&#x5FAE;&#x4FE1;&#x4EA4;&#x6D41;-&#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x53F7;" class="headerlink" title="&#x6B22;&#x8FCE;&#x52A0;&#x5FAE;&#x4FE1;&#x4EA4;&#x6D41; &#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x53F7;"></a>&#x6B22;&#x8FCE;&#x52A0;&#x5FAE;&#x4FE1;&#x4EA4;&#x6D41; &#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x53F7;</h2><p>&#x53EF;&#x80FD;&#x6BD4;&#x8F83;&#x6709;&#x8DA3;&#x7684;&#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x53F7;&#xFF0C;&#x957F;&#x6309;&#x626B;&#x7801;&#x5173;&#x6CE8;&#x3002;&#x6B22;&#x8FCE;&#x52A0;&#x7B14;&#x8005;&#x5FAE;&#x4FE1;<code>ruochuan12</code>&#xFF08;&#x6CE8;&#x660E;&#x6765;&#x6E90;&#xFF0C;&#x57FA;&#x672C;&#x6765;&#x8005;&#x4E0D;&#x62D2;&#xFF09;&#xFF0C;&#x62C9;&#x60A8;&#x8FDB;&#x3010;&#x524D;&#x7AEF;&#x89C6;&#x91CE;&#x4EA4;&#x6D41;&#x7FA4;&#x3011;&#xFF0C;&#x957F;&#x671F;&#x4EA4;&#x6D41;&#x5B66;&#x4E60;~</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/aadeca165d32560f0a5f1eb50f8961e40e01bf2c41721a1f3af6e8acf87d67e9" alt="&#x82E5;&#x5DDD;&#x89C6;&#x91CE;"></p>
<p>&#x82E5;&#x5DDD;&#x89C6;&#x91CE;</p>
<p>&#x672C;&#x6587;&#x4F7F;&#x7528; <a href="/external_links/f4f051239b400ed0d04b60fef623174b.html" target="blank" rel="noopener">mdnice</a> &#x6392;&#x7248;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/60100d13f48a5de6463decad99fbc81f.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903930183286791.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903930183286791.html" itemprop="url">Flutter完整开发实战详解(十七、 实用技巧与填坑二)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-02T14:54:00+08:00">
                2019-09-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x4F5C;&#x4E3A;&#x7CFB;&#x5217;&#x6587;&#x7AE0;&#x7684;&#x7B2C;&#x5341;&#x4E03;&#x7BC7;&#xFF0C;&#x672C;&#x7BC7;&#x518D;&#x4E00;&#x6B21;&#x5E26;&#x6765; Flutter &#x5F00;&#x53D1;&#x8FC7;&#x7A0B;&#x4E2D;&#x7684;&#x5B9E;&#x7528;&#x6280;&#x5DE7;&#xFF0C;&#x8BA9;&#x4F60;&#x7EE7;&#x7EED;&#x5F2F;&#x9053;&#x8D85;&#x8F66;&#xFF0C;&#x5168;&#x7BC7;&#x5747;&#x4E3A;&#x4E2A;&#x4EBA;&#x7684;&#x65E5;&#x5E38;&#x5E72;&#x8D27;&#x603B;&#x7ED3;&#xFF0C;&#x4EE5;&#x5B9E;&#x7528;&#x586B;&#x5751;&#x4E3A;&#x4E3B;&#xFF0C;&#x8BA9;&#x4F60;&#x5C11;&#x8D70;&#x5F2F;&#x8DEF;&#x72C2;&#x98D9;&#x8F66;&#x3002;</p>
<h2 id="&#x6587;&#x7AE0;&#x6C47;&#x603B;&#x5730;&#x5740;&#xFF1A;"><a href="#&#x6587;&#x7AE0;&#x6C47;&#x603B;&#x5730;&#x5740;&#xFF1A;" class="headerlink" title="&#x6587;&#x7AE0;&#x6C47;&#x603B;&#x5730;&#x5740;&#xFF1A;"></a>&#x6587;&#x7AE0;&#x6C47;&#x603B;&#x5730;&#x5740;&#xFF1A;</h2><blockquote>
<p><a href="/external_links/0587d739d614eebe25e21ff5c954b7fa.html" target="blank" rel="noopener">Flutter &#x5B8C;&#x6574;&#x5B9E;&#x6218;&#x5B9E;&#x6218;&#x7CFB;&#x5217;&#x6587;&#x7AE0;&#x4E13;&#x680F;</a></p>
<p><a href="/external_links/1ba09be5bbc4739a8d663c9da52c73a9.html" target="blank" rel="noopener">Flutter &#x756A;&#x5916;&#x7684;&#x4E16;&#x754C;&#x7CFB;&#x5217;&#x6587;&#x7AE0;&#x4E13;&#x680F;</a></p>
</blockquote>
<p><a href="/external_links/c3658c5a7c3fd9ce8fbce9c1e57641fb.html" target="blank" rel="noopener"><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/c168636279ed753f4668a29fc023f2711d12456bd9556b7fe02c15a0870507c0" alt></a><br>1&#x3001;Package get git &#x5931;&#x8D25;</p>
<hr>
<p>Flutter &#x9879;&#x76EE;&#x5728;&#x5F15;&#x7528;&#x7B2C;&#x4E09;&#x5E93;&#x65F6;&#xFF0C;&#x4E00;&#x822C;&#x90FD;&#x662F;&#x76F4;&#x63A5;&#x5F15;&#x7528; <code>pub</code> &#x4E0A;&#x7684;&#x7B2C;&#x4E09;&#x65B9;&#x63D2;&#x4EF6;&#xFF0C;&#x4F46;&#x662F;&#x6709;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x4E3A;&#x4E86;&#x5B89;&#x5168;&#x548C;&#x79C1;&#x5BC6;&#xFF0C;&#x4F1A;&#x9009;&#x62E9;&#x4F7F;&#x7528; git &#x5F15;&#x7528;&#xFF0C;&#x5982;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;  photo_view:</span><br><span class="line">    git:</span><br><span class="line">      url: https://github.com/CarSmallGuo/photo_view.git</span><br><span class="line">      ref: master</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x65F6;&#x5019;&#x5728;&#x6267;&#x884C; <code>flutter packages get</code> &#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x51FA;&#x73B0;&#x5931;&#x8D25;&#x540E;&#xFF0C;&#x518D;&#x6B21;&#x6267;&#x884C; <code>flutter packages get</code> &#x53EF;&#x80FD;&#x4F1A;&#x9047;&#x5230;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#x7684;&#x95EE;&#x9898;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/ea2a0336d04990b45733fcb333dc10d2b7893832b300d8acb3eb4dfa7f92dfcd" alt></p>
<p>)<br>&#x800C; <code>flutter packages get</code> &#x63D0;&#x793A; <code>git</code> &#x5931;&#x8D25;&#x7684;&#x539F;&#x56E0;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#xFF1A;</p>
<p>&#x5728;&#x4E0B;&#x8F7D;&#x5305;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x51FA;&#x73B0;&#x95EE;&#x9898;&#xFF0C;&#x4E0B;&#x6B21;&#x518D;&#x62C9;&#x5305;&#x7684;&#x65F6;&#x5019;&#xFF0C;<strong>&#x5728; <code>.pub_cache</code> &#x5185;&#x7684; <code>git</code> &#x76EE;&#x5F55;&#x4E0B;&#x4F1A;&#x68C0;&#x6D4B;&#x5230;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x76EE;&#x5F55;&#xFF0C;&#x4F46;&#x662F;&#x53EF;&#x80FD;&#x662F;&#x7A7A;&#x76EE;&#x5F55;&#x7B49;&#x7B49;&#xFF0C;&#x5BFC;&#x81F4; <code>flutter packages get</code> &#x7684;&#x65F6;&#x5019;&#x5F02;&#x5E38;&#x3002;</strong></p>
<p><strong>&#x6240;&#x4EE5;&#x4F60;&#x9700;&#x8981;&#x6E05;&#x9664;&#x6389; <code>.pub_cache</code> &#x5185;&#x7684; <code>git</code> &#x7684;&#x5F02;&#x5E38;&#x76EE;&#x5F55;&#xFF0C;&#x7136;&#x540E;&#x6700;&#x597D;&#x6E05;&#x9664;&#x6389;&#x9879;&#x76EE;&#x4E0B;&#x7684; <code>pubspec.lock</code> &#xFF0C;&#x4E4B;&#x540E;&#x91CD;&#x65B0;&#x6267;&#x884C; <code>flutter packages get</code> &#x3002;</strong></p>
<blockquote>
<p><code>win</code> &#x4E00;&#x822C;&#x662F;&#x5728; <code>C:\Users\xxxxx\AppData\Roaming\Pub\Cache</code> &#x8DEF;&#x5F84;&#x4E0B;&#x6709; <code>git</code> &#x76EE;&#x5F55;&#x3002;</p>
<p><code>mac</code> &#x76EE;&#x5F55;&#x5728; <code>~/.pub-cache</code> &#x3002;</p>
</blockquote>
<h2 id="2&#x3001;TextEditingController"><a href="#2&#x3001;TextEditingController" class="headerlink" title="2&#x3001;TextEditingController"></a>2&#x3001;TextEditingController</h2><p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/ff261831328942f22a21841cb9af7da917ebccec0db39a6b1bef6687c6aa7b73" alt="image.png"></p>
<p>&#x5982;&#x4E0A;&#x4EE3;&#x7801;&#x6240;&#x793A;&#xFF0C;&#x7EA2;&#x7EBF;&#x90E8;&#x5206;&#x8868;&#x793A;&#xFF0C;&#x5982;&#x679C; <code>controller</code> &#x4E3A;&#x7A7A;&#xFF0C;&#x5C31;&#x8D4B;&#x503C;&#x4E00;&#x4E2A; <code>TextEditingController</code> &#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x5199;&#x6CD5;&#x4F1A;&#x5BFC;&#x81F4;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#x95EE;&#x9898;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/077d434327e1fcf5b8cde47a7ab0280fccaddd8ed718800059d086503cef3e01" alt></p>
<p><strong>&#x5F39;&#x51FA;&#x952E;&#x76D8;&#x65F6;&#x8F93;&#x5165;&#x6210;&#x529F;&#x540E;&#xFF0C;&#x6536;&#x8D77;&#x952E;&#x76D8;&#x65F6;&#x8F93;&#x5165;&#x7684;&#x5185;&#x5BB9;&#x6D88;&#x5931;&#x4E86;&#xFF01;</strong> &#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#x952E;&#x76D8;&#x7684;&#x5F39;&#x51FA;&#x548C;&#x6536;&#x8D77;&#x90FD;&#x4F1A;&#x89E6;&#x53D1;&#x9875;&#x9762; <code>build</code> &#xFF0C;&#x800C;&#x5728; <code>controller</code> &#x4E3A; <code>null</code> &#x65F6;&#xFF0C;&#x6BCF;&#x6B21;&#x8D4B;&#x503C;&#x7684; <code>TextEditingController</code> &#x4F1A;&#x5BFC;&#x81F4; <code>TextField</code> &#x7684; <code>TextEditingValue</code> &#x91CD;&#x7F6E;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/469a5a638a05f9438d60ee1d32644730f046bb489995cc15babb99c39e8aa32b" alt="image.png"></p>
<p>&#x5982;&#x4E0A;&#x56FE;&#x6240;&#x793A;&#xFF0C;&#x56E0;&#x4E3A;&#x5F53; <code>TextField</code> &#x7684; <code>controller</code> &#x4E0D;&#x4E3A;&#x7A7A;&#x65F6;&#xFF0C;update &#x65F6;&#x662F;&#x4E0D;&#x4F1A;&#x6267;&#x884C; <code>value</code> &#x7684;&#x62F7;&#x8D1D;&#xFF0C;&#x6240;&#x4EE5;&#x4E3A;&#x4E86;&#x907F;&#x514D;&#x8FD9;&#x7C7B;&#x95EE;&#x9898;&#xFF0C;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#xFF0C; <strong>&#x9700;&#x8981;&#x5148;&#x5728;&#x5168;&#x5C40;&#x6784;&#x5EFA; <code>TextEditingController</code> &#x518D;&#x8D4B;&#x503C;&#xFF0C;&#x5982;&#x679C; <code>controller</code> &#x4E3A;&#x7A7A;&#x76F4;&#x63A5;&#x7ED9; null &#x5373;&#x53EF;&#xFF0C;&#x907F;&#x514D; <code>build</code> &#x65F6;&#x6BCF;&#x6B21;&#x91CD;&#x6784; <code>TextEditingController</code> &#x3002;</strong></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/84c874c532e90e7127c41acc2bf9124e7e7814a73376271d18a025c0509ee166" alt></p>
<h2 id="3&#x3001;Scrollable"><a href="#3&#x3001;Scrollable" class="headerlink" title="3&#x3001;Scrollable"></a>3&#x3001;Scrollable</h2><p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/651a1457db98424b4a65ecaa9c33494486ccdbdeac3440232c4e68993827c87c" alt></p>
<p>&#x5982;&#x4E0A;&#x56FE;&#x6240;&#x793A;&#xFF0C;&#x5728;&#x4E4B;&#x524D;&#x7B2C;&#x4E03;&#x7BC7;&#x7684;&#x65F6;&#x5019;&#x5206;&#x6790;&#x8FC7;&#xFF0C;<strong>&#x6ED1;&#x52A8;&#x5217;&#x8868;&#x5185;&#x4E00;&#x822C;&#x90FD;&#x4F1A;&#x6709; <code>Scrollable</code> &#x7684;&#x5B58;&#x5728;&#xFF0C;&#x800C; <code>Scrollable</code> &#x6070;&#x597D;&#x662F;&#x4E00;&#x4E2A; <code>InheritedWidget</code></strong> &#xFF0C;&#x8FD9;&#x5C31;&#x7ED9;&#x6211;&#x4EEC;&#x5728; <code>children</code> &#x4E2D;&#x8C03;&#x7528; <code>Scrollable</code> &#x76F8;&#x5173;&#x65B9;&#x6CD5;&#x63D0;&#x4F9B;&#x4E86;&#x4FBF;&#x5229;&#x3002;</p>
<p>&#x5982;&#x4E0B;&#x4EE3;&#x7801;&#x6240;&#x4F9D;&#xFF0C;&#x901A;&#x8FC7; <code>Scrollable.of(context)</code> &#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x66F4;&#x89E3;&#x8026;&#x7684;&#x5728; <code>ListView/GridView</code> &#x7684; <code>children</code> &#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x63A7;&#x5236;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;ScrollableState state = Scrollable.of(context)</span><br><span class="line"></span><br><span class="line">///&#x83B7;&#x53D6; _scrollable &#x5185; viewport &#x7684; renderObject</span><br><span class="line">RenderObject renderObject = state.context.findRenderObject();</span><br><span class="line">///&#x76D1;&#x542C;&#x4F4D;&#x7F6E;&#x66F4;&#x65B0;</span><br><span class="line">state.position.addListener((){});</span><br><span class="line">///&#x901A;&#x77E5;&#x4F4D;&#x7F6E;&#x66F4;&#x65B0;</span><br><span class="line">state.position.notifyListeners();</span><br><span class="line">///&#x6EDA;&#x52A8;&#x5230;&#x6307;&#x5B9A;&#x4F4D;&#x7F6E;</span><br><span class="line">state.position.jumpTo(1000);</span><br><span class="line">&#xB7;&#xB7;&#xB7;&#xB7;</span><br></pre></td></tr></table></figure>

<h2 id="4&#x3001;&#x56FE;&#x7247;&#x9AD8;&#x65AF;&#x6A21;&#x7CCA;"><a href="#4&#x3001;&#x56FE;&#x7247;&#x9AD8;&#x65AF;&#x6A21;&#x7CCA;" class="headerlink" title="4&#x3001;&#x56FE;&#x7247;&#x9AD8;&#x65AF;&#x6A21;&#x7CCA;"></a>4&#x3001;&#x56FE;&#x7247;&#x9AD8;&#x65AF;&#x6A21;&#x7CCA;</h2><p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/656db3b7319f8cbfe6ec2290cd37b390bc0fa616f301e0164592ef99458bb59c" alt></p>
<p>&#x5728; Flutter &#x4E2D;&#xFF0C;&#x63D0;&#x4F9B;&#x4E86; <code>BackdropFilter</code> &#x548C; <code>ImageFilter</code> &#x5B9E;&#x73B0;&#x4E86;&#x9AD8;&#x65AF;&#x6A21;&#x7CCA;&#x7684;&#x652F;&#x6301;&#xFF0C;&#x5982;&#x4E0B;&#x4EE3;&#x7801;&#x6240;&#x793A;&#xFF0C;&#x53EF;&#x4EE5;&#x5FEB;&#x901F;&#x5B9E;&#x73B0;&#x4E0A;&#x56FE;&#x7684;&#x9AD8;&#x65AF;&#x6A21;&#x7CCA;&#x6548;&#x679C;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;class BlurDemoPage extends StatelessWidget {</span><br><span class="line">  @override</span><br><span class="line">  Widget build(BuildContext context) {</span><br><span class="line">    return Scaffold(</span><br><span class="line">      body: new Container(</span><br><span class="line">        child: Stack(</span><br><span class="line">          children: &lt;Widget&gt;[</span><br><span class="line">            Positioned(</span><br><span class="line">              top: 0,</span><br><span class="line">              bottom: 0,</span><br><span class="line">              left: 0,</span><br><span class="line">              right: 0,</span><br><span class="line">              child: new Image.asset(</span><br><span class="line">                &quot;static/gsy_cat.png&quot;,</span><br><span class="line">                fit: BoxFit.cover,</span><br><span class="line">                width: MediaQuery.of(context).size.width,</span><br><span class="line">                height: MediaQuery.of(context).size.height,</span><br><span class="line">              )),</span><br><span class="line">            new Center(</span><br><span class="line">              child: new Container(</span><br><span class="line">                width: 200,</span><br><span class="line">                height: 200,</span><br><span class="line">                child: ClipRRect(</span><br><span class="line">                  borderRadius: BorderRadius.circular(15.0),</span><br><span class="line">                  child: BackdropFilter(</span><br><span class="line">                    filter: ImageFilter.blur(sigmaX: 8.0, sigmaY: 8.0),</span><br><span class="line">                    child: new Row(</span><br><span class="line">                      mainAxisSize: MainAxisSize.max,</span><br><span class="line">                      crossAxisAlignment: CrossAxisAlignment.center,</span><br><span class="line">                      mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">                      children: &lt;Widget&gt;[</span><br><span class="line">                        new Icon(Icons.ac_unit),</span><br><span class="line">                        new Text(&quot;&#x54C7;&#xFF01;&#xFF01;&quot;)</span><br><span class="line">                      ],</span><br><span class="line">                    )))))</span><br><span class="line">          ],</span><br><span class="line">        )));</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h2 id="5&#x3001;&#x6EDA;&#x52A8;&#x5230;&#x6307;&#x5B9A;&#x4F4D;&#x7F6E;"><a href="#5&#x3001;&#x6EDA;&#x52A8;&#x5230;&#x6307;&#x5B9A;&#x4F4D;&#x7F6E;" class="headerlink" title="5&#x3001;&#x6EDA;&#x52A8;&#x5230;&#x6307;&#x5B9A;&#x4F4D;&#x7F6E;"></a>5&#x3001;&#x6EDA;&#x52A8;&#x5230;&#x6307;&#x5B9A;&#x4F4D;&#x7F6E;</h2><p>&#x56E0;&#x4E3A;&#x76EE;&#x524D; Flutter &#x5E76;&#x6CA1;&#x6709;&#x76F4;&#x63A5;&#x63D0;&#x4F9B;&#x6EDA;&#x52A8;&#x5230;&#x6307;&#x5B9A; <code>Item</code> &#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5728;&#x6BCF;&#x4E2A; <code>Item</code> &#x5927;&#x5C0F;&#x4E0D;&#x4E00;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6298;&#x4E2D;&#x5229;&#x7528;&#x5982;&#x56FE;&#x4E0B;&#x6240;&#x793A;&#x4EE3;&#x7801;&#xFF0C;&#x53EF;&#x4EE5;&#x5FEB;&#x901F;&#x5B9E;&#x73B0;&#x6EDA;&#x52A8;&#x5230;&#x6307;&#x5B9A; <code>Item</code> &#x7684;&#x6548;&#x679C;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/bc7e7634b7f07a90856e4bae5e577b322b91c8edd29e232a31b61e0f7da36216" alt></p>
<p>&#x4E0A;&#x56FE;&#x4E3A;&#x90E8;&#x5206;&#x4EE3;&#x7801;&#xFF0C;&#x5B8C;&#x6574;&#x4EE3;&#x7801;&#x53EF;&#x89C1; <a href="/external_links/c6a35fa6fdaee581225b990af9895563.html" target="blank" rel="noopener">scroll_to_index_demo_page2.dart</a> &#xFF0C;&#x8FD9;&#x91CC;&#x4E3B;&#x8981;&#x662F;&#x7ED9;&#x6BCF;&#x4E2A; <code>item</code> &#x90FD;&#x8D4B;&#x4E88;&#x4E86;&#x4E00;&#x4E2A; <code>GlobalKey</code> , &#x5229;&#x7528; <code>findRenderObject</code> &#x627E;&#x5230;&#x6240;&#x9700; <code>item</code> &#x7684; <code>RenderBox</code> &#xFF0C;&#x7136;&#x540E;&#x4F7F;&#x7528; <code>localToGlobal</code> &#x83B7;&#x53D6; <code>item</code> &#x5728; <code>ViewPort</code> &#x8FD9;&#x4E2A; <code>ancestor</code> &#x4E2D;&#x7684;&#x504F;&#x79FB;&#x91CF;&#x8FDB;&#x884C;&#x6EDA;&#x52A8;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/b08261d757d0da511af4bb4441574a5bddbcd7577cfb9f4da1419988749677fb" alt></p>
<p>&#x5F53;&#x7136;&#x8FD8;&#x6709;&#x53E6;&#x5916;&#x4E00;&#x79CD;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#xFF0C;&#x5177;&#x4F53;&#x53EF;&#x89C1; <a href="/external_links/d965599c790539e88ce936ba561e0f8a.html" target="blank" rel="noopener">scroll_to_index_demo_page.dart</a></p>
<h2 id="6&#x3001;findRenderObject"><a href="#6&#x3001;findRenderObject" class="headerlink" title="6&#x3001;findRenderObject"></a>6&#x3001;findRenderObject</h2><p>&#x5728; Flutter &#x4E2D;&#x662F;&#x5B58;&#x5728; <strong>&#x5BB9;&#x5668; Widget</strong> &#x548C; <strong>&#x6E32;&#x67D3;Widget</strong> &#x7684;&#x533A;&#x522B;&#x7684;&#xFF0C;&#x4E00;&#x822C;&#x60C5;&#x51B5;&#x4E0B;:</p>
<ul>
<li><code>Text</code>&#x3001;<code>Sliver</code> &#x3001;<code>ListTile</code> &#x7B49;&#x90FD;&#x662F;&#x5C5E;&#x4E8E;&#x6E32;&#x67D3; Widget &#xFF0C;&#x5176;&#x5185;&#x90E8;&#x4E3B;&#x8981;&#x662F; <code>RenderObjectElement</code> &#x3002;</li>
<li><code>StatelessWidget</code> / <code>StatefulWidget</code> &#x7B49;&#x5C5E;&#x4E8E;&#x5BB9;&#x5668; Widget &#xFF0C;&#x5176;&#x5185;&#x90E8;&#x4F7F;&#x7528;&#x7684;&#x662F; <code>ComponentElement</code> &#xFF0C; <strong><code>ComponentElement</code> &#x672C;&#x8EAB;&#x662F;&#x4E0D;&#x5B58;&#x5728; <code>RenderObject</code> &#x7684;&#x3002;</strong></li>
</ul>
<p>&#x7ED3;&#x5408;&#x524D;&#x9762;&#x7BC7;&#x7AE0;&#x6211;&#x4EEC;&#x8BF4;&#x8FC7; <code>BuildContext</code> &#x7684;&#x5B9E;&#x73B0;&#x5C31;&#x662F; <code>Element</code>&#xFF0C;&#x6240;&#x4EE5; <code>context.findRenderObject()</code> &#x8FD9;&#x4E2A;&#x64CD;&#x4F5C;&#x5176;&#x5B9E;&#x5C31;&#x662F; <code>Element</code> &#x7684; <code>findRenderObject()</code> &#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/890ced29fbf33c625c0e315404d585e374a94e03d8536ff0fa7370bea67e3959" alt></p>
<p>&#x90A3;&#x4E48;&#x5982;&#x4E0A;&#x56FE;&#x6240;&#x793A;&#xFF0C;<code>findRenderObject</code> &#x7684;&#x5B9E;&#x73B0;&#x6700;&#x7EC8;&#x5C31;&#x662F;&#x83B7;&#x53D6; <code>renderObject</code>&#xFF0C;&#x5728; <code>Element</code> &#x4E2D; <code>renderObject</code> &#x7684;&#x83B7;&#x53D6;&#x903B;&#x8F91;&#x5C31;&#x5F88;&#x6E05;&#x6670;&#x4E86;&#xFF0C;<strong>&#x5728;&#x9047;&#x5230; <code>ComponentElement</code> &#x65F6;&#xFF0C;&#x6267;&#x884C;&#x7684;&#x662F; <code>element.visitChildren(visit);</code></strong> , &#x9012;&#x5F52;&#x76F4;&#x5230;&#x627E;&#x5230; <code>RenderObjectElement</code> &#x3002;</p>
<p>&#x6240;&#x4EE5;&#x5982;&#x4E0B;&#x4EE3;&#x7801;&#x6240;&#x793A;&#xFF0C;<code>print(&quot;${globalKey.currentContext.findRenderObject()}&quot;);</code> &#x6700;&#x7EC8;&#x8F93;&#x51FA;&#x4E86; <code>SizedBox</code> &#x7684; <code>RenderObject</code> &#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/ffbc61d90a13d4746f9096d60fbe11211ef9c6b474f5b6095878c7a7fa95bec1" alt></p>
<h2 id="7&#x3001;&#x884C;&#x95F4;&#x8DDD;"><a href="#7&#x3001;&#x884C;&#x95F4;&#x8DDD;" class="headerlink" title="7&#x3001;&#x884C;&#x95F4;&#x8DDD;"></a>7&#x3001;&#x884C;&#x95F4;&#x8DDD;</h2><p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/ddc2622caea24b00ad3583c23e80048783ab5ff1bb1bd2d4a7f67affea4c644e" alt></p>
<p>&#x5728; Flutter &#x4E2D;&#xFF0C;&#x662F;&#x6CA1;&#x6709;&#x76F4;&#x63A5;&#x8BBE;&#x7F6E; <code>Text</code> &#x884C;&#x95F4;&#x8DDD;&#x7684;&#x65B9;&#x6CD5;&#x7684;&#xFF0C; <code>Text</code> &#x663E;&#x793A;&#x7684;&#x6548;&#x679C;&#x662F;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#x7684;&#x903B;&#x8F91;&#x7EC4;&#x6210;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/b781a2fd041920de6f7cdb8092a2da4b9d89a2d029d4e84ba7f59acb0660306e" alt></p>
<p>&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x5E94;&#x8BE5;&#x5982;&#x4F55;&#x5904;&#x7406;&#x884C;&#x95F4;&#x8DDD;&#x5462;&#xFF1F;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#xFF0C;<strong>&#x901A;&#x8FC7;&#x8BBE;&#x7F6E; <code>StrutStyle</code> &#x7684; <code>leading</code> , &#x7136;&#x540E;&#x5229;&#x7528; <code>Transform</code> &#x505A;&#x8BA1;&#x7B97;&#x7FFB;&#x65B9;&#x5411;&#x4F4D;&#x7F6E;&#x504F;&#x79FB;&#xFF0C;&#x56E0;&#x4E3A; <code>leading</code> &#x662F;&#x4E0A;&#x4E0B;&#x5747;&#x8861;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x8BA1;&#x7B97;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x6211;&#x4EEC;&#x6240;&#x9700;&#x8981;&#x7684;&#x884C;&#x95F4;&#x8DDD;&#x5927;&#x5C0F;&#x3002;</strong> (&#x867D;&#x7136;&#x65E0;&#x6CD5;&#x4FDD;&#x8BC1;&#x4E00;&#x5B9A; 100%&#x50CF;&#x7D20;&#x51C6;&#x786E;&#xFF0C;&#x4F60;&#x662F;&#x5426;&#x8FD8;&#x77E5;&#x9053;&#x5176;&#x4ED6;&#x65B9;&#x6CD5;&#xFF1F;)</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/704e4bdc52585f4cfc608a61b6d2b908189a70620dc70aa599bd737f694b8ce1" alt></p>
<blockquote>
<p><strong>&#x8FD9;&#x91CC;&#x989D;&#x5916;&#x63D0;&#x4E00;&#x70B9;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x7236;&#x8282;&#x70B9;&#x4F7F;&#x7528; <code>DefaultTextStyle</code> &#x6765;&#x5B9E;&#x73B0;&#x5C40;&#x90E8;&#x6837;&#x5F0F;&#x7684;&#x5171;&#x4EAB;&#x54E6;&#x3002;</strong></p>
</blockquote>
<h2 id="8&#x3001;Builder"><a href="#8&#x3001;Builder" class="headerlink" title="8&#x3001;Builder"></a>8&#x3001;Builder</h2><p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/19c66df42c2a89883bcb6ebd2907323ed8bd666fdc4553da2ae9f5ab00a4f1b6" alt></p>
<p>&#x5728; Flutter &#x4E2D;&#x5B58;&#x5728; <code>Builder</code> &#x8FD9;&#x6837;&#x4E00;&#x4E2A; Widget&#xFF0C;&#x770B;&#x6E90;&#x7801;&#x53D1;&#x73B0;&#x5B83;&#x5176;&#x5B9E;&#x5C31;&#x662F; <code>StatelessWidget</code> &#x7684;&#x7B80;&#x5355;&#x5C01;&#x88C5;&#xFF0C;&#x90A3;&#x4E3A;&#x4EC0;&#x4E48;&#x8FD8;&#x9700;&#x8981;&#x5B83;&#x7684;&#x5B58;&#x5728;&#x5462;&#xFF1F;</p>
<p>&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#xFF0C;&#x76F8;&#x4FE1;&#x4E00;&#x4E9B; Flutter &#x5F00;&#x53D1;&#x8005;&#x5728;&#x4F7F;&#x7528; <code>Scaffold.of(context).showSnackBar(snackbar)</code> &#x65F6;&#xFF0C;&#x53EF;&#x80FD; &#x9047;&#x5230;&#x8FC7;&#x5982;&#x4E0B;&#x9519;&#x8BEF;&#xFF0C;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#x4F20;&#x5165;&#x7684; <code>context</code> &#x5C5E;&#x4E8E;&#x9519;&#x8BEF;&#x8282;&#x70B9;&#x5BFC;&#x81F4;&#x7684;&#xFF0C;<strong>&#x56E0;&#x4E3A;&#x6B64;&#x5904;&#x4F20;&#x5165;&#x7684; <code>context</code> &#x5E76;&#x4E0D;&#x80FD;&#x627E;&#x5230;&#x9875;&#x9762;&#x6240;&#x5728;&#x7684; <code>Scaffold</code> &#x8282;&#x70B9;&#x3002;</strong></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/c2015022675beaa9b36a09830173ef9f35a1fe45bdd821d5b8d865a16fcb3211" alt></p>
<p>&#x6240;&#x4EE5;&#x8FD9;&#x65F6;&#x5019; <code>Builder</code> &#x7684;&#x4F5C;&#x7528;&#x5C31;&#x4F53;&#x73B0;&#x4E86;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF0C;&#x901A;&#x8FC7; <code>builder</code> &#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x8D4B;&#x4E88;&#x7684; <code>context</code> &#xFF0C;&#x5728;&#x5411;&#x4E0A;&#x67E5;&#x627E; <code>Scaffold</code> &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x987A;&#x5229;&#x627E;&#x5230;&#x7236;&#x8282;&#x70B9;&#x7684; <code>Scaffold</code> &#x4E86;&#xFF0C;&#x8FD9;&#x4E5F;&#x4E00;&#x5B9A;&#x7A0B;&#x5EA6;&#x4E0A;&#x4F53;&#x73B0;&#x4E86; <code>ComponentElement</code> &#x7684;&#x4F5C;&#x7528;&#x4E4B;&#x4E00;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/738076095d06fb5f3c771289e542554009709a2c7573cd37fc41179d561254c5" alt></p>
<h2 id="9&#x3001;&#x5FEB;&#x901F;&#x5B9E;&#x73B0;&#x52A8;&#x753B;&#x5207;&#x6362;&#x6548;&#x679C;"><a href="#9&#x3001;&#x5FEB;&#x901F;&#x5B9E;&#x73B0;&#x52A8;&#x753B;&#x5207;&#x6362;&#x6548;&#x679C;" class="headerlink" title="9&#x3001;&#x5FEB;&#x901F;&#x5B9E;&#x73B0;&#x52A8;&#x753B;&#x5207;&#x6362;&#x6548;&#x679C;"></a>9&#x3001;&#x5FEB;&#x901F;&#x5B9E;&#x73B0;&#x52A8;&#x753B;&#x5207;&#x6362;&#x6548;&#x679C;</h2><p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/6c47341908aed205df0f556b8d75d56e54f4689e8c2a97bdcc841583b41e970c" alt></p>
<p>&#x8981;&#x5B9E;&#x73B0;&#x5982;&#x4E0A;&#x56FE;&#x6240;&#x793A;&#x52A8;&#x753B;&#x6548;&#x679C;&#xFF0C;&#x5728; Flutter &#x4E2D;&#x63D0;&#x4F9B;&#x4E86; <code>AnimatedSwitcher</code> &#x5C01;&#x88C5;&#x7B80;&#x6613;&#x5B9E;&#x73B0;&#x3002;</p>
<p>&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#xFF0C;<strong>&#x901A;&#x8FC7;&#x5D4C;&#x5957; <code>AnimatedSwitcher</code> &#xFF0C;&#x6307;&#x5B9A; <code>transitionBuilder</code> &#x52A8;&#x753B;&#x6548;&#x679C;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x6570;&#x636E;&#x6539;&#x53D8;&#x65F6;&#xFF0C;&#x540C;&#x65F6;&#x6539;&#x53D8;&#x9700;&#x8981;&#x6267;&#x884C;&#x52A8;&#x753B;&#x7684; <code>key</code> &#x503C;&#xFF0C;&#x5373;&#x53EF;&#x8FBE;&#x5230;&#x52A8;&#x753B;&#x5207;&#x6362;&#x7684;&#x6548;&#x679C;&#x3002;</strong></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/f6074b5f26ac6dbf9ce35f7dcafdc75954c6b8804ebf7ff15c80fa4b305e9d5f" alt></p>
<h2 id="10&#x3001;&#x591A;&#x8BED;&#x8A00;&#x663E;&#x793A;&#x5F02;&#x5E38;"><a href="#10&#x3001;&#x591A;&#x8BED;&#x8A00;&#x663E;&#x793A;&#x5F02;&#x5E38;" class="headerlink" title="10&#x3001;&#x591A;&#x8BED;&#x8A00;&#x663E;&#x793A;&#x5F02;&#x5E38;"></a>10&#x3001;&#x591A;&#x8BED;&#x8A00;&#x663E;&#x793A;&#x5F02;&#x5E38;</h2><p>&#x5728;&#x5B98;&#x65B9;&#x7684; <a href="/external_links/9e3dfcdf1dbf85b1fe6001b2875e78b5.html" target="blank" rel="noopener">github.com/flutter/flu&#x2026;</a> issue &#x4E2D;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#xFF0C;<strong>Flutter &#x5728;&#x97E9;&#x8BED;/&#x65E5;&#x8BED; &#x4E0E;&#x4E2D;&#x6587;&#x540C;&#x65F6;&#x663E;&#x793A;&#xFF0C;&#x4F1A;&#x5BFC;&#x81F4; iOS &#x4E0B;&#x51FA;&#x73B0;&#x6587;&#x5B57;&#x6E32;&#x67D3;&#x5F02;&#x5E38;&#x7684;&#x95EE;&#x9898;</strong> &#xFF0C;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#xFF0C;&#x5DE6;&#x8FB9;&#x4E3A;&#x5F02;&#x5E38;&#x60C5;&#x51B5;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/0993e5255dc7d97385fc90a0957e486e74f074a0cff8f0454713fd6e059c7da3" alt></p>
<p>&#x6539;&#x95EE;&#x9898;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x6682;&#x65F6;&#x6709;&#x4E24;&#x79CD;&#xFF1A;</p>
<ul>
<li><strong>&#x589E;&#x52A0;&#x5B57;&#x4F53; ttf &#xFF0C;&#x5168;&#x5C40;&#x6307;&#x5B9A;&#x6539;&#x5B57;&#x4F53;&#x663E;&#x793A;&#x3002;</strong></li>
<li><strong>&#x4FEE;&#x6539;&#x4E3B;&#x9898;&#x4E0B;&#x6240;&#x6709; <code>TextTheme</code> &#x7684; <code>fontFamilyFallback</code> &#xFF1A;</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;getThemeData() {</span><br><span class="line">  var themeData = ThemeData(</span><br><span class="line">        primarySwatch: primarySwatch</span><br><span class="line">   );</span><br><span class="line"></span><br><span class="line">    var result = themeData.copyWith(</span><br><span class="line">      textTheme: confirmTextTheme(themeData.textTheme),</span><br><span class="line">      accentTextTheme: confirmTextTheme(themeData.accentTextTheme),</span><br><span class="line">      primaryTextTheme: confirmTextTheme(themeData.primaryTextTheme),</span><br><span class="line">    );</span><br><span class="line">    return result;</span><br><span class="line">}</span><br><span class="line">/// &#x5904;&#x7406; ios &#x4E0A;&#xFF0C;&#x540C;&#x9875;&#x9762;&#x51FA;&#x73B0;&#x97E9;&#x6587;&#x548C;&#x7B80;&#x4F53;&#x4E2D;&#x6587;&#xFF0C;&#x5BFC;&#x81F4;&#x7684;&#x663E;&#x793A;&#x5B57;&#x4F53;&#x5F02;&#x5E38;</span><br><span class="line">confirmTextTheme(TextTheme textTheme) {</span><br><span class="line">  getCopyTextStyle(TextStyle textStyle) {</span><br><span class="line">    return textStyle.copyWith(fontFamilyFallback: [&quot;PingFang SC&quot;, &quot;Heiti SC&quot;]);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  return textTheme.copyWith(</span><br><span class="line">    display4: getCopyTextStyle(textTheme.display4),</span><br><span class="line">    display3: getCopyTextStyle(textTheme.display3),</span><br><span class="line">    display2: getCopyTextStyle(textTheme.display2),</span><br><span class="line">    display1: getCopyTextStyle(textTheme.display1),</span><br><span class="line">    headline: getCopyTextStyle(textTheme.headline),</span><br><span class="line">    title: getCopyTextStyle(textTheme.title),</span><br><span class="line">    subhead: getCopyTextStyle(textTheme.subhead),</span><br><span class="line">    body2: getCopyTextStyle(textTheme.body2),</span><br><span class="line">    body1: getCopyTextStyle(textTheme.body1),</span><br><span class="line">    caption: getCopyTextStyle(textTheme.caption),</span><br><span class="line">    button: getCopyTextStyle(textTheme.button),</span><br><span class="line">    subtitle: getCopyTextStyle(textTheme.subtitle),</span><br><span class="line">    overline: getCopyTextStyle(textTheme.overline),</span><br><span class="line">  );</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ps &#xFF1A;<strong>&#x901A;&#x8FC7;<code>WidgetsBinding.instance.window.locale;</code> &#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x5230;&#x624B;&#x673A;&#x5E73;&#x53F0;&#x672C;&#x8EAB;&#x7684;&#x5F53;&#x524D;&#x8BED;&#x8A00;&#x60C5;&#x51B5;&#xFF0C;&#x4E0D;&#x9700;&#x8981; <code>context</code> &#xFF0C;&#x4E5F;&#x4E0D;&#x662F;&#x4F60;&#x8BBE;&#x7F6E;&#x540E;&#x7684; <code>Locale</code> &#x3002;</strong></p>
</blockquote>
<h2 id="11&#x3001;&#x957F;&#x6309;&#x8F93;&#x5165;&#x6846;&#x5BFC;&#x81F4;&#x5F02;&#x5E38;&#x7684;&#x60C5;&#x51B5;"><a href="#11&#x3001;&#x957F;&#x6309;&#x8F93;&#x5165;&#x6846;&#x5BFC;&#x81F4;&#x5F02;&#x5E38;&#x7684;&#x60C5;&#x51B5;" class="headerlink" title="11&#x3001;&#x957F;&#x6309;&#x8F93;&#x5165;&#x6846;&#x5BFC;&#x81F4;&#x5F02;&#x5E38;&#x7684;&#x60C5;&#x51B5;"></a>11&#x3001;&#x957F;&#x6309;&#x8F93;&#x5165;&#x6846;&#x5BFC;&#x81F4;&#x5F02;&#x5E38;&#x7684;&#x60C5;&#x51B5;</h2><p>&#x5982;&#x679C;&#x9879;&#x76EE;&#x5B58;&#x5728;&#x591A;&#x8BED;&#x8A00;&#x548C;&#x4E3B;&#x9898;&#x5207;&#x6362;&#x7684;&#x573A;&#x666F;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x9047;&#x5230;&#x957F;&#x6309;&#x8F93;&#x5165;&#x6846;&#x5BFC;&#x81F4;&#x5F02;&#x5E38;&#x7684;&#x573A;&#x666F;&#xFF0C;&#x76EE;&#x524D;&#x53EF;&#x63A8;&#x8350;&#x4E24;&#x79CD;&#x89E3;&#x653E;&#x65B9;&#x6CD5;&#xFF1A;</p>
<ul>
<li>1&#x3001;&#x53EF;&#x4EE5;&#x7ED9;&#x4F60;&#x7684;&#x81EA;&#x5B9A;&#x4E49; <code>ThemeData</code> &#x5F3A;&#x5236;&#x6307;&#x5B9A;&#x56FA;&#x5B9A;&#x4E00;&#x4E2A;&#x5E73;&#x53F0;&#xFF0C;&#x4F46;&#x662F;&#x8BE5;&#x65B9;&#x5F0F;&#x4F1A;&#x5BFC;&#x81F4;&#x5E73;&#x53F0;&#x590D;&#x5236;&#x7C98;&#x8D34;&#x5F39;&#x51FA;&#x6846;&#x6CA1;&#x6709;&#x4E86;&#x5E73;&#x53F0;&#x7279;&#x6027;&#xFF1A;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801; ///&#x9632;&#x6B62;&#x8F93;&#x5165;&#x6846;&#x957F;&#x6309;&#x5D29;&#x6E83;&#x95EE;&#x9898;</span><br><span class="line">platform: TargetPlatform.android</span><br></pre></td></tr></table></figure>

<ul>
<li>2&#x3001;&#x589E;&#x52A0;&#x4E00;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x7684; <code>LocalizationsDelegate</code> , &#x5B9E;&#x73B0;&#x591A;&#x8BED;&#x8A00;&#x73AF;&#x5883;&#x4E0B;&#x7684;&#x81EA;&#x5B9A;&#x4E49;&#x652F;&#x6301;&#xFF1A;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">class FallbackCupertinoLocalisationsDelegate</span><br><span class="line">    extends LocalizationsDelegate&lt;CupertinoLocalizations&gt; {</span><br><span class="line">  const FallbackCupertinoLocalisationsDelegate();</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  bool isSupported(Locale locale) =&gt; true;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  Future&lt;CupertinoLocalizations&gt; load(Locale locale) =&gt; loadCupertinoLocalizations(locale);</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  bool shouldReload(FallbackCupertinoLocalisationsDelegate old) =&gt; false;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">class CustomZhCupertinoLocalizations extends DefaultCupertinoLocalizations {</span><br><span class="line">  const CustomZhCupertinoLocalizations();</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String datePickerMinuteSemanticsLabel(int minute) {</span><br><span class="line">    if (minute == 1) return &apos;1 &#x5206;&#x949F;&apos;;</span><br><span class="line">    return minute.toString() + &apos; &#x5206;&#x949F;&apos;;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String get anteMeridiemAbbreviation =&gt; &apos;&#x4E0A;&#x5348;&apos;;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String get postMeridiemAbbreviation =&gt; &apos;&#x4E0B;&#x5348;&apos;;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String get alertDialogLabel =&gt; &apos;&#x8B66;&#x544A;&apos;;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String timerPickerHourLabel(int hour) =&gt; &apos;&#x5C0F;&#x65F6;&apos;;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String timerPickerMinuteLabel(int minute) =&gt; &apos;&#x5206;&apos;;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String timerPickerSecond(int second) =&gt; &apos;&#x79D2;&apos;;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String get cutButtonLabel =&gt; &apos;&#x88C1;&#x526A;&apos;;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String get copyButtonLabel =&gt; &apos;&#x590D;&#x5236;&apos;;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String get pasteButtonLabel =&gt; &apos;&#x7C98;&#x8D34;&apos;;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String get selectAllButtonLabel =&gt; &apos;&#x5168;&#x9009;&apos;;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">class CustomTCCupertinoLocalizations extends DefaultCupertinoLocalizations {</span><br><span class="line">  const CustomTCCupertinoLocalizations();</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String datePickerMinuteSemanticsLabel(int minute) {</span><br><span class="line">    if (minute == 1) return &apos;1 &#x5206;&#x9418;&apos;;</span><br><span class="line">    return minute.toString() + &apos; &#x5206;&#x9418;&apos;;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String get anteMeridiemAbbreviation =&gt; &apos;&#x4E0A;&#x5348;&apos;;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String get postMeridiemAbbreviation =&gt; &apos;&#x4E0B;&#x5348;&apos;;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String get alertDialogLabel =&gt; &apos;&#x8B66;&#x544A;&apos;;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String timerPickerHourLabel(int hour) =&gt; &apos;&#x5C0F;&#x65F6;&apos;;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String timerPickerMinuteLabel(int minute) =&gt; &apos;&#x5206;&apos;;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String timerPickerSecond(int second) =&gt; &apos;&#x79D2;&apos;;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String get cutButtonLabel =&gt; &apos;&#x88C1;&#x526A;&apos;;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String get copyButtonLabel =&gt; &apos;&#x5FA9;&#x5236;&apos;;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String get pasteButtonLabel =&gt; &apos;&#x7C98;&#x8CBC;&apos;;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String get selectAllButtonLabel =&gt; &apos;&#x5168;&#x9078;&apos;;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">Future&lt;CupertinoLocalizations&gt; loadCupertinoLocalizations(Locale locale) {</span><br><span class="line">  CupertinoLocalizations localizations;</span><br><span class="line">  if (locale.languageCode == &quot;zh&quot;) {</span><br><span class="line">    switch (locale.countryCode) {</span><br><span class="line">      case &apos;HK&apos;:</span><br><span class="line">      case &apos;TW&apos;:</span><br><span class="line">        localizations = CustomTCCupertinoLocalizations();</span><br><span class="line">        break;</span><br><span class="line">      default:</span><br><span class="line">        localizations = CustomZhCupertinoLocalizations();</span><br><span class="line">    }</span><br><span class="line">  } else {</span><br><span class="line">    localizations = DefaultCupertinoLocalizations();</span><br><span class="line">  }</span><br><span class="line">  return SynchronousFuture&lt;CupertinoLocalizations&gt;(localizations);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&#x81EA;&#x6B64;&#xFF0C;&#x7B2C;&#x5341;&#x4E03;&#x7BC7;&#x7EC8;&#x4E8E;&#x7ED3;&#x675F;&#x4E86;&#xFF01;(///&#x25BD;///)</p>
</blockquote>
<h3 id="&#x8D44;&#x6E90;&#x63A8;&#x8350;"><a href="#&#x8D44;&#x6E90;&#x63A8;&#x8350;" class="headerlink" title="&#x8D44;&#x6E90;&#x63A8;&#x8350;"></a>&#x8D44;&#x6E90;&#x63A8;&#x8350;</h3><ul>
<li>Github &#xFF1A; <a href="/external_links/bd7808078f5d6788f5c0bd5cbc28101b.html" target="blank" rel="noopener">github.com/CarGuo</a></li>
<li><strong>&#x5F00;&#x6E90; Flutter &#x5B8C;&#x6574;&#x9879;&#x76EE;&#xFF1A;<a href="/external_links/c3658c5a7c3fd9ce8fbce9c1e57641fb.html" target="blank" rel="noopener">github.com/CarGuo/GSYG&#x2026;</a></strong></li>
<li><strong>&#x5F00;&#x6E90; Flutter &#x591A;&#x6848;&#x4F8B;&#x5B66;&#x4E60;&#x578B;&#x9879;&#x76EE;: <a href="/external_links/726848483446b0f2a85c2a35da9d2c89.html" target="blank" rel="noopener">github.com/CarGuo/GSYF&#x2026;</a></strong></li>
<li><strong>&#x5F00;&#x6E90; Fluttre &#x5B9E;&#x6218;&#x7535;&#x5B50;&#x4E66;&#x9879;&#x76EE;&#xFF1A;<a href="/external_links/8a40a928cf868858ba750fb90c14ae13.html" target="blank" rel="noopener">github.com/CarGuo/GSYF&#x2026;</a></strong></li>
<li>&#x5F00;&#x6E90; React Native &#x9879;&#x76EE;&#xFF1A;<a href="/external_links/1b66db3a6d84807383b0065dbd1b5216.html" target="blank" rel="noopener">github.com/CarGuo/GSYG&#x2026;</a></li>
</ul>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/c2b194322c92b5d85c55dc45fdd2a54c4ad85fc20671d484c0463d069db34002" alt></p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/42ab628df6ba234af97272064c1423a9.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903924965572615.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903924965572615.html" itemprop="url">Android - 一种新奇的冷启动速度优化思路(Fragm</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-26T21:38:38+08:00">
                2019-08-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="&#x4E00;&#x3001;&#x80CC;&#x666F;"><a href="#&#x4E00;&#x3001;&#x80CC;&#x666F;" class="headerlink" title="&#x4E00;&#x3001;&#x80CC;&#x666F;"></a>&#x4E00;&#x3001;&#x80CC;&#x666F;</h3><p>&#x660E;&#x5929;&#x662F;&#x5468;&#x4E8C;&#xFF0C;&#x6B63;&#x597D;&#x662F;&#x6211;&#x4EEC;&#x56E2;&#x961F;&#x6BCF;&#x5468;&#x4E00;&#x6B21;&#x7684;&#x6280;&#x672F;&#x5206;&#x4EAB;&#xFF0C;&#x6211;&#x4F1A;&#x628A;&#x524D;&#x6BB5;&#x65F6;&#x95F4;&#x82B1;&#x4E86;&#x51E0;&#x5929;&#x5728;&#x5E72;&#x5176;&#x4ED6;&#x6D3B;&#x7684;&#x540C;&#x65F6;&#xFF0C;&#x6574;&#x7684;&#x4E00;&#x5957;&#x8BE1;&#x5F02;&#x7684;&#x51B7;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x4F18;&#x5316;&#x65B9;&#x6848;&#x5206;&#x4EAB;&#x4E00;&#x4E0B;&#x3002;</p>
<h3 id="&#x4E8C;&#x3001;&#x7279;&#x610F;&#x58F0;&#x660E;"><a href="#&#x4E8C;&#x3001;&#x7279;&#x610F;&#x58F0;&#x660E;" class="headerlink" title="&#x4E8C;&#x3001;&#x7279;&#x610F;&#x58F0;&#x660E;"></a>&#x4E8C;&#x3001;&#x7279;&#x610F;&#x58F0;&#x660E;</h3><p>&#x6211;&#x8FD9;&#x8FB9;&#x6587;&#x7AE0;&#x7684;&#x5185;&#x5BB9;&#x4E0D;&#x4F1A;&#x6D89;&#x53CA;&#x7F51;&#x4E0A;&#x53D8;&#x5730;&#x90FD;&#x662F;&#x7684;&#x5E38;&#x89C4;&#x7684;&#x4F18;&#x5316;&#x65B9;&#x6848;~ &#xFF0C;&#x540C;&#x65F6;&#xFF0C;&#x5E73;&#x65F6;&#x5DE5;&#x4F5C;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5DE5;&#x4F5C;&#x5185;&#x5BB9;&#x6742;&#x4E14;&#x591A;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x4E2A;&#x4F18;&#x5316;&#x65B9;&#x6848;&#x4E5F;&#x4E0D;&#x662F;&#x7279;&#x522B;&#x6210;&#x719F;&#xFF0C;&#x4EC5;&#x4F9B;&#x53C2;&#x8003;&#x5427;~</p>
<h3 id="&#x4E09;&#x3001;&#x6700;&#x5E38;&#x89C1;&#x7684;&#x4F18;&#x5316;&#x65B9;&#x6848;"><a href="#&#x4E09;&#x3001;&#x6700;&#x5E38;&#x89C1;&#x7684;&#x4F18;&#x5316;&#x65B9;&#x6848;" class="headerlink" title="&#x4E09;&#x3001;&#x6700;&#x5E38;&#x89C1;&#x7684;&#x4F18;&#x5316;&#x65B9;&#x6848;"></a>&#x4E09;&#x3001;&#x6700;&#x5E38;&#x89C1;&#x7684;&#x4F18;&#x5316;&#x65B9;&#x6848;</h3><ul>
<li>&#x6570;&#x636E;&#x61D2;&#x52A0;&#x8F7D;&#xFF0C;&#x6BD4;&#x5982;Fragment&#x7528;&#x6237;&#x4E0D;&#x53EF;&#x89C1;&#x65F6;&#x4E0D;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x7684;&#x83B7;&#x53D6;</li>
<li>&#x4F18;&#x5316;&#x5E03;&#x5C40;&#x5C42;&#x7EA7;&#xFF0C;&#x51CF;&#x5C11;&#x9996;&#x6B21;inflate layout&#x7684;&#x8017;&#x65F6;</li>
<li>&#x5C06;&#x7EDD;&#x5927;&#x90E8;&#x5206;sdk&#x7684;&#x521D;&#x59CB;&#x5316;&#x653E;&#x7EBF;&#x7A0B;&#x6C60;&#x4E2D;&#x8FD0;&#x884C;</li>
<li>&#x80FD;&#x7528;ViewStub&#x7684;&#x5C31;&#x7528;ViewStub&#xFF0C;&#x6309;&#x9700;&#x52A0;&#x8F7D;layout</li>
<li>&#x4E00;&#x5B9A;&#x8981;&#x5C3D;&#x91CF;&#x907F;&#x514D;&#x542F;&#x52A8;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x51FA;&#x73B0;&#x7684;&#x4E3B;&#x7EBF;&#x7A0B;&#x53BB;unpack&#x4E00;&#x4E9B;&#x5168;&#x5C40;&#x914D;&#x7F6E;&#x7684;&#x6570;&#x636E;</li>
<li>&#x4E0D;&#x4EC5;&#x4EC5;&#x662F;&#x4E09;&#x65B9;&#x5E93;&#x53EF;&#x4EE5;&#x653E;&#x5B50;&#x7EBF;&#x7A0B;&#x8FDB;&#x884C;&#xFF0C;&#x4E00;&#x4E9B;&#x65F6;&#x6548;&#x6027;&#x8981;&#x6C42;&#x6CA1;&#x90A3;&#x4E48;&#x9AD8;&#x7684;&#x903B;&#x8F91;&#x90FD;&#x53EF;&#x4EE5;&#x653E;&#x5B50;&#x7EBF;&#x7A0B;</li>
</ul>
<h3 id="&#x56DB;&#x3001;&#x9879;&#x76EE;&#x7ED3;&#x6784;"><a href="#&#x56DB;&#x3001;&#x9879;&#x76EE;&#x7ED3;&#x6784;" class="headerlink" title="&#x56DB;&#x3001;&#x9879;&#x76EE;&#x7ED3;&#x6784;"></a>&#x56DB;&#x3001;&#x9879;&#x76EE;&#x7ED3;&#x6784;</h3><p>&#x5728;&#x6211;&#x4EEC;&#x7684;Android&#x9879;&#x76EE;&#x4E2D;&#xFF0C;&#x5E94;&#x7528;&#x8FC7;&#x4E86;&#x95EA;&#x5C4F;&#x4E4B;&#x540E;&#x4F1A;&#x8FDB;&#x5165;&#x5230;&#x4E3B;&#x5C4F; - MainActivity&#xFF0C;&#x8FD9;&#x4E2A;&#x5730;&#x65B9;&#x6211;&#x5410;&#x69FD;&#x5F88;&#x591A;&#x6B21;&#x4E86;&#xFF0C;&#x5E7F;&#x544A;&#x95EA;&#x5C4F;&#x4F5C;&#x4E3A;launcher&#x771F;&#x7684;&#x4E0D;&#x662F;&#x7279;&#x522B;&#x9760;&#x8C31;&#xFF0C;&#x6700;&#x597D;&#x7684;&#x65B9;&#x5F0F;&#x5E94;&#x8BE5;&#x662F;&#x4ECE;MainActivity&#x91CC;&#x9762;&#x6765;&#x542F;&#x52A8;AdActivity&#xFF0C;&#x751A;&#x81F3;&#x662F;&#x4E0D;&#x7528;Activity&#xFF0C;&#x91C7;&#x7528;&#x4E00;&#x4E2A;&#x5168;&#x5C4F;&#x7684;AdView&#x90FD;&#x53EF;&#x4EE5;&#x3002;</p>
<p>&#x5148;&#x7B80;&#x5355;&#x4ECB;&#x7ECD;&#x4E00;&#x4E0B;&#x6211;&#x4EEC;&#x9879;&#x76EE;&#x4E2D;MainActivity&#x6D89;&#x53CA;&#x5230;&#x7684;&#x7ED3;&#x6784;&#xFF1A;</p>
<p>&#x7B80;&#x5355;&#x7684;&#x753B;&#x4E86;&#x4E2A;&#x56FE;&#xFF0C;<strong>&#x7B80;&#x76F4;&#x662F;&#x3002;&#x3002;&#x753B;&#x56FE;&#x754C;&#x7684;&#x803B;&#x8FB1;&#x3002;&#x3002;&#x3002;</strong></p>
<p>&#x5927;&#x6982;&#x770B;&#x770B;&#x610F;&#x601D;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#xFF0C;&#x6211;&#x5728;&#x7EC4;&#x5185;&#x5206;&#x4EAB;&#x5C31;&#x662F;&#x7528;&#x7684;&#x8FD9;&#x4E2A;&#x8349;&#x56FE;&#xFF0C;&#x6025;&#x7740;&#x4E0B;&#x73ED;&#xFF0C;&#x5C31;&#x4E0D;&#x91CD;&#x65B0;&#x753B;&#x4E86;&#x3002;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/bcc07a6a07fa78da8aa8ec3325b283d74a48139a9407ced1ba0af334be174e85" alt></p>
<p>&#x5F53;App&#x51B7;&#x542F;&#x52A8;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8089;&#x773C;&#x53EF;&#x89C1;&#x7684;&#x8981;&#x521D;&#x59CB;&#x5316;&#x7684;&#x4E1C;&#x897F;&#x592A;&#x591A;&#x4E86;&#xFF0C;&#x672C;&#x8EAB;<strong>Fragment&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x76F8;&#x5BF9;&#x91CD;&#x7684;&#x4E1C;&#x897F;&#x3002;&#x6BD4;Activity&#x8981;&#x8F7B;&#x91CF;&#x5F88;&#x591A;&#xFF0C;&#x4F46;&#x662F;&#x6BD4;View&#x53C8;&#x8981;&#x91CD;</strong></p>
<p>&#x6211;&#x4EEC;&#x9996;&#x9875;&#x5927;&#x6982;&#x662F; 4-5&#x4E2A;tab&#xFF0C;&#x6BCF;&#x4E2A;tab&#x90FD;&#x662F;&#x4E00;&#x4E2A;Fragment&#xFF0C;&#x4E14;&#x7B2C;&#x4E00;&#x4E2A;tab&#x5185;&#x5D4C;&#x4E86;4&#x4E2A;Fragment&#xFF0C;&#x6211;&#x8FD9;&#x4E00;&#x6B21;&#x7684;<strong>&#x4F18;&#x5316;&#x4E3B;&#x8981;&#x5C06;&#x76EE;&#x6807;&#x7784;&#x51C6;&#x4E86;&#x9996;&#x9875;&#x7684; tab1 &#x4EE5;&#x53CA;tab1&#x5185;&#x5D4C;&#x7684;&#x56DB;&#x4E2A;tab</strong></p>
<h2 id="&#x4E94;&#x3001;&#x6781;&#x81F4;&#x7684;&#x61D2;&#x52A0;&#x8F7D;"><a href="#&#x4E94;&#x3001;&#x6781;&#x81F4;&#x7684;&#x61D2;&#x52A0;&#x8F7D;" class="headerlink" title="&#x4E94;&#x3001;&#x6781;&#x81F4;&#x7684;&#x61D2;&#x52A0;&#x8F7D;"></a>&#x4E94;&#x3001;&#x6781;&#x81F4;&#x7684;&#x61D2;&#x52A0;&#x8F7D;</h2><h3 id="5-1-&#x6781;&#x81F4;&#x7684;&#x61D2;&#x52A0;&#x8F7D;"><a href="#5-1-&#x6781;&#x81F4;&#x7684;&#x61D2;&#x52A0;&#x8F7D;" class="headerlink" title="5.1 &#x6781;&#x81F4;&#x7684;&#x61D2;&#x52A0;&#x8F7D;"></a>5.1 &#x6781;&#x81F4;&#x7684;&#x61D2;&#x52A0;&#x8F7D;</h3><p>&#x5E73;&#x65F6;&#x89C1;&#x5230;&#x7684;&#x61D2;&#x52A0;&#x8F7D;&#xFF1A;</p>
<blockquote>
<p>&#x5C31;&#x662F;&#x521D;&#x59CB;&#x5316;fragment&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x8FDE;&#x540C;&#x6211;&#x4EEC;&#x5199;&#x7684;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x4E00;&#x8D77;&#x6267;&#x884C;&#xFF0C;&#x8FD9;&#x6837;&#x975E;&#x5E38;&#x6D88;&#x8017;&#x6027;&#x80FD;&#xFF0C;&#x6700;&#x7406;&#x60F3;&#x7684;&#x65B9;&#x5F0F;&#x662F;&#xFF0C;&#x53EA;&#x6709;&#x7528;&#x6237;&#x70B9;&#x5F00;&#x6216;&#x6ED1;&#x52A8;&#x5230;&#x5F53;&#x524D;fragment&#x65F6;&#xFF0C;&#x624D;&#x8FDB;&#x884C;&#x8BF7;&#x6C42;&#x7F51;&#x7EDC;&#x7684;&#x64CD;&#x4F5C;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x4EA7;&#x751F;&#x4E86;&#x61D2;&#x52A0;&#x8F7D;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x8BF4;&#x6CD5;&#x3002;</p>
</blockquote>
<p>&#x4F46;&#x662F;&#x3002;&#x3002;&#x3002;&#x3002;</p>
<p>&#x7531;&#x4E8E;&#x6211;&#x4EEC;&#x9996;&#x5C4F;4&#x4E2A;&#x5B50;Tab&#x90FD;&#x662F;&#x7EE7;&#x627F;&#x81EA;&#x4E00;&#x4E2A;&#x57FA;&#x7C7B;BaseLoadListFragment&#xFF0C;&#x6570;&#x636E;&#x52A0;&#x8F7D;&#x7684;&#x903B;&#x8F91;&#x975E;&#x5E38;&#x7684;&#x6B7B;&#xFF0C;&#x6309;&#x7167;&#x4E0A;&#x8FF0;&#x7684;&#x6539;&#x6CD5;&#xFF0C;&#x5F71;&#x54CD;&#x9762;&#x592A;&#x5927;&#x3002;&#x540E;&#x7EED;&#x53EF;&#x80FD;&#x4F1A;&#x5F92;&#x589E;&#x70E6;&#x607C;</p>
<h3 id="5-2-&#x61D2;&#x52A0;&#x8F7D;&#x65B9;&#x6848;"><a href="#5-2-&#x61D2;&#x52A0;&#x8F7D;&#x65B9;&#x6848;" class="headerlink" title="5.2 &#x61D2;&#x52A0;&#x8F7D;&#x65B9;&#x6848;"></a>5.2 &#x61D2;&#x52A0;&#x8F7D;&#x65B9;&#x6848;</h3><ol>
<li>&#x9996;&#x5C4F;&#x52A0;&#x8F7D;&#x65F6;&#xFF0C;&#x53EA;&#x5F80;ViewPager&#x4E2D;&#x585E;&#x5165;&#x9ED8;&#x8BA4;&#x8981;&#x5C55;&#x793A;&#x7684;tab&#xFF0C;&#x5269;&#x4F59;&#x7684;tab&#x7528;&#x7A7A;&#x7684;&#x5360;&#x4F4D;Fragment&#x4EE3;&#x66FF;</li>
<li>&#x5F53;&#x7528;&#x6237;&#x6ED1;&#x52A8;&#x5230;&#x5176;&#x4ED6;tab&#x65F6;&#xFF0C;&#x6BD4;&#x5982;&#x6ED1;&#x52A8;&#x5230;&#x597D;&#x53CB;&#x52A8;&#x6001;tab&#xFF0C;&#x5C31;&#x7528;FriendFragment&#x628A;&#x5F53;&#x524D;&#x7684;EmptyPlaceholderFragment&#x66FF;&#x6362;&#x6389;&#xFF0C;&#x7136;&#x540E;adapter.notifyDataSetChanged</li>
<li>&#x5F53;&#x56DB;&#x4E2A;Tab&#x5168;&#x90E8;&#x66FF;&#x6362;&#x4E3A;&#x6570;&#x636E;tab&#x65F6;&#xFF0C;&#x6E05;&#x9664;&#x6389;EmptyFragment&#x7684;&#x5F15;&#x7528;&#xFF0C;&#x91CA;&#x653E;&#x5185;&#x5B58;</li>
</ol>
<p>&#x8BF4;&#x5230;&#x8FD9;&#x91CC;&#xFF0C;&#x53C8;&#x4E0D;&#x5F97;&#x4E0D;&#x63D0;&#x4E00;&#x4E2A;&#x8001;&#x751F;&#x5E38;&#x8C08;&#x7684;&#x4E00;&#x4E2A;&#x5751;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x7684;&#x9996;&#x9875;&#x662F;&#x7528;&#x7684;ViewPager + FragmentPagerAdapter&#x6765;&#x8FDB;&#x884C;&#x5B9E;&#x73B0;&#x7684;&#x3002;&#x56E0;&#x6B64;&#x5C31;&#x51FA;&#x73B0;&#x4E86;&#x4E00;&#x4E2A;&#x5751;&#xFF1A;</p>
<blockquote>
<p>ViewPager + FragmentPagerAdapter&#x7EC4;&#x5408;&#x4F7F;&#x7528;&#xFF0C;&#x8C03;&#x7528;notifyDataSetChanged()&#x65B9;&#x6CD5;&#x65E0;&#x6548;&#xFF0C;&#x65E0;&#x6CD5;&#x5237;&#x65B0;Fragment&#x5217;&#x8868;</p>
</blockquote>
<p>&#x4E0B;&#x9762;&#x6211;&#x4F1A;&#x5BF9;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x8FDB;&#x884C;&#x4E00;&#x4E0B;&#x8BE6;&#x7EC6;&#x7684;&#x4ECB;&#x7ECD;</p>
<h3 id="5-3-FragmentPagerAdapter&#x4E0E;FragmentStatePagerAdapter"><a href="#5-3-FragmentPagerAdapter&#x4E0E;FragmentStatePagerAdapter" class="headerlink" title="5.3 FragmentPagerAdapter&#x4E0E;FragmentStatePagerAdapter"></a>5.3 FragmentPagerAdapter&#x4E0E;FragmentStatePagerAdapter</h3><p>&#x5F53;&#x6211;&#x4EEC;&#x8981;&#x4F7F;&#x7528;ViewPager&#x6765;&#x52A0;&#x8F7D;Fragment&#x65F6;&#xFF0C;&#x5B98;&#x65B9;&#x4E3A;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;&#x4E86;&#x8FD9;&#x4E24;&#x79CD;Adapter&#xFF0C;&#x90FD;&#x662F;&#x7EE7;&#x627F;&#x81EA;PagerAdapter&#x3002;</p>
<p>&#x533A;&#x522B;&#xFF0C;&#x4E0A;&#x5B98;&#x65B9;&#x63CF;&#x8FF0;&#xFF1A;</p>
<p>FragmentPagerAdapter</p>
<blockquote>
<p>This version of the pager is best for use when there are a handful of typically more static fragments to be paged through, such as a set of tabs. The fragment of each page the user visits will be kept in memory, though its view hierarchy may be destroyed when not visible. This can result in using a significant amount of memory since fragment instances can hold on to an arbitrary amount of state. For larger sets of pages, consider <code>[FragmentStatePagerAdapter](https://developer.android.com/reference/android/support/v4/app/FragmentStatePagerAdapter.html)</code>.</p>
</blockquote>
<p>FragmentStatePagerAdapter</p>
<blockquote>
<p>This version of the pager is more useful when there are a large number of pages, working more like a list view. When pages are not visible to the user, their entire fragment may be destroyed, only keeping the saved state of that fragment. This allows the pager to hold on to much less memory associated with each visited page as compared to<code>[FragmentPagerAdapter](https://developer.android.com/reference/android/support/v4/app/FragmentPagerAdapter.html)</code> at the cost of potentially more overhead when switching between pages</p>
</blockquote>
<p>&#x603B;&#x7ED3;&#xFF1A;</p>
<ul>
<li>&#x4F7F;&#x7528;FragmentStatePagerAdapter&#x65F6;&#xFF0C;&#x5982;&#x679C;tab&#x5BF9;&#x4E8E;&#x7528;&#x6237;&#x4E0D;&#x53EF;&#x89C1;&#x4E86;&#xFF0C;Fragment&#x5C31;&#x4F1A;&#x88AB;&#x9500;&#x6BC1;&#xFF0C;FragmentPagerAdapter&#x5219;&#x4E0D;&#x4F1A;&#xFF0C;&#x4F7F;&#x7528;FragmentPagerAdapter&#x65F6;&#xFF0C;&#x6240;&#x6709;&#x7684;tab&#x4E0A;&#x7684;Fragment&#x90FD;&#x4F1A;hold&#x5728;&#x5185;&#x5B58;&#x91CC;</li>
<li>&#x5F53;tab&#x975E;&#x5E38;&#x591A;&#x65F6;&#xFF0C;&#x63A8;&#x8350;&#x4F7F;&#x7528;FragmentStatePagerAdapter</li>
<li>&#x5F53;tab&#x4E0D;&#x591A;&#xFF0C;&#x4E14;&#x56FA;&#x5B9A;&#x65F6;&#xFF0C;&#x63A8;&#x8350;&#x7528;FragmentPagerAdapter</li>
</ul>
<p>&#x6211;&#x4EEC;&#x9879;&#x76EE;&#x4E2D;&#x5C31;&#x662F;&#x4F7F;&#x7528;&#x7684;ViewPager+FragmentPagerAdapter&#x3002;</p>
<h3 id="5-4-FragmentPagerAdapter&#x7684;&#x5237;&#x65B0;&#x95EE;&#x9898;"><a href="#5-4-FragmentPagerAdapter&#x7684;&#x5237;&#x65B0;&#x95EE;&#x9898;" class="headerlink" title="5.4 FragmentPagerAdapter&#x7684;&#x5237;&#x65B0;&#x95EE;&#x9898;"></a>5.4 FragmentPagerAdapter&#x7684;&#x5237;&#x65B0;&#x95EE;&#x9898;</h3><p>&#x6B63;&#x5E38;&#x60C5;&#x51B5;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;adapter&#x65F6;&#xFF0C;&#x60F3;&#x8981;&#x5237;&#x65B0;&#x6570;&#x636E;&#x53EA;&#x9700;&#x8981;&#xFF1A;</p>
<ol>
<li>&#x66F4;&#x65B0;dataSet</li>
<li>&#x8C03;&#x7528;notifyDataSetChanged()</li>
</ol>
<p>&#x4F46;&#x662F;&#xFF0C;&#x8FD9;&#x4E2A;&#x5728;&#x8FD9;&#x4E2A;Adapter&#x4E2D;&#x662F;&#x4E0D;&#x9002;&#x7528;&#x7684;&#x3002;&#x56E0;&#x4E3A;&#xFF08;&#x8FD9;&#x4E00;&#x6B65;&#x6CA1;&#x8010;&#x5FC3;&#x7684;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x770B;&#x540E;&#x9762;&#x7684;&#x603B;&#x7ED3;&#xFF09;&#xFF1A;</p>
<ol>
<li>&#x9ED8;&#x8BA4;&#x7684;PagerAdapter&#x7684;destoryItem&#x53EA;&#x4F1A;&#x628A;Fragment detach&#x6389;&#xFF0C;&#x800C;&#x4E0D;&#x4F1A;remove</li>
<li>&#x5F53;&#x518D;&#x6B21;&#x8C03;&#x7528;instantiateItem&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E4B;&#x524D;detach&#x6389;&#x7684;Fragment&#xFF0C;&#x53C8;&#x4F1A;&#x4ECE;mFragmentManager&#x4E2D;&#x53D6;&#x51FA;&#xFF0C;&#x53C8;&#x53EF;&#x4EE5;attach&#x4E86;</li>
</ol>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/6b6830401c6e32c6648167aecad7e92035bda771b0d969283c8adb59f2ba47d0" alt></p>
<p>3&#xFF0C;ViewPager&#x7684;dataSetChanged&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/6fac3f5d5b2d9514b10f05227f73f4346028bdd0edeb1a360bd18a9214a16461" alt></p>
<p>4&#xFF0C;&#x4E14;adapter&#x7684;&#x9ED8;&#x8BA4;&#x5B9E;&#x73B0;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/54dc5c401717a96ac26105371acc021ebf3a53adcc64e03c005f618884a82882" alt></p>
<p>&#x7B80;&#x5355;&#x603B;&#x7ED3;&#x4E00;&#x4E0B;&#xFF1A;</p>
<p>1&#xFF0C;ViewPager&#x7684;dataSetChanged()&#x4E2D;&#x4F1A;&#x53BB;&#x7528;adapter.getItemPosition&#x6765;&#x5224;&#x65AD;&#x662F;&#x5426;&#x8981;&#x79FB;&#x9664;&#x5F53;&#x524D;Item&#xFF08;position = POSITION_NONE&#x65F6;remove&#xFF09;</p>
<p>2&#xFF0C;PagerAdapter&#x7684;getItemPosition&#x9ED8;&#x8BA4;&#x5B9E;&#x73B0;&#x4E3A;POSITION_UNCHANGED</p>
<p>&#x4E0A;&#x8FF0;&#x4E24;&#x70B9;&#x5BFC;&#x81F4;ViewPager&#x6784;&#x5EFA;&#x5B8C;&#x6210;Adapter&#x4E4B;&#x540E;&#xFF0C;&#x4E0D;&#x4F1A;&#x6709;&#x673A;&#x4F1A;&#x8C03;&#x7528;&#x5230;Adapter&#x7684;instantiateItem&#x4E86;&#x3002;</p>
<p>&#x518D;&#x8005;&#xFF0C;&#x5373;&#x4F7F;&#x91CD;&#x5199;&#x4E86;getItemPosition&#x65B9;&#x6CD5;&#xFF0C;&#x6BCF;&#x6B21;&#x8FD4;&#x56DE;POSITION_NONE&#xFF0C;&#x8FD8;&#x662F;&#x4E0D;&#x4F1A;&#x66FF;&#x6362;&#x6389;Fragment&#xFF0C;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;instantiateItem&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x4F1A;&#x6839;&#x636E;getItemId()&#x53BB;&#x4ECE;FragmetnManager&#x4E2D;&#x627E;&#x5230;&#x5DF2;&#x7ECF;&#x521B;&#x5EFA;&#x597D;&#x7684;Fragment&#x8FD4;&#x56DE;&#x56DE;&#x53BB;&#xFF0C;&#x800C;getItemId()&#x7684;&#x9ED8;&#x8BA4;&#x5B9E;&#x73B0;&#x662F;return position&#x3002;</p>
<h3 id="5-5-FragmentPagerAdapter&#x5237;&#x65B0;&#x7684;&#x6B63;&#x786E;&#x59FF;&#x52BF;"><a href="#5-5-FragmentPagerAdapter&#x5237;&#x65B0;&#x7684;&#x6B63;&#x786E;&#x59FF;&#x52BF;" class="headerlink" title="5.5 FragmentPagerAdapter&#x5237;&#x65B0;&#x7684;&#x6B63;&#x786E;&#x59FF;&#x52BF;"></a>5.5 FragmentPagerAdapter&#x5237;&#x65B0;&#x7684;&#x6B63;&#x786E;&#x59FF;&#x52BF;</h3><p>&#x91CD;&#x5199;getItemId()&#x548C;getItemPosition()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">typescript&#x590D;&#x5236;&#x4EE3;&#x7801; class TabsAdapter extends FragmentPagerAdapter {</span><br><span class="line"></span><br><span class="line">        private ArrayList&lt;Fragment&gt; mFragmentList;</span><br><span class="line">        private ArrayList&lt;String&gt; mPageTitleList;</span><br><span class="line">        private int mCount;</span><br><span class="line"></span><br><span class="line">        TabsAdapter(FragmentManager fm, ArrayList&lt;Fragment&gt; fragmentList, ArrayList&lt;String&gt; pageTitleList) {</span><br><span class="line">            super(fm);</span><br><span class="line">            mFragmentList = fragmentList;</span><br><span class="line">            mCount = fragmentList.size();</span><br><span class="line">            mPageTitleList = pageTitleList;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public Fragment getItem(int position) {</span><br><span class="line">            return mFragmentList.get(position);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public CharSequence getPageTitle(int position) {</span><br><span class="line">            return mPageTitleList.get(position);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public int getCount() {</span><br><span class="line">            return mCount;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public long getItemId(int position) {</span><br><span class="line">            //&#x8FD9;&#x4E2A;&#x5730;&#x65B9;&#x7684;&#x91CD;&#x5199;&#x975E;&#x5E38;&#x5173;&#x952E;&#xFF0C;super&#x4E2D;&#x662F;&#x8FD4;&#x56DE;position&#xFF0C;</span><br><span class="line">            //&#x5982;&#x679C;&#x4E0D;&#x91CD;&#x5199;&#xFF0C;&#x8FD8;&#x662F;&#x4F1A;&#x7EE7;&#x7EED;&#x627E;&#x5230;FragmentManager&#x4E2D;&#x7F13;&#x5B58;&#x7684;Fragment</span><br><span class="line">            return mFragmentList.get(position).hashCode();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public int getItemPosition(@NonNull Object object) {</span><br><span class="line">            //&#x4E0D;&#x5728;&#x6570;&#x636E;&#x96C6;&#x5408;&#x91CC;&#x9762;&#x7684;&#x8BDD;&#xFF0C;return POSITION_NONE&#xFF0C;&#x8FDB;&#x884C;item&#x7684;&#x91CD;&#x5EFA;</span><br><span class="line">            int index = mFragmentList.indexOf(object);</span><br><span class="line">            if (index == -1) {</span><br><span class="line">                return POSITION_NONE;</span><br><span class="line">            } else {</span><br><span class="line">                return mFragmentList.indexOf(object);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        void refreshFragments(ArrayList&lt;Fragment&gt; fragmentList) {</span><br><span class="line">            mFragmentList = fragmentList;</span><br><span class="line">            notifyDataSetChanged();</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>&#x5176;&#x4ED6;&#x7684;&#x76F8;&#x5173;&#x4EE3;&#x7801;&#xFF1A;</p>
<p><strong>&#xFF08;1&#xFF09;&#x5B9E;&#x73B0;ViewPager.OnPageChangeListener</strong>&#xFF0C;&#x6765;&#x76D1;&#x63A7;ViewPager&#x7684;&#x6ED1;&#x52A8;&#x72B6;&#x6001;&#xFF0C;&#x624D;&#x53EF;&#x4EE5;&#x5728;&#x6ED1;&#x52A8;&#x5230;&#x4E0B;&#x4E00;&#x4E2A;tab&#x7684;&#x65F6;&#x5019;&#x8FDB;&#x884C;Fragment&#x66FF;&#x6362;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x5176;&#x4E2D;mDefaultTab&#x662F;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x63A5;&#x53E3;&#x8FD4;&#x56DE;&#x7684;&#x5F53;&#x524D;&#x542F;&#x52A8;&#x5C55;&#x793A;&#x7684;tab&#x5E8F;&#x53F7;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">arduino&#x590D;&#x5236;&#x4EE3;&#x7801;    @Override</span><br><span class="line">    public void onPageScrolled(int position, float positionOffset, int positionOffsetPixels) {</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onPageSelected(int position) {</span><br><span class="line">        mCurrentSelectedTab = position;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onPageScrollStateChanged(int state) {</span><br><span class="line">        if (!hasReplacedAllEmptyFragments &amp;&amp; mCurrentSelectedTab != mDefaultTab &amp;&amp; state == 0) {</span><br><span class="line">            //&#x5F53;&#x6EE1;&#x8DB3;&#xFF1A; 1. &#x6CA1;&#x6709;&#x5168;&#x90E8;&#x66FF;&#x6362;&#x5B8C; 2. &#x5F53;&#x524D;tab&#x4E0D;&#x662F;&#x521D;&#x59CB;&#x5316;&#x7684;&#x9ED8;&#x8BA4;tab&#xFF08;&#x9ED8;&#x8BA4;tab&#x4E0D;&#x4F1A;&#x7528;&#x7A7A;&#x7684;Fragment&#x53BB;&#x66FF;&#x6362;&#xFF09; 3. &#x6ED1;&#x52A8;&#x7ED3;&#x675F;&#x4E86;&#xFF0C;&#x5373;state = 0</span><br><span class="line">            replaceEmptyFragmentsIfNeed(mCurrentSelectedTab);</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>&#x5907;&#x6CE8;&#xFF1A;</p>
<blockquote>
<p>onPageScrollStateChanged&#x63A5;&#x6ED1;&#x52A8;&#x7684;&#x72B6;&#x6001;&#x503C;&#x3002;&#x4E00;&#x5171;&#x6709;&#x4E09;&#x4E2A;&#x53D6;&#x503C;&#xFF1A;</p>
<p>0&#xFF1A;&#x4EC0;&#x4E48;&#x90FD;&#x6CA1;&#x505A;  </p>
<p>1&#xFF1A;&#x5F00;&#x59CB;&#x6ED1;&#x52A8;  </p>
<p>2&#xFF1A;&#x6ED1;&#x52A8;&#x7ED3;&#x675F;</p>
<p>&#x4E00;&#x6B21;&#x5F15;&#x8D77;&#x9875;&#x9762;&#x5207;&#x6362;&#x7684;&#x6ED1;&#x52A8;&#xFF0C;state&#x7684;&#x987A;&#x5E8F;&#x5206;&#x522B;&#x662F;&#xFF1A; 1  -&gt;  2  -&gt;  0</p>
</blockquote>
<p>&#xFF08;<strong>2&#xFF09;&#x8FDB;&#x884C;Fragment&#x7684;&#x66FF;&#x6362;</strong>&#xFF0C;&#x8FD9;&#x91CC;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x7684;tab&#x6570;&#x91CF;&#x662F;&#x53EF;&#x80FD;&#x6839;&#x636E;&#x5168;&#x5C40;config&#x4FE1;&#x606F;&#x800C;&#x6539;&#x53D8;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x4E2A;&#x5730;&#x65B9;&#x5199;&#x7684;&#x7A0D;&#x5FAE;&#x7EA0;&#x7ED3;&#x4E86;&#x4E00;&#x4E9B;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;    /**</span><br><span class="line">     * &#x5982;&#x679C;&#x5168;&#x90E8;&#x66FF;&#x6362;&#x5B8C;&#x4E86;&#xFF0C;&#x76F4;&#x63A5;return</span><br><span class="line">     * &#x66FF;&#x6362;&#x8FC7;&#x7A0B;&#xFF1A;</span><br><span class="line">     * 1. &#x627E;&#x5230;&#x5F53;&#x524D;&#x7A7A;&#x7684;tab&#x5728;mEmptyFragmentList &#x4E2D;&#x7684;&#x5B9E;&#x9645;&#x4E0B;&#x6807;</span><br><span class="line">     *</span><br><span class="line">     * @param tabId &#x8981;&#x66FF;&#x6362;&#x7684;tab&#x7684;tabId - &#xFF08;&#x5F53;&#x524D;&#x7A7A;&#x7684;Fragment&#x5728;adapter&#x6570;&#x636E;&#x5217;&#x8868;mFragmentList&#x7684;&#x4E0B;&#x6807;&#xFF09;</span><br><span class="line">     */</span><br><span class="line">    private void replaceEmptyFragmentsIfNeed(int tabId) {</span><br><span class="line">        if (hasReplacedAllEmptyFragments) {</span><br><span class="line">            return;</span><br><span class="line">        }</span><br><span class="line">        int tabRealIndex = mEmptyFragmentList.indexOf(mFragmentList.get(tabId)); //&#x627E;&#x5230;&#x5F53;&#x524D;&#x7684;&#x7A7A;Fragment&#x5728; mEmptyFragmentList &#x662F;&#x7B2C;&#x51E0;&#x4E2A;</span><br><span class="line">        if (tabRealIndex &gt; -1) {</span><br><span class="line">            if (Collections.replaceAll(mFragmentList, mEmptyFragmentList.get(tabRealIndex), mDataFragmentList.get(tabRealIndex))) {</span><br><span class="line">                mTabsAdapter.refreshFragments(mFragmentList); //&#x5C06;mFragmentList&#x4E2D;&#x7684;&#x76F8;&#x5E94;empty fragment&#x66FF;&#x6362;&#x5B8C;&#x6210;&#x4E4B;&#x540E;&#x5237;&#x65B0;&#x6570;&#x636E;</span><br><span class="line">                boolean hasAllReplaced = true;</span><br><span class="line">                for (Fragment fragment : mFragmentList) {</span><br><span class="line">                    if (fragment instanceof EmptyPlaceHolderFragment) {</span><br><span class="line">                        hasAllReplaced = false;</span><br><span class="line">                        break;</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">                if (hasAllReplaced) {</span><br><span class="line">                    mEmptyFragmentList.clear(); //&#x5168;&#x90E8;&#x66FF;&#x6362;&#x5B8C;&#x6210;&#x7684;&#x8BDD;&#xFF0C;&#x91CA;&#x653E;&#x5F15;&#x7528;</span><br><span class="line">                }</span><br><span class="line">                hasReplacedAllEmptyFragments = hasAllReplaced;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<h2 id="&#x516D;&#x3001;&#x795E;&#x5947;&#x7684;&#x7684;&#x9884;&#x52A0;&#x8F7D;&#xFF08;&#x9884;&#x52A0;&#x8F7D;View&#xFF0C;&#x800C;&#x4E0D;&#x662F;data&#xFF09;"><a href="#&#x516D;&#x3001;&#x795E;&#x5947;&#x7684;&#x7684;&#x9884;&#x52A0;&#x8F7D;&#xFF08;&#x9884;&#x52A0;&#x8F7D;View&#xFF0C;&#x800C;&#x4E0D;&#x662F;data&#xFF09;" class="headerlink" title="&#x516D;&#x3001;&#x795E;&#x5947;&#x7684;&#x7684;&#x9884;&#x52A0;&#x8F7D;&#xFF08;&#x9884;&#x52A0;&#x8F7D;View&#xFF0C;&#x800C;&#x4E0D;&#x662F;data&#xFF09;"></a>&#x516D;&#x3001;&#x795E;&#x5947;&#x7684;&#x7684;&#x9884;&#x52A0;&#x8F7D;&#xFF08;&#x9884;&#x52A0;&#x8F7D;View&#xFF0C;&#x800C;&#x4E0D;&#x662F;data&#xFF09;</h2><p>Android&#x5728;&#x542F;&#x52A8;&#x8FC7;&#x7A0B;&#x4E2D;&#x53EF;&#x80FD;&#x6D89;&#x53CA;&#x5230;&#x7684;&#x4E00;&#x4E9B;View&#x7684;&#x9884;&#x52A0;&#x8F7D;&#x65B9;&#x6848;&#xFF1A;</p>
<ol>
<li>WebView&#x63D0;&#x524D;&#x521B;&#x5EFA;&#x597D;&#xFF0C;&#x56E0;&#x4E3A;webview&#x521B;&#x5EFA;&#x7684;&#x8017;&#x65F6;&#x8F83;&#x957F;&#xFF0C;&#x5982;&#x679C;&#x9996;&#x5C4F;&#x6709;h5&#x7684;&#x9875;&#x9762;&#xFF0C;&#x53EF;&#x4EE5;&#x63D0;&#x524D;&#x521B;&#x5EFA;&#x597D;&#x3002;</li>
<li>Application&#x7684;onCreate&#x65F6;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5F00;&#x59CB;&#x5728;&#x5B50;&#x7EBF;&#x7A0B;&#x4E2D;&#x8FDB;&#x884C;&#x540E;&#x9762;&#x8981;&#x7528;&#x5230;&#x7684;Layout&#x7684;inflate&#x5DE5;&#x4F5C;&#x4E86;&#xFF0C;&#x6700;&#x5148;&#x60F3;&#x5230;&#x7684;&#x5E94;&#x8BE5;&#x662F;&#x5B98;&#x65B9;&#x63D0;&#x4F9B;&#x7684;AsyncLayoutInflater</li>
<li>&#x586B;&#x5145;View&#x7684;&#x6570;&#x636E;&#x7684;&#x9884;&#x52A0;&#x8F7D;&#xFF0C;&#x4ECA;&#x5929;&#x7684;&#x5185;&#x5BB9;&#x4E0D;&#x6D89;&#x53CA;&#x8FD9;&#x4E00;&#x9879;</li>
</ol>
<h3 id="6-1-&#x9700;&#x8981;&#x9884;&#x52A0;&#x8F7D;&#x4EC0;&#x4E48;"><a href="#6-1-&#x9700;&#x8981;&#x9884;&#x52A0;&#x8F7D;&#x4EC0;&#x4E48;" class="headerlink" title="6.1 &#x9700;&#x8981;&#x9884;&#x52A0;&#x8F7D;&#x4EC0;&#x4E48;"></a>6.1 &#x9700;&#x8981;&#x9884;&#x52A0;&#x8F7D;&#x4EC0;&#x4E48;</h3><p>&#x76F4;&#x63A5;&#x770B;&#x56FE;&#xFF0C;&#x8FD9;&#x4E2A;&#x662F;&#x9996;&#x9875;&#x56DB;&#x4E2A;&#x5B50;Tab Fragment&#x7684;&#x57FA;&#x7C7B;&#x7684;layout&#xFF0C;&#x56E0;&#x4E3A;&#x67D0;&#x4E9B;&#x4E1C;&#x897F;&#x8BBE;&#x8BA1;&#x7684;&#x4E0D;&#x5408;&#x7406;&#xFF0C;&#x5BFC;&#x81F4;&#x5C42;&#x7EA7;&#x662F;&#x975E;&#x5E38;&#x7684;&#x6DF1;&#xFF0C;&#x76F4;&#x63A5;&#x5BFC;&#x81F4;&#x4E86;&#x9996;&#x9875;&#x4E0A;&#x7684;&#x4E09;&#x4E2A;tab&#x52A0;&#x4E0A;FeedMainFragment&#x81EA;&#x8EAB;&#xFF0C;&#x5149;&#x5C06;&#x8FD9;&#x4E2A;View inflate&#x51FA;&#x6765;&#x7684;&#x65F6;&#x95F4;&#x5C31;&#x975E;&#x5E38;&#x957F;&#x3002;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x8003;&#x8651;&#x5728;&#x5B50;&#x7EBF;&#x7A0B;&#x4E2D;&#x63D0;&#x524D;inflate layout</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/3a5d460119094182cda0858e8bab245704fa0278b52296a929ca8cfaddf5e137" alt></p>
<h3 id="6-2-&#x4FEE;&#x6539;AsyncLayoutInflater"><a href="#6-2-&#x4FEE;&#x6539;AsyncLayoutInflater" class="headerlink" title="6.2 &#x4FEE;&#x6539;AsyncLayoutInflater"></a>6.2 &#x4FEE;&#x6539;AsyncLayoutInflater</h3><p>&#x5B98;&#x65B9;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x7C7B;&#xFF0C;&#x53EF;&#x4EE5;&#x6765;&#x8FDB;&#x884C;&#x5F02;&#x6B65;&#x7684;inflate&#xFF0C;&#x4F46;&#x662F;&#x6709;&#x4E24;&#x4E2A;&#x7F3A;&#x70B9;&#xFF1A;</p>
<ol>
<li>&#x6BCF;&#x6B21;&#x90FD;&#x8981;&#x73B0;&#x573A;new&#x4E00;&#x4E2A;&#x51FA;&#x6765;</li>
<li>&#x5F02;&#x6B65;&#x52A0;&#x8F7D;&#x7684;view&#x53EA;&#x80FD;&#x901A;&#x8FC7;callback&#x56DE;&#x8C03;&#x624D;&#x80FD;&#x83B7;&#x5F97;&#xFF08;&#x6B7B;&#x7A74;&#xFF09;</li>
</ol>
<p>&#x56E0;&#x6B64;&#x51B3;&#x5B9A;&#x81EA;&#x5DF1;&#x5C01;&#x88C5;&#x4E00;&#x4E2A;AsyncInflateManager&#xFF0C;&#x5185;&#x90E8;&#x4F7F;&#x7528;&#x7EBF;&#x7A0B;&#x6C60;&#xFF0C;&#x4E14;&#x5BF9;&#x4E8E;inflate&#x5B8C;&#x6210;&#x7684;View&#x6709;&#x4E00;&#x5957;&#x7F13;&#x5B58;&#x673A;&#x5236;&#x3002;&#x800C;&#x5176;&#x4E2D;&#x6700;&#x6838;&#x5FC3;&#x7684;LayoutInflater&#x5219;&#x76F4;&#x63A5;copy&#x51FA;&#x6765;&#x5C31;&#x597D;&#x3002;</p>
<p>&#x5148;&#x770B;AsyncInflateManager&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x76F4;&#x63A5;&#x5C06;&#x4EE3;&#x7801;copy&#x8FDB;&#x6765;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x622A;&#x56FE;&#x4E86;&#xFF0C;&#x8FD9;&#x6837;&#x4F60;&#x4EEC;&#x5982;&#x679C;&#x60F3;&#x7528;&#x5176;&#x4E2D;&#x90E8;&#x5206;&#x4E1C;&#x897F;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;copy&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line">typescript&#x590D;&#x5236;&#x4EE3;&#x7801;/**</span><br><span class="line"> * @author zoutao</span><br><span class="line"> * &lt;p&gt;</span><br><span class="line"> * &#x7528;&#x6765;&#x63D0;&#x4F9B;&#x5B50;&#x7EBF;&#x7A0B;inflate view&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x907F;&#x514D;&#x67D0;&#x4E2A;view&#x5C42;&#x7EA7;&#x592A;&#x6DF1;&#x592A;&#x590D;&#x6742;&#xFF0C;&#x4E3B;&#x7EBF;&#x7A0B;inflate&#x4F1A;&#x8017;&#x65F6;&#x5F88;&#x957F;&#xFF0C;</span><br><span class="line"> * &#x5B9E;&#x5C31;&#x662F;&#x5BF9; AsyncLayoutInflater&#x8FDB;&#x884C;&#x4E86;&#x62BD;&#x53D6;&#x548C;&#x5C01;&#x88C5;</span><br><span class="line"> */</span><br><span class="line">public class AsyncInflateManager {</span><br><span class="line">    private static AsyncInflateManager sInstance;</span><br><span class="line">    private ConcurrentHashMap&lt;String, AsyncInflateItem&gt; mInflateMap; //&#x4FDD;&#x5B58;inflateKey&#x4EE5;&#x53CA;InflateItem&#xFF0C;&#x91CC;&#x9762;&#x5305;&#x542B;&#x6240;&#x6709;&#x8981;&#x8FDB;&#x884C;inflate&#x7684;&#x4EFB;&#x52A1;</span><br><span class="line">    private ConcurrentHashMap&lt;String, CountDownLatch&gt; mInflateLatchMap;</span><br><span class="line">    private ExecutorService mThreadPool; //&#x7528;&#x6765;&#x8FDB;&#x884C;inflate&#x5DE5;&#x4F5C;&#x7684;&#x7EBF;&#x7A0B;&#x6C60;</span><br><span class="line"></span><br><span class="line">    private AsyncInflateManager() {</span><br><span class="line">        mThreadPool = new ThreadPoolExecutor(4, 4, 0, TimeUnit.MILLISECONDS, new LinkedBlockingDeque&lt;Runnable&gt;());</span><br><span class="line">        mInflateMap = new ConcurrentHashMap&lt;&gt;();</span><br><span class="line">        mInflateLatchMap = new ConcurrentHashMap&lt;&gt;();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public static AsyncInflateManager getInstance() {</span><br><span class="line">        &#x5355;&#x4F8B;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x7528;&#x6765;&#x83B7;&#x5F97;&#x5F02;&#x6B65;inflate&#x51FA;&#x6765;&#x7684;view</span><br><span class="line">     *</span><br><span class="line">     * @param context</span><br><span class="line">     * @param layoutResId &#x9700;&#x8981;&#x62FF;&#x7684;layoutId</span><br><span class="line">     * @param parent      container</span><br><span class="line">     * @param inflateKey  &#x6BCF;&#x4E00;&#x4E2A;View&#x4F1A;&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;inflateKey&#xFF0C;&#x56E0;&#x4E3A;&#x53EF;&#x80FD;&#x8BB8;&#x591A;&#x5730;&#x65B9;&#x7528;&#x7684;&#x540C;&#x4E00;&#x4E2A; layout&#xFF0C;&#x4F46;&#x662F;&#x9700;&#x8981;inflate&#x591A;&#x4E2A;&#xFF0C;&#x7528;InflateKey&#x8FDB;&#x884C;&#x533A;&#x5206;</span><br><span class="line">     * @param inflater    &#x5916;&#x90E8;&#x4F20;&#x8FDB;&#x6765;&#x7684;inflater&#xFF0C;&#x5916;&#x9762;&#x5982;&#x679C;&#x6709;inflater&#xFF0C;&#x4F20;&#x8FDB;&#x6765;&#xFF0C;&#x7528;&#x6765;&#x8FDB;&#x884C;&#x53EF;&#x80FD;&#x7684;SyncInflate&#xFF0C;</span><br><span class="line">     * @return &#x6700;&#x540E;inflate&#x51FA;&#x6765;&#x7684;view</span><br><span class="line">     */</span><br><span class="line">    @UiThread</span><br><span class="line">    @NonNull</span><br><span class="line">    public View getInflatedView(Context context, int layoutResId, @Nullable ViewGroup parent, String inflateKey, @NonNull LayoutInflater inflater) {</span><br><span class="line">        if (!TextUtils.isEmpty(inflateKey) &amp;&amp; mInflateMap.containsKey(inflateKey)) {</span><br><span class="line">            AsyncInflateItem item = mInflateMap.get(inflateKey);</span><br><span class="line">            CountDownLatch latch = mInflateLatchMap.get(inflateKey);</span><br><span class="line">            if (item != null) {</span><br><span class="line">                View resultView = item.inflatedView;</span><br><span class="line">                if (resultView != null) {</span><br><span class="line">                    //&#x62FF;&#x5230;&#x4E86;view&#x76F4;&#x63A5;&#x8FD4;&#x56DE;</span><br><span class="line">                    removeInflateKey(inflateKey);</span><br><span class="line">                    replaceContextForView(resultView, context);</span><br><span class="line">                    return resultView;</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                if (item.isInflating() &amp;&amp; latch != null) {</span><br><span class="line">                    //&#x6CA1;&#x62FF;&#x5230;view&#xFF0C;&#x4F46;&#x662F;&#x5728;inflate&#x4E2D;&#xFF0C;&#x7B49;&#x5F85;&#x8FD4;&#x56DE;</span><br><span class="line">                    try {</span><br><span class="line">                        latch.wait();</span><br><span class="line">                    } catch (InterruptedException e) {</span><br><span class="line">                        Log.e(TAG, e.getMessage(), e);</span><br><span class="line">                    }</span><br><span class="line">                    removeInflateKey(inflateKey);</span><br><span class="line">                    if (resultView != null) {</span><br><span class="line">                        replaceContextForView(resultView, context);</span><br><span class="line">                        return resultView;</span><br><span class="line">                    }</span><br><span class="line"></span><br><span class="line">                }</span><br><span class="line">                //&#x5982;&#x679C;&#x8FD8;&#x6CA1;&#x5F00;&#x59CB;inflate&#xFF0C;&#x5219;&#x8BBE;&#x7F6E;&#x4E3A;false&#xFF0C;UI&#x7EBF;&#x7A0B;&#x8FDB;&#x884C;inflate</span><br><span class="line">                item.setCancelled(true);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        //&#x62FF;&#x5F02;&#x6B65;inflate&#x7684;View&#x5931;&#x8D25;&#xFF0C;UI&#x7EBF;&#x7A0B;inflate</span><br><span class="line">        return inflater.inflate(layoutResId, parent, false);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * inflater&#x521D;&#x59CB;&#x5316;&#x65F6;&#x662F;&#x4F20;&#x8FDB;&#x6765;&#x7684;application&#xFF0C;inflate&#x51FA;&#x6765;&#x7684;view&#x7684;context&#x6CA1;&#x6CD5;&#x7528;&#x6765;startActivity&#xFF0C;</span><br><span class="line">     * &#x56E0;&#x6B64;&#x7528;MutableContextWrapper&#x8FDB;&#x884C;&#x5305;&#x88C5;&#xFF0C;&#x540E;&#x7EED;&#x8FDB;&#x884C;&#x66FF;&#x6362;</span><br><span class="line">     */</span><br><span class="line">    private void replaceContextForView(View inflatedView, Context context) {</span><br><span class="line">        if (inflatedView == null || context == null) {</span><br><span class="line">            return;</span><br><span class="line">        }</span><br><span class="line">        Context cxt = inflatedView.getContext();</span><br><span class="line">        if (cxt instanceof MutableContextWrapper) {</span><br><span class="line">            ((MutableContextWrapper) cxt).setBaseContext(context);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @UiThread</span><br><span class="line">    private void asyncInflate(Context context, AsyncInflateItem item) {</span><br><span class="line">        if (item == null || item.layoutResId == 0 || mInflateMap.containsKey(item.inflateKey) || item.isCancelled() || item.isInflating()) {</span><br><span class="line">            return;</span><br><span class="line">        }</span><br><span class="line">        onAsyncInflateReady(item);</span><br><span class="line">        inflateWithThreadPool(context, item);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private void onAsyncInflateReady(AsyncInflateItem item) {</span><br><span class="line">       ...</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private void onAsyncInflateStart(AsyncInflateItem item) {</span><br><span class="line">        ...</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private void onAsyncInflateEnd(AsyncInflateItem item, boolean success) {</span><br><span class="line">        item.setInflating(false);</span><br><span class="line">        CountDownLatch latch = mInflateLatchMap.get(item.inflateKey);</span><br><span class="line">        if (latch != null) {</span><br><span class="line">            //&#x91CA;&#x653E;&#x9501;</span><br><span class="line">            latch.countDown();</span><br><span class="line">        }</span><br><span class="line">        ...</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private void removeInflateKey(String inflateKey) {</span><br><span class="line">        ...</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private void inflateWithThreadPool(Context context, AsyncInflateItem item) {</span><br><span class="line">        mThreadPool.execute(new Runnable() {</span><br><span class="line">            @Override</span><br><span class="line">            public void run() {</span><br><span class="line">                if (!item.isInflating() &amp;&amp; !item.isCancelled()) {</span><br><span class="line">                    try {</span><br><span class="line">                        onAsyncInflateStart(item);</span><br><span class="line">                        item.inflatedView = new BasicInflater(context).inflate(item.layoutResId, item.parent, false);</span><br><span class="line">                        onAsyncInflateEnd(item, true);</span><br><span class="line">                    } catch (RuntimeException e) {</span><br><span class="line">                        Log.e(TAG, &quot;Failed to inflate resource in the background! Retrying on the UI thread&quot;, e);</span><br><span class="line">                        onAsyncInflateEnd(item, false);</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * copy from AsyncLayoutInflater - actual inflater</span><br><span class="line">     */</span><br><span class="line">    private static class BasicInflater extends LayoutInflater {</span><br><span class="line">        private static final String[] sClassPrefixList = new String[]{&quot;android.widget.&quot;, &quot;android.webkit.&quot;, &quot;android.app.&quot;};</span><br><span class="line"></span><br><span class="line">        BasicInflater(Context context) {</span><br><span class="line">            super(context);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        public LayoutInflater cloneInContext(Context newContext) {</span><br><span class="line">            return new BasicInflater(newContext);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        protected View onCreateView(String name, AttributeSet attrs) throws ClassNotFoundException {</span><br><span class="line">            for (String prefix : sClassPrefixList) {</span><br><span class="line">                try {</span><br><span class="line">                    View view = this.createView(name, prefix, attrs);</span><br><span class="line">                    if (view != null) {</span><br><span class="line">                        return view;</span><br><span class="line">                    }</span><br><span class="line">                } catch (ClassNotFoundException ignored) {</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            return super.onCreateView(name, attrs);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x91CC;&#x6211;&#x7528;&#x4E00;&#x4E2A;AsyncInflateItem&#x6765;&#x7BA1;&#x7406;&#x4E00;&#x6B21;&#x8981;inflate&#x7684;&#x4E00;&#x4E2A;&#x5355;&#x4F4D;&#xFF0C;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">arduino&#x590D;&#x5236;&#x4EE3;&#x7801;/**</span><br><span class="line"> * @author zoutao</span><br><span class="line"> */</span><br><span class="line">public class AsyncInflateItem {</span><br><span class="line">    String inflateKey;</span><br><span class="line">    int layoutResId;</span><br><span class="line">    ViewGroup parent;</span><br><span class="line">    OnInflateFinishedCallback callback;</span><br><span class="line">    View inflatedView;</span><br><span class="line"></span><br><span class="line">    private boolean cancelled;</span><br><span class="line">    private boolean inflating;</span><br><span class="line"></span><br><span class="line">    //&#x8FD8;&#x6709;&#x4E00;&#x4E9B;set get&#x65B9;&#x6CD5;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4EE5;&#x53CA;&#x6700;&#x540E;inflate&#x7684;&#x56DE;&#x8C03;callback&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">csharp&#x590D;&#x5236;&#x4EE3;&#x7801;public interface OnInflateFinishedCallback {</span><br><span class="line">    void onInflateFinished(AsyncInflateItem result);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x7ECF;&#x8FC7;&#x8FD9;&#x6837;&#x7684;&#x5C01;&#x88C5;&#xFF0C;&#x5916;&#x9762;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5728;Application&#x7684;onCreate&#x4E2D;&#xFF0C;&#x5F00;&#x59CB;&#x5F02;&#x6B65;&#x7684;inflate view&#x7684;&#x4EFB;&#x52A1;&#x3002;&#x8C03;&#x7528;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;AsyncInflateUtil.startTask();</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author zoutao</span><br><span class="line"> */</span><br><span class="line">public class AsyncInflateUtil {</span><br><span class="line">    public static void startTask() {</span><br><span class="line">        Context context = new MutableContextWrapper(CommonContext.getApplication());</span><br><span class="line">        AsyncInflateManager.getInstance().asyncInflateViews(context,</span><br><span class="line">                new AsyncInflateItem(InflateKey.TAB_1_CONTAINER_FRAGMENT, R.layout.fragment_main),</span><br><span class="line">                new AsyncInflateItem(InflateKey.SUB_TAB_1_FRAGMENT, R.layout.fragment_load_list),</span><br><span class="line">                new AsyncInflateItem(InflateKey.SUB_TAB_2_FRAGMENT, R.layout.fragment_load_list),</span><br><span class="line">                new AsyncInflateItem(InflateKey.SUB_TAB_3_FRAGMENT, R.layout.fragment_load_list),</span><br><span class="line">                new AsyncInflateItem(InflateKey.SUB_TAB_4_FRAGMENT, R.layout.fragment_load_list));</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public class InflateKey {</span><br><span class="line">        public static final String TAB_1_CONTAINER_FRAGMENT = &quot;tab1&quot;;</span><br><span class="line">        public static final String SUB_TAB_1_FRAGMENT = &quot;sub1&quot;;</span><br><span class="line">        public static final String SUB_TAB_2_FRAGMENT = &quot;sub2&quot;;</span><br><span class="line">        public static final String SUB_TAB_3_FRAGMENT = &quot;sub3&quot;;</span><br><span class="line">        public static final String SUB_TAB_4_FRAGMENT = &quot;sub4&quot;;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><strong>&#x6CE8;&#x610F;&#xFF1A;&#x8FD9;&#x91CC;&#x4F1A;&#x6709;&#x4E00;&#x4E2A;&#x5751;&#x3002;&#x5C31;&#x662F;&#x5728;Application&#x7684;onCreate&#x4E2D;&#xFF0C;&#x80FD;&#x62FF;&#x5230;&#x7684;Context&#x53EA;&#x6709;Application&#xFF0C;&#x8FD9;&#x6837;inflate&#x7684;View&#xFF0C;View&#x6301;&#x6709;&#x7684;Context&#x5C31;&#x662F;Application&#xFF0C;&#x8FD9;&#x4F1A;&#x5BFC;&#x81F4;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#x3002;</strong></p>
<p>&#x5982;&#x679C;&#x7528;View.getContext()&#x8FD9;&#x4E2A;context&#x53BB;&#x8FDB;&#x884C;Activity&#x7684;&#x8DF3;&#x8F6C;&#x5C31;&#x4F1A;&#x3002;&#x3002;&#x629B;&#x5F02;&#x5E38;</p>
<blockquote>
<p>Calling startActivity() from outside of an Activity context requires the FLAG_ACTIVITY_NEW_TASK flag. Is this really what you want?</p>
</blockquote>
<p>&#x800C;&#x5982;&#x679C;&#x60F3;&#x8981;&#x4F20;&#x5165;Activity&#x6765;&#x521B;&#x5EFA;LayoutInflater&#xFF0C;&#x65F6;&#x673A;&#x53C8;&#x592A;&#x665A;&#x3002;&#x4F17;&#x6240;&#x5468;&#x77E5;&#xFF0C;Context&#x662F;&#x4E00;&#x4E2A;&#x62BD;&#x8C61;&#x7C7B;&#xFF0C;&#x5B9E;&#x73B0;&#x5B83;&#x7684;&#x5305;&#x88C5;&#x7C7B;&#x5C31;&#x662F;ContextWrapper&#xFF0C;&#x800C;Activity&#x3001;Appcation&#x7B49;&#x90FD;&#x662F;ContextWrapper&#x7684;&#x5B50;&#x7C7B;&#xFF0C;&#x7136;&#x800C;&#xFF0C;ContextWrapper&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x795E;&#x5947;&#x7684;&#x5B50;&#x7C7B;&#xFF0C;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">scala&#x590D;&#x5236;&#x4EE3;&#x7801;package android.content;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Special version of {@link ContextWrapper} that allows the base context to</span><br><span class="line"> * be modified after it is initially set.</span><br><span class="line"> */</span><br><span class="line">public class MutableContextWrapper extends ContextWrapper {</span><br><span class="line">    public MutableContextWrapper(Context base) {</span><br><span class="line">        super(base);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * Change the base context for this ContextWrapper. All calls will then be</span><br><span class="line">     * delegated to the base context.  Unlike ContextWrapper, the base context</span><br><span class="line">     * can be changed even after one is already set.</span><br><span class="line">     * </span><br><span class="line">     * @param base The new base context for this wrapper.</span><br><span class="line">     */</span><br><span class="line">    public void setBaseContext(Context base) {</span><br><span class="line">        mBase = base;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="6-3-&#x88C5;&#x9970;&#x5668;&#x6A21;&#x5F0F;"><a href="#6-3-&#x88C5;&#x9970;&#x5668;&#x6A21;&#x5F0F;" class="headerlink" title="6.3 &#x88C5;&#x9970;&#x5668;&#x6A21;&#x5F0F;"></a>6.3 &#x88C5;&#x9970;&#x5668;&#x6A21;&#x5F0F;</h3><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;Android&#x4E0A;Context&#x7684;&#x8BBE;&#x8BA1;&#x91C7;&#x7528;&#x4E86;&#x88C5;&#x9970;&#x5668;&#x6A21;&#x5F0F;&#xFF0C;&#x88C5;&#x9970;&#x5668;&#x6A21;&#x5F0F;&#x6781;&#x5927;&#x7A0B;&#x5EA6;&#x7684;&#x63D0;&#x9AD8;&#x4E86;&#x7075;&#x6D3B;&#x6027;&#x3002;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x5BF9;&#x6211;&#x6700;&#x5927;&#x7684;&#x611F;&#x53D7;&#x5C31;&#x662F;&#xFF0C;<strong>&#x5F53;&#x5B98;&#x65B9;&#x6CA1;&#x6709;&#x63D0;&#x4F9B;MutableContextWrapper&#x8FD9;&#x4E2A;&#x7C7B;&#x65F6;&#xFF0C;&#x5176;&#x5B9E;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x4E5F;&#x5B8C;&#x5168;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x540C;&#x6837;&#x7684;&#x65B9;&#x5F0F;&#x53BB;&#x8FDB;&#x884C;&#x5B9E;&#x73B0;&#x3002;&#x601D;&#x7EF4;&#x4E00;&#x5B9A;&#x8981;&#x7075;&#x6D3B;~</strong></p>
<h2 id="&#x4E03;&#x3001;&#x603B;&#x7ED3;"><a href="#&#x4E03;&#x3001;&#x603B;&#x7ED3;" class="headerlink" title="&#x4E03;&#x3001;&#x603B;&#x7ED3;"></a>&#x4E03;&#x3001;&#x603B;&#x7ED3;</h2><p>&#x5E38;&#x89C1;&#x7684;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x4F18;&#x5316;&#x7684;&#x65B9;&#x6848;&#x6709;&#xFF1A;</p>
<ul>
<li>&#x6570;&#x636E;&#x61D2;&#x52A0;&#x8F7D;&#xFF0C;&#x6BD4;&#x5982;Fragment&#x7528;&#x6237;&#x4E0D;&#x53EF;&#x89C1;&#x65F6;&#x4E0D;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x7684;&#x83B7;&#x53D6;</li>
<li>&#x4F18;&#x5316;&#x5E03;&#x5C40;&#x5C42;&#x7EA7;&#xFF0C;&#x51CF;&#x5C11;&#x9996;&#x6B21;inflate layout&#x7684;&#x8017;&#x65F6;</li>
<li>&#x5C06;&#x7EDD;&#x5927;&#x90E8;&#x5206;sdk&#x7684;&#x521D;&#x59CB;&#x5316;&#x653E;&#x7EBF;&#x7A0B;&#x6C60;&#x4E2D;&#x8FD0;&#x884C;</li>
<li>&#x80FD;&#x7528;ViewStub&#x7684;&#x5C31;&#x7528;ViewStub&#xFF0C;&#x6309;&#x9700;&#x52A0;&#x8F7D;layout</li>
<li>&#x4E00;&#x5B9A;&#x8981;&#x5C3D;&#x91CF;&#x907F;&#x514D;&#x542F;&#x52A8;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x51FA;&#x73B0;&#x7684;&#x4E3B;&#x7EBF;&#x7A0B;&#x53BB;unpack&#x4E00;&#x4E9B;&#x5168;&#x5C40;&#x914D;&#x7F6E;&#x7684;&#x6570;&#x636E;</li>
<li>&#x4E0D;&#x4EC5;&#x4EC5;&#x662F;&#x4E09;&#x65B9;&#x5E93;&#x53EF;&#x4EE5;&#x653E;&#x5B50;&#x7EBF;&#x7A0B;&#x8FDB;&#x884C;&#xFF0C;&#x4E00;&#x4E9B;&#x65F6;&#x6548;&#x6027;&#x8981;&#x6C42;&#x6CA1;&#x90A3;&#x4E48;&#x9AD8;&#x7684;&#x903B;&#x8F91;&#x90FD;&#x53EF;&#x4EE5;&#x653E;&#x5B50;&#x7EBF;&#x7A0B;</li>
</ul>
<p>&#x8FD9;&#x4E9B;&#x90FD;&#x53EF;&#x4EE5;&#x5728;&#x7F51;&#x4E0A;&#x627E;&#x5230;&#x5927;&#x91CF;&#x7684;&#x6587;&#x7AE0;&#x4EE5;&#x53CA;&#x5404;&#x4E2A;&#x5927;&#x4F6C;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x6848;&#x3002;</p>
<p>&#x9996;&#x5148;&#xFF0C;&#x4F18;&#x5316;&#x7684;&#x5927;&#x65B9;&#x5411;&#x80AF;&#x5B9A;&#x5148;&#x5B9A;&#x597D;&#xFF1A;</p>
<ol>
<li>&#x61D2;&#x52A0;&#x8F7D;</li>
<li>&#x9884;&#x52A0;&#x8F7D;</li>
</ol>
<p>&#x61D2;&#x52A0;&#x8F7D;&#xFF1A;</p>
<ul>
<li>&#x9996;&#x5C4F;&#x52A0;&#x8F7D;&#x65F6;&#xFF0C;&#x53EA;&#x5F80;ViewPager&#x4E2D;&#x585E;&#x5165;&#x9ED8;&#x8BA4;&#x8981;&#x5C55;&#x793A;&#x7684;tab&#xFF0C;&#x5269;&#x4F59;&#x7684;tab&#x7528;&#x7A7A;&#x7684;&#x5360;&#x4F4D;Fragment&#x4EE3;&#x66FF;</li>
<li>&#x5F53;&#x7528;&#x6237;&#x6ED1;&#x52A8;&#x5230;&#x5176;&#x4ED6;tab&#x65F6;&#xFF0C;&#x6BD4;&#x5982;&#x6ED1;&#x52A8;&#x5230;&#x597D;&#x53CB;&#x52A8;&#x6001;tab&#xFF0C;&#x5C31;&#x7528;FriendFragment&#x628A;&#x5F53;&#x524D;&#x7684;EmptyPlaceholderFragment&#x66FF;&#x6362;&#x6389;&#xFF0C;&#x7136;&#x540E;adapter.notifyDataSetChanged</li>
<li>&#x5F53;&#x56DB;&#x4E2A;Tab&#x5168;&#x90E8;&#x66FF;&#x6362;&#x4E3A;&#x6570;&#x636E;tab&#x65F6;&#xFF0C;&#x6E05;&#x9664;&#x6389;EmptyFragment&#x7684;&#x5F15;&#x7528;&#xFF0C;&#x91CA;&#x653E;&#x5185;&#x5B58;</li>
</ul>
<p>&#x9884;&#x52A0;&#x8F7D;&#xFF1A;</p>
<ul>
<li>Application onCreate&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x9488;&#x5BF9;&#x540E;&#x7EED;&#x6240;&#x6709;&#x7684;Fragment&#xFF0C;&#x5728;&#x5B50;&#x7EBF;&#x7A0B;&#x4E2D;&#x5C06;Layout&#x5148;&#x7ED9;inflate&#x51FA;&#x6765;</li>
<li>&#x9488;&#x5BF9;inflate&#x5B8C;&#x6210;&#x7684;View&#x52A0;&#x5165;&#x4E00;&#x5957;&#x7F13;&#x5B58;&#x7684;&#x5B58;&#x53D6;&#x673A;&#x5236;&#xFF0C;&#x4EE5;&#x53CA;&#x7B49;&#x5F85;&#x673A;&#x5236;</li>
<li>&#x5982;&#x679C;&#x6B63;&#x5728;inflate&#xFF0C;&#x5219;&#x8FDB;&#x884C;&#x963B;&#x585E;&#x7B49;&#x5F85;</li>
<li>&#x5982;&#x679C;&#x5DF2;&#x7ECF;inflate&#x5B8C;&#x6210;&#x4E86;&#xFF0C;&#x53D6;&#x51FA;view&#xFF0C;&#x5E76;&#x91CA;&#x653E;&#x7F13;&#x5B58;&#x5BF9;&#x4E8E;View&#x7684;&#x5F15;&#x7528;</li>
<li>&#x5982;&#x679C;&#x8FD8;&#x6CA1;&#x6709;&#x5F00;&#x59CB;Inflate&#xFF0C;&#x5219;&#x5728;UI&#x7EBF;&#x7A0B;&#x76F4;&#x63A5;&#x8FDB;&#x884C;inflate</li>
</ul>
<p><strong>&#x8FD9;&#x4E9B;&#x65B9;&#x6848;&#x4E0D;&#x4E00;&#x5B9A;&#x975E;&#x5E38;&#x597D;&#x4F7F;&#xFF0C;&#x6240;&#x4EE5;&#x4EC5;&#x4F9B;&#x53C2;&#x8003;<del>~</del></strong></p>
<p>&#x4ECE;ContextWrapper&#x3001;MutableContextWrapper&#x7C7B;&#x7684;&#x8BBE;&#x8BA1;&#x4E2D;&#x5B66;&#x5230;&#x4E86;  &#x2193;</p>
<h2 id="&#x5199;&#x4EE3;&#x7801;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x9996;&#x5148;&#x8981;&#x8FDB;&#x884C;&#x8BBE;&#x8BA1;&#xFF0C;&#x9009;&#x7528;&#x6700;&#x5408;&#x9002;&#x7684;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#xFF0C;&#x8FD9;&#x6837;&#x540E;&#x7EED;&#x8D5A;&#x5230;&#x7684;&#x8FDC;&#x8FDC;&#x5927;&#x4E8E;&#x5199;&#x4E00;&#x4E2A;&#x6587;&#x6863;&#x3001;&#x60F3;&#x4E00;&#x4E2A;&#x8BBE;&#x8BA1;&#x6240;&#x8017;&#x8D39;&#x7684;&#x65F6;&#x95F4;&#x548C;&#x8111;&#x529B;&#x6210;&#x672C;"><a href="#&#x5199;&#x4EE3;&#x7801;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x9996;&#x5148;&#x8981;&#x8FDB;&#x884C;&#x8BBE;&#x8BA1;&#xFF0C;&#x9009;&#x7528;&#x6700;&#x5408;&#x9002;&#x7684;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#xFF0C;&#x8FD9;&#x6837;&#x540E;&#x7EED;&#x8D5A;&#x5230;&#x7684;&#x8FDC;&#x8FDC;&#x5927;&#x4E8E;&#x5199;&#x4E00;&#x4E2A;&#x6587;&#x6863;&#x3001;&#x60F3;&#x4E00;&#x4E2A;&#x8BBE;&#x8BA1;&#x6240;&#x8017;&#x8D39;&#x7684;&#x65F6;&#x95F4;&#x548C;&#x8111;&#x529B;&#x6210;&#x672C;" class="headerlink" title="&#x5199;&#x4EE3;&#x7801;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x9996;&#x5148;&#x8981;&#x8FDB;&#x884C;&#x8BBE;&#x8BA1;&#xFF0C;&#x9009;&#x7528;&#x6700;&#x5408;&#x9002;&#x7684;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#xFF0C;&#x8FD9;&#x6837;&#x540E;&#x7EED;&#x8D5A;&#x5230;&#x7684;&#x8FDC;&#x8FDC;&#x5927;&#x4E8E;&#x5199;&#x4E00;&#x4E2A;&#x6587;&#x6863;&#x3001;&#x60F3;&#x4E00;&#x4E2A;&#x8BBE;&#x8BA1;&#x6240;&#x8017;&#x8D39;&#x7684;&#x65F6;&#x95F4;&#x548C;&#x8111;&#x529B;&#x6210;&#x672C;"></a>&#x5199;&#x4EE3;&#x7801;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x9996;&#x5148;&#x8981;&#x8FDB;&#x884C;&#x8BBE;&#x8BA1;&#xFF0C;&#x9009;&#x7528;&#x6700;&#x5408;&#x9002;&#x7684;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#xFF0C;&#x8FD9;&#x6837;&#x540E;&#x7EED;&#x8D5A;&#x5230;&#x7684;&#x8FDC;&#x8FDC;&#x5927;&#x4E8E;&#x5199;&#x4E00;&#x4E2A;&#x6587;&#x6863;&#x3001;&#x60F3;&#x4E00;&#x4E2A;&#x8BBE;&#x8BA1;&#x6240;&#x8017;&#x8D39;&#x7684;&#x65F6;&#x95F4;&#x548C;&#x8111;&#x529B;&#x6210;&#x672C;</h2><p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/905f443e925cc63f21af9e9cd48f947023bd31d929041aa34773936d347ad6c0" alt></p>
<p><strong>&#x6211;&#x7684;&#x7B80;&#x4E66; <a href="/external_links/f2aaac8b595386986ebb09814f5930be.html" target="blank" rel="noopener">&#x90B9;&#x554A;&#x6D9B;&#x6D9B;&#x6D9B;&#x7684;&#x7B80;&#x4E66;</a></strong></p>
<p><strong>&#x6211;&#x7684;CSDN</strong> <strong><a href="/external_links/3d7b9c9f5199f309316bc30af805c170.html" target="blank" rel="noopener">&#x90B9;&#x554A;&#x6D9B;&#x6D9B;&#x6D9B;&#x7684;CSDN</a></strong></p>
<p><strong>&#x6211;&#x7684;&#x6398;&#x91D1; <a href="/external_links/6e6ffa19872c648cc288f487cbf401dc.html" target="blank" rel="noopener">&#x90B9;&#x554A;&#x6D9B;&#x6D9B;&#x6D9B;&#x7684;&#x6398;&#x91D1;</a></strong></p>
<h2 id="&#x4F60;&#x53EF;&#x80FD;&#x611F;&#x5174;&#x8DA3;"><a href="#&#x4F60;&#x53EF;&#x80FD;&#x611F;&#x5174;&#x8DA3;" class="headerlink" title="&#x4F60;&#x53EF;&#x80FD;&#x611F;&#x5174;&#x8DA3;"></a>&#x4F60;&#x53EF;&#x80FD;&#x611F;&#x5174;&#x8DA3;</h2><p><a href="/external_links/b892305c27d5f122cffdeb3c944d003b.html" target="blank" rel="noopener">Android QUIC &#x5B9E;&#x8DF5; - &#x57FA;&#x4E8E; OKHttp &#x6269;&#x5C55;&#x51FA; Cronet &#x62E6;&#x622A;&#x5668; - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/7306692609497546752">Android&#x542F;&#x52A8;&#x4F18;&#x5316;&#x5B9E;&#x8DF5; - &#x79D2;&#x5F00;&#x7387;&#x4ECE;17%&#x63D0;&#x5347;&#x81F3;75% - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/7302982924987039796">&#x5982;&#x4F55;&#x79D1;&#x5B66;&#x7684;&#x8FDB;&#x884C;Android&#x5305;&#x4F53;&#x79EF;&#x4F18;&#x5316; - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/7297035708429598754">Android&#x7A33;&#x5B9A;&#x6027;&#xFF1A;Looper&#x515C;&#x5E95;&#x6846;&#x67B6;&#x5B9E;&#x73B0;&#x7EBF;&#x4E0A;&#x5BB9;&#x707E;&#xFF08;&#x4E8C;&#xFF09; - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/7288178532861755432">&#x57FA;&#x4E8E; Booster ASM API&#x7684;&#x914D;&#x7F6E;&#x5316; hook &#x65B9;&#x6848;&#x5C01;&#x88C5; - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/7287241480770076687">&#x8BB0; AndroidStudio Tracer&#x5DE5;&#x5177;&#x5BFC;&#x81F4;&#x7684;&#x7F16;&#x8BD1;&#x5931;&#x8D25; - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/7280864416555860003">Android &#x542F;&#x52A8;&#x4F18;&#x5316;&#x6848;&#x4F8B;-WebView&#x975E;&#x9884;&#x671F;&#x521D;&#x59CB;&#x5316;&#x6392;&#x67E5; - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/7274430147126280207">chromium-net - &#x8DDF;&#x968F; Cronet &#x7684;&#x811A;&#x6B65;&#x63A2;&#x7D22;&#x5927;&#x81F4;&#x6D41;&#x7A0B;&#xFF08;1&#xFF09; - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/7198466997288566842">Android&#x7A33;&#x5B9A;&#x6027;&#xFF1A;&#x53EF;&#x8FDC;&#x7A0B;&#x914D;&#x7F6E;&#x5316;&#x7684;Looper&#x515C;&#x5E95;&#x6846;&#x67B6; - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/7141301214523686926">&#x4E00;&#x7C7B;&#x6709;&#x8DA3;&#x7684;&#x65E0;&#x9650;&#x7F13;&#x5B58;OOM&#x73B0;&#x8C61; - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/6844903924965572615">Android - &#x4E00;&#x79CD;&#x65B0;&#x5947;&#x7684;&#x51B7;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x4F18;&#x5316;&#x601D;&#x8DEF;(Fragment&#x6781;&#x5EA6;&#x61D2;&#x52A0;&#x8F7D; + Layout&#x5B50;&#x7EBF;&#x7A0B;&#x9884;&#x52A0;&#x8F7D;) - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/6844903923745030158">Android - &#x5F7B;&#x5E95;&#x6D88;&#x706D;OOM&#x7684;&#x5B9E;&#x6218;&#x7ECF;&#x9A8C;&#x5206;&#x4EAB;&#xFF08;&#x5343;&#x5206;&#x4E4B;1.5 -&gt; &#x4E07;&#x5206;&#x4E4B;0.2&#xFF09; - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/13f852a7d40e5660b69e70945274d07f.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="../162/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="../../">1</a><span class="space">&hellip;</span><a class="page-number" href="../162/">162</a><span class="page-number current">163</span><a class="page-number" href="../164/">164</a><span class="space">&hellip;</span><a class="page-number" href="../178/">178</a><a class="extend next" rel="next" href="../164/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">开发者博客</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="https://dev.newban.cn/archives/">
              
                  <span class="site-state-item-count">1775</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">725</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="../../atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">开发者博客</span>
  <div>
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
  </div>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




  <script type="text/javascript" async src="js/src/mermaid.min.js"></script>
  <script>
  if (window.mermaid) {
        var mermaid_config = {
            startOnLoad: true,
            theme: 'default',
            flowchart:{
                useMaxWidth: false,
                htmlLabels: true
            }                
        }
        mermaid.initialize(mermaid_config);
  }
  </script>
  

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="../../lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="../../lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="../../lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="../../lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="../../lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="../../lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="../../js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="../../js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="../../js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
