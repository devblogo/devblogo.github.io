<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">
<meta name="referrer" content="never">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="../../lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="../../lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="../../css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="../../images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="../../images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="../../images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="../../images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">





  <link rel="alternate" href="../../atom.xml" title="开发者博客 – IT技术 尽在开发者博客" type="application/atom+xml">






<meta property="og:type" content="website">
<meta property="og:title" content="开发者博客 – IT技术 尽在开发者博客">
<meta property="og:url" content="https://dev.newban.cn/page/41/index.html">
<meta property="og:site_name" content="开发者博客 – IT技术 尽在开发者博客">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="开发者博客 – IT技术 尽在开发者博客">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>
<!--谷歌广告验证代码-->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-2626449904708114",
          enable_page_level_ads: true
     });
</script>
<!--谷歌广告验证代码-->



  <link rel="canonical" href="https://dev.newban.cn/page/41/">





  <title>开发者博客 – IT技术 尽在开发者博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">开发者博客 – IT技术 尽在开发者博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">开发者博客 – 科技是第一生产力</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="http://dev.newban.cn/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="https://dev.newban.cn/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7349124917378695180.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7349124917378695180.html" itemprop="url">Flutter - 升级319之后页面多次rebuild？</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-03-24T14:44:22+08:00">
                2024-03-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>&#x6B22;&#x8FCE;&#x5173;&#x6CE8;&#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x53F7;&#xFF1A;<a href="/external_links/d31e77effa2c9a5c6fc7141cdeb0b161.html" target="blank" rel="noopener">FSA&#x5168;&#x6808;&#x884C;&#x52A8;</a> &#x1F44B;</p>
</blockquote>
<p>BiliBili: <a href="/external_links/4f1b7d544de737e9c9a37b3d367b13d8.html" target="blank" rel="noopener">www.bilibili.com/video/BV1Qm&#x2026;</a></p>
<h2 id="&#x4E00;&#x3001;&#x80CC;&#x666F;"><a href="#&#x4E00;&#x3001;&#x80CC;&#x666F;" class="headerlink" title="&#x4E00;&#x3001;&#x80CC;&#x666F;"></a>&#x4E00;&#x3001;&#x80CC;&#x666F;</h2><p>&#x4E0A;&#x5468;&#x4E00;&#x5C1D;&#x8BD5;&#x4ECE; <code>3.16.9</code> &#x5347;&#x7EA7; <code>3.19.3</code>&#xFF0C;&#x4E3B;&#x8981;&#x6709;&#x4E24;&#x4E2A;&#x539F;&#x56E0;&#xFF1A;</p>
<p>&#x4E00;&#x662F;&#x5B89;&#x5353;&#x7AEF;&#x6709;&#x4E00;&#x4E2A;&#x7591;&#x4F3C;&#x9020;&#x6210;&#x5D29;&#x6E83;&#x7387;&#x4E0A;&#x6DA8;&#x7684; <code>bug</code> &#x5728; <code>Flutter 3.16</code> &#x4E0A;&#x51FA;&#x73B0;&#xFF0C;&#x76F8;&#x5173;issue: <a href="/external_links/e6536e9c49475562749b6fac2ecb1e9a.html" target="blank" rel="noopener">#138947</a>, &#x8BE5; <code>bug</code> &#x5728; <code>3.13</code> &#x4E0D;&#x4F1A;&#x51FA;&#x73B0;&#xFF0C;&#x5728; <code>3.17.pre</code> &#x4E0A;&#x5F97;&#x5230;&#x4FEE;&#x590D;&#xFF0C;&#x800C; <code>3.16</code> &#x4E4B;&#x540E;&#x7684;&#x4E0B;&#x4E2A;&#x6B63;&#x5F0F;&#x7248;&#x672C;&#x662F; <code>3.19</code>&#x3002;</p>
<p>&#x4E8C;&#x662F;&#x82F9;&#x679C;&#x7684;&#x9690;&#x79C1;&#x6E05;&#x5355;&#x5BA1;&#x6838;&#x653F;&#x7B56;&#x3002;</p>
<p>&#x5728;&#x82F9;&#x679C;&#x53D1;&#x5E03;&#x7684;&#x3010;<a href="/external_links/4886c013ef0c7a08d813d0fdf5f6e54f.html" target="blank" rel="noopener">&#x5173;&#x4E8E; App Store &#x63D0;&#x4EA4;&#x7684;&#x9690;&#x79C1;&#x66F4;&#x65B0;</a>&#x3011;&#x65B0;&#x95FB;&#x4E2D;&#x6307;&#x51FA;</p>
<blockquote>
<p><strong>&#x81EA; 3 &#x6708; 13 &#x65E5;&#x8D77;&#xFF1A;</strong> &#x5982;&#x679C;&#x4F60;&#x4E0A;&#x4F20;&#x65B0; App &#x6216;&#x66F4;&#x65B0; App &#x5230; App Store Connect&#xFF0C;&#x4E14;&#x8BE5; App &#x4F7F;&#x7528;&#x4E86;&#x9700;&#x8981;&#x58F0;&#x660E;&#x6279;&#x51C6;&#x539F;&#x56E0;&#x7684; API&#xFF0C;&#x4F46;&#x4F60;&#x672A;&#x5728; App &#x7684;&#x9690;&#x79C1;&#x6E05;&#x5355;&#x4E2D;&#x63D0;&#x4F9B;&#x6279;&#x51C6;&#x539F;&#x56E0;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x901A;&#x8FC7;&#x7535;&#x5B50;&#x90AE;&#x4EF6;&#x544A;&#x77E5;&#x4F60;&#x3002;&#x8FD9;&#x662F;&#x5BF9; App Store Connect &#x4E2D;&#x73B0;&#x6709;&#x901A;&#x77E5;&#x7684;&#x8865;&#x5145;&#x3002;</p>
<p><strong>&#x81EA; 5 &#x6708; 1 &#x65E5;&#x8D77;&#xFF1A;</strong> &#x4F60;&#x9700;&#x8981;&#x5C31;&#x4F60;&#x7684; App &#x4EE3;&#x7801;&#x4F7F;&#x7528;&#x7684;&#x6240;&#x5217; API &#x63D0;&#x4F9B;&#x6279;&#x51C6;&#x539F;&#x56E0;&#xFF0C;&#x624D;&#x80FD;&#x5C06;&#x65B0; App &#x6216;&#x66F4;&#x65B0; App &#x4E0A;&#x4F20;&#x5230; App Store Connect&#x3002;&#x5982;&#x679C;&#x4F60;&#x6CA1;&#x6709;&#x5408;&#x7406;&#x7684;&#x539F;&#x56E0;&#x4F7F;&#x7528;&#x67D0;&#x4E2A; API&#xFF0C;&#x8BF7;&#x5BFB;&#x627E;&#x66FF;&#x4EE3;&#x7684;&#x65B9;&#x6848;&#x3002;&#x5982;&#x679C;&#x4F60;&#x6DFB;&#x52A0;&#x4E86;&#x5E38;&#x7528;&#x7B2C;&#x4E09;&#x65B9; SDK &#x5217;&#x8868;&#x4E2D;&#x6240;&#x5217;&#x7684;&#x65B0;&#x7248;&#x7B2C;&#x4E09;&#x65B9; SDK&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x4E9B; API&#x3001;&#x9690;&#x79C1;&#x6E05;&#x5355;&#x548C;&#x7B7E;&#x540D;&#x8981;&#x6C42;&#x5C06;&#x5E94;&#x7528;&#x4E8E;&#x8BE5; SDK&#x3002;&#x8BF7;&#x52A1;&#x5FC5;&#x4F7F;&#x7528;&#x5305;&#x542B;&#x5176;&#x9690;&#x79C1;&#x6E05;&#x5355;&#x7684; SDK &#x7248;&#x672C;&#xFF0C;&#x5E76;&#x6CE8;&#x610F;&#x5728;&#x5C06;&#x8BE5; SDK &#x6DFB;&#x52A0;&#x4E3A;&#x4E8C;&#x8FDB;&#x5236;&#x4F9D;&#x8D56;&#x9879;&#x65F6;&#x4E5F;&#x9700;&#x8981;&#x63D0;&#x4F9B;&#x7B7E;&#x540D;&#x3002;</p>
</blockquote>
<p>&#x5728;&#x82F9;&#x679C;&#x7684;&#x3010;<a href="/external_links/584d15b93d01a0f71aa931c15da16de8.html" target="blank" rel="noopener">&#x5373;&#x5C06;&#x53D1;&#x5E03;&#x7684;&#x7B2C;&#x4E09;&#x65B9;SDK&#x8981;&#x6C42;</a>&#x3011;&#x4E00;&#x6587;&#x4E2D;&#xFF0C;&#x5217;&#x4E3E;&#x51FA;&#x9700;&#x8981;&#x9690;&#x79C1;&#x6E05;&#x5355;&#x548C;&#x7B7E;&#x540D;&#x7684; <code>SDK</code>&#xFF0C;&#x5176;&#x4E2D;&#x5C31;&#x5305;&#x542B;&#x4E86; <code>Flutter</code>&#x3002;&#x4E3A;&#x4E86;&#x7B26;&#x5408;&#x8BE5;&#x5BA1;&#x6838;&#x8981;&#x6C42;&#xFF0C;<code>Flutter</code> &#x4ECE; <code>3.19</code> &#x5F00;&#x59CB;&#x5305;&#x542B;&#x4E86; <code>PrivacyInfo.xcprivacy</code> &#x8FD9;&#x4E2A;&#x9690;&#x79C1;&#x6E05;&#x5355;&#x6587;&#x4EF6;&#x3002;</p>
<p>&#x6587;&#x4EF6;&#x4F4D;&#x4E8E;: <a href="/external_links/176a9cac15edffec178463c3f54fa3a9.html" target="blank" rel="noopener">github.com/flutter/eng&#x2026;</a></p>
<h2 id="&#x4E8C;&#x3001;&#x8E29;&#x5751;"><a href="#&#x4E8C;&#x3001;&#x8E29;&#x5751;" class="headerlink" title="&#x4E8C;&#x3001;&#x8E29;&#x5751;"></a>&#x4E8C;&#x3001;&#x8E29;&#x5751;</h2><p>&#x5347;&#x5230;&#x5230; <code>3.19.3</code> &#x540E;&#x53D1;&#x73B0;&#xFF0C;&#x4ECE; <code>&#x9875;&#x9762;A</code> &#x8DF3;&#x8F6C;&#x5230; <code>&#x9875;&#x9762;B</code> &#x548C;&#x8FD4;&#x56DE; <code>&#x9875;&#x9762;A</code> &#x65F6;&#xFF0C;<code>&#x9875;&#x9762;A</code> &#x7684; <code>build</code> &#x65B9;&#x6CD5;&#x90FD;&#x4F1A;&#x88AB;&#x6267;&#x884C;&#xFF0C;&#x964D;&#x56DE; <code>3.16.9</code> &#x5219;&#x4E0D;&#x4F1A;&#xFF0C;&#x8FD9;&#x5C31;&#x5F88;&#x5947;&#x602A;&#x3002;&#x540E;&#x6765;&#x53D1;&#x73B0;&#x662F;&#x56E0;&#x4E3A; <code>&#x9875;&#x9762;A</code> &#x95F4;&#x63A5;&#x4F7F;&#x7528;&#x4E86; <code>ModalRoute.of</code>&#x3002;</p>
<p>&#x4EE5;&#x4E0B;&#x662F;&#x53EF;&#x590D;&#x73B0;&#x95EE;&#x9898;&#x7684;&#x4EE3;&#x7801;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">diff&#x590D;&#x5236;&#x4EE3;&#x7801;class PageA extends StatefulWidget {</span><br><span class="line">  @override</span><br><span class="line">  State&lt;PageA&gt; createState() =&gt; _PageAState();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">class _PageAState extends State&lt;PageA&gt; {</span><br><span class="line">  @override</span><br><span class="line">  Widget build(BuildContext context) {</span><br><span class="line"></span><br><span class="line">    // ==== &#x8FD9;&#x91CC; ====</span><br><span class="line">+    final arguments = ModalRoute.of(context)?.settings.arguments;</span><br><span class="line">+    print(&quot;PageA arguments:$arguments&quot;);</span><br><span class="line"></span><br><span class="line">    return Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        backgroundColor: Theme.of(context).colorScheme.inversePrimary,</span><br><span class="line">        title: const Text(&apos;PageA&apos;),</span><br><span class="line">      ),</span><br><span class="line">      body: const SizedBox.shrink(),</span><br><span class="line">    );</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h2 id="&#x4E09;&#x3001;&#x63A2;&#x7D22;"><a href="#&#x4E09;&#x3001;&#x63A2;&#x7D22;" class="headerlink" title="&#x4E09;&#x3001;&#x63A2;&#x7D22;"></a>&#x4E09;&#x3001;&#x63A2;&#x7D22;</h2><p>&#x5728;&#x7ECF;&#x8FC7;&#x4E00;&#x756A;&#x6478;&#x7D22;&#x540E;&#xFF0C;&#x53D1;&#x73B0; <code>ModalRoute</code> &#x5728; <code>3.19</code> &#x4E0A;&#x9762;&#x6709;&#x4E00;&#x4E2A;&#x5C0F;&#x4FEE;&#x6539;~</p>
<p>&#x76F8;&#x5173; <code>issue</code> &#x662F;: <a href="/external_links/4069a94cfbb6f26d35587d26e49dc320.html" target="blank" rel="noopener">#112567</a> &#x3002;</p>
<p>&#x8BE5; <code>issue</code> &#x4E3B;&#x8981;&#x662F;&#x6D89;&#x53CA;&#x5728; <code>Web</code> &#x7AEF;&#x4E0A;&#x6309; <code>Tab</code> &#x952E;&#x5207;&#x6362;&#x7126;&#x70B9;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x540E;&#x7EED;&#x6709;&#x4E2A; <code>PR</code>: <a href="/external_links/b296af1fe419fce2588b74a4b257f04e.html" target="blank" rel="noopener">#130841</a> &#x89E3;&#x51B3;&#x4E86;&#x8BE5;&#x95EE;&#x9898;&#x3002;</p>
<blockquote>
<p>&#x8BE5; <code>PR</code> &#x56E0;&#x5185;&#x90E8;&#x6D4B;&#x8BD5;&#x539F;&#x56E0;&#x8FDB;&#x884C;&#x4E86;&#x56DE;&#x6EDA;&#xFF0C;&#x540E;&#x518D;&#x91CD;&#x65B0;&#x767B;&#x9646;&#xFF0C;&#x73B0;PR: <a href="/external_links/a27a8fbdbb6b8b70d051c7360dbabce7.html" target="blank" rel="noopener">#134554</a></p>
</blockquote>
<p>&#x800C;&#x5728;&#x8BE5; <code>PR</code> &#x4E2D;&#x5C31;&#x5BF9; <code>ModalRoute</code> &#x52A0;&#x4E86;&#x5982;&#x4E0B;&#x4EE3;&#x7801;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">diff&#x590D;&#x5236;&#x4EE3;&#x7801;// packages/flutter/lib/src/widgets/routes.dart</span><br><span class="line"></span><br><span class="line">abstract class ModalRoute&lt;T&gt; extends TransitionRoute&lt;T&gt; with LocalHistoryRoute&lt;T&gt; {</span><br><span class="line">  ...</span><br><span class="line">+  @override</span><br><span class="line">+  void didChangeNext(Route&lt;dynamic&gt;? nextRoute) {</span><br><span class="line">+    super.didChangeNext(nextRoute);</span><br><span class="line">+    changedInternalState();</span><br><span class="line">+  }</span><br><span class="line">+</span><br><span class="line">+  @override</span><br><span class="line">+  void didPopNext(Route&lt;dynamic&gt; nextRoute) {</span><br><span class="line">+    super.didPopNext(nextRoute);</span><br><span class="line">+    changedInternalState();</span><br><span class="line">+  }</span><br><span class="line">+</span><br><span class="line">  @override</span><br><span class="line">  void changedInternalState() {</span><br><span class="line">    super.changedInternalState();</span><br><span class="line">-    setState(() { /* internal state already changed */ });</span><br><span class="line">-    _modalBarrier.markNeedsBuild();</span><br><span class="line">+    // No need to mark dirty if this method is called during build phase.</span><br><span class="line">+    if (SchedulerBinding.instance.schedulerPhase != SchedulerPhase.persistentCallbacks) {</span><br><span class="line">+      setState(() { /* internal state already changed */ });</span><br><span class="line">+      _modalBarrier.markNeedsBuild();</span><br><span class="line">+    }</span><br><span class="line">    _modalScope.maintainState = maintainState;</span><br><span class="line">  }</span><br><span class="line">...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><code>didChangeNext</code> &#x548C; <code>didPopNext</code> &#x8FD9;&#x4E24;&#x4E2A;&#x65B9;&#x6CD5;&#x5BF9;&#x5E94;&#x7684;&#x5C31;&#x662F;&#x9875;&#x9762;&#x7684; <code>push</code> &#x548C; <code>pop</code>&#xFF0C;&#x73B0;&#x5728;&#x5728;&#x8BE5; <code>PR</code> &#x4E2D;&#x91CD;&#x5199;&#x5E76;&#x8C03;&#x7528;&#x4E86; <code>changedInternalState</code> &#x65B9;&#x6CD5;&#xFF0C;&#x5728; <code>changedInternalState</code> &#x65B9;&#x6CD5;&#x4E2D;&#x8C03;&#x7528;&#x4E86; <code>setState</code>&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x5C06;&#x4EE5;&#x9AD8;&#x4EAE;&#x7684;&#x65B9;&#x5F0F;&#x6807;&#x51FA;&#x91CD;&#x70B9;&#x4EE3;&#x7801;&#xFF08;&#x4E0D;&#x662F;&#x65B0;&#x589E;&#x4EE3;&#x7801;&#xFF09;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">diff&#x590D;&#x5236;&#x4EE3;&#x7801;abstract class ModalRoute&lt;T&gt; extends TransitionRoute&lt;T&gt; with LocalHistoryRoute&lt;T&gt; {</span><br><span class="line">  ...</span><br><span class="line">  @protected</span><br><span class="line">  void setState(VoidCallback fn) {</span><br><span class="line">    if (_scopeKey.currentState != null) {</span><br><span class="line">+      _scopeKey.currentState!._routeSetState(fn);</span><br><span class="line">    } else {</span><br><span class="line">      // The route isn&apos;t currently visible, so we don&apos;t have to call its setState</span><br><span class="line">      // method, but we do still need to call the fn callback, otherwise the state</span><br><span class="line">      // in the route won&apos;t be updated!</span><br><span class="line">      fn();</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x4E2A; <code>ModalRoute</code> &#x5185;&#x7684; <code>setState</code> &#x4F1A;&#x4F7F; <code>_ModalScopeStatus</code> &#x7684; <code>_routeSetState</code> &#x88AB;&#x8C03;&#x7528;&#xFF0C;&#x7136;&#x540E;&#x89E6;&#x53D1; <code>_ModalScopeState</code> &#x7684; <code>setState</code>&#xFF0C;&#x63A5;&#x7740;&#x5176; <code>child: _ModalScopeStatus</code> &#x5C31;&#x5F00;&#x59CB; <code>rebuild</code> &#x4E86;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">diff&#x590D;&#x5236;&#x4EE3;&#x7801;class _ModalScopeState&lt;T&gt; extends State&lt;_ModalScope&lt;T&gt;&gt; {</span><br><span class="line">  ...</span><br><span class="line">  void _routeSetState(VoidCallback fn) {</span><br><span class="line">    if (widget.route.isCurrent &amp;&amp; !_shouldIgnoreFocusRequest &amp;&amp; _shouldRequestFocus) {</span><br><span class="line">      widget.route.navigator!.focusNode.enclosingScope?.setFirstFocus(focusScopeNode);</span><br><span class="line">    }</span><br><span class="line">+    setState(fn);</span><br><span class="line">  }</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  @override</span><br><span class="line">  Widget build(BuildContext context) {</span><br><span class="line">    return AnimatedBuilder(</span><br><span class="line">      ...</span><br><span class="line">+      child: _ModalScopeStatus(</span><br><span class="line">        ...</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  }</span><br><span class="line">  ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5982;&#x4E0B;&#x4EE3;&#x7801;&#x6240;&#x793A;&#xFF0C;<code>_ModalScopeStatus</code> &#x662F;&#x4E00;&#x4E2A; <code>InheritedWidget</code>&#xFF0C;&#x5728;&#x7ECF;&#x8FC7;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x5904;&#x7406;&#x540E;&#x6700;&#x7EC8;&#x4F1A;&#x8D70;&#x5230;&#x5176; <code>InheritedElement</code> &#x7684; <code>update</code> &#x65B9;&#x6CD5;&#xFF0C;&#x5728; <code>update</code> &#x65B9;&#x6CD5;&#x4E2D;&#x901A;&#x8FC7;&#x8C03;&#x7528; <code>updateShouldNotify</code> &#x6765;&#x5224;&#x65AD;&#x6570;&#x636E;&#x662F;&#x5426;&#x53D1;&#x751F;&#x53D8;&#x5316;&#xFF0C;&#x8FDB;&#x800C;&#x51B3;&#x5B9A;&#x662F;&#x5426;&#x901A;&#x77E5;&#x76F8;&#x5173;&#x4F9D;&#x8D56;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">diff&#x590D;&#x5236;&#x4EE3;&#x7801;+ class _ModalScopeStatus extends InheritedWidget {</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">+  bool updateShouldNotify(_ModalScopeStatus old) {</span><br><span class="line">+    return isCurrent != old.isCurrent ||</span><br><span class="line">           canPop != old.canPop ||</span><br><span class="line">           impliesAppBarDismissal != old.impliesAppBarDismissal ||</span><br><span class="line">           route != old.route;</span><br><span class="line">  }</span><br><span class="line">  ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">diff&#x590D;&#x5236;&#x4EE3;&#x7801;class InheritedElement extends ProxyElement {</span><br><span class="line">  ...</span><br><span class="line">  @override</span><br><span class="line">  void updated(InheritedWidget oldWidget) {</span><br><span class="line">+    if ((widget as InheritedWidget).updateShouldNotify(oldWidget)) {</span><br><span class="line">      super.updated(oldWidget);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><code>_ModalScopeStatus</code> &#x7684; <code>isCurrent</code> &#x8868;&#x793A;&#x5F53;&#x524D;&#x9875;&#x9762;&#x662F;&#x5426;&#x5904;&#x4E8E;&#x6700;&#x4E0A;&#x5C42;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x6253;&#x5F00;&#x548C;&#x5173;&#x95ED;&#x4E0B;&#x4E00;&#x4E2A;&#x9875;&#x9762;&#x65F6;&#xFF0C;&#x5176;&#x503C;&#x5FC5;&#x5B9A;&#x5207;&#x6362;&#xFF0C;&#x4E5F;&#x5C31;&#x662F; <code>updateShouldNotify</code> &#x5FC5;&#x5B9A;&#x8FD4;&#x56DE; <code>true</code>&#xFF0C;&#x65E2;&#x800C;&#x901A;&#x77E5;&#x4F9D;&#x8D56;&#xFF08;&#x5B9E;&#x9645;&#x4E0A;&#x5C31;&#x662F;&#x627E;&#x51FA;&#x4E00;&#x4E2A;&#x4E2A;&#x4F9D;&#x8D56;&#x8FDB;&#x884C;&#x6807;&#x810F;&#xFF0C;&#x7136;&#x540E;&#x7B49;&#x5F85; <code>build</code> &#x65B9;&#x6CD5;&#x7684;&#x91CD;&#x65B0;&#x8C03;&#x7528;&#xFF09;&#x3002;</p>
<p>&#x800C;&#x6211;&#x4EEC;&#x5728;&#x4F7F;&#x7528; <code>ModalRoute.of</code> &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5185;&#x90E8;&#x5C31;&#x662F;&#x5C06;&#x5F53;&#x524D;&#x9875;&#x7684; <code>BuildContext</code> &#x6DFB;&#x52A0;&#x5230;&#x4F9D;&#x8D56;&#x4E2D;&#xFF0C;&#x6240;&#x4EE5;&#x4ED6;&#x8FD9;&#x4E2A;&#x6539;&#x52A8;&#x5C31;&#x4F1A;&#x5F71;&#x54CD;&#x5230;&#x4F7F;&#x7528; <code>ModalRoute.of</code> &#x7684; <code>Widget</code>&#xFF0C;&#x4F7F;&#x5176;&#x591A;&#x6B21; <code>rebuild</code>&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dart&#x590D;&#x5236;&#x4EE3;&#x7801;@optionalTypeArgs</span><br><span class="line">static ModalRoute&lt;T&gt;? of&lt;T extends Object?&gt;(BuildContext context) {</span><br><span class="line">  final _ModalScopeStatus? widget = context.dependOnInheritedWidgetOfExactType&lt;_ModalScopeStatus&gt;();</span><br><span class="line">  return widget?.route as ModalRoute&lt;T&gt;?;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h2 id="&#x56DB;&#x3001;&#x89E3;&#x51B3;&#x65B9;&#x6848;"><a href="#&#x56DB;&#x3001;&#x89E3;&#x51B3;&#x65B9;&#x6848;" class="headerlink" title="&#x56DB;&#x3001;&#x89E3;&#x51B3;&#x65B9;&#x6848;"></a>&#x56DB;&#x3001;&#x89E3;&#x51B3;&#x65B9;&#x6848;</h2><h3 id="&#x65B9;&#x6848;&#x4E00;&#xFF1A;&#x8C03;&#x6574;-ModalRoute-of"><a href="#&#x65B9;&#x6848;&#x4E00;&#xFF1A;&#x8C03;&#x6574;-ModalRoute-of" class="headerlink" title="&#x65B9;&#x6848;&#x4E00;&#xFF1A;&#x8C03;&#x6574; ModalRoute.of"></a>&#x65B9;&#x6848;&#x4E00;&#xFF1A;&#x8C03;&#x6574; <code>ModalRoute.of</code></h3><p>&#x5728;&#x5F53;&#x524D;&#x7248;&#x672C;&#x4E2D;&#xFF0C;<code>of</code> &#x7684;&#x7528;&#x610F;&#x5C31;&#x662F;&#x627E;&#x5230;&#x76F8;&#x5E94;&#x7684; <code>ModalRoute</code> &#x5E76;&#x4E14;&#x521B;&#x5EFA;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#xFF0C;&#x5F53;&#x6570;&#x636E;&#x6539;&#x53D8;&#x65F6;&#x4F1A;&#x91CD;&#x65B0; <code>build</code> &#xFF0C;&#x8FD9;&#x662F;&#x7B26;&#x5408;&#x5B83;&#x671F;&#x671B;&#x7528;&#x610F;&#x7684;&#x3002;</p>
<p>&#x4F46;&#x662F;&#x6709;&#x4E9B;&#x573A;&#x666F;&#x4E0B;&#x6211;&#x4EEC;&#x5E76;&#x4E0D;&#x5E0C;&#x671B;&#x6709;&#x8FD9;&#x4E2A; &#x201C;<strong>&#x7279;&#x6027;</strong>&#x201D;&#xFF0C;&#x6BD4;&#x5982;&#xFF0C;&#x6211;&#x6253;&#x5F00;&#x65B0;&#x9875;&#x9762;&#x540E;&#xFF0C;&#x901A;&#x8FC7; <code>ModalRoute.of(context)?.settings.arguments</code> &#x53D6;&#x8DEF;&#x7531;&#x53C2;&#x6570;&#xFF0C;&#x5F53;&#x524D;&#x9875;&#x9762;&#x7684;&#x53D6;&#x53C2;&#xFF0C;&#x4E0E;&#x8DF3;&#x8F6C;&#x548C;&#x5173;&#x95ED;&#x4E0B;&#x4E2A;&#x9875;&#x9762;&#x662F;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x5173;&#x7CFB;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x79CD;&#x573A;&#x666F;&#x4E0B;&#x89E6;&#x53D1; <code>rebuild</code> &#x5C06;&#x6BEB;&#x65E0;&#x610F;&#x4E49;&#x3002;</p>
<p>&#x6240;&#x4EE5;&#x6211;&#x63D0;&#x4E86;&#x4E2A; <code>PR</code>: <a href="/external_links/9816bf2d440b388346f13952fdba0c78.html" target="blank" rel="noopener">#145389</a>, &#x7ED9; <code>ModalRoute.of</code> &#x6DFB;&#x52A0;&#x4E86; <code>createDependency</code> &#x53C2;&#x6570;&#xFF0C;&#x4E3A;&#x5F00;&#x53D1;&#x8005;&#x63D0;&#x4F9B;&#x4E86;&#x662F;&#x5426;&#x521B;&#x5EFA;&#x4F9D;&#x8D56;&#x7684;&#x9009;&#x62E9;&#x3002;&#x76EE;&#x524D;&#x8FD8;&#x5728;&#x5BA1;&#x6838;&#x4E2D;~</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">dart&#x590D;&#x5236;&#x4EE3;&#x7801;  static ModalRoute&lt;T&gt;? of&lt;T extends Object?&gt;(</span><br><span class="line">    BuildContext context, {</span><br><span class="line">    bool createDependency = true,</span><br><span class="line">  }) {</span><br><span class="line">    _ModalScopeStatus? widget;</span><br><span class="line">    if (createDependency) {</span><br><span class="line">      widget = context.dependOnInheritedWidgetOfExactType&lt;_ModalScopeStatus&gt;();</span><br><span class="line">    } else {</span><br><span class="line">      widget = context</span><br><span class="line">          .getElementForInheritedWidgetOfExactType&lt;_ModalScopeStatus&gt;()</span><br><span class="line">          ?.widget as _ModalScopeStatus?;</span><br><span class="line">    }</span><br><span class="line">    return widget?.route as ModalRoute&lt;T&gt;?;</span><br><span class="line">  }</span><br></pre></td></tr></table></figure>

<h3 id="&#x65B9;&#x6848;&#x4E8C;&#xFF1A;&#x9B54;&#x6539;&#x6E90;&#x7801;"><a href="#&#x65B9;&#x6848;&#x4E8C;&#xFF1A;&#x9B54;&#x6539;&#x6E90;&#x7801;" class="headerlink" title="&#x65B9;&#x6848;&#x4E8C;&#xFF1A;&#x9B54;&#x6539;&#x6E90;&#x7801;"></a>&#x65B9;&#x6848;&#x4E8C;&#xFF1A;&#x9B54;&#x6539;&#x6E90;&#x7801;</h3><p>&#x539F; <code>PR</code> &#x662F;&#x5BF9; <code>Tab</code> &#x952E;&#x5207;&#x6362;&#x7126;&#x70B9;&#x95EE;&#x9898;&#x7684;&#x4FEE;&#x590D;&#xFF0C;&#x4F46;&#x5BF9;&#x4E8E;&#x79FB;&#x52A8;&#x7AEF;&#x6765;&#x8BF4;&#x6839;&#x672C;&#x4E0D;&#x7B97;&#x95EE;&#x9898;&#xFF0C;&#x56E0;&#x4E3A;&#x7528;&#x4E0D;&#x4E0A;~ &#x1F605; &#xFF08;&#x5F53;&#x7136;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x4EEC;&#x7684;&#x7528;&#x6237;&#x6709;&#x4F7F;&#x7528;&#x65E0;&#x969C;&#x788D;&#x529F;&#x80FD;&#x7684;&#xFF0C;&#x8FD8;&#x9700;&#x8981;&#x81EA;&#x884C;&#x659F;&#x914C;&#x4E00;&#x4E0B;&#xFF09;</p>
<p>&#x5982;&#x679C;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x5230;&#x65F6;&#x8FD8;&#x672A;&#x89E3;&#x51B3;&#xFF08;&#x539F; <code>PR</code> &#x7684;&#x4F5C;&#x8005;&#x8FD8;&#x5728;&#x4F11;&#x5047;&#xFF09;&#xFF0C;&#x90A3;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x5148;&#x6CE8;&#x91CA;&#x6389;&#x76F8;&#x5173;&#x4EE3;&#x7801;&#x5BF9; <code>changedInternalState</code> &#x7684;&#x8C03;&#x7528;&#x6765;&#x5E94;&#x5BF9;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">diff&#x590D;&#x5236;&#x4EE3;&#x7801;// packages/flutter/lib/src/widgets/routes.dart</span><br><span class="line"></span><br><span class="line">abstract class ModalRoute&lt;T&gt; extends TransitionRoute&lt;T&gt; with LocalHistoryRoute&lt;T&gt; {</span><br><span class="line">  ...</span><br><span class="line">  @override</span><br><span class="line">  void didChangeNext(Route&lt;dynamic&gt;? nextRoute) {</span><br><span class="line">    super.didChangeNext(nextRoute);</span><br><span class="line">+    // changedInternalState();</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  void didPopNext(Route&lt;dynamic&gt; nextRoute) {</span><br><span class="line">    super.didPopNext(nextRoute);</span><br><span class="line">+    // changedInternalState();</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x8865;&#x4E01;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">shell&#x590D;&#x5236;&#x4EE3;&#x7801;# &#x8FDB;&#x5165;&#x4F60;&#x7684; flutter &#x76EE;&#x5F55;&#xFF0C;&#x6BD4;&#x5982;&#x6211;&#x7528;&#x7684;&#x662F; fvm &#x4E0B;&#x8F7D;&#x7684; 3.19.3</span><br><span class="line"># &#x8BB0;&#x5F97;&#x5C06; cd &#x540E;&#x9762;&#x7684;&#x8DEF;&#x5F84;&#x6362;&#x6210;&#x4F60;&#x81EA;&#x5DF1;&#x7535;&#x8111;&#x4E0A;&#x7684;~</span><br><span class="line">cd /Users/lxf/fvm/versions/3.19.3</span><br><span class="line"></span><br><span class="line"># &#x4E0B;&#x8F7D;&#x8865;&#x4E01;</span><br><span class="line">curl -O https://raw.githubusercontent.com/LinXunFeng/flutter_assets/main/patch/01_rollbak_3_19_routes_change/0001-Roll-back-changes-to-routes.dart.patch</span><br><span class="line"></span><br><span class="line"># &#x5E94;&#x7528;&#x8865;&#x4E01;</span><br><span class="line">git apply 0001-Roll-back-changes-to-routes.dart.patch</span><br></pre></td></tr></table></figure>

<h2 id="&#x4E94;&#x3001;&#x6700;&#x540E;"><a href="#&#x4E94;&#x3001;&#x6700;&#x540E;" class="headerlink" title="&#x4E94;&#x3001;&#x6700;&#x540E;"></a>&#x4E94;&#x3001;&#x6700;&#x540E;</h2><p>&#x603B;&#x800C;&#x8A00;&#x4E4B;&#xFF0C;&#x8DDD;&#x79BB;5&#x6708;1&#x65E5;&#xFF08;&#x82F9;&#x679C;&#x5F3A;&#x5236;&#x8981;&#x6C42;&#x6DFB;&#x52A0;&#x9690;&#x79C1;&#x6E05;&#x5355;&#x6587;&#x4EF6;&#x7684;&#x671F;&#x9650;&#xFF09;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x6708;&#xFF0C;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x5927;&#x53EF;&#x4FDD;&#x6301;&#x5728; <code>3.13</code> &#x7248;&#x672C;&#x5148;&#x7528;&#x7740;&#xFF0C;&#x514D;&#x5F97;&#x6298;&#x817E;&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x7948;&#x7977;&#x5FEB;&#x70B9;&#x4FEE;&#x590D;&#x8BE5;&#x95EE;&#x9898;&#xFF0C;&#x7136;&#x540E;&#x987A;&#x5229;&#x5347;&#x7EA7;&#x4E0A;&#x53BB;~</p>
<blockquote>
<p>&#x5982;&#x679C;&#x6587;&#x7AE0;&#x5BF9;&#x60A8;&#x6709;&#x6240;&#x5E2E;&#x52A9;, &#x8BF7;&#x4E0D;&#x541D;&#x70B9;&#x51FB;&#x5173;&#x6CE8;&#x4E00;&#x4E0B;&#x6211;&#x7684;&#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x53F7;&#xFF1A;<a href="/external_links/475d7a8029ffd100531bc36509c3041f.html" target="blank" rel="noopener">FSA&#x5168;&#x6808;&#x884C;&#x52A8;</a>, &#x8FD9;&#x5C06;&#x662F;&#x5BF9;&#x6211;&#x6700;&#x5927;&#x7684;&#x6FC0;&#x52B1;. &#x516C;&#x4F17;&#x53F7;&#x4E0D;&#x4EC5;&#x6709; <code>iOS</code> &#x6280;&#x672F;&#xFF0C;&#x8FD8;&#x6709; <code>Android</code>&#xFF0C;<code>Flutter</code>&#xFF0C;<code>Python</code> &#x7B49;&#x6587;&#x7AE0;, &#x53EF;&#x80FD;&#x6709;&#x4F60;&#x60F3;&#x8981;&#x4E86;&#x89E3;&#x7684;&#x6280;&#x80FD;&#x77E5;&#x8BC6;&#x70B9;&#x54E6;~</p>
</blockquote>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/5bfa4b56ed9528790c9fc9ded112b305.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7349001116598681634.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7349001116598681634.html" itemprop="url">修仙么朋友-从0到1构建个人修仙百科</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-03-22T17:38:08+08:00">
                2024-03-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="ChatGPT&#x6784;&#x5EFA;&#x4FEE;&#x4ED9;&#x767E;&#x79D1;"><a href="#ChatGPT&#x6784;&#x5EFA;&#x4FEE;&#x4ED9;&#x767E;&#x79D1;" class="headerlink" title="ChatGPT&#x6784;&#x5EFA;&#x4FEE;&#x4ED9;&#x767E;&#x79D1;"></a>ChatGPT&#x6784;&#x5EFA;&#x4FEE;&#x4ED9;&#x767E;&#x79D1;</h2><p>ChatGPT&#x975E;&#x5E38;&#x9002;&#x5408;&#x8FDB;&#x884C;&#x65E5;&#x5E38;&#x7684;&#x901A;&#x7528;&#x95EE;&#x7B54;&#xFF0C;&#x4F46;&#x5728;&#x9700;&#x8981;&#x9886;&#x57DF;&#x7279;&#x5B9A;&#x77E5;&#x8BC6;&#x65F6;&#x5B58;&#x5728;&#x4E00;&#x4E9B;&#x4E0D;&#x8DB3;&#x3002;&#x6B64;&#x5916;&#xFF0C;&#x5B83;&#x4F1A;&#x7F16;&#x9020;&#x7B54;&#x6848;&#x6765;&#x586B;&#x8865;&#x5176;&#x77E5;&#x8BC6;&#x7A7A;&#x767D;&#xFF0C;&#x5E76;&#x4E14;&#x4ECE;&#x4E0D;&#x5F15;&#x7528;&#x5176;&#x4FE1;&#x606F;&#x6765;&#x6E90;&#xFF0C;&#x56E0;&#x6B64;&#x65E0;&#x6CD5;&#x771F;&#x6B63;&#x88AB;&#x4FE1;&#x4EFB;&#x3002;</p>
<p>&#x672C;&#x5E94;&#x7528;&#x5C1D;&#x8BD5;&#x4F7F;&#x7528;&#x7F51;&#x7EDC;&#x4FEE;&#x4ED9;&#x5C0F;&#x8BF4;&#x6765;&#x6784;&#x5EFA;&#x4FEE;&#x4ED9;&#x9886;&#x57DF;&#x7684;&#x4FEE;&#x4ED9;&#x767E;&#x79D1;&#x3002;</p>
<p>&#x4F7F;&#x7528;&#x7684;&#x6280;&#x672F;:</p>
<ul>
<li>Next.js (React&#x6846;&#x67B6;)</li>
<li><a href="/external_links/440ba62f05f01a5dcc2161e2ec984cc9.html" target="blank" rel="noopener">MemFire</a> (&#x56FD;&#x5185;&#x7248;Supabase,&#x4F7F;&#x7528;&#x4ED6;&#x4EEC;&#x7684;pgvector&#x5B9E;&#x73B0;&#x4F5C;&#x4E3A;&#x5411;&#x91CF;&#x6570;&#x636E;&#x5E93;)</li>
<li>OpenAI API (&#x7528;&#x4E8E;&#x751F;&#x6210;&#x5D4C;&#x5165;&#x548C;&#x804A;&#x5929;&#x5B8C;&#x6210;)</li>
<li>TailwindCSS (&#x7528;&#x4E8E;&#x6837;&#x5F0F;)</li>
</ul>
<p>&#x540E;&#x7EED;&#x5DE5;&#x4F5C;&#xFF1A;</p>
<ul>
<li>&#x4F7F;&#x7528;MemFire &#x4E91;&#x51FD;&#x6570;&#x6784;&#x5EFA;&#x672C;&#x5E94;&#x7528;&#x4E2D;&#x7684;api&#x63A5;&#x53E3;</li>
<li>&#x4F7F;&#x7528;MemFire &#x9759;&#x6001;&#x6258;&#x7BA1;&#x90E8;&#x7F72;&#x672C;&#x5E94;&#x7528;</li>
</ul>
<h2 id="&#x529F;&#x80FD;&#x6982;&#x8FF0;"><a href="#&#x529F;&#x80FD;&#x6982;&#x8FF0;" class="headerlink" title="&#x529F;&#x80FD;&#x6982;&#x8FF0;"></a>&#x529F;&#x80FD;&#x6982;&#x8FF0;</h2><p>&#x521B;&#x5EFA;&#x548C;&#x5B58;&#x50A8;&#x5D4C;&#x5165;:</p>
<ul>
<li>&#x4E0A;&#x4F20;&#x4FEE;&#x4ED9;&#x5C0F;&#x8BF4;&#xFF0C;&#x8F6C;&#x6362;&#x4E3A;&#x7EAF;&#x6587;&#x672C;&#x5E76;&#x5206;&#x5272;&#x6210;1000&#x4E2A;&#x5B57;&#x7B26;&#x7684;&#x6587;&#x6863;</li>
<li>&#x4F7F;&#x7528;OpenAI&#x7684;&#x5D4C;&#x5165;API&#xFF0C;&#x5229;&#x7528;&#x201D;text-embedding-ada-002&#x201D;&#x6A21;&#x578B;&#x4E3A;&#x6BCF;&#x4E2A;&#x6587;&#x6863;&#x751F;&#x6210;&#x5D4C;&#x5165;</li>
<li>&#x5C06;&#x5D4C;&#x5165;&#x5411;&#x91CF;&#x5B58;&#x50A8;&#x5728;Supabase&#x7684;postgres&#x8868;&#x4E2D;&#xFF0C;&#x4F7F;&#x7528;pgvector; &#x8868;&#x5305;&#x542B;&#x4E09;&#x5217;: &#x6587;&#x6863;&#x6587;&#x672C;&#x3001;&#x6E90;URL&#x4EE5;&#x53CA;&#x4ECE;OpenAI API&#x8FD4;&#x56DE;&#x7684;&#x5D4C;&#x5165;&#x5411;&#x91CF;&#x3002;</li>
</ul>
<p>&#x54CD;&#x5E94;&#x67E5;&#x8BE2;:</p>
<ul>
<li>&#x4ECE;&#x7528;&#x6237;&#x63D0;&#x793A;&#x751F;&#x6210;&#x5355;&#x4E2A;&#x5D4C;&#x5165;&#x5411;&#x91CF;</li>
<li>&#x4F7F;&#x7528;&#x8BE5;&#x5D4C;&#x5165;&#x5411;&#x91CF;&#x5BF9;&#x5411;&#x91CF;&#x6570;&#x636E;&#x5E93;&#x8FDB;&#x884C;&#x76F8;&#x4F3C;&#x6027;&#x641C;&#x7D22;</li>
<li>&#x4F7F;&#x7528;&#x76F8;&#x4F3C;&#x6027;&#x641C;&#x7D22;&#x7684;&#x7ED3;&#x679C;&#x6784;&#x5EFA;GPT-3.5/GPT-4&#x7684;&#x63D0;&#x793A;</li>
<li>&#x7136;&#x540E;&#x5C06;GPT&#x7684;&#x54CD;&#x5E94;&#x6D41;&#x5F0F;&#x4F20;&#x8F93;&#x7ED9;&#x7528;&#x6237;&#x3002;</li>
</ul>
<h2 id="&#x4FEE;&#x4ED9;&#x4F53;&#x9A8C;"><a href="#&#x4FEE;&#x4ED9;&#x4F53;&#x9A8C;" class="headerlink" title="&#x4FEE;&#x4ED9;&#x4F53;&#x9A8C;"></a>&#x4FEE;&#x4ED9;&#x4F53;&#x9A8C;</h2><ol>
<li>&#x4E0A;&#x4F20;&#x5C0F;&#x8BF4;<br><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/0f8541792975ecfcfb391f5df3c99fa66b6734a75018c5154d540f9b0184eb8d" alt="zhuxian"><br><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/28691de76bd8e3234813f1098afb9e16ca3971c75b96dd61ccb0b90f057118c1" alt="fanren"></li>
<li>&#x4FEE;&#x4ED9;&#x95EE;&#x7B54;<br><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/3df365ee893f98547e399ce886c6dfc30b00d4d46c95e4e1ee1ad46e546b592e" alt="xx1"><br><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/5251847f9958674a2f214315d190b9b7fdabe58e27ad31246b4a4dff44ba141f" alt="xx2"><br><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/360e5ebc493f8cda9b12e34ee57556fbfdd89d2037fe5a9c55061699c2e5e717" alt="xx3"></li>
</ol>
<p><a href="/external_links/c0bb2a93bbf12a7e36477553aca7dc14.html" target="blank" rel="noopener">&#x4F53;&#x9A8C;&#x5730;&#x5740;</a></p>
<h2 id="&#x5165;&#x95E8;&#x6307;&#x5357;"><a href="#&#x5165;&#x95E8;&#x6307;&#x5357;" class="headerlink" title="&#x5165;&#x95E8;&#x6307;&#x5357;"></a>&#x5165;&#x95E8;&#x6307;&#x5357;</h2><p>&#x4EE5;&#x4E0B;&#x8BBE;&#x7F6E;&#x6307;&#x5357;&#x5047;&#x5B9A;&#x60A8;&#x81F3;&#x5C11;&#x5BF9;&#x4F7F;&#x7528;React&#x548C;Next.js&#x5F00;&#x53D1;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6709;&#x57FA;&#x672C;&#x7684;&#x4E86;&#x89E3;&#x3002;&#x719F;&#x6089;OpenAI API&#x548C;Supabase&#x4F1A;&#x5BF9;&#x4F7F;&#x4E8B;&#x60C5;&#x6B63;&#x5E38;&#x8FD0;&#x884C;&#x6709;&#x6240;&#x5E2E;&#x52A9;&#xFF0C;&#x4F46;&#x4E0D;&#x662F;&#x5FC5;&#x9700;&#x7684;&#x3002;</p>
<h3 id="&#x8BBE;&#x7F6E;Supabase"><a href="#&#x8BBE;&#x7F6E;Supabase" class="headerlink" title="&#x8BBE;&#x7F6E;Supabase"></a>&#x8BBE;&#x7F6E;Supabase</h3><ol>
<li>&#x767B;&#x5F55;<a href="/external_links/440ba62f05f01a5dcc2161e2ec984cc9.html" target="blank" rel="noopener">MemFire</a> &#x521B;&#x5EFA;&#x5E94;&#x7528;<br><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/c67bee06dd33424a77edb45e822e81fdf9e91f67c2eec52b42efdaf4e329fcee" alt="yy1"></li>
<li>&#x542F;&#x7528;Vector&#x6269;&#x5C55;<br>&#x9996;&#x5148;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x542F;&#x7528;Vector&#x6269;&#x5C55;&#x3002;&#x53EF;&#x4EE5;&#x5728;&#x5E94;&#x7528;&#x7684;SQL&#x6267;&#x884C;&#x5668;&#x4E2D;&#x8FD0;&#x884C;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#x5B8C;&#x6210;&#x6B64;&#x64CD;&#x4F5C;&#xFF1A;</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sql&#x590D;&#x5236;&#x4EE3;&#x7801;create extension vector;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/4fff6fc0f0e9db7238e8c0e0848ec3665c1e660bfd9c1f75dd1aa5a25ef6637b" alt="yy2"></p>
<ol start="3">
<li>&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x8868;&#x6765;&#x5B58;&#x50A8;&#x6211;&#x4EEC;&#x7684;&#x6587;&#x6863;&#x53CA;&#x5176;&#x5D4C;&#x5165;&#x3002;</li>
</ol>
<p>&#x8F6C;&#x5230;SQL&#x7F16;&#x8F91;&#x5668;&#x5E76;&#x8FD0;&#x884C;&#x4EE5;&#x4E0B;&#x67E5;&#x8BE2;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sql&#x590D;&#x5236;&#x4EE3;&#x7801;create table documents (</span><br><span class="line">  id bigserial primary key,</span><br><span class="line">  content text,</span><br><span class="line">  url text,</span><br><span class="line">  embedding vector (1536)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/a28dec9812de9f1e8f57c7a3494cebb4124bfcb2a451b4a9fe0c5d70e3233143" alt="yy3"></p>
<ol start="4">
<li>&#x6700;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x7528;&#x4E8E;&#x6267;&#x884C;&#x76F8;&#x4F3C;&#x6027;&#x641C;&#x7D22;&#x7684;&#x51FD;&#x6570;&#x3002;&#x8F6C;&#x5230;SQL&#x7F16;&#x8F91;&#x5668;&#x5E76;&#x8FD0;&#x884C;&#x4EE5;&#x4E0B;&#x67E5;&#x8BE2;&#xFF1A;</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">sql&#x590D;&#x5236;&#x4EE3;&#x7801;create or replace function match_documents (</span><br><span class="line">  query_embedding vector(1536),</span><br><span class="line">  similarity_threshold float,</span><br><span class="line">  match_count int</span><br><span class="line">)</span><br><span class="line">returns table (</span><br><span class="line">  id bigint,</span><br><span class="line">  content text,</span><br><span class="line">  url text,</span><br><span class="line">  similarity float</span><br><span class="line">)</span><br><span class="line">language plpgsql</span><br><span class="line">as $$</span><br><span class="line">begin</span><br><span class="line">  return query</span><br><span class="line">  select</span><br><span class="line">    documents.id,</span><br><span class="line">    documents.content,</span><br><span class="line">    documents.url,</span><br><span class="line">    1 - (documents.embedding &lt;=&gt; query_embedding) as similarity</span><br><span class="line">  from documents</span><br><span class="line">  where 1 - (documents.embedding &lt;=&gt; query_embedding) &gt; similarity_threshold</span><br><span class="line">  order by documents.embedding &lt;=&gt; query_embedding</span><br><span class="line">  limit match_count;</span><br><span class="line">end;</span><br><span class="line">$$;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/3cca4760f2d150dbd5aee5b902d5c23509564c8d22dfca93eb1f93057e7fbab7" alt="yy4"></p>
<h3 id="&#x8BBE;&#x7F6E;&#x672C;&#x5730;&#x73AF;&#x5883;"><a href="#&#x8BBE;&#x7F6E;&#x672C;&#x5730;&#x73AF;&#x5883;" class="headerlink" title="&#x8BBE;&#x7F6E;&#x672C;&#x5730;&#x73AF;&#x5883;"></a>&#x8BBE;&#x7F6E;&#x672C;&#x5730;&#x73AF;&#x5883;</h3><ul>
<li>&#x5B89;&#x88C5;&#x4F9D;&#x8D56;&#x9879;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash&#x590D;&#x5236;&#x4EE3;&#x7801;npm install</span><br></pre></td></tr></table></figure>

<ul>
<li>&#x5728;&#x6839;&#x76EE;&#x5F55;&#x4E2D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x540D;&#x4E3A;<code>.env.local</code>&#x7684;&#x6587;&#x4EF6;&#x4EE5;&#x5B58;&#x50A8;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#xFF1A;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash&#x590D;&#x5236;&#x4EE3;&#x7801;cp .env.local.example .env.local</span><br></pre></td></tr></table></figure>

<ul>
<li>&#x6253;&#x5F00;<code>.env.local</code>&#x6587;&#x4EF6;&#xFF0C;&#x6DFB;&#x52A0;&#x60A8;&#x7684;Supabase&#x9879;&#x76EE;URL&#x548C;API&#x5BC6;&#x94A5;&#x3002;<br><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/802438c9ca63df60aba7c2224887958b1f5019b109321e42f27f555dcac4ca07" alt="yy5"></li>
<li>&#x5C06;&#x60A8;&#x7684;OpenAI API&#x5BC6;&#x94A5;&#x6DFB;&#x52A0;&#x5230;<code>.env.local</code>&#x6587;&#x4EF6;&#x3002;&#x60A8;&#x53EF;&#x4EE5;&#x5728;OpenAI Web&#x95E8;&#x6237;&#x7684;<code>API Keys</code>&#x4E0B;&#x627E;&#x5230;&#x5B83;&#x3002;API&#x5BC6;&#x94A5;&#x5E94;&#x5B58;&#x50A8;&#x5728;<code>OPENAI_API_KEY</code>&#x53D8;&#x91CF;&#x4E2D;&#x3002;</li>
<li>[&#x53EF;&#x9009;]&#x63D0;&#x4F9B;<code>OPEAI_PROXY</code>&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x4EE5;&#x542F;&#x7528;&#x60A8;&#x81EA;&#x5B9A;&#x4E49;&#x7684;OpenAI API&#x4EE3;&#x7406;&#x3002;&#x5C06;&#x5176;&#x8BBE;&#x7F6E;&#x4E3A; <code>&quot;&quot;</code> &#x4EE5;&#x76F4;&#x63A5;&#x8C03;&#x7528;&#x5B98;&#x65B9;API&#x3002;</li>
<li>&#x542F;&#x52A8;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash&#x590D;&#x5236;&#x4EE3;&#x7801;npm run dev</span><br></pre></td></tr></table></figure>

<ul>
<li>&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x6253;&#x5F00;<a href="/external_links/87a70ce46ea04de7c28dd1e4da31904c.html" target="blank" rel="noopener">http://localhost:3000&#x67E5;&#x770B;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;</a></li>
</ul>
<h2 id="github&#x5730;&#x5740;"><a href="#github&#x5730;&#x5740;" class="headerlink" title="github&#x5730;&#x5740;"></a>github&#x5730;&#x5740;</h2><p><a href="/external_links/baa3dd4fcb6c09659b50d67c120de8e5.html" target="blank" rel="noopener">github.com/TiannV/ai-k&#x2026;</a></p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/4e1afb44d19b3f39f41cb8ef89ba00b7.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7348653890588672037.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7348653890588672037.html" itemprop="url">五分钟，零基础也能入门 Python 图像文字识别</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-03-21T20:21:53+08:00">
                2024-03-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x1F448;&#x1F448;&#x1F448; <strong>&#x6B22;&#x8FCE;&#x70B9;&#x8D5E;&#x6536;&#x85CF;&#x5173;&#x6CE8;&#x54DF;</strong></p>
<blockquote>
<p><strong>&#x9996;&#x5148;&#x5206;&#x4EAB;&#x4E4B;&#x524D;&#x7684;&#x6240;&#x6709;&#x6587;&#x7AE0; &gt;&gt;&gt;&gt;</strong> &#x1F61C;&#x1F61C;&#x1F61C;   </p>
<p><strong>&#x6587;&#x7AE0;&#x5408;&#x96C6; :</strong> &#x1F381; <a href="https://dev.newban.cn/6941642435189538824">juejin.cn/post/694164&#x2026;</a>   </p>
<p><strong>Github :</strong> &#x1F449; <a href="/external_links/f4c0695dd8cd8371c2f2fc9edde11029.html" target="blank" rel="noopener">github.com/black-ant</a>  </p>
<p><strong>CASE &#x5907;&#x4EFD; :</strong> &#x1F449; <a href="/external_links/907cd6419accaedf9bfa60f559823d4b.html" target="blank" rel="noopener">gitee.com/antblack/ca&#x2026;</a></p>
</blockquote>
<h2 id="&#x4E00;-&#x524D;&#x8A00;"><a href="#&#x4E00;-&#x524D;&#x8A00;" class="headerlink" title="&#x4E00;. &#x524D;&#x8A00;"></a>&#x4E00;. &#x524D;&#x8A00;</h2><p>&#x6700;&#x8FD1;&#x5728;&#x7814;&#x7A76; Python &#x7684;&#x4E00;&#x4E9B;&#x529F;&#x80FD; &#xFF0C; &#x4E5F;&#x5C1D;&#x8BD5;&#x4E86;&#x4E00;&#x4E9B;&#x6709;&#x8DA3;&#x5B9E;&#x73B0;&#xFF0C; &#x8FD9;&#x4E00;&#x7BC7;&#x5C31;&#x4ECE;&#x5B9E;&#x8DF5;&#x7684;&#x89D2;&#x5EA6;&#x6765;&#x7814;&#x7A76;&#x4E00;&#x4E0B; Python &#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x56FE;&#x7247;&#x8BC6;&#x522B;&#x3002;</p>
<p>&#x4F17;&#x6240;&#x5468;&#x77E5; &#xFF0C; Python &#x7684;&#x5E93;&#x771F;&#x7684;&#x8001;&#x591A;&#x4E86;&#xFF0C;&#x5176;&#x4E2D;&#x5728;&#x56FE;&#x50CF;&#x8BC6;&#x522B;&#x4E0A;&#x6BD4;&#x8F83;&#x7A81;&#x51FA;&#x7684;&#x5C31;&#x662F; OpenCV.</p>
<p>&#x90A3;&#x4E48;&#x57FA;&#x4E8E;&#x8FD9;&#x4E2A;&#x5E93;&#x6211;&#x4EEC;&#x80FD;&#x5B9E;&#x73B0;&#x4EC0;&#x4E48;&#x529F;&#x80FD;&#x5462;&#xFF1F;</p>
<h2 id="&#x4E8C;-&#x53C2;&#x4E0E;&#x5BF9;&#x8C61;&#x7B80;&#x4ECB;"><a href="#&#x4E8C;-&#x53C2;&#x4E0E;&#x5BF9;&#x8C61;&#x7B80;&#x4ECB;" class="headerlink" title="&#x4E8C;. &#x53C2;&#x4E0E;&#x5BF9;&#x8C61;&#x7B80;&#x4ECB;"></a>&#x4E8C;. &#x53C2;&#x4E0E;&#x5BF9;&#x8C61;&#x7B80;&#x4ECB;</h2><ul>
<li><strong>OpenCV</strong> &#xFF1A;&#x4E00;&#x4E2A;&#x5F00;&#x6E90;&#x7684;&#x8DE8;&#x5E73;&#x53F0;&#x8BA1;&#x7B97;&#x673A;&#x89C6;&#x89C9;&#x5E93; , &#x652F;&#x6301; C++ ,Java &#x548C; Python<ul>
<li>&#x5305;&#x62EC;&#x56FE;&#x7247;&#x7684;<code>&#x8BFB;&#x53D6;</code> &#xFF0C;<code>&#x5199;&#x5165;</code> &#xFF0C;<code>&#x8F6C;&#x6362;</code> &#xFF0C;<code>&#x56FE;&#x50CF;&#x589E;&#x5F3A;</code> &#xFF0C; <code>&#x7279;&#x5F81;&#x63D0;&#x53D6;</code>&#x7B49;&#x7B49;</li>
</ul>
</li>
<li><strong>Tesseract</strong> &#xFF1A; &#x5149;&#x5B66;&#x5B57;&#x7B26;&#x8BC6;&#x522B; (OCR) &#x7684;&#x5F00;&#x6E90;&#x5F15;&#x64CE; &#xFF0C;&#x7528;&#x4E8E;&#x8BB2;&#x56FE;&#x50CF;&#x8F6C;&#x6362;&#x4E3A;&#x53EF;&#x8BFB;&#x7684;&#x6587;&#x672C;</li>
</ul>
<h2 id="&#x4E09;-&#x7B80;&#x5355;&#x4F7F;&#x7528;"><a href="#&#x4E09;-&#x7B80;&#x5355;&#x4F7F;&#x7528;" class="headerlink" title="&#x4E09;. &#x7B80;&#x5355;&#x4F7F;&#x7528;"></a>&#x4E09;. &#x7B80;&#x5355;&#x4F7F;&#x7528;</h2><h3 id="3-1-&#x73AF;&#x5883;&#x51C6;&#x5907;"><a href="#3-1-&#x73AF;&#x5883;&#x51C6;&#x5907;" class="headerlink" title="3.1 &#x73AF;&#x5883;&#x51C6;&#x5907;"></a>3.1 &#x73AF;&#x5883;&#x51C6;&#x5907;</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;// S1 : &#x5B89;&#x88C5;&#x4F9D;&#x8D56;</span><br><span class="line">pip install numpy matplotlib</span><br><span class="line"></span><br><span class="line">// S2 : &#x5B89;&#x88C5; OpenCV</span><br><span class="line">pip install opencv-python</span><br><span class="line"></span><br><span class="line">// S3 : &#x5B89;&#x88C5;&#x7269;&#x7406;&#x673A;&#x4E0A;&#x9762;&#x7684; tesseract</span><br><span class="line">https://github.com/UB-Mannheim/tesseract/wiki</span><br><span class="line"></span><br><span class="line">- PS : &#x6B64;&#x5904;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;&#x7684;&#x662F; English &#x8BED;&#x8A00;&#x5305; &#xFF0C;&#x5982;&#x679C;&#x9700;&#x8981;&#x4E2D;&#x6587;&#xFF0C;&#x8FD9;&#x91CC;&#x8981;&#x4E0B;&#x8F7D;&#x65B0;&#x7684;&#x8BED;&#x8A00;&#x5305;</span><br><span class="line">- https://tesseract-ocr.github.io/tessdoc/Data-Files.html</span><br><span class="line">- &#x4E0B;&#x8F7D;&#x5B8C;&#x6210;&#x540E;&#x628A;&#x6587;&#x4EF6;&#x89E3;&#x538B;&#x5230; /Tesseract-OCR/tessdata &#x4E2D; </span><br><span class="line"></span><br><span class="line">// S4 &#xFF1A;&#x51C6;&#x5907;&#x73AF;&#x5883;&#x53D8;&#x91CF;</span><br><span class="line">@ https://blog.csdn.net/qq_40147863/article/details/82285920</span><br><span class="line">- &#x73AF;&#x5883;&#x53D8;&#x91CF; &#x7CFB;&#x7EDF;&#x53D8;&#x91CF; &#x548C; &#x7528;&#x6237;&#x53D8;&#x91CF; &#x91CC;&#x9762; &#x52A0;&#x4E0A;&#x5BF9;&#x5E94;&#x7684; Path &#x5373;&#x53EF;</span><br><span class="line"></span><br><span class="line">## S4 : &#x5B89;&#x88C5; Python OCR &#x8BC6;&#x522B; </span><br><span class="line">pip install pytesseract</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//============================</span><br><span class="line">// &#x6269;&#x5C55;&#x529F;&#x80FD; &#xFF1A;</span><br><span class="line"></span><br><span class="line">// &#x6D4B;&#x8BD5;&#x4E00; &#xFF1A; &#x4E2D;&#x6587;&#x5305;&#x5B89;&#x88C5;&#x60C5;&#x51B5;</span><br><span class="line">&gt; tesseract --list-langs </span><br><span class="line">- &#x5982;&#x679C;&#x4E2D;&#x6587;&#x5305;&#x5B89;&#x88C5;&#x6210;&#x529F;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x591A;&#x4E2A;&#x7ED3;&#x679C;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-&#x521D;&#x4EE3;&#x4EE3;&#x7801;&#x5C55;&#x793A;"><a href="#3-2-&#x521D;&#x4EE3;&#x4EE3;&#x7801;&#x5C55;&#x793A;" class="headerlink" title="3.2 &#x521D;&#x4EE3;&#x4EE3;&#x7801;&#x5C55;&#x793A;"></a>3.2 &#x521D;&#x4EE3;&#x4EE3;&#x7801;&#x5C55;&#x793A;</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">python&#x590D;&#x5236;&#x4EE3;&#x7801;import cv2</span><br><span class="line">import os</span><br><span class="line">import pytesseract</span><br><span class="line"></span><br><span class="line"># S1 : &#x8BFB;&#x53D6;&#x56FE;&#x7247;</span><br><span class="line">image_path = &quot;C:\\Users\\zzg\\Desktop\\test.png&quot;</span><br><span class="line"></span><br><span class="line"># S2 : &#x8BC6;&#x522B;&#x56FE;&#x7247;</span><br><span class="line">image = cv2.imread(image_path)</span><br><span class="line"></span><br><span class="line"># S3 : &#x4F7F;&#x7528; OCR &#x8BC6;&#x522B;&#x6587;&#x5B57;</span><br><span class="line">text = pytesseract.image_to_string(image,lang=&apos;chi_sim&apos;)</span><br><span class="line"></span><br><span class="line"># &#x6253;&#x5370;&#x6587;&#x5B57;</span><br><span class="line">print(&quot;&#x8BC6;&#x522B;&#x51FA;&#x6587;&#x5B57;&#x5185;&#x5BB9;:&quot;+text)</span><br></pre></td></tr></table></figure>

<ul>
<li>&#x2757;&#x5982;&#x679C;&#x6B64;&#x65F6;&#x672A;&#x4F18;&#x5316;&#x6267;&#x884C;&#x7684;&#x60C5;&#x51B5;&#x4E0B; &#xFF0C;<code>&#x5927;&#x6982;&#x7387;&#x662F;&#x8BC6;&#x522B;&#x4E0D;&#x51FA;&#x6765;&#x7684;</code></li>
<li>&#x2753;&#x4E3B;&#x8981;&#x539F;&#x56E0;&#x5728;&#x4E8E;&#x56FE;&#x7247;&#x6CA1;&#x6709;&#x505A;&#x5408;&#x9002;&#x7684;&#x5904;&#x7406;&#xFF0C;&#x6216;&#x8005;&#x8BED;&#x8A00;&#x5305;&#x672A;&#x52A0;&#x8F7D;</li>
</ul>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/a21983dd9187a6b3bb454a774461d1e054500b379f7f958514edd7b1e4e64876" alt="image.png"></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/b3bac27e4f8b620adccdccb1a7d8cfb03462a5e458318aacc2cdc12e6d84da66" alt="image.png"></p>
<ul>
<li>&#x5BF9;&#x4E8E;<code>&#x82F1;&#x6587;&#x6587;&#x5B57;</code>&#xFF0C; &#x4F7F;&#x7528;&#x82F1;&#x6587;&#x6A21;&#x578B;&#x7684;&#x6548;&#x679C;&#x8FD8;&#x662F;&#x5F88;&#x597D;&#x7684;&#xFF0C;&#x4E00;&#x6BB5;&#x590D;&#x6742;&#x7684;&#x4EE3;&#x7801;&#x57FA;&#x672C;&#x4E0A;&#x80FD;&#x591F;&#x8BC6;&#x522B;&#x6E05;&#x695A;</li>
<li>&#x5BF9;&#x4E8E;<code>&#x4E2D;&#x6587;&#x6587;&#x5B57;</code> &#xFF0C;&#x6574;&#x4F53;&#x6548;&#x679C;&#x5C31;&#x6BD4;&#x8F83;&#x5DEE;&#x4E86;</li>
</ul>
<p><strong>&#x8BC6;&#x522B;&#x4E86;&#x53C8;&#x597D;&#x50CF;&#x6CA1;&#x8BC6;&#x522B;</strong>&#xFF0C;&#x8FD9;&#x8BF4;&#x660E;&#x5728;&#x4E0D;&#x8FDB;&#x884C;&#x4EFB;&#x4F55;&#x4F18;&#x5316;&#x7684;&#x524D;&#x63D0;&#x4E0B;&#xFF0C;&#x6587;&#x5B57;&#x8BC6;&#x522B;&#x7684;<code>&#x51C6;&#x786E;&#x7387;&#x5E76;&#x4E0D;&#x9AD8;</code>&#x3002;&#x6240;&#x4EE5;&#x5728;&#x751F;&#x4EA7;&#x4E0A;&#x4F7F;&#x7528;&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;<code>&#x8981;&#x5728;&#x4EE3;&#x7801;&#x548C;&#x6A21;&#x578B;&#x5C42;&#x9762;&#x8FDB;&#x884C;&#x4E00;&#x5B9A;&#x7684;&#x4F18;&#x5316;</code>&#xFF0C;&#x4EE5;&#x8FBE;&#x5230;&#x9884;&#x671F;&#x7684;&#x6548;&#x679C;&#x3002;</p>
<h2 id="&#x56DB;-&#x6DF1;&#x5165;&#x539F;&#x7406;"><a href="#&#x56DB;-&#x6DF1;&#x5165;&#x539F;&#x7406;" class="headerlink" title="&#x56DB;. &#x6DF1;&#x5165;&#x539F;&#x7406;"></a>&#x56DB;. &#x6DF1;&#x5165;&#x539F;&#x7406;</h2><h3 id="4-1-&#x4EC0;&#x4E48;&#x53EB;&#x7070;&#x5EA6;&#x5316;-&#xFF1F;"><a href="#4-1-&#x4EC0;&#x4E48;&#x53EB;&#x7070;&#x5EA6;&#x5316;-&#xFF1F;" class="headerlink" title="4.1 &#x4EC0;&#x4E48;&#x53EB;&#x7070;&#x5EA6;&#x5316; &#xFF1F;"></a>4.1 &#x4EC0;&#x4E48;&#x53EB;&#x7070;&#x5EA6;&#x5316; &#xFF1F;</h3><p>&#x5C06;&#x4E00;&#x5E45;&#x5F69;&#x8272;&#x56FE;&#x50CF;&#x8F6C;&#x6362;&#x4E3A;&#x7070;&#x5EA6;&#x56FE;&#x50CF;&#x7684;&#x8FC7;&#x7A0B; &#xFF0C;&#x4E00;&#x822C;&#x60C5;&#x51B5;&#x4E0B;&#x7070;&#x5EA6;&#x56FE;&#x50CF;&#x53EA;&#x4F1A;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x901A;&#x9053;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;// &#x7070;&#x5EA6;&#x5316;&#x56FE;&#x50CF; </span><br><span class="line">gray_image = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)</span><br><span class="line"></span><br><span class="line">// &#x5C55;&#x793A;&#x56FE;&#x50CF;</span><br><span class="line">cv2.imshow(&quot;Image&quot;, gray_image)</span><br><span class="line">cv2.waitKey(0)</span><br><span class="line">cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/bc8c384a3f25fc6717f491b772f6081b72e1eb9dc0b3fa2dad6874cd0a0608f9" alt="image.png"></p>
<blockquote>
<p>&#x95EE;&#x9898;&#x4E00; &#xFF1A;&#x901A;&#x9053;&#x662F;&#x4EC0;&#x4E48; &#xFF1F;</p>
</blockquote>
<p>&#x56FE;&#x50CF;&#x4E2D;&#x6709;&#x5F88;&#x591A;<code>&#x5206;&#x91CF;</code>&#x7528;&#x6765;<code>&#x63CF;&#x8FF0;&#x4E00;&#x4E9B;&#x4FE1;&#x606F;</code> &#xFF0C;&#x5E38;&#x89C1;&#x7684;&#x6709;&#x989C;&#x8272;&#x901A;&#x9053; &#xFF0C;&#x6DF1;&#x5EA6;&#x901A;&#x9053; , alpha &#x901A;&#x9053;&#x7B49;&#x3002;</p>
<p>&#x4E00;&#x822C;&#x5E38;&#x89C4;&#x7684;&#x5F69;&#x8272;&#x56FE;&#x50CF;&#x5305;&#x542B;&#x4E09;&#x4E2A;&#x989C;&#x8272;&#x901A;&#x9053; &#xFF1A;&#x7EA2;&#x8272;&#x3001;&#x7EFF;&#x8272;&#x548C;&#x84DD;&#x8272;&#xFF08;&#x6216;&#x591A;&#x6216;&#x5C11;&#x90FD;&#x542C;&#x8FC7;&#xFF0C;&#x8FD9;&#x5C31;&#x662F;&#x4E09;&#x539F;&#x8272;&#xFF09;&#x3002;</p>
<blockquote>
<p>&#x95EE;&#x9898;&#x4E8C; &#xFF1A; &#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x7070;&#x5EA6;&#x5316; &#xFF1F;</p>
</blockquote>
<ul>
<li>&#x4E09;&#x901A;&#x9053;<code>&#x989C;&#x8272;&#x8FC7;&#x4E8E;&#x590D;&#x6742;</code>&#xFF0C;&#x5904;&#x7406;<code>&#x96BE;&#x5EA6;&#x66F4;&#x5927;</code></li>
<li>&#x901A;&#x8FC7;&#x7070;&#x5EA6;&#x56FE;&#x50CF;&#x6D88;&#x9664;&#x989C;&#x8272;&#x4FE1;&#x606F;&#x7684;&#x5E72;&#x6270;</li>
<li>&#x907F;&#x514D;&#x5149;&#x7167; &#xFF0C;&#x6587;&#x5B57;&#x989C;&#x8272; &#xFF0C;&#x80CC;&#x666F;&#x5BF9;&#x8BC6;&#x522B;&#x7684;&#x5F71;&#x54CD;</li>
</ul>
<h3 id="4-2-&#x4EC0;&#x4E48;&#x662F;&#x8BED;&#x8A00;&#x5305;"><a href="#4-2-&#x4EC0;&#x4E48;&#x662F;&#x8BED;&#x8A00;&#x5305;" class="headerlink" title="4.2 &#x4EC0;&#x4E48;&#x662F;&#x8BED;&#x8A00;&#x5305;"></a>4.2 &#x4EC0;&#x4E48;&#x662F;&#x8BED;&#x8A00;&#x5305;</h3><p>&#x4E4B;&#x524D;&#x5728;&#x73AF;&#x5883;&#x914D;&#x7F6E;&#x7684;&#x65F6;&#x5019;&#x4E5F;&#x63D0;&#x5230;&#x8FC7;&#xFF0C;&#x4E3A;&#x4E86;&#x66F4;&#x597D;&#x7684;&#x8BC6;&#x522B;&#x4E2D;&#x6587;&#xFF0C;&#x9700;&#x8981;&#x6DFB;&#x52A0;&#x8BED;&#x8A00;&#x5305;&#x3002;</p>
<p>Tesseract &#x7684;&#x8BED;&#x8A00;&#x5305;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9; Tesseract &#x5F15;&#x64CE;&#x8BC6;&#x522B;&#x7279;&#x5B9A;&#x8BED;&#x8A00;&#x6587;&#x672C;&#x7684;&#x6A21;&#x578B;&#x6587;&#x4EF6;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4E0B;&#x8F7D;&#x7279;&#x5B9A;&#x7684;&#x8BED;&#x8A00;&#x5305;&#xFF0C;&#x653E;&#x5728; <code>tessdata</code> &#x76EE;&#x5F55;&#x4E0B;&#x5373;&#x53EF;&#x3002; Tesseract &#x53EF;&#x4EE5;&#x540C;&#x65F6;&#x517C;&#x5BB9;&#x591A;&#x4E2A;&#x8BED;&#x8A00;&#x5305;&#x3002;&#x4E5F;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x8BAD;&#x7EC3;&#x8BED;&#x8A00;&#x5305;&#x3002;</p>
<p>@ <a href="/external_links/9bde37356e2326f642985a9e9132d8e5.html" target="blank" rel="noopener">tesseract-ocr.github.io/tessdoc/Dat&#x2026;</a></p>
<h3 id="4-3-&#x4F18;&#x5316;&#x56FE;&#x50CF;&#x7684;&#x65B9;&#x5F0F;"><a href="#4-3-&#x4F18;&#x5316;&#x56FE;&#x50CF;&#x7684;&#x65B9;&#x5F0F;" class="headerlink" title="4.3 &#x4F18;&#x5316;&#x56FE;&#x50CF;&#x7684;&#x65B9;&#x5F0F;"></a>4.3 &#x4F18;&#x5316;&#x56FE;&#x50CF;&#x7684;&#x65B9;&#x5F0F;</h3><p>&#x5982;&#x679C;&#x771F;&#x7684;&#x9700;&#x8981;&#x6DF1;&#x5EA6;&#x4F7F;&#x7528;&#xFF0C;&#x5EFA;&#x8BAE;&#x8BA4;&#x771F;&#x9605;&#x8BFB;&#x5B98;&#x65B9;&#x6587;&#x6863; &#xFF0C;&#x5728;&#x5B98;&#x65B9;&#x6587;&#x6863;&#x4E2D;&#x63D0;&#x4F9B;&#x4E86;&#x5927;&#x91CF;&#x63D0;&#x9AD8;&#x8D28;&#x91CF;&#x7684;&#x6848;&#x4F8B; &#xFF1A;</p>
<ul>
<li>@ <a href="/external_links/4ab6c14448dd11ee85040d098af57108.html" target="blank" rel="noopener">&#x63D0;&#x9AD8;&#x8F93;&#x51FA;&#x8D28;&#x91CF;</a></li>
<li>@ <a href="/external_links/811fc0c7f63ead8e27d9b262e54d9c20.html" target="blank" rel="noopener">&#x5B98;&#x65B9;&#x6587;&#x6863;&#x76EE;&#x5F55;</a></li>
</ul>
<p><strong>&#x5176;&#x4E2D;&#x5E38;&#x89C1;&#x7684;&#x65B9;&#x5F0F;&#x5305;&#x62EC; &#xFF1A;</strong></p>
<ul>
<li><strong>&#x91CD;&#x65B0;&#x7F29;&#x653E;</strong> &#xFF1A; &#x4FEE;&#x6539;&#x56FE;&#x7247;&#x7684;&#x5C3A;&#x5BF8; &#xFF0C;&#x901A;&#x8FC7;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x6269;&#x5927;&#x56FE;&#x7247;&#x7684;&#x95F4;&#x9694;&#xFF0C;&#x63D0;&#x9AD8;&#x8BC6;&#x522B;&#x7387;</li>
<li><strong>&#x4E8C;&#x503C;&#x5316;</strong> &#xFF1A; &#x7070;&#x5EA6;&#x5316;&#x5C31;&#x662F;&#x4E8C;&#x503C;&#x5316;&#x7684;&#x4E00;&#x79CD;&#xFF0C;&#x76EE;&#x7684;&#x662F;&#x51CF;&#x5C11;&#x590D;&#x6742;&#x7684;&#x989C;&#x8272;</li>
<li><strong>&#x964D;&#x566A;</strong></li>
</ul>
<blockquote>
<p>&#x901A;&#x5E38;&#x6700;&#x5E38;&#x89C1;&#x7684;&#x5C31;&#x662F;&#x56FE;&#x50CF;&#x7684;&#x7F29;&#x653E;&#x5904;&#x7406;</p>
</blockquote>
<p>&#x89E3;&#x51B3;&#x7684;&#x65B9;&#x6848;&#x662F;&#x5BF9;&#x56FE;&#x7247;&#x8FDB;&#x884C;&#x7F29;&#x653E;&#x6216;&#x8005;&#x5207;&#x5272; &#xFF0C;&#x9996;&#x5148;&#x6211;&#x4EEC;&#x770B;&#x4E00;&#x4E0B;&#x56FE;&#x50CF;&#x7F29;&#x653E;&#x540E;&#x7684;&#x6548;&#x679C; &#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/16b69f429ee217b5546c4b15ef61ca9cae25a09a8b14d4da955d6a51f24cb551" alt="image.png"></p>
<ul>
<li>&#x539F;&#x672C;&#x4EE5;&#x4E3A;&#x8FD8;&#x9700;&#x8981;&#x4F18;&#x5316;&#x5F88;&#x4E45; &#xFF0C;<strong>&#x4F46;&#x662F;&#x7B80;&#x5355;&#x6269;&#x5927;&#x4E00;&#x4E0B;&#x6548;&#x679C;&#x5C31;&#x5F88;&#x660E;&#x663E;&#x4E86;</strong></li>
</ul>
<h3 id="4-4-&#x6280;&#x672F;&#x539F;&#x7406;"><a href="#4-4-&#x6280;&#x672F;&#x539F;&#x7406;" class="headerlink" title="4.4 &#x6280;&#x672F;&#x539F;&#x7406;"></a>4.4 &#x6280;&#x672F;&#x539F;&#x7406;</h3><p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/7368441ae62683a132c824c57eff0ff9196846fcc2fec60a5b489d479842d0f8" alt="image.png"></p>
<p>Tesseract &#x540C;&#x6837;&#x662F;&#x4E00;&#x79CD;&#x57FA;&#x4E8E;&#x673A;&#x5668;&#x5B66;&#x4E60;&#x8BA1;&#x7B97;&#x7684;&#x5B9E;&#x73B0;&#x529F;&#x80FD; &#xFF0C; &#x5728;&#x4F7F;&#x7528;&#x4E0A;&#x4E00;&#x6837;&#x57FA;&#x4E8E;&#x5927;&#x6A21;&#x578B;&#x5B9E;&#x73B0;&#x3002;</p>
<ul>
<li><strong>Tesseract</strong> &#x57FA;&#x4E8E;&#x5377;&#x79EF;&#x795E;&#x7ECF;&#x7F51;&#x7EDC; (<strong>CNN</strong>) &#x7684;&#x6A21;&#x578B;</li>
<li><strong>Tesseract</strong> &#x901A;&#x8FC7;&#x4E0D;&#x540C;&#x7684;&#x7EC4;&#x4EF6;&#x8BA1;&#x7B97;&#x6A21;&#x578B;&#x6587;&#x4EF6; &#xFF0C;&#x53EF;&#x4EE5;&#x8BA1;&#x7B97;&#x5355;&#x8BED;&#x8A00;&#x6A21;&#x578B;&#x6587;&#x4EF6;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x8BA1;&#x7B97;&#x591A;&#x8BED;&#x8A00;&#x6A21;&#x578B;&#x6587;&#x4EF6;</li>
<li>&#x5728;&#x4F7F;&#x7528;&#x65F6; &#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x591A;&#x4E2A; .<strong>traineddata</strong> &#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x5206;&#x6790;</li>
<li>&#x5165;&#x95E8;&#x9636;&#x6BB5;&#x5C31;&#x4E0D;&#x6D89;&#x53CA;&#x6A21;&#x578B;&#x7684;&#x8BAD;&#x7EC3;&#x4E86;&#xFF0C;&#x6BD5;&#x7ADF;&#x6211;&#x4E5F;&#x8FD8;&#x4E0D;&#x4F1A;</li>
</ul>
<h2 id="&#x4E94;-&#x6700;&#x7EC8;&#x7ED3;&#x679C;"><a href="#&#x4E94;-&#x6700;&#x7EC8;&#x7ED3;&#x679C;" class="headerlink" title="&#x4E94;. &#x6700;&#x7EC8;&#x7ED3;&#x679C;"></a>&#x4E94;. &#x6700;&#x7EC8;&#x7ED3;&#x679C;</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;import cv2</span><br><span class="line">import os</span><br><span class="line">import pytesseract</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># &#x8BFB;&#x53D6;&#x56FE;&#x7247;</span><br><span class="line">image_path = &quot;C:\\Users\\zzg\\Desktop\\test2.png&quot;</span><br><span class="line"># &#x68C0;&#x67E5;&#x6587;&#x4EF6;&#x662F;&#x5426;&#x5B58;&#x5728;</span><br><span class="line">if not os.path.isfile(image_path):</span><br><span class="line">    print(&quot;&#x9519;&#x8BEF;&#xFF1A;&#x56FE;&#x50CF;&#x6587;&#x4EF6;&#x672A;&#x627E;&#x5230;&#xFF01;&quot;)</span><br><span class="line">    exit()</span><br><span class="line"></span><br><span class="line">image = cv2.imread(image_path)</span><br><span class="line"></span><br><span class="line"># &#x7070;&#x5EA6;&#x5316;&#x56FE;&#x7247;</span><br><span class="line">gray_image = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)</span><br><span class="line"></span><br><span class="line"># &#x5BF9;&#x56FE;&#x7247;&#x8FDB;&#x884C;&#x7F29;&#x653E;</span><br><span class="line">image_big = cv2.resize(gray_image, dsize=(None, None), fx=3, fy=3, interpolation=cv2.INTER_CUBIC)</span><br><span class="line"></span><br><span class="line"># &#x964D;&#x566A;&#x56FE;&#x7247;</span><br><span class="line">denoised_image = cv2.GaussianBlur(image_big, (5, 5), 0)</span><br><span class="line"></span><br><span class="line"># &#x4F7F;&#x7528; OCR &#x8BC6;&#x522B;&#x6587;&#x5B57;</span><br><span class="line">text = pytesseract.image_to_string( denoised_image,lang=&apos;chi_sim&apos;)</span><br><span class="line"></span><br><span class="line"># &#x6253;&#x5370;&#x6587;&#x5B57;</span><br><span class="line">print(&quot;&#x8BC6;&#x522B;&#x51FA;&#x6587;&#x5B57;&#x5185;&#x5BB9;:&quot;+text)</span><br></pre></td></tr></table></figure>

<h2 id="&#x603B;&#x7ED3;"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3;</h2><p>&#x8FD9;&#x7BC7;&#x662F;&#x7B2C;&#x4E00;&#x7BC7;&#x5B66;&#x4E60;&#x7684;&#x6587;&#x6863; &#xFF0C;&#x91CD;&#x5728;&#x4E86;&#x89E3;&#x8FD9;&#x79CD;&#x4F7F;&#x7528;&#x65B9;&#x5F0F;&#x3002;</p>
<p>&#x540E;&#x7EED;&#x4F1A;&#x6269;&#x5C55;&#x5230; <code>&#x590D;&#x6742;&#x56FE;&#x50CF;</code> &#x4EE5;&#x53CA; <code>&#x4E1A;&#x52A1;&#x7EA7;&#x4F7F;&#x7528;</code>&#x3002;&#x6B22;&#x8FCE;&#x5173;&#x6CE8;&#x3002;</p>
<h2 id="&#x53C2;&#x8003;&#x6587;&#x6863;"><a href="#&#x53C2;&#x8003;&#x6587;&#x6863;" class="headerlink" title="&#x53C2;&#x8003;&#x6587;&#x6863;"></a>&#x53C2;&#x8003;&#x6587;&#x6863;</h2><p><a href="/external_links/eef5259dacce3db55d1a4dd2cc3af481.html" target="blank" rel="noopener">zhuanlan.zhihu.com/p/110647131</a></p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/e8a7c59a0b5eaa9c328a8004cb9024ac.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7348643498117955603.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7348643498117955603.html" itemprop="url">大模型06-大模型应用开发之准备篇（OpenAI的plugi</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-03-21T17:14:20+08:00">
                2024-03-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="&#x5199;&#x5728;&#x524D;&#x9762;&#x7684;&#x8BDD;"><a href="#&#x5199;&#x5728;&#x524D;&#x9762;&#x7684;&#x8BDD;" class="headerlink" title="&#x5199;&#x5728;&#x524D;&#x9762;&#x7684;&#x8BDD;"></a>&#x5199;&#x5728;&#x524D;&#x9762;&#x7684;&#x8BDD;</h1><p>&#x5728;&#x524D;&#x9762;&#x51E0;&#x4E2A;&#x7AE0;&#x8282;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x719F;&#x6089;&#x4E86;&#x5927;&#x6A21;&#x578B;&#x7684;&#x4E00;&#x4E9B;&#x6982;&#x5FF5;&#xFF0C;&#x5B66;&#x4E60;&#x4E86;&#x5927;&#x6A21;&#x578B;&#x7684;&#x63D0;&#x793A;&#x5DE5;&#x7A0B;&#xFF0C;&#x4F53;&#x9A8C;&#x4E86;Chat&#x7684;&#x4F7F;&#x7528;&#x3002;</p>
<p>&#x4ECA;&#x5929;&#x8FD9;&#x4E2A;&#x7AE0;&#x8282;&#x662F;&#x4E3A;&#x4E86;&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x5927;&#x6A21;&#x578B;&#x505A;&#x5E94;&#x7528;&#x5F00;&#x53D1;&#x505A;&#x51C6;&#x5907;&#x3002;</p>
<p>&#x5927;&#x5BB6;&#x9646;&#x7EED;&#x5728;&#x5F88;&#x591A;&#x6587;&#x7AE0;&#x4E2D;&#x53EF;&#x80FD;&#x5DF2;&#x7ECF;&#x770B;&#x5230;&#x8FC7;&#x4E86;&#x5F88;&#x591A;&#x6982;&#x5FF5;&#xFF0C;&#x6BD4;&#x5982;plugins&#x3001;GPTs&#x3001;Agent&#xFF0C;&#x8FD9;&#x91CC;&#x9762;&#x81EA;ChatGPT3.5&#x7206;&#x706B;&#x4EE5;&#x6765;&#xFF0C;&#x6709;&#x4F17;&#x591A;&#x7684;AI&#x521B;&#x4E1A;&#x516C;&#x53F8;&#x4ECE;&#x4E0D;&#x540C;&#x7684;&#x5207;&#x5165;&#x70B9;&#x5728;&#x505A;&#xFF0C;OpenAI&#x516C;&#x53F8;&#x4E5F;&#x5728;&#x4E0D;&#x65AD;&#x63A8;&#x8FDB;&#x81EA;&#x5BB6;&#x4EA7;&#x54C1;&#x7684;&#x6838;&#x5FC3;&#x80FD;&#x529B;&#x548C;&#x751F;&#x6001;&#x7684;&#x8FED;&#x4EE3;&#x66F4;&#x65B0;&#xFF0C;&#x6BD4;&#x5982;&#x53BB;&#x5E74;&#x6700;&#x5F15;&#x4EBA;&#x77A9;&#x76EE;&#x7684;GPT-4 turbo&#x7684;&#x53D1;&#x5E03;&#x3002;</p>
<p>&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x5C31;&#x4EE5;OpenAI&#x7684;&#x4EA7;&#x54C1;&#x6765;&#x4ECB;&#x7ECD;&#x4E0B;&#x8FD9;&#x4E9B;&#x6982;&#x5FF5;&#xFF0C;&#x4EE5;&#x53CA;&#x5728;GPT-4 turbo&#x4E2D;&#x51FA;&#x73B0;&#x7684;GPTs&#x7B49;&#x7684;&#x89E3;&#x8BFB;&#x548C;&#x5E94;&#x7528;&#x3002;</p>
<h1 id="OpenAI&#x7684;plugins&#x4E0E;GPTs-Actions"><a href="#OpenAI&#x7684;plugins&#x4E0E;GPTs-Actions" class="headerlink" title="OpenAI&#x7684;plugins&#x4E0E;GPTs(Actions)"></a>OpenAI&#x7684;plugins&#x4E0E;GPTs(Actions)</h1><p>ChatGPT&#x7684;&#x201D;Actions&#x201D;&#x4E0E;&#x201D;Plugins&#x201D;&#x662F;OpenAI&#x5728;GPT&#x6A21;&#x578B;&#x4E2D;&#x5F15;&#x5165;&#x7684;&#x4E24;&#x79CD;&#x4E0D;&#x540C;&#x7684;&#x529F;&#x80FD;&#x6269;&#x5C55;&#x673A;&#x5236;&#x3002;&#x8FD9;&#x4E24;&#x79CD;&#x673A;&#x5236;&#x7684;&#x76EE;&#x7684;&#x662F;&#x589E;&#x5F3A;&#x6A21;&#x578B;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x4F7F;&#x5176;&#x80FD;&#x591F;&#x5904;&#x7406;&#x66F4;&#x591A;&#x6837;&#x5316;&#x7684;&#x4EFB;&#x52A1;&#x548C;&#x8BF7;&#x6C42;&#x3002;</p>
<h2 id="plugins&#x7684;&#x59CB;&#x672B;"><a href="#plugins&#x7684;&#x59CB;&#x672B;" class="headerlink" title="plugins&#x7684;&#x59CB;&#x672B;"></a>plugins&#x7684;&#x59CB;&#x672B;</h2><h3 id="plugins&#x7684;&#x63A8;&#x51FA;"><a href="#plugins&#x7684;&#x63A8;&#x51FA;" class="headerlink" title="plugins&#x7684;&#x63A8;&#x51FA;"></a>plugins&#x7684;&#x63A8;&#x51FA;</h3><p>2023&#x5E74;&#xFF08;&#x5317;&#x4EAC;&#x65F6;&#x95F4;&#xFF09;3&#x6708;24&#x51CC;&#x6668;&#xFF0C;OpenAI&#x5BA3;&#x5E03;&#xFF0C;ChatGPT&#x4E2D;&#x521D;&#x6B65;&#x5B9E;&#x73B0;&#x5BF9;&#x63D2;&#x4EF6;&#x7684;&#x652F;&#x6301;&#x3002; <em>&#xFF08;Plugins are tools designed specifically for language models with safety as a core principle, and help ChatGPT access up-to-date information, run computations, or use third-party services.&#xFF09;</em></p>
<p>&#x63A8;&#x51FA;&#x4EE5;&#x6765;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x4EEC;&#x5DF2;&#x7ECF;&#x6784;&#x5EFA;&#x4E86;&#x6570;&#x5343;&#x4E2A;ChatGPT&#x63D2;&#x4EF6;&#xFF0C;&#x5305;&#x62EC;&#x6765;&#x81EA;Expedia&#x3001;Instacart&#x548C;Kayak&#x7B49;&#x516C;&#x53F8;&#x7684;&#x63D2;&#x4EF6;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/e5cc0c84ea0112570238a2afb7b05e6dc6d3e6b274501293fac8af3ab836e8ec" alt="v2-96e45676350d3ab0602d2f3f22592faa_1440w.webp"></p>
<p>&#x7B80;&#x5355;&#x70B9;&#x8BF4;&#xFF0C;&#x63D2;&#x4EF6;&#x80FD;&#x591F;&#x4F7F;ChatGPT&#x53C2;&#x4E0E;&#x5F00;&#x53D1;&#x8005;&#x5B9A;&#x4E49;&#x7684;API&#x4E92;&#x52A8;&#xFF0C;&#x589E;&#x5F3A;ChatGPT&#x7684;&#x80FD;&#x529B;&#x3002;&#x6709;&#x70B9;&#x7C7B;&#x4F3C;&#x4E8E;&#x82F9;&#x679C;&#x7684;appstore&#x3002;</p>
<p>&#x5F15;&#x5165;&#x63D2;&#x4EF6;Plugin&#x6807;&#x5FD7;ChatGPT&#x8D70;&#x5728;&#x521B;&#x5EFA;&#x751F;&#x6001;&#x7CFB;&#x7EDF;&#x7684;&#x4F1F;&#x5927;&#x9053;&#x8DEF;&#x4E0A;&#xFF0C;&#x7EDF;&#x4E00;&#x5E73;&#x53F0;+&#x63D2;&#x4EF6;&#x7684;&#x6A21;&#x5F0F;&#x6709;&#x671B;&#x6784;&#x5EFA;&#x4E0E;&#x82F9;&#x679C;+App Store&#x76F8;&#x4F3C;&#x7684;&#x7E41;&#x8363;&#x751F;&#x6001;&#x3002;</p>
<p>&#x540C;&#x65F6;&#xFF0C;Plugin&#x7684;&#x63A8;&#x51FA;&#x7ED9;&#x4E86;&#x5E7F;&#x5927;&#x7684;&#x5F00;&#x53D1;&#x8005;&#x66F4;&#x591A;&#x7684;&#x53C2;&#x4E0E;&#x5927;&#x6A21;&#x578B;&#x7684;&#x673A;&#x4F1A;&#x3002;</p>
<h3 id="&#x518D;&#x89C1;&#xFF0C;ChatGPT&#x63D2;&#x4EF6;&#xFF0C;Hello&#xFF0C;GPTs"><a href="#&#x518D;&#x89C1;&#xFF0C;ChatGPT&#x63D2;&#x4EF6;&#xFF0C;Hello&#xFF0C;GPTs" class="headerlink" title="&#x518D;&#x89C1;&#xFF0C;ChatGPT&#x63D2;&#x4EF6;&#xFF0C;Hello&#xFF0C;GPTs"></a>&#x518D;&#x89C1;&#xFF0C;ChatGPT&#x63D2;&#x4EF6;&#xFF0C;Hello&#xFF0C;GPTs</h3><p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/079cdad6409adb86c43d5ef0b3ac0dacda92b1507f2a11611fd3cafba08abdbc" alt="image.png"></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/492ca779389c587cd1173850faa533e533064d67a1b3236930d3f3a2fb237974" alt="image.png"></p>
<p>&#x81EA;2024&#x5E74;3&#x6708;19&#x65E5;&#x8D77;&#xFF0C;&#x5C06;&#x4E0D;&#x518D;&#x5141;&#x8BB8;&#x521B;&#x5EFA;&#x5E26;&#x63D2;&#x4EF6;&#x7684;&#x65B0;&#x5BF9;&#x8BDD;&#xFF0C;&#x8FD9;&#x4E00;&#x53D8;&#x5316;&#x610F;&#x5473;&#x7740;&#xFF0C;&#x7528;&#x6237;&#x548C;&#x5F00;&#x53D1;&#x8005;&#x5C06;&#x65E0;&#x6CD5;&#x5B89;&#x88C5;&#x65B0;&#x63D2;&#x4EF6;&#x6216;&#x5229;&#x7528;&#x73B0;&#x6709;&#x63D2;&#x4EF6;&#x521B;&#x5EFA;&#x65B0;&#x7684;&#x5BF9;&#x8BDD;&#x3002;</p>
<p><strong>&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x7ED3;&#x675F;&#x63D2;&#x4EF6;&#x6D4B;&#x8BD5;&#x7248;&#xFF1F;</strong></p>
<p>&#x5B98;&#x65B9;&#x7684;&#x56DE;&#x7B54;&#x662F;&#xFF1A;</p>
<p>&#x201C;With the launch of GPTs and the GPT store, we were able to make many improvements that plugin users had asked for. GPTs now have full feature parity (in addition to many new features) with plugins.&#x201D;</p>
<p>&#x5373;&#x201C;&#x968F;&#x7740; GPTs &#x548C; GPT &#x5546;&#x5E97;&#x7684;&#x63A8;&#x51FA;&#xFF0C;&#x6211;&#x4EEC;&#x80FD;&#x591F;&#x6839;&#x636E;&#x63D2;&#x4EF6;&#x7528;&#x6237;&#x7684;&#x8981;&#x6C42;&#x8FDB;&#x884C;&#x8BB8;&#x591A;&#x6539;&#x8FDB;&#x3002;<strong>GPTs &#x73B0;&#x5728;&#x5177;&#x6709;&#x4E0E;&#x63D2;&#x4EF6;&#x76F8;&#x540C;&#x7684;&#x5B8C;&#x6574;&#x529F;&#x80FD;</strong>&#xFF08;&#x9664;&#x4E86;&#x8BB8;&#x591A;&#x65B0;&#x529F;&#x80FD;&#x4E4B;&#x5916;&#xFF09;&#x3002;&#x201D;</p>
<p>GPTs&#x7684;&#x63A8;&#x51FA;&#xFF0C;&#x4F7F;&#x5F97;&#x666E;&#x901A;&#x4EBA;&#x4E5F;&#x80FD;&#x5728;GPT&#x7684;&#x8F85;&#x52A9;&#x4E0B;&#x81EA;&#x5DF1;&#x521B;&#x5EFA;&#x667A;&#x80FD;&#x4F53;&#xFF08;&#x5C3D;&#x7BA1;&#x56E0;&#x6BCF;&#x4E2A;&#x4EBA;&#x7684;&#x80FD;&#x529B;&#x4E0D;&#x540C;&#xFF0C;&#x521B;&#x5EFA;&#x7684;&#x667A;&#x80FD;&#x4F53;&#x7684;&#x80FD;&#x529B;&#x5F3A;&#x5F31;&#x4E5F;&#x5404;&#x6709;&#x5DEE;&#x5F02;&#xFF09;&#x3002;</p>
<p>&#x5982;&#x679C;&#x4F60;&#x5728;&#x5FAE;&#x535A;&#x4E0A;&#x641C;&#x7D22; ChatGPT Plugins&#xFF0C;&#x70ED;&#x95E8;&#x5185;&#x5BB9;&#x8FD8;&#x662F;&#x4E00;&#x5E74;&#x524D;&#x7684;&#x90A3;&#x573A;&#x53D1;&#x5E03;&#x4F1A;&#x6F14;&#x793A;&#x548C;&#x8BC4;&#x8BBA;&#xFF0C;&#x6240;&#x6709;&#x4EBA;&#x90FD;&#x5728;&#x611F;&#x53F9;&#x5411;&#x7B2C;&#x4E09;&#x65B9;&#x5F00;&#x653E; ChatGPT &#x7684;&#x80FD;&#x529B;&#x6709;&#x591A;&#x9006;&#x5929;&#xFF0C;&#x7ED3;&#x679C; OpenAI &#x81EA;&#x5DF1;&#x5C31;&#x7528; GPTs &#x628A; ChatGPT Plugins &#x7ED9;&#x5E72;&#x6389;&#x4E86;&#x3002;</p>
<p>&#x5177;&#x4F53;&#x4E3A;&#x4EC0;&#x4E48;OpenAI&#x4F1A;&#x5728;&#x4E00;&#x5E74;&#x4EE5;&#x540E;&#x5173;&#x95ED;Plugins&#xFF0C;&#x7F51;&#x4E0A;&#x6709;&#x5F88;&#x591A;&#x63A8;&#x8BBA;&#xFF0C;&#x53EF;&#x80FD;&#x548C;OpenAI&#x7684;&#x5E03;&#x5C40;&#x6709;&#x5173;&#xFF0C;&#x4E5F;&#x53EF;&#x80FD;&#x548C;&#x76EE;&#x524D;&#x7684;&#x5B89;&#x5168;&#x6709;&#x5173;&#x3002;&#x4F46;&#x662F;&#x8FD9;&#x90FD;&#x4E0D;&#x59A8;&#x788D;&#x539F;&#x672C;&#x7684;&#x5F88;&#x591A;&#x63D2;&#x4EF6;&#x4E5F;&#x90FD;&#x5F00;&#x53D1;&#x4E86;GPTs&#xFF0C;<strong>&#x5F88;&#x591A;GPTs&#x5DF2;&#x7ECF;&#x53EF;&#x4EE5;&#x66FF;&#x4EE3;&#x7EDD;&#x5927;&#x90E8;&#x5206;&#x63D2;&#x4EF6;&#x7684;&#x529F;&#x80FD;&#x4E86;</strong>&#x3002;GPT&#x5546;&#x5E97;&#x5DF2;&#x7ECF;&#x62E5;&#x6709;<strong>&#x6570;&#x5341;&#x4E07;&#x4E2A;GPTs</strong>&#xFF0C;&#x6DB5;&#x76D6;&#x5199;&#x4F5C;&#x3001;&#x751F;&#x4EA7;&#x529B;&#x3001;&#x7F16;&#x7A0B;&#x3001;&#x6559;&#x80B2;&#x7B49;&#x7C7B;&#x522B;&#x3002;</p>
<p>GPTs&#x7684;&#x63A8;&#x51FA;&#x4F7F;&#x5F97;&#x975E;&#x5F00;&#x53D1;&#x8005;&#x7684;&#x666E;&#x901A;&#x4EBA;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x6295;&#x5165;&#x5230;&#x5927;&#x6A21;&#x578B;&#x7684;&#x6D6A;&#x6F6E;&#x3002;</p>
<h2 id="&#x4E8C;&#x8005;&#x7684;&#x5BF9;&#x6BD4;"><a href="#&#x4E8C;&#x8005;&#x7684;&#x5BF9;&#x6BD4;" class="headerlink" title="&#x4E8C;&#x8005;&#x7684;&#x5BF9;&#x6BD4;"></a>&#x4E8C;&#x8005;&#x7684;&#x5BF9;&#x6BD4;</h2><p>ChatGPT Plugins &#x662F;&#x9700;&#x8981;&#x672C;&#x5730;&#x5F00;&#x53D1;&#x7684;&#xFF0C;API &#x6743;&#x9650;&#x5361;&#x5F97;&#x7279;&#x522B;&#x4E25;&#x683C;&#xFF0C;&#x4F46;&#x5927;&#x591A;&#x6570; GPTs &#x5374;&#x90FD;&#x662F;&#x76F4;&#x63A5;&#x57FA;&#x4E8E; Web &#x7AEF;&#x521B;&#x5EFA;&#x7684;&#xFF0C;&#x751A;&#x81F3;&#x4E0D;&#x9700;&#x8981;&#x7F16;&#x7A0B;&#x3002;</p>
<h3 id="Plugins"><a href="#Plugins" class="headerlink" title="Plugins"></a>Plugins</h3><p>&#x5B9A;&#x4E49;&#x4E0E;&#x7528;&#x9014;&#xFF1A;Plugins&#xFF08;&#x63D2;&#x4EF6;&#xFF09;&#x662F;&#x4E00;&#x79CD;&#x7528;&#x4E8E;&#x6269;&#x5C55;ChatGPT&#x529F;&#x80FD;&#x7684;&#x673A;&#x5236;&#xFF0C;&#x5141;&#x8BB8;&#x6A21;&#x578B;&#x4E0E;&#x5916;&#x90E8;&#x7CFB;&#x7EDF;&#x4EA4;&#x4E92;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x53EF;&#x4EE5;&#x4E0E;&#x6570;&#x636E;&#x5E93;&#x3001;API&#x6216;&#x5176;&#x4ED6;&#x8F6F;&#x4EF6;&#x670D;&#x52A1;&#x8FDB;&#x884C;&#x4EA4;&#x4E92;&#x3002;</p>
<p>&#x5DE5;&#x4F5C;&#x65B9;&#x5F0F;&#xFF1A;&#x5F53;ChatGPT&#x9700;&#x8981;&#x83B7;&#x53D6;&#x5916;&#x90E8;&#x4FE1;&#x606F;&#x6216;&#x6267;&#x884C;&#x67D0;&#x4E9B;&#x4E0D;&#x4EC5;&#x4EC5;&#x4F9D;&#x8D56;&#x6587;&#x672C;&#x751F;&#x6210;&#x7684;&#x4EFB;&#x52A1;&#x65F6;&#xFF0C;&#x4F1A;&#x901A;&#x8FC7;&#x8FD9;&#x4E9B;&#x63D2;&#x4EF6;&#x4E0E;&#x5916;&#x90E8;&#x7CFB;&#x7EDF;&#x901A;&#x4FE1;&#x3002;</p>
<p>&#x5E94;&#x7528;&#x5B9E;&#x4F8B;&#xFF1A;&#x4F8B;&#x5982;&#xFF0C;ChatGPT&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x5929;&#x6C14;&#x63D2;&#x4EF6;&#x6765;&#x83B7;&#x53D6;&#x5B9E;&#x65F6;&#x5929;&#x6C14;&#x4FE1;&#x606F;&#xFF0C;&#x6216;&#x8005;&#x901A;&#x8FC7;&#x641C;&#x7D22;&#x5F15;&#x64CE;&#x63D2;&#x4EF6;&#x6765;&#x63D0;&#x4F9B;&#x6700;&#x65B0;&#x7684;&#x641C;&#x7D22;&#x7ED3;&#x679C;&#x3002;</p>
<h3 id="Actions"><a href="#Actions" class="headerlink" title="Actions"></a>Actions</h3><p>&#x5B9A;&#x4E49;&#x4E0E;&#x7528;&#x9014;&#xFF1A;Actions&#xFF08;&#x52A8;&#x4F5C;&#xFF09;&#x662F;ChatGPT&#x7684;&#x4E00;&#x79CD;&#x65B0;&#x529F;&#x80FD;&#xFF0C;&#x65E8;&#x5728;&#x5141;&#x8BB8;&#x6A21;&#x578B;&#x5728;&#x5BF9;&#x8BDD;&#x4E2D;&#x76F4;&#x63A5;&#x6267;&#x884C;&#x7279;&#x5B9A;&#x7684;&#x52A8;&#x4F5C;&#xFF0C;&#x8FD9;&#x4E9B;&#x52A8;&#x4F5C;&#x53EF;&#x80FD;&#x6D89;&#x53CA;&#x6A21;&#x578B;&#x7684;&#x5185;&#x90E8;&#x529F;&#x80FD;&#x6216;&#x7279;&#x5B9A;&#x7684;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x3002;</p>
<p>&#x65B0;&#x7279;&#x6027;&#xFF1A;<br>&#x76F4;&#x63A5;&#x4EA4;&#x4E92;&#xFF1A;Actions&#x53EF;&#x4EE5;&#x8BA9;&#x6A21;&#x578B;&#x5728;&#x5BF9;&#x8BDD;&#x4E2D;&#x76F4;&#x63A5;&#x89E6;&#x53D1;&#x548C;&#x6267;&#x884C;&#x7279;&#x5B9A;&#x4EFB;&#x52A1;&#xFF0C;&#x5982;&#x751F;&#x6210;&#x56FE;&#x50CF;&#x3001;&#x6267;&#x884C;&#x4EE3;&#x7801;&#x7B49;&#xFF0C;&#x65E0;&#x9700;&#x5916;&#x90E8;&#x63D2;&#x4EF6;&#x4ECB;&#x5165;&#x3002;<br>&#x4EFB;&#x52A1;&#x591A;&#x6837;&#x6027;&#xFF1A;&#x652F;&#x6301;&#x591A;&#x79CD;&#x4E0D;&#x540C;&#x7684;&#x4EFB;&#x52A1;&#x7C7B;&#x578B;&#xFF0C;&#x5982;&#x6587;&#x672C;&#x751F;&#x6210;&#x3001;&#x56FE;&#x50CF;&#x5904;&#x7406;&#x3001;&#x6570;&#x636E;&#x5206;&#x6790;&#x7B49;&#x3002;</p>
<p>&#x66F4;&#x6D41;&#x7545;&#x7684;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#xFF1A;&#x901A;&#x8FC7;Actions&#xFF0C;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#x66F4;&#x52A0;&#x76F4;&#x63A5;&#x548C;&#x6D41;&#x7545;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x79BB;&#x5F00;&#x5BF9;&#x8BDD;&#x754C;&#x9762;&#x5373;&#x53EF;&#x5B8C;&#x6210;&#x591A;&#x79CD;&#x4EFB;&#x52A1;&#x3002;</p>
<p>&#x81EA;&#x5B9A;&#x4E49;&#x52A8;&#x4F5C;&#xFF1A;&#x652F;&#x6301;&#x521B;&#x5EFA;&#x81EA;&#x5B9A;&#x4E49;&#x52A8;&#x4F5C;&#xFF0C;&#x4EE5;&#x9002;&#x5E94;&#x7279;&#x5B9A;&#x7684;&#x7528;&#x4F8B;&#x6216;&#x9700;&#x6C42;&#x3002;</p>
<p>&#x96C6;&#x6210;&#x5185;&#x90E8;&#x5DE5;&#x5177;&#xFF1A;&#x4E0E;&#x5185;&#x7F6E;&#x7684;&#x5DE5;&#x5177;&#x548C;&#x529F;&#x80FD;&#xFF08;&#x5982;Python&#x73AF;&#x5883;&#x3001;DALL-E&#x56FE;&#x50CF;&#x751F;&#x6210;&#x7B49;&#xFF09;&#x7D27;&#x5BC6;&#x96C6;&#x6210;&#x3002;</p>
<h3 id="&#x603B;&#x7ED3;"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3;</h3><p>Plugins&#xFF1A;&#x4FA7;&#x91CD;&#x4E8E;&#x4E0E;&#x5916;&#x90E8;&#x7CFB;&#x7EDF;&#x7684;&#x4EA4;&#x4E92;&#x548C;&#x96C6;&#x6210;&#x3002;<br>Actions&#xFF1A;&#x4FA7;&#x91CD;&#x4E8E;&#x5728;&#x5BF9;&#x8BDD;&#x4E2D;&#x76F4;&#x63A5;&#x6267;&#x884C;&#x7279;&#x5B9A;&#x4EFB;&#x52A1;&#xFF0C;&#x63D0;&#x4F9B;&#x4E86;&#x66F4;&#x591A;&#x6837;&#x5316;&#x7684;&#x5185;&#x90E8;&#x529F;&#x80FD;&#x3002;</p>
<h2 id="GPT4-0-turbo&#x5347;&#x7EA7;&#x4E0A;&#x7EBF;"><a href="#GPT4-0-turbo&#x5347;&#x7EA7;&#x4E0A;&#x7EBF;" class="headerlink" title="GPT4.0 turbo&#x5347;&#x7EA7;&#x4E0A;&#x7EBF;"></a>GPT4.0 turbo&#x5347;&#x7EA7;&#x4E0A;&#x7EBF;</h2><p>&#x63D0;&#x5230;GPTs&#x5C31;&#x4E0D;&#x5F97;&#x4E0D;&#x63D0;GPT4.0 turbo&#xFF0C;&#x5B83;&#x7684;&#x51FA;&#x73B0;&#xFF0C;&#x662F;&#x4F7F;&#x5F97;&#x4F17;&#x591A;AI&#x521B;&#x4E1A;&#x8005;&#x4E00;&#x591C;&#x65E0;&#x7720;&#x7684;&#x7248;&#x672C;&#x3002;</p>
<p>&#x501F;&#x7528;&#x4E00;&#x4E2A;&#x56FE;&#x6765;&#x8BF4;&#x660E;&#x4E0B;&#x5B83;&#x7684;&#x5F3A;&#x5927;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/718e779444a5311267de867e91ced25e879c99bf922cb265130c0925277b77a3" alt="image.png"></p>
<ul>
<li><strong>&#x8FD9;&#x91CC;&#x9762;&#x6709;&#x51E0;&#x4E2A;&#x7206;&#x70B9;&#xFF1A;</strong></li>
<li>&#x66F4;&#x957F;&#x3002;&#x652F;&#x6301;128K&#x4E0A;&#x4E0B;&#x6587;&#x8F93;&#x5165;&#xFF0C;&#x6807;&#x51C6;GPT-4&#x662F;8K&#x7248;&#x672C;&#xFF0C;&#x4E4B;&#x524D;&#x5347;&#x7EA7;&#x51FA;&#x4E86;32K&#x7248;&#x672C;</li>
<li>&#x66F4;&#x53EF;&#x63A7;&#x3002;JSON&#x683C;&#x5F0F;&#x8F93;&#x51FA;&#xFF0C;&#x589E;&#x52A0;seed&#x63A7;&#x5236;&#x6A21;&#x578B;&#x56DE;&#x590D;&#x53EF;&#x590D;&#x73B0;</li>
<li>&#x66F4;&#x65B0;&#x7684;&#x77E5;&#x8BC6;&#x3002;GPT-4 Trubo&#x7684;&#x77E5;&#x8BC6;&#x66F4;&#x65B0;&#x81F3;2023&#x5E74;4&#x6708;</li>
<li>&#x5F00;&#x653E;&#x591A;&#x6A21;&#x6001;&#x80FD;&#x529B;&#xFF0C;&#x6574;&#x5408;&#x4E86;&#x6587;&#x751F;&#x56FE;&#x6A21;&#x578B;DALL&#xB7;E 3&#x548C;&#x58F0;&#x97F3;&#x5408;&#x6210;&#x6A21;&#x578B;&#xFF08;TTS&#xFF09;&#x4EE5;&#x53CA;&#x8BED;&#x97F3;&#x8BC6;&#x522B;&#x6A21;&#x578B;Whisper V3&#x7B49;</li>
<li>&#x5F00;&#x653E; Fine-Tuning&#x529F;&#x80FD;&#xFF0C;&#x652F;&#x6301;&#x5728;GPT-4&#x57FA;&#x7840;&#x4E0A;&#x5FAE;&#x8C03;&#x8FDB;&#x884C;&#x6A21;&#x578B;&#x5B9A;&#x5236;</li>
<li>&#x8F93;&#x51FA;&#x901F;&#x5EA6;&#x66F4;&#x5FEB;&#xFF0C;&#x6BCF;&#x5206;&#x949F;&#x8F93;&#x51FA;&#x7FFB;&#x500D;</li>
<li>GPTs</li>
<li>Assistant API</li>
</ul>
<h1 id="&#x57FA;&#x4E8E;&#x5927;&#x6A21;&#x578B;&#xFF08;LLM&#xFF09;&#x7684;Agent"><a href="#&#x57FA;&#x4E8E;&#x5927;&#x6A21;&#x578B;&#xFF08;LLM&#xFF09;&#x7684;Agent" class="headerlink" title="&#x57FA;&#x4E8E;&#x5927;&#x6A21;&#x578B;&#xFF08;LLM&#xFF09;&#x7684;Agent"></a>&#x57FA;&#x4E8E;&#x5927;&#x6A21;&#x578B;&#xFF08;LLM&#xFF09;&#x7684;Agent</h1><p>&#x76EE;&#x524D;&#xFF0C;&#x4E1A;&#x754C;&#x4E00;&#x822C;&#x8BA4;&#x4E3A;&#x57FA;&#x4E8E;&#x5927;&#x6A21;&#x578B;&#x7684;&#x5E94;&#x7528;&#x96C6;&#x4E2D;&#x5728;&#x4E24;&#x4E2A;&#x65B9;&#x5411;&#x4E0A;&#xFF1A;RAG &#x548C; Agent&#xFF0C;&#x65E0;&#x8BBA;&#x54EA;&#x4E00;&#x79CD;&#x5E94;&#x7528;&#xFF0C;&#x8BBE;&#x8BA1;&#x3001;&#x5B9E;&#x73B0;&#x548C;&#x4F18;&#x5316;&#x80FD;&#x591F;&#x5145;&#x5206;&#x5229;&#x7528;&#x5927;&#x6A21;&#x578B;(LLM)&#x6F5C;&#x529B;&#x7684;&#x5E94;&#x7528;&#x90FD;&#x9700;&#x8981;&#x5927;&#x91CF;&#x7684;&#x52AA;&#x529B;&#x548C;&#x4E13;&#x4E1A;&#x77E5;&#x8BC6;&#x3002;</p>
<h2 id="Agent&#x5E7F;&#x4E49;&#x7684;&#x5B9A;&#x4E49;"><a href="#Agent&#x5E7F;&#x4E49;&#x7684;&#x5B9A;&#x4E49;" class="headerlink" title="Agent&#x5E7F;&#x4E49;&#x7684;&#x5B9A;&#x4E49;"></a>Agent&#x5E7F;&#x4E49;&#x7684;&#x5B9A;&#x4E49;</h2><p>&#x8FD9;&#x91CC;&#x7684;Agent &#x6307;&#x7684;&#x662F;&#x667A;&#x80FD;&#x4F53;&#xFF0C;&#x53EF;&#x4EE5;&#x8FFD;&#x6EAF;&#x5230;&#x660E;&#x65AF;&#x57FA;&#x7684;&#x300A;society of mind&#x300B;&#x4E00;&#x4E66;&#x3002;&#x5728;&#x90A3;&#x672C;&#x4E66;&#x4E2D;&#xFF0C;&#x660E;&#x65AF;&#x57FA;&#x5BF9;Agent&#x7684;&#x5B9A;&#x4E49;&#x6709;&#x70B9;&#x62BD;&#x8C61;&#x2014;&#x2014;&#x201C;&#x793E;&#x4F1A;&#x4E2D;&#x67D0;&#x4E2A;&#x4E2A;&#x4F53;&#x7ECF;&#x8FC7;&#x534F;&#x5546;&#x540E;&#x53EF;&#x6C42;&#x5F97;&#x95EE;&#x9898;&#x7684;&#x89E3;,&#x8FD9;&#x4E2A;&#x4E2A;&#x4F53;&#x5C31;&#x662F;agent&#x201D;&#x3002;&#x5728;&#x8BA1;&#x7B97;&#x673A;&#x9886;&#x57DF;&#xFF0C;agent&#x662F;&#x4E00;&#x79CD;&#x901A;&#x8FC7;&#x4F20;&#x611F;&#x5668;&#x611F;&#x77E5;&#x5176;&#x73AF;&#x5883;&#xFF0C;&#x5E76;&#x901A;&#x8FC7;&#x6267;&#x884C;&#x5668;&#x4F5C;&#x7528;&#x4E8E;&#x8BE5;&#x73AF;&#x5883;&#x7684;&#x5B9E;&#x4F53;&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;&#x53EF;&#x4EE5;&#x628A;&#x5B9E;&#x4F53;&#x5B9A;&#x4E49;&#x4E3A;&#x4E00;&#x79CD;&#x4ECE;&#x611F;&#x77E5;&#x5E8F;&#x5217;&#x5230;&#x5B9E;&#x4F53;&#x52A8;&#x4F5C;&#x7684;&#x6620;&#x5C04;&#x3002;&#x4E00;&#x822C;&#x8BA4;&#x4E3A;&#xFF0C;Agent&#x662F;&#x6307;&#x9A7B;&#x7559;&#x5728;&#x67D0;&#x4E00;&#x73AF;&#x5883;&#x4E0B;&#xFF0C;&#x80FD;&#x6301;&#x7EED;&#x81EA;&#x4E3B;&#x5730;&#x53D1;&#x6325;&#x4F5C;&#x7528;&#xFF0C;&#x5177;&#x5907;&#x81EA;&#x4E3B;&#x6027;&#x3001;&#x53CD;&#x5E94;&#x6027;&#x3001;&#x793E;&#x4F1A;&#x6027;&#x3001;&#x4E3B;&#x52A8;&#x6027;&#x7B49;&#x7279;&#x5F81;&#x7684;&#x8BA1;&#x7B97;&#x5B9E;&#x4F53;&#x3002;</p>
<p>&#x667A;&#x80FD;&#xFF0C;&#x662F;Agent &#x4E0E;&#x73AF;&#x5883;&#x76F8;&#x4E92;&#x4F5C;&#x7528;&#x7684;&#x6D8C;&#x73B0;&#x5C5E;&#x6027;&#x3002;</p>
<h2 id="&#x5927;&#x6A21;&#x578B;&#x4E2D;&#x7684;Agent"><a href="#&#x5927;&#x6A21;&#x578B;&#x4E2D;&#x7684;Agent" class="headerlink" title="&#x5927;&#x6A21;&#x578B;&#x4E2D;&#x7684;Agent"></a>&#x5927;&#x6A21;&#x578B;&#x4E2D;&#x7684;Agent</h2><p>&#x5728;&#x5927;&#x6A21;&#x578B;&#x9886;&#x57DF;&#xFF0C;&#x5927;&#x6A21;&#x578B;&#x66FF;&#x4EE3;&#x4E86;&#x4F20;&#x7EDF;agent &#x4E2D;&#x7684;&#x89C4;&#x5219;&#x5F15;&#x64CE;&#x4EE5;&#x53CA;&#x77E5;&#x8BC6;&#x5E93;&#xFF0C;Agent&#x63D0;&#x4F9B;&#x4E86;&#x5E76;&#x5BFB;&#x6C42;&#x63A8;&#x7406;&#x3001;&#x89C2;&#x5BDF;&#x3001;&#x6279;&#x8BC4;&#x548C;&#x9A8C;&#x8BC1;&#x7684;&#x5BF9;&#x8BDD;&#x901A;&#x9053;&#x3002;&#x7279;&#x522B;&#x662F;&#x5F53;&#x914D;&#x7F6E;&#x4E86;&#x6B63;&#x786E;&#x7684;&#x63D0;&#x793A;&#x548C;&#x63A8;&#x7406;&#x8BBE;&#x7F6E;&#x65F6;&#xFF0C;&#x5355;&#x4E2A;LLM&#x5C31;&#x53EF;&#x4EE5;&#x663E;&#x793A;&#x51FA;&#x5E7F;&#x6CDB;&#x7684;&#x529F;&#x80FD; &#xFF0C;&#x4E0D;&#x540C;&#x914D;&#x7F6E;&#x7684;Agent&#x4E4B;&#x95F4;&#x7684;&#x5BF9;&#x8BDD;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x4EE5;&#x6A21;&#x5757;&#x5316;&#x5E76;&#x4EE5;&#x4E92;&#x8865;&#x7684;&#x65B9;&#x5F0F;&#x5C06;&#x8FD9;&#x4E9B;&#x5E7F;&#x6CDB;&#x7684;LLM&#x529F;&#x80FD;&#x7ED3;&#x5408;&#x8D77;&#x6765;&#x3002;</p>
<p>&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x53EF;&#x4EE5;&#x8F7B;&#x677E;&#x3001;&#x5FEB;&#x901F;&#x5730;&#x521B;&#x5EFA;&#x5177;&#x6709;&#x4E0D;&#x540C;&#x89D2;&#x8272;&#x7684;Agent&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;&#x4F7F;&#x7528;Agent&#x6765;&#x7F16;&#x5199;&#x4EE3;&#x7801;&#x3001;&#x6267;&#x884C;&#x4EE3;&#x7801;&#x3001;&#x8FDE;&#x63A5;&#x4EBA;&#x5DE5;&#x53CD;&#x9988;&#x3001;&#x9A8C;&#x8BC1;&#x8F93;&#x51FA;&#x7B49;&#x3002;&#x901A;&#x8FC7;&#x9009;&#x62E9;&#x548C;&#x914D;&#x7F6E;&#x5185;&#x7F6E;&#x529F;&#x80FD;&#x7684;&#x5B50;&#x96C6;&#xFF0C;Agent&#x7684;&#x540E;&#x7AEF;&#x4E5F;&#x53EF;&#x4EE5;&#x5F88;&#x5BB9;&#x6613;&#x5730;&#x8FDB;&#x884C;&#x6269;&#x5C55;&#xFF0C;&#x4EE5;&#x5141;&#x8BB8;&#x66F4;&#x591A;&#x7684;&#x81EA;&#x5B9A;&#x4E49;&#x884C;&#x4E3A;&#x3002;</p>
<h3 id="&#x57FA;&#x4E8E;&#x5927;&#x6A21;&#x578B;&#x7684;&#x5E38;&#x89C1;Agent-&#x548C;-Multi-Agent-&#x7CFB;&#x7EDF;"><a href="#&#x57FA;&#x4E8E;&#x5927;&#x6A21;&#x578B;&#x7684;&#x5E38;&#x89C1;Agent-&#x548C;-Multi-Agent-&#x7CFB;&#x7EDF;" class="headerlink" title="&#x57FA;&#x4E8E;&#x5927;&#x6A21;&#x578B;&#x7684;&#x5E38;&#x89C1;Agent &#x548C; Multi-Agent &#x7CFB;&#x7EDF;"></a>&#x57FA;&#x4E8E;&#x5927;&#x6A21;&#x578B;&#x7684;&#x5E38;&#x89C1;Agent &#x548C; Multi-Agent &#x7CFB;&#x7EDF;</h3><h2 id="&#x5C0F;&#x7ED3;"><a href="#&#x5C0F;&#x7ED3;" class="headerlink" title="&#x5C0F;&#x7ED3;"></a>&#x5C0F;&#x7ED3;</h2><p>&#x5F00;&#x5934;&#x6211;&#x4EEC;&#x8BB2;&#x4E86;&#xFF0C;Agent&#x662F;&#x4E00;&#x4E2A;&#x76EE;&#x524D;&#x5927;&#x6A21;&#x578B;&#x9886;&#x57DF;&#x91CD;&#x8981;&#x7684;&#x5E94;&#x7528;&#x65B9;&#x5411;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x4E5F;&#x4F1A;&#x518D;&#x7EC6;&#x5206;&#x4E13;&#x9898;&#x5206;&#x522B;&#x8FDB;&#x884C;&#x8BA8;&#x8BBA;&#x3002;&#x4E0D;&#x5728;&#x8FD9;&#x91CC;&#x8FC7;&#x591A;&#x5C55;&#x5F00;&#x3002;</p>
<h2 id="OpenAI&#x63A8;&#x51FA;&#x7684;Assistants-API"><a href="#OpenAI&#x63A8;&#x51FA;&#x7684;Assistants-API" class="headerlink" title="OpenAI&#x63A8;&#x51FA;&#x7684;Assistants API"></a>OpenAI&#x63A8;&#x51FA;&#x7684;Assistants API</h2><p>Assistant&#x5168;&#x540D;Assistant API&#xFF0C; &#x6240;&#x4EE5;&#x5B83;&#x672C;&#x8EAB;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;APP&#xFF0C;&#x800C;&#x662F;API&#x5DE5;&#x5177;&#x7BB1;&#xFF0C;&#x53EF;&#x4EE5;&#x5D4C;&#x5165;&#x5230;APP&#x4E2D;&#x90A3;&#x79CD;&#xFF0C;&#x6240;&#x4EE5;Assistant API&#x7684;&#x5E94;&#x7528;&#x5C42;&#x7EA7;&#x5E94;&#x8BE5;&#x662F;&#x4ECB;&#x4E8E;Fine-tuned Models&#x548C;LLM-based APP&#x4E4B;&#x95F4;&#xFF0C;&#x5B83;&#x770B;&#x8D77;&#x6765;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x5B8C;&#x5168;&#x4F53;&#x5E94;&#x7528;&#xFF0C;&#x4F46;&#x4E5F;&#x4E0D;&#x9700;&#x8981;&#x50CF;&#x6A21;&#x578B;finetune&#x4E00;&#x6837;&#x9700;&#x8981;&#x638C;&#x63E1;&#x539F;&#x7406;&#x3001;&#x6570;&#x636E;&#x96C6;&#x3001;&#x65B9;&#x6CD5;&#x7B49;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x540E;&#x9762;&#x6211;&#x4EEC;&#x4E5F;&#x5355;&#x72EC;&#x5F00;&#x4E2A;&#x4E13;&#x9898;&#x6765;&#x5206;&#x4EAB;&#x5BF9;&#x4E8E;Assistants API&#x7684;&#x4F7F;&#x7528;&#x3002;</p>
<h1 id="RAG"><a href="#RAG" class="headerlink" title="RAG"></a>RAG</h1><p>&#x6240;&#x8C13;RAG&#xFF0C;&#x68C0;&#x7D22;&#x589E;&#x5F3A;&#x751F;&#x6210;&#xFF08;Retrieval Augmented Generation&#xFF09;&#xFF0C;&#x7B80;&#x79F0; RAG&#xFF0C;&#x5DF2;&#x7ECF;&#x6210;&#x4E3A;&#x5F53;&#x524D;&#x6700;&#x706B;&#x70ED;&#x7684;LLM&#x5E94;&#x7528;&#x65B9;&#x6848;&#x3002;</p>
<p>&#x901A;&#x4FD7;&#x70B9;&#x8BF4;;&#x5C31;&#x662F;&#x901A;&#x8FC7;&#x81EA;&#x6709;&#x5782;&#x57DF;&#x6570;&#x636E;&#x5E93;&#x68C0;&#x7D22;&#x76F8;&#x5173;&#x4FE1;&#x606F;&#xFF0C;&#x7136;&#x540E;&#x5408;&#x5E76;&#x6210;&#x4E3A;&#x63D0;&#x793A;&#x6A21;&#x677F;&#xFF0C;&#x7ED9;&#x5927;&#x6A21;&#x578B;&#x751F;&#x6210;&#x6F02;&#x4EAE;&#x7684;&#x56DE;&#x7B54;&#x3002;</p>
<p>RAG&#x7684;&#x51FA;&#x73B0;&#xFF0C;&#x662F;&#x56E0;&#x4E3A;&#x5728;&#x5927;&#x6A21;&#x578B;&#x7684;&#x5E7F;&#x6CDB;&#x5E94;&#x7528;&#x4E2D;&#xFF0C;&#x4F34;&#x968F;&#x7740;&#x51FA;&#x73B0;&#x7684;&#x4E00;&#x4E9B;&#x95EE;&#x9898;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;</p>
<ul>
<li><strong>&#x77E5;&#x8BC6;&#x7684;&#x5C40;&#x9650;&#x6027;</strong>&#xFF1A;&#x6A21;&#x578B;&#x81EA;&#x8EAB;&#x7684;&#x77E5;&#x8BC6;&#x5B8C;&#x5168;&#x6E90;&#x4E8E;&#x5B83;&#x7684;&#x8BAD;&#x7EC3;&#x6570;&#x636E;&#xFF0C;&#x800C;&#x73B0;&#x6709;&#x7684;&#x4E3B;&#x6D41;&#x5927;&#x6A21;&#x578B;&#xFF08;ChatGPT&#x3001;&#x6587;&#x5FC3;&#x4E00;&#x8A00;&#x3001;&#x901A;&#x4E49;&#x5343;&#x95EE;&#x2026;&#xFF09;&#x7684;&#x8BAD;&#x7EC3;&#x96C6;&#x57FA;&#x672C;&#x90FD;&#x662F;&#x6784;&#x5EFA;&#x4E8E;&#x7F51;&#x7EDC;&#x516C;&#x5F00;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x5BF9;&#x4E8E;&#x4E00;&#x4E9B;&#x5B9E;&#x65F6;&#x6027;&#x7684;&#x3001;&#x975E;&#x516C;&#x5F00;&#x7684;&#x6216;&#x79BB;&#x7EBF;&#x7684;&#x6570;&#x636E;&#x662F;&#x65E0;&#x6CD5;&#x83B7;&#x53D6;&#x5230;&#x7684;&#xFF0C;&#x8FD9;&#x90E8;&#x5206;&#x77E5;&#x8BC6;&#x4E5F;&#x5C31;&#x65E0;&#x4ECE;&#x5177;&#x5907;&#x3002;</li>
<li><strong>&#x5E7B;&#x89C9;&#x95EE;&#x9898;</strong>&#xFF1A;&#x6240;&#x6709;&#x7684;AI&#x6A21;&#x578B;&#x7684;&#x5E95;&#x5C42;&#x539F;&#x7406;&#x90FD;&#x662F;&#x57FA;&#x4E8E;&#x6570;&#x5B66;&#x6982;&#x7387;&#xFF0C;&#x5176;&#x6A21;&#x578B;&#x8F93;&#x51FA;&#x5B9E;&#x8D28;&#x4E0A;&#x662F;&#x4E00;&#x7CFB;&#x5217;&#x6570;&#x503C;&#x8FD0;&#x7B97;&#xFF0C;&#x5927;&#x6A21;&#x578B;&#x4E5F;&#x4E0D;&#x4F8B;&#x5916;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x6709;&#x65F6;&#x5019;&#x4F1A;&#x4E00;&#x672C;&#x6B63;&#x7ECF;&#x5730;&#x80E1;&#x8BF4;&#x516B;&#x9053;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x5728;&#x5927;&#x6A21;&#x578B;&#x81EA;&#x8EAB;&#x4E0D;&#x5177;&#x5907;&#x67D0;&#x4E00;&#x65B9;&#x9762;&#x7684;&#x77E5;&#x8BC6;&#x6216;&#x4E0D;&#x64C5;&#x957F;&#x7684;&#x573A;&#x666F;&#x3002;&#x800C;&#x8FD9;&#x79CD;&#x5E7B;&#x89C9;&#x95EE;&#x9898;&#x7684;&#x533A;&#x5206;&#x662F;&#x6BD4;&#x8F83;&#x56F0;&#x96BE;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x8981;&#x6C42;&#x4F7F;&#x7528;&#x8005;&#x81EA;&#x8EAB;&#x5177;&#x5907;&#x76F8;&#x5E94;&#x9886;&#x57DF;&#x7684;&#x77E5;&#x8BC6;&#x3002;</li>
<li><strong>&#x6570;&#x636E;&#x5B89;&#x5168;&#x6027;</strong>&#xFF1A;&#x5BF9;&#x4E8E;&#x4F01;&#x4E1A;&#x6765;&#x8BF4;&#xFF0C;&#x6570;&#x636E;&#x5B89;&#x5168;&#x81F3;&#x5173;&#x91CD;&#x8981;&#xFF0C;&#x6CA1;&#x6709;&#x4F01;&#x4E1A;&#x613F;&#x610F;&#x627F;&#x62C5;&#x6570;&#x636E;&#x6CC4;&#x9732;&#x7684;&#x98CE;&#x9669;&#xFF0C;&#x5C06;&#x81EA;&#x8EAB;&#x7684;&#x79C1;&#x57DF;&#x6570;&#x636E;&#x4E0A;&#x4F20;&#x7B2C;&#x4E09;&#x65B9;&#x5E73;&#x53F0;&#x8FDB;&#x884C;&#x8BAD;&#x7EC3;&#x3002;&#x8FD9;&#x4E5F;&#x5BFC;&#x81F4;&#x5B8C;&#x5168;&#x4F9D;&#x8D56;&#x901A;&#x7528;&#x5927;&#x6A21;&#x578B;&#x81EA;&#x8EAB;&#x80FD;&#x529B;&#x7684;&#x5E94;&#x7528;&#x65B9;&#x6848;&#x4E0D;&#x5F97;&#x4E0D;&#x5728;&#x6570;&#x636E;&#x5B89;&#x5168;&#x548C;&#x6548;&#x679C;&#x65B9;&#x9762;&#x8FDB;&#x884C;&#x53D6;&#x820D;&#x3002;</li>
</ul>
<p>&#x800C;RAG&#x662F;&#x89E3;&#x51B3;&#x4E0A;&#x8FF0;&#x95EE;&#x9898;&#x7684;&#x4E00;&#x5957;&#x6709;&#x6548;&#x65B9;&#x6848;&#x3002;</p>
<p><strong>RAG = &#x68C0;&#x7D22;&#x6280;&#x672F; + LLM &#x63D0;&#x793A;</strong>&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x5411; LLM &#x63D0;&#x95EE;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;RAG &#x4ECE;&#x5404;&#x79CD;&#x6570;&#x636E;&#x6E90;&#x68C0;&#x7D22;&#x76F8;&#x5173;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x5E76;&#x5C06;&#x68C0;&#x7D22;&#x5230;&#x7684;&#x4FE1;&#x606F;&#x548C;&#x95EE;&#x9898;&#x6CE8;&#x5165;&#x5230; LLM &#x63D0;&#x793A;&#x4E2D;&#xFF0C;LLM &#x6700;&#x540E;&#x7ED9;&#x51FA;&#x7B54;&#x6848;&#x3002;</p>
<p>&#x8BB8;&#x591A;&#x4EA7;&#x54C1;&#x57FA;&#x4E8E; RAG &#x6784;&#x5EFA;&#xFF0C;&#x4ECE;&#x57FA;&#x4E8E; web &#x641C;&#x7D22;&#x5F15;&#x64CE;&#x548C; LLM &#x7684;&#x95EE;&#x7B54;&#x670D;&#x52A1;&#x5230;&#x4F7F;&#x7528;&#x79C1;&#x6709;&#x6570;&#x636E;&#x7684;chat&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;</p>
<h1 id="&#x603B;&#x7ED3;-1"><a href="#&#x603B;&#x7ED3;-1" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3;</h1><p>&#x672C;&#x6587;&#x7AE0;&#x8BB2;&#x4E86;&#x5F88;&#x591A;&#x5728;&#x5927;&#x6A21;&#x578B;&#x5E94;&#x7528;&#x5C42;&#x7684;&#x5F88;&#x591A;&#x6982;&#x5FF5;&#xFF0C;&#x6709;ChatGPT&#x7684;&#x529F;&#x80FD;&#xFF1A;plugins&#x3001;GPTs&#x3001;Assistant API&#xFF1B;&#x4E5F;&#x6709;&#x5927;&#x6A21;&#x578B;&#x7684;&#x5E94;&#x7528;&#xFF1A;agent&#xFF0C;RAG&#xFF0C;&#x63D0;&#x793A;&#x8BCD;&#x5DE5;&#x7A0B;&#x7684;&#x5E94;&#x7528;&#xFF0C;finetune&#xFF0C;&#x8BAD;&#x7EC3;&#x5782;&#x76F4;&#x9886;&#x57DF;&#x5927;&#x6A21;&#x578B;&#xFF0C;&#x81EA;&#x5DF1;&#x9020;&#x8F6E;&#x5B50;&#x7B49;&#x7B49;&#x3002;</p>
<p>&#x5728;&#x771F;&#x6B63;&#x805A;&#x7126;&#x4E8E;&#x6211;&#x4EEC;&#x627E;&#x5230;&#x81EA;&#x5DF1;&#x611F;&#x5174;&#x8DA3;&#x548C;&#x5408;&#x9002;&#x7684;&#x6DF1;&#x5165;&#x65B9;&#x5411;&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x8981;&#x4E86;&#x89E3;&#x73B0;&#x5728;&#x57FA;&#x4E8E;&#x5927;&#x6A21;&#x578B;&#x7684;&#x5E94;&#x7528;&#x90FD;&#x6709;&#x4E9B;&#x4EC0;&#x4E48;&#xFF0C;&#x624D;&#x80FD;&#x77E5;&#x9053;&#x6211;&#x4EEC;&#x5728;&#x4EC0;&#x4E48;&#x573A;&#x666F;&#x4E0B;&#xFF0C;&#x80FD;&#x505A;&#x4E9B;&#x4EC0;&#x4E48;&#x3002;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/d5ee0868eec0dfb9d5785cb4f1787267.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7348475959269916723.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7348475959269916723.html" itemprop="url">大文件上传的前后端实践：从分片到重组</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-03-21T10:46:33+08:00">
                2024-03-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x5728;&#x5B9E;&#x73B0;&#x5927;&#x6587;&#x4EF6;&#x4E0A;&#x4F20;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x8003;&#x8651;&#x7684;&#x4E0D;&#x4EC5;&#x4EC5;&#x662F;&#x5982;&#x4F55;&#x5C06;&#x6587;&#x4EF6;&#x4ECE;&#x5BA2;&#x6237;&#x7AEF;&#x4F20;&#x8F93;&#x5230;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x8FD8;&#x5305;&#x62EC;&#x5982;&#x4F55;&#x63D0;&#x9AD8;&#x4E0A;&#x4F20;&#x6548;&#x7387;&#x3001;&#x4FDD;&#x8BC1;&#x4E0A;&#x4F20;&#x8FC7;&#x7A0B;&#x7684;&#x53EF;&#x9760;&#x6027;&#x4EE5;&#x53CA;&#x5982;&#x4F55;&#x4F18;&#x5316;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#x3002;&#x4EE5;&#x4E0B;&#x662F;&#x5B9E;&#x73B0;&#x5927;&#x6587;&#x4EF6;&#x4E0A;&#x4F20;&#x65F6;&#x53EF;&#x4EE5;&#x91C7;&#x7528;&#x7684;&#x4E00;&#x4E9B;&#x7B56;&#x7565;&#x548C;&#x6280;&#x672F;&#x5B9E;&#x73B0;&#x3002;</p>
<ol>
<li>&#x6587;&#x4EF6;&#x5207;&#x7247;</li>
</ol>
<hr>
<p>&#x6587;&#x4EF6;&#x5207;&#x7247;&#x662F;&#x5904;&#x7406;&#x5927;&#x6587;&#x4EF6;&#x4E0A;&#x4F20;&#x7684;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x6709;&#x6548;&#x7684;&#x7B56;&#x7565;&#x3002;&#x901A;&#x8FC7;&#x5C06;&#x5927;&#x6587;&#x4EF6;&#x5206;&#x5272;&#x6210;&#x5C0F;&#x5757;&#xFF08;chunk&#xFF09;&#xFF0C;&#x53EF;&#x4EE5;&#x5E76;&#x884C;&#x4E0A;&#x4F20;&#x591A;&#x4E2A;&#x6587;&#x4EF6;&#x5757;&#xFF0C;&#x63D0;&#x9AD8;&#x4E0A;&#x4F20;&#x6548;&#x7387;&#x3002;&#x6B64;&#x5916;&#xFF0C;&#x5982;&#x679C;&#x67D0;&#x4E2A;&#x6587;&#x4EF6;&#x5757;&#x4E0A;&#x4F20;&#x5931;&#x8D25;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x4E0A;&#x4F20;&#x8BE5;&#x6587;&#x4EF6;&#x5757;&#xFF0C;&#x800C;&#x4E0D;&#x9700;&#x8981;&#x4ECE;&#x5934;&#x5F00;&#x59CB;&#x4E0A;&#x4F20;&#x6574;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x8FD9;&#x663E;&#x8457;&#x63D0;&#x9AD8;&#x4E86;&#x4E0A;&#x4F20;&#x7684;&#x53EF;&#x9760;&#x6027;&#x3002;</p>
<ul>
<li>&#x524D;&#x7AEF;&#x5B9E;&#x73B0;&#xFF1A;</li>
</ul>
<p>&#x4F7F;&#x7528;Blob.prototype.slice&#x65B9;&#x6CD5;&#x5C06;&#x6587;&#x4EF6;&#x5207;&#x5272;&#x6210;&#x591A;&#x4E2A;&#x5757;&#x3002;<br>&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x4E0A;&#x4F20;&#x961F;&#x5217;&#xFF0C;&#x6839;&#x636E;&#x7F51;&#x7EDC;&#x72B6;&#x51B5;&#x548C;&#x670D;&#x52A1;&#x5668;&#x7684;&#x627F;&#x8F7D;&#x80FD;&#x529B;&#xFF0C;&#x8C03;&#x6574;&#x5E76;&#x53D1;&#x4E0A;&#x4F20;&#x7684;&#x5757;&#x7684;&#x6570;&#x91CF;&#x3002;<br>&#x76D1;&#x542C;&#x6BCF;&#x4E2A;&#x5757;&#x7684;&#x4E0A;&#x4F20;&#x8FDB;&#x5EA6;&#xFF0C;&#x4EE5;&#x4FBF;&#x63D0;&#x4F9B;&#x7ED9;&#x7528;&#x6237;&#x5B9E;&#x65F6;&#x7684;&#x4E0A;&#x4F20;&#x53CD;&#x9988;&#x3002;</p>
<ul>
<li>&#x540E;&#x7AEF;&#x5B9E;&#x73B0;&#xFF1A;</li>
</ul>
<p>&#x63A5;&#x6536;&#x4E0A;&#x4F20;&#x7684;&#x6587;&#x4EF6;&#x5757;&#xFF0C;&#x5E76;&#x5728;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x4E34;&#x65F6;&#x5B58;&#x50A8;&#x3002;<br>&#x68C0;&#x67E5;&#x6240;&#x6709;&#x6587;&#x4EF6;&#x5757;&#x4E0A;&#x4F20;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x518D;&#x5C06;&#x8FD9;&#x4E9B;&#x5757;&#x5408;&#x5E76;&#x6210;&#x539F;&#x59CB;&#x6587;&#x4EF6;&#x3002;<br>&#x5B9E;&#x73B0;&#x673A;&#x5236;&#x4EE5;&#x5904;&#x7406;&#x53EF;&#x80FD;&#x7684;&#x91CD;&#x590D;&#x4E0A;&#x4F20;&#xFF0C;&#x4FDD;&#x8BC1;&#x6587;&#x4EF6;&#x7684;&#x5B8C;&#x6574;&#x6027;&#x3002;</p>
<ol start="2">
<li>&#x65AD;&#x70B9;&#x7EED;&#x4F20;</li>
</ol>
<hr>
<p>&#x5728;&#x6587;&#x4EF6;&#x5207;&#x7247;&#x7684;&#x57FA;&#x7840;&#x4E0A;&#xFF0C;&#x5B9E;&#x73B0;&#x65AD;&#x70B9;&#x7EED;&#x4F20;&#x80FD;&#x8FDB;&#x4E00;&#x6B65;&#x63D0;&#x9AD8;&#x4E0A;&#x4F20;&#x7684;&#x53EF;&#x9760;&#x6027;&#x3002;&#x5982;&#x679C;&#x4E0A;&#x4F20;&#x8FC7;&#x7A0B;&#x4E2D;&#x51FA;&#x73B0;&#x7F51;&#x7EDC;&#x65AD;&#x5F00;&#x7B49;&#x95EE;&#x9898;&#xFF0C;&#x53EF;&#x4EE5;&#x4ECE;&#x4E0A;&#x6B21;&#x4E0A;&#x4F20;&#x6210;&#x529F;&#x7684;&#x5730;&#x65B9;&#x7EE7;&#x7EED;&#x4E0A;&#x4F20;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x91CD;&#x65B0;&#x4E0A;&#x4F20;&#x6574;&#x4E2A;&#x6587;&#x4EF6;&#x3002;</p>
<ul>
<li>&#x524D;&#x7AEF;&#x5B9E;&#x73B0;&#xFF1A;</li>
</ul>
<p>&#x5728;&#x5F00;&#x59CB;&#x4E0A;&#x4F20;&#x524D;&#xFF0C;&#x67E5;&#x8BE2;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x4E86;&#x89E3;&#x54EA;&#x4E9B;&#x6587;&#x4EF6;&#x5757;&#x5DF2;&#x7ECF;&#x4E0A;&#x4F20;&#x6210;&#x529F;&#x3002;<br>&#x53EA;&#x4E0A;&#x4F20;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x4E0D;&#x5B58;&#x5728;&#x7684;&#x6587;&#x4EF6;&#x5757;&#x3002;<br>&#x5B9E;&#x73B0;&#x672C;&#x5730;&#x5B58;&#x50A8;&#x673A;&#x5236;&#xFF08;&#x5982;localStorage&#xFF09;&#xFF0C;&#x8BB0;&#x5F55;&#x4E0A;&#x4F20;&#x8FDB;&#x5EA6;&#xFF0C;&#x4EE5;&#x4FBF;&#x4E8E;&#x65AD;&#x70B9;&#x7EED;&#x4F20;&#x3002;</p>
<ul>
<li>&#x540E;&#x7AEF;&#x5B9E;&#x73B0;&#xFF1A;</li>
</ul>
<p>&#x5B9E;&#x73B0;&#x63A5;&#x53E3;&#x4EE5;&#x5141;&#x8BB8;&#x524D;&#x7AEF;&#x67E5;&#x8BE2;&#x5DF2;&#x4E0A;&#x4F20;&#x7684;&#x6587;&#x4EF6;&#x5757;&#x4FE1;&#x606F;&#x3002;<br>&#x5728;&#x6587;&#x4EF6;&#x5757;&#x4E0A;&#x4F20;&#x540E;&#xFF0C;&#x4FDD;&#x5B58;&#x5176;&#x72B6;&#x6001;&#xFF08;&#x5982;&#x5DF2;&#x4E0A;&#x4F20;&#x7684;&#x5757;&#x7684;&#x7D22;&#x5F15;&#xFF09;&#x3002;<br>&#x652F;&#x6301;&#x4ECE;&#x6307;&#x5B9A;&#x7684;&#x6587;&#x4EF6;&#x5757;&#x5F00;&#x59CB;&#x5408;&#x5E76;&#x6587;&#x4EF6;&#x3002;</p>
<ol start="3">
<li>&#x538B;&#x7F29;&#x4E0E;&#x4F18;&#x5316;</li>
</ol>
<hr>
<p>&#x5728;&#x4E0A;&#x4F20;&#x524D;&#x5BF9;&#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x538B;&#x7F29;&#xFF0C;&#x53EF;&#x4EE5;&#x51CF;&#x5C11;&#x9700;&#x8981;&#x4E0A;&#x4F20;&#x7684;&#x6570;&#x636E;&#x91CF;&#x3002;&#x5BF9;&#x4E8E;&#x7279;&#x5B9A;&#x7C7B;&#x578B;&#x7684;&#x6587;&#x4EF6;&#xFF08;&#x5982;&#x56FE;&#x7247;&#x3001;&#x89C6;&#x9891;&#xFF09;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x683C;&#x5F0F;&#x8F6C;&#x6362;&#x6216;&#x8D28;&#x91CF;&#x538B;&#x7F29;&#xFF0C;&#x4EE5;&#x8FDB;&#x4E00;&#x6B65;&#x51CF;&#x5C0F;&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#x3002;</p>
<ul>
<li>&#x524D;&#x7AEF;&#x5B9E;&#x73B0;&#xFF1A;</li>
</ul>
<p>&#x4F7F;&#x7528;JavaScript&#x5E93;&#xFF08;&#x5982;pako&#x7528;&#x4E8E;&#x6587;&#x672C;&#x538B;&#x7F29;&#xFF0C;ffmpeg.wasm&#x7528;&#x4E8E;&#x89C6;&#x9891;&#x5904;&#x7406;&#xFF09;&#x8FDB;&#x884C;&#x6587;&#x4EF6;&#x538B;&#x7F29;&#x6216;&#x683C;&#x5F0F;&#x8F6C;&#x6362;&#x3002;<br>&#x4F18;&#x5316;&#x6587;&#x4EF6;&#x538B;&#x7F29;&#x8FC7;&#x7A0B;&#xFF0C;&#x907F;&#x514D;&#x963B;&#x585E;UI&#x7EBF;&#x7A0B;&#xFF0C;&#x63D0;&#x9AD8;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#xFF08;&#x5982;&#x4F7F;&#x7528;Web Worker&#xFF09;&#x3002;</p>
<ul>
<li>&#x540E;&#x7AEF;&#x5B9E;&#x73B0;&#xFF1A;</li>
</ul>
<p>&#x5728;&#x6587;&#x4EF6;&#x4E0A;&#x4F20;&#x540E;&#xFF0C;&#x53EF;&#x5BF9;&#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x538B;&#x7F29;&#x6216;&#x683C;&#x5F0F;&#x8F6C;&#x6362;&#x3002;<br>&#x63D0;&#x4F9B;&#x914D;&#x7F6E;&#x9009;&#x9879;&#xFF0C;&#x8BA9;&#x7528;&#x6237;&#x9009;&#x62E9;&#x662F;&#x5426;&#x8FDB;&#x884C;&#x538B;&#x7F29;&#x53CA;&#x538B;&#x7F29;&#x7EA7;&#x522B;&#x3002;</p>
<ol start="4">
<li>&#x4F18;&#x5316;&#x7528;&#x6237;&#x4F53;&#x9A8C;</li>
</ol>
<hr>
<p>&#x4E0A;&#x4F20;&#x5927;&#x6587;&#x4EF6;&#x53EF;&#x80FD;&#x662F;&#x4E00;&#x4E2A;&#x65F6;&#x95F4;&#x8F83;&#x957F;&#x7684;&#x8FC7;&#x7A0B;&#xFF0C;&#x4F18;&#x5316;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#x662F;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#x3002;</p>
<p>&#x63D0;&#x4F9B;&#x5B9E;&#x65F6;&#x7684;&#x4E0A;&#x4F20;&#x8FDB;&#x5EA6;&#x53CD;&#x9988;&#x3002;<br>&#x5141;&#x8BB8;&#x7528;&#x6237;&#x6682;&#x505C;&#x3001;&#x7EE7;&#x7EED;&#x6216;&#x53D6;&#x6D88;&#x4E0A;&#x4F20;&#x3002;<br>&#x5728;&#x4E0A;&#x4F20;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x7ED9;&#x4E88;&#x660E;&#x786E;&#x7684;&#x53CD;&#x9988;&#x3002;</p>
<ol start="5">
<li>&#x5B89;&#x5168;&#x6027;&#x8003;&#x8651;</li>
</ol>
<hr>
<p>&#x4E0A;&#x4F20;&#x5927;&#x6587;&#x4EF6;&#x65F6;&#xFF0C;&#x8FD8;&#x9700;&#x8981;&#x8003;&#x8651;&#x5B89;&#x5168;&#x6027;&#x95EE;&#x9898;&#x3002;</p>
<ul>
<li>&#x5BF9;&#x4E0A;&#x4F20;&#x7684;&#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x5B89;&#x5168;&#x68C0;&#x67E5;&#xFF0C;&#x9632;&#x6B62;&#x6076;&#x610F;&#x8F6F;&#x4EF6;&#x6216;&#x75C5;&#x6BD2;&#x4E0A;&#x4F20;&#x3002;</li>
<li>&#x4F7F;&#x7528;HTTPS&#x7B49;&#x52A0;&#x5BC6;&#x534F;&#x8BAE;&#xFF0C;&#x4FDD;&#x8BC1;&#x6570;&#x636E;&#x5728;&#x4F20;&#x8F93;&#x8FC7;&#x7A0B;&#x4E2D;&#x7684;&#x5B89;&#x5168;&#x3002;</li>
<li>&#x5BF9;&#x6587;&#x4EF6;&#x4E0A;&#x4F20;&#x63A5;&#x53E3;&#x8FDB;&#x884C;&#x8BA4;&#x8BC1;&#x548C;&#x6388;&#x6743;&#xFF0C;&#x907F;&#x514D;&#x672A;&#x6388;&#x6743;&#x8BBF;&#x95EE;&#x3002;</li>
</ul>
<h2 id="&#x5B9E;&#x6218;&#xFF08;JS-JAVA&#xFF09;"><a href="#&#x5B9E;&#x6218;&#xFF08;JS-JAVA&#xFF09;" class="headerlink" title="&#x5B9E;&#x6218;&#xFF08;JS + JAVA&#xFF09;"></a>&#x5B9E;&#x6218;&#xFF08;JS + JAVA&#xFF09;</h2><h3 id="1-&#x524D;&#x7AEF;&#x5B9E;&#x73B0;"><a href="#1-&#x524D;&#x7AEF;&#x5B9E;&#x73B0;" class="headerlink" title="1. &#x524D;&#x7AEF;&#x5B9E;&#x73B0;"></a>1. &#x524D;&#x7AEF;&#x5B9E;&#x73B0;</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">js&#x590D;&#x5236;&#x4EE3;&#x7801;// &#x5047;&#x8BBE;&#x540E;&#x7AEF;&#x63D0;&#x4F9B;&#x4E86;&#x4EE5;&#x4E0B;API&#x63A5;&#x53E3;</span><br><span class="line">// 1. POST /upload/chunk &#x7528;&#x4E8E;&#x4E0A;&#x4F20;&#x6587;&#x4EF6;&#x5757;</span><br><span class="line">// 2. POST /upload/complete &#x7528;&#x4E8E;&#x901A;&#x77E5;&#x540E;&#x7AEF;&#x6240;&#x6709;&#x6587;&#x4EF6;&#x5757;&#x4E0A;&#x4F20;&#x5B8C;&#x6210;</span><br><span class="line">// 3. GET /upload/check &#x7528;&#x4E8E;&#x68C0;&#x67E5;&#x6587;&#x4EF6;&#x5757;&#x4E0A;&#x4F20;&#x72B6;&#x6001;&#xFF08;&#x652F;&#x6301;&#x65AD;&#x70B9;&#x7EED;&#x4F20;&#xFF09;</span><br><span class="line"> </span><br><span class="line">// HTML&#x9875;&#x9762;&#x4E2D;&#x9700;&#x6709;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x8F93;&#x5165;&lt;input type=&quot;file&quot; id=&quot;fileInput&quot;&gt;</span><br><span class="line">document.getElementById(&apos;fileInput&apos;).addEventListener(&apos;change&apos;, handleFileUpload);</span><br><span class="line"> </span><br><span class="line">async function handleFileUpload(event) {</span><br><span class="line">    const file = event.target.files[0];</span><br><span class="line">    if (!file) {</span><br><span class="line">        return;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    const CHUNK_SIZE = 5 * 1024 * 1024; // &#x6BCF;&#x4E2A;&#x6587;&#x4EF6;&#x5757;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x8FD9;&#x91CC;&#x8BBE;&#x4E3A;5MB</span><br><span class="line">    const chunkCount = Math.ceil(file.size / CHUNK_SIZE);</span><br><span class="line"> </span><br><span class="line">    for (let i = 0; i &lt; chunkCount; i++) {</span><br><span class="line">        const chunk = file.slice(i * CHUNK_SIZE, (i + 1) * CHUNK_SIZE);</span><br><span class="line">        const formData = new FormData();</span><br><span class="line">        formData.append(&apos;file&apos;, chunk);</span><br><span class="line">        formData.append(&apos;filename&apos;, file.name);</span><br><span class="line">        formData.append(&apos;chunkIndex&apos;, i);</span><br><span class="line">        formData.append(&apos;chunkCount&apos;, chunkCount);</span><br><span class="line"> </span><br><span class="line">        // &#x4E0A;&#x4F20;&#x524D;&#x68C0;&#x67E5;&#x6587;&#x4EF6;&#x5757;&#x662F;&#x5426;&#x5DF2;&#x4E0A;&#x4F20;</span><br><span class="line">        const { uploaded } = await checkChunkStatus(file.name, i);</span><br><span class="line">        if (!uploaded) {</span><br><span class="line">            // &#x663E;&#x793A;&#x8FDB;&#x5EA6;&#x4FE1;&#x606F;</span><br><span class="line">            const onProgress = (percentage) =&gt; {</span><br><span class="line">                console.log(`Chunk ${i + 1}/${chunkCount}: ${percentage}%`);</span><br><span class="line">            };</span><br><span class="line">            await uploadChunk(formData, onProgress); // &#x4E0A;&#x4F20;&#x6587;&#x4EF6;&#x5757;&#xFF0C;&#x76D1;&#x542C;&#x8FDB;&#x5EA6;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    // &#x6240;&#x6709;&#x5757;&#x4E0A;&#x4F20;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x901A;&#x77E5;&#x670D;&#x52A1;&#x5668;&#x5408;&#x5E76;&#x6587;&#x4EF6;</span><br><span class="line">    await notifyServerComplete(file.name, chunkCount);</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">// &#x68C0;&#x67E5;&#x6587;&#x4EF6;&#x5757;&#x4E0A;&#x4F20;&#x72B6;&#x6001;</span><br><span class="line">async function checkChunkStatus(filename, chunkIndex) {</span><br><span class="line">    const response = await fetch(`/upload/check?filename=${filename}&amp;chunkIndex=${chunkIndex}`);</span><br><span class="line">    return response.json();</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">// &#x4F7F;&#x7528;XMLHttpRequest&#x4EE5;&#x4FBF;&#x53EF;&#x4EE5;&#x76D1;&#x542C;&#x4E0A;&#x4F20;&#x8FDB;&#x5EA6;</span><br><span class="line">function uploadChunk(formData, onProgress) {</span><br><span class="line">    return new Promise((resolve, reject) =&gt; {</span><br><span class="line">        const xhr = new XMLHttpRequest();</span><br><span class="line">        xhr.open(&apos;POST&apos;, &apos;/upload/chunk&apos;);</span><br><span class="line"> </span><br><span class="line">        // &#x76D1;&#x542C;&#x4E0A;&#x4F20;&#x8FDB;&#x5EA6;&#x4E8B;&#x4EF6;</span><br><span class="line">        xhr.upload.onprogress = function (event) {</span><br><span class="line">            if (event.lengthComputable) {</span><br><span class="line">                const percentage = (event.loaded / event.total) * 100;</span><br><span class="line">                onProgress(Math.round(percentage));</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line"> </span><br><span class="line">        xhr.onload = function () {</span><br><span class="line">            if (xhr.status === 200) {</span><br><span class="line">                resolve();</span><br><span class="line">            } else {</span><br><span class="line">                reject(`Failed to upload chunk: ${xhr.statusText}`);</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line"> </span><br><span class="line">        xhr.onerror = function () {</span><br><span class="line">            reject(&apos;Failed to upload chunk due to a network error&apos;);</span><br><span class="line">        };</span><br><span class="line"> </span><br><span class="line">        xhr.send(formData);</span><br><span class="line">    });</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">// &#x901A;&#x77E5;&#x670D;&#x52A1;&#x5668;&#x6240;&#x6709;&#x6587;&#x4EF6;&#x5757;&#x4E0A;&#x4F20;&#x5B8C;&#x6210;</span><br><span class="line">async function notifyServerComplete(filename, chunkCount) {</span><br><span class="line">    await fetch(&apos;/upload/complete&apos;, {</span><br><span class="line">        method: &apos;POST&apos;,</span><br><span class="line">        body: JSON.stringify({ filename, chunkCount }),</span><br><span class="line">        headers: {</span><br><span class="line">            &apos;Content-Type&apos;: &apos;application/json&apos;,</span><br><span class="line">        },</span><br><span class="line">    });</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5728;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x4E2D;&#xFF0C;xhr.upload.onprogress &#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x5668;&#x88AB;&#x7528;&#x6765;&#x76D1;&#x542C;&#x6587;&#x4EF6;&#x4E0A;&#x4F20;&#x7684;&#x8FDB;&#x5EA6;&#x3002;&#x5F53;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#xFF08;&#x6216;&#x6587;&#x4EF6;&#x5757;&#xFF09;&#x6B63;&#x5728;&#x901A;&#x8FC7; XMLHttpRequest &#xFF08;xhr&#xFF09;&#x4E0A;&#x4F20;&#x5230;&#x670D;&#x52A1;&#x5668;&#x65F6;&#xFF0C;&#x8FD9;&#x4E2A;&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x5668;&#x4F1A;&#x88AB;&#x5468;&#x671F;&#x6027;&#x5730;&#x8C03;&#x7528;&#xFF0C;&#x63D0;&#x4F9B;&#x5173;&#x4E8E;&#x5F53;&#x524D;&#x4E0A;&#x4F20;&#x8FDB;&#x5EA6;&#x7684;&#x5B9E;&#x65F6;&#x4FE1;&#x606F;&#x3002;&#x5177;&#x4F53;&#x6765;&#x8BF4;&#xFF0C;event&#x3001;event.loaded &#x548C; event.total &#x8FD9;&#x51E0;&#x4E2A;&#x90E8;&#x5206;&#x626E;&#x6F14;&#x4E86;&#x5173;&#x952E;&#x7684;&#x89D2;&#x8272;&#xFF1A;</p>
<ul>
<li>event: &#x5728;&#x8FD9;&#x4E2A;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#xFF0C;event &#x662F;&#x4E00;&#x4E2A; ProgressEvent &#x5BF9;&#x8C61;&#xFF0C;&#x5B83;&#x63D0;&#x4F9B;&#x4E86;&#x5173;&#x4E8E;&#x6B63;&#x5728;&#x8FDB;&#x884C;&#x7684;&#x6587;&#x4EF6;&#x4E0A;&#x4F20;&#x8FDB;&#x5EA6;&#x7684;&#x4FE1;&#x606F;&#x3002;&#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;&#x5305;&#x542B;&#x4E86;&#x591A;&#x4E2A;&#x5C5E;&#x6027;&#xFF0C;&#x5176;&#x4E2D; loaded &#x548C; total &#x662F;&#x6211;&#x4EEC;&#x7279;&#x522B;&#x5173;&#x5FC3;&#x7684;&#x3002;</li>
<li>event.loaded: &#x8FD9;&#x4E2A;&#x5C5E;&#x6027;&#x8868;&#x793A;&#x5230;&#x76EE;&#x524D;&#x4E3A;&#x6B62;&#x5DF2;&#x7ECF;&#x4E0A;&#x4F20;&#x7684;&#x5B57;&#x8282;&#x6570;&#x3002;&#x6BCF;&#x6B21; onprogress &#x4E8B;&#x4EF6;&#x88AB;&#x89E6;&#x53D1;&#x65F6;&#xFF0C;event.loaded &#x4F1A;&#x66F4;&#x65B0;&#xFF0C;&#x4EE5;&#x53CD;&#x6620;&#x5DF2;&#x4E0A;&#x4F20;&#x7684;&#x6570;&#x636E;&#x91CF;&#x3002;</li>
<li>event.total: &#x8FD9;&#x4E2A;&#x5C5E;&#x6027;&#x8868;&#x793A;&#x6574;&#x4E2A;&#x4E0A;&#x4F20;&#x4EFB;&#x52A1;&#x7684;&#x603B;&#x5B57;&#x8282;&#x6570;&#x3002;&#x5728;&#x6587;&#x4EF6;&#x4E0A;&#x4F20;&#x7684;&#x573A;&#x666F;&#x4E2D;&#xFF0C;&#x8FD9;&#x901A;&#x5E38;&#x662F;&#x5F53;&#x524D;&#x6B63;&#x5728;&#x4E0A;&#x4F20;&#x7684;&#x6587;&#x4EF6;&#xFF08;&#x6216;&#x6587;&#x4EF6;&#x5757;&#xFF09;&#x7684;&#x603B;&#x5927;&#x5C0F;&#x3002;event.total &#x7684;&#x503C;&#x5728;&#x6574;&#x4E2A;&#x4E0A;&#x4F20;&#x8FC7;&#x7A0B;&#x4E2D;&#x4FDD;&#x6301;&#x4E0D;&#x53D8;&#x3002;<br>&#x901A;&#x8FC7; event.loaded &#x548C; event.total&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8BA1;&#x7B97;&#x51FA;&#x5F53;&#x524D;&#x4E0A;&#x4F20;&#x8FDB;&#x5EA6;&#x7684;&#x767E;&#x5206;&#x6BD4;&#xFF1A;</li>
</ul>
<p><code>const percentage = (event.loaded / event.total) * 100;</code><br>&#x8FD9;&#x91CC;&#xFF0C;&#x6211;&#x4EEC;&#x9996;&#x5148;&#x8BA1;&#x7B97; <code>event.loaded</code> &#x9664;&#x4EE5; <code>event.total</code> &#x7684;&#x503C;&#xFF0C;&#x8FD9;&#x4E2A;&#x6BD4;&#x503C;&#x4EE3;&#x8868;&#x4E86;&#x4E0A;&#x4F20;&#x8FDB;&#x5EA6;&#x7684;&#x5C0F;&#x6570;&#x5F62;&#x5F0F;&#xFF08;&#x4F8B;&#x5982;&#xFF0C;0.5 &#x8868;&#x793A;&#x4E0A;&#x4F20;&#x4E86;50%&#xFF09;&#x3002;&#x7136;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x8FD9;&#x4E2A;&#x5C0F;&#x6570;&#x4E58;&#x4EE5;100&#xFF0C;&#x5F97;&#x5230;&#x4E00;&#x4E2A;&#x767E;&#x5206;&#x6BD4;&#x503C;&#x3002;&#x4F7F;&#x7528; Math.round(percentage) &#x53EF;&#x4EE5;&#x5C06;&#x8FD9;&#x4E2A;&#x767E;&#x5206;&#x6BD4;&#x503C;&#x56DB;&#x820D;&#x4E94;&#x5165;&#x5230;&#x6700;&#x63A5;&#x8FD1;&#x7684;&#x6574;&#x6570;&#xFF0C;&#x4EE5;&#x4FBF;&#x4E8E;&#x66F4;&#x52A0;&#x4EBA;&#x6027;&#x5316;&#x5730;&#x5C55;&#x793A;&#x4E0A;&#x4F20;&#x8FDB;&#x5EA6;&#xFF08;&#x6BD4;&#x5982;&#x5728;&#x8FDB;&#x5EA6;&#x6761;&#x6216;&#x8FDB;&#x5EA6;&#x63D0;&#x793A;&#x4E2D;&#xFF09;&#x3002;</p>
<p>&#x6B64;&#x5916;&#xFF0C;if (event.lengthComputable) &#x8FD9;&#x4E2A;&#x6761;&#x4EF6;&#x68C0;&#x67E5;&#x786E;&#x4FDD;&#x4E86;&#x53EA;&#x6709;&#x5F53;&#x4E0A;&#x4F20;&#x8FDB;&#x5EA6;&#x7684;&#x4FE1;&#x606F;&#x662F;&#x53EF;&#x8BA1;&#x7B97;&#x7684;&#xFF08;&#x5373; event.total &#x5DF2;&#x77E5;&#xFF09;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x624D;&#x8BA1;&#x7B97;&#x548C;&#x5C55;&#x793A;&#x8FDB;&#x5EA6;&#x767E;&#x5206;&#x6BD4;&#x3002;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x597D;&#x4E60;&#x60EF;&#xFF0C;&#x56E0;&#x4E3A;&#x5728;&#x67D0;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x53EF;&#x80FD;&#x65E0;&#x6CD5;&#x9884;&#x5148;&#x77E5;&#x9053;&#x603B;&#x7684;&#x4E0A;&#x4F20;&#x5927;&#x5C0F;&#xFF0C;&#x5BFC;&#x81F4;&#x8FDB;&#x5EA6;&#x4FE1;&#x606F;&#x4E0D;&#x53EF;&#x7528;&#x3002;</p>
<h3 id="2-&#x540E;&#x7AEF;&#x5B9E;&#x73B0;"><a href="#2-&#x540E;&#x7AEF;&#x5B9E;&#x73B0;" class="headerlink" title="2. &#x540E;&#x7AEF;&#x5B9E;&#x73B0;"></a>2. &#x540E;&#x7AEF;&#x5B9E;&#x73B0;</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;import org.springframework.http.HttpStatus;</span><br><span class="line">import org.springframework.http.ResponseEntity;</span><br><span class="line">import org.springframework.web.bind.annotation.*;</span><br><span class="line">import org.springframework.web.multipart.MultipartFile;</span><br><span class="line"> </span><br><span class="line">import java.io.*;</span><br><span class="line">import java.nio.file.Files;</span><br><span class="line">import java.nio.file.Paths;</span><br><span class="line">import java.util.Collections;</span><br><span class="line"> </span><br><span class="line">@RestController</span><br><span class="line">public class FileUploadController {</span><br><span class="line"> </span><br><span class="line">    private static final String UPLOAD_DIR = &quot;/path/to/upload/dir&quot;;</span><br><span class="line"> </span><br><span class="line">    @PostMapping(&quot;/upload/chunk&quot;)</span><br><span class="line">    public ResponseEntity&lt;?&gt; uploadChunk(@RequestParam(&quot;file&quot;) MultipartFile file,</span><br><span class="line">                                         @RequestParam(&quot;filename&quot;) String filename,</span><br><span class="line">                                         @RequestParam(&quot;chunkIndex&quot;) int chunkIndex,</span><br><span class="line">                                         @RequestParam(&quot;chunkCount&quot;) int chunkCount) {</span><br><span class="line">        // &#x5B58;&#x50A8;&#x4E0A;&#x4F20;&#x7684;&#x6587;&#x4EF6;&#x5757;</span><br><span class="line">        File chunkFile = new File(UPLOAD_DIR, filename + &quot;-&quot; + chunkIndex);</span><br><span class="line">        try {</span><br><span class="line">            file.transferTo(chunkFile);</span><br><span class="line">        } catch (IOException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build();</span><br><span class="line">        }</span><br><span class="line">        return ResponseEntity.ok().build();</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    @GetMapping(&quot;/upload/check&quot;)</span><br><span class="line">    public ResponseEntity&lt;?&gt; checkChunkStatus(@RequestParam(&quot;filename&quot;) String filename,</span><br><span class="line">                                              @RequestParam(&quot;chunkIndex&quot;) int chunkIndex) {</span><br><span class="line">        File chunkFile = new File(UPLOAD_DIR, filename + &quot;-&quot; + chunkIndex);</span><br><span class="line">        boolean uploaded = chunkFile.exists();</span><br><span class="line">        return ResponseEntity.ok(Collections.singletonMap(&quot;uploaded&quot;, uploaded));</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    @PostMapping(&quot;/upload/complete&quot;)</span><br><span class="line">    public ResponseEntity&lt;?&gt; completeUpload(@RequestBody CompleteUploadRequest request) {</span><br><span class="line">        // &#x5408;&#x5E76;&#x6587;&#x4EF6;&#x5757;</span><br><span class="line">        try {</span><br><span class="line">            mergeChunks(request.filename, request.chunkCount);</span><br><span class="line">        } catch (IOException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build();</span><br><span class="line">        }</span><br><span class="line">        return ResponseEntity.ok().build();</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    private void mergeChunks(String filename, int chunkCount) throws IOException {</span><br><span class="line">        File outputFile = new File(UPLOAD_DIR, filename);</span><br><span class="line">        try (OutputStream mergeFile = new BufferedOutputStream(new FileOutputStream(outputFile))) {</span><br><span class="line">            byte[] buffer = new byte[1024];</span><br><span class="line">            for (int i = 0; i &lt; chunkCount; i++) {</span><br><span class="line">                File chunkFile = new File(UPLOAD_DIR, filename + &quot;-&quot; + i);</span><br><span class="line">                try (InputStream chunkFileStream = new BufferedInputStream(new FileInputStream(chunkFile))) {</span><br><span class="line">                    int bytesRead;</span><br><span class="line">                    while ((bytesRead = chunkFileStream.read(buffer)) &gt; 0) {</span><br><span class="line">                        mergeFile.write(buffer, 0, bytesRead);</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">                Files.deleteIfExists(chunkFile.toPath()); // &#x5220;&#x9664;&#x5904;&#x7406;&#x8FC7;&#x7684;&#x6587;&#x4EF6;&#x5757;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    static class CompleteUploadRequest {</span><br><span class="line">        public String filename;</span><br><span class="line">        public int chunkCount;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h2 id="&#x603B;&#x7ED3;"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3;</h2><p>&#x5B9E;&#x73B0;&#x5927;&#x6587;&#x4EF6;&#x4E0A;&#x4F20;&#x662F;&#x4E00;&#x4E2A;&#x7EFC;&#x5408;&#x6027;&#x7684;&#x5DE5;&#x7A0B;&#xFF0C;&#x6D89;&#x53CA;&#x5230;&#x524D;&#x7AEF;&#x7684;&#x6587;&#x4EF6;&#x5904;&#x7406;&#x3001;&#x7F51;&#x7EDC;&#x4F20;&#x8F93;&#x4F18;&#x5316;&#xFF0C;&#x4EE5;&#x53CA;&#x540E;&#x7AEF;&#x7684;&#x6587;&#x4EF6;&#x63A5;&#x6536;&#x3001;&#x5B58;&#x50A8;&#x548C;&#x5B89;&#x5168;&#x5904;&#x7406;&#x7B49;&#x591A;&#x4E2A;&#x65B9;&#x9762;&#x3002;&#x901A;&#x8FC7;&#x6587;&#x4EF6;&#x5207;&#x7247;&#x3001;&#x65AD;&#x70B9;&#x7EED;&#x4F20;&#x3001;&#x6587;&#x4EF6;&#x538B;&#x7F29;&#x4EE5;&#x53CA;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#x7684;&#x4F18;&#x5316;&#xFF0C;&#x53EF;&#x4EE5;&#x6709;&#x6548;&#x5730;&#x63D0;&#x9AD8;&#x5927;&#x6587;&#x4EF6;&#x4E0A;&#x4F20;&#x7684;&#x6548;&#x7387;&#x548C;&#x53EF;&#x9760;&#x6027;&#xFF0C;&#x4E3A;&#x7528;&#x6237;&#x63D0;&#x4F9B;&#x66F4;&#x52A0;&#x6D41;&#x7545;&#x548C;&#x53CB;&#x597D;&#x7684;&#x4E0A;&#x4F20;&#x4F53;&#x9A8C;&#x3002;&#x540C;&#x65F6;&#xFF0C;&#x5B89;&#x5168;&#x6027;&#x63AA;&#x65BD;&#x4E5F;&#x4E0D;&#x53EF;&#x5FFD;&#x89C6;&#xFF0C;&#x4EE5;&#x4FDD;&#x8BC1;&#x6574;&#x4E2A;&#x4E0A;&#x4F20;&#x8FC7;&#x7A0B;&#x7684;&#x5B89;&#x5168;&#x53EF;&#x9760;&#x3002;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/ec7aabb8865945920c196b28e76ee5b6.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7347911786803789876.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7347911786803789876.html" itemprop="url">全网首发 探秘Flutter UI测试-Golden Tes</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-03-19T15:26:15+08:00">
                2024-03-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/c9acd77e5941871e83d9d6004c2fb8a3162c680288b08419523e0efebdda8092" alt="image.png"></p>
<h1 id="&#x524D;&#x8A00;"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00;</h1><p>UI&#x6D4B;&#x8BD5;&#x5206;&#x4E3A;&#x4E24;&#x79CD;&#x7C7B;&#x578B;&#xFF1A;&#x884C;&#x4E3A;&#x6D4B;&#x8BD5;&#x548C;&#x89C6;&#x89C9;&#x6D4B;&#x8BD5;&#x3002;&#x884C;&#x4E3A;&#x6D4B;&#x8BD5;&#x4E3B;&#x8981;&#x5173;&#x6CE8;&#x7528;&#x6237;&#x5728;&#x64CD;&#x4F5C;UI&#x7EC4;&#x4EF6;&#x65F6;&#xFF0C;UI&#x7684;&#x53D8;&#x5316;&#x662F;&#x5426;&#x6B63;&#x786E;&#x3002;&#x800C;&#x89C6;&#x89C9;&#x6D4B;&#x8BD5;&#x5219;&#x7740;&#x91CD;&#x4E8E;&#x9A8C;&#x8BC1;UI&#x7684;&#x5916;&#x89C2;&#x662F;&#x5426;&#x7B26;&#x5408;&#x9884;&#x671F;&#x3002;&#x901A;&#x8FC7;&#x6BD4;&#x8F83;&#x5E94;&#x7528;&#x7684;&#x5B9E;&#x9645;&#x622A;&#x56FE;&#x4E0E;&#x9884;&#x671F;&#x7ED3;&#x679C;&#xFF0C;&#x89C6;&#x89C9;&#x6D4B;&#x8BD5;&#x80FD;&#x591F;&#x786E;&#x4FDD;UI&#x5728;&#x4E0D;&#x540C;&#x5E73;&#x53F0;&#x3001;&#x4E0D;&#x540C;&#x8BBE;&#x5907;&#x4E0A;&#x7684;&#x4E00;&#x81F4;&#x6027;&#x548C;&#x7F8E;&#x89C2;&#x6027;&#x3002;</p>
<p>&#x5728;&#x5B9E;&#x9645;&#x9879;&#x76EE;&#x5F00;&#x53D1;&#x4E2D;&#xFF0C;&#x7ECF;&#x5E38;&#x4F1A;&#x5BF9;&#x73B0;&#x6709;&#x7684;UI&#x8FDB;&#x884C;&#x529F;&#x80FD;&#x6269;&#x5C55;&#x6216;&#x4FEE;&#x6539;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5728;&#x6D88;&#x606F;&#x901A;&#x77E5;&#x6309;&#x94AE;&#x4E0A;&#x6DFB;&#x52A0;&#x7EA2;&#x70B9;&#x63D0;&#x793A;&#x529F;&#x80FD;&#x3002;&#x8FD9;&#x79CD;&#x6539;&#x52A8;&#x53EF;&#x80FD;&#x4F1A;&#x5BFC;&#x81F4;&#x539F;&#x6709;&#x7684;UI&#x51FA;&#x73B0;&#x95EE;&#x9898;&#xFF0C;&#x6BD4;&#x5982;&#x95F4;&#x8DDD;&#x4E0D;&#x4E00;&#x81F4;&#x6216;&#x5B57;&#x4F53;&#x5927;&#x5C0F;&#x4E0D;&#x5BF9;&#x7B49;&#x3002;&#x800C;&#x9A8C;&#x8BC1;&#x662F;&#x5426;&#x51FA;&#x73B0;&#x8BE5;&#x95EE;&#x9898;&#x9700;&#x8981;&#x4E0D;&#x5C11;&#x7684;&#x6210;&#x672C;&#xFF0C;&#x5982;&#x679C;&#x53EA;&#x662F;&#x7EC6;&#x5C0F;&#x7684;&#x5DEE;&#x522B;&#xFF0C;&#x5982;2&#xFF0C;3&#x4E2A;&#x50CF;&#x7D20;&#x7684;&#x5DEE;&#x522B;&#xFF0C;&#x90A3;&#x8089;&#x773C;&#x5F88;&#x96BE;&#x9274;&#x522B;&#x3002;&#x8FD9;&#x65F6;&#x5C31;&#x9700;&#x8981;Golden test&#x4E86;&#x3002;Golden Test&#x6B63;&#x662F;&#x4E00;&#x79CD;&#x89C6;&#x89C9;&#x6D4B;&#x8BD5;&#x5DE5;&#x5177;&#xFF0C;&#x5B83;&#x80FD;&#x591F;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x786E;&#x8BA4;&#x65B0;&#x529F;&#x80FD;&#x7684;&#x5F15;&#x5165;&#x662F;&#x5426;&#x5F71;&#x54CD;&#x4E86;UI&#x7684;&#x6574;&#x4F53;&#x5916;&#x89C2;&#xFF0C;&#x4ECE;&#x800C;&#x786E;&#x4FDD;&#x5E94;&#x7528;&#x7684;&#x8D28;&#x91CF;&#x548C;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#x3002;</p>
<h1 id="&#x4EC0;&#x4E48;&#x662F;Golden-Test"><a href="#&#x4EC0;&#x4E48;&#x662F;Golden-Test" class="headerlink" title="&#x4EC0;&#x4E48;&#x662F;Golden Test"></a>&#x4EC0;&#x4E48;&#x662F;Golden Test</h1><p><code>Golden Test</code> &#x662F;&#x4E00;&#x79CD;&#x901A;&#x8FC7;&#x6BD4;&#x8F83;&#x56FE;&#x7247;&#x6765;&#x6D4B;&#x8BD5; UI &#x7684;&#x6280;&#x672F;&#x3002;&#x5B83;&#x9996;&#x5148;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x6807;&#x51C6;&#x56FE;&#x7247;&#xFF0C;&#x8868;&#x793A; UI &#x6B63;&#x786E;&#x72B6;&#x6001;&#x3002;&#x7136;&#x540E;&#xFF0C;&#x5F53;&#x5F00;&#x53D1;&#x8005;&#x5BF9; UI &#x8FDB;&#x884C;&#x4FEE;&#x6539;&#x65F6;&#xFF0C;<code>Golden Test</code> &#x4F1A;&#x81EA;&#x52A8;&#x6355;&#x83B7;&#x65B0;&#x7684; UI &#x72B6;&#x6001;&#xFF0C;&#x5E76;&#x4E0E;&#x6807;&#x51C6;&#x56FE;&#x7247;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#x3002;&#x901A;&#x8FC7;&#x6BD4;&#x8F83;&#x8FD9;&#x4E24;&#x5F20;&#x56FE;&#x7247;&#xFF0C;<code>Golden Test</code> &#x53EF;&#x4EE5;&#x53D1;&#x73B0; UI &#x7684;&#x53D8;&#x5316;&#xFF0C;&#x5E76;&#x751F;&#x6210;&#x6D4B;&#x8BD5;&#x62A5;&#x544A;&#x3002;&#x56E0;&#x6B64;&#xFF0C;<code>Golden Test</code> &#x4E5F;&#x88AB;&#x79F0;&#x4E3A;&#x5FEB;&#x7167;&#x6D4B;&#x8BD5;&#xFF0C;&#x5B83;&#x4EE5;&#x50CF;&#x7D20;&#x7EA7;&#x522B;&#x7684;&#x51C6;&#x786E;&#x6027;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#xFF0C;&#x5373;&#x4F7F;&#x662F;&#x5FAE;&#x5C0F;&#x7684;&#x50CF;&#x7D20;&#x5DEE;&#x5F02;&#x4E5F;&#x80FD;&#x88AB;&#x6355;&#x6349;&#x5230;&#x3002;&#x8FD9;&#x4F7F;&#x5F97; <code>Golden Test</code> &#x5728;&#x89C6;&#x89C9;&#x6D4B;&#x8BD5;&#x65B9;&#x9762;&#x975E;&#x5E38;&#x53EF;&#x9760;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x53EF;&#x4EE5;&#x653E;&#x5FC3;&#x5730;&#x4F7F;&#x7528;&#x5B83;&#x6765;&#x786E;&#x4FDD;&#x5E94;&#x7528;&#x5728;&#x4E0D;&#x540C;&#x60C5;&#x51B5;&#x4E0B;&#x7684;&#x4E00;&#x81F4;&#x6027;&#x548C;&#x7F8E;&#x89C2;&#x6027;&#x3002;</p>
<p>Golden Test &#x5728;&#x8BB8;&#x591A;&#x5E73;&#x53F0;&#x4E2D;&#x90FD;&#x6709;&#x5BF9;&#x5E94;&#x7684;&#x5DE5;&#x5177;&#xFF0C;&#x5982;Android&#x4E2D;&#x6709;<a href="/external_links/9dac3328e533afe44800c07aa8ca7058.html" target="blank" rel="noopener"><code>Paparazzi</code></a>&#xFF0C;IOS&#x4E2D;&#x6709;<a href="/external_links/067e511f1acca3fee4bd3a6065d164c1.html" target="blank" rel="noopener"><code>SnapshotTesting</code></a>, Web&#x4E2D;&#x6709;<a href="/external_links/86d4cdb4a398844c57a3afa0279373b8.html" target="blank" rel="noopener"><code>snapshot-diff</code></a> &#x7B49;&#xFF0C;&#x4E0D;&#x8FC7;&#x5B83;&#x4EEC;&#x5927;&#x90E8;&#x5206;&#x90FD;&#x4E0D;&#x662F;&#x5E73;&#x53F0;&#x5B98;&#x65B9;&#x7684;&#x5DE5;&#x5177;&#x800C;&#x662F;&#x4EE5;&#x7B2C;&#x4E09;&#x65B9;&#x5E93;&#x7684;&#x5F62;&#x5F0F;&#x5B58;&#x5728;&#x3002;&#x800C;Flutter&#x662F;&#x5C11;&#x6709;&#x7684;&#x63D0;&#x4F9B;&#x4E86;<code>Golden Test</code>&#x5B98;&#x65B9;&#x652F;&#x6301;&#x7684;&#x5E73;&#x53F0;&#x3002;&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x5C06;&#x8BB2;&#x8FF0;&#x5982;&#x4F55;&#x5728;flutter&#x4E2D;&#x4F7F;&#x7528;<code>Golden Test</code></p>
<h1 id="&#x5982;&#x4F55;&#x4F7F;&#x7528;Golden-test"><a href="#&#x5982;&#x4F55;&#x4F7F;&#x7528;Golden-test" class="headerlink" title="&#x5982;&#x4F55;&#x4F7F;&#x7528;Golden test"></a>&#x5982;&#x4F55;&#x4F7F;&#x7528;Golden test</h1><p>&#x5728;Flutter &#x9879;&#x76EE;&#x4E2D;&#x7684;test&#x6587;&#x4EF6;&#x5939;&#x91CC;&#xFF0C;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;<code>golden_widget_test.dart</code>&#x7684;&#x4EE3;&#x7801;&#x6587;&#x4EF6;&#x3002;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dart&#x590D;&#x5236;&#x4EE3;&#x7801;void main() {</span><br><span class="line">  testWidgets(&apos;Golden test&apos;, (WidgetTester tester) async {</span><br><span class="line">    await tester.pumpWidget(MyApp());</span><br><span class="line">    await expectLater(find.byType(MyApp),</span><br><span class="line">                      matchesGoldenFile(&apos;circle_button.png&apos;));</span><br><span class="line">  });</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x6B63;&#x5982;&#x4F60;&#x6240;&#x770B;&#x5230;&#x7684;&#xFF0C;&#x6211;&#x901A;&#x8FC7;<code>tester.pumpWidget</code>&#x65B9;&#x6CD5;&#x6E32;&#x67D3;&#x4E00;&#x4E2A;My App widget &#xFF0C;&#x8BE5;widget&#x5305;&#x542B;<code>CircleButton</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dart&#x590D;&#x5236;&#x4EE3;&#x7801;await tester.pumpWidget(MyApp());</span><br></pre></td></tr></table></figure>

<p>&#x7136;&#x540E;<code>expectLater</code> &#x9A8C;&#x8BC1;&#x8BE5;widget&#x662F;&#x5426;&#x4E0E;&#x57FA;&#x51C6;&#x56FE;&#x7247;&#xFF08;main.png&#xFF09;&#x4E00;&#x81F4;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dart&#x590D;&#x5236;&#x4EE3;&#x7801;    await expectLater(find.byType(MyApp),</span><br><span class="line">                      matchesGoldenFile(&apos;circle_button.png&apos;));</span><br></pre></td></tr></table></figure>

<p>&#x4E00;&#x5F00;&#x59CB;&#x6211;&#x4EEC;&#x5E76;&#x6CA1;&#x6709;&#x57FA;&#x51C6;&#x56FE;&#x7247;&#xFF0C;&#x6240;&#x4EE5;&#x5047;&#x5B9A;&#x5F53;&#x524D;Widget&#x7684;UI&#x662F;&#x6B63;&#x786E;&#x7684;&#xFF0C;&#x5373;&#x901A;&#x8FC7;UI&#x8BBE;&#x8BA1;&#x5E08;&#x9A8C;&#x8BC1;&#x8FC7;&#x7684;&#xFF0C;&#x5219;&#x901A;&#x8FC7;&#x8FD0;&#x884C;&#x8BE5;&#x547D;&#x4EE4;&#xFF0C;&#x751F;&#x6210;&#x57FA;&#x51C6;&#x56FE;&#x7247;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&#x590D;&#x5236;&#x4EE3;&#x7801;flutter test --update-goldens</span><br></pre></td></tr></table></figure>

<p>&#x8FD0;&#x884C;&#x8BE5;&#x547D;&#x4EE4;&#x540E;&#xFF0C;<code>test</code>&#x6587;&#x4EF6;&#x5939;&#x51FA;&#x73B0;&#x4E86;<code>circle_button.png</code> &#xFF0C;&#x8FD9;&#x5C31;&#x662F;&#x57FA;&#x51C6;&#x56FE;&#x7247;&#x3002;&#x4E0D;&#x8FC7;&#x8FD9;&#x57FA;&#x51C6;&#x56FE;&#x7247;&#x4F3C;&#x4E4E;&#x4E0D;&#x592A;&#x5BF9;&#xFF0C;&#x5BF9;&#x6BD4;&#x8FD0;&#x884C;&#x5728;&#x771F;&#x673A;&#x4E0A;&#x6309;&#x94AE;&#x7684;&#x5B57;&#x4F53;&#x53D8;&#x6210;&#x4E86;&#x77E9;&#x5F62;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/692759a91b982822a166dcabe072362177e1f4bbe83f1fde058d67499b185ff8" alt="image.png"></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/5fc8924ba7ae247efb1347a154f858e19658e056661c48d34baab5c9e9a200d8" alt="image.png"></p>
<p>circle_button.png</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/7c468d44fcf076a293c62ba50919ec5f8ee3409c1d938dda97bbd77a06e3e5fa" alt></p>
<p>&#x771F;&#x673A;&#x8FD0;&#x884C;&#x56FE;&#x7247;</p>
<p>&#x51FA;&#x73B0;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x7684;&#x539F;&#x56E0;&#x662F;&#x4E0D;&#x540C;&#x7684;&#x8BBE;&#x5907;&#x4E0A;&#x8FD0;&#x884C;&#x7684;&#x5B57;&#x4F53;&#x90FD;&#x662F;&#x4E0D;&#x540C;&#x7684;&#xFF0C;&#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;<code>Golden Test</code>&#x5728;&#x4E0D;&#x540C;&#x7684;&#x8BBE;&#x5907;&#x4E0A;&#x8FD0;&#x884C;&#x65F6;&#x751F;&#x6210;&#x7684;&#x56FE;&#x7247;&#x4E00;&#x81F4;&#xFF0C;&#x6240;&#x4EE5;&#x5C06;&#x5B57;&#x4F53;&#x90FD;&#x6E32;&#x67D3;&#x6210;&#x4E86;&#x77E9;&#x5F62;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x5C31;&#x65E0;&#x6CD5;&#x901A;&#x8FC7;&#x67E5;&#x770B;&#x56FE;&#x7247;&#x6765;&#x9A8C;&#x8BC1;UI&#x663E;&#x793A;&#x662F;&#x5426;&#x7B26;&#x5408;&#x9884;&#x671F;&#x4E86;&#xFF0C;&#x800C;&#x4E14;&#x5728;&#x8FD0;&#x884C;&#x5728;<code>Ci/Cd</code>&#x673A;&#x5B50;&#x7684;&#x8BBE;&#x5907;&#x57FA;&#x672C;&#x90FD;&#x662F;&#x7EDF;&#x4E00;&#x7684;&#x3002;&#x6240;&#x4EE5;&#x5E76;&#x4E0D;&#x9700;&#x8981;&#x5C06;&#x6B64;&#x6E32;&#x67D3;&#x6210;&#x77E9;&#x5F62;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x6211;&#x901A;&#x8FC7;&#x5F15;&#x5165;&#x4E09;&#x65B9;&#x5E93;<a href="/external_links/1b9dbdc4dced2a1bedffd4f5480e2ab3.html" target="blank" rel="noopener"><code>golden_toolkit</code></a>&#x6765;&#x89E3;&#x51B3;&#x6B64;&#x95EE;&#x9898;&#x3002;<a href="/external_links/1b9dbdc4dced2a1bedffd4f5480e2ab3.html" target="blank" rel="noopener"><code>golden_toolkit</code></a>&#x4E5F;&#x80FD;&#x5E2E;&#x52A9;&#x5F00;&#x53D1;&#x8005;&#x66F4;&#x52A0;&#x6613;&#x4E8E;&#x7F16;&#x5199;<code>Golden Test</code>&#x3002;&#x5B83;&#x7684;&#x4F18;&#x52BF;&#x8FD9;&#x91CC;&#x4E0D;&#x4F5C;&#x8FC7;&#x591A;&#x8D58;&#x8FF0;&#x3002;</p>
<p>&#x5F15;&#x5165;<a href="/external_links/1b9dbdc4dced2a1bedffd4f5480e2ab3.html" target="blank" rel="noopener"><code>golden_toolkit</code></a>&#x540E;&#xFF0C;test&#x6587;&#x4EF6;&#x5939;&#x4E0B;&#x65B0;&#x5EFA;<code>flutter_test_config.dart</code> &#x3002;&#x6587;&#x4EF6;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">dart&#x590D;&#x5236;&#x4EE3;&#x7801;import &apos;dart:async&apos;;</span><br><span class="line">import &apos;dart:io&apos;;</span><br><span class="line"></span><br><span class="line">import &apos;package:golden_toolkit/golden_toolkit.dart&apos;;</span><br><span class="line"></span><br><span class="line">Future&lt;void&gt; testExecutable(FutureOr&lt;void&gt; Function() testMain) async {</span><br><span class="line">  return GoldenToolkit.runWithConfiguration(</span><br><span class="line">    () async {</span><br><span class="line">      await loadAppFonts();</span><br><span class="line">      await testMain();</span><br><span class="line">    },</span><br><span class="line">    config: GoldenToolkitConfiguration(</span><br><span class="line">      // Currently, goldens are not generated/validated in CI for this repo. We have settled on the goldens for this package</span><br><span class="line">      // being captured/validated by developers running on MacOSX. We may revisit this in the future if there is a reason to invest</span><br><span class="line">      // in more sophistication</span><br><span class="line">      skipGoldenAssertion: () =&gt; !Platform.isMacOS,</span><br><span class="line">    ),</span><br><span class="line">  );</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x7136;&#x540E;&#x4E0B;&#x8F7D;&#x7B2C;&#x4E09;&#x65B9;&#x5B57;&#x4F53;&#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x5BFC;&#x5165;&#xFF0C;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;<a href="/external_links/1b9dbdc4dced2a1bedffd4f5480e2ab3.html" target="blank" rel="noopener"><code>golden_toolkit</code></a>&#x81EA;&#x5E26;&#x7684;&#x5B57;&#x4F53;&#x53EA;&#x652F;&#x6301;&#x6E32;&#x67D3;&#x82F1;&#x6587;&#x3002;&#x7136;&#x540E;&#x5728;<code>pubspec.yaml</code> &#x4E2D;&#x7684;flutter &#x6807;&#x7B7E;&#x4E0B;&#x6DFB;&#x52A0;&#x5982;&#x4E0B;&#x5B57;&#x7B26;&#x4E32;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/10266db569a7731b73c93be22872cb76389750816767665075c37e6a9f138442" alt="image.png"></p>
<p>&#x5728;&#x5B9E;&#x9645;&#x9879;&#x76EE;&#x4E2D;&#x76F4;&#x63A5;&#x5BFC;&#x5165;&#x5B57;&#x4F53;&#x6587;&#x4EF6;&#x4F1A;&#x4F7F;&#x5305;&#x4F53;&#x79EF;&#x589E;&#x52A0;&#x4E00;&#x4E9B;&#x65E0;&#x7528;&#x6587;&#x4EF6;&#x3002;&#x800C;&#x5B57;&#x4F53;&#x6682;&#x65F6;&#x4E0D;&#x80FD;&#x50CF;<code>dev_dependencies</code> &#x4E00;&#x6837;&#x6DFB;&#x52A0;&#x53EA;&#x5728;&#x5F00;&#x53D1;&#x4E2D;&#x5F15;&#x7528;&#x7684;&#x5E93;&#x3002;<a href="/external_links/e071531e0ea4cbe12cb943d62c51f4a7.html" target="blank" rel="noopener">github.com/flutter/flu&#x2026;</a></p>
<p>&#x8FD9;&#x91CC;&#x6211;&#x5EFA;&#x8BAE;&#x5728;&#x9879;&#x76EE;&#x4E2D;&#x6587;&#x4EF6;&#x5939;&#x91CC;&#x518D;&#x5EFA;&#x4E00;&#x4E2A;flutter <code>example</code>,&#x5728;&#x8BE5;<code>example</code>&#x91CC;&#x5199;<code>Golden Test</code>&#x3002;</p>
<p>&#x8FD9;&#x4E9B;&#x64CD;&#x4F5C;&#x540E;&#x5F00;&#x59CB;&#x7F16;&#x5199;&#x57FA;&#x4E8E;<a href="/external_links/1b9dbdc4dced2a1bedffd4f5480e2ab3.html" target="blank" rel="noopener"><code>golden_toolkit</code></a>&#x7684;<code>Golden Test</code>&#x3002;&#x65B0;&#x5EFA;<code>circle_button_test</code>&#x3002;&#x5728;test&#x6587;&#x4EF6;&#x5939;&#x4E2D;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">dart&#x590D;&#x5236;&#x4EE3;&#x7801;import &apos;package:flutter_golden_test_example/circle_button.dart&apos;;</span><br><span class="line">import &apos;package:golden_toolkit/golden_toolkit.dart&apos;;</span><br><span class="line"></span><br><span class="line">void main() {</span><br><span class="line">  testGoldens(&apos;Circle button&apos;, (tester) async {</span><br><span class="line">    final builder = GoldenBuilder.grid(</span><br><span class="line">      columns: 3,</span><br><span class="line">      widthToHeightRatio: 1,</span><br><span class="line">    )</span><br><span class="line">      ..addScenario(</span><br><span class="line">        &apos;alarm&apos;,</span><br><span class="line">        const CircleButton(icon: &apos;assets/images/ic_alarm.svg&apos;, text: &apos;&#x65F6;&#x949F;&apos;),</span><br><span class="line">      )</span><br><span class="line">      ..addScenario(</span><br><span class="line">        &apos;notification&apos;,</span><br><span class="line">        const CircleButton(</span><br><span class="line">            icon: &apos;assets/images/ic_notification.svg&apos;, text: &apos;&#x901A;&#x77E5;&apos;),</span><br><span class="line">      );</span><br><span class="line">    await tester.pumpWidgetBuilder(builder.build());</span><br><span class="line">    await screenMatchesGolden(tester, &apos;circle_button&apos;);</span><br><span class="line">  });</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x7136;&#x540E;&#x8FD0;&#x884C;<code>flutter test --update-goldens</code> &#x5C31;&#x4F1A;&#x751F;&#x6210;&#x5982;&#x4E0B;&#x6587;&#x4EF6;&#x3002;&#x8FD9;&#x5C31;&#x662F;&#x57FA;&#x51C6;&#x56FE;&#x7247;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/c3dd89fb060bf7783c4f54e95fdd14cd27de2ba8d50b320dd87a9278073cfdeb" alt="image.png"></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/1f3b2c103d68001901c4364641032807cbabe90edaa9d124cb63695dafc7b266" alt="image.png"><br>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x6A21;&#x62DF;&#x4E0B;&#x5BF9;&#x8BE5;UI&#x5728;&#x65B0;&#x589E;&#x529F;&#x80FD;&#x65F6;&#x51FA;&#x73B0;&#x7684;&#x7834;&#x574F;&#x6027;&#x53D8;&#x66F4;&#x5BFC;&#x81F4;&#x6587;&#x672C;&#x5B57;&#x4F53;&#x989C;&#x8272;&#x9519;&#x8BEF;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/8466431b81329c88c6be4a26a7fc4bfa1ac29fbdb490020e7283e26fecc2ecb4" alt="image.png"><br>&#x6B64;&#x65F6;&#x8FD0;&#x884C;<code>flutter test</code> &#x3002;&#x5219;&#x4F1A;&#x62A5;&#x9519;&#x3002;&#x56FE;&#x4E2D;&#x5708;&#x51FA;&#x6765;&#x7684;&#x4FE1;&#x606F;&#x5219;&#x544A;&#x77E5;&#x4E86;&#x5F53;&#x524D;UI&#x4EE3;&#x7801;&#x8F93;&#x51FA;&#x7684;&#x56FE;&#x548C;&#x57FA;&#x51C6;&#x56FE;&#x7684;&#x5DEE;&#x5F02;&#x6BD4;&#x4F8B;&#x3002;&#x5E76;&#x65B0;&#x589E;&#x4E86;failures&#x6587;&#x4EF6;&#x5939;&#xFF0C;&#x91CC;&#x9762;&#x7684;&#x6587;&#x4EF6;&#x5206;&#x522B;&#x8868;&#x793A;&#x7684;&#x4F5C;&#x7528;&#x662F;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/0eb5b13c98518f46e10c6349c5815eeb53330720a0f50f3dcd65253fde886971" alt="image.png"></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/af22f3d0b6e610342a427db05779ea533b5e032289976cca46ac908d002952ee" alt="image.png"></p>
<table>
<thead>
<tr>
<th>&#x6587;&#x4EF6;&#x540E;&#x7F00;&#x540D;</th>
<th>&#x4F5C;&#x7528;</th>
</tr>
</thead>
<tbody><tr>
<td>xx_isolatedDiff</td>
<td>&#x6807;&#x8BB0;&#x4E24;&#x8005;&#x5DEE;&#x5F02;&#x7684;&#x56FE;&#x7247;</td>
</tr>
<tr>
<td>xx_maskedDiff</td>
<td>&#x6807;&#x8BB0;&#x4E24;&#x8005;&#x5DEE;&#x5F02;&#x7684;&#x56FE;&#x7247;</td>
</tr>
<tr>
<td>xx_masterImage</td>
<td>&#x57FA;&#x51C6;&#x56FE;&#x7247;</td>
</tr>
<tr>
<td>xx_testImage</td>
<td>&#x88AB;&#x6D4B;&#x8BD5;&#x56FE;&#x7247;&#xFF08;&#x5F53;&#x524D;UI&#x4EE3;&#x7801;&#x751F;&#x6210;&#x7684;&#x56FE;&#x7247;&#xFF09;</td>
</tr>
</tbody></table>
<p>&#x5176;&#x4E2D;isolatedDiff&#x548C;maskedDiff&#x7684;&#x5DEE;&#x5F02;&#xFF0C;&#x76F4;&#x63A5;&#x770B;&#x56FE;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/91351d9a062f768d47c1eea7b577dea78ebd87f62821c82b87d4949676cbef73" alt="image.png"></p>
<p>circle_button_isolatedDiff.png</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/55a95e07279e9fd5f28793f3c0817af72d3621fda1ded6b93dcbcdbc10b7e1cd" alt="image.png"></p>
<p>circle_button_maskedDiff.png</p>
<p>&#x8FD9;&#x4E9B;<code>Diff</code>&#x7684;&#x56FE;&#x7247;&#x4F1A;&#x5708;&#x51FA;UI&#x5DEE;&#x5F02;&#x7684;&#x5730;&#x65B9;&#x3002;</p>
<p>&#x5982;&#x679C;&#x4F60;UI&#x7684;&#x53D8;&#x66F4;&#x662F;&#x901A;&#x8FC7;&#x5408;&#x5E76;&#x5206;&#x652F;&#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x5728;&#x4F60;&#x66F4;&#x65B0;&#x57FA;&#x51C6;&#x56FE;&#x7247;&#x540E;&#xFF0C;&#x63D0;&#x4EA4;mr&#x540E;&#xFF0C;mr&#x9875;&#x9762;&#x4F1A;&#x663E;&#x793A;&#x51FA;UI&#x7684;&#x53D8;&#x66F4;&#x5982;&#x4E0B;&#x56FE;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/a6374a3563fd310e933de8b0d0a55967f706482cfa219ff1d429b1665564dac1" alt="image.png"></p>
<p>&#x6700;&#x540E;&#x8BB0;&#x5F97;&#x8FD8;&#x9700;&#x8981;&#x5C06; <strong><code>failures</code></strong> &#x6587;&#x4EF6;&#x5939;&#x6DFB;&#x52A0;&#x5728; <strong><code>.gitignore</code></strong> &#x4E2D;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/59c43ff4cd8b673fd51f2eccde604d9e043d3815450948a091c209ed522f64fa" alt="image.png"></p>
<h1 id="&#x76F8;&#x5173;&#x94FE;&#x63A5;"><a href="#&#x76F8;&#x5173;&#x94FE;&#x63A5;" class="headerlink" title="&#x76F8;&#x5173;&#x94FE;&#x63A5;"></a>&#x76F8;&#x5173;&#x94FE;&#x63A5;</h1><p>&#x6E90;&#x4EE3;&#x7801;&#x4ED3;&#x5E93;&#xFF1A; <a href="/external_links/bb245fe1c48fdca94de6ab0efe7c7127.html" target="blank" rel="noopener">github.com/drown0315/f&#x2026;</a></p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/00ce974fb04c41a393aa1903d2a585e8.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7347851786134978610.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7347851786134978610.html" itemprop="url">在Jetpack Compose中方便的使用MVI思想？试试</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-03-19T09:43:18+08:00">
                2024-03-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x539F;&#x6587;&#x5730;&#x5740;&#xFF1A; <a href="/external_links/3dc989092ef497a477f309c1ac40b331.html" target="blank" rel="noopener"># &#x5728;Compose&#x4E2D;&#x65B9;&#x4FBF;&#x7684;&#x4F7F;&#x7528;MVI&#x601D;&#x60F3;&#xFF1F;&#x8BD5;&#x8BD5;useReducer&#xFF01;</a></p>
<h2 id="&#x5199;&#x5728;&#x524D;&#x9762;"><a href="#&#x5199;&#x5728;&#x524D;&#x9762;" class="headerlink" title="&#x5199;&#x5728;&#x524D;&#x9762;"></a>&#x5199;&#x5728;&#x524D;&#x9762;</h2><p>&#x672C;&#x6587;&#x4E2D;&#x63D0;&#x53CA;&#x7684;<code>use</code>&#x5F00;&#x5934;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x90FD;&#x51FA;&#x81EA;&#x4E0E;&#x6211;&#x7684; <a href="/external_links/582b0f220990c518ed24378b2dea1916.html" target="blank" rel="noopener">ComposeHooks</a> &#x9879;&#x76EE;&#xFF0C;&#x5B83;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x7CFB;&#x5217; React Hooks &#x98CE;&#x683C;&#x7684;&#x72B6;&#x6001;&#x5C01;&#x88C5;&#x51FD;&#x6570;&#xFF0C;&#x53EF;&#x4EE5;&#x5E2E;&#x4F60;&#x66F4;&#x597D;&#x7684;&#x4F7F;&#x7528; Compose&#xFF0C;&#x65E0;&#x9700;&#x5173;&#x7CFB;&#x590D;&#x6742;&#x7684;&#x72B6;&#x6001;&#x7BA1;&#x7406;&#xFF0C;&#x4E13;&#x5FC3;&#x4E8E;&#x4E1A;&#x52A1;&#x4E0E;UI&#x7EC4;&#x4EF6;&#x3002;</p>
<p>&#x8FD9;&#x662F;&#x7CFB;&#x5217;&#x6587;&#x7AE0;&#x7684;&#x7B2C;&#x5DF2;&#x7BC7;&#xFF0C;&#x5168;&#x90E8;&#x6587;&#x7AE0;&#xFF1A;</p>
<ul>
<li><a href="https://dev.newban.cn/7342793007938371594">&#x5728;Compose&#x4E2D;&#x4F7F;&#x7528;useRequest&#x8F7B;&#x677E;&#x7BA1;&#x7406;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;</a></li>
<li><a href="https://dev.newban.cn/7344927519923011594">&#x5728;Compose&#x4E2D;&#x4F7F;&#x7528;&#x72B6;&#x6001;&#x63D0;&#x5347;&#xFF1F;&#x6211;&#x63D0;&#x5347;&#x4E2A;P&#x2026;Provider</a></li>
<li><a href="https://dev.newban.cn/7345396671423250441">&#x5728;Compose&#x4E2D;&#x7236;&#x7EC4;&#x4EF6;&#x5982;&#x4F55;&#x8C03;&#x7528;&#x5B50;&#x7EC4;&#x4EF6;&#x7684;&#x51FD;&#x6570;&#xFF1F;</a></li>
<li><a href="https://dev.newban.cn/7347851786134978610">&#x5728;Compose&#x4E2D;&#x65B9;&#x4FBF;&#x7684;&#x4F7F;&#x7528;MVI&#x601D;&#x60F3;&#xFF1F;&#x8BD5;&#x8BD5;useReducer&#xFF01;</a></li>
</ul>
<h2 id="&#x4EC0;&#x4E48;&#x662F;-MVI&#xFF1F;"><a href="#&#x4EC0;&#x4E48;&#x662F;-MVI&#xFF1F;" class="headerlink" title="&#x4EC0;&#x4E48;&#x662F; MVI&#xFF1F;"></a>&#x4EC0;&#x4E48;&#x662F; MVI&#xFF1F;</h2><p>&#x4EC0;&#x4E48;&#x662F; <code>MVI</code>&#xFF1F;&#x60F3;&#x5FC5;&#x4F60;&#x4E5F;&#x770B;&#x8FC7;&#x5F88;&#x591A;&#x535A;&#x5BA2;&#x4E86;&#xFF0C;&#x5176;&#x5B9E;&#x7B80;&#x5355;&#x8BF4;&#x5C31;&#x662F;&#xFF1A;<strong>&#x660E;&#x786E;&#x5206;&#x79BB;</strong>&#x6570;&#x636E;&#x6A21;&#x578B;&#xFF08;Model&#xFF09;&#x3001;&#x7528;&#x6237;&#x754C;&#x9762;&#xFF08;View&#xFF09;&#x548C;&#x7528;&#x6237;&#x610F;&#x56FE;&#xFF08;Intent&#xFF0C;&#x4E5F;&#x79F0;&#x4E3A;&#x4E8B;&#x4EF6;&#x3001;&#x52A8;&#x4F5C;&#xFF09;&#xFF0C;&#x4EE5;&#x5B9E;&#x73B0;UI&#x7684;&#x54CD;&#x5E94;&#x5F0F;&#x548C;<strong>&#x53EF;&#x9884;&#x6D4B;&#x7684;&#x66F4;&#x65B0;</strong>&#x3002;</p>
<p>&#x5B83;&#x4E0E; <code>MVVM</code> &#x5176;&#x5B9E;&#x533A;&#x522B;&#x4E0D;&#x5927;&#xFF0C;&#x6709;&#x522B;&#x4E8E; MVVM &#x7684;&#x662F;&#xFF0C;MVVM &#x5C06;&#x8026;&#x5408;&#x4EE3;&#x7801;&#x6309;&#x7167;&#x804C;&#x8D23;&#x533A;&#x5206;&#xFF0C;&#x62C6;&#x5206;&#x6587;&#x4EF6;&#x3002;&#x501F;&#x52A9; <code>LiveData</code> &#x6216;&#x8005; <code>DataBinding</code> &#x5C06; VM &#x4E2D;&#x6570;&#x636E;&#x66F4;&#x65B0;&#x76F4;&#x63A5;&#x9A71;&#x52A8; V &#x5C42;&#xFF0C;&#x5B9E;&#x73B0;&#x4E86; V &#x5C42;&#x4E0E; M &#x5C42;&#x4E4B;&#x95F4;&#x7684;&#x89E3;&#x8026;&#x3002;</p>
<p>&#x5F97;&#x529B;&#x4E8E; Compose &#x5E26;&#x6765;&#x7684;<strong>&#x72B6;&#x6001;</strong>&#x9A71;&#x52A8;&#x89C6;&#x56FE;&#x80FD;&#x529B;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7406;&#x89E3; MVI &#x601D;&#x60F3;&#x4E3A;&#xFF1A;&#x7528;&#x6237;&#x53D1;&#x51FA;<strong>&#x4E8B;&#x4EF6;</strong>&#xFF0C;&#x4E8B;&#x4EF6;&#x9A71;&#x52A8;<strong>&#x72B6;&#x6001;</strong>&#x53D8;&#x5316;&#xFF0C;&#x72B6;&#x6001;&#x9A71;&#x52A8; <strong>UI</strong> &#x53D8;&#x5316;&#x3002;&#x8FD9;&#x4E5F;&#x5C31;&#x662F;&#x6240;&#x8C13;&#x7684;&#x4E8B;&#x4EF6;&#x5411;&#x4E0A;&#xFF0C;&#x72B6;&#x6001;&#x5411;&#x4E0B;&#xFF1A;&#x4E8B;&#x4EF6;&#x4ECE;&#x7EC4;&#x4EF6;&#x53D1;&#x51FA;&#xFF0C;&#x5355;&#x4E00;&#x53EF;&#x4FE1;&#x6765;&#x6E90;&#x7684;&#x72B6;&#x6001;&#x9A71;&#x52A8;&#x7EC4;&#x4EF6;&#x66F4;&#x65B0;&#x3002;</p>
<p>&#x4ECE;&#x8FD9;&#x4E00;&#x601D;&#x60F3;&#x51FA;&#x53D1;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;&#xFF1A;&#x8C01;&#x6301;&#x6709;&#x72B6;&#x6001;&#xFF0C;&#x8C01;&#x5C31;&#x662F; M &#x5C42;&#x3002;&#x90A3;&#x4E48;&#x8FC7;&#x53BB;&#x7684; MVVM &#x7684;&#x6587;&#x4EF6;&#x62C6;&#x5206;&#x5C06;&#x4F1A;&#x53D8;&#x5F97;&#x76F8;&#x5BF9;&#x677E;&#x6563;&#xFF0C;&#x6211;&#x4EEC;&#x5B8C;&#x5168;&#x53EF;&#x4EE5;&#x6452;&#x5F03;&#x8FC7;&#x53BB;&#x90A3;&#x79CD;<em>&#x5168;&#x5C4F;&#x5F0F;</em>&#x601D;&#x60F3;&#xFF0C;&#x4E0D;&#x518D;&#x6839;&#x636E;&#x5C4F;&#x5E55;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; VM &#x5927;&#x7BA1;&#x5BB6;&#x3002;&#x800C;&#x662F;&#x62C6;&#x5206;&#x6210;&#x804C;&#x8D23;&#x3001;&#x7C92;&#x5EA6;&#x66F4;&#x7EC6;&#x5C0F;&#x7684;<strong>&#x7EC4;&#x4EF6;</strong>&#x601D;&#x60F3;&#x3002;<br><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/f3b19f236ab1b65a8971bf821c7c171de0bd1239f9e969a7f99af55c2240d603" alt="&#x4E8B;&#x4EF6;&#x5411;&#x4E0A;&#x72B6;&#x6001;&#x5411;&#x4E0B;"></p>
<p>&#x5F53;&#x7136;&#x4F7F;&#x7528; <code>MVVM</code> &#x6211;&#x4EEC;&#x4E00;&#x6837;&#x53EF;&#x4EE5;&#x505A;&#x5230;&#x7C7B;&#x4F3C;&#x7684;&#x6548;&#x679C;&#xFF0C;&#x4F46;&#x662F; MVI &#x5C06;&#x5B83;&#x6D41;&#x7A0B;&#x5316;&#x3001;&#x6807;&#x51C6;&#x5316;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;&#x5176;&#x5B9E; MVI &#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x6709;&#x4E00;&#x5B9A;&#x6A21;&#x677F;&#x7684;&#x66F4;&#x4F18;&#x79C0;&#x7684; <code>MVVM</code>&#x3002;</p>
<p>&#x8FC7;&#x53BB;&#x6211;&#x4EEC;&#x7684; VM &#x5C42;&#x5176;&#x5B9E;&#x4E5F;&#x5F88;&#x91CD;&#xFF0C;&#x4E00;&#x4E2A;&#x590D;&#x6742;&#x7684;&#x9875;&#x9762;&#xFF0C;&#x6570;&#x4E2A;&#x7F51;&#x7EDC;&#x63A5;&#x53E3;&#xFF0C;&#x90FD;&#x88AB;&#x4ECD;&#x5728;&#x4E00;&#x4E2A; VM &#x4E2D;&#xFF0C;&#x9274;&#x4E8E;&#x4E0D;&#x540C;&#x5F00;&#x53D1;&#x8005;&#x7684;&#x6C34;&#x5E73;&#x7684;&#x53C2;&#x5DEE;&#xFF0C;&#x6211;&#x4EEC;&#x9879;&#x76EE;&#x4E2D;&#x751A;&#x81F3;&#x6709;&#x4E00;&#x4E2A; VM &#x6587;&#x4EF6;&#x4E2D;&#x6301;&#x6709;&#x4E86;20&#x591A;&#x4E2A; LiveData&#xFF0C;&#x53EF;&#x4EE5;&#x8BF4;&#x5B8C;&#x5168;&#x8FDD;&#x80CC;&#x4E86; MVVM &#x7684;&#x521D;&#x8877;&#x3002;</p>
<p>&#x540C;&#x6837;&#x7684;&#xFF0C;&#x60F3;&#x5FC5;&#x4F60;&#x5DF2;&#x7ECF;&#x770B;&#x4E86;&#x5F88;&#x591A;&#x5728; Compose &#x4E2D;&#x4F7F;&#x7528; <code>ViewModel</code> &#x6765;&#x5B9E;&#x73B0; <code>MVI</code> &#x7684;&#x6587;&#x7AE0;&#x4E86;&#x5427;&#xFF08;&#x6211;&#x751A;&#x81F3;&#x770B;&#x8FC7;&#x56DE;&#x5B57;&#x7684;&#x56DB;&#x79CD;&#x5199;&#x6CD5;&#xFF09;&#xFF0C;&#x5B83;&#x771F;&#x7684;&#x6709;&#x8FD9;&#x4E48;&#x590D;&#x6742;&#x4E48;&#xFF1F;&#x5728; Compose &#x4E2D;&#x6211;&#x4EEC;&#x8FD8;&#x9700;&#x8981;&#x8FD9;&#x6837;&#x7684;&#x4E00;&#x4F4D;&#x5927;&#x7BA1;&#x5BB6;&#x4E48;&#xFF1F;&#x867D;&#x7136;&#x5F88;&#x591A;&#x4F8B;&#x5B50;&#x3001;&#x751A;&#x81F3;&#x5B98;&#x65B9;&#x7684; demo&#xFF0C;&#x90FD;&#x8FD8;&#x5728;&#x4F7F;&#x7528; <code>ViewModel</code>&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x662F;&#x4E00;&#x79CD;&#x65E0;&#x6CD5;&#x56DE;&#x907F;&#x7684;&#x53D6;&#x820D;&#xFF1F;&#x8FD8;&#x662F;&#x65E2;&#x5F80;&#x8DEF;&#x7EBF;&#x7684;&#x60EF;&#x6027;&#x3002;</p>
<p>&#x5728;&#x4E00;&#x4E9B;&#x573A;&#x666F;&#x4E0B;&#xFF0C;&#x6211;&#x4EEC;&#x5B8C;&#x5168;&#x53EF;&#x4EE5;&#x66F4;&#x7EC4;&#x4EF6;&#x5316;&#x601D;&#x7EF4;&#xFF0C;&#x5728;&#x66F4;&#x5C0F;&#x7C92;&#x5EA6;&#x4E0A;&#x5E94;&#x7528; MVI&#x3002;&#x4ECA;&#x5929;&#x4F60;&#x53EF;&#x4EE5;&#x8BD5;&#x8BD5;&#x4E00;&#x70B9;&#x65B0;&#x4E1C;&#x897F;&#xFF1A;<code>useReducer</code>&#xFF0C;&#x901A;&#x8FC7;&#x5B83;&#x6211;&#x5C06;&#x8FDB;&#x4E00;&#x6B65;&#x9610;&#x8FF0;&#x6211;&#x6240;&#x8BF4;&#x7684;&#xFF1A;&#x677E;&#x6563;&#x7684;&#x3001;&#x7EC4;&#x4EF6;&#x4E0B;&#x7684; MVI &#x601D;&#x60F3;&#x3002;</p>
<h2 id="&#x6211;&#x4EEC;&#x9700;&#x8981;-VM-&#x4E48;&#xFF1F;"><a href="#&#x6211;&#x4EEC;&#x9700;&#x8981;-VM-&#x4E48;&#xFF1F;" class="headerlink" title="&#x6211;&#x4EEC;&#x9700;&#x8981; VM &#x4E48;&#xFF1F;"></a>&#x6211;&#x4EEC;&#x9700;&#x8981; VM &#x4E48;&#xFF1F;</h2><p>MVI &#x76F8;&#x5173;&#x6587;&#x7AE0;&#x4E2D;&#x4F60;&#x53EF;&#x80FD;&#x4F1A;&#x770B;&#x5230;&#x4E00;&#x4E2A;&#x89C2;&#x70B9;&#xFF1A;&#x7EAF;&#x51FD;&#x6570;&#xFF08;&#x7ED9;&#x5B9A;&#x76F8;&#x540C;&#x7684;&#x8F93;&#x5165;&#x65F6;&#xFF0C;&#x603B;&#x662F;&#x4EA7;&#x751F;&#x76F8;&#x540C;&#x7684;&#x8F93;&#x51FA;&#xFF0C;&#x5E76;&#x4E14;&#x4E0D;&#x4EA7;&#x751F;&#x4EFB;&#x4F55;&#x526F;&#x4F5C;&#x7528;&#x7684;&#x51FD;&#x6570;&#xFF09;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x6784;&#x5EFA;&#x4E00;&#x4E2A;&#x6539;&#x53D8;&#x72B6;&#x6001;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x79F0;&#x4E4B;&#x4E3A; reducer &#x51FD;&#x6570;&#xFF0C;&#x5C06;&#x4E0A;&#x4E00;&#x4E2A;&#x72B6;&#x6001;&#x3001;Intent&#xFF08;&#x4E5F;&#x6210;&#x4E3A; event&#x3001;action&#xFF09;&#x4F5C;&#x4E3A;&#x51FD;&#x6570;&#x7684;&#x5165;&#x53C2;&#xFF0C;&#x5C06;&#x8FD4;&#x56DE;&#x503C;&#x4F5C;&#x4E3A;&#x65B0;&#x7684;&#x72B6;&#x6001;&#x5E94;&#x7528;&#x4E8E;&#x7EC4;&#x4EF6;&#xFF0C;&#x53EA;&#x8981;&#x8FD9;&#x4E2A; reducer &#x51FD;&#x6570;&#x662F; <strong>&#x7EAF;&#x51FD;&#x6570;</strong>&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x5B9E;&#x73B0;&#x4E86;&#xFF1A;<strong>&#x53EF;&#x9884;&#x6D4B;&#x7684;&#x66F4;&#x65B0;</strong>&#x3002;</p>
<p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x6765;&#x6784;&#x5EFA;&#x4E00;&#x4E2A;&#x6700;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;// &#x6784;&#x5EFA;&#x72B6;&#x6001;&#x7C7B;&#x578B;</span><br><span class="line">data class SimpleData(</span><br><span class="line"> &#xA0; &#xA0;val name: String,</span><br><span class="line"> &#xA0; &#xA0;val age: Int,</span><br><span class="line">)</span><br><span class="line">&#x200B;</span><br><span class="line">// Intent&#x3001;&#x6211;&#x4EEC;&#x4E00;&#x534A;&#x4E60;&#x60EF;&#x79F0;&#x4E4B;&#x4E3A;&#xFF1A;action&#xFF0C;&#x4F7F;&#x7528; sealed interface&#x53EF;&#x4EE5;&#x65B9;&#x4FBF;&#x7684;&#x5B9E;&#x73B0;</span><br><span class="line">sealed interface SimpleAction {</span><br><span class="line"> &#xA0; &#xA0;data class ChangeName(val newName: String) : SimpleAction</span><br><span class="line"> &#xA0; &#xA0;data object AgeIncrease : SimpleAction</span><br><span class="line">}</span><br><span class="line">&#x200B;</span><br><span class="line">// &#x6784;&#x5EFA;&#x4E00;&#x4E2A; Reducer &#x51FD;&#x6570;&#xFF0C;&#x6CDB;&#x578B;&#x662F;&#x72B6;&#x6001;&#x7684;&#x7C7B;&#x578B;</span><br><span class="line">val simpleReducer: Reducer&lt;SimpleData&gt; = { prevState: SimpleData, action: Any -&gt;</span><br><span class="line"> &#xA0; &#xA0;when (action) {</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0;is SimpleAction.ChangeName -&gt; prevState.copy(name = action.newName)</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0;is SimpleAction.AgeIncrease -&gt; prevState.copy(age = prevState.age + 1)</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0;else -&gt; prevState</span><br><span class="line"> &#xA0;  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>reducer &#x51FD;&#x6570;&#x4E2D;&#x6211;&#x4EEC;&#x8981;&#x4F7F;&#x7528; <strong>&#x4E0D;&#x53EF;&#x53D8;</strong> &#x6570;&#x636E;&#xFF0C;data class &#x5C31;&#x662F;&#x6700;&#x597D;&#x7684;&#x9009;&#x62E9;&#xFF0C;&#x901A;&#x8FC7; copy &#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x65B0;&#x7684;&#x72B6;&#x6001;&#x3002;</p>
<p>&#x8FD9;&#x4E9B;&#x4EE3;&#x7801;&#xFF0C;&#x8981;&#x4E48;&#x662F;&#x7C7B;&#x578B;&#x58F0;&#x660E;&#x3001;&#x8981;&#x4E48;&#x662F;&#x4E00;&#x4E2A;&#x7EAF;&#x51FD;&#x6570;&#xFF0C;&#x4ED6;&#x4EEC;&#x4E0E;&#x6700;&#x7EC8;&#x7EC4;&#x4EF6;&#x606F;&#x606F;&#x76F8;&#x5173;&#xFF0C;&#x4F46;&#x662F;&#x4ED6;&#x4EEC;&#x5E76;&#x9700;&#x8981;&#x653E;&#x5230;&#x4E00;&#x4E2A; <code>ViewModel</code> &#x7C7B;&#x4E2D;&#xFF0C;&#x518D;&#x60F3;&#x4E00;&#x60F3;&#x6211;&#x4EEC;&#x9700;&#x8981; ViewModel &#x4E48;&#xFF1F;</p>
<p>&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x51E0;&#x4E4E;&#x5DF2;&#x7ECF;&#x662F; MVI &#x7684;&#x5B8C;&#x6574;&#x5B9E;&#x73B0;&#x4E86;&#xFF0C;M&#x5C42;&#x72B6;&#x6001;&#xFF1A;<code>SimpleData</code>&#xFF0C;I&#x5C42;&#x7531;Action&#x3001;Reducer&#x51FD;&#x6570;&#x6784;&#x6210;&#x3002;</p>
<p>&#x4ED6;&#x4EEC;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x3001;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#xFF0C;&#x800C;&#x4E14;&#x53EF;&#x4EE5;&#x65B9;&#x4FBF;&#x7684;&#x6269;&#x5C55;&#xFF0C;&#x89C4;&#x8303;&#x4E86;M&#x5C42;&#x53D8;&#x5316;&#xFF08;&#x4F60;&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x4FEE;&#x6539;&#x72B6;&#x6001;&#xFF0C;&#x5FC5;&#x987B;&#x901A;&#x8FC7;&#x4F20;&#x9012; Action &#x7ED9; Reducer &#x51FD;&#x6570;&#x9A71;&#x52A8;&#x72B6;&#x6001;&#x53D8;&#x5316;&#xFF09;&#x3002;</p>
<p>&#x518D;&#x6765;&#x770B;&#x770B;&#x6211;&#x4EEC;&#x7684; V &#x5C42;&#x9700;&#x8981;&#x505A;&#x4EC0;&#x4E48;&#xFF1F;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;@Composable</span><br><span class="line">fun UseReducerExample() {</span><br><span class="line"> &#xA0; &#xA0;val (state, dispatch) = useReducer(simpleReducer, initialState = SimpleData(&quot;default&quot;, 18))</span><br><span class="line"> &#xA0; &#xA0;val (input, setInput) = useState(&quot;&quot;)</span><br><span class="line"> &#xA0; &#xA0;Surface {</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0;Column {</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;Text(text = &quot;UserName: $state.name&quot;)</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;Text(text = &quot;UserAge: $state.age&quot;)</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;OutlinedTextField(value = input, onValueChange = setInput)</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;TButton(text = &quot;changeName&quot;) {</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;dispatch(SimpleAction.ChangeName(input))</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;  }</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;TButton(text = &quot;+1&quot;) {</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;dispatch(SimpleAction.AgeIncrease)</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;  }</span><br><span class="line"> &#xA0; &#xA0; &#xA0;  }</span><br><span class="line"> &#xA0;  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x4F7F;&#x7528;&#xFF1A;<code>useReducer</code>&#x51FD;&#x6570;&#xFF0C;&#x4F20;&#x5165; Reducer &#x51FD;&#x6570;&#x4E0E;&#x4E00;&#x4E2A;&#x521D;&#x59CB;&#x72B6;&#x6001;&#xFF1A;<code>initialState</code>&#xFF0C;&#x901A;&#x8FC7;&#x89E3;&#x6784;&#x58F0;&#x660E;&#x8BED;&#x6CD5;&#xFF0C;&#x53EF;&#x4EE5;&#x8F7B;&#x677E;&#x7684;&#x62FF;&#x5230;<strong>&#x72B6;&#x6001;</strong>&#x3001;<code>dispatch</code>&#x51FD;&#x6570;&#x3002;</p>
<p>&#x7136;&#x540E;&#x5728;&#x7EC4;&#x4EF6;&#x4E2D;&#x4F7F;&#x7528;&#x5373;&#x53EF;&#x3002;</p>
<h2 id="&#x6211;&#x4EEC;&#x4E0D;&#x4E00;&#x5B9A;&#x9700;&#x8981;-VM&#xFF01;"><a href="#&#x6211;&#x4EEC;&#x4E0D;&#x4E00;&#x5B9A;&#x9700;&#x8981;-VM&#xFF01;" class="headerlink" title="&#x6211;&#x4EEC;&#x4E0D;&#x4E00;&#x5B9A;&#x9700;&#x8981; VM&#xFF01;"></a>&#x6211;&#x4EEC;&#x4E0D;&#x4E00;&#x5B9A;&#x9700;&#x8981; VM&#xFF01;</h2><p>&#x73B0;&#x5728;&#x6211;&#x53EF;&#x4EE5;&#x56DE;&#x7B54;&#x6211;&#x4E4B;&#x524D;&#x7684;&#x95EE;&#x9898;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x771F;&#x7684;&#x9700;&#x8981;&#x4E48;&#xFF1F;</p>
<p>&#x5F88;&#x591A;&#x573A;&#x666F;&#x6211;&#x4EEC;&#x5176;&#x5B9E;&#x5E76;&#x4E0D;&#x9700;&#x8981;&#xFF0C;&#x5C06;&#x72B6;&#x6001;&#x4ECE; VM &#x4E2D;&#x62C6;&#x89E3;&#x3001;&#x7C92;&#x5316;&#x6210;&#x4E3A;&#x66F4;&#x5C0F;&#x7684;&#x4E00;&#x4E2A;&#x4E2A;&#x7EC4;&#x4EF6;&#xFF0C;&#x5728;&#x7EC4;&#x4EF6;&#x6587;&#x4EF6;&#x4E2D;&#x76F4;&#x63A5;&#x58F0;&#x660E;&#x8FD9;&#x4E9B;&#x72B6;&#x6001;&#x7C7B;&#x578B;&#x3001;Action&#x3001;Reducer &#x51FD;&#x6570;&#xFF0C;&#x7136;&#x540E;&#x901A;&#x8FC7; <code>useReducer</code> &#x51FD;&#x6570;&#x5373;&#x53EF;&#x3002;</p>
<p>&#x5728;&#x5927;&#x591A;&#x6570;&#x573A;&#x666F;&#x4E5F;&#x8BB8;&#x6211;&#x4EEC;&#x6839;&#x672C;&#x5C31;&#x7528;&#x4E0D;&#x4E0A; VM &#x5E26;&#x7ED9;&#x6211;&#x4EEC;&#x7684;&#x597D;&#x5904;&#xFF0C;&#x5B83;&#x5728; View &#x4F53;&#x7CFB;&#x662F;&#x90A3;&#x4E48;&#x91CD;&#x8981;&#xFF0C;&#x4F46;&#x662F;&#x5728; Compose &#x4E2D;&#xFF0C;&#x6211;&#x8BA4;&#x4E3A;&#x6709;&#x70B9;&#x53EF;&#x6709;&#x53EF;&#x65E0;&#x4E86;&#x3002;</p>
<p>&#x6BD4;&#x5982;&#x751F;&#x547D;&#x5468;&#x671F;&#x611F;&#x77E5;&#xFF0C;&#x9664;&#x975E;&#x4F60;&#x8981;&#x4F7F;&#x7528;&#x65CB;&#x8F6C;&#x5C4F;&#x5E55;&#x4E0B;&#x7684;&#x72B6;&#x6001;&#x4FDD;&#x6301;&#xFF08;&#x5927;&#x591A;&#x6570;&#x5E94;&#x7528;&#x90FD;&#x662F;&#x9501;&#x65B9;&#x5411;&#x7684;&#xFF09;&#xFF1F;</p>
<p>&#x6BD4;&#x5982;&#x6570;&#x636E;&#x5171;&#x4EAB;&#xFF0C;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;<a href="https://dev.newban.cn/7067325498216415269#heading-8"><strong>&#x72B6;&#x6001;&#x63D0;&#x5347;</strong></a>&#xFF1F;&#x4E86;&#x89E3;&#x4E00;&#x4E0B; <a href="https://dev.newban.cn/7344927519923011594"><code>useContext</code></a>&#xFF1F;</p>
<p>&#x5982;&#x679C;&#x4F60;&#x662F;&#x65E7;&#x7684; MVVM &#x9879;&#x76EE;&#x6539;&#x9020;&#xFF0C;&#x90A3;&#x4E48;&#x4F7F;&#x7528; vm &#x6539;&#x9020;&#x6210;&#x672C;&#x6BD4;&#x8F83;&#x5C0F;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x662F;&#x65B0;&#x9879;&#x76EE;&#xFF0C;&#x6211;&#x89C9;&#x5F97;&#x4E00;&#x822C;&#x7684;&#x573A;&#x666F;&#x5B8C;&#x5168;&#x6CA1;&#x6709;&#x5FC5;&#x8981;&#x7EE7;&#x7EED;&#x4F7F;&#x7528; VM &#x4E86;&#x3002;</p>
<h2 id="&#x63A2;&#x7D22;&#x66F4;&#x591A;"><a href="#&#x63A2;&#x7D22;&#x66F4;&#x591A;" class="headerlink" title="&#x63A2;&#x7D22;&#x66F4;&#x591A;"></a>&#x63A2;&#x7D22;&#x66F4;&#x591A;</h2><p>&#x9879;&#x76EE;&#x5F00;&#x6E90;&#x5730;&#x5740;&#xFF1A;<a href="/external_links/5deda0a62b4a277ffced2d3e371ba146.html" target="blank" rel="noopener">junerver</a>/<a href="/external_links/582b0f220990c518ed24378b2dea1916.html" target="blank" rel="noopener">ComposeHooks</a></p>
<p>MavenCentral&#xFF1A;<a href="/external_links/b99e2850bd754b7b820a442f24711ea1.html" target="blank" rel="noopener">hooks</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scss&#x590D;&#x5236;&#x4EE3;&#x7801;implementation(&quot;xyz.junerver.compose:hooks:1.0.6&quot;)</span><br></pre></td></tr></table></figure>

<p>&#x6B22;&#x8FCE;&#x4F7F;&#x7528;&#x3001;&#x52D8;&#x8BEF;&#x3001;pr&#x3001;star&#x3002;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/ffe06567b0a1b82526ceaa0543022cb2.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7347670979635314703.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7347670979635314703.html" itemprop="url">天天用defineEmits宏函数，竟然不知道编译后是vue</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-03-19T09:26:20+08:00">
                2024-03-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x672C;&#x6587;&#x662F; <a href="/external_links/c0d1ddea52f9ca897a53426f8b9f07b0.html" target="blank" rel="noopener">vue3&#x7F16;&#x8BD1;&#x539F;&#x7406;&#x63ED;&#x79D8;</a> &#x7684;&#x7B2C; 5 &#x7BC7;&#xFF0C;&#x548C;&#x8BE5;&#x7CFB;&#x5217;&#x7684;&#x5176;&#x4ED6;&#x6587;&#x7AE0;&#x4E00;&#x8D77;&#x670D;&#x7528;&#x6548;&#x679C;&#x66F4;&#x4F73;&#x3002;</p>
<ol>
<li><a href="https://dev.newban.cn/7335721246931189795">vue3&#x7684;&#x5B8F;&#x5230;&#x5E95;&#x662F;&#x4EC0;&#x4E48;&#x4E1C;&#x897F;&#xFF1F;</a></li>
<li><a href="https://dev.newban.cn/7339210740455440419">Vue 3 &#x7684; setup&#x8BED;&#x6CD5;&#x7CD6;&#x5230;&#x5E95;&#x662F;&#x4EC0;&#x4E48;&#x4E1C;&#x897F;&#xFF1F;</a></li>
<li><a href="https://dev.newban.cn/7343139078486982710">&#x770B;&#x4E0D;&#x61C2;&#x6765;&#x6253;&#x6211;&#xFF0C;vue3&#x7684;.vue&#x6587;&#x4EF6;(SFC)&#x7F16;&#x8BD1;&#x8FC7;&#x7A0B;</a></li>
<li><a href="https://dev.newban.cn/7345129748006354978">&#x4E3A;&#x4EC0;&#x4E48;defineProps&#x5B8F;&#x51FD;&#x6570;&#x4E0D;&#x9700;&#x8981;&#x4ECE;vue&#x4E2D;import&#x5BFC;&#x5165;&#xFF1F;</a></li>
<li><a href="https://dev.newban.cn/7347670979635314703">&#x5929;&#x5929;&#x7528;defineEmits&#x5B8F;&#x51FD;&#x6570;&#xFF0C;&#x7ADF;&#x7136;&#x4E0D;&#x77E5;&#x9053;&#x7F16;&#x8BD1;&#x540E;&#x662F;vue2&#x7684;&#x9009;&#x9879;&#x5F0F;API&#xFF1F;</a></li>
<li><a href="https://dev.newban.cn/7349936384512131107">&#x9762;&#x8BD5;&#x5B98;&#xFF1A;&#x53EA;&#x77E5;&#x9053;v-model&#x662F;:modelValue&#x548C;@onUpdate&#x8BED;&#x6CD5;&#x7CD6;&#xFF0C;&#x90A3;&#x4F60;&#x53EF;&#x4EE5;&#x8D70;&#x4E86;</a></li>
<li><a href="https://dev.newban.cn/7354960709010260005">defineModel&#x662F;&#x5426;&#x7834;&#x574F;&#x4E86;vue3&#x7684;&#x5355;&#x5411;&#x6570;&#x636E;&#x6D41;&#x5462;&#xFF1F;</a></li>
<li><a href="https://dev.newban.cn/7356154581208072226">&#x770B;&#x4E0D;&#x61C2;&#x6765;&#x6253;&#x6211;&#xFF0C;vue3&#x5982;&#x4F55;&#x5C06;template&#x7F16;&#x8BD1;&#x6210;render&#x51FD;&#x6570;</a></li>
<li><a href="https://dev.newban.cn/7358709354425090083">&#x9762;&#x8BD5;&#x5B98;&#xFF1A;&#x6765;&#x8BF4;&#x8BF4;vue3&#x662F;&#x600E;&#x4E48;&#x5904;&#x7406;&#x5185;&#x7F6E;&#x7684;v-for&#x3001;v-model&#x7B49;&#x6307;&#x4EE4;&#xFF1F;</a></li>
<li><a href="https://dev.newban.cn/7360663978647404559">&#x9762;&#x8BD5;&#x5B98;&#xFF1A;&#x5728;&#x539F;&#x751F;input&#x4E0A;&#x9762;&#x4F7F;&#x7528;v-model&#x548C;&#x7EC4;&#x4EF6;&#x4E0A;&#x9762;&#x4F7F;&#x7528;&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;&#xFF1F;</a></li>
</ol>
<h1 id="&#x524D;&#x8A00;"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00;</h1><p>&#x6211;&#x4EEC;&#x6BCF;&#x5929;&#x90FD;&#x5728;&#x4F7F;&#x7528; <code>defineEmits</code> &#x5B8F;&#x51FD;&#x6570;&#xFF0C;&#x4F46;&#x662F;&#x4F60;&#x77E5;&#x9053;<code>defineEmits</code> &#x5B8F;&#x51FD;&#x6570;&#x7ECF;&#x8FC7;&#x7F16;&#x8BD1;&#x540E;&#x5176;&#x5B9E;&#x5C31;&#x662F;vue2&#x7684;&#x9009;&#x9879;&#x5F0F;API&#x5417;&#xFF1F;&#x901A;&#x8FC7;&#x56DE;&#x7B54;&#x4E0B;&#x9762;&#x4E24;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x5C06;&#x9010;&#x6B65;&#x4E3A;&#x4F60;&#x63ED;&#x79D8;<code>defineEmits</code> &#x5B8F;&#x51FD;&#x6570;&#x7684;&#x795E;&#x79D8;&#x9762;&#x7EB1;&#x3002;&#x4E3A;&#x4EC0;&#x4E48; Vue &#x7684; <code>defineEmits</code> &#x5B8F;&#x51FD;&#x6570;&#x4E0D;&#x9700;&#x8981; import &#x5BFC;&#x5165;&#x5C31;&#x53EF;&#x7528;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;<code>defineEmits</code>&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x7B49;&#x540C;&#x4E8E;<code>$emit</code> &#x65B9;&#x6CD5;&#x7528;&#x4E8E;&#x5728;&#x7EC4;&#x4EF6;&#x4E2D;&#x629B;&#x51FA;&#x4E8B;&#x4EF6;&#xFF1F;</p>
<h1 id="&#x4E3E;&#x4E24;&#x4E2A;&#x4F8B;&#x5B50;"><a href="#&#x4E3E;&#x4E24;&#x4E2A;&#x4F8B;&#x5B50;" class="headerlink" title="&#x4E3E;&#x4E24;&#x4E2A;&#x4F8B;&#x5B50;"></a>&#x4E3E;&#x4E24;&#x4E2A;&#x4F8B;&#x5B50;</h1><p>&#x8981;&#x56DE;&#x7B54;&#x4E0A;&#x9762;&#x63D0;&#x7684;&#x51E0;&#x4E2A;&#x95EE;&#x9898;&#x6211;&#x4EEC;&#x5148;&#x6765;&#x770B;&#x4E24;&#x4E2A;&#x4F8B;&#x5B50;&#x662F;&#x5982;&#x4F55;&#x58F0;&#x660E;&#x4E8B;&#x4EF6;&#x548C;&#x629B;&#x51FA;&#x4E8B;&#x4EF6;&#xFF0C;&#x5206;&#x522B;&#x662F;vue2&#x7684;&#x9009;&#x9879;&#x5F0F;&#x5929;&#x5929;&#x7528;defineEmits&#x5B8F;&#x51FD;&#x6570;&#x7ADF;&#x7136;&#x4E0D;&#x77E5;&#x9053;&#x7F16;&#x8BD1;&#x540E;&#x662F;vue2&#x7684;&#x9009;&#x9879;&#x5F0F;API&#xFF1F;&#x548C;vue3&#x7684;&#x7EC4;&#x5408;&#x5F0F;API&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x5148;&#x6765;&#x770B;vue2&#x7684;&#x9009;&#x9879;&#x5F0F;&#x8BED;&#x6CD5;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;<code>options-child.vue</code>&#x6587;&#x4EF6;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">xml&#x590D;&#x5236;&#x4EE3;&#x7801;    &lt;template&gt;</span><br><span class="line">      &lt;button @click=&quot;handleClick&quot;&gt;&#x653E;&#x5927;&#x6587;&#x5B57;&lt;/button&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line"></span><br><span class="line">    &lt;script&gt;</span><br><span class="line">    export default {</span><br><span class="line">      name: &quot;options-child&quot;,</span><br><span class="line">      emits: [&quot;enlarge-text&quot;],</span><br><span class="line">      methods: {</span><br><span class="line">        handleClick() {</span><br><span class="line">          this.$emit(&quot;enlarge-text&quot;);</span><br><span class="line">        },</span><br><span class="line">      },</span><br><span class="line">    };</span><br><span class="line">    &lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>&#x4F7F;&#x7528;<code>emits</code>&#x9009;&#x9879;&#x58F0;&#x660E;&#x4E86;&#x8981;&#x629B;&#x51FA;&#x7684;&#x4E8B;&#x4EF6;&#x201D;enlarge-text&#x201D;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x70B9;&#x51FB;&#x6309;&#x94AE;&#x540E;&#x8C03;&#x7528;<code>this.$emit</code>&#x65B9;&#x6CD5;&#x629B;&#x51FA;<code>&quot;enlarge-text&quot;</code>&#x4E8B;&#x4EF6;&#x3002;&#x8FD9;&#x91CC;&#x7684;this&#x5927;&#x5BB6;&#x90FD;&#x77E5;&#x9053;&#x662F;&#x6307;&#x5411;&#x7684;&#x5F53;&#x524D;&#x7EC4;&#x4EF6;&#x7684;vue&#x5B9E;&#x4F8B;&#xFF0C;&#x6240;&#x4EE5;<code>this.$emit</code>&#x662F;&#x8C03;&#x7528;&#x7684;&#x5F53;&#x524D;vue&#x5B9E;&#x4F8B;&#x7684;<code>$emit</code>&#x65B9;&#x6CD5;&#x3002;<strong>&#x5927;&#x5BB6;&#x5148;&#x8BB0;&#x4F4F;vue2&#x7684;&#x9009;&#x9879;&#x5F0F;&#x8BED;&#x6CD5;&#x4F8B;&#x5B50;&#xFF0C;&#x540E;&#x9762;&#x6211;&#x4EEC;&#x8BB2;<code>defineEmits</code>&#x5B8F;&#x51FD;&#x6570;&#x7F16;&#x8BD1;&#x539F;&#x7406;&#x65F6;&#x4F1A;&#x7528;&#x3002;</strong></p>
<p><a href="/external_links/0dd90e10a2d0a625248e2f5baf67e451.html" target="blank" rel="noopener">&#x5173;&#x6CE8;&#x516C;&#x4F17;&#x53F7;&#xFF1A;&#x3010;&#x524D;&#x7AEF;&#x6B27;&#x9633;&#x3011;&#xFF0C;&#x89E3;&#x9501;&#x6211;&#x66F4;&#x591A;vue&#x539F;&#x7406;&#x6587;&#x7AE0;&#x3002;&#x8FD8;&#x53EF;&#x4EE5;&#x52A0;&#x6211;&#x5FAE;&#x4FE1;&#xFF0C;&#x8BA9;&#x4F60;&#x7684;&#x670B;&#x53CB;&#x5708;&#x591A;&#x4E00;&#x4F4D;&#x5BF9;vue&#x6709;&#x6DF1;&#x5165;&#x7406;&#x89E3;&#x7684;&#x4EBA;&#x3002;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5FAE;&#x4FE1;&#x7ED9;&#x6211;&#x8BF4;&#x4F60;&#x60F3;&#x770B;&#x54EA;&#x4E9B;vue&#x539F;&#x7406;&#x6587;&#x7AE0;&#xFF0C;&#x6211;&#x4F1A;&#x6839;&#x636E;&#x5927;&#x5BB6;&#x7684;&#x53CD;&#x9988;&#x8FDB;&#x884C;&#x521B;&#x4F5C;&#x3002;</a></p>
<p>&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;&#x770B;vue3&#x7684;&#x7EC4;&#x5408;&#x5F0F;&#x8BED;&#x6CD5;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;<code>composition-child.vue</code>&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">xml&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;template&gt;</span><br><span class="line">  &lt;button @click=&quot;handleClick&quot;&gt;&#x653E;&#x5927;&#x6587;&#x5B57;&lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">const emits = defineEmits([&quot;enlarge-text&quot;]);</span><br><span class="line">function handleClick() {</span><br><span class="line">  emits(&quot;enlarge-text&quot;);</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>&#x5728;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x4E86;<code>defineEmits</code>&#x5B8F;&#x51FD;&#x6570;&#x58F0;&#x660E;&#x4E86;&#x8981;&#x629B;&#x51FA;&#x7684;&#x4E8B;&#x4EF6;&#x201D;enlarge-text&#x201D;&#xFF0C;<code>defineEmits</code>&#x5B8F;&#x51FD;&#x6570;&#x6267;&#x884C;&#x540E;&#x8FD4;&#x56DE;&#x4E86;&#x4E00;&#x4E2A;<code>emits</code>&#x51FD;&#x6570;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x70B9;&#x51FB;&#x6309;&#x94AE;&#x540E;&#x4F7F;&#x7528;  <code>emits(&quot;enlarge-text&quot;)</code>&#x629B;&#x51FA;<code>&quot;enlarge-text&quot;</code>&#x4E8B;&#x4EF6;&#x3002;</p>
<h1 id="&#x901A;&#x8FC7;debug&#x641E;&#x6E05;&#x695A;&#x4E0A;&#x9762;&#x51E0;&#x4E2A;&#x95EE;&#x9898;"><a href="#&#x901A;&#x8FC7;debug&#x641E;&#x6E05;&#x695A;&#x4E0A;&#x9762;&#x51E0;&#x4E2A;&#x95EE;&#x9898;" class="headerlink" title="&#x901A;&#x8FC7;debug&#x641E;&#x6E05;&#x695A;&#x4E0A;&#x9762;&#x51E0;&#x4E2A;&#x95EE;&#x9898;"></a>&#x901A;&#x8FC7;debug&#x641E;&#x6E05;&#x695A;&#x4E0A;&#x9762;&#x51E0;&#x4E2A;&#x95EE;&#x9898;</h1><p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x8981;&#x641E;&#x6E05;&#x695A;&#x5E94;&#x8BE5;&#x5728;&#x54EA;&#x91CC;&#x6253;&#x65AD;&#x70B9;&#xFF0C;&#x5728;&#x6211;&#x4E4B;&#x524D;&#x7684;&#x6587;&#x7AE0; <a href="https://dev.newban.cn/7343139078486982710">vue&#x6587;&#x4EF6;&#x662F;&#x5982;&#x4F55;&#x7F16;&#x8BD1;&#x4E3A;js&#x6587;&#x4EF6;</a> &#x4E2D;&#x5DF2;&#x7ECF;&#x5E26;&#x4F60;&#x641E;&#x6E05;&#x695A;&#x4E86;&#x5C06;vue&#x6587;&#x4EF6;&#x4E2D;&#x7684;<code>&lt;script&gt;</code>&#x6A21;&#x5757;&#x7F16;&#x8BD1;&#x6210;&#x6D4F;&#x89C8;&#x5668;&#x53EF;&#x76F4;&#x63A5;&#x8FD0;&#x884C;&#x7684;js&#x4EE3;&#x7801;&#xFF0C;&#x5E95;&#x5C42;&#x5C31;&#x662F;&#x8C03;&#x7528;<code>vue/compiler-sfc</code>&#x5305;&#x7684;<code>compileScript</code>&#x51FD;&#x6570;&#x3002;&#x5F53;&#x7136;&#x5982;&#x679C;&#x4F60;&#x8FD8;&#x6CA1;&#x770B;&#x8FC7;&#x6211;&#x7684;<a href="https://dev.newban.cn/7343139078486982710">vue&#x6587;&#x4EF6;&#x662F;&#x5982;&#x4F55;&#x7F16;&#x8BD1;&#x4E3A;js&#x6587;&#x4EF6;</a> &#x6587;&#x7AE0;&#x4E5F;&#x4E0D;&#x5F71;&#x54CD;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x9605;&#x8BFB;&#x3002;</p>
<p>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5C06;&#x65AD;&#x70B9;&#x6253;&#x5728;<code>vue/compiler-sfc</code>&#x5305;&#x7684;<code>compileScript</code>&#x51FD;&#x6570;&#x4E2D;&#xFF0C;&#x4E00;&#x6837;&#x7684;&#x5957;&#x8DEF;&#xFF0C;&#x9996;&#x5148;&#x6211;&#x4EEC;&#x5728;vscode&#x7684;&#x6253;&#x5F00;&#x4E00;&#x4E2A;debug&#x7EC8;&#x7AEF;&#x3002;<br><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/07c7631f141486e3a53e52f93b5aa8bf98e7d288c382c984483c5e07d57e51b7" alt="debug-terminal"></p>
<p>&#x7136;&#x540E;&#x5728;node_modules&#x4E2D;&#x627E;&#x5230;<code>vue/compiler-sfc</code>&#x5305;&#x7684;<code>compileScript</code>&#x51FD;&#x6570;&#x6253;&#x4E0A;&#x65AD;&#x70B9;&#xFF0C;<code>compileScript</code>&#x51FD;&#x6570;&#x4F4D;&#x7F6E;&#x5728;<code>/node_modules/@vue/compiler-sfc/dist/compiler-sfc.cjs.js</code>&#x3002;&#x5728;debug&#x7EC8;&#x7AEF;&#x4E0A;&#x9762;&#x6267;&#x884C;<code>yarn dev</code>&#x540E;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x6253;&#x5F00;&#x5BF9;&#x5E94;&#x7684;&#x9875;&#x9762;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;<a href="/external_links/f993794d255bd1a46153e34df8e6817c.html" target="blank" rel="noopener">http://localhost:5173/</a> &#x3002;&#x6B64;&#x65F6;&#x65AD;&#x70B9;&#x5C31;&#x4F1A;&#x8D70;&#x5230;<code>compileScript</code>&#x51FD;&#x6570;&#x4E2D;&#xFF0C;&#x7531;&#x4E8E;&#x6BCF;&#x7F16;&#x8BD1;&#x4E00;&#x4E2A;<code>vue</code>&#x6587;&#x4EF6;&#x90FD;&#x8981;&#x8D70;&#x5230;&#x8FD9;&#x4E2A;debug&#x4E2D;&#xFF0C;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x53EA;&#x60F3;<code>debug</code>&#x770B;&#x770B;<code>composition-child.vue</code>&#x6587;&#x4EF6;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x524D;&#x9762;&#x4E3E;&#x7684;vue3&#x7684;&#x7EC4;&#x5408;&#x5F0F;&#x8BED;&#x6CD5;&#x7684;&#x4F8B;&#x5B50;&#x3002;&#x6240;&#x4EE5;&#x4E3A;&#x4E86;&#x65B9;&#x4FBF;&#x6211;&#x4EEC;&#x5728;<code>compileScript</code>&#x4E2D;&#x52A0;&#x4E86;&#x4E0B;&#x9762;&#x8FD9;&#x6837;&#x4E00;&#x6BB5;&#x4EE3;&#x7801;&#xFF0C;&#x5E76;&#x4E14;&#x53BB;&#x6389;&#x4E86;&#x5728;<code>compileScript</code>&#x51FD;&#x6570;&#x4E2D;&#x52A0;&#x7684;&#x65AD;&#x70B9;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x53EA;&#x6709;&#x7F16;&#x8BD1;<code>composition-child.vue</code>&#x6587;&#x4EF6;&#x65F6;&#x4F1A;&#x8D70;&#x8FDB;&#x65AD;&#x70B9;&#x3002;&#x52A0;&#x7684;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x4E2D;&#x7684;<code>sfc.fileName</code>&#x5C31;&#x662F;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x7684;&#x610F;&#x601D;&#xFF0C;&#x540E;&#x9762;&#x6211;&#x4EEC;&#x4F1A;&#x8BB2;&#x3002;<br><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/2eebdfc2e4defbc4028f0a036a2541544ec0f109929d3d32179afca3579f0375" alt="debug-terminal"></p>
<h2 id="compileScript-&#x51FD;&#x6570;"><a href="#compileScript-&#x51FD;&#x6570;" class="headerlink" title="compileScript &#x51FD;&#x6570;"></a><code>compileScript</code> &#x51FD;&#x6570;</h2><p>&#x6211;&#x4EEC;&#x518D;&#x6765;&#x56DE;&#x5FC6;&#x4E00;&#x4E0B;<code>composition-child.vue</code>&#x6587;&#x4EF6;&#x4E2D;&#x7684;<code>script</code>&#x6A21;&#x5757;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">xml&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">const emits = defineEmits([&quot;enlarge-text&quot;]);</span><br><span class="line"></span><br><span class="line">function handleClick() {</span><br><span class="line">  emits(&quot;enlarge-text&quot;);</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p><code>compileScript</code>&#x51FD;&#x6570;&#x5185;&#x5305;&#x542B;&#x4E86;&#x7F16;&#x8BD1;<code>script</code>&#x6A21;&#x5757;&#x7684;&#x6240;&#x6709;&#x7684;&#x903B;&#x8F91;&#xFF0C;&#x4EE3;&#x7801;&#x5F88;&#x590D;&#x6742;&#xFF0C;&#x5149;&#x662F;&#x6E90;&#x4EE3;&#x7801;&#x5C31;&#x63A5;&#x8FD1;1000&#x884C;&#x3002;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x6211;&#x4EEC;&#x540C;&#x6837;&#x4E0D;&#x4F1A;&#x53BB;&#x901A;&#x8BFB;<code>compileScript</code>&#x51FD;&#x6570;&#x7684;&#x6240;&#x6709;&#x529F;&#x80FD;&#xFF0C;&#x53EA;&#x8BB2;&#x6D89;&#x53CA;&#x5230;<code>defineEmits</code>&#x6D41;&#x7A0B;&#x7684;&#x4EE3;&#x7801;&#x3002;&#x8FD9;&#x4E2A;&#x662F;&#x6839;&#x636E;&#x6211;&#x4EEC;&#x8FD9;&#x4E2A;&#x573A;&#x666F;&#x5C06;<code>compileScript</code>&#x51FD;&#x6570;&#x7B80;&#x5316;&#x540E;&#x7684;&#x4EE3;&#x7801;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;function compileScript(sfc, options) {</span><br><span class="line">  const ctx = new ScriptCompileContext(sfc, options);</span><br><span class="line">  const startOffset = ctx.startOffset;</span><br><span class="line">  const endOffset = ctx.endOffset;</span><br><span class="line">  const scriptSetupAst = ctx.scriptSetupAst;</span><br><span class="line"></span><br><span class="line">  for (const node of scriptSetupAst.body) {</span><br><span class="line">    if (node.type === &quot;ExpressionStatement&quot;) {</span><br><span class="line">      // ...</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    if (node.type === &quot;VariableDeclaration&quot; &amp;&amp; !node.declare) {</span><br><span class="line">      const total = node.declarations.length;</span><br><span class="line">      for (let i = 0; i &lt; total; i++) {</span><br><span class="line">        const decl = node.declarations[i];</span><br><span class="line">        const init = decl.init;</span><br><span class="line">        if (init) {</span><br><span class="line">          const isDefineEmits = processDefineEmits(ctx, init, decl.id);</span><br><span class="line">          if (isDefineEmits) {</span><br><span class="line">            ctx.s.overwrite(</span><br><span class="line">              startOffset + init.start,</span><br><span class="line">              startOffset + init.end,</span><br><span class="line">              &quot;__emit&quot;</span><br><span class="line">            );</span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    if (</span><br><span class="line">      (node.type === &quot;VariableDeclaration&quot; &amp;&amp; !node.declare) ||</span><br><span class="line">      node.type.endsWith(&quot;Statement&quot;)</span><br><span class="line">    ) {</span><br><span class="line">      // ....</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  ctx.s.remove(0, startOffset);</span><br><span class="line">  ctx.s.remove(endOffset, source.length);</span><br><span class="line"></span><br><span class="line">  let runtimeOptions = ``;</span><br><span class="line">  const emitsDecl = genRuntimeEmits(ctx);</span><br><span class="line">  if (emitsDecl) runtimeOptions += `\n  emits: ${emitsDecl},`;</span><br><span class="line"></span><br><span class="line">  const def =</span><br><span class="line">    (defaultExport ? `\n  ...${normalScriptDefaultVar},` : ``) +</span><br><span class="line">    (definedOptions ? `\n  ...${definedOptions},` : &quot;&quot;);</span><br><span class="line">  ctx.s.prependLeft(</span><br><span class="line">    startOffset,</span><br><span class="line">    `\n${genDefaultAs} /*#__PURE__*/${ctx.helper(</span><br><span class="line">      `defineComponent`</span><br><span class="line">    )}({${def}${runtimeOptions}\n  ${</span><br><span class="line">      hasAwait ? `async ` : ``</span><br><span class="line">    }setup(${args}) {\n${exposeCall}`</span><br><span class="line">  );</span><br><span class="line">  ctx.s.appendRight(endOffset, `})`);</span><br><span class="line"></span><br><span class="line">  return {</span><br><span class="line">    //....</span><br><span class="line">    content: ctx.s.toString(),</span><br><span class="line">  };</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5982;&#x679C;&#x770B;&#x8FC7;&#x6211;&#x4E0A;&#x4E00;&#x7BC7; <a href="https://dev.newban.cn/7345129748006354978">&#x4E3A;&#x4EC0;&#x4E48;defineProps&#x5B8F;&#x51FD;&#x6570;&#x4E0D;&#x9700;&#x8981;&#x4ECE;vue&#x4E2D;import&#x5BFC;&#x5165;&#xFF1F;</a>&#x6587;&#x7AE0;&#x7684;&#x5C0F;&#x4F19;&#x4F34;&#x5E94;&#x8BE5;&#x4F1A;&#x5F88;&#x719F;&#x6089;&#x8FD9;&#x4E2A;<code>compileScript</code>&#x51FD;&#x6570;&#xFF0C;<code>compileScript</code>&#x51FD;&#x6570;&#x5185;&#x5904;&#x7406;<code>defineProps</code>&#x548C;<code>defineEmits</code>&#x5927;&#x4F53;&#x6D41;&#x7A0B;&#x5176;&#x5B9E;&#x5F88;&#x76F8;&#x4F3C;&#x7684;&#x3002;</p>
<h3 id="ScriptCompileContext&#x7C7B;"><a href="#ScriptCompileContext&#x7C7B;" class="headerlink" title="ScriptCompileContext&#x7C7B;"></a>ScriptCompileContext&#x7C7B;</h3><p>&#x6211;&#x4EEC;&#x5C06;&#x65AD;&#x70B9;&#x8D70;&#x5230;<code>compileScript</code>&#x51FD;&#x6570;&#x4E2D;&#x7684;&#x7B2C;&#x4E00;&#x90E8;&#x5206;&#x4EE3;&#x7801;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;function compileScript(sfc, options) {</span><br><span class="line">  const ctx = new ScriptCompileContext(sfc, options);</span><br><span class="line">  const startOffset = ctx.startOffset;</span><br><span class="line">  const endOffset = ctx.endOffset;</span><br><span class="line">  const scriptSetupAst = ctx.scriptSetupAst;</span><br><span class="line">  // ...&#x7701;&#x7565;</span><br><span class="line">  return {</span><br><span class="line">    //....</span><br><span class="line">    content: ctx.s.toString(),</span><br><span class="line">  };</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x90E8;&#x5206;&#x4EE3;&#x7801;&#x4E3B;&#x8981;&#x4F7F;&#x7528;<code>ScriptCompileContext</code>&#x7C7B;new&#x4E86;&#x4E00;&#x4E2A;<code>ctx</code>&#x4E0A;&#x4E0B;&#x6587;&#x5BF9;&#x8C61;&#xFF0C;&#x5E76;&#x4E14;&#x8BFB;&#x53D6;&#x4E86;&#x4E0A;&#x4E0B;&#x6587;&#x5BF9;&#x8C61;&#x4E2D;&#x7684;<code>startOffset</code>&#x3001;<code>endOffset</code>&#x3001;<code>scriptSetupAst</code>&#x3001;<code>s</code>&#x56DB;&#x4E2A;&#x5C5E;&#x6027;&#x3002;&#x6211;&#x4EEC;&#x5C06;&#x65AD;&#x70B9;&#x8D70;&#x8FDB;<code>ScriptCompileContext</code>&#x7C7B;&#xFF0C;&#x770B;&#x770B;&#x4ED6;&#x7684;<code>constructor</code>&#x6784;&#x9020;&#x51FD;&#x6570;&#x3002;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x662F;&#x6211;&#x7B80;&#x5316;&#x540E;&#x7684;<code>ScriptCompileContext</code>&#x7C7B;&#x7684;&#x4EE3;&#x7801;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;import MagicString from &apos;magic-string&apos;</span><br><span class="line"></span><br><span class="line">class ScriptCompileContext {</span><br><span class="line">  source = this.descriptor.source</span><br><span class="line">  s = new MagicString(this.source)</span><br><span class="line">  startOffset = this.descriptor.scriptSetup?.loc.start.offset</span><br><span class="line">  endOffset = this.descriptor.scriptSetup?.loc.end.offset</span><br><span class="line"></span><br><span class="line">  constructor(descriptor, options) {</span><br><span class="line">    this.descriptor = descriptor;</span><br><span class="line">    this.s = new MagicString(this.source);</span><br><span class="line">    this.scriptSetupAst = descriptor.scriptSetup &amp;&amp; parse(descriptor.scriptSetup.content, this.startOffset);</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5728;<code>compileScript</code>&#x51FD;&#x6570;&#x4E2D;<code>new ScriptCompileContext</code>&#x65F6;&#x4F20;&#x5165;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x662F;<code>sfc</code>&#x53D8;&#x91CF;&#xFF0C;&#x7136;&#x540E;&#x5728;<code>ScriptCompileContext</code>&#x7C7B;&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#x4E2D;&#x662F;&#x4F7F;&#x7528;<code>descriptor</code>&#x53D8;&#x91CF;&#x6765;&#x63A5;&#x6536;&#xFF0C;&#x63A5;&#x7740;&#x8D4B;&#x503C;&#x7ED9;<code>descriptor</code>&#x5C5E;&#x6027;&#x3002;</p>
<p>&#x5728;&#x4E4B;&#x524D;&#x7684;<a href="https://dev.newban.cn/7343139078486982710">vue&#x6587;&#x4EF6;&#x662F;&#x5982;&#x4F55;&#x7F16;&#x8BD1;&#x4E3A;js&#x6587;&#x4EF6;</a> &#x6587;&#x7AE0;&#x4E2D;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x8BB2;&#x8FC7;&#x4E86;&#x4F20;&#x5165;&#x7ED9;<code>compileScript</code>&#x51FD;&#x6570;&#x7684;<code>sfc</code>&#x53D8;&#x91CF;&#x662F;&#x4E00;&#x4E2A;<code>descriptor</code>&#x5BF9;&#x8C61;&#xFF0C;<code>descriptor</code>&#x5BF9;&#x8C61;&#x662F;&#x7531;vue&#x6587;&#x4EF6;&#x7F16;&#x8BD1;&#x6765;&#x7684;&#x3002;<code>descriptor</code>&#x5BF9;&#x8C61;&#x62E5;&#x6709;template&#x5C5E;&#x6027;&#x3001;scriptSetup&#x5C5E;&#x6027;&#x3001;style&#x5C5E;&#x6027;&#x3001;source&#x5C5E;&#x6027;&#xFF0C;&#x5206;&#x522B;&#x5BF9;&#x5E94;vue&#x6587;&#x4EF6;&#x7684;<code>&lt;template&gt;</code>&#x6A21;&#x5757;&#x3001;<code>&lt;script setup&gt;</code>&#x6A21;&#x5757;&#x3001;<code>&lt;style&gt;</code>&#x6A21;&#x5757;&#x3001;&#x6E90;&#x4EE3;&#x7801;code&#x5B57;&#x7B26;&#x4E32;&#x3002;&#x5728;&#x6211;&#x4EEC;&#x8FD9;&#x4E2A;&#x573A;&#x666F;&#x53EA;&#x5173;&#x6CE8;<code>scriptSetup</code>&#x548C;<code>source</code>&#x5C5E;&#x6027;&#x5C31;&#x884C;&#x4E86;&#xFF0C;&#x5176;&#x4E2D;<code>sfc.scriptSetup.content</code>&#x7684;&#x503C;&#x5C31;&#x662F;<code>&lt;script setup&gt;</code>&#x6A21;&#x5757;&#x4E2D;code&#x4EE3;&#x7801;&#x5B57;&#x7B26;&#x4E32;&#x3002;&#x8BE6;&#x60C5;&#x67E5;&#x770B;&#x4E0B;&#x56FE;&#xFF1A;<br><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/a7af086393b76ed5686f7202d7286fc4c0e06aa5284dff8cbf9e88b68ec1335d" alt="composition-child"></p>
<p>&#x73B0;&#x5728;&#x6211;&#x60F3;&#x4F60;&#x5DF2;&#x7ECF;&#x641E;&#x6E05;&#x695A;&#x4E86;<code>ctx</code>&#x4E0A;&#x4E0B;&#x6587;&#x5BF9;&#x8C61;4&#x4E2A;&#x5C5E;&#x6027;&#x4E2D;&#x7684;<code>startOffset</code>&#x5C5E;&#x6027;&#x548C;<code>endOffset</code>&#x5C5E;&#x6027;&#x4E86;&#xFF0C;<code>startOffset</code>&#x548C;<code>endOffset</code>&#x5206;&#x522B;&#x5BF9;&#x5E94;&#x7684;&#x5C31;&#x662F;<code>descriptor.scriptSetup?.loc.start.offset</code>&#x548C;<code>descriptor.scriptSetup?.loc.end.offset</code>&#x3002;<code>startOffset</code>&#x4E3A;<code>&lt;script setup&gt;</code>&#x6A21;&#x5757;&#x4E2D;&#x7684;&#x5185;&#x5BB9;&#x5F00;&#x59CB;&#x7684;&#x4F4D;&#x7F6E;&#x3002;<code>endOffset</code>&#x4E3A;<code>&lt;script setup&gt;</code>&#x6A21;&#x5757;&#x4E2D;&#x7684;&#x5185;&#x5BB9;&#x7ED3;&#x675F;&#x7684;&#x4F4D;&#x7F6E;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x63A5;&#x7740;&#x6765;&#x770B;&#x6784;&#x9020;&#x51FD;&#x6570;&#x4E2D;&#x7684;<code>this.s = new MagicString(this.source)</code>&#x8FD9;&#x6BB5;&#x8BDD;&#xFF0C;<code>this.source</code>&#x662F;vue&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x6E90;&#x4EE3;&#x7801;code&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x4EE5;&#x8FD9;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;new&#x4E86;&#x4E00;&#x4E2A;<code>MagicString</code>&#x5BF9;&#x8C61;&#x8D4B;&#x503C;&#x7ED9;<code>s</code>&#x5C5E;&#x6027;&#x3002;<code>magic-string</code>&#x662F;&#x4E00;&#x4E2A;&#x7528;&#x4E8E;&#x9AD8;&#x6548;&#x64CD;&#x4F5C;&#x5B57;&#x7B26;&#x4E32;&#x7684; JavaScript &#x5E93;&#x3002;&#x5B83;&#x63D0;&#x4F9B;&#x4E30;&#x5BCC;&#x7684; API&#xFF0C;&#x53EF;&#x4EE5;&#x8F7B;&#x677E;&#x5730;&#x5BF9;&#x5B57;&#x7B26;&#x4E32;&#x8FDB;&#x884C;&#x63D2;&#x5165;&#x3001;&#x5220;&#x9664;&#x3001;&#x66FF;&#x6362;&#x7B49;&#x64CD;&#x4F5C;&#x3002;&#x6211;&#x4EEC;&#x8FD9;&#x91CC;&#x4E3B;&#x8981;&#x7528;&#x5230;<code>toString</code>&#x3001;<code>remove</code>&#x3001;<code>overwrite</code>&#x3001;<code>prependLeft</code>&#x3001;<code>appendRight</code>&#x4E94;&#x4E2A;&#x65B9;&#x6CD5;&#x3002;<code>toString</code>&#x65B9;&#x6CD5;&#x7528;&#x4E8E;&#x751F;&#x6210;&#x7ECF;&#x8FC7;&#x5904;&#x7406;&#x540E;&#x8FD4;&#x56DE;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x5176;&#x4F59;&#x51E0;&#x4E2A;&#x65B9;&#x6CD5;&#x6211;&#x4E3E;&#x51E0;&#x4E2A;&#x4F8B;&#x5B50;&#x4F60;&#x5E94;&#x8BE5;&#x5C31;&#x660E;&#x767D;&#x4E86;&#x3002;</p>
<p><code>s.remove( start, end )</code>&#x7528;&#x4E8E;&#x5220;&#x9664;&#x4ECE;&#x5F00;&#x59CB;&#x5230;&#x7ED3;&#x675F;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;const s = new MagicString(&apos;hello word&apos;);</span><br><span class="line">s.remove(0, 6);</span><br><span class="line">s.toString(); // &apos;word&apos;</span><br></pre></td></tr></table></figure>

<p><code>s.overwrite( start, end, content )</code>&#xFF0C;&#x4F7F;&#x7528;<code>content</code>&#x7684;&#x5185;&#x5BB9;&#x66FF;&#x6362;&#x5F00;&#x59CB;&#x4F4D;&#x7F6E;&#x5230;&#x7ED3;&#x675F;&#x4F4D;&#x7F6E;&#x7684;&#x5185;&#x5BB9;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;const s = new MagicString(&apos;hello word&apos;);</span><br><span class="line">s.overwrite(0, 5, &quot;&#x4F60;&#x597D;&quot;);</span><br><span class="line">s.toString(); // &apos;&#x4F60;&#x597D; word&apos;</span><br></pre></td></tr></table></figure>

<p><code>s.prependLeft( index, content )</code>&#x7528;&#x4E8E;&#x5728;&#x6307;&#x5B9A;<code>index</code>&#x7684;&#x524D;&#x9762;&#x63D2;&#x5165;&#x5B57;&#x7B26;&#x4E32;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;const s = new MagicString(&apos;hello word&apos;);</span><br><span class="line">s.prependLeft(5, &apos;xx&apos;);</span><br><span class="line">s.toString(); // &apos;helloxx word&apos;</span><br></pre></td></tr></table></figure>

<p><code>s.appendRight( index, content )</code>&#x7528;&#x4E8E;&#x5728;&#x6307;&#x5B9A;<code>index</code>&#x7684;&#x540E;&#x9762;&#x63D2;&#x5165;&#x5B57;&#x7B26;&#x4E32;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;const s = new MagicString(&apos;hello word&apos;);</span><br><span class="line">s.appendRight(5, &apos;xx&apos;);</span><br><span class="line">s.toString(); // &apos;helloxx word&apos;</span><br></pre></td></tr></table></figure>

<p>&#x73B0;&#x5728;&#x4F60;&#x5E94;&#x8BE5;&#x5DF2;&#x7ECF;&#x660E;&#x767D;&#x4E86;<code>ctx</code>&#x4E0A;&#x4E0B;&#x6587;&#x5BF9;&#x8C61;&#x4E2D;&#x7684;<code>s</code>&#x5C5E;&#x6027;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x63A5;&#x7740;&#x6765;&#x770B;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x5C5E;&#x6027;<code>scriptSetupAst</code>&#x3002;&#x5728;&#x6784;&#x9020;&#x51FD;&#x6570;&#x4E2D;&#x662F;&#x7531;<code>parse</code>&#x51FD;&#x6570;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x8D4B;&#x503C;&#x7684;&#xFF1A; <code>this.scriptSetupAst = descriptor.scriptSetup &amp;&amp; parse(descriptor.scriptSetup.content, this.startOffset)</code>&#x3002;<code>parse</code>&#x51FD;&#x6570;&#x7684;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">typescript&#x590D;&#x5236;&#x4EE3;&#x7801;import { parse as babelParse } from &apos;@babel/parser&apos;</span><br><span class="line"></span><br><span class="line">function parse(input: string, offset: number): Program {</span><br><span class="line">  try {</span><br><span class="line">    return babelParse(input, {</span><br><span class="line">      plugins,</span><br><span class="line">      sourceType: &apos;module&apos;,</span><br><span class="line">    }).program</span><br><span class="line">  } catch (e: any) {</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x6211;&#x4EEC;&#x5728;&#x524D;&#x9762;&#x5DF2;&#x7ECF;&#x8BB2;&#x8FC7;&#x4E86;<code>descriptor.scriptSetup.content</code>&#x7684;&#x503C;&#x5C31;&#x662F;<code>vue</code>&#x6587;&#x4EF6;&#x4E2D;&#x7684;<code>&lt;script setup&gt;</code>&#x6A21;&#x5757;&#x7684;&#x4EE3;&#x7801;<code>code</code>&#x5B57;&#x7B26;&#x4E32;&#xFF0C;<code>parse</code>&#x51FD;&#x6570;&#x4E2D;&#x8C03;&#x7528;&#x4E86;<code>babel</code>&#x63D0;&#x4F9B;&#x7684;<code>parser</code>&#x51FD;&#x6570;&#xFF0C;&#x5C06;<code>vue</code>&#x6587;&#x4EF6;&#x4E2D;&#x7684;<code>&lt;script setup&gt;</code>&#x6A21;&#x5757;&#x7684;&#x4EE3;&#x7801;<code>code</code>&#x5B57;&#x7B26;&#x4E32;&#x8F6C;&#x6362;&#x6210;<code>AST&#x62BD;&#x8C61;&#x8BED;&#x6CD5;&#x6811;</code>&#x3002;</p>
<p>&#x5728;<code>ScriptCompileContext</code>&#x6784;&#x9020;&#x51FD;&#x6570;&#x4E2D;&#x4E3B;&#x8981;&#x505A;&#x4E86;&#x4E0B;&#x9762;&#x8FD9;&#x4E9B;&#x4E8B;&#x60C5;&#xFF1A;<br><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/779d5c1197cfeb9c7fa822156343010e9591daa8b03148879457f34b35149c26" alt="progress1"></p>
<h3 id="processDefineEmits&#x51FD;&#x6570;"><a href="#processDefineEmits&#x51FD;&#x6570;" class="headerlink" title="processDefineEmits&#x51FD;&#x6570;"></a>processDefineEmits&#x51FD;&#x6570;</h3><p>&#x6211;&#x4EEC;&#x63A5;&#x7740;&#x5C06;&#x65AD;&#x70B9;&#x8D70;&#x5230;<code>compileScript</code>&#x51FD;&#x6570;&#x4E2D;&#x7684;&#x7B2C;&#x4E8C;&#x90E8;&#x5206;&#xFF0C;<code>for</code>&#x5FAA;&#x73AF;&#x904D;&#x5386;AST&#x62BD;&#x8C61;&#x8BED;&#x6CD5;&#x6811;&#x7684;&#x5730;&#x65B9;&#xFF0C;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;function compileScript(sfc, options) {</span><br><span class="line">  // ...&#x7701;&#x7565;</span><br><span class="line">  for (const node of scriptSetupAst.body) {</span><br><span class="line">    if (node.type === &quot;ExpressionStatement&quot;) {</span><br><span class="line">      // ...</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    if (node.type === &quot;VariableDeclaration&quot; &amp;&amp; !node.declare) {</span><br><span class="line">      const total = node.declarations.length;</span><br><span class="line">      for (let i = 0; i &lt; total; i++) {</span><br><span class="line">        const decl = node.declarations[i];</span><br><span class="line">        const init = decl.init;</span><br><span class="line">        if (init) {</span><br><span class="line">          const isDefineEmits = processDefineEmits(ctx, init, decl.id);</span><br><span class="line">          if (isDefineEmits) {</span><br><span class="line">            ctx.s.overwrite(</span><br><span class="line">              startOffset + init.start,</span><br><span class="line">              startOffset + init.end,</span><br><span class="line">              &quot;__emit&quot;</span><br><span class="line">            );</span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    if (</span><br><span class="line">      (node.type === &quot;VariableDeclaration&quot; &amp;&amp; !node.declare) ||</span><br><span class="line">      node.type.endsWith(&quot;Statement&quot;)</span><br><span class="line">    ) {</span><br><span class="line">      // ....</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  // ...&#x7701;&#x7565;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x770B;&#x8FC7;&#x6211;&#x4E0A;&#x4E00;&#x7BC7; <a href="https://dev.newban.cn/7345129748006354978">&#x4E3A;&#x4EC0;&#x4E48;defineProps&#x5B8F;&#x51FD;&#x6570;&#x4E0D;&#x9700;&#x8981;&#x4ECE;vue&#x4E2D;import&#x5BFC;&#x5165;&#xFF1F;</a>&#x53EF;&#x80FD;&#x4F1A;&#x7591;&#x60D1;&#x4E86;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x8FD9;&#x91CC;&#x4E0D;&#x5217;&#x51FA;&#x6EE1;&#x8DB3;<code>node.type === &quot;ExpressionStatement&quot;</code>&#x6761;&#x4EF6;&#x7684;&#x4EE3;&#x7801;&#x5462;&#x3002;&#x539F;&#x56E0;&#x662F;&#x5728;&#x4E0A;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;&#x4E2D;&#x6211;&#x4EEC;&#x6CA1;&#x6709;&#x5C06;<code>defineProps</code>&#x51FD;&#x6570;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x8D4B;&#x503C;&#x7ED9;&#x4E00;&#x4E2A;&#x53D8;&#x91CF;&#xFF0C;&#x4ED6;&#x662F;&#x4E00;&#x6761;&#x8868;&#x8FBE;&#x5F0F;&#x8BED;&#x53E5;&#xFF0C;&#x6240;&#x4EE5;&#x6EE1;&#x8DB3;<code>node.type === &quot;ExpressionStatement&quot;</code>&#x7684;&#x6761;&#x4EF6;&#x3002;&#x5728;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x4E2D;&#x6211;&#x4EEC;&#x5C06;<code>defineEmits</code>&#x51FD;&#x6570;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x8D4B;&#x503C;&#x7ED9;&#x4E00;&#x4E2A;<code>emits</code>&#x53D8;&#x91CF;&#xFF0C;&#x4ED6;&#x662F;&#x4E00;&#x6761;&#x53D8;&#x91CF;&#x58F0;&#x660E;&#x8BED;&#x53E5;&#xFF0C;&#x6240;&#x4EE5;&#x4ED6;&#x6EE1;&#x8DB3;<code>node.type === &quot;VariableDeclaration&quot;</code> &#x7684;&#x6761;&#x4EF6;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">scss&#x590D;&#x5236;&#x4EE3;&#x7801;// &#x8868;&#x8FBE;&#x5F0F;&#x8BED;&#x53E5;</span><br><span class="line">defineProps({</span><br><span class="line">  content: String,</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">// &#x53D8;&#x91CF;&#x58F0;&#x660E;&#x8BED;&#x53E5;</span><br><span class="line">const emits = defineEmits([&quot;enlarge-text&quot;]);</span><br></pre></td></tr></table></figure>

<p>&#x5C06;&#x65AD;&#x70B9;&#x8D70;&#x8FDB;for&#x5FAA;&#x73AF;&#x91CC;&#x9762;&#xFF0C;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x5728;script&#x6A21;&#x5757;&#x4E2D;&#x7B2C;&#x4E00;&#x884C;&#x4EE3;&#x7801;&#x662F;&#x53D8;&#x91CF;&#x58F0;&#x660E;&#x8BED;&#x53E5;<code>const emits = defineEmits([&quot;enlarge-text&quot;]);</code>&#x3002;&#x5728;console&#x4E2D;&#x770B;&#x770B;&#x7531;&#x8FD9;&#x6761;&#x53D8;&#x91CF;&#x58F0;&#x660E;&#x8BED;&#x53E5;&#x7F16;&#x8BD1;&#x6210;&#x7684;node&#x8282;&#x70B9;&#x957F;&#x4EC0;&#x4E48;&#x6837;&#x5B50;&#xFF0C;&#x5982;&#x4E0B;&#x56FE;&#xFF1A;<br><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/13e547d21d2097e69af4d8f9a68b87b604f0575e27e2b17bbbf28b10e5cf38de" alt="first-node"></p>
<p>&#x4ECE;&#x4E0A;&#x56FE;&#x4E2D;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5F53;&#x524D;&#x7684;<code>node</code>&#x8282;&#x70B9;&#x7C7B;&#x578B;&#x4E3A;&#x53D8;&#x91CF;&#x58F0;&#x660E;&#x8BED;&#x53E5;&#xFF0C;&#x5E76;&#x4E14;<code>node.declare</code>&#x7684;&#x503C;&#x4E3A;<code>undefined</code>&#x3002;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;&#x770B;<code>node.declarations</code>&#x5B57;&#x6BB5;&#xFF0C;&#x4ED6;&#x8868;&#x793A;&#x8BE5;&#x8282;&#x70B9;&#x7684;&#x6240;&#x6709;&#x58F0;&#x660E;&#x5B50;&#x8282;&#x70B9;&#x3002;&#x8FD9;&#x53E5;&#x8BDD;&#x662F;&#x4EC0;&#x4E48;&#x610F;&#x601D;&#x5462;&#xFF1F;&#x8BF4;&#x4EBA;&#x8BDD;&#x5C31;&#x662F;&#x8868;&#x793A;const&#x53F3;&#x8FB9;&#x7684;&#x8BED;&#x53E5;&#x3002;&#x90A3;&#x4E3A;&#x4EC0;&#x4E48;<code>declarations</code>&#x662F;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;&#x5462;&#xFF1F;&#x90A3;&#x662F;&#x56E0;&#x4E3A;const&#x53F3;&#x8FB9;&#x53EF;&#x4EE5;&#x6709;&#x591A;&#x6761;&#x8BED;&#x53E5;&#xFF0C;&#x6BD4;&#x5982;<code>const a = 2, b = 4;</code>&#x3002;&#x5728;&#x6211;&#x4EEC;&#x8FD9;&#x4E2A;&#x573A;&#x666F;<code>node.declarations</code>&#x5B57;&#x6BB5;&#x5C31;&#x662F;&#x8868;&#x793A;<code>emits = defineEmits([&quot;enlarge-text&quot;]);</code>&#x3002;&#x63A5;&#x7740;&#x6765;&#x770B;<code>declarations</code>&#x6570;&#x7EC4;&#x4E0B;&#x7684;<code>init</code>&#x5B57;&#x6BB5;&#xFF0C;&#x4ECE;&#x540D;&#x5B57;&#x6211;&#x60F3;&#x4F60;&#x5E94;&#x8BE5;&#x5DF2;&#x7ECF;&#x731C;&#x5230;&#x4E86;&#x4ED6;&#x7684;&#x4F5C;&#x7528;&#x662F;&#x8868;&#x793A;&#x53D8;&#x91CF;&#x7684;&#x521D;&#x59CB;&#x5316;&#x503C;&#xFF0C;&#x5728;&#x6211;&#x4EEC;&#x8FD9;&#x4E2A;&#x573A;&#x666F;<code>init</code>&#x5B57;&#x6BB5;&#x5C31;&#x662F;&#x8868;&#x793A;<code>defineEmits([&quot;enlarge-text&quot;])</code>&#x3002;&#x800C;<code>init.start</code>&#x8868;&#x793A;<code>defineEmits([&quot;enlarge-text&quot;]);</code>&#x4E2D;&#x7684;&#x5F00;&#x59CB;&#x4F4D;&#x7F6E;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5B57;&#x7B26;&#x4E32;&#x2019;d&#x2019;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;<code>init.end</code>&#x8868;&#x793A;<code>defineEmits([&quot;enlarge-text&quot;]);</code>&#x4E2D;&#x7684;&#x7ED3;&#x675F;&#x4F4D;&#x7F6E;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5B57;&#x7B26;&#x4E32;&#x2019;;&#x2019;&#x7684;&#x4F4D;&#x7F6E;&#x3002;</p>
<p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5C06;&#x65AD;&#x70B9;&#x8D70;&#x5230;if&#x8BED;&#x53E5;&#x5185;&#xFF0C;&#x4E0B;&#x9762;&#x7684;&#x8FD9;&#x4E9B;&#x4EE3;&#x7801;&#x6211;&#x60F3;&#x4F60;&#x5E94;&#x8BE5;&#x80FD;&#x591F;&#x5F88;&#x8F7B;&#x677E;&#x7684;&#x7406;&#x89E3;&#x4E86;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;if (node.type === &quot;VariableDeclaration&quot; &amp;&amp; !node.declare) {</span><br><span class="line">  const total = node.declarations.length;</span><br><span class="line">  for (let i = 0; i &lt; total; i++) {</span><br><span class="line">    const decl = node.declarations[i];</span><br><span class="line">    const init = decl.init;</span><br><span class="line">    if (init) {</span><br><span class="line">      const isDefineEmits = processDefineEmits(ctx, init, decl.id);</span><br><span class="line">      // &#x7701;&#x7565;...</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x6211;&#x4EEC;&#x5728;&#x63A7;&#x5236;&#x53F0;&#x4E2D;&#x5DF2;&#x7ECF;&#x770B;&#x5230;&#x4E86;<code>node.declare</code>&#x7684;&#x503C;&#x662F;<code>undefined</code>&#xFF0C;&#x5E76;&#x4E14;&#x8FD9;&#x4E5F;&#x662F;&#x4E00;&#x6761;&#x53D8;&#x91CF;&#x58F0;&#x660E;&#x8BED;&#x53E5;&#xFF0C;&#x6240;&#x4EE5;&#x65AD;&#x70B9;&#x4F1A;&#x8D70;&#x5230;if&#x91CC;&#x9762;&#x3002;&#x7531;&#x4E8E;&#x6211;&#x4EEC;&#x8FD9;&#x91CC;&#x53EA;&#x58F0;&#x660E;&#x4E86;&#x4E00;&#x4E2A;&#x53D8;&#x91CF;&#xFF0C;&#x6240;&#x4EE5;<code>node.declarations</code>&#x6570;&#x7EC4;&#x4E2D;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x503C;&#xFF0C;&#x8FD9;&#x4E2A;&#x503C;&#x5C31;&#x662F;&#x5BF9;&#x5E94;&#x7684;<code>emits = defineEmits([&quot;enlarge-text&quot;]);</code>&#x3002;&#x63A5;&#x7740;&#x904D;&#x5386;<code>node.declarations</code>&#x6570;&#x7EC4;&#xFF0C;&#x5C06;&#x6570;&#x7EC4;&#x4E2D;&#x7684;item&#x8D4B;&#x503C;&#x7ED9;<code>decl</code>&#x53D8;&#x91CF;&#xFF0C;&#x7136;&#x540E;&#x4F7F;&#x7528;<code>decl.init</code>&#x8BFB;&#x53D6;&#x5230;&#x53D8;&#x91CF;&#x58F0;&#x660E;&#x8BED;&#x53E5;&#x4E2D;&#x7684;&#x521D;&#x59CB;&#x5316;&#x503C;&#xFF0C;&#x5728;&#x6211;&#x4EEC;&#x8FD9;&#x91CC;&#x521D;&#x59CB;&#x5316;&#x503C;&#x5C31;&#x662F;<code>defineEmits([&quot;enlarge-text&quot;]);</code>&#x3002;&#x5982;&#x679C;&#x6709;&#x521D;&#x59CB;&#x5316;&#x503C;&#xFF0C;&#x90A3;&#x5C31;&#x5C06;&#x4ED6;&#x4F20;&#x5165;&#x7ED9;<code>processDefineEmits</code>&#x51FD;&#x6570;&#x5224;&#x65AD;&#x662F;&#x5426;&#x5728;&#x8C03;&#x7528;<code>defineEmits</code>&#x51FD;&#x6570;&#x3002;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x770B;<code>processDefineEmits</code>&#x51FD;&#x6570;&#x662F;&#x4EC0;&#x4E48;&#x6837;&#x7684;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;const DEFINE_EMITS = &quot;defineEmits&quot;;</span><br><span class="line">function processDefineEmits(ctx, node, declId) {</span><br><span class="line">  if (!isCallOf(node, DEFINE_EMITS)) {</span><br><span class="line">    return false;</span><br><span class="line">  }</span><br><span class="line">  ctx.emitsRuntimeDecl = node.arguments[0];</span><br><span class="line">  return true;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5728; <code>processDefineEmits</code> &#x51FD;&#x6570;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x9996;&#x5148;&#x4F7F;&#x7528; <code>isCallOf</code> &#x51FD;&#x6570;&#x5224;&#x65AD;&#x5F53;&#x524D;&#x7684; AST &#x8BED;&#x6CD5;&#x6811;&#x8282;&#x70B9; node &#x662F;&#x5426;&#x5728;&#x8C03;&#x7528; <code>defineEmits</code> &#x51FD;&#x6570;&#x3002;<code>isCallOf</code> &#x51FD;&#x6570;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x662F; node &#x8282;&#x70B9;&#xFF0C;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#x5728;&#x8FD9;&#x91CC;&#x662F;&#x5199;&#x6B7B;&#x7684;&#x5B57;&#x7B26;&#x4E32; &#x201C;defineEmits&#x201D;&#x3002;isCallOf&#x7684;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;export function isCallOf(node, test) {</span><br><span class="line">  return !!(</span><br><span class="line">    node &amp;&amp;</span><br><span class="line">    test &amp;&amp;</span><br><span class="line">    node.type === &quot;CallExpression&quot; &amp;&amp;</span><br><span class="line">    node.callee.type === &quot;Identifier&quot; &amp;&amp;</span><br><span class="line">    (typeof test === &quot;string&quot;</span><br><span class="line">      ? node.callee.name === test</span><br><span class="line">      : test(node.callee.name))</span><br><span class="line">  );</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x6211;&#x4EEC;&#x5728;debug console&#x4E2D;&#x5C06;<code>node.type</code>&#x3001;<code>node.callee.type</code>&#x3001;<code>node.callee.name</code>&#x7684;&#x503C;&#x6253;&#x5370;&#x51FA;&#x6765;&#x770B;&#x770B;&#x3002;<br><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/785a655f71c8451c961e08862023d4bcac5392a364046ada566a00de05086ac7" alt="isCallOf"></p>
<p>&#x4ECE;&#x56FE;&#x4E0A;&#x770B;&#x5230;<code>node.type</code>&#x3001;<code>node.callee.type</code>&#x3001;<code>node.callee.name</code>&#x7684;&#x503C;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x4E86;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x786E;&#x5B9E;&#x662F;&#x5728;&#x8C03;&#x7528; <code>defineEmits</code> &#x51FD;&#x6570;&#x3002;&#x6240;&#x4EE5;<code>isCallOf(node, DEFINE_EMITS)</code> &#x7684;&#x6267;&#x884C;&#x7ED3;&#x679C;&#x4E3A; true&#xFF0C;&#x5728; <code>processDefineEmits</code> &#x51FD;&#x6570;&#x4E2D;&#x6211;&#x4EEC;&#x662F;&#x5BF9; <code>isCallOf</code> &#x51FD;&#x6570;&#x7684;&#x6267;&#x884C;&#x7ED3;&#x679C;&#x53D6;&#x53CD;&#xFF0C;&#x6240;&#x4EE5; <code>!isCallOf(node, DEFINE_EMITS)</code> &#x7684;&#x6267;&#x884C;&#x7ED3;&#x679C;&#x4E3A; false&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x63A5;&#x7740;&#x6765;&#x770B;<code>processDefineEmits</code>&#x51FD;&#x6570;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;const DEFINE_EMITS = &quot;defineEmits&quot;;</span><br><span class="line">function processDefineEmits(ctx, node, declId) {</span><br><span class="line">  if (!isCallOf(node, DEFINE_EMITS)) {</span><br><span class="line">    return false;</span><br><span class="line">  }</span><br><span class="line">  ctx.emitsRuntimeDecl = node.arguments[0];</span><br><span class="line">  return true;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5982;&#x679C;&#x662F;&#x5728;&#x6267;&#x884C;<code>defineEmits</code>&#x51FD;&#x6570;&#xFF0C;&#x5C31;&#x4F1A;&#x6267;&#x884C;&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x4EE3;&#x7801;<code>ctx.emitsRuntimeDecl = node.arguments[0];</code>&#x3002;&#x5C06;&#x4F20;&#x5165;&#x7684;<code>node</code>&#x8282;&#x70B9;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x8D4B;&#x503C;&#x7ED9;<code>ctx</code>&#x4E0A;&#x4E0B;&#x6587;&#x5BF9;&#x8C61;&#x7684;<code>emitsRuntimeDecl</code>&#x5C5E;&#x6027;&#xFF0C;&#x8FD9;&#x91CC;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x8C03;&#x7528;<code>defineEmits</code>&#x51FD;&#x6570;&#x65F6;&#x7ED9;&#x4F20;&#x5165;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x3002;&#x4E3A;&#x4EC0;&#x4E48;&#x5199;&#x6B7B;&#x6210;&#x53D6;<code>arguments[0]</code>&#x5462;&#xFF1F;&#x662F;&#x56E0;&#x4E3A;<code>defineEmits</code>&#x51FD;&#x6570;&#x53EA;&#x63A5;&#x6536;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x4F20;&#x5165;&#x7684;&#x53C2;&#x6570;&#x53EF;&#x4EE5;&#x662F;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x6216;&#x8005;&#x6570;&#x7EC4;&#x3002;&#x6BD4;&#x5982;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">csharp&#x590D;&#x5236;&#x4EE3;&#x7801;const props = defineEmits({</span><br><span class="line">  &apos;enlarge-text&apos;: null</span><br><span class="line">})</span><br><span class="line"></span><br><span class="line">const emits = defineEmits([&apos;enlarge-text&apos;])</span><br></pre></td></tr></table></figure>

<p><strong>&#x8BB0;&#x4F4F;&#x8FD9;&#x4E2A;&#x5728;<code>ctx</code>&#x4E0A;&#x4E0B;&#x6587;&#x4E0A;&#x9762;&#x585E;&#x7684;<code>emitsRuntimeDecl</code>&#x5C5E;&#x6027;&#xFF0C;&#x540E;&#x9762;&#x4F1A;&#x7528;&#x5230;&#x3002;</strong></p>
<p>&#x81F3;&#x6B64;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x4E86;&#x89E3;&#x5230;&#x4E86;<code>processDefineEmits</code>&#x4E2D;&#x4E3B;&#x8981;&#x505A;&#x4E86;&#x4E24;&#x4EF6;&#x4E8B;&#xFF1A;&#x5224;&#x65AD;&#x5F53;&#x524D;&#x6267;&#x884C;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#x8BED;&#x53E5;&#x662F;&#x5426;&#x662F;<code>defineEmits</code>&#x51FD;&#x6570;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x90A3;&#x4E48;&#x5C31;&#x5C06;&#x8C03;&#x7528;<code>defineEmits</code>&#x51FD;&#x6570;&#x65F6;&#x4F20;&#x5165;&#x7684;&#x53C2;&#x6570;&#x8F6C;&#x6362;&#x6210;&#x7684;node&#x8282;&#x70B9;&#x585E;&#x5230;<code>ctx</code>&#x4E0A;&#x4E0B;&#x6587;&#x7684;<code>emitsRuntimeDecl</code>&#x5C5E;&#x6027;&#x4E2D;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x63A5;&#x7740;&#x6765;&#x770B;<code>compileScript</code>&#x51FD;&#x6570;&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;if (node.type === &quot;VariableDeclaration&quot; &amp;&amp; !node.declare) {</span><br><span class="line">  const total = node.declarations.length;</span><br><span class="line">  for (let i = 0; i &lt; total; i++) {</span><br><span class="line">    const decl = node.declarations[i];</span><br><span class="line">    const init = decl.init;</span><br><span class="line">    if (init) {</span><br><span class="line">      const isDefineEmits = processDefineEmits(ctx, init, decl.id);</span><br><span class="line">      if (isDefineEmits) {</span><br><span class="line">        ctx.s.overwrite(</span><br><span class="line">          startOffset + init.start,</span><br><span class="line">          startOffset + init.end,</span><br><span class="line">          &quot;__emit&quot;</span><br><span class="line">        );</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5C06;<code>processDefineEmits</code>&#x51FD;&#x6570;&#x7684;&#x6267;&#x884C;&#x7ED3;&#x679C;&#x8D4B;&#x503C;&#x8D4B;&#x503C;&#x7ED9;<code>isDefineEmits</code>&#x53D8;&#x91CF;&#xFF0C;&#x5728;&#x6211;&#x4EEC;&#x8FD9;&#x4E2A;&#x573A;&#x666F;&#x5F53;&#x7136;&#x662F;&#x5728;&#x8C03;&#x7528;<code>defineEmits</code>&#x51FD;&#x6570;&#xFF0C;&#x6240;&#x4EE5;&#x4F1A;&#x6267;&#x884C;if&#x8BED;&#x53E5;&#x5185;&#x7684;<code>ctx.s.overwrite</code>&#x65B9;&#x6CD5;&#x3002;<code>ctx.s.overwrite</code>&#x65B9;&#x6CD5;&#x6211;&#x4EEC;&#x524D;&#x9762;&#x5DF2;&#x7ECF;&#x8BB2;&#x8FC7;&#x4E86;&#xFF0C;&#x4F5C;&#x7528;&#x662F;&#x4F7F;&#x7528;&#x6307;&#x5B9A;&#x7684;&#x5185;&#x5BB9;&#x66FF;&#x6362;&#x5F00;&#x59CB;&#x4F4D;&#x7F6E;&#x5230;&#x7ED3;&#x675F;&#x4F4D;&#x7F6E;&#x7684;&#x5185;&#x5BB9;&#x3002;&#x5728;&#x6267;&#x884C;<code>ctx.s.overwrite</code>&#x524D;&#x6211;&#x4EEC;&#x5148;&#x5728;debug console&#x4E2D;&#x6267;&#x884C;<code>ctx.s.toString()</code>&#x770B;&#x770B;&#x5F53;&#x524D;&#x7684;code&#x4EE3;&#x7801;&#x5B57;&#x7B26;&#x4E32;&#x662F;&#x4EC0;&#x4E48;&#x6837;&#x7684;&#x3002;<br><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/8bb6b2cea0d23c4a5b77285936a8f2959adf44b2fd926a27a16c9a385e247680" alt="before-overwrite"></p>
<p>&#x4ECE;&#x4E0A;&#x56FE;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6B64;&#x65F6;&#x7684;code&#x4EE3;&#x7801;&#x5B57;&#x7B26;&#x4E32;&#x8FD8;&#x662F;&#x548C;&#x6211;&#x4EEC;&#x7684;&#x6E90;&#x4EE3;&#x7801;&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x63A5;&#x7740;&#x6765;&#x770B;<code>ctx.s.overwrite</code>&#x65B9;&#x6CD5;&#x63A5;&#x6536;&#x7684;&#x53C2;&#x6570;&#x3002;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x4E3A;<code>startOffset + init.start</code>&#xFF0C;<code>startOffset</code>&#x6211;&#x4EEC;&#x524D;&#x9762;&#x5DF2;&#x7ECF;&#x8BB2;&#x8FC7;&#x4E86;&#x4ED6;&#x7684;&#x503C;&#x4E3A;<code>script</code>&#x6A21;&#x5757;&#x7684;&#x5185;&#x5BB9;&#x5F00;&#x59CB;&#x7684;&#x4F4D;&#x7F6E;&#x3002;<code>init</code>&#x6211;&#x4EEC;&#x524D;&#x9762;&#x4E5F;&#x8BB2;&#x8FC7;&#x4E86;&#xFF0C;&#x4ED6;&#x8868;&#x793A;<code>emits</code>&#x53D8;&#x91CF;&#x7684;&#x521D;&#x59CB;&#x5316;&#x503C;&#x5BF9;&#x5E94;&#x7684;node&#x8282;&#x70B9;&#xFF0C;&#x5728;&#x6211;&#x4EEC;&#x8FD9;&#x4E2A;&#x573A;&#x666F;<code>init</code>&#x5B57;&#x6BB5;&#x5C31;&#x662F;&#x8868;&#x793A;<code>defineEmits([&quot;enlarge-text&quot;])</code>&#x3002;&#x6240;&#x4EE5;<code>init.start</code>&#x4E3A;<code>emits</code>&#x53D8;&#x91CF;&#x7684;&#x521D;&#x59CB;&#x5316;&#x503C;&#x5728;<code>script</code>&#x6A21;&#x5757;&#x4E2D;&#x5F00;&#x59CB;&#x7684;&#x4F4D;&#x7F6E;&#x3002;&#x800C;<code>ctx.s.</code>&#x4E3A;&#x64CD;&#x7EB5;&#x6574;&#x4E2A;vue&#x6587;&#x4EF6;&#x7684;code&#x4EE3;&#x7801;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x6240;&#x4EE5;<code>startOffset + init.start</code>&#x7684;&#x503C;&#x4E3A;<code>emits</code>&#x53D8;&#x91CF;&#x7684;&#x521D;&#x59CB;&#x5316;&#x503C;&#x7684;&#x8D77;&#x70B9;&#x5728;&#x6574;&#x4E2A;vue&#x6587;&#x4EF6;&#x7684;code&#x4EE3;&#x7801;&#x5B57;&#x7B26;&#x4E32;&#x6240;&#x5728;&#x4F4D;&#x7F6E;&#x3002;&#x540C;&#x7406;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;<code>startOffset + init.end</code>&#x7684;&#x503C;&#x4E3A;<code>emits</code>&#x53D8;&#x91CF;&#x7684;&#x521D;&#x59CB;&#x5316;&#x503C;&#x7684;&#x7EC8;&#x70B9;&#x5728;&#x6574;&#x4E2A;vue&#x6587;&#x4EF6;&#x7684;code&#x4EE3;&#x7801;&#x5B57;&#x7B26;&#x4E32;&#x6240;&#x5728;&#x4F4D;&#x7F6E;&#xFF0C;&#x800C;&#x7B2C;&#x4E09;&#x4E2A;&#x53C2;&#x6570;&#x662F;&#x4E00;&#x4E2A;&#x5199;&#x6B7B;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x201D;__emit&#x201D;&#x3002;&#x6240;&#x4EE5;<code>ctx.s.overwrite</code>&#x65B9;&#x6CD5;&#x7684;&#x4F5C;&#x7528;&#x662F;&#x5C06;<code>const emits = defineEmits([&quot;enlarge-text&quot;]);</code>&#x66FF;&#x6362;&#x4E3A;<code>const emits = __emit;</code>&#x3002;</p>
<p>&#x5173;&#x4E8E;<code>startOffset</code>&#x3001;<code>init.start</code>&#x3001; <code>init.end</code>&#x8BF7;&#x770B;&#x4E0B;&#x56FE;&#xFF1A;<br><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/78772545a52e430613f520142d7c7b52024d5b9e1c792d9ed30141de84ca8ef3" alt="params-overwrite"></p>
<p>&#x5728;&#x6267;&#x884C;<code>ctx.s.overwrite</code>&#x65B9;&#x6CD5;&#x540E;&#x6211;&#x4EEC;&#x5728;debug console&#x4E2D;&#x518D;&#x6B21;&#x6267;&#x884C;<code>ctx.s.toString()</code>&#x770B;&#x770B;&#x8FD9;&#x4F1A;&#x513F;&#x7684;code&#x4EE3;&#x7801;&#x5B57;&#x7B26;&#x4E32;&#x662F;&#x4EC0;&#x4E48;&#x6837;&#x7684;&#x3002;<br><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/bda4f5eb8af8a5e80187cb7a349f7cf4a6d8a2c5e1e9d36648bbe2803753b714" alt="after-overwrite"></p>
<p>&#x4ECE;&#x4E0A;&#x56FE;&#x4E2D;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6B64;&#x65F6;&#x4EE3;&#x7801;&#x4E2D;&#x5DF2;&#x7ECF;&#x6CA1;&#x6709;&#x4E86;<code>defineEmits</code>&#x51FD;&#x6570;&#xFF0C;&#x5DF2;&#x7ECF;&#x53D8;&#x6210;&#x4E86;&#x4E00;&#x4E2A;<code>__emit</code>&#x53D8;&#x91CF;&#x3002;<br><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/56c06c145f404d9db11201d7b860d134384ff3f49797d09322c97e4b362bbf48" alt="convert-defineEmits"></p>
<h3 id="genRuntimeEmits&#x51FD;&#x6570;"><a href="#genRuntimeEmits&#x51FD;&#x6570;" class="headerlink" title="genRuntimeEmits&#x51FD;&#x6570;"></a>genRuntimeEmits&#x51FD;&#x6570;</h3><p>&#x6211;&#x4EEC;&#x63A5;&#x7740;&#x5C06;&#x65AD;&#x70B9;&#x8D70;&#x5230;<code>compileScript</code>&#x51FD;&#x6570;&#x4E2D;&#x7684;&#x7B2C;&#x4E09;&#x90E8;&#x5206;&#xFF0C;&#x751F;&#x6210;&#x8FD0;&#x884C;&#x65F6;&#x7684;&#x201C;&#x58F0;&#x660E;&#x4E8B;&#x4EF6;&#x201D;&#x3002;&#x6211;&#x4EEC;&#x5728;&#x4E0A;&#x4E00;&#x6B65;&#x5C06;<code>defineEmits</code>&#x58F0;&#x660E;&#x4E8B;&#x4EF6;&#x7684;&#x4EE3;&#x7801;&#x66FF;&#x6362;&#x4E3A;<code>__emit</code>&#xFF0C;&#x90A3;&#x4E48;&#x603B;&#x5F97;&#x6709;&#x4E00;&#x4E2A;&#x5730;&#x65B9;&#x53BB;&#x751F;&#x6210;&#x201C;&#x58F0;&#x660E;&#x4E8B;&#x4EF6;&#x201D;&#x3002;&#x6CA1;&#x9519;&#xFF0C;&#x5C31;&#x662F;&#x5728;<code>genRuntimeEmits</code>&#x51FD;&#x6570;&#x8FD9;&#x91CC;&#x751F;&#x6210;&#x7684;&#x3002;<code>compileScript</code>&#x51FD;&#x6570;&#x4E2D;&#x6267;&#x884C;<code>genRuntimeEmits</code>&#x51FD;&#x6570;&#x7684;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;ctx.s.remove(0, startOffset);</span><br><span class="line">ctx.s.remove(endOffset, source.length);</span><br><span class="line"></span><br><span class="line">let runtimeOptions = ``;</span><br><span class="line">const emitsDecl = genRuntimeEmits(ctx);</span><br><span class="line">if (emitsDecl) runtimeOptions += `\n  emits: ${emitsDecl},`;</span><br></pre></td></tr></table></figure>

<p>&#x4ECE;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x4E2D;&#x6211;&#x4EEC;&#x770B;&#x5230;&#x9996;&#x5148;&#x6267;&#x884C;&#x4E86;&#x4E24;&#x6B21;<code>remove</code>&#x65B9;&#x6CD5;&#xFF0C;&#x5728;&#x524D;&#x9762;&#x5DF2;&#x7ECF;&#x8BB2;&#x8FC7;&#x4E86;<code>startOffset</code>&#x4E3A;<code>script</code>&#x6A21;&#x5757;&#x4E2D;&#x7684;&#x5185;&#x5BB9;&#x5F00;&#x59CB;&#x7684;&#x4F4D;&#x7F6E;&#x3002;&#x6240;&#x4EE5;<code>ctx.s.remove(0, startOffset);</code>&#x7684;&#x610F;&#x601D;&#x662F;&#x5220;&#x9664;&#x6389;<code>template</code>&#x6A21;&#x5757;&#x7684;&#x5185;&#x5BB9;&#x548C;<code>&lt;script setup&gt;</code>&#x5F00;&#x59CB;&#x6807;&#x7B7E;&#x3002;&#x8FD9;&#x884C;&#x4EE3;&#x7801;&#x6267;&#x884C;&#x5B8C;&#x540E;&#x6211;&#x4EEC;&#x518D;&#x770B;&#x770B;<code>ctx.s.toString()</code>&#x7684;&#x503C;&#xFF1A;<br><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/ad2c55b492e7001f4d18468fcd0693bf52cb2f4a32c57101ea4a1995336d81f8" alt="remove1"></p>
<p>&#x4ECE;&#x4E0A;&#x56FE;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6B64;&#x65F6;<code>template</code>&#x6A21;&#x5757;&#x548C;<code>&lt;script setup&gt;</code>&#x5F00;&#x59CB;&#x6807;&#x7B7E;&#x5DF2;&#x7ECF;&#x6CA1;&#x6709;&#x4E86;&#xFF0C;&#x63A5;&#x7740;&#x6267;&#x884C;<code>ctx.s.remove(endOffset, source.length);</code>&#xFF0C;&#x8FD9;&#x884C;&#x4EE3;&#x7801;&#x7684;&#x610F;&#x601D;&#x662F;&#x5220;&#x9664;<code>&lt;/script &gt;</code>&#x7ED3;&#x675F;&#x6807;&#x7B7E;&#x548C;<code>&lt;style&gt;</code>&#x6A21;&#x5757;&#x3002;&#x8FD9;&#x884C;&#x4EE3;&#x7801;&#x6267;&#x884C;&#x5B8C;&#x540E;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;&#x770B;<code>ctx.s.toString()</code>&#x7684;&#x503C;&#xFF1A;<br><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/92dd7e3cec5421d1c58c65ebd797823fb960ef0bffee3e61457d0d6eb2564f2d" alt="remove2"></p>
<p>&#x4ECE;&#x4E0A;&#x56FE;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x6B64;&#x65F6;&#x53EA;&#x6709;script&#x6A21;&#x5757;&#x4E2D;&#x7684;&#x5185;&#x5BB9;&#x4E86;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x63A5;&#x7740;&#x5C06;<code>compileScript</code>&#x51FD;&#x6570;&#x4E2D;&#x7684;&#x65AD;&#x70B9;&#x8D70;&#x5230;&#x8C03;&#x7528;<code>genRuntimeEmits</code>&#x51FD;&#x6570;&#x5904;&#xFF0C;&#x7B80;&#x5316;&#x540E;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;function genRuntimeEmits(ctx) {</span><br><span class="line">  let emitsDecl = &quot;&quot;;</span><br><span class="line">  if (ctx.emitsRuntimeDecl) {</span><br><span class="line">    emitsDecl = ctx.getString(ctx.emitsRuntimeDecl).trim();</span><br><span class="line">  }</span><br><span class="line">  return emitsDecl;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x770B;&#x5230;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x662F;&#x4E0D;&#x662F;&#x89C9;&#x5F97;&#x548C;&#x4E0A;&#x4E00;&#x7BC7;<code>defineProps</code>&#x6587;&#x7AE0;&#x4E2D;&#x8BB2;&#x7684;<code>genRuntimeProps</code>&#x51FD;&#x6570;&#x5F88;&#x76F8;&#x4F3C;&#x3002;&#x8FD9;&#x91CC;&#x7684;&#x4E0A;&#x4E0B;&#x6587;<code>ctx</code>&#x4E0A;&#x9762;&#x7684;<code>emitsRuntimeDecl</code>&#x5C5E;&#x6027;&#x6211;&#x4EEC;&#x524D;&#x9762;&#x8BB2;&#x8FC7;&#x4E86;&#xFF0C;&#x4ED6;&#x5C31;&#x662F;&#x8C03;&#x7528;<code>defineEmits</code>&#x51FD;&#x6570;&#x65F6;&#x4F20;&#x5165;&#x7684;&#x53C2;&#x6570;&#x8F6C;&#x6362;&#x6210;&#x7684;node&#x8282;&#x70B9;&#x3002;&#x6211;&#x4EEC;&#x5C06;&#x65AD;&#x70B9;&#x8D70;&#x8FDB;<code>ctx.getString</code>&#x51FD;&#x6570;&#xFF0C;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;getString(node, scriptSetup = true) {</span><br><span class="line">  const block = scriptSetup ? this.descriptor.scriptSetup : this.descriptor.script;</span><br><span class="line">  return block.content.slice(node.start, node.end);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x6211;&#x4EEC;&#x524D;&#x9762;&#x5DF2;&#x7ECF;&#x8BB2;&#x8FC7;&#x4E86;<code>descriptor</code>&#x5BF9;&#x8C61;&#x662F;&#x7531;<code>vue</code>&#x6587;&#x4EF6;&#x7F16;&#x8BD1;&#x800C;&#x6765;&#xFF0C;&#x5176;&#x4E2D;&#x7684;<code>scriptSetup</code>&#x5C5E;&#x6027;&#x5C31;&#x662F;&#x5BF9;&#x5E94;&#x7684;<code>&lt;script setup&gt;</code>&#x6A21;&#x5757;&#x3002;&#x6211;&#x4EEC;&#x8FD9;&#x91CC;&#x6CA1;&#x6709;&#x4F20;&#x5165;<code>scriptSetup</code>&#xFF0C;&#x6240;&#x4EE5;<code>block</code>&#x7684;&#x503C;&#x4E3A;<code>this.descriptor.scriptSetup</code>&#x3002;&#x540C;&#x6837;&#x6211;&#x4EEC;&#x524D;&#x9762;&#x4E5F;&#x8BB2;&#x8FC7;<code>scriptSetup.content</code>&#x7684;&#x503C;&#x662F;<code>&lt;script setup&gt;</code>&#x6A21;&#x5757;<code>code</code>&#x4EE3;&#x7801;&#x5B57;&#x7B26;&#x4E32;&#x3002;&#x8BF7;&#x770B;&#x4E0B;&#x56FE;&#xFF1A;<br><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/9a2cb1f6a774552dbb470f1bb39dfb8a89038695cbdeb975598f84cc96fe0159" alt="script-code"></p>
<p>&#x8FD9;&#x91CC;&#x4F20;&#x5165;&#x7684;<code>node</code>&#x8282;&#x70B9;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x524D;&#x9762;&#x5B58;&#x5728;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;<code>ctx.emitsRuntimeDecl</code>&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5728;&#x8C03;&#x7528;<code>defineEmits</code>&#x51FD;&#x6570;&#x65F6;&#x4F20;&#x5165;&#x7684;&#x53C2;&#x6570;&#x8282;&#x70B9;&#xFF0C;<code>node.start</code>&#x5C31;&#x662F;&#x53C2;&#x6570;&#x8282;&#x70B9;&#x5F00;&#x59CB;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;<code>node.end</code>&#x5C31;&#x662F;&#x53C2;&#x6570;&#x8282;&#x70B9;&#x7684;&#x7ED3;&#x675F;&#x4F4D;&#x7F6E;&#x3002;&#x6240;&#x4EE5;&#x4F7F;&#x7528;<code>content.slice</code>&#x65B9;&#x6CD5;&#x5C31;&#x53EF;&#x4EE5;&#x622A;&#x53D6;&#x51FA;&#x6765;&#x8C03;&#x7528;<code>defineEmits</code>&#x51FD;&#x6570;&#x65F6;&#x4F20;&#x5165;&#x7684;&#x53C2;&#x6570;&#x3002;&#x8BF7;&#x770B;&#x4E0B;&#x56FE;&#xFF1A;<br><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/b23223ce2e20c4bd5fe5320a59383174f7c2334e10a4df18144e2d8b8b4c66ed" alt="block-slice"></p>
<p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x518D;&#x56DE;&#x8FC7;&#x5934;&#x6765;&#x770B;<code>compileScript</code>&#x51FD;&#x6570;&#x4E2D;&#x7684;&#x8C03;&#x7528;<code>genRuntimeEmits</code>&#x51FD;&#x6570;&#x7684;&#x4EE3;&#x7801;&#x4F60;&#x5C31;&#x80FD;&#x5F88;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#x4E86;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;let runtimeOptions = ``;</span><br><span class="line">const emitsDecl = genRuntimeEmits(ctx);</span><br><span class="line">if (emitsDecl) runtimeOptions += `\n  emits: ${emitsDecl},`;</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x91CC;&#x7684;<code>emitsDecl</code>&#x5728;&#x6211;&#x4EEC;&#x8FD9;&#x4E2A;&#x573A;&#x666F;&#x4E2D;&#x5C31;&#x662F;&#x4F7F;&#x7528;<code>slice</code>&#x622A;&#x53D6;&#x51FA;&#x6765;&#x7684;<code>emits</code>&#x5B9A;&#x4E49;&#xFF0C;&#x518D;&#x4F7F;&#x7528;&#x5B57;&#x7B26;&#x4E32;&#x62FC;&#x63A5; <code>emits:</code>&#xFF0C;&#x5C31;&#x5F97;&#x5230;&#x4E86;<code>runtimeOptions</code>&#x7684;&#x503C;&#x3002;&#x5982;&#x56FE;&#xFF1A;<br><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/9f81b8793a24377440c340d239799dc11672601ec0f16884dd3e6d5c2c553470" alt="runtimeOptions"></p>
<p>&#x770B;&#x5230;<code>runtimeOptions</code>&#x7684;&#x503C;&#x662F;&#x4E0D;&#x662F;&#x5C31;&#x89C9;&#x5F97;&#x5F88;&#x719F;&#x6089;&#x4E86;&#xFF0C;&#x53C8;&#x6709;<code>name</code>&#x5C5E;&#x6027;&#xFF0C;&#x53C8;&#x6709;<code>emits</code>&#x5C5E;&#x6027;&#xFF0C;&#x548C;&#x6211;&#x4EEC;&#x524D;&#x9762;&#x4E3E;&#x7684;&#x4E24;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#x7684;vue2&#x7684;&#x9009;&#x9879;&#x5F0F;&#x8BED;&#x6CD5;&#x7684;&#x4F8B;&#x5B50;&#x6BD4;&#x8F83;&#x76F8;&#x4F3C;&#x3002;<br><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/d2dad9bc3657202d6ad9eea17652b739ad43493d027df7a3aa727c49628137b4" alt="genRuntimeEmits"></p>
<h3 id="&#x62FC;&#x63A5;&#x6210;&#x5B8C;&#x6574;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#x8FD0;&#x884C;&#x65F6;-js-&#x4EE3;&#x7801;"><a href="#&#x62FC;&#x63A5;&#x6210;&#x5B8C;&#x6574;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#x8FD0;&#x884C;&#x65F6;-js-&#x4EE3;&#x7801;" class="headerlink" title="&#x62FC;&#x63A5;&#x6210;&#x5B8C;&#x6574;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#x8FD0;&#x884C;&#x65F6; js &#x4EE3;&#x7801;"></a>&#x62FC;&#x63A5;&#x6210;&#x5B8C;&#x6574;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#x8FD0;&#x884C;&#x65F6; <code>js</code> &#x4EE3;&#x7801;</h3><p>&#x6211;&#x4EEC;&#x63A5;&#x7740;&#x5C06;&#x65AD;&#x70B9;&#x8D70;&#x5230;<code>compileScript</code>&#x51FD;&#x6570;&#x4E2D;&#x7684;&#x6700;&#x540E;&#x4E00;&#x90E8;&#x5206;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">javascript&#x590D;&#x5236;&#x4EE3;&#x7801;const def =</span><br><span class="line">  (defaultExport ? `\n  ...${normalScriptDefaultVar},` : ``) +</span><br><span class="line">  (definedOptions ? `\n  ...${definedOptions},` : &quot;&quot;);</span><br><span class="line">ctx.s.prependLeft(</span><br><span class="line">  startOffset,</span><br><span class="line">  `\n${genDefaultAs} /*#__PURE__*/${ctx.helper(</span><br><span class="line">    `defineComponent`</span><br><span class="line">  )}({${def}${runtimeOptions}\n  ${</span><br><span class="line">    hasAwait ? `async ` : ``</span><br><span class="line">  }setup(${args}) {\n${exposeCall}`</span><br><span class="line">);</span><br><span class="line">ctx.s.appendRight(endOffset, `})`);</span><br><span class="line"></span><br><span class="line">return {</span><br><span class="line">  //....</span><br><span class="line">  content: ctx.s.toString(),</span><br><span class="line">};</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x5757;&#x4EE3;&#x7801;&#x548C;&#x6211;&#x4EEC;&#x8BB2;<code>defineProps</code>&#x6587;&#x7AE0;&#x4E2D;&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x5148;&#x8C03;&#x7528;&#x4E86;<code>ctx.s.prependLeft</code>&#x65B9;&#x6CD5;&#x7ED9;&#x5B57;&#x7B26;&#x4E32;&#x5F00;&#x59CB;&#x7684;&#x5730;&#x65B9;&#x63D2;&#x5165;&#x4E86;&#x4E00;&#x4E32;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x8FD9;&#x4E32;&#x62FC;&#x63A5;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x770B;&#x7740;&#x5F88;&#x9EBB;&#x70E6;&#x7684;&#x6837;&#x5B50;&#xFF0C;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x5728;debug console&#x4E0A;&#x9762;&#x770B;&#x770B;&#x8981;&#x62FC;&#x63A5;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x662F;&#x4EC0;&#x4E48;&#x6837;&#x7684;&#xFF1A;<br><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/713521869d616d1a70e69bdea230e95b829c278ff101be2a5d7985d6d3682983" alt="prependLeft"></p>
<p>&#x770B;&#x5230;&#x8FD9;&#x4E32;&#x4F60;&#x5E94;&#x8BE5;&#x5F88;&#x719F;&#x6089;&#xFF0C;&#x9664;&#x4E86;&#x524D;&#x9762;&#x6211;&#x4EEC;&#x62FC;&#x63A5;&#x7684;<code>name</code>&#x548C;<code>emits</code>&#x4E4B;&#x5916;&#x8FD8;&#x6709;&#x90E8;&#x5206;<code>setup</code>&#x7F16;&#x8BD1;&#x540E;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x91CC;&#x7684;<code>setup</code>&#x4EE3;&#x7801;&#x8FD8;&#x4E0D;&#x5B8C;&#x6574;&#xFF0C;&#x5269;&#x4F59;&#x90E8;&#x5206;&#x8FD8;&#x5728;<code>ctx.s.toString()</code>&#x91CC;&#x9762;&#x3002;</p>
<p>&#x5C06;&#x65AD;&#x70B9;&#x6267;&#x884C;&#x5B8C;<code>ctx.s.prependLeft</code>&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x5728;debug console&#x4E0A;&#x9762;&#x901A;&#x8FC7;<code>ctx.s.toString()</code>&#x770B;&#x6B64;&#x65F6;&#x64CD;&#x4F5C;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x53D8;&#x6210;&#x4EC0;&#x4E48;&#x6837;&#x4E86;&#xFF1A;<br><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/f47866bc62120073a56b3d267b93ee68de4ea058abdc23002b24d8a254f52e79" alt="after-prependLeft"></p>
<p>&#x4ECE;&#x4E0A;&#x56FE;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6B64;&#x65F6;&#x7684;setup&#x51FD;&#x6570;&#x5DF2;&#x7ECF;&#x62FC;&#x63A5;&#x5B8C;&#x6574;&#x4E86;&#xFF0C;&#x5DF2;&#x7ECF;&#x662F;&#x4E00;&#x4E2A;&#x7F16;&#x8BD1;&#x540E;&#x7684;<code>vue</code>&#x7EC4;&#x4EF6;&#x5BF9;&#x8C61;&#x7684;&#x4EE3;&#x7801;&#x5B57;&#x7B26;&#x4E32;&#x4E86;&#xFF0C;&#x53EA;&#x5DEE;&#x4E00;&#x4E2A;<code>})</code>&#x7ED3;&#x675F;&#x7B26;&#x53F7;&#xFF0C;&#x6240;&#x4EE5;&#x6267;&#x884C;<code>ctx.s.appendRight</code>&#x65B9;&#x6CD5;&#x5C06;&#x7ED3;&#x675F;&#x7B26;&#x53F7;&#x63D2;&#x5165;&#x8FDB;&#x53BB;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x6700;&#x540E;&#x518D;&#x6765;&#x770B;&#x770B;&#x7ECF;&#x8FC7;<code>compileScript</code>&#x51FD;&#x6570;&#x5904;&#x7406;&#x540E;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#x53EF;&#x6267;&#x884C;&#x7684;<code>js</code>&#x4EE3;&#x7801;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;<code>ctx.s.toString()</code><br><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/7b683a1bb71a3d2d84549602c09ad1765744445c0a7ffc7a6e77bd92e29efe15" alt="full-code"></p>
<p><strong>&#x4ECE;&#x4E0A;&#x56FE;&#x4E2D;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x7F16;&#x8BD1;&#x540E;&#x7684;&#x4EE3;&#x7801;&#x4E2D;<code>&#x58F0;&#x660E;&#x4E8B;&#x4EF6;</code>&#x8FD8;&#x662F;&#x901A;&#x8FC7;vue&#x7EC4;&#x4EF6;&#x5BF9;&#x8C61;&#x4E0A;&#x9762;&#x7684;<code>emits</code>&#x9009;&#x9879;&#x58F0;&#x660E;&#x7684;&#xFF0C;&#x548C;&#x6211;&#x4EEC;&#x524D;&#x9762;&#x4E3E;&#x7684;vue2&#x7684;&#x9009;&#x9879;&#x5F0F;&#x8BED;&#x6CD5;&#x7684;&#x4F8B;&#x5B50;&#x4E00;&#x6A21;&#x4E00;&#x6837;&#x3002;</strong></p>
<h2 id="&#x4E3A;&#x4EC0;&#x4E48;defineEmits&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x7B49;&#x540C;&#x4E8E;-emit-&#x65B9;&#x6CD5;&#x7528;&#x4E8E;&#x5728;&#x7EC4;&#x4EF6;&#x4E2D;&#x629B;&#x51FA;&#x4E8B;&#x4EF6;&#xFF1F;"><a href="#&#x4E3A;&#x4EC0;&#x4E48;defineEmits&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x7B49;&#x540C;&#x4E8E;-emit-&#x65B9;&#x6CD5;&#x7528;&#x4E8E;&#x5728;&#x7EC4;&#x4EF6;&#x4E2D;&#x629B;&#x51FA;&#x4E8B;&#x4EF6;&#xFF1F;" class="headerlink" title="&#x4E3A;&#x4EC0;&#x4E48;defineEmits&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x7B49;&#x540C;&#x4E8E;$emit &#x65B9;&#x6CD5;&#x7528;&#x4E8E;&#x5728;&#x7EC4;&#x4EF6;&#x4E2D;&#x629B;&#x51FA;&#x4E8B;&#x4EF6;&#xFF1F;"></a>&#x4E3A;&#x4EC0;&#x4E48;<code>defineEmits</code>&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x7B49;&#x540C;&#x4E8E;<code>$emit</code> &#x65B9;&#x6CD5;&#x7528;&#x4E8E;&#x5728;&#x7EC4;&#x4EF6;&#x4E2D;&#x629B;&#x51FA;&#x4E8B;&#x4EF6;&#xFF1F;</h2><p>&#x5728;&#x4E0A;&#x4E00;&#x8282;&#x4E2D;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x4E86;<code>defineEmits</code>&#x51FD;&#x6570;&#x5728;&#x7F16;&#x8BD1;&#x65F6;&#x5C31;&#x88AB;&#x66FF;&#x6362;&#x4E3A;&#x4E86;<code>__emit</code>&#x53D8;&#x91CF;&#xFF0C;&#x7136;&#x540E;&#x5C06;<code>__emit</code>&#x8D4B;&#x503C;&#x7ED9;&#x6211;&#x4EEC;&#x5B9A;&#x4E49;&#x7684;<code>emits</code>&#x53D8;&#x91CF;&#x3002;&#x5728;&#x9700;&#x8981;&#x629B;&#x51FA;&#x4E8B;&#x4EF6;&#x65F6;&#x6211;&#x4EEC;&#x662F;&#x8C03;&#x7528;&#x7684;<code>emits(&quot;enlarge-text&quot;);</code>&#xFF0C;&#x5B9E;&#x9645;&#x5C31;&#x662F;&#x5728;&#x8C03;&#x7528;<code>__emit(&quot;enlarge-text&quot;);</code>&#x3002;&#x90A3;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x901A;&#x8FC7;debug&#x770B;&#x770B;&#x8FD9;&#x4E2A;<code>__emit</code>&#x5230;&#x5E95;&#x662F;&#x4EC0;&#x4E48;&#x4E1C;&#x897F;&#xFF1F;</p>
<p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x7684;source&#x9762;&#x677F;&#x4E2D;&#x627E;&#x5230;&#x7531;vue&#x6587;&#x4EF6;&#x7F16;&#x8BD1;&#x800C;&#x6765;&#x7684;js&#x6587;&#x4EF6;&#xFF0C;&#x7136;&#x540E;&#x7ED9;setup&#x51FD;&#x6570;&#x6253;&#x4E0A;&#x65AD;&#x70B9;&#x3002;&#x5728;&#x6211;&#x4EEC;&#x524D;&#x9762;&#x7684; <a href="https://dev.newban.cn/7339210740455440419">Vue 3 &#x7684; setup&#x8BED;&#x6CD5;&#x7CD6;&#x5230;&#x5E95;&#x662F;&#x4EC0;&#x4E48;&#x4E1C;&#x897F;&#xFF1F;</a>&#x6587;&#x7AE0;&#x4E2D;&#x5DF2;&#x7ECF;&#x624B;&#x628A;&#x624B;&#x7684;&#x6559;&#x4F60;&#x4E86;&#x600E;&#x4E48;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x627E;&#x5230;&#x7F16;&#x8BD1;&#x540E;&#x7684;js&#x6587;&#x4EF6;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x4E2D;&#x5C31;&#x4E0D;&#x518D;&#x8D58;&#x8FF0;&#x4E86;&#x3002;</p>
<p>&#x7ED9;<code>setup</code>&#x51FD;&#x6570;&#x6253;&#x4E0A;&#x65AD;&#x70B9;&#xFF0C;&#x5237;&#x65B0;&#x6D4F;&#x89C8;&#x5668;&#x9875;&#x9762;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x770B;&#x5230;&#x65AD;&#x70B9;&#x5DF2;&#x7ECF;&#x8D70;&#x8FDB;&#x6765;&#x4E86;&#x3002;&#x5982;&#x56FE;&#xFF1A;<br><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/8a87e6102703d4482595f02728ee5e6fea32bb4526d598f3c3d6cfdcba361362" alt="setup-debug"></p>
<p>&#x4ECE;&#x4E0A;&#x56FE;&#x4E2D;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x89C1;<code>defineEmits</code>&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x4E5F;&#x5C31;&#x662F;<code>__emit</code>&#x53D8;&#x91CF;&#xFF0C;&#x5B9E;&#x9645;&#x5C31;&#x662F;<code>setup</code>&#x51FD;&#x6570;&#x7684;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#x5BF9;&#x8C61;&#x4E2D;&#x7684;<code>emit</code>&#x5C5E;&#x6027;&#x3002;&#x53F3;&#x8FB9;&#x7684;Call Stack&#x6709;&#x7684;&#x5C0F;&#x4F19;&#x4F34;&#x53EF;&#x80FD;&#x4E0D;&#x5E38;&#x7528;&#xFF0C;&#x4ED6;&#x7684;&#x4F5C;&#x7528;&#x662F;&#x8FFD;&#x8E2A;&#x51FD;&#x6570;&#x7684;&#x6267;&#x884C;&#x6D41;&#x3002;&#x6BD4;&#x5982;&#x5728;&#x8FD9;&#x91CC;<code>setup</code>&#x51FD;&#x6570;&#x662F;&#x7531;<code>callWithErrorHandling</code>&#x51FD;&#x6570;&#x5185;&#x8C03;&#x7528;&#x7684;&#xFF0C;&#x5728;Call Stack&#x4E2D;<code>setup</code>&#x4E0B;&#x9762;&#x5C31;&#x662F;<code>callWithErrorHandling</code>&#x3002;&#x800C;<code>callWithErrorHandling</code>&#x51FD;&#x6570;&#x662F;&#x7531;<code>setupStatefulComponent</code>&#x51FD;&#x6570;&#x5185;&#x8C03;&#x7528;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x5728;Call Stack&#x4E2D;<code>callWithErrorHandling</code>&#x4E0B;&#x9762;&#x5C31;&#x662F;<code>setupStatefulComponent</code>&#x3002;&#x5E76;&#x4E14;&#x8FD8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x70B9;&#x51FB;&#x51FD;&#x6570;&#x540D;&#x79F0;&#x8DF3;&#x8F6C;&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x51FD;&#x6570;&#x4E2D;&#x3002;</p>
<p>&#x4E3A;&#x4E86;&#x641E;&#x6E05;&#x695A;<code>setup</code>&#x51FD;&#x6570;&#x7684;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#x5230;&#x5E95;&#x662F;&#x4EC0;&#x4E48;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x70B9;&#x51FB;&#x53F3;&#x8FB9;&#x7684;Call Stack&#x4E2D;&#x7684;<code>callWithErrorHandling</code>&#x51FD;&#x6570;&#xFF0C;&#x770B;&#x770B;&#x5728;<code>callWithErrorHandling</code>&#x51FD;&#x6570;&#x4E2D;&#x662F;&#x600E;&#x4E48;&#x8C03;&#x7528;<code>setup</code>&#x51FD;&#x6570;&#x7684;&#x3002;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">php&#x590D;&#x5236;&#x4EE3;&#x7801;function callWithErrorHandling(fn, instance, type, args) {</span><br><span class="line">  try {</span><br><span class="line">    return args ? fn(...args) : fn();</span><br><span class="line">  } catch (err) {</span><br><span class="line">    handleError(err, instance, type);</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4ECE;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8FD9;&#x4E2A;<code>callWithErrorHandling</code>&#x51FD;&#x6570;&#x5B9E;&#x9645;&#x5C31;&#x662F;&#x7528;&#x4E8E;&#x9519;&#x8BEF;&#x5904;&#x7406;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x53C2;&#x6570;<code>args</code>&#xFF0C;&#x90A3;&#x5C31;&#x8C03;&#x7528;<code>fn</code>&#x65F6;&#x5C06;&#x53C2;&#x6570;&#x4EE5;<code>...args</code>&#x7684;&#x5F62;&#x5F0F;&#x4F20;&#x5165;&#x7ED9;<code>fn</code>&#x3002;&#x5728;&#x6211;&#x4EEC;&#x8FD9;&#x91CC;<code>fn</code>&#x5C31;&#x662F;<code>setup</code>&#x51FD;&#x6570;&#xFF0C;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x8981;&#x770B;&#x4F20;&#x9012;&#x7ED9;<code>setup</code>&#x7684;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x5C31;&#x5BF9;&#x5E94;&#x7684;&#x8FD9;&#x91CC;&#x7684;&#x662F;<code>args</code>&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x7B2C;&#x4E8C;&#x9879;&#x3002;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x4E86;&#x8C03;&#x7528;<code>callWithErrorHandling</code>&#x51FD;&#x6570;&#x65F6;&#x4F20;&#x5165;&#x7684;&#x7B2C;&#x56DB;&#x4E2A;&#x53C2;&#x6570;&#x662F;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;&#xFF0C;&#x6570;&#x7EC4;&#x7684;&#x7B2C;&#x4E8C;&#x9879;&#x5C31;&#x662F;&#x8C03;&#x7528;<code>setup</code>&#x51FD;&#x6570;&#x65F6;&#x4F20;&#x5165;&#x7684;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#x5BF9;&#x8C61;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x63A5;&#x7740;&#x6765;&#x770B;&#x5728;<code>setupStatefulComponent</code>&#x51FD;&#x6570;&#x4E2D;&#x662F;&#x5982;&#x4F55;&#x8C03;&#x7528;<code>callWithErrorHandling</code>&#x51FD;&#x6570;&#x7684;&#xFF0C;&#x7B80;&#x5316;&#x540E;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;function setupStatefulComponent(instance, isSSR) {</span><br><span class="line">  const setupContext = (instance.setupContext =</span><br><span class="line">    setup.length &gt; 1 ? createSetupContext(instance) : null);</span><br><span class="line">  const setupResult = callWithErrorHandling(setup, instance, 0, [</span><br><span class="line">    true ? shallowReadonly(instance.props) : instance.props,</span><br><span class="line">    setupContext,</span><br><span class="line">  ]);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4ECE;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8C03;&#x7528;<code>callWithErrorHandling</code>&#x51FD;&#x6570;&#x65F6;&#x4F20;&#x5165;&#x7684;&#x7B2C;&#x56DB;&#x4E2A;&#x53C2;&#x6570;&#x786E;&#x5B9E;&#x662F;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;&#xFF0C;&#x6570;&#x7EC4;&#x7684;&#x7B2C;&#x4E8C;&#x9879;&#x662F;<code>setupContext</code>&#xFF0C;&#x8FD9;&#x4E2A;<code>setupContext</code>&#x5C31;&#x662F;&#x8C03;&#x7528;<code>setup</code>&#x51FD;&#x6570;&#x65F6;&#x4F20;&#x5165;&#x7684;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#x5BF9;&#x8C61;&#x3002;&#x800C;<code>setupContext</code>&#x7684;&#x503C;&#x662F;&#x7531;<code>createSetupContext</code>&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x7684;&#xFF0C;&#x5728;&#x8C03;&#x7528;<code>createSetupContext</code>&#x51FD;&#x6570;&#x65F6;&#x4F20;&#x5165;&#x4E86;&#x5F53;&#x524D;&#x7684;vue&#x5B9E;&#x4F8B;&#x3002;&#x6211;&#x4EEC;&#x63A5;&#x7740;&#x6765;&#x770B;&#x7B80;&#x5316;&#x540E;&#x7684;<code>createSetupContext</code>&#x51FD;&#x6570;&#x662F;&#x4EC0;&#x4E48;&#x6837;&#x7684;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">csharp&#x590D;&#x5236;&#x4EE3;&#x7801;function createSetupContext(instance) {</span><br><span class="line">  return Object.freeze({</span><br><span class="line">    get attrs() {</span><br><span class="line">      return getAttrsProxy(instance);</span><br><span class="line">    },</span><br><span class="line">    get slots() {</span><br><span class="line">      return getSlotsProxy(instance);</span><br><span class="line">    },</span><br><span class="line">    get emit() {</span><br><span class="line">      return (event, ...args) =&gt; instance.emit(event, ...args);</span><br><span class="line">    },</span><br><span class="line">    expose,</span><br><span class="line">  });</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x91CC;&#x51FA;&#x73B0;&#x4E86;&#x4E00;&#x4E2A;&#x6211;&#x4EEC;&#x5E73;&#x65F6;&#x4E0D;&#x5E38;&#x7528;&#x7684;<code>Object.freeze</code>&#x65B9;&#x6CD5;&#xFF0C;&#x5728;mdn&#x4E0A;&#x9762;&#x67E5;&#x4E86;&#x4E00;&#x4E0B;&#x4ED6;&#x7684;&#x4F5C;&#x7528;:</p>
<blockquote>
<p><code>Object.freeze()</code> &#x9759;&#x6001;&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x4F7F;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x88AB;<em>&#x51BB;&#x7ED3;</em>&#x3002;&#x51BB;&#x7ED3;&#x5BF9;&#x8C61;&#x53EF;&#x4EE5;<a href="/external_links/7ba453a015263731d72a89306217795c.html" target="blank" rel="noopener">&#x9632;&#x6B62;&#x6269;&#x5C55;</a>&#xFF0C;&#x5E76;&#x4F7F;&#x73B0;&#x6709;&#x7684;&#x5C5E;&#x6027;&#x4E0D;&#x53EF;&#x5199;&#x5165;&#x548C;&#x4E0D;&#x53EF;&#x914D;&#x7F6E;&#x3002;&#x88AB;&#x51BB;&#x7ED3;&#x7684;&#x5BF9;&#x8C61;&#x4E0D;&#x80FD;&#x518D;&#x88AB;&#x66F4;&#x6539;&#xFF1A;&#x4E0D;&#x80FD;&#x6DFB;&#x52A0;&#x65B0;&#x7684;&#x5C5E;&#x6027;&#xFF0C;&#x4E0D;&#x80FD;&#x79FB;&#x9664;&#x73B0;&#x6709;&#x7684;&#x5C5E;&#x6027;&#xFF0C;&#x4E0D;&#x80FD;&#x66F4;&#x6539;&#x5B83;&#x4EEC;&#x7684;&#x53EF;&#x679A;&#x4E3E;&#x6027;&#x3001;&#x53EF;&#x914D;&#x7F6E;&#x6027;&#x3001;&#x53EF;&#x5199;&#x6027;&#x6216;&#x503C;&#xFF0C;&#x5BF9;&#x8C61;&#x7684;&#x539F;&#x578B;&#x4E5F;&#x4E0D;&#x80FD;&#x88AB;&#x91CD;&#x65B0;&#x6307;&#x5B9A;&#x3002;<code>freeze()</code> &#x8FD4;&#x56DE;&#x4E0E;&#x4F20;&#x5165;&#x7684;&#x5BF9;&#x8C61;&#x76F8;&#x540C;&#x7684;&#x5BF9;&#x8C61;&#x3002;</p>
</blockquote>
<p>&#x4ECE;&#x524D;&#x9762;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x77E5;&#x9053;&#x4E86;<code>createSetupContext</code>&#x51FD;&#x6570;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x5C31;&#x662F;&#x8C03;&#x7528;<code>setup</code>&#x51FD;&#x6570;&#x65F6;&#x4F20;&#x5165;&#x7684;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#x5BF9;&#x8C61;&#xFF0C;&#x6211;&#x4EEC;&#x8981;&#x627E;&#x7684;<code>__emit</code>&#x5C31;&#x662F;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#x5BF9;&#x8C61;&#x4E2D;&#x7684;<code>emit</code>&#x5C5E;&#x6027;&#x3002;&#x5F53;&#x8BFB;&#x53D6;<code>emit</code>&#x5C5E;&#x6027;&#x65F6;&#x5C31;&#x4F1A;&#x8D70;&#x5230;&#x4E0A;&#x9762;&#x7684;&#x51BB;&#x7ED3;&#x5BF9;&#x8C61;&#x7684;<code>get emit()</code> &#x4E2D;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x8C03;&#x7528;<code>emit</code>&#x51FD;&#x6570;&#x629B;&#x51FA;&#x4E8B;&#x4EF6;&#x65F6;&#x5B9E;&#x9645;&#x5C31;&#x662F;&#x8C03;&#x7528;&#x7684;&#x662F;<code>instance.emit</code>&#x65B9;&#x6CD5;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;<code>vue</code>&#x5B9E;&#x4F8B;&#x4E0A;&#x9762;&#x7684;<code>emit</code>&#x65B9;&#x6CD5;&#x3002;</p>
<p>&#x73B0;&#x5728;&#x6211;&#x60F3;&#x4F60;&#x5E94;&#x8BE5;&#x5DF2;&#x7ECF;&#x53CD;&#x5E94;&#x8FC7;&#x6765;&#x4E86;&#xFF0C;&#x8C03;&#x7528;<code>defineEmits</code>&#x51FD;&#x6570;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x5B9E;&#x9645;&#x5C31;&#x662F;&#x5728;&#x8C03;&#x7528;vue&#x5B9E;&#x4F8B;&#x4E0A;&#x9762;&#x7684;emit&#x65B9;&#x6CD5;&#xFF0C;&#x5176;&#x5B9E;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#x629B;&#x51FA;&#x4E8B;&#x4EF6;&#x7684;&#x505A;&#x6CD5;&#x8FD8;&#x662F;&#x548C;vue2&#x7684;&#x9009;&#x9879;&#x5F0F;&#x8BED;&#x6CD5;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x53EA;&#x662F;&#x5728;&#x7F16;&#x8BD1;&#x65F6;&#x5C31;&#x5C06;&#x770B;&#x7740;&#x9AD8;&#x5927;&#x4E0A;&#x7684;<code>defineEmits</code>&#x51FD;&#x6570;&#x7F16;&#x8BD1;&#x6210;vue2&#x7684;&#x9009;&#x9879;&#x5F0F;&#x8BED;&#x6CD5;&#x7684;&#x6837;&#x5B50;&#x3002;<br><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/b6d9c40d10726cdd580ed90c8afea8edd904362c949887924e2ea722e0db53be" alt="full-emit-progress"></p>
<h1 id="&#x603B;&#x7ED3;"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3;</h1><p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x80FD;&#x591F;&#x56DE;&#x7B54;&#x524D;&#x9762;&#x63D0;&#x7684;&#x4E24;&#x4E2A;&#x95EE;&#x9898;&#x4E86;&#xFF1A;</p>
<ul>
<li>&#x4E3A;&#x4EC0;&#x4E48; Vue &#x7684; <code>defineEmits</code> &#x5B8F;&#x51FD;&#x6570;&#x4E0D;&#x9700;&#x8981; import &#x5BFC;&#x5165;&#x5C31;&#x53EF;&#x7528;&#xFF1F;<br>&#x5728;&#x904D;&#x5386;script&#x6A21;&#x5757;&#x8F6C;&#x6362;&#x6210;&#x7684;AST&#x62BD;&#x8C61;&#x8BED;&#x6CD5;&#x6811;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x5F53;&#x524D;&#x7684;node&#x8282;&#x70B9;&#x662F;&#x5728;&#x8C03;&#x7528;<code>defineEmits</code>&#x51FD;&#x6570;&#xFF0C;&#x5C31;&#x7EE7;&#x7EED;&#x53BB;&#x627E;&#x8FD9;&#x4E2A;node&#x8282;&#x70B9;&#x4E0B;&#x9762;&#x7684;&#x53C2;&#x6570;&#x8282;&#x70B9;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8C03;&#x7528;<code>defineEmits</code>&#x51FD;&#x6570;&#x4F20;&#x5165;&#x7684;&#x53C2;&#x6570;&#x5BF9;&#x5E94;&#x7684;node&#x8282;&#x70B9;&#x3002;&#x7136;&#x540E;&#x5C06;&#x53C2;&#x6570;&#x8282;&#x70B9;&#x5BF9;&#x8C61;&#x8D4B;&#x503C;&#x7ED9;&#x5F53;&#x524D;&#x7684;<code>ctx</code>&#x4E0A;&#x4E0B;&#x6587;&#x7684;<code>emitsRuntimeDecl</code>&#x5C5E;&#x6027;&#x4E2D;&#xFF0C;&#x63A5;&#x7740;&#x6839;&#x636E;<code>defineEmits</code>&#x51FD;&#x6570;&#x5BF9;&#x5E94;&#x7684;node&#x8282;&#x70B9;&#x4E2D;&#x8BB0;&#x5F55;&#x7684;start&#x548C;end&#x4F4D;&#x7F6E;&#x5BF9;vue&#x6587;&#x4EF6;&#x7684;code&#x4EE3;&#x7801;&#x5B57;&#x7B26;&#x4E32;&#x8FDB;&#x884C;&#x66FF;&#x6362;&#x3002;&#x5C06;<code>defineEmits([&quot;enlarge-text&quot;])</code>&#x66FF;&#x6362;&#x4E3A;<code>__emit</code>&#xFF0C;&#x6B64;&#x65F6;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x5DF2;&#x7ECF;&#x5C31;&#x6CA1;&#x6709;&#x4E86; <code>defineEmits</code> &#x5B8F;&#x51FD;&#x6570;&#x4E86;&#xFF0C;&#x81EA;&#x7136;&#x4E5F;&#x4E0D;&#x9700;&#x8981;&#x4ECE;vue&#x4E2D;import&#x5BFC;&#x5165;&#x3002;&#x5F53;&#x904D;&#x5386;&#x5B8C;AST&#x62BD;&#x8C61;&#x8BED;&#x6CD5;&#x6811;&#x540E;&#x8C03;&#x7528;<code>genRuntimeEmits</code>&#x51FD;&#x6570;&#xFF0C;&#x4ECE;&#x524D;&#x9762;&#x5B58;&#x7684;<code>ctx</code>&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x7684;<code>emitsRuntimeDecl</code>&#x5C5E;&#x6027;&#x4E2D;&#x53D6;&#x51FA;&#x6765;&#x8C03;&#x7528;<code>defineEmits</code>&#x51FD;&#x6570;&#x65F6;&#x4F20;&#x5165;&#x7684;&#x53C2;&#x6570;&#x8282;&#x70B9;&#x4FE1;&#x606F;&#x3002;&#x6839;&#x636E;&#x53C2;&#x6570;&#x8282;&#x70B9;&#x4E2D;&#x8BB0;&#x5F55;&#x7684;start&#x548C;end&#x4F4D;&#x7F6E;&#xFF0C;&#x5BF9;script&#x6A21;&#x5757;&#x4E2D;&#x7684;code&#x4EE3;&#x7801;&#x5B57;&#x7B26;&#x4E32;&#x6267;&#x884C;slice&#x65B9;&#x6CD5;&#xFF0C;&#x622A;&#x53D6;&#x51FA;&#x8C03;&#x7528;<code>defineEmits</code>&#x51FD;&#x6570;&#x65F6;&#x4F20;&#x5165;&#x7684;&#x53C2;&#x6570;&#x3002;&#x7136;&#x540E;&#x901A;&#x8FC7;&#x5B57;&#x7B26;&#x4E32;&#x62FC;&#x63A5;&#x7684;&#x65B9;&#x5F0F;&#x5C06;&#x8C03;&#x7528;<code>defineEmits</code>&#x51FD;&#x6570;&#x65F6;&#x4F20;&#x5165;&#x7684;&#x53C2;&#x6570;&#x62FC;&#x63A5;&#x5230;vue&#x7EC4;&#x4EF6;&#x5BF9;&#x8C61;&#x7684;emits&#x5C5E;&#x6027;&#x4E0A;&#x3002;</li>
<li>&#x4E3A;&#x4EC0;&#x4E48;<code>defineEmits</code>&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x7B49;&#x540C;&#x4E8E;<code>$emit</code> &#x65B9;&#x6CD5;&#x7528;&#x4E8E;&#x5728;&#x7EC4;&#x4EF6;&#x4E2D;&#x629B;&#x51FA;&#x4E8B;&#x4EF6;&#xFF1F;<br><code>defineEmits</code> &#x5B8F;&#x51FD;&#x6570;&#x5728;&#x4E0A;&#x4E2A;&#x95EE;&#x9898;&#x4E2D;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x8BB2;&#x8FC7;&#x4E86;&#x4F1A;&#x88AB;&#x66FF;&#x6362;&#x4E3A;<code>__emit</code>&#xFF0C;&#x800C;&#x8FD9;&#x4E2A;<code>__emit</code>&#x662F;&#x8C03;&#x7528;<code>setup</code>&#x51FD;&#x6570;&#x65F6;&#x4F20;&#x5165;&#x7684;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#x5BF9;&#x8C61;&#x4E0A;&#x7684;<code>emit</code>&#x5C5E;&#x6027;&#x3002;&#x800C;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#x5BF9;&#x8C61;&#x662F;&#x5728;<code>setupStatefulComponent</code>&#x51FD;&#x6570;&#x4E2D;&#x8C03;&#x7528;<code>createSetupContext</code>&#x51FD;&#x6570;&#x751F;&#x6210;&#x7684;<code>setupContext</code>&#x5BF9;&#x8C61;&#x3002;&#x5728;<code>createSetupContext</code>&#x51FD;&#x6570;&#x4E2D;&#x6211;&#x4EEC;&#x770B;&#x5230;&#x8FD4;&#x56DE;&#x7684;<code>emit</code>&#x5C5E;&#x6027;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x7BAD;&#x5934;&#x51FD;&#x6570;&#xFF0C;&#x5F53;&#x8C03;&#x7528;<code>defineEmits</code>&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x7684;<code>emit</code>&#x51FD;&#x6570;&#x65F6;&#x5C31;&#x4F1A;&#x8C03;&#x7528;&#x8FD9;&#x4E2A;&#x7BAD;&#x5934;&#x51FD;&#x6570;&#xFF0C;&#x5728;&#x7BAD;&#x5934;&#x51FD;&#x6570;&#x4E2D;&#x5176;&#x5B9E;&#x662F;&#x8C03;&#x7528;vue&#x5B9E;&#x4F8B;&#x4E0A;&#x7684;<code>emit</code>&#x65B9;&#x6CD5;&#x3002;</li>
</ul>
<p>&#x641E;&#x660E;&#x767D;&#x4E86;&#x4E0A;&#x9762;&#x4E24;&#x4E2A;&#x95EE;&#x9898;&#x6211;&#x60F3;&#x4F60;&#x73B0;&#x5728;&#x5E94;&#x8BE5;&#x660E;&#x767D;&#x4E86;&#x4E3A;&#x4EC0;&#x4E48;&#x8BF4;<strong>vue3&#x7684;defineEmits &#x5B8F;&#x51FD;&#x6570;&#x7F16;&#x8BD1;&#x540E;&#x5176;&#x5B9E;&#x5C31;&#x662F;vue2&#x7684;&#x9009;&#x9879;&#x5F0F;API</strong>&#xFF0C;<code>defineEmits</code>&#x5B8F;&#x51FD;&#x6570;&#x58F0;&#x660E;&#x7684;&#x4E8B;&#x4EF6;&#x7ECF;&#x8FC7;&#x7F16;&#x8BD1;&#x540E;&#x5C31;&#x53D8;&#x6210;&#x4E86;vue&#x7EC4;&#x4EF6;&#x5BF9;&#x8C61;&#x4E0A;&#x7684;<code>emits</code>&#x5C5E;&#x6027;&#x3002;<code>defineEmits</code>&#x51FD;&#x6570;&#x7684;&#x8FD4;&#x56DE;&#x503C;<code>emit</code>&#x51FD;&#x6570;&#xFF0C;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x5728;&#x8C03;&#x7528;vue&#x5B9E;&#x4F8B;&#x4E0A;&#x7684;<code>emit</code>&#x65B9;&#x6CD5;&#xFF0C;&#x8FD9;&#x4E0D;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x5728;vue2&#x7684;&#x9009;&#x9879;&#x5F0F;API&#x4E2D;&#x58F0;&#x660E;&#x4E8B;&#x4EF6;&#x548C;&#x89E6;&#x53D1;&#x4E8B;&#x4EF6;&#x7684;&#x6837;&#x5B50;&#x5417;&#x3002;&#x5927;&#x90E8;&#x5206;&#x770B;&#x7740;&#x9AD8;&#x5927;&#x4E0A;&#x7684;&#x9ED1;&#x9B54;&#x6CD5;&#x5176;&#x5B9E;&#x90FD;&#x662F;&#x7F16;&#x8BD1;&#x65F6;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;<strong>vue3&#x4E2D;&#x7684;&#x50CF;<code>defineEmits</code>&#x8FD9;&#x6837;&#x7684;&#x5B8F;&#x51FD;&#x6570;&#x7ECF;&#x8FC7;&#x7F16;&#x8BD1;&#x540E;&#x5176;&#x5B9E;&#x8FD8;&#x662F;&#x6211;&#x4EEC;&#x719F;&#x6089;&#x7684;vue2&#x7684;&#x9009;&#x9879;&#x5F0F;API&#x3002;</strong></p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/f73e82aa6b9e62fa6a5d7b0b58e53ece.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7347620503723098124.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7347620503723098124.html" itemprop="url">Qt C++食用教程 1、QtCreator安装 2、QtC</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-03-18T17:46:50+08:00">
                2024-03-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x7531;&#x4E8E;&#x9879;&#x76EE;&#x7ECF;&#x5E38;&#x8981;&#x5C55;&#x793A;&#x68C0;&#x6D4B;&#x7ED3;&#x679C;&#xFF0C;&#x4F46;&#x76F4;&#x63A5;&#x8FD0;&#x884C;&#x4EE3;&#x7801;&#x8FDB;&#x884C;&#x68C0;&#x6D4B;&#x5BF9;&#x64CD;&#x4F5C;&#x4EBA;&#x5458;&#x6781;&#x5176;&#x4E0D;&#x53CB;&#x597D;&#xFF0C;&#x6240;&#x4EE5;&#x505A;&#x4E00;&#x5957;&#x80FD;&#x5B8C;&#x7F8E;&#x8FD0;&#x884C;&#x68C0;&#x6D4B;&#x8FC7;&#x7A0B;&#x4EE5;&#x53CA;&#x5C55;&#x793A;&#x68C0;&#x6D4B;&#x7ED3;&#x679C;&#x7684;UI&#x754C;&#x9762;&#x663E;&#x5F97;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x3002;&#x7531;&#x4E8E;Qt&#x51E0;&#x4E4E;&#x53EF;&#x4EE5;&#x5728;&#x4EFB;&#x4F55;&#x8BBE;&#x5907;&#x4E0A;&#x4F7F;&#x7528;&#xFF0C;&#x4F60;&#x80FD;&#x5728;&#x4F60;&#x7684;&#x8BA1;&#x7B97;&#x673A;&#xFF0C;&#x667A;&#x80FD;&#x624B;&#x673A;&#xFF0C;&#x7535;&#x89C6;&#x4EE5;&#x53CA;&#x5176;&#x5B83;&#x7684;&#x667A;&#x80FD;&#x8BBE;&#x5907;&#x4E0A;&#x4F7F;&#x7528;&#x5B83;&#xFF0C;&#x800C;&#x4E14;qt&#x8BBE;&#x8BA1;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x65E0;&#x9700;&#x7ECF;&#x9A8C;&#xFF0C;&#x5F00;&#x53D1;&#x7B80;&#x5355;&#xFF0C;&#x5BF9;&#x5F00;&#x53D1;&#x8005;&#x975E;&#x5E38;&#x53CB;&#x597D;&#x3001;&#x5728;&#x5DE5;&#x4E1A;&#x4E0A;&#x88AB;&#x5E7F;&#x6CDB;&#x4F7F;&#x7528;,&#x6240;&#x4EE5;&#x6211;&#x51B3;&#x5B9A;&#x505A;&#x4E2A;Qt&#x8BBE;&#x8BA1;&#x7684;UI&#x754C;&#x9762;&#x7528;&#x6765;&#x5C55;&#x793A;&#x7B97;&#x6CD5;&#x4EE5;&#x53CA;&#x8FDB;&#x884C;&#x826F;&#x597D;&#x7684;&#x7528;&#x6237;&#x4EA4;&#x4E92;,&#x4E00;&#x8D77;&#x5B66;&#x4E60;&#x4E00;&#x4E0B;&#x5982;&#x4F55;&#x7528;Qt&#x642D;&#x5EFA;&#x4E00;&#x4E2A;&#x7B80;&#x6D01;&#x3001;&#x8212;&#x9002;&#x7684;UI&#x754C;&#x9762;&#x5427;&#x3002;</p>
<h1 id="1&#x3001;QtCreator&#x5B89;&#x88C5;"><a href="#1&#x3001;QtCreator&#x5B89;&#x88C5;" class="headerlink" title="1&#x3001;QtCreator&#x5B89;&#x88C5;"></a>1&#x3001;QtCreator&#x5B89;&#x88C5;</h1><p>&#x8FDB;&#x5165;&#x5B98;&#x7F51;<a href="/external_links/4dd537318c8e3cb3a35c46a41b1d576e.html" target="blank" rel="noopener">Download Qt: Get Qt Online Installer</a>&#x4E0B;&#x8F7D;QtCreator,&#x81EA;&#x884C;&#x9009;&#x62E9;&#x7CFB;&#x7EDF;&#x7248;&#x672C;&#xFF0C;&#x5B89;&#x88C5;&#x52FE;&#x9009;Qt-&gt;MinGW&#x4EE5;&#x53CA;MSVC&#x5373;&#x53EF;&#x3002;&#xFF08;MSVC&#x65B9;&#x4FBF;&#x8FDB;&#x884C;VS&#x7F16;&#x7A0B;&#xFF09;</p>
<h1 id="2&#x3001;QtCreator&#x4F7F;&#x7528;"><a href="#2&#x3001;QtCreator&#x4F7F;&#x7528;" class="headerlink" title="2&#x3001;QtCreator&#x4F7F;&#x7528;"></a>2&#x3001;QtCreator&#x4F7F;&#x7528;</h1><h2 id="S2-1&#xFF1A;&#x521B;&#x5EFA;&#x9879;&#x76EE;&#xFF1A;"><a href="#S2-1&#xFF1A;&#x521B;&#x5EFA;&#x9879;&#x76EE;&#xFF1A;" class="headerlink" title="S2.1&#xFF1A;&#x521B;&#x5EFA;&#x9879;&#x76EE;&#xFF1A;"></a>S2.1&#xFF1A;&#x521B;&#x5EFA;&#x9879;&#x76EE;&#xFF1A;</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rust&#x590D;&#x5236;&#x4EE3;&#x7801;          step1:&#x6253;&#x5F00;QtCreator&#xFF1B;</span><br><span class="line">          step2:&#x6587;&#x4EF6;-&gt;&#x65B0;&#x5EFA;&#x6587;&#x4EF6;&#x548C;&#x9879;&#x76EE;-&gt;Application-&gt;Qt Widgets Application-&gt;choose&#xFF1B;</span><br><span class="line">          step3:&#x4E00;&#x76F4;&#x70B9;&#x51FB;next&#x76F4;&#x5230;Kits&#x9009;&#x9879;&#xFF0C;&#x968F;&#x540E;&#x9009;&#x62E9;Desktop MSVC&#x7684;64&#x4F4D;&#x7248;&#x672C;&#x4EE5;&#x53CA;Desktop MinGW&#x7684;64&#x4F4D;&#x7248;&#x672C;&#xFF1B;</span><br><span class="line">          step4:&#x9009;&#x62E9;&#x5B8C;&#x540E;&#x7EE7;&#x7EED;next&#xFF0C;&#x5B8C;&#x6210;&#x9879;&#x76EE;&#x7684;&#x65B0;&#x5EFA;&#xFF1B;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/f5d00d4aca92aa2db2695c545654cf740d735d380c9e568c584c09d73d1f87ea" alt="&#x5C4F;&#x5E55;&#x622A;&#x56FE; 2024-03-17 200342.png"></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/3625f5eddc6801ce160260422ce36a3ef19cc0a1ab39f84df67d9289f351427d" alt="&#x5C4F;&#x5E55;&#x622A;&#x56FE; 2024-03-17 201255.png"></p>
<h2 id="S2-2&#xFF1A;&#x5BFC;&#x5165;&#x9879;&#x76EE;&#xFF1A;"><a href="#S2-2&#xFF1A;&#x5BFC;&#x5165;&#x9879;&#x76EE;&#xFF1A;" class="headerlink" title="S2.2&#xFF1A;&#x5BFC;&#x5165;&#x9879;&#x76EE;&#xFF1A;"></a>S2.2&#xFF1A;&#x5BFC;&#x5165;&#x9879;&#x76EE;&#xFF1A;</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rust&#x590D;&#x5236;&#x4EE3;&#x7801;        step1:&#x6253;&#x5F00;QtCreator&#xFF1B;</span><br><span class="line">        step2:&#x6587;&#x4EF6;-&gt;&#x65B0;&#x5EFA;&#x6587;&#x4EF6;&#x548C;&#x9879;&#x76EE;-&gt;Import Project-&gt;&#x5BFC;&#x5165;&#x73B0;&#x6709;&#x9879;&#x76EE;-&gt;choose;</span><br><span class="line">        step3:&#x521B;&#x5EFA;&#x81EA;&#x5DF1;&#x7684;&#x9879;&#x76EE;&#x540D;&#x79F0;&#x4EE5;&#x53CA;&#x9009;&#x62E9;&#x81EA;&#x5DF1;&#x7684;&#x9879;&#x76EE;&#x4F4D;&#x7F6E;;</span><br><span class="line">        step4:&#x9009;&#x62E9;&#x9879;&#x76EE;&#x4F4D;&#x7F6E;&#x4E0B;&#x9700;&#x5BFC;&#x5165;&#x7684;&#x6587;&#x4EF6;&#xFF1B;</span><br><span class="line">        step5:&#x4E00;&#x76F4;&#x70B9;&#x51FB;next&#xFF0C;&#x5B8C;&#x6210;&#x9879;&#x76EE;&#x6784;&#x5EFA;&#xFF1B;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/1806ce72989c7d1a9b4b71506c808696cea13154a7f42a21d4b8dc14d99ca042" alt="&#x5C4F;&#x5E55;&#x622A;&#x56FE; 2024-03-17 202137.png"><br><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/15f7f446087cde3eb127786a6b7e42535c223783d9be66a61b93a1e70c726792" alt="&#x5C4F;&#x5E55;&#x622A;&#x56FE; 2024-03-17 202137.png"></p>
<h2 id="S2-3-&#x9879;&#x76EE;&#x6587;&#x4EF6;&#x4ECB;&#x7ECD;&#xFF1A;"><a href="#S2-3-&#x9879;&#x76EE;&#x6587;&#x4EF6;&#x4ECB;&#x7ECD;&#xFF1A;" class="headerlink" title="S2.3 &#x9879;&#x76EE;&#x6587;&#x4EF6;&#x4ECB;&#x7ECD;&#xFF1A;"></a>S2.3 &#x9879;&#x76EE;&#x6587;&#x4EF6;&#x4ECB;&#x7ECD;&#xFF1A;</h2><p>.pro&#x6587;&#x4EF6;:Qt&#x9879;&#x76EE;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x53EF;&#x76F4;&#x63A5;&#x70B9;&#x51FB;&#x8BE5;&#x6587;&#x4EF6;&#x8FDB;&#x5165;qt&#x5BF9;&#x8BE5;&#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x7F16;&#x8F91;&#xFF0C;&#x91CC;&#x9762;&#x5305;&#x542B;&#x4E86;&#x5BF9;&#x5E93;&#x6587;&#x4EF6;&#x7684;&#x58F0;&#x660E;&#xFF0C;&#x94FE;&#x63A5;&#x7684;&#x4E09;&#x65B9;&#x5E93;&#xFF0C;&#x5F53;&#x4F60;&#x60F3;&#x8C03;&#x7528;py&#x5E93;&#x65F6;&#x9700;&#x8981;&#x5411;&#x91CC;&#x9762;&#x6DFB;&#x52A0;&#x5E93;&#x8DEF;&#x5F84;&#x4EE5;&#x53CA;&#x58F0;&#x660E;&#xFF1B;</p>
<p>.h&#x6587;&#x4EF6;&#xFF1A;&#x9879;&#x76EE;&#x7684;&#x5934;&#x6587;&#x4EF6;&#xFF08;&#x5B66;&#x8FC7;c&#x7684;&#x90FD;&#x77E5;&#x9053;&#x80FD;&#x4ECE;&#x91CC;&#x9762;&#x8C03;&#x7528;&#x5E93;&#x51FD;&#x6570;&#xFF09;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x5728;&#x91CC;&#x9762;&#x58F0;&#x660E;&#x51FD;&#x6570;&#x7C7B;,&#x5E38;&#x7528;&#x7684;public&#x7C7B;&#x80FD;&#x88AB;&#x88AB;&#x672C;&#x7C7B;&#x4E2D;&#x7684;&#x6210;&#x5458;&#x51FD;&#x6570;&#x6240;&#x5F15;&#x7528;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x88AB;&#x7C7B;&#x7684;&#x4F5C;&#x7528;&#x57DF;&#x5185;&#x7684;&#x5176;&#x4ED6;&#x51FD;&#x6570;&#x5F15;&#x7528;&#xFF0C;private&#x5219;&#x53EA;&#x80FD;&#x88AB;&#x672C;&#x7C7B;&#x4E2D;&#x7684;&#x6210;&#x5458;&#x51FD;&#x6570;&#x5F15;&#x7528;&#xFF1B;</p>
<p>.cpp&#x6587;&#x4EF6;&#xFF1A;&#x9875;&#x9762;&#x5185;&#x5BB9;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x5728;&#x8FD9;&#x91CC;&#x4F60;&#x80FD;&#x5C06;&#x60F3;&#x8981;&#x7684;&#x9875;&#x9762;&#x6548;&#x679C;&#x5199;&#x51FA;&#x6765;&#xFF1B;</p>
<p>.ui&#x6587;&#x4EF6;&#xFF1A;&#x70B9;&#x51FB;&#x53EF;&#x8FDB;&#x5165;qtdesigner&#x8BBE;&#x8BA1;&#x754C;&#x9762;&#xFF0C;&#x62D6;&#x62FD;&#x63A7;&#x4EF6;&#x8FDB;&#x5165;&#x9875;&#x9762;&#x5373;&#x53EF;&#x5B8C;&#x6210;&#x63A7;&#x4EF6;&#x7684;&#x6DFB;&#x52A0;&#xFF1B;<br>&#x8BBE;&#x8BA1;&#x754C;&#x9762;&#x7684;&#x63A7;&#x4EF6;&#x5206;&#x7C7B;&#x53EF;&#x53C2;&#x8003;&#x4E0B;&#x56FE;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/ec890a475522a53aea369b12db7f70a02030523a67e9d230d34169fb97c4e19a" alt="&#x5C4F;&#x5E55;&#x622A;&#x56FE; 2024-03-17 210540.png"></p>
<h1 id="3&#x3001;VS&#x4F7F;&#x7528;&#x63A7;&#x4EF6;&#x8F7D;&#x5165;Qt"><a href="#3&#x3001;VS&#x4F7F;&#x7528;&#x63A7;&#x4EF6;&#x8F7D;&#x5165;Qt" class="headerlink" title="3&#x3001;VS&#x4F7F;&#x7528;&#x63A7;&#x4EF6;&#x8F7D;&#x5165;Qt"></a>3&#x3001;VS&#x4F7F;&#x7528;&#x63A7;&#x4EF6;&#x8F7D;&#x5165;Qt</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rust&#x590D;&#x5236;&#x4EE3;&#x7801;step1:&#x8FDB;&#x5165;VS&#xFF0C;&#x70B9;&#x51FB;&#x6269;&#x5C55;-&gt;&#x7BA1;&#x7406;&#x6269;&#x5C55;-&gt;&#x641C;&#x7D22;Qt Visudio Tools-&gt;&#x70B9;&#x51FB;&#x5B89;&#x88C5;&#xFF1B;</span><br><span class="line">step2:&#x52A0;&#x8F7D;msvc&#x7F16;&#x8BD1;&#x5668;&#xFF0C;&#x70B9;&#x51FB;&#x6269;&#x5C55;-&gt;Qt Visudio Tools-&gt;Qt Versions</span><br><span class="line">step3:version&#x5199;&#x81EA;&#x5DF1;Qt&#x7248;&#x672C;&#x540D;&#x5373;&#x53EF;&#xFF0C;path&#x9009;&#x62E9;MSVC&#x76EE;&#x5F55;&#x4E0B;&#x7684;bin&#x4E2D;&#x7684;.exe</span><br><span class="line">step4:&#x9879;&#x76EE;&#x5C5E;&#x6027;&#x9875;&#x4E2D;&#x9009;&#x62E9;Qt Project Settings-&gt;&#x70B9;&#x51FB;Qt Modules-&gt;&#x9009;&#x62E9;&#x81EA;&#x5DF1;&#x9700;&#x8981;&#x7684;&#x6A21;&#x5757;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/c690dd8bd5088c6b21eb15599b892610f7f4d0671b868ee5df1e045e6a9878f2" alt="{2A74C12C-4B22-4069-897D-53D1311B72AD}.png"><br>&#x60F3;&#x8981;&#x7528;VS&#x5FEB;&#x901F;&#x6253;&#x5F00;.ui&#x6587;&#x4EF6;&#x8FDB;&#x5165;&#x8BBE;&#x8BA1;&#x754C;&#x9762;&#xFF1A;&#x5728;VS&#x4E2D;&#x53F3;&#x952E;&#x4F60;&#x7684;.ui&#x6587;&#x4EF6;&#xFF0C;&#x9009;&#x62E9;&#x6253;&#x5F00;&#x65B9;&#x5F0F;&#xFF0C;&#x65B0;&#x5EFA;&#x9879;&#xFF0C;&#x6DFB;&#x52A0;&#x4F60;&#x7684;QtCreator.exe&#x6216;Qt Designer.exe&#x5373;&#x53EF;&#x3002;</p>
<h1 id="4&#x3001;&#x7528;&#x4F8B;&#xFF1A;"><a href="#4&#x3001;&#x7528;&#x4F8B;&#xFF1A;" class="headerlink" title="4&#x3001;&#x7528;&#x4F8B;&#xFF1A;"></a>4&#x3001;&#x7528;&#x4F8B;&#xFF1A;</h1><p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/583d6ee2d089218a7776275aa6758f1c5fb4e04e97b1023e6e42f857dd9dac99" alt="&#x5C4F;&#x5E55;&#x622A;&#x56FE; 2024-03-18 174113.png"></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/144011cad1f6e100f58ef0a115e45467b307b8cf4c3db977ac10ca14a4e1e224" alt="&#x5C4F;&#x5E55;&#x622A;&#x56FE; 2024-03-18 174016.png"><br>&#x7B80;&#x5355;&#x7684;&#x914D;&#x7F6E;&#x4F7F;&#x7528;&#x4ECB;&#x7ECD;&#x5C31;&#x5230;&#x8FD9;&#x4E86;&#xFF0C;&#x53BB;&#x8BD5;&#x8BD5;&#x8BBE;&#x8BA1;&#x4E2A;&#x767B;&#x5F55;&#x754C;&#x9762;&#x5427;&#xFF01;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/794f0bad82db65a34cd514c149e566d2.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7347000319983419411.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7347000319983419411.html" itemprop="url">在 kubernetes 环境下如何采集日志 节点采集 Si</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-03-18T11:06:19+08:00">
                2024-03-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x672C;&#x6587;&#x4E3A;&#x7A00;&#x571F;&#x6398;&#x91D1;&#x6280;&#x672F;&#x793E;&#x533A;&#x9996;&#x53D1;&#x7B7E;&#x7EA6;&#x6587;&#x7AE0;&#xFF0C;30&#x5929;&#x5185;&#x7981;&#x6B62;&#x8F6C;&#x8F7D;&#xFF0C;30&#x5929;&#x540E;&#x672A;&#x83B7;&#x6388;&#x6743;&#x7981;&#x6B62;&#x8F6C;&#x8F7D;&#xFF0C;&#x4FB5;&#x6743;&#x5FC5;&#x7A76;&#xFF01;</p>
<p>&#x5F53;&#x6211;&#x4EEC;&#x6CA1;&#x6709;&#x4F7F;&#x7528;&#x4E91;&#x539F;&#x751F;&#x65B9;&#x6848;&#x90E8;&#x7F72;&#x5E94;&#x7528;&#x65F6;&#x91C7;&#x7528;&#x7684;&#x65E5;&#x5FD7;&#x65B9;&#x6848;&#x5F80;&#x5F80;&#x662F; ELK &#x6280;&#x672F;&#x6808;&#x3002;<br><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/170bd36c33d917fb4370dce4e5092a45c2e7aeacfa50573fe2d0cb0a2bdff112" alt></p>
<p>&#x8FD9;&#x5957;&#x6280;&#x672F;&#x65B9;&#x6848;&#x6BD4;&#x8F83;&#x6210;&#x719F;&#xFF0C;&#x7A33;&#x5B9A;&#x6027;&#x4E5F;&#x5F88;&#x9AD8;&#xFF0C;&#x6240;&#x4EE5;&#x51E0;&#x4E4E;&#x6210;&#x4E3A;&#x4E86;&#x5F53;&#x65F6;&#x7684;&#x6807;&#x914D;&#x3002;</p>
<p>&#x53EF;&#x662F;&#x968F;&#x7740;&#x6211;&#x4EEC;&#x4F7F;&#x7528; kubernetes &#x6B65;&#x5165;&#x4E91;&#x539F;&#x751F;&#x7684;&#x65F6;&#x4EE3;&#x540E;&#xFF0C; kubernetes &#x628A;&#x4EE5;&#x5F80;&#x7684;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x4E0A;&#x7684;&#x8BB8;&#x591A;&#x5E95;&#x5C42;&#x90FD;&#x5C4F;&#x853D;&#xFF0C;&#x518D;&#x7531;&#x4ED6;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E9B;&#x6807;&#x51C6;&#x63A5;&#x53E3;&#x3002;</p>
<p>&#x540C;&#x65F6;&#x5728; kubernetes &#x4E2D;&#x7684;&#x65E5;&#x5FD7;&#x6765;&#x6E90;&#x4E5F;&#x6BD4;&#x4F20;&#x7EDF;&#x865A;&#x62DF;&#x673A;&#x591A;&#xFF0C;&#x6BD4;&#x5982;&#x53EF;&#x80FD;&#x6709;&#x5BB9;&#x5668;&#x3001;kubernetes &#x81EA;&#x8EAB;&#x7684;&#x4E8B;&#x4EF6;&#x3001;&#x65E5;&#x5FD7;&#x7B49;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x7684;&#x65E5;&#x5FD7;&#x91C7;&#x96C6;&#x65B9;&#x6848;&#x4E5F;&#x5F97;&#x4E0E;&#x65F6;&#x4FF1;&#x8FDB;&#xFF0C;kubernetes &#x7684;&#x5B98;&#x65B9;&#x535A;&#x5BA2;&#x6709;&#x4ECB;&#x7ECD;&#x63D0;&#x4F9B;&#x4E00;&#x4E0B;&#x51E0;&#x79CD;&#x65B9;&#x6848;&#xFF1A;</p>
<h1 id="&#x8282;&#x70B9;&#x91C7;&#x96C6;"><a href="#&#x8282;&#x70B9;&#x91C7;&#x96C6;" class="headerlink" title="&#x8282;&#x70B9;&#x91C7;&#x96C6;"></a>&#x8282;&#x70B9;&#x91C7;&#x96C6;</h1><p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/c3fe1c50d49d2f01167a4155107c9b1b27ec81af64dfed100d7d1cdfda1ed2eb" alt></p>
<p>&#x7B2C;&#x4E00;&#x79CD;&#x65B9;&#x6848;&#x662F;&#x5728;&#x8282;&#x70B9;&#x4E2D;&#x91C7;&#x96C6;&#x65E5;&#x5FD7;&#xFF0C;&#x6211;&#x4EEC;&#x77E5;&#x9053; kubernetes &#x662F;&#x5206;&#x4E3A; master &#x8C03;&#x5EA6;&#x8282;&#x70B9;&#x4EE5;&#x53CA; worker &#x5DE5;&#x4F5C;&#x8282;&#x70B9;&#xFF1B;&#x6211;&#x4EEC;&#x7684;&#x5E94;&#x7528;&#x90FD;&#x662F;&#x8FD0;&#x884C;&#x5728; worker &#x8282;&#x70B9;&#x4E2D;&#x7684;&#x3002;</p>
<blockquote>
<p>&#x5728; kubernetes &#x73AF;&#x5883;&#x4E2D;&#x66F4;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x6807;&#x51C6;&#x7684; stdout/stderr &#x4F5C;&#x4E3A;&#x65E5;&#x5FD7;&#x8F93;&#x51FA;&#xFF0C;&#x8FD9;&#x6837; kubernetes &#x66F4;&#x65B9;&#x4FBF;&#x505A;&#x7EDF;&#x4E00;&#x5904;&#x7406;&#x3002;</p>
</blockquote>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/5b2db5eb99963a5b04c2027a27a9562d19202fc0a304e6d9e188875f650d91c1" alt></p>
<p>&#x4EE5;&#x6211;&#x4EEC;&#x7684; docker &#x8FD0;&#x884C;&#x65F6;&#x4E3A;&#x4F8B;&#xFF0C;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#x6211;&#x4EEC;&#x7684;&#x6807;&#x51C6;&#x8F93;&#x5165;&#x6587;&#x4EF6;&#x4F1A;&#x5199;&#x5165;&#x5230; <code>/var/log</code> &#x76EE;&#x5F55;&#x4E2D;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/0d7896af3481e728995a8704ed2d25a718d66a953c624547347bd955156143b5" alt></p>
<p>&#x5982;&#x4E0A;&#x56FE;&#x6240;&#x793A;&#xFF1A;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728; kubernetes &#x7684;&#x6BCF;&#x4E00;&#x4E2A; worker &#x8282;&#x70B9;&#x4E2D;&#x90E8;&#x7F72;&#x4E00;&#x4E2A; <code>DaemonSet</code> &#x7C7B;&#x578B;&#x7684;&#x91C7;&#x96C6;&#x5668;&#xFF08;filebeat &#x7B49;&#xFF09;&#xFF0C;&#x518D;&#x7531;&#x4ED6;&#x53BB;&#x91C7;&#x96C6;&#x8BE5;&#x8282;&#x70B9;&#x4E0B; <code>/var/log</code> &#x7684;&#x65E5;&#x5FD7;&#xFF0C;&#x6700;&#x7EC8;&#x7531;&#x4ED6;&#x5C06;&#x65E5;&#x5FD7;&#x91C7;&#x96C6;&#x540E;&#x53D1;&#x5F80;&#x65E5;&#x5FD7;&#x5904;&#x7406;&#x7684;&#x540E;&#x7AEF;&#xFF0C;&#x6BD4;&#x5982; elasticsearch &#x7B49;&#x7EC4;&#x4EF6;&#x4E2D;&#x3002;</p>
<p>&#x8FD9;&#x79CD;&#x65B9;&#x6848;&#x7684;&#x597D;&#x5904;&#x662F;&#x8D44;&#x6E90;&#x5360;&#x7528;&#x8F83;&#x4F4E;&#xFF0C;&#x5F80;&#x5F80;&#x662F;&#x6709;&#x591A;&#x5C11;&#x4E2A; worker &#x8282;&#x70B9;&#x5C31;&#x53EF;&#x4EE5;&#x90E8;&#x7F72;&#x591A;&#x5C11;&#x4E2A;&#x91C7;&#x96C6;&#x5668;&#x3002;</p>
<p>&#x800C;&#x4E14;&#x548C;&#x4E1A;&#x52A1;&#x7684;&#x8026;&#x5408;&#x5EA6;&#x4F4E;&#xFF0C;&#x4E1A;&#x52A1;&#x548C;&#x91C7;&#x96C6;&#x5668;&#x4E0D;&#x7BA1;&#x8C01;&#x8FDB;&#x884C;&#x91CD;&#x542F;&#x6216;&#x5347;&#x7EA7;&#x4E92;&#x76F8;&#x90FD;&#x4E0D;&#x4F1A;&#x4EA7;&#x751F;&#x5F71;&#x54CD;&#x3002;</p>
<p>&#x4F46;&#x7F3A;&#x70B9;&#x4E5F;&#x6BD4;&#x8F83;&#x660E;&#x663E;&#xFF0C;&#x6574;&#x4E2A;&#x8282;&#x70B9;&#x7684;&#x65E5;&#x5FD7;&#x91C7;&#x96C6;&#x74F6;&#x9888;&#x90FD;&#x5728;&#x8FD9;&#x4E2A;&#x91C7;&#x96C6;&#x5668;&#x8FD9;&#x91CC;&#x4E86;&#xFF0C;&#x5982;&#x679C;&#x67D0;&#x4E9B; worker &#x8282;&#x70B9;&#x7684; Pod &#x6570;&#x91CF;&#x4E0D;&#x5747;&#x8861;&#xFF0C;&#x6216;&#x8005;&#x662F;&#x672C;&#x8EAB;&#x65E5;&#x5FD7;&#x4EA7;&#x751F;&#x4E5F;&#x4E0D;&#x5E73;&#x5747;&#x65F6;&#x5C31;&#x4F1A;&#x51FA;&#x73B0;&#x660E;&#x663E;&#x7684;&#x8D1F;&#x503A;&#x4E0D;&#x5E73;&#x8861;&#x3002;</p>
<p>&#x800C;&#x4E14;&#x4E5F;&#x65E0;&#x6CD5;&#x9488;&#x5BF9;&#x67D0;&#x4E9B;&#x65E5;&#x5FD7;&#x9AD8;&#x5CF0;&#x573A;&#x666F;&#x8FDB;&#x884C;&#x8C03;&#x4F18;&#xFF08;&#x6BD5;&#x7ADF;&#x6240;&#x6709;&#x7684; Pod &#x90FD;&#x662F;&#x4F7F;&#x7528;&#x7684;&#x4E00;&#x4E2A;&#x65E5;&#x5FD7;&#x91C7;&#x96C6;&#x5668;&#xFF09;&#x3002;</p>
<p>&#x6240;&#x4EE5;&#x8282;&#x70B9;&#x7EA7;&#x7684;&#x65E5;&#x5FD7;&#x91C7;&#x96C6;&#x66F4;&#x9002;&#x7528;&#x4E0E;&#x8BE5; worker &#x8282;&#x70B9;&#x8D1F;&#x503A;&#x8F83;&#x4F4E;&#x7684;&#x65F6;&#x5019;&#x4F7F;&#x7528;&#xFF0C;&#x4E5F;&#x66F4;&#x5BB9;&#x6613;&#x7EF4;&#x62A4;&#x3002;</p>
<h1 id="Sidecar-&#x4EE3;&#x7406;&#x6A21;&#x5F0F;"><a href="#Sidecar-&#x4EE3;&#x7406;&#x6A21;&#x5F0F;" class="headerlink" title="Sidecar &#x4EE3;&#x7406;&#x6A21;&#x5F0F;"></a>Sidecar &#x4EE3;&#x7406;&#x6A21;&#x5F0F;</h1><p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/20a005a35d418c6fca6357f638ffe03fe16ee36c8c75e5bee2df77634ab51978" alt><br>&#x7B2C;&#x4E8C;&#x79CD;&#x76F8;&#x5BF9;&#x4E8E;&#x7B2C;&#x4E00;&#x79CD;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;&#x7531;&#x96C6;&#x4E2D;&#x5F0F;&#x7684;&#x65E5;&#x5FD7;&#x91C7;&#x96C6;&#x5206;&#x6563;&#x5230;&#x5404;&#x4E2A;&#x5E94;&#x7528; Pod &#x4E2D;&#x81EA;&#x884C;&#x91C7;&#x96C6;&#x3002;</p>
<p>&#x9700;&#x8981;&#x4E3A;&#x6BCF;&#x4E00;&#x4E2A;&#x4E1A;&#x52A1; Pod &#x6302;&#x8F7D;&#x4E00;&#x4E2A;&#x8FB9;&#x8F66;&#xFF08;sidecar&#xFF09;&#x8FDB;&#x884C;&#x65E5;&#x5FD7;&#x91C7;&#x96C6;&#xFF0C;&#x7531;&#x4E8E;&#x8FB9;&#x8F66;&#x548C;&#x4E1A;&#x52A1; Pod &#x5171;&#x4EAB;&#x7684;&#x662F;&#x4E00;&#x4E2A;&#x5B58;&#x50A8;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x5F88;&#x65B9;&#x4FBF;&#x7684;&#x8BFB;&#x53D6;&#x5230;&#x65E5;&#x5FD7;&#x3002;</p>
<p>&#x7531;&#x4E8E;&#x5B83;&#x662F;&#x548C;&#x5E94;&#x7528;&#x6302;&#x8F7D;&#x5728;&#x4E00;&#x8D77;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x8D44;&#x6E90;&#x5360;&#x7528;&#x81EA;&#x7136;&#x4F1A;&#x6BD4;&#x8282;&#x70B9;&#x91C7;&#x96C6;&#x66F4;&#x591A;&#xFF0C;&#x540C;&#x7406;&#x8026;&#x5408;&#x5EA6;&#x4E5F;&#x589E;&#x52A0;&#x4E86;&#xFF0C;&#x91C7;&#x96C6;&#x7EC4;&#x4EF6;&#x7684;&#x5347;&#x7EA7;&#x53EF;&#x80FD;&#x8FD8;&#x4F1A;&#x5F71;&#x54CD;&#x7684;&#x4E1A;&#x52A1; Pod&#x3002;</p>
<p>&#x4F46;&#x540C;&#x6837;&#x7684;&#x5E26;&#x6765;&#x597D;&#x5904;&#x5C31;&#x662F;&#x53EF;&#x4EE5;&#x9488;&#x5BF9;&#x5355;&#x4E2A; Pod &#x66F4;&#x7CBE;&#x7EC6;&#x7684;&#x63A7;&#x5236;&#x91C7;&#x96C6;&#x65B9;&#x6848;&#x3002;</p>
<p>&#x6BD4;&#x5982;&#x5BF9;&#x4E8E;&#x4E00;&#x4E9B;&#x65E5;&#x5FD7;&#x5199;&#x5165;&#x9891;&#x7E41;&#x7684;&#x5E94;&#x7528;&#xFF0C;&#x53EF;&#x4EE5;&#x5C06; filebeat &#x7684;&#x914D;&#x7F6E;&#x63D0;&#x9AD8;&#xFF0C;&#x751A;&#x81F3;&#x8FD8;&#x53EF;&#x4EE5;&#x5C06;&#x8FD9;&#x79CD;&#x9AD8;&#x8D1F;&#x8F7D;&#x7684;&#x65E5;&#x5FD7;&#x5355;&#x72EC;&#x5199;&#x5165;&#x4E00;&#x4E2A; elasticsearch &#x4E2D;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x4E0E;&#x666E;&#x901A;&#x8D1F;&#x8F7D;&#x7684;&#x65E5;&#x5FD7;&#x8FDB;&#x884C;&#x8D44;&#x6E90;&#x9694;&#x79BB;&#x3002;</p>
<p>&#x8FD9;&#x4E2A;&#x65B9;&#x6848;&#x66F4;&#x9002;&#x7528;&#x4E0E;&#x96C6;&#x7FA4;&#x89C4;&#x6A21;&#x8F83;&#x5927;&#x7684;&#x573A;&#x666F;&#xFF0C;&#x9700;&#x8981;&#x505A;&#x4E00;&#x4E9B;&#x7CBE;&#x7EC6;&#x5316;&#x914D;&#x7F6E;&#x3002;</p>
<hr>
<p>&#x6211;&#x4EEC;&#x5176;&#x5B9E;&#x4E5F;&#x662F;&#x91C7;&#x7528;&#x7684;&#x4E5F;&#x662F;&#x8FD9;&#x4E2A;&#x65B9;&#x6848;&#xFF0C;&#x4E0D;&#x8FC7;&#x5177;&#x4F53;&#x7EC6;&#x8282;&#x7A0D;&#x6709;&#x4E0D;&#x540C;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x6CA1;&#x6709;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x6807;&#x51C6;&#x8F93;&#x5165;&#x548C;&#x8F93;&#x51FA;&#xFF0C;&#x539F;&#x56E0;&#x5982;&#x4E0B;&#xFF1A;</p>
<p>&#x65E5;&#x5FD7;&#x683C;&#x5F0F;&#x6CA1;&#x6CD5;&#x7EDF;&#x4E00;&#xFF0C;&#x5BFC;&#x81F4;&#x6700;&#x7EC8;&#x67E5;&#x8BE2;&#x7684;&#x65F6;&#x5019;&#x65E0;&#x6CD5;&#x505A;&#x4E00;&#x4E9B;&#x6807;&#x51C6;&#x5316;&#x7684;&#x9650;&#x5236;&#xFF08;&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x8981;&#x6C42;&#x6BCF;&#x4E2A;&#x65E5;&#x5FD7;&#x90FD;&#x9700;&#x8981;&#x5E26;&#x4E1A;&#x52A1; id&#x3001;traceId &#x7B49;&#xFF0C;&#x67E5;&#x8BE2;&#x65F6;&#x5019;&#x6709;&#x8FD9;&#x4E9B;&#x4E1A;&#x52A1;&#x6307;&#x6807;&#x5C31;&#x5F88;&#x5BB9;&#x6613;&#x6C89;&#x6DC0;&#x4E00;&#x4E9B;&#x6807;&#x51C6;&#x7684;&#x67E5;&#x8BE2;&#x8BED;&#x53E5;&#x3002;&#xFF09;</p>
<p>&#x6700;&#x7EC8;&#x6211;&#x4EEC;&#x8FD8;&#x662F;&#x91C7;&#x7528;&#x4E86; Java &#x7684;&#x8001;&#x670B;&#x53CB;&#xFF0C;logback &#x914D;&#x7F6E;&#x4E86;&#x81EA;&#x5DF1;&#x7684;&#x65E5;&#x5FD7;&#x683C;&#x5F0F;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x5E94;&#x7528;&#x90FD;&#x4F1A;&#x6839;&#x636E;&#x8FD9;&#x4E2A;&#x6A21;&#x7248;&#x8FDB;&#x884C;&#x65E5;&#x5FD7;&#x8F93;&#x51FA;&#x3002;</p>
<p>&#x540C;&#x65F6;&#x5229;&#x7528;&#x65E5;&#x5FD7;&#x6846;&#x67B6;&#x7684;&#x6279;&#x91CF;&#x5199;&#x5165;&#x3001;&#x7F13;&#x51B2;&#x7B49;&#x7279;&#x6027;&#x8FD8;&#x66F4;&#x5BB9;&#x6613;&#x8FDB;&#x884C;&#x65E5;&#x5FD7;&#x7684;&#x6027;&#x80FD;&#x8C03;&#x4F18;&#x3002;&#xFF08;&#x53EA;&#x4F7F;&#x7528;&#x6807;&#x51C6;&#x8F93;&#x51FA;&#x65F6;&#x5BF9;&#x5E94;&#x7528;&#x6765;&#x8BF4;&#x662F;&#x9ED1;&#x76D2;&#x3002;&#xFF09;</p>
<p>&#x6700;&#x7EC8;&#x6211;&#x4EEC;&#x7684;&#x6280;&#x672F;&#x65B9;&#x6848;&#x662F;&#xFF1A;<br><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/a6e843a03caa2ea6813b09e0e63a83d1cc6ccf26f4f12c58c116e37be3d832c9" alt></p>
<h1 id="&#x76F4;&#x63A5;&#x5199;&#x5165;"><a href="#&#x76F4;&#x63A5;&#x5199;&#x5165;" class="headerlink" title="&#x76F4;&#x63A5;&#x5199;&#x5165;"></a>&#x76F4;&#x63A5;&#x5199;&#x5165;</h1><p>&#x8FD8;&#x6709;&#x4E00;&#x79CD;&#x65B9;&#x6848;&#x662F;&#x76F4;&#x63A5;&#x5199;&#x5165;&#xFF0C;&#x8FD9;&#x4E2A;&#x5176;&#x5B9E;&#x548C; kubernetes &#x672C;&#x8EAB;&#x5C31;&#x6CA1;&#x6709;&#x592A;&#x591A;&#x5173;&#x7CFB;&#x4E86;&#x3002;</p>
<p>&#x7531;&#x4E1A;&#x52A1;&#x81EA;&#x5DF1;&#x8C03;&#x7528; elasticsearch &#x6216;&#x8005;&#x5176;&#x4ED6;&#x7684;&#x5B58;&#x50A8;&#x7EC4;&#x4EF6;&#x7684; API &#x8FDB;&#x884C;&#x5199;&#x5165;&#xFF0C;&#x8FD9;&#x79CD;&#x901A;&#x5E38;&#x9002;&#x7528;&#x4E8E;&#x5BF9;&#x6027;&#x80FD;&#x8981;&#x6C42;&#x8F83;&#x9AD8;&#x7684;&#x573A;&#x666F;&#xFF0C;&#x7565;&#x8FC7;&#x4E86;&#x4E2D;&#x95F4;&#x7684;&#x91C7;&#x96C6;&#x6B65;&#x9AA4;&#xFF0C;&#x76F4;&#x63A5;&#x5199;&#x5165;&#x5B58;&#x50A8;&#x7AEF;&#x3002;</p>
<p>&#x8FD9;&#x4E2A;&#x6211;&#x5728; <a href="/external_links/f9bd4fcec43df9d4847ae46a3cb7e032.html" target="blank" rel="noopener">VictoriaLogs&#xFF1A;&#x4E00;&#x6B3E;&#x8D85;&#x4F4E;&#x5360;&#x7528;&#x7684; ElasticSearch &#x66FF;&#x4EE3;&#x65B9;&#x6848;</a>&#x4E2D;&#x4ECB;&#x7ECD;&#x8FC7;&#xFF0C;&#x6211;&#x9700;&#x8981;&#x5728; broker &#x7684;&#x62E6;&#x622A;&#x5668;&#x4E2D;&#x57CB;&#x70B9;&#x6D88;&#x606F;&#x4FE1;&#x606F;&#xFF0C;&#x4ECE;&#x800C;&#x53EF;&#x4EE5;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x6D88;&#x606F;&#x1F194;&#x7684;&#x94FE;&#x8DEF;&#x4FE1;&#x606F;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/17ebd2c95765a002b09f1802053874402b7d19e9f4d22e06440fb0120ca0a92d" alt></p>
<p>&#x56E0;&#x4E3A;&#x9700;&#x8981;&#x62E6;&#x622A;&#x6D88;&#x606F;&#x7684;&#x53D1;&#x9001;&#x3001;&#x6D88;&#x8D39;&#x7684;&#x5404;&#x4E2A;&#x9636;&#x6BB5;&#xFF0C;&#x52A0;&#x4E0A;&#x5E76;&#x53D1;&#x538B;&#x529B;&#x8F83;&#x9AD8;&#xFF0C;&#x6240;&#x4EE5;&#x5BF9;&#x65E5;&#x5FD7;&#x7684;&#x5199;&#x5165;&#x6027;&#x80FD;&#x8981;&#x6C42;&#x8FD8;&#x662F;&#x86EE;&#x9AD8;&#x7684;&#x3002;</p>
<p>&#x56E0;&#x6B64;&#x5C31;&#x9700;&#x8981;&#x5728;&#x62E6;&#x622A;&#x5668;&#x4E2D;&#x76F4;&#x63A5;&#x5BF9;&#x5199;&#x5165;&#x5230;&#x65E5;&#x5FD7;&#x5B58;&#x50A8;&#x3002;</p>
<blockquote>
<p>&#x8FD9;&#x91CC;&#x8003;&#x8651;&#x5230;&#x6211;&#x8FD9;&#x91CC;&#x7684;&#x4F46;&#x4E00;&#x573A;&#x666F;&#xFF0C;&#x4EE5;&#x53CA;&#x5BF9;&#x8D44;&#x6E90;&#x7684;&#x6D88;&#x8017;&#xFF0C;&#x6700;&#x7EC8;&#x9009;&#x53D6;&#x4E86; <code>victoriaLog</code> &#x8FD9;&#x4E2A;&#x65E5;&#x5FD7;&#x5B58;&#x50A8;&#x3002;</p>
</blockquote>
<p>&#x800C;&#x5728;&#x53D1;&#x9001;&#x65E5;&#x5FD7;&#x7684;&#x65F6;&#x5019;&#x4E5F;&#x5F97;&#x7528;&#x4E86;&#x9AD8;&#x6027;&#x80FD;&#x7684;&#x65E5;&#x5FD7;&#x53D1;&#x751F;&#x6846;&#x67B6;&#xFF0C;&#x8FD9;&#x91CC;&#x9009;&#x53D6;&#x4E86;<a href="/external_links/836cc33f3ac8d50c070cfbfc8eb25178.html" target="blank" rel="noopener">aliyun-log-java-producer</a>&#x7136;&#x540E;&#x505A;&#x4E86;&#x4E00;&#x4E9B;&#x5B9A;&#x5236;&#x3002;</p>
<p>&#x8FD9;&#x4E2A;&#x5E93;&#x652F;&#x6301;&#x4EE5;&#x4E0B;&#x4E00;&#x4E9B;&#x529F;&#x80FD;&#xFF1A;</p>
<ul>
<li>&#x9AD8;&#x6027;&#x80FD;&#xFF1A;&#x6279;&#x91CF;&#x53D1;&#x9001;&#x3001;&#x591A;&#x7EBF;&#x7A0B;&#x7B49;</li>
<li>&#x81EA;&#x52A8;&#x91CD;&#x8BD5;</li>
<li>&#x5F02;&#x6B65;&#x975E;&#x963B;&#x585E;</li>
<li>&#x8D44;&#x6E90;&#x63A7;&#x5236;&#xFF08;&#x53EF;&#x4EE5;&#x5BF9;&#x5185;&#x5B58;&#x3001;&#x6570;&#x91CF;&#x8FDB;&#x884C;&#x63A7;&#x5236;&#xFF09;</li>
</ul>
<p>&#x56E0;&#x4E3A;&#x8FD9;&#x662F;&#x4E3A;&#x963F;&#x91CC;&#x4E91;&#x65E5;&#x5FD7;&#x670D;&#x52A1;&#x7684;&#x4E00;&#x4E2A;&#x7EC4;&#x4EF6;&#xFF0C;&#x4EE3;&#x7801;&#x91CC;&#x786C;&#x7F16;&#x7801;&#x4E86;&#x53EA;&#x80FD;&#x5199;&#x5165;&#x963F;&#x91CC;&#x7684;&#x65E5;&#x5FD7;&#x670D;&#x52A1;&#x3002;</p>
<p>&#x6240;&#x4EE5;&#x62FF;&#x6765;&#x7A0D;&#x52A0;&#x6539;&#x9020;&#x540E;&#xFF0C;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x652F;&#x6301;&#x81EA;&#x5B9A;&#x4E49;&#x53D1;&#x9001;&#x5230;&#x4EFB;&#x610F;&#x540E;&#x7AEF;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x5728;&#x521D;&#x59CB;&#x5316;&#x65F6;&#x81EA;&#x5B9A;&#x4E49;&#x5B9E;&#x73B0;&#x53D1;&#x9001;&#x56DE;&#x8C03;&#x63A5;&#x53E3;&#x5373;&#x53EF;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;ProducerConfig producerConfig = new ProducerConfig();</span><br><span class="line">producerConfig.setSenderArgs(new Object[]{vlogUrl, client});</span><br><span class="line">producerConfig.setSender((batch, args) -&gt; {</span><br><span class="line">    StringBuilder body = new StringBuilder();</span><br><span class="line">    for (String s : batch.getLogItemsString()) {</span><br><span class="line">        body.append(&quot;{\&quot;create\&quot;:{}}&quot;);</span><br><span class="line">        body.append(&quot;\n&quot;);</span><br><span class="line">        body.append(s);</span><br><span class="line">        body.append(&quot;\n&quot;);</span><br><span class="line">    }</span><br><span class="line">    RequestBody requestBody =</span><br><span class="line">            RequestBody.create(MediaType.parse(&quot;application/json&quot;), body.toString());</span><br><span class="line">    Request request =</span><br><span class="line">            new Request.Builder()</span><br><span class="line">                    .url(String.format(&quot;%s/insert/elasticsearch/_bulk&quot;, args[0]))</span><br><span class="line">                    .post(requestBody)</span><br><span class="line">                    .build();</span><br><span class="line"></span><br><span class="line">    OkHttpClient okHttpClient = (OkHttpClient) args[1];</span><br><span class="line">    try (Response response = okHttpClient.newCall(request).execute()) {</span><br><span class="line">        if (response.isSuccessful()) {</span><br><span class="line">        } else {</span><br><span class="line">            log.error(&quot;Request failed with error code: &quot; + response);</span><br><span class="line">        }</span><br><span class="line">    } catch (IOException e) {</span><br><span class="line">        log.error(&quot;Send vlogs failed&quot;, e);</span><br><span class="line">        throw e;</span><br><span class="line">    }</span><br><span class="line">});</span><br><span class="line">logProducer = new LogProducer(producerConfig);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&#x8003;&#x8651;&#x5230;&#x8FD9;&#x4E2A;&#x5E93;&#x53EA;&#x662F;&#x5BF9;&#x963F;&#x91CC;&#x4E91;&#x65E5;&#x5FD7;&#x670D;&#x52A1;&#x7684;&#x4E00;&#x4E2A;&#x7EC4;&#x4EF6;&#xFF0C;&#x52A0;&#x4E0A;&#x4EE3;&#x7801;&#x5DF2;&#x7ECF;&#x5F88;&#x4E45;&#x6CA1;&#x7EF4;&#x62A4;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x5C31;&#x6CA1;&#x6709;&#x5C06;&#x8FD9;&#x90E8;&#x5206;&#x4EE3;&#x7801;&#x63D0;&#x4EA4;&#x5230;&#x793E;&#x533A;&#xFF0C;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x8BC4;&#x8BBA;&#x533A;&#x7559;&#x8A00;&#x3002;</p>
</blockquote>
<h1 id="&#x65E5;&#x5FD7;&#x5B89;&#x5168;"><a href="#&#x65E5;&#x5FD7;&#x5B89;&#x5168;" class="headerlink" title="&#x65E5;&#x5FD7;&#x5B89;&#x5168;"></a>&#x65E5;&#x5FD7;&#x5B89;&#x5168;</h1><p>&#x65E5;&#x5FD7;&#x662F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x57FA;&#x7840;&#x4F46;&#x53C8;&#x5F88;&#x654F;&#x611F;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x9996;&#x5148;&#x662F;&#x7F16;&#x7801;&#x89C4;&#x8303;&#x4E0A;&#x8981;&#x907F;&#x514D;&#x6253;&#x5370;&#x4E00;&#x4E9B;&#x654F;&#x611F;&#x4FE1;&#x606F;&#xFF1B;&#x6BD4;&#x5982;&#x8EAB;&#x4EFD;&#x8BC1;&#x3001;&#x5BC6;&#x7801;&#x7B49;&#xFF1B;&#x540C;&#x65F6;&#x5BF9;&#x65E5;&#x5FD7;&#x7684;&#x8BBF;&#x95EE;&#x4E5F;&#x8981;&#x6700;&#x597D;&#x6743;&#x9650;&#x63A7;&#x5236;&#x3002;</p>
<p>&#x5728;&#x6211;&#x4EEC;&#x5185;&#x90E8;&#x7684;&#x7814;&#x6548;&#x5E73;&#x53F0;&#x4E2D;&#xFF0C;&#x5BF9;&#x4E8E;&#x65E5;&#x5FD7;&#x3001;&#x76D1;&#x63A7;&#x7B49;&#x529F;&#x80FD;&#x90FD;&#x662F;&#x548C;&#x5E94;&#x7528;&#x6743;&#x9650;&#x6302;&#x94A9;&#x7684;&#x3002;</p>
<p>&#x7B80;&#x5355;&#x6765;&#x8BF4;&#x5C31;&#x662F;&#x5173;&#x95ED;&#x4E86;&#x7EDF;&#x4E00;&#x67E5;&#x8BE2; ES &#x7684;&#x5165;&#x53E3;&#xFF0C;&#x53EA;&#x5728;&#x5E94;&#x7528;&#x5C42;&#x7EA7;&#x63D0;&#x4F9B;&#x67E5;&#x8BE2;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E8E;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/32003c66f9651627979b962e8e40659d8d9fda1d59e4cfd3aa69f659e6f6afaf" alt></p>
<blockquote>
<p>&#x56FE;&#x6765;&#x81EA;&#x4E8E; orbit &#x4EA7;&#x54C1;&#x3002;</p>
</blockquote>
<h1 id="OpenTelemetry"><a href="#OpenTelemetry" class="headerlink" title="OpenTelemetry"></a>OpenTelemetry</h1><p>&#x5F53;&#x7136;&#x8BB2;&#x5230;&#x65E5;&#x5FD7;&#x76EE;&#x524D;&#x81EA;&#x7136;&#x4E5F;&#x9003;&#x4E0D;&#x8FC7; OpenTelemetry&#xFF0C;&#x4F5C;&#x4E3A;&#x5F53;&#x524D;&#x4E91;&#x539F;&#x751F;&#x53EF;&#x89C2;&#x6D4B;&#x6027;&#x7684;&#x6807;&#x51C6;&#x4E5F;&#x63D0;&#x4F9B;&#x4E86;&#x5BF9;&#x5E94;&#x7684;&#x65E5;&#x5FD7;&#x7EC4;&#x4EF6;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/e3096a5dc352ae8f637e347f8ad07e1c429c3c58626f283213ba9ee54bdc7b0b" alt><br>OpenTelemetry &#x4E5F;&#x5B9A;&#x4E49;&#x4E86;&#x7ED3;&#x6784;&#x5316;&#x7684;&#x65E5;&#x5FD7;&#x683C;&#x5F0F;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">json&#x590D;&#x5236;&#x4EE3;&#x7801;{&quot;resourceLogs&quot;:[{&quot;resource&quot;:{&quot;attributes&quot;:[{&quot;key&quot;:&quot;resource-attr&quot;,&quot;value&quot;:{&quot;stringValue&quot;:&quot;resource-attr-val-1&quot;}}]},&quot;scopeLogs&quot;:[{&quot;scope&quot;:{},&quot;logRecords&quot;:[{&quot;timeUnixNano&quot;:&quot;1581452773000000789&quot;,&quot;severityNumber&quot;:9,&quot;severityText&quot;:&quot;Info&quot;&quot;body&quot;:{&quot;stringValue&quot;:&quot;This is a log message&quot;},&quot;attributes&quot;:[{&quot;key&quot;:&quot;app&quot;,&quot;value&quot;:{&quot;stringValue&quot;:&quot;server&quot;}},{&quot;key&quot;:&quot;instance_num&quot;,&quot;value&quot;:{&quot;intValue&quot;:&quot;1&quot;}}],&quot;droppedAttributesCount&quot;:1,&quot;traceId&quot;:&quot;08040201000000000000000000000000&quot;,&quot;spanId&quot;:&quot;0102040800000000&quot;},{&quot;timeUnixNano&quot;:&quot;1581452773000000789&quot;,&quot;severityNumber&quot;:9,&quot;severityText&quot;:&quot;Info&quot;,&quot;body&quot;:{&quot;stringValue&quot;:&quot;something happened&quot;},&quot;attributes&quot;:[{&quot;key&quot;:&quot;customer&quot;,&quot;value&quot;:{&quot;stringValue&quot;:&quot;acme&quot;}},{&quot;key&quot;:&quot;env&quot;,&quot;value&quot;:{&quot;stringValue&quot;:&quot;dev&quot;}}],&quot;droppedAttributesCount&quot;:1,&quot;traceId&quot;:&quot;&quot;,&quot;spanId&quot;:&quot;&quot;}]}]}]}</span><br></pre></td></tr></table></figure>

<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x914D;&#x7F6E; <code>otel.logs.exporter=otlp (default)</code> &#x53EF;&#x4EE5;&#x5C06;&#x65E5;&#x5FD7;&#x8F93;&#x51FA;&#x5230; <code>oetl-collector</code> &#x4E2D;&#xFF0C;&#x518D;&#x7531;&#x4ED6;&#x8F93;&#x51FA;&#x5230;&#x540E;&#x7AEF;&#x5B58;&#x50A8;&#x4E2D;&#x3002;</p>
<p>&#x867D;&#x7136;&#x8FD9;&#x6837; <code>otel-collectoer</code> &#x5C31;&#x6210;&#x4E3A;&#x74F6;&#x9888;&#x4E86;&#xFF0C;&#x4F46;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x90E8;&#x7F72;&#x591A;&#x4E2A;&#x526F;&#x672C;&#x6765;&#x964D;&#x4F4E;&#x538B;&#x529B;&#x3002;</p>
<p>&#x540C;&#x65F6;&#x4E5F;&#x53EF;&#x4EE5;&#x5728;&#x5E94;&#x7528;&#x4E2D;&#x6307;&#x5B9A;&#x4E0D;&#x540C;&#x7684; <code>endpoint(otel.exporter.otlp.endpoint=http://127.0.0.1:4317)</code> &#x6765;&#x533A;&#x5206;&#x65E5;&#x5FD7;&#x7684; collector&#xFF0C;&#x4E0E;&#x5176;&#x4ED6;&#x7C7B;&#x578B;&#x7684; collector &#x505A;&#x5230;&#x8D44;&#x6E90;&#x9694;&#x79BB;&#x3002;</p>
<p>&#x4E0D;&#x8FC7;&#x76EE;&#x524D;&#x793E;&#x533A;&#x5173;&#x4E8E;&#x65E5;&#x5FD7;&#x7684;&#x5B9E;&#x8DF5;&#x8FD8;&#x6BD4;&#x8F83;&#x5C11;&#xFF0C;&#x800C;&#x4E14;&#x7531;&#x4E8E;&#x7248;&#x672C; 1.0 &#x7248;&#x672C; release &#x7684;&#x65F6;&#x95F4;&#x4E5F;&#x4E0D;&#x7B97;&#x957F;&#xFF0C;&#x7A33;&#x5B9A;&#x6027;&#x548C;&#x4E4B;&#x524D;&#x7684; filebeat &#x76F8;&#x6BD4;&#x8FD8;&#x5F97;&#x9700;&#x8981;&#x65F6;&#x95F4;&#x68C0;&#x9A8C;&#x3002;</p>
<h1 id="&#x603B;&#x7ED3;"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3;</h1><p>&#x7406;&#x60F3;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5C06;&#x53EF;&#x89C2;&#x6D4B;&#x6027;&#x7684;&#x4E09;&#x4E2A;&#x91CD;&#x8981;&#x7EC4;&#x4EF6;&#x90FD;&#x5173;&#x8054;&#x8D77;&#x6765;&#x624D;&#x80FD;&#x66F4;&#x597D;&#x7684;&#x6392;&#x67E5;&#x5B9A;&#x4F4D;&#x95EE;&#x9898;&#x3002;</p>
<p>&#x6BD4;&#x5982;&#x5F53;&#x6536;&#x5230;&#x76D1;&#x63A7;&#x7CFB;&#x7EDF;&#x901A;&#x8FC7;&#x6307;&#x6807;&#x53D8;&#x5316;&#x53D1;&#x51FA;&#x7684;&#x62A5;&#x8B66;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x94FE;&#x8DEF;&#x8FFD;&#x8E2A;&#x5B9A;&#x4F4D;&#x5177;&#x4F53;&#x662F;&#x54EA;&#x4E2A;&#x7CFB;&#x7EDF;&#x89E6;&#x53D1;&#x7684;&#x95EE;&#x9898;&#x3002;</p>
<p>&#x4E4B;&#x540E;&#x901A;&#x8FC7; traceID &#x5B9A;&#x4F4D;&#x5230;&#x5177;&#x4F53;&#x7684;&#x65E5;&#x5FD7;&#xFF0C;&#x518D;&#x901A;&#x8FC7;&#x65E5;&#x5FD7;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x5217;&#x51FA;&#x66F4;&#x591A;&#x65E5;&#x5FD7;&#x4FE1;&#x606F;&#xFF0C;&#x8FD9;&#x6837;&#x6574;&#x4E2A;&#x94FE;&#x6761;&#x5C31;&#x53EF;&#x4EE5;&#x4E32;&#x8054;&#x8D77;&#x6765;&#xFF0C;&#x53EF;&#x4EE5;&#x6781;&#x5927;&#x7684;&#x63D0;&#x9AD8;&#x6548;&#x7387;&#x3002;</p>
<p>&#x53C2;&#x8003;&#x94FE;&#x63A5;&#xFF1A;</p>
<ul>
<li><a href="/external_links/836cc33f3ac8d50c070cfbfc8eb25178.html" target="blank" rel="noopener">github.com/aliyun/aliy&#x2026;</a></li>
<li><a href="/external_links/36398e9ceb1ba11d947843b7a6a24f28.html" target="blank" rel="noopener">kubernetes.io/docs/concep&#x2026;</a></li>
<li><a href="/external_links/98a59da628eb1e9a08a5987be8ec50b0.html" target="blank" rel="noopener">coding.net/help/docs/o&#x2026;</a></li>
<li><a href="/external_links/f0db0c1bd1677366a49c5ff6fac09759.html" target="blank" rel="noopener">opentelemetry.io/docs/concep&#x2026;</a></li>
</ul>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/b96ef44ad8de26894e6011b405004299.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="../40/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="../../">1</a><span class="space">&hellip;</span><a class="page-number" href="../40/">40</a><span class="page-number current">41</span><a class="page-number" href="../42/">42</a><span class="space">&hellip;</span><a class="page-number" href="../99/">99</a><a class="extend next" rel="next" href="../42/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">开发者博客</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="https://dev.newban.cn/archives/">
              
                  <span class="site-state-item-count">990</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">399</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="../../atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">开发者博客</span>
  <div>
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
  </div>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




  <script type="text/javascript" async src="js/src/mermaid.min.js"></script>
  <script>
  if (window.mermaid) {
        var mermaid_config = {
            startOnLoad: true,
            theme: 'default',
            flowchart:{
                useMaxWidth: false,
                htmlLabels: true
            }                
        }
        mermaid.initialize(mermaid_config);
  }
  </script>
  

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="../../lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="../../lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="../../lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="../../lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="../../lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="../../lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="../../js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="../../js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="../../js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
