<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">
<meta name="referrer" content="never">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="../../lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="../../lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="../../css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="../../images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="../../images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="../../images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="../../images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">





  <link rel="alternate" href="../../atom.xml" title="开发者博客 – IT技术 尽在开发者博客" type="application/atom+xml">






<meta property="og:type" content="website">
<meta property="og:title" content="开发者博客 – IT技术 尽在开发者博客">
<meta property="og:url" content="https://dev.newban.cn/page/376/index.html">
<meta property="og:site_name" content="开发者博客 – IT技术 尽在开发者博客">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="开发者博客 – IT技术 尽在开发者博客">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>
<!--谷歌广告验证代码-->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-2626449904708114",
          enable_page_level_ads: true
     });
</script>
<!--谷歌广告验证代码-->



  <link rel="canonical" href="https://dev.newban.cn/page/376/">





  <title>开发者博客 – IT技术 尽在开发者博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">开发者博客 – IT技术 尽在开发者博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">开发者博客 – 科技是第一生产力</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="http://dev.newban.cn/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="https://dev.newban.cn/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903516935307271.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903516935307271.html" itemprop="url">PHP高性能分布式应用服务器框架-SwooleDistrib</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-27T15:38:21+08:00">
                2017-11-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="&#x9009;&#x62E9;SD&#x6846;&#x67B6;&#x52A9;&#x529B;&#x4F01;&#x4E1A;&#x5F00;&#x53D1;"><a href="#&#x9009;&#x62E9;SD&#x6846;&#x67B6;&#x52A9;&#x529B;&#x4F01;&#x4E1A;&#x5F00;&#x53D1;" class="headerlink" title="&#x9009;&#x62E9;SD&#x6846;&#x67B6;&#x52A9;&#x529B;&#x4F01;&#x4E1A;&#x5F00;&#x53D1;"></a>&#x9009;&#x62E9;SD&#x6846;&#x67B6;&#x52A9;&#x529B;&#x4F01;&#x4E1A;&#x5F00;&#x53D1;</h1><p>&#x4ECA;&#x5E74;&#x5E74;&#x5E95;&#x5386;&#x65F6;2&#x5E74;&#x591A;&#x7684;&#x8FED;&#x4EE3;&#xFF0C;&#x8FD9;&#x662F;SD&#x6846;&#x67B6;&#x7855;&#x679C;&#x6EE1;&#x6EE1;&#x7684;&#x4E00;&#x5E74;&#xFF0C;&#x901A;&#x8FC7;&#x4E0D;&#x65AD;&#x7684;&#x8FED;&#x4EE3;&#x548C;&#x6539;&#x8FDB;SD&#x6846;&#x67B6;&#x5DF2;&#x7ECF;&#x5728;&#x5708;&#x5185;&#x6709;&#x826F;&#x597D;&#x7684;&#x53E3;&#x7891;&#xFF0C;&#x4E0D;&#x5C11;&#x65B0;&#x751F;&#x7684;&#x6846;&#x67B6;&#x501F;&#x9274;&#x4E86;SD&#x7684;&#x8BBE;&#x8BA1;&#x601D;&#x60F3;&#xFF0C;SD&#x6846;&#x67B6;&#x4E5F;&#x88AB;&#x4E0D;&#x5C11;&#x521B;&#x4E1A;&#x578B;&#x516C;&#x53F8;&#x548C;&#x5927;&#x578B;&#x4F01;&#x4E1A;&#x4F7F;&#x7528;&#x3002;</p>
<h2 id="SD&#x6846;&#x67B6;&#x5230;&#x5E95;&#x662F;&#x4EC0;&#x4E48;&#x6280;&#x672F;"><a href="#SD&#x6846;&#x67B6;&#x5230;&#x5E95;&#x662F;&#x4EC0;&#x4E48;&#x6280;&#x672F;" class="headerlink" title="SD&#x6846;&#x67B6;&#x5230;&#x5E95;&#x662F;&#x4EC0;&#x4E48;&#x6280;&#x672F;"></a>SD&#x6846;&#x67B6;&#x5230;&#x5E95;&#x662F;&#x4EC0;&#x4E48;&#x6280;&#x672F;</h2><p>SD&#x6846;&#x67B6;&#x5168;&#x79F0;SwooleDistributed&#xFF0C;&#x4ECE;&#x540D;&#x79F0;&#x4E0A;&#x770B;&#x4E00;&#x4E2A;&#x662F;Swoole&#x4E00;&#x4E2A;&#x662F;Distributed&#xFF0C;&#x4ED6;&#x662F;&#x57FA;&#x4E8E;Swoole&#x6269;&#x5C55;&#x7684;&#x53EF;&#x4EE5;&#x5206;&#x5E03;&#x5F0F;&#x90E8;&#x7F72;&#x7684;&#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;&#x6846;&#x67B6;&#x3002;<br>&#x501F;&#x52A9;&#x4E8E;PHP&#x7684;&#x9AD8;&#x6548;&#x5F00;&#x53D1;&#x73AF;&#x5883;&#xFF0C;Swoole&#x7684;&#x9AD8;&#x6027;&#x80FD;&#x5F02;&#x6B65;&#x7F51;&#x7EDC;&#x901A;&#x4FE1;&#x5F15;&#x64CE;&#xFF0C;&#x4EE5;&#x53CA;&#x5176;&#x4ED6;&#x7684;&#x9AD8;&#x53EF;&#x7528;&#x7684;&#x6269;&#x5C55;&#x548C;&#x5DE5;&#x5177;&#xFF0C;SD&#x6846;&#x67B6;&#x63D0;&#x4F9B;&#x7ED9;&#x5E7F;&#x5927;&#x5F00;&#x53D1;&#x8005;&#x4E00;&#x4E2A;&#x7A33;&#x5B9A;&#x7684;&#x9AD8;&#x6548;&#x7684;&#x800C;&#x4E14;&#x529F;&#x80FD;&#x5F3A;&#x5927;&#x7684;&#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;&#x6846;&#x67B6;&#x3002;</p>
<h2 id="&#x5165;&#x95E8;&#x6210;&#x672C;"><a href="#&#x5165;&#x95E8;&#x6210;&#x672C;" class="headerlink" title="&#x5165;&#x95E8;&#x6210;&#x672C;"></a>&#x5165;&#x95E8;&#x6210;&#x672C;</h2><p>&#x8001;&#x5B9E;&#x7684;&#x8BF4;&#x76F8;&#x5BF9;&#x6BD4;&#x76EE;&#x524D;&#x70ED;&#x95E8;&#x7684;FPM&#x6846;&#x67B6;&#x6765;&#x8BF4;&#xFF0C;SD&#x7684;&#x5165;&#x95E8;&#x6210;&#x672C;&#x76F8;&#x5BF9;&#x8FD8;&#x662F;&#x6BD4;&#x8F83;&#x9AD8;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x8BBE;&#x8BA1;&#x7406;&#x5FF5;&#x4E0D;&#x540C;&#x4EE5;&#x53CA;&#x548C;&#x4F20;&#x7EDF;PHP-FPM&#x73AF;&#x5883;&#x5B8C;&#x5168;&#x4E0D;&#x540C;&#x7684;&#x8FD0;&#x884C;&#x73AF;&#x5883;&#xFF0C;&#x5BF9;&#x4E8E;&#x957F;&#x65F6;&#x95F4;&#x4F7F;&#x7528;LAMP&#xFF08;LANP&#xFF09;&#x6280;&#x672F;&#x7684;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x6765;&#x8BF4;&#x4F1A;&#x6709;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x7684;&#x9002;&#x5E94;&#x671F;&#xFF0C;&#x5982;&#x679C;&#x5F00;&#x53D1;&#x5E94;&#x7528;&#x7B80;&#x5355;&#x6D89;&#x53CA;&#x5230;&#x7684;&#x7CFB;&#x7EDF;&#x590D;&#x6742;&#x5EA6;&#x4F4E;&#xFF0C;&#x90A3;&#x4E48;SD&#x4E0A;&#x624B;&#x8FD8;&#x662F;&#x6BD4;&#x8F83;&#x5BB9;&#x6613;&#xFF0C;&#x6839;&#x636E;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;&#x548C;&#x6587;&#x6863;&#x51E0;&#x4E4E;&#x7ACB;&#x5373;&#x5C31;&#x80FD;&#x5F00;&#x542F;SD&#x7684;&#x63A2;&#x7D22;&#x4E4B;&#x65C5;&#xFF0C;&#x4F46;&#x662F;&#x5982;&#x679C;&#x5F00;&#x53D1;&#x7684;&#x662F;&#x590D;&#x6742;&#x7684;&#x5E94;&#x7528;&#x90A3;&#x4E48;SD&#x5305;&#x542B;&#x7684;&#x4F17;&#x591A;&#x7EC4;&#x4EF6;&#x8FD8;&#x662F;&#x9700;&#x8981;&#x4F60;&#x6162;&#x6162;&#x719F;&#x6089;&#x4E0A;&#x624B;&#x7684;&#x3002;</p>
<h2 id="SD&#x6846;&#x67B6;&#x5230;&#x5E95;&#x5305;&#x542B;&#x54EA;&#x4E9B;&#x5F3A;&#x5927;&#x7684;&#x529F;&#x80FD;&#x5462;"><a href="#SD&#x6846;&#x67B6;&#x5230;&#x5E95;&#x5305;&#x542B;&#x54EA;&#x4E9B;&#x5F3A;&#x5927;&#x7684;&#x529F;&#x80FD;&#x5462;" class="headerlink" title="SD&#x6846;&#x67B6;&#x5230;&#x5E95;&#x5305;&#x542B;&#x54EA;&#x4E9B;&#x5F3A;&#x5927;&#x7684;&#x529F;&#x80FD;&#x5462;"></a>SD&#x6846;&#x67B6;&#x5230;&#x5E95;&#x5305;&#x542B;&#x54EA;&#x4E9B;&#x5F3A;&#x5927;&#x7684;&#x529F;&#x80FD;&#x5462;</h2><p>&#x6211;&#x4EEC;&#x8FD9;&#x91CC;&#x5217;&#x4E3E;&#x4E0B;SD&#x63D0;&#x4F9B;&#x7684;&#x5404;&#x79CD;&#x5404;&#x6837;&#x7684;&#x529F;&#x80FD;&#x4EE5;&#x53CA;&#x6A21;&#x5757;&#x7EC4;&#x4EF6;</p>
<ul>
<li>&#x6DF7;&#x5408;&#x534F;&#x8BAE;<br>SD&#x6846;&#x67B6;&#x652F;&#x6301;&#x957F;&#x8FDE;&#x63A5;&#x534F;&#x8BAE;TCP&#xFF0C;WebSocket&#xFF0C;&#x77ED;&#x8FDE;&#x63A5;&#x534F;&#x8BAE;HTTP&#xFF0C;&#x4EE5;&#x53CA;UDP&#x3002;<br>&#x901A;&#x8FC7;&#x914D;&#x7F6E;&#x5F00;&#x653E;&#x4E0D;&#x540C;&#x7684;&#x7AEF;&#x53E3;&#x5F00;&#x53D1;&#x8005;&#x53EF;&#x4EE5;&#x8F7B;&#x677E;&#x7BA1;&#x7406;&#x4E0D;&#x540C;&#x7684;&#x534F;&#x8BAE;&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x5171;&#x7528;&#x4E00;&#x5957;&#x4E1A;&#x52A1;&#x4EE3;&#x7801;&#xFF0C;&#x5F53;&#x7136;&#x4F60;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x667A;&#x80FD;&#x8DEF;&#x7531;&#x8FDB;&#x884C;&#x4EE3;&#x7801;&#x7684;&#x9694;&#x79BB;&#x3002;<br>&#x957F;&#x8FDE;&#x63A5;&#x53EF;&#x4EE5;&#x914D;&#x7F6E;&#x4E0D;&#x540C;&#x7684;&#x6570;&#x636E;&#x4F20;&#x8F93;&#x534F;&#x8BAE;&#xFF0C;&#x6BD4;&#x5982;&#x4E8C;&#x8FDB;&#x5236;&#x534F;&#x8BAE;&#x6587;&#x672C;&#x534F;&#x8BAE;&#x7B49;&#x7B49;&#xFF0C;&#x901A;&#x8FC7;&#x6846;&#x67B6;&#x63D0;&#x4F9B;&#x7684;&#x5C01;&#x88C5;&#x5668;&#x89E3;&#x5305;&#x5668;&#x63A5;&#x53E3;&#x53EF;&#x4EE5;&#x81EA;&#x5B9A;&#x4E49;&#x5404;&#x79CD;&#x5404;&#x79CD;&#x7684;&#x534F;&#x8BAE;&#x5C01;&#x88C5;&#xFF0C;&#x5E76;&#x4E14;&#x5404;&#x79CD;&#x534F;&#x8BAE;&#x4E4B;&#x95F4;&#x53EF;&#x4EE5;&#x81EA;&#x52A8;&#x8F6C;&#x6362;&#xFF0C;&#x6BD4;&#x5982;&#x4F60;&#x901A;&#x8FC7;&#x5E7F;&#x64AD;&#x53D1;&#x9001;&#x4E00;&#x4E2A;&#x4FE1;&#x606F;&#xFF0C;&#x8BE5;&#x4FE1;&#x606F;&#x6D41;&#x5411;&#x4E0D;&#x540C;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x95F4;&#x91C7;&#x7528;&#x4E0D;&#x540C;&#x534F;&#x8BAE;&#xFF0C;&#x90A3;&#x4E48;&#x6846;&#x67B6;&#x4F1A;&#x6839;&#x636E;&#x4E0D;&#x540C;&#x7684;&#x7AEF;&#x53E3;&#x81EA;&#x52A8;&#x8F6C;&#x6362;&#x4E0D;&#x540C;&#x7684;&#x534F;&#x8BAE;&#x5C01;&#x88C5;&#x3002;<br>&#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;Http&#x7ED9;&#x6240;&#x6709;&#x957F;&#x8FDE;&#x63A5;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x63A8;&#x9001;&#x6D88;&#x606F;&#xFF0C;&#x7C7B;&#x4F3C;&#x8FD9;&#x79CD;&#x6DF7;&#x5408;&#x534F;&#x8BAE;&#x534F;&#x4F5C;&#x7684;&#x4E1A;&#x52A1;&#x5728;SD&#x6846;&#x67B6;&#x4E0A;&#x4F1A;&#x5F02;&#x5E38;&#x7B80;&#x5355;&#x3002;</li>
<li>MVC&#x4EE5;&#x53CA;&#x667A;&#x80FD;&#x8DEF;&#x7531;<br>&#x6846;&#x67B6;&#x7684;&#x8BBE;&#x8BA1;&#x662F;MVC&#x67B6;&#x6784;&#xFF0C;&#x5176;&#x4E2D;&#x6BCF;&#x4E00;&#x4E2A;&#x5C42;&#x7EA7;&#x90FD;&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x5212;&#x5206;&#x5B50;&#x5C42;&#x7EA7;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x53EF;&#x4EE5;&#x5C06;Controller&#x7EE7;&#x7EED;&#x5206;&#x5C42;&#x901A;&#x8FC7;&#x4E0D;&#x540C;&#x6587;&#x4EF6;&#x5939;&#x8FDB;&#x884C;&#x7BA1;&#x7406;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x5C06;Model&#x8FDB;&#x884C;&#x7EC6;&#x5206;&#xFF0C;&#x5212;&#x5206;&#x4E3A;&#x4E1A;&#x52A1;&#x5C42;&#x548C;&#x6570;&#x636E;&#x5C42;&#xFF0C;&#x8FD9;&#x90FD;&#x770B;&#x5F00;&#x53D1;&#x8005;&#x81EA;&#x8EAB;&#x7684;&#x7CFB;&#x7EDF;&#x8BBE;&#x8BA1;&#x3002;&#x667A;&#x80FD;&#x8DEF;&#x7531;&#x5C06;&#x5904;&#x7406;&#x89E3;&#x5305;&#x5668;&#x89E3;&#x5305;&#x540E;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x8D1F;&#x8D23;&#x5C06;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#x4F20;&#x9012;&#x5230;Controller&#x5C42;&#x3002;</li>
<li>&#x4E2D;&#x95F4;&#x4EF6;<br>SD&#x6846;&#x67B6;&#x8FD8;&#x63D0;&#x4F9B;&#x4E86;&#x4E2D;&#x95F4;&#x4EF6;&#xFF0C;&#x4E2D;&#x95F4;&#x4EF6;&#x53EF;&#x4EE5;&#x5BF9;&#x6D41;&#x5165;&#x7684;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x5904;&#x7406;&#xFF0C;&#x6BD4;&#x5982;&#x6E05;&#x7406;&#x5F02;&#x5E38;&#x6570;&#x636E;&#xFF0C;&#x4FEE;&#x6539;&#x6570;&#x636E;&#xFF0C;&#x6D41;&#x91CF;&#x7EDF;&#x8BA1;&#xFF0C;&#x641C;&#x96C6;&#x65E5;&#x5FD7;&#x7B49;&#x529F;&#x80FD;&#x3002;&#x4E2D;&#x95F4;&#x4EF6;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x591A;&#x4E2A;&#xFF0C;&#x4ED6;&#x4EEC;&#x548C;&#x7AEF;&#x53E3;&#x8FDB;&#x884C;&#x7ED1;&#x5B9A;&#x3002;</li>
<li>&#x5BF9;&#x8C61;&#x6C60;<br>SD&#x6846;&#x67B6;&#x5185;&#x5927;&#x591A;&#x6570;&#x7684;&#x5BF9;&#x8C61;&#x90FD;&#x4F7F;&#x7528;&#x4E86;&#x5BF9;&#x8C61;&#x6C60;&#x6280;&#x672F;&#xFF0C;&#x5BF9;&#x8C61;&#x6C60;&#x6280;&#x672F;&#x6709;&#x5229;&#x4E8E;&#x7CFB;&#x7EDF;&#x5185;&#x5B58;&#x7684;&#x7A33;&#x5B9A;&#xFF0C;&#x51CF;&#x5C11;GC&#x7684;&#x6B21;&#x6570;&#xFF0C;&#x63D0;&#x9AD8;&#x7CFB;&#x7EDF;&#x7684;&#x8FD0;&#x884C;&#x6548;&#x7387;&#xFF0C;&#x4E8B;&#x5B9E;&#x8BC1;&#x660E;&#x5BF9;&#x8C61;&#x6C60;&#x5BF9;&#x7CFB;&#x7EDF;&#x7A33;&#x5B9A;&#x505A;&#x51FA;&#x4E86;&#x6781;&#x5927;&#x7684;&#x8D21;&#x732E;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x8FD9;&#x4E00;&#x5957;&#x5BF9;&#x8C61;&#x6C60;&#x6280;&#x672F;&#xFF0C;&#x589E;&#x52A0;&#x5BF9;&#x5BF9;&#x8C61;&#x7684;&#x590D;&#x7528;&#xFF0C;&#x51CF;&#x5C11;GC&#x548C;NEW&#x7684;&#x9891;&#x7387;&#xFF0C;&#x5BF9;&#x7CFB;&#x7EDF;&#x6BDB;&#x523A;&#x73B0;&#x8C61;&#x548C;&#x5185;&#x5B58;&#x6CC4;&#x9732;&#x65B9;&#x9762;&#x90FD;&#x6709;&#x5F88;&#x5927;&#x7684;&#x7A33;&#x5B9A;&#x6027;&#x63D0;&#x5347;&#x3002;</li>
<li>&#x5F02;&#x6B65;&#x5BA2;&#x6237;&#x7AEF;&#x4EE5;&#x53CA;&#x8FDE;&#x63A5;&#x6C60;<br>Mysql&#xFF0C;Redis&#xFF0C;Http&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;Tcp&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7B49;&#x7B49;&#x5176;&#x4ED6;&#x66F4;&#x4E3A;&#x590D;&#x6742;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x5728;SD&#x6846;&#x67B6;&#x4E2D;&#x5747;&#x4E3A;&#x5F02;&#x6B65;&#x7684;&#x6A21;&#x5F0F;&#xFF0C;&#x5F02;&#x6B65;&#x89E3;&#x51B3;&#x4E86;&#x7CFB;&#x7EDF;&#x6574;&#x4F53;&#x7684;&#x5E76;&#x53D1;&#x80FD;&#x529B;&#xFF0C;&#x4F46;&#x5F02;&#x6B65;&#x5BA2;&#x6237;&#x7AEF;&#x9700;&#x8981;&#x63D0;&#x4F9B;&#x8FDE;&#x63A5;&#x6C60;&#x7EF4;&#x6301;&#xFF0C;SD&#x6846;&#x67B6;&#x63D0;&#x4F9B;&#x4E86;&#x8FDE;&#x63A5;&#x6C60;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x4E0D;&#x9700;&#x8981;&#x81EA;&#x5DF1;&#x7BA1;&#x7406;&#x8FDE;&#x63A5;&#x6C60;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x5373;&#x53EF;&#x3002;</li>
<li>&#x534F;&#x7A0B;<br>&#x5F02;&#x6B65;&#x4E8B;&#x4EF6;&#x56DE;&#x8C03;&#x89E3;&#x51B3;&#x7684;&#x662F;&#x5E76;&#x53D1;&#x6027;&#x80FD;&#xFF0C;&#x4F46;&#x9020;&#x6210;&#x7684;&#x662F;&#x4E1A;&#x52A1;&#x4EE3;&#x7801;&#x7684;&#x6DF7;&#x4E71;&#x3002;SD&#x6846;&#x67B6;&#x63D0;&#x4F9B;&#x4E86;&#x534F;&#x7A0B;&#x89E3;&#x51B3;&#x4E86;&#x8FD9;&#x4E00;&#x95EE;&#x9898;&#xFF0C;&#x901A;&#x8FC7;yield&#x5173;&#x952E;&#x5B57;&#x63D0;&#x4F9B;&#x5BF9;&#x5F02;&#x6B65;&#x7684;&#x540C;&#x6B65;&#x5199;&#x6CD5;&#xFF0C;&#x6D88;&#x9664;&#x4E86;&#x4E1A;&#x52A1;&#x4E66;&#x5199;&#x4E0A;&#x7684;&#x5927;&#x91CF;&#x56DE;&#x8C03;&#x5D4C;&#x5957;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;yield+&#x540C;&#x6B65;&#x7684;&#x5199;&#x6CD5;&#x5B9E;&#x73B0;&#x5F02;&#x6B65;&#x7684;&#x6027;&#x80FD;&#x3002;<br>&#x534F;&#x7A0B;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x6574;&#x5957;&#x5B8C;&#x6574;&#x7684;&#x4F53;&#x7CFB;&#xFF0C;&#x5305;&#x62EC;&#x8D85;&#x65F6;&#xFF0C;&#x5F02;&#x5E38;&#xFF0C;&#x4F11;&#x7720;&#xFF0C;&#x591A;&#x8DEF;&#x9009;&#x62E9;&#xFF0C;&#x4EE5;&#x53CA;&#x521B;&#x5EFA;&#x7528;&#x6237;&#x534F;&#x7A0B;&#x7B49;&#x7B49;&#x529F;&#x80FD;&#x3002;</li>
<li>&#x5B9A;&#x65F6;&#x4EFB;&#x52A1;<br>&#x987E;&#x540D;&#x601D;&#x4E49;&#x5B9A;&#x65F6;&#x6267;&#x884C;&#x7684;&#x4EFB;&#x52A1;&#x3002;</li>
<li>&#x4EFB;&#x52A1;&#x6295;&#x9012;<br>&#x652F;&#x6301;&#x5C06;&#x8017;&#x65F6;&#x4EFB;&#x52A1;&#x6295;&#x9012;&#x5230;Task&#x8FDB;&#x7A0B;&#x3002;</li>
<li>&#x81EA;&#x52A8;Reload<br>&#x53EF;&#x4EE5;&#x5F00;&#x542F;&#x6846;&#x67B6;&#x7684;&#x81EA;&#x52A8;Reload&#x529F;&#x80FD;&#xFF0C;&#x8FD9;&#x6837;&#x4EE3;&#x7801;&#x4FEE;&#x6539;&#x4F1A;&#x88AB;&#x7ACB;&#x5373;&#x54CD;&#x5E94;&#x3002;</li>
</ul>
<p><strong>&#x4E0A;&#x9762;&#x63CF;&#x8FF0;&#x7684;&#x90FD;&#x662F;&#x4E00;&#x4E9B;&#x57FA;&#x7840;&#x529F;&#x80FD;&#xFF0C;&#x5927;&#x5BB6;&#x5F00;&#x53D1;&#x5E94;&#x7528;&#x65F6;&#x7ECF;&#x5E38;&#x7528;&#x5230;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x4E0B;&#x9762;&#x5219;&#x662F;&#x4E00;&#x4E9B;&#x9AD8;&#x7EA7;&#x529F;&#x80FD;&#x3002;</strong></p>
<ul>
<li>&#x96C6;&#x7FA4;&#x4EE5;&#x53CA;&#x5FAE;&#x670D;&#x52A1;<br>&#x6846;&#x67B6;&#x63D0;&#x4F9B;&#x96C6;&#x7FA4;&#x90E8;&#x7F72;&#xFF0C;&#x901A;&#x8FC7;&#x5F00;&#x542F;&#x96C6;&#x7FA4;&#x5F00;&#x5173;&#xFF0C;&#x90E8;&#x7F72;Consul&#x5DE5;&#x5177;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x5F00;&#x542F;&#x96C6;&#x7FA4;&#x4E4B;&#x65C5;&#xFF0C;&#x6846;&#x67B6;&#x4E2D;&#x6D88;&#x606F;&#x529F;&#x80FD;&#x90FD;&#x662F;&#x652F;&#x6301;&#x96C6;&#x7FA4;&#x73AF;&#x5883;&#x7684;&#x3002;&#x901A;&#x8FC7;&#x66B4;&#x9732;API&#xFF0C;&#x76D1;&#x542C;API&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x5FAE;&#x670D;&#x52A1;&#xFF0C;&#x5FAE;&#x670D;&#x52A1;&#x4E2D;&#x6211;&#x4EEC;&#x53C8;&#x63D0;&#x4F9B;&#x4E86;&#x5065;&#x5EB7;&#x76D1;&#x63A7;&#xFF0C;&#x7194;&#x65AD;&#xFF0C;&#x8D85;&#x65F6;&#xFF0C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#xFF0C;&#x8BF7;&#x6C42;&#x8FC1;&#x79FB;&#x7B49;&#x7B49;&#x529F;&#x80FD;&#x3002;<br>&#x96C6;&#x7FA4;&#x91C7;&#x7528;&#x7684;&#x662F;&#x5BF9;&#x7B49;&#x7F51;&#x7EDC;&#xFF0C;&#x6CA1;&#x6709;&#x4E2D;&#x95F4;&#x8282;&#x70B9;&#xFF0C;&#x6CA1;&#x6709;&#x5355;&#x70B9;&#x9690;&#x60A3;&#xFF0C;&#x8BBE;&#x8BA1;&#x7406;&#x5FF5;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#x3002;  </li>
</ul>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/e36f322ae2f1a17aae6abb604593d8eb97e3ce35fb14ec7144a895aa263f609c" alt="image"></p>
<p>image</p>
<ul>
<li>&#x8BA2;&#x9605;&#x4E0E;&#x53D1;&#x5E03;<br>SD&#x63D0;&#x4F9B;&#x7684;&#x8BA2;&#x9605;&#x53D1;&#x5E03;&#x529F;&#x80FD;&#x4E5F;&#x662F;&#x652F;&#x6301;&#x96C6;&#x7FA4;&#x73AF;&#x5883;&#xFF0C;&#x5E76;&#x4E14;&#x5B83;&#x4E25;&#x683C;&#x7684;&#x6309;&#x7167;MQTT&#x6240;&#x5B9A;&#x4E49;&#x7684;&#x8BA2;&#x9605;&#x53D1;&#x5E03;&#x89C4;&#x8303;&#xFF0C;&#x5E76;&#x4E14;&#x5B9E;&#x73B0;&#x4E86;&#x6240;&#x6709;&#x7684;&#x529F;&#x80FD;&#x3002;&#x8FD9;&#x6050;&#x6015;&#x662F;&#x6700;&#x597D;&#x6700;&#x4F18;&#x79C0;&#x7684;&#x8BA2;&#x9605;&#x53D1;&#x5E03;&#x529F;&#x80FD;&#x4E86;&#x3002;</li>
<li>&#x4E8B;&#x4EF6;&#x6D3E;&#x53D1;<br>&#x8DE8;&#x8FDB;&#x7A0B;&#x8DE8;&#x670D;&#x52A1;&#x5668;&#x7684;&#x4E8B;&#x4EF6;&#x6D3E;&#x53D1;&#x529F;&#x80FD;&#xFF0C;&#x5F88;&#x591A;SD&#x6846;&#x67B6;&#x7684;&#x57FA;&#x7840;&#x8BBE;&#x65BD;&#x90FD;&#x662F;&#x57FA;&#x4E8E;&#x8FD9;&#x4E2A;&#x642D;&#x5EFA;&#x7684;&#x3002;</li>
<li>&#x7528;&#x6237;&#x8FDB;&#x7A0B;&#x7BA1;&#x7406;&#x4EE5;&#x53CA;&#x8FDB;&#x7A0B;&#x95F4;RPC<br>SD&#x6846;&#x67B6;&#x91CD;&#x65B0;&#x5C01;&#x88C5;&#x4E86;&#x7528;&#x6237;&#x8FDB;&#x7A0B;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x53EF;&#x4EE5;&#x542F;&#x52A8;&#x81EA;&#x5DF1;&#x7684;&#x7528;&#x6237;&#x8FDB;&#x7A0B;&#xFF0C;&#x7528;&#x6237;&#x8FDB;&#x7A0B;&#x53EF;&#x4EE5;&#x662F;&#x5F02;&#x6B65;&#x7684;&#x4E5F;&#x53EF;&#x4EE5;&#x662F;&#x540C;&#x6B65;&#x7684;&#xFF0C;&#x4E5F;&#x662F;&#x652F;&#x6301;&#x5404;&#x79CD;&#x8FDE;&#x63A5;&#x6C60;&#x548C;&#x534F;&#x7A0B;&#xFF0C;&#x7528;&#x6237;&#x8FDB;&#x7A0B;&#x7684;&#x7528;&#x5904;&#x5F88;&#x591A;&#xFF0C;&#x540C;&#x6837;&#x6846;&#x67B6;&#x4E5F;&#x652F;&#x6301;&#x7528;&#x6237;&#x8FDB;&#x7A0B;&#x548C;Worker&#x8FDB;&#x7A0B;&#x95F4;&#x4E92;&#x76F8;RPC&#x8C03;&#x7528;&#x3002;</li>
<li>&#x96C6;&#x7FA4;&#x4E0B;&#x7684;&#x5B9A;&#x65F6;&#x4EFB;&#x52A1;<br>&#x901A;&#x8FC7;Consul&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x5B9A;&#x65F6;&#x4EFB;&#x52A1;&#xFF0C;&#x5E76;&#x4E14;&#x4F1A;&#x540C;&#x6B65;&#x5230;&#x96C6;&#x7FA4;&#x6240;&#x6709;&#x7684;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x53BB;&#x6267;&#x884C;&#xFF0C;&#x96C6;&#x7FA4;&#x670D;&#x52A1;&#x5668;&#x4F1A;&#x9009;&#x4E3E;&#x51FA;&#x4E00;&#x4E2A;Leader&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x83B7;&#x53D6;&#x662F;&#x5426;&#x662F;Leader&#x6765;&#x51B3;&#x5B9A;&#x8FD9;&#x4E2A;&#x4EFB;&#x52A1;&#x662F;&#x5426;&#x88AB;&#x6267;&#x884C;&#x3002;</li>
<li>Context&#x4E0A;&#x4E0B;&#x6587;<br>&#x8FD9;&#x4E2A;&#x662F;&#x5728;&#x6D88;&#x606F;&#x5904;&#x7406;&#x6574;&#x4E2A;&#x6D41;&#x7A0B;&#x4E2D;&#x88AB;&#x5171;&#x4EAB;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#xFF0C;&#x5F88;&#x5B9E;&#x7528;&#xFF0C;&#x5F88;&#x65B9;&#x4FBF;&#x3002;</li>
</ul>
<p><strong>&#x63A5;&#x4E0B;&#x6765;&#x4ECB;&#x7ECD;&#x7684;&#x662F;SD&#x7279;&#x8272;&#x7EC4;&#x4EF6;</strong></p>
<ul>
<li>&#x5F02;&#x6B65;AMQP&#x5BA2;&#x6237;&#x7AEF;&#x4EE5;&#x53CA;&#x5206;&#x5E03;&#x5F0F;&#x4EFB;&#x52A1;&#x7CFB;&#x7EDF;<br>&#x6D88;&#x606F;&#x961F;&#x5217;&#x534F;&#x8BAE;AMQP&#xFF0C;&#x6846;&#x67B6;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x652F;&#x6301;AMQP&#x534F;&#x8BAE;&#x7684;&#x5F02;&#x6B65;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x53EF;&#x4EE5;&#x548C;RabbitMQ&#x8054;&#x52A8;&#xFF0C;&#x901A;&#x8FC7;&#x6846;&#x67B6;&#x63D0;&#x4F9B;&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x4EFB;&#x52A1;&#x7EC4;&#x4EF6;&#xFF0C;&#x53EF;&#x4EE5;&#x642D;&#x5EFA;&#x5206;&#x5E03;&#x5F0F;&#x4EFB;&#x52A1;&#x7CFB;&#x7EDF;&#x3002;</li>
<li>&#x5F02;&#x6B65;MQTT&#x5BA2;&#x6237;&#x7AEF;<br>&#x5F02;&#x6B65;&#x7684;MQTT&#x5BA2;&#x6237;&#x7AEF;&#x53EF;&#x4EE5;&#x548C;MQTT&#x670D;&#x52A1;&#x5B9E;&#x73B0;&#x8BA2;&#x9605;&#x4E0E;&#x53D1;&#x5E03;</li>
<li>MQTT&#x7B80;&#x6613;&#x96C6;&#x7FA4;&#x670D;&#x52A1;&#x5668;<br>&#x652F;&#x6301;QOS0&#x7EA7;&#x522B;&#x7684;&#x7B80;&#x6613;MQTT&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x652F;&#x6301;&#x96C6;&#x7FA4;&#x90E8;&#x7F72;&#x3002;</li>
<li>&#x670D;&#x52A1;&#x5668;&#x76D1;&#x63A7;&#x7CFB;&#x7EDF;<br>&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x5668;&#x76D1;&#x63A7;&#x540E;&#x53F0;&#xFF0C;&#x53EF;&#x4EE5;&#x5BF9;&#x96C6;&#x7FA4;&#x8FDB;&#x884C;&#x76D1;&#x63A7;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x76D1;&#x63A7;&#x67D0;&#x4E00;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x7684;&#x5177;&#x4F53;&#x8FD0;&#x884C;&#x72B6;&#x51B5;&#x3002;<br>&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x4E9B;&#x622A;&#x56FE;<br><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/498613d7ad12aa375e57e5442f75d990cadeb38a73b25d92917c7f416b90b6b5" alt></li>
</ul>
<p> <img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/f443149e39f655a17fe77814959e8d611ee7237974b65e1a9c819f25b370579f" alt></p>
<p> <img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/6bb73793b01428dff77cc587bb7058684cf5f1c300da58e02a911fef6be087c6" alt></p>
<p> <img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/f0e9e06068e960fce51d947cb73ef5c6334f64abb1150dcd1133a11a2886f613" alt></p>
<p> <img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/41943d24da92eb39fec9c8214bf54b1b8d244d43d8f4a957b814b3d76bb09900" alt></p>
<h2 id="SD&#x6846;&#x67B6;&#x8FDC;&#x8FDC;&#x4E0D;&#x6B62;&#x73B0;&#x5728;"><a href="#SD&#x6846;&#x67B6;&#x8FDC;&#x8FDC;&#x4E0D;&#x6B62;&#x73B0;&#x5728;" class="headerlink" title="SD&#x6846;&#x67B6;&#x8FDC;&#x8FDC;&#x4E0D;&#x6B62;&#x73B0;&#x5728;"></a>SD&#x6846;&#x67B6;&#x8FDC;&#x8FDC;&#x4E0D;&#x6B62;&#x73B0;&#x5728;</h2><p>SD&#x6846;&#x67B6;&#x4E00;&#x76F4;&#x5728;&#x9AD8;&#x901F;&#x53D1;&#x5C55;&#x4E2D;&#xFF0C;&#x6709;&#x66F4;&#x591A;&#x5F00;&#x53D1;&#x8005;&#x7684;&#x53C2;&#x4E0E;&#x624D;&#x4F1A;&#x6709;&#x66F4;&#x597D;&#x7684;&#x672A;&#x6765;&#x3002;<br>&#x9644;&#x5E26;SD&#x6846;&#x67B6;&#x7684;&#x6587;&#x6863;&#x4EE5;&#x53CA;&#x5B98;&#x7F51;<br><a href="/external_links/1ee2fa496fe0d9d80a5fc69e312ce7db.html" target="blank" rel="noopener">&#x5B98;&#x7F51;</a><br><a href="/external_links/78db9ba82f4ca0879080bd464349dbaf.html" target="blank" rel="noopener">&#x6587;&#x6863;</a><br><a href="/external_links/8e24c135482b8afd56a3617ab04aa893.html" target="blank" rel="noopener">GitHub</a><br>&#x5982;&#x679C;&#x4F60;&#x559C;&#x6B22;&#xFF0C;&#x8BF7;&#x6253;&#x4E2A;&#x661F;&#x661F;&#x652F;&#x6301;&#x4E0B;&#xFF5E;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/0f22cb029f9cb036b3c327b5d37e5da2.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903516939485192.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903516939485192.html" itemprop="url">数据库高可用的定义和度量</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-27T15:31:53+08:00">
                2017-11-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x4F5C;&#x8005;&#xFF1A;&#x5F90;&#x6587;&#x97EC;</p>
<h2 id="&#x4EC0;&#x4E48;&#x662F;&#x9AD8;&#x53EF;&#x7528;"><a href="#&#x4EC0;&#x4E48;&#x662F;&#x9AD8;&#x53EF;&#x7528;" class="headerlink" title="&#x4EC0;&#x4E48;&#x662F;&#x9AD8;&#x53EF;&#x7528;"></a>&#x4EC0;&#x4E48;&#x662F;&#x9AD8;&#x53EF;&#x7528;</h2><p>&#x9AD8;&#x53EF;&#x7528;&#x662F;&#x7CFB;&#x7EDF;&#x7684;&#x4E00;&#x4E2A;&#x7279;&#x6027;&#xFF0C;&#x4FDD;&#x8BC1;&#x7CFB;&#x7EDF;&#x80FD;&#x5728;&#x8DB3;&#x591F;&#x957F;&#x7684;&#x65F6;&#x95F4;&#x5185;&#x63D0;&#x4F9B;&#x6307;&#x5B9A;&#x7A0B;&#x5EA6;&#x7684;&#x670D;&#x52A1;&#x7B49;&#x7EA7;&#x3002;&#x518D;&#x7EC6;&#x5316;&#x4E00;&#x4E0B;&#xFF0C;&#x53EF;&#x4EE5;&#x8BF4;&#x662F;&#x5728;&#x6709;&#x9650;&#x7684;&#x6545;&#x969C;&#x6761;&#x4EF6;&#x4E0B;&#xFF0C;&#x63D0;&#x4F9B;&#x4E00;&#x5B9A;&#x7EA7;&#x522B;&#x7684;&#x7A33;&#x5B9A;&#x670D;&#x52A1;&#x3002;</p>
<p>&#x5728;&#x4F20;&#x7EDF;&#x9886;&#x57DF;&#xFF0C;SLA&#x7528;&#x4E8E;&#x5728;&#x5546;&#x4E1A;&#x4E0A;&#x5B9A;&#x4E49;&#x7CFB;&#x7EDF;&#x7684;&#x9AD8;&#x53EF;&#x7528;&#x3002;</p>
<p>SLA&#x5168;&#x79F0;&#x662F;service level agreement&#xFF0C;&#x5728;&#x7F51;&#x7EDC;&#x670D;&#x52A1;&#x4F9B;&#x5E94;&#x5546;&#x9886;&#x57DF;&#x88AB;&#x5E7F;&#x6CDB;&#x4F7F;&#x7528;&#xFF0C;&#x7EA6;&#x5B9A;&#x4E86;&#x6700;&#x5C0F;&#x5E26;&#x5BBD;&#xFF0C;&#x540C;&#x65F6;&#x670D;&#x52A1;&#x5BA2;&#x6237;&#x6570;&#xFF0C;&#x6700;&#x5927;&#x6545;&#x969C;&#x65F6;&#x95F4;&#x7B49;&#x7B49;&#x4E00;&#x7CFB;&#x5217;&#x6307;&#x6807;&#x3002;&#x5728;&#x8F6F;&#x4EF6;&#x9886;&#x57DF;&#xFF0C;&#x6700;&#x5E7F;&#x6CDB;&#x4F7F;&#x7528;&#x7684;&#x6307;&#x6807;&#x662F;&#x5E73;&#x5747;&#x670D;&#x52A1;&#x65F6;&#x95F4;&#x3002;</p>
<p>&#x89C1;&#x4E0B;&#x56FE;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/42932403b6d4beb79cac0966c77b9dd04e07ee41dce9afa2872930814b0ec2ec" alt><br>&#x56E0;&#x4E3A;&#x8F6F;&#x4EF6;&#x9886;&#x57DF;&#x7684;&#x5404;&#x9879;&#x6307;&#x6807;&#x4E0D;&#x597D;&#x5EA6;&#x91CF;&#xFF0C;&#x5F88;&#x96BE;&#x7EA6;&#x675F;&#xFF0C;&#x56E0;&#x6B64;&#x5176;&#x4ED6;&#x6307;&#x6807;&#x4E5F;&#x5F88;&#x5C11;&#x63D0;&#x5230;&#x3002;&#x4F46;&#x53EF;&#x4EE5;&#x60F3;&#x50CF;&#xFF0C;&#x4F5C;&#x4E3A;&#x9AD8;&#x53EF;&#x7528;&#x7684;&#x7CFB;&#x7EDF;&#xFF0C;&#x4E0D;&#x6B62;&#x8981;&#x6709;&#x8FBE;&#x6807;&#x7684;&#x6545;&#x969C;&#x65F6;&#x95F4;&#xFF0C;&#x540C;&#x65F6;&#x8981;&#x4FDD;&#x8BC1;&#x5728;&#x670D;&#x52A1;&#x65F6;&#x95F4;&#x8FBE;&#x5230;&#x7528;&#x6237;&#x53EF;&#x63A5;&#x53D7;&#x7684;&#x670D;&#x52A1;&#x8D28;&#x91CF;&#xFF0C;&#x5BF9;&#x4E8E;&#x6570;&#x636E;&#x5E93;&#x800C;&#x8A00;&#xFF0C;&#x7C7B;&#x4F3C;tps&#xFF0C;&#x4E8B;&#x52A1;&#x5E73;&#x5747;&#x65F6;&#x5EF6;&#xFF0C;99%&#x65F6;&#x5EF6;&#x7B49;&#x3002;</p>
<h2 id="&#x5404;&#x5BB6;SLA&#x5C55;&#x64AD;"><a href="#&#x5404;&#x5BB6;SLA&#x5C55;&#x64AD;" class="headerlink" title="&#x5404;&#x5BB6;SLA&#x5C55;&#x64AD;"></a>&#x5404;&#x5BB6;SLA&#x5C55;&#x64AD;</h2><p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/04fa994f4568c49a7177a4a0e196c4d9760ab3954ca1138d50d9ac1bcdd45e74" alt><br>&#x4ECE;&#x8FD9;&#x51E0;&#x5BB6;&#x5BF9;&#x6BD4;&#x770B;&#xFF0C;AWS&#x662F;&#x6700;&#x5F3A;&#x7684;&#xFF0C;&#x963F;&#x91CC;&#x4E5F;&#x5DEE;&#x4E0D;&#x591A;&#x4E86;&#xFF0C;&#x817E;&#x8BAF;&#x4E91;&#x662F;&#x76F8;&#x5BF9;&#x8F83;&#x5DEE;&#x7684;&#xFF0C;&#x770B;&#x4E00;&#x4E0B;&#x670D;&#x52A1;&#x6761;&#x6B3E;&#x7684;&#x5B8C;&#x5584;&#x7A0B;&#x5EA6;&#x5C31;&#x80FD;&#x660E;&#x663E;&#x5730;&#x611F;&#x53D7;&#x5230;&#x3002;</p>
<h2 id="&#x8BC4;&#x4EF7;&#x9AD8;&#x53EF;&#x7528;&#x7684;&#x6807;&#x51C6;"><a href="#&#x8BC4;&#x4EF7;&#x9AD8;&#x53EF;&#x7528;&#x7684;&#x6807;&#x51C6;" class="headerlink" title="&#x8BC4;&#x4EF7;&#x9AD8;&#x53EF;&#x7528;&#x7684;&#x6807;&#x51C6;"></a>&#x8BC4;&#x4EF7;&#x9AD8;&#x53EF;&#x7528;&#x7684;&#x6807;&#x51C6;</h2><p>&#x8BC4;&#x4EF7;&#x7CFB;&#x7EDF;&#x9AD8;&#x53EF;&#x7528;&#xFF0C;&#x53EF;&#x4EE5;&#x6709;&#x51E0;&#x4E2A;&#x7EF4;&#x5EA6;&#xFF1A;</p>
<ol>
<li>&#x6709;&#x9650;&#x6545;&#x969C;&#x4E0B;&#x6570;&#x636E;&#x662F;&#x5426;&#x4E22;&#x5931;&#xFF0C;&#x7CFB;&#x7EDF;&#x7684;&#x670D;&#x52A1;&#x7B49;&#x7EA7;&#x964D;&#x4F4E;&#x5E45;&#x5EA6;&#x662F;&#x5426;&#x5408;&#x7406;&#xFF1B;</li>
<li>&#x9AD8;&#x538B;&#x529B;&#x4E0B;&#x7CFB;&#x7EDF;&#x7684;&#x670D;&#x52A1;&#x7B49;&#x7EA7;&#xFF1B;</li>
<li>&#x670D;&#x52A1;&#x53D8;&#x66F4;&#x4E0B;&#x7CFB;&#x7EDF;&#x7684;&#x670D;&#x52A1;&#x7B49;&#x7EA7;&#xFF1B;</li>
</ol>
<p>&#x6709;&#x4E00;&#x4E2A;&#x5173;&#x4E8E;&#x6545;&#x969C;&#x6761;&#x4EF6;&#x4E0B;&#x7CFB;&#x7EDF;&#x8868;&#x73B0;&#x8F83;&#x597D;&#x7684;&#x5206;&#x7EA7;&#xFF0C;&#x89C1;&#x4E0B;&#x8868;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/6850acba0b9d2d9a3b629b26cc593612f45bcad03e1a2bb35bb9f4cc4cee349b" alt><br> &#x6458;&#x81EA;&#x300A;&#x6765;&#x81EA; Google &#x7684;&#x9AD8;&#x53EF;&#x7528;&#x67B6;&#x6784;&#x7406;&#x5FF5;&#x4E0E;&#x5B9E;&#x8DF5;&#x300B;</p>
<h2 id="&#x6570;&#x636E;&#x5E93;&#x7CFB;&#x7EDF;&#x7684;&#x4E00;&#x4E9B;&#x5EA6;&#x91CF;&#x65B9;&#x6CD5;"><a href="#&#x6570;&#x636E;&#x5E93;&#x7CFB;&#x7EDF;&#x7684;&#x4E00;&#x4E9B;&#x5EA6;&#x91CF;&#x65B9;&#x6CD5;" class="headerlink" title="&#x6570;&#x636E;&#x5E93;&#x7CFB;&#x7EDF;&#x7684;&#x4E00;&#x4E9B;&#x5EA6;&#x91CF;&#x65B9;&#x6CD5;"></a>&#x6570;&#x636E;&#x5E93;&#x7CFB;&#x7EDF;&#x7684;&#x4E00;&#x4E9B;&#x5EA6;&#x91CF;&#x65B9;&#x6CD5;</h2><p><strong>&#x6570;&#x636E;&#x6301;&#x4E45;&#x5EA6;</strong></p>
<p>&#x6570;&#x636E;&#x5E93;&#x7CFB;&#x7EDF;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x526F;&#x672C;&#x5907;&#x4EFD;&#x7B49;&#x65B9;&#x5F0F;&#x6709;&#x6548;&#x63D0;&#x9AD8;&#x6570;&#x636E;&#x6301;&#x4E45;&#x5EA6;&#xFF0C;&#x62B5;&#x5FA1;&#x78C1;&#x76D8;&#x635F;&#x574F;&#x7B49;&#x6545;&#x969C;&#x9020;&#x6210;&#x6570;&#x636E;&#x4E22;&#x5931;&#x7684;&#x98CE;&#x9669;&#x3002;</p>
<p>&#x5F53;&#x7136;&#x968F;&#x7740;&#x73B0;&#x5728;&#x5206;&#x5E03;&#x5F0F;&#x5B58;&#x50A8;&#x7684;&#x53D1;&#x5C55;&#xFF0C;&#x6301;&#x4E45;&#x5EA6;&#x5DF2;&#x7ECF;&#x5F88;&#x5C11;&#x6709;&#x4EBA;&#x5173;&#x5FC3;&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x5BF9;&#x4E8E;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x78C1;&#x76D8;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x8FD9;&#x4ECD;&#x7136;&#x662F;&#x4E00;&#x4E2A;&#x9700;&#x8981;&#x8003;&#x8651;&#x7684;&#x95EE;&#x9898;&#x3002;</p>
<p><strong>&#x5E73;&#x5747;&#x670D;&#x52A1;&#x65F6;&#x95F4;</strong></p>
<p>&#x5BF9;&#x4E8E;&#x8BA1;&#x7B97;&#x670D;&#x52A1;&#x53EF;&#x7528;&#x65F6;&#x95F4;&#xFF0C;&#x5F15;&#x5165;3&#x4E2A;&#x6765;&#x81EA;&#x5DE5;&#x4E1A;&#x754C;&#x7684;&#x6982;&#x5FF5;&#xFF1A;</p>
<ol>
<li>MTBF (Mean Time Between Failures) =&#x5E73;&#x5747;&#x6545;&#x969C;&#x9593;&#x9694;&#x6642;&#x9593;</li>
<li>MTTF (Mean Time To Failure) =&#x5E73;&#x5747;&#x6545;&#x969C;&#x6642;&#x9593;</li>
<li>MTTR (Mean Time To Repair) =&#x5E73;&#x5747;&#x4FEE;&#x5FA9;&#x6642;&#x9593;</li>
</ol>
<p><strong><em>&#x9AD8;&#x53EF;&#x7528;&#x65F6;&#x95F4;=MTBF/(MTBF+MTTF)</em></strong></p>
<p>&#x663E;&#x7136;&#xFF0C;&#x8FD9;&#x91CC;&#x5B58;&#x5728;&#x6267;&#x884C;&#x4E0A;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x5047;&#x8BBE;tcp&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#x662F;2min&#xFF0C;&#x90A3;&#x4E48;&#x4F4E;&#x4E8E;&#x4E24;&#x5206;&#x949F;&#x662F;&#x5F88;&#x96BE;&#x786E;&#x5B9A;&#x5230;&#x5E95;&#x662F;&#x7CFB;&#x7EDF;&#x6545;&#x969C;&#x8FD8;&#x4EC5;&#x4EC5;&#x662F;&#x8F6F;&#x4EF6;&#x5904;&#x7406;&#x8F83;&#x6162;&#x3002;&#x6216;&#x8005;&#x8F6F;&#x4EF6;&#x7531;&#x4E8E;&#x8D44;&#x6E90;&#xFF08;&#x6BD4;&#x5982;IO&#xFF09;&#x53D7;&#x9650;&#x88AB;&#x5361;&#x4F4F;&#xFF0C;&#x8FD9;&#x662F;&#x5BA2;&#x6237;&#x4E5F;&#x662F;&#x5F88;&#x96BE;&#x5224;&#x65AD;&#x662F;&#x5426;&#x53D1;&#x751F;&#x4E86;&#x6545;&#x969C;&#x3002;</p>
<p>&#x5BF9;&#x4E8E;&#x7CFB;&#x7EDF;&#x7BA1;&#x7406;&#x5458;&#x6765;&#x8BF4;&#xFF0C;&#x540C;&#x6837;&#x5B58;&#x5728;&#x7C7B;&#x4F3C;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x5FC3;&#x8DF3;&#x68C0;&#x6D4B;&#x662F;&#x6700;&#x5E38;&#x89C1;&#x7684;&#x76D1;&#x63A7;&#x624B;&#x6BB5;&#xFF0C;&#x4F46;&#x662F;&#x5FC3;&#x8DF3;&#x65F6;&#x95F4;&#x4E5F;&#x5F88;&#x96BE;&#x8BBE;&#x7F6E;&#x592A;&#x77ED;&#xFF0C;&#x8FD9;&#x662F;&#x53D7;&#x7F51;&#x7EDC;&#x6761;&#x4EF6;&#x9650;&#x5236;&#x7684;&#xFF0C;&#x5E38;&#x5E38;&#xFF0C;&#x6545;&#x969C;&#x7684;&#x53D1;&#x73B0;&#x5C31;&#x662F;&#x4EE5;&#x5206;&#x949F;&#x8BA1;&#x7B97;&#x7684;&#x3002;</p>
<p><strong>RTO/RPO</strong></p>
<p>RTO&#x548C;RPO&#x662F;&#x4F20;&#x7EDF;&#x6570;&#x636E;&#x5E93;&#x9886;&#x57DF;&#x5E38;&#x89C1;&#x7684;&#x4E24;&#x4E2A;&#x8861;&#x91CF;&#x9AD8;&#x53EF;&#x7528;&#x7684;&#x6307;&#x6807;&#x3002;</p>
<ol>
<li>RTO(Recovery time objective):&#x6545;&#x969C;&#x6062;&#x590D;&#x8017;&#x65F6;</li>
<li>RPO(Recovery point objective):&#x6062;&#x590D;&#x540E;&#x6570;&#x636E;&#x5BF9;&#x5E94;&#x7684;&#x65F6;&#x95F4;&#x70B9;&#xFF0C;&#x5373;&#x4E22;&#x5931;&#x7684;&#x6570;&#x636E;&#x91CF;&#x8F6C;&#x6362;&#x4E3A;&#x65F6;&#x95F4;</li>
</ol>
<p>&#x4E3E;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x6570;&#x636E;&#x5E93;&#x540C;&#x57CE;&#x540C;&#x6B65;&#x5907;&#x673A;&#xFF0C;&#x6545;&#x969C;&#x540E;RPO&#x5FC5;&#x7136;&#x662F;0&#xFF0C;tikv&#x4E00;&#x822C;&#x60C5;&#x51B5;&#x4E0B;RPO&#x4E5F;&#x662F;0&#x3002;RTO&#x4E5F;&#x662F;&#x79D2;&#x7EA7;&#x7684;&#xFF0C;&#x5BF9;&#x4E8E;&#x4E0D;&#x540C;&#x7684;&#x6545;&#x969C;&#xFF0C;&#x7ED3;&#x679C;&#x4E5F;&#x4E0D;&#x540C;</p>
<p><strong>&#x8BF7;&#x6C42;&#x6210;&#x529F;&#x7387;</strong></p>
<p>&#x5BF9;&#x4E8E;&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#x6765;&#x8BF4;&#xFF0C;&#x4ECE;&#x7CFB;&#x7EDF;&#x5C42;&#x9762;&#x8003;&#x5BDF;&#x5E73;&#x5747;&#x670D;&#x52A1;&#x65F6;&#x95F4;&#x7684;&#x610F;&#x4E49;&#x5E76;&#x4E0D;&#x662F;&#x5F88;&#x5927;&#xFF0C;&#x5BF9;&#x4E8E;&#x5F88;&#x591A;&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#x6765;&#x8BF4;&#xFF0C;&#x5355;&#x673A;&#x7684;&#x6545;&#x969C;&#x5E76;&#x4E0D;&#x80FD;&#x5F71;&#x54CD;&#x7CFB;&#x7EDF;&#x6574;&#x4F53;&#x7A33;&#x5B9A;&#x7684;&#x7EE7;&#x7EED;&#x8FD0;&#x884C;&#xFF0C;&#x4ECE;&#x8FD9;&#x4E2A;&#x89D2;&#x5EA6;&#x6765;&#x8BF4;&#xFF0C;&#x7CFB;&#x7EDF;&#x53EF;&#x7528;&#x6027;&#x53EF;&#x4EE5;&#x8BF4;&#x662F;100%&#x7684;&#x3002;&#x8FD9;&#x65F6;&#xFF0C;&#x8BA1;&#x7B97;&#x8BF7;&#x6C42;&#x7684;&#x6210;&#x529F;&#x6570;&#x53EF;&#x80FD;&#x66F4;&#x9002;&#x5408;&#x8FD9;&#x6837;&#x7684;&#x7CFB;&#x7EDF;&#xFF0C;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><strong><em>&#x53EF;&#x7528;&#x6027;=&#x6210;&#x529F;&#x8BF7;&#x6C42;&#x6570;/&#x603B;&#x8BF7;&#x6C42;&#x6570;</em></strong></p>
<p>&#x5F53;&#x7136;&#x8FD9;&#x79CD;&#x6307;&#x6807;&#x66F4;&#x65B9;&#x4FBF;&#x89C2;&#x5BDF;&#x7CFB;&#x7EDF;&#x7684;&#x5185;&#x90E8;&#x9519;&#x8BEF;&#xFF0C;&#x5BF9;&#x4E8E;&#x4E8B;&#x52A1;&#x56DE;&#x6EDA;&#x8FD9;&#x79CD;&#x884C;&#x4E3A;&#xFF0C;&#x5E76;&#x4E0D;&#x80FD;&#x8BA4;&#x4E3A;&#x662F;&#x5931;&#x8D25;&#x7684;&#x8BF7;&#x6C42;&#x3002;&#x8FD9;&#x662F;&#x548C;&#x4E1A;&#x52A1;&#x884C;&#x4E3A;&#x53CA;&#x4E8B;&#x52A1;&#x8BED;&#x4E49;&#x76F8;&#x5173;&#x7684;&#x3002;</p>
<p><strong>&#x957F;&#x7A33;</strong></p>
<p>&#x4E0A;&#x9762;&#x63D0;&#x53CA;SLA&#xFF0C;&#x4E5F;&#x63D0;&#x5230;&#x4E86;&#xFF0C;&#x5176;&#x5B9E;&#x5728;&#x4F20;&#x7EDF;&#x9886;&#x57DF;&#xFF0C;&#x4E0D;&#x6B62;&#x53EF;&#x670D;&#x52A1;&#x65F6;&#x95F4;&#x53D7;&#x4EBA;&#x5173;&#x6CE8;&#xFF0C;&#x670D;&#x52A1;&#x8D28;&#x91CF;&#x6307;&#x6807;&#xFF08;SLO&#xFF09;&#x540C;&#x6837;&#x53D7;&#x4EBA;&#x5173;&#x6CE8;&#x3002;</p>
<p>&#x5927;&#x5BB6;&#x90FD;&#x77E5;&#x9053;&#x6728;&#x6876;&#x539F;&#x7406;&#xFF0C;&#x6570;&#x636E;&#x5E93;&#x505A;&#x4E3A;&#x57FA;&#x7840;&#x8F6F;&#x4EF6;&#xFF0C;&#x65E2;&#x662F;&#x541E;&#x5410;&#x6CA1;&#x6709;&#x4E0B;&#x964D;&#xFF0C;&#x4E00;&#x65F6;&#x7684;&#x6027;&#x80FD;&#x6296;&#x52A8;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x4E1A;&#x52A1;&#x8F6F;&#x4EF6;&#x7684;&#x6027;&#x80FD;&#x5927;&#x5E45;&#x4E0B;&#x964D;&#x3002;</p>
<p>&#x8861;&#x91CF;&#x6570;&#x636E;&#x5E93;&#x670D;&#x52A1;&#x8D28;&#x91CF;&#x901A;&#x5E38;&#x6709;&#x51E0;&#x4E2A;&#x6307;&#x6807;&#xFF1A;</p>
<ol>
<li>&#x541E;&#x5410;&#x91CF;&#xFF0C;&#x5BF9;&#x4E8E;&#x6570;&#x636E;&#x5E93;&#x7CFB;&#x7EDF;&#xFF0C;&#x4E00;&#x822C;&#x662F;qps&#xFF0C;&#x6216;&#x8005;tps&#xFF1B;</li>
<li>&#x65F6;&#x5EF6;&#xFF0C;&#x5173;&#x4E8E;&#x65F6;&#x5EF6;&#xFF0C;&#x4E00;&#x822C;&#x6709;&#x5982;&#x4E0B;&#x51E0;&#x4E2A;&#x6307;&#x6807;, &#x5E73;&#x5747;&#x65F6;&#x5EF6;&#xFF0C;95%&#x65F6;&#x5EF6;&#xFF0C;99%&#x65F6;&#x5EF6;&#xFF0C;&#x6700;&#x5927;&#x65F6;&#x5EF6;&#xFF1B;</li>
<li>&#x56DE;&#x6EDA;&#x7387;</li>
</ol>
<h2 id="&#x5236;&#x5B9A;&#x5408;&#x7406;&#x7684;&#x9AD8;&#x53EF;&#x7528;&#x76EE;&#x6807;"><a href="#&#x5236;&#x5B9A;&#x5408;&#x7406;&#x7684;&#x9AD8;&#x53EF;&#x7528;&#x76EE;&#x6807;" class="headerlink" title="&#x5236;&#x5B9A;&#x5408;&#x7406;&#x7684;&#x9AD8;&#x53EF;&#x7528;&#x76EE;&#x6807;"></a>&#x5236;&#x5B9A;&#x5408;&#x7406;&#x7684;&#x9AD8;&#x53EF;&#x7528;&#x76EE;&#x6807;</h2><p>&#x4E0D;&#x5BA2;&#x6C14;&#x7684;&#x8BF4;&#xFF0C;&#x5BF9;&#x4E8E;&#x7EDD;&#x5927;&#x90E8;&#x5206;&#x7CFB;&#x7EDF;&#xFF0C;&#x5728;&#x6B63;&#x5E38;&#x6545;&#x969C;&#x4E0B;&#xFF0C;2&#x4E2A;9&#x5230;3&#x4E2A;9&#x5DF2;&#x7ECF;&#x8DB3;&#x591F;&#x7528;&#x4E86;&#xFF0C;&#x4E0D;&#x8003;&#x8651;&#x7CFB;&#x7EDF;&#x53D8;&#x66F4;&#xFF0C;&#x8FD9;&#x4E5F;&#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x5BB9;&#x6613;&#x8FBE;&#x5230;&#x7684;&#x6307;&#x6807;&#x3002;</p>
<p>&#x800C;&#x63D0;&#x5347;&#x4E00;&#x4E2A;9&#xFF0C;&#x7CFB;&#x7EDF;&#x8BBE;&#x8BA1;&#x548C;&#x5B9E;&#x73B0;&#x7684;&#x590D;&#x6742;&#x5EA6;&#x90FD;&#x8981;&#x63D0;&#x5347;&#x5F88;&#x591A;&#xFF0C;&#x6240;&#x5F97;&#x672A;&#x5FC5;&#x507F;&#x6240;&#x5931;&#x3002;</p>
<p>&#x6253;&#x4E2A;&#x6BD4;&#x65B9;&#xFF0C;&#x6211;&#x4EEC;&#x770B;&#x5230;&#x963F;&#x91CC;rds&#x7684;SLA&#x662F;99.95%&#xFF0C;&#x800C;&#x4E14;&#x662F;&#x6309;&#x6708;&#x7ED3;&#x7B97;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x6BCF;&#x4E2A;&#x6708;&#x5141;&#x8BB8;&#x7684;&#x6545;&#x969C;&#x65F6;&#x95F4;&#x5927;&#x6982;&#x662F;4min&#xFF0C;&#x52A0;&#x4E0A;1min&#x7684;&#x4E0D;&#x8BA1;&#x65F6;&#x95F4;&#xFF0C;&#x7B97;5min&#xFF0C;&#x4E25;&#x683C;&#x6765;&#x8BF4;&#xFF0C;&#x8FD9;5min&#x5305;&#x542B;&#x6545;&#x969C;&#x53D1;&#x73B0;&#x548C;&#x6545;&#x969C;&#x5904;&#x7406;&#x3002;&#x53EF;&#x4EE5;&#x60F3;&#x50CF;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x4EBA;&#x6765;&#x5904;&#x7406;&#xFF0C;5min&#x90FD;&#x672A;&#x5FC5;&#x80FD;&#x53CA;&#x65F6;&#x767B;&#x5F55;&#x5230;&#x7CFB;&#x7EDF;&#x4E0A;&#x3002;&#x5FC5;&#x7136;&#x662F;&#x5168;&#x81EA;&#x52A8;&#x7684;&#x6545;&#x969C;&#x5904;&#x7406;&#xFF0C;&#x8FD9;&#x4E2A;&#x8981;&#x6C42;&#x5BF9;&#x7CFB;&#x7EDF;&#x7684;&#x81EA;&#x52A8;&#x5316;&#x6545;&#x969C;&#x5904;&#x7406;&#x80FD;&#x529B;&#x7684;&#x8981;&#x6C42;&#x5C31;&#x975E;&#x5E38;&#x9AD8;&#x4E86;&#x3002;&#x5F88;&#x591A;&#x5927;&#x578B;&#x4E92;&#x8054;&#x7F51;&#x516C;&#x53F8;&#x4E5F;&#x672A;&#x5FC5;&#x6709;&#x8FD9;&#x4E2A;&#x5F00;&#x53D1;&#x80FD;&#x529B;&#xFF0C;&#x5F53;&#x7136;&#xFF0C;&#x4E5F;&#x6CA1;&#x6709;&#x8FD9;&#x4E2A;&#x5FC5;&#x8981;&#x3002;</p>
<p>&#x4E0D;&#x8FC7;&#x53EA;&#x8981;&#x4E0D;&#x53D1;&#x751F;&#x5927;&#x89C4;&#x6A21;&#x7684;&#x6545;&#x969C;&#xFF0C;&#x8D54;100&#x500D;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x5BF9;&#x963F;&#x91CC;&#x4E5F;&#x4E0D;&#x7B97;&#x4EC0;&#x4E48;&#x3002;&#x4E0D;&#x6309;&#x5BA2;&#x6237;&#x635F;&#x5931;&#x8D54;&#x507F;&#xFF0C;&#x90FD;&#x662F;&#x73A9;&#x7B11;&#x7F62;&#x4E86;&#x3002;</p>
<h2 id="&#x53C2;&#x8003;&#x8D44;&#x6599;"><a href="#&#x53C2;&#x8003;&#x8D44;&#x6599;" class="headerlink" title="&#x53C2;&#x8003;&#x8D44;&#x6599;"></a>&#x53C2;&#x8003;&#x8D44;&#x6599;</h2><ol>
<li>&#x300A;SRE: google&#x8FD0;&#x7EF4;&#x89E3;&#x5BC6;&#x300B;</li>
<li><a href="/external_links/351d20d415653c6d097acc099231e4c2.html" target="blank" rel="noopener">&#x6765;&#x81EA; Google &#x7684;&#x9AD8;&#x53EF;&#x7528;&#x67B6;&#x6784;&#x7406;&#x5FF5;&#x4E0E;&#x5B9E;&#x8DF5;</a></li>
<li><a href="/external_links/351d20d415653c6d097acc099231e4c2.html" target="blank" rel="noopener">&#x5173;&#x4E8E;SLA,&#x4F60;&#x5230;&#x5E95;&#x77E5;&#x591A;&#x5C11;&#xFF1F;</a></li>
<li><a href="/external_links/351d20d415653c6d097acc099231e4c2.html" target="blank" rel="noopener">&#x4E91;&#x670D;&#x52A1;&#x5668;(ECS)&#x670D;&#x52A1;&#x7B49;&#x7EA7;&#x534F;&#x8BAE;(SLA)</a></li>
<li><a href="/external_links/351d20d415653c6d097acc099231e4c2.html" target="blank" rel="noopener">&#x817E;&#x8BAF;&#x4E91;&#x670D;&#x52A1;SLA</a></li>
<li>&#x300A;the tail at scale&#x300B;</li>
</ol>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/e130d46b5862d9f6987c8006dcedf37e.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903516905930759.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903516905930759.html" itemprop="url">Laravel 中的简单工厂和抽象工厂</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-27T14:49:47+08:00">
                2017-11-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#x4E4B;&#x5DE5;&#x5382;&#x6A21;&#x5F0F;&#x5206;&#x4E3A;&#x4E24;&#x79CD;&#xFF1A;&#x7B80;&#x5355;&#x5DE5;&#x5382;&#x548C;&#x62BD;&#x8C61;&#x5DE5;&#x5382;&#x6A21;&#x5F0F;&#xFF0C;&#x5DE5;&#x5382;&#x6A21;&#x5F0F;&#x5C5E;&#x4E8E;&#x201C;&#x521B;&#x5EFA;&#x201D;&#x578B;&#x7684;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#xFF0C;&#x987E;&#x540D;&#x601D;&#x4E49;&#x7528;&#x6765;&#x5B9E;&#x4F8B;&#x5316;&#x5BF9;&#x8C61;&#xFF0C;&#x8C03;&#x7528;&#x8005;&#x4E0D;&#x9700;&#x8981;&#x5173;&#x5FC3;&#x5BF9;&#x8C61;&#x7684;&#x5177;&#x4F53;&#x4F4D;&#x7F6E;&#x548C;&#x5B9E;&#x73B0;&#xFF0C;&#x5DE5;&#x5382;&#x6A21;&#x5F0F;&#x9690;&#x85CF;&#x4E86;&#x80CC;&#x540E;&#x7684;&#x7EC6;&#x8282;&#xFF0C;&#x4ECE;&#x800C;&#x5B9E;&#x73B0;&#x4E86;&#x89E3;&#x8026;&#x7684;&#x76EE;&#x7684;&#x3002;</p>
<p>&#x5728;&#x5927;&#x591A;&#x6570;&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x7684;&#x8BED;&#x8A00;&#x4E2D;&#xFF0C;&#x5B9E;&#x4F8B;&#x5316;&#x5BF9;&#x8C61;&#x57FA;&#x672C;&#x4E0A;&#x90FD;&#x662F; <code>new ClassA()</code> &#x8FD9;&#x6837;&#x521B;&#x5EFA;&#x5B9E;&#x4F8B;&#xFF0C;&#x6709;&#x4E24;&#x4E2A;&#x539F;&#x56E0;&#x4E0D;&#x5EFA;&#x8BAE;&#x8FD9;&#x4E48;&#x505A;&#xFF1A;1.&#x4E0A;&#x5C42;&#x4F7F;&#x7528;&#x8005;&#x6CA1;&#x6709;&#x548C;&#x5BF9;&#x8C61;&#x7684;&#x521B;&#x5EFA;&#x8FC7;&#x7A0B;&#x9694;&#x79BB;&#xFF0C;&#x5BFC;&#x81F4;&#x4EE3;&#x7801;&#x8026;&#x5408;&#x5EA6;&#x9AD8; 2.&#x521B;&#x5EFA;&#x5BF9;&#x8C61;&#x5B9E;&#x4F8B;&#x7684;&#x8FC7;&#x7A0B;&#x53EF;&#x80FD;&#x6BD4;&#x8F83;&#x590D;&#x6742;&#xFF0C;&#x6BD4;&#x5982;&#x4E00;&#x4E9B;&#x524D;&#x7F6E;&#x7684;&#x8FC7;&#x7A0B;&#x3002;&#x6240;&#x4EE5;&#x628A;&#x8FD9;&#x4E2A;&#x521B;&#x5EFA;&#x8FC7;&#x7A0B;&#x4EA4;&#x7ED9;&#x5DE5;&#x5382;&#x65B9;&#x6CD5;&#xFF0C;&#x8C03;&#x7528;&#x8005;&#x4E0D;&#x7528;&#x5173;&#x5FC3;&#x5B9E;&#x4F8B;&#x662F;&#x600E;&#x4E48;&#x521B;&#x5EFA;&#x7684;&#x3002;</p>
<p>&#x5DE5;&#x5382;&#x662F;&#x751F;&#x4EA7;&#x4EA7;&#x54C1;&#x7684;&#xFF0C;&#x8FD9;&#x91CC;&#x4EA7;&#x54C1;&#x6307;&#x7684;&#x5C31;&#x662F;&#x5177;&#x4F53;&#x7684;&#x5B9E;&#x4F8B;&#x3002;&#x7B80;&#x5355;&#x5DE5;&#x5382;&#x548C;&#x62BD;&#x8C61;&#x5DE5;&#x5382;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#x90FD;&#x662F;&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x7C7B;&#x7684;&#x5B9E;&#x4F8B;&#x5316;&#xFF0C;&#x907F;&#x514D; <code>new XX()</code>&#x5E26;&#x6765;&#x7684;&#x4EE3;&#x7801;&#x8026;&#x5408;&#x3002;</p>
<p>&#x7B80;&#x5355;&#x5DE5;&#x5382;&#x6A21;&#x5F0F;</p>
<p>&#x7B80;&#x5355;&#x5DE5;&#x5382;&#x6A21;&#x5F0F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x5DE5;&#x5382;&#x65B9;&#x6CD5;&#xFF0C;&#x6216;&#x8005;&#x8BF4;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x6BD4;&#x5982;&#x4F20;&#x5165;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x5DE5;&#x5382;&#x65B9;&#x6CD5;&#x6839;&#x636E;&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x8FD4;&#x56DE;&#x5177;&#x4F53;&#x7C7B;&#x7684;&#x5B9E;&#x4F8B;&#x3002;&#x5B83;&#x76F8;&#x5F53;&#x4E8E;&#x591A;&#x4E86;&#x4E00;&#x5C42;&#x5C01;&#x88C5;&#xFF0C;&#x4F60;&#x53EA;&#x8981;&#x5173;&#x5FC3;&#x9700;&#x8981;&#x4EC0;&#x4E48;&#x5B9E;&#x4F8B;&#xFF0C;&#x5B83;&#x5C31;&#x8FD4;&#x56DE;&#x4EC0;&#x4E48;&#x5B9E;&#x4F8B;&#xFF0C;&#x800C;&#x4E0D;&#x7528;&#x76F4;&#x63A5;&#x5B9E;&#x4F8B;&#x5316;&#xFF0C;&#x5B9E;&#x4F8B;&#x5316;&#x7684;&#x8FC7;&#x7A0B;&#x4EA4;&#x7ED9;&#x4E86;&#x5DE5;&#x5382;&#x65B9;&#x6CD5;&#x3002;</p>
<p>Laravel &#x4E2D;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#x7684;&#x5DE5;&#x5382;&#x7C7B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;vendor/laravel/framework/src/Illuminate/Database/Connectors/ConnectionFactory.php</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;protected function createConnection($driver, $connection, $database, $prefix = &apos;&apos;, array $config = []){ &#xA0; &#xA0;if ($this-&gt;container-&gt;bound($key = &quot;db.connection.{$driver}&quot;)) { &#xA0; &#xA0; &#xA0; &#xA0;return $this-&gt;container-&gt;make($key, [$connection, $database, $prefix, $config]); &#xA0; &#xA0;} &#xA0; &#xA0;switch ($driver) { &#xA0; &#xA0; &#xA0; &#xA0;case &apos;mysql&apos;: &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;return new MySqlConnection($connection, $database, $prefix, $config); &#xA0; &#xA0; &#xA0; &#xA0;case &apos;pgsql&apos;: &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;return new PostgresConnection($connection, $database, $prefix, $config); &#xA0; &#xA0; &#xA0; &#xA0;case &apos;sqlite&apos;: &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;return new SQLiteConnection($connection, $database, $prefix, $config); &#xA0; &#xA0; &#xA0; &#xA0;case &apos;sqlsrv&apos;: &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;return new SqlServerConnection($connection, $database, $prefix, $config); &#xA0; &#xA0;} &#xA0; &#xA0;throw new InvalidArgumentException(&quot;Unsupported driver [$driver]&quot;);}</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x91CC;&#x6839;&#x636E;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x6570;&#x636E;&#x5E93;&#x9A71;&#x52A8;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x8FD4;&#x56DE;&#x5BF9;&#x5E94;&#x6570;&#x636E;&#x5E93;&#x7684;&#x8FDE;&#x63A5;&#x5BF9;&#x8C61;&#x7684;&#x5B9E;&#x4F8B;&#x3002;</p>
<p>&#x7B80;&#x5355;&#x5DE5;&#x5382;&#x6A21;&#x5F0F;&#x7B26;&#x5408; &#x5355;&#x4E00;&#x804C;&#x8D23;&#x539F;&#x5219; &#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6BCF;&#x4E2A;&#x7C7B;&#x53EA;&#x505A;&#x4E00;&#x4EF6;&#x4E8B;&#x60C5;&#xFF0C;&#x4F46;&#x4E0D;&#x7B26;&#x5408; &#x5F00;&#x653E;&#x5C01;&#x95ED;&#x539F;&#x5219; &#xFF0C;&#x6BCF;&#x6B21;&#x589E;&#x52A0;&#x548C;&#x51CF;&#x5C11;&#x6240;&#x9700;&#x5B9E;&#x4F8B;&#x90FD;&#x9700;&#x8981;&#x6539;&#x52A8;&#x4EE3;&#x7801;&#xFF0C;&#x4E0D;&#x80FD;&#x505A;&#x5230;&#x5F88;&#x597D;&#x7684;&#x6269;&#x5C55;&#x3002;</p>
<p>&#x62BD;&#x8C61;&#x5DE5;&#x5382;&#x6A21;&#x5F0F;</p>
<p>&#x62BD;&#x8C61;&#x5DE5;&#x5382;&#x6A21;&#x5F0F;&#x5728;&#x7B80;&#x5355;&#x5DE5;&#x5382;&#x6A21;&#x5F0F;&#x57FA;&#x7840;&#x4E0A;&#xFF0C;&#x591A;&#x4E86;&#x4E00;&#x5C42;&#x62BD;&#x8C61;&#x5DE5;&#x5382;&#x63A5;&#x53E3;&#xFF0C;&#x5B83;&#x7684;&#x601D;&#x60F3;&#x662F;&#xFF0C;&#x5047;&#x5982;&#x6709;&#x591A;&#x4E2A;&#x5DE5;&#x5382;&#x751F;&#x4EA7;&#x540C;&#x6837;&#x7684;&#x4EA7;&#x54C1;&#xFF0C;&#x4ED6;&#x4EEC;&#x6709;&#x540C;&#x6837;&#x7684;&#x884C;&#x4E3A;&#xFF0C;&#x90A3;&#x4E48;&#x628A;&#x8FD9;&#x4E9B;&#x4EA7;&#x54C1;&#x7684;&#x521B;&#x5EFA;&#x884C;&#x4E3A;&#x62BD;&#x8C61;&#x51FA;&#x6765;&#xFF0C;&#x6BCF;&#x4E2A;&#x5DE5;&#x5382;&#x5B9E;&#x73B0;&#x8FD9;&#x4E2A;&#x62BD;&#x8C61;&#x63A5;&#x53E3;&#x3002;</p>
<p>&#x9002;&#x7528;&#x573A;&#x666F;</p>
<p>&#x6709;&#x591A;&#x4E2A;&#x5DE5;&#x5382;&#xFF0C;&#x751F;&#x4EA7;&#x540C;&#x4E00;&#x7C7B;&#x578B;&#x7684;&#x4EA7;&#x54C1;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<p>&#x5DE5;&#x5382;1</p>
<p>&#x4EA7;&#x54C1;1 &#x4EA7;&#x54C1;2 &#x4EA7;&#x54C1;3 &#x5DE5;&#x5382;2</p>
<p>&#x4EA7;&#x54C1;1 &#x4EA7;&#x54C1;2 &#x4EA7;&#x54C1;3 &#x4EE5; Mac &#x7CFB;&#x7EDF;&#x548C; Windows &#x7CFB;&#x7EDF;&#x4E3A;&#x4F8B;&#xFF0C;&#x90FD;&#x6709;&#x521B;&#x5EFA; button &#x548C;&#x521B;&#x5EFA; border &#x529F;&#x80FD;&#xFF0C;&#x8FD9;&#x4E24;&#x4E2A;&#x5DE5;&#x5382;&#x90FD;&#x53EF;&#x4EE5;&#x751F;&#x4EA7; button &#x548C; border&#xFF0C;&#x90A3;&#x4E48;&#x628A;&#x521B;&#x5EFA;&#x8FD9;&#x4E24;&#x4E2A;&#x4EA7;&#x54C1;&#x7684;&#x65B9;&#x6CD5;&#x62BD;&#x8C61;&#x51FA;&#x6765;&#xFF0C;&#x8FD9;&#x4E2A;&#x62BD;&#x8C61;&#x51FA;&#x6765;&#x7684;&#x65B9;&#x6CD5;&#x53EB;&#x505A;&#x62BD;&#x8C61;&#x5DE5;&#x5382;&#x7C7B;&#xFF0C;&#x4E24;&#x4E2A;&#x5DE5;&#x5382;&#x90FD;&#x8981;&#x5B9E;&#x73B0;&#x8FD9;&#x4E2A;&#x62BD;&#x8C61;&#x7C7B;&#x3002;</p>
<p>PHP &#x62BD;&#x8C61;&#x5DE5;&#x5382;&#x4EE3;&#x7801;&#x793A;&#x4F8B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;abstract class AbstractFactory { abstract public function CreateButton(); abstract public function CreateBorder();}class MacFactory extends AbstractFactory{ public function CreateButton() { return new MacButton(); } public function CreateBorder() { return new MacBorder(); }}class WinFactory extends AbstractFactory{ public function CreateButton() { return new WinButton(); } public function CreateBorder() { return new WinBorder(); }}class Button{}class Border{}class MacButton extends Button{ function __construct() { echo &apos;MacButton is created&apos; . &quot;\n&quot;; }}class MacBorder extends Border{ function __construct() { echo &apos;MacBorder is created&apos; . &quot;\n&quot;; }}class WinButton extends Button{ function __construct() { echo &apos;WinButton is created&apos; . &quot;\n&quot;; }}class WinBorder extends Border{ function __construct() { echo &apos;WinBorder is created&apos; . &quot;\n&quot;; }}?&gt;</span><br></pre></td></tr></table></figure>

<p>&#x4ECE;&#x5DE5;&#x5382;&#x53D6;&#x51FA;&#x5B9E;&#x4F8B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;?$type = &apos;Mac&apos;; //value by user.if(!in_array($type, array(&apos;Win&apos;,&apos;Mac&apos;))) &#xA0; &#xA0;die(&apos;Type Error&apos;);$factoryClass = $type.&apos;Factory&apos;;$factory=new $factoryClass;$factory-&gt;CreateButton();$factory-&gt;CreateBorder();?&gt;</span><br></pre></td></tr></table></figure>

<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/1e16d662be9ef0505cd26a2d0d1744e0.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903516889169927.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903516889169927.html" itemprop="url">【英】 使用 helmet 库来保护你的 Express 网</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-27T14:26:27+08:00">
                2017-11-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="/external_links/4ed5922eb818b953fc6e20d667e67b46.html" target="blank" rel="noopener">Express</a> is a great way to build a web server using <a href="/external_links/d85a99338b8814ad95a7d155affb699c.html" target="blank" rel="noopener">Node.js</a>. It&#x2019;s easy to get started with and allows you to configure and extend it easily thanks to its concept of middleware.<br> While there are a <a href="/external_links/5506f3d87b4e2a889ab3ec8b2b27237c.html" target="blank" rel="noopener">variety of frameworks to create web applications</a> in Node.js, my first choice is always Express. However, out of the box Express<br> doesn&#x2019;t adhere to all security best practices. Let&#x2019;s look at how we can use modules like <a href="/external_links/051474e053754afd0d69e559ea5a2d6e.html" target="blank" rel="noopener"><code>helmet</code></a>  to improve the security of an application.</p>
<h3 id="Set-Up"><a href="#Set-Up" class="headerlink" title="Set Up"></a>Set Up</h3><p>Before we get started make sure you have Node.js and npm (or yarn) installed. You can find the <a href="/external_links/6b8b4efc7defcb0fc1edb85964cd4557.html" target="blank" rel="noopener">download and installation instructions on the Node.js website</a>.</p>
<p>We&#x2019;ll work on a new project but you can also apply these features to your existing project.</p>
<p>Start a new project in your command line by running:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;mkdir secure-express-demo</span><br><span class="line">cd secure-express-demo</span><br><span class="line">npm init -y</span><br></pre></td></tr></table></figure>

<p>Install the Express module by running:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;npm install express --save</span><br></pre></td></tr></table></figure>

<p>Create a new file called <code>index.js</code> in the <code>secure-express-demo</code> folder and add the following lines:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;const express = require(&apos;express&apos;);</span><br><span class="line">const PORT = process.env.PORT || 3000;</span><br><span class="line">const app = express();</span><br><span class="line">&#xA0;</span><br><span class="line">app.get(&apos;/&apos;, (req, res) =&gt; {</span><br><span class="line">&#xA0;&#xA0;res.send(`&lt;h1&gt;Hello World&lt;/h1&gt;`);</span><br><span class="line">});</span><br><span class="line">&#xA0;</span><br><span class="line">app.listen(PORT, () =&gt; {</span><br><span class="line">&#xA0;&#xA0;console.log(`Listening on http://localhost:${PORT}`);</span><br><span class="line">});</span><br></pre></td></tr></table></figure>

<p>Save the file and let&#x2019;s see if everything is working. Start the server by running:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;node index.js</span><br></pre></td></tr></table></figure>

<p>Navigate to <a href="/external_links/87a70ce46ea04de7c28dd1e4da31904c.html" target="blank" rel="noopener">http://localhost:3000</a> and you should be greeted with <code>Hello World</code>.</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/6f1d1f9dd70f193a72b31fc247784d4834fa3b8d4a1576d1211b54d57852f3ec" alt="hello-world.png"></p>
<h3 id="Inspecting-the-Headers"><a href="#Inspecting-the-Headers" class="headerlink" title="Inspecting the Headers"></a>Inspecting the Headers</h3><p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/25906dab13c251f8cfc9c550227902794165b6715e893e2154ee5767b5a94701" alt="giphy.gif"></p>
<p>We&#x2019;ll start by adding and removing a few HTTP headers that will help improve our security. To inspect these headers you can use a tool like <code>curl</code> by running:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;curl http://localhost:3000 --include</span><br></pre></td></tr></table></figure>

<p>The <code>--include</code> flag makes sure to print out the HTTP headers of the response. If you don&#x2019;t have <code>curl</code> installed you can also use your favorite browser developer tools and the networking pane.</p>
<p>At the moment you should see the following HTTP headers being transmitted in the response:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;HTTP/1.1 200 OK</span><br><span class="line">X-Powered-By: Express</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Length: 20</span><br><span class="line">ETag: W/&quot;14-SsoazAISF4H46953FT6rSL7/tvU&quot;</span><br><span class="line">Date: Wed, 01 Nov 2017 13:36:10 GMT</span><br><span class="line">Connection: keep-alive</span><br></pre></td></tr></table></figure>

<p>One header that you should keep an eye on is <code>X-Powered-By</code>. Generally speaking headers that start with <code>X-</code> are non-standard headers. This one gives away which framework you are using. For an attacker, this cuts the attack space<br> down for them as they can concentrate on the known vulnerabilities in that framework.</p>
<h3 id="Putting-the-helmet-on"><a href="#Putting-the-helmet-on" class="headerlink" title="Putting the helmet on"></a>Putting the helmet on</h3><p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/d6f6fb5c5864efdf53402bb123c91ca8d5245d5780b6cc3e9b2e009c492d935d" alt="giphy.gif"></p>
<p>Let&#x2019;s see what happens if we start using <code>helmet</code>. Install <code>helmet</code> by running:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;npm install helmet --save</span><br></pre></td></tr></table></figure>

<p>Now add the <code>helmet</code> middleware to your application. Modify the <code>index.js</code> accordingly:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;const express = require(&apos;express&apos;);</span><br><span class="line">const helmet = require(&apos;helmet&apos;);</span><br><span class="line">const PORT = process.env.PORT || 3000;</span><br><span class="line">const app = express();</span><br><span class="line">&#xA0;</span><br><span class="line">app.use(helmet());</span><br><span class="line">&#xA0;</span><br><span class="line">app.get(&apos;/&apos;, (req, res) =&gt; {</span><br><span class="line">&#xA0;&#xA0;res.send(`&lt;h1&gt;Hello World&lt;/h1&gt;`);</span><br><span class="line">});</span><br><span class="line">&#xA0;</span><br><span class="line">app.listen(PORT, () =&gt; {</span><br><span class="line">&#xA0;&#xA0;console.log(`Listening on http://localhost:${PORT}`);</span><br><span class="line">});</span><br></pre></td></tr></table></figure>

<p>This is using the default configuration of <code>helmet</code>. Let&#x2019;s take a look at what it actually does. Restart the server and inspect the HTTP headers again by running:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;curl http://localhost:3000 --inspect</span><br></pre></td></tr></table></figure>

<p>The new headers should look something like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;HTTP/1.1 200 OK</span><br><span class="line">X-DNS-Prefetch-Control: off</span><br><span class="line">X-Frame-Options: SAMEORIGIN</span><br><span class="line">Strict-Transport-Security: max-age=15552000; includeSubDomains</span><br><span class="line">X-Download-Options: noopen</span><br><span class="line">X-Content-Type-Options: nosniff</span><br><span class="line">X-XSS-Protection: 1; mode=block</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Length: 20</span><br><span class="line">ETag: W/&quot;14-SsoazAISF4H46953FT6rSL7/tvU&quot;</span><br><span class="line">Date: Wed, 01 Nov 2017 13:50:42 GMT</span><br><span class="line">Connection: keep-alive</span><br></pre></td></tr></table></figure>

<p>The <code>X-Powered-By</code> header is gone, which is a good start, but now we have a bunch of new headers. What are they all doing?</p>
<h4 id="X-DNS-Prefetch-Control"><a href="#X-DNS-Prefetch-Control" class="headerlink" title="X-DNS-Prefetch-Control"></a>X-DNS-Prefetch-Control</h4><p>This header isn&#x2019;t much of an added security benefit as much as an added privacy benefit. By setting the value to <code>off</code> it turns off the DNS lookups that the browser does for URLs in the page. The DNS lookups are done for performance improvements<br> and according to MDN they can <a href="/external_links/baa5a01ccd73f270b1619c0e76f569ea.html" target="blank" rel="noopener">improve the performance of loading images by 5% or more</a>. However this look up can make it appear like the user visited<br> things they never visited.</p>
<p>The default for this is <code>off</code> but if you care about the added performance benefit you can enable it by passing <code>{ dnsPrefetchControl: { allow: true }}</code> to the <code>helmet()</code> call.</p>
<h4 id="X-Frame-Options"><a href="#X-Frame-Options" class="headerlink" title="X-Frame-Options"></a>X-Frame-Options</h4><p><code>X-Frame-Options</code> allows you to control whether the page can be loaded in a frame like <code>&lt;frame/&gt;</code> <code>&lt;iframe/&gt;</code> or <code>&lt;object/&gt;</code>. Unless you really need to frame your page you should just disable<br> it entirely by passing the option to the <code>helmet()</code> call:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;app.use(helmet({</span><br><span class="line">&#xA0; frameguard: {</span><br><span class="line">&#xA0; &#xA0; action: &apos;deny&apos;</span><br><span class="line">&#xA0; }</span><br><span class="line">}));</span><br></pre></td></tr></table></figure>

<p><a href="/external_links/4ed653c049948fa153f2b83098279f7e.html" target="blank" rel="noopener"><code>X-Frame-Options</code> is supported by all modern browsers</a>. It can however also be controlled via a Content Security Policy as we&#x2019;ll see later.</p>
<h4 id="Strict-Transport-Security"><a href="#Strict-Transport-Security" class="headerlink" title="Strict-Transport-Security"></a>Strict-Transport-Security</h4><p>This is also known as HSTS (HTTP Strict Transport Security) and is used to ensure that there is no protocol downgrade when you are using HTTPS. If a user visited the website once on HTTPS it makes sure that the browser will not allow any future communication<br> via HTTP. This feature is helpful to avoid Man-In-The-Middle attacks.</p>
<p>You might have seen this feature in action if you tried to access a page like <a href="/external_links/99999ebcfdb78df077ad2727fd00969f.html" target="blank" rel="noopener">https://google.com</a> while being on a public WiFi with a captive portal. The WiFi is trying to redirect you to their captive portal but since you visited <code>google.com</code> before via HTTPS and it set the <code>Strict-Transport-Security</code> header, the browser will block this redirect.</p>
<p>You can read more about it on the <a href="/external_links/8404577735e94f1066395311d62b8662.html" target="blank" rel="noopener">MDN page</a> or the <a href="/external_links/b32fff8b85fbeb3612953109a9ac3acd.html" target="blank" rel="noopener">OWASP wiki page</a>.</p>
<h4 id="X-Download-Options"><a href="#X-Download-Options" class="headerlink" title="X-Download-Options"></a>X-Download-Options</h4><p>This header is only protecting you from an old IE security vulnerability. Basically if you host untrusted HTML files for download, users were able open these directly (rather than saving them to disk first) and they would execute in the context of<br> your app. This header ensures that users download files before they open them so that they can&#x2019;t execute in your app&#x2019;s security context.</p>
<p>You can find more information about this on the <a href="/external_links/8014f6549b4e65cfe0e208bb610d73ca.html" target="blank" rel="noopener">helmet page</a> and this <a href="/external_links/a7ad2c888fd818c55aca5803d619642e.html" target="blank" rel="noopener">MSDN blog post</a>.</p>
<h4 id="X-Content-Type-Options"><a href="#X-Content-Type-Options" class="headerlink" title="X-Content-Type-Options"></a>X-Content-Type-Options</h4><p>Some browsers perform &#x201C;MIME sniffing&#x201D; meaning that rather than loading things based on the <code>Content-Type</code> that the server will send, the browser will try to determine the content type based on the file content and execute it based on that.</p>
<p>Say your page offers a way to upload pictures and an attacker uploads some HTML instead, if the browser performs MIME sniffing, it could execute the code as HTML and the attacker would have performed a successful XSS attack.</p>
<p>By setting this header to <code>nosniff</code> we are disabling this MIME sniffing.</p>
<h4 id="X-XSS-Protection"><a href="#X-XSS-Protection" class="headerlink" title="X-XSS-Protection"></a>X-XSS-Protection</h4><p>This header is used to turn on basic XSS protections in the user&#x2019;s browser. It can&#x2019;t avoid every XSS opportunity but it can determine basic ones. For example, if it detects that the query string contains something like a script tag, the browser could<br> block the execution of the same code in the page knowing that it&#x2019;s likely an XSS attack. This header can have three different values. <code>0</code>, <code>1</code> and <code>1; mode=block</code>. If you want to learn more about which mode<br> you should choose, make sure to <a href="/external_links/38f0ba1b3f986a0687edfa1f54028925.html" target="blank" rel="noopener">check out this blog post about <code>X-XSS-Protection</code> and it&#x2019;s potential dangers</a>.</p>
<h4 id="Upgrading-your-helmet"><a href="#Upgrading-your-helmet" class="headerlink" title="Upgrading your helmet"></a>Upgrading your helmet</h4><p>These are just the default settings that <a href="/external_links/da60cc72719a5a0a2e82529d59c3c914.html" target="blank" rel="noopener"><code>helmet</code></a> provides. Additionally it allows you to configure headers like the <a href="/external_links/f6d77d6b1be0404a595cf2c1e7a51e21.html" target="blank" rel="noopener"><code>Expect-CT</code></a>,<br> <a href="/external_links/ec85229cb1c9245a30d7571203126c79.html" target="blank" rel="noopener"><code>Public-Key-Pins</code></a>, <a href="/external_links/0611c937774507fdf3466bfca190aeae.html" target="blank" rel="noopener"><code>Cache-Control</code></a> and <a href="/external_links/0b3b7a6e9f27fc4cc5f5b61a04c7b3e8.html" target="blank" rel="noopener"><code>Referrer-Policy</code></a>.<br> You can find more about the respective headers and how to configure them in the <a href="/external_links/da60cc72719a5a0a2e82529d59c3c914.html" target="blank" rel="noopener"><code>helmet</code> documentation</a>.</p>
<h3 id="Protecting-your-page-from-unwanted-content"><a href="#Protecting-your-page-from-unwanted-content" class="headerlink" title="Protecting your page from unwanted content"></a>Protecting your page from unwanted content</h3><p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/199e9a516346468ccfcc343287c4675a73f7fe54901ad068bf45df468d9e51b5" alt="giphy.gif"></p>
<p>Cross-site scripting is a constant threat to web applications. If an attacker can inject and run code in your application it can be a nightmare for you and your users. One solution that tries to stop the risk of unwanted code being executed on<br> your page is a <code>Content Security Policy</code> or <code>CSP</code>.</p>
<p>A CSP allows you to specify a set of rules that define the origins from which your page can load various resources. Any resource that violates these rules will be blocked by the browser automatically.</p>
<p>You can specify these rules via the <code>Content-Security-Policy</code> HTTP header but you can also set them in an HTML meta tag if you don&#x2019;t have a way to modify the HTTP headers.</p>
<p>This is what such a header might look like:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;Content-Security-Policy: default-src &apos;none&apos;;</span><br><span class="line">&#xA0; &#xA0; script-src &apos;nonce-XQY ZwBUm/WV9iQ3PwARLw==&apos;;</span><br><span class="line">&#xA0; &#xA0; style-src &apos;nonce-XQY ZwBUm/WV9iQ3PwARLw==&apos;;</span><br><span class="line">&#xA0; &#xA0; img-src &apos;self&apos;;</span><br><span class="line">&#xA0; &#xA0; font-src &apos;nonce-XQY ZwBUm/WV9iQ3PwARLw==&apos; fonts.gstatic.com;</span><br><span class="line">&#xA0; &#xA0; object-src &apos;none&apos;;</span><br><span class="line">&#xA0; &#xA0; block-all-mixed-content;</span><br><span class="line">&#xA0; &#xA0; frame-ancestors &apos;none&apos;;</span><br></pre></td></tr></table></figure>

<p>In this example you can see that for fonts we only allow them if they are from our own domain or from fonts.gstatic.com aka Google Fonts. Images we&#x2019;ll only allow from our own domain and not any external domain. For scripts and styles, however, we<br> only allow them if they have a certain <code>nonce</code>. This means we don&#x2019;t even care about the origin but we care about a very specific value. This nonce has to be specified in a way like below:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;script src=&quot;myscript.js&quot; nonce=&quot;XQY ZwBUm/WV9iQ3PwARLw==&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;link rel=&quot;stylesheet&quot; href=&quot;mystyles.css&quot; nonce=&quot;XQY ZwBUm/WV9iQ3PwARLw==&quot; /&gt;</span><br></pre></td></tr></table></figure>

<p>When the browser receives the HTML it will make sure to clear out the nonce for security purposes, so other scripts won&#x2019;t be able to access them to add additional unwanted scripts.</p>
<p>We are also disabling any mixed content meaning that HTTP content inside our HTTPS page is not permitted. Other things that we don&#x2019;t permit are any <code>&lt;object /&gt;</code> elements and anything that isn&#x2019;t an image, stylesheet<br> or script since the <code>default-src</code> is mapping to <code>none</code>. Additionally we are disabling iframing with the <code>frame-ancestors</code> value.</p>
<p>We could write these headers manually but luckily there are plenty of solutions to use CSP in Express. <a href="/external_links/213cf30350a4cc341c080cb409623253.html" target="blank" rel="noopener"><code>helmet</code> comes with support for CSP</a> but in the case of <code>nonce</code> it<br> forces you to generate them yourself. I&#x2019;m personally using a module called <code>express-csp-header</code> for this.</p>
<p>Install <code>express-csp-header</code> by running:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;npm install express-csp-header --save</span><br></pre></td></tr></table></figure>

<p>Consume and enable CSP by adding the following lines to your <code>index.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;const express = require(&apos;express&apos;);</span><br><span class="line">const helmet = require(&apos;helmet&apos;);</span><br><span class="line">const csp = require(&apos;express-csp-header&apos;);</span><br><span class="line">&#xA0;</span><br><span class="line">const PORT = process.env.PORT || 3000;</span><br><span class="line">const app = express();</span><br><span class="line">&#xA0;</span><br><span class="line">const cspMiddleware = csp({</span><br><span class="line">&#xA0; policies: {</span><br><span class="line">&#xA0; &#xA0; &apos;default-src&apos;: [csp.NONE],</span><br><span class="line">&#xA0; &#xA0; &apos;script-src&apos;: [csp.NONCE],</span><br><span class="line">&#xA0; &#xA0; &apos;style-src&apos;: [csp.NONCE],</span><br><span class="line">&#xA0; &#xA0; &apos;img-src&apos;: [csp.SELF],</span><br><span class="line">&#xA0; &#xA0; &apos;font-src&apos;: [csp.NONCE, &apos;fonts.gstatic.com&apos;],</span><br><span class="line">&#xA0; &#xA0; &apos;object-src&apos;: [csp.NONE],</span><br><span class="line">&#xA0; &#xA0; &apos;block-all-mixed-content&apos;: true,</span><br><span class="line">&#xA0; &#xA0; &apos;frame-ancestors&apos;: [csp.NONE]</span><br><span class="line">&#xA0; }</span><br><span class="line">});</span><br><span class="line">&#xA0;</span><br><span class="line">app.use(helmet());</span><br><span class="line">app.use(cspMiddleware);</span><br><span class="line">&#xA0;</span><br><span class="line">app.get(&apos;/&apos;, (req, res) =&gt; {</span><br><span class="line">&#xA0; res.send(`</span><br><span class="line">&#xA0; &#xA0; &lt;h1&gt;Hello World&lt;/h1&gt;</span><br><span class="line">&#xA0; &#xA0; &lt;style nonce=${req.nonce}&gt;</span><br><span class="line">&#xA0; &#xA0; &#xA0; .blue { background: cornflowerblue; color: white; }</span><br><span class="line">&#xA0; &#xA0; &lt;/style&gt;</span><br><span class="line">&#xA0; &#xA0; &lt;p class=&quot;blue&quot;&gt;This should have a blue background because of the loaded styles&lt;/p&gt;</span><br><span class="line">&#xA0; &#xA0; &lt;style&gt;</span><br><span class="line">&#xA0; &#xA0; &#xA0; .red { background: maroon; color: white; }</span><br><span class="line">&#xA0; &#xA0; &lt;/style&gt;</span><br><span class="line">&#xA0; &#xA0; &lt;p class=&quot;red&quot;&gt;This should not have a red background, the styles are not loaded because of the missing nonce.&lt;/p&gt;</span><br><span class="line">&#xA0; `);</span><br><span class="line">});</span><br><span class="line">&#xA0;</span><br><span class="line">app.listen(PORT, () =&gt; {</span><br><span class="line">&#xA0; console.log(`Listening on http://localhost:${PORT}`);</span><br><span class="line">});</span><br></pre></td></tr></table></figure>

<p>Restart your server and navigate to <a href="/external_links/87a70ce46ea04de7c28dd1e4da31904c.html" target="blank" rel="noopener">http://localhost:3000</a> you should see one paragraph with a blue background because the styles have been loaded. The other paragraph is not styled because of the missing nonce.</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/e5279360f844b8ed748ad7c146a8252607a12416c6e1b798ffb37d78a00cbd32" alt="csp-output.png"></p>
<p>The CSP header allows you also to specify a report URL that a violation report should be sent to and you can even execute CSP in report-only mode if you want to gather some data first before enforcing it strictly.</p>
<p>You can find more information about <a href="/external_links/0778f58a4d872d657f1d0a385d2fc9f6.html" target="blank" rel="noopener">CSP on the respective MDN page</a> and the <a href="/external_links/4ed653c049948fa153f2b83098279f7e.html" target="blank" rel="noopener">current browser support on the caniuse.com page</a> but<br> overall all major browsers support it.</p>
<h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h3><p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/0c4d6e6eb7862b6631dbb52c2f73b711c41e4c9d237860b630151393892f4cea" alt="giphy.gif"></p>
<p>Unfortunately there is no silver bullet in security and new vulnerabilities constantly pop up but setting these HTTP headers in your web applications is easy to do and significantly improve your app&#x2019;s security. If you want to do a quick check of how<br> your HTTP headers hold up to security best practices, make sure to <a href="/external_links/a98eff7b5589f99a2a28f2b3587c8e58.html" target="blank" rel="noopener">check out securityheaders.io</a>.</p>
<p>If you want to learn more about web security best practices, make sure to <a href="/external_links/2fa21074142e0cd118def44fc23b7466.html" target="blank" rel="noopener">check out the Open Web Applications Security Project aka. OWASP</a>. It covers a wide selection of topics and links to additional<br> helpful resources.</p>
<p>If you have any questions or any other helpful tools to improve the security of your Node.js web applications, feel free to ping me:</p>
<ul>
<li>Twitter: <a href="/external_links/143485dbeaf2dd1f8b62a8c5f3c13a02.html" target="blank" rel="noopener">@dkundel</a></li>
<li>Email: <a href="/external_links/9271043bb4cd5a965a417e8bd6bacd38.html" target="blank" rel="noopener">dkundel@twilio.com</a></li>
<li>GitHub: <a href="/external_links/2abda60eb3918431b2e66ed3407e9f6a.html" target="blank" rel="noopener">dkundel</a></li>
</ul>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/69fcee097b9cc1053101c4bc746dc16c.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903516889333774.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903516889333774.html" itemprop="url">PHP 的 错误/异常 处理总结</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-27T14:25:09+08:00">
                2017-11-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="&#x9519;&#x8BEF;"><a href="#&#x9519;&#x8BEF;" class="headerlink" title="&#x9519;&#x8BEF;"></a>&#x9519;&#x8BEF;</h2><blockquote>
<p>&#x8FD9;&#x91CC;&#x8BF4;&#x7684;&#x9519;&#x8BEF;&#xFF0C;&#x53EF;&#x80FD;&#x662F;&#x7531; &#x8BED;&#x6CD5;&#x89E3;&#x6790;&#x3001;&#x8FD0;&#x884C;&#x65F6;&#x7B49;&#x5404;&#x79CD;&#x539F;&#x56E0;&#x4EA7;&#x751F;&#x7684;&#x4FE1;&#x606F;&#x5F15;&#x8D77;&#x7684;</p>
</blockquote>
<h3 id="&#x5E38;&#x89C1;&#x7684;&#x9519;&#x8BEF;&#x7C7B;&#x578B;"><a href="#&#x5E38;&#x89C1;&#x7684;&#x9519;&#x8BEF;&#x7C7B;&#x578B;" class="headerlink" title="&#x5E38;&#x89C1;&#x7684;&#x9519;&#x8BEF;&#x7C7B;&#x578B;"></a>&#x5E38;&#x89C1;&#x7684;&#x9519;&#x8BEF;&#x7C7B;&#x578B;</h3><h4 id="&#x8FD0;&#x884C;&#x65F6;&#x9519;&#x8BEF;"><a href="#&#x8FD0;&#x884C;&#x65F6;&#x9519;&#x8BEF;" class="headerlink" title="&#x8FD0;&#x884C;&#x65F6;&#x9519;&#x8BEF;"></a>&#x8FD0;&#x884C;&#x65F6;&#x9519;&#x8BEF;</h4><ul>
<li><code>E_ERROR</code> - &#x81F4;&#x547D;&#x9519;&#x8BEF;</li>
</ul>
<pre><code>+ &#x5B9A;&#x4E49;&#xFF1A;&#x81F4;&#x547D;&#x7684;&#x8FD0;&#x884C;&#x65F6;&#x9519;&#x8BEF;
+ &#x540E;&#x679C;&#xFF1A;&#x811A;&#x672C;&#x7EC8;&#x6B62;&#x4E0D;&#x518D;&#x7EE7;&#x7EED;&#x8FD0;&#x884C;</code></pre><ul>
<li><code>E_WARNING</code> - &#x8B66;&#x544A;</li>
</ul>
<pre><code>+ &#x5B9A;&#x4E49;&#xFF1A;&#x8FD0;&#x884C;&#x65F6;&#x8B66;&#x544A; (&#x975E;&#x81F4;&#x547D;&#x9519;&#x8BEF;)
+ &#x540E;&#x679C;&#xFF1A;&#x7ED9;&#x51FA;&#x63D0;&#x793A;&#x4FE1;&#x606F;&#xFF0C;&#x4F46;&#x662F;&#x811A;&#x672C;&#x4E0D;&#x4F1A;&#x7EC8;&#x6B62;&#x8FD0;&#x884C;</code></pre><ul>
<li><code>E_NOTICE</code> - &#x901A;&#x77E5;</li>
</ul>
<pre><code>+ &#x5B9A;&#x4E49;&#xFF1A;&#x8FD0;&#x884C;&#x65F6;&#x901A;&#x77E5;
+ &#x7ED3;&#x679C;&#xFF1A;&#x7ED9;&#x51FA;&#x901A;&#x77E5;&#x4FE1;&#x606F;&#xFF0C;&#x4F46;&#x662F;&#x811A;&#x672C;&#x4E0D;&#x4F1A;&#x7EC8;&#x6B62;&#x8FD0;&#x884C;</code></pre><h4 id="&#x5176;&#x4ED6;&#x7C7B;&#x578B;&#x9519;&#x8BEF;"><a href="#&#x5176;&#x4ED6;&#x7C7B;&#x578B;&#x9519;&#x8BEF;" class="headerlink" title="&#x5176;&#x4ED6;&#x7C7B;&#x578B;&#x9519;&#x8BEF;"></a>&#x5176;&#x4ED6;&#x7C7B;&#x578B;&#x9519;&#x8BEF;</h4><ul>
<li>&#x7F16;&#x8BD1;&#x65F6;&#x9519;&#x8BEF;<br>eg. <code>E_PARSE</code> <code>E_COMPILE_ERROR</code> <code>E_COMPILE_WARNING</code> &#x2026;</li>
<li>&#x7528;&#x6237;&#x4EA7;&#x751F;&#x7684;&#x4FE1;&#x606F;<br>eg. <code>E_USER_WARNING</code> <code>E_USER_ERROR</code> <code>E_USER_NOTICE</code></li>
<li>&#x2026; &#x7B49;</li>
</ul>
<p>&#x5177;&#x4F53;&#x5982;&#x4E0B;&#x56FE;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/89a6d68f184673922d965054d8de3a61d411c976ed3b8ef79af13e83cd96b613" alt></p>
<p>&#x53C2;&#x8003;&#xFF1A;<a href="/external_links/5380ae83d56afdd69e650e77e07d1772.html" target="blank" rel="noopener">PHP-&#x9519;&#x8BEF;&#x5904;&#x7406;-&#x9884;&#x5B9A;&#x4E49;&#x5E38;&#x91CF;</a></p>
<h3 id="&#x9519;&#x8BEF;&#x5904;&#x7406;"><a href="#&#x9519;&#x8BEF;&#x5904;&#x7406;" class="headerlink" title="&#x9519;&#x8BEF;&#x5904;&#x7406;"></a>&#x9519;&#x8BEF;&#x5904;&#x7406;</h3><blockquote>
<p>&#x8FD9;&#x91CC;&#x53EA;&#x9488;&#x5BF9;&#x8FD0;&#x884C;&#x65F6;&#x9519;&#x8BEF;&#x8FDB;&#x884C;&#x5904;&#x7406;&#xFF0C;&#x5176;&#x4ED6;&#xFF08;&#x5982;&#xFF1A;<code>&#x8BED;&#x6CD5;&#x9519;&#x8BEF;</code> <code>Zend &#x5F15;&#x64CE;&#x4EA7;&#x751F;&#x7684;&#x9519;&#x8BEF;</code> &#x7B49;&#xFF09;&#x4E0D;&#x5728;&#x8BA8;&#x8BBA;&#x8303;&#x56F4;&#x5185;&#x3002;</p>
</blockquote>
<h4 id="&#x8BBE;&#x7F6E;&#x4E00;&#x822C;&#x9519;&#x8BEF;&#x7684;&#x5904;&#x7406;&#x51FD;&#x6570;"><a href="#&#x8BBE;&#x7F6E;&#x4E00;&#x822C;&#x9519;&#x8BEF;&#x7684;&#x5904;&#x7406;&#x51FD;&#x6570;" class="headerlink" title="&#x8BBE;&#x7F6E;&#x4E00;&#x822C;&#x9519;&#x8BEF;&#x7684;&#x5904;&#x7406;&#x51FD;&#x6570;"></a>&#x8BBE;&#x7F6E;&#x4E00;&#x822C;&#x9519;&#x8BEF;&#x7684;&#x5904;&#x7406;&#x51FD;&#x6570;</h4><p>&#x6838;&#x5FC3;&#x65B9;&#x6CD5;&#xFF1A;<a href="/external_links/3cde164646eb4aa83b288b08dac2de2e.html" target="blank" rel="noopener">set_error_handler</a></p>
<p>&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;?php</span><br><span class="line">/* &#x8BA9;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x5728;&#x6807;&#x51C6;&#x8F93;&#x51FA;&#x53EF;&#x89C1; */</span><br><span class="line">ini_set(&quot;display_errors&quot;,&quot;On&quot;);</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * &#x56DE;&#x8C03;&#x51FD;&#x6570;&#x539F;&#x578B; : bool handler ( int $errno , string $errstr [, string $errfile [, int $errline [, array $errcontext ]]] )</span><br><span class="line"> */</span><br><span class="line">set_error_handler(function ($errno, $errstr) {</span><br><span class="line">    $err_type = &apos;&apos;;</span><br><span class="line">    $return = true;</span><br><span class="line">    if (E_WARNING === $errno) {</span><br><span class="line">        $err_type = &apos;warning&apos;;</span><br><span class="line">        $return = false;</span><br><span class="line">    } elseif (E_NOTICE === $errno) {</span><br><span class="line">        $err_type = &apos;notice&apos;;</span><br><span class="line">    } elseif (E_ERROR === $errno) {</span><br><span class="line">        $err_type = &apos;error&apos;;</span><br><span class="line">    }</span><br><span class="line">    echo sprintf(&quot;This is error callback, err_type:%s, err_no:%d, err_str:%s \n&quot;, $err_type, $errno, $errstr);</span><br><span class="line">    return $return;</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">function sayHere($line)</span><br><span class="line">{</span><br><span class="line">    echo sprintf(&quot;I am here.Line:%d \n&quot;, $line);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">/* warning */</span><br><span class="line">function test($a) {}</span><br><span class="line">test();</span><br><span class="line">sayHere(__LINE__);</span><br><span class="line"></span><br><span class="line">/* notice */</span><br><span class="line">echo $notice_msg;</span><br><span class="line">sayHere(__LINE__);</span><br><span class="line"></span><br><span class="line">/* fatal */</span><br><span class="line">$i = &apos;&apos;;</span><br><span class="line">while(1) {</span><br><span class="line">    $i .= &apos;a&apos;;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">sayHere(__LINE__);</span><br></pre></td></tr></table></figure>

<p>&#x7ED3;&#x679C;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/6470f6b6e45f17624ca78965066e7c762945ac757159dd5fa9b120d998fbf6f8" alt></p>
<p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x770B;&#x5230;&#xFF0C;<code>set_error_handler</code> <strong>&#x53EA;&#x5BF9;</strong> <code>E_WARNING</code> <code>E_NOTICE</code> &#x8FDB;&#x884C;&#x4E86;&#x6355;&#x83B7;&#xFF0C;&#x5E76;&#x4E14;&#x5F53;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x9047;&#x5230;<br><code>E_NOTICE</code> &#x8FD4;&#x56DE; <code>true</code> &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x770B;&#x5230;&#x5E95;&#x5C42;&#x5BF9;&#x6807;&#x51C6;&#x9519;&#x8BEF;&#x7684;&#x8F93;&#x51FA;&#xFF0C;&#x4F46;&#x662F;&#x9047;&#x5230; <code>E_WARNING</code> &#x8FD4;&#x56DE; <code>false</code>&#xFF0C;&#x6211;&#x4EEC;&#x5E76;&#x6CA1;&#x6709;&#x770B;&#x5230;&#x5E95;&#x5C42;&#x5BF9;&#x6807;&#x51C6;&#x9519;&#x8BEF;&#x7684;&#x8F93;&#x51FA;&#x3002;</p>
<p>&#x603B;&#x7ED3;&#xFF0C;&#x6765;&#x81EA;&#x4E8E;&#x5B98;&#x65B9;&#x624B;&#x518C;&#xFF1A;</p>
<ol>
<li><code>set_error_handler</code> &#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#x6307;&#x5B9A;&#x7684;&#x9519;&#x8BEF;&#x7C7B;&#x578B;&#x90FD;&#x4F1A;&#x7ED5;&#x8FC7; PHP &#x6807;&#x51C6;&#x9519;&#x8BEF;&#x5904;&#x7406;&#x7A0B;&#x5E8F;</li>
<li>&#x4EE5;&#x4E0B;&#x7EA7;&#x522B;&#x7684;&#x9519;&#x8BEF;&#x4E0D;&#x80FD;&#x7531;&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x7684;&#x51FD;&#x6570;&#x6765;&#x5904;&#x7406;&#xFF1A; <code>E_ERROR</code>&#x3001; <code>E_PARSE</code>&#x3001; <code>E_CORE_ERROR</code>&#x3001; <code>E_CORE_WARNING</code>&#x3001; <code>E_COMPILE_ERROR</code>&#x3001; <code>E_COMPILE_WARNING</code></li>
</ol>
<p><strong>&#x5907;&#x6CE8;&#xFF1A;&#x6B64;&#x65B9;&#x6CD5;&#x53EF;&#x6709;&#x9488;&#x5BF9;&#x6027;&#x7684;&#x5BF9;&#x670D;&#x52A1;&#x4EA7;&#x751F;&#x7684;&#x6D88;&#x606F;&#x8FDB;&#x884C;&#x6536;&#x96C6;&#xFF0C;&#x5904;&#x7406;&#x3002;&#x6BD4;&#x5982;&#xFF1A;&#x5728;&#x6846;&#x67B6;&#x521D;&#x59CB;&#x5316;&#x65F6;&#xFF0C;&#x6CE8;&#x518C;&#x4E00;&#x4E2A;&#x5B9A;&#x5236;&#x5316;&#x7684;&#x9519;&#x8BEF;&#x56DE;&#x8C03;&#x3002;</strong></p>
<p>&#x90A3;&#x81F4;&#x547D;&#x9519;&#x8BEF;&#x6709;&#x6CA1;&#x6709;&#x529E;&#x6CD5;&#x5904;&#x7406;&#x5462;&#xFF1F;&#x63A5;&#x7740;&#x770B;&#x3002;</p>
<h4 id="&#x8BBE;&#x7F6E;&#x81F4;&#x547D;&#x9519;&#x8BEF;&#x5904;&#x7406;&#x51FD;&#x6570;"><a href="#&#x8BBE;&#x7F6E;&#x81F4;&#x547D;&#x9519;&#x8BEF;&#x5904;&#x7406;&#x51FD;&#x6570;" class="headerlink" title="&#x8BBE;&#x7F6E;&#x81F4;&#x547D;&#x9519;&#x8BEF;&#x5904;&#x7406;&#x51FD;&#x6570;"></a>&#x8BBE;&#x7F6E;&#x81F4;&#x547D;&#x9519;&#x8BEF;&#x5904;&#x7406;&#x51FD;&#x6570;</h4><p>&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x81F4;&#x547D;&#x9519;&#x8BEF;&#x4F1A;&#x5F15;&#x8D77;&#xFF1A;&#x811A;&#x672C;&#x7EC8;&#x6B62;&#x4E0D;&#x518D;&#x7EE7;&#x7EED;&#x8FD0;&#x884C;&#x3002;<br>&#x90A3;&#x4E48;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x5229;&#x7528; <a href="/external_links/974913ad0bc197bde8ab9fb90fbc1e27.html" target="blank" rel="noopener">register_shutdown_function</a> &#x65B9;&#x6CD5;&#x505A;&#x4E00;&#x4E9B;&#x5904;&#x7406;&#x3002;<br>&#x4F5C;&#x7528;&#xFF1A;&#x6CE8;&#x518C;&#x4E00;&#x4E2A;&#x4F1A;&#x5728;php&#x4E2D;&#x6B62;&#x65F6;&#x6267;&#x884C;&#x7684;&#x51FD;&#x6570;</p>
<p>&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;?php</span><br><span class="line">/* &#x8BA9;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x5728;&#x6807;&#x51C6;&#x8F93;&#x51FA;&#x53EF;&#x89C1; */</span><br><span class="line">ini_set(&quot;display_errors&quot;,&quot;On&quot;);</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * &#x56DE;&#x8C03;&#x51FD;&#x6570;&#x539F;&#x578B; : &#x53C2;&#x6570;&#x7531; register_shutdown_function &#x7684;&#x53C2;&#x6570;&#x51B3;&#x5B9A;</span><br><span class="line"> */</span><br><span class="line">register_shutdown_function(function () {</span><br><span class="line">    echo &quot;This will shutdown. \n&quot;;</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">function sayHere($line)</span><br><span class="line">{</span><br><span class="line">    echo sprintf(&quot;I am here.Line:%d \n&quot;, $line);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">function test($a)</span><br><span class="line">{</span><br><span class="line">    return;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">/* warning */</span><br><span class="line">test();</span><br><span class="line">sayHere(__LINE__);</span><br><span class="line"></span><br><span class="line">/* notice */</span><br><span class="line">echo $notice_msg;</span><br><span class="line">sayHere(__LINE__);</span><br><span class="line"></span><br><span class="line">/* fatal */</span><br><span class="line">$i = &apos;&apos;;</span><br><span class="line">while(1) {</span><br><span class="line">    $i .= &apos;a&apos;;</span><br><span class="line">}</span><br><span class="line">sayHere(__LINE__);</span><br></pre></td></tr></table></figure>

<p>&#x7ED3;&#x679C;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/a4ed7b03369e0b5a956d44074d4155e99a1f3cdbf62cd7d428dd7e1d9ce4b7a2" alt></p>
<p>&#x5982;&#x524D;&#x6240;&#x8FF0;&#xFF0C;&#x53D1;&#x751F;&#x81F4;&#x547D;&#x9519;&#x8BEF;&#xFF0C;&#x8FDB;&#x7A0B;&#x9000;&#x51FA;&#xFF0C;&#x4F46;&#x662F;&#x4E2D;&#x6B62;&#x4E4B;&#x524D;&#x6267;&#x884C;&#x4E86;&#x6211;&#x4EEC;&#x6CE8;&#x518C;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x3002;</p>
<hr>
<h2 id="&#x5F02;&#x5E38;"><a href="#&#x5F02;&#x5E38;" class="headerlink" title="&#x5F02;&#x5E38;"></a>&#x5F02;&#x5E38;</h2><p>&#x8BF4;&#x660E;&#xFF1A;&#x6211;&#x4EEC;&#x8FD9;&#x91CC;&#x6307;&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x5F02;&#x5E38;&#x3002;</p>
<h3 id="try-catch-&#x6355;&#x83B7;"><a href="#try-catch-&#x6355;&#x83B7;" class="headerlink" title="try-catch &#x6355;&#x83B7;"></a>try-catch &#x6355;&#x83B7;</h3><p>&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;?php</span><br><span class="line">/* &#x8BA9;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x5728;&#x6807;&#x51C6;&#x8F93;&#x51FA;&#x53EF;&#x89C1; */</span><br><span class="line">ini_set(&quot;display_errors&quot;,&quot;On&quot;);</span><br><span class="line"></span><br><span class="line">class UserException extends \Exception</span><br><span class="line">{</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">try {</span><br><span class="line">    throw new \UserException(&apos;This is exception&apos;);</span><br><span class="line">} catch (\UserException $e) {</span><br><span class="line">    echo &apos;UserException:&apos; . $e-&gt;getMessage() . PHP_EOL;</span><br><span class="line">} catch (\Exception $e) {</span><br><span class="line">    echo &apos;Exception:&apos; . $e-&gt;getMessage() . PHP_EOL;</span><br><span class="line">} finally {</span><br><span class="line">    echo &apos;here is finally&apos; . PHP_EOL;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x7ED3;&#x679C;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&#x279C;  answer git:(master) &#x2717; php exception.php</span><br><span class="line">UserException:This is exception</span><br><span class="line">here is finally</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x662F;&#x5E38;&#x89C1;&#x7684;&#x6355;&#x83B7;&#xFF0C;&#x4E0D;&#x505A;&#x8FC7;&#x591A;&#x8BF4;&#x660E;&#xFF0C;&#x53C2;&#x89C1;&#xFF1A;<a href="/external_links/37fdbc3a15b1eabcd5af90eba8519388.html" target="blank" rel="noopener">&#x5F02;&#x5E38;&#x5904;&#x7406;</a></p>
<h3 id="&#x672A;&#x6355;&#x83B7;&#x7684;&#x5F02;&#x5E38;"><a href="#&#x672A;&#x6355;&#x83B7;&#x7684;&#x5F02;&#x5E38;" class="headerlink" title="&#x672A;&#x6355;&#x83B7;&#x7684;&#x5F02;&#x5E38;"></a>&#x672A;&#x6355;&#x83B7;&#x7684;&#x5F02;&#x5E38;</h3><p>&#x90A3;&#x4E48;&#xFF0C;&#x5982;&#x6709;&#x629B;&#x51FA;&#x53BB;&#x7684;&#x5F02;&#x5E38;&#x672A;&#x88AB; <code>catch</code>&#xFF0C;&#x600E;&#x4E48;&#x529E;&#xFF1F;<br>&#x6211;&#x4EEC;&#x5148;&#x770B;&#x4E00;&#x4E0B;&#xFF0C;&#x672A;&#x88AB; <code>catch</code> &#x4F1A;&#x600E;&#x4E48;&#x6837;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;?php</span><br><span class="line">/* &#x8BA9;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x5728;&#x6807;&#x51C6;&#x8F93;&#x51FA;&#x53EF;&#x89C1; */</span><br><span class="line">ini_set(&quot;display_errors&quot;,&quot;On&quot;);</span><br><span class="line"></span><br><span class="line">throw new \Exception(&apos;I am an exception&apos;);</span><br><span class="line"></span><br><span class="line">echo &apos;I am here&apos; . PHP_EOL;</span><br></pre></td></tr></table></figure>

<p>&#x7ED3;&#x679C;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&#x279C;  answer git:(master) &#x2717; php throw.php</span><br><span class="line"></span><br><span class="line">Fatal error: Uncaught exception &apos;Exception&apos; with message &apos;I am an exception&apos; in /Users/javin/github/answer/throw.php:5</span><br><span class="line">Stack trace:</span><br><span class="line">#0 {main}</span><br><span class="line">  thrown in /Users/javin/github/answer/throw.php on line 5</span><br></pre></td></tr></table></figure>

<p>&#x4F1A;&#x51FA;&#x73B0; <code>&#x81F4;&#x547D;&#x9519;&#x8BEF;</code>&#xFF0C;&#x811A;&#x672C;&#x4E2D;&#x65AD;&#xFF0C;&#x90A3;&#x4E48;&#xFF0C;&#x6211;&#x4EEC;&#x5F53;&#x7136;&#x53EF;&#x4EE5;&#x7528;&#x4E0A;&#x8FB9;&#x6240;&#x8BF4;&#x7684; <code>register_shutdown_function</code>  &#x6765;&#x5904;&#x7406;&#x3002;<br>&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x5C31;&#x6CA1;&#x6709;&#x5408;&#x5176;&#x4ED6;&#x81F4;&#x547D;&#x9519;&#x8BEF;&#x533A;&#x5206;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#xFF0C;&#x6709;&#x6CA1;&#x6709;&#x4E13;&#x95E8;&#x5904;&#x7406;&#x672A;&#x6355;&#x83B7;&#x7684;&#x5F02;&#x5E38;&#x5462;&#xFF1F;<br>&#x7B54;&#x6848;&#x662F;&#x6709;&#x7684;&#xFF0C;&#x5B83;&#x5C31;&#x662F;&#xFF1A;<a href="/external_links/ea15ff112f0691c1ea476f3b8b24ee4b.html" target="blank" rel="noopener">set_exception_handler</a></p>
<p>&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;?php</span><br><span class="line">/* &#x8BA9;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x5728;&#x6807;&#x51C6;&#x8F93;&#x51FA;&#x53EF;&#x89C1; */</span><br><span class="line">ini_set(&quot;display_errors&quot;,&quot;On&quot;);</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * &#x56DE;&#x8C03;&#x51FD;&#x6570;&#x7B7E;&#x540D;&#xFF1A;void handler ( Exception $ex )</span><br><span class="line"> */</span><br><span class="line">set_exception_handler(function ($e) {</span><br><span class="line">    echo sprintf(&quot;This is exception, msg:%s\n&quot;, $e-&gt;getMessage());</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">throw new \Exception(&apos;I am an exception&apos;);</span><br><span class="line">echo &apos;I am here&apos; . PHP_EOL;</span><br></pre></td></tr></table></figure>

<p>&#x7ED3;&#x679C;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&#x279C;  answer git:(master) &#x2717; php throw.php</span><br><span class="line">This is exception, msg:I am an exception</span><br></pre></td></tr></table></figure>

<p>&#x7ED3;&#x8BBA;&#xFF1A;<code>set_exception_handler</code> &#x53EF;&#x4EE5;&#x5BF9;&#x672A;&#x6355;&#x83B7;&#x7684;&#x5F02;&#x5E38;&#x8FDB;&#x884C;&#x5904;&#x7406;&#xFF0C;&#x4F46;&#x662F;&#x811A;&#x672C;&#x4ECD;&#x7136;&#x4F1A;&#x56E0;&#x4E3A;&#x81F4;&#x547D;&#x9519;&#x8BEF;&#x800C;&#x4E2D;&#x65AD;&#x3002;</p>
<hr>
<h2 id="&#x7ED3;&#x5C3E;"><a href="#&#x7ED3;&#x5C3E;" class="headerlink" title="&#x7ED3;&#x5C3E;"></a>&#x7ED3;&#x5C3E;</h2><p>&#x672C;&#x6587;&#x5BF9; <code>&#x5F02;&#x5E38;&#x5904;&#x7406;</code> &#x505A;&#x4E86;&#x7B80;&#x8981;&#x7684;&#x603B;&#x7ED3;&#xFF0C;&#x5176;&#x4E2D;&#x6D89;&#x53CA;&#x5230;&#x4E09;&#x4E2A;&#x6838;&#x5FC3;&#x65B9;&#x6CD5; <code>set_error_handler</code> <code>register_shutdown_function</code> <code>set_exception_handler</code>&#xFF0C;&#x5176;&#x8BE6;&#x7EC6;&#x8BF4;&#x660E;&#xFF0C;&#x8BF7;&#x53C2;&#x89C1; <a href="/external_links/b6e84eae6d0632fddab1d901c667d2ae.html" target="blank" rel="noopener">&#x5B98;&#x65B9;&#x624B;&#x518C;</a> &#x3002;<br>&#x540C;&#x65F6; <code>PHP-7</code> &#x4E2D;&#x4E5F;&#x6709;&#x4E00;&#x4E9B;&#x65B0;&#x7684;&#x7279;&#x6027;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A; <a href="/external_links/448a4632f9014044f54e4cdf904a68d1.html" target="blank" rel="noopener">Error &#x7C7B;</a> </p>
<p>&#x53C2;&#x8003;&#xFF1A;<a href="/external_links/e6c09528865131657ebd3d567d7ab9e1.html" target="blank" rel="noopener">PHP 7 &#x9519;&#x8BEF;&#x5904;&#x7406;</a></p>
<p>&#x6700;&#x540E;&#xFF0C;&#x5F3A;&#x70C8;&#x5EFA;&#x8BAE;&#x5F00;&#x542F;&#x7F16;&#x8F91;&#x5668;&#x7684; <code>&#x8BED;&#x6CD5;&#x68C0;&#x67E5;</code> &#x529F;&#x80FD;&#xFF0C;&#x4E0D;&#x7BA1;&#x662F; <code>IDE</code>&#xFF0C;&#x8FD8;&#x662F; <code>GUI &#x6587;&#x672C;&#x7F16;&#x8F91;&#x5668;</code>&#xFF0C;&#x8FD8;&#x662F; <code>vim</code>&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x907F;&#x514D;&#x5F88;&#x591A;&#x4E0D;&#x5FC5;&#x8981;&#x7684;&#x9519;&#x8BEF;&#x3002;&#x5982;&#x679C;&#x6709;&#x4F7F;&#x7528;&#x7248;&#x672C;&#x63A7;&#x5236;&#xFF0C;&#x53EF;&#x4EE5;&#x7ED9;&#x5BF9;&#x5E94;&#x7684;&#x8F6F;&#x4EF6;&#x52A0;&#x4E0A; <code>&#x8BED;&#x6CD5;&#x68C0;&#x67E5;</code> &#x7684;&#x94A9;&#x5B50;&#x3002;</p>
<p>&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#xFF1A;</p>
<ul>
<li><a href="/external_links/6d6bcb7ec3d02d1f961360976acb1cb5.html" target="blank" rel="noopener">&#x6211;&#x7684; vim-&#x914D;&#x7F6E;</a></li>
<li><a href="/external_links/9c6ee87ba57c44e70c0481417508a4d0.html" target="blank" rel="noopener">&#x81EA;&#x52A8;&#x5316;&#x68C0;&#x6D4B;PHP&#x8BED;&#x6CD5;&#x548C;&#x7F16;&#x7A0B;&#x89C4;&#x8303;(Git pre-commit)</a></li>
</ul>
<hr>
<p>&#x4EE5;&#x4E0A;&#x5982;&#x6709;&#x9519;&#x8BEF;&#xFF0C;&#x8BF7;&#x591A;&#x591A;&#x6307;&#x6B63;&#x3002;&#x5982;&#x6709;&#x9057;&#x6F0F;&#xFF0C;&#x8BF7;&#x591A;&#x591A;&#x8865;&#x5145;&#x3002;&#x1F64F;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/9f11cbc5d8cbc6980849f9779c6a7f2a.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903516889153543.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903516889153543.html" itemprop="url">【英】 使用 Rust 来写原生 Nodejs 模块</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-27T14:18:36+08:00">
                2017-11-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>TL:DR - Use Rust instead of C++ to write native Node.js modules!</p>
</blockquote>
<p>RisingStack faced a shocking event last year: we reached the maximum speed that Node.js had to offer at the time, while our server costs went over the roof. To increase the performance of our application (and decrease our costs), we decided to<br> completely rewrite it, and migrate our system to a different infrastructure - which was a lot of work, needless to say.</p>
<p>I figured out later that <strong>we could have just implemented a native module instead!</strong></p>
<p>Back then, we weren&#x2019;t aware that there was a better method to solve our performance issue. Just a few weeks ago I found out that another option could have been available. <strong>That&#x2019;s when I picked up Rust instead of C++ to implement a native module.</strong> I figured out that it is a great choice thanks to the safety and ease of use it provides.</p>
<blockquote>
<p>In this Rust tutorial, I&#x2019;m going to walk you through the steps of writing a modern, fast and safe native module.</p>
</blockquote>
<h2 id="The-Problem-with-our-Node-js-Server-Speed"><a href="#The-Problem-with-our-Node-js-Server-Speed" class="headerlink" title="The Problem with our Node.js Server Speed"></a>The Problem with our Node.js Server Speed</h2><p>Our issue began in late 2016 when we&#x2019;ve been working on Trace, our Node.js monitoring product, which was recently merged with <a href="/external_links/2f665d1d3e75cc1b123978eadbcf2392.html" target="blank" rel="noopener">Keymetrics</a> in October 2017.</p>
<p>Like every other tech startup at the time, we&#x2019;ve been running our services on Heroku to spare some expenses on infrastructure costs and maintenance. We&#x2019;ve been building a microservice architecture application, which meant that our services have<br> been communicating a lot over HTTP(S).</p>
<p><strong>This is where the tricky part comes in:</strong> we wanted to communicate securely between the services, but Heroku did not offer private networking, so we had to implement our own solution. Therefore, we looked into a few solutions for<br> authentication, and the one we eventually settled with was http signatures.</p>
<blockquote>
<p>To explain it briefly; http signatures are based on public-key cryptography. To create an http signature, you take all parts of a request: the URL, the body and the headers and you sign them with your private key. Then, you can give your public<br> key to those who would receive your signed requests so they can validate them.</p>
</blockquote>
<p>Time passed by and we noticed that CPU utilization went over the roof in most of our http server processes. We suspected an obvious reason - if you&#x2019;re doing crypto, it&#x2019;s like that all the time.</p>
<p>However, after doing some serious profiling with the <a href="/external_links/b213dc8a4be5fe97b513bf2ae8b1dc76.html" target="blank" rel="noopener">v8-profiler</a> we figured out that it actually wasn&#x2019;t the crypto! It was the <a href="/external_links/26c4859035d4a73990a3ce76cbdd0dcf.html" target="blank" rel="noopener">URL parsing</a> that took the most CPU time. Why? Because to do the authentication, we had to parse the URL to validate request signatures.</p>
<p>To solve this issue, we decided to leave Heroku (what we wanted to do for other reasons too), and create a Google Cloud infrastructure with Kubernetes &amp; internal networking - instead of optimizing our URL parsing.</p>
<p>The reason for writing this story/tutorial is that just a few weeks ago I realized that we could have optimized URL parsing in an other way - by writing a native library with Rust.</p>
<h2 id="Naive-developer-going-native-the-need-for-a-Rust-module"><a href="#Naive-developer-going-native-the-need-for-a-Rust-module" class="headerlink" title="Naive developer going native - the need for a Rust module"></a>Naive developer going native - the need for a Rust module</h2><p><strong>It shouldn&#x2019;t be that hard to write native code, right?</strong></p>
<p>Here at RisingStack, we&#x2019;ve always said that we want to use the right tool for the job. To do so, we&#x2019;re always doing research to create better software, including some on C++ native modules when necessary.</p>
<blockquote>
<p>Shameless plug: I&#x2019;ve written a blogpost about my learning <a href="/external_links/aef538e0bd9a11b85c9e696e62001523.html" target="blank" rel="noopener">journey on native Node.js modules</a> too. Take a look!</p>
</blockquote>
<p>Back then I thought that in most cases C++ is the right way to write fast and efficient software.. However, as now we have modern tooling at our disposal (in this example - Rust), we can use it to write more efficient, safe and fast code with<br> much less effort than it ever required.</p>
<p>Let&#x2019;s get back to our initial problem: parsing an URL shouldn&#x2019;t be that hard right? It contains a protocol, host, query parameters&#x2026;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/b58cf7ebfba209d7613a2cb14ca5794e66b721587ef3a720b29d77a66a852cd2" alt="URL-parsing-protocol">)<br> (Source the <a href="/external_links/ef28912e9f7f98c4e0b99c3f5fb8ce31.html" target="blank" rel="noopener">Node.js documentation</a>)</p>
<p>That looks pretty complex. After reading through <a href="/external_links/aab83c91b5866f6ed0e30644b207a5ee.html" target="blank" rel="noopener">the URL standard</a> I figured out that I don&#x2019;t want to implement it myself, so I started to look for alternatives.</p>
<p>I thought that surely I&#x2019;m not the only person who wants to parse URLs. Browsers probably have already solved this issue, so I checked out chromium&#x2019;s solution: <a href="/external_links/8a97b990a45229638b90cb571411e73d.html" target="blank" rel="noopener">google-url</a>. While<br> that implementation can be easily called from Node.js using the N-API, I have a few reasons not to do so:</p>
<ul>
<li><strong>Updates:</strong> when I just copy-paste some code from the internet I immediately get the feeling of danger. People have been doing it for a long time, and there are so many reasons it didn&#x2019;t work out so well.. There is just no easy<br>way of updating a huge block of code that is sitting in my repository.</li>
<li><strong>Safety:</strong> a person with not so much C++ experience cannot validate that the code is right, but we&#x2019;ll eventually have to run it on our servers. C++ has a steep learning curve, and it takes a long time to master it.</li>
<li><strong>Security:</strong> we all heard about exploitable C++ code that is out there, which I&#x2019;d rather avoid because I have no way to audit it myself. Using well maintained open-source modules gives me enough confidence to not worry about<br>security.</li>
</ul>
<p><strong>So I&#x2019;d much prefer a more approachable language, with an easy to use update mechanism and modern tooling: Rust!</strong></p>
<h2 id="A-few-words-about-Rust"><a href="#A-few-words-about-Rust" class="headerlink" title="A few words about Rust"></a>A few words about Rust</h2><p>Rust allows us to write fast and efficient code.</p>
<p>All of the Rust projects are managed with <code>cargo</code> - think about it as <code>npm</code> for Rust. Project dependencies can be installed with <code>cargo</code>, and there is a registry full of packages waiting for you to use.</p>
<p>I found a library which we can use in this example - <a href="/external_links/d521858702048b73a9df0a887adcdc8a.html" target="blank" rel="noopener">rust-url</a>, so shout out to the Servo team for their work.</p>
<p>We&#x2019;re going to use Rust FFI too! We had already covered <a href="/external_links/c610e33986ef7c460f92119625d8da1a.html" target="blank" rel="noopener">using Rust FFI with Node.js</a> in a previous blogpost two years ago. Since then quite a lot has<br> changed in the Rust ecosystem.</p>
<p>We have a supposedly working library (rust-url), so let&#x2019;s try to build it!</p>
<h3 id="How-do-I-build-a-Rust-app"><a href="#How-do-I-build-a-Rust-app" class="headerlink" title="How do I build a Rust app?"></a>How do I build a Rust app?</h3><p>After following instructions on <a href="/external_links/bbb4a03070c2d27c521baa8cb3666f0c.html" target="blank" rel="noopener">rustup.rs</a>, we can have a working <code>rustc</code> compiler, but all we should care about now is <code>cargo</code>. I don&#x2019;t want to go into much detail about how it works,<br> so please check out our <a href="/external_links/c610e33986ef7c460f92119625d8da1a.html" target="blank" rel="noopener">previous Rust blogpost</a> if you&#x2019;re interested.</p>
<h3 id="Creating-a-new-Rust-Project"><a href="#Creating-a-new-Rust-Project" class="headerlink" title="Creating a new Rust Project"></a>Creating a new Rust Project</h3><p>Creating a new Rust project is as simple as <code>cargo new --lib &lt;projectname&gt;</code>.</p>
<blockquote>
<p>You can check out all of the code in my example repository <a href="/external_links/31c86469d20452767e271b4aa628828e.html" target="blank" rel="noopener">github.com/peteyy/rust&#x2026;</a></p>
</blockquote>
<p>To use the Rust library that we have, we can just list it as a dependency in our <code>Cargo.toml</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">[package]</span><br><span class="line">name = &quot;ffi&quot;</span><br><span class="line">version = &quot;1.0.0&quot;</span><br><span class="line">authors = [&quot;Peter Czibik &lt;p.czibik@gmail.com&gt;&quot;]</span><br><span class="line"></span><br><span class="line">[dependencies]</span><br><span class="line">url = &quot;1.6&quot;</span><br></pre></td></tr></table></figure>

<p>There is no short (built in) form for adding a dependency as you do with <code>npm install</code> - you have to manually add it yourself. However, there is a crate called <a href="/external_links/12352f8d9669365694f413e8c5c8becb.html" target="blank" rel="noopener"><code>cargo edit</code></a> that adds a similar functionality.</p>
<h3 id="Rust-FFI"><a href="#Rust-FFI" class="headerlink" title="Rust FFI"></a>Rust FFI</h3><p>To be able to use Rust modules from Node.js, we can use the FFI provided by Rust. FFI is a short-term for Foreign Function Interface. Foreign function interface (FFI) is a mechanism by which a program written in one programming language can call<br> routines or make use of services written in another.</p>
<p>To be able to link to our library we have to add two things to <code>Cargo.toml</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">[lib]</span><br><span class="line">crate-type = [&quot;dylib&quot;]</span><br><span class="line"></span><br><span class="line">[dependencies]</span><br><span class="line">libc = &quot;0.2&quot;</span><br><span class="line">url = &quot;1.6&quot;</span><br></pre></td></tr></table></figure>

<p>We have to declare that our library is a dynamic library. A file ending with the extension <code>.dylib</code> is a dynamic library: it&#x2019;s a library that&#x2019;s loaded at runtime instead of at compile time.</p>
<p>We will also have to link our program against <code>libc</code>. <code>libc</code> is the standard library for the C programming language, as specified in the ANSI C standard.</p>
<p>The <code>libc</code> crate is a Rust library with native bindings to the types and functions commonly found on various systems, including libc. This allows us to use C types from our Rust code, which we will have to do if we&#x2019;d like to accept<br> or return anything from our Rust functions. :)</p>
<p>Our code is fairly simple - I&#x2019;m using the <code>url</code> and <code>libc</code> crate with the <code>extern crate</code> keyword. To expose this to the outer world through FFI, it is important to mark our function as <code>pub extern</code>.<br> Our function takes a <code>c_char</code> pointer which represents the <code>String</code> types coming from Node.js.</p>
<p>We need to mark our conversion as <code>unsafe</code>. A block of code that is prefixed with the unsafe keyword is used to permit calling unsafe functions or dereferencing raw pointers within a safe function.</p>
<p>Rust uses the <code>Option&lt;T&gt;</code> type to represent a value that can be empty. Think of it as a value that can be <code>null</code> or <code>undefined</code> in your JavaScript. You can (and should) explicitly check every time you try<br> to access a value that can be null. There are a few ways to address this in Rust, but this time I&#x2019;m going with the simplest method: <a href="/external_links/86589928b758927575ab97dc0cc5819e.html" target="blank" rel="noopener"><code>unwrap</code></a> which<br> will simply throw an error (panic in Rust terms) if the value is not present.</p>
<p>When the URL parsing is done, we have to convert it to a <code>CString</code>, that can be passed back to JavaScript.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">extern crate libc;</span><br><span class="line">extern crate url;</span><br><span class="line"></span><br><span class="line">use std::ffi::{CStr,CString};</span><br><span class="line">use url::{Url};</span><br><span class="line"></span><br><span class="line">#[no_mangle]</span><br><span class="line">pub extern &quot;C&quot; fn get_query (arg1: *const libc::c_char) -&gt; *const libc::c_char {</span><br><span class="line"></span><br><span class="line">    let s1 = unsafe { CStr::from_ptr(arg1) };</span><br><span class="line"></span><br><span class="line">    let str1 = s1.to_str().unwrap();</span><br><span class="line"></span><br><span class="line">    let parsed_url = Url::parse(</span><br><span class="line">        str1</span><br><span class="line">    ).unwrap();</span><br><span class="line"></span><br><span class="line">    CString::new(parsed_url.query().unwrap().as_bytes()).unwrap().into_raw()</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>To build this Rust code, you can use <code>cargo build --release</code> command. Before compilation, make sure you add the <code>url</code> library to your list of dependencies in <code>Cargo.toml</code> for this project too!</p>
<p>We can use the <code>ffi</code> Node.js package to create a module that exposes the Rust code.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">const path = require(&apos;path&apos;);</span><br><span class="line">const ffi = require(&apos;ffi&apos;);</span><br><span class="line"></span><br><span class="line">const library_name = path.resolve(__dirname, &apos;./target/release/libffi&apos;);</span><br><span class="line">const api = ffi.Library(library_name, {</span><br><span class="line">  get_query: [&apos;string&apos;, [&apos;string&apos;]]</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">module.exports = {</span><br><span class="line">  getQuery: api.get_query</span><br><span class="line">};</span><br></pre></td></tr></table></figure>

<p>The naming convention is <code>lib*</code>, where <code>*</code> is the name of your library, for the <code>.dylib</code> file that <code>cargo build --release</code> builds.</p>
<p>This is great; we have a working Rust code that we called from Node.js! It works, but you can already see that we had to do a bunch of conversion between the types, which can add a bit of an overhead to our function calls. There should be a much<br> better way to integrate our code with JavaScript.</p>
<h2 id="Meet-Neon"><a href="#Meet-Neon" class="headerlink" title="Meet Neon"></a>Meet Neon</h2><blockquote>
<p>Rust bindings for writing safe and fast native Node.js modules.</p>
</blockquote>
<p>Neon allows us to use JavaScript types in our Rust code. To create a new Neon project, we can use their own cli. Use <code>npm install neon-cli --global</code> to install it.</p>
<p><code>neon new &lt;projectname&gt;</code> will create a new neon project with zero configuration.</p>
<p>With our neon project done, we can rewrite the code from above as the following:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">#[macro_use]</span><br><span class="line">extern crate neon;</span><br><span class="line"></span><br><span class="line">extern crate url;</span><br><span class="line"></span><br><span class="line">use url::{Url};</span><br><span class="line">use neon::vm::{Call, JsResult};</span><br><span class="line">use neon::js::{JsString, JsObject};</span><br><span class="line"></span><br><span class="line">fn get_query(call: Call) -&gt; JsResult&lt;JsString&gt; {</span><br><span class="line">    let scope = call.scope;</span><br><span class="line">    let url = call.arguments.require(scope, 0)?.check::&lt;JsString&gt;()?.value();</span><br><span class="line"></span><br><span class="line">    let parsed_url = Url::parse(</span><br><span class="line">        &amp;url</span><br><span class="line">    ).unwrap();</span><br><span class="line"></span><br><span class="line">    Ok(JsString::new(scope, parsed_url.query().unwrap()).unwrap())</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">register_module!(m, {</span><br><span class="line">    m.export(&quot;getQuery&quot;, get_query)</span><br><span class="line">});</span><br></pre></td></tr></table></figure>

<p>Those new types that we&#x2019;re using on the top <code>JsString</code>, <code>Call</code> and <code>JsResult</code> are wrappers for JavaScript types that allows us to hook into the JavaScript VM and execute code on top of it. The <code>Scope</code> allows us to bind our new variables to existing JavaScript scopes, so our variables can be garbage collected.</p>
<p>This is much like <a href="/external_links/aef538e0bd9a11b85c9e696e62001523.html" target="blank" rel="noopener">writing native Node.js modules in C++</a> which I&#x2019;ve explained in a previous blogpost.</p>
<p>Notice the <code>#[macro_use]</code> attribute that allows us to use the <code>register_module!</code> macro, which allows us to create modules just like in Node.js <code>module.exports</code>.</p>
<p>The only tricky part here is accessing arguments:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;let url = call.arguments.require(scope, 0)?.check::&lt;JsString&gt;()?.value();</span><br></pre></td></tr></table></figure>

<p>We have to accept all kinds of arguments (as any other JavaScript function does) so we cannot be sure if the function was called with single or multiple arguments. That is why we have to check for the first element&#x2019;s existence.</p>
<p>Other than that change, we can get rid of most of the serialization and just use <code>Js</code> types directly.</p>
<p><strong>Now let&#x2019;s try to run them!</strong></p>
<p>If you downloaded my example first, you have to go into the ffi folder and do a <code>cargo build --release</code> and then into the neon folder and (with previously globally installed neon-cli) run <code>neon build</code>.</p>
<p>If you&#x2019;re ready, you can use Node.js to generate a new list of urls with the <a href="/external_links/36c46f650378c8f33bd3e584d8641fd2.html" target="blank" rel="noopener">faker library</a>.</p>
<p>Run the <code>node generateUrls.js</code> command which will place a <code>urls.json</code> file in your folder, what our tests will read and try to parse. When that is ready, you can run the &#x201C;benchmarks&#x201D; with <code>node urlParser.js</code>. If<br> everything was successful, you should see something like this:</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/cebc89aa2dd1621c385ccc61ab2c89c323ec0ea141b4067f4f0fe1ac499db967" alt="Rust-Node-js-success-screen"></p>
<p>This test was done with 100 URLs (randomly generated) and our app parsed them only once to give a result. If you&#x2019;d like to benchmark parsing, increase the number (<code>tryCount</code> in urlParser.js) of URLs or the number of times (<code>urlLength</code> in urlGenerator.js).</p>
<p>You can see the winner in my benchmark is the Rust neon version, but as the length of the array increases, there will be more optimization V8 can do, and they will get closer. Eventually, it will surpass the Rust neon implementation.</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/8338b73f80299e2d23f0aa2865087767f3d8f24b4ce370cd876d966d589c523c" alt="Rust-node-js-benchmark"></p>
<p>This was just a simple example, so of course, there is much to learn for us in this field,</p>
<p>We can further optimize this calculation in the future, potentially utilizing concurrency libraries provided by some crates like <a href="/external_links/75835a7c91499b8f306ed80d10d79b88.html" target="blank" rel="noopener"><code>rayon</code></a>.</p>
<h2 id="Implementing-Rust-modules-in-Node-js"><a href="#Implementing-Rust-modules-in-Node-js" class="headerlink" title="Implementing Rust modules in Node.js"></a>Implementing Rust modules in Node.js</h2><p>Hopefully, you&#x2019;ve also learned something today about implementing Rust modules in Node.js along with me, and you can benefit from a new tool in your toolchain from now on. I wanted to demonstrate that while this is possible (and fun), it is not<br> a silver bullet that will solve all of the performance problems.</p>
<p><strong>Just keep in mind that knowing Rust may come handy in certain situations.</strong></p>
<p><em>If you have any questions or comments, let me know in the section below - I&#x2019;ll be here to answer them!</em></p>
<p><a href="/external_links/572b169d2fd3807ed2756ad24bef5e35.html" target="blank" rel="noopener">Follow @RisingStack</a></p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/d6411c7ab40f6d40dea2607875ea5554.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903516868198407.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903516868198407.html" itemprop="url">曲线点抽稀算法- Python 实现 何为抽稀 道格拉斯-普</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-27T13:50:10+08:00">
                2017-11-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="&#x4F55;&#x4E3A;&#x62BD;&#x7A00;"><a href="#&#x4F55;&#x4E3A;&#x62BD;&#x7A00;" class="headerlink" title="&#x4F55;&#x4E3A;&#x62BD;&#x7A00;"></a>&#x4F55;&#x4E3A;&#x62BD;&#x7A00;</h1><blockquote>
<p>&#x5728;&#x5904;&#x7406;&#x77E2;&#x91CF;&#x5316;&#x6570;&#x636E;&#x65F6;&#xFF0C;&#x8BB0;&#x5F55;&#x4E2D;&#x5F80;&#x5F80;&#x4F1A;&#x6709;&#x5F88;&#x591A;&#x91CD;&#x590D;&#x6570;&#x636E;&#xFF0C;&#x5BF9;&#x8FDB;&#x4E00;&#x6B65;&#x6570;&#x636E;&#x5904;&#x7406;&#x5E26;&#x6765;&#x8BF8;&#x591A;&#x4E0D;&#x4FBF;&#x3002;&#x591A;&#x4F59;&#x7684;&#x6570;&#x636E;&#x4E00;&#x65B9;&#x9762;&#x6D6A;&#x8D39;&#x4E86;&#x8F83;&#x591A;&#x7684;&#x5B58;&#x50A8;&#x7A7A;&#x95F4;&#xFF0C;&#x53E6;&#x4E00;&#x65B9;&#x9762;&#x9020;&#x6210;&#x6240;&#x8981;&#x8868;&#x8FBE;&#x7684;&#x56FE;&#x5F62;&#x4E0D;&#x5149;&#x6ED1;&#x6216;&#x4E0D;&#x7B26;&#x5408;&#x6807;&#x51C6;&#x3002;&#x56E0;&#x6B64;&#x8981;&#x901A;&#x8FC7;&#x67D0;&#x79CD;&#x89C4;&#x5219;&#xFF0C;&#x5728;&#x4FDD;&#x8BC1;&#x77E2;&#x91CF;&#x66F2;&#x7EBF;&#x5F62;&#x72B6;&#x4E0D;&#x53D8;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C; &#x6700;&#x5927;&#x9650;&#x5EA6;&#x5730;&#x51CF;&#x5C11;&#x6570;&#x636E;&#x70B9;&#x4E2A;&#x6570;&#xFF0C;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x79F0;&#x4E3A;&#x62BD;&#x7A00;&#x3002;</p>
</blockquote>
<p>&#x901A;&#x4FD7;&#x7684;&#x8BB2;&#x5C31;&#x662F;&#x5BF9;&#x66F2;&#x7EBF;&#x8FDB;&#x884C;&#x91C7;&#x6837;&#x7B80;&#x5316;&#xFF0C;&#x5373;&#x5728;&#x66F2;&#x7EBF;&#x4E0A;&#x53D6;&#x6709;&#x9650;&#x4E2A;&#x70B9;&#xFF0C;&#x5C06;&#x5176;&#x53D8;&#x4E3A;&#x6298;&#x7EBF;&#xFF0C;&#x5E76;&#x4E14;&#x80FD;&#x591F;&#x5728;&#x4E00;&#x5B9A;&#x7A0B;&#x5EA6;&#x4FDD;&#x6301;&#x539F;&#x6709;&#x5F62;&#x72B6;&#x3002;&#x6BD4;&#x8F83;&#x5E38;&#x7528;&#x7684;&#x4E24;&#x79CD;&#x62BD;&#x7A00;&#x7B97;&#x6CD5;&#x662F;&#xFF1A;&#x9053;&#x683C;&#x62C9;&#x65AF;-&#x666E;&#x514B;(Douglas-Peuker)&#x7B97;&#x6CD5;&#x548C;&#x5782;&#x8DDD;&#x9650;&#x503C;&#x6CD5;&#x3002;</p>
<h1 id="&#x9053;&#x683C;&#x62C9;&#x65AF;-&#x666E;&#x514B;-Douglas-Peuker-&#x7B97;&#x6CD5;"><a href="#&#x9053;&#x683C;&#x62C9;&#x65AF;-&#x666E;&#x514B;-Douglas-Peuker-&#x7B97;&#x6CD5;" class="headerlink" title="&#x9053;&#x683C;&#x62C9;&#x65AF;-&#x666E;&#x514B;(Douglas-Peuker)&#x7B97;&#x6CD5;"></a>&#x9053;&#x683C;&#x62C9;&#x65AF;-&#x666E;&#x514B;(Douglas-Peuker)&#x7B97;&#x6CD5;</h1><p>Douglas-Peuker&#x7B97;&#x6CD5;(DP&#x7B97;&#x6CD5;)&#x8FC7;&#x7A0B;&#x5982;&#x4E0B;:</p>
<ul>
<li>1&#x3001;&#x8FDE;&#x63A5;&#x66F2;&#x7EBF;&#x9996;&#x5C3E;&#x4E24;&#x70B9;A&#x3001;B&#xFF1B;</li>
<li>2&#x3001;&#x4F9D;&#x6B21;&#x8BA1;&#x7B97;&#x66F2;&#x7EBF;&#x4E0A;&#x6240;&#x6709;&#x70B9;&#x5230;A&#x3001;B&#x4E24;&#x70B9;&#x6240;&#x5728;&#x66F2;&#x7EBF;&#x7684;&#x8DDD;&#x79BB;&#xFF1B;</li>
<li>3&#x3001;&#x8BA1;&#x7B97;&#x6700;&#x5927;&#x8DDD;&#x79BB;D&#xFF0C;&#x5982;&#x679C;D&#x5C0F;&#x4E8E;&#x9608;&#x503C;threshold,&#x5219;&#x53BB;&#x6389;&#x66F2;&#x7EBF;&#x4E0A;&#x51FA;A&#x3001;B&#x5916;&#x7684;&#x6240;&#x6709;&#x70B9;&#xFF1B;&#x5982;&#x679C;D&#x5927;&#x4E8E;&#x9608;&#x503C;threshold,&#x5219;&#x628A;&#x66F2;&#x7EBF;&#x4EE5;&#x6700;&#x5927;&#x8DDD;&#x79BB;&#x5206;&#x5272;&#x6210;&#x4E24;&#x6BB5;&#xFF1B;</li>
<li>4&#x3001;&#x5BF9;&#x6240;&#x6709;&#x66F2;&#x7EBF;&#x5206;&#x6BB5;&#x91CD;&#x590D;1-3&#x6B65;&#x9AA4;&#xFF0C;&#x77E5;&#x9053;&#x6240;&#x6709;D&#x5747;&#x5C0F;&#x4E8E;&#x9608;&#x503C;&#x3002;&#x5373;&#x5B8C;&#x6210;&#x62BD;&#x7A00;&#x3002;</li>
</ul>
<p>&#x8FD9;&#x79CD;&#x7B97;&#x6CD5;&#x7684;&#x62BD;&#x7A00;&#x7CBE;&#x5EA6;&#x4E0E;&#x9608;&#x503C;&#x6709;&#x5F88;&#x5927;&#x5173;&#x7CFB;&#xFF0C;&#x9608;&#x503C;&#x8D8A;&#x5927;&#xFF0C;&#x7B80;&#x5316;&#x7A0B;&#x5EA6;&#x8D8A;&#x5927;&#xFF0C;&#x70B9;&#x51CF;&#x5C11;&#x7684;&#x8D8A;&#x591A;&#xFF1B;&#x53CD;&#x4E4B;&#x7B80;&#x5316;&#x7A0B;&#x5EA6;&#x8D8A;&#x4F4E;&#xFF0C;&#x70B9;&#x4FDD;&#x7559;&#x7684;&#x8D8A;&#x591A;&#xFF0C;&#x5F62;&#x72B6;&#x4E5F;&#x8D8A;&#x8D8B;&#x4E8E;&#x539F;&#x66F2;&#x7EBF;&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x662F;Python&#x4EE3;&#x7801;&#x5B9E;&#x73B0;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;# -*- coding: utf-8 -*-</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">-------------------------------------------------</span><br><span class="line">&#xA0;&#xA0;File Name&#xFF1A;&#xA0;&#xA0;&#xA0;&#xA0;DouglasPeuker</span><br><span class="line">&#xA0;&#xA0;Description :&#xA0;&#xA0;&#x9053;&#x683C;&#x62C9;&#x65AF;-&#x666E;&#x514B;&#x62BD;&#x7A00;&#x7B97;&#x6CD5;</span><br><span class="line">&#xA0;&#xA0;Author :&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;J_hao</span><br><span class="line">&#xA0;&#xA0;date&#xFF1A;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;2017/8/16</span><br><span class="line">-------------------------------------------------</span><br><span class="line">&#xA0;&#xA0;Change Activity:</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;2017/8/16: &#x9053;&#x683C;&#x62C9;&#x65AF;-&#x666E;&#x514B;&#x62BD;&#x7A00;&#x7B97;&#x6CD5;</span><br><span class="line">-------------------------------------------------</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">from __future__ import division</span><br><span class="line">&#xA0;</span><br><span class="line">from math import sqrt, pow</span><br><span class="line">&#xA0;</span><br><span class="line">__author__ = &apos;J_hao&apos;</span><br><span class="line">&#xA0;</span><br><span class="line">THRESHOLD = 0.0001&#xA0;&#xA0;# &#x9608;&#x503C;</span><br><span class="line">&#xA0;</span><br><span class="line">&#xA0;</span><br><span class="line">def point2LineDistance(point_a, point_b, point_c):</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&quot;&quot;&quot;</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#x8BA1;&#x7B97;&#x70B9;a&#x5230;&#x70B9;b c&#x6240;&#x5728;&#x76F4;&#x7EBF;&#x7684;&#x8DDD;&#x79BB;</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;:param point_a:</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;:param point_b:</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;:param point_c:</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;:return:</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&quot;&quot;&quot;</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;# &#x9996;&#x5148;&#x8BA1;&#x7B97;b c &#x6240;&#x5728;&#x76F4;&#x7EBF;&#x7684;&#x659C;&#x7387;&#x548C;&#x622A;&#x8DDD;</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;if point_b[0] == point_c[0]:</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;return 9999999</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;slope = (point_b[1] - point_c[1]) / (point_b[0] - point_c[0])</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;intercept = point_b[1] - slope * point_b[0]</span><br><span class="line">&#xA0;</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;# &#x8BA1;&#x7B97;&#x70B9;a&#x5230;b c&#x6240;&#x5728;&#x76F4;&#x7EBF;&#x7684;&#x8DDD;&#x79BB;</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;distance = abs(slope * point_a[0] - point_a[1] + intercept) / sqrt(1 + pow(slope, 2))</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;return distance</span><br><span class="line">&#xA0;</span><br><span class="line">&#xA0;</span><br><span class="line">class DouglasPeuker(object):</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;def __init__(self):</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;self.threshold = THRESHOLD</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;self.qualify_list = list()</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;self.disqualify_list = list()</span><br><span class="line">&#xA0;</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;def diluting(self, point_list):</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&quot;&quot;&quot;</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#x62BD;&#x7A00;</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;:param point_list:&#x4E8C;&#x7EF4;&#x70B9;&#x5217;&#x8868;</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;:return:</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&quot;&quot;&quot;</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if len(point_list) &lt; 3:</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;self.qualify_list.extend(point_list[::-1])</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;else:</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;# &#x627E;&#x5230;&#x4E0E;&#x6536;&#x5C3E;&#x4E24;&#x70B9;&#x8FDE;&#x7EBF;&#x8DDD;&#x79BB;&#x6700;&#x5927;&#x7684;&#x70B9;</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;max_distance_index, max_distance = 0, 0</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;for index, point in enumerate(point_list):</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if index in [0, len(point_list) - 1]:</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;continue</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;distance = point2LineDistance(point, point_list[0], point_list[-1])</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if distance &gt; max_distance:</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;max_distance_index = index</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;max_distance = distance</span><br><span class="line">&#xA0;</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;# &#x82E5;&#x6700;&#x5927;&#x8DDD;&#x79BB;&#x5C0F;&#x4E8E;&#x9608;&#x503C;&#xFF0C;&#x5219;&#x53BB;&#x6389;&#x6240;&#x6709;&#x4E2D;&#x95F4;&#x70B9;&#x3002; &#x53CD;&#x4E4B;&#xFF0C;&#x5219;&#x5C06;&#x66F2;&#x7EBF;&#x6309;&#x6700;&#x5927;&#x8DDD;&#x79BB;&#x70B9;&#x5206;&#x5272;</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if max_distance &lt; self.threshold:</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;self.qualify_list.append(point_list[-1])</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;self.qualify_list.append(point_list[0])</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;else:</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;# &#x5C06;&#x66F2;&#x7EBF;&#x6309;&#x6700;&#x5927;&#x8DDD;&#x79BB;&#x7684;&#x70B9;&#x5206;&#x5272;&#x6210;&#x4E24;&#x6BB5;</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;sequence_a = point_list[:max_distance_index]</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;sequence_b = point_list[max_distance_index:]</span><br><span class="line">&#xA0;</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;for sequence in [sequence_a, sequence_b]:</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if len(sequence) &lt; 3 and sequence == sequence_b:</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;self.qualify_list.extend(sequence[::-1])</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;else:</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;self.disqualify_list.append(sequence)</span><br><span class="line">&#xA0;</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;def main(self, point_list):</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;self.diluting(point_list)</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;while len(self.disqualify_list) &gt; 0:</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;self.diluting(self.disqualify_list.pop())</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;print self.qualify_list</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;print len(self.qualify_list)</span><br><span class="line">&#xA0;</span><br><span class="line">&#xA0;</span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;d = DouglasPeuker()</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;d.main([[104.066228, 30.644527], [104.066279, 30.643528], [104.066296, 30.642528], [104.066314, 30.641529],</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[104.066332, 30.640529], [104.066383, 30.639530], [104.066400, 30.638530], [104.066451, 30.637531],</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[104.066468, 30.636532], [104.066518, 30.635533], [104.066535, 30.634533], [104.066586, 30.633534],</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[104.066636, 30.632536], [104.066686, 30.631537], [104.066735, 30.630538], [104.066785, 30.629539],</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[104.066802, 30.628539], [104.066820, 30.627540], [104.066871, 30.626541], [104.066888, 30.625541],</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[104.066906, 30.624541], [104.066924, 30.623541], [104.066942, 30.622542], [104.066960, 30.621542],</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[104.067011, 30.620543], [104.066122, 30.620086], [104.065124, 30.620021], [104.064124, 30.620022],</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[104.063124, 30.619990], [104.062125, 30.619958], [104.061125, 30.619926], [104.060126, 30.619894],</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[104.059126, 30.619895], [104.058127, 30.619928], [104.057518, 30.620722], [104.057625, 30.621716],</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[104.057735, 30.622710], [104.057878, 30.623700], [104.057984, 30.624694], [104.058094, 30.625688],</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[104.058204, 30.626682], [104.058315, 30.627676], [104.058425, 30.628670], [104.058502, 30.629667],</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[104.058518, 30.630667], [104.058503, 30.631667], [104.058521, 30.632666], [104.057664, 30.633182],</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[104.056664, 30.633174], [104.055664, 30.633166], [104.054672, 30.633289], [104.053758, 30.633694],</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[104.052852, 30.634118], [104.052623, 30.635091], [104.053145, 30.635945], [104.053675, 30.636793],</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[104.054200, 30.637643], [104.054756, 30.638475], [104.055295, 30.639317], [104.055843, 30.640153],</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[104.056387, 30.640993], [104.056933, 30.641830], [104.057478, 30.642669], [104.058023, 30.643507],</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[104.058595, 30.644327], [104.059152, 30.645158], [104.059663, 30.646018], [104.060171, 30.646879],</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[104.061170, 30.646855], [104.062168, 30.646781], [104.063167, 30.646823], [104.064167, 30.646814],</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[104.065163, 30.646725], [104.066157, 30.646618], [104.066231, 30.645620], [104.066247, 30.644621], ])</span><br></pre></td></tr></table></figure>

<h1 id="&#x5782;&#x8DDD;&#x9650;&#x503C;&#x6CD5;"><a href="#&#x5782;&#x8DDD;&#x9650;&#x503C;&#x6CD5;" class="headerlink" title="&#x5782;&#x8DDD;&#x9650;&#x503C;&#x6CD5;"></a>&#x5782;&#x8DDD;&#x9650;&#x503C;&#x6CD5;</h1><p>&#x5782;&#x8DDD;&#x9650;&#x503C;&#x6CD5;&#x5176;&#x5B9E;&#x548C;DP&#x7B97;&#x6CD5;&#x539F;&#x7406;&#x4E00;&#x6837;&#xFF0C;&#x4F46;&#x662F;&#x5782;&#x8DDD;&#x9650;&#x503C;&#x4E0D;&#x662F;&#x4ECE;&#x6574;&#x4F53;&#x89D2;&#x5EA6;&#x8003;&#x8651;&#xFF0C;&#x800C;&#x662F;&#x4F9D;&#x6B21;&#x626B;&#x63CF;&#x6BCF;&#x4E00;&#x4E2A;&#x70B9;&#xFF0C;&#x68C0;&#x67E5;&#x662F;&#x5426;&#x7B26;&#x5408;&#x8981;&#x6C42;&#x3002;</p>
<p>&#x7B97;&#x6CD5;&#x8FC7;&#x7A0B;&#x5982;&#x4E0B;:</p>
<ul>
<li>1&#x3001;&#x4EE5;&#x7B2C;&#x4E8C;&#x4E2A;&#x70B9;&#x5F00;&#x59CB;&#xFF0C;&#x8BA1;&#x7B97;&#x7B2C;&#x4E8C;&#x4E2A;&#x70B9;&#x5230;&#x524D;&#x4E00;&#x4E2A;&#x70B9;&#x548C;&#x540E;&#x4E00;&#x4E2A;&#x70B9;&#x6240;&#x5728;&#x76F4;&#x7EBF;&#x7684;&#x8DDD;&#x79BB;d&#xFF1B;</li>
<li>2&#x3001;&#x5982;&#x679C;d&#x5927;&#x4E8E;&#x9608;&#x503C;&#xFF0C;&#x5219;&#x4FDD;&#x7559;&#x7B2C;&#x4E8C;&#x4E2A;&#x70B9;&#xFF0C;&#x8BA1;&#x7B97;&#x7B2C;&#x4E09;&#x4E2A;&#x70B9;&#x5230;&#x7B2C;&#x4E8C;&#x4E2A;&#x70B9;&#x548C;&#x7B2C;&#x56DB;&#x4E2A;&#x70B9;&#x6240;&#x5728;&#x76F4;&#x7EBF;&#x7684;&#x8DDD;&#x79BB;d;&#x82E5;d&#x5C0F;&#x4E8E;&#x9608;&#x503C;&#x5219;&#x820D;&#x5F03;&#x7B2C;&#x4E8C;&#x4E2A;&#x70B9;&#xFF0C;&#x8BA1;&#x7B97;&#x7B2C;&#x4E09;&#x4E2A;&#x70B9;&#x5230;&#x7B2C;&#x4E00;&#x4E2A;&#x70B9;&#x548C;&#x7B2C;&#x56DB;&#x4E2A;&#x70B9;&#x6240;&#x5728;&#x76F4;&#x7EBF;&#x7684;&#x8DDD;&#x79BB;d;</li>
<li>3&#x3001;&#x4F9D;&#x6B21;&#x7C7B;&#x63A8;&#xFF0C;&#x76F4;&#x7EBF;&#x66F2;&#x7EBF;&#x4E0A;&#x5012;&#x6570;&#x7B2C;&#x4E8C;&#x4E2A;&#x70B9;&#x3002;</li>
</ul>
<p>&#x4E0B;&#x9762;&#x662F;Python&#x4EE3;&#x7801;&#x5B9E;&#x73B0;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;# -*- coding: utf-8 -*-</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">-------------------------------------------------</span><br><span class="line">&#xA0;&#xA0;File Name&#xFF1A;&#xA0;&#xA0;&#xA0;&#xA0;LimitVerticalDistance</span><br><span class="line">&#xA0;&#xA0;Description :&#xA0;&#xA0;&#x5782;&#x8DDD;&#x9650;&#x503C;&#x62BD;&#x7A00;&#x7B97;&#x6CD5;</span><br><span class="line">&#xA0;&#xA0;Author :&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;J_hao</span><br><span class="line">&#xA0;&#xA0;date&#xFF1A;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;2017/8/17</span><br><span class="line">-------------------------------------------------</span><br><span class="line">&#xA0;&#xA0;Change Activity:</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;2017/8/17:</span><br><span class="line">-------------------------------------------------</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">from __future__ import division</span><br><span class="line">&#xA0;</span><br><span class="line">from math import sqrt, pow</span><br><span class="line">&#xA0;</span><br><span class="line">__author__ = &apos;J_hao&apos;</span><br><span class="line">&#xA0;</span><br><span class="line">THRESHOLD = 0.0001&#xA0;&#xA0;# &#x9608;&#x503C;</span><br><span class="line">&#xA0;</span><br><span class="line">&#xA0;</span><br><span class="line">def point2LineDistance(point_a, point_b, point_c):</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&quot;&quot;&quot;</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#x8BA1;&#x7B97;&#x70B9;a&#x5230;&#x70B9;b c&#x6240;&#x5728;&#x76F4;&#x7EBF;&#x7684;&#x8DDD;&#x79BB;</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;:param point_a:</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;:param point_b:</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;:param point_c:</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;:return:</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&quot;&quot;&quot;</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;# &#x9996;&#x5148;&#x8BA1;&#x7B97;b c &#x6240;&#x5728;&#x76F4;&#x7EBF;&#x7684;&#x659C;&#x7387;&#x548C;&#x622A;&#x8DDD;</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;if point_b[0] == point_c[0]:</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;return 9999999</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;slope = (point_b[1] - point_c[1]) / (point_b[0] - point_c[0])</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;intercept = point_b[1] - slope * point_b[0]</span><br><span class="line">&#xA0;</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;# &#x8BA1;&#x7B97;&#x70B9;a&#x5230;b c&#x6240;&#x5728;&#x76F4;&#x7EBF;&#x7684;&#x8DDD;&#x79BB;</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;distance = abs(slope * point_a[0] - point_a[1] + intercept) / sqrt(1 + pow(slope, 2))</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;return distance</span><br><span class="line">&#xA0;</span><br><span class="line">&#xA0;</span><br><span class="line">class LimitVerticalDistance(object):</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;def __init__(self):</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;self.threshold = THRESHOLD</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;self.qualify_list = list()</span><br><span class="line">&#xA0;</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;def diluting(self, point_list):</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&quot;&quot;&quot;</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#x62BD;&#x7A00;</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;:param point_list:&#x4E8C;&#x7EF4;&#x70B9;&#x5217;&#x8868;</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;:return:</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&quot;&quot;&quot;</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;self.qualify_list.append(point_list[0])</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;check_index = 1</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;while check_index &lt; len(point_list) - 1:</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;distance = point2LineDistance(point_list[check_index],</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;self.qualify_list[-1],</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;point_list[check_index + 1])</span><br><span class="line">&#xA0;</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if distance &lt; self.threshold:</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;check_index += 1</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;else:</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;self.qualify_list.append(point_list[check_index])</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;check_index += 1</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;return self.qualify_list</span><br><span class="line">&#xA0;</span><br><span class="line">&#xA0;</span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;l = LimitVerticalDistance()</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;diluting = l.diluting([[104.066228, 30.644527], [104.066279, 30.643528], [104.066296, 30.642528], [104.066314, 30.641529],</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[104.066332, 30.640529], [104.066383, 30.639530], [104.066400, 30.638530], [104.066451, 30.637531],</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[104.066468, 30.636532], [104.066518, 30.635533], [104.066535, 30.634533], [104.066586, 30.633534],</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[104.066636, 30.632536], [104.066686, 30.631537], [104.066735, 30.630538], [104.066785, 30.629539],</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[104.066802, 30.628539], [104.066820, 30.627540], [104.066871, 30.626541], [104.066888, 30.625541],</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[104.066906, 30.624541], [104.066924, 30.623541], [104.066942, 30.622542], [104.066960, 30.621542],</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[104.067011, 30.620543], [104.066122, 30.620086], [104.065124, 30.620021], [104.064124, 30.620022],</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[104.063124, 30.619990], [104.062125, 30.619958], [104.061125, 30.619926], [104.060126, 30.619894],</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[104.059126, 30.619895], [104.058127, 30.619928], [104.057518, 30.620722], [104.057625, 30.621716],</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[104.057735, 30.622710], [104.057878, 30.623700], [104.057984, 30.624694], [104.058094, 30.625688],</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[104.058204, 30.626682], [104.058315, 30.627676], [104.058425, 30.628670], [104.058502, 30.629667],</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[104.058518, 30.630667], [104.058503, 30.631667], [104.058521, 30.632666], [104.057664, 30.633182],</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[104.056664, 30.633174], [104.055664, 30.633166], [104.054672, 30.633289], [104.053758, 30.633694],</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[104.052852, 30.634118], [104.052623, 30.635091], [104.053145, 30.635945], [104.053675, 30.636793],</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[104.054200, 30.637643], [104.054756, 30.638475], [104.055295, 30.639317], [104.055843, 30.640153],</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[104.056387, 30.640993], [104.056933, 30.641830], [104.057478, 30.642669], [104.058023, 30.643507],</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[104.058595, 30.644327], [104.059152, 30.645158], [104.059663, 30.646018], [104.060171, 30.646879],</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[104.061170, 30.646855], [104.062168, 30.646781], [104.063167, 30.646823], [104.064167, 30.646814],</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;[104.065163, 30.646725], [104.066157, 30.646618], [104.066231, 30.645620], [104.066247, 30.644621], ])</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;print len(diluting)</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;print(diluting)</span><br></pre></td></tr></table></figure>

<h1 id="&#x6700;&#x540E;"><a href="#&#x6700;&#x540E;" class="headerlink" title="&#x6700;&#x540E;"></a>&#x6700;&#x540E;</h1><p>&#x5176;&#x5B9E;DP&#x7B97;&#x6CD5;&#x548C;&#x5782;&#x8DDD;&#x9650;&#x503C;&#x6CD5;&#x539F;&#x7406;&#x4E00;&#x6837;&#xFF0C;DP&#x7B97;&#x6CD5;&#x662F;&#x4ECE;&#x6574;&#x4F53;&#x4E0A;&#x8003;&#x8651;&#x4E00;&#x6761;&#x5B8C;&#x6574;&#x7684;&#x66F2;&#x7EBF;&#xFF0C;&#x5B9E;&#x73B0;&#x65F6;&#x8F83;&#x5782;&#x8DDD;&#x9650;&#x503C;&#x6CD5;&#x590D;&#x6742;&#xFF0C;&#x4F46;&#x5782;&#x8DDD;&#x9650;&#x503C;&#x6CD5;&#x53EF;&#x80FD;&#x4F1A;&#x5728;&#x67D0;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#x5BFC;&#x81F4;&#x5C40;&#x90E8;&#x6700;&#x4F18;&#x3002;&#x53E6;&#x5916;&#x5728;&#x5B9E;&#x9645;&#x4F7F;&#x7528;&#x4E2D;&#x53D1;&#x73B0;&#x91C7;&#x7528;&#x70B9;&#x5230;&#x53E6;&#x5916;&#x4E24;&#x70B9;&#x6240;&#x5728;&#x76F4;&#x7EBF;&#x8DDD;&#x79BB;&#x7684;&#x65B9;&#x6CD5;&#x6765;&#x5224;&#x65AD;&#x504F;&#x79BB;&#xFF0C;&#x5728;&#x66F2;&#x7EBF;&#x5F27;&#x5EA6;&#x6BD4;&#x8F83;&#x5927;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x6BD4;&#x8F83;&#x51C6;&#x786E;&#x3002;&#x5982;&#x679C;&#x5728;&#x66F2;&#x7EBF;&#x5F27;&#x5EA6;&#x6BD4;&#x8F83;&#x5C0F;&#xFF0C;&#x5F2F;&#x66F2;&#x7A0B;&#x5EA6;&#x4E0D;&#x660E;&#x663E;&#x65F6;&#xFF0C;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x62BD;&#x7A00;&#x6548;&#x679C;&#x4E0D;&#x662F;&#x5F88;&#x7406;&#x60F3;&#xFF0C;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528;&#x4E09;&#x70B9;&#x6240;&#x56F4;&#x6210;&#x7684;&#x4E09;&#x89D2;&#x5F62;&#x9762;&#x79EF;&#x4F5C;&#x4E3A;&#x5224;&#x65AD;&#x6807;&#x51C6;&#x3002;&#x4E0B;&#x9762;&#x662F;&#x62BD;&#x7A00;&#x6548;&#x679C;:</p>
<p><a href="/external_links/9eb2c0532aee641f45e78063934df7e8.html" target="blank" rel="noopener"><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/de6ffe8540b80ef7ffae627e9a38181c17d9e6910145d974d3e640f066231149" alt="7164538"></a><br> <a href="/external_links/c4212a075490ceea0d50341af7778820.html" target="blank" rel="noopener"><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/debec9416b86c5c3776ab1c2cf42590b37947fe8bab5d000643b6d313ba8ce0e" alt="7164538"></a></p>
<p> 1 &#x8D5E;  1 &#x6536;&#x85CF;  <a href="#article-comment">&#x8BC4;&#x8BBA;</a> </p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/251493fdbfc4699db21f040e8367326f.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903516851421197.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903516851421197.html" itemprop="url">源码 并发一枝花之BlockingQueue 接口定义 实现</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-27T12:56:31+08:00">
                2017-11-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x4ECA;&#x5929;&#x6765;&#x4ECB;&#x7ECD;Java&#x5E76;&#x53D1;&#x7F16;&#x7A0B;&#x4E2D;&#x6700;&#x53D7;&#x6B22;&#x8FCE;&#x7684;&#x540C;&#x6B65;&#x7C7B;&#x2014;&#x2014;&#x582A;&#x79F0;&#x5E76;&#x53D1;&#x4E00;&#x679D;&#x82B1;&#x4E4B;BlockingQueue&#x3002;</p>
<blockquote>
<p>JDK&#x7248;&#x672C;&#xFF1A;oracle java 1.8.0_102</p>
</blockquote>
<p>&#x7EE7;&#x7EED;&#x9605;&#x8BFB;&#x4E4B;&#x524D;&#xFF0C;&#x9700;<strong>&#x786E;&#x4FDD;&#x4F60;&#x5BF9;&#x9501;&#x548C;&#x6761;&#x4EF6;&#x961F;&#x5217;&#x7684;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#x70C2;&#x719F;&#x4E8E;&#x5FC3;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x6761;&#x4EF6;&#x961F;&#x5217;</strong>&#xFF0C;&#x5426;&#x5219;&#x4F60;&#x53EF;&#x80FD;&#x65E0;&#x6CD5;&#x7406;&#x89E3;&#x4EE5;&#x4E0B;&#x6E90;&#x7801;&#x7684;&#x7CBE;&#x5999;&#x4E4B;&#x5904;&#xFF0C;&#x751A;&#x81F3;&#x57FA;&#x672C;&#x7684;&#x6B63;&#x786E;&#x6027;&#x3002;&#x672C;&#x7BC7;&#x6682;&#x4E0D;&#x6D89;&#x53CA;&#x6B64;&#x90E8;&#x5206;&#x5185;&#x5BB9;&#xFF0C;&#x9700;&#x8BFB;&#x8005;&#x81EA;&#x884C;&#x51C6;&#x5907;&#x3002;</p>
<h1 id="&#x63A5;&#x53E3;&#x5B9A;&#x4E49;"><a href="#&#x63A5;&#x53E3;&#x5B9A;&#x4E49;" class="headerlink" title="&#x63A5;&#x53E3;&#x5B9A;&#x4E49;"></a>&#x63A5;&#x53E3;&#x5B9A;&#x4E49;</h1><p>BlockingQueue&#x7EE7;&#x627F;&#x81EA;Queue&#xFF0C;&#x589E;&#x52A0;&#x4E86;&#x963B;&#x585E;&#x7684;&#x5165;&#x961F;&#x3001;&#x51FA;&#x961F;&#x7B49;&#x7279;&#x6027;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public interface BlockingQueue&lt;E&gt; extends Queue&lt;E&gt; {</span><br><span class="line">  boolean add(E e);</span><br><span class="line"></span><br><span class="line">  void put(E e) throws InterruptedException;</span><br><span class="line"></span><br><span class="line">  // can extends from Queue. i don&apos;t know why overriding here</span><br><span class="line">  boolean offer(E e);</span><br><span class="line"></span><br><span class="line">  boolean offer(E e, long timeout, TimeUnit unit)</span><br><span class="line">      throws InterruptedException;</span><br><span class="line"></span><br><span class="line">  E take() throws InterruptedException;</span><br><span class="line"></span><br><span class="line">  // extends from Queue</span><br><span class="line">  // E poll();</span><br><span class="line"></span><br><span class="line">  E poll(long timeout, TimeUnit unit)</span><br><span class="line">      throws InterruptedException;</span><br><span class="line"></span><br><span class="line">  int remainingCapacity();</span><br><span class="line"></span><br><span class="line">  boolean remove(Object o);</span><br><span class="line"></span><br><span class="line">  public boolean contains(Object o);</span><br><span class="line"></span><br><span class="line">  int drainTo(Collection&lt;? super E&gt; c);</span><br><span class="line"></span><br><span class="line">  int drainTo(Collection&lt;? super E&gt; c, int maxElements);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&#x4E3A;&#x4E86;&#x65B9;&#x4FBF;&#x8BB2;&#x89E3;&#xFF0C;&#x6211;&#x8C03;&#x6574;&#x4E86;&#x90E8;&#x5206;&#x65B9;&#x6CD5;&#x7684;&#x987A;&#x5E8F;&#xFF0C;&#x8FD8;&#x589E;&#x52A0;&#x4E86;&#x6CE8;&#x91CA;&#x8F85;&#x52A9;&#x8BF4;&#x660E;&#x3002;</p>
</blockquote>
<p>&#x9700;&#x8981;&#x5173;&#x6CE8;&#x7684;&#x662F;&#x4E24;&#x5BF9;&#x65B9;&#x6CD5;:</p>
<ul>
<li><strong>&#x963B;&#x585E;&#x65B9;&#x6CD5;BlockingQueue#put()&#x548C;BlockingQueue#take()</strong>&#xFF1A;&#x5982;&#x679C;&#x5165;&#x961F;&#xFF08;&#x6216;&#x51FA;&#x961F;&#xFF0C;&#x4E0B;&#x540C;&#xFF09;&#x5931;&#x8D25;&#xFF08;&#x5982;&#x5E0C;&#x671B;&#x5165;&#x961F;&#x4F46;&#x961F;&#x5217;&#x6EE1;&#xFF0C;&#x4E0B;&#x540C;&#xFF09;&#xFF0C;&#x5219;&#x7B49;&#x5F85;&#xFF0C;&#x4E00;&#x76F4;&#x5230;&#x6EE1;&#x8DB3;&#x5165;&#x961F;&#x6761;&#x4EF6;&#xFF0C;&#x5165;&#x961F;&#x6210;&#x529F;&#x3002;</li>
<li><strong>&#x975E;&#x963B;&#x585E;&#x65B9;&#x6CD5;BlockingQueue#offer()&#x548C;BlockingQueue#poll()&#xFF0C;&#x53CA;&#x5B83;&#x4EEC;&#x7684;&#x8D85;&#x65F6;&#x7248;&#x672C;</strong>&#xFF1A;&#x975E;&#x8D85;&#x65F6;&#x7248;&#x672C;&#x662F;&#x77AC;&#x65F6;&#x52A8;&#x4F5C;&#xFF0C;&#x5982;&#x679C;&#x5165;&#x961F;&#x5F53;&#x524D;&#x5165;&#x961F;&#x5931;&#x8D25;&#xFF0C;&#x5219;&#x7ACB;&#x523B;&#x8FD4;&#x56DE;&#x5931;&#x8D25;&#xFF1B;&#x8D85;&#x65F6;&#x7248;&#x672C;&#x53EF;&#x5728;&#x6B64;&#x57FA;&#x7840;&#x4E0A;&#x963B;&#x585E;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x9650;&#x65F6;&#x7684;BlockingQueue#put()&#x548C;BlockingQueue#take()&#x3002;</li>
</ul>
<h1 id="&#x5B9E;&#x73B0;&#x7C7B;"><a href="#&#x5B9E;&#x73B0;&#x7C7B;" class="headerlink" title="&#x5B9E;&#x73B0;&#x7C7B;"></a>&#x5B9E;&#x73B0;&#x7C7B;</h1><p>BlockingQueue&#x6709;&#x5F88;&#x591A;&#x5B9E;&#x73B0;&#x7C7B;&#x3002;&#x6839;&#x636E;github&#x7684;code results&#x6392;&#x540D;&#xFF0C;&#x6700;&#x5E38;&#x7528;&#x7684;&#x662F;LinkedBlockingQueue(253k)&#x548C;ArrayBlockingQueue&#xFF08;95k&#xFF09;&#x3002;LinkedBlockingQueue&#x7684;&#x6027;&#x80FD;&#x5728;&#x5927;&#x90E8;&#x5206;&#x60C5;&#x51B5;&#x4E0B;&#x4F18;&#x4E8E;ArrayBlockingQueue&#xFF0C;&#x672C;&#x6587;&#x4E3B;&#x8981;&#x4ECB;&#x7ECD;LinkedBlockingQueue&#xFF0C;&#x6587;&#x672B;&#x4F1A;&#x7B80;&#x8981;&#x63D0;&#x53CA;&#x4E8C;&#x8005;&#x7684;&#x5BF9;&#x6BD4;&#x3002;</p>
<h2 id="LinkedBlockingQueue"><a href="#LinkedBlockingQueue" class="headerlink" title="LinkedBlockingQueue"></a>LinkedBlockingQueue</h2><h3 id="&#x963B;&#x585E;&#x65B9;&#x6CD5;put-&#x548C;take"><a href="#&#x963B;&#x585E;&#x65B9;&#x6CD5;put-&#x548C;take" class="headerlink" title="&#x963B;&#x585E;&#x65B9;&#x6CD5;put()&#x548C;take()"></a>&#x963B;&#x585E;&#x65B9;&#x6CD5;put()&#x548C;take()</h3><p>&#x4E24;&#x4E2A;&#x963B;&#x585E;&#x65B9;&#x6CD5;&#x76F8;&#x5BF9;&#x7B80;&#x5355;&#xFF0C;&#x6709;&#x52A9;&#x4E8E;&#x7406;&#x89E3;LinkedBlockingQueue&#x7684;&#x6838;&#x5FC3;&#x601D;&#x60F3;&#xFF1A;<strong>&#x5728;&#x961F;&#x5934;&#x548C;&#x961F;&#x5C3E;&#x5404;&#x6301;&#x6709;&#x4E00;&#x628A;&#x9501;&#xFF0C;&#x5165;&#x961F;&#x548C;&#x51FA;&#x961F;&#x4E4B;&#x95F4;&#x4E0D;&#x5B58;&#x5728;&#x7ADE;&#x4E89;</strong>&#x3002;</p>
<blockquote>
<p>&#x524D;&#x9762;&#x5728;<a href="/external_links/79e509b39ba22a797ebe0e35b4508954.html" target="blank" rel="noopener">Java&#x5B9E;&#x73B0;&#x751F;&#x4EA7;&#x8005;-&#x6D88;&#x8D39;&#x8005;&#x6A21;&#x578B;</a>&#x4E2D;&#x5FAA;&#x5E8F;&#x6E10;&#x8FDB;&#x7684;&#x5F15;&#x51FA;&#x4E86;BlockingQueue#put()&#x548C;BlockingQueue#take()&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x53EF;&#x4EE5;&#x5148;&#x53BB;&#x590D;&#x4E60;&#x4E00;&#x4E0B;&#xFF0C;&#x4E86;&#x89E3;&#x4E3A;&#x4EC0;&#x4E48;LinkedBlockingQueue&#x8981;&#x5982;&#x6B64;&#x8BBE;&#x8BA1;&#x3002;&#x4EE5;&#x4E0B;&#x662F;&#x66F4;&#x7EC6;&#x81F4;&#x7684;&#x8BB2;&#x89E3;&#x3002;</p>
</blockquote>
<h4 id="&#x963B;&#x585E;&#x7684;&#x5165;&#x961F;&#x64CD;&#x4F5C;put"><a href="#&#x963B;&#x585E;&#x7684;&#x5165;&#x961F;&#x64CD;&#x4F5C;put" class="headerlink" title="&#x963B;&#x585E;&#x7684;&#x5165;&#x961F;&#x64CD;&#x4F5C;put()"></a>&#x963B;&#x585E;&#x7684;&#x5165;&#x961F;&#x64CD;&#x4F5C;put()</h4><p>&#x5728;&#x961F;&#x5C3E;&#x5165;&#x961F;&#x3002;putLock&#x548C;notFull&#x914D;&#x5408;&#x5B8C;&#x6210;&#x540C;&#x6B65;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public void put(E e) throws InterruptedException {</span><br><span class="line">    if (e == null) throw new NullPointerException();</span><br><span class="line">    int c = -1;</span><br><span class="line">    Node&lt;E&gt; node = new Node&lt;E&gt;(e);</span><br><span class="line">    final ReentrantLock putLock = this.putLock;</span><br><span class="line">    final AtomicInteger count = this.count;</span><br><span class="line">    putLock.lockInterruptibly();</span><br><span class="line">    try {</span><br><span class="line">        while (count.get() == capacity) {</span><br><span class="line">            notFull.await();</span><br><span class="line">        }</span><br><span class="line">        enqueue(node);</span><br><span class="line">        c = count.getAndIncrement();</span><br><span class="line">        if (c + 1 &lt; capacity)</span><br><span class="line">            notFull.signal();</span><br><span class="line">    } finally {</span><br><span class="line">        putLock.unlock();</span><br><span class="line">    }</span><br><span class="line">    if (c == 0)</span><br><span class="line">        signalNotEmpty();</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x73B0;&#x5728;&#x89E6;&#x53D1;&#x4E00;&#x4E2A;&#x5165;&#x961F;&#x64CD;&#x4F5C;&#xFF0C;&#x5206;&#x60C5;&#x51B5;&#x8BA8;&#x8BBA;&#x3002;</p>
<h5 id="case1&#xFF1A;&#x5165;&#x961F;&#x524D;&#xFF0C;&#x961F;&#x5217;&#x975E;&#x7A7A;&#x975E;&#x6EE1;&#xFF08;&#x957F;&#x5EA6;&#x5927;&#x4E8E;&#x7B49;&#x4E8E;2&#xFF09;"><a href="#case1&#xFF1A;&#x5165;&#x961F;&#x524D;&#xFF0C;&#x961F;&#x5217;&#x975E;&#x7A7A;&#x975E;&#x6EE1;&#xFF08;&#x957F;&#x5EA6;&#x5927;&#x4E8E;&#x7B49;&#x4E8E;2&#xFF09;" class="headerlink" title="case1&#xFF1A;&#x5165;&#x961F;&#x524D;&#xFF0C;&#x961F;&#x5217;&#x975E;&#x7A7A;&#x975E;&#x6EE1;&#xFF08;&#x957F;&#x5EA6;&#x5927;&#x4E8E;&#x7B49;&#x4E8E;2&#xFF09;"></a>case1&#xFF1A;&#x5165;&#x961F;&#x524D;&#xFF0C;&#x961F;&#x5217;&#x975E;&#x7A7A;&#x975E;&#x6EE1;&#xFF08;&#x957F;&#x5EA6;&#x5927;&#x4E8E;&#x7B49;&#x4E8E;2&#xFF09;</h5><p>&#x5165;&#x961F;&#x524D;&#x9700;&#x5F97;&#x5230;&#x9501;putLock&#x3002;&#x68C0;&#x67E5;&#x961F;&#x5217;&#x975E;&#x6EE1;&#xFF0C;&#x65E0;&#x9700;&#x7B49;&#x5F85;&#x6761;&#x4EF6;notFull&#xFF0C;&#x76F4;&#x63A5;&#x5165;&#x961F;&#x3002;&#x5165;&#x961F;&#x540E;&#xFF0C;&#x68C0;&#x67E5;&#x961F;&#x5217;&#x975E;&#x6EE1;&#xFF08;&#x7CBE;&#x786E;&#x8BF4;&#x662F;&#x5165;&#x961F;&#x524D;&#x201C;&#x5C06;&#x6EE1;&#x201D;&#xFF0C;&#x4F46;&#x4E0D;&#x5F71;&#x54CD;&#x7406;&#x89E3;&#xFF09;&#xFF0C;&#x968F;&#x673A;&#x901A;&#x77E5;&#x4E00;&#x4E2A;&#x751F;&#x4EA7;&#x8005;&#x6761;&#x4EF6;notFull&#x6EE1;&#x8DB3;&#x3002;&#x6700;&#x540E;&#xFF0C;&#x68C0;&#x67E5;&#x5165;&#x961F;&#x524D;&#x961F;&#x5217;&#x975E;&#x7A7A;&#xFF0C;&#x5219;&#x65E0;&#x9700;&#x901A;&#x77E5;&#x6761;&#x4EF6;notEmpty&#x3002;</p>
<p>&#x6CE8;&#x610F;&#x70B9;&#xFF1A;</p>
<ul>
<li><strong>&#x5165;&#x961F;&#x524D;&#x961F;&#x5217;&#x975E;&#x7A7A;&#x975E;&#x6EE1;&#xFF08;&#x957F;&#x5EA6;&#x5927;&#x4E8E;&#x7B49;&#x4E8E;2&#xFF09;&#xFF0C;&#x5219;head&#x548C;tail&#x6307;&#x5411;&#x7684;&#x8282;&#x70B9;&#x4E0D;&#x540C;&#xFF0C;&#x5165;&#x961F;&#x4E0E;&#x51FA;&#x961F;&#x64CD;&#x4F5C;&#x4E0D;&#x4F1A;&#x540C;&#x65F6;&#x66F4;&#x65B0;&#x540C;&#x4E00;&#x8282;&#x70B9;&#x4E5F;&#x5C31;&#x4E0D;&#x5B58;&#x5728;&#x7ADE;&#x4E89;</strong>&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5206;&#x522B;&#x7528;&#x4E24;&#x4E2A;&#x9501;&#x540C;&#x6B65;&#x5165;&#x961F;&#x3001;&#x51FA;&#x961F;&#x64CD;&#x4F5C;&#x624D;&#x80FD;&#x662F;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x7684;&#x3002;&#x8FDB;&#x4E00;&#x6B65;&#x7684;&#xFF0C;&#x7531;&#x4E8E;&#x5165;&#x961F;&#x5DF2;&#x7ECF;&#x7531;&#x9501;putLock&#x4FDD;&#x62A4;&#xFF0C;&#x5219;enqueue&#x5185;&#x90E8;&#x5B9E;&#x73B0;&#x4E0D;&#x9700;&#x8981;&#x52A0;&#x9501;&#x3002;</li>
<li>&#x6761;&#x4EF6;notFull&#x53EF;&#x4EE5;&#x53EA;&#x968F;&#x673A;&#x901A;&#x77E5;&#x4E00;&#x4E2A;&#x7B49;&#x5F85;&#x8BE5;&#x6761;&#x4EF6;&#x7684;&#x751F;&#x4EA7;&#x8005;&#x7EBF;&#x7A0B;&#xFF08;&#x4F7F;&#x7528;signal()&#x800C;&#x4E0D;&#x662F;signalAll()&#xFF09;&#x3002;&#x5373;<code>&#x201C;&#x5355;&#x6B21;&#x901A;&#x77E5;&#x201D;</code>&#xFF0C;&#x76EE;&#x7684;&#x662F;&#x51CF;&#x5C11;&#x65E0;&#x6548;&#x7ADE;&#x4E89;&#x3002;<strong>&#x4F46;&#x8FD9;&#x4E0D;&#x4F1A;&#x4EA7;&#x751F;&#x201C;&#x4FE1;&#x53F7;&#x52AB;&#x6301;&#x201D;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x56E0;&#x4E3A;&#x53EA;&#x6709;&#x751F;&#x4EA7;&#x8005;&#x5728;&#x7B49;&#x5F85;&#x8BE5;&#x6761;&#x4EF6;</strong>&#x3002;</li>
<li>&#x6761;&#x4EF6;&#x901A;&#x77E5;&#x65B9;&#x6CD5;singal()&#x662F;&#x8FD1;&#x4E4E;&#x201C;&#x5E42;&#x7B49;&#x201D;&#x7684;&#xFF1A;&#x5982;&#x679C;&#x6709;&#x7EBF;&#x7A0B;&#x5728;&#x7B49;&#x5F85;&#x8BE5;&#x6761;&#x4EF6;&#xFF0C;&#x5219;&#x968F;&#x673A;&#x9009;&#x62E9;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x901A;&#x77E5;&#xFF1B;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x7EBF;&#x7A0B;&#x7B49;&#x5F85;&#xFF0C;&#x5219;&#x4EC0;&#x4E48;&#x90FD;&#x4E0D;&#x505A;&#xFF0C;&#x4E0D;&#x4F1A;&#x9020;&#x6210;&#x4EC0;&#x4E48;&#x6076;&#x52A3;&#x5F71;&#x54CD;&#x3002;</li>
</ul>
<h5 id="case2&#xFF1A;&#x5165;&#x961F;&#x524D;&#xFF0C;&#x961F;&#x5217;&#x6EE1;"><a href="#case2&#xFF1A;&#x5165;&#x961F;&#x524D;&#xFF0C;&#x961F;&#x5217;&#x6EE1;" class="headerlink" title="case2&#xFF1A;&#x5165;&#x961F;&#x524D;&#xFF0C;&#x961F;&#x5217;&#x6EE1;"></a>case2&#xFF1A;&#x5165;&#x961F;&#x524D;&#xFF0C;&#x961F;&#x5217;&#x6EE1;</h5><p>&#x5165;&#x961F;&#x524D;&#x9700;&#x5F97;&#x5230;&#x9501;putLock&#x3002;&#x68C0;&#x67E5;&#x961F;&#x5217;&#x6EE1;&#xFF0C;&#x5219;&#x7B49;&#x5F85;&#x6761;&#x4EF6;notFull&#x3002;<em>&#x6761;&#x4EF6;notFull&#x53EF;&#x80FD;&#x7531;&#x51FA;&#x961F;&#x6210;&#x529F;&#x89E6;&#x53D1;&#xFF08;&#x5FC5;&#x8981;&#x7684;&#xFF09;&#xFF0C;&#x4E5F;&#x53EF;&#x80FD;&#x7531;&#x5165;&#x961F;&#x6210;&#x529F;&#x89E6;&#x53D1;&#xFF08;&#x4E5F;&#x662F;&#x5FC5;&#x8981;&#x7684;&#xFF0C;&#x907F;&#x514D;&#x201C;&#x4FE1;&#x53F7;&#x4E0D;&#x8DB3;&#x201D;&#x7684;&#x95EE;&#x9898;&#xFF09;</em>&#x3002;&#x6761;&#x4EF6;notFull&#x6EE1;&#x8DB3;&#x540E;&#xFF0C;&#x5165;&#x961F;&#x3002;&#x5165;&#x961F;&#x540E;&#xFF0C;&#x5047;&#x8BBE;&#x68C0;&#x67E5;&#x961F;&#x5217;&#x6EE1;&#xFF08;&#x961F;&#x5217;&#x975E;&#x6EE1;&#x7684;&#x60C5;&#x51B5;&#x540C;case1&#xFF09;&#xFF0C;&#x5219;&#x65E0;&#x9700;&#x901A;&#x77E5;&#x6761;&#x4EF6;notFull&#x3002;&#x6700;&#x540E;&#xFF0C;&#x68C0;&#x67E5;&#x5165;&#x961F;&#x524D;&#x961F;&#x5217;&#x975E;&#x7A7A;&#xFF0C;&#x5219;&#x65E0;&#x9700;&#x901A;&#x77E5;&#x6761;&#x4EF6;notEmpty&#x3002;</p>
<p>&#x6CE8;&#x610F;&#x70B9;&#xFF1A;</p>
<ul>
<li><strong>&#x201C;&#x4FE1;&#x53F7;&#x4E0D;&#x8DB3;&#x201D;&#x95EE;&#x9898;</strong>&#xFF1A;&#x5047;&#x8BBE;&#x961F;&#x5217;&#x6EE1;&#x65F6;&#xFF0C;&#x5B58;&#x5728;<em>3&#x4E2A;&#x751F;&#x4EA7;&#x8005;P1-P3&#xFF08;&#x591A;&#x4E8E;&#x4E00;&#x4E2A;&#x5C31;&#x53EF;&#x4EE5;&#xFF09;&#x540C;&#x65F6;&#x963B;&#x585E;&#x5728;10&#x884C;</em>&#xFF1B;&#x5982;&#x679C;&#x6B64;&#x65F6;<em>5&#x4E2A;&#x6D88;&#x8D39;&#x8005;C1-C5&#xFF08;&#x591A;&#x4E8E;&#x4E00;&#x4E2A;&#x5C31;&#x53EF;&#x4EE5;&#xFF09;&#x5FEB;&#x901F;&#x3001;&#x8FDE;&#x7EED;&#x7684;&#x51FA;&#x961F;&#xFF0C;&#x4F46;&#x6700;&#x540E;&#x53EA;&#x4F1A;&#x6709;&#x4E00;&#x4E2A;&#x4FE1;&#x53F7;&#x53D1;&#x51FA;</em>&#xFF08;19-20&#x884C;&#x5728;take()&#x4E2D;&#x7684;&#x5BF9;&#x5076;&#x903B;&#x8F91;&#xFF0C;&#x53EA;&#x4F1A;&#x5728;&#x961F;&#x5217;&#x4E4B;&#x524D;&#x6D88;&#x8D39;&#x524D;&#x961F;&#x5217;&#x6EE1;&#x7684;&#x60C5;&#x51B5;&#x53D1;&#x51FA;&#x4FE1;&#x53F7;&#xFF09;&#xFF1B;<em>&#x4E00;&#x4E2A;&#x4FE1;&#x53F7;&#x53EA;&#x80FD;&#x5524;&#x9192;&#x4E00;&#x4E2A;&#x751F;&#x4EA7;&#x8005;P1</em>&#xFF0C;&#x4F46;&#x660E;&#x663E;&#x6B64;&#x65F6;&#x961F;&#x5217;&#x7F3A;&#x5C11;&#x4E86;5&#x4E2A;&#x5143;&#x7D20;&#xFF0C;&#x8BE5;&#x903B;&#x8F91;<em>&#x4E0D;&#x8DB3;&#x4EE5;&#x5524;&#x9192;P2&#x3001;P3</em>&#x3002;&#x56E0;&#x6B64;&#xFF0C;<strong>14-15&#x884C;&#x201C;&#x5165;&#x961F;&#x5B8C;&#x6210;&#x65F6;&#x7684;&#x901A;&#x77E5;&#x201D;&#x662F;&#x5FC5;&#x8981;&#x7684;&#xFF0C;&#x4FDD;&#x8BC1;&#x4E86;&#x53EA;&#x8981;&#x961F;&#x5217;&#x975E;&#x6EE1;&#xFF0C;&#x6BCF;&#x6B21;&#x5165;&#x961F;&#x540E;&#x90FD;&#x80FD;&#x5524;&#x9192;1&#x4E2A;&#x963B;&#x585E;&#x7684;&#x751F;&#x4EA7;&#x8005;&#xFF0C;&#x6765;&#x7B49;&#x5F85;&#x9501;&#x91CA;&#x653E;&#x540E;&#x7ADE;&#x4E89;&#x9501;</strong>&#x3002;&#x5373;&#xFF0C;<em>P1&#x5B8C;&#x6210;&#x5165;&#x961F;&#x540E;&#xFF0C;&#x5982;&#x679C;&#x68C0;&#x67E5;&#x5230;&#x961F;&#x5217;&#x975E;&#x6EE1;&#xFF0C;&#x4F1A;&#x968F;&#x673A;&#x5524;&#x9192;&#x4E00;&#x4E2A;&#x751F;&#x4EA7;&#x8005;P2&#xFF0C;&#x8BA9;P2&#x5728;P1&#x91CA;&#x653E;&#x9501;putLock&#x540E;&#x7ADE;&#x4E89;&#x9501;&#xFF0C;&#x7EE7;&#x7EED;&#x5165;&#x961F;</em>&#xFF0C;P3&#x540C;&#x7406;&#x3002;&#x76F8;&#x6BD4;&#x4E8E;signalAll()&#x5524;&#x9192;&#x6240;&#x6709;&#x751F;&#x4EA7;&#x8005;&#xFF0C;&#x8FD9;&#x79CD;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x4F7F;&#x5F97;&#x540C;&#x4E00;&#x65F6;&#x95F4;&#x6700;&#x591A;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x751F;&#x4EA7;&#x8005;&#x5728;&#x6E05;&#x9192;&#x7684;&#x7ADE;&#x4E89;&#x9501;&#xFF0C;&#x6027;&#x80FD;&#x63D0;&#x5347;&#x975E;&#x5E38;&#x660E;&#x663E;&#x3002;</li>
</ul>
<p>&#x8865;&#x5145;signalNotEmpty()&#x3001;signalNotFull()&#x7684;&#x5B9E;&#x73B0;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;private void signalNotEmpty() {</span><br><span class="line">    final ReentrantLock takeLock = this.takeLock;</span><br><span class="line">    takeLock.lock();</span><br><span class="line">    try {</span><br><span class="line">        notEmpty.signal();</span><br><span class="line">    } finally {</span><br><span class="line">        takeLock.unlock();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line">private void signalNotFull() {</span><br><span class="line">    final ReentrantLock putLock = this.putLock;</span><br><span class="line">    putLock.lock();</span><br><span class="line">    try {</span><br><span class="line">        notFull.signal();</span><br><span class="line">    } finally {</span><br><span class="line">        putLock.unlock();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h5 id="case3&#xFF1A;&#x5165;&#x961F;&#x524D;&#xFF0C;&#x961F;&#x5217;&#x7A7A;"><a href="#case3&#xFF1A;&#x5165;&#x961F;&#x524D;&#xFF0C;&#x961F;&#x5217;&#x7A7A;" class="headerlink" title="case3&#xFF1A;&#x5165;&#x961F;&#x524D;&#xFF0C;&#x961F;&#x5217;&#x7A7A;"></a>case3&#xFF1A;&#x5165;&#x961F;&#x524D;&#xFF0C;&#x961F;&#x5217;&#x7A7A;</h5><p>&#x5165;&#x961F;&#x524D;&#x9700;&#x5F97;&#x5230;&#x9501;putLock&#x3002;&#x68C0;&#x67E5;&#x961F;&#x5217;&#x7A7A;&#xFF0C;&#x5219;&#x65E0;&#x9700;&#x7B49;&#x5F85;&#x6761;&#x4EF6;notFull&#xFF0C;&#x76F4;&#x63A5;&#x5165;&#x961F;&#x3002;&#x5165;&#x961F;&#x540E;&#xFF0C;&#x5982;&#x679C;&#x961F;&#x5217;&#x975E;&#x6EE1;&#xFF0C;&#x5219;&#x540C;case1&#xFF1B;&#x5982;&#x679C;&#x961F;&#x5217;&#x6EE1;&#xFF0C;&#x5219;&#x540C;case2&#x3002;&#x6700;&#x540E;&#xFF0C;&#x5047;&#x8BBE;&#x68C0;&#x67E5;&#x5165;&#x961F;&#x524D;&#x961F;&#x5217;&#x7A7A;&#xFF08;&#x961F;&#x5217;&#x975E;&#x7A7A;&#x7684;&#x60C5;&#x51B5;&#x540C;case1&#xFF09;&#xFF0C;&#x5219;&#x968F;&#x673A;&#x901A;&#x77E5;&#x4E00;&#x4E2A;&#x6D88;&#x8D39;&#x8005;&#x6761;&#x4EF6;notEmpty&#x6EE1;&#x8DB3;&#x3002;</p>
<p>&#x6CE8;&#x610F;&#x70B9;&#xFF1A;</p>
<ul>
<li><strong>&#x53EA;&#x6709;&#x5165;&#x961F;&#x524D;&#x961F;&#x5217;&#x7A7A;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x624D;&#x9700;&#x8981;&#x901A;&#x77E5;&#x6761;&#x4EF6;notEmpty&#x6EE1;&#x8DB3;</strong>&#x3002;&#x5373;<code>&#x201C;&#x6761;&#x4EF6;&#x901A;&#x77E5;&#x201D;</code>&#xFF0C;&#x662F;&#x4E00;&#x79CD;&#x51CF;&#x5C11;&#x65E0;&#x6548;&#x901A;&#x77E5;&#x7684;&#x63AA;&#x65BD;&#x3002;&#x56E0;&#x4E3A;&#x5982;&#x679C;&#x961F;&#x5217;&#x975E;&#x7A7A;&#xFF0C;&#x5219;&#x51FA;&#x961F;&#x64CD;&#x4F5C;&#x4E0D;&#x4F1A;&#x963B;&#x585E;&#x5728;&#x6761;&#x4EF6;notEmpty&#x4E0A;&#x3002;&#x53E6;&#x4E00;&#x65B9;&#x9762;&#xFF0C;&#x867D;&#x7136;&#x5DF2;&#x7ECF;&#x6709;&#x751F;&#x4EA7;&#x8005;&#x5B8C;&#x6210;&#x4E86;&#x5165;&#x961F;&#xFF0C;&#x4F46;&#x53EF;&#x80FD;&#x6709;&#x6D88;&#x8D39;&#x8005;&#x5728;&#x751F;&#x4EA7;&#x8005;&#x91CA;&#x653E;&#x9501;putLock&#x540E;&#x3001;&#x901A;&#x77E5;&#x6761;&#x4EF6;notEmpty&#x6EE1;&#x8DB3;&#x524D;&#xFF0C;&#x4F7F;&#x961F;&#x5217;&#x53D8;&#x7A7A;&#xFF1B;&#x4E0D;&#x8FC7;&#x8FD9;&#x6CA1;&#x6709;&#x5F71;&#x54CD;&#xFF0C;take()&#x65B9;&#x6CD5;&#x7684;while&#x5FAA;&#x73AF;&#x80FD;&#x591F;&#x5728;&#x7EBF;&#x7A0B;&#x7ADE;&#x4E89;&#x5230;&#x9501;&#x4E4B;&#x540E;&#x518D;&#x6B21;&#x786E;&#x8BA4;&#x3002;</li>
<li>&#x901A;&#x8FC7;&#x5165;&#x961F;&#x548C;&#x51FA;&#x961F;&#x524D;&#x68C0;&#x67E5;&#x961F;&#x5217;&#x957F;&#x5EA6;&#xFF08;while+await&#xFF09;&#xFF0C;&#x9690;&#x542B;&#x4FDD;&#x8BC1;&#x4E86;&#x961F;&#x5217;&#x7A7A;&#x65F6;&#x53EA;&#x5141;&#x8BB8;&#x5165;&#x961F;&#x64CD;&#x4F5C;&#xFF0C;&#x4E0D;&#x5B58;&#x5728;&#x7ADE;&#x4E89;&#x961F;&#x5217;&#x3002;</li>
</ul>
<h5 id="case4&#xFF1A;&#x5165;&#x961F;&#x524D;&#xFF0C;&#x961F;&#x5217;&#x957F;&#x5EA6;&#x4E3A;1"><a href="#case4&#xFF1A;&#x5165;&#x961F;&#x524D;&#xFF0C;&#x961F;&#x5217;&#x957F;&#x5EA6;&#x4E3A;1" class="headerlink" title="case4&#xFF1A;&#x5165;&#x961F;&#x524D;&#xFF0C;&#x961F;&#x5217;&#x957F;&#x5EA6;&#x4E3A;1"></a>case4&#xFF1A;&#x5165;&#x961F;&#x524D;&#xFF0C;&#x961F;&#x5217;&#x957F;&#x5EA6;&#x4E3A;1</h5><p>case4&#x662F;&#x4E00;&#x4E2A;&#x7279;&#x6B8A;&#x60C5;&#x51B5;&#xFF0C;&#x5206;&#x6790;&#x65B9;&#x6CD5;&#x7C7B;&#x4F3C;&#x4E8E;case1&#xFF0C;&#x4F46;&#x53EF;&#x80FD;&#x5165;&#x961F;&#x4E0E;&#x51FA;&#x961F;&#x4E4B;&#x95F4;&#x5B58;&#x5728;&#x7ADE;&#x4E89;&#xFF0C;&#x6211;&#x4EEC;&#x7A0D;&#x540E;&#x5206;&#x6790;&#x3002;</p>
<h4 id="&#x963B;&#x585E;&#x7684;&#x51FA;&#x961F;&#x64CD;&#x4F5C;take"><a href="#&#x963B;&#x585E;&#x7684;&#x51FA;&#x961F;&#x64CD;&#x4F5C;take" class="headerlink" title="&#x963B;&#x585E;&#x7684;&#x51FA;&#x961F;&#x64CD;&#x4F5C;take()"></a>&#x963B;&#x585E;&#x7684;&#x51FA;&#x961F;&#x64CD;&#x4F5C;take()</h4><p>&#x5728;&#x961F;&#x5934;&#x5165;&#x961F;&#x3002;takeLock&#x548C;notEmpty&#x914D;&#x5408;&#x5B8C;&#x6210;&#x540C;&#x6B65;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public E take() throws InterruptedException {</span><br><span class="line">    E x;</span><br><span class="line">    int c = -1;</span><br><span class="line">    final AtomicInteger count = this.count;</span><br><span class="line">    final ReentrantLock takeLock = this.takeLock;</span><br><span class="line">    takeLock.lockInterruptibly();</span><br><span class="line">    try {</span><br><span class="line">        while (count.get() == 0) {</span><br><span class="line">            notEmpty.await();</span><br><span class="line">        }</span><br><span class="line">        x = dequeue();</span><br><span class="line">        c = count.getAndDecrement();</span><br><span class="line">        if (c &gt; 1)</span><br><span class="line">            notEmpty.signal();</span><br><span class="line">    } finally {</span><br><span class="line">        takeLock.unlock();</span><br><span class="line">    }</span><br><span class="line">    if (c == capacity)</span><br><span class="line">        signalNotFull();</span><br><span class="line">    return x;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4F9D;&#x65E7;&#x662F;&#x56DB;&#x79CD;case&#xFF0C;put()&#x548C;take()&#x662F;&#x5BF9;&#x5076;&#x7684;&#xFF0C;&#x5F88;&#x5BB9;&#x6613;&#x5206;&#x6790;&#xFF0C;&#x4E0D;&#x8D58;&#x8FF0;&#x3002;</p>
<h4 id="&#x201C;case4-&#x961F;&#x5217;&#x957F;&#x5EA6;&#x4E3A;1&#x201D;&#x65F6;&#x7684;&#x7279;&#x6B8A;&#x60C5;&#x51B5;"><a href="#&#x201C;case4-&#x961F;&#x5217;&#x957F;&#x5EA6;&#x4E3A;1&#x201D;&#x65F6;&#x7684;&#x7279;&#x6B8A;&#x60C5;&#x51B5;" class="headerlink" title="&#x201C;case4 &#x961F;&#x5217;&#x957F;&#x5EA6;&#x4E3A;1&#x201D;&#x65F6;&#x7684;&#x7279;&#x6B8A;&#x60C5;&#x51B5;"></a>&#x201C;case4 &#x961F;&#x5217;&#x957F;&#x5EA6;&#x4E3A;1&#x201D;&#x65F6;&#x7684;&#x7279;&#x6B8A;&#x60C5;&#x51B5;</h4><p>&#x961F;&#x5217;&#x957F;&#x5EA6;&#x4E3A;1&#x65F6;&#xFF0C;&#x5230;&#x5E95;&#x5165;&#x961F;&#x548C;&#x51FA;&#x961F;&#x4E4B;&#x95F4;&#x5B58;&#x5728;&#x7ADE;&#x4E89;&#x5417;&#xFF1F;&#x8FD9;&#x53D6;&#x51B3;&#x4E8E;LinkedBlockingQueue&#x7684;&#x5E95;&#x5C42;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x3002;</p>
<p>&#x6700;&#x7B80;&#x5355;&#x7684;&#x662F;&#x4F7F;&#x7528;&#x6734;&#x7D20;&#x94FE;&#x8868;&#xFF0C;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;JDK&#x63D0;&#x4F9B;&#x7684;&#x975E;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x96C6;&#x5408;&#x7C7B;&#xFF0C;&#x5982;LinkedList&#x7B49;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x961F;&#x5217;&#x957F;&#x5EA6;&#x4E3A;1&#x65F6;&#xFF0C;&#x6734;&#x7D20;&#x94FE;&#x8868;&#x4E2D;&#x7684;head&#x3001;tail&#x6307;&#x5411;&#x540C;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#xFF0C;&#x4ECE;&#x800C;&#x5165;&#x961F;&#x3001;&#x51FA;&#x961F;&#x66F4;&#x65B0;&#x540C;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x65F6;&#x5B58;&#x5728;&#x7ADE;&#x4E89;&#x3002;</p>
<blockquote>
<p>&#x6734;&#x7D20;&#x94FE;&#x8868;&#xFF1A;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x4FDD;&#x5B58;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#xFF0C;&#x4E0D;&#x52A0;&#x4EFB;&#x4F55;&#x63A7;&#x5236;&#x548C;trick&#x3002;&#x5178;&#x578B;&#x5982;LinkedList&#x3002;</p>
</blockquote>
<p><strong>&#x589E;&#x52A0;dummy node&#x53EF;&#x89E3;&#x51B3;&#x8BE5;&#x95EE;&#x9898;</strong>&#xFF08;&#x6216;&#x8005;&#x53EB;&#x54E8;&#x5175;&#x8282;&#x70B9;&#x4EC0;&#x4E48;&#x7684;&#xFF09;&#x3002;&#x5B9A;&#x4E49;Node(item, next)&#xFF0C;&#x63CF;&#x8FF0;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li>&#x521D;&#x59CB;&#x5316;&#x94FE;&#x8868;&#x65F6;&#xFF0C;&#x521B;&#x5EFA;dummy node&#xFF1A;<ul>
<li>dummy = new Node(null, null)</li>
<li>head = dummy.next // head &#x4E3A; null &lt;=&gt; &#x961F;&#x5217;&#x7A7A;</li>
<li>tail = dummy // tail.item &#x4E3A; null &lt;=&gt; &#x961F;&#x5217;&#x7A7A;</li>
</ul>
</li>
<li>&#x5728;&#x961F;&#x5C3E;&#x5165;&#x961F;&#x65F6;&#xFF0C;tail&#x540E;&#x79FB;&#xFF1A;<ul>
<li>tail.next = new Node(newItem, null)</li>
<li>tail = tail.next</li>
</ul>
</li>
<li>&#x5728;&#x961F;&#x5934;&#x51FA;&#x961F;&#x65F6;&#xFF0C;dummy&#x540E;&#x79FB;&#xFF0C;&#x540C;&#x6B65;&#x66F4;&#x65B0;head&#xFF1A;<ul>
<li>oldItem = head.item</li>
<li>dummy = dummy.next</li>
<li>dummy.item = null</li>
<li>head = dummy.next</li>
<li>return oldItem</li>
</ul>
</li>
</ul>
<p>&#x5728;&#x65B0;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x4E2D;&#xFF0C;<strong>&#x66F4;&#x65B0;&#x64CD;&#x4F5C;&#x53D1;&#x751F;&#x5728;dummy&#x548C;tail&#x4E0A;</strong>&#xFF0C;head&#x4EC5;&#x4EC5;&#x4F5C;&#x4E3A;&#x793A;&#x610F;&#x5B58;&#x5728;&#xFF0C;&#x8DDF;&#x968F;dummy&#x8282;&#x70B9;&#x66F4;&#x65B0;&#x3002;&#x961F;&#x5217;&#x957F;&#x5EA6;&#x4E3A;1&#x65F6;&#xFF0C;&#x867D;&#x7136;head&#x3001;tail&#x4ECD;&#x6307;&#x5411;&#x540C;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#xFF0C;&#x4F46;<strong>dummy&#x3001;tail&#x6307;&#x5411;&#x4E0D;&#x540C;&#x7684;&#x8282;&#x70B9;&#xFF0C;&#x4ECE;&#x800C;&#x66F4;&#x65B0;dummy&#x548C;tail&#x65F6;&#x4E0D;&#x5B58;&#x5728;&#x7ADE;&#x4E89;</strong>&#x3002;</p>
<p>&#x6E90;&#x7801;&#x4E2D;&#x7684;head&#x5373;&#x4E3A;<code>dummy</code>&#xFF0C;first&#x5373;&#x4E3A;<code>head</code>&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;...</span><br><span class="line">public LinkedBlockingQueue(int capacity) {</span><br><span class="line">    if (capacity &lt;= 0) throw new IllegalArgumentException();</span><br><span class="line">    this.capacity = capacity;</span><br><span class="line">    last = head = new Node&lt;E&gt;(null);</span><br><span class="line">}</span><br><span class="line">...</span><br><span class="line">private void enqueue(Node&lt;E&gt; node) {</span><br><span class="line">    // assert putLock.isHeldByCurrentThread();</span><br><span class="line">    // assert last.next == null;</span><br><span class="line">    last = last.next = node;</span><br><span class="line">}</span><br><span class="line">...</span><br><span class="line">private E dequeue() {</span><br><span class="line">    // assert takeLock.isHeldByCurrentThread();</span><br><span class="line">    // assert head.item == null;</span><br><span class="line">    Node&lt;E&gt; h = head;</span><br><span class="line">    Node&lt;E&gt; first = h.next;</span><br><span class="line">    h.next = h; // help GC</span><br><span class="line">    head = first;</span><br><span class="line">    E x = first.item;</span><br><span class="line">    first.item = null;</span><br><span class="line">    return x;</span><br><span class="line">}</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h4 id="enqueue&#x548C;count&#x81EA;&#x589E;&#x7684;&#x5148;&#x540E;&#x987A;&#x5E8F;"><a href="#enqueue&#x548C;count&#x81EA;&#x589E;&#x7684;&#x5148;&#x540E;&#x987A;&#x5E8F;" class="headerlink" title="enqueue&#x548C;count&#x81EA;&#x589E;&#x7684;&#x5148;&#x540E;&#x987A;&#x5E8F;"></a>enqueue&#x548C;count&#x81EA;&#x589E;&#x7684;&#x5148;&#x540E;&#x987A;&#x5E8F;</h4><p>&#x4EE5;put()&#x4E3A;&#x4F8B;&#xFF0C;<strong>count&#x81EA;&#x589E;&#x4E00;&#x5B9A;&#x8981;&#x665A;&#x4E8E;enqueue&#x6267;&#x884C;</strong>&#xFF0C;&#x5426;&#x5219;take()&#x65B9;&#x6CD5;&#x7684;while&#x5FAA;&#x73AF;&#x68C0;&#x67E5;&#x4F1A;&#x5931;&#x6548;&#x3002;</p>
<p>&#x7528;&#x4E00;&#x4E2A;&#x6700;&#x7B80;&#x5355;&#x7684;&#x573A;&#x666F;&#x6765;&#x5206;&#x6790;&#xFF0C;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x751F;&#x4EA7;&#x8005;&#x7EBF;&#x7A0B;T1&#xFF0C;&#x4E00;&#x4E2A;&#x6D88;&#x8D39;&#x8005;&#x7EBF;&#x7A0B;T2&#x3002;</p>
<h5 id="&#x5982;&#x679C;&#x5148;count&#x81EA;&#x589E;&#x518D;enqueue"><a href="#&#x5982;&#x679C;&#x5148;count&#x81EA;&#x589E;&#x518D;enqueue" class="headerlink" title="&#x5982;&#x679C;&#x5148;count&#x81EA;&#x589E;&#x518D;enqueue"></a>&#x5982;&#x679C;&#x5148;count&#x81EA;&#x589E;&#x518D;enqueue</h5><p>&#x5047;&#x8BBE;&#x76EE;&#x524D;&#x961F;&#x5217;&#x957F;&#x5EA6;0&#xFF0C;&#x5219;&#x4E8B;&#x4EF6;&#x53D1;&#x751F;&#x987A;&#x5E8F;&#xFF1A;</p>
<ol>
<li>T1&#x7EBF;&#x7A0B;&#xFF1A;count &#x81EA;&#x589E;</li>
<li>T2&#x7EBF;&#x7A0B;&#xFF1A;while &#x68C0;&#x67E5; count &gt; 0&#xFF0C;&#x65E0;&#x9700;&#x7B49;&#x5F85;&#x6761;&#x4EF6; notEmpty</li>
<li>T2&#x7EBF;&#x7A0B;&#xFF1A;dequeue &#x6267;&#x884C;</li>
<li>T1&#x7EBF;&#x7A0B;&#xFF1A;enqueue &#x6267;&#x884C;</li>
</ol>
<p>&#x5F88;&#x660E;&#x663E;&#xFF0C;&#x5728;&#x4E8B;&#x4EF6;1&#x53D1;&#x751F;&#x540E;&#x4E8B;&#x4EF6;4&#x53D1;&#x751F;&#x524D;&#xFF0C;&#x867D;&#x7136;count&gt;0&#xFF0C;&#x4F46;&#x961F;&#x5217;&#x4E2D;&#x5B9E;&#x9645;&#x662F;&#x6CA1;&#x6709;&#x5143;&#x7D20;&#x7684;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x4E8B;&#x4EF6;3 dequeue&#x4F1A;&#x6267;&#x884C;&#x5931;&#x8D25;&#xFF08;&#x9884;&#x8BA1;&#x629B;&#x51FA;NullPointerException&#xFF09;&#x3002;&#x4E8B;&#x4EF6;4&#x4E5F;&#x5C31;&#x4E0D;&#x4F1A;&#x53D1;&#x751F;&#x4E86;&#x3002;</p>
<h5 id="&#x5982;&#x679C;&#x5148;enqueue&#x518D;count&#x81EA;&#x589E;"><a href="#&#x5982;&#x679C;&#x5148;enqueue&#x518D;count&#x81EA;&#x589E;" class="headerlink" title="&#x5982;&#x679C;&#x5148;enqueue&#x518D;count&#x81EA;&#x589E;"></a>&#x5982;&#x679C;&#x5148;enqueue&#x518D;count&#x81EA;&#x589E;</h5><p>&#x5982;&#x679C;&#x5148;enqueue&#x518D;count&#x81EA;&#x589E;&#xFF0C;&#x5C31;&#x4E0D;&#x4F1A;&#x5B58;&#x5728;&#x8BE5;&#x95EE;&#x9898;&#x3002;</p>
<p>&#x4ECD;&#x5047;&#x8BBE;&#x76EE;&#x524D;&#x961F;&#x5217;&#x957F;&#x5EA6;0&#xFF0C;&#x5219;&#x4E8B;&#x4EF6;&#x53D1;&#x751F;&#x987A;&#x5E8F;&#xFF1A;</p>
<ol>
<li>T1&#x7EBF;&#x7A0B;&#xFF1A;enqueue &#x6267;&#x884C;</li>
<li>T2&#x7EBF;&#x7A0B;&#xFF1A;while &#x68C0;&#x67E5; count == 0&#xFF0C;&#x7B49;&#x5F85;&#x6761;&#x4EF6; notEmpty</li>
<li>T1&#x7EBF;&#x7A0B;&#xFF1A;count &#x81EA;&#x589E;</li>
<li>T1&#x7EBF;&#x7A0B;&#xFF1A;&#x901A;&#x77E5;&#x6761;&#x4EF6;notFull&#x6EE1;&#x8DB3;</li>
<li>T1&#x7EBF;&#x7A0B;&#xFF1A;&#x901A;&#x77E5;&#x6761;&#x4EF6;notEmpty&#x6EE1;&#x8DB3;</li>
<li>T2&#x7EBF;&#x7A0B;&#xFF1A;&#x6536;&#x5230;&#x6761;&#x4EF6;notEmpty</li>
<li>T2&#x7EBF;&#x7A0B;&#xFF1A;while &#x68C0;&#x67E5; count &gt; 0&#xFF0C;&#x65E0;&#x9700;&#x7B49;&#x5F85;&#x6761;&#x4EF6; notEmpty</li>
<li>T2&#x7EBF;&#x7A0B;&#xFF1A;dequeue &#x6267;&#x884C;</li>
</ol>
<p>&#x6362;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x7528;&#x72B6;&#x6001;&#x673A;&#x6765;&#x63CF;&#x8FF0;&#xFF1A;</p>
<ul>
<li>&#x4E8B;&#x4EF6;E1&#x53D1;&#x751F;&#x524D;&#xFF0C;&#x961F;&#x5217;&#x5904;&#x4E8E;<code>&#x72B6;&#x6001;S1</code></li>
<li>&#x4E8B;&#x4EF6;E1&#x53D1;&#x751F;&#xFF0C;&#x7EBF;&#x7A0B;T1 &#x589E;&#x52A0;&#x4E86;&#x4E00;&#x4E2A;&#x961F;&#x5217;&#x5143;&#x7D20;&#xFF0C;&#x5BFC;&#x81F4;&#x961F;&#x5217;&#x5143;&#x7D20;&#x7684;&#x6570;&#x91CF;&#x5927;&#x4E8E;count&#xFF08;1&gt;0&#xFF09;&#xFF0C;&#x961F;&#x5217;&#x8F6C;&#x6362;&#x5230;<code>&#x72B6;&#x6001;S2</code></li>
<li>&#x4E8B;&#x4EF6;E1&#x53D1;&#x751F;&#x540E;&#x3001;&#x76F4;&#x5230;&#x4E8B;&#x4EF6;E3&#x53D1;&#x751F;&#x524D;&#xFF0C;&#x961F;&#x5217;&#x4E00;&#x76F4;&#x5904;&#x4E8E;<code>&#x72B6;&#x6001;S2</code></li>
<li>&#x4E8B;&#x4EF6;E3&#x53D1;&#x751F;&#xFF0C;&#x7EBF;&#x7A0B;T1 &#x4F7F;count&#x81EA;&#x589E;&#xFF0C;&#x5BFC;&#x81F4;&#x961F;&#x5217;&#x5143;&#x7D20;&#x7684;&#x6570;&#x91CF;&#x7B49;&#x4E8E;count&#xFF08;1=1&#xFF09;&#xFF0C;&#x961F;&#x5217;&#x8F6C;&#x6362;&#x5230;<code>&#x72B6;&#x6001;S1</code></li>
<li>&#x4E8B;&#x4EF6;E3&#x53D1;&#x751F;&#x540E;&#x3001;&#x4E8B;&#x4EF6;E8&#x53D1;&#x751F;&#x524D;&#xFF0C;&#x961F;&#x5217;&#x4E00;&#x76F4;&#x5904;&#x4E8E;<code>&#x72B6;&#x6001;S1</code></li>
</ul>
<blockquote>
<p>&#x5F88;&#x591A;&#x8BFB;&#x8005;&#x53EF;&#x80FD;&#x7B2C;&#x4E00;&#x6B21;&#x4ECE;&#x72B6;&#x6001;&#x673A;&#x7684;&#x89D2;&#x5EA6;&#x6765;&#x7406;&#x89E3;&#x5E76;&#x53D1;&#x7A0B;&#x5E8F;&#x8BBE;&#x8BA1;&#xFF0C;&#x6240;&#x4EE5;&#x7334;&#x5B50;&#x9009;&#x62E9;&#x5148;&#x5199;&#x51FA;&#x72B6;&#x6001;&#x8FC1;&#x79FB;&#x5E8F;&#x5217;&#xFF0C;&#x5982;&#x679C;&#x80FD;&#x7406;&#x89E3;&#x4E0A;&#x8FF0;&#x5E8F;&#x5217;&#xFF0C;&#x6211;&#x4EEC;&#x518D;&#x8FDB;&#x884C;&#x8FDB;&#x4E00;&#x6B65;&#x7684;&#x62BD;&#x8C61;&#x3002;&#x5B9E;&#x9645;&#x7684;&#x72B6;&#x6001;&#x673A;&#x5B9A;&#x4E49;&#x6BD4;&#x4E0B;&#x9762;&#x8981;&#x4E25;&#x8C28;&#x7684;&#x591A;&#xFF0C;&#x4E0D;&#x8FC7;&#x8FD9;&#x91CC;&#x7684;&#x63CF;&#x8FF0;&#x5DF2;&#x7ECF;&#x8DB3;&#x591F;&#x4E86;&#x3002;</p>
</blockquote>
<p>&#x73B0;&#x5728;&#x8865;&#x5145;&#x5B9A;&#x4E49;&#x5982;&#x4E0B;&#xFF0C;&#x4E0D;&#x8003;&#x8651;&#x5165;&#x961F;&#x548C;&#x51FA;&#x961F;&#x7684;&#x533A;&#x522B;&#xFF1A;</p>
<ul>
<li>&#x961F;&#x5217;&#x5143;&#x7D20;&#x7684;&#x6570;&#x91CF;&#x7B49;&#x4E8E;count&#x7684;&#x72B6;&#x6001;&#x5B9A;&#x4E49;&#x4E3A;<code>&#x72B6;&#x6001;S1</code></li>
<li>&#x961F;&#x5217;&#x5143;&#x7D20;&#x7684;&#x6570;&#x91CF;&#x5927;&#x4E8E;count&#x7684;&#x72B6;&#x6001;&#x5B9A;&#x4E49;&#x4E3A;<code>&#x72B6;&#x6001;S2</code></li>
<li>enqueue&#x64CD;&#x4F5C;&#x5B9A;&#x4E49;&#x4E3A;&#x72B6;&#x6001;&#x8F6C;&#x6362;S1-&gt;S2</li>
<li>count&#x81EA;&#x589E;&#x64CD;&#x4F5C;&#x5B9A;&#x4E49;&#x4E3A;&#x72B6;&#x6001;&#x8F6C;&#x6362;S2-&gt;S1</li>
</ul>
<p><strong>LinkedBlockingQueue&#x4E2D;&#x7684;&#x540C;&#x6B65;&#x673A;&#x5236;&#x4FDD;&#x8BC1;&#x4E86;&#x4E0D;&#x4F1A;&#x6709;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x770B;&#x5230;&#x72B6;&#x6001;S2</strong>&#xFF0C;&#x5373;&#xFF0C;S1-&gt;S2-&gt;S1&#x4E24;&#x4E2A;&#x72B6;&#x6001;&#x8F6C;&#x6362;&#x53EA;&#x80FD;&#x7531;&#x7EBF;&#x7A0B;T1&#x8FDE;&#x7EED;&#x5B8C;&#x6210;&#xFF0C;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x65E0;&#x6CD5;&#x5728;&#x4E2D;&#x95F4;&#x63D2;&#x5165;&#x72B6;&#x6001;&#x8F6C;&#x6362;&#x3002;</p>
<blockquote>
<p>&#x5728;&#x7334;&#x5B50;&#x7684;&#x7406;&#x89E3;&#x4E2D;&#xFF0C;<strong>&#x5E76;&#x53D1;&#x7A0B;&#x5E8F;&#x8BBE;&#x8BA1;&#x7684;&#x672C;&#x8D28;&#x662F;&#x72B6;&#x6001;&#x673A;&#xFF0C;&#x5373;&#x7EF4;&#x62A4;&#x5408;&#x6CD5;&#x7684;&#x72B6;&#x6001;&#x548C;&#x72B6;&#x6001;&#x8F6C;&#x6362;</strong>&#x3002;&#x4EE5;&#x4E0A;&#x662F;&#x4E00;&#x4E2A;&#x6781;&#x5176;&#x7B80;&#x5355;&#x7684;&#x573A;&#x666F;&#xFF0C;&#x7528;&#x72B6;&#x6001;&#x673A;&#x4E3E;&#x4F8B;&#x5B50;&#x5C31;&#x53EF;&#x4EE5;&#x63CF;&#x8FF0;&#xFF1B;&#x7136;&#x800C;&#xFF0C;&#x590D;&#x6742;&#x573A;&#x666F;&#x9700;&#x8981;&#x7528;&#x72B6;&#x6001;&#x673A;&#x505A;&#x6570;&#x5B66;&#x8BC1;&#x660E;&#xFF0C;&#x8FD9;&#x4F7F;&#x5F97;&#x7528;&#x72B6;&#x6001;&#x673A;&#x63CF;&#x8FF0;&#x5E76;&#x53D1;&#x7A0B;&#x5E8F;&#x8BBE;&#x8BA1;&#x4E0D;&#x592A;&#x53D7;&#x6B22;&#x8FCE;&#xFF08;&#x867D;&#x7136;&#x53E3;&#x5934;&#x63CF;&#x8FF0;&#x4E5F;&#x4E0D;&#x80FD;&#x7B97;&#x4E25;&#x683C;&#x8BC1;&#x660E;&#xFF09;&#x3002;&#x4E0D;&#x8FC7;&#xFF0C;&#x7406;&#x89E3;&#x5B9E;&#x73B0;&#x4E2D;&#x7684;&#x5404;&#x79CD;&#x4EE3;&#x7801;&#x987A;&#x5E8F;&#x3001;&#x731B;&#x4E0D;&#x4E01;&#x8E66;&#x51FA;&#x7684;trick&#xFF0C;&#x8FD9;&#x4E9B;&#x53EA;&#x662F;&#x201C;&#x77E5;&#x5176;&#x6240;&#x4EE5;&#x7136;&#x201D;&#xFF1B;&#x901A;&#x8FC7;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;&#x6765;&#x638C;&#x63E1;&#x5176;&#x72B6;&#x6001;&#x673A;&#x672C;&#x8D28;&#xFF0C;&#x624D;&#x80FD;&#x8BA9;&#x6211;&#x4EEC;&#x4E86;&#x89E3;&#x5176;&#x5982;&#x4F55;&#x4FDD;&#x8BC1;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x6027;&#xFF0C;&#x81EA;&#x5DF1;&#x4E5F;&#x80FD;&#x5199;&#x51FA;&#x7C7B;&#x4F3C;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x505A;&#x5230;&#x201C;&#x77E5;&#x5176;&#x7136;&#x800C;&#x77E5;&#x5176;&#x6240;&#x4EE5;&#x7136;&#x201D;&#x3002;&#x540E;&#x9762;&#x4F1A;&#x7EE7;&#x7EED;&#x7528;&#x72B6;&#x6001;&#x673A;&#x5206;&#x6790;ConcurrentLinkedQueue&#x7684;&#x6E90;&#x7801;&#xFF0C;&#x656C;&#x8BF7;&#x671F;&#x5F85;&#x3002;</p>
</blockquote>
<h3 id="&#x975E;&#x963B;&#x585E;&#x65B9;&#x6CD5;offer-&#x548C;poll"><a href="#&#x975E;&#x963B;&#x585E;&#x65B9;&#x6CD5;offer-&#x548C;poll" class="headerlink" title="&#x975E;&#x963B;&#x585E;&#x65B9;&#x6CD5;offer()&#x548C;poll()"></a>&#x975E;&#x963B;&#x585E;&#x65B9;&#x6CD5;offer()&#x548C;poll()</h3><p>&#x5206;&#x6790;&#x4E86;&#x4E24;&#x4E2A;&#x963B;&#x585E;&#x65B9;&#x6CD5;put()&#x3001;take()&#x540E;&#xFF0C;&#x975E;&#x963B;&#x585E;&#x65B9;&#x6CD5;&#x5C31;&#x7B80;&#x5355;&#x4E86;&#x3002;</p>
<h4 id="&#x77AC;&#x65F6;&#x7248;"><a href="#&#x77AC;&#x65F6;&#x7248;" class="headerlink" title="&#x77AC;&#x65F6;&#x7248;"></a>&#x77AC;&#x65F6;&#x7248;</h4><p>&#x4EE5;offer&#x4E3A;&#x4F8B;&#xFF0C;poll()&#x540C;&#x7406;&#x3002;&#x5047;&#x8BBE;&#x6B64;&#x65F6;&#x961F;&#x5217;&#x975E;&#x7A7A;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public boolean offer(E e) {</span><br><span class="line">    if (e == null) throw new NullPointerException();</span><br><span class="line">    final AtomicInteger count = this.count;</span><br><span class="line">    if (count.get() == capacity)</span><br><span class="line">        return false;</span><br><span class="line">    int c = -1;</span><br><span class="line">    Node&lt;E&gt; node = new Node&lt;E&gt;(e);</span><br><span class="line">    final ReentrantLock putLock = this.putLock;</span><br><span class="line">    putLock.lock();</span><br><span class="line">    try {</span><br><span class="line">        if (count.get() &lt; capacity) {</span><br><span class="line">            enqueue(node);</span><br><span class="line">            c = count.getAndIncrement();</span><br><span class="line">            if (c + 1 &lt; capacity)</span><br><span class="line">                notFull.signal();</span><br><span class="line">        }</span><br><span class="line">    } finally {</span><br><span class="line">        putLock.unlock();</span><br><span class="line">    }</span><br><span class="line">    if (c == 0)</span><br><span class="line">        signalNotEmpty();</span><br><span class="line">    return c &gt;= 0;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h5 id="case1&#xFF1A;&#x5165;&#x961F;&#x524D;&#xFF0C;&#x961F;&#x5217;&#x975E;&#x6EE1;"><a href="#case1&#xFF1A;&#x5165;&#x961F;&#x524D;&#xFF0C;&#x961F;&#x5217;&#x975E;&#x6EE1;" class="headerlink" title="case1&#xFF1A;&#x5165;&#x961F;&#x524D;&#xFF0C;&#x961F;&#x5217;&#x975E;&#x6EE1;"></a>case1&#xFF1A;&#x5165;&#x961F;&#x524D;&#xFF0C;&#x961F;&#x5217;&#x975E;&#x6EE1;</h5><p>&#x5165;&#x961F;&#x524D;&#x9700;&#x5F97;&#x5230;&#x9501;putLock&#x3002;&#x68C0;&#x67E5;&#x961F;&#x5217;&#x975E;&#x6EE1;&#xFF08;&#x9690;&#x542B;&#x8868;&#x660E;&#x201C;&#x65E0;&#x9700;&#x7B49;&#x5F85;&#x6761;&#x4EF6;notFull&#x201D;&#xFF09;&#xFF0C;&#x76F4;&#x63A5;&#x5165;&#x961F;&#x3002;&#x5165;&#x961F;&#x540E;&#xFF0C;&#x68C0;&#x67E5;&#x961F;&#x5217;&#x975E;&#x6EE1;&#xFF0C;&#x968F;&#x673A;&#x901A;&#x77E5;&#x4E00;&#x4E2A;&#x751F;&#x4EA7;&#x8005;&#xFF08;&#x5305;&#x62EC;&#x4F7F;&#x7528;put()&#x65B9;&#x6CD5;&#x7684;&#x751F;&#x4EA7;&#x8005;&#xFF0C;&#x4E0B;&#x540C;&#xFF09;&#x6761;&#x4EF6;notFull&#x6EE1;&#x8DB3;&#x3002;&#x6700;&#x540E;&#xFF0C;&#x68C0;&#x67E5;&#x5165;&#x961F;&#x524D;&#x961F;&#x5217;&#x975E;&#x7A7A;&#xFF0C;&#x5219;&#x65E0;&#x9700;&#x901A;&#x77E5;&#x6761;&#x4EF6;notEmpty&#x3002;</p>
<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x77AC;&#x65F6;&#x7248;offer()&#x5728;&#x961F;&#x5217;&#x975E;&#x6EE1;&#x65F6;&#x7684;&#x884C;&#x4E3A;&#x4E0E;put()&#x76F8;&#x540C;&#x3002;</p>
<h5 id="case2&#xFF1A;&#x5165;&#x961F;&#x524D;&#xFF0C;&#x961F;&#x5217;&#x6EE1;-1"><a href="#case2&#xFF1A;&#x5165;&#x961F;&#x524D;&#xFF0C;&#x961F;&#x5217;&#x6EE1;-1" class="headerlink" title="case2&#xFF1A;&#x5165;&#x961F;&#x524D;&#xFF0C;&#x961F;&#x5217;&#x6EE1;"></a>case2&#xFF1A;&#x5165;&#x961F;&#x524D;&#xFF0C;&#x961F;&#x5217;&#x6EE1;</h5><p>&#x5165;&#x961F;&#x524D;&#x9700;&#x5F97;&#x5230;&#x9501;putLock&#x3002;&#x68C0;&#x67E5;&#x961F;&#x5217;&#x6EE1;&#xFF0C;&#x76F4;&#x63A5;&#x9000;&#x51FA;try-block&#x3002;&#x540E;&#x540C;case1&#x3002;</p>
<p>&#x961F;&#x5217;&#x6EE1;&#x65F6;&#xFF0C;offer()&#x4E0E;put()&#x7684;&#x533A;&#x522B;&#x5C31;&#x663E;&#x73B0;&#x51FA;&#x6765;&#x4E86;&#x3002;put()&#x901A;&#x8FC7;while&#x5FAA;&#x73AF;&#x963B;&#x585E;&#xFF0C;&#x4E00;&#x76F4;&#x7B49;&#x5230;&#x6761;&#x4EF6;notFull&#x5F97;&#x5230;&#x6EE1;&#x8DB3;&#xFF1B;&#x800C;offer()&#x5374;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x3002;</p>
<blockquote>
<p>&#x4E00;&#x4E2A;&#x5C0F;point&#xFF1A;</p>
<p>c&#x5728;&#x7533;&#x8BF7;&#x9501;putLock&#x524D;&#x88AB;&#x8D4B;&#x503C;&#x4E3A;-1&#x3002;&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x5982;&#x679C;&#x5165;&#x961F;&#x6210;&#x529F;&#xFF0C;&#x4F1A;&#x6267;&#x884C;<code>c = count.getAndIncrement();</code>&#x4E00;&#x53E5;&#xFF0C;&#x5219;&#x91CA;&#x653E;&#x9501;&#x540E;&#xFF0C;c&#x7684;&#x503C;&#x5C06;&#x5927;&#x4E8E;&#x7B49;&#x4E8E;0&#x3002;&#x4E8E;&#x662F;&#xFF0C;&#x8FD9;&#x91CC;&#x76F4;&#x63A5;&#x7528;c&#x662F;&#x5426;&#x5927;&#x4E8E;&#x7B49;&#x4E8E;0&#x6765;&#x5224;&#x65AD;&#x662F;&#x5426;&#x5165;&#x961F;&#x6210;&#x529F;&#x3002;<strong>&#x8FD9;&#x79CD;&#x5B9E;&#x73B0;&#x727A;&#x7272;&#x4E86;&#x53EF;&#x8BFB;&#x6027;&#xFF0C;&#x53EA;&#x6362;&#x6765;&#x4E86;&#x65E0;&#x8DB3;&#x8F7B;&#x91CD;&#x7684;&#x6027;&#x80FD;&#x6216;&#x4EE3;&#x7801;&#x91CF;&#x7684;&#x4F18;&#x5316;&#x3002;&#x81EA;&#x5DF1;&#x5728;&#x5F00;&#x53D1;&#x65F6;&#xFF0C;&#x4E0D;&#x8981;&#x7F16;&#x5199;&#x8FD9;&#x79CD;&#x4EE3;&#x7801;</strong>&#x3002;</p>
</blockquote>
<h4 id="&#x8D85;&#x65F6;&#x7248;"><a href="#&#x8D85;&#x65F6;&#x7248;" class="headerlink" title="&#x8D85;&#x65F6;&#x7248;"></a>&#x8D85;&#x65F6;&#x7248;</h4><p>&#x540C;&#x4E0A;&#xFF0C;&#x4EE5;offer()&#x4E3A;&#x4F8B;&#x3002;&#x5047;&#x8BBE;&#x6B64;&#x65F6;&#x961F;&#x5217;&#x975E;&#x7A7A;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public boolean offer(E e, long timeout, TimeUnit unit)</span><br><span class="line">    throws InterruptedException {</span><br><span class="line"></span><br><span class="line">    if (e == null) throw new NullPointerException();</span><br><span class="line">    long nanos = unit.toNanos(timeout);</span><br><span class="line">    int c = -1;</span><br><span class="line">    final ReentrantLock putLock = this.putLock;</span><br><span class="line">    final AtomicInteger count = this.count;</span><br><span class="line">    putLock.lockInterruptibly();</span><br><span class="line">    try {</span><br><span class="line">        while (count.get() == capacity) {</span><br><span class="line">            if (nanos &lt;= 0)</span><br><span class="line">                return false;</span><br><span class="line">            nanos = notFull.awaitNanos(nanos);</span><br><span class="line">        }</span><br><span class="line">        enqueue(new Node&lt;E&gt;(e));</span><br><span class="line">        c = count.getAndIncrement();</span><br><span class="line">        if (c + 1 &lt; capacity)</span><br><span class="line">            notFull.signal();</span><br><span class="line">    } finally {</span><br><span class="line">        putLock.unlock();</span><br><span class="line">    }</span><br><span class="line">    if (c == 0)</span><br><span class="line">        signalNotEmpty();</span><br><span class="line">    return true;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8BE5;&#x65B9;&#x6CD5;&#x540C;put()&#x5F88;&#x50CF;&#xFF0C;12-13&#x884C;&#x5224;&#x65AD;nanos&#x8D85;&#x65F6;&#x7684;&#x60C5;&#x51B5;&#xFF08;&#x541E;&#x6389;&#x4E86;timeout&#x53C2;&#x6570;&#x975E;&#x6CD5;&#x7684;&#x5F02;&#x5E38;&#x60C5;&#x51B5;&#xFF09;&#xFF0C;&#x6240;&#x4EE5;&#x533A;&#x522B;&#x53EA;&#x6709;14&#x884C;&#xFF1A;&#x5C06;&#x963B;&#x585E;&#x7684;<code>notFull.await()</code>&#x6362;&#x6210;&#x975E;&#x963B;&#x585E;&#x7684;&#x8D85;&#x65F6;&#x7248;<code>notFull.awaitNanos(nanos)</code>&#x3002;</p>
<p>awaitNanos()&#x7684;&#x5B9E;&#x73B0;&#x6709;&#x70B9;&#x610F;&#x601D;&#xFF0C;&#x8FD9;&#x91CC;&#x4E0D;&#x8868;&#x3002;&#x5176;&#x5B9E;&#x73B0;&#x7C7B;&#x4E2D;&#x7684;Javadoc&#x63CF;&#x8FF0;&#x975E;&#x5E38;&#x5E72;&#x7EC3;&#xFF1A;&#x201C;Block until signalled, interrupted, or timed out.&#x201D;&#xFF0C;&#x8FD4;&#x56DE;&#x503C;&#x4E3A;&#x5269;&#x4F59;&#x65F6;&#x95F4;&#x3002;&#x5269;&#x4F59;&#x65F6;&#x95F4;&#x5C0F;&#x4E8E;&#x7B49;&#x4E8E;&#x53C2;&#x6570;nanos&#xFF0C;&#x8868;&#x793A;&#xFF1A;</p>
<ol>
<li>&#x6761;&#x4EF6;notFull&#x6EE1;&#x8DB3;&#xFF08;&#x5269;&#x4F59;&#x65F6;&#x95F4;&#x5927;&#x4E8E;0&#xFF09;</li>
<li>&#x7B49;&#x5F85;&#x7684;&#x603B;&#x65F6;&#x957F;&#x5DF2;&#x8D85;&#x8FC7;timeout&#xFF08;&#x5269;&#x4F59;&#x65F6;&#x95F4;&#x5C0F;&#x4E8E;&#x7B49;&#x4E8E;0&#xFF09;</li>
</ol>
<p>nanos&#x9996;&#x5148;&#x88AB;&#x521D;&#x59CB;&#x5316;&#x4E3A;timeout&#xFF1B;&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x6D88;&#x8D39;&#x8005;&#x7EBF;&#x7A0B;&#x53EF;&#x80FD;&#x963B;&#x585E;&#x3001;&#x6536;&#x5230;&#x4FE1;&#x53F7;&#x591A;&#x6B21;&#xFF0C;&#x6BCF;&#x6B21;&#x6536;&#x5230;&#x4FE1;&#x53F7;&#x88AB;&#x5524;&#x9192;&#xFF0C;&#x8FD4;&#x56DE;&#x7684;&#x5269;&#x4F59;&#x65F6;&#x95F4;&#x90FD;&#x5927;&#x4E8E;0&#x5E76;&#x5C0F;&#x4E8E;&#x7B49;&#x4E8E;&#x53C2;&#x6570;nanos&#xFF0C;&#x518D;&#x7528;&#x5269;&#x4F59;&#x65F6;&#x95F4;&#x4F5C;&#x4E3A;&#x4E0B;&#x6B21;&#x7B49;&#x5F85;&#x7684;&#x53C2;&#x6570;nanos&#xFF0C;&#x76F4;&#x5230;&#x5269;&#x4F59;&#x65F6;&#x95F4;&#x5C0F;&#x4E8E;&#x7B49;&#x4E8E;0&#x3002;&#x4EE5;&#x6B64;&#x5B9E;&#x73B0;&#x603B;&#x65F6;&#x957F;&#x4E0D;&#x8D85;&#x8FC7;timeout&#x7684;&#x8D85;&#x65F6;&#x68C0;&#x6D4B;&#x3002;</p>
<p>&#x5176;&#x4ED6;&#x540C;put()&#x65B9;&#x6CD5;&#x3002;</p>
<blockquote>
<p>12-13&#x884C;&#x5224;&#x65AD;nanos&#x53C2;&#x6570;&#x975E;&#x6CD5;&#x540E;&#xFF0C;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x4E86;false&#x3002;&#x5B9E;&#x73B0;&#x6709;&#x95EE;&#x9898;&#xFF0C;&#x6709;&#x53EF;&#x80FD;&#x8FDD;&#x53CD;&#x63A5;&#x53E3;&#x58F0;&#x660E;&#x3002;</p>
<p>&#x6839;&#x636E;Javadoc&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x58F0;&#x660E;&#xFF0C;&#x8FD4;&#x56DE;&#x503C;true&#x8868;&#x793A;&#x5165;&#x961F;&#x6210;&#x529F;&#xFF0C;false&#x8868;&#x793A;&#x5165;&#x961F;&#x5931;&#x8D25;&#x3002;&#x4F46;&#x5982;&#x679C;&#x4F20;&#x8FDB;&#x6765;&#x7684;timeout&#x662F;&#x4E00;&#x4E2A;&#x8D1F;&#x6570;&#xFF0C;&#x90A3;&#x4E48;5&#x884C;&#x521D;&#x59CB;&#x5316;&#x7684;nanos&#x4E5F;&#x5C06;&#x662F;&#x4E00;&#x4E2A;&#x8D1F;&#x6570;&#xFF1B;&#x8FDB;&#x800C;&#x4E00;&#x8FDB;&#x5165;while&#x5FAA;&#x73AF;&#xFF0C;&#x5C31;&#x5728;13&#x884C;&#x8FD4;&#x56DE;&#x4E86;false&#x3002;&#x7136;&#x800C;&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x79CD;&#x53C2;&#x6570;&#x975E;&#x6CD5;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x8FD4;&#x56DE;false&#x8BA9;&#x4EBA;&#x8BEF;&#x4EE5;&#x4E3A;&#x53C2;&#x6570;&#x6B63;&#x5E38;&#xFF0C;&#x53EA;&#x662F;&#x5165;&#x961F;&#x5931;&#x8D25;&#x3002;&#x8FD9;&#x8FDD;&#x53CD;&#x4E86;&#x63A5;&#x53E3;&#x58F0;&#x660E;&#xFF0C;&#x5E76;&#x4E14;&#x975E;&#x5E38;&#x96BE;&#x4EE5;&#x53D1;&#x73B0;&#x3002;</p>
<p>&#x5E94;&#x8BE5;&#x5728;&#x51FD;&#x6570;&#x5934;&#x90E8;&#x5C31;&#x5C06;&#x53C2;&#x6570;&#x975E;&#x6CD5;&#x7684;&#x60C5;&#x51B5;&#x68C0;&#x67E5;&#x51FA;&#x6765;&#xFF0C;&#x76F8;&#x5E94;&#x629B;&#x51FA;IllegalArgumentException&#x3002;</p>
</blockquote>
<h2 id="LinkedBlockingQueue&#x4E0E;ArrayBlockingQueue&#x7684;&#x533A;&#x522B;"><a href="#LinkedBlockingQueue&#x4E0E;ArrayBlockingQueue&#x7684;&#x533A;&#x522B;" class="headerlink" title="LinkedBlockingQueue&#x4E0E;ArrayBlockingQueue&#x7684;&#x533A;&#x522B;"></a>LinkedBlockingQueue&#x4E0E;ArrayBlockingQueue&#x7684;&#x533A;&#x522B;</h2><p>github&#x4E0A;LinkedBlockingQueue&#x548C;ArrayBlockingQueue&#x7684;&#x4F7F;&#x7528;&#x9891;&#x7387;&#x90FD;&#x5F88;&#x9AD8;&#x3002;&#x5927;&#x90E8;&#x5206;&#x60C5;&#x51B5;&#x4E0B;&#x90FD;&#x53EF;&#x4EE5;&#x4E5F;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528;LinkedBlockingQueue&#xFF0C;&#x4F46;&#x6E05;&#x695A;&#x4E8C;&#x8005;&#x7684;&#x5F02;&#x540C;&#x70B9;&#xFF0C;&#x65B9;&#x80FD;&#x5BF9;&#x75C7;&#x4E0B;&#x836F;&#xFF0C;&#x5728;&#x9488;&#x5BF9;&#x4E0D;&#x540C;&#x7684;&#x4F18;&#x5316;&#x573A;&#x666F;&#x9009;&#x62E9;&#x6700;&#x5408;&#x9002;&#x7684;&#x65B9;&#x6848;&#x3002;</p>
<p>&#x76F8;&#x540C;&#x70B9;&#xFF1A;</p>
<ul>
<li>&#x652F;&#x6301;&#x6709;&#x754C;</li>
</ul>
<p>&#x4E0D;&#x540C;&#x70B9;</p>
<ul>
<li>LinkedBlockingQueue&#x5E95;&#x5C42;&#x7528;&#x94FE;&#x8868;&#x5B9E;&#x73B0;&#xFF1A;ArrayBlockingQueue&#x5E95;&#x5C42;&#x7528;&#x6570;&#x7EC4;&#x5B9E;&#x73B0;</li>
<li>LinkedBlockingQueue&#x652F;&#x6301;&#x4E0D;&#x6307;&#x5B9A;&#x5BB9;&#x91CF;&#x7684;&#x65E0;&#x754C;&#x961F;&#x5217;&#xFF08;&#x957F;&#x5EA6;&#x6700;&#x5927;&#x503C;Integer.MAX_VALUE&#xFF09;&#xFF1B;ArrayBlockingQueue&#x5FC5;&#x987B;&#x6307;&#x5B9A;&#x5BB9;&#x91CF;&#xFF0C;&#x65E0;&#x6CD5;&#x6269;&#x5BB9;</li>
<li>LinkedBlockingQueue&#x652F;&#x6301;&#x61D2;&#x52A0;&#x8F7D;&#xFF1A;ArrayBlockingQueue&#x4E0D;&#x652F;&#x6301;</li>
<li>ArrayBlockingQueue&#x5165;&#x961F;&#x65F6;&#x4E0D;&#x751F;&#x6210;&#x989D;&#x5916;&#x5BF9;&#x8C61;&#xFF1A;LinkedBlockingQueue&#x9700;&#x751F;&#x6210;Node&#x5BF9;&#x8C61;&#xFF0C;&#x6D88;&#x8017;&#x65F6;&#x95F4;&#xFF0C;&#x4E14;GC&#x538B;&#x529B;&#x5927;</li>
<li>LinkedBlockingQueue&#x7684;&#x5165;&#x961F;&#x548C;&#x51FA;&#x961F;&#x5206;&#x522B;&#x7528;&#x4E24;&#x628A;&#x9501;&#x4FDD;&#x62A4;&#xFF0C;&#x65E0;&#x7ADE;&#x4E89;&#xFF0C;&#x4E8C;&#x8005;&#x4E0D;&#x4F1A;&#x4E92;&#x76F8;&#x5F71;&#x54CD;&#xFF1B;ArrayBlockingQueue&#x7684;&#x5165;&#x961F;&#x548C;&#x51FA;&#x961F;&#x5171;&#x7528;&#x4E00;&#x628A;&#x9501;&#xFF0C;&#x5165;&#x961F;&#x548C;&#x51FA;&#x961F;&#x5B58;&#x5728;&#x7ADE;&#x4E89;&#xFF0C;&#x4E00;&#x65B9;&#x901F;&#x5EA6;&#x9AD8;&#x65F6;&#x53E6;&#x4E00;&#x65B9;&#x901F;&#x5EA6;&#x4F1A;&#x53D8;&#x4F4E;&#x3002;&#x4E0D;&#x8003;&#x8651;&#x5206;&#x914D;&#x5BF9;&#x8C61;&#x3001;GC&#x7B49;&#x56E0;&#x7D20;&#x7684;&#x8BDD;&#xFF0C;ArrayBlockingQueue&#x5E76;&#x53D1;&#x6027;&#x80FD;&#x8981;&#x4F4E;&#x4E8E;LinkedBlockingQueue</li>
</ul>
<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;LinkedBlockingQueue&#x6574;&#x4F53;&#x4E0A;&#x662F;&#x4F18;&#x4E8E;ArrayBlockingQueue&#x7684;&#x3002;&#x6240;&#x4EE5;&#xFF0C;&#x9664;&#x975E;&#x67D0;&#x4E9B;&#x7279;&#x6B8A;&#x539F;&#x56E0;&#xFF0C;&#x5426;&#x5219;&#x5E94;&#x4F18;&#x5148;&#x4F7F;&#x7528;LinkedBlockingQueue&#x3002;</p>
<blockquote>
<p>&#x53EF;&#x80FD;&#x4E0D;&#x5168;&#xFF0C;&#x6B22;&#x8FCE;&#x8BC4;&#x8BBA;&#xFF0C;&#x968F;&#x65F6;&#x589E;&#x6539;&#x3002;</p>
</blockquote>
<h1 id="&#x603B;&#x7ED3;"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3;</h1><p>&#x6CA1;&#x6709;&#x3002;</p>
<hr>
<blockquote>
<p>&#x672C;&#x6587;&#x94FE;&#x63A5;&#xFF1A;<a href="/external_links/1989b143807e38baa245b97f71e5ceed.html" target="blank" rel="noopener">&#x6E90;&#x7801;|&#x5E76;&#x53D1;&#x4E00;&#x679D;&#x82B1;&#x4E4B;BlockingQueue</a><br>&#x4F5C;&#x8005;&#xFF1A;<a href="mailto:monkeysayhi7@gmail.com" target="_blank" rel="noopener">&#x7334;&#x5B50;007</a><br>&#x51FA;&#x5904;&#xFF1A;<a href="/external_links/8bfa8dc3a9648d74d2788759ace24805.html" target="blank" rel="noopener">monkeysayhi.github.io</a><br>&#x672C;&#x6587;&#x57FA;&#x4E8E; <a href="/external_links/6f1da3ff281999354d4abd56d1551468.html" target="blank" rel="noopener">&#x77E5;&#x8BC6;&#x5171;&#x4EAB;&#x7F72;&#x540D;-&#x76F8;&#x540C;&#x65B9;&#x5F0F;&#x5171;&#x4EAB; 4.0</a> &#x56FD;&#x9645;&#x8BB8;&#x53EF;&#x534F;&#x8BAE;&#x53D1;&#x5E03;&#xFF0C;&#x6B22;&#x8FCE;&#x8F6C;&#x8F7D;&#xFF0C;&#x6F14;&#x7ECE;&#x6216;&#x7528;&#x4E8E;&#x5546;&#x4E1A;&#x76EE;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x5FC5;&#x987B;&#x4FDD;&#x7559;&#x672C;&#x6587;&#x7684;&#x7F72;&#x540D;&#x53CA;&#x94FE;&#x63A5;&#x3002;</p>
</blockquote>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/01d947e74fd8bfdc7391f80cb2a27bba.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903516851421192.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903516851421192.html" itemprop="url">Java模拟赛跑过程 需求 设计 && 实现 总结</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-27T12:55:48+08:00">
                2017-11-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Java&#x5E76;&#x53D1;&#x9762;&#x8BD5;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x7ECF;&#x5178;&#x95EE;&#x9898;&#x2014;&#x2014;&#x624B;&#x5199;&#x4EE3;&#x7801;&#x6A21;&#x62DF;&#x8D5B;&#x8DD1;&#x8FC7;&#x7A0B;&#x3002;&#x8BE5;&#x95EE;&#x9898;&#x8003;&#x67E5;CountDownLatch&#x7684;&#x7528;&#x6CD5;&#xFF0C;&#x6BD4;<a href="/external_links/79e509b39ba22a797ebe0e35b4508954.html" target="blank" rel="noopener">Java&#x5B9E;&#x73B0;&#x751F;&#x4EA7;&#x8005;-&#x6D88;&#x8D39;&#x8005;&#x6A21;&#x578B;</a>&#x7684;&#x8003;&#x67E5;&#x66F4;&#x76F4;&#x63A5;&#xFF1A;</p>
<ul>
<li>&#x5BF9;Java&#x5E76;&#x53D1;&#x6A21;&#x578B;&#x7684;&#x7406;&#x89E3;</li>
<li>&#x5BF9;Java&#x5E76;&#x53D1;&#x7F16;&#x7A0B;&#x63A5;&#x53E3;&#xFF08;CountDownLatch&#xFF09;&#x7684;&#x719F;&#x7EC3;&#x7A0B;&#x5EA6;</li>
<li><strong>&#x7B80;&#x5316;&#x95EE;&#x9898;&#x7684;&#x80FD;&#x529B;</strong></li>
<li>bug free</li>
<li>coding style</li>
</ul>
<blockquote>
<p>JDK&#x7248;&#x672C;&#xFF1A;oracle java 1.8.0_102</p>
</blockquote>
<p>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x662F;&#x201C;&#x7B80;&#x5316;&#x95EE;&#x9898;&#x7684;&#x80FD;&#x529B;&#x201D;&#x3002;&#x5EFA;&#x8BAE;&#x8BFB;&#x8005;&#x5728;&#x7EE7;&#x7EED;&#x9605;&#x8BFB;&#x4E4B;&#x524D;&#xFF0C;&#x81EA;&#x5DF1;&#x5148;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x7248;&#x672C;&#xFF0C;&#x4E4B;&#x540E;&#x518D;&#x4E0E;&#x6587;&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#x6BD4;&#x8F83;&#xFF0C;&#x770B;&#x54EA;&#x79CD;&#x601D;&#x8DEF;&#x66F4;&#x7B80;&#x6D01;&#xFF0C;&#x5B9E;&#x73B0;&#x66F4;&#x7F8E;&#x89C2;&#x3002;</p>
<h1 id="&#x9700;&#x6C42;"><a href="#&#x9700;&#x6C42;" class="headerlink" title="&#x9700;&#x6C42;"></a>&#x9700;&#x6C42;</h1><p>&#x95EE;&#x9898;&#x5F88;&#x7ECF;&#x5178;&#xFF0C;&#x5219;&#x9700;&#x6C42;&#x6982;&#x62EC;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li>&#x6240;&#x6709;&#x9009;&#x624B;&#x5C31;&#x4F4D;&#x540E;&#xFF0C;&#x88C1;&#x5224;&#x9E23;&#x67AA;&#x5F00;&#x59CB;&#x6BD4;&#x8D5B;</li>
<li>&#x9009;&#x624B;&#x5230;&#x8FBE;&#x7EC8;&#x70B9;&#x6216;&#x4E2D;&#x9014;&#x9000;&#x8D5B;&#x540E;&#xFF0C;&#x8BB0;&#x5F55;&#x6210;&#x7EE9;</li>
<li>&#x6240;&#x6709;&#x9009;&#x624B;&#x90FD;&#x5DF2;&#x8BB0;&#x5F55;&#x6210;&#x7EE9;&#x540E;&#xFF0C;&#x7ED3;&#x675F;&#x6BD4;&#x8D5B;</li>
</ul>
<p>&#x518D;&#x6B21;&#x5EFA;&#x8BAE;&#x8BFB;&#x8005;&#x81EA;&#x5DF1;&#x5148;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x7248;&#x672C;&#xFF0C;&#x518D;&#x7EE7;&#x7EED;&#x9605;&#x8BFB;&#x3002;</p>
<h1 id="&#x8BBE;&#x8BA1;-amp-amp-&#x5B9E;&#x73B0;"><a href="#&#x8BBE;&#x8BA1;-amp-amp-&#x5B9E;&#x73B0;" class="headerlink" title="&#x8BBE;&#x8BA1; &amp;&amp; &#x5B9E;&#x73B0;"></a>&#x8BBE;&#x8BA1; &amp;&amp; &#x5B9E;&#x73B0;</h1><h2 id="&#x8BBE;&#x8BA1;"><a href="#&#x8BBE;&#x8BA1;" class="headerlink" title="&#x8BBE;&#x8BA1;"></a>&#x8BBE;&#x8BA1;</h2><p>&#x9898;&#x76EE;&#x63CF;&#x8FF0;&#x5F88;&#x6E05;&#x6670;&#xFF0C;&#x73B0;&#x7B80;&#x5316;&#x9700;&#x6C42;&#x5E76;&#x8BBE;&#x8BA1;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&#x9009;&#x624B;&#x9010;&#x6E10;&#x5C31;&#x4F4D; -&gt; &#x5F00;&#x59CB;&#x6BD4;&#x8D5B; -&gt; &#x9009;&#x624B;&#x9010;&#x6E10;&#x8DD1;&#x5230;&#x7EC8;&#x70B9;&#x6216;&#x53D1;&#x751F;&#x5F02;&#x5E38; -&gt; &#x6BD4;&#x8D5B;&#x7ED3;&#x675F;</span><br></pre></td></tr></table></figure>

<p>&#x5728;&#x4E09;&#x4E2A;&#x8FDE;&#x63A5;&#x5904;&#x5404;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;CountDownLatch&#x5373;&#x53EF;&#x3002;</p>
<h2 id="&#x5B9E;&#x73B0;"><a href="#&#x5B9E;&#x73B0;" class="headerlink" title="&#x5B9E;&#x73B0;"></a>&#x5B9E;&#x73B0;</h2><p>&#x4E09;&#x4E2A;&#x8FDE;&#x63A5;&#x5904;&#x5206;&#x522B;&#x547D;&#x540D;&#x4E3A;ready&#x3001;start&#x3001;end&#xFF0C;&#x53C2;&#x8D5B;&#x8005;&#x6570;&#x91CF;racerCnt&#xFF0C;&#x5219;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public class Race {</span><br><span class="line"></span><br><span class="line">  public static void race(int racerCnt) throws InterruptedException {</span><br><span class="line">    CountDownLatch ready = new CountDownLatch(racerCnt);</span><br><span class="line">    CountDownLatch start = new CountDownLatch(1);</span><br><span class="line">    CountDownLatch end = new CountDownLatch(racerCnt);</span><br><span class="line"></span><br><span class="line">    for (int i = 0; i &lt; racerCnt; i++) {</span><br><span class="line">      final int racerNo = i;</span><br><span class="line">      new Thread(new Runnable() {</span><br><span class="line">        @Override</span><br><span class="line">        public void run() {</span><br><span class="line">          System.out.println(&quot;ready: &quot; + racerNo);</span><br><span class="line">          ready.countDown();</span><br><span class="line">          try {</span><br><span class="line">            start.await();</span><br><span class="line">            System.out.println(&quot;start: &quot; + racerNo);</span><br><span class="line">          } catch (InterruptedException e) {</span><br><span class="line">            System.out.println(&quot;I am hurt, and have to interrupt the race...&quot;);</span><br><span class="line">            Thread.currentThread().interrupt();</span><br><span class="line">          } finally {</span><br><span class="line">            System.out.println(&quot;end: &quot; + racerNo);</span><br><span class="line">            end.countDown();</span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">      }).start();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    ready.await();</span><br><span class="line">    System.out.println(&quot;********************** all ready!!! **********************&quot;);</span><br><span class="line">    System.out.println(&quot;********************** will start soon **********************&quot;);</span><br><span class="line">    start.countDown();</span><br><span class="line">    end.await();</span><br><span class="line">    System.out.println(&quot;********************** all end!!! **********************&quot;);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  public static void main(String[] args) throws InterruptedException {</span><br><span class="line">    race(5);</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x9009;&#x62E9;&#x4E00;&#x4E2A;&#x6BD4;&#x8F83;&#x4E71;&#x7684;&#x8F93;&#x51FA;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;ready: 1</span><br><span class="line">ready: 0</span><br><span class="line">ready: 2</span><br><span class="line">ready: 3</span><br><span class="line">ready: 4</span><br><span class="line">********************** all ready!!! **********************</span><br><span class="line">********************** will start soon **********************</span><br><span class="line">start: 1</span><br><span class="line">start: 2</span><br><span class="line">start: 3</span><br><span class="line">end: 3</span><br><span class="line">start: 0</span><br><span class="line">end: 0</span><br><span class="line">end: 2</span><br><span class="line">end: 1</span><br><span class="line">start: 4</span><br><span class="line">end: 4</span><br><span class="line">********************** all end!!! **********************</span><br></pre></td></tr></table></figure>

<p>&#x5F88;&#x660E;&#x663E;&#xFF1A;&#x7B2C;&#x4E00;&#x540D;&#x662F;3&#x53F7;&#x9009;&#x624B;&#xFF1B;&#x6700;&#x540E;&#x4E00;&#x540D;&#x662F;4&#x53F7;&#x9009;&#x624B;&#xFF1B;3&#x53F7;&#x8DD1;&#x5B8C;&#x7684;&#x65F6;&#x5019;&#xFF0C;0&#x53F7;&#x8FD8;&#x6CA1;&#x6709;&#x5F00;&#x8DD1;&#x3002;</p>
<h1 id="&#x603B;&#x7ED3;"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3;</h1><p>&#x7528;CountDownLatch&#x6A21;&#x62DF;&#x8D5B;&#x8DD1;&#x8FC7;&#x7A0B;&#x867D;&#x7136;&#x7B80;&#x5355;&#xFF0C;&#x4F46;&#x80FD;&#x7B80;&#x6D01;&#x3001;&#x7F8E;&#x89C2;&#x7684;&#x5B9E;&#x73B0;&#x5374;&#x4E0D;&#x5BB9;&#x6613;&#xFF0C;&#x5F88;&#x8003;&#x9A8C;&#x9762;&#x8BD5;&#x8005;&#x7B80;&#x5316;&#x95EE;&#x9898;&#x7684;&#x80FD;&#x529B;&#x3002;</p>
<hr>
<blockquote>
<p>&#x672C;&#x6587;&#x94FE;&#x63A5;&#xFF1A;<a href="/external_links/b6a0899d93546a58f1f2e82ced279c10.html" target="blank" rel="noopener">Java&#x6A21;&#x62DF;&#x8D5B;&#x8DD1;&#x8FC7;&#x7A0B;</a><br>&#x4F5C;&#x8005;&#xFF1A;<a href="mailto:monkeysayhi7@gmail.com" target="_blank" rel="noopener">&#x7334;&#x5B50;007</a><br>&#x51FA;&#x5904;&#xFF1A;<a href="/external_links/8bfa8dc3a9648d74d2788759ace24805.html" target="blank" rel="noopener">monkeysayhi.github.io</a><br>&#x672C;&#x6587;&#x57FA;&#x4E8E; <a href="/external_links/6f1da3ff281999354d4abd56d1551468.html" target="blank" rel="noopener">&#x77E5;&#x8BC6;&#x5171;&#x4EAB;&#x7F72;&#x540D;-&#x76F8;&#x540C;&#x65B9;&#x5F0F;&#x5171;&#x4EAB; 4.0</a> &#x56FD;&#x9645;&#x8BB8;&#x53EF;&#x534F;&#x8BAE;&#x53D1;&#x5E03;&#xFF0C;&#x6B22;&#x8FCE;&#x8F6C;&#x8F7D;&#xFF0C;&#x6F14;&#x7ECE;&#x6216;&#x7528;&#x4E8E;&#x5546;&#x4E1A;&#x76EE;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x5FC5;&#x987B;&#x4FDD;&#x7559;&#x672C;&#x6587;&#x7684;&#x7F72;&#x540D;&#x53CA;&#x94FE;&#x63A5;&#x3002;</p>
</blockquote>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/88d13c67de9bc5514f5b5b85d3d955f6.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903513944768520.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903513944768520.html" itemprop="url">Maven的profile文件过滤引起的字符编码BUG</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-27T12:14:02+08:00">
                2017-11-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x672C;&#x6587;&#x8BB0;&#x5F55;&#x4E86;&#x4E00;&#x6B21;&#x6587;&#x4EF6;&#x7F16;&#x7801;&#x5DEE;&#x5F02;&#x5F15;&#x8D77;&#x7684;profile&#x66FF;&#x6362;&#x5360;&#x4F4D;&#x7B26;&#x5931;&#x8D25;&#x7684;bug&#xFF0C;&#x53CA;&#x5904;&#x7406;&#x601D;&#x8DEF;&#x3002;&#x8BB0;&#x5F55;&#x6210;&#x6587;&#xFF0C;&#x4EE5;&#x4FBF;&#x4EE5;&#x540E;&#x53CD;&#x601D;&#xFF0C;&#x6216;&#x8BA9;&#x540E;&#x6765;&#x9047;&#x5230;&#x95EE;&#x9898;&#x7684;&#x540C;&#x5B66;&#x80FD;&#x6709;&#x636E;&#x53EF;&#x5FAA;&#x3002;</p>
<h3 id="&#x8D77;&#x56E0;&#x53CA;bug&#x63CF;&#x8FF0;"><a href="#&#x8D77;&#x56E0;&#x53CA;bug&#x63CF;&#x8FF0;" class="headerlink" title="&#x8D77;&#x56E0;&#x53CA;bug&#x63CF;&#x8FF0;"></a>&#x8D77;&#x56E0;&#x53CA;bug&#x63CF;&#x8FF0;</h3><p>&#x76F8;&#x4FE1;&#x5927;&#x5BB6;&#x5BF9;&#x4E8E;Maven&#x4E2D;&#x6253;&#x5305;&#x4E0D;&#x540C;&#x73AF;&#x5883;&#x4F7F;&#x7528;&#x4E0D;&#x540C;profile&#x6587;&#x4EF6;&#x7684;&#x505A;&#x6CD5;&#x5DF2;&#x7ECF;&#x5F88;&#x719F;&#x6089;&#x4E86;&#x3002;&#x6211;&#x6240;&#x5728;&#x7684;&#x9879;&#x76EE;&#x5206;&#x4E86;&#x597D;&#x591A;&#x4E2A;profile&#xFF0C;&#x6BCF;&#x4E2A;profile&#x5BF9;&#x5E94;&#x4E0D;&#x540C;&#x7684;properties&#xFF0C;&#x5982;&#x4E0B;&#x56FE;&#xFF1A;  </p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/fd7faff80ab855088efac1eb989e8d2ed59567258355585d9f8b34d443b7c251" alt="&#x591A;&#x4E2A;properties"></p>
<p>&#x591A;&#x4E2A;properties</p>
<p>&#x5728;&#x5F00;&#x53D1;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x51FA;&#x73B0;&#x5176;&#x4E2D;&#x67D0;&#x51E0;&#x4E2A;properties&#x7F16;&#x8BD1;&#x6253;&#x5305;&#x51FA;&#x6765;&#x7684;&#x5DE5;&#x7A0B;&#xFF0C;&#x5360;&#x4F4D;&#x7B26;&#x6CA1;&#x6709;&#x88AB;&#x66FF;&#x6362;&#xFF0C;&#x4F46;&#x662F;&#x5176;&#x4ED6;&#x7684;properties&#x5219;&#x6CA1;&#x6709;&#x95EE;&#x9898;&#x3002;war&#x5305;&#x4E2D;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x8FD8;&#x662F;&#x4F1A;&#x6709;${xxx.xxx.xxx}&#x7684;&#x5B57;&#x7B26;&#x3002;  </p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/b57e64b2395a3a568754f86ac352f0d03143d75079ab32d575438dac2919890b" alt="&#x591A;&#x4E2A;properties"></p>
<p>&#x591A;&#x4E2A;properties</p>
<h3 id="&#x5904;&#x7406;&#x601D;&#x8DEF;"><a href="#&#x5904;&#x7406;&#x601D;&#x8DEF;" class="headerlink" title="&#x5904;&#x7406;&#x601D;&#x8DEF;"></a>&#x5904;&#x7406;&#x601D;&#x8DEF;</h3><ul>
<li>&#x9996;&#x5148;&#x6392;&#x9664;&#x4E86;&#x7F16;&#x7801;&#x5931;&#x8BEF;&#xFF0C;&#x5B57;&#x7B26;&#x5199;&#x9519;&#x7B49;&#x7B49;&#x521D;&#x7EA7;&#x9519;&#x8BEF;</li>
<li>&#x7136;&#x540E;&#x6211;&#x6000;&#x7591;&#x662F;<em>maven-resources-plugin</em>&#x63D2;&#x4EF6;&#x5728;filter&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x51FA;&#x73B0;&#x5B57;&#x7B26;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x8FD9;&#x4E2A;&#x60F3;&#x6CD5;&#x662F;&#x7531;&#x4E8E;&#x5728;Maven&#x7684;resource&#x6253;&#x5305;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x89E6;&#x53D1;resources&#x7684;filter&#x64CD;&#x4F5C;&#x7684;&#x63D2;&#x4EF6;&#x5C31;&#x662F;<em>maven-resources-plugin</em>&#xFF0C;&#x6240;&#x4EE5;&#x51FA;&#x95EE;&#x9898;&#x4E00;&#x5B9A;&#x662F;&#x5728;&#x8FD9;&#x4E2A;&#x63D2;&#x4EF6;&#x7684;&#x5DE5;&#x4F5C;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x67E5;&#x770B;Maven&#x7684;package&#x8FC7;&#x7A0B;&#x65E5;&#x5FD7;&#xFF0C;&#x5982;&#x4E0B;&#x56FE;&#xFF1A;<br><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/ebc0a98aff8877f737547ac799f21d2b6e90ebaa094ff6d6d2051f2adabad765" alt="maven-resources-plugin&#x7684;&#x5DE5;&#x4F5C;&#x65E5;&#x5FD7;"></li>
</ul>
<p>maven-resources-plugin&#x7684;&#x5DE5;&#x4F5C;&#x65E5;&#x5FD7;</p>
<p>&#x65E5;&#x5FD7;&#x63D0;&#x793A;&#x4F7F;&#x7528;<em>UTF-8</em>&#x7684;&#x7F16;&#x7801;&#x683C;&#x5F0F;&#xFF0C;&#x62F7;&#x8D1D;&#x4E86;16&#x4E2A;&#x7ECF;&#x8FC7;filter&#x64CD;&#x4F5C;&#x7684;resource&#x6587;&#x4EF6;&#x3002;&#x7136;&#x540E;&#x6392;&#x9664;&#x4E86;properties&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x4E2D;&#x6587;&#x5E72;&#x6270;&#xFF0C;&#x4F46;&#x662F;&#x4F9D;&#x7136;&#x6CA1;&#x6709;&#x89E3;&#x51B3;&#x95EE;&#x9898;&#xFF0C;Maven&#x6253;&#x5305;&#x540E;&#x4F9D;&#x7136;&#x662F;&#x90A3;&#x51E0;&#x4E2A;properties&#x6CA1;&#x6709;&#x6709;&#x6548;&#x7684;&#x66FF;&#x6362;&#x5360;&#x4F4D;&#x7B26;&#x3002;</p>
<ul>
<li>&#x6682;&#x65F6;&#x6CA1;&#x6709;&#x5176;&#x4ED6;&#x89E3;&#x51B3;&#x601D;&#x8DEF;&#xFF0C;&#x53EA;&#x80FD;&#x9010;&#x5B57;&#x9010;&#x5B57;&#x7684;&#x5BF9;&#x6BD4;&#x80FD;&#x6210;&#x529F;&#x66FF;&#x6362;&#x5360;&#x4F4D;&#x7B26;&#x7684;properties&#x548C;&#x4E0D;&#x80FD;&#x6210;&#x529F;&#x66FF;&#x6362;&#x5360;&#x4F4D;&#x7B26;&#x7684;properties&#x3002;&#x8FD8;&#x7528;&#x4E0A;&#x4E86;&#x5404;&#x79CD;&#x5BF9;&#x6BD4;&#x5DE5;&#x5177;&#x3002;&#x7ED3;&#x5C40;&#x4F9D;&#x7136;&#x662F;&#x6CA1;&#x6709;&#x53D1;&#x73B0;&#x4EC0;&#x4E48;&#x5F02;&#x5E38;&#x7684;&#x5730;&#x65B9;&#x3002;</li>
</ul>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/04cf119738a004348f210f3ae0beb43a102afc9c38d56b6a36ae9c5d68e22f75" alt="&#x6587;&#x4EF6;&#x5B57;&#x7B26;&#x7684;&#x5BF9;&#x6BD4;"></p>
<p>&#x6587;&#x4EF6;&#x5B57;&#x7B26;&#x7684;&#x5BF9;&#x6BD4;</p>
<ul>
<li>&#x786E;&#x5B9A;&#x5B57;&#x7B26;&#x6CA1;&#x95EE;&#x9898;&#x540E;&#xFF0C;&#x6000;&#x7591;&#x662F;&#x6587;&#x4EF6;&#x672C;&#x8EAB;&#x7684;&#x95EE;&#x9898;&#x3002;&#x590D;&#x5236;&#x6B63;&#x5E38;&#x548C;&#x5F02;&#x5E38;&#x4E24;&#x79CD;properties&#x6587;&#x4EF6;&#xFF0C;&#x4FEE;&#x6539;&#x540D;&#x5B57;&#xFF0C;&#x4FEE;&#x6539;properties&#x91CC;&#x9762;&#x7684;&#x5185;&#x5BB9;&#x4FE1;&#x606F;&#x3002;&#x6253;&#x5305;&#x6D4B;&#x8BD5;&#x3002;&#x6D4B;&#x8BD5;&#x7684;&#x7ED3;&#x679C;&#x662F;&#xFF0C;&#x80FD;&#x6B63;&#x5E38;&#x66FF;&#x6362;&#x5360;&#x4F4D;&#x7B26;&#x7684;properties&#x590D;&#x5236;&#x51FA;&#x6765;&#x7684;&#x90FD;&#x80FD;&#x591F;&#x6B63;&#x5E38;&#x66FF;&#x6362;&#x5360;&#x4F4D;&#x7B26;&#xFF0C;&#x53CD;&#x4E4B;&#x4E0D;&#x80FD;&#x6B63;&#x786E;&#x66FF;&#x6362;&#x5360;&#x4F4D;&#x7B26;&#x7684;properties&#x590D;&#x5236;&#x51FA;&#x6765;&#x7684;&#x90FD;&#x4E0D;&#x80FD;&#x6B63;&#x5E38;&#x66FF;&#x6362;&#x5360;&#x4F4D;&#x7B26;&#x3002;&#x7531;&#x6B64;&#x53EF;&#x89C1;&#xFF0C;&#x8FD9;&#x4E24;&#x4E2A;properties&#x53EF;&#x80FD;&#x5728;&#x5B58;&#x6863;&#x7684;&#x65F6;&#x5019;&#x5C31;&#x5B58;&#x5728;&#x5DEE;&#x5F02;&#x3002;&#x4ECE;IDE&#x91CC;&#x590D;&#x5236;&#x5F02;&#x5E38;&#x7684;properties&#x4E2D;&#x7684;&#x5B57;&#x7B26;&#xFF0C;&#x5230;&#x8BB0;&#x4E8B;&#x672C;&#x91CC;&#x4FDD;&#x5B58;&#x5230;&#x672C;&#x5730;&#xFF0C;&#x679C;&#x7136;&#x662F;&#x5B58;&#x6863;&#x65F6;&#x7684;&#x7F16;&#x7801;&#x6709;&#x95EE;&#x9898;&#xFF0C;&#x800C;IDE&#x6CA1;&#x6709;&#x63D0;&#x793A;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;</li>
</ul>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/4198d04d707f5b27b3ab2a2d9883d0c8aa7b7534139259a93d76b2952d9aa5a0" alt="&#x5F02;&#x5E38;&#x7684;&#x5B57;&#x7B26;"></p>
<p>&#x5F02;&#x5E38;&#x7684;&#x5B57;&#x7B26;</p>
<ul>
<li>&#x6700;&#x540E;&#x66FF;&#x6362;&#x4E86;&#x6709;&#x5F02;&#x5E38;&#x7F16;&#x7801;&#x7684;&#x5B57;&#x7B26;&#xFF0C;&#x5C31;&#x80FD;&#x6210;&#x529F;&#x6253;&#x5305;&#x66FF;&#x6362;&#x4E86;&#x3002;</li>
</ul>
<h3 id="&#x5C0F;&#x7ED3;"><a href="#&#x5C0F;&#x7ED3;" class="headerlink" title="&#x5C0F;&#x7ED3;"></a>&#x5C0F;&#x7ED3;</h3><p>&#x5728;&#x6392;&#x9664;&#x4E86;&#x5927;&#x90E8;&#x5206;&#x4F4E;&#x7EA7;&#x9519;&#x8BEF;&#x540E;&#xFF0C;&#x4E0D;&#x8981;&#x76F2;&#x76EE;&#x8FDB;&#x884C;&#x6CA1;&#x6709;&#x5FC5;&#x8981;&#x7684;&#x76F2;&#x76EE;&#x6D4B;&#x8BD5;&#xFF0C;&#x6295;&#x77F3;&#x95EE;&#x8DEF;&#x867D;&#x7136;&#x662F;&#x4E0D;&#x9519;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x4F46;&#x662F;&#x5728;&#x6392;&#x9664;bug&#x65F6;&#xFF0C;&#x4E00;&#x6B65;&#x4E00;&#x6B65;&#x7684;&#x6295;&#x77F3;&#x95EE;&#x8DEF;&#x672A;&#x514D;&#x592A;&#x8FC7;&#x8017;&#x65F6;&#x3002;&#x6BD4;&#x65B9;&#x8BF4;&#x5728;&#x8FD9;&#x6B21;&#x7684;bug&#x89E3;&#x51B3;&#x4E2D;&#xFF0C;&#x5728;&#x6392;&#x9664;&#x4E86;&#x5927;&#x90E8;&#x5206;&#x4F4E;&#x7EA7;&#x9519;&#x8BEF;&#x540E;&#xFF0C;&#x4E0D;&#x5E94;&#x76F2;&#x76EE;&#x8FDB;&#x884C;&#x6D4B;&#x8BD5;&#xFF0C;&#x5984;&#x56FE;&#x4EE5;&#x6B64;&#x627E;&#x5230;&#x89E3;&#x51B3;&#x95EE;&#x9898;&#x7684;&#x529E;&#x6CD5;&#xFF0C;&#x800C;&#x5E94;&#x8BE5;&#x7AD9;&#x5728;&#x66F4;&#x9AD8;&#x5C42;&#x6B21;&#x7684;&#x89D2;&#x5EA6;&#x6765;&#x770B;&#x5F85;&#x95EE;&#x9898;&#x51FA;&#x73B0;&#x7684;&#x7F18;&#x7531;&#x3002;&#x6240;&#x4EE5;&#x5728;&#x4EE5;&#x540E;&#x7684;&#x7F16;&#x7801;&#x5B66;&#x4E60;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x5E94;&#x8BE5;&#x52A0;&#x5F3A;&#x81EA;&#x5DF1;&#x7684;&#x903B;&#x8F91;&#x601D;&#x7EF4;&#x80FD;&#x529B;&#xFF0C;&#x63D0;&#x9AD8;&#x5206;&#x6790;&#x89E3;&#x51B3;&#x95EE;&#x9898;&#x7684;&#x80FD;&#x529B;&#x3002;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/327a0e13c1752ee07bbab0d2dc8e11ad.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="../375/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="../../">1</a><span class="space">&hellip;</span><a class="page-number" href="../375/">375</a><span class="page-number current">376</span><a class="page-number" href="../377/">377</a><span class="space">&hellip;</span><a class="page-number" href="../399/">399</a><a class="extend next" rel="next" href="../377/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">开发者博客</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="https://dev.newban.cn/archives/">
              
                  <span class="site-state-item-count">3990</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">1304</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="../../atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">开发者博客</span>
  <div>
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
  </div>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




  <script type="text/javascript" async src="js/src/mermaid.min.js"></script>
  <script>
  if (window.mermaid) {
        var mermaid_config = {
            startOnLoad: true,
            theme: 'default',
            flowchart:{
                useMaxWidth: false,
                htmlLabels: true
            }                
        }
        mermaid.initialize(mermaid_config);
  }
  </script>
  

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="../../lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="../../lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="../../lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="../../lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="../../lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="../../lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="../../js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="../../js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="../../js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
