<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">
<meta name="referrer" content="never">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="../../lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="../../lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="../../css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="../../images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="../../images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="../../images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="../../images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">





  <link rel="alternate" href="../../atom.xml" title="开发者博客 – IT技术 尽在开发者博客" type="application/atom+xml">






<meta property="og:type" content="website">
<meta property="og:title" content="开发者博客 – IT技术 尽在开发者博客">
<meta property="og:url" content="https://dev.newban.cn/page/385/index.html">
<meta property="og:site_name" content="开发者博客 – IT技术 尽在开发者博客">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="开发者博客 – IT技术 尽在开发者博客">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>
<!--谷歌广告验证代码-->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-2626449904708114",
          enable_page_level_ads: true
     });
</script>
<!--谷歌广告验证代码-->



  <link rel="canonical" href="https://dev.newban.cn/page/385/">





  <title>开发者博客 – IT技术 尽在开发者博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">开发者博客 – IT技术 尽在开发者博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">开发者博客 – 科技是第一生产力</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="http://dev.newban.cn/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="https://dev.newban.cn/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903512531288072.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903512531288072.html" itemprop="url">对象池的一个 race condition</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-20T14:34:24+08:00">
                2017-11-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x62D9;&#x4F5C;&#x300A;Linux &#x591A;&#x7EBF;&#x7A0B;&#x670D;&#x52A1;&#x7AEF;&#x7F16;&#x7A0B;&#x300B;&#x7B2C; 1.11 &#x8282;&#x4ECB;&#x7ECD;&#x4E86;&#x5982;&#x4F55;&#x7528; shared_ptr/weak_ptr &#x5B9E;&#x73B0;&#x5BF9;&#x8C61;&#x6C60;&#xFF0C;&#x6700;&#x8FD1;&#x6709;&#x8BFB;&#x8005;&#x6307;&#x51FA;&#x5BF9;&#x8C61;&#x9500;&#x6BC1;&#x6709; race condition&#x3002;&#x672C;&#x6587;&#x4ECB;&#x7ECD;&#x4E00;&#x4E0B;&#x590D;&#x73B0;&#x53CA;&#x4FEE;&#x590D;&#x7684;&#x65B9;&#x6CD5;&#x3002;</p>
<p>&#x4ECE;&#x7B2C; 22 &#x9875;&#x7684; version 3 &#x5F00;&#x59CB;&#x7684;&#x4EE3;&#x7801;&#x6709;&#x8FD9;&#x4E2A; race condition&#xFF0C;&#x5305;&#x62EC;&#x7B2C; 1.11.1 &#x8282;&#x7684; version 4 &#x548C;&#x7B2C; 1.11.2 &#x8282;&#x7684;&#x5F31;&#x56DE;&#x8C03;&#x7248;&#xFF0C;&#x89C1;<a href="/external_links/351d20d415653c6d097acc099231e4c2.html" target="blank" rel="noopener">&#x8BD5;&#x8BFB;&#x6837;&#x5F20;</a>&#xFF0C;&#x914D;&#x5957;&#x4EE3;&#x7801;&#x89C1; <a href="/external_links/351d20d415653c6d097acc099231e4c2.html" target="blank" rel="noopener">GitHub</a>&#x3002;&#x8FD9;&#x4E2A;<br> race condition &#x518D;&#x6B21;&#x9A8C;&#x8BC1;&#x4E86;&#x5BF9;&#x8C61;&#x7684;&#x9500;&#x6BC1;&#x6BD4;&#x521B;&#x5EFA;&#x66F4;&#x96BE;&#x3002;</p>
<h2 id="Race-condition"><a href="#Race-condition" class="headerlink" title="Race condition"></a>Race condition</h2><p>&#x4E3A;&#x4E86;&#x7A81;&#x51FA;&#x91CD;&#x70B9;&#xFF0C;&#x672C;&#x6587;&#x4EE5; version 3 &#x4E3A;&#x4F8B;&#xFF0C;&#x4ECB;&#x7ECD; race condition &#x7684;&#x6210;&#x56E0;&#x53CA;&#x4FEE;&#x590D;&#x65B9;&#x6CD5;&#xFF0C;&#x5B8C;&#x6574;&#x4EE3;&#x7801;&#xFF08;&#x5305;&#x62EC;&#x4FEE;&#x590D;&#xFF09;&#x89C1; <a href="/external_links/351d20d415653c6d097acc099231e4c2.html" target="blank" rel="noopener">GitHub</a>&#x3002;&#x4E3A;&#x4E86;&#x4FBF;&#x4E8E;&#x4E0B;&#x6587;&#x8BA8;&#x8BBA;&#xFF0C;&#x6211;&#x628A; version 3 &#x4EE3;&#x7801;&#x7684;&#x4EE3;&#x7801;&#x7528; C++11 &#x91CD;&#x65B0;&#x5B9E;&#x73B0;&#xFF0C;&#x8D34;&#x5728;&#x8FD9;&#x91CC;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;class Stock : boost::noncopyable</span><br><span class="line">{</span><br><span class="line"> public:</span><br><span class="line">  Stock(const string&amp; name)</span><br><span class="line">    : name_(name)</span><br><span class="line">  {</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  const string&amp; key() const { return name_; }</span><br><span class="line"></span><br><span class="line"> private:</span><br><span class="line">  string name_;</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">// &#x5BF9;&#x8C61;&#x6C60;</span><br><span class="line">class StockFactory : boost::noncopyable</span><br><span class="line">{</span><br><span class="line"> public:</span><br><span class="line"></span><br><span class="line">  std::shared_ptr&lt;Stock&gt; get(const string&amp; key)</span><br><span class="line">  {</span><br><span class="line">    std::shared_ptr&lt;Stock&gt; pStock;</span><br><span class="line">    muduo::MutexLockGuard lock(mutex_);</span><br><span class="line">    std::weak_ptr&lt;Stock&gt;&amp; wkStock = stocks_[key];</span><br><span class="line">    pStock = wkStock.lock();</span><br><span class="line">    if (!pStock)</span><br><span class="line">    {</span><br><span class="line">      pStock.reset(new Stock(key),</span><br><span class="line">                   [this] (Stock* stock) { deleteStock(stock); });</span><br><span class="line">      wkStock = pStock;</span><br><span class="line">    }</span><br><span class="line">    return pStock;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line"> private:</span><br><span class="line"></span><br><span class="line">  void deleteStock(Stock* stock)</span><br><span class="line">  {</span><br><span class="line">    if (stock)</span><br><span class="line">    {</span><br><span class="line">      muduo::MutexLockGuard lock(mutex_);</span><br><span class="line">      stocks_.erase(stock-&gt;key());</span><br><span class="line">    }</span><br><span class="line">    delete stock;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  mutable muduo::MutexLock mutex_;</span><br><span class="line">  std::unordered_map&lt;string, std::weak_ptr&lt;Stock&gt; &gt; stocks_;</span><br><span class="line">};</span><br></pre></td></tr></table></figure>

<p>Race condition &#x53D1;&#x751F;&#x5728; StockFactory::deleteStock() &#x8FD9;&#x4E2A;&#x6210;&#x5458;&#x51FD;&#x6570;&#x91CC;&#xFF0C;&#x5982;&#x679C;&#x8FDB;&#x5165; deleteStock &#x4E4B;&#x540E;&#xFF0C;&#x5728; lock &#x4E4B;&#x524D;&#xFF0C;&#x6709;&#x522B;&#x7684;&#x7EBF;&#x7A0B;&#x8C03;&#x7528;&#x4E86;&#x76F8;&#x540C; key &#x7684; StockFactory::get()&#xFF0C;&#x4F1A;&#x9020;&#x6210;&#x6B64; key &#x88AB;&#x4ECE; stocks_ &#x54C8;&#x5E0C;&#x8868;&#x4E2D;&#x9519;&#x8BEF;&#x5730;&#x5220;&#x9664;&#xFF0C;&#x56E0;&#x6B64;&#x4F1A;&#x91CD;&#x590D;&#x521B;&#x5EFA; Stock &#x5BF9;&#x8C61;&#x3002;&#x7A0B;&#x5E8F;&#x4E0D;&#x4F1A; crash &#x4E5F;&#x4E0D;&#x4F1A;&#x6709; memory leak&#xFF0C;&#x4F46;&#x662F;&#x7A0B;&#x5E8F;&#x4E2D;&#x5B58;&#x5728;&#x4E24;&#x4E2A;&#x76F8;&#x540C; key &#x7684; Stock &#x5BF9;&#x8C61;&#xFF0C;&#x8FDD;&#x80CC;&#x4E86;&#x5BF9;&#x8C61;&#x6C60;&#x5E94;&#x6709;&#x7684;&#x8BED;&#x610F;&#x3002;&#x4E0B;&#x56FE;&#x63CF;&#x7ED8;&#x4E86; race<br> condition &#x7684;&#x53D1;&#x751F;&#x8FC7;&#x7A0B;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/c60b062a3a7f9e90da4714f26bbbb84874ce0484ec8ca5a923c7718e08a91c6e" alt><br>&#x590D;&#x73B0;<br>&#x2013;</p>
<p>&#x8FD9;&#x4E2A; race condition &#x53EF;&#x4EE5;&#x7528; sleep() &#x5F88;&#x5BB9;&#x6613;&#x5730;&#x590D;&#x73B0;&#x51FA;&#x6765;&#xFF0C;&#x89C1; <a href="/external_links/351d20d415653c6d097acc099231e4c2.html" target="blank" rel="noopener">GitHub</a> &#x4E0A;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x7F16;&#x8BD1;&#x65F6;&#x987B;&#x5B9A;&#x4E49; REPRODUCE_BUG &#x8FD9;&#x4E2A;&#x5B8F;&#x3002;</p>
<h2 id="&#x4FEE;&#x590D;"><a href="#&#x4FEE;&#x590D;" class="headerlink" title="&#x4FEE;&#x590D;"></a>&#x4FEE;&#x590D;</h2><p>&#x4FEE;&#x590D;&#x8FD9;&#x4E2A; race condition &#x7684;&#x529E;&#x6CD5;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x5728; deleteStock() &#x4E2D;&#xFF0C;&#x62FF;&#x5230; lock &#x4E4B;&#x540E;&#xFF0C;&#x68C0;&#x67E5;&#x4E00;&#x4E0B; weak_ptr &#x662F;&#x5426; expired()&#xFF0C;&#x7136;&#x540E;&#x53EA;&#x5728; expired() &#x4E3A; true &#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x4ECE; stocks_ &#x4E2D;&#x5220;&#x6389; key&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;void deleteStock(Stock* stock)</span><br><span class="line">  {</span><br><span class="line">    if (stock)</span><br><span class="line">    {</span><br><span class="line">      muduo::MutexLockGuard lock(mutex_);</span><br><span class="line">      auto it = stocks_.find(stock-&gt;key());</span><br><span class="line">      assert(it != stocks_.end());</span><br><span class="line">      if (it-&gt;second.expired())</span><br><span class="line">      {</span><br><span class="line">        stocks_.erase(it);</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">    delete stock;</span><br><span class="line">  }</span><br></pre></td></tr></table></figure>

<p>&#x4FEE;&#x590D;&#x4E4B;&#x540E;&#xFF0C;&#x539F;&#x6765;&#x7684; race condition &#x4E0D;&#x590D;&#x5B58;&#x5728;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/26141b967b2d7455a2ea2c7295f363e6ae452c09819fad9627c4d58f705637eb" alt><br>&#x601D;&#x8003;&#x9898;</p>
<hr>
<p>&#x5982;&#x679C;&#x628A;&#x6761;&#x4EF6; if (it-&gt;second.expired()) &#x6539;&#x6210; if (!it-&gt;second.lock())&#xFF0C;&#x5373;&#x8BD5;&#x7740;&#x5C06; weak_ptr &#x63D0;&#x5347;&#x4E3A; shared_ptr&#xFF0C;&#x5982;&#x679C;&#x63D0;&#x5347;&#x4E0D;&#x6210;&#x529F;&#xFF0C;&#x5219; erase key&#xFF0C;&#x8FD9;&#x6837;&#x505A;&#x6709;&#x6CA1;&#x6709;&#x95EE;&#x9898;&#xFF1F;</p>
<p>&#x8FD9;&#x6837;&#x505A;&#x6709;&#x53EF;&#x80FD;&#x9020;&#x6210;&#x6B7B;&#x9501;&#xFF0C;&#x56E0;&#x4E3A; muduo Mutex &#x662F;<a href="/external_links/351d20d415653c6d097acc099231e4c2.html" target="blank" rel="noopener">&#x4E0D;&#x53EF;&#x91CD;&#x5165;</a>&#x7684;&#x3002;race condition&#xFF1A;&#x5982;&#x679C; weak_ptr::lock() &#x6210;&#x529F;&#xFF0C;&#x62FF;&#x5230;&#x4E00;&#x4E2A; shared_ptr &#xFF08;use_count &#x5E94;&#x8BE5; &gt; 1&#xFF09;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x6B64; shared_ptr &#x6790;&#x6784;&#x4E4B;&#x524D;&#xFF0C;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x91CA;&#x653E;&#x4E86;&#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;&#xFF0C;&#x4F7F;&#x5F97; use_count<br> &#x964D;&#x4E3A; 1&#xFF0C;&#x90A3;&#x4E48;&#x5F53;&#x6B64; shared_ptr &#x6790;&#x6784;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x9012;&#x5F52;&#x8C03;&#x7528; deleteStock()&#xFF0C;&#x4ECE;&#x800C;&#x9020;&#x6210;&#x6B7B;&#x9501;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/791cf1195a95c76fb4d52d84628573c26170f383c6fa2f47c3fb0a8b02592fc0" alt><br>&#x9898;&#x56FE;<br>&#x2013;</p>
<p>Herb Sutter &#x5728; CppCon2016 &#x4E0A;&#x4E5F;&#x63D0;&#x5230;&#x4E86;&#x7C7B;&#x4F3C;&#x7684;&#x5BF9;&#x8C61;&#x6C60;&#x6280;&#x672F;&#xFF0C;&#x4ED6;&#x7684;&#x5B9E;&#x73B0;&#x5BF9;&#x5E94;&#x4E66;&#x4E2D;&#x7684; version 2&#xFF0C;&#x6CA1;&#x6709;&#x8FD9;&#x4E2A; race condition&#xFF0C;&#x4F46;&#x5BF9;&#x8C61;&#x6C60;&#x7684;&#x5927;&#x5C0F;&#x53EA;&#x589E;&#x4E0D;&#x51CF;&#x3002;&#x6F14;&#x8BB2;&#x89C6;&#x9891;&#xFF1A;<a href="/external_links/351d20d415653c6d097acc099231e4c2.html" target="blank" rel="noopener">My CppCon talk video is online</a>&#xFF0C;&#x5E7B;&#x706F;&#x7247;&#xFF1A;<br> <a href="/external_links/351d20d415653c6d097acc099231e4c2.html" target="blank" rel="noopener">CppCon/CppCon2016</a>&#x3002;</p>
<h2 id="&#x9898;&#x5916;&#x8BDD;"><a href="#&#x9898;&#x5916;&#x8BDD;" class="headerlink" title="&#x9898;&#x5916;&#x8BDD;"></a>&#x9898;&#x5916;&#x8BDD;</h2><p>&#x627F;&#x8499;&#x8BFB;&#x8005;&#x539A;&#x7231;&#xFF0C;&#x300A;Linux &#x591A;&#x7EBF;&#x7A0B;&#x670D;&#x52A1;&#x7AEF;&#x7F16;&#x7A0B;&#x300B;&#x81EA;&#x4ECE; 2013 &#x5E74; 1 &#x6708;&#x9762;&#x4E16;&#x4EE5;&#x6765;&#xFF0C;&#x622A;&#x81F3; 2017 &#x5E74; 11 &#x6708;&#xFF0C;&#x7D2F;&#x8BA1;&#x5370;&#x5237; 10 &#x6B21;&#xFF0C;&#x5370;&#x6570;&#x5171; 2 &#x4E07;&#x518C;&#x3002;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/a5402ca816497f2d349f62a881bd57b1.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903511780491277.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903511780491277.html" itemprop="url">深入理解JVM类文件格式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-20T14:17:25+08:00">
                2017-11-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x6211;&#x4EEC;&#x77E5;&#x9053;Java&#x6700;&#x6709;&#x540D;&#x7684;&#x5BA3;&#x4F20;&#x53E3;&#x53F7;&#x5C31;&#x662F;&#xFF1A;<strong>&#x201C;&#x4E00;&#x6B21;&#x7F16;&#x5199;&#xFF0C;&#x5230;&#x5904;&#x8FD0;&#x884C;&#xFF08;Write Once&#xFF0C;Run Anywhere&#xFF09;&#x201D;</strong>&#xFF0C;&#x800C;&#x5176;&#x5E73;&#x53F0;&#x65E0;&#x5173;&#x6027;&#x5219;&#x662F;&#x4F9D;&#x8D56;&#x4E8E;JVM&#xFF0C; &#x6240;&#x6709;&#x7684;java&#x6587;&#x4EF6;&#x90FD;&#x88AB;&#x7F16;&#x8BD1;&#x6210;&#x5B57;&#x8282;&#x7801;&#xFF08;class&#xFF09;&#x6587;&#x4EF6;&#xFF0C;&#x800C;&#x865A;&#x62DF;&#x673A;&#x53EA;&#x9700;&#x8981;&#x8BA4;&#x8BC6;&#x5B57;&#x8282;&#x7801;&#x6587;&#x4EF6;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;&#x60F3;&#x8981;&#x5F04;&#x61C2;&#x865A;&#x62DF;&#x673A;&#x4EE5;&#x53CA;&#x7C7B;&#x52A0;&#x8F7D;&#x673A;&#x5236;&#xFF0C;&#x8FD9;&#x90E8;&#x5206;&#x5185;&#x5BB9;&#x662F;&#x4E0D;&#x53EF;&#x4E0D;&#x77E5;&#x7684;&#x3002;  </p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/569427a550ff692dd3b12623fda1876d3962ff4915af934941b6ed2697bde0b5" alt="JVM"></p>
<p>JVM</p>
<p>Class&#x6587;&#x4EF6;&#x662F;&#x4E00;&#x7EC4;&#x4EE5;8&#x5B57;&#x8282;&#x4E3A;&#x57FA;&#x7840;&#x5355;&#x4F4D;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x6D41;&#xFF0C;&#x6240;&#x6709;&#x6570;&#x636E;&#x65E0;&#x95F4;&#x9694;&#x7684;&#x6392;&#x5217;&#x5728;Class&#x6587;&#x4EF6;&#x4E4B;&#x4E2D;&#xFF0C;&#x591A;&#x5B57;&#x8282;&#x6570;&#x636E;&#x4EE5;&#x5927;&#x7AEF;(big-endian order)&#x7684;&#x65B9;&#x5F0F;&#x5B58;&#x50A8;&#x3002;Class&#x6587;&#x4EF6;&#x4EE5;&#x4E00;&#x79CD;&#x63A5;&#x8FD1;&#x4E8E;C&#x4E2D;&#x7ED3;&#x6784;&#x4F53;&#x7684;&#x4F2A;&#x4EE3;&#x7801;&#x5F62;&#x5F0F;&#x5B58;&#x50A8;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF0C;&#x5E76;&#x4E14;&#x53EA;&#x5305;&#x542B;&#x65E0;&#x7B26;&#x53F7;&#x6570;&#x548C;&#x8868;&#x4E24;&#x79CD;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF1A;</p>
<ul>
<li><strong>&#x65E0;&#x7B26;&#x53F7;&#x6570;</strong>:u1&#x3001;u2&#x3001;u4&#x3001;u8&#x5206;&#x522B;&#x8868;1&#x3001;2&#x3001;4&#x3001;8&#x5B57;&#x8282;&#x7684;&#x65E0;&#x7B26;&#x53F7;&#x6570;</li>
<li><strong>&#x8868;</strong>&#xFF1A; &#x7531;&#x591A;&#x4E2A;&#x65E0;&#x7B26;&#x53F7;&#x6570;&#x6216;&#x8005;&#x5176;&#x4ED6;&#x8868;&#x7EC4;&#x6210;&#x7684;&#x590D;&#x5408;&#x6570;&#x636E;&#x7C7B;&#x578B;&#xFF0C; Class&#x6587;&#x4EF6;&#x672C;&#x8EAB;&#x4E5F;&#x662F;&#x4E00;&#x5F20;&#x8868;&#x3002;</li>
</ul>
<p>Class&#x8868;&#x7ED3;&#x6784;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;ClassFile {</span><br><span class="line">    u4             magic;</span><br><span class="line">    u2             minor_version;</span><br><span class="line">    u2             major_version;</span><br><span class="line">    u2             constant_pool_count;</span><br><span class="line">    cp_info        constant_pool[constant_pool_count-1];</span><br><span class="line">    u2             access_flags;</span><br><span class="line">    u2             this_class;</span><br><span class="line">    u2             super_class;</span><br><span class="line">    u2             interfaces_count;</span><br><span class="line">    u2             interfaces[interfaces_count];</span><br><span class="line">    u2             fields_count;</span><br><span class="line">    field_info     fields[fields_count];</span><br><span class="line">    u2             methods_count;</span><br><span class="line">    method_info    methods[methods_count];</span><br><span class="line">    u2             attributes_count;</span><br><span class="line">    attribute_info attributes[attributes_count];</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x53C2;&#x7167;&#x4E0A;&#x9762;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF0C;Class&#x6587;&#x4EF6;&#x7531;10&#x4E2A;&#x90E8;&#x5206;&#x7EC4;&#x6210;&#xFF1A;<br>1 . &#x9B54;&#x6570;<br>2 . Class&#x6587;&#x4EF6;&#x4E3B;&#x6B21;&#x7248;&#x672C;&#x53F7;<br>3 . &#x5E38;&#x91CF;&#x6C60;<br>4 . &#x8BBF;&#x95EE;&#x6807;&#x8BB0;<br>5 . &#x5F53;&#x524D;&#x7C7B;&#x540D;<br>6 . &#x7236;&#x7C7B;&#x540D;<br>7 . &#x7EE7;&#x627F;&#x7684;&#x63A5;&#x53E3;&#x540D;<br>8 . &#x5305;&#x542B;&#x7684;&#x6240;&#x6709;&#x5B57;&#x6BB5;&#x7684;&#x6570;&#x91CF;+&#x5B57;&#x6BB5;<br>9 . &#x5305;&#x542B;&#x7684;&#x6240;&#x6709;&#x65B9;&#x6CD5;&#x7684;&#x6570;&#x91CF;+&#x65B9;&#x6CD5;<br>10 . &#x5305;&#x542B;&#x7684;&#x6240;&#x6709;&#x5C5E;&#x6027;&#x7684;&#x6570;&#x91CF;+&#x5C5E;&#x6027;</p>
<p><strong>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x4F9D;&#x6B21;&#x5BF9;&#x6BCF;&#x4E2A;&#x90E8;&#x5206;&#x8FDB;&#x884C;&#x5206;&#x6790;&#xFF1A;</strong></p>
<h3 id="1-&#x9B54;&#x6570;"><a href="#1-&#x9B54;&#x6570;" class="headerlink" title="1. &#x9B54;&#x6570;"></a>1. &#x9B54;&#x6570;</h3><p><strong>&#x9B54;&#x6570;&#xFF08;Magic number&#xFF09;</strong>&#x7528;&#x6765;&#x786E;&#x5B9A;&#x6587;&#x4EF6;&#x7C7B;&#x578B;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x662F;&#x68C0;&#x6D4B;&#x6587;&#x4EF6;&#x662F;&#x5426;&#x662F;&#x80FD;&#x591F;&#x88AB;&#x865A;&#x62DF;&#x673A;&#x63A5;&#x53D7;&#x7684;Class&#x6587;&#x4EF6;&#x3002;&#x5F88;&#x591A;&#x6587;&#x4EF6;&#x90FD;&#x4F7F;&#x7528;&#x9B54;&#x6570;&#x6765;&#x786E;&#x5B9A;&#x6587;&#x4EF6;&#x7C7B;&#x578B;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x6269;&#x5C55;&#x540D;&#xFF08;&#x56E0;&#x4E3A;&#x6269;&#x5C55;&#x540D;&#x53EF;&#x4EE5;&#x4EFB;&#x610F;&#x4FEE;&#x6539;&#xFF09;&#x3002;&#x53EF;&#x4EE5;&#x53C2;&#x770B;&#x6211;&#x7684;<a href="/external_links/4d5ba67e7f48ac452ad6d2cf9f62a59d.html" target="blank" rel="noopener">&#x6DF1;&#x5165;&#x7406;&#x89E3;&#x7A0B;&#x5E8F;&#x6784;&#x9020;&#xFF08;&#x4E00;&#xFF09;</a>&#x3002;</p>
<p> Class&#x6587;&#x4EF6;&#x7684;&#x9B54;&#x6570;&#x662F;&#x201C;0xcafebabe&#x201D;&#xFF0C;&#x5496;&#x5561;&#x5B9D;&#x8D1D;&#xFF1F;Java&#x672C;&#x8EAB;&#x4E5F;&#x662F;&#x4E00;&#x79CD;&#x722A;&#x54C7;&#x5496;&#x5561;&#xFF0C;&#x771F;&#x662F;&#x633A;&#x6709;&#x7F18;&#x7684;&#x3002;<br>&#x8FD9;&#x91CC;&#x6211;&#x4E5F;&#x5199;&#x4E2A;&#x5C0F;&#x7684;&#x6D4B;&#x8BD5;&#x7A0B;&#x5E8F;&#xFF0C;&#x6765;&#x770B;&#x770B;&#x5B83;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x7801;&#x6D41;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;package com.shuqing28;</span><br><span class="line"></span><br><span class="line">public class TestClass {</span><br><span class="line">    private int m;</span><br><span class="line">    public int inc() {</span><br><span class="line">        return m+1;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x6211;&#x4EEC;&#x4F7F;&#x7528;javac&#x7F16;&#x8BD1;&#x6210;.class&#x6587;&#x4EF6;&#xFF0C;Windows&#x4E0B;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;WinHex&#x6253;&#x5F00;&#xFF0C;Linux&#x4E0B;&#x5219;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;hexdump&#x6253;&#x5F00;&#x4E8C;&#x8FDB;&#x5236;&#xFF0C;&#x547D;&#x4EE4;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;$ hexdump -C TestClass.class </span><br><span class="line">00000000  ca fe ba be 00 00 00 34  00 16 0a 00 04 00 12 09  |.......4........|</span><br><span class="line">00000010  00 03 00 13 07 00 14 07  00 15 01 00 01 6d 01 00  |.............m..|</span><br><span class="line">00000020  01 49 01 00 06 3c 69 6e  69 74 3e 01 00 03 28 29  |.I...&lt;init&gt;...()|</span><br><span class="line">00000030  56 01 00 04 43 6f 64 65  01 00 0f 4c 69 6e 65 4e  |V...Code...LineN|</span><br><span class="line">00000040  75 6d 62 65 72 54 61 62  6c 65 01 00 12 4c 6f 63  |umberTable...Loc|</span><br><span class="line">00000050  61 6c 56 61 72 69 61 62  6c 65 54 61 62 6c 65 01  |alVariableTable.|</span><br><span class="line">00000060  00 04 74 68 69 73 01 00  19 4c 63 6f 6d 2f 73 68  |..this...Lcom/sh|</span><br><span class="line">00000070  75 71 69 6e 67 32 38 2f  54 65 73 74 43 6c 61 73  |uqing28/TestClas|</span><br><span class="line">00000080  73 3b 01 00 03 69 6e 63  01 00 03 28 29 49 01 00  |s;...inc...()I..|</span><br><span class="line">00000090  0a 53 6f 75 72 63 65 46  69 6c 65 01 00 0e 54 65  |.SourceFile...Te|</span><br><span class="line">000000a0  73 74 43 6c 61 73 73 2e  6a 61 76 61 0c 00 07 00  |stClass.java....|</span><br><span class="line">000000b0  08 0c 00 05 00 06 01 00  17 63 6f 6d 2f 73 68 75  |.........com/shu|</span><br><span class="line">000000c0  71 69 6e 67 32 38 2f 54  65 73 74 43 6c 61 73 73  |qing28/TestClass|</span><br><span class="line">000000d0  01 00 10 6a 61 76 61 2f  6c 61 6e 67 2f 4f 62 6a  |...java/lang/Obj|</span><br><span class="line">000000e0  65 63 74 00 21 00 03 00  04 00 00 00 01 00 02 00  |ect.!...........|</span><br><span class="line">000000f0  05 00 06 00 00 00 02 00  01 00 07 00 08 00 01 00  |................|</span><br><span class="line">00000100  09 00 00 00 2f 00 01 00  01 00 00 00 05 2a b7 00  |..../........*..|</span><br><span class="line">00000110  01 b1 00 00 00 02 00 0a  00 00 00 06 00 01 00 00  |................|</span><br><span class="line">00000120  00 03 00 0b 00 00 00 0c  00 01 00 00 00 05 00 0c  |................|</span><br><span class="line">00000130  00 0d 00 00 00 01 00 0e  00 0f 00 01 00 09 00 00  |................|</span><br><span class="line">00000140  00 31 00 02 00 01 00 00  00 07 2a b4 00 02 04 60  |.1........*....`|</span><br><span class="line">00000150  ac 00 00 00 02 00 0a 00  00 00 06 00 01 00 00 00  |................|</span><br><span class="line">00000160  06 00 0b 00 00 00 0c 00  01 00 00 00 07 00 0c 00  |................|</span><br><span class="line">00000170  0d 00 00 00 01 00 10 00  00 00 02 00 11           |.............|</span><br><span class="line">0000017d</span><br></pre></td></tr></table></figure>

<p>&#x770B;&#x7B2C;&#x4E00;&#x884C;&#x7684;&#x524D;4&#x4E2A;&#x5B57;&#x8282;&#x7684;&#x5341;&#x516D;&#x8FDB;&#x5236;&#x5C31;&#x662F;<code>0xcafebabe</code>&#xFF0C;&#x6240;&#x4EE5;&#x6587;&#x4EF6;&#x7C7B;&#x578B;&#x786E;&#x5B9E;&#x4E3A;<strong>.class</strong>&#x6587;&#x4EF6;&#x3002;</p>
<h3 id="2-&#x7248;&#x672C;&#x53F7;"><a href="#2-&#x7248;&#x672C;&#x53F7;" class="headerlink" title="2. &#x7248;&#x672C;&#x53F7;"></a>2. &#x7248;&#x672C;&#x53F7;</h3><p>&#x7B2C;5&#x548C;&#x7B2C;6&#x5B57;&#x8282;&#x662F;&#x6B21;&#x7248;&#x672C;&#x53F7;&#xFF08;Minor Version&#xFF09;&#xFF0C;&#x7B2C;7&#x548C;&#x7B2C;8&#x5B57;&#x8282;&#x662F;&#x4E3B;&#x7248;&#x672C;&#x53F7;&#xFF08;Major Version&#xFF09;&#x3002;&#x8FD9;&#x91CC;&#x770B;&#x51FA;&#x6211;&#x4EEC;&#x7684;&#x4E3B;&#x7248;&#x672C;&#x53F7;&#x662F;<code>0x0034</code>&#xFF0C;&#x4E5F;&#x5C31;&#x662F;52&#xFF0C;&#x4E0B;&#x9762;&#x662F;JDK&#x4E0E;&#x5176;&#x5BF9;&#x5E94;&#x7684;&#x7248;&#x672C;&#x53F7;&#x5173;&#x7CFB;&#xFF1A;</p>
<blockquote>
<p>JDK 1.8 = 52<br>JDK 1.7 = 51<br>JDK 1.6 =50<br>JDK 1.5 = 49<br>JDK 1.4 = 48<br>JDK 1.3 = 47<br>JDK 1.2 = 46<br>JDK 1.1 = 45</p>
</blockquote>
<p>&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x6211;&#x4F7F;&#x7528;&#x7684;&#x662F;Java8&#x7F16;&#x8BD1;&#x7684;&#x4EE3;&#x7801;&#x3002;</p>
<h3 id="3-&#x5E38;&#x91CF;&#x6C60;"><a href="#3-&#x5E38;&#x91CF;&#x6C60;" class="headerlink" title="3. &#x5E38;&#x91CF;&#x6C60;"></a>3. &#x5E38;&#x91CF;&#x6C60;</h3><p>&#x6211;&#x4EEC;&#x7EE7;&#x7EED;&#x770B;&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;&#x7684;&#x7B2C;&#x4E00;&#x884C;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;00000000  ca fe ba be 00 00 00 34  00 16 0a 00 04 00 12 09  |.......4........|</span><br></pre></td></tr></table></figure>

<p>&#x5728;&#x4E3B;&#x7248;&#x672C;&#x53F7;<code>0x0034</code>&#x540E;&#x7684;&#x662F;<code>0x0016</code>&#xFF0C;&#x8FD9;&#x4E2A;&#x503C;&#x8868;&#x793A;&#x5E38;&#x91CF;&#x6C60;&#x7684;&#x5BB9;&#x91CF;&#x3002;&#x5E38;&#x91CF;&#x6C60;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;Class&#x6587;&#x4EF6;&#x7684;&#x8D44;&#x6E90;&#x4ED3;&#x5E93;&#xFF0C;&#x5E38;&#x91CF;&#x6C60;&#x4E2D;&#x5305;&#x542B;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x662F;&#x8FD9;&#x6837;&#x7684;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;cp_info {</span><br><span class="line">    u1 tag;</span><br><span class="line">    u1 info[];</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5E38;&#x91CF;&#x6C60;&#x4E2D;&#x7684;&#x6BCF;&#x4E2A;&#x9879;&#x76EE;&#x90FD;&#x5305;&#x542B;&#x4E00;&#x4E2A;tag&#x5F00;&#x5934;&#x7684;cp_info&#x5BF9;&#x8C61;&#xFF0C;&#x4EE3;&#x8868;&#x7740;&#x5E38;&#x91CF;&#x7C7B;&#x578B;&#xFF0C;info&#x5219;&#x6839;&#x636E;&#x4E0D;&#x540C;&#x7684;&#x7C7B;&#x578B;&#x5404;&#x6709;&#x5404;&#x7684;&#x7ED3;&#x6784;&#x3002;&#x76EE;&#x524D;&#x4E00;&#x5171;&#x6709;14&#x79CD;&#x5E38;&#x91CF;&#x7C7B;&#x578B;&#xFF1A;</p>
<table>
<thead>
<tr>
<th>Constant Type</th>
<th>Value</th>
</tr>
</thead>
<tbody><tr>
<td>CONSTANT_Class</td>
<td>7</td>
</tr>
<tr>
<td>CONSTANT_Fieldref</td>
<td>9</td>
</tr>
<tr>
<td>CONSTANT_Methodref</td>
<td>10</td>
</tr>
<tr>
<td>CONSTANT_InterfaceMethodref</td>
<td>11</td>
</tr>
<tr>
<td>CONSTANT_String</td>
<td>8</td>
</tr>
<tr>
<td>CONSTANT_Integer</td>
<td>3</td>
</tr>
<tr>
<td>CONSTANT_Float</td>
<td>4</td>
</tr>
<tr>
<td>CONSTANT_Long</td>
<td>5</td>
</tr>
<tr>
<td>CONSTANT_Double</td>
<td>6</td>
</tr>
<tr>
<td>CONSTANT_NameAndType</td>
<td>12</td>
</tr>
<tr>
<td>CONSTANT_Utf8</td>
<td>1</td>
</tr>
<tr>
<td>CONSTANT_MethodHandle</td>
<td>15</td>
</tr>
<tr>
<td>CONSTANT_MethodType</td>
<td>16</td>
</tr>
<tr>
<td>CONSTANT_InvokeDynamic</td>
<td>18</td>
</tr>
</tbody></table>
<p>&#x4E0A;&#x9762;&#x7684;<code>0x0016</code>&#x7FFB;&#x8BD1;&#x6210;&#x5341;&#x8FDB;&#x5236;&#x662F;22&#xFF0C;&#x90A3;&#x4E48;&#x5E38;&#x91CF;&#x6C60;&#x4E2D;&#x6709;21&#x4E2A;&#x5E38;&#x91CF;&#xFF0C;&#x56E0;&#x4E3A;&#x5E38;&#x91CF;&#x6C60;&#x4E2D;&#x7D22;&#x5F15;&#x662F;&#x4ECE;1&#x5F00;&#x59CB;&#x8BA1;&#x6570;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x5E38;&#x91CF;&#x7D22;&#x5F15;&#x8303;&#x56F4;&#x662F;1~21&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;00000000  ca fe ba be 00 00 00 34  00 16 0a 00 04 00 12 09  |.......4........|</span><br></pre></td></tr></table></figure>

<p>&#x63A5;&#x4E0B;&#x770B;&#x5E38;&#x91CF;&#x6C60;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x5E38;&#x91CF;, tag&#x662F;<code>0x0a</code>, &#x67E5;&#x4E0A;&#x9762;&#x7684;&#x5E38;&#x91CF;&#x8868;&#x5C31;&#x662F;CONSTANT_Methodref&#xFF0C;&#x8868;&#x793A;&#x63A5;&#x4E0B;&#x6765;&#x5B9A;&#x4E49;&#x7684;&#x662F;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x77E5;&#x9053;&#x7C7B;&#x578B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x67E5;&#x4E00;&#x4E0B;CONSTANT_Methodref&#x7684;&#x7ED3;&#x6784;&#xFF0C;&#x8FD9;&#x91CC;&#x53EF;&#x4EE5;&#x53C2;&#x8003;Oracle&#x7684;&#x5B98;&#x65B9;&#x6587;&#x6863;<a href="/external_links/c286dc800b4d2e91789eb1e240aff1c4.html" target="blank" rel="noopener">The class File Format</a>,</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;CONSTANT_Methodref_info {</span><br><span class="line">    u1 tag;</span><br><span class="line">    u2 class_index;</span><br><span class="line">    u2 name_and_type_index;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><strong>&#x7531;&#x4E8E;.class&#x6587;&#x4EF6;&#x662F;&#x65E0;&#x95F4;&#x9694;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;&#xFF0C;&#x6240;&#x4EE5;&#x63A5;&#x7740;&#x8BFB;&#xFF1A;</strong></p>
<ul>
<li>tag: <code>0x0a</code>,&#x4E0A;&#x9762;&#x5DF2;&#x7ECF;&#x8BF4;&#x4E86;&#x6307;&#x4EE3;CONSTANT_Methodref&#x5E38;&#x91CF;</li>
<li>class_index&#xFF1A;&#x6307;&#x5411;&#x5E38;&#x91CF;&#x6C60;&#x4E2D;CONSTANT_Class_info&#x7C7B;&#x578B;&#x7684;&#x5E38;&#x91CF;&#xFF0C;&#x4EE3;&#x8868;&#x4E0A;&#x9762;&#x65B9;&#x6CD5;&#x7684;&#x540D;&#x79F0;</li>
<li>name_and_type_index : &#x6307;&#x5411;&#x5E38;&#x91CF;&#x6C60;&#x4E2D;CONSTANT_NameAndType_info&#x5E38;&#x91CF;&#xFF0C;&#x662F;&#x5BF9;&#x65B9;&#x6CD5;&#x7684;&#x63CF;&#x8FF0;</li>
</ul>
<p>&#x56E0;&#x4E3A;class_index&#x5360;&#x4E24;&#x4E2A;&#x5B57;&#x8282;&#xFF0C;&#x6240;&#x4EE5;&#x7D27;&#x63A5;&#x7740;&#x8BFB;&#x5230;&#x4E86;<code>0x0004</code>,&#x4E5F;&#x5C31;&#x662F;4&#xFF0C;&#x6307;&#x5411;&#x5E38;&#x91CF;&#x6C60;&#x4E2D;&#x7684;&#x7B2C;4&#x4E2A;&#x5E38;&#x91CF;&#xFF0C;name_and_type_index&#x662F;<code>0x0012</code>&#xFF0C;&#x6307;&#x5411;&#x7B2C;18&#x4E2A;&#x5E38;&#x91CF;&#x3002;&#x540E;&#x9762;&#x4F1A;&#x5206;&#x6790;&#x5230;&#x7B2C;4&#x548C;&#x7B2C;18&#x4E2A;&#x5E38;&#x91CF;&#x3002;</p>
<p>&#x7EE7;&#x7EED;&#x5F80;&#x4E0B;&#x8BFB;&#xFF0C;&#x5230;&#x7B2C;&#x4E00;&#x884C;&#x7684;&#x6700;&#x672B;&#x4E86;&#xFF0C;&#x662F;&#x4E2A;0x09,&#x6307;&#x793A;&#x7684;&#x662F;CONSTANT_Fieldref&#xFF0C;&#x8868;&#x793A;&#x63A5;&#x4E0B;&#x6765;&#x662F;&#x5BF9;&#x4E00;&#x4E2A;&#x57DF;&#x7684;&#x5B9A;&#x4E49;&#xFF0C; &#x67E5;&#x5B98;&#x65B9;&#x6587;&#x6863;&#xFF0C;&#x683C;&#x5F0F;&#x4E3A;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;CONSTANT_Fieldref_info {</span><br><span class="line">    u1 tag;</span><br><span class="line">    u2 class_index;</span><br><span class="line">    u2 name_and_type_index;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x7ED3;&#x6784;&#x548C;CONSTANT_Methodref_info&#x4E00;&#x6837;&#xFF0C;&#x8FD9;&#x65F6;&#x5019;&#x8BFB;&#x5230;&#x4E86;&#x7B2C;&#x4E8C;&#x884C;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;00000010  00 03 00 13 07 00 14 07  00 15 01 00 01 6d 01 00  |.............m..|</span><br></pre></td></tr></table></figure>

<p>class_index&#x4E3A;<code>0x0003</code>&#xFF0C;&#x6307;&#x5411;&#x7B2C;3&#x4E2A;&#x5E38;&#x91CF;&#xFF0C;name_and_type_index&#x4E3A;<code>0x0013</code>&#x6307;&#x5411;&#x7B2C;13&#x4E2A;&#x5E38;&#x91CF;&#x3002;&#x8FD9;&#x65F6;&#x5019;&#x7EE7;&#x7EED;&#x5F80;&#x540E;&#x8BFB;&#xFF0C;&#x7EC8;&#x4E8E;&#x8BFB;&#x5230;&#x7B2C;3&#x4E2A;&#x5E38;&#x91CF;&#x4E86;&#x3002;&#x6B64;&#x65F6;tag&#x662F;<code>0x07</code>&#xFF0C;&#x67E5;&#x8868;&#x53EF;&#x5F97;&#x4E3A;CONSTANT_Class&#x7C7B;&#x578B;&#xFF0C;&#x6B64;&#x7C7B;&#x578B;&#x7684;&#x5E38;&#x91CF;&#x4EE3;&#x8868;&#x4E00;&#x4E2A;&#x7C7B;&#x6216;&#x8005;&#x63A5;&#x53E3;&#x7684;&#x7B26;&#x53F7;&#x5F15;&#x7528;&#xFF0C;CONSTANT_Class&#x7684;&#x7ED3;&#x6784;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;CONSTANT_Class_info {</span><br><span class="line">    u1 tag;</span><br><span class="line">    u2 name_index;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>tag&#x662F;7&#xFF0C; name_index&#x662F;<code>0x0014</code>&#xFF0C;&#x5341;&#x8FDB;&#x5236;&#x5C31;&#x662F;20&#xFF0C;&#x6307;&#x5411;&#x7B2C;20&#x4E2A;&#x5E38;&#x91CF;&#xFF0C;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x8BFB;&#x4E86;&#x5F88;&#x591A;&#x4E2A;&#x5B57;&#x8282;&#x4E86;&#x3002;&#x4F46;&#x662F;&#x8FD9;&#x6837;&#x89E3;&#x6790;&#x4E0B;&#x53BB;&#x5F88;&#x7D2F;&#xFF0C;&#x8FD8;&#x597D;java&#x81EA;&#x5E26;&#x7684;javap&#x5DE5;&#x5177;&#x53EF;&#x4EE5;&#x5E2E;&#x6211;&#x4EEC;&#x5206;&#x6790;&#x51FA;&#x5B57;&#x8282;&#x7801;&#x7684;&#x5185;&#x5BB9;&#x3002;<br>&#x6267;&#x884C;&#x4E0B;&#x9762;&#x8BED;&#x53E5;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;javap -verbose TestClass.class</span><br></pre></td></tr></table></figure>

<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;Last modified Nov 14, 2017; size 381 bytes</span><br><span class="line">  MD5 checksum 102d643185c4823ef103931ff3e34462</span><br><span class="line">  Compiled from &quot;TestClass.java&quot;</span><br><span class="line">public class com.shuqing28.TestClass</span><br><span class="line">  minor version: 0</span><br><span class="line">  major version: 52</span><br><span class="line">  flags: ACC_PUBLIC, ACC_SUPER</span><br><span class="line">Constant pool:</span><br><span class="line">   #1 = Methodref          #4.#18         // java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span><br><span class="line">   #2 = Fieldref           #3.#19         // com/shuqing28/TestClass.m:I</span><br><span class="line">   #3 = Class              #20            // com/shuqing28/TestClass</span><br><span class="line">   #4 = Class              #21            // java/lang/Object</span><br><span class="line">   #5 = Utf8               m</span><br><span class="line">   #6 = Utf8               I</span><br><span class="line">   #7 = Utf8               &lt;init&gt;</span><br><span class="line">   #8 = Utf8               ()V</span><br><span class="line">   #9 = Utf8               Code</span><br><span class="line">  #10 = Utf8               LineNumberTable</span><br><span class="line">  #11 = Utf8               LocalVariableTable</span><br><span class="line">  #12 = Utf8               this</span><br><span class="line">  #13 = Utf8               Lcom/shuqing28/TestClass;</span><br><span class="line">  #14 = Utf8               inc</span><br><span class="line">  #15 = Utf8               ()I</span><br><span class="line">  #16 = Utf8               SourceFile</span><br><span class="line">  #17 = Utf8               TestClass.java</span><br><span class="line">  #18 = NameAndType        #7:#8          // &quot;&lt;init&gt;&quot;:()V</span><br><span class="line">  #19 = NameAndType        #5:#6          // m:I</span><br><span class="line">  #20 = Utf8               com/shuqing28/TestClass</span><br><span class="line">  #21 = Utf8               java/lang/Object</span><br><span class="line">{</span><br><span class="line">  public com.shuqing28.TestClass();</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">...//&#x7701;&#x7565;</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;Constant pool&#x5B57;&#x6BB5;&#xFF0C;&#x540E;&#x9762;&#x4F9D;&#x6B21;&#x5217;&#x51FA;&#x4E86;21&#x4E2A;&#x5E38;&#x91CF;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x7B2C;&#x4E00;&#x4E2A;&#x662F;Methodref&#x578B;&#x7684;&#x5E38;&#x91CF;&#xFF0C;class_index&#x6307;&#x5411;&#x7B2C;4&#x4E2A;&#x5E38;&#x91CF;&#xFF0C;&#x7B2C;4&#x4E2A;&#x5E38;&#x91CF;&#x5462;&#x662F;CONSTANT_Class&#x7C7B;&#x578B;&#xFF0C;name_index&#x53C8;&#x6307;&#x5411;&#x7B2C;20&#x4E2A;&#x5E38;&#x91CF;&#xFF0C;&#x53EF;&#x77E5;&#x662F;&#x4E00;&#x4E2A;CONSTANT_Utf8&#x7C7B;&#x578B;&#x7684;&#x5E38;&#x91CF;&#xFF0C;&#x524D;&#x9762;&#x6CA1;&#x8BF4;&#x5230;CONSTANT_Utf8&#xFF0C;&#x4E0B;&#x9762;&#x662F;&#x5B83;&#x7684;&#x7ED3;&#x6784;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;CONSTANT_Utf8_info {</span><br><span class="line">    u1 tag;</span><br><span class="line">    u2 length;</span><br><span class="line">    u1 bytes[length];</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x7B2C;&#x4E00;&#x4F4D;tag&#x4E3A;1&#xFF0C;length&#x6307;&#x793A;&#x5B57;&#x7B26;&#x6570;&#x7EC4;&#x7684;&#x957F;&#x5EA6;&#xFF0C;bytes[length]&#x662F;&#x4F7F;&#x7528;UTF-8&#x7F29;&#x7565;&#x7F16;&#x7801;&#x8868;&#x793A;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x8FD9;&#x91CC;&#x89E3;&#x6790;&#x51FA;&#x6765;&#x662F;com/shuqing28/TestClass&#xFF0C;&#x5373;&#x7C7B;&#x7684;&#x5168;&#x9650;&#x5B9A;&#x540D;&#x3002;</p>
<p>&#x7EE7;&#x7EED;&#x56DE;&#x5230;&#x7B2C;&#x4E00;&#x4E2A;Methodref&#x5E38;&#x91CF;&#xFF0C;&#x5B83;&#x7684;name_and_type_index&#x503C;&#x662F;18, &#x7EE7;&#x7EED;&#x627E;&#x5230;&#x7B2C;18&#x4E2A;&#x5E38;&#x91CF;&#xFF0C;&#x662F;CONSTANT_NameAndType_info&#x7C7B;&#x578B;&#xFF0C;&#x4EE3;&#x8868;&#x7684;&#x662F;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#x7684;&#x4FE1;&#x606F;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;CONSTANT_NameAndType_info {</span><br><span class="line">    u1 tag;</span><br><span class="line">    u2 name_index;</span><br><span class="line">    u2 descriptor_index;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>name_index&#x6307;&#x5411;&#x4E86;&#x5E38;&#x91CF;7&#xFF0C; &#x5373;<code>#7 = Utf8 &lt;init&gt;</code>, &#x662F;&#x4E00;&#x4E2A;CONSTANT_Utf8_info&#x7C7B;&#x578B;&#xFF0C;&#x503C;&#x4E3A;,&#x8FD9;&#x4E2A;&#x662F;&#x65B9;&#x6CD5;&#x7684;&#x540D;&#x79F0;&#xFF0C;descriptor_index&#x6307;&#x5411;&#x4E86;&#x5E38;&#x91CF;8&#xFF0C;&#x5373;<code>#8 = Utf8 ()V</code>,&#x662F;&#x65B9;&#x6CD5;&#x7684;&#x63CF;&#x8FF0;&#xFF0C;&#x4E0B;&#x6587;&#x4F1A;&#x8BF4;&#x8FD9;&#x4E2A;&#x8868;&#x8FBE;&#x5F0F;&#x662F;&#x4EC0;&#x4E48;&#x610F;&#x601D;&#x3002;<br>&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x4E00;&#x4E00;&#x628A;&#x8FD9;21&#x4E2A;&#x5E38;&#x91CF;&#x5206;&#x6790;&#x6E05;&#x695A;&#x4E86;&#x3002;</p>
<p>&#x5176;&#x5B9E;Class&#x6587;&#x4EF6;&#x5C31;&#x662F;&#x5728;&#x4E00;&#x5F00;&#x59CB;&#x5217;&#x51FA;&#x4E86;&#x4E00;&#x5806;&#x5E38;&#x91CF;&#xFF0C;&#x540E;&#x9762;&#x7684;&#x5404;&#x79CD;&#x63CF;&#x8FF0;&#x90FD;&#x662F;&#x5404;&#x79CD;index&#xFF0C;&#x6307;&#x5411;&#x524D;&#x9762;&#x5E38;&#x91CF;&#x6C60;&#x4E2D;&#x7684;&#x5404;&#x79CD;&#x5E38;&#x91CF;&#xFF0C;&#x6765;&#x63CF;&#x8FF0;&#x6574;&#x4E2A;&#x7C7B;&#x7684;&#x5B9A;&#x4E49;&#x3002;&#x5C31;&#x50CF;&#x6709;&#x4E00;&#x672C;&#x5B57;&#x5178;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x5B57;&#x5178;&#x4E2D;&#x7684;&#x5B57;&#x6765;&#x9020;&#x6211;&#x4EEC;&#x7684;&#x53E5;&#x5B50;&#xFF0C;&#x53EA;&#x4E0D;&#x8FC7;Class&#x6587;&#x4EF6;&#x4E2D;&#x9020;&#x53E5;&#x662F;&#x6709;&#x4E25;&#x683C;&#x683C;&#x5F0F;&#x89C4;&#x5B9A;&#x7684;&#xFF0C;&#x4E0B;&#x9762;&#x7684;&#x5185;&#x5BB9;&#x57FA;&#x672C;&#x90FD;&#x6309;&#x7167;&#x56FA;&#x5B9A;&#x683C;&#x5F0F;&#xFF0C;&#x65E0;&#x95F4;&#x9694;&#x7684;&#x63CF;&#x8FF0;&#x4E00;&#x4E2A;&#x7C7B;&#x7684;&#x5185;&#x5BB9;&#x3002;</p>
<h3 id="4-&#x8BBF;&#x95EE;&#x6807;&#x5FD7;"><a href="#4-&#x8BBF;&#x95EE;&#x6807;&#x5FD7;" class="headerlink" title="4. &#x8BBF;&#x95EE;&#x6807;&#x5FD7;"></a>4. &#x8BBF;&#x95EE;&#x6807;&#x5FD7;</h3><p>&#x5E38;&#x91CF;&#x6C60;&#x7ED3;&#x675F;&#x540E;&#xFF0C;&#x7D27;&#x63A5;&#x7740;&#x7684;&#x4E24;&#x4E2A;&#x5B57;&#x8282;&#x4EE3;&#x8868;&#x8BBF;&#x95EE;&#x6807;&#x5FD7;&#xFF08;access_flags&#xFF09;,&#x8FD9;&#x4E2A;&#x6807;&#x5FD7;&#x7528;&#x4E8E;&#x8BC6;&#x522B;&#x4E00;&#x4E9B;&#x7C7B;&#x6216;&#x8005;&#x63A5;&#x53E3;&#x7684;&#x8BBF;&#x95EE;&#x4FE1;&#x606F;&#xFF0C;&#x5305;&#x62EC;&#x8FD9;&#x4E2A;Class&#x662F;&#x7C7B;&#x8FD8;&#x662F;&#x63A5;&#x53E3;&#xFF0C;&#x662F;&#x5426;&#x662F;public&#x7684;,&#x662F;&#x5426;&#x662F;abstract&#xFF0C;&#x662F;&#x5426;&#x662F;final&#x7684;&#x3002;<br>&#x8BBF;&#x95EE;&#x6807;&#x8BB0;&#x542B;&#x4E49;&#x5982;&#x4E0B;&#x8868;&#xFF1A;</p>
<table>
<thead>
<tr>
<th>&#x6807;&#x5FD7;&#x540D;&#x79F0;</th>
<th>&#x6807;&#x5FD7;&#x503C;</th>
<th>&#x542B;&#x4E49;</th>
</tr>
</thead>
<tbody><tr>
<td>ACC_PUBLIC</td>
<td>0x0001</td>
<td>Declared public; may be accessed from outside its package.</td>
</tr>
<tr>
<td>ACC_FINAL</td>
<td>0x0010</td>
<td>Declared final; no subclasses allowed.</td>
</tr>
<tr>
<td>ACC_SUPER</td>
<td>0x0020</td>
<td>Treat superclass methods specially when invoked by the invokespecial instruction.</td>
</tr>
<tr>
<td>ACC_INTERFACE</td>
<td>0x0200</td>
<td>Is an interface, not a class.</td>
</tr>
<tr>
<td>ACC_ABSTRACT</td>
<td>0x0400</td>
<td>Declared abstract; must not be instantiated.</td>
</tr>
<tr>
<td>ACC_SYNTHETIC</td>
<td>0x1000</td>
<td>Declared synthetic; not present in the source code.</td>
</tr>
<tr>
<td>ACC_ANNOTATION</td>
<td>0x2000</td>
<td>Declared as an annotation type.</td>
</tr>
<tr>
<td>ACC_ENUM</td>
<td>0x4000</td>
<td>Declared as an enum type.</td>
</tr>
</tbody></table>
<p>access_flags&#x4E2D;&#x4E00;&#x5171;&#x6709;16&#x4E2A;&#x6807;&#x5FD7;&#x4F4D;&#x53EF;&#x7528;&#xFF0C;&#x5F53;&#x524D;&#x53EA;&#x5B9A;&#x4E49;&#x4E86;8&#x4E2A;&#xFF0C;&#x522B;&#x7684;&#x90FD;&#x4E3A;0&#xFF0C;TestClass&#x662F;public&#x7C7B;&#x578B;&#x7684;&#xFF0C;&#x4E14;&#x4F7F;&#x7528;JDK1.2&#x4EE5;&#x540E;&#x7684;&#x7F16;&#x8BD1;&#x5668;&#x8FDB;&#x884C;&#x7F16;&#x8BD1;&#x7684;&#xFF08;&#x4F7F;&#x7528;JDK1.2&#x4EE5;&#x540E;&#x7684;&#x7F16;&#x8BD1;&#x5668;&#x7F16;&#x8BD1;&#xFF0C;&#x8FD9;&#x4E2A;&#x503C;&#x90FD;&#x4E3A;&#x771F;&#xFF09;&#xFF0C;&#x522B;&#x7684;&#x6807;&#x5FD7;&#x90FD;&#x4E3A;&#x5047;&#x3002;&#x6240;&#x4EE5;access_flags&#x7684;&#x503C;&#x5E94;&#x4E3A;&#xFF1A;<code>0x0001|0x0020 = 0x0021</code>&#x3002;&#x6211;&#x4EEC;&#x627E;&#x5230;&#x521A;&#x624D;&#x5E38;&#x91CF;&#x6C60;&#x6700;&#x540E;&#x4E00;&#x884C;&#x7684;&#x5730;&#x65B9;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;000000e0  65 63 74 00 21 00 03 00  04 00 00 00 01 00 02 00  |ect.!...........|</span><br></pre></td></tr></table></figure>

<p><code>65 63 74</code>&#x5206;&#x522B;&#x5BF9;&#x5E94;ect&#xFF0C;&#x7D27;&#x63A5;&#x7740;&#x662F;<code>0x0021</code>,&#x4E0E;&#x6211;&#x4EEC;&#x7684;&#x5206;&#x6790;&#x7ED3;&#x679C;&#x4E00;&#x81F4;&#x3002;</p>
<h3 id="5-&#x7C7B;&#x7D22;&#x5F15;&#x3001;&#x7236;&#x7C7B;&#x7D22;&#x5F15;&#x4E0E;&#x63A5;&#x53E3;&#x7D22;&#x5F15;&#x96C6;&#x5408;"><a href="#5-&#x7C7B;&#x7D22;&#x5F15;&#x3001;&#x7236;&#x7C7B;&#x7D22;&#x5F15;&#x4E0E;&#x63A5;&#x53E3;&#x7D22;&#x5F15;&#x96C6;&#x5408;" class="headerlink" title="5.&#x7C7B;&#x7D22;&#x5F15;&#x3001;&#x7236;&#x7C7B;&#x7D22;&#x5F15;&#x4E0E;&#x63A5;&#x53E3;&#x7D22;&#x5F15;&#x96C6;&#x5408;"></a>5.&#x7C7B;&#x7D22;&#x5F15;&#x3001;&#x7236;&#x7C7B;&#x7D22;&#x5F15;&#x4E0E;&#x63A5;&#x53E3;&#x7D22;&#x5F15;&#x96C6;&#x5408;</h3><p>&#x5F15;&#x7528;&#x6587;&#x7AE0;&#x5F00;&#x5934;&#x7684;ClassFile&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF0C;&#x8FD9;&#x4E09;&#x9879;&#x5B9A;&#x4E49;&#x4E3A;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;    u2             this_class;</span><br><span class="line">    u2             super_class;</span><br><span class="line">    u2             interfaces_count;</span><br><span class="line">    u2             interfaces[interfaces_count];</span><br></pre></td></tr></table></figure>

<p>&#x7C7B;&#x7D22;&#x5F15;&#x548C;&#x7236;&#x7C7B;&#x7D22;&#x5F15;&#x90FD;&#x662F;u2&#x7C7B;&#x578B;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x800C;&#x63A5;&#x53E3;&#x7D22;&#x5F15;&#x9996;&#x5148;&#x7ED9;&#x51FA;&#x4E86;&#x63A5;&#x53E3;&#x7684;&#x6570;&#x91CF;&#xFF0C;&#x7136;&#x540E;&#x624D;&#x662F;&#x4E00;&#x4E2A;&#x5305;&#x542B;&#x63A5;&#x53E3;&#x7684;&#x6570;&#x7EC4;&#x3002;&#x8FD9;&#x4E09;&#x4E2A;&#x503C;&#x63ED;&#x793A;&#x4E86;&#x4E00;&#x4E2A;&#x7C7B;&#x7684;&#x7EE7;&#x627F;&#x5173;&#x7CFB;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;000000e0  65 63 74 00 21 00 03 00  04 00 00 00 01 00 02 00  |ect.!...........|</span><br></pre></td></tr></table></figure>

<p>&#x63A5;&#x7740;&#x524D;&#x9762;&#x7684;<code>0x0021</code>&#x770B;&#xFF0C;&#x7C7B;&#x7D22;&#x5F15;&#x4E3A;<code>0x0003</code>&#xFF0C;&#x6307;&#x793A;&#x5E38;&#x91CF;&#x6C60;&#x7B2C;3&#x4E2A;&#x5E38;&#x91CF;&#xFF0C;&#x67E5;&#x4E0A;&#x6587;&#x53EF;&#x5F97;<code>#3 = Class #20 // com/shuqing28/TestClass</code>,&#x7B2C;3&#x4E2A;&#x5E38;&#x91CF;&#x53C8;&#x6307;&#x5411;&#x7B2C;20&#x4E2A;&#x5E38;&#x91CF;&#xFF0C;&#x800C;&#x7B2C;20&#x4E2A;&#x5E38;&#x91CF;&#x662F;&#x4E00;&#x4E2A;CONSTANT_Utf8&#x53D8;&#x91CF;&#xFF0C;&#x5176;&#x503C;&#x4E3A;com/shuqing28/TestClass&#xFF0C;&#x8868;&#x793A;&#x7C7B;&#x7684;&#x5168;&#x9650;&#x5B9A;&#x540D;&#x5B57;&#x7B26;&#x4E32;&#x3002;<br>&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x662F;<code>0x0004</code>&#x662F;&#x7236;&#x7C7B;&#x7D22;&#x5F15;&#xFF0C;&#x6307;&#x5411;&#x5E38;&#x91CF;&#x6C60;&#x4E2D;&#x7B2C;4&#x4E2A;&#x5E38;&#x91CF;&#xFF0C;&#x5373;<code>#4 = Class #21 // java/lang/Object</code>, &#x53C8;&#x6307;&#x5411;&#x7B2C;21&#x4E2A;&#x53D8;&#x91CF;&#xFF0C;&#x5373;java/lang/Object&#xFF0C;&#x6211;&#x4EEC;&#x77E5;&#x9053;Object&#x662F;&#x6240;&#x6709;&#x7C7B;&#x7684;&#x7236;&#x7C7B;&#x3002;<br>&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x662F;<code>0x0000</code>&#xFF0C;&#x53EF;&#x89C1;TestClass&#x6CA1;&#x6709;&#x5B9E;&#x73B0;&#x4EFB;&#x4F55;&#x63A5;&#x53E3;&#x3002;</p>
<h3 id="6-&#x5B57;&#x6BB5;&#x8868;&#x96C6;&#x5408;"><a href="#6-&#x5B57;&#x6BB5;&#x8868;&#x96C6;&#x5408;" class="headerlink" title="6.&#x5B57;&#x6BB5;&#x8868;&#x96C6;&#x5408;"></a>6.&#x5B57;&#x6BB5;&#x8868;&#x96C6;&#x5408;</h3><p>&#x5B57;&#x6BB5;&#x8868;&#x7528;&#x4E8E;&#x63CF;&#x8FF0;&#x63A5;&#x53E3;&#x6216;&#x8005;&#x7C7B;&#x4E2D;&#x58F0;&#x660E;&#x7684;&#x53D8;&#x91CF;&#x3002;&#x5B57;&#x6BB5;&#x5305;&#x62EC;&#x7C7B;&#x7EA7;&#x522B;&#x7684;&#x53D8;&#x91CF;&#x4EE5;&#x53CA;&#x5B9E;&#x4F8B;&#x7EA7;&#x7684;&#x53D8;&#x91CF;&#xFF0C;&#x4F46;&#x662F;&#x4E0D;&#x5305;&#x62EC;&#x65B9;&#x6CD5;&#x5185;&#x7684;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x3002;&#x4E00;&#x4E2A;Java&#x5B57;&#x6BB5;&#x53EF;&#x4EE5;&#x5305;&#x62EC;&#x4EE5;&#x4E0B;&#x4FE1;&#x606F;&#xFF1A;&#x5B57;&#x6BB5;&#x7684;&#x4F5C;&#x7528;&#x57DF;&#x3001;&#x662F;&#x5B9E;&#x4F8B;&#x53D8;&#x91CF;&#x8FD8;&#x662F;&#x7C7B;&#x53D8;&#x91CF;&#x3001;&#x662F;&#x5426;&#x662F;final&#x3001;&#x5E76;&#x53D1;&#x53EF;&#x89C1;&#x6027;&#xFF08;volatile&#xFF09;&#xFF0C;&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x88AB;&#x5E8F;&#x5217;&#x5316;&#xFF08;transient&#xFF09;&#x3001;&#x5B57;&#x6BB5;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x3002;&#x4E0B;&#x9762;&#x662F;&#x5B57;&#x6BB5;&#x8868;&#x5177;&#x4F53;&#x7ED3;&#x6784;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;field_info {</span><br><span class="line">    u2             access_flags;</span><br><span class="line">    u2             name_index;</span><br><span class="line">    u2             descriptor_index;</span><br><span class="line">    u2             attributes_count;</span><br><span class="line">    attribute_info attributes[attributes_count];</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x518D;&#x770B;access_flags&#x53EF;&#x4EE5;&#x53D6;&#x4EE5;&#x4E0B;&#x503C;&#xFF1A;</p>
<table>
<thead>
<tr>
<th>&#x6807;&#x5FD7;&#x540D;&#x79F0;</th>
<th>&#x6807;&#x5FD7;&#x503C;</th>
<th>&#x542B;&#x4E49;</th>
</tr>
</thead>
<tbody><tr>
<td>ACC_PUBLIC</td>
<td>0x0001</td>
<td>Declared public; may be accessed from outside its package.</td>
</tr>
<tr>
<td>ACC_PRIVATE</td>
<td>0x0002</td>
<td>Declared private; usable only within the defining class.</td>
</tr>
<tr>
<td>ACC_PROTECTED</td>
<td>0x0004</td>
<td>Declared protected; may be accessed within subclasses.</td>
</tr>
<tr>
<td>ACC_STATIC</td>
<td>0x0008</td>
<td>Declared static.</td>
</tr>
<tr>
<td>ACC_FINAL</td>
<td>0x0010</td>
<td>Declared final; never directly assigned to after object construction (JLS &#xA7;17.5).</td>
</tr>
<tr>
<td>ACC_VOLATILE</td>
<td>0x0040</td>
<td>Declared volatile; cannot be cached.</td>
</tr>
<tr>
<td>ACC_TRANSIENT</td>
<td>0x0080</td>
<td>Declared transient; not written or read by a persistent object manager.</td>
</tr>
<tr>
<td>ACC_SYNTHETIC</td>
<td>0x1000</td>
<td>Declared synthetic; not present in the source code.</td>
</tr>
<tr>
<td>ACC_ENUM</td>
<td>0x4000</td>
<td>Declared as an element of an enum.</td>
</tr>
</tbody></table>
<p>&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;ACC_PUBLIC&#x3001;ACC_PRIVATE&#x3001;ACC_PROTECTED&#x4E09;&#x4E2A;&#x6807;&#x5FD7;&#x6700;&#x591A;&#x53EA;&#x80FD;&#x5B58;&#x5728;&#x4E00;&#x4E2A;&#xFF0C;&#x5176;&#x5B83;&#x6807;&#x5FD7;&#x90FD;&#x6309;&#x7167;Java&#x8BED;&#x8A00;&#x672C;&#x8EAB;&#x7684;&#x6027;&#x8D28;&#x6765;&#x3002;</p>
<p>&#x5728;access_flags&#x6807;&#x5FD7;&#x7684;&#x540E;&#x9762;&#x662F;&#x4E24;&#x9879;&#x7D22;&#x5F15;&#x503C;name_index,descriptor_index&#xFF0C;&#x4E24;&#x4E2A;&#x90FD;&#x662F;&#x6307;&#x5411;&#x5E38;&#x91CF;&#x6C60;&#x7684;&#x7D22;&#x5F15;&#xFF0C;&#x5206;&#x522B;&#x4EE3;&#x8868;&#x5B57;&#x6BB5;&#x7684;&#x7B80;&#x5355;&#x540D;&#x79F0;&#x4EE5;&#x53CA;&#x5B57;&#x6BB5;&#x548C;&#x65B9;&#x6CD5;&#x7684;&#x63CF;&#x8FF0;&#x7B26;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x68B3;&#x7406;&#x4E0B;&#x7B80;&#x5355;&#x540D;&#x79F0;&#x3001;&#x63CF;&#x8FF0;&#x7B26;&#x4EE5;&#x53CA;&#x5168;&#x9650;&#x5B9A;&#x540D;&#x8FD9;&#x4E09;&#x4E2A;&#x8BCD;&#x5BF9;&#x5E94;&#x7684;&#x6982;&#x5FF5;&#xFF1A;<br>&#x5168;&#x9650;&#x5B9A;&#x540D;&#xFF1A;&#x524D;&#x9762;&#x63D0;&#x5230;&#x7684;com/shuqing28/TestClass&#x5C31;&#x662F;&#x5168;&#x9650;&#x5B9A;&#x540D;&#xFF0C;&#x5B83;&#x628A;java&#x4EE3;&#x7801;&#x4E2D;&#x6240;&#x6709;&#x7684;&#x201D;.&#x201D;&#x66FF;&#x6362;&#x6210;&#x4E86;&#x201D;/&#x201C;&#xFF0C;&#x4E00;&#x822C;&#x4F7F;&#x7528;&#x201D;;&#x201D;&#x7ED3;&#x5C3E;&#x3002;<br>&#x7B80;&#x5355;&#x540D;&#x79F0;&#xFF1A;&#x4E0D;&#x5E26;&#x7C7B;&#x578B;&#x548C;&#x4FEE;&#x9970;&#x7684;&#x65B9;&#x6CD5;&#x6216;&#x8005;&#x5B57;&#x6BB5;&#x540D;&#xFF0C;&#x4E0A;&#x6587;&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#x91CC;&#x5C31;&#x662F;&#x201D;inc&#x201D;&#x548C;&#x201D;m&#x201D;<br>&#x81F3;&#x4E8E;&#x65B9;&#x6CD5;&#x63CF;&#x8FF0;&#x7B26;&#xFF0C;&#x63CF;&#x8FF0;&#x7684;&#x662F;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x3001;&#x65B9;&#x6CD5;&#x7684;&#x53C2;&#x6570;&#x5217;&#x8868;&#x548C;&#x8FD4;&#x56DE;&#x503C;&#x3002;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x5728;C++&#x4E2D;&#x91CD;&#x8F7D;&#x51FD;&#x6570;&#x65F6;&#x51FD;&#x6570;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x6362;&#x4E86;&#x540D;&#x5B57;&#x7684;&#xFF0C;&#x5305;&#x542B;&#x4E86;&#x51FD;&#x6570;&#x7684;&#x53C2;&#x6570;,&#x4F8B;&#x5982;add(int x, int y),&#x5728;&#x7F16;&#x8BD1;&#x540E;&#x53EF;&#x80FD;&#x662F;Add_Int_Int, &#x4F46;&#x662F;&#x5728;Java&#x4E2D;&#x6211;&#x4EEC;&#x628A;&#x57FA;&#x672C;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x90FD;&#x7528;&#x4E00;&#x4E2A;&#x5927;&#x5199;&#x5B57;&#x7B26;&#x6765;&#x8868;&#x793A;&#xFF0C;&#x800C;&#x5BF9;&#x8C61;&#x7C7B;&#x5219;&#x662F;&#x4F7F;&#x7528;L+&#x5BF9;&#x8C61;&#x7684;&#x5168;&#x9650;&#x5B9A;&#x540D;&#x6765;&#x8868;&#x793A;&#x3002;</p>
<p>&#x63CF;&#x8FF0;&#x7B26;&#x6807;&#x8BC6;&#x5B57;&#x7B26;&#x542B;&#x4E49;&#xFF1A;</p>
<table>
<thead>
<tr>
<th>&#x6807;&#x8BC6;&#x5B57;&#x7B26;</th>
<th>&#x542B;&#x4E49;</th>
</tr>
</thead>
<tbody><tr>
<td>B</td>
<td>byte</td>
</tr>
<tr>
<td>C</td>
<td>char</td>
</tr>
<tr>
<td>D</td>
<td>double</td>
</tr>
<tr>
<td>F</td>
<td>float</td>
</tr>
<tr>
<td>I</td>
<td>int</td>
</tr>
<tr>
<td>J</td>
<td>long</td>
</tr>
<tr>
<td>S</td>
<td>short</td>
</tr>
<tr>
<td>Z</td>
<td>boolean</td>
</tr>
<tr>
<td>V</td>
<td>void</td>
</tr>
<tr>
<td>L</td>
<td>Object, &#x4F8B;&#x5982; Ljava/lang/Object</td>
</tr>
</tbody></table>
<p>&#x5BF9;&#x4E8E;&#x6570;&#x7EC4;&#xFF0C;&#x524D;&#x9762;&#x52A0;<code>[</code>&#x5C31;&#x884C;&#xFF0C;&#x5982;<code>java.lang.String[][]</code>&#xFF0C;&#x8868;&#x8FBE;&#x4E3A;<code>[[java/lang/String</code>, <code>int[]</code> &#x5C31;&#x88AB;&#x8BB0;&#x5F55;&#x4E3A;<code>[I</code>&#x3002;<br>&#x7528;&#x63CF;&#x8FF0;&#x7B26;&#x63CF;&#x8FF0;&#x65B9;&#x6CD5;&#x65F6;&#xFF0C;&#x6309;&#x7167;&#x53C2;&#x6570;&#x5217;&#x8868;&#xFF0C;&#x8FD4;&#x56DE;&#x503C;&#x7684;&#x987A;&#x5E8F;&#x63CF;&#x8FF0;&#xFF0C;&#x53C2;&#x6570;&#x5217;&#x8868;&#x8FD8;&#x9700;&#x8981;&#x653E;&#x5728;&#x62EC;&#x53F7;&#x5185;&#x3002;&#x6BD4;&#x5982;&#x524D;&#x6587;&#x63D0;&#x53CA;&#x7684;&#x201D;() V&#x201D; &#x5C31;&#x8868;&#x793A;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x4E3A;&#x7A7A;&#xFF0C;&#x8FD4;&#x56DE;&#x503C;&#x4E3A;<code>void</code>&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5373;&#x4EE3;&#x7801;&#x4E2D;&#x7684;<code>void inc()</code>&#x65B9;&#x6CD5;&#x3002;</p>
<p>&#x4E3E;&#x4E2A;&#x590D;&#x6742;&#x70B9;&#x7684;&#xFF0C; <code>int indexOf(char[] source, int sourceOffset, int sourceCount, char[] target, int targetOffset, int targetCount, int fromIndex)</code>,&#x5176;&#x63CF;&#x8FF0;&#x7B26;&#x4E3A;<code>([CII[CIII) I</code>&#x3002;</p>
<p>&#x7EE7;&#x7EED;&#x5206;&#x6790;&#x6211;&#x4EEC;&#x524D;&#x6587;&#x4E2D;&#x63D0;&#x53CA;&#x7684;&#x7A0B;&#x5E8F;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x4EE3;&#x7801;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;000000e0  65 63 74 00 21 00 03 00  04 00 00 00 01 00 02 00  |ect.!...........|</span><br><span class="line">000000f0  05 00 06 00 00 00 02 00  01 00 07 00 08 00 01 00  |................|</span><br></pre></td></tr></table></figure>

<p>&#x4E0A;&#x4E00;&#x5C0F;&#x8282;&#x6211;&#x4EEC;&#x5206;&#x6790;&#x5230;&#x7B2C;&#x4E00;&#x884C;&#x7684;<code>0x0000</code>&#x4E86;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x662F;<code>0x01</code>,&#x8FD9;&#x4E2A;&#x503C;&#x5176;&#x5B9E;&#x4EE3;&#x8868;&#x4E86;&#x5B57;&#x6BB5;&#x8868;&#x7684;&#x4E2A;&#x6570;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x4EE3;&#x7801;&#x91CC;&#x53EA;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x5B57;&#x6BB5;&#x3002;&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x662F;<code>0x0002</code>&#xFF0C;&#x8FD9;&#x4E2A;&#x5B57;&#x6BB5;&#x662F;access_flags&#x6807;&#x5FD7;&#xFF0C;&#x67E5;&#x8BE2;&#x540E;&#x53EF;&#x77E5;&#x4E3A;ACC_PRIVATE&#xFF0C;&#x518D;&#x63A5;&#x4E0B;&#x6765;&#x662F;<code>0x0005</code>, &#x4ECE;&#x5E38;&#x91CF;&#x8868;&#x6E05;&#x5355;&#x4E0A;&#x53EF;&#x4EE5;&#x67E5;&#x5230;&#x662F;<code>#5 = Utf8 m</code>, &#x518D;&#x63A5;&#x7740;&#x662F;descriptor_index&#xFF0C; &#x5176;&#x503C;&#x4E3A;<code>0x0006</code>&#xFF0C;&#x67E5;&#x4E00;&#x4E0B;&#x5E38;&#x91CF;&#x6C60;&#x4E3A;<code>#6 = Utf8 I</code>&#xFF0C;&#x53EF;&#x77E5;&#x8FD9;&#x4E00;&#x53E5;&#x4E3A;<code>private int m;</code></p>
<p>&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;&#x5728;decriptor_index&#x540E;&#xFF0C;&#x8FD8;&#x6709;&#x4E2A;&#x5C5E;&#x6027;&#x96C6;&#x5408;&#x7528;&#x4E8E;&#x5B58;&#x50A8;&#x4E00;&#x4E9B;&#x989D;&#x5916;&#x4FE1;&#x606F;&#xFF0C;&#x800C;<code>0x0000</code>&#x4EE3;&#x8868;&#x6CA1;&#x6709;&#x5C5E;&#x6027;&#x5B57;&#x6BB5;&#x3002;<br>&#x5982;&#x679C;&#x628A;m&#x5B57;&#x6BB5;&#x58F0;&#x660E;&#x4E3A;<code>private static int m = 123;</code> &#x5219;&#x53EF;&#x80FD;&#x591A;&#x4E00;&#x4E2A;ConstantValue&#x5C5E;&#x6027;&#xFF0C;&#x6307;&#x5411;&#x5E38;&#x91CF;&#x503C;123&#x3002;</p>
<h3 id="7-&#x65B9;&#x6CD5;&#x8868;&#x96C6;&#x5408;"><a href="#7-&#x65B9;&#x6CD5;&#x8868;&#x96C6;&#x5408;" class="headerlink" title="7.&#x65B9;&#x6CD5;&#x8868;&#x96C6;&#x5408;"></a>7.&#x65B9;&#x6CD5;&#x8868;&#x96C6;&#x5408;</h3><p>&#x65B9;&#x6CD5;&#x8868;&#x96C6;&#x5408;&#x548C;&#x5B57;&#x6BB5;&#x8868;&#x96C6;&#x5408;&#x975E;&#x5E38;&#x76F8;&#x4F3C;&#xFF0C;&#x7ED3;&#x6784;&#x4E5F;&#x662F;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;method_info {</span><br><span class="line">    u2             access_flags;</span><br><span class="line">    u2             name_index;</span><br><span class="line">    u2             descriptor_index;</span><br><span class="line">    u2             attributes_count;</span><br><span class="line">    attribute_info attributes[attributes_count];</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x53EA;&#x4E0D;&#x8FC7;&#x5728;&#x8BBF;&#x95EE;&#x6807;&#x5FD7;&#x548C;&#x5C5E;&#x6027;&#x8868;&#x96C6;&#x5408;&#x7684;&#x53EF;&#x9009;&#x9879;&#x6709;&#x6240;&#x4E0D;&#x540C;&#x3002;&#x4F8B;&#x5982;access_flags&#x6709;&#x4EE5;&#x4E0B;&#x53EF;&#x9009;&#x503C;:</p>
<table>
<thead>
<tr>
<th>&#x6807;&#x5FD7;&#x540D;&#x79F0;</th>
<th>&#x6807;&#x5FD7;&#x503C;</th>
<th>&#x542B;&#x4E49;</th>
</tr>
</thead>
<tbody><tr>
<td>ACC_PUBLIC</td>
<td>0x0001</td>
<td>Declared <code>public</code>; may be accessed from outside its package.</td>
</tr>
<tr>
<td>ACC_PRIVATE</td>
<td>0x0002</td>
<td>Declared<code>private</code>; accessible only within the defining class.</td>
</tr>
<tr>
<td>ACC_PROTECTED</td>
<td>0x0004</td>
<td>Declared<code>protected</code>; may be accessed within subclasses.</td>
</tr>
<tr>
<td>ACC_STATIC</td>
<td>0x0008</td>
<td>Declared<code>static</code>.</td>
</tr>
<tr>
<td>ACC_FINAL</td>
<td>0x0010</td>
<td>Declared<code>final</code>; must not be overridden</td>
</tr>
<tr>
<td>ACC_SYNCHRONIZED</td>
<td>0x0020</td>
<td>Declared<code>synchronized</code>; invocation is wrapped by a monitor use.</td>
</tr>
<tr>
<td>ACC_BRIDGE</td>
<td>0x0040</td>
<td>A bridge method, generated by the compiler.</td>
</tr>
<tr>
<td>ACC_VARARGS</td>
<td>0x0080</td>
<td>Declared with variable number of arguments.</td>
</tr>
<tr>
<td>ACC_NATIVE</td>
<td>0x0100</td>
<td>Declared<code>native</code>; implemented in a language other than Java.</td>
</tr>
<tr>
<td>ACC_ABSTRACT</td>
<td>0x0400</td>
<td>Declared<code>abstract</code>; no implementation is provided.</td>
</tr>
<tr>
<td>ACC_STRICT</td>
<td>0x0800</td>
<td>Declared<code>strictfp</code>; floating-point mode is FP-strict.</td>
</tr>
<tr>
<td>ACC_SYNTHETIC</td>
<td>0x1000</td>
<td>Declared synthetic; not present in the source code.</td>
</tr>
</tbody></table>
<p>&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x65B9;&#x6CD5;&#x91CC;&#x589E;&#x52A0;&#x4E86;&#x50CF;<code>ACC_SYNCHRONIZED</code>,<code>ACC_NATIVE</code>,<code>ACC_STRICT</code>, <code>ACC_ABSTRACT</code>, &#x5206;&#x522B;&#x5BF9;&#x5E94;&#x7740;<code>synchronized</code>&#x3001;<code>native</code>&#x3001;<code>strictfp</code>&#x3001;<code>abstract</code>&#x8FD9;&#x4E9B;&#x53EA;&#x80FD;&#x4FEE;&#x9970;&#x65B9;&#x6CD5;&#x7684;&#x5173;&#x952E;&#x5B57;&#x3002;</p>
<p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x5206;&#x6790;&#x6211;&#x4EEC;&#x7A0B;&#x5E8F;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x4EE3;&#x7801;&#x4E86;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;000000f0  05 00 06 00 00 00 02 00  01 00 07 00 08 00 01 00  |................|</span><br><span class="line">00000100  09 00 00 00 2f 00 01 00  01 00 00 00 05 2a b7 00  |..../........*..|</span><br></pre></td></tr></table></figure>

<p>&#x4E0A;&#x4E00;&#x5C0F;&#x8282;&#x6211;&#x4EEC;&#x521A;&#x521A;&#x5206;&#x6790;&#x5230;000000f0&#x884C;&#x7684;0x0000&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x662F;<code>0x0002</code>&#xFF0C;&#x4EE3;&#x8868;&#x6709;&#x4E24;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x51E0;&#x4E2A;&#x5B57;&#x8282;&#x662F;</p>
<ul>
<li><code>0x0001</code>&#xFF1A;&#x8BBF;&#x95EE;&#x6807;&#x8BB0;&#x662F;ACC_PUBLIC</li>
<li><code>0x0007</code>&#xFF1A;&#x540D;&#x79F0;&#x7D22;&#x5F15;&#x6307;&#x5411;&#x7B2C;7&#x4E2A;&#x5E38;&#x91CF;&#xFF1A;</li>
<li><code>0x0008</code>&#xFF1A;&#x63CF;&#x8FF0;&#x7B26;&#x7D22;&#x5F15;&#x6307;&#x5411;&#x7B2C;8&#x4E2A;&#x5E38;&#x91CF;&#xFF1A;()V</li>
<li><code>0x0001</code>&#xFF1A;&#x5C5E;&#x6027;&#x6709;&#x4E00;&#x4E2A;</li>
<li><code>0x0009</code>&#xFF1A;&#x5C5E;&#x6027;&#x6307;&#x5411;&#x7B2C;9&#x4E2A;&#x5E38;&#x91CF;&#xFF0C;Code</li>
</ul>
<p>&#x6211;&#x4EEC;&#x6B63;&#x597D;&#x6709;&#x7591;&#x95EE;&#xFF0C;&#x65B9;&#x6CD5;&#x5B9A;&#x4E49;&#x6709;&#x4E86;&#xFF0C;&#x65B9;&#x6CD5;&#x4F53;&#x5728;&#x54EA;&#x5462;&#xFF0C;&#x7B54;&#x6848;&#x5C31;&#x662F;&#x4E0A;&#x9762;&#x5206;&#x6790;&#x7684;&#x6700;&#x540E;&#x4E00;&#x4E2A;Code&#x3002;&#x4E0B;&#x4E00;&#x8282;&#x5C31;&#x8BF4;&#x8BF4;&#x5C5E;&#x6027;&#x8868;&#x96C6;&#x5408;&#x7684;&#x5404;&#x79CD;&#x53EF;&#x80FD;&#x3002;</p>
<h3 id="8-&#x5C5E;&#x6027;&#x8868;&#x96C6;&#x5408;"><a href="#8-&#x5C5E;&#x6027;&#x8868;&#x96C6;&#x5408;" class="headerlink" title="8.&#x5C5E;&#x6027;&#x8868;&#x96C6;&#x5408;"></a>8.&#x5C5E;&#x6027;&#x8868;&#x96C6;&#x5408;</h3><p>&#x5C5E;&#x6027;&#x8868;(attribute_info)&#x5728;&#x524D;&#x9762;&#x5DF2;&#x7ECF;&#x591A;&#x6B21;&#x63D0;&#x53CA;&#xFF0C;Class&#x6587;&#x4EF6;&#x3001;&#x5B57;&#x6BB5;&#x8868;&#x3001;&#x65B9;&#x6CD5;&#x8868;&#x4E2D;&#x90FD;&#x53EF;&#x4EE5;&#x643A;&#x5E26;&#x81EA;&#x5DF1;&#x7684;&#x5C5E;&#x6027;&#x8868;&#x96C6;&#x5408;&#xFF0C;&#x7528;&#x4E8E;&#x63CF;&#x8FF0;&#x67D0;&#x4E9B;&#x573A;&#x666F;&#x8F6C;&#x6709;&#x7684;&#x4FE1;&#x606F;&#x3002;<br>&#x5C5E;&#x6027;&#x8868;&#x5E76;&#x6CA1;&#x6709;&#x4E25;&#x683C;&#x9650;&#x5236;&#x987A;&#x5E8F;&#xFF0C;&#x53EA;&#x8981;&#x4E0D;&#x4E0E;&#x5DF2;&#x6709;&#x5C5E;&#x6027;&#x540D;&#x91CD;&#x590D;&#xFF0C;&#x4EFB;&#x4F55;&#x4EBA;&#x5B9E;&#x73B0;&#x7684;&#x7F16;&#x8BD1;&#x5668;&#x90FD;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x81EA;&#x5DF1;&#x5B9A;&#x4E49;&#x7684;&#x5C5E;&#x6027;&#x4FE1;&#x606F;&#xFF0C;&#x4EE5;&#x4E0B;&#x662F;&#x4E00;&#x4E9B;&#x9884;&#x5B9A;&#x4E49;&#x7684;&#x5C5E;&#x6027;&#xFF1A;</p>
<table>
<thead>
<tr>
<th>&#x5C5E;&#x6027;&#x540D;&#x79F0;</th>
<th>&#x4F7F;&#x7528;&#x4F4D;&#x7F6E;</th>
<th>&#x542B;&#x4E49;</th>
</tr>
</thead>
<tbody><tr>
<td>SourceFile</td>
<td>ClassFile</td>
<td>&#x8BB0;&#x5F55;&#x6E90;&#x6587;&#x4EF6;&#x7684;&#x540D;&#x79F0;</td>
</tr>
<tr>
<td>InnerClasses</td>
<td>ClassFile</td>
<td>&#x5185;&#x90E8;&#x7C7B;&#x5217;&#x8868;</td>
</tr>
<tr>
<td>EnclosingMethod</td>
<td>ClassFile</td>
<td>&#x5185;&#x90E8;&#x7C7B;&#x624D;&#x6709;&#x8FD9;&#x4E2A;&#x5C5E;&#x6027;&#xFF0C;&#x7528;&#x4E8E;&#x6807;&#x8BC6;&#x8FD9;&#x4E2A;&#x7C7B;&#x6240;&#x5728;&#x7684;&#x5916;&#x56F4;&#x65B9;&#x6CD5;</td>
</tr>
<tr>
<td>SourceDebugExtension</td>
<td>ClassFile</td>
<td>&#x7528;&#x4E8E;&#x5B58;&#x50A8;&#x989D;&#x5916;&#x7684;&#x8C03;&#x8BD5;&#x4FE1;&#x606F;&#xFF0C;JDK1.6&#x4E2D;&#x65B0;&#x589E;</td>
</tr>
<tr>
<td>BootstrapMethods</td>
<td>ClassFile</td>
<td>&#x7528;&#x4E8E;&#x4FDD;&#x5B58;invokeddynamic&#x6307;&#x4EE4;&#x5F15;&#x7528;&#x7684;&#x5F15;&#x5BFC;&#x65B9;&#x6CD5;&#x9650;&#x5B9A;&#x7B26;,JDK1.7&#x4E2D;&#x65B0;&#x589E;</td>
</tr>
<tr>
<td>ConstantValue</td>
<td>field_info</td>
<td>final&#x5173;&#x952E;&#x5B57;&#x5B9A;&#x4E49;&#x7684;&#x5E38;&#x91CF;&#x503C;</td>
</tr>
<tr>
<td>Code</td>
<td>method_info</td>
<td>Java&#x4EE3;&#x7801;&#x7F16;&#x8BD1;&#x6210;&#x7684;&#x5B57;&#x8282;&#x7801;&#x6307;&#x4EE4;</td>
</tr>
<tr>
<td>Exceptions</td>
<td>method_info</td>
<td>&#x65B9;&#x6CD5;&#x629B;&#x51FA;&#x7684;&#x5F02;&#x5E38;</td>
</tr>
<tr>
<td>RuntimeVisibleParameterAnnotations, RuntimeInvisibleParameterAnnotations</td>
<td>method_info</td>
<td>&#x6307;&#x660E;&#x54EA;&#x4E9B;&#x53C2;&#x6570;&#x662F;&#x8FD0;&#x884C;&#x65F6;&#x53EF;&#x89C1;&#x7684;&#xFF0C;&#x54EA;&#x4E9B;&#x662F;&#x8FD0;&#x884C;&#x65F6;&#x4E0D;&#x53EF;&#x89C1;&#x7684;&#xFF0C;JDK1.5&#x4E2D;&#x65B0;&#x589E;</td>
</tr>
<tr>
<td>AnnotationDefault</td>
<td>method_info</td>
<td>&#x8BB0;&#x5F55;&#x6CE8;&#x89E3;&#x7C7B;&#x5143;&#x7D20;&#x7684;&#x9ED8;&#x8BA4;&#x503C;,JDK1.5&#x4E2D;&#x65B0;&#x589E;&#x7684;</td>
</tr>
<tr>
<td>MethodParameters</td>
<td>method_info</td>
<td>&#x8BB0;&#x5F55;&#x65B9;&#x6CD5;&#x7684;&#x53C2;&#x6570;&#x4FE1;&#x606F;&#xFF0C;&#x6BD4;&#x5982;&#x5B83;&#x4EEC;&#x7684;&#x540D;&#x5B57;&#xFF0C;&#x8BBF;&#x95EE;&#x7EA7;&#x522B;&#xFF0C;JDK1.8&#x65B0;&#x589E;</td>
</tr>
<tr>
<td>Synthetic</td>
<td>ClassFile, field_info, method_info</td>
<td>&#x8868;&#x793A;&#x65B9;&#x6CD5;&#x6216;&#x5B57;&#x6BB5;&#x662F;&#x7F16;&#x8BD1;&#x5668;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;</td>
</tr>
<tr>
<td>Deprecated</td>
<td>ClassFile, field_info, method_info</td>
<td>&#x88AB;&#x58F0;&#x660E;&#x4E3A;deprecated&#x7684;&#x5B57;&#x6BB5;</td>
</tr>
<tr>
<td>Signature</td>
<td>ClassFile, field_info, method_info</td>
<td>&#x7528;&#x4E8E;&#x652F;&#x6301;&#x6CDB;&#x578B;&#x60C5;&#x51B5;&#x4E0B;&#x7684;&#x65B9;&#x6CD5;&#x7B7E;&#x540D;&#xFF0C;&#x5728;Java&#x8BED;&#x8A00;&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x4EFB;&#x4F55;&#x7C7B;&#x3001;&#x63A5;&#x53E3;&#x3001;&#x521D;&#x59CB;&#x5316;&#x65B9;&#x6CD5;&#x6216;&#x8005;&#x6210;&#x5458;&#x7684;&#x6CDB;&#x578B;&#x7B7E;&#x540D;&#x5305;&#x542B;&#x4E86;&#x7C7B;&#x578B;&#x53D8;&#x91CF;&#x6216;&#x8005;&#x53C2;&#x6570;&#x5316;&#x7C7B;&#x578B;&#xFF0C;&#x5219;Signature&#x5C5E;&#x6027;&#x4F1A;&#x4E3A;&#x5B83;&#x8BB0;&#x5F55;&#x6CDB;&#x578B;&#x7B7E;&#x540D;&#x4FE1;&#x606F;&#x3002;&#x7531;&#x4E8E;Java&#x7684;&#x6CDB;&#x578B;&#x91C7;&#x7528;&#x64E6;&#x9664;&#x6CD5;&#x5B9E;&#x73B0;&#xFF0C;&#x5728;&#x4E3A;&#x4E86;&#x907F;&#x514D;&#x7C7B;&#x578B;&#x4FE1;&#x606F;&#x88AB;&#x64E6;&#x9664;&#x540E;&#x5BFC;&#x81F4;&#x7B7E;&#x540D;&#x6DF7;&#x4E71;&#xFF0C;&#x9700;&#x8981;&#x8FD9;&#x4E2A;&#x5C5E;&#x6027;&#x8BB0;&#x5F55;&#x6CDB;&#x578B;&#x4E2D;&#x7684;&#x76F8;&#x5173;&#x4FE1;&#x606F;&#x3002;JDK1.5&#x4E2D;&#x65B0;&#x589E;</td>
</tr>
<tr>
<td>RuntimeVisibleAnnotations, RuntimeInvisibleAnnotations</td>
<td>ClassFile, field_info, method_info</td>
<td>&#x4E3A;&#x52A8;&#x6001;&#x6CE8;&#x89E3;&#x63D0;&#x4F9B;&#x652F;&#x6301;&#xFF0C;&#x6307;&#x660E;&#x54EA;&#x4E9B;&#x662F;&#x6CE8;&#x89E3;&#x662F;&#x8FD0;&#x884C;&#x65F6;&#x53EF;&#x89C1;&#x7684;&#xFF0C;&#x54EA;&#x4E9B;&#x662F;&#x8FD0;&#x884C;&#x65F6;&#x4E0D;&#x53EF;&#x89C1;&#x7684;&#xFF0C;JDK1.5&#x4E2D;&#x65B0;&#x589E;</td>
</tr>
<tr>
<td>LineNumberTable</td>
<td>Code</td>
<td>Java&#x6E90;&#x7801;&#x7684;&#x884C;&#x53F7;&#x4E0E;&#x5B57;&#x8282;&#x7801;&#x6307;&#x4EE4;&#x7684;&#x5BF9;&#x5E94;&#x5173;&#x7CFB;</td>
</tr>
<tr>
<td>LocalVariableTable</td>
<td>Code</td>
<td>&#x65B9;&#x6CD5;&#x7684;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x63CF;&#x8FF0;</td>
</tr>
<tr>
<td>LocalVariableTypeTable</td>
<td>Code</td>
<td>&#x4F7F;&#x7528;&#x7279;&#x5F81;&#x7B7E;&#x540D;&#x4EE3;&#x66FF;&#x63CF;&#x8FF0;&#x7B26;&#xFF0C;&#x662F;&#x4E3A;&#x4E86;&#x5F15;&#x5165;&#x6CDB;&#x578B;&#x8BED;&#x6CD5;&#x4E4B;&#x540E;&#x80FD;&#x63CF;&#x8FF0;&#x6CDB;&#x578B;&#x53C2;&#x6570;&#x5316;&#x7C7B;&#x578B;&#x800C;&#x6DFB;&#x52A0;&#xFF0C;JDK1.5&#x4E2D;&#x65B0;&#x589E;</td>
</tr>
<tr>
<td>StackMapTable</td>
<td>Code</td>
<td>&#x4F9B;&#x65B0;&#x7684;&#x7C7B;&#x578B;&#x68C0;&#x67E5;&#x9A8C;&#x8BC1;&#x5668;(Type Checker)&#x68C0;&#x67E5;&#x548C;&#x5904;&#x7406;&#x76EE;&#x6807;&#x65B9;&#x6CD5;&#x7684;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x548C;&#x64CD;&#x4F5C;&#x6808;&#x6240;&#x9700;&#x8981;&#x7684;&#x7C7B;&#x578B;&#x662F;&#x5426;&#x5339;&#x914D;&#xFF0C;JDK1.6&#x65B0;&#x589E;</td>
</tr>
<tr>
<td>RuntimeVisibleTypeAnnotations, RuntimeInvisibleTypeAnnotations</td>
<td>ClassFile, field_info, method_info, Code</td>
<td>&#x8BB0;&#x5F55;&#x8FD0;&#x884C;&#x65F6;&#x7C7B;&#x578B;&#x4E0A;&#x6CE8;&#x89E3;&#x7684;&#x53EF;&#x89C1;&#x6027;&#xFF0C;&#x4E5F;&#x5305;&#x62EC;&#x8FD0;&#x884C;&#x65F6;&#x7C7B;&#x578B;&#x53C2;&#x6570;&#x7684;&#x6CE8;&#x89E3;&#x7684;&#x53EF;&#x89C1;&#x6027;</td>
</tr>
</tbody></table>
<p>&#x4E0B;&#x9762;&#x5177;&#x4F53;&#x8BF4;&#x4E00;&#x8BF4;&#x4E00;&#x4E9B;&#x6BD4;&#x8F83;&#x91CD;&#x8981;&#x7684;&#x5C5E;&#x6027;&#xFF1A;</p>
<h4 id="Code&#x5C5E;&#x6027;"><a href="#Code&#x5C5E;&#x6027;" class="headerlink" title="Code&#x5C5E;&#x6027;"></a>Code&#x5C5E;&#x6027;</h4><p>&#x9996;&#x5148;&#x6765;&#x770B;Code&#x5C5E;&#x6027;&#x7684;&#x7ED3;&#x6784;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;Code_attribute {</span><br><span class="line">    u2 attribute_name_index;</span><br><span class="line">    u4 attribute_length;</span><br><span class="line">    u2 max_stack;</span><br><span class="line">    u2 max_locals;</span><br><span class="line">    u4 code_length;</span><br><span class="line">    u1 code[code_length];</span><br><span class="line">    u2 exception_table_length;</span><br><span class="line">    {   u2 start_pc;</span><br><span class="line">        u2 end_pc;</span><br><span class="line">        u2 handler_pc;</span><br><span class="line">        u2 catch_type;</span><br><span class="line">    } exception_table[exception_table_length];</span><br><span class="line">    u2 attributes_count;</span><br><span class="line">    attribute_info attributes[attributes_count];</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>attribute_name_index</strong>&#xFF1A; &#x5360;&#x4E24;&#x4E2A;&#x5B57;&#x8282;&#xFF0C;&#x6307;&#x5411;CONSTANT_Utf8_info&#x5E38;&#x91CF;&#xFF0C;&#x8868;&#x793A;&#x5C5E;&#x6027;&#x540D;&#xFF0C;&#x8FD9;&#x91CC;&#x56FA;&#x5B9A;&#x662F;&#x201D;Code&#x201D;</li>
<li><strong>attribute_length</strong>&#xFF1A;&#x5C5E;&#x6027;&#x503C;&#x7684;&#x957F;&#x5EA6;&#xFF0C;&#x7531;&#x4E8E;attribute_name_index&#x548C;attribute_length&#x5360;6&#x4E2A;&#x5B57;&#x8282;&#xFF0C;&#x6240;&#x4EE5;attribute_length&#x4E3A;&#x5C5E;&#x6027;&#x8868;&#x957F;&#x5EA6;&#x51CF;6</li>
<li><strong>max_statck</strong>: &#x64CD;&#x4F5C;&#x6570;&#x6808;&#x6DF1;&#x5EA6;&#x7684;&#x6700;&#x5927;&#x503C;&#xFF0C;&#x5728;&#x65B9;&#x6CD5;&#x6267;&#x884C;&#x65F6;&#xFF0C;&#x64CD;&#x4F5C;&#x6570;&#x6808;&#x4E0D;&#x80FD;&#x8D85;&#x8FC7;&#x8FD9;&#x4E2A;&#x503C;</li>
<li><strong>max_locals</strong>&#xFF1A; &#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x6240;&#x9700;&#x7684;&#x5B58;&#x50A8;&#x7A7A;&#x95F4;&#x3002;max_locals&#x7684;&#x5355;&#x4F4D;&#x662F;Slot,Slot&#x662F;&#x865A;&#x62DF;&#x673A;&#x4E3A;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x5206;&#x914D;&#x7684;&#x6700;&#x5C0F;&#x5355;&#x4F4D;&#xFF0C;&#x5BF9;&#x4E8E;byte,char,float,int,short,boolean&#x548C;returnAddress&#x7B49;&#x957F;&#x5EA6;&#x4E0D;&#x8D85;&#x8FC7;32&#x4F4D;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#xFF0C;&#x90FD;&#x53EA;&#x5360;&#x4E00;&#x4E2A;slot&#xFF0C;&#x800C;double&#x548C;long &#x8FD9;&#x79CD;64&#x4E3A;&#x7684;&#x6570;&#x636E;&#x90FD;&#x662F;&#x9700;&#x8981;&#x5360;&#x7528;&#x4E24;&#x4E2A;slot&#x3002;&#x65B9;&#x6CD5;&#x53C2;&#x6570;&#xFF08;&#x5305;&#x62EC;&#x9690;&#x85CF;&#x7684;<code>this</code>&#xFF09;&#x3001;&#x5F02;&#x5E38;&#x5904;&#x7406;&#x5668;&#x7684;&#x53C2;&#x6570;&#x3001;&#x65B9;&#x6CD5;&#x4F53;&#x5B9A;&#x4E49;&#x7684;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x90FD;&#x9700;&#x8981;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x8868;&#x6765;&#x5B58;&#x653E;&#x3002;&#x4F46;&#x662F;max_locals&#x5E76;&#x4E0D;&#x662F;&#x6240;&#x6709;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x6240;&#x5360;&#x7684;slot&#x4E4B;&#x548C;&#xFF0C;&#x56E0;&#x4E3A;slot&#x53EF;&#x4EE5;&#x91CD;&#x7528;&#xFF0C;&#x5F53;&#x4E00;&#x4E2A;&#x53D8;&#x91CF;&#x8D85;&#x51FA;&#x4F5C;&#x7528;&#x57DF;&#x4E86;&#xFF0C;&#x8BE5;slot&#x53C8;&#x4F1A;&#x7ED9;&#x522B;&#x7684;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x4F7F;&#x7528;&#xFF0C;&#x7F16;&#x8BD1;&#x5668;&#x4F1A;&#x6839;&#x636E;&#x4F5C;&#x7528;&#x57DF;&#x8BA1;&#x7B97;max_locals&#x3002;</li>
<li><strong>code_length</strong>: &#x7F16;&#x8BD1;&#x5668;&#x7F16;&#x8BD1;&#x540E;&#x7684;&#x5B57;&#x8282;&#x7801;&#x957F;&#x5EA6;</li>
<li><strong>code</strong>: &#x7528;&#x4E8E;&#x5B58;&#x50A8;&#x5B57;&#x8282;&#x7801;&#x6307;&#x4EE4;&#x7684;&#x4E00;&#x7CFB;&#x5217;&#x5B57;&#x8282;&#x6D41;&#xFF0C;&#x6BCF;&#x4E2A;&#x6307;&#x4EE4;&#x662F;&#x4E00;&#x4E2A;u1&#x7C7B;&#x578B;&#x7684;&#x5355;&#x5B57;&#x8282;&#xFF0C;&#x5F53;&#x865A;&#x62DF;&#x673A;&#x8BFB;&#x5230;&#x8BE5;&#x5B57;&#x8282;&#x65F6;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x77E5;&#x9053;&#x662F;&#x4EC0;&#x4E48;&#x6307;&#x4EE4;&#xFF0C;&#x77E5;&#x9053;&#x662F;&#x4EC0;&#x4E48;&#x6307;&#x4EE4;&#xFF0C;&#x5C31;&#x77E5;&#x9053;&#x6307;&#x4EE4;&#x9700;&#x8981;&#x4EC0;&#x4E48;&#x64CD;&#x4F5C;&#x6570;&#xFF0C;&#x7EE7;&#x7EED;&#x8BFB;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#xFF0C;&#x8FD9;&#x91CC;&#x7C7B;&#x4F3C;&#x4E8E;&#x6C47;&#x7F16;&#xFF0C;u1&#x7684;&#x53D6;&#x503C;&#x8303;&#x56F4;&#x662F;0~255&#xFF0C;&#x53EF;&#x4EE5;&#x8868;&#x8FBE;256&#x6761;&#x6307;&#x4EE4;&#x3002;Java&#x865A;&#x62DF;&#x673A;&#x89C4;&#x8303;&#x4E2D;&#x5B9A;&#x4E49;&#x4E86;&#x7EA6;200&#x6761;&#x6307;&#x4EE4;&#xFF0C;&#x53C2;&#x770B;<a href="/external_links/c286dc800b4d2e91789eb1e240aff1c4.html" target="blank" rel="noopener">Instructions</a>&#x3002;&#x5173;&#x4E8E;&#x8FD9;&#x90E8;&#x5206;&#x5185;&#x5BB9;&#x4EE5;&#x540E;&#x518D;&#x5199;&#x535A;&#x5BA2;&#x4ECB;&#x7ECD;&#x4E86;&#x3002;</li>
<li><strong>exception_table_length</strong>&#xFF1A;&#x5F02;&#x5E38;&#x8868;&#x7684;&#x957F;&#x5EA6;</li>
<li><strong>exception_table</strong>&#xFF1A; &#x5F02;&#x5E38;&#x8868;&#x5BF9;&#x4E8E;Code&#x6765;&#x8BF4;&#x5E76;&#x4E0D;&#x662F;&#x5FC5;&#x987B;&#x5B58;&#x5728;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x4E0A;&#x8FF0;&#x957F;&#x5EA6;&#x4E5F;&#x53EF;&#x4EE5;&#x4E3A;0&#xFF0C;&#x5F02;&#x5E38;&#x8868;&#x6709;4&#x4E2A;&#x5C5E;&#x6027;&#xFF0C;&#x4EE3;&#x8868;&#x7740;&#x5982;&#x679C;&#x5728;start_pc&#x5230;end_pc&#x4E4B;&#x95F4;&#x51FA;&#x73B0;catch_type&#x7C7B;&#x578B;&#x7684;&#x5F02;&#x5E38;&#xFF0C;&#x5C31;&#x8DF3;&#x8F6C;&#x5230;handler_pc&#x6240;&#x6307;&#x5411;&#x7684;&#x884C;&#x5904;&#x7406;&#x3002;</li>
</ul>
<h4 id="Exceptions&#x5C5E;&#x6027;"><a href="#Exceptions&#x5C5E;&#x6027;" class="headerlink" title="Exceptions&#x5C5E;&#x6027;"></a>Exceptions&#x5C5E;&#x6027;</h4><p>Exceptions&#x5C5E;&#x6027;&#x5728;&#x65B9;&#x6CD5;&#x8868;&#x4E2D;&#x4E0E;Code&#x5C5E;&#x6027;&#x5E73;&#x7EA7;&#xFF0C;&#x6CE8;&#x610F;&#x548C;&#x4E0A;&#x9762;Code&#x4E2D;&#x7684;&#x5F02;&#x5E38;&#x8868;&#x4E0D;&#x540C;&#xFF0C;Exceptions&#x5C5E;&#x6027;&#x7684;&#x4F5C;&#x7528;&#x662F;&#x5217;&#x51FA;&#x65B9;&#x6CD5;&#x53EF;&#x80FD;&#x629B;&#x51FA;&#x7684;&#x5F02;&#x5E38;&#xFF0C;Exceptions&#x5C5E;&#x6027;&#x8868;&#x7684;&#x7ED3;&#x6784;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;Exceptions_attribute {</span><br><span class="line">    u2 attribute_name_index;</span><br><span class="line">    u4 attribute_length;</span><br><span class="line">    u2 number_of_exceptions;</span><br><span class="line">    u2 exception_index_table[number_of_exceptions];</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>number_of_exceptions</strong>: &#x53EF;&#x80FD;&#x629B;&#x51FA;&#x7684;&#x5F02;&#x5E38;&#x79CD;&#x7C7B;&#x7684;&#x4E2A;&#x6570;</li>
<li><strong>exception_index_table</strong>:&#x6307;&#x5411;&#x5E38;&#x91CF;&#x6C60;&#x4E2D;CONSTANT_Class_info&#x7684;&#x7D22;&#x5F15;</li>
</ul>
<h4 id="LineNumberTable&#x5C5E;&#x6027;"><a href="#LineNumberTable&#x5C5E;&#x6027;" class="headerlink" title="LineNumberTable&#x5C5E;&#x6027;"></a>LineNumberTable&#x5C5E;&#x6027;</h4><p>LineNumber&#x7528;&#x6765;&#x8BB0;&#x5F55;Java&#x6E90;&#x7801;&#x4E0E;&#x5B57;&#x8282;&#x7801;&#x884C;&#x53F7;&#x4E4B;&#x95F4;&#x7684;&#x5BF9;&#x5E94;&#x5173;&#x7CFB;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x7F16;&#x8BD1;&#x4EE3;&#x7801;&#x65F6;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>-g: none</code>&#x6216;<code>-g: line</code>&#x6765;&#x53D6;&#x6D88;&#x751F;&#x6210;&#x8FD9;&#x4E2A;&#x5C5E;&#x6027;&#xFF0C;&#x4E0D;&#x8FC7;&#x5728;&#x8C03;&#x8BD5;&#x4EE3;&#x7801;&#x65F6;&#x5C31;&#x770B;&#x4E0D;&#x5230;&#x884C;&#x53F7;&#x4E86;&#xFF0C;&#x4E5F;&#x65E0;&#x6CD5;&#x6253;&#x65AD;&#x70B9;&#x3002;</p>
<p>LineNumberTable&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;LineNumberTable_attribute {</span><br><span class="line">    u2 attribute_name_index;</span><br><span class="line">    u4 attribute_length;</span><br><span class="line">    u2 line_number_table_length;</span><br><span class="line">    {   u2 start_pc;</span><br><span class="line">        u2 line_number;    </span><br><span class="line">    } line_number_table[line_number_table_length];</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x6211;&#x4EEC;&#x4E3B;&#x8981;&#x770B;line_number_table&#xFF0C;start_pc&#x662F;&#x5B57;&#x8282;&#x7801;&#x884C;&#x53F7;&#xFF0C;line_number&#x662F;Java&#x6E90;&#x7801;&#x884C;&#x53F7;&#x3002;</p>
<h4 id="LocalVariableTable&#x5C5E;&#x6027;"><a href="#LocalVariableTable&#x5C5E;&#x6027;" class="headerlink" title="LocalVariableTable&#x5C5E;&#x6027;"></a>LocalVariableTable&#x5C5E;&#x6027;</h4><p>LocalVariableTable&#x5C5E;&#x6027;&#x7528;&#x4E8E;&#x63CF;&#x8FF0;&#x6808;&#x5E27;&#x4E2D;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x8868;&#x4E2D;&#x7684;&#x53D8;&#x91CF;&#x4E0E;Java&#x6E90;&#x7801;&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x53D8;&#x91CF;&#x4E4B;&#x95F4;&#x7684;&#x5173;&#x7CFB;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x7F16;&#x8BD1;&#x4EE3;&#x7801;&#x65F6;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>-g: none</code>&#x6216;<code>-g: vars</code>&#x6765;&#x53D6;&#x6D88;&#x751F;&#x6210;&#x8FD9;&#x4E2A;&#x5C5E;&#x6027;&#xFF0C;&#x4F46;&#x662F;&#x5982;&#x679C;&#x53D6;&#x6D88;&#x7684;&#x8BDD;&#xFF0C;IDE&#x4F1A;&#x7528;arg0,arg1&#x8FD9;&#x6837;&#x7684;&#x53C2;&#x6570;&#x6765;&#x53D6;&#x4EE3;&#x539F;&#x6709;&#x7684;&#x53C2;&#x6570;&#x540D;&#xFF0C;&#x5BFC;&#x81F4;&#x8C03;&#x8BD5;&#x65F6;&#x4E0D;&#x6E05;&#x6670;&#x3002;<br>LocalVariableTable&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;LocalVariableTable_attribute {</span><br><span class="line">    u2 attribute_name_index;</span><br><span class="line">    u4 attribute_length;</span><br><span class="line">    u2 local_variable_table_length;</span><br><span class="line">    {   u2 start_pc;</span><br><span class="line">        u2 length;</span><br><span class="line">        u2 name_index;</span><br><span class="line">        u2 descriptor_index;</span><br><span class="line">        u2 index;</span><br><span class="line">    } local_variable_table[local_variable_table_length];</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4E3B;&#x8981;&#x4ECB;&#x7ECD;local_variable_table&#xFF1A;</p>
<ul>
<li><strong>start_pc&#x548C;length</strong>&#xFF1A; &#x5206;&#x522B;&#x4EE3;&#x8868;&#x4E86;&#x8FD9;&#x4E2A;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x5F00;&#x59CB;&#x7684;&#x5B57;&#x8282;&#x7801;&#x504F;&#x79FB;&#x91CF;&#x4EE5;&#x53CA;&#x4F5C;&#x7528;&#x8303;&#x56F4;&#x8986;&#x76D6;&#x7684;&#x957F;&#x5EA6;</li>
<li><strong>name_index&#x548C;descriptor_index</strong>&#xFF1A;&#x5206;&#x522B;&#x6307;&#x5411;&#x4EE3;&#x8868;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x540D;&#x79F0;&#x548C;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x63CF;&#x8FF0;&#x7B26;&#x7684;&#x5E38;&#x91CF;</li>
<li><strong>index</strong>&#xFF1A; &#x662F;&#x8BE5;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x5728;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x8868;&#x4E2D;&#x7684;slot&#x4F4D;&#x7F6E;&#xFF0C;&#x5982;&#x679C;&#x53D8;&#x91CF;&#x65F6;double &#x6216;&#x8005;long&#x7C7B;&#x578B;&#x7684;&#xFF0C;&#x5360;&#x7528;&#x7684;slot&#x4E3A;index&#x548C;index+1&#x4E24;&#x4E2A;&#x3002;</li>
</ul>
<h4 id="ConstantValue&#x5C5E;&#x6027;"><a href="#ConstantValue&#x5C5E;&#x6027;" class="headerlink" title="ConstantValue&#x5C5E;&#x6027;"></a>ConstantValue&#x5C5E;&#x6027;</h4><p>ConstantValue&#x662F;&#x4E00;&#x4E2A;&#x5B9A;&#x957F;&#x5C5E;&#x6027;&#xFF0C;&#x7528;&#x6765;&#x901A;&#x77E5;&#x865A;&#x62DF;&#x673A;&#x4E3A;&#x9759;&#x6001;&#x53D8;&#x91CF;&#x8D4B;&#x503C;&#xFF0C;&#x5982;&#x679C;&#x540C;&#x65F6;&#x5B9A;&#x4E49;&#x4E86;<code>int x=3;</code>&#x548C;<code>static int y=3;</code>&#x5219;&#x865A;&#x62DF;&#x673A;&#x4E3A;x,y&#x8D4B;&#x503C;&#x7684;&#x65F6;&#x673A;&#x4E0D;&#x540C;&#xFF0C;&#x5BF9;&#x4E8E;x&#xFF0C;&#x662F;&#x5728;&#x5B9E;&#x4F8B;&#x6784;&#x9020;&#x5668;<code>&lt;init&gt;</code>&#x4E2D;&#x8FDB;&#x884C;&#x7684;&#xFF0C;&#x800C;static&#x7C7B;&#x578B;&#x7684;&#x53D8;&#x91CF;&#xFF0C;&#x5219;&#x4F1A;&#x5728;&#x7C7B;&#x6784;&#x9020;&#x5668;<code>&lt;clinit&gt;</code>&#x65B9;&#x6CD5;&#x4E2D;&#x6216;&#x8005;&#x4F7F;&#x7528;ConstantValue&#x5C5E;&#x6027;&#x3002;<br>&#x76EE;&#x524D;javac&#x7F16;&#x8BD1;&#x5668;&#x7684;&#x89C4;&#x5219;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x540C;&#x65F6;&#x6709;final&#x548C;static&#x4FEE;&#x9970;&#xFF0C;&#x5219;&#x662F;&#x4F7F;&#x7528;ConstantValue&#x5C5E;&#x6027;&#xFF0C;&#x53EA;&#x6709;static&#x65F6;&#xFF0C;&#x5E76;&#x4E14;&#x53D8;&#x91CF;&#x7C7B;&#x578B;&#x662F;&#x57FA;&#x672C;&#x7C7B;&#x578B;&#x6216;&#x8005;String&#x65F6;&#xFF0C;&#x5C31;&#x4F1A;&#x5728;<code>&lt;clinit&gt;</code>&#x4E2D;&#x8FDB;&#x884C;&#x521D;&#x59CB;&#x5316;&#x3002;</p>
<h4 id="InnerClasses&#x5C5E;&#x6027;"><a href="#InnerClasses&#x5C5E;&#x6027;" class="headerlink" title="InnerClasses&#x5C5E;&#x6027;"></a>InnerClasses&#x5C5E;&#x6027;</h4><p>&#x5982;&#x679C;&#x7C7B;&#x4E2D;&#x5B9A;&#x4E49;&#x4E86;&#x5185;&#x90E8;&#x7C7B;&#xFF0C;&#x5219;&#x4F1A;&#x4F7F;&#x7528;InnerClasses&#x5C5E;&#x6027;&#x6765;&#x8BB0;&#x5F55;&#x5185;&#x90E8;&#x7C7B;&#x548C;&#x5BBF;&#x4E3B;&#x7684;&#x5173;&#x7CFB;&#x3002;<br>InnerClasses&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;InnerClasses_attribute {</span><br><span class="line">    u2 attribute_name_index;</span><br><span class="line">    u4 attribute_length;</span><br><span class="line">    u2 number_of_classes;   //&#x8BB0;&#x5F55;&#x6709;&#x591A;&#x5C11;&#x4E2A;&#x5185;&#x90E8;&#x7C7B;</span><br><span class="line">    {   u2 inner_class_info_index;</span><br><span class="line">        u2 outer_class_info_index;</span><br><span class="line">        u2 inner_name_index;</span><br><span class="line">        u2 inner_class_access_flags;</span><br><span class="line">    } classes[number_of_classes];</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8FD8;&#x662F;&#x53EA;&#x770B;classes&#x5B57;&#x6BB5;&#xFF0C;inner_class_info_index&#x6307;&#x5411;&#x5185;&#x90E8;&#x7C7B;&#x7684;&#x7B26;&#x53F7;&#x5F15;&#x7528;&#xFF0C;outer_class_info_index&#x6307;&#x5411;&#x5BBF;&#x4E3B;&#x7C7B;&#x7684;&#x7B26;&#x53F7;&#x5F15;&#x7528;&#xFF0C;inner_name_index&#x6307;&#x5411;&#x5185;&#x90E8;&#x7C7B;&#x7684;&#x540D;&#x79F0;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x533F;&#x540D;&#x5185;&#x90E8;&#x7C7B;&#xFF0C;&#x5219;&#x4E3A;0&#xFF0C;inner_class_access_flags&#x662F;&#x5185;&#x90E8;&#x7C7B;&#x7684;&#x8BBF;&#x95EE;&#x6807;&#x5FD7;&#xFF0C;&#x89C1;&#x4E0B;&#x8868;&#xFF1A;</p>
<table>
<thead>
<tr>
<th>&#x6807;&#x5FD7;&#x540D;&#x79F0;</th>
<th>&#x6807;&#x5FD7;&#x503C;</th>
<th>&#x542B;&#x4E49;</th>
</tr>
</thead>
<tbody><tr>
<td>ACC_PUBLIC</td>
<td>0x0001</td>
<td>Marked or implicitly public in source.</td>
</tr>
<tr>
<td>ACC_PRIVATE</td>
<td>0x0002</td>
<td>Marked private in source.</td>
</tr>
<tr>
<td>ACC_PROTECTED</td>
<td>0x0004</td>
<td>Marked protected in source.</td>
</tr>
<tr>
<td>ACC_STATIC</td>
<td>0x0008</td>
<td>Marked or implicitly static in source.</td>
</tr>
<tr>
<td>ACC_FINAL</td>
<td>0x0010</td>
<td>Marked final in source.</td>
</tr>
<tr>
<td>ACC_INTERFACE</td>
<td>0x0200</td>
<td>Was an interface in source.</td>
</tr>
<tr>
<td>ACC_ABSTRACT</td>
<td>0x0400</td>
<td>Marked or implicitly abstract in source.</td>
</tr>
<tr>
<td>ACC_SYNTHETIC</td>
<td>0x1000</td>
<td>Declared synthetic; not present in the source code.</td>
</tr>
<tr>
<td>ACC_ANNOTATION</td>
<td>0x2000</td>
<td>Declared as an annotation type.</td>
</tr>
<tr>
<td>ACC_ENUM</td>
<td>0x4000</td>
<td>Declared as an enum type.</td>
</tr>
</tbody></table>
<p>&#x8FD8;&#x6709;&#x5176;&#x5B83;&#x7684;&#x4E00;&#x4E9B;&#x5C5E;&#x6027;&#xFF0C;&#x5982;&#x679C;&#x60F3;&#x4E86;&#x89E3;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x4E00;&#x4E0B;&#x53C2;&#x8003;&#x8D44;&#x6599;&#x3002;</p>
<p>&#x53C2;&#x8003;&#x8D44;&#x6599;&#xFF1A;</p>
<ol>
<li><a href="/external_links/e83f2bae29cc1139f00b53229d49f18a.html" target="blank" rel="noopener">Java Virtual Machine Specification</a></li>
<li><a href="/external_links/12068d4e063b21ee4de34e02cb7c332a.html" target="blank" rel="noopener">Java&#x865A;&#x62DF;&#x673A;&#xFF1A;JVM&#x9AD8;&#x7EA7;&#x7279;&#x6027;&#x4E0E;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;</a></li>
</ol>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/f00beeaa428d5da198f7840120a941a3.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903511893737486.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903511893737486.html" itemprop="url">图解红黑树</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-20T14:13:30+08:00">
                2017-11-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x7EA2;&#x9ED1;&#x6811;&#xFF08;&#x82F1;&#x8BED;&#xFF1A;Red&#x2013;black tree&#xFF09;&#x662F;&#x4E00;&#x79CD;&#x81EA;&#x5E73;&#x8861;&#x4E8C;&#x53C9;&#x67E5;&#x627E;&#x6811;&#xFF0C;&#x662F;&#x5728;&#x8BA1;&#x7B97;&#x673A;&#x79D1;&#x5B66;&#x4E2D;&#x7528;&#x5230;&#x7684;&#x4E00;&#x79CD;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF0C;&#x5178;&#x578B;&#x7684;&#x7528;&#x9014;&#x662F;&#x5B9E;&#x73B0;&#x5173;&#x8054;&#x6570;&#x7EC4;&#x3002;&#x5728;&#x4E86;&#x89E3;&#x7EA2;&#x9ED1;&#x6811;&#x4E4B;&#x524D;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x7B80;&#x8FF0;&#x4E00;&#x4E0B;&#x4E8C;&#x53C9;&#x67E5;&#x627E;&#x6811;&#x3002;</p>
<h2 id="BST"><a href="#BST" class="headerlink" title="BST"></a>BST</h2><p>&#x4E8C;&#x53C9;&#x67E5;&#x627E;&#x6811;&#xFF0C;&#x4E5F;&#x79F0;&#x6709;&#x5E8F;&#x4E8C;&#x53C9;&#x6811;&#xFF0C;&#x662F;&#x6307;&#x4E00;&#x68F5;&#x7A7A;&#x6811;&#x6216;&#x8005;&#x5177;&#x6709;&#x4EE5;&#x4E0B;&#x6027;&#x8D28;&#x7684;&#x4E8C;&#x53C9;&#x6811;&#xFF1A;</p>
<ul>
<li><p>&#x5DE6;&#x5B50;&#x8282;&#x70B9;&#x7684;&#x503C;&#x6BD4;&#x7236;&#x8282;&#x70B9;&#x5C0F;</p>
</li>
<li><p>&#x53F3;&#x5B50;&#x8282;&#x70B9;&#x7684;&#x503C;&#x6BD4;&#x7236;&#x8282;&#x70B9;&#x5927;</p>
</li>
<li><p>&#x4EFB;&#x610F;&#x8282;&#x70B9;&#x7684;&#x5DE6;&#x53F3;&#x5B57;&#x6811;&#x4E5F;&#x5206;&#x522B;&#x4E3A;&#x4E8C;&#x53C9;&#x67E5;&#x627E;&#x6811;</p>
</li>
<li><p>&#x6CA1;&#x6709;&#x952E;&#x503C;&#x76F8;&#x7B49;&#x7684;&#x70B9;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/c7a82aae8764aa0ec0e5803ce45c94d4e47176349b39919373eadbce2bb7859c" alt="BST"><br><em>BST</em><br>&#x5728;&#x7406;&#x60F3;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4E8C;&#x53C9;&#x67E5;&#x627E;&#x6811;&#x589E;&#x5220;&#x6539;&#x67E5;&#x7684;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E3A;O(logN)&#xFF0C;&#x4F46;&#x662F;&#x82E5;&#x662F;&#x4E8C;&#x53C9;&#x6811;&#x6781;&#x5EA6;&#x4E0D;&#x5E73;&#x8861;&#xFF0C;&#x6BD4;&#x5982;&#x4E0B;&#x56FE;&#x8FD9;&#x6837;&#x5F62;&#x6210;&#x4E86;&#x4E00;&#x4E2A;&#x7EBF;&#x6027;&#x94FE;&#x540E;&#xFF0C;&#x5C31;&#x4F1A;&#x4EA7;&#x751F;&#x6700;&#x574F;&#x8FD0;&#x884C;&#x60C5;&#x51B5;O(N).</p>
</li>
</ul>
<p> <img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/d07894def41ce3d9e349983ea656738a7550d04a3c1b0b844219bb4ea85f6aaa" alt="&#x6700;&#x574F;&#x8FD0;&#x884C;&#x590D;&#x6742;&#x5EA6;"><br> <em>&#x6700;&#x574F;&#x8FD0;&#x884C;&#x590D;&#x6742;&#x5EA6;</em><br>&#x57FA;&#x4E8E;BST&#x5B58;&#x5728;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x5E73;&#x8861;&#x4E8C;&#x53C9;&#x6811;&#x4EA7;&#x751F;&#x4E86;&#xFF0C;&#x5178;&#x578B;&#x7684;&#x6709;AVL&#x6811;&#x548C;&#x7EA2;&#x9ED1;&#x6811;&#xFF0C;&#x56E0;&#x4E3A;AVL&#x662F;&#x4E25;&#x683C;&#x7684;&#x5E73;&#x8861;&#x4E8C;&#x53C9;&#x6811;&#xFF0C;&#x4F46;&#x662F;&#x63D2;&#x5165;&#x548C;&#x5220;&#x9664;&#x7684;&#x6027;&#x80FD;&#x8F83;&#x5DEE;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x5B9E;&#x9645;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E2D;&#x4E0D;&#x5982;&#x7EA2;&#x9ED1;&#x6811;&#x5E94;&#x7528;&#x5E7F;&#x6CDB;&#x3002;</p>
<h2 id="RBTree"><a href="#RBTree" class="headerlink" title="RBTree"></a>RBTree</h2><p>&#x7EA2;&#x9ED1;&#x6811;&#x7684;&#x5E94;&#x7528;&#x975E;&#x5E38;&#x5E7F;&#x6CDB;&#xFF0C;&#x5E38;&#x89C1;&#x7684;&#x51FD;&#x6570;&#x5E93;&#xFF0C;&#x5982;C++&#x4E2D;&#x7684;map&#xFF0C;multimap,&#x4EE5;&#x53CA;Java&#x4E2D;&#x7684;TreeMap&#xFF0C;TreeSet&#xFF0C; Java8&#x4E2D;&#x7684;HashMap&#x7684;&#x5B9E;&#x73B0;&#x4E5F;&#x91C7;&#x7528;&#x4E86;&#x7EA2;&#x9ED1;&#x6811;&#x3002;</p>
<p>&#x7EA2;&#x9ED1;&#x6811;&#x4ECE;&#x672C;&#x8D28;&#x4E0A;&#x6765;&#x8BF4;&#x5C31;&#x662F;&#x4E00;&#x9897;&#x4E8C;&#x53C9;&#x67E5;&#x627E;&#x6811;&#xFF0C;&#x4F46;&#x662F;&#x5728;&#x4E8C;&#x53C9;&#x6811;&#x7684;&#x57FA;&#x7840;&#x4E0A;&#x589E;&#x52A0;&#x4E86;&#x7740;&#x8272;&#x76F8;&#x5173;&#x7684;&#x6027;&#x8D28;&#xFF0C;&#x4F7F;&#x5F97;&#x7EA2;&#x9ED1;&#x6811;&#x53EF;&#x4EE5;&#x4FDD;&#x8BC1;&#x76F8;&#x5BF9;&#x5E73;&#x8861;&#xFF0C;&#x4ECE;&#x800C;&#x4FDD;&#x8BC1;&#x7EA2;&#x9ED1;&#x6811;&#x7684;&#x589E;&#x5220;&#x6539;&#x67E5;&#x7684;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x6700;&#x574F;&#x4E5F;&#x80FD;&#x8FBE;&#x5230;O(log N)&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x662F;&#x7EA2;&#x9ED1;&#x6811;&#x6700;&#x91CD;&#x8981;&#x7684;5&#x6761;&#x6027;&#x8D28;&#xFF0C;&#x540E;&#x9762;&#x9700;&#x8981;&#x6B63;&#x5E38;&#x56DE;&#x6765;&#x67E5;&#x770B;&#xFF1A;</p>
<blockquote>
<ol>
<li>&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x8981;&#x4E48;&#x662F;&#x9ED1;&#x7684;&#xFF0C;&#x8981;&#x4E48;&#x662F;&#x7EA2;&#x7684;</li>
<li>&#x6839;&#x8282;&#x70B9;&#x662F;&#x9ED1;&#x7684;</li>
<li>&#x53F6;&#x8282;&#x70B9;&#x662F;&#x9ED1;&#x7684;</li>
<li>&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x662F;&#x7EA2;&#x7684;&#xFF0C;&#x4ED6;&#x7684;&#x4E24;&#x4E2A;&#x513F;&#x5B50;&#x8282;&#x70B9;&#x90FD;&#x662F;&#x9ED1;&#x7684;</li>
<li>&#x5BF9;&#x4E8E;&#x4EFB;&#x4E00;&#x8282;&#x70B9;&#x800C;&#x8A00;&#xFF0C;&#x5176;&#x5230;&#x53F6;&#x8282;&#x70B9;&#x6811;&#x5C3E;&#x7AEF;NIL&#x6307;&#x9488;&#x7684;&#x6BCF;&#x4E00;&#x6761;&#x8DEF;&#x5F84;&#x90FD;&#x5305;&#x542B;&#x76F8;&#x540C;&#x6570;&#x76EE;&#x7684;&#x9ED1;&#x8282;&#x70B9;</li>
</ol>
</blockquote>
<p> <img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/4d28f9e8ea975a2daeba15789a10ec9bd19ac91131c4772199126a542ff830ca" alt="&#x7EA2;&#x9ED1;&#x6811;&#xFF08;&#x56FE;&#x7247;&#x5F15;&#x81EA;&#x7EF4;&#x57FA;&#x767E;&#x79D1;&#xFF09;"><br><em>&#x7EA2;&#x9ED1;&#x6811;&#xFF08;&#x56FE;&#x7247;&#x5F15;&#x81EA;&#x7EF4;&#x57FA;&#x767E;&#x79D1;&#xFF09;</em><br>&#x4E0A;&#x56FE;&#x662F;&#x4E00;&#x68F5;&#x5178;&#x578B;&#x7684;&#x7EA2;&#x9ED1;&#x6811;&#xFF0C;&#x7EA2;&#x9ED1;&#x6811;&#x7684;5&#x6761;&#x7279;&#x6027;&#x786E;&#x4FDD;&#x4E86;&#x4ECE;&#x6839;&#x5230;&#x53F6;&#x5B50;&#x7684;&#x6700;&#x957F;&#x7684;&#x53EF;&#x80FD;&#x8DEF;&#x5F84;&#x4E0D;&#x591A;&#x4E8E;&#x6700;&#x77ED;&#x7684;&#x53EF;&#x80FD;&#x8DEF;&#x5F84;&#x7684;&#x4E24;&#x500D;&#x957F;&#xFF0C;&#x4F7F;&#x5F97;&#x6574;&#x68F5;&#x6811;&#x5927;&#x81F4;&#x4E0A;&#x662F;&#x5E73;&#x8861;&#x7684;&#x3002;&#x6811;&#x4E0A;&#x7684;&#x589E;&#x5220;&#x6539;&#x67E5;&#x64CD;&#x4F5C;&#x7684;&#x6700;&#x574F;&#x60C5;&#x51B5;&#x65F6;&#x95F4;&#x90FD;&#x4E0E;&#x6811;&#x7684;&#x9AD8;&#x5EA6;&#x6210;&#x6B63;&#x6BD4;&#xFF0C;&#x6240;&#x4EE5;&#x7EA2;&#x9ED1;&#x6811;&#x5728;&#x6700;&#x574F;&#x60C5;&#x51B5;&#x4E0B;&#x4E5F;&#x662F;&#x9AD8;&#x6548;&#x7684;&#x3002;</p>
<p>&#x5728;&#x7EA2;&#x9ED1;&#x6811;&#x4E2D;&#x4E00;&#x822C;&#x7528;&#x9ED1;&#x7684;NIL&#x8282;&#x70B9;&#x8868;&#x793A;&#x53F6;&#x8282;&#x70B9;&#xFF0C;&#x4E0D;&#x5305;&#x542B;&#x503C;&#xFF0C;&#x53EA;&#x662F;&#x6807;&#x5FD7;&#x8BE5;&#x5206;&#x652F;&#x7ED3;&#x675F;&#xFF0C;&#x6709;&#x65F6;&#x5019;&#x7ED8;&#x56FE;&#x4E2D;&#x4F1A;&#x76F4;&#x63A5;&#x7701;&#x7565;&#x3002;</p>
<p>&#x5728;&#x6B63;&#x5F0F;&#x4ECB;&#x7ECD;&#x7EA2;&#x9ED1;&#x6811;&#x63D2;&#x5165;&#x548C;&#x5220;&#x9664;&#x64CD;&#x4F5C;&#x524D;&#xFF0C;&#x9700;&#x8981;&#x5148;&#x4E86;&#x89E3;&#x7EA2;&#x9ED1;&#x6811;&#x7684;&#x65CB;&#x8F6C;&#x64CD;&#x4F5C;&#x3002;</p>
<h2 id="RBTree&#x7684;&#x65CB;&#x8F6C;&#x64CD;&#x4F5C;"><a href="#RBTree&#x7684;&#x65CB;&#x8F6C;&#x64CD;&#x4F5C;" class="headerlink" title="RBTree&#x7684;&#x65CB;&#x8F6C;&#x64CD;&#x4F5C;"></a>RBTree&#x7684;&#x65CB;&#x8F6C;&#x64CD;&#x4F5C;</h2><p>&#x5F53;&#x5728;&#x542B;n&#x4E2A;&#x5173;&#x952E;&#x5B57;&#x7684;&#x7EA2;&#x9ED1;&#x6811;&#x4E0A;&#x8FDB;&#x884C;insert&#x548C;delete&#x64CD;&#x4F5C;&#x65F6;&#xFF0C;&#x4FEE;&#x6539;&#x540E;&#x7684;&#x6811;&#x53EF;&#x80FD;&#x4E0D;&#x6EE1;&#x8DB3;&#x4E0A;&#x9762;&#x7ED9;&#x51FA;&#x7684;5&#x4E2A;&#x7EA2;&#x9ED1;&#x6811;&#x7684;&#x57FA;&#x672C;&#x7279;&#x6027;&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x6539;&#x53D8;&#x6811;&#x4E2D;&#x7684;&#x67D0;&#x4E9B;&#x8282;&#x70B9;&#x7684;&#x989C;&#x8272;&#x4EE5;&#x53CA;&#x6307;&#x9488;&#x7ED3;&#x6784;&#x3002; &#x8FD9;&#x4E9B;&#x6307;&#x9488;&#x7ED3;&#x6784;&#x7684;&#x4FEE;&#x6539;&#x662F;&#x901A;&#x8FC7;&#x65CB;&#x8F6C;&#x5B8C;&#x6210;&#x7684;&#xFF0C;&#x65CB;&#x8F6C;&#x5206;&#x4E3A;&#x5DE6;&#x65CB;&#x548C;&#x53F3;&#x65CB;:</p>
<p> <img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/6788c5661ee282a64b539dba672b9d667167036a4c485bdc063d270332b80a2a" alt="&#x65CB;&#x8F6C;&#x64CD;&#x4F5C;"><br> <em>&#x65CB;&#x8F6C;&#x64CD;&#x4F5C;</em><br>&#x5F53;&#x5728;&#x67D0;&#x4E2A;&#x8282;&#x70B9;x&#x4E0A;&#x505A;&#x5DE6;&#x65CB;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x5047;&#x8BBE;&#x5B83;&#x7684;&#x53F3;&#x5B69;&#x5B50;&#x662F;y&#x8282;&#x70B9;&#x5E76;&#x4E14;&#x4E0D;&#x4E3A;NIL&#x3002;&#x5DE6;&#x65CB;&#x4EE5;x&#x5230;y&#x4E4B;&#x95F4;&#x7684;&#x8F74;&#x4E3A;&#x652F;&#x6491;&#xFF0C;&#x5DE6;&#x65CB;&#x540E;&#xFF0C;y&#x6210;&#x4E3A;&#x8BE5;&#x5C40;&#x90E8;&#x65B0;&#x7684;&#x6839;&#xFF0C;x&#x6210;&#x4E3A;y&#x7684;&#x505A;&#x5B69;&#x5B50;&#xFF0C;&#x800C;y&#x7684;&#x5DE6;&#x5B69;&#x5B50;&#x6210;&#x4E3A;x&#x7684;&#x53F3;&#x5B69;&#x5B50;&#xFF0C;&#x5373;&#x56FE;&#x4E2D;&#x7684;&#x3B2;&#x3002;&#x6211;&#x4EEC;&#x4EE5;&#x4E00;&#x6BB5;&#x4F2A;&#x4EE3;&#x7801;&#x8BF4;&#x660E;&#x5DE6;&#x65CB;&#x7684;&#x8FC7;&#x7A0B;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">stylus&#x590D;&#x5236;&#x4EE3;&#x7801;y&lt;-right[x]   //&#x628A;x&#x7684;&#x53F3;&#x513F;&#x5B50;&#x4FDD;&#x5B58;&#x4E3A;y</span><br><span class="line">right[x]&lt;-left[y]   //&#x628A;y&#x7684;&#x5DE6;&#x513F;&#x5B50;&#x7ED9;x&#x4F5C;&#x4E3A;&#x53F3;&#x513F;&#x5B50;</span><br><span class="line">p[left[y]]&lt;-x   //&#x628A;x&#x8BBE;&#x4E3A;y&#x7684;&#x5DE6;&#x513F;&#x5B50;&#x7684;&#x7238;&#x7238;&#xFF0C;&#x8FD9;&#x4E00;&#x6B65;&#x4E0E;&#x4E0A;&#x4E00;&#x6B65;&#x5BF9;&#x5E94;&#xFF0C;&#x56E0;&#x4E3A;&#x6307;&#x9488;&#x90FD;&#x662F;&#x53CC;&#x5411;&#x7684;</span><br><span class="line">p[y]&lt;-p[x]      //&#x628A;x&#x7684;&#x7238;&#x7238;&#x8BBE;&#x5B9A;&#x4E3A;y&#x7684;&#x7238;&#x7238;</span><br><span class="line">if p[x]=nil[T]    //&#x5982;&#x679C;x&#x7684;&#x7238;&#x7238;&#x672C;&#x6765;&#x5C31;&#x662F;&#x7A7A;&#x7684;</span><br><span class="line">  then root[T]&lt;-y  //&#x90A3;&#x4E48;y&#x5C31;&#x53D8;&#x6210;&#x4E86;&#x6839;&#x8282;&#x70B9;</span><br><span class="line">  else if x=left[p[x]]   //&#x5426;&#x5219;&#xFF0C;&#x5982;&#x679C;&#x539F;&#x6765;x&#x662F;&#x5B83;&#x7238;&#x7238;&#x7684;&#x5DE6;&#x513F;&#x5B50;</span><br><span class="line">    then left[p[x]]&lt;-y   //&#x5C31;&#x628A;y&#x8BBE;&#x4E3A;&#x539F;&#x6765;x&#x7238;&#x7238;&#x7684;&#x5DE6;&#x513F;&#x5B50;</span><br><span class="line">    else right[p[x]]&lt;-y   //&#x4E0D;&#x7136;&#x5C31;&#x628A;y&#x8BBE;&#x4E3A;&#x539F;&#x6765;x&#x7238;&#x7238;&#x7684;&#x53F3;&#x513F;&#x5B50;</span><br><span class="line">left[y]&lt;-x     //x&#x8FD9;&#x65F6;&#x5019;&#x8F6C;&#x4E0B;&#x6765;&#x6210;&#x4E3A;y&#x7684;&#x5DE6;&#x513F;&#x5B50;</span><br><span class="line">p[x]&lt;-y    //y &#x4E5F;&#x5C31;&#x6210;&#x4E86;x&#x7684;&#x7238;&#x7238;&#x4E86;</span><br></pre></td></tr></table></figure>

<p>&#x5728;&#x5B9E;&#x9645;&#x7684;&#x6811;&#x4E2D;&#xFF0C;&#x65CB;&#x8F6C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<p> <img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/8e7c3f580379a77117ee26b4310f2962ad80988f5b768a29e78f546dba4ae762" alt="&#x65CB;&#x8F6C;&#x524D;"><br> <em>&#x65CB;&#x8F6C;&#x524D;</em>   </p>
<p>&#x65CB;&#x8F6C;&#x540E;&#xFF0C;18&#x4EE3;&#x66FF;&#x4E86;11&#x6210;&#x4E3A;&#x4E86;7&#x7684;&#x53F3;&#x513F;&#x5B50;&#xFF0C;11&#xFF0C;&#x6210;&#x4E86;18&#x7684;&#x5DE6;&#x513F;&#x5B50;&#xFF0C;18&#x539F;&#x5148;&#x7684;&#x513F;&#x5B50;&#xFF0C;&#x5373;&#x4EE5;14&#x4E3A;&#x6839;&#x8282;&#x70B9;&#x7684;&#x5DE6;&#x5B50;&#x6811;&#x6210;&#x4E86;11&#x7684;&#x53F3;&#x513F;&#x5B50;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<p> <img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/b18041c636720b8cd1ca4ac360fd86db8f992ef0d6525124a0f16c66451469cd" alt="&#x65CB;&#x8F6C;&#x540E;"><br> <em>&#x65CB;&#x8F6C;&#x540E;</em><br>&#x53F3;&#x65CB;&#x64CD;&#x4F5C;&#x4E0E;&#x5DE6;&#x65CB;&#x7C7B;&#x4F3C;&#xFF0C;&#x8BFB;&#x8005;&#x4EEC;&#x53EF;&#x4EE5;&#x81EA;&#x884C;&#x8BD5;&#x7740;&#x5199;&#x51FA;&#x4F2A;&#x4EE3;&#x7801;&#x3002;</p>
<h2 id="RBTree&#x7684;&#x63D2;&#x5165;&#x64CD;&#x4F5C;"><a href="#RBTree&#x7684;&#x63D2;&#x5165;&#x64CD;&#x4F5C;" class="headerlink" title="RBTree&#x7684;&#x63D2;&#x5165;&#x64CD;&#x4F5C;"></a>RBTree&#x7684;&#x63D2;&#x5165;&#x64CD;&#x4F5C;</h2><p>&#x7EA2;&#x9ED1;&#x6811;&#x7684;&#x63D2;&#x5165;&#x4E0E;BST&#x7684;&#x63D2;&#x5165;&#x65B9;&#x5F0F;&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x4E5F;&#x662F;&#x901A;&#x8FC7;&#x4E0D;&#x65AD;&#x6BD4;&#x8F83;&#x5927;&#x5C0F;&#xFF0C;&#x63D2;&#x5165;&#x5230;&#x5408;&#x9002;&#x4F4D;&#x7F6E;&#xFF0C;&#x53EA;&#x4E0D;&#x8FC7;&#x63D2;&#x5165;&#x540E;&#x9700;&#x8981;&#x505A;&#x8C03;&#x6574;&#xFF0C;&#x4EE5;&#x6EE1;&#x8DB3;&#x7EA2;&#x9ED1;&#x6811;&#x7684;5&#x6761;&#x7279;&#x6027;&#x3002;</p>
<p>&#x5148;&#x770B;&#x4E00;&#x4E0B;BST&#x7684;&#x63D2;&#x5165;&#x4EE3;&#x7801;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">pgsql&#x590D;&#x5236;&#x4EE3;&#x7801; public BinaryNode&lt;T&gt; insert(T t,BinaryNode&lt;T&gt; node)</span><br><span class="line">   {</span><br><span class="line">       if(node==null)</span><br><span class="line">       {</span><br><span class="line">           return new BinaryNode&lt;T&gt;(t, null, null);</span><br><span class="line">       }</span><br><span class="line">       int result = t.compareTo(node.data);</span><br><span class="line">       if(result&lt;0)</span><br><span class="line">          node.left= insert(t,node.left);</span><br><span class="line">       else if(result&gt;0)</span><br><span class="line">          node.right= insert(t,node.right);</span><br><span class="line">       else</span><br><span class="line">           ;//doNothing</span><br><span class="line">       return node;</span><br><span class="line">   }</span><br></pre></td></tr></table></figure>

<p>&#x65B0;&#x63D2;&#x5165;&#x7684;&#x8282;&#x70B9;&#x603B;&#x662F;&#x8BBE;&#x4E3A;&#x7EA2;&#x8272;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x5982;&#x679C;&#x7236;&#x8282;&#x70B9;&#x4E3A;&#x9ED1;&#x8272;&#xFF0C;&#x5C31;&#x4E0D;&#x9700;&#x8981;&#x4FEE;&#x590D;&#xFF0C;&#x56E0;&#x4E3A;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x6027;&#x8D28;&#x88AB;&#x6539;&#x53D8;&#xFF0C;&#x6240;&#x4EE5;&#x53EA;&#x6709;&#x5728;&#x7236;&#x8282;&#x70B9;&#x4E3A;&#x7EA2;&#x8272;&#x8282;&#x70B9;&#x65F6;&#x9700;&#x8981;&#x505A;&#x4FEE;&#x590D;&#x64CD;&#x4F5C;&#x3002;</p>
<p>&#x4FEE;&#x590D;&#x64CD;&#x4F5C;&#x4E00;&#x5171;&#x5206;&#x4E3A;3&#x79CD;&#x60C5;&#x51B5;&#xFF1A;</p>
<h4 id="&#x60C5;&#x51B5;1-&#xFF1A;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;&#x7236;&#x8282;&#x70B9;&#x662F;&#x7EA2;&#x8272;&#xFF0C;&#x4E14;&#x7956;&#x7236;&#x8282;&#x70B9;&#x7684;&#x53E6;&#x4E00;&#x4E2A;&#x5B50;&#x8282;&#x70B9;&#xFF08;&#x53D4;&#x53D4;&#x8282;&#x70B9;&#xFF09;&#x4E5F;&#x662F;&#x7EA2;&#x8272;"><a href="#&#x60C5;&#x51B5;1-&#xFF1A;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;&#x7236;&#x8282;&#x70B9;&#x662F;&#x7EA2;&#x8272;&#xFF0C;&#x4E14;&#x7956;&#x7236;&#x8282;&#x70B9;&#x7684;&#x53E6;&#x4E00;&#x4E2A;&#x5B50;&#x8282;&#x70B9;&#xFF08;&#x53D4;&#x53D4;&#x8282;&#x70B9;&#xFF09;&#x4E5F;&#x662F;&#x7EA2;&#x8272;" class="headerlink" title="&#x60C5;&#x51B5;1 &#xFF1A;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;&#x7236;&#x8282;&#x70B9;&#x662F;&#x7EA2;&#x8272;&#xFF0C;&#x4E14;&#x7956;&#x7236;&#x8282;&#x70B9;&#x7684;&#x53E6;&#x4E00;&#x4E2A;&#x5B50;&#x8282;&#x70B9;&#xFF08;&#x53D4;&#x53D4;&#x8282;&#x70B9;&#xFF09;&#x4E5F;&#x662F;&#x7EA2;&#x8272;"></a>&#x60C5;&#x51B5;1 &#xFF1A;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;&#x7236;&#x8282;&#x70B9;&#x662F;&#x7EA2;&#x8272;&#xFF0C;&#x4E14;&#x7956;&#x7236;&#x8282;&#x70B9;&#x7684;&#x53E6;&#x4E00;&#x4E2A;&#x5B50;&#x8282;&#x70B9;&#xFF08;&#x53D4;&#x53D4;&#x8282;&#x70B9;&#xFF09;&#x4E5F;&#x662F;&#x7EA2;&#x8272;</h4><p>&#x6B64;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x8003;&#x8651;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x662F;&#x7236;&#x8282;&#x70B9;&#x7684;&#x5DE6;&#x513F;&#x5B50;&#xFF0C;&#x56E0;&#x4E3A;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x548C;&#x7236;&#x8282;&#x70B9;&#x90FD;&#x662F;&#x7EA2;&#x8272;&#xFF0C;&#x4E0D;&#x6EE1;&#x8DB3;&#x7EA2;&#x9ED1;&#x6811;&#x7684;&#x7279;&#x6027;4 &#xFF08;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x662F;&#x7EA2;&#x7684;&#xFF0C;&#x4ED6;&#x7684;&#x4E24;&#x4E2A;&#x513F;&#x5B50;&#x8282;&#x70B9;&#x90FD;&#x662F;&#x9ED1;&#x7684;&#xFF09;&#x3002;</p>
<blockquote>
<p>&#x5BF9;&#x7B56; :&#x628A;&#x7236;&#x8282;&#x70B9;&#x548C;&#x53D4;&#x53D4;&#x8282;&#x70B9;&#x53D8;&#x9ED1;&#xFF0C;&#x7237;&#x7237;&#x8282;&#x70B9;&#x6D82;&#x7EA2;&#xFF0C;&#x7136;&#x540E;&#x628A;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x6307;&#x9488;&#x7ED9;&#x5230;&#x7237;&#x7237;&#xFF0C;&#x8BA9;&#x7237;&#x7237;&#x8282;&#x70B9;&#x90A3;&#x5C42;&#x7EE7;&#x7EED;&#x5FAA;&#x73AF;&#xFF0C;&#x63A5;&#x53D7;&#x7EA2;&#x9ED1;&#x6811;&#x7279;&#x6027;&#x68C0;&#x6D4B;&#x3002;</p>
</blockquote>
<p> <img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/26812b047d001a6c3e4f4fd8b27aa013cf770497f98359718270c400140c08cd" alt="1.PNG"><br> <em>1.PNG</em><br>&#x65B0;&#x63D2;&#x5165;&#x8282;&#x70B9;1&#xFF0C;&#x7236;&#x4EB2;2&#x548C;&#x53D4;&#x53D4;6&#x90FD;&#x662F;&#x7EA2;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x628A;2&#x548C;6&#x90FD;&#x53D8;&#x6210;&#x9ED1;&#x7684;&#xFF0C; &#x7237;&#x7237;&#x53D8;&#x6210;&#x7EA2;&#x7684;&#x3002;</p>
<h4 id="&#x60C5;&#x51B5;2&#xFF1A;-&#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;&#x7236;&#x8282;&#x70B9;&#x662F;&#x7EA2;&#x7684;&#xFF0C;&#x53D4;&#x53D4;&#x8282;&#x70B9;&#x662F;&#x9ED1;&#x7684;&#xFF0C;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x662F;&#x7236;&#x8282;&#x70B9;&#x7684;&#x53F3;&#x5B50;&#x6811;&#x3002;"><a href="#&#x60C5;&#x51B5;2&#xFF1A;-&#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;&#x7236;&#x8282;&#x70B9;&#x662F;&#x7EA2;&#x7684;&#xFF0C;&#x53D4;&#x53D4;&#x8282;&#x70B9;&#x662F;&#x9ED1;&#x7684;&#xFF0C;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x662F;&#x7236;&#x8282;&#x70B9;&#x7684;&#x53F3;&#x5B50;&#x6811;&#x3002;" class="headerlink" title="&#x60C5;&#x51B5;2&#xFF1A; &#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;&#x7236;&#x8282;&#x70B9;&#x662F;&#x7EA2;&#x7684;&#xFF0C;&#x53D4;&#x53D4;&#x8282;&#x70B9;&#x662F;&#x9ED1;&#x7684;&#xFF0C;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x662F;&#x7236;&#x8282;&#x70B9;&#x7684;&#x53F3;&#x5B50;&#x6811;&#x3002;"></a>&#x60C5;&#x51B5;2&#xFF1A; &#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;&#x7236;&#x8282;&#x70B9;&#x662F;&#x7EA2;&#x7684;&#xFF0C;&#x53D4;&#x53D4;&#x8282;&#x70B9;&#x662F;&#x9ED1;&#x7684;&#xFF0C;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x662F;&#x7236;&#x8282;&#x70B9;&#x7684;&#x53F3;&#x5B50;&#x6811;&#x3002;</h4><blockquote>
<p>&#x5BF9;&#x7B56;&#xFF1A;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;&#x7236;&#x8282;&#x70B9;&#x4F5C;&#x4E3A;&#x65B0;&#x7684;&#x5F53;&#x524D;&#x8282;&#x70B9;&#xFF0C;&#x4EE5;&#x65B0;&#x5F53;&#x524D;&#x6307;&#x70B9;&#x4E3A;&#x652F;&#x70B9;&#x5DE6;&#x65CB;</p>
</blockquote>
<p>&#x63A5;&#x7740;&#x4E0A;&#x9762;&#x7684;&#x60C5;&#x51B5;1&#xFF0C; &#x5728;&#x60C5;&#x51B5;1&#x7684;&#x64CD;&#x4F5C;&#x4E4B;&#x540E;&#xFF0C;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x4E3A;4&#xFF0C; &#x4F46;&#x662F;4&#x7684;&#x7236;&#x8282;&#x70B9;3&#x8FD8;&#x662F;&#x7EA2;&#x7684;&#xFF0C;&#x4ECD;&#x7136;&#x4E0D;&#x6EE1;&#x8DB3;&#x7EA2;&#x9ED1;&#x6811;&#x7684;&#x7279;&#x6027;4&#xFF0C; &#x7531;&#x4E8E;&#x53D4;&#x53D4;&#x8282;&#x70B9;7&#x662F;&#x9ED1;&#x7684;&#xFF0C;&#x4E14;4&#x4E3A;3&#x7684;&#x53F3;&#x513F;&#x5B50;&#xFF0C;&#x6240;&#x4EE5;&#x6EE1;&#x8DB3;&#x60C5;&#x51B5;2&#xFF0C;&#x8FD9;&#x65F6;&#x5019;&#x628A;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x8F6C;&#x79FB;&#x5230;3&#xFF0C;&#x4EE5;3&#x4E3A;&#x652F;&#x70B9;&#x5DE6;&#x65CB;&#x3002;4&#x53D8;&#x4E3A;&#x7237;&#x7237;5&#x7684;&#x65B0;&#x5DE6;&#x513F;&#x5B50;&#xFF0C;&#x800C;&#x539F;&#x6765;&#x7684;3&#x4E0B;&#x53BB;&#x4E86;&#xFF0C;&#x6210;&#x4E3A;4&#x7684;&#x5DE6;&#x513F;&#x5B50;&#x3002;4&#x539F;&#x6709;&#x7684;&#x5DE6;&#x513F;&#x5B50;&#xFF08;2-1&#x5206;&#x652F;&#xFF09;&#x7ED9;3&#x505A;&#x4E86;&#x53F3;&#x513F;&#x5B50;&#x3002;</p>
<p> <img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/07d092fe5f985b69b87e2b81b366dfd80680d8255c96905efdb3442e4d7ed165" alt="2.PNG"><br> <em>2.PNG</em></p>
<h4 id="&#x60C5;&#x51B5;3&#xFF1A;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;&#x7236;&#x8282;&#x70B9;&#x662F;&#x7EA2;&#x8272;&#xFF0C;&#x53D4;&#x53D4;&#x8282;&#x70B9;&#x662F;&#x9ED1;&#x8272;&#xFF0C;&#x4E14;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x662F;&#x5176;&#x7236;&#x8282;&#x70B9;&#x7684;&#x5DE6;&#x513F;&#x5B50;"><a href="#&#x60C5;&#x51B5;3&#xFF1A;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;&#x7236;&#x8282;&#x70B9;&#x662F;&#x7EA2;&#x8272;&#xFF0C;&#x53D4;&#x53D4;&#x8282;&#x70B9;&#x662F;&#x9ED1;&#x8272;&#xFF0C;&#x4E14;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x662F;&#x5176;&#x7236;&#x8282;&#x70B9;&#x7684;&#x5DE6;&#x513F;&#x5B50;" class="headerlink" title="&#x60C5;&#x51B5;3&#xFF1A;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;&#x7236;&#x8282;&#x70B9;&#x662F;&#x7EA2;&#x8272;&#xFF0C;&#x53D4;&#x53D4;&#x8282;&#x70B9;&#x662F;&#x9ED1;&#x8272;&#xFF0C;&#x4E14;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x662F;&#x5176;&#x7236;&#x8282;&#x70B9;&#x7684;&#x5DE6;&#x513F;&#x5B50;"></a>&#x60C5;&#x51B5;3&#xFF1A;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;&#x7236;&#x8282;&#x70B9;&#x662F;&#x7EA2;&#x8272;&#xFF0C;&#x53D4;&#x53D4;&#x8282;&#x70B9;&#x662F;&#x9ED1;&#x8272;&#xFF0C;&#x4E14;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x662F;&#x5176;&#x7236;&#x8282;&#x70B9;&#x7684;&#x5DE6;&#x513F;&#x5B50;</h4><blockquote>
<p>&#x5BF9;&#x7B56;&#xFF1A; &#x7236;&#x8282;&#x70B9;&#x53D8;&#x9ED1;&#xFF0C;&#x7956;&#x7236;&#x53D8;&#x7EA2;&#xFF0C;&#x4EE5;&#x7956;&#x7236;&#x8282;&#x70B9;&#x4E3A;&#x652F;&#x70B9;&#x53F3;&#x65CB;</p>
</blockquote>
<p>&#x63A5;&#x7740;&#x4E0A;&#x9762;&#x7684;&#x60C5;&#x51B5;2&#xFF0C; &#x5F53;&#x524D;&#x8282;&#x70B9;&#x53D8;&#x6210;&#x4E86;3&#xFF0C;&#x7531;&#x4E8E;&#x7236;&#x8282;&#x70B9;4&#x4E3A;&#x7EA2;&#xFF0C;&#x53D4;&#x53D4;&#x8282;&#x70B9;7 &#x4E3A;&#x9ED1;&#xFF0C;&#x4E14;4&#x4E3A;5&#x7684;&#x5DE6;&#x513F;&#x5B50;&#xFF0C;&#x6240;&#x4EE5;&#x6EE1;&#x8DB3;&#x60C5;&#x51B5;3&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x5C06;&#x7236;&#x8282;&#x70B9;4&#x53D8;&#x9ED1;&#xFF0C;&#x7956;&#x7236;5&#x53D8;&#x7EA2;&#xFF0C;&#x5E76;&#x4E14;&#x53F3;&#x65CB;&#xFF0C;&#x53F3;&#x65CB;&#x540E;&#xFF0C;4 &#x7684;&#x53F3;&#x513F;&#x5B50;6&#x8DDF;&#x4E86;5&#x505A;&#x4E86;&#x5DE6;&#x513F;&#x5B50;&#xFF0C;5&#x6210;&#x4E86;4&#x7684;&#x53F3;&#x513F;&#x5B50;&#x3002;&#x5982;&#x56FE;&#x6240;&#x793A;&#xFF1A;</p>
<p> <img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/545aeff751b51e3a2d7dd526a6ca83e52344430ab47e8f019b5c2a93f43f3291" alt="3.PNG"><br> <em>3.PNG</em><br>&#x8FD9;&#x6837;&#x7EA2;&#x9ED1;&#x6811;&#x91CD;&#x65B0;&#x6062;&#x590D;&#x4E86;&#x5E73;&#x8861;&#x3002;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x91CC;&#x6B63;&#x597D;&#x9047;&#x5230;&#x4E86;&#x4E09;&#x79CD;&#x57FA;&#x672C;&#x60C5;&#x51B5;&#xFF0C;&#x5B9E;&#x9645;&#x64CD;&#x4F5C;&#x4E2D;&#x4E5F;&#x8BB8;&#x4E00;&#x6B65;&#x5C31;&#x6210;&#x529F;&#x4E86;&#xFF0C;&#x7B80;&#x5316;&#x7684;&#x6765;&#x770B;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x4E0B;&#x9762;&#x4E09;&#x79CD;&#x57FA;&#x672C;&#x60C5;&#x51B5;&#xFF1A;<br> <strong>case1 :</strong>  </p>
<p> <img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/bbcee27a34fb5fdb86c8311d729a02dd3ab0b0c4346a0392eb38f2104f535eb2" alt="&#x7236;&#x7EA2;&#x53D4;&#x7EA2;"><br> <em>&#x7236;&#x7EA2;&#x53D4;&#x7EA2;</em><br> <strong>case2 :</strong><br> <img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/d3c17a4c3d678a3a862f689afe436975e60f9f36e51388a5e685e8c99778d1f4" alt="&#x7236;&#x7EA2;&#xFF0C; &#x5DE6;&#x5B50;"><br> <em>&#x7236;&#x7EA2;&#xFF0C; &#x5DE6;&#x5B50;</em><br> <strong>case3 :</strong><br> <img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/7eedc663f54b2ae0875a8706a2efc2f0197d4d4a9f067f7dcf31a16f34644dd2" alt="&#x7236;&#x7EA2;&#xFF0C; &#x53F3;&#x5B50;"><br> <em>&#x7236;&#x7EA2;&#xFF0C; &#x53F3;&#x5B50;</em><br>&#x5F53;&#x524D;&#x8282;&#x70B9;&#x4E3A;&#x7236;&#x8282;&#x70B9;&#x7684;&#x53F3;&#x8282;&#x70B9;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5148;&#x65CB;&#x8F6C;&#x6210;&#x4E3A;&#x5DE6;&#x5B50;&#xFF0C;&#x5373;case2&#x7684;&#x6837;&#x5B50;&#xFF0C;&#x518D;&#x53F3;&#x65CB;&#x3002;</p>
<p>&#x4FEE;&#x590D;&#x64CD;&#x4F5C;&#x6574;&#x4F53;&#x6765;&#x8BF4;&#x662F;&#x4E00;&#x4E2A;&#x5411;&#x4E0A;&#x56DE;&#x6EAF;&#x7684;&#x8FC7;&#x7A0B;&#xFF0C;&#x5C31;&#x62FF;&#x6211;&#x4EEC;&#x4E3E;&#x5F97;&#x4F8B;&#x5B50;&#x6765;&#x8BF4;&#xFF0C;&#x60C5;&#x51B5;1&#x64CD;&#x4F5C;&#x540E;&#xFF0C;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x5411;&#x4E0A;&#x79FB;&#x5230;&#x4E86;4&#xFF0C; &#x6B64;&#x65F6;&#x53C8;&#x4F1A;&#x68C0;&#x6D4B;4 &#x548C;&#x5B83;&#x7684;&#x7236;&#x8282;&#x70B9;&#x4E4B;&#x95F4;&#x6027;&#x8D28;&#x662F;&#x5426;&#x7B26;&#x5408;&#x7EA2;&#x9ED1;&#x6811;&#x7684;5&#x6761;&#x7279;&#x6027;&#xFF0C;&#x4E0D;&#x5BF9;&#x7684;&#x8BDD;&#x7EE7;&#x7EED;&#x4FEE;&#x590D;&#x7EA2;&#x9ED1;&#x6811;&#xFF0C;&#x76F4;&#x5230;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x8F6C;&#x79FB;&#x5230;root&#x8282;&#x70B9;&#xFF0C;&#x4E14;root&#x8282;&#x70B9;&#x4E3A;&#x9ED1;&#x8272;&#xFF0C;&#x4FEE;&#x590D;&#x64CD;&#x4F5C;&#x7ED3;&#x675F;&#x3002;</p>
<h2 id="RBTree&#x7684;&#x5220;&#x9664;&#x64CD;&#x4F5C;"><a href="#RBTree&#x7684;&#x5220;&#x9664;&#x64CD;&#x4F5C;" class="headerlink" title="RBTree&#x7684;&#x5220;&#x9664;&#x64CD;&#x4F5C;"></a>RBTree&#x7684;&#x5220;&#x9664;&#x64CD;&#x4F5C;</h2><p>&#x5220;&#x9664;&#x64CD;&#x4F5C;&#x9996;&#x5148;&#x4E5F;&#x9700;&#x8981;&#x505A;&#x666E;&#x901A;BST&#x7684;&#x5220;&#x9664;&#x64CD;&#x4F5C;&#xFF0C;&#x5220;&#x9664;&#x64CD;&#x4F5C;&#x4F1A;&#x5220;&#x9664;&#x5BF9;&#x5E94;&#x7684;&#x8282;&#x70B9;&#xFF0C;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x5C31;&#x4F1A;&#x76F4;&#x63A5;&#x5220;&#x9664;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x975E;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#xFF0C;&#x5C31;&#x4F1A;&#x7528;&#x4E2D;&#x5E8F;&#x904D;&#x5386;&#x7684;&#x540E;&#x7EE7;&#x8282;&#x70B9;&#x6765;&#x9876;&#x66FF;&#x8981;&#x5220;&#x9664;&#x7684;&#x8282;&#x70B9;&#xFF0C;&#x6709;&#x7684;&#x4E66;&#x4E0A;&#x4E5F;&#x4F1A;&#x7528;&#x524D;&#x9A71;&#x8282;&#x70B9;&#x6765;&#x9876;&#x66FF;&#x3002;&#x5220;&#x9664;&#x540E;&#x4E5F;&#x9700;&#x8981;&#x505A;&#x4FEE;&#x590D;&#x64CD;&#x4F5C;&#xFF0C;&#x6765;&#x6EE1;&#x8DB3;&#x7EA2;&#x9ED1;&#x6811;&#x7684;&#x7279;&#x6027;&#x3002;</p>
<p>&#x9996;&#x5148;&#x4E5F;&#x662F;&#x770B;&#x4E00;&#x4E0B;BST&#x5220;&#x9664;&#x8282;&#x70B9;&#x7684;&#x4EE3;&#x7801;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;public BinaryNode&lt;T&gt; remove(T t,BinaryNode&lt;T&gt; node)</span><br><span class="line">{</span><br><span class="line">       if(node == null)</span><br><span class="line">           return node;//&#x6CA1;&#x6709;&#x627E;&#x5230;,doNothing</span><br><span class="line">       int result = t.compareTo(node.data);</span><br><span class="line">       if(result&gt;0)</span><br><span class="line">           node.right = remove(t,node.right);</span><br><span class="line">       else if(result&lt;0)</span><br><span class="line">           node.left = remove(t,node.left);</span><br><span class="line">       else if(node.left!=null&amp;&amp;node.right!=null) </span><br><span class="line">       {   //&#x5F85;&#x5220;&#x9664;&#x8282;&#x70B9;&#x6709;&#x4E24;&#x4E2A;&#x513F;&#x5B50;&#x8282;&#x70B9;&#x65F6;&#xFF0C;&#x7528;&#x53F3;&#x513F;&#x5B50;&#x4E2D;&#x7684;&#x6700;&#x5C0F;&#x5143;&#x7D20;&#x586B;&#x5145;&#x5F85;&#x5220;&#x9664;&#x8282;&#x70B9;</span><br><span class="line">           node.data = findMin(node.right).data;</span><br><span class="line">           node.right = remove(node.data,node.right);</span><br><span class="line">       }</span><br><span class="line">       else //&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x513F;&#x5B50;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x628A;&#x7236;&#x8282;&#x70B9;&#x7684;&#x513F;&#x5B50;&#x6307;&#x9488;&#x6307;&#x5411;&#x513F;&#x5B50;&#x7684;&#x8BE5;&#x72EC;&#x751F;&#x5B50;</span><br><span class="line">           node = (node.left!=null)?node.left:node.right;</span><br><span class="line">       return node;        </span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5220;&#x9664;&#x4FEE;&#x590D;&#x64CD;&#x4F5C;&#x5728;&#x9047;&#x5230;&#x88AB;&#x5220;&#x9664;&#x7684;&#x8282;&#x70B9;&#x662F;&#x7EA2;&#x8272;&#x8282;&#x70B9;&#x6216;&#x8005;&#x5230;&#x8FBE;root&#x8282;&#x70B9;&#x65F6;&#xFF0C;&#x4FEE;&#x590D;&#x64CD;&#x4F5C;&#x5B8C;&#x6BD5;&#x3002;</p>
<p>&#x5728;&#x5220;&#x9664;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x540E;&#xFF0C;&#x5982;&#x679C;&#x5220;&#x9664;&#x7684;&#x8282;&#x70B9;&#x65F6;&#x7EA2;&#x8272;&#x8282;&#x70B9;&#xFF0C;&#x90A3;&#x4E48;&#x7EA2;&#x9ED1;&#x6811;&#x7684;&#x6027;&#x8D28;&#x5E76;&#x4E0D;&#x4F1A;&#x88AB;&#x5F71;&#x54CD;&#xFF0C;&#x6B64;&#x65F6;&#x4E0D;&#x9700;&#x8981;&#x4FEE;&#x6B63;&#xFF0C;&#x5982;&#x679C;&#x5220;&#x9664;&#x7684;&#x662F;&#x9ED1;&#x8272;&#x8282;&#x70B9;&#xFF0C;&#x539F;&#x7EA2;&#x9ED1;&#x6811;&#x7684;&#x6027;&#x8D28;&#x5C31;&#x4F1A;&#x88AB;&#x6539;&#x53D8;&#xFF0C;&#x6B64;&#x65F6;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x505A;&#x4FEE;&#x6B63;&#x3002;</p>
<p>&#x5F53;&#x9ED1;&#x8272;&#x8282;&#x70B9;&#x88AB;&#x5220;&#x9664;&#x540E;&#xFF0C;&#x5047;&#x8BBE;&#x8BE5;&#x8282;&#x70B9;&#x4E3A;y&#xFF0C;&#x4F1A;&#x4EA7;&#x751F;3&#x4E2A;&#x95EE;&#x9898;&#xFF1A;</p>
<ol>
<li>&#x5982;&#x679C;y&#x539F;&#x6765;&#x662F;&#x6839;&#x8282;&#x70B9;&#xFF0C;&#x800C;y&#x7684;&#x4E00;&#x4E2A;&#x7EA2;&#x8272;&#x5B69;&#x5B50;&#x6210;&#x4E3A;&#x65B0;&#x7684;&#x6839;&#xFF0C;&#x5219;&#x8FDD;&#x53CD;&#x4E86;&#x6027;&#x8D28;2</li>
<li>&#x5982;&#x679C;y&#x7684;&#x5B50;&#x8282;&#x70B9;&#x548C;y&#x7684;&#x7236;&#x8282;&#x70B9;&#x90FD;&#x662F;&#x7EA2;&#x8272;&#xFF0C;&#x90A3;&#x4E48;y&#x88AB;&#x5220;&#x9664;&#x540E;&#xFF0C;&#x4E24;&#x4E2A;&#x8FDE;&#x7EED;&#x7684;&#x7EA2;&#x8272;&#x8282;&#x70B9;&#x8FDE;&#x63A5;&#x8D77;&#x6765;&#xFF0C;&#x8FDD;&#x53CD;&#x4E86;&#x6027;&#x8D28;4</li>
<li>&#x5220;&#x9664;y&#x5C06;&#x5BFC;&#x81F4;&#x5148;&#x524D;&#x5305;&#x542B;y&#x7684;&#x4EFB;&#x4F55;&#x8DEF;&#x5F84;&#x4E0A;&#x7684;&#x9ED1;&#x8282;&#x70B9;&#x4E2A;&#x6570;&#x5C11;1&#xFF0C;&#x6027;&#x8D28;5&#x88AB;&#x7834;&#x574F;</li>
</ol>
<p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5047;&#x8BBE;&#xFF0C;&#x9876;&#x66FF;&#x5220;&#x9664;&#x8282;&#x70B9;&#x7684;&#x90A3;&#x4E2A;&#x540E;&#x6765;&#x8282;&#x70B9;&#xFF0C;&#x7EE7;&#x627F;&#x4E86;&#x88AB;&#x5220;&#x9664;&#x7684;&#x9ED1;&#x8272;&#x8282;&#x70B9;&#x7684;&#x90A3;&#x5C42;&#x9ED1;&#x8272;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x9876;&#x66FF;&#x7684;&#x8282;&#x70B9;&#x5177;&#x6709;&#x53CC;&#x91CD;&#x989C;&#x8272;&#xFF0C;&#x5982;&#x679C;&#x539F;&#x6765;&#x662F;&#x9ED1;&#x8272;&#xFF0C;&#x90A3;&#x4E48;&#x73B0;&#x5728;&#x5C31;&#x662F;&#x9ED1;+&#x9ED1;&#xFF0C;&#x5982;&#x679C;&#x539F;&#x6765;&#x662F;&#x7EA2;&#x8272;&#xFF0C;&#x73B0;&#x5728;&#x5C31;&#x662F;&#x7EA2;+&#x9ED1;&#x3002;&#x56E0;&#x4E3A;&#x6709;&#x4E86;&#x8FD9;&#x5C42;&#x989D;&#x5916;&#x7684;&#x9ED1;&#x8272;&#xFF0C;&#x6240;&#x4EE5;&#x6027;&#x8D28;5&#x8FD8;&#x662F;&#x80FD;&#x4FDD;&#x6301;&#x7684;&#xFF0C;&#x73B0;&#x5728;&#x53EA;&#x9700;&#x8981;&#x6062;&#x590D;&#x5B83;&#x7684;&#x6027;&#x8D28;&#x5373;&#x53EF;&#x3002;</p>
<ul>
<li>&#x5982;&#x679C;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x65F6;&#x7EA2;+&#x9ED1;&#x8272;<br>&#x76F4;&#x63A5;&#x628A;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x67D3;&#x6210;&#x9ED1;&#x8272;&#xFF0C;&#x6B64;&#x65F6;&#x7EA2;&#x9ED1;&#x6811;&#x6027;&#x8D28;&#x5168;&#x90E8;&#x6062;&#x590D;</li>
<li>&#x5982;&#x679C;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x65F6;&#x9ED1;+&#x9ED1;&#x4E14;&#x662F;&#x6839;&#x8282;&#x70B9;&#xFF0C;&#x6B64;&#x65F6;&#x4EC0;&#x4E48;&#x90FD;&#x4E0D;&#x7528;&#x505A;&#xFF0C;&#x76F4;&#x63A5;&#x7ED3;&#x675F;</li>
<li>&#x5982;&#x679C;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x65F6;&#x9ED1;+&#x9ED1;&#xFF0C;&#x4F46;&#x662F;&#x4E0D;&#x662F;&#x6839;&#x8282;&#x70B9;&#xFF0C;&#x90A3;&#x4E48;&#x53C8;&#x53EF;&#x4EE5;&#x5206;&#x4E3A;&#x4EE5;&#x4E0B;4&#x79CD;&#x60C5;&#x51B5;</li>
</ul>
<p><strong>&#x8BBE;&#x5220;&#x9664;&#x8282;&#x70B9;&#x4E3A;x&#x8282;&#x70B9;</strong></p>
<h4 id="&#x60C5;&#x51B5;1&#xFF1A;x&#x8282;&#x70B9;&#x65F6;&#x9ED1;-&#x9ED1;&#xFF0C;&#x4E14;x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x662F;&#x7EA2;&#x8272;&#xFF08;x&#x7684;&#x7236;&#x8282;&#x70B9;&#x548C;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x7684;&#x5B50;&#x8282;&#x70B9;&#x90FD;&#x662F;&#x9ED1;&#x8272;&#xFF09;"><a href="#&#x60C5;&#x51B5;1&#xFF1A;x&#x8282;&#x70B9;&#x65F6;&#x9ED1;-&#x9ED1;&#xFF0C;&#x4E14;x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x662F;&#x7EA2;&#x8272;&#xFF08;x&#x7684;&#x7236;&#x8282;&#x70B9;&#x548C;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x7684;&#x5B50;&#x8282;&#x70B9;&#x90FD;&#x662F;&#x9ED1;&#x8272;&#xFF09;" class="headerlink" title="&#x60C5;&#x51B5;1&#xFF1A;x&#x8282;&#x70B9;&#x65F6;&#x9ED1;+&#x9ED1;&#xFF0C;&#x4E14;x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x662F;&#x7EA2;&#x8272;&#xFF08;x&#x7684;&#x7236;&#x8282;&#x70B9;&#x548C;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x7684;&#x5B50;&#x8282;&#x70B9;&#x90FD;&#x662F;&#x9ED1;&#x8272;&#xFF09;"></a>&#x60C5;&#x51B5;1&#xFF1A;x&#x8282;&#x70B9;&#x65F6;&#x9ED1;+&#x9ED1;&#xFF0C;&#x4E14;x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x662F;&#x7EA2;&#x8272;&#xFF08;x&#x7684;&#x7236;&#x8282;&#x70B9;&#x548C;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x7684;&#x5B50;&#x8282;&#x70B9;&#x90FD;&#x662F;&#x9ED1;&#x8272;&#xFF09;</h4><p> <img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/573d9c50aab177d97d81341460acdf6bc17747f3fe5572f06f35a4e83d52e7db" alt="x&#x8282;&#x70B9;&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x4E3A;&#x7EA2;&#x8272;&#xFF08;x&#x8282;&#x70B9;&#x7684;&#x7236;&#x8282;&#x70B9;&#x548C;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x7684;&#x5B50;&#x8282;&#x70B9;&#x90FD;&#x662F;&#x9ED1;&#x8272;&#xFF09;"><br> <em>x&#x8282;&#x70B9;&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x4E3A;&#x7EA2;&#x8272;&#xFF08;x&#x8282;&#x70B9;&#x7684;&#x7236;&#x8282;&#x70B9;&#x548C;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x7684;&#x5B50;&#x8282;&#x70B9;&#x90FD;&#x662F;&#x9ED1;&#x8272;&#xFF09;</em>   </p>
<p>&#x56E0;&#x4E3A;&#x5144;&#x5F1F;&#x8282;&#x70B9;7&#x5FC5;&#x987B;&#x6709;&#x9ED1;&#x8272;&#x5B69;&#x5B50;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6539;&#x53D8;4&#x548C;7&#x7684;&#x989C;&#x8272;&#xFF0C;&#x518D;&#x5BF9;4&#x505A;&#x4E00;&#x6B21;&#x5DE6;&#x65CB;&#xFF0C;&#x800C;&#x4E14;&#x7EA2;&#x9ED1;&#x6027;&#x8D28;&#x7EE7;&#x7EED;&#x4FDD;&#x5B58;&#x3002;&#x5B8C;&#x6210;&#x8FD9;&#x4E24;&#x4E2A;&#x64CD;&#x4F5C;&#x540E;&#xFF0C;&#x5C3D;&#x7BA1;&#x6240;&#x6709;&#x8DEF;&#x5F84;&#x4E0A;&#x9ED1;&#x8272;&#x8282;&#x70B9;&#x7684;&#x6570;&#x76EE;&#x6CA1;&#x6709;&#x6539;&#x53D8;&#xFF0C;&#x4F46;&#x73B0;&#x5728;&#x5220;&#x9664;&#x8282;&#x70B9;&#x6709;&#x4E86;&#x4E00;&#x4E2A;&#x9ED1;&#x8272;&#x7684;&#x5144;&#x5F1F;&#x548C;&#x4E00;&#x4E2A;&#x7EA2;&#x8272;&#x7684;&#x7236;&#x4EB2;&#xFF08;&#x5B83;&#x7684;&#x65B0;&#x5144;&#x5F1F;&#x662F;&#x9ED1;&#x8272;&#x56E0;&#x4E3A;&#x5B83;&#x662F;&#x539F;&#x5148;&#x7EA2;7&#x7684;&#x4E00;&#x4E2A;&#x513F;&#x5B50;&#xFF09;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x63A5;&#x4E0B;&#x53BB;&#x6309;&#x60C5;&#x5F62;2&#x3001;&#x60C5;&#x5F62;3&#x6216;&#x60C5;&#x5F62;4&#x6765;&#x5904;&#x7406;&#x3002;</p>
<h4 id="&#x60C5;&#x51B5;2&#xFF1A;x&#x8282;&#x70B9;&#x65F6;&#x9ED1;-&#x9ED1;&#xFF0C;x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x65F6;&#x9ED1;&#x8272;&#xFF08;x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x7684;&#x4E24;&#x4E2A;&#x5B69;&#x5B50;&#x90FD;&#x662F;&#x9ED1;&#x8272;&#xFF09;"><a href="#&#x60C5;&#x51B5;2&#xFF1A;x&#x8282;&#x70B9;&#x65F6;&#x9ED1;-&#x9ED1;&#xFF0C;x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x65F6;&#x9ED1;&#x8272;&#xFF08;x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x7684;&#x4E24;&#x4E2A;&#x5B69;&#x5B50;&#x90FD;&#x662F;&#x9ED1;&#x8272;&#xFF09;" class="headerlink" title="&#x60C5;&#x51B5;2&#xFF1A;x&#x8282;&#x70B9;&#x65F6;&#x9ED1;+&#x9ED1;&#xFF0C;x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x65F6;&#x9ED1;&#x8272;&#xFF08;x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x7684;&#x4E24;&#x4E2A;&#x5B69;&#x5B50;&#x90FD;&#x662F;&#x9ED1;&#x8272;&#xFF09;"></a>&#x60C5;&#x51B5;2&#xFF1A;x&#x8282;&#x70B9;&#x65F6;&#x9ED1;+&#x9ED1;&#xFF0C;x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x65F6;&#x9ED1;&#x8272;&#xFF08;x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x7684;&#x4E24;&#x4E2A;&#x5B69;&#x5B50;&#x90FD;&#x662F;&#x9ED1;&#x8272;&#xFF09;</h4><p> <img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/1227c6e53a6961ea4d50b32cf9cff02cbafc712a540ab88f73a34e8b10a3b4a1" alt="x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x65F6;&#x9ED1;&#x8272;&#xFF08;x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x7684;&#x4E24;&#x4E2A;&#x5B69;&#x5B50;&#x90FD;&#x662F;&#x9ED1;&#x8272;&#xFF09;"><br> <em>x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x65F6;&#x9ED1;&#x8272;&#xFF08;x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x7684;&#x4E24;&#x4E2A;&#x5B69;&#x5B50;&#x90FD;&#x662F;&#x9ED1;&#x8272;&#xFF09;</em><br>&#x6B64;&#x65F6;&#x6211;&#x4EEC;&#x628A;x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x8F6C;&#x53D8;&#x4E3A;&#x7EA2;&#x8272;&#xFF0C;&#x8BBE;&#x7F6E;x&#x7684;&#x7236;&#x8282;&#x70B9;&#x4E3A;&#x65B0;&#x7684;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x3002;<br> &#x5176;&#x5B9E;&#x8FD9;&#x6837;&#x505A;&#x7684;&#x601D;&#x60F3;&#x662F;&#x628A;&#x539F;&#x5148;x&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x9ED1;&#x8272;&#x5C5E;&#x6027;&#x4E0A;&#x79FB;&#x3002;&#x539F;&#x5148;&#x7684;x&#x53D8;&#x6210;&#x5355;&#x7EAF;&#x7684;&#x9ED1;&#x8282;&#x70B9;&#xFF0C;&#x800C;&#x5B83;&#x7684;&#x7236;&#x8282;&#x70B9;4&#x6B64;&#x65F6;&#x53D8;&#x6210;&#x4E86;&#x7EA2;+&#x9ED1;&#xFF0C;&#x5982;&#x679C;4&#x539F;&#x6765;&#x5C31;&#x662F;&#x9ED1;&#xFF0C;&#x90A3;&#x4E48;&#x6B64;&#x65F6;&#x53D8;&#x6210;&#x9ED1;+&#x9ED1;&#x3002;&#x6B64;&#x65F6;&#x5DE6;&#x8FB9;&#x5206;&#x652F;&#x7684;&#x9ED1;&#x8282;&#x70B9;&#x6570;&#x6CA1;&#x6709;&#x53D8;&#x5316;&#xFF0C;&#x4F46;&#x662F;&#x53F3;&#x8FB9;4,7&#x90A3;&#x4E00;&#x6761;&#x5206;&#x652F;&#xFF0C;&#x9ED1;&#x8282;&#x70B9;&#x6570;&#x589E;&#x52A0;&#x4E86;1&#xFF0C;&#x56E0;&#x4E3A;&#x6B64;&#x65F6;4&#x4E5F;&#x5305;&#x542B;&#x9ED1;&#x5C5E;&#x6027;&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x901A;&#x8FC7;&#x51CF;1&#x4E2A;&#x9ED1;&#x8272;&#x8282;&#x70B9;&#xFF0C;&#x56E0;&#x4E3A;&#x5144;&#x5F1F;&#x8282;&#x70B9;7&#x7684;&#x5B50;&#x8282;&#x70B9;&#x90FD;&#x662F;&#x9ED1;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x76F4;&#x63A5;&#x628A;7 &#x53D8;&#x6210;&#x7EA2;&#x7684;&#x3002;<br> &#x7ECF;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x9ED1;&#x8272;&#x5C5E;&#x6027;&#x8F6C;&#x79FB;&#x5230;4&#x4E2D;&#x53BB;&#x4E86;&#xFF0C;&#x8FD9;&#x65F6;&#x5019;&#x7EE7;&#x7EED;&#x5BF9;4&#x8FDB;&#x884C;&#x5904;&#x7406;&#x3002;</p>
<h4 id="&#x60C5;&#x51B5;3&#xFF1A;x&#x8282;&#x70B9;&#x662F;&#x9ED1;-&#x9ED1;&#x8282;&#x70B9;&#xFF0C;x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x65F6;&#x9ED1;&#x8272;&#xFF08;x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x7684;&#x5DE6;&#x513F;&#x5B50;&#x662F;&#x7EA2;&#xFF0C;&#x53F3;&#x513F;&#x5B50;&#x662F;&#x9ED1;&#xFF09;"><a href="#&#x60C5;&#x51B5;3&#xFF1A;x&#x8282;&#x70B9;&#x662F;&#x9ED1;-&#x9ED1;&#x8282;&#x70B9;&#xFF0C;x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x65F6;&#x9ED1;&#x8272;&#xFF08;x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x7684;&#x5DE6;&#x513F;&#x5B50;&#x662F;&#x7EA2;&#xFF0C;&#x53F3;&#x513F;&#x5B50;&#x662F;&#x9ED1;&#xFF09;" class="headerlink" title="&#x60C5;&#x51B5;3&#xFF1A;x&#x8282;&#x70B9;&#x662F;&#x9ED1;+&#x9ED1;&#x8282;&#x70B9;&#xFF0C;x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x65F6;&#x9ED1;&#x8272;&#xFF08;x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x7684;&#x5DE6;&#x513F;&#x5B50;&#x662F;&#x7EA2;&#xFF0C;&#x53F3;&#x513F;&#x5B50;&#x662F;&#x9ED1;&#xFF09;"></a>&#x60C5;&#x51B5;3&#xFF1A;x&#x8282;&#x70B9;&#x662F;&#x9ED1;+&#x9ED1;&#x8282;&#x70B9;&#xFF0C;x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x65F6;&#x9ED1;&#x8272;&#xFF08;x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x7684;&#x5DE6;&#x513F;&#x5B50;&#x662F;&#x7EA2;&#xFF0C;&#x53F3;&#x513F;&#x5B50;&#x662F;&#x9ED1;&#xFF09;</h4><p> <img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/a3cd06dac1ad60ad5516770a8137c93762f8c0b64f297c45a66aac462186bde1" alt="x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x65F6;&#x9ED1;&#x8272;&#xFF08;x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x7684;&#x5DE6;&#x513F;&#x5B50;&#x662F;&#x7EA2;&#xFF0C;&#x53F3;&#x513F;&#x5B50;&#x662F;&#x9ED1;&#xFF09;"><br> <em>x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x65F6;&#x9ED1;&#x8272;&#xFF08;x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x7684;&#x5DE6;&#x513F;&#x5B50;&#x662F;&#x7EA2;&#xFF0C;&#x53F3;&#x513F;&#x5B50;&#x662F;&#x9ED1;&#xFF09;</em>   </p>
<p>&#x6B64;&#x65F6;&#x6211;&#x4EEC;&#x628A;x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x7684;&#x5DE6;&#x513F;&#x5B50;&#x8BBE;&#x4E3A;&#x9ED1;&#x8272;&#xFF0C;&#x5C06;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x8BBE;&#x4E3A;&#x7EA2;&#x8272;&#xFF0C;&#x518D;&#x5BF9;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x8FDB;&#x884C;&#x53F3;&#x65CB;&#x3002;&#x5E76;&#x4E14;&#x91CD;&#x65B0;&#x8BBE;&#x7F6E;&#x65CB;&#x8F6C;&#x540E;x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#xFF0C;&#x6B64;&#x65F6;&#x662F;5. &#x5176;&#x5B9E;&#x8FD9;&#x4E00;&#x6B65;&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x4E2D;&#x95F4;&#x72B6;&#x6001;&#xFF0C;&#x5E76;&#x4E14;&#x4E0D;&#x662F;&#x5E73;&#x8861;&#x7684;&#xFF0C;&#x76EE;&#x7684;&#x662F;&#x4E3A;&#x4E86;&#x5F97;&#x5230;&#x60C5;&#x51B5;4&#x7684;&#x72B6;&#x6001;</p>
<h4 id="&#x60C5;&#x51B5;4&#xFF1A;x&#x8282;&#x70B9;&#x662F;&#x9ED1;-&#x9ED1;&#x8282;&#x70B9;&#xFF0C;x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x65F6;&#x9ED1;&#x8272;&#xFF08;x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x7684;&#x53F3;&#x513F;&#x5B50;&#x662F;&#x7EA2;&#xFF0C;&#x5DE6;&#x513F;&#x5B50;&#x968F;&#x610F;&#xFF09;"><a href="#&#x60C5;&#x51B5;4&#xFF1A;x&#x8282;&#x70B9;&#x662F;&#x9ED1;-&#x9ED1;&#x8282;&#x70B9;&#xFF0C;x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x65F6;&#x9ED1;&#x8272;&#xFF08;x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x7684;&#x53F3;&#x513F;&#x5B50;&#x662F;&#x7EA2;&#xFF0C;&#x5DE6;&#x513F;&#x5B50;&#x968F;&#x610F;&#xFF09;" class="headerlink" title="&#x60C5;&#x51B5;4&#xFF1A;x&#x8282;&#x70B9;&#x662F;&#x9ED1;+&#x9ED1;&#x8282;&#x70B9;&#xFF0C;x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x65F6;&#x9ED1;&#x8272;&#xFF08;x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x7684;&#x53F3;&#x513F;&#x5B50;&#x662F;&#x7EA2;&#xFF0C;&#x5DE6;&#x513F;&#x5B50;&#x968F;&#x610F;&#xFF09;"></a>&#x60C5;&#x51B5;4&#xFF1A;x&#x8282;&#x70B9;&#x662F;&#x9ED1;+&#x9ED1;&#x8282;&#x70B9;&#xFF0C;x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x65F6;&#x9ED1;&#x8272;&#xFF08;x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x7684;&#x53F3;&#x513F;&#x5B50;&#x662F;&#x7EA2;&#xFF0C;&#x5DE6;&#x513F;&#x5B50;&#x968F;&#x610F;&#xFF09;</h4><p> <img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/6aa0141182f91798e1c52569e2bac2f264a86a07b77fdb6ac9003aee68e1b888" alt="x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x65F6;&#x9ED1;&#x8272;&#xFF08;x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x7684;&#x53F3;&#x513F;&#x5B50;&#x662F;&#x7EA2;&#xFF0C;&#x5DE6;&#x513F;&#x5B50;&#x968F;&#x610F;&#xFF09;"><br> <em>x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x65F6;&#x9ED1;&#x8272;&#xFF08;x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x7684;&#x53F3;&#x513F;&#x5B50;&#x662F;&#x7EA2;&#xFF0C;&#x5DE6;&#x513F;&#x5B50;&#x968F;&#x610F;&#xFF09;</em><br>&#x6B64;&#x65F6;&#xFF0C;&#x628A;x&#x7684;&#x7236;&#x8282;&#x70B9;&#x7684;&#x989C;&#x8272;&#x8D4B;&#x7ED9;x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#xFF0C;&#x628A;&#x7236;&#x8282;&#x70B9;&#x8BBE;&#x4E3A;&#x9ED1;&#x8272;&#xFF0C;&#x5C06;x&#x7684;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x7684;&#x53F3;&#x5B50;&#x8282;&#x70B9;&#x8BBE;&#x4E3A;&#x9ED1;&#x8272;&#xFF0C;&#x518D;&#x5BF9;x&#x7684;&#x7236;&#x8282;&#x70B9;&#x8FDB;&#x884C;&#x5DE6;&#x65CB;&#x3002;&#x8FD9;&#x4E00;&#x6B65;&#x64CD;&#x4F5C;&#x7684;&#x771F;&#x6B63;&#x7684;&#x8282;&#x70B9;&#x501F;&#x8C03;&#x64CD;&#x4F5C;&#xFF0C;&#x901A;&#x8FC7;&#x5C06;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x4EE5;&#x53CA;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x7684;&#x53F3;&#x8282;&#x70B9;&#x501F;&#x8C03;&#x8FC7;&#x6765;&#xFF0C;&#x5E76;&#x5C06;&#x5144;&#x5F1F;&#x8282;&#x70B9;&#x7684;&#x53F3;&#x5B50;&#x8282;&#x70B9;&#x53D8;&#x6210;&#x7EA2;&#x8272;&#x6765;&#x8FBE;&#x5230;&#x501F;&#x8C03;&#x4E24;&#x4E2A;&#x9ED1;&#x8282;&#x70B9;&#x7684;&#x76EE;&#x7684;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x6574;&#x68F5;&#x6811;&#x8FD8;&#x662F;&#x7B26;&#x5408;&#x7EA2;&#x9ED1;&#x6811;&#x7684;&#x5B9A;&#x4E49;&#x7684;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/fa7127e13cdf97f0891d8757688cd19c.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903511902126094.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903511902126094.html" itemprop="url">Mongodb架构设计浅谈 Mongodb架构设计</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-20T14:13:27+08:00">
                2017-11-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Mongodb&#x67B6;&#x6784;&#x8BBE;&#x8BA1;"><a href="#Mongodb&#x67B6;&#x6784;&#x8BBE;&#x8BA1;" class="headerlink" title="Mongodb&#x67B6;&#x6784;&#x8BBE;&#x8BA1;"></a>Mongodb&#x67B6;&#x6784;&#x8BBE;&#x8BA1;</h1><p>&#x53C2;&#x8003;&#x94FE;&#x63A5;&#xFF1A;learnmongodbthehardway.com/schema/sche&#x2026;</p>
<h2 id="&#x6982;&#x89C8;"><a href="#&#x6982;&#x89C8;" class="headerlink" title="&#x6982;&#x89C8;"></a>&#x6982;&#x89C8;</h2><p>Mongodb&#x662F;&#x6587;&#x6863;&#x578B;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x7531;&#x4E8E;&#x5176;&#x4E0D;&#x5C5E;&#x4E8E;&#x5173;&#x7CFB;&#x578B;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x4E0D;&#x5FC5;&#x9075;&#x5B88;&#x4E09;&#x5927;&#x8303;&#x5F0F;&#xFF0C;&#x800C;&#x4E14;&#x4E5F;&#x6CA1;&#x6709;Join&#x5173;&#x952E;&#x5B57;&#x6765;&#x652F;&#x6301;&#x8868;&#x8FDE;&#x63A5;&#xFF0C;&#x6240;&#x4EE5;Mongodb&#x7684;&#x8868;&#x7ED3;&#x6784;&#x8BBE;&#x8BA1;&#x8DDF;Oracle&#x3001;MySQL&#x5F88;&#x4E0D;&#x4E00;&#x6837;&#x3002;&#x4E0B;&#x9762;&#x9488;&#x5BF9;&#x51E0;&#x79CD;&#x4E0D;&#x540C;&#x7684;&#x8868;&#x8BBE;&#x8BA1;&#x7ED3;&#x6784;&#x5206;&#x522B;&#x4E3E;&#x4F8B;&#xFF1A;</p>
<h2 id="1&#x5BF9;1&#x5173;&#x7CFB;&#x6A21;&#x578B;"><a href="#1&#x5BF9;1&#x5173;&#x7CFB;&#x6A21;&#x578B;" class="headerlink" title="1&#x5BF9;1&#x5173;&#x7CFB;&#x6A21;&#x578B;"></a>1&#x5BF9;1&#x5173;&#x7CFB;&#x6A21;&#x578B;</h2><p>&#x5728;&#x5173;&#x7CFB;&#x578B;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#xFF0C;1&#x5BF9;1&#x5173;&#x7CFB;&#x6A21;&#x578B;&#x901A;&#x5E38;&#x662F;&#x901A;&#x8FC7;&#x5916;&#x952E;&#x7684;&#x5F62;&#x5F0F;&#x8FDB;&#x884C;&#x5904;&#x7406;&#x3002;&#x6211;&#x4EEC;&#x4EE5;&#x4F5C;&#x5BB6;&#x8DDF;&#x5730;&#x5740;&#x6765;&#x4E3E;&#x4F8B;&#xFF0C;&#x5047;&#x8BBE;&#x8FD9;&#x4E24;&#x4E2A;&#x5B9E;&#x4F53;&#x7684;&#x5173;&#x7CFB;&#x662F;1&#x5BF9;1&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x53EF;&#x80FD;&#x4F1A;&#x50CF;&#x4E0B;&#x9762;&#x8FD9;&#x6837;&#x5B50;&#x5EFA;&#x8868;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/634477c6159dfe8d74307b2fd1b45dfc9353a1d5c8bcec815cd2306a4910c4f6" alt></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/d2c4315bae7e0372c40574f3c97678d5431863c9f74cd4da8985e18b9f42236d" alt></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/b152aa6fd2feca1d569ea7de62d1f99a5383c366d9a48b08ee494af3169ed1bd" alt></p>
<p>&#x4F46;&#x662F;&#xFF0C;&#x4E3A;&#x4E86;&#x65B9;&#x4FBF;&#xFF0C;&#x5176;&#x5B9E;&#x6211;&#x4EEC;&#x5728;&#x8BBE;&#x8BA1;&#x8868;&#x7684;&#x65F6;&#x5019;&#x4E0D;&#x4F1A;&#x4E25;&#x683C;&#x9075;&#x5B88;&#x4E09;&#x5927;&#x8303;&#x5F0F;&#xFF0C;&#x4F1A;&#x505A;&#x4E00;&#x5B9A;&#x7684;&#x5197;&#x4F59;&#x6570;&#x636E;&#xFF0C;&#x5B9E;&#x9645;&#x60C5;&#x51B5;&#x4E0B;&#x53EF;&#x80FD;&#x5C31;&#x662F;&#x8FD9;&#x6837;&#x5B50;&#x7684;&#x8868;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/96f354345e8c7539e1e2b190dfccb952463c3b37f0337ac2bbacfbe75514885d" alt></p>
<p>&#x90A3;&#x4E48;&#xFF0C;&#x6211;&#x4EEC;&#x56DE;&#x5230;Mongodb&#xFF0C;&#x5728;&#x8FD9;&#x5F20;&#x975E;&#x5173;&#x7CFB;&#x578B;&#x7684;NoSQL&#x6570;&#x636E;&#x5E93;&#x91CC;&#xFF0C;&#x6CA1;&#x6709;&#x6807;&#x51C6;&#x7684;&#x5916;&#x952E;&#xFF08;&#x867D;&#x7136;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x624B;&#x5DE5;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x79CD;&#x8868;&#x4E4B;&#x95F4;&#x7684;&#x5B57;&#x6BB5;&#x5173;&#x8054;&#x5173;&#x7CFB;&#x53EA;&#x80FD;&#x5B58;&#x5728;&#x7A0B;&#x5E8F;&#x7EA7;&#x522B;&#xFF0C;&#x6570;&#x636E;&#x5E93;&#x672C;&#x8EAB;&#x5E76;&#x6CA1;&#x6709;&#x63D0;&#x51FA;&#x5916;&#x952E;&#x7EA6;&#x675F;&#x7684;&#x6982;&#x5FF5;&#xFF09;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x600E;&#x4E48;&#x6765;&#x5EFA;&#x7ACB;&#x8868;&#x5E76;&#x5904;&#x7406;&#x8868;&#x4E4B;&#x95F4;&#x7684;&#x5173;&#x7CFB;&#x5462;&#xFF1F;</p>
<ol>
<li>&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;</li>
</ol>
<p> &#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;&#x5EFA;&#x7ACB;&#x5916;&#x952E;&#xFF0C;&#x5728;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x8868;&#x91CC;&#x5EFA;&#x7ACB;&#x5BF9;&#x65B9;&#x7684;id&#x5B57;&#x6BB5;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801; &#x7528;&#x6237;&#x4FE1;&#x606F;&#x7684;&#x6587;&#x6863;&#x8BBE;&#x8BA1;    </span><br><span class="line"> {</span><br><span class="line">   _id: 1,</span><br><span class="line">   name: &quot;Peter Wilkinson&quot;,</span><br><span class="line">   age: 27</span><br><span class="line"> }</span><br><span class="line"></span><br><span class="line"> &#x4FDD;&#x7559;&#x5916;&#x952E;&#x7684;&#x5730;&#x5740;&#x4FE1;&#x606F;&#x7684;&#x6587;&#x6863;&#x8BBE;&#x8BA1;</span><br><span class="line"> {</span><br><span class="line">   user_id: 1,</span><br><span class="line">   street: &quot;100 some road&quot;,</span><br><span class="line">   city: &quot;Nevermore&quot;</span><br><span class="line"> }</span><br></pre></td></tr></table></figure>

<ol>
<li>&#x5185;&#x5D4C;&#x6587;&#x6863;</li>
</ol>
<p> &#x76F4;&#x63A5;&#x628A;&#x5730;&#x5740;&#x4FE1;&#x606F;&#x7684;&#x6587;&#x6863;&#x4F5C;&#x4E3A;&#x7528;&#x6237;&#x4FE1;&#x606F;&#x6587;&#x6863;&#x7684;&#x4E00;&#x4E2A;&#x5B57;&#x6BB5;&#x50A8;&#x5B58;&#x8FDB;&#x53BB;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801; {</span><br><span class="line">    name: &quot;Peter Wilkinson&quot;,</span><br><span class="line">   age: 27,</span><br><span class="line">   address: {</span><br><span class="line">     street: &quot;100 some road&quot;,</span><br><span class="line">     city: &quot;Nevermore&quot;</span><br><span class="line">   }</span><br><span class="line"> }</span><br></pre></td></tr></table></figure>

<p> &#x76F4;&#x63A5;&#x5185;&#x5D4C;&#x6587;&#x6863;&#x7684;&#x597D;&#x5904;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x5355;&#x6B21;&#x8BFB;&#x64CD;&#x4F5C;&#x5C31;&#x53EF;&#x4EE5;&#x7279;&#x5B9A;&#x7528;&#x6237;&#x7684;&#x7528;&#x6237;&#x4FE1;&#x606F;&#x6587;&#x6863;&#x4EE5;&#x53CA;&#x5BF9;&#x5E94;&#x7684;&#x5730;&#x5740;&#x4FE1;&#x606F;&#x6587;&#x6863;&#xFF0C;&#x5F53;&#x7136;&#x4E86;&#xFF0C;&#x8FD9;&#x662F;&#x5728;&#x7528;&#x6237;&#x4FE1;&#x606F;&#x548C;&#x5730;&#x5740;&#x4FE1;&#x606F;&#x5F3A;&#x5173;&#x8054;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8FD9;&#x6837;&#x5B50;&#x76F4;&#x63A5;&#x5185;&#x5D4C;&#x624D;&#x663E;&#x5F97;&#x6709;&#x610F;&#x4E49;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801; &#x5B98;&#x65B9;&#x6587;&#x6863;&#x63A8;&#x8350;1&#x5BF9;1&#x7684;&#x6570;&#x636E;&#x6A21;&#x578B;&#x5C3D;&#x91CF;&#x4F7F;&#x7528;&#x5185;&#x5D4C;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x8FD9;&#x6837;&#x5B50;&#x4F1A;&#x63D0;&#x9AD8;&#x8BFB;&#x64CD;&#x4F5C;&#x7684;&#x6548;&#x7387;&#xFF0C;&#x66F4;&#x5FEB;&#x5730;&#x83B7;&#x53D6;&#x6587;&#x6863;&#x4FE1;&#x606F;</span><br></pre></td></tr></table></figure>

<h2 id="1&#x5BF9;&#x591A;&#x5173;&#x7CFB;&#x6A21;&#x578B;"><a href="#1&#x5BF9;&#x591A;&#x5173;&#x7CFB;&#x6A21;&#x578B;" class="headerlink" title="1&#x5BF9;&#x591A;&#x5173;&#x7CFB;&#x6A21;&#x578B;"></a>1&#x5BF9;&#x591A;&#x5173;&#x7CFB;&#x6A21;&#x578B;</h2><p>1&#x5BF9;&#x591A;&#x7684;&#x5173;&#x7CFB;&#x6A21;&#x578B;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7B80;&#x5355;&#x5730;&#x4EE5;&#x535A;&#x5BA2;&#x548C;&#x5BF9;&#x5E94;&#x7684;&#x8BC4;&#x8BBA;&#x4FE1;&#x606F;&#x6765;&#x4E3E;&#x4F8B;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/8eb6dc53e3a7a23acc32be5f64282c50d90d700c811fb4664ebe3e63b00c27a4" alt></p>
<p>&#x5BF9;&#x5E94;&#x7684;Mongodb&#x7684;&#x8868;&#x6A21;&#x578B;&#x5982;&#x4E0B;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&#x535A;&#x5BA2;&#x4FE1;&#x606F;&#x7684;&#x6587;&#x6863;&#x8BBE;&#x8BA1;</span><br><span class="line">{</span><br><span class="line">  title: &quot;An awesome blog&quot;,</span><br><span class="line">  url: &quot;http://awesomeblog.com&quot;,</span><br><span class="line">  text: &quot;This is an awesome blog we have just started&quot;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">&#x8BC4;&#x8BBA;&#x4FE1;&#x606F;&#x7684;&#x6587;&#x6863;&#x8BBE;&#x8BA1;</span><br><span class="line">{</span><br><span class="line">  name: &quot;Peter Critic&quot;,</span><br><span class="line">  created_on: ISODate(&quot;2014-01-01T10:01:22Z&quot;),</span><br><span class="line">  comment: &quot;Awesome blog post&quot;</span><br><span class="line">}</span><br><span class="line">{</span><br><span class="line">  name: &quot;John Page&quot;,</span><br><span class="line">  created_on: ISODate(&quot;2014-01-01T11:01:22Z&quot;),</span><br><span class="line">  comment: &quot;Not so awesome blog&quot;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5728;&#x5173;&#x7CFB;&#x578B;&#x6570;&#x636E;&#x5E93;&#x91CC;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x5E38;&#x662F;&#x5206;&#x522B;&#x5EFA;&#x7ACB;&#x4E24;&#x5F20;&#x8868;&#xFF1A;&#x4E00;&#x4E2A;Blog&#x8868;&#x3001;&#x4E00;&#x4E2A;Comments&#x8868;&#xFF08;&#x4ECE;&#x8868;&#xFF0C;&#x5E26;&#x6709;blog_id&#x5916;&#x952E;&#xFF09;&#xFF0C;&#x7136;&#x540E;&#x901A;&#x8FC7;join&#x64CD;&#x4F5C;&#x628A;&#x4E24;&#x4E2A;&#x8868;&#x5173;&#x8054;&#x8D77;&#x6765;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/4997f68c573f7f0ed92d1ea1f8fbbc48ce29bfc832b0a3eb42a2e90f6cd68fa4" alt></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/aa26b693622558bb7c92c45496faed101a5c7548cefca1e101510328541ffb28" alt></p>
<p>&#x4F46;&#x662F;&#x5728;Mongodb&#x91CC;&#x7531;&#x4E8E;&#x6CA1;&#x6709;Join&#x5173;&#x952E;&#x5B57;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6839;&#x636E;Mongodb&#x7684;&#x7279;&#x70B9;&#xFF0C;&#x5F97;&#x51FA;&#x4EE5;&#x4E0B;&#x4E09;&#x4E2A;&#x89E3;&#x51B3;&#x65B9;&#x5F0F;&#xFF1A;</p>
<ol>
<li>&#x5185;&#x5D4C;</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801; &#x5185;&#x5D4C;&#x4E86;&#x8BC4;&#x8BBA;&#x4FE1;&#x606F;&#x7684;&#x535A;&#x5BA2;&#x6587;&#x6863;&#x8BBE;&#x8BA1;</span><br><span class="line"> {</span><br><span class="line">   title: &quot;An awesome blog&quot;,</span><br><span class="line">   url: &quot;http://awesomeblog.com&quot;,</span><br><span class="line">   text: &quot;This is an awesome blog we have just started&quot;,</span><br><span class="line">   comments: [{</span><br><span class="line">     name: &quot;Peter Critic&quot;,</span><br><span class="line">     created_on: ISODate(&quot;2014-01-01T10:01:22Z&quot;),</span><br><span class="line">     comment: &quot;Awesome blog post&quot;</span><br><span class="line">   }, {</span><br><span class="line">     name: &quot;John Page&quot;,</span><br><span class="line">     created_on: ISODate(&quot;2014-01-01T11:01:22Z&quot;),</span><br><span class="line">     comment: &quot;Not so awesome blog&quot;</span><br><span class="line">   }]</span><br><span class="line"> }</span><br></pre></td></tr></table></figure>

<p> &#x4E0A;&#x9762;&#x8FD9;&#x79CD;&#x8868;&#x8BBE;&#x8BA1;&#x7684;&#x597D;&#x5904;&#x662F;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x83B7;&#x53D6;&#x6307;&#x5B9A;&#x535A;&#x5BA2;&#x4E0B;&#x7684;&#x8BC4;&#x8BBA;&#x4FE1;&#x606F;&#xFF0C;&#x7528;&#x6237;&#x65B0;&#x589E;&#x8BC4;&#x8BBA;&#x7684;&#x8BDD;&#xFF0C;&#x76F4;&#x63A5;&#x5728;blog&#x6587;&#x6863;&#x4E0B;&#x7684;comments&#x6570;&#x7EC4;&#x5B57;&#x6BB5;&#x63D2;&#x5165;&#x4E00;&#x4E2A;&#x65B0;&#x503C;&#x5373;&#x53EF;&#x3002;</p>
<p> &#x4F46;&#x662F;&#x8FD9;&#x79CD;&#x8868;&#x8BBE;&#x8BA1;&#x81F3;&#x5C11;&#x6709;&#x4E09;&#x4E2A;&#x5982;&#x4E0B;&#x7684;&#x6F5C;&#x5728;&#x95EE;&#x9898;&#x9700;&#x8981;&#x6CE8;&#x610F;&#xFF1A;</p>
<pre><code>1. &#x535A;&#x5BA2;&#x4E0B;&#x7684;&#x8BC4;&#x8BBA;&#x6570;&#x7EC4;&#x53EF;&#x80FD;&#x4F1A;&#x9010;&#x6E10;&#x6269;&#x589E;&#xFF0C;&#x751A;&#x81F3;&#x4E8E;&#x8D85;&#x8FC7;&#x4E86;&#x6587;&#x6863;&#x7684;&#x6700;&#x5927;&#x9650;&#x5236;&#x957F;&#x5EA6;&#xFF1A;16MB
2. &#x7B2C;&#x4E8C;&#x4E2A;&#x95EE;&#x9898;&#x662F;&#x8DDF;&#x5199;&#x6027;&#x80FD;&#x76F8;&#x5173;&#xFF0C;&#x7531;&#x4E8E;&#x8BC4;&#x8BBA;&#x662F;&#x4E0D;&#x505C;&#x5730;&#x6DFB;&#x52A0;&#x81F3;&#x535A;&#x5BA2;&#x6587;&#x6863;&#x91CC;&#xFF0C;&#x5F53;&#x6709;&#x65B0;&#x7684;&#x535A;&#x5BA2;&#x6587;&#x6863;&#x63D2;&#x5165;&#x96C6;&#x5408;&#x7684;&#x65F6;&#x5019;&#xFF0C;MongoDB&#x4F1A;&#x53D8;&#x5F97;&#x6BD4;&#x8F83;&#x56F0;&#x96BE;&#x5B9A;&#x4F4D;&#x5230;&#x539F;&#x6765;&#x7684;&#x535A;&#x5BA2;&#x6587;&#x6863;&#x4F4D;&#x7F6E;&#xFF0C;&#x53E6;&#x5916;&#xFF0C;&#x6570;&#x636E;&#x5E93;&#x8FD8;&#x9700;&#x8981;&#x989D;&#x5916;&#x5F00;&#x8F9F;&#x65B0;&#x7684;&#x5185;&#x5B58;&#x7A7A;&#x95F4;&#x5E76;&#x590D;&#x5236;&#x539F;&#x6765;&#x7684;&#x535A;&#x5BA2;&#x6587;&#x6863;&#x3001;&#x66F4;&#x65B0;&#x6240;&#x6709;&#x7D22;&#x5F15;&#xFF0C;&#x8FD9;&#x9700;&#x8981;&#x66F4;&#x591A;&#x7684;IO&#x4EA4;&#x4E92;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x5F71;&#x54CD;&#x5199;&#x6027;&#x80FD;</code></pre><p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/87bfcbf7632047d8412201eb2fef6452469c9b48d9c4dd569a0a9985c805f889" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;        &#x5FC5;&#x987B;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x53EA;&#x6709;&#x9AD8;&#x5199;&#x5165;&#x6D41;&#x91CF;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x624D;&#x53EF;&#x80FD;&#x4F1A;&#x5F71;&#x54CD;&#x5199;&#x6027;&#x80FD;&#xFF0C;&#x800C;&#x5BF9;&#x4E8E;&#x5199;&#x5165;&#x6D41;&#x91CF;&#x8F83;&#x5C0F;&#x7684;&#x7A0B;&#x5E8F;&#x53CD;&#x800C;&#x6CA1;&#x6709;&#x90A3;&#x4E48;&#x5927;&#x7684;&#x5F71;&#x54CD;&#x3002;&#x89C6;&#x5177;&#x4F53;&#x60C5;&#x51B5;&#x800C;&#x5B9A;&#x3002;</span><br><span class="line"></span><br><span class="line">3. &#x7B2C;&#x4E09;&#x4E2A;&#x95EE;&#x9898;&#x662F;&#x5F53;&#x4F60;&#x5C1D;&#x8BD5;&#x53BB;&#x8FDB;&#x884C;&#x8BC4;&#x8BBA;&#x5206;&#x9875;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F60;&#x4F1A;&#x53D1;&#x89C9;&#x901A;&#x8FC7;&#x5E38;&#x89C4;&#x7684;find&#x67E5;&#x8BE2;&#x64CD;&#x4F5C;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x80FD;&#x5148;&#x8BFB;&#x53D6;&#x6574;&#x4E2A;&#x6587;&#x6863;&#x4FE1;&#x606F;&#xFF08;&#x5305;&#x62EC;&#x6240;&#x6709;&#x8BC4;&#x8BBA;&#x4FE1;&#x606F;&#xFF09;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x7A0B;&#x5E8F;&#x91CC;&#x8FDB;&#x884C;&#x8BC4;&#x8BBA;&#x4FE1;&#x606F;&#x7684;&#x5206;&#x9875;</span><br></pre></td></tr></table></figure>

<ol>
<li>&#x8FDE;&#x63A5;</li>
</ol>
<p> &#x7B2C;&#x4E8C;&#x4E2A;&#x65B9;&#x5F0F;&#x662F;&#x901A;&#x8FC7;&#x5EFA;&#x7ACB;&#x7C7B;&#x4F3C;&#x5916;&#x952E;&#x7684;id&#x6765;&#x8FDB;&#x884C;&#x6587;&#x6863;&#x95F4;&#x7684;&#x5173;&#x8054;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801; &#x535A;&#x5BA2;&#x7684;&#x6587;&#x6863;&#x8BBE;&#x8BA1;        </span><br><span class="line"> {</span><br><span class="line">   _id: 1,</span><br><span class="line">   title: &quot;An awesome blog&quot;,</span><br><span class="line">   url: &quot;http://awesomeblog.com&quot;,</span><br><span class="line">   text: &quot;This is an awesome blog we have just started&quot;</span><br><span class="line"> }</span><br><span class="line"></span><br><span class="line"> &#x8BC4;&#x8BBA;&#x7684;&#x6587;&#x6863;&#x8BBE;&#x8BA1;</span><br><span class="line"> {</span><br><span class="line">   blog_entry_id: 1,</span><br><span class="line">   name: &quot;Peter Critic&quot;,</span><br><span class="line">   created_on: ISODate(&quot;2014-01-01T10:01:22Z&quot;),</span><br><span class="line">   comment: &quot;Awesome blog post&quot;</span><br><span class="line"> }</span><br><span class="line"> {</span><br><span class="line">   blog_entry_id: 1,</span><br><span class="line">   name: &quot;John Page&quot;,</span><br><span class="line">   created_on: ISODate(&quot;2014-01-01T11:01:22Z&quot;),</span><br><span class="line">   comment: &quot;Not so awesome blog&quot;</span><br><span class="line"> }</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&#x8FD9;&#x6837;&#x5B50;&#x8BBE;&#x8BA1;&#x6A21;&#x578B;&#x6709;&#x4E2A;&#x597D;&#x5904;&#x662F;&#x5F53;&#x8BC4;&#x8BBA;&#x4FE1;&#x606F;&#x9010;&#x6E10;&#x589E;&#x957F;&#x7684;&#x65F6;&#x5019;&#x5E76;&#x4E0D;&#x4F1A;&#x5F71;&#x54CD;&#x539F;&#x59CB;&#x7684;&#x535A;&#x5BA2;&#x6587;&#x6863;&#xFF0C;&#x4ECE;&#x800C;&#x907F;&#x514D;&#x4E86;&#x5355;&#x4E2A;&#x6587;&#x6863;&#x8D85;&#x8FC7;16MB&#x7684;&#x60C5;&#x51B5;&#x51FA;&#x73B0;&#x3002;&#x800C;&#x4E14;&#x8FD9;&#x6837;&#x5B50;&#x8BBE;&#x8BA1;&#x4E5F;&#x6BD4;&#x8F83;&#x5BB9;&#x6613;&#x8FD4;&#x56DE;&#x5206;&#x9875;&#x8BC4;&#x8BBA;&#x3002;&#x4F46;&#x662F;&#x574F;&#x5904;&#x7684;&#x8BDD;&#xFF0C;&#x5C31;&#x662F;&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x5728;&#x4E00;&#x4E2A;&#x535A;&#x5BA2;&#x6587;&#x6863;&#x4E0B;&#x62E5;&#x6709;&#x975E;&#x5E38;&#x591A;&#x7684;&#x8BC4;&#x8BBA;&#x65F6;&#xFF08;&#x6BD4;&#x5982;1000&#x6761;&#xFF09;&#xFF0C;&#x90A3;&#x6211;&#x4EEC;&#x83B7;&#x53D6;&#x6240;&#x6709;&#x8BC4;&#x8BBA;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x5F15;&#x8D77;&#x6570;&#x636E;&#x5E93;&#x5F88;&#x591A;&#x7684;&#x8BFB;&#x64CD;&#x4F5C;</span><br></pre></td></tr></table></figure>

<ol>
<li>&#x5206;&#x5757;</li>
</ol>
<p> &#x7B2C;&#x4E09;&#x4E2A;&#x65B9;&#x6CD5;&#x5C31;&#x662F;&#x524D;&#x9762;&#x4E24;&#x79CD;&#x65B9;&#x6CD5;&#x7684;&#x6DF7;&#x5408;&#xFF0C;&#x7406;&#x8BBA;&#x4E0A;&#xFF0C;&#x5C1D;&#x8BD5;&#x53BB;&#x5E73;&#x8861;&#x5185;&#x5D4C;&#x7B56;&#x7565;&#x548C;&#x8FDE;&#x63A5;&#x6A21;&#x5F0F;&#xFF0C;&#x4E3E;&#x4E2A;&#x4F8B;&#x5B50;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x80FD;&#x4F1A;&#x6839;&#x636E;&#x5B9E;&#x9645;&#x60C5;&#x51B5;&#xFF0C;&#x628A;&#x6240;&#x6709;&#x7684;&#x8BC4;&#x8BBA;&#x5207;&#x5206;&#x6210;&#x6700;&#x591A;50&#x6761;&#x8BC4;&#x8BBA;&#x7684;&#x5206;&#x5757;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801; &#x535A;&#x5BA2;&#x7684;&#x6587;&#x6863;&#x8BBE;&#x8BA1;        </span><br><span class="line"> {</span><br><span class="line">   _id: 1,</span><br><span class="line">   title: &quot;An awesome blog&quot;,</span><br><span class="line">   url: &quot;http://awesomeblog.com&quot;,</span><br><span class="line">   text: &quot;This is an awesome blog we have just started&quot;</span><br><span class="line"> }</span><br><span class="line"></span><br><span class="line"> &#x8BC4;&#x8BBA;&#x4FE1;&#x606F;&#x7684;&#x6587;&#x6863;&#x8BBE;&#x8BA1;</span><br><span class="line"> {</span><br><span class="line">   blog_entry_id: 1,</span><br><span class="line">   page: 1,</span><br><span class="line">   count: 50,</span><br><span class="line">   comments: [{</span><br><span class="line">     name: &quot;Peter Critic&quot;,</span><br><span class="line">     created_on: ISODate(&quot;2014-01-01T10:01:22Z&quot;),</span><br><span class="line">     comment: &quot;Awesome blog post&quot;</span><br><span class="line">   }, ...]</span><br><span class="line"> }</span><br><span class="line"> {</span><br><span class="line">   blog_entry_id: 1,</span><br><span class="line">   page: 2,</span><br><span class="line">   count: 1,</span><br><span class="line">   comments: [{</span><br><span class="line">     name: &quot;John Page&quot;,</span><br><span class="line">     created_on: ISODate(&quot;2014-01-01T11:01:22Z&quot;),</span><br><span class="line">     comment: &quot;Not so awesome blog&quot;</span><br><span class="line">   }]</span><br><span class="line"> }</span><br></pre></td></tr></table></figure>

<p> &#x8FD9;&#x6837;&#x5B50;&#x8BBE;&#x8BA1;&#x6700;&#x5927;&#x7684;&#x597D;&#x5904;&#x662F;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5355;&#x6B21;&#x8BFB;&#x64CD;&#x4F5C;&#x91CC;&#x4E00;&#x6B21;&#x6027;&#x6293;&#x51FA;50&#x6761;&#x8BC4;&#x8BBA;&#xFF0C;&#x65B9;&#x4FBF;&#x6211;&#x4EEC;&#x8FDB;&#x884C;&#x8BC4;&#x8BBA;&#x5206;&#x9875;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801; &#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x4F7F;&#x7528;&#x5206;&#x5757;&#x7B56;&#x7565;&#xFF1F;</span><br><span class="line"> &#x5F53;&#x4F60;&#x53EF;&#x4EE5;&#x5C06;&#x6587;&#x6863;&#x5207;&#x5272;&#x6210;&#x4E0D;&#x540C;&#x7684;&#x6279;&#x6B21;&#x65F6;&#xFF0C;&#x90A3;&#x4E48;&#x91C7;&#x7528;&#x8FD9;&#x79CD;&#x7B56;&#x7565;&#x53EF;&#x4EE5;&#x52A0;&#x901F;&#x6587;&#x6863;&#x68C0;&#x7D22;</span><br><span class="line"> &#x5178;&#x578B;&#x7684;&#x4F8B;&#x5B50;&#x5C31;&#x662F;&#x6839;&#x636E;&#x5C0F;&#x65F6;&#x3001;&#x5929;&#x6570;&#x6216;&#x8005;&#x6570;&#x91CF;&#x8FDB;&#x884C;&#x8BC4;&#x8BBA;&#x5206;&#x9875;&#xFF08;&#x7C7B;&#x4F3C;&#x8BC4;&#x8BBA;&#x5206;&#x9875;&#xFF09;</span><br></pre></td></tr></table></figure>

<h2 id="&#x591A;&#x5BF9;&#x591A;&#x5173;&#x7CFB;&#x6A21;&#x578B;"><a href="#&#x591A;&#x5BF9;&#x591A;&#x5173;&#x7CFB;&#x6A21;&#x578B;" class="headerlink" title="&#x591A;&#x5BF9;&#x591A;&#x5173;&#x7CFB;&#x6A21;&#x578B;"></a>&#x591A;&#x5BF9;&#x591A;&#x5173;&#x7CFB;&#x6A21;&#x578B;</h2><p>&#x591A;&#x5BF9;&#x591A;&#x5173;&#x7CFB;&#x6A21;&#x578B;&#xFF0C;&#x6211;&#x4EEC;&#x4EE5;&#x4F5C;&#x8005;&#x8DDF;&#x521B;&#x4F5C;&#x7684;&#x4E66;&#x7C4D;&#x6765;&#x4E3E;&#x4F8B;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/df785cfedcc2cb5367c14541d7423dc2859ac1712f2c8baa5889165dab34ff07" alt></p>
<p>&#x5728;&#x5173;&#x7CFB;&#x578B;&#x6570;&#x636E;&#x5E93;&#x91CC;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E2D;&#x95F4;&#x8868;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x5904;&#x7406;<br><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/bbbc2b4b7c1c8c2a1e396c656837a643e1d46abc0a9473538acefdb46078d478" alt></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/ec0eab8c9f36c78b102c7ddd49601efa89ef215d1dce30a4b3edcea43c2b4e93" alt></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/b7f1ba1671013432132dd84e3d0f34887313f8c566714f50400ea924184bf2dc" alt></p>
<ol>
<li>&#x53CC;&#x5411;&#x5D4C;&#x5957;</li>
</ol>
<p> &#x5728;MongoDB&#x91CC;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x53CC;&#x5411;&#x5D4C;&#x5957;&#xFF0C;&#x628A;&#x4E24;&#x4E2A;&#x6587;&#x6863;&#x7684;&#x5916;&#x952E;&#x901A;&#x8FC7;&#x6570;&#x7EC4;&#x5B57;&#x6BB5;&#x6DFB;&#x52A0;&#x5230;&#x5F7C;&#x6B64;&#x7684;&#x6587;&#x6863;&#x91CC;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801; &#x4F5C;&#x8005;&#x4FE1;&#x606F;&#x7684;&#x6587;&#x6863;&#x8BBE;&#x8BA1;</span><br><span class="line"> {</span><br><span class="line">   _id: 1,</span><br><span class="line">   name: &quot;Peter Standford&quot;,</span><br><span class="line">   books: [1, 2]</span><br><span class="line"> }</span><br><span class="line"> {</span><br><span class="line">   _id: 2,</span><br><span class="line">   name: &quot;Georg Peterson&quot;,</span><br><span class="line">   books: [2]</span><br><span class="line"> }</span><br><span class="line"></span><br><span class="line"> &#x4E66;&#x7C4D;&#x4FE1;&#x606F;&#x7684;&#x6587;&#x6863;&#x8BBE;&#x8BA1;</span><br><span class="line"> {</span><br><span class="line">   _id: 1,</span><br><span class="line">   title: &quot;A tale of two people&quot;,</span><br><span class="line">   categories: [&quot;drama&quot;],</span><br><span class="line">   authors: [1, 2]</span><br><span class="line"> }</span><br><span class="line"> {</span><br><span class="line">   _id: 2,</span><br><span class="line">   title: &quot;A tale of two space ships&quot;,</span><br><span class="line">   categories: [&quot;scifi&quot;],</span><br><span class="line">   authors: [1]</span><br><span class="line"> }</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&#x5F53;&#x6211;&#x4EEC;&#x8FDB;&#x884C;&#x67E5;&#x8BE2;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E24;&#x4E2A;&#x7EF4;&#x5EA6;&#x4E92;&#x76F8;&#x8FDB;&#x884C;&#x67E5;&#x8BE2;</span><br><span class="line"></span><br><span class="line">    &#x901A;&#x8FC7;&#x6307;&#x5B9A;&#x7684;&#x4F5C;&#x8005;&#x641C;&#x7D22;&#x5BF9;&#x5E94;&#x7684;&#x4E66;&#x7C4D;</span><br><span class="line">    var db = db.getSisterDB(&quot;library&quot;);</span><br><span class="line">    var booksCollection = db.books;</span><br><span class="line">    var authorsCollection = db.authors;</span><br><span class="line"></span><br><span class="line">    var author = authorsCollection.findOne({name: &quot;Peter Standford&quot;});</span><br><span class="line">    var books = booksCollection.find({_id: {$in: author.books}}).toArray();</span><br><span class="line"></span><br><span class="line">    &#x901A;&#x8FC7;&#x6307;&#x5B9A;&#x7684;&#x4E66;&#x7C4D;&#x641C;&#x7D22;&#x5BF9;&#x5E94;&#x7684;&#x4F5C;&#x8005;</span><br><span class="line">    var db = db.getSisterDB(&quot;library&quot;);</span><br><span class="line">    var booksCollection = db.books;</span><br><span class="line">    var authorsCollection = db.authors;</span><br><span class="line"></span><br><span class="line">    var book = booksCollection.findOne({title: &quot;A tale of two space ships&quot;});</span><br><span class="line">    var authors = authorsCollection.find({_id: {$in: book.authors}}).toArray();</span><br></pre></td></tr></table></figure>

<ol>
<li>&#x5355;&#x5411;&#x5D4C;&#x5957;</li>
</ol>
<p> &#x5355;&#x5411;&#x5D4C;&#x5957;&#x7B56;&#x7565;&#x662F;&#x7528;&#x6765;&#x4F18;&#x5316;&#x591A;&#x5BF9;&#x591A;&#x5173;&#x7CFB;&#x6A21;&#x578B;&#x91CC;&#x7684;&#x8BFB;&#x6027;&#x80FD;&#xFF0C;&#x901A;&#x8FC7;&#x5C06;&#x53CC;&#x5411;&#x5F15;&#x7528;&#x8F6C;&#x79FB;&#x4E3A;&#x7C7B;&#x4F3C;&#x4E00;&#x5BF9;&#x591A;&#x7684;&#x5355;&#x5411;&#x5F15;&#x7528;&#x3002;&#x8FD9;&#x79CD;&#x7B56;&#x7565;&#x662F;&#x6709;&#x7279;&#x5B9A;&#x573A;&#x666F;&#x7684;&#xFF0C;&#x6BD4;&#x5982;&#x5728;&#x6211;&#x4EEC;&#x8FD9;&#x4E2A;&#x6848;&#x4F8B;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x8BBE;&#x8BA1;&#x7684;&#x4F5C;&#x8005;&#x4FE1;&#x606F;&#x6587;&#x6863;&#x91CC;&#xFF0C;&#x5C06;&#x4E66;&#x7C4D;&#x4FE1;&#x606F;&#x4F5C;&#x4E3A;&#x6570;&#x7EC4;&#x5B57;&#x6BB5;&#x5D4C;&#x5165;&#x4F5C;&#x8005;&#x6587;&#x6863;&#xFF0C;&#x4F46;&#x662F;&#x5B9E;&#x9645;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4E66;&#x7C4D;&#x7684;&#x6570;&#x91CF;&#x662F;&#x4F1A;&#x5FEB;&#x901F;&#x5730;&#x589E;&#x957F;&#xFF0C;&#x5F88;&#x53EF;&#x80FD;&#x4F1A;&#x7A81;&#x7834;&#x5355;&#x4E2A;&#x6587;&#x6863;16MB&#x7684;&#x9650;&#x5236;&#x3002;</p>
<p> &#x5728;&#x8FD9;&#x4E2A;&#x6848;&#x4F8B;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x4E66;&#x7C4D;&#x6570;&#x91CF;&#x662F;&#x5FEB;&#x901F;&#x589E;&#x957F;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x4E66;&#x7C4D;&#x5206;&#x7C7B;&#x786E;&#x5B9E;&#x6BD4;&#x8F83;&#x56FA;&#x5B9A;&#xFF0C;&#x901A;&#x5E38;&#x4E0D;&#x4F1A;&#x6709;&#x592A;&#x5927;&#x6539;&#x52A8;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x628A;&#x4E66;&#x7C4D;&#x5206;&#x7C7B;&#x4FE1;&#x606F;&#x5355;&#x72EC;&#x8BBE;&#x8BA1;&#x6210;&#x6587;&#x6863;&#xFF0C;&#x7136;&#x540E;&#x4F5C;&#x8005;&#x4FE1;&#x606F;&#x4F5C;&#x4E3A;&#x4E66;&#x7C4D;&#x4FE1;&#x606F;&#x7684;&#x5D4C;&#x5165;&#x6570;&#x7EC4;&#x5F15;&#x7528;&#xFF0C;&#x4E66;&#x7C4D;&#x5206;&#x7C7B;&#x4E5F;&#x4F5C;&#x4E3A;&#x5D4C;&#x5165;&#x6570;&#x7EC4;&#x5F15;&#x7528;&#x3002;&#x4EE5;&#x76F8;&#x5BF9;&#x53D8;&#x5316;&#x4E0D;&#x5927;&#x7684;&#x4E66;&#x7C4D;&#x5206;&#x7C7B;&#x4F5C;&#x4E3A;&#x4E3B;&#x8868;&#xFF0C;&#x628A;&#x76F8;&#x5BF9;&#x53D8;&#x5316;&#x8F83;&#x5927;&#x7684;&#x4E66;&#x7C4D;&#x4FE1;&#x606F;&#x4F5C;&#x4E3A;&#x4ECE;&#x8868;&#xFF0C;&#x50A8;&#x5B58;&#x4E3B;&#x8868;id&#x4F5C;&#x4E3A;&#x5916;&#x952E;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801; &#x4E66;&#x7C4D;&#x5206;&#x7C7B;&#x7684;&#x6587;&#x6863;&#x8BBE;&#x8BA1;</span><br><span class="line"> {</span><br><span class="line">  _id: 1,</span><br><span class="line">  name: &quot;drama&quot;</span><br><span class="line"> }</span><br><span class="line"></span><br><span class="line"> &#x901A;&#x8FC7;&#x5916;&#x952E;&#x5173;&#x8054;&#x5BF9;&#x5E94;&#x5206;&#x7C7B;&#x7684;&#x4E66;&#x7C4D;&#x4FE1;&#x606F;&#x6587;&#x6863;&#x8BBE;&#x8BA1;</span><br><span class="line"> {</span><br><span class="line">   _id: 1,</span><br><span class="line">   title: &quot;A tale of two people&quot;,</span><br><span class="line">   categories: [1],</span><br><span class="line">   authors: [1, 2]</span><br><span class="line"> }</span><br></pre></td></tr></table></figure>

<p> &#x76F8;&#x5BF9;&#x5E94;&#x7684;&#x67E5;&#x8BE2;&#x8BED;&#x53E5;&#x5982;&#x4E0B;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801; &#x901A;&#x8FC7;&#x6307;&#x5B9A;&#x4E66;&#x7C4D;&#x6765;&#x67E5;&#x627E;&#x5BF9;&#x5E94;&#x7684;&#x4E66;&#x7C4D;&#x5206;&#x7C7B;</span><br><span class="line"> var db = db.getSisterDB(&quot;library&quot;);</span><br><span class="line"> var booksCol = db.books;</span><br><span class="line"> var categoriesCol = db.categories;</span><br><span class="line"></span><br><span class="line"> var book = booksCol.findOne({title: &quot;A tale of two space ships&quot;});</span><br><span class="line"> var categories = categoriesCol.find({_id: {$in: book.categories}}).toArray();</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;    &#x6839;&#x636E;&#x6307;&#x5B9A;&#x4E66;&#x7C4D;&#x5206;&#x7C7B;&#x6765;&#x67E5;&#x627E;&#x5BF9;&#x5E94;&#x4E66;&#x7C4D;</span><br><span class="line">    var db = db.getSisterDB(&quot;library&quot;);</span><br><span class="line">    var booksCollection = db.books;</span><br><span class="line">    var categoriesCollection = db.categories;</span><br><span class="line"></span><br><span class="line">    var category = categoriesCollection.findOne({name: &quot;drama&quot;});</span><br><span class="line">    var books = booksCollection.find({categories: category.id}).toArray();</span><br><span class="line"></span><br><span class="line">&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x5730;&#x65B9;&#xFF1A;</span><br><span class="line"></span><br><span class="line">    &#x4FDD;&#x6301;&#x5173;&#x8054;&#x5173;&#x7CFB;&#x7684;&#x5E73;&#x8861;</span><br><span class="line">    &#x5F53;&#x591A;&#x5BF9;&#x591A;&#x5173;&#x7CFB;&#x6A21;&#x578B;&#x91CC;&#xFF0C;&#x6709;&#x4E00;&#x4E2A;&#x6A21;&#x578B;&#x6570;&#x91CF;&#x7EA7;&#x522B;&#x7279;&#x522B;&#x5927;&#xFF08;&#x6BD4;&#x5982;&#x6700;&#x591A;&#x53EF;&#x8FBE;500000&#x4E2A;&#xFF09;&#xFF0C;&#x53E6;&#x4E00;&#x4E2A;&#x6570;&#x91CF;&#x7EA7;&#x522B;&#x7279;&#x522B;&#x5C0F;&#xFF08;&#x6BD4;&#x5982;&#x6700;&#x591A;3&#x4E2A;&#xFF09;&#xFF0C;&#x50CF;&#x8FD9;&#x4E2A;&#x6848;&#x4F8B;&#x4E2D;&#xFF0C;&#x53EF;&#x80FD;&#x624D;3&#x4E2A;&#x5DE6;&#x53F3;&#x7684;&#x4E66;&#x7C4D;&#x5206;&#x7C7B;&#x5C31;&#x53EF;&#x4EE5;&#x5BF9;&#x5E94;&#x5230;&#x9AD8;&#x8FBE;500000&#x672C;&#x4E66;&#x3002;&#x5728;&#x8FD9;&#x5F20;&#x6570;&#x91CF;&#x7EA7;&#x522B;&#x60AC;&#x6B8A;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5C31;&#x5E94;&#x8BE5;&#x91C7;&#x7528;&#x8FD9;&#x79CD;&#x5355;&#x5411;&#x5D4C;&#x5957;&#x7684;&#x7B56;&#x7565;&#x3002;&#x5982;&#x679C;&#x53CC;&#x65B9;&#x4E66;&#x7C4D;&#x7EA7;&#x522B;&#x90FD;&#x6BD4;&#x8F83;&#x5C0F;&#xFF08;&#x53EF;&#x80FD;&#x6700;&#x591A;&#x4E5F;&#x5C31;&#x662F;5&#x4E2A;&#x5DE6;&#x53F3;&#xFF09;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x91C7;&#x7528;&#x53CC;&#x5411;&#x5D4C;&#x5957;&#x7684;&#x7B56;&#x7565;&#x53EF;&#x80FD;&#x4F1A;&#x597D;&#x4E00;&#x70B9;&#x3002;</span><br></pre></td></tr></table></figure>

<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/8b28571551981fc8726f107d22d15293.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903511864410119.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903511864410119.html" itemprop="url">聊聊jesque的event机制</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-20T14:13:22+08:00">
                2017-11-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="&#x5E8F;"><a href="#&#x5E8F;" class="headerlink" title="&#x5E8F;"></a>&#x5E8F;</h2><p>&#x672C;&#x6587;&#x4E3B;&#x8981;&#x4ECB;&#x7ECD;&#x4E00;&#x4E0B;jesque&#x7684;event&#x673A;&#x5236;</p>
<h2 id="WorkerEvent"><a href="#WorkerEvent" class="headerlink" title="WorkerEvent"></a>WorkerEvent</h2><p>jesque-2.1.2-sources.jar!/net/greghaines/jesque/worker/WorkerEvent.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;/**</span><br><span class="line"> * The possible WorkerEvents that a WorkerListener may register for.</span><br><span class="line"> */</span><br><span class="line">public enum WorkerEvent {</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * The Worker just finished starting up and is about to start running.</span><br><span class="line">     */</span><br><span class="line">    WORKER_START,</span><br><span class="line">    /**</span><br><span class="line">     * The Worker is polling the queue.</span><br><span class="line">     */</span><br><span class="line">    WORKER_POLL,</span><br><span class="line">    /**</span><br><span class="line">     * The Worker is processing a Job.</span><br><span class="line">     */</span><br><span class="line">    JOB_PROCESS,</span><br><span class="line">    /**</span><br><span class="line">     * The Worker is about to execute a materialized Job.</span><br><span class="line">     */</span><br><span class="line">    JOB_EXECUTE,</span><br><span class="line">    /**</span><br><span class="line">     * The Worker successfully executed a materialized Job.</span><br><span class="line">     */</span><br><span class="line">    JOB_SUCCESS,</span><br><span class="line">    /**</span><br><span class="line">     * The Worker caught an Exception during the execution of a materialized Job.</span><br><span class="line">     */</span><br><span class="line">    JOB_FAILURE,</span><br><span class="line">    /**</span><br><span class="line">     * The Worker caught an Exception during normal operation.</span><br><span class="line">     */</span><br><span class="line">    WORKER_ERROR,</span><br><span class="line">    /**</span><br><span class="line">     * The Worker just finished running and is about to shutdown.</span><br><span class="line">     */</span><br><span class="line">    WORKER_STOP;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<blockquote>
<p>JOB_PROCESS&#x4E0E;JOB_EXECUTE&#x53EF;&#x80FD;&#x8BA9;&#x4EBA;&#x6709;&#x70B9;&#x8FF7;&#x7CCA;&#x3002;&#x4E8C;&#x8005;&#x4E4B;&#x95F4;&#x6709;&#x4E2A;&#x53BB;redis&#x66F4;&#x65B0;&#x72B6;&#x6001;&#x4EE5;&#x53CA;&#x5B9E;&#x4F8B;&#x5316;job&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x800C;JOB_EXECUTE&#x5219;&#x662F;before execute&#x7684;&#x610F;&#x601D;<br>JOB_SUCCESS&#x4EE5;&#x53CA;JOB_FAILURE&#x5219;&#x662F;after execute&#x7684;&#x610F;&#x601D;</p>
</blockquote>
<h2 id="WorkerEventEmitter"><a href="#WorkerEventEmitter" class="headerlink" title="WorkerEventEmitter"></a>WorkerEventEmitter</h2><p>jesque-2.1.2-sources.jar!/net/greghaines/jesque/worker/WorkerEventEmitter.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;/**</span><br><span class="line"> * A WorkerEventEmitter allows WorkerListeners to register for WorkerEvents.</span><br><span class="line"> */</span><br><span class="line">public interface WorkerEventEmitter {</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Register a WorkerListener for all WorkerEvents. </span><br><span class="line">     * @param listener the WorkerListener to register</span><br><span class="line">     */</span><br><span class="line">    void addListener(WorkerListener listener);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Register a WorkerListener for the specified WorkerEvents.</span><br><span class="line">     * @param listener the WorkerListener to register</span><br><span class="line">     * @param events the WorkerEvents to be notified of</span><br><span class="line">     */</span><br><span class="line">    void addListener(WorkerListener listener, WorkerEvent... events);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Unregister a WorkerListener for all WorkerEvents.</span><br><span class="line">     * @param listener the WorkerListener to unregister</span><br><span class="line">     */</span><br><span class="line">    void removeListener(WorkerListener listener);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Unregister a WorkerListener for the specified WorkerEvents.</span><br><span class="line">     * @param listener the WorkerListener to unregister</span><br><span class="line">     * @param events the WorkerEvents to no longer be notified of</span><br><span class="line">     */</span><br><span class="line">    void removeListener(WorkerListener listener, WorkerEvent... events);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Unregister all WorkerListeners for all WorkerEvents.</span><br><span class="line">     */</span><br><span class="line">    void removeAllListeners();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Unregister all WorkerListeners for the specified WorkerEvents.</span><br><span class="line">     * @param events the WorkerEvents to no longer be notified of</span><br><span class="line">     */</span><br><span class="line">    void removeAllListeners(WorkerEvent... events);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&#x5B9A;&#x4E49;&#x4E86;event emitter&#x7684;&#x63A5;&#x53E3;</p>
</blockquote>
<h2 id="WorkerListenerDelegate"><a href="#WorkerListenerDelegate" class="headerlink" title="WorkerListenerDelegate"></a>WorkerListenerDelegate</h2><p>jesque-2.1.0-sources.jar!/net/greghaines/jesque/worker/WorkerListenerDelegate.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;/**</span><br><span class="line"> * WorkerListenerDelegate keeps track of WorkerListeners and notifies each listener when fireEvent() is invoked.</span><br><span class="line"> */</span><br><span class="line">public class WorkerListenerDelegate implements WorkerEventEmitter {</span><br><span class="line"></span><br><span class="line">    private static final Logger log = LoggerFactory.getLogger(WorkerListenerDelegate.class);</span><br><span class="line"></span><br><span class="line">    private final Map&lt;WorkerEvent, ConcurrentSet&lt;WorkerListener&gt;&gt; eventListenerMap;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Constructor.</span><br><span class="line">     */</span><br><span class="line">    public WorkerListenerDelegate() {</span><br><span class="line">        final Map&lt;WorkerEvent, ConcurrentSet&lt;WorkerListener&gt;&gt; elp = </span><br><span class="line">                new EnumMap&lt;WorkerEvent, ConcurrentSet&lt;WorkerListener&gt;&gt;(WorkerEvent.class);</span><br><span class="line">        for (final WorkerEvent event : WorkerEvent.values()) {</span><br><span class="line">            elp.put(event, new ConcurrentHashSet&lt;WorkerListener&gt;());</span><br><span class="line">        }</span><br><span class="line">        this.eventListenerMap = Collections.unmodifiableMap(elp);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * {@inheritDoc}</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public void addListener(final WorkerListener listener) {</span><br><span class="line">        addListener(listener, WorkerEvent.values());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * {@inheritDoc}</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public void addListener(final WorkerListener listener, final WorkerEvent... events) {</span><br><span class="line">        if (listener != null) {</span><br><span class="line">            for (final WorkerEvent event : events) {</span><br><span class="line">                final ConcurrentSet&lt;WorkerListener&gt; listeners = this.eventListenerMap.get(event);</span><br><span class="line">                if (listeners != null) {</span><br><span class="line">                    listeners.add(listener);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * {@inheritDoc}</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public void removeListener(final WorkerListener listener) {</span><br><span class="line">        removeListener(listener, WorkerEvent.values());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * {@inheritDoc}</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public void removeListener(final WorkerListener listener, final WorkerEvent... events) {</span><br><span class="line">        if (listener != null) {</span><br><span class="line">            for (final WorkerEvent event : events) {</span><br><span class="line">                final ConcurrentSet&lt;WorkerListener&gt; listeners = this.eventListenerMap.get(event);</span><br><span class="line">                if (listeners != null) {</span><br><span class="line">                    listeners.remove(listener);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * {@inheritDoc}</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public void removeAllListeners() {</span><br><span class="line">        removeAllListeners(WorkerEvent.values());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * {@inheritDoc}</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public void removeAllListeners(final WorkerEvent... events) {</span><br><span class="line">        for (final WorkerEvent event : events) {</span><br><span class="line">            final ConcurrentSet&lt;WorkerListener&gt; listeners = this.eventListenerMap.get(event);</span><br><span class="line">            if (listeners != null) {</span><br><span class="line">                listeners.clear();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Notify all WorkerListeners currently registered for the given WorkerEvent.</span><br><span class="line">     * @param event the WorkerEvent that occurred</span><br><span class="line">     * @param worker the Worker that the event occurred in</span><br><span class="line">     * @param queue the queue the Worker is processing</span><br><span class="line">     * @param job the Job related to the event (only supply for JOB_PROCESS, JOB_EXECUTE, JOB_SUCCESS, and </span><br><span class="line">     * JOB_FAILURE events)</span><br><span class="line">     * @param runner the materialized object that the Job specified (only supply for JOB_EXECUTE and </span><br><span class="line">     * JOB_SUCCESS events)</span><br><span class="line">     * @param result the result of the successful execution of the Job (only set for JOB_SUCCESS and if the Job was </span><br><span class="line">     * a Callable that returned a value)</span><br><span class="line">     * @param t the Throwable that caused the event (only supply for JOB_FAILURE and ERROR events)</span><br><span class="line">     */</span><br><span class="line">    public void fireEvent(final WorkerEvent event, final Worker worker, final String queue, final Job job, </span><br><span class="line">            final Object runner, final Object result, final Throwable t) {</span><br><span class="line">        final ConcurrentSet&lt;WorkerListener&gt; listeners = this.eventListenerMap.get(event);</span><br><span class="line">        if (listeners != null) {</span><br><span class="line">            for (final WorkerListener listener : listeners) {</span><br><span class="line">                if (listener != null) {</span><br><span class="line">                    try {</span><br><span class="line">                        listener.onEvent(event, worker, queue, job, runner, result, t);</span><br><span class="line">                    } catch (Exception e) {</span><br><span class="line">                        log.error(&quot;Failure executing listener &quot; + listener + &quot; for event &quot; + event </span><br><span class="line">                                + &quot; from queue &quot; + queue + &quot; on worker &quot; + worker, e);</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<blockquote>
<p>event emitter&#x7684;&#x5B9E;&#x73B0;&#x7C7B;&#xFF0C;&#x4F7F;&#x7528;EnumMap&#x6765;&#x5B58;&#x653E;listener&#xFF0C;key&#x662F;WorkerEvent&#x679A;&#x4E3E;&#xFF0C;&#x800C;value&#x5219;&#x662F;listener&#x7684;ConcurrentSet&#xFF0C;&#x5373;&#x540C;&#x4E00;&#x4E2A;event&#x53EF;&#x4EE5;&#x6709;&#x591A;&#x4E2A;listener&#x3002;</p>
</blockquote>
<h2 id="&#x4E8B;&#x4EF6;&#x7684;&#x89E6;&#x53D1;"><a href="#&#x4E8B;&#x4EF6;&#x7684;&#x89E6;&#x53D1;" class="headerlink" title="&#x4E8B;&#x4EF6;&#x7684;&#x89E6;&#x53D1;"></a>&#x4E8B;&#x4EF6;&#x7684;&#x89E6;&#x53D1;</h2><p>jesque-2.1.2-sources.jar!/net/greghaines/jesque/worker/WorkerImpl.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;protected final WorkerListenerDelegate listenerDelegate = new WorkerListenerDelegate();</span><br><span class="line"></span><br><span class="line">//......</span><br><span class="line">protected void process(final Job job, final String curQueue) {</span><br><span class="line">        try {</span><br><span class="line">            this.processingJob.set(true);</span><br><span class="line">            if (threadNameChangingEnabled) {</span><br><span class="line">                renameThread(&quot;Processing &quot; + curQueue + &quot; since &quot; + System.currentTimeMillis());</span><br><span class="line">            }</span><br><span class="line">            this.listenerDelegate.fireEvent(JOB_PROCESS, this, curQueue, job, null, null, null);</span><br><span class="line">            this.jedis.set(key(WORKER, this.name), statusMsg(curQueue, job));</span><br><span class="line">            final Object instance = this.jobFactory.materializeJob(job);</span><br><span class="line">            final Object result = execute(job, curQueue, instance);</span><br><span class="line">            success(job, instance, result, curQueue);</span><br><span class="line">        } catch (Throwable thrwbl) {</span><br><span class="line">            failure(thrwbl, job, curQueue);</span><br><span class="line">        } finally {</span><br><span class="line">            removeInFlight(curQueue);</span><br><span class="line">            this.jedis.del(key(WORKER, this.name));</span><br><span class="line">            this.processingJob.set(false);</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&#x5728;wokerImpl&#x7C7B;&#x91CC;&#x5934;&#xFF0C;&#x7EC4;&#x5408;&#x4E86;WorkerEventEmitter&#x7684;&#x5B9E;&#x73B0;&#x7C7B;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x76F8;&#x5E94;&#x7684;&#x65B9;&#x6CD5;&#x91CC;&#x5934;&#x53BB;&#x89E6;&#x53D1;/&#x901A;&#x77E5;&#x76F8;&#x5E94;&#x7684;listener(<code>&#x9ED8;&#x8BA4;&#x662F;&#x540C;&#x6B65;&#x6267;&#x884C;</code>)</p>
</blockquote>
<h2 id="&#x5C0F;&#x7ED3;"><a href="#&#x5C0F;&#x7ED3;" class="headerlink" title="&#x5C0F;&#x7ED3;"></a>&#x5C0F;&#x7ED3;</h2><p>&#x5176;&#x5B9E;&#x672C;&#x8D28;&#x5C31;&#x662F;&#x89C2;&#x5BDF;&#x8005;&#x6A21;&#x5F0F;&#xFF0C;workerImpl&#x662F;&#x88AB;&#x89C2;&#x5BDF;&#x8005;&#xFF0C;listener&#x662F;&#x89C2;&#x5BDF;&#x8005;&#xFF0C;wokerImpl&#x5728;&#x6709;&#x76F8;&#x5E94;&#x6267;&#x884C;&#x70B9;&#x4F1A;&#x89E6;&#x53D1;&#x76F8;&#x5E94;&#x4E8B;&#x4EF6;&#xFF0C;&#x540C;&#x6B65;&#x901A;&#x77E5;listner&#x6267;&#x884C;&#x76F8;&#x5173;&#x903B;&#x8F91;&#x3002;</p>
<h2 id="doc"><a href="#doc" class="headerlink" title="doc"></a>doc</h2><ul>
<li><a href="/external_links/d4b7b08576e96ed2af3ab0ebc82ff696.html" target="blank" rel="noopener">jesque</a></li>
</ul>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/8683a9b37bad02246cc141ad3547b9fe.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903511948263432.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903511948263432.html" itemprop="url">Dapper，大规模分布式系统的跟踪系统</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-20T14:12:20+08:00">
                2017-11-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="&#x6982;&#x8FF0;"><a href="#&#x6982;&#x8FF0;" class="headerlink" title="&#x6982;&#x8FF0;"></a>&#x6982;&#x8FF0;</h3><p>&#x5F53;&#x4EE3;&#x7684;&#x4E92;&#x8054;&#x7F51;&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x901A;&#x5E38;&#x90FD;&#x662F;&#x7528;&#x590D;&#x6742;&#x7684;&#x3001;&#x5927;&#x89C4;&#x6A21;&#x5206;&#x5E03;&#x5F0F;&#x96C6;&#x7FA4;&#x6765;&#x5B9E;&#x73B0;&#x7684;&#x3002;&#x4E92;&#x8054;&#x7F51;&#x5E94;&#x7528;&#x6784;&#x5EFA;&#x5728;&#x4E0D;&#x540C;&#x7684;&#x8F6F;&#x4EF6;&#x6A21;&#x5757;&#x96C6;&#x4E0A;&#xFF0C;&#x8FD9;&#x4E9B;&#x8F6F;&#x4EF6;&#x6A21;&#x5757;&#xFF0C;&#x6709;&#x53EF;&#x80FD;&#x662F;&#x7531;&#x4E0D;&#x540C;&#x7684;&#x56E2;&#x961F;&#x5F00;&#x53D1;&#x3001;&#x53EF;&#x80FD;&#x4F7F;&#x7528;&#x4E0D;&#x540C;&#x7684;&#x7F16;&#x7A0B;&#x8BED;&#x8A00;&#x6765;&#x5B9E;&#x73B0;&#x3001;&#x6709;&#x53EF;&#x80FD;&#x5E03;&#x5728;&#x4E86;&#x51E0;&#x5343;&#x53F0;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x6A2A;&#x8DE8;&#x591A;&#x4E2A;&#x4E0D;&#x540C;&#x7684;&#x6570;&#x636E;&#x4E2D;&#x5FC3;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5C31;&#x9700;&#x8981;&#x4E00;&#x4E9B;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x7406;&#x89E3;&#x7CFB;&#x7EDF;&#x884C;&#x4E3A;&#x3001;&#x7528;&#x4E8E;&#x5206;&#x6790;&#x6027;&#x80FD;&#x95EE;&#x9898;&#x7684;&#x5DE5;&#x5177;&#x3002;</p>
<p>Dapper&#x2013;Google&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E0B;&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x8DDF;&#x8E2A;&#x7CFB;&#x7EDF;&#xFF0C;&#x5E94;&#x8FD0;&#x800C;&#x751F;&#x3002;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x5C31;&#x6765;&#x4ECB;&#x7ECD;&#x4E00;&#x4E2A;&#x5927;&#x89C4;&#x6A21;&#x96C6;&#x7FA4;&#x7684;&#x8DDF;&#x8E2A;&#x7CFB;&#x7EDF;&#xFF0C;&#x5B83;&#x662F;&#x5982;&#x4F55;&#x6EE1;&#x8DB3;&#x4E00;&#x4E2A;&#x4F4E;&#x635F;&#x8017;&#x3001;&#x5E94;&#x7528;&#x900F;&#x660E;&#x7684;&#x3001;&#x5927;&#x8303;&#x56F4;&#x90E8;&#x7F72;&#x8FD9;&#x4E09;&#x4E2A;&#x9700;&#x6C42;&#x7684;&#x3002;&#x5F53;&#x7136;Dapper&#x8BBE;&#x8BA1;&#x4E4B;&#x521D;&#xFF0C;&#x53C2;&#x8003;&#x4E86;&#x4E00;&#x4E9B;&#x5176;&#x4ED6;&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#x7684;&#x7406;&#x5FF5;&#xFF0C;&#x5C24;&#x5176;&#x662F;Magpie&#x548C;X-Trace&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x4E4B;&#x6240;&#x4EE5;&#x80FD;&#x6210;&#x529F;&#x5E94;&#x7528;&#x5728;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E0A;&#xFF0C;&#x8FD8;&#x9700;&#x8981;&#x4E00;&#x4E9B;&#x753B;&#x9F99;&#x70B9;&#x775B;&#x4E4B;&#x7B14;&#xFF0C;&#x4F8B;&#x5982;&#x91C7;&#x6837;&#x7387;&#x7684;&#x4F7F;&#x7528;&#x4EE5;&#x53CA;&#x628A;&#x4EE3;&#x7801;&#x690D;&#x5165;&#x9650;&#x5236;&#x5728;&#x4E00;&#x5C0F;&#x90E8;&#x5206;&#x516C;&#x5171;&#x5E93;&#x7684;&#x6539;&#x9020;&#x4E0A;&#x3002;</p>
<p>&#x81EA;&#x4ECE;Dapper&#x53D1;&#x5C55;&#x6210;&#x4E3A;&#x4E00;&#x6D41;&#x7684;&#x76D1;&#x63A7;&#x7CFB;&#x7EDF;&#x4E4B;&#x540E;&#xFF0C;&#x7ED9;&#x5176;&#x4ED6;&#x5E94;&#x7528;&#x7684;&#x5F00;&#x53D1;&#x8005;&#x548C;&#x8FD0;&#x7EF4;&#x56E2;&#x961F;&#x5E2E;&#x4E86;&#x5927;&#x5FD9;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x4ECA;&#x5929;&#x624D;&#x53D1;&#x8868;&#x8FD9;&#x7BC7;&#x8BBA;&#x6587;&#xFF0C;&#x6765;&#x6C47;&#x62A5;&#x4E00;&#x4E0B;&#x8FD9;&#x4E24;&#x5E74;&#x6765;&#xFF0C;Dapper&#x662F;&#x600E;&#x4E48;&#x6784;&#x5EFA;&#x548C;&#x90E8;&#x7F72;&#x7684;&#x3002;Dapper&#x6700;&#x521D;&#x53EA;&#x662F;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x81EA;&#x7ED9;&#x81EA;&#x8DB3;&#x7684;&#x76D1;&#x63A7;&#x5DE5;&#x5177;&#x8D77;&#x6B65;&#x7684;&#xFF0C;&#x4F46;&#x6700;&#x7EC8;&#x8FDB;&#x5316;&#x6210;&#x4E00;&#x4E2A;&#x76D1;&#x63A7;&#x5E73;&#x53F0;&#xFF0C;&#x8FD9;&#x4E2A;&#x76D1;&#x63A7;&#x5E73;&#x53F0;&#x4FC3;&#x751F;&#x51FA;&#x591A;&#x79CD;&#x591A;&#x6837;&#x7684;&#x76D1;&#x63A7;&#x5DE5;&#x5177;&#xFF0C;&#x6709;&#x4E9B;&#x751A;&#x81F3;&#x5DF2;&#x7ECF;&#x4E0D;&#x662F;&#x7531;Dapper&#x56E2;&#x961F;&#x5F00;&#x53D1;&#x7684;&#x4E86;&#x3002;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x4F1A;&#x4ECB;&#x7ECD;&#x4E00;&#x4E9B;&#x4F7F;&#x7528;Dapper&#x642D;&#x5EFA;&#x7684;&#x5206;&#x6790;&#x5DE5;&#x5177;&#xFF0C;&#x5206;&#x4EAB;&#x4E00;&#x4E0B;&#x8FD9;&#x4E9B;&#x5DE5;&#x5177;&#x5728;google&#x5185;&#x90E8;&#x4F7F;&#x7528;&#x7684;&#x7EDF;&#x8BA1;&#x6570;&#x636E;&#xFF0C;&#x5C55;&#x73B0;&#x4E00;&#x4E9B;&#x4F7F;&#x7528;&#x573A;&#x666F;&#xFF0C;&#x6700;&#x540E;&#x4F1A;&#x8BA8;&#x8BBA;&#x4E00;&#x4E0B;&#x6211;&#x4EEC;&#x8FC4;&#x4ECA;&#x4E3A;&#x6B62;&#x4ECE;Dapper&#x6536;&#x83B7;&#x4E86;&#x4E9B;&#x4EC0;&#x4E48;&#x3002;</p>
<h3 id="1-&#x4ECB;&#x7ECD;"><a href="#1-&#x4ECB;&#x7ECD;" class="headerlink" title="1. &#x4ECB;&#x7ECD;"></a>1. &#x4ECB;&#x7ECD;</h3><p>&#x6211;&#x4EEC;&#x5F00;&#x53D1;Dapper&#x662F;&#x4E3A;&#x4E86;&#x6536;&#x96C6;&#x66F4;&#x591A;&#x7684;&#x590D;&#x6742;&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#x7684;&#x884C;&#x4E3A;&#x4FE1;&#x606F;&#xFF0C;&#x7136;&#x540E;&#x5448;&#x73B0;&#x7ED9;Google&#x7684;&#x5F00;&#x53D1;&#x8005;&#x4EEC;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#x6709;&#x4E00;&#x4E2A;&#x7279;&#x6B8A;&#x7684;&#x597D;&#x5904;&#xFF0C;&#x56E0;&#x4E3A;&#x90A3;&#x4E9B;&#x5927;&#x89C4;&#x6A21;&#x7684;&#x4F4E;&#x7AEF;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x4F5C;&#x4E3A;&#x4E92;&#x8054;&#x7F51;&#x670D;&#x52A1;&#x7684;&#x8F7D;&#x4F53;&#xFF0C;&#x662F;&#x4E00;&#x4E2A;&#x7279;&#x6B8A;&#x7684;&#x7ECF;&#x6D4E;&#x5212;&#x7B97;&#x7684;&#x5E73;&#x53F0;&#x3002;&#x60F3;&#x8981;&#x5728;&#x8FD9;&#x4E2A;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x7406;&#x89E3;&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#x7684;&#x884C;&#x4E3A;&#xFF0C;&#x5C31;&#x9700;&#x8981;&#x76D1;&#x63A7;&#x90A3;&#x4E9B;&#x6A2A;&#x8DE8;&#x4E86;&#x4E0D;&#x540C;&#x7684;&#x5E94;&#x7528;&#x3001;&#x4E0D;&#x540C;&#x7684;&#x670D;&#x52A1;&#x5668;&#x4E4B;&#x95F4;&#x7684;&#x5173;&#x8054;&#x52A8;&#x4F5C;&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x4E3E;&#x4E00;&#x4E2A;&#x8DDF;&#x641C;&#x7D22;&#x76F8;&#x5173;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x9610;&#x8FF0;&#x4E86;Dapper&#x53EF;&#x4EE5;&#x5E94;&#x5BF9;&#x54EA;&#x4E9B;&#x6311;&#x6218;&#x3002;&#x6BD4;&#x5982;&#x4E00;&#x4E2A;&#x524D;&#x6BB5;&#x670D;&#x52A1;&#x53EF;&#x80FD;&#x5BF9;&#x4E0A;&#x767E;&#x53F0;&#x67E5;&#x8BE2;&#x670D;&#x52A1;&#x5668;&#x53D1;&#x8D77;&#x4E86;&#x4E00;&#x4E2A;Web&#x67E5;&#x8BE2;&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A;&#x67E5;&#x8BE2;&#x90FD;&#x6709;&#x81EA;&#x5DF1;&#x7684;Index&#x3002;&#x8FD9;&#x4E2A;&#x67E5;&#x8BE2;&#x53EF;&#x80FD;&#x4F1A;&#x88AB;&#x53D1;&#x9001;&#x5230;&#x591A;&#x4E2A;&#x7684;&#x5B50;&#x7CFB;&#x7EDF;&#xFF0C;&#x8FD9;&#x4E9B;&#x5B50;&#x7CFB;&#x7EDF;&#x5206;&#x522B;&#x7528;&#x6765;&#x5904;&#x7406;&#x5E7F;&#x544A;&#x3001;&#x8FDB;&#x884C;&#x62FC;&#x5199;&#x68C0;&#x67E5;&#x6216;&#x662F;&#x67E5;&#x627E;&#x4E00;&#x4E9B;&#x50CF;&#x56FE;&#x7247;&#x3001;&#x89C6;&#x9891;&#x6216;&#x65B0;&#x95FB;&#x8FD9;&#x6837;&#x7684;&#x7279;&#x6B8A;&#x7ED3;&#x679C;&#x3002;&#x6839;&#x636E;&#x6BCF;&#x4E2A;&#x5B50;&#x7CFB;&#x7EDF;&#x7684;&#x67E5;&#x8BE2;&#x7ED3;&#x679C;&#x8FDB;&#x884C;&#x7B5B;&#x9009;&#xFF0C;&#x5F97;&#x5230;&#x6700;&#x7EC8;&#x7ED3;&#x679C;&#xFF0C;&#x6700;&#x540E;&#x6C47;&#x603B;&#x5230;&#x9875;&#x9762;&#x4E0A;&#x3002;&#x6211;&#x4EEC;&#x628A;&#x8FD9;&#x79CD;&#x641C;&#x7D22;&#x6A21;&#x578B;&#x79F0;&#x4E3A;&#x201C;&#x5168;&#x5C40;&#x641C;&#x7D22;&#x201D;&#xFF08;universal search&#xFF09;&#x3002;&#x603B;&#x7684;&#x6765;&#x8BF4;&#xFF0C;&#x8FD9;&#x4E00;&#x6B21;&#x5168;&#x5C40;&#x641C;&#x7D22;&#x6709;&#x53EF;&#x80FD;&#x8C03;&#x7528;&#x4E0A;&#x5343;&#x53F0;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x6D89;&#x53CA;&#x5404;&#x79CD;&#x670D;&#x52A1;&#x3002;&#x800C;&#x4E14;&#xFF0C;&#x7528;&#x6237;&#x5BF9;&#x641C;&#x7D22;&#x7684;&#x8017;&#x65F6;&#x662F;&#x5F88;&#x654F;&#x611F;&#x7684;&#xFF0C;&#x800C;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x5B50;&#x7CFB;&#x7EDF;&#x7684;&#x4F4E;&#x6548;&#x90FD;&#x5BFC;&#x81F4;&#x5BFC;&#x81F4;&#x6700;&#x7EC8;&#x7684;&#x641C;&#x7D22;&#x8017;&#x65F6;&#x3002;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x5DE5;&#x7A0B;&#x5E08;&#x53EA;&#x80FD;&#x77E5;&#x9053;&#x8FD9;&#x4E2A;&#x67E5;&#x8BE2;&#x8017;&#x65F6;&#x4E0D;&#x6B63;&#x5E38;&#xFF0C;&#x4F46;&#x662F;&#x4ED6;&#x65E0;&#x4ECE;&#x77E5;&#x6653;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x5230;&#x5E95;&#x662F;&#x7531;&#x54EA;&#x4E2A;&#x670D;&#x52A1;&#x8C03;&#x7528;&#x9020;&#x6210;&#x7684;&#xFF0C;&#x6216;&#x8005;&#x4E3A;&#x4EC0;&#x4E48;&#x8FD9;&#x4E2A;&#x8C03;&#x7528;&#x6027;&#x80FD;&#x5DEE;&#x5F3A;&#x4EBA;&#x610F;&#x3002;&#x9996;&#x5148;&#xFF0C;&#x8FD9;&#x4E2A;&#x5DE5;&#x7A0B;&#x5E08;&#x53EF;&#x80FD;&#x65E0;&#x6CD5;&#x51C6;&#x786E;&#x7684;&#x5B9A;&#x4F4D;&#x5230;&#x8FD9;&#x6B21;&#x5168;&#x5C40;&#x641C;&#x7D22;&#x662F;&#x8C03;&#x7528;&#x4E86;&#x54EA;&#x4E9B;&#x670D;&#x52A1;&#xFF0C;&#x56E0;&#x4E3A;&#x65B0;&#x7684;&#x670D;&#x52A1;&#x3001;&#x4E43;&#x81F3;&#x670D;&#x52A1;&#x4E0A;&#x7684;&#x67D0;&#x4E2A;&#x7247;&#x6BB5;&#xFF0C;&#x90FD;&#x6709;&#x53EF;&#x80FD;&#x5728;&#x4EFB;&#x4F55;&#x65F6;&#x95F4;&#x4E0A;&#x8FC7;&#x7EBF;&#x6216;&#x4FEE;&#x6539;&#x8FC7;&#xFF0C;&#x6709;&#x53EF;&#x80FD;&#x662F;&#x9762;&#x5411;&#x7528;&#x6237;&#x529F;&#x80FD;&#xFF0C;&#x4E5F;&#x6709;&#x53EF;&#x80FD;&#x662F;&#x4E00;&#x4E9B;&#x4F8B;&#x5982;&#x9488;&#x5BF9;&#x6027;&#x80FD;&#x6216;&#x5B89;&#x5168;&#x8BA4;&#x8BC1;&#x65B9;&#x9762;&#x7684;&#x529F;&#x80FD;&#x6539;&#x8FDB;&#x3002;&#x5176;&#x6B21;&#xFF0C;&#x4F60;&#x4E0D;&#x80FD;&#x82DB;&#x6C42;&#x8FD9;&#x4E2A;&#x5DE5;&#x7A0B;&#x5E08;&#x5BF9;&#x6240;&#x6709;&#x53C2;&#x4E0E;&#x8FD9;&#x6B21;&#x5168;&#x5C40;&#x641C;&#x7D22;&#x7684;&#x670D;&#x52A1;&#x90FD;&#x4E86;&#x5982;&#x6307;&#x638C;&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x90FD;&#x6709;&#x53EF;&#x80FD;&#x662F;&#x7531;&#x4E0D;&#x540C;&#x7684;&#x56E2;&#x961F;&#x5F00;&#x53D1;&#x6216;&#x7EF4;&#x62A4;&#x7684;&#x3002;&#x518D;&#x6B21;&#xFF0C;&#x8FD9;&#x4E9B;&#x66B4;&#x9732;&#x51FA;&#x6765;&#x7684;&#x670D;&#x52A1;&#x6216;&#x670D;&#x52A1;&#x5668;&#x6709;&#x53EF;&#x80FD;&#x540C;&#x65F6;&#x8FD8;&#x88AB;&#x5176;&#x4ED6;&#x5BA2;&#x6237;&#x7AEF;&#x4F7F;&#x7528;&#x7740;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x6B21;&#x5168;&#x5C40;&#x641C;&#x7D22;&#x7684;&#x6027;&#x80FD;&#x95EE;&#x9898;&#x751A;&#x81F3;&#x6709;&#x53EF;&#x80FD;&#x662F;&#x7531;&#x5176;&#x4ED6;&#x5E94;&#x7528;&#x9020;&#x6210;&#x7684;&#x3002;&#x4E3E;&#x4E2A;&#x4F8B;&#x5B50;&#xFF0C;&#x4E00;&#x4E2A;&#x540E;&#x53F0;&#x670D;&#x52A1;&#x53EF;&#x80FD;&#x8981;&#x5E94;&#x4ED8;&#x5404;&#x79CD;&#x5404;&#x6837;&#x7684;&#x8BF7;&#x6C42;&#x7C7B;&#x578B;&#xFF0C;&#x800C;&#x4E00;&#x4E2A;&#x4F7F;&#x7528;&#x6548;&#x7387;&#x5F88;&#x9AD8;&#x7684;&#x5B58;&#x50A8;&#x7CFB;&#x7EDF;&#xFF0C;&#x6BD4;&#x5982;Bigtable&#xFF0C;&#x6709;&#x53EF;&#x80FD;&#x6B63;&#x88AB;&#x53CD;&#x590D;&#x8BFB;&#x5199;&#x7740;&#xFF0C;&#x56E0;&#x4E3A;&#x4E0A;&#x9762;&#x8DD1;&#x7740;&#x5404;&#x79CD;&#x5404;&#x6837;&#x7684;&#x5E94;&#x7528;&#x3002;</p>
<p>&#x4E0A;&#x9762;&#x8FD9;&#x4E2A;&#x6848;&#x4F8B;&#x4E2D;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x5BF9;Dapper&#x6211;&#x4EEC;&#x53EA;&#x6709;&#x4E24;&#x70B9;&#x8981;&#x6C42;&#xFF1A;&#x65E0;&#x6240;&#x4E0D;&#x5728;&#x7684;&#x90E8;&#x7F72;&#xFF0C;&#x6301;&#x7EED;&#x7684;&#x76D1;&#x63A7;&#x3002;&#x65E0;&#x6240;&#x4E0D;&#x5728;&#x7684;&#x91CD;&#x8981;&#x6027;&#x4E0D;&#x8A00;&#x800C;&#x55BB;&#xFF0C;&#x56E0;&#x4E3A;&#x5728;&#x4F7F;&#x7528;&#x8DDF;&#x8E2A;&#x7CFB;&#x7EDF;&#x7684;&#x8FDB;&#x884C;&#x76D1;&#x63A7;&#x65F6;&#xFF0C;&#x5373;&#x4FBF;&#x53EA;&#x6709;&#x4E00;&#x5C0F;&#x90E8;&#x5206;&#x6CA1;&#x88AB;&#x76D1;&#x63A7;&#x5230;&#xFF0C;&#x90A3;&#x4E48;&#x4EBA;&#x4EEC;&#x5BF9;&#x8FD9;&#x4E2A;&#x7CFB;&#x7EDF;&#x662F;&#x4E0D;&#x662F;&#x503C;&#x5F97;&#x4FE1;&#x4EFB;&#x90FD;&#x4F1A;&#x4EA7;&#x751F;&#x5DE8;&#x5927;&#x7684;&#x8D28;&#x7591;&#x3002;&#x53E6;&#x5916;&#xFF0C;&#x76D1;&#x63A7;&#x5E94;&#x8BE5;&#x662F;7x24&#x5C0F;&#x65F6;&#x7684;&#xFF0C;&#x6BD5;&#x7ADF;&#xFF0C;&#x7CFB;&#x7EDF;&#x5F02;&#x5E38;&#x6216;&#x662F;&#x90A3;&#x4E9B;&#x91CD;&#x8981;&#x7684;&#x7CFB;&#x7EDF;&#x884C;&#x4E3A;&#x6709;&#x53EF;&#x80FD;&#x51FA;&#x73B0;&#x8FC7;&#x4E00;&#x6B21;&#xFF0C;&#x5C31;&#x5F88;&#x96BE;&#x751A;&#x81F3;&#x4E0D;&#x592A;&#x53EF;&#x80FD;&#x91CD;&#x73B0;&#x3002;&#x90A3;&#x4E48;&#xFF0C;&#x6839;&#x636E;&#x8FD9;&#x4E24;&#x4E2A;&#x660E;&#x786E;&#x7684;&#x9700;&#x6C42;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x63A8;&#x51FA;&#x4E09;&#x4E2A;&#x5177;&#x4F53;&#x7684;&#x8BBE;&#x8BA1;&#x76EE;&#x6807;&#xFF1A;</p>
<p>1.&#x4F4E;&#x6D88;&#x8017;&#xFF1A;&#x8DDF;&#x8E2A;&#x7CFB;&#x7EDF;&#x5BF9;&#x5728;&#x7EBF;&#x670D;&#x52A1;&#x7684;&#x5F71;&#x54CD;&#x5E94;&#x8BE5;&#x505A;&#x5230;&#x8DB3;&#x591F;&#x5C0F;&#x3002;&#x5728;&#x4E00;&#x4E9B;&#x9AD8;&#x5EA6;&#x4F18;&#x5316;&#x8FC7;&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x5373;&#x4F7F;&#x4E00;&#x70B9;&#x70B9;&#x635F;&#x8017;&#x4E5F;&#x4F1A;&#x5F88;&#x5BB9;&#x6613;&#x5BDF;&#x89C9;&#x5230;&#xFF0C;&#x800C;&#x4E14;&#x6709;&#x53EF;&#x80FD;&#x8FEB;&#x4F7F;&#x5728;&#x7EBF;&#x670D;&#x52A1;&#x7684;&#x90E8;&#x7F72;&#x56E2;&#x961F;&#x4E0D;&#x5F97;&#x4E0D;&#x5C06;&#x8DDF;&#x8E2A;&#x7CFB;&#x7EDF;&#x5173;&#x505C;&#x3002;</p>
<p>2.&#x5E94;&#x7528;&#x7EA7;&#x7684;&#x900F;&#x660E;&#xFF1A;&#x5BF9;&#x4E8E;&#x5E94;&#x7528;&#x7684;&#x7A0B;&#x5E8F;&#x5458;&#x6765;&#x8BF4;&#xFF0C;&#x662F;&#x4E0D;&#x9700;&#x8981;&#x77E5;&#x9053;&#x6709;&#x8DDF;&#x8E2A;&#x7CFB;&#x7EDF;&#x8FD9;&#x56DE;&#x4E8B;&#x7684;&#x3002;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x8DDF;&#x8E2A;&#x7CFB;&#x7EDF;&#x60F3;&#x751F;&#x6548;&#xFF0C;&#x5C31;&#x5FC5;&#x987B;&#x9700;&#x8981;&#x4F9D;&#x8D56;&#x5E94;&#x7528;&#x7684;&#x5F00;&#x53D1;&#x8005;&#x4E3B;&#x52A8;&#x914D;&#x5408;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x8DDF;&#x8E2A;&#x7CFB;&#x7EDF;&#x4E5F;&#x592A;&#x8106;&#x5F31;&#x4E86;&#xFF0C;&#x5F80;&#x5F80;&#x7531;&#x4E8E;&#x8DDF;&#x8E2A;&#x7CFB;&#x7EDF;&#x5728;&#x5E94;&#x7528;&#x4E2D;&#x690D;&#x5165;&#x4EE3;&#x7801;&#x7684;bug&#x6216;&#x758F;&#x5FFD;&#x5BFC;&#x81F4;&#x5E94;&#x7528;&#x51FA;&#x95EE;&#x9898;&#xFF0C;&#x8FD9;&#x6837;&#x624D;&#x662F;&#x65E0;&#x6CD5;&#x6EE1;&#x8DB3;&#x5BF9;&#x8DDF;&#x8E2A;&#x7CFB;&#x7EDF;&#x201C;&#x65E0;&#x6240;&#x4E0D;&#x5728;&#x7684;&#x90E8;&#x7F72;&#x201D;&#x8FD9;&#x4E2A;&#x9700;&#x6C42;&#x3002;&#x9762;&#x5BF9;&#x5F53;&#x4E0B;&#x60F3;Google&#x8FD9;&#x6837;&#x7684;&#x5FEB;&#x8282;&#x594F;&#x7684;&#x5F00;&#x53D1;&#x73AF;&#x5883;&#x6765;&#x8BF4;&#xFF0C;&#x5C24;&#x5176;&#x91CD;&#x8981;&#x3002;</p>
<p>3.&#x5EF6;&#x5C55;&#x6027;&#xFF1A;Google&#x81F3;&#x5C11;&#x5728;&#x672A;&#x6765;&#x51E0;&#x5E74;&#x7684;&#x670D;&#x52A1;&#x548C;&#x96C6;&#x7FA4;&#x7684;&#x89C4;&#x6A21;&#xFF0C;&#x76D1;&#x63A7;&#x7CFB;&#x7EDF;&#x90FD;&#x5E94;&#x8BE5;&#x80FD;&#x5B8C;&#x5168;&#x628A;&#x63A7;&#x4F4F;&#x3002;</p>
<p>&#x4E00;&#x4E2A;&#x989D;&#x5916;&#x7684;&#x8BBE;&#x8BA1;&#x76EE;&#x6807;&#x662F;&#x4E3A;&#x8DDF;&#x8E2A;&#x6570;&#x636E;&#x4EA7;&#x751F;&#x4E4B;&#x540E;&#xFF0C;&#x8FDB;&#x884C;&#x5206;&#x6790;&#x7684;&#x901F;&#x5EA6;&#x8981;&#x5FEB;&#xFF0C;&#x7406;&#x60F3;&#x60C5;&#x51B5;&#x662F;&#x6570;&#x636E;&#x5B58;&#x5165;&#x8DDF;&#x8E2A;&#x4ED3;&#x5E93;&#x540E;&#x4E00;&#x5206;&#x949F;&#x5185;&#x5C31;&#x80FD;&#x7EDF;&#x8BA1;&#x51FA;&#x6765;&#x3002;&#x5C3D;&#x7BA1;&#x8DDF;&#x8E2A;&#x7CFB;&#x7EDF;&#x5BF9;&#x4E00;&#x5C0F;&#x65F6;&#x524D;&#x7684;&#x65E7;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x7EDF;&#x8BA1;&#x4E5F;&#x662F;&#x76F8;&#x5F53;&#x6709;&#x4EF7;&#x503C;&#x7684;&#xFF0C;&#x4F46;&#x5982;&#x679C;&#x8DDF;&#x8E2A;&#x7CFB;&#x7EDF;&#x80FD;&#x63D0;&#x4F9B;&#x8DB3;&#x591F;&#x5FEB;&#x7684;&#x4FE1;&#x606F;&#x53CD;&#x9988;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5BF9;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E0B;&#x7684;&#x5F02;&#x5E38;&#x72B6;&#x51B5;&#x505A;&#x51FA;&#x5FEB;&#x901F;&#x53CD;&#x5E94;&#x3002;</p>
<p>&#x505A;&#x5230;&#x771F;&#x6B63;&#x7684;&#x5E94;&#x7528;&#x7EA7;&#x522B;&#x7684;&#x900F;&#x660E;&#xFF0C;&#x8FD9;&#x5E94;&#x8BE5;&#x662F;&#x5F53;&#x4E0B;&#x9762;&#x4E34;&#x7684;&#x6700;&#x6311;&#x6218;&#x6027;&#x7684;&#x8BBE;&#x8BA1;&#x76EE;&#x6807;&#xFF0C;&#x6211;&#x4EEC;&#x628A;&#x6838;&#x5FC3;&#x8DDF;&#x8E2A;&#x4EE3;&#x7801;&#x505A;&#x7684;&#x5F88;&#x8F7B;&#x5DE7;&#xFF0C;&#x7136;&#x540E;&#x628A;&#x5B83;&#x690D;&#x5165;&#x5230;&#x90A3;&#x4E9B;&#x65E0;&#x6240;&#x4E0D;&#x5728;&#x7684;&#x516C;&#x5171;&#x7EC4;&#x4EF6;&#x79CD;&#xFF0C;&#x6BD4;&#x5982;&#x7EBF;&#x7A0B;&#x8C03;&#x7528;&#x3001;&#x63A7;&#x5236;&#x6D41;&#x4EE5;&#x53CA;RPC&#x5E93;&#x3002;&#x4F7F;&#x7528;&#x81EA;&#x9002;&#x5E94;&#x7684;&#x91C7;&#x6837;&#x7387;&#x53EF;&#x4EE5;&#x4F7F;&#x8DDF;&#x8E2A;&#x7CFB;&#x7EDF;&#x53D8;&#x5F97;&#x53EF;&#x4F38;&#x7F29;&#xFF0C;&#x5E76;&#x964D;&#x4F4E;&#x6027;&#x80FD;&#x635F;&#x8017;&#xFF0C;&#x8FD9;&#x4E9B;&#x5185;&#x5BB9;&#x5C06;&#x5728;&#x7B2C;4.4&#x8282;&#x4E2D;&#x63D0;&#x53CA;&#x3002;&#x7ED3;&#x679C;&#x5C55;&#x793A;&#x7684;&#x76F8;&#x5173;&#x7CFB;&#x7EDF;&#x4E5F;&#x9700;&#x8981;&#x5305;&#x542B;&#x4E00;&#x4E9B;&#x7528;&#x6765;&#x6536;&#x96C6;&#x8DDF;&#x8E2A;&#x6570;&#x636E;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x7528;&#x6765;&#x56FE;&#x5F62;&#x5316;&#x7684;&#x5DE5;&#x5177;&#xFF0C;&#x4EE5;&#x53CA;&#x7528;&#x6765;&#x5206;&#x6790;&#x5927;&#x89C4;&#x6A21;&#x8DDF;&#x8E2A;&#x6570;&#x636E;&#x7684;&#x5E93;&#x548C;API&#x3002;&#x867D;&#x7136;&#x5355;&#x72EC;&#x4F7F;&#x7528;Dapper&#x6709;&#x65F6;&#x5C31;&#x8DB3;&#x591F;&#x8BA9;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x67E5;&#x660E;&#x5F02;&#x5E38;&#x7684;&#x6765;&#x6E90;&#xFF0C;&#x4F46;&#x662F;Dapper&#x7684;&#x521D;&#x8877;&#x4E0D;&#x662F;&#x8981;&#x53D6;&#x4EE3;&#x6240;&#x6709;&#x5176;&#x4ED6;&#x76D1;&#x63A7;&#x7684;&#x5DE5;&#x5177;&#x3002;&#x6211;&#x4EEC;&#x53D1;&#x73B0;&#xFF0C;Dapper&#x7684;&#x6570;&#x636E;&#x5F80;&#x5F80;&#x4FA7;&#x91CD;&#x6027;&#x80FD;&#x65B9;&#x9762;&#x7684;&#x8C03;&#x67E5;&#xFF0C;&#x6240;&#x4EE5;&#x5176;&#x4ED6;&#x76D1;&#x63A7;&#x5DE5;&#x5177;&#x4E5F;&#x6709;&#x4ED6;&#x4EEC;&#x5404;&#x81EA;&#x7684;&#x7528;&#x5904;&#x3002;</p>
<h2 id="1-1-&#x6587;&#x732E;&#x7684;&#x603B;&#x7ED3;"><a href="#1-1-&#x6587;&#x732E;&#x7684;&#x603B;&#x7ED3;" class="headerlink" title="1.1 &#x6587;&#x732E;&#x7684;&#x603B;&#x7ED3;"></a>1.1 &#x6587;&#x732E;&#x7684;&#x603B;&#x7ED3;</h2><p>&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#x8DDF;&#x8E2A;&#x5DE5;&#x5177;&#x7684;&#x8BBE;&#x8BA1;&#x7A7A;&#x95F4;&#x5DF2;&#x7ECF;&#x88AB;&#x4E00;&#x4E9B;&#x4F18;&#x79C0;&#x6587;&#x7AE0;&#x63A2;&#x7D22;&#x8FC7;&#x4E86;&#xFF0C;&#x5176;&#x4E2D;&#x7684;Pinpoint[9]&#x3001;Magpie[3]&#x548C;X-Trace[12]&#x548C;Dapper&#x6700;&#x4E3A;&#x76F8;&#x8FD1;&#x3002;&#x8FD9;&#x4E9B;&#x7CFB;&#x7EDF;&#x5728;&#x5176;&#x53D1;&#x5C55;&#x8FC7;&#x7A0B;&#x7684;&#x65E9;&#x671F;&#x503E;&#x5411;&#x4E8E;&#x5199;&#x5165;&#x7814;&#x7A76;&#x62A5;&#x544A;&#x4E2D;&#xFF0C;&#x5373;&#x4FBF;&#x4ED6;&#x4EEC;&#x8FD8;&#x6CA1;&#x6765;&#x5F97;&#x53CA;&#x6E05;&#x695A;&#x5730;&#x8BC4;&#x4F30;&#x7CFB;&#x7EDF;&#x5F53;&#x4E2D;&#x4E00;&#x4E9B;&#x8BBE;&#x8BA1;&#x7684;&#x91CD;&#x8981;&#x6027;&#x3002;&#x76F8;&#x6BD4;&#x4E4B;&#x4E0B;&#xFF0C;&#x7531;&#x4E8E;Dapper&#x5DF2;&#x7ECF;&#x5728;&#x5927;&#x89C4;&#x6A21;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E2D;&#x6478;&#x722C;&#x6EDA;&#x6253;&#x4E86;&#x591A;&#x5E74;&#xFF0C;&#x7ECF;&#x8FC7;&#x8FD9;&#x4E48;&#x591A;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x7684;&#x9A8C;&#x8BC1;&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x8BA4;&#x4E3A;&#x8FD9;&#x7BC7;&#x8BBA;&#x6587;&#x6700;&#x9002;&#x5408;&#x91CD;&#x70B9;&#x9610;&#x8FF0;&#x5728;&#x90E8;&#x7F72;Dapper&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x6211;&#x4EEC;&#x6709;&#x90A3;&#x4E9B;&#x6536;&#x83B7;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x8BBE;&#x8BA1;&#x601D;&#x60F3;&#x662F;&#x5982;&#x4F55;&#x51B3;&#x5B9A;&#x7684;&#xFF0C;&#x4EE5;&#x53CA;&#x4EE5;&#x4EC0;&#x4E48;&#x6837;&#x7684;&#x65B9;&#x5F0F;&#x5B9E;&#x73B0;&#x5B83;&#x624D;&#x4F1A;&#x6700;&#x6709;&#x7528;&#x3002;Dappe&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x5E73;&#x53F0;&#xFF0C;&#x627F;&#x8F7D;&#x57FA;&#x4E8E;Dapper&#x5F00;&#x53D1;&#x7684;&#x6027;&#x80FD;&#x5206;&#x6790;&#x5DE5;&#x5177;&#xFF0C;&#x4EE5;&#x53CA;Dapper&#x81EA;&#x8EAB;&#x7684;&#x76D1;&#x6D4B;&#x5DE5;&#x5177;&#xFF0C;&#x5B83;&#x7684;&#x4EF7;&#x503C;&#x5728;&#x4E8E;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x56DE;&#x987E;&#x8BC4;&#x4F30;&#x4E2D;&#x627E;&#x51FA;&#x4E00;&#x4E9B;&#x610F;&#x60F3;&#x4E0D;&#x5230;&#x7684;&#x7ED3;&#x679C;&#x3002;</p>
<p>&#x867D;&#x7136;Dapper&#x5728;&#x8BB8;&#x591A;&#x9AD8;&#x9636;&#x7684;&#x8BBE;&#x8BA1;&#x601D;&#x60F3;&#x4E0A;&#x5438;&#x53D6;&#x4E86;Pinpoint&#x548C;Magpie&#x7684;&#x7814;&#x7A76;&#x6210;&#x679C;&#xFF0C;&#x4F46;&#x5728;&#x5206;&#x5E03;&#x5F0F;&#x8DDF;&#x8E2A;&#x8FD9;&#x4E2A;&#x9886;&#x57DF;&#x4E2D;&#xFF0C;Dapper&#x7684;&#x5B9E;&#x73B0;&#x5305;&#x542B;&#x4E86;&#x8BB8;&#x591A;&#x65B0;&#x7684;&#x8D21;&#x732E;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x6211;&#x4EEC;&#x60F3;&#x5B9E;&#x73B0;&#x4F4E;&#x635F;&#x8017;&#x7684;&#x8BDD;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x5728;&#x9AD8;&#x5EA6;&#x4F18;&#x5316;&#x7684;&#x800C;&#x4E14;&#x8D8B;&#x4E8E;&#x6781;&#x7AEF;&#x5EF6;&#x8FDF;&#x654F;&#x611F;&#x7684;Web&#x670D;&#x52A1;&#x4E2D;&#xFF0C;&#x91C7;&#x6837;&#x7387;&#x662F;&#x5F88;&#x5FC5;&#x8981;&#x7684;&#x3002;&#x6216;&#x8BB8;&#x66F4;&#x4EE4;&#x4EBA;&#x60CA;&#x8BB6;&#x7684;&#x662F;&#xFF0C;&#x6211;&#x4EEC;&#x53D1;&#x73B0;&#x5373;&#x4FBF;&#x662F;1/1000&#x7684;&#x91C7;&#x6837;&#x7387;&#xFF0C;&#x5BF9;&#x4E8E;&#x8DDF;&#x8E2A;&#x6570;&#x636E;&#x7684;&#x901A;&#x7528;&#x4F7F;&#x7528;&#x5C42;&#x9762;&#x4E0A;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x63D0;&#x4F9B;&#x8DB3;&#x591F;&#x591A;&#x7684;&#x4FE1;&#x606F;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x7684;&#x7CFB;&#x7EDF;&#x7684;&#x53E6;&#x4E00;&#x4E2A;&#x91CD;&#x8981;&#x7684;&#x7279;&#x5F81;&#xFF0C;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x80FD;&#x5B9E;&#x73B0;&#x7684;&#x5E94;&#x7528;&#x7EA7;&#x7684;&#x900F;&#x660E;&#x3002;&#x6211;&#x4EEC;&#x7684;&#x7EC4;&#x4EF6;&#x5BF9;&#x5E94;&#x7528;&#x7684;&#x4FB5;&#x5165;&#x88AB;&#x5148;&#x9650;&#x5236;&#x5728;&#x8DB3;&#x591F;&#x4F4E;&#x7684;&#x6C34;&#x5E73;&#x4E0A;&#xFF0C;&#x5373;&#x4F7F;&#x60F3;Google&#x7F51;&#x9875;&#x641C;&#x7D22;&#x8FD9;&#x4E48;&#x5927;&#x89C4;&#x6A21;&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8FDB;&#x884C;&#x8DDF;&#x8E2A;&#x800C;&#x65E0;&#x9700;&#x52A0;&#x5165;&#x989D;&#x5916;&#x7684;&#x6807;&#x6CE8;(Annotation)&#x3002;&#x867D;&#x7136;&#x7531;&#x4E8E;&#x6211;&#x4EEC;&#x7684;&#x90E8;&#x7F72;&#x7CFB;&#x7EDF;&#x6709;&#x5E78;&#x662F;&#x4E00;&#x5B9A;&#x7A0B;&#x5EA6;&#x7684;&#x540C;&#x8D28;&#x5316;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x66F4;&#x5BB9;&#x6613;&#x505A;&#x5230;&#x5BF9;&#x5E94;&#x7528;&#x5C42;&#x7684;&#x900F;&#x660E;&#x8FD9;&#x70B9;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x8BC1;&#x660E;&#x4E86;&#x8FD9;&#x662F;&#x5B9E;&#x73B0;&#x8FD9;&#x79CD;&#x7A0B;&#x5EA6;&#x7684;&#x900F;&#x660E;&#x6027;&#x7684;&#x5145;&#x5206;&#x6761;&#x4EF6;&#x3002;</p>
<ol start="2">
<li>Dapper&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x8DDF;&#x8E2A;</li>
</ol>
<hr>
<p> <img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/febc025f5553536cbd8daf71a5b4eeab67db524a1823b0ad35d31146f633026d" alt><br>&#x56FE;1&#xFF1A;&#x8FD9;&#x4E2A;&#x8DEF;&#x5F84;&#x7531;&#x7528;&#x6237;&#x7684;X&#x8BF7;&#x6C42;&#x53D1;&#x8D77;&#xFF0C;&#x7A7F;&#x8FC7;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x670D;&#x52A1;&#x7CFB;&#x7EDF;&#x3002;&#x7528;&#x5B57;&#x6BCD;&#x6807;&#x8BC6;&#x7684;&#x8282;&#x70B9;&#x4EE3;&#x8868;&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#x4E2D;&#x7684;&#x4E0D;&#x540C;&#x5904;&#x7406;&#x8FC7;&#x7A0B;&#x3002;</p>
<p>&#x5206;&#x5E03;&#x5F0F;&#x670D;&#x52A1;&#x7684;&#x8DDF;&#x8E2A;&#x7CFB;&#x7EDF;&#x9700;&#x8981;&#x8BB0;&#x5F55;&#x5728;&#x4E00;&#x6B21;&#x7279;&#x5B9A;&#x7684;&#x8BF7;&#x6C42;&#x540E;&#x7CFB;&#x7EDF;&#x4E2D;&#x5B8C;&#x6210;&#x7684;&#x6240;&#x6709;&#x5DE5;&#x4F5C;&#x7684;&#x4FE1;&#x606F;&#x3002;&#x4E3E;&#x4E2A;&#x4F8B;&#x5B50;&#xFF0C;&#x56FE;1&#x5C55;&#x73B0;&#x7684;&#x662F;&#x4E00;&#x4E2A;&#x548C;5&#x53F0;&#x670D;&#x52A1;&#x5668;&#x76F8;&#x5173;&#x7684;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#xFF0C;&#x5305;&#x62EC;&#xFF1A;&#x524D;&#x7AEF;&#xFF08;A&#xFF09;&#xFF0C;&#x4E24;&#x4E2A;&#x4E2D;&#x95F4;&#x5C42;&#xFF08;B&#x548C;C&#xFF09;&#xFF0C;&#x4EE5;&#x53CA;&#x4E24;&#x4E2A;&#x540E;&#x7AEF;&#xFF08;D&#x548C;E&#xFF09;&#x3002;&#x5F53;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#xFF08;&#x8FD9;&#x4E2A;&#x7528;&#x4F8B;&#x7684;&#x53D1;&#x8D77;&#x4EBA;&#xFF09;&#x53D1;&#x8D77;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x9996;&#x5148;&#x5230;&#x8FBE;&#x524D;&#x7AEF;&#xFF0C;&#x7136;&#x540E;&#x53D1;&#x9001;&#x4E24;&#x4E2A;RPC&#x5230;&#x670D;&#x52A1;&#x5668;B&#x548C;C&#x3002;B&#x4F1A;&#x9A6C;&#x4E0A;&#x505A;&#x51FA;&#x53CD;&#x5E94;&#xFF0C;&#x4F46;&#x662F;C&#x9700;&#x8981;&#x548C;&#x540E;&#x7AEF;&#x7684;D&#x548C;E&#x4EA4;&#x4E92;&#x4E4B;&#x540E;&#x518D;&#x8FD4;&#x8FD8;&#x7ED9;A&#xFF0C;&#x7531;A&#x6765;&#x54CD;&#x5E94;&#x6700;&#x521D;&#x7684;&#x8BF7;&#x6C42;&#x3002;&#x5BF9;&#x4E8E;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#xFF0C;&#x7B80;&#x5355;&#x5B9E;&#x7528;&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x8DDF;&#x8E2A;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x5C31;&#x662F;&#x4E3A;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x6BCF;&#x4E00;&#x6B21;&#x4F60;&#x53D1;&#x9001;&#x548C;&#x63A5;&#x6536;&#x52A8;&#x4F5C;&#x6765;&#x6536;&#x96C6;&#x8DDF;&#x8E2A;&#x6807;&#x8BC6;&#x7B26;(message identifiers)&#x548C;&#x65F6;&#x95F4;&#x6233;(timestamped<br> events)&#x3002;</p>
<p>&#x4E3A;&#x4E86;&#x5C06;&#x6240;&#x6709;&#x8BB0;&#x5F55;&#x6761;&#x76EE;&#x4E0E;&#x4E00;&#x4E2A;&#x7ED9;&#x5B9A;&#x7684;&#x53D1;&#x8D77;&#x8005;&#xFF08;&#x4F8B;&#x5982;&#xFF0C;&#x56FE;1&#x4E2D;&#x7684;RequestX&#xFF09;&#x5173;&#x8054;&#x4E0A;&#x5E76;&#x8BB0;&#x5F55;&#x6240;&#x6709;&#x4FE1;&#x606F;&#xFF0C;&#x73B0;&#x5728;&#x6709;&#x4E24;&#x79CD;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;&#x9ED1;&#x76D2;(black-box)&#x548C;&#x57FA;&#x4E8E;&#x6807;&#x6CE8;(annotation-based)&#x7684;&#x76D1;&#x63A7;&#x65B9;&#x6848;&#x3002;&#x9ED1;&#x76D2;&#x65B9;&#x6848;[1&#xFF0C;15&#xFF0C;2]&#x5047;&#x5B9A;&#x9700;&#x8981;&#x8DDF;&#x8E2A;&#x7684;&#x9664;&#x4E86;&#x4E0A;&#x8FF0;&#x4FE1;&#x606F;&#x4E4B;&#x5916;&#x6CA1;&#x6709;&#x989D;&#x5916;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x8FD9;&#x6837;&#x4F7F;&#x7528;&#x7EDF;&#x8BA1;&#x56DE;&#x5F52;&#x6280;&#x672F;&#x6765;&#x63A8;&#x65AD;&#x4E24;&#x8005;&#x4E4B;&#x95F4;&#x7684;&#x5173;&#x7CFB;&#x3002;&#x57FA;&#x4E8E;&#x6807;&#x6CE8;&#x7684;&#x65B9;&#x6848;[3&#xFF0C;12&#xFF0C;9&#xFF0C;16]&#x4F9D;&#x8D56;&#x4E8E;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6216;&#x4E2D;&#x95F4;&#x4EF6;&#x660E;&#x786E;&#x5730;&#x6807;&#x8BB0;&#x4E00;&#x4E2A;&#x5168;&#x5C40;ID&#xFF0C;&#x4ECE;&#x800C;&#x8FDE;&#x63A5;&#x6BCF;&#x4E00;&#x6761;&#x8BB0;&#x5F55;&#x548C;&#x53D1;&#x8D77;&#x8005;&#x7684;&#x8BF7;&#x6C42;&#x3002;&#x867D;&#x7136;&#x9ED1;&#x76D2;&#x65B9;&#x6848;&#x6BD4;&#x6807;&#x6CE8;&#x65B9;&#x6848;&#x66F4;&#x8F7B;&#x4FBF;&#xFF0C;&#x4ED6;&#x4EEC;&#x9700;&#x8981;&#x66F4;&#x591A;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x4EE5;&#x83B7;&#x5F97;&#x8DB3;&#x591F;&#x7684;&#x7CBE;&#x5EA6;&#xFF0C;&#x56E0;&#x4E3A;&#x4ED6;&#x4EEC;&#x4F9D;&#x8D56;&#x4E8E;&#x7EDF;&#x8BA1;&#x63A8;&#x8BBA;&#x3002;&#x57FA;&#x4E8E;&#x6807;&#x6CE8;&#x7684;&#x65B9;&#x6848;&#x6700;&#x4E3B;&#x8981;&#x7684;&#x7F3A;&#x70B9;&#x662F;&#xFF0C;&#x5F88;&#x660E;&#x663E;&#xFF0C;&#x9700;&#x8981;&#x4EE3;&#x7801;&#x690D;&#x5165;&#x3002;&#x5728;&#x6211;&#x4EEC;&#x7684;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E2D;&#xFF0C;&#x56E0;&#x4E3A;&#x6240;&#x6709;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x90FD;&#x4F7F;&#x7528;&#x76F8;&#x540C;&#x7684;&#x7EBF;&#x7A0B;&#x6A21;&#x578B;&#xFF0C;&#x63A7;&#x5236;&#x6D41;&#x548C;RPC&#x7CFB;&#x7EDF;&#xFF0C;&#x6211;&#x4EEC;&#x53D1;&#x73B0;&#xFF0C;&#x53EF;&#x4EE5;&#x628A;&#x4EE3;&#x7801;&#x690D;&#x5165;&#x9650;&#x5236;&#x5728;&#x4E00;&#x4E2A;&#x5F88;&#x5C0F;&#x7684;&#x901A;&#x7528;&#x7EC4;&#x4EF6;&#x5E93;&#x4E2D;&#xFF0C;&#x4ECE;&#x800C;&#x5B9E;&#x73B0;&#x4E86;&#x76D1;&#x6D4B;&#x7CFB;&#x7EDF;&#x7684;&#x5E94;&#x7528;&#x5BF9;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x662F;&#x6709;&#x6548;&#x5730;&#x900F;&#x660E;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x503E;&#x5411;&#x4E8E;&#x8BA4;&#x4E3A;&#xFF0C;Dapper&#x7684;&#x8DDF;&#x8E2A;&#x67B6;&#x6784;&#x50CF;&#x662F;&#x5185;&#x5D4C;&#x5728;RPC&#x8C03;&#x7528;&#x7684;&#x6811;&#x5F62;&#x7ED3;&#x6784;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x6838;&#x5FC3;&#x6570;&#x636E;&#x6A21;&#x578B;&#x4E0D;&#x53EA;&#x5C40;&#x9650;&#x4E8E;&#x6211;&#x4EEC;&#x7684;&#x7279;&#x5B9A;&#x7684;RPC&#x6846;&#x67B6;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x80FD;&#x8DDF;&#x8E2A;&#x5176;&#x4ED6;&#x884C;&#x4E3A;&#xFF0C;&#x4F8B;&#x5982;Gmail&#x7684;SMTP&#x4F1A;&#x8BDD;&#xFF0C;&#x5916;&#x754C;&#x7684;HTTP&#x8BF7;&#x6C42;&#xFF0C;&#x548C;&#x5916;&#x90E8;&#x5BF9;SQL&#x670D;&#x52A1;&#x5668;&#x7684;&#x67E5;&#x8BE2;&#x7B49;&#x3002;&#x4ECE;&#x5F62;&#x5F0F;&#x4E0A;&#x770B;&#xFF0C;&#x6211;&#x4EEC;&#x7684;Dapper&#x8DDF;&#x8E2A;&#x6A21;&#x578B;&#x4F7F;&#x7528;&#x7684;&#x6811;&#x5F62;&#x7ED3;&#x6784;&#xFF0C;Span&#x4EE5;&#x53CA;Annotation&#x3002;</p>
<h2 id="2-1-&#x8DDF;&#x8E2A;&#x6811;&#x548C;span"><a href="#2-1-&#x8DDF;&#x8E2A;&#x6811;&#x548C;span" class="headerlink" title="2.1 &#x8DDF;&#x8E2A;&#x6811;&#x548C;span"></a>2.1 &#x8DDF;&#x8E2A;&#x6811;&#x548C;span</h2><p>&#x5728;Dapper&#x8DDF;&#x8E2A;&#x6811;&#x7ED3;&#x6784;&#x4E2D;&#xFF0C;&#x6811;&#x8282;&#x70B9;&#x662F;&#x6574;&#x4E2A;&#x67B6;&#x6784;&#x7684;&#x57FA;&#x672C;&#x5355;&#x5143;&#xFF0C;&#x800C;&#x6BCF;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x53C8;&#x662F;&#x5BF9;span&#x7684;&#x5F15;&#x7528;&#x3002;&#x8282;&#x70B9;&#x4E4B;&#x95F4;&#x7684;&#x8FDE;&#x7EBF;&#x8868;&#x793A;&#x7684;span&#x548C;&#x5B83;&#x7684;&#x7236;span&#x76F4;&#x63A5;&#x7684;&#x5173;&#x7CFB;&#x3002;&#x867D;&#x7136;span&#x5728;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x4E2D;&#x53EA;&#x662F;&#x7B80;&#x5355;&#x7684;&#x4EE3;&#x8868;span&#x7684;&#x5F00;&#x59CB;&#x548C;&#x7ED3;&#x675F;&#x65F6;&#x95F4;&#xFF0C;&#x4ED6;&#x4EEC;&#x5728;&#x6574;&#x4E2A;&#x6811;&#x5F62;&#x7ED3;&#x6784;&#x4E2D;&#x5374;&#x662F;&#x76F8;&#x5BF9;&#x72EC;&#x7ACB;&#x7684;&#xFF0C;&#x4EFB;&#x4F55;RPC&#x76F8;&#x5173;&#x7684;&#x65F6;&#x95F4;&#x6570;&#x636E;&#x3001;&#x96F6;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x7279;&#x5B9A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;Annotation&#x7684;&#x76F8;&#x5173;&#x5185;&#x5BB9;&#x4F1A;&#x5728;2.3&#x8282;&#x4E2D;&#x8BA8;&#x8BBA;&#x3002;</p>
<p> <img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/5fc9e347e027902f09c1488aaba2f63757dccb6378beaa241367fb8b513e07e5" alt><br>&#x56FE;2&#xFF1A;5&#x4E2A;span&#x5728;Dapper&#x8DDF;&#x8E2A;&#x6811;&#x79CD;&#x77ED;&#x6682;&#x7684;&#x5173;&#x8054;&#x5173;&#x7CFB;</p>
<p>&#x5728;&#x56FE;2&#x4E2D;&#x8BF4;&#x660E;&#x4E86;span&#x5728;&#x4E00;&#x4E2A;&#x5927;&#x7684;&#x8DDF;&#x8E2A;&#x8FC7;&#x7A0B;&#x4E2D;&#x662F;&#x4EC0;&#x4E48;&#x6837;&#x7684;&#x3002;Dapper&#x8BB0;&#x5F55;&#x4E86;span&#x540D;&#x79F0;&#xFF0C;&#x4EE5;&#x53CA;&#x6BCF;&#x4E2A;span&#x7684;ID&#x548C;&#x7236;ID&#xFF0C;&#x4EE5;&#x91CD;&#x5EFA;&#x5728;&#x4E00;&#x6B21;&#x8FFD;&#x8E2A;&#x8FC7;&#x7A0B;&#x4E2D;&#x4E0D;&#x540C;span&#x4E4B;&#x95F4;&#x7684;&#x5173;&#x7CFB;&#x3002;&#x5982;&#x679C;&#x4E00;&#x4E2A;span&#x6CA1;&#x6709;&#x7236;ID&#x88AB;&#x79F0;&#x4E3A;root span&#x3002;&#x6240;&#x6709;span&#x90FD;&#x6302;&#x5728;&#x4E00;&#x4E2A;&#x7279;&#x5B9A;&#x7684;&#x8DDF;&#x8E2A;&#x4E0A;&#xFF0C;&#x4E5F;&#x5171;&#x7528;&#x4E00;&#x4E2A;&#x8DDF;&#x8E2A;id&#xFF08;&#x5728;&#x56FE;&#x4E2D;&#x672A;&#x793A;&#x51FA;&#xFF09;&#x3002;&#x6240;&#x6709;&#x8FD9;&#x4E9B;ID&#x7528;&#x5168;&#x5C40;&#x552F;&#x4E00;&#x7684;64&#x4F4D;&#x6574;&#x6570;&#x6807;&#x793A;&#x3002;&#x5728;&#x4E00;&#x4E2A;&#x5178;&#x578B;&#x7684;Dapper&#x8DDF;&#x8E2A;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x4E3A;&#x6BCF;&#x4E00;&#x4E2A;RPC&#x5BF9;&#x5E94;&#x5230;&#x4E00;&#x4E2A;&#x5355;&#x4E00;&#x7684;span&#x4E0A;&#xFF0C;&#x800C;&#x4E14;&#x6BCF;&#x4E00;&#x4E2A;&#x989D;&#x5916;&#x7684;&#x7EC4;&#x4EF6;&#x5C42;&#x90FD;&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;&#x8DDF;&#x8E2A;&#x6811;&#x578B;&#x7ED3;&#x6784;&#x7684;&#x5C42;&#x7EA7;&#x3002;</p>
<p> <img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/684789cdfc6637476119f9174715f6bc3bcbeeb792f1d9a1ad57cf4bcf10bfc9" alt><br>&#x56FE;3&#xFF1A;&#x5728;&#x56FE;2&#x4E2D;&#x6240;&#x793A;&#x7684;&#x4E00;&#x4E2A;&#x5355;&#x72EC;&#x7684;span&#x7684;&#x7EC6;&#x8282;&#x56FE;</p>
<p>&#x56FE;3&#x7ED9;&#x51FA;&#x4E86;&#x4E00;&#x4E2A;&#x66F4;&#x8BE6;&#x7EC6;&#x7684;&#x5178;&#x578B;&#x7684;Dapper&#x8DDF;&#x8E2A;span&#x7684;&#x8BB0;&#x5F55;&#x70B9;&#x7684;&#x89C6;&#x56FE;&#x3002;&#x5728;&#x56FE;2&#x4E2D;&#x8FD9;&#x79CD;&#x67D0;&#x4E2A;span&#x8868;&#x8FF0;&#x4E86;&#x4E24;&#x4E2A;&#x201C;Helper.Call&#x201D;&#x7684;RPC(&#x5206;&#x522B;&#x4E3A;server&#x7AEF;&#x548C;client&#x7AEF;)&#x3002;span&#x7684;&#x5F00;&#x59CB;&#x65F6;&#x95F4;&#x548C;&#x7ED3;&#x675F;&#x65F6;&#x95F4;&#xFF0C;&#x4EE5;&#x53CA;&#x4EFB;&#x4F55;RPC&#x7684;&#x65F6;&#x95F4;&#x4FE1;&#x606F;&#x90FD;&#x901A;&#x8FC7;Dapper&#x5728;RPC&#x7EC4;&#x4EF6;&#x5E93;&#x7684;&#x690D;&#x5165;&#x8BB0;&#x5F55;&#x4E0B;&#x6765;&#x3002;&#x5982;&#x679C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5F00;&#x53D1;&#x8005;&#x9009;&#x62E9;&#x5728;&#x8DDF;&#x8E2A;&#x4E2D;&#x589E;&#x52A0;&#x4ED6;&#x4EEC;&#x81EA;&#x5DF1;&#x7684;&#x6CE8;&#x91CA;&#xFF08;&#x5982;&#x56FE;&#x4E2D;&#x201C;foo&#x201D;&#x7684;&#x6CE8;&#x91CA;&#xFF09;(&#x4E1A;&#x52A1;&#x6570;&#x636E;)&#xFF0C;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#x4E5F;&#x4F1A;&#x548C;&#x5176;&#x4ED6;span&#x4FE1;&#x606F;&#x4E00;&#x6837;&#x8BB0;&#x5F55;&#x4E0B;&#x6765;&#x3002;</p>
<p>&#x8BB0;&#x4F4F;&#xFF0C;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;span&#x53EF;&#x4EE5;&#x5305;&#x542B;&#x6765;&#x81EA;&#x4E0D;&#x540C;&#x7684;&#x4E3B;&#x673A;&#x4FE1;&#x606F;&#xFF0C;&#x8FD9;&#x4E9B;&#x4E5F;&#x8981;&#x8BB0;&#x5F55;&#x4E0B;&#x6765;&#x3002;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A;RPC span&#x53EF;&#x4EE5;&#x5305;&#x542B;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x5668;&#x4E24;&#x4E2A;&#x8FC7;&#x7A0B;&#x7684;&#x6CE8;&#x91CA;&#xFF0C;&#x4F7F;&#x5F97;&#x94FE;&#x63A5;&#x4E24;&#x4E2A;&#x4E3B;&#x673A;&#x7684;span&#x4F1A;&#x6210;&#x4E3A;&#x6A21;&#x578B;&#x4E2D;&#x6240;&#x8BF4;&#x7684;span&#x3002;&#x7531;&#x4E8E;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x7684;&#x65F6;&#x95F4;&#x6233;&#x6765;&#x81EA;&#x4E0D;&#x540C;&#x7684;&#x4E3B;&#x673A;&#xFF0C;&#x6211;&#x4EEC;&#x5FC5;&#x987B;&#x8003;&#x8651;&#x5230;&#x65F6;&#x95F4;&#x504F;&#x5DEE;&#x3002;&#x5728;&#x6211;&#x4EEC;&#x7684;&#x5206;&#x6790;&#x5DE5;&#x5177;&#xFF0C;&#x6211;&#x4EEC;&#x5229;&#x7528;&#x4E86;&#x8FD9;&#x4E2A;&#x4E8B;&#x5B9E;&#xFF1A;RPC&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x4E4B;&#x540E;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x624D;&#x80FD;&#x63A5;&#x6536;&#x5230;&#xFF0C;&#x5BF9;&#x4E8E;&#x54CD;&#x5E94;&#x4E5F;&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF08;&#x670D;&#x52A1;&#x5668;&#x5148;&#x54CD;&#x5E94;&#xFF0C;&#x7136;&#x540E;&#x5BA2;&#x6237;&#x7AEF;&#x624D;&#x80FD;&#x63A5;&#x6536;&#x5230;&#x8FD9;&#x4E2A;&#x54CD;&#x5E94;&#xFF09;&#x3002;&#x8FD9;&#x6837;&#x4E00;&#x6765;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x7684;RPC&#x5C31;&#x6709;&#x4E00;&#x4E2A;&#x65F6;&#x95F4;&#x6233;&#x7684;&#x4E00;&#x4E2A;&#x4E0A;&#x9650;&#x548C;&#x4E0B;&#x9650;&#x3002;</p>
<h2 id="2-2-&#x690D;&#x5165;&#x70B9;"><a href="#2-2-&#x690D;&#x5165;&#x70B9;" class="headerlink" title="2.2 &#x690D;&#x5165;&#x70B9;"></a>2.2 &#x690D;&#x5165;&#x70B9;</h2><p>Dapper&#x53EF;&#x4EE5;&#x4EE5;&#x5BF9;&#x5E94;&#x7528;&#x5F00;&#x53D1;&#x8005;&#x8FD1;&#x4E4E;&#x96F6;&#x6D78;&#x5165;&#x7684;&#x6210;&#x672C;&#x5BF9;&#x5206;&#x5E03;&#x5F0F;&#x63A7;&#x5236;&#x8DEF;&#x5F84;&#x8FDB;&#x884C;&#x8DDF;&#x8E2A;&#xFF0C;&#x51E0;&#x4E4E;&#x5B8C;&#x5168;&#x4F9D;&#x8D56;&#x4E8E;&#x57FA;&#x4E8E;&#x5C11;&#x91CF;&#x901A;&#x7528;&#x7EC4;&#x4EF6;&#x5E93;&#x7684;&#x6539;&#x9020;&#x3002;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li>&#x5F53;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x5728;&#x5904;&#x7406;&#x8DDF;&#x8E2A;&#x63A7;&#x5236;&#x8DEF;&#x5F84;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;Dapper&#x628A;&#x8FD9;&#x6B21;&#x8DDF;&#x8E2A;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x7684;&#x5728;ThreadLocal&#x4E2D;&#x8FDB;&#x884C;&#x5B58;&#x50A8;&#x3002;&#x8FFD;&#x8E2A;&#x4E0A;&#x4E0B;&#x6587;&#x662F;&#x4E00;&#x4E2A;&#x5C0F;&#x800C;&#x4E14;&#x5BB9;&#x6613;&#x590D;&#x5236;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x5176;&#x4E2D;&#x627F;&#x8F7D;&#x4E86;Scan&#x7684;&#x5C5E;&#x6027;&#x6BD4;&#x5982;&#x8DDF;&#x8E2A;ID&#x548C;span ID&#x3002;</li>
<li>&#x5F53;&#x8BA1;&#x7B97;&#x8FC7;&#x7A0B;&#x662F;&#x5EF6;&#x8FDF;&#x8C03;&#x7528;&#x7684;&#x6216;&#x662F;&#x5F02;&#x6B65;&#x7684;&#xFF0C;&#x5927;&#x591A;&#x6570;Google&#x5F00;&#x53D1;&#x8005;&#x901A;&#x8FC7;&#x7EBF;&#x7A0B;&#x6C60;&#x6216;&#x5176;&#x4ED6;&#x6267;&#x884C;&#x5668;&#xFF0C;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x901A;&#x7528;&#x7684;&#x63A7;&#x5236;&#x6D41;&#x5E93;&#x6765;&#x56DE;&#x8C03;&#x3002;Dapper&#x786E;&#x4FDD;&#x6240;&#x6709;&#x8FD9;&#x6837;&#x7684;&#x56DE;&#x8C03;&#x53EF;&#x4EE5;&#x5B58;&#x50A8;&#x8FD9;&#x6B21;&#x8DDF;&#x8E2A;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#xFF0C;&#x800C;&#x5F53;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x88AB;&#x89E6;&#x53D1;&#x65F6;&#xFF0C;&#x8FD9;&#x6B21;&#x8DDF;&#x8E2A;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x4F1A;&#x4E0E;&#x9002;&#x5F53;&#x7684;&#x7EBF;&#x7A0B;&#x5173;&#x8054;&#x4E0A;&#x3002;&#x5728;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x4E0B;&#xFF0C;Dapper&#x53EF;&#x4EE5;&#x4F7F;&#x7528;trace ID&#x548C;span ID&#x6765;&#x8F85;&#x52A9;&#x6784;&#x5EFA;&#x5F02;&#x6B65;&#x8C03;&#x7528;&#x7684;&#x8DEF;&#x5F84;&#x3002;</li>
<li>&#x51E0;&#x4E4E;&#x6240;&#x6709;&#x7684;Google&#x7684;&#x8FDB;&#x7A0B;&#x95F4;&#x901A;&#x4FE1;&#x662F;&#x5EFA;&#x7ACB;&#x5728;&#x4E00;&#x4E2A;&#x7528;C++&#x548C;Java&#x5F00;&#x53D1;&#x7684;RPC&#x6846;&#x67B6;&#x4E0A;&#x3002;&#x6211;&#x4EEC;&#x628A;&#x8DDF;&#x8E2A;&#x690D;&#x5165;&#x8BE5;&#x6846;&#x67B6;&#x6765;&#x5B9A;&#x4E49;RPC&#x4E2D;&#x6240;&#x6709;&#x7684;span&#x3002;span&#x7684;ID&#x548C;&#x8DDF;&#x8E2A;&#x7684;ID&#x4F1A;&#x4ECE;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x5230;&#x670D;&#x52A1;&#x7AEF;&#x3002;&#x50CF;&#x90A3;&#x6837;&#x7684;&#x57FA;&#x4E8E;RPC&#x7684;&#x7CFB;&#x7EDF;&#x88AB;&#x5E7F;&#x6CDB;&#x4F7F;&#x7528;&#x5728;Google&#x4E2D;&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x91CD;&#x8981;&#x7684;&#x690D;&#x5165;&#x70B9;&#x3002;&#x5F53;&#x90A3;&#x4E9B;&#x975E;RPC&#x901A;&#x4FE1;&#x6846;&#x67B6;&#x53D1;&#x5C55;&#x6210;&#x719F;&#x5E76;&#x627E;&#x5230;&#x4E86;&#x81EA;&#x5DF1;&#x7684;&#x7528;&#x6237;&#x7FA4;&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x8BA1;&#x5212;&#x5BF9;RPC&#x901A;&#x4FE1;&#x6846;&#x67B6;&#x8FDB;&#x884C;&#x690D;&#x5165;&#x3002;</li>
</ul>
<p>Dapper&#x7684;&#x8DDF;&#x8E2A;&#x6570;&#x636E;&#x662F;&#x72EC;&#x7ACB;&#x4E8E;&#x8BED;&#x8A00;&#x7684;&#xFF0C;&#x5F88;&#x591A;&#x5728;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E2D;&#x7684;&#x8DDF;&#x8E2A;&#x7ED3;&#x5408;&#x4E86;&#x7528;C++&#x548C;Java&#x5199;&#x7684;&#x8FDB;&#x7A0B;&#x7684;&#x6570;&#x636E;&#x3002;&#x5728;3.2&#x8282;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x8BA8;&#x8BBA;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x900F;&#x660E;&#x5EA6;&#x65F6;&#x6211;&#x4EEC;&#x4F1A;&#x628A;&#x8FD9;&#x4E9B;&#x7406;&#x8BBA;&#x7684;&#x662F;&#x5982;&#x4F55;&#x5B9E;&#x8DF5;&#x7684;&#x8FDB;&#x884C;&#x8BA8;&#x8BBA;&#x3002;</p>
<h2 id="2-3-Annotation"><a href="#2-3-Annotation" class="headerlink" title="2.3 Annotation"></a>2.3 Annotation</h2><p> <img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/9781a3d7333389b02d733973aeb859ac02143f94a25aa7677a9c76e337dcf5ff" alt><br>&#x4E0A;&#x8FF0;&#x690D;&#x5165;&#x70B9;&#x8DB3;&#x591F;&#x63A8;&#x5BFC;&#x51FA;&#x590D;&#x6742;&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#x7684;&#x8DDF;&#x8E2A;&#x7EC6;&#x8282;&#xFF0C;&#x4F7F;&#x5F97;Dapper&#x7684;&#x6838;&#x5FC3;&#x529F;&#x80FD;&#x5728;&#x4E0D;&#x6539;&#x52A8;Google&#x5E94;&#x7528;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x53EF;&#x7528;&#x3002;&#x7136;&#x800C;&#xFF0C;Dapper&#x8FD8;&#x5141;&#x8BB8;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x5728;Dapper&#x8DDF;&#x8E2A;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x6DFB;&#x52A0;&#x989D;&#x5916;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x4EE5;&#x76D1;&#x63A7;&#x66F4;&#x9AD8;&#x7EA7;&#x522B;&#x7684;&#x7CFB;&#x7EDF;&#x884C;&#x4E3A;&#xFF0C;&#x6216;&#x5E2E;&#x52A9;&#x8C03;&#x8BD5;&#x95EE;&#x9898;&#x3002;&#x6211;&#x4EEC;&#x5141;&#x8BB8;&#x7528;&#x6237;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;API&#x5B9A;&#x4E49;&#x5E26;&#x65F6;&#x95F4;&#x6233;&#x7684;Annotation&#xFF0C;&#x6838;&#x5FC3;&#x7684;&#x793A;&#x4F8B;&#x4EE3;&#x7801;&#x5165;&#x56FE;4&#x6240;&#x793A;&#x3002;&#x8FD9;&#x4E9B;Annotation&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x4EFB;&#x610F;&#x5185;&#x5BB9;&#x3002;&#x4E3A;&#x4E86;&#x4FDD;&#x62A4;Dapper&#x7684;&#x7528;&#x6237;&#x610F;&#x5916;&#x7684;&#x8FC7;&#x5206;&#x70ED;&#x8877;&#x4E8E;&#x65E5;&#x5FD7;&#x7684;&#x8BB0;&#x5F55;&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A;&#x8DDF;&#x8E2A;span&#x6709;&#x4E00;&#x4E2A;&#x53EF;&#x914D;&#x7F6E;&#x7684;&#x603B;Annotation&#x91CF;&#x7684;&#x4E0A;&#x9650;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7EA7;&#x7684;Annotation&#x662F;&#x4E0D;&#x80FD;&#x66FF;&#x4EE3;&#x7528;&#x4E8E;&#x8868;&#x793A;span&#x7ED3;&#x6784;&#x7684;&#x4FE1;&#x606F;&#x548C;&#x8BB0;&#x5F55;&#x7740;RPC&#x76F8;&#x5173;&#x7684;&#x4FE1;&#x606F;&#x3002;</p>
<p>&#x9664;&#x4E86;&#x7B80;&#x5355;&#x7684;&#x6587;&#x672C;Annotation&#xFF0C;Dapper&#x4E5F;&#x652F;&#x6301;&#x7684;key-value&#x6620;&#x5C04;&#x7684; Annotation&#xFF0C;&#x63D0;&#x4F9B;&#x7ED9;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x66F4;&#x5F3A;&#x7684;&#x8DDF;&#x8E2A;&#x80FD;&#x529B;&#xFF0C;&#x5982;&#x6301;&#x7EED;&#x7684;&#x8BA1;&#x6570;&#x5668;&#xFF0C;&#x4E8C;&#x8FDB;&#x5236;&#x6D88;&#x606F;&#x8BB0;&#x5F55;&#x548C;&#x5728;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x4E0A;&#x8DD1;&#x7740;&#x7684;&#x4EFB;&#x610F;&#x7684;&#x7528;&#x6237;&#x6570;&#x636E;&#x3002;&#x952E;&#x503C;&#x5BF9;&#x7684;Annotation&#x65B9;&#x5F0F;&#x7528;&#x6765;&#x5728;&#x5206;&#x5E03;&#x5F0F;&#x8FFD;&#x8E2A;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x5B9A;&#x4E49;&#x67D0;&#x4E2A;&#x7279;&#x5B9A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x76F8;&#x5173;&#x7C7B;&#x578B;&#x3002;</p>
<h2 id="2-4-&#x91C7;&#x6837;&#x7387;"><a href="#2-4-&#x91C7;&#x6837;&#x7387;" class="headerlink" title="2.4 &#x91C7;&#x6837;&#x7387;"></a>2.4 &#x91C7;&#x6837;&#x7387;</h2><p>&#x4F4E;&#x635F;&#x8017;&#x7684;&#x662F;Dapper&#x7684;&#x4E00;&#x4E2A;&#x5173;&#x952E;&#x7684;&#x8BBE;&#x8BA1;&#x76EE;&#x6807;&#xFF0C;&#x56E0;&#x4E3A;&#x5982;&#x679C;&#x8FD9;&#x4E2A;&#x5DE5;&#x5177;&#x4EF7;&#x503C;&#x672A;&#x88AB;&#x8BC1;&#x5B9E;&#x4F46;&#x53C8;&#x5BF9;&#x6027;&#x80FD;&#x6709;&#x5F71;&#x54CD;&#x7684;&#x8BDD;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x670D;&#x52A1;&#x8FD0;&#x8425;&#x4EBA;&#x5458;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x613F;&#x610F;&#x90E8;&#x7F72;&#x5B83;&#x3002;&#x51B5;&#x4E14;&#xFF0C;&#x6211;&#x4EEC;&#x60F3;&#x8BA9;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x4F7F;&#x7528;Annotation&#x7684;API&#xFF0C;&#x800C;&#x4E0D;&#x7528;&#x62C5;&#x5FC3;&#x989D;&#x5916;&#x7684;&#x5F00;&#x9500;&#x3002;&#x6211;&#x4EEC;&#x8FD8;&#x53D1;&#x73B0;&#xFF0C;&#x67D0;&#x4E9B;&#x7C7B;&#x578B;&#x7684;Web&#x670D;&#x52A1;&#x5BF9;&#x690D;&#x5165;&#x5E26;&#x6765;&#x7684;&#x6027;&#x80FD;&#x635F;&#x8017;&#x786E;&#x5B9E;&#x975E;&#x5E38;&#x654F;&#x611F;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x9664;&#x4E86;&#x628A;Dapper&#x7684;&#x6536;&#x96C6;&#x5DE5;&#x4F5C;&#x5BF9;&#x57FA;&#x672C;&#x7EC4;&#x4EF6;&#x7684;&#x6027;&#x80FD;&#x635F;&#x8017;&#x9650;&#x5236;&#x7684;&#x5C3D;&#x53EF;&#x80FD;&#x5C0F;&#x4E4B;&#x5916;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x6709;&#x8FDB;&#x4E00;&#x6B65;&#x63A7;&#x5236;&#x635F;&#x8017;&#x7684;&#x529E;&#x6CD5;&#xFF0C;&#x90A3;&#x5C31;&#x662F;&#x9047;&#x5230;&#x5927;&#x91CF;&#x8BF7;&#x6C42;&#x65F6;&#x53EA;&#x8BB0;&#x5F55;&#x5176;&#x4E2D;&#x7684;&#x4E00;&#x5C0F;&#x90E8;&#x5206;&#x3002;&#x6211;&#x4EEC;&#x5C06;&#x5728;4.4&#x8282;&#x4E2D;&#x8BA8;&#x8BBA;&#x8DDF;&#x8E2A;&#x7684;&#x91C7;&#x6837;&#x7387;&#x65B9;&#x6848;&#x7684;&#x66F4;&#x591A;&#x7EC6;&#x8282;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/c2c9523198450649e8d7f93445a87c314004f76c26b711919b090814d1a03ef7" alt><br>&#x56FE;5&#xFF1A;Dapper&#x6536;&#x96C6;&#x7BA1;&#x9053;&#x7684;&#x603B;&#x89C8;</p>
<h2 id="2-5-&#x8DDF;&#x8E2A;&#x7684;&#x6536;&#x96C6;"><a href="#2-5-&#x8DDF;&#x8E2A;&#x7684;&#x6536;&#x96C6;" class="headerlink" title="2.5 &#x8DDF;&#x8E2A;&#x7684;&#x6536;&#x96C6;"></a>2.5 &#x8DDF;&#x8E2A;&#x7684;&#x6536;&#x96C6;</h2><p>Dapper&#x7684;&#x8DDF;&#x8E2A;&#x8BB0;&#x5F55;&#x548C;&#x6536;&#x96C6;&#x7BA1;&#x9053;&#x7684;&#x8FC7;&#x7A0B;&#x5206;&#x4E3A;&#x4E09;&#x4E2A;&#x9636;&#x6BB5;&#xFF08;&#x53C2;&#x89C1;&#x56FE;5&#xFF09;&#x3002;&#x9996;&#x5148;&#xFF0C;span&#x6570;&#x636E;&#x5199;&#x5165;&#xFF08;1&#xFF09;&#x672C;&#x5730;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x4E2D;&#x3002;&#x7136;&#x540E;Dapper&#x7684;&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x548C;&#x6536;&#x96C6;&#x7EC4;&#x4EF6;&#x628A;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#x4ECE;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x7684;&#x4E3B;&#x673A;&#x4E2D;&#x62C9;&#x51FA;&#x6765;&#xFF08;2&#xFF09;&#xFF0C;&#x6700;&#x7EC8;&#x5199;&#x5230;&#xFF08;3&#xFF09;Dapper&#x7684;Bigtable&#x4ED3;&#x5E93;&#x4E2D;&#x3002;&#x4E00;&#x6B21;&#x8DDF;&#x8E2A;&#x88AB;&#x8BBE;&#x8BA1;&#x6210;Bigtable&#x4E2D;&#x7684;&#x4E00;&#x884C;&#xFF0C;&#x6BCF;&#x4E00;&#x5217;&#x76F8;&#x5F53;&#x4E8E;&#x4E00;&#x4E2A;span&#x3002;Bigtable&#x7684;&#x652F;&#x6301;&#x7A00;&#x758F;&#x8868;&#x683C;&#x5E03;&#x5C40;&#x6B63;&#x9002;&#x5408;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x56E0;&#x4E3A;&#x6BCF;&#x4E00;&#x6B21;&#x8DDF;&#x8E2A;&#x53EF;&#x4EE5;&#x6709;&#x4EFB;&#x610F;&#x591A;&#x4E2A;span&#x3002;&#x8DDF;&#x8E2A;&#x6570;&#x636E;&#x6536;&#x96C6;&#xFF08;&#x5373;&#x4ECE;&#x5E94;&#x7528;&#x4E2D;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x6570;&#x636E;&#x4F20;&#x8F93;&#x5230;&#x4E2D;&#x592E;&#x4ED3;&#x5E93;&#x6240;&#x82B1;&#x8D39;&#x7684;&#x65F6;&#x95F4;&#xFF09;&#x7684;&#x5EF6;&#x8FDF;&#x4E2D;&#x4F4D;&#x6570;&#x5C11;&#x4E8E;15&#x79D2;&#x3002;&#x7B2C;98&#x767E;&#x5206;&#x4F4D;&#x7684;&#x5EF6;&#x8FDF;(The<br> 98th percentile latency)&#x5F80;&#x5F80;&#x968F;&#x7740;&#x65F6;&#x95F4;&#x7684;&#x63A8;&#x79FB;&#x5448;&#x73B0;&#x53CC;&#x5CF0;&#x578B;;&#x5927;&#x7EA6;75%&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x7B2C;98&#x767E;&#x5206;&#x4F4D;&#x7684;&#x5EF6;&#x8FDF;&#x65F6;&#x95F4;&#x5C0F;&#x4E8E;2&#x5206;&#x949F;&#xFF0C;&#x4F46;&#x662F;&#x53E6;&#x5916;&#x5927;&#x7EA6;25%&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x589E;&#x6DA8;&#x5230;&#x51E0;&#x4E2A;&#x5C0F;&#x65F6;&#x3002;</p>
<p>Dapper&#x8FD8;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;API&#x6765;&#x7B80;&#x5316;&#x8BBF;&#x95EE;&#x6211;&#x4EEC;&#x4ED3;&#x5E93;&#x4E2D;&#x7684;&#x8DDF;&#x8E2A;&#x6570;&#x636E;&#x3002; Google&#x7684;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x7528;&#x8FD9;&#x4E2A;API&#xFF0C;&#x4EE5;&#x6784;&#x5EFA;&#x901A;&#x7528;&#x548C;&#x7279;&#x5B9A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x5206;&#x6790;&#x5DE5;&#x5177;&#x3002;&#x7B2C;5.1&#x8282;&#x5305;&#x542B;&#x66F4;&#x591A;&#x5982;&#x4F55;&#x4F7F;&#x7528;&#x5B83;&#x7684;&#x4FE1;&#x606F;&#x3002;</p>
<h2 id="2-5-1-&#x5E26;&#x5916;&#x6570;&#x636E;&#x8DDF;&#x8E2A;&#x6536;&#x96C6;"><a href="#2-5-1-&#x5E26;&#x5916;&#x6570;&#x636E;&#x8DDF;&#x8E2A;&#x6536;&#x96C6;" class="headerlink" title="2.5.1 &#x5E26;&#x5916;&#x6570;&#x636E;&#x8DDF;&#x8E2A;&#x6536;&#x96C6;"></a>2.5.1 &#x5E26;&#x5916;&#x6570;&#x636E;&#x8DDF;&#x8E2A;&#x6536;&#x96C6;</h2><p>tip1:&#x5E26;&#x5916;&#x6570;&#x636E;:&#x4F20;&#x8F93;&#x5C42;&#x534F;&#x8BAE;&#x4F7F;&#x7528;&#x5E26;&#x5916;&#x6570;&#x636E;(out-of-band&#xFF0C;OOB)&#x6765;&#x53D1;&#x9001;&#x4E00;&#x4E9B;&#x91CD;&#x8981;&#x7684;&#x6570;&#x636E;,&#x5982;&#x679C;&#x901A;&#x4FE1;&#x4E00;&#x65B9;&#x6709;&#x91CD;&#x8981;&#x7684;&#x6570;&#x636E;&#x9700;&#x8981;&#x901A;&#x77E5;&#x5BF9;&#x65B9;&#x65F6;,&#x534F;&#x8BAE;&#x80FD;&#x591F;&#x5C06;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#x5FEB;&#x901F;&#x5730;&#x53D1;&#x9001;&#x5230;&#x5BF9;&#x65B9;&#x3002;&#x4E3A;&#x4E86;&#x53D1;&#x9001;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#xFF0C;&#x534F;&#x8BAE;&#x4E00;&#x822C;&#x4E0D;&#x4F7F;&#x7528;&#x4E0E;&#x666E;&#x901A;&#x6570;&#x636E;&#x76F8;&#x540C;&#x7684;&#x901A;&#x9053;,&#x800C;&#x662F;&#x4F7F;&#x7528;&#x53E6;&#x5916;&#x7684;&#x901A;&#x9053;&#x3002;</p>
<p>tip2:&#x8FD9;&#x91CC;&#x6307;&#x7684;in-band&#x7B56;&#x7565;&#x662F;&#x628A;&#x8DDF;&#x8E2A;&#x6570;&#x636E;&#x968F;&#x7740;&#x8C03;&#x7528;&#x94FE;&#x8FDB;&#x884C;&#x4F20;&#x9001;&#xFF0C;out-of-band&#x662F;&#x901A;&#x8FC7;&#x5176;&#x4ED6;&#x7684;&#x94FE;&#x8DEF;&#x8FDB;&#x884C;&#x8DDF;&#x8E2A;&#x6570;&#x636E;&#x7684;&#x6536;&#x96C6;&#xFF0C;Dapper&#x7684;&#x5199;&#x65E5;&#x5FD7;&#x7136;&#x540E;&#x8FDB;&#x884C;&#x65E5;&#x5FD7;&#x91C7;&#x96C6;&#x7684;&#x65B9;&#x5F0F;&#x5C31;&#x5C5E;&#x4E8E;out-of-band&#x7B56;&#x7565;</p>
<p>Dapper&#x7CFB;&#x7EDF;&#x8BF7;&#x6C42;&#x6811;&#x6811;&#x81EA;&#x8EAB;&#x8FDB;&#x884C;&#x8DDF;&#x8E2A;&#x8BB0;&#x5F55;&#x548C;&#x6536;&#x96C6;&#x5E26;&#x5916;&#x6570;&#x636E;&#x3002;&#x8FD9;&#x6837;&#x505A;&#x662F;&#x4E3A;&#x4E24;&#x4E2A;&#x4E0D;&#x76F8;&#x5173;&#x7684;&#x539F;&#x56E0;&#x3002;&#x9996;&#x5148;&#xFF0C;&#x5E26;&#x5185;&#x6536;&#x96C6;&#x65B9;&#x6848;&#x2013;&#x8FD9;&#x91CC;&#x8DDF;&#x8E2A;&#x6570;&#x636E;&#x4F1A;&#x4EE5;RPC&#x54CD;&#x5E94;&#x5934;&#x7684;&#x5F62;&#x5F0F;&#x88AB;&#x8FD4;&#x56DE;&#x2013;&#x4F1A;&#x5F71;&#x54CD;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7F51;&#x7EDC;&#x52A8;&#x6001;&#x3002;&#x5728;Google&#x91CC;&#x7684;&#x8BB8;&#x591A;&#x89C4;&#x6A21;&#x8F83;&#x5927;&#x7684;&#x7CFB;&#x7EDF;&#x4E2D;&#xFF0C;&#x4E00;&#x6B21;&#x8DDF;&#x8E2A;&#x6210;&#x5343;&#x4E0A;&#x4E07;&#x7684;span&#x5E76;&#x4E0D;&#x5C11;&#x89C1;&#x3002;&#x7136;&#x800C;&#xFF0C;RPC&#x56DE;&#x5E94;&#x5927;&#x5C0F;&#x2013;&#x751A;&#x81F3;&#x662F;&#x63A5;&#x8FD1;&#x5927;&#x578B;&#x5206;&#x5E03;&#x5F0F;&#x7684;&#x8DDF;&#x8E2A;&#x7684;&#x6839;&#x8282;&#x70B9;&#x7684;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#x2013; &#x4ECD;&#x7136;&#x662F;&#x6BD4;&#x8F83;&#x5C0F;&#x7684;&#xFF1A;&#x901A;&#x5E38;&#x5C0F;&#x4E8E;10K&#x3002;&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5E26;&#x5185;Dapper&#x7684;&#x8DDF;&#x8E2A;&#x6570;&#x636E;&#x4F1A;&#x8BA9;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6570;&#x636E;&#x548C;&#x503E;&#x5411;&#x4E8E;&#x4F7F;&#x7528;&#x540E;&#x7EED;&#x5206;&#x6790;&#x7ED3;&#x679C;&#x7684;&#x6570;&#x636E;&#x91CF;&#x76F8;&#x5F62;&#x89C1;&#x7ECC;&#x3002;&#x5176;&#x6B21;&#xFF0C;&#x5E26;&#x5185;&#x6536;&#x96C6;&#x65B9;&#x6848;&#x5047;&#x5B9A;&#x6240;&#x6709;&#x7684;RPC&#x662F;&#x5B8C;&#x7F8E;&#x5D4C;&#x5957;&#x7684;&#x3002;&#x6211;&#x4EEC;&#x53D1;&#x73B0;&#xFF0C;&#x5728;&#x6240;&#x6709;&#x7684;&#x540E;&#x7AEF;&#x7684;&#x7CFB;&#x7EDF;&#x8FD4;&#x56DE;&#x7684;&#x6700;&#x7EC8;&#x7ED3;&#x679C;&#x4E4B;&#x524D;&#xFF0C;&#x6709;&#x8BB8;&#x591A;&#x4E2D;&#x95F4;&#x4EF6;&#x4F1A;&#x628A;&#x7ED3;&#x679C;&#x8FD4;&#x56DE;&#x7ED9;&#x4ED6;&#x4EEC;&#x7684;&#x8C03;&#x7528;&#x8005;&#x3002;&#x5E26;&#x5185;&#x6536;&#x96C6;&#x7CFB;&#x7EDF;&#x662F;&#x65E0;&#x6CD5;&#x89E3;&#x91CA;&#x8FD9;&#x79CD;&#x975E;&#x5D4C;&#x5957;&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x6267;&#x884C;&#x6A21;&#x5F0F;&#x7684;&#x3002;</p>
<h2 id="2-6-&#x5B89;&#x5168;&#x548C;&#x9690;&#x79C1;&#x8003;&#x8651;"><a href="#2-6-&#x5B89;&#x5168;&#x548C;&#x9690;&#x79C1;&#x8003;&#x8651;" class="headerlink" title="2.6 &#x5B89;&#x5168;&#x548C;&#x9690;&#x79C1;&#x8003;&#x8651;"></a>2.6 &#x5B89;&#x5168;&#x548C;&#x9690;&#x79C1;&#x8003;&#x8651;</h2><p>&#x8BB0;&#x5F55;&#x4E00;&#x5B9A;&#x91CF;&#x7684;RPC&#x6709;&#x6548;&#x8D1F;&#x8F7D;&#x4FE1;&#x606F;&#x5C06;&#x4E30;&#x5BCC;Dapper&#x7684;&#x8DDF;&#x8E2A;&#x80FD;&#x529B;&#xFF0C;&#x56E0;&#x4E3A;&#x5206;&#x6790;&#x5DE5;&#x5177;&#x80FD;&#x591F;&#x5728;&#x6709;&#x6548;&#x8F7D;&#x8377;&#x6570;&#x636E;&#xFF08;&#x65B9;&#x6CD5;&#x4F20;&#x9012;&#x7684;&#x53C2;&#x6570;&#xFF09;&#x4E2D;&#x627E;&#x5230;&#x76F8;&#x5173;&#x7684;&#x6837;&#x4F8B;&#xFF0C;&#x8FD9;&#x4E9B;&#x6837;&#x4F8B;&#x53EF;&#x4EE5;&#x89E3;&#x91CA;&#x88AB;&#x76D1;&#x63A7;&#x7CFB;&#x7EDF;&#x7684;&#x4E3A;&#x4F55;&#x8868;&#x73B0;&#x5F02;&#x5E38;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x6709;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6709;&#x6548;&#x8F7D;&#x8377;&#x6570;&#x636E;&#x53EF;&#x80FD;&#x5305;&#x542B;&#x7684;&#x4E00;&#x4E9B;&#x4E0D;&#x5E94;&#x8BE5;&#x900F;&#x9732;&#x7ED9;&#x672A;&#x7ECF;&#x6388;&#x6743;&#x7528;&#x6237;(&#x5305;&#x62EC;&#x6B63;&#x5728;debug&#x7684;&#x5DE5;&#x7A0B;&#x5E08;)&#x7684;&#x5185;&#x90E8;&#x4FE1;&#x606F;&#x3002;</p>
<p>&#x7531;&#x4E8E;&#x5B89;&#x5168;&#x548C;&#x9690;&#x79C1;&#x95EE;&#x9898;&#x662F;&#x4E0D;&#x53EF;&#x5FFD;&#x7565;&#x7684;&#xFF0C;dapper&#x4E2D;&#x7684;&#x867D;&#x7136;&#x5B58;&#x50A8;RPC&#x65B9;&#x6CD5;&#x7684;&#x540D;&#x79F0;&#xFF0C;&#x4F46;&#x5728;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x4E0D;&#x8BB0;&#x5F55;&#x4EFB;&#x4F55;&#x6709;&#x6548;&#x8F7D;&#x8377;&#x6570;&#x636E;&#x3002;&#x76F8;&#x53CD;&#xFF0C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7EA7;&#x522B;&#x7684;Annotation&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x65B9;&#x4FBF;&#x7684;&#x53EF;&#x9009;&#x673A;&#x5236;&#xFF1A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x53EF;&#x4EE5;&#x5728;span&#x4E2D;&#x9009;&#x62E9;&#x5173;&#x8054;&#x90A3;&#x4E9B;&#x4E3A;&#x4EE5;&#x540E;&#x5206;&#x6790;&#x63D0;&#x4F9B;&#x4EF7;&#x503C;&#x7684;&#x6570;&#x636E;&#x3002;</p>
<p>Dapper&#x8FD8;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E9B;&#x5B89;&#x5168;&#x4E0A;&#x7684;&#x4FBF;&#x5229;&#xFF0C;&#x662F;&#x5B83;&#x7684;&#x8BBE;&#x8BA1;&#x8005;&#x4E8B;&#x5148;&#x6CA1;&#x6709;&#x9884;&#x6599;&#x5230;&#x7684;&#x3002;&#x901A;&#x8FC7;&#x8DDF;&#x8E2A;&#x516C;&#x5F00;&#x7684;&#x5B89;&#x5168;&#x534F;&#x8BAE;&#x53C2;&#x6570;&#xFF0C;Dapper&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x76F8;&#x5E94;&#x7EA7;&#x522B;&#x7684;&#x8BA4;&#x8BC1;&#x6216;&#x52A0;&#x5BC6;&#xFF0C;&#x6765;&#x76D1;&#x89C6;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x662F;&#x5426;&#x6EE1;&#x8DB3;&#x5B89;&#x5168;&#x7B56;&#x7565;&#x3002;&#x4F8B;&#x5982;&#x3002;Dapper&#x8FD8;&#x53EF;&#x4EE5;&#x63D0;&#x4F9B;&#x4FE1;&#x606F;&#xFF0C;&#x4EE5;&#x57FA;&#x4E8E;&#x7B56;&#x7565;&#x7684;&#x7684;&#x9694;&#x79BB;&#x7CFB;&#x7EDF;&#x6309;&#x9884;&#x671F;&#x6267;&#x884C;&#xFF0C;&#x4F8B;&#x5982;&#x652F;&#x6491;&#x654F;&#x611F;&#x6570;&#x636E;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E0D;&#x4E0E;&#x672A;&#x7ECF;&#x6388;&#x6743;&#x7684;&#x7CFB;&#x7EDF;&#x7EC4;&#x4EF6;&#x8FDB;&#x884C;&#x4E86;&#x4EA4;&#x4E92;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x6D4B;&#x7B97;&#x63D0;&#x4F9B;&#x4E86;&#x6BD4;&#x6E90;&#x7801;&#x5BA1;&#x6838;&#x66F4;&#x5F3A;&#x5927;&#x7684;&#x4FDD;&#x969C;&#x3002;</p>
<ol start="3">
<li>Dapper&#x90E8;&#x7F72;&#x72B6;&#x51B5;</li>
</ol>
<hr>
<p>Dapper&#x4F5C;&#x4E3A;&#x6211;&#x4EEC;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E0B;&#x7684;&#x8DDF;&#x8E2A;&#x7CFB;&#x7EDF;&#x5DF2;&#x7ECF;&#x8D85;&#x8FC7;&#x4E24;&#x5E74;&#x3002;&#x5728;&#x672C;&#x8282;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x6C47;&#x62A5;&#x7CFB;&#x7EDF;&#x72B6;&#x6001;&#xFF0C;&#x628A;&#x91CD;&#x70B9;&#x653E;&#x5728;Dapper&#x5982;&#x4F55;&#x6EE1;&#x8DB3;&#x4E86;&#x6211;&#x4EEC;&#x7684;&#x76EE;&#x6807;&#x2014;&#x2014;&#x65E0;&#x5904;&#x4E0D;&#x5728;&#x7684;&#x90E8;&#x7F72;&#x548C;&#x5E94;&#x7528;&#x7EA7;&#x7684;&#x900F;&#x660E;&#x3002;</p>
<h2 id="3-1-Dapper&#x8FD0;&#x884C;&#x5E93;"><a href="#3-1-Dapper&#x8FD0;&#x884C;&#x5E93;" class="headerlink" title="3.1 Dapper&#x8FD0;&#x884C;&#x5E93;"></a>3.1 Dapper&#x8FD0;&#x884C;&#x5E93;</h2><p>&#x4E5F;&#x8BB8;Dapper&#x4EE3;&#x7801;&#x4E2D;&#x4E2D;&#x6700;&#x5173;&#x952E;&#x7684;&#x90E8;&#x5206;&#xFF0C;&#x5C31;&#x662F;&#x5BF9;&#x57FA;&#x7840;RPC&#x3001;&#x7EBF;&#x7A0B;&#x63A7;&#x5236;&#x548C;&#x6D41;&#x7A0B;&#x63A7;&#x5236;&#x7684;&#x7EC4;&#x4EF6;&#x5E93;&#x7684;&#x690D;&#x5165;&#xFF0C;&#x5176;&#x4E2D;&#x5305;&#x62EC;span&#x7684;&#x521B;&#x5EFA;&#xFF0C;&#x91C7;&#x6837;&#x7387;&#x7684;&#x8BBE;&#x7F6E;&#xFF0C;&#x4EE5;&#x53CA;&#x628A;&#x65E5;&#x5FD7;&#x5199;&#x5165;&#x672C;&#x5730;&#x78C1;&#x76D8;&#x3002;&#x9664;&#x4E86;&#x505A;&#x5230;&#x8F7B;&#x91CF;&#x7EA7;&#xFF0C;&#x690D;&#x5165;&#x7684;&#x4EE3;&#x7801;&#x66F4;&#x9700;&#x8981;&#x7A33;&#x5B9A;&#x548C;&#x5065;&#x58EE;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4E0E;&#x6D77;&#x91CF;&#x7684;&#x5E94;&#x7528;&#x5BF9;&#x63A5;&#xFF0C;&#x7EF4;&#x62A4;&#x548C;bug&#x4FEE;&#x590D;&#x53D8;&#x5F97;&#x56F0;&#x96BE;&#x3002;&#x690D;&#x5165;&#x7684;&#x6838;&#x5FC3;&#x4EE3;&#x7801;&#x662F;&#x7531;&#x672A;&#x8D85;&#x8FC7;1000&#x884C;&#x7684;C++&#x548C;&#x4E0D;&#x8D85;&#x8FC7;800&#x884C;Java&#x4EE3;&#x7801;&#x7EC4;&#x6210;&#x3002;&#x4E3A;&#x4E86;&#x652F;&#x6301;&#x952E;&#x503C;&#x5BF9;&#x7684;Annotation&#x8FD8;&#x6DFB;&#x52A0;&#x4E86;&#x989D;&#x5916;&#x7684;500&#x884C;&#x4EE3;&#x7801;&#x3002;</p>
<h2 id="3-2-&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E0B;&#x7684;&#x6DB5;&#x76D6;&#x9762;"><a href="#3-2-&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E0B;&#x7684;&#x6DB5;&#x76D6;&#x9762;" class="headerlink" title="3.2 &#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E0B;&#x7684;&#x6DB5;&#x76D6;&#x9762;"></a>3.2 &#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E0B;&#x7684;&#x6DB5;&#x76D6;&#x9762;</h2><p>Dapper&#x7684;&#x6E17;&#x900F;&#x53EF;&#x4EE5;&#x603B;&#x7ED3;&#x4E3A;&#x4E24;&#x4E2A;&#x65B9;&#x9762;&#xFF1A;&#x4E00;&#x65B9;&#x9762;&#x662F;&#x53EF;&#x4EE5;&#x521B;&#x5EFA;Dapper&#x8DDF;&#x8E2A;&#x7684;&#x8FC7;&#x7A0B;(&#x4E0E;Dapper&#x690D;&#x5165;&#x7684;&#x7EC4;&#x4EF6;&#x5E93;&#x76F8;&#x5173;)&#xFF0C;&#x548C;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E0B;&#x7684;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x5728;&#x8FD0;&#x884C;Dapper&#x8DDF;&#x8E2A;&#x6536;&#x96C6;&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x3002;Dapper&#x7684;&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x7684;&#x5206;&#x5E03;&#x76F8;&#x5F53;&#x4E8E;&#x6211;&#x4EEC;&#x670D;&#x52A1;&#x5668;&#x7684;&#x7B80;&#x5355;&#x7684;&#x62D3;&#x6251;&#x56FE;&#xFF0C;&#x5B83;&#x5B58;&#x5728;&#x4E8E;Google&#x51E0;&#x4E4E;&#x6240;&#x6709;&#x7684;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x3002;&#x8FD9;&#x5F88;&#x96BE;&#x786E;&#x5B9A;&#x7CBE;&#x786E;&#x7684;Dapper-ready&#x8FDB;&#x7A0B;&#x90E8;&#x5206;&#xFF0C;&#x56E0;&#x4E3A;&#x8FC7;&#x7A0B;&#x5373;&#x4FBF;&#x4E0D;&#x4EA7;&#x751F;&#x8DDF;&#x8E2A;&#x4FE1;&#x606F;Dapper&#x4E5F;&#x662F;&#x65E0;&#x4ECE;&#x77E5;&#x6653;&#x7684;&#x3002;&#x5C3D;&#x7BA1;&#x5982;&#x6B64;&#xFF0C;&#x8003;&#x8651;&#x5230;&#x65E0;&#x5904;&#x4E0D;&#x5728;Dapper&#x7EC4;&#x4EF6;&#x7684;&#x690D;&#x5165;&#x5E93;&#xFF0C;&#x6211;&#x4EEC;&#x4F30;&#x8BA1;&#x51E0;&#x4E4E;&#x6BCF;&#x4E00;&#x4E2A;Google&#x7684;&#x751F;&#x4EA7;&#x8FDB;&#x7A0B;&#x90FD;&#x662F;&#x652F;&#x6301;&#x8DDF;&#x8E2A;&#x7684;&#x3002;</p>
<p>&#x5728;&#x67D0;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;Dapper&#x7684;&#x662F;&#x4E0D;&#x80FD;&#x6B63;&#x786E;&#x7684;&#x8DDF;&#x8E2A;&#x63A7;&#x5236;&#x8DEF;&#x5F84;&#x7684;&#x3002;&#x8FD9;&#x4E9B;&#x901A;&#x5E38;&#x6E90;&#x4E8E;&#x4F7F;&#x7528;&#x975E;&#x6807;&#x51C6;&#x7684;&#x63A7;&#x5236;&#x6D41;&#xFF0C;&#x6216;&#x662F;Dapper&#x7684;&#x9519;&#x8BEF;&#x7684;&#x628A;&#x8DEF;&#x5F84;&#x5173;&#x8054;&#x5F52;&#x5230;&#x4E0D;&#x76F8;&#x5173;&#x7684;&#x4E8B;&#x4EF6;&#x4E0A;&#x3002;Dapper&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x5E93;&#x6765;&#x5E2E;&#x52A9;&#x5F00;&#x53D1;&#x8005;&#x624B;&#x52A8;&#x63A7;&#x5236;&#x8DDF;&#x8E2A;&#x4F20;&#x64AD;&#x4F5C;&#x4E3A;&#x4E00;&#x79CD;&#x53D8;&#x901A;&#x65B9;&#x6CD5;&#x3002;&#x76EE;&#x524D;&#x6709;40&#x4E2A;C++&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x548C;33&#x4E2A;Java&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x9700;&#x8981;&#x4E00;&#x4E9B;&#x624B;&#x52A8;&#x63A7;&#x5236;&#x7684;&#x8FFD;&#x8E2A;&#x4F20;&#x64AD;&#xFF0C;&#x4E0D;&#x8FC7;&#x8FD9;&#x53EA;&#x662F;&#x4E0A;&#x5343;&#x4E2A;&#x7684;&#x8DDF;&#x8E2A;&#x4E2D;&#x7684;&#x4E00;&#x5C0F;&#x90E8;&#x5206;&#x3002;&#x4E5F;&#x6709;&#x975E;&#x5E38;&#x5C0F;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x7A0B;&#x5E8F;&#x4F7F;&#x7528;&#x7684;&#x975E;&#x7EC4;&#x4EF6;&#x6027;&#x8D28;&#x7684;&#x901A;&#x4FE1;&#x5E93;&#xFF08;&#x6BD4;&#x5982;&#x539F;&#x751F;&#x7684;TCP Socket&#x6216;SOAP RPC&#xFF09;&#xFF0C;&#x56E0;&#x6B64;&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x652F;&#x6301;Dapper&#x7684;&#x8DDF;&#x8E2A;&#x3002;&#x4F46;&#x662F;&#x8FD9;&#x4E9B;&#x5E94;&#x7528;&#x53EF;&#x4EE5;&#x5355;&#x72EC;&#x63A5;&#x5165;&#x5230;Dapper&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x9700;&#x8981;&#x7684;&#x8BDD;&#x3002;</p>
<p>&#x8003;&#x8651;&#x5230;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x7684;&#x5B89;&#x5168;&#xFF0C;Dapper&#x7684;&#x8DDF;&#x8E2A;&#x4E5F;&#x53EF;&#x4EE5;&#x5173;&#x95ED;&#x3002;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;&#x5B83;&#x5728;&#x90E8;&#x7F72;&#x7684;&#x65E9;&#x8D77;&#x5C31;&#x662F;&#x9ED8;&#x8BA4;&#x5173;&#x95ED;&#x7684;&#xFF0C;&#x76F4;&#x5230;&#x6211;&#x4EEC;&#x5BF9;Dapper&#x7684;&#x7A33;&#x5B9A;&#x6027;&#x548C;&#x4F4E;&#x635F;&#x8017;&#x6709;&#x4E86;&#x8DB3;&#x591F;&#x7684;&#x4FE1;&#x5FC3;&#x4E4B;&#x540E;&#x624D;&#x628A;&#x5B83;&#x5F00;&#x542F;&#x3002;Dapper&#x7684;&#x56E2;&#x961F;&#x5076;&#x5C14;&#x4F1A;&#x6267;&#x884C;&#x5BA1;&#x67E5;&#x5BFB;&#x627E;&#x8DDF;&#x8E2A;&#x914D;&#x7F6E;&#x7684;&#x53D8;&#x5316;&#xFF0C;&#x6765;&#x770B;&#x770B;&#x90A3;&#x4E9B;&#x670D;&#x52A1;&#x5173;&#x95ED;&#x4E86;Dapper&#x7684;&#x8DDF;&#x8E2A;&#x3002;&#x4F46;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0D;&#x591A;&#x89C1;&#xFF0C;&#x800C;&#x4E14;&#x901A;&#x5E38;&#x662F;&#x6E90;&#x4E8E;&#x5BF9;&#x76D1;&#x63A7;&#x5BF9;&#x6027;&#x80FD;&#x6D88;&#x8017;&#x7684;&#x62C5;&#x5FE7;&#x3002;&#x7ECF;&#x8FC7;&#x4E86;&#x5BF9;&#x5B9E;&#x9645;&#x6027;&#x80FD;&#x6D88;&#x8017;&#x7684;&#x8FDB;&#x4E00;&#x6B65;&#x8C03;&#x67E5;&#x548C;&#x6D4B;&#x91CF;&#xFF0C;&#x6240;&#x6709;&#x8FD9;&#x4E9B;&#x5173;&#x95ED;Dapper&#x8DDF;&#x8E2A;&#x90FD;&#x5DF2;&#x7ECF;&#x6062;&#x590D;&#x5F00;&#x542F;&#x4E86;&#xFF0C;&#x4E0D;&#x8FC7;&#x8FD9;&#x4E9B;&#x5DF2;&#x7ECF;&#x4E0D;&#x91CD;&#x8981;&#x4E86;&#x3002;</p>
<h2 id="3-3-&#x8DDF;&#x8E2A;Annotation&#x7684;&#x4F7F;&#x7528;"><a href="#3-3-&#x8DDF;&#x8E2A;Annotation&#x7684;&#x4F7F;&#x7528;" class="headerlink" title="3.3 &#x8DDF;&#x8E2A;Annotation&#x7684;&#x4F7F;&#x7528;"></a>3.3 &#x8DDF;&#x8E2A;Annotation&#x7684;&#x4F7F;&#x7528;</h2><p>&#x7A0B;&#x5E8F;&#x5458;&#x503E;&#x5411;&#x4E8E;&#x4F7F;&#x7528;&#x7279;&#x5B9A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;Annotation&#xFF0C;&#x65E0;&#x8BBA;&#x662F;&#x4F5C;&#x4E3A;&#x4E00;&#x79CD;&#x5206;&#x5E03;&#x5F0F;&#x8C03;&#x8BD5;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#xFF0C;&#x8FD8;&#x662F;&#x901A;&#x8FC7;&#x4E00;&#x4E9B;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7279;&#x5B9A;&#x7684;&#x529F;&#x80FD;&#x5BF9;&#x8DDF;&#x8E2A;&#x8FDB;&#x884C;&#x5206;&#x7C7B;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x6240;&#x6709;&#x7684;Bigtable&#x7684;&#x8BF7;&#x6C42;&#x4F1A;&#x628A;&#x88AB;&#x8BBF;&#x95EE;&#x7684;&#x8868;&#x540D;&#x4E5F;&#x8BB0;&#x5F55;&#x5230;Annotation&#x4E2D;&#x3002;&#x76EE;&#x524D;&#xFF0C;70&#xFF05;&#x7684;Dapper span&#x548C;90&#xFF05;&#x7684;&#x6240;&#x6709;Dapper&#x8DDF;&#x8E2A;&#x90FD;&#x81F3;&#x5C11;&#x6709;&#x4E00;&#x4E2A;&#x7279;&#x6B8A;&#x5E94;&#x7528;&#x7684;Annotation&#x3002;</p>
<p>41&#x4E2A;Java&#x5E94;&#x7528;&#x548C;68&#x4E2A;C++&#x5E94;&#x7528;&#x4E2D;&#x90FD;&#x6DFB;&#x52A0;&#x81EA;&#x5B9A;&#x4E49;&#x7684;Annotation&#x4E3A;&#x4E86;&#x66F4;&#x597D;&#x5730;&#x7406;&#x89E3;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#x7684;span&#x5728;&#x4ED6;&#x4EEC;&#x7684;&#x670D;&#x52A1;&#x4E2D;&#x7684;&#x884C;&#x4E3A;&#x3002;&#x503C;&#x5F97;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x8FC4;&#x4ECA;&#x4E3A;&#x6B62;&#x6211;&#x4EEC;&#x7684;Java&#x5F00;&#x53D1;&#x8005;&#x6BD4;C++&#x5F00;&#x53D1;&#x8005;&#x66F4;&#x591A;&#x7684;&#x5728;&#x6BCF;&#x4E00;&#x4E2A;&#x8DDF;&#x8E2A;span&#x4E0A;&#x91C7;&#x7528;Annotation&#x7684;API&#x3002;&#x8FD9;&#x53EF;&#x80FD;&#x662F;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x7684;Java&#x5E94;&#x7528;&#x7684;&#x4F5C;&#x7528;&#x57DF;&#x5F80;&#x5F80;&#x662F;&#x66F4;&#x63A5;&#x8FD1;&#x6700;&#x7EC8;&#x7528;&#x6237;(C++&#x504F;&#x5E95;&#x5C42;);&#x8FD9;&#x4E9B;&#x7C7B;&#x578B;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7ECF;&#x5E38;&#x5904;&#x7406;&#x66F4;&#x5E7F;&#x6CDB;&#x7684;&#x8BF7;&#x6C42;&#x7EC4;&#x5408;&#xFF0C;&#x56E0;&#x6B64;&#x5177;&#x6709;&#x6BD4;&#x8F83;&#x590D;&#x6742;&#x7684;&#x63A7;&#x5236;&#x8DEF;&#x5F84;&#x3002;</p>
<ol start="4">
<li>&#x5904;&#x7406;&#x8DDF;&#x8E2A;&#x635F;&#x8017;</li>
</ol>
<hr>
<p>&#x8DDF;&#x8E2A;&#x7CFB;&#x7EDF;&#x7684;&#x6210;&#x672C;&#x7531;&#x4E24;&#x90E8;&#x5206;&#x7EC4;&#x6210;&#xFF1A;1.&#x6B63;&#x5728;&#x88AB;&#x76D1;&#x63A7;&#x7684;&#x7CFB;&#x7EDF;&#x5728;&#x751F;&#x6210;&#x8FFD;&#x8E2A;&#x548C;&#x6536;&#x96C6;&#x8FFD;&#x8E2A;&#x6570;&#x636E;&#x7684;&#x6D88;&#x8017;&#x5BFC;&#x81F4;&#x7CFB;&#x7EDF;&#x6027;&#x80FD;&#x4E0B;&#x964D;&#xFF0C;2&#x3002;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x4E00;&#x90E8;&#x5206;&#x8D44;&#x6E90;&#x6765;&#x5B58;&#x50A8;&#x548C;&#x5206;&#x6790;&#x8DDF;&#x8E2A;&#x6570;&#x636E;&#x3002;&#x867D;&#x7136;&#x4F60;&#x53EF;&#x4EE5;&#x8BF4;&#x4E00;&#x4E2A;&#x6709;&#x4EF7;&#x503C;&#x7684;&#x7EC4;&#x4EF6;&#x690D;&#x5165;&#x8DDF;&#x8E2A;&#x5E26;&#x6765;&#x4E00;&#x90E8;&#x5206;&#x6027;&#x80FD;&#x635F;&#x8017;&#x662F;&#x503C;&#x5F97;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x76F8;&#x4FE1;&#x5982;&#x679C;&#x57FA;&#x672C;&#x635F;&#x8017;&#x80FD;&#x8FBE;&#x5230;&#x53EF;&#x4EE5;&#x5FFD;&#x7565;&#x7684;&#x7A0B;&#x5EA6;&#xFF0C;&#x90A3;&#x4E48;&#x5BF9;&#x8DDF;&#x8E2A;&#x7CFB;&#x7EDF;&#x6700;&#x521D;&#x7684;&#x63A8;&#x5E7F;&#x4F1A;&#x6709;&#x6781;&#x5927;&#x7684;&#x5E2E;&#x52A9;&#x3002;</p>
<p>&#x5728;&#x672C;&#x8282;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x5C55;&#x73B0;&#x4E00;&#x4E0B;&#x4E09;&#x4E2A;&#x65B9;&#x9762;&#xFF1A;Dapper&#x7EC4;&#x4EF6;&#x64CD;&#x4F5C;&#x7684;&#x6D88;&#x8017;&#xFF0C;&#x8DDF;&#x8E2A;&#x6536;&#x96C6;&#x7684;&#x6D88;&#x8017;&#xFF0C;&#x4EE5;&#x53CA;Dapper&#x5BF9;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x8D1F;&#x8F7D;&#x7684;&#x5F71;&#x54CD;&#x3002;&#x6211;&#x4EEC;&#x8FD8;&#x4ECB;&#x7ECD;&#x4E86;Dapper&#x53EF;&#x8C03;&#x8282;&#x7684;&#x91C7;&#x6837;&#x7387;&#x673A;&#x5236;&#x5982;&#x4F55;&#x5E2E;&#x6211;&#x4EEC;&#x5904;&#x7406;&#x4F4E;&#x635F;&#x8017;&#x548C;&#x8DDF;&#x8E2A;&#x4EE3;&#x8868;&#x6027;&#x4E4B;&#x95F4;&#x7684;&#x5E73;&#x8861;&#x548C;&#x53D6;&#x820D;&#x3002;</p>
<h2 id="4-1-&#x751F;&#x6210;&#x8DDF;&#x8E2A;&#x7684;&#x635F;&#x8017;"><a href="#4-1-&#x751F;&#x6210;&#x8DDF;&#x8E2A;&#x7684;&#x635F;&#x8017;" class="headerlink" title="4.1 &#x751F;&#x6210;&#x8DDF;&#x8E2A;&#x7684;&#x635F;&#x8017;"></a>4.1 &#x751F;&#x6210;&#x8DDF;&#x8E2A;&#x7684;&#x635F;&#x8017;</h2><p>&#x751F;&#x6210;&#x8DDF;&#x8E2A;&#x7684;&#x5F00;&#x9500;&#x662F;Dapper&#x6027;&#x80FD;&#x5F71;&#x54CD;&#x4E2D;&#x6700;&#x5173;&#x952E;&#x7684;&#x90E8;&#x5206;&#xFF0C;&#x56E0;&#x4E3A;&#x6536;&#x96C6;&#x548C;&#x5206;&#x6790;&#x53EF;&#x4EE5;&#x66F4;&#x5BB9;&#x6613;&#x5728;&#x7D27;&#x6025;&#x60C5;&#x51B5;&#x4E0B;&#x88AB;&#x5173;&#x95ED;&#x3002;Dapper&#x8FD0;&#x884C;&#x5E93;&#x4E2D;&#x6700;&#x91CD;&#x8981;&#x7684;&#x8DDF;&#x8E2A;&#x751F;&#x6210;&#x6D88;&#x8017;&#x5728;&#x4E8E;&#x521B;&#x5EFA;&#x548C;&#x9500;&#x6BC1;span&#x548C;annotation&#xFF0C;&#x5E76;&#x8BB0;&#x5F55;&#x5230;&#x672C;&#x5730;&#x78C1;&#x76D8;&#x4F9B;&#x540E;&#x7EED;&#x7684;&#x6536;&#x96C6;&#x3002;&#x6839;span&#x7684;&#x521B;&#x5EFA;&#x548C;&#x9500;&#x6BC1;&#x9700;&#x8981;&#x635F;&#x8017;&#x5E73;&#x5747;204&#x7EB3;&#x79D2;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x800C;&#x540C;&#x6837;&#x7684;&#x64CD;&#x4F5C;&#x5728;&#x5176;&#x4ED6;span&#x4E0A;&#x9700;&#x8981;&#x6D88;&#x8017;176&#x7EB3;&#x79D2;&#x3002;&#x65F6;&#x95F4;&#x4E0A;&#x7684;&#x5DEE;&#x522B;&#x4E3B;&#x8981;&#x5728;&#x4E8E;&#x9700;&#x8981;&#x5728;&#x8DDF;span&#x4E0A;&#x7ED9;&#x8FD9;&#x6B21;&#x8DDF;&#x8E2A;&#x5206;&#x914D;&#x4E00;&#x4E2A;&#x5168;&#x5C40;&#x552F;&#x4E00;&#x7684;ID&#x3002;</p>
<p>&#x5982;&#x679C;&#x4E00;&#x4E2A;span&#x6CA1;&#x6709;&#x88AB;&#x91C7;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x989D;&#x5916;&#x7684;span&#x4E0B;&#x521B;&#x5EFA;annotation&#x7684;&#x6210;&#x672C;&#x51E0;&#x4E4E;&#x53EF;&#x4EE5;&#x5FFD;&#x7565;&#x4E0D;&#x8BA1;&#xFF0C;&#x4ED6;&#x7531;&#x5728;Dapper&#x8FD0;&#x884C;&#x671F;&#x5BF9;ThreadLocal&#x67E5;&#x627E;&#x64CD;&#x4F5C;&#x6784;&#x6210;&#xFF0C;&#x8FD9;&#x5E73;&#x5747;&#x53EA;&#x6D88;&#x8017;9&#x7EB3;&#x79D2;&#x3002;&#x5982;&#x679C;&#x8FD9;&#x4E2A;span&#x88AB;&#x8BA1;&#x5165;&#x91C7;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x4F1A;&#x7528;&#x4E00;&#x4E2A;&#x7528;&#x5B57;&#x7B26;&#x4E32;&#x8FDB;&#x884C;&#x6807;&#x6CE8;&#x2013;&#x5728;&#x56FE;4&#x4E2D;&#x6709;&#x5C55;&#x73B0;&#x2013;&#x5E73;&#x5747;&#x9700;&#x8981;&#x6D88;&#x8017;40&#x7EB3;&#x79D2;&#x3002;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#x90FD;&#x662F;&#x5728;2.2GHz&#x7684;x86&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x91C7;&#x96C6;&#x7684;&#x3002;</p>
<p>&#x5728;Dapper&#x8FD0;&#x884C;&#x671F;&#x5199;&#x5165;&#x5230;&#x672C;&#x5730;&#x78C1;&#x76D8;&#x662F;&#x6700;&#x6602;&#x8D35;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x4F46;&#x662F;&#x4ED6;&#x4EEC;&#x7684;&#x53EF;&#x89C1;&#x635F;&#x8017;&#x5927;&#x5927;&#x51CF;&#x5C11;&#xFF0C;&#x56E0;&#x4E3A;&#x5199;&#x5165;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x548C;&#x64CD;&#x4F5C;&#x76F8;&#x5BF9;&#x4E8E;&#x88AB;&#x8DDF;&#x8E2A;&#x7684;&#x5E94;&#x7528;&#x7CFB;&#x7EDF;&#x6765;&#x8BF4;&#x90FD;&#x662F;&#x5F02;&#x6B65;&#x7684;&#x3002;&#x4E0D;&#x8FC7;&#xFF0C;&#x65E5;&#x5FD7;&#x5199;&#x5165;&#x7684;&#x64CD;&#x4F5C;&#x5982;&#x679C;&#x5728;&#x5927;&#x6D41;&#x91CF;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x6BCF;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x90FD;&#x88AB;&#x8DDF;&#x8E2A;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x5C31;&#x4F1A;&#x53D8;&#x5F97;&#x53EF;&#x4EE5;&#x5BDF;&#x89C9;&#x5230;&#x3002;&#x6211;&#x4EEC;&#x8BB0;&#x5F55;&#x4E86;&#x5728;4.3&#x8282;&#x5C55;&#x793A;&#x4E86;&#x4E00;&#x6B21;Web&#x641C;&#x7D22;&#x7684;&#x8D1F;&#x8F7D;&#x4E0B;&#x7684;&#x6027;&#x80FD;&#x6D88;&#x8017;&#x3002;</p>
<h2 id="4-2-&#x8DDF;&#x8E2A;&#x6536;&#x96C6;&#x7684;&#x6D88;&#x8017;"><a href="#4-2-&#x8DDF;&#x8E2A;&#x6536;&#x96C6;&#x7684;&#x6D88;&#x8017;" class="headerlink" title="4.2 &#x8DDF;&#x8E2A;&#x6536;&#x96C6;&#x7684;&#x6D88;&#x8017;"></a>4.2 &#x8DDF;&#x8E2A;&#x6536;&#x96C6;&#x7684;&#x6D88;&#x8017;</h2><p>&#x8BFB;&#x51FA;&#x8DDF;&#x8E2A;&#x6570;&#x636E;&#x4E5F;&#x4F1A;&#x5BF9;&#x6B63;&#x5728;&#x88AB;&#x76D1;&#x63A7;&#x7684;&#x8D1F;&#x8F7D;&#x4EA7;&#x751F;&#x5E72;&#x6270;&#x3002;&#x8868;1&#x5C55;&#x793A;&#x7684;&#x662F;&#x6700;&#x574F;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;Dapper&#x6536;&#x96C6;&#x65E5;&#x5FD7;&#x7684;&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x5728;&#x9AD8;&#x4E8E;&#x5B9E;&#x9645;&#x60C5;&#x51B5;&#x7684;&#x8D1F;&#x8F7D;&#x57FA;&#x51C6;&#x4E0B;&#x8FDB;&#x884C;&#x6D4B;&#x8BD5;&#x65F6;&#x7684;cpu&#x4F7F;&#x7528;&#x7387;&#x3002;&#x5728;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E0B;&#xFF0C;&#x8DDF;&#x8E2A;&#x6570;&#x636E;&#x5904;&#x7406;&#x4E2D;&#xFF0C;&#x8FD9;&#x4E2A;&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x4ECE;&#x6765;&#x6CA1;&#x6709;&#x8D85;&#x8FC7;0.3%&#x7684;&#x5355;&#x6838;cpu&#x4F7F;&#x7528;&#x7387;&#xFF0C;&#x800C;&#x4E14;&#x53EA;&#x6709;&#x5F88;&#x5C11;&#x91CF;&#x7684;&#x5185;&#x5B58;&#x4F7F;&#x7528;&#xFF08;&#x4EE5;&#x53CA;&#x5806;&#x788E;&#x7247;&#x7684;&#x566A;&#x97F3;&#xFF09;&#x3002;&#x6211;&#x4EEC;&#x8FD8;&#x9650;&#x5236;&#x4E86;Dapper&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x4E3A;&#x5185;&#x6838;scheduler&#x6700;&#x4F4E;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#xFF0C;&#x4EE5;&#x9632;&#x5728;&#x4E00;&#x53F0;&#x9AD8;&#x8D1F;&#x8F7D;&#x7684;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x53D1;&#x751F;cpu&#x7ADE;&#x4E89;&#x3002;</p>
<p>Dapper&#x4E5F;&#x662F;&#x4E00;&#x4E2A;&#x5E26;&#x5BBD;&#x8D44;&#x6E90;&#x7684;&#x8F7B;&#x91CF;&#x7EA7;&#x7684;&#x6D88;&#x8D39;&#x8005;&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A;span&#x5728;&#x6211;&#x4EEC;&#x7684;&#x4ED3;&#x5E93;&#x4E2D;&#x4F20;&#x8F93;&#x53EA;&#x5360;&#x7528;&#x4E86;&#x5E73;&#x5747;426&#x7684;byte&#x3002;&#x4F5C;&#x4E3A;&#x7F51;&#x7EDC;&#x884C;&#x4E3A;&#x4E2D;&#x7684;&#x6781;&#x5C0F;&#x90E8;&#x5206;&#xFF0C;Dapper&#x7684;&#x6570;&#x636E;&#x6536;&#x96C6;&#x5728;Google&#x7684;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E2D;&#x7684;&#x53EA;&#x5360;&#x7528;&#x4E86;0.01%&#x7684;&#x7F51;&#x7EDC;&#x8D44;&#x6E90;&#x3002;</p>
<p> <img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/d1a5bd8951b6daa36b80e81dc0289b78ebfb2bcac72db97bf428b920907e09b4" alt><br>&#x8868;1&#xFF1A;Dapper&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x5728;&#x8D1F;&#x8F7D;&#x6D4B;&#x8BD5;&#x65F6;&#x7684;CPU&#x8D44;&#x6E90;&#x4F7F;&#x7528;&#x7387;</p>
<h2 id="4-3-&#x5728;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E0B;&#x5BF9;&#x8D1F;&#x8F7D;&#x7684;&#x5F71;&#x54CD;"><a href="#4-3-&#x5728;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E0B;&#x5BF9;&#x8D1F;&#x8F7D;&#x7684;&#x5F71;&#x54CD;" class="headerlink" title="4.3 &#x5728;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E0B;&#x5BF9;&#x8D1F;&#x8F7D;&#x7684;&#x5F71;&#x54CD;"></a>4.3 &#x5728;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E0B;&#x5BF9;&#x8D1F;&#x8F7D;&#x7684;&#x5F71;&#x54CD;</h2><p>&#x6BCF;&#x4E2A;&#x8BF7;&#x6C42;&#x90FD;&#x4F1A;&#x5229;&#x7528;&#x5230;&#x5927;&#x91CF;&#x7684;&#x670D;&#x52A1;&#x5668;&#x7684;&#x9AD8;&#x541E;&#x5410;&#x91CF;&#x7684;&#x7EBF;&#x4E0A;&#x670D;&#x52A1;&#xFF0C;&#x8FD9;&#x662F;&#x5BF9;&#x6709;&#x6548;&#x8DDF;&#x8E2A;&#x6700;&#x4E3B;&#x8981;&#x7684;&#x9700;&#x6C42;&#x4E4B;&#x4E00;&#xFF1B;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x9700;&#x8981;&#x751F;&#x6210;&#x5927;&#x91CF;&#x7684;&#x8DDF;&#x8E2A;&#x6570;&#x636E;&#xFF0C;&#x5E76;&#x4E14;&#x4ED6;&#x4EEC;&#x5BF9;&#x6027;&#x80FD;&#x7684;&#x5F71;&#x54CD;&#x662F;&#x6700;&#x654F;&#x611F;&#x7684;&#x3002;&#x5728;&#x8868;2&#x4E2D;&#x6211;&#x4EEC;&#x7528;&#x96C6;&#x7FA4;&#x4E0B;&#x7684;&#x7F51;&#x7EDC;&#x641C;&#x7D22;&#x670D;&#x52A1;&#x4F5C;&#x4E3A;&#x4F8B;&#x5B50;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x8C03;&#x6574;&#x91C7;&#x6837;&#x7387;&#xFF0C;&#x6765;&#x8861;&#x91CF;Dapper&#x5728;&#x5EF6;&#x8FDF;&#x548C;&#x541E;&#x5410;&#x91CF;&#x65B9;&#x9762;&#x5BF9;&#x6027;&#x80FD;&#x7684;&#x5F71;&#x54CD;&#x3002;</p>
<p> <img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/33ddb5e57348f6b9cc4df9ef8e78b752be0271737b41bf05db7bd02c04690051" alt><br>&#x8868;2&#xFF1A;&#x7F51;&#x7EDC;&#x641C;&#x7D22;&#x96C6;&#x7FA4;&#x4E2D;&#xFF0C;&#x5BF9;&#x4E0D;&#x540C;&#x91C7;&#x6837;&#x7387;&#x5BF9;&#x7F51;&#x7EDC;&#x5EF6;&#x8FDF;&#x548C;&#x541E;&#x5410;&#x7684;&#x5F71;&#x54CD;&#x3002;&#x5EF6;&#x8FDF;&#x548C;&#x541E;&#x5410;&#x7684;&#x5B9E;&#x9A8C;&#x8BEF;&#x5DEE;&#x5206;&#x522B;&#x662F;2.5%&#x548C;0.15%&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x770B;&#x5230;&#xFF0C;&#x867D;&#x7136;&#x5BF9;&#x541E;&#x5410;&#x91CF;&#x7684;&#x5F71;&#x54CD;&#x4E0D;&#x662F;&#x5F88;&#x660E;&#x663E;&#xFF0C;&#x4F46;&#x4E3A;&#x4E86;&#x907F;&#x514D;&#x660E;&#x663E;&#x7684;&#x5EF6;&#x8FDF;&#xFF0C;&#x8DDF;&#x8E2A;&#x7684;&#x91C7;&#x6837;&#x8FD8;&#x662F;&#x5FC5;&#x8981;&#x7684;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x5EF6;&#x8FDF;&#x548C;&#x541E;&#x5410;&#x91CF;&#x7684;&#x5E26;&#x6765;&#x7684;&#x635F;&#x5931;&#x5728;&#x628A;&#x91C7;&#x6837;&#x7387;&#x8C03;&#x6574;&#x5230;&#x5C0F;&#x4E8E;1/16&#x4E4B;&#x540E;&#x5C31;&#x5168;&#x90E8;&#x5728;&#x5B9E;&#x9A8C;&#x8BEF;&#x5DEE;&#x8303;&#x56F4;&#x5185;&#x3002;&#x5728;&#x5B9E;&#x8DF5;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53D1;&#x73B0;&#x5373;&#x4FBF;&#x91C7;&#x6837;&#x7387;&#x8C03;&#x6574;&#x5230;1/1024&#x4ECD;&#x7136;&#x662F;&#x6709;&#x8DB3;&#x591F;&#x91CF;&#x7684;&#x8DDF;&#x8E2A;&#x6570;&#x636E;&#x7684;&#x7528;&#x6765;&#x8DDF;&#x8E2A;&#x5927;&#x91CF;&#x7684;&#x670D;&#x52A1;&#x3002;&#x4FDD;&#x6301;Dapper&#x7684;&#x6027;&#x80FD;&#x635F;&#x8017;&#x57FA;&#x7EBF;&#x5728;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x4F4E;&#x7684;&#x6C34;&#x5E73;&#x662F;&#x5F88;&#x91CD;&#x8981;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4E3A;&#x90A3;&#x4E9B;&#x5E94;&#x7528;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x5BBD;&#x677E;&#x7684;&#x73AF;&#x5883;&#x4F7F;&#x7528;&#x5B8C;&#x6574;&#x7684;Annotation API&#x800C;&#x65E0;&#x60E7;&#x6027;&#x80FD;&#x635F;&#x5931;&#x3002;&#x4F7F;&#x7528;&#x8F83;&#x4F4E;&#x7684;&#x91C7;&#x6837;&#x7387;&#x8FD8;&#x6709;&#x989D;&#x5916;&#x7684;&#x597D;&#x5904;&#xFF0C;&#x53EF;&#x4EE5;&#x8BA9;&#x6301;&#x4E45;&#x5316;&#x5230;&#x786C;&#x76D8;&#x4E2D;&#x7684;&#x8DDF;&#x8E2A;&#x6570;&#x636E;&#x5728;&#x5783;&#x573E;&#x56DE;&#x6536;&#x673A;&#x5236;&#x5904;&#x7406;&#x4E4B;&#x524D;&#x4FDD;&#x7559;&#x66F4;&#x957F;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x8FD9;&#x6837;&#x4E3A;Dapper&#x7684;&#x6536;&#x96C6;&#x7EC4;&#x4EF6;&#x7ED9;&#x4E86;&#x66F4;&#x591A;&#x7684;&#x7075;&#x6D3B;&#x6027;&#x3002;</p>
<h2 id="4-4-&#x53EF;&#x53D8;&#x91C7;&#x6837;"><a href="#4-4-&#x53EF;&#x53D8;&#x91C7;&#x6837;" class="headerlink" title="4.4 &#x53EF;&#x53D8;&#x91C7;&#x6837;"></a>4.4 &#x53EF;&#x53D8;&#x91C7;&#x6837;</h2><p>&#x4EFB;&#x4F55;&#x7ED9;&#x5B9A;&#x8FDB;&#x7A0B;&#x7684;Dapper&#x7684;&#x6D88;&#x8017;&#x548C;&#x6BCF;&#x4E2A;&#x8FDB;&#x7A0B;&#x5355;&#x4F4D;&#x65F6;&#x95F4;&#x7684;&#x8DDF;&#x8E2A;&#x7684;&#x91C7;&#x6837;&#x7387;&#x6210;&#x6B63;&#x6BD4;&#x3002;Dapper&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x751F;&#x4EA7;&#x7248;&#x672C;&#x5728;Google&#x5185;&#x90E8;&#x7684;&#x6240;&#x6709;&#x8FDB;&#x7A0B;&#x4E0A;&#x4F7F;&#x7528;&#x7EDF;&#x4E00;&#x7684;&#x91C7;&#x6837;&#x7387;&#xFF0C;&#x4E3A;1/1024&#x3002;&#x8FD9;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x65B9;&#x6848;&#x662F;&#x5BF9;&#x6211;&#x4EEC;&#x7684;&#x9AD8;&#x541E;&#x5410;&#x91CF;&#x7684;&#x7EBF;&#x4E0A;&#x670D;&#x52A1;&#x6765;&#x8BF4;&#x662F;&#x975E;&#x5E38;&#x6709;&#x7528;&#xFF0C;&#x56E0;&#x4E3A;&#x90A3;&#x4E9B;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x4E8B;&#x4EF6;(&#x5728;&#x5927;&#x541E;&#x5410;&#x91CF;&#x7684;&#x60C5;&#x51B5;&#x4E0B;)&#x4ECD;&#x7136;&#x5F88;&#x6709;&#x53EF;&#x80FD;&#x7ECF;&#x5E38;&#x51FA;&#x73B0;&#xFF0C;&#x5E76;&#x4E14;&#x901A;&#x5E38;&#x8DB3;&#x4EE5;&#x88AB;&#x6355;&#x6349;&#x5230;&#x3002;</p>
<p>&#x7136;&#x800C;&#xFF0C;&#x5728;&#x8F83;&#x4F4E;&#x7684;&#x91C7;&#x6837;&#x7387;&#x548C;&#x8F83;&#x4F4E;&#x7684;&#x4F20;&#x8F93;&#x8D1F;&#x8F7D;&#x4E0B;&#x53EF;&#x80FD;&#x4F1A;&#x5BFC;&#x81F4;&#x9519;&#x8FC7;&#x91CD;&#x8981;&#x4E8B;&#x4EF6;&#xFF0C;&#x800C;&#x60F3;&#x7528;&#x8F83;&#x9AD8;&#x7684;&#x91C7;&#x6837;&#x7387;&#x5C31;&#x9700;&#x8981;&#x80FD;&#x63A5;&#x53D7;&#x7684;&#x6027;&#x80FD;&#x635F;&#x8017;&#x3002;&#x5BF9;&#x4E8E;&#x8FD9;&#x6837;&#x7684;&#x7CFB;&#x7EDF;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x5C31;&#x662F;&#x8986;&#x76D6;&#x9ED8;&#x8BA4;&#x7684;&#x91C7;&#x6837;&#x7387;&#xFF0C;&#x8FD9;&#x9700;&#x8981;&#x624B;&#x52A8;&#x5E72;&#x9884;&#x7684;&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x662F;&#x6211;&#x4EEC;&#x8BD5;&#x56FE;&#x907F;&#x514D;&#x5728;dapper&#x4E2D;&#x51FA;&#x73B0;&#x7684;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x5728;&#x90E8;&#x7F72;&#x53EF;&#x53D8;&#x91C7;&#x6837;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x53C2;&#x6570;&#x5316;&#x914D;&#x7F6E;&#x91C7;&#x6837;&#x7387;&#x65F6;&#xFF0C;&#x4E0D;&#x662F;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x7EDF;&#x4E00;&#x7684;&#x91C7;&#x6837;&#x65B9;&#x6848;&#xFF0C;&#x800C;&#x662F;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x91C7;&#x6837;&#x671F;&#x671B;&#x7387;&#x6765;&#x6807;&#x8BC6;&#x5355;&#x4F4D;&#x65F6;&#x95F4;&#x5185;&#x91C7;&#x6837;&#x7684;&#x8FFD;&#x8E2A;&#x3002;&#x8FD9;&#x6837;&#x4E00;&#x6765;&#xFF0C;&#x4F4E;&#x6D41;&#x91CF;&#x4F4E;&#x8D1F;&#x8F7D;&#x81EA;&#x52A8;&#x63D0;&#x9AD8;&#x91C7;&#x6837;&#x7387;&#xFF0C;&#x800C;&#x5728;&#x9AD8;&#x6D41;&#x91CF;&#x9AD8;&#x8D1F;&#x8F7D;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x4F1A;&#x964D;&#x4F4E;&#x91C7;&#x6837;&#x7387;&#xFF0C;&#x4F7F;&#x635F;&#x8017;&#x4E00;&#x76F4;&#x4FDD;&#x6301;&#x5728;&#x63A7;&#x5236;&#x4E4B;&#x4E0B;&#x3002;&#x5B9E;&#x9645;&#x4F7F;&#x7528;&#x7684;&#x91C7;&#x6837;&#x7387;&#x4F1A;&#x968F;&#x7740;&#x8DDF;&#x8E2A;&#x672C;&#x8EAB;&#x8BB0;&#x5F55;&#x4E0B;&#x6765;&#xFF0C;&#x8FD9;&#x6709;&#x5229;&#x4E8E;&#x4ECE;Dapper&#x7684;&#x8DDF;&#x8E2A;&#x6570;&#x636E;&#x4E2D;&#x51C6;&#x786E;&#x7684;&#x5206;&#x6790;&#x3002;</p>
<h2 id="4-5-&#x5E94;&#x5BF9;&#x79EF;&#x6781;&#x91C7;&#x6837;-Coping-with-aggressive-sampling"><a href="#4-5-&#x5E94;&#x5BF9;&#x79EF;&#x6781;&#x91C7;&#x6837;-Coping-with-aggressive-sampling" class="headerlink" title="4.5 &#x5E94;&#x5BF9;&#x79EF;&#x6781;&#x91C7;&#x6837;(Coping with aggressive sampling)"></a>4.5 &#x5E94;&#x5BF9;&#x79EF;&#x6781;&#x91C7;&#x6837;(Coping with aggressive sampling)</h2><p>&#x65B0;&#x7684;Dapper&#x7528;&#x6237;&#x5F80;&#x5F80;&#x89C9;&#x5F97;&#x4F4E;&#x91C7;&#x6837;&#x7387;&#x2013;&#x5728;&#x9AD8;&#x541E;&#x5410;&#x91CF;&#x7684;&#x670D;&#x52A1;&#x4E0B;&#x7ECF;&#x5E38;&#x4F4E;&#x81F3;0.01&#xFF05;&#x2013;&#x5C06;&#x4F1A;&#x4E0D;&#x5229;&#x4E8E;&#x4ED6;&#x4EEC;&#x7684;&#x5206;&#x6790;&#x3002;&#x6211;&#x4EEC;&#x5728;Google&#x7684;&#x7ECF;&#x9A8C;&#x4F7F;&#x6211;&#x4EEC;&#x76F8;&#x4FE1;&#xFF0C;&#x5BF9;&#x4E8E;&#x9AD8;&#x541E;&#x5410;&#x91CF;&#x670D;&#x52A1;&#xFF0C;&#x79EF;&#x6781;&#x91C7;&#x6837;(aggressive sampling)&#x5E76;&#x4E0D;&#x59A8;&#x788D;&#x6700;&#x91CD;&#x8981;&#x7684;&#x5206;&#x6790;&#x3002;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x663E;&#x7740;&#x7684;&#x64CD;&#x4F5C;&#x5728;&#x7CFB;&#x7EDF;&#x4E2D;&#x51FA;&#x73B0;&#x4E00;&#x6B21;&#xFF0C;&#x4ED6;&#x5C31;&#x4F1A;&#x51FA;&#x73B0;&#x4E0A;&#x5343;&#x6B21;&#x3002;&#x4F4E;&#x541E;&#x5410;&#x91CF;&#x7684;&#x670D;&#x52A1;&#x2013;&#x4E5F;&#x8BB8;&#x662F;&#x6BCF;&#x79D2;&#x8BF7;&#x6C42;&#x51E0;&#x5341;&#x6B21;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x51E0;&#x5341;&#x4E07;&#x2013;&#x53EF;&#x4EE5;&#x8D1F;&#x62C5;&#x5F97;&#x8D77;&#x8DDF;&#x8E2A;&#x6BCF;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#xFF0C;&#x8FD9;&#x662F;&#x4FC3;&#x4F7F;&#x6211;&#x4EEC;&#x4E0B;&#x51B3;&#x5FC3;&#x4F7F;&#x7528;&#x81EA;&#x9002;&#x5E94;&#x91C7;&#x6837;&#x7387;&#x7684;&#x539F;&#x56E0;&#x3002;</p>
<h2 id="4-6-&#x5728;&#x6536;&#x96C6;&#x8FC7;&#x7A0B;&#x4E2D;&#x989D;&#x5916;&#x7684;&#x91C7;&#x6837;"><a href="#4-6-&#x5728;&#x6536;&#x96C6;&#x8FC7;&#x7A0B;&#x4E2D;&#x989D;&#x5916;&#x7684;&#x91C7;&#x6837;" class="headerlink" title="4.6 &#x5728;&#x6536;&#x96C6;&#x8FC7;&#x7A0B;&#x4E2D;&#x989D;&#x5916;&#x7684;&#x91C7;&#x6837;"></a>4.6 &#x5728;&#x6536;&#x96C6;&#x8FC7;&#x7A0B;&#x4E2D;&#x989D;&#x5916;&#x7684;&#x91C7;&#x6837;</h2><p>&#x4E0A;&#x8FF0;&#x91C7;&#x6837;&#x673A;&#x5236;&#x88AB;&#x8BBE;&#x8BA1;&#x4E3A;&#x5C3D;&#x91CF;&#x51CF;&#x5C11;&#x4E0E;Dapper&#x8FD0;&#x884C;&#x5E93;&#x534F;&#x4F5C;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#x660E;&#x663E;&#x7684;&#x6027;&#x80FD;&#x635F;&#x8017;&#x3002;Dapper&#x7684;&#x56E2;&#x961F;&#x8FD8;&#x9700;&#x8981;&#x63A7;&#x5236;&#x5199;&#x5165;&#x4E2D;&#x592E;&#x8D44;&#x6599;&#x5E93;&#x7684;&#x6570;&#x636E;&#x7684;&#x603B;&#x89C4;&#x6A21;&#xFF0C;&#x56E0;&#x6B64;&#x4E3A;&#x8FBE;&#x5230;&#x8FD9;&#x4E2A;&#x76EE;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x7ED3;&#x5408;&#x4E86;&#x4E8C;&#x7EA7;&#x91C7;&#x6837;&#x3002;</p>
<p>&#x76EE;&#x524D;&#x6211;&#x4EEC;&#x7684;&#x751F;&#x4EA7;&#x96C6;&#x7FA4;&#x6BCF;&#x5929;&#x4EA7;&#x751F;&#x8D85;&#x8FC7;1TB&#x7684;&#x91C7;&#x6837;&#x8DDF;&#x8E2A;&#x6570;&#x636E;&#x3002;Dapper&#x7684;&#x7528;&#x6237;&#x5E0C;&#x671B;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E0B;&#x7684;&#x8FDB;&#x7A0B;&#x7684;&#x8DDF;&#x8E2A;&#x6570;&#x636E;&#x4ECE;&#x88AB;&#x8BB0;&#x5F55;&#x4E4B;&#x540E;&#x80FD;&#x4FDD;&#x5B58;&#x81F3;&#x5C11;&#x4E24;&#x5468;&#x7684;&#x65F6;&#x95F4;&#x3002;&#x9010;&#x6E10;&#x589E;&#x957F;&#x7684;&#x8FFD;&#x8E2A;&#x6570;&#x636E;&#x7684;&#x5BC6;&#x5EA6;&#x5FC5;&#x987B;&#x548C;Dapper&#x4E2D;&#x592E;&#x4ED3;&#x5E93;&#x6240;&#x6D88;&#x8017;&#x7684;&#x670D;&#x52A1;&#x5668;&#x53CA;&#x786C;&#x76D8;&#x5B58;&#x50A8;&#x8FDB;&#x884C;&#x6743;&#x8861;&#x3002;&#x5BF9;&#x8BF7;&#x6C42;&#x7684;&#x9AD8;&#x91C7;&#x6837;&#x7387;&#x8FD8;&#x4F7F;&#x5F97;Dapper&#x6536;&#x96C6;&#x5668;&#x63A5;&#x8FD1;&#x5199;&#x5165;&#x541E;&#x5410;&#x91CF;&#x7684;&#x4E0A;&#x9650;&#x3002;</p>
<p>&#x4E3A;&#x4E86;&#x7EF4;&#x6301;&#x7269;&#x8D28;&#x8D44;&#x6E90;&#x7684;&#x9700;&#x6C42;&#x548C;&#x6E10;&#x589E;&#x7684;Bigtable&#x7684;&#x541E;&#x5410;&#x4E4B;&#x95F4;&#x7684;&#x7075;&#x6D3B;&#x6027;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x6536;&#x96C6;&#x7CFB;&#x7EDF;&#x81EA;&#x8EAB;&#x4E0A;&#x589E;&#x52A0;&#x4E86;&#x989D;&#x5916;&#x7684;&#x91C7;&#x6837;&#x7387;&#x7684;&#x652F;&#x6301;&#x3002;&#x6211;&#x4EEC;&#x5145;&#x5206;&#x5229;&#x7528;&#x6240;&#x6709;span&#x90FD;&#x6765;&#x81EA;&#x4E00;&#x4E2A;&#x7279;&#x5B9A;&#x7684;&#x8DDF;&#x8E2A;&#x5E76;&#x5206;&#x4EAB;&#x540C;&#x4E00;&#x4E2A;&#x8DDF;&#x8E2A;ID&#x8FD9;&#x4E2A;&#x4E8B;&#x5B9E;&#xFF0C;&#x867D;&#x7136;&#x8FD9;&#x4E9B;span&#x6709;&#x53EF;&#x80FD;&#x6A2A;&#x8DE8;&#x4E86;&#x6570;&#x5343;&#x4E2A;&#x4E3B;&#x673A;&#x3002;&#x5BF9;&#x4E8E;&#x5728;&#x6536;&#x96C6;&#x7CFB;&#x7EDF;&#x4E2D;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;span&#xFF0C;&#x6211;&#x4EEC;&#x7528;hash&#x7B97;&#x6CD5;&#x628A;&#x8DDF;&#x8E2A;ID&#x8F6C;&#x6210;&#x4E00;&#x4E2A;&#x6807;&#x91CF;Z&#xFF0C;&#x8FD9;&#x91CC;0&lt;=Z&lt;=1&#x3002;&#x5982;&#x679C;Z&#x6BD4;&#x6211;&#x4EEC;&#x6536;&#x96C6;&#x7CFB;&#x7EDF;&#x4E2D;&#x7684;&#x7CFB;&#x6570;&#x4F4E;&#x7684;&#x8BDD;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x4FDD;&#x7559;&#x8FD9;&#x4E2A;span&#x4FE1;&#x606F;&#xFF0C;&#x5E76;&#x5199;&#x5165;&#x5230;Bigtable&#x4E2D;&#x3002;&#x53CD;&#x4E4B;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x629B;&#x5F03;&#x4ED6;&#x3002;&#x901A;&#x8FC7;&#x5728;&#x91C7;&#x6837;&#x51B3;&#x7B56;&#x4E2D;&#x7684;&#x8DDF;&#x8E2A;ID&#xFF0C;&#x6211;&#x4EEC;&#x8981;&#x4E48;&#x4FDD;&#x5B58;&#x3001;&#x8981;&#x4E48;&#x629B;&#x5F03;&#x6574;&#x4E2A;&#x8DDF;&#x8E2A;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5355;&#x72EC;&#x5904;&#x7406;&#x8DDF;&#x8E2A;&#x5185;&#x7684;span&#x3002;&#x6211;&#x4EEC;&#x53D1;&#x73B0;&#xFF0C;&#x6709;&#x4E86;&#x8FD9;&#x4E2A;&#x989D;&#x5916;&#x7684;&#x914D;&#x7F6E;&#x53C2;&#x6570;&#x4F7F;&#x7BA1;&#x7406;&#x6211;&#x4EEC;&#x7684;&#x6536;&#x96C6;&#x7BA1;&#x9053;&#x53D8;&#x5F97;&#x7B80;&#x5355;&#x591A;&#x4E86;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F88;&#x5BB9;&#x6613;&#x5730;&#x5728;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#x8C03;&#x6574;&#x6211;&#x4EEC;&#x7684;&#x5168;&#x5C40;&#x5199;&#x5165;&#x7387;&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x3002;</p>
<p>&#x5982;&#x679C;&#x6574;&#x4E2A;&#x8DDF;&#x8E2A;&#x8FC7;&#x7A0B;&#x548C;&#x6536;&#x96C6;&#x7CFB;&#x7EDF;&#x53EA;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x91C7;&#x6837;&#x7387;&#x53C2;&#x6570;&#x786E;&#x5B9E;&#x4F1A;&#x7B80;&#x5355;&#x4E00;&#x4E9B;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x5C31;&#x4E0D;&#x80FD;&#x5E94;&#x5BF9;&#x5FEB;&#x901F;&#x8C03;&#x6574;&#x5728;&#x6240;&#x6709;&#x90E8;&#x7F72;&#x7684;&#x8282;&#x70B9;&#x4E0A;&#x7684;&#x8FD0;&#x884C;&#x671F;&#x91C7;&#x6837;&#x7387;&#x914D;&#x7F6E;&#x7684;&#x8FD9;&#x4E2A;&#x8981;&#x6C42;&#x3002;&#x6211;&#x4EEC;&#x9009;&#x62E9;&#x4E86;&#x8FD0;&#x884C;&#x671F;&#x91C7;&#x6837;&#x7387;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x53EF;&#x4EE5;&#x4F18;&#x96C5;&#x7684;&#x53BB;&#x6389;&#x6211;&#x4EEC;&#x65E0;&#x6CD5;&#x5199;&#x5165;&#x5230;&#x4ED3;&#x5E93;&#x4E2D;&#x7684;&#x591A;&#x4F59;&#x6570;&#x636E;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8C03;&#x8282;&#x6536;&#x96C6;&#x7CFB;&#x7EDF;&#x4E2D;&#x7684;&#x4E8C;&#x7EA7;&#x91C7;&#x6837;&#x7387;&#x7CFB;&#x6570;&#x6765;&#x8C03;&#x6574;&#x8FD9;&#x4E2A;&#x8FD0;&#x884C;&#x671F;&#x91C7;&#x6837;&#x7387;&#x3002;Dapper&#x7684;&#x7BA1;&#x9053;&#x7EF4;&#x62A4;&#x53D8;&#x5F97;&#x66F4;&#x5BB9;&#x6613;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4FEE;&#x6539;&#x6211;&#x4EEC;&#x7684;&#x4E8C;&#x7EA7;&#x91C7;&#x6837;&#x7387;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x76F4;&#x63A5;&#x589E;&#x52A0;&#x6216;&#x51CF;&#x5C11;&#x6211;&#x4EEC;&#x7684;&#x5168;&#x5C40;&#x8986;&#x76D6;&#x7387;&#x548C;&#x5199;&#x5165;&#x901F;&#x5EA6;&#x3002;</p>
<ol start="5">
<li>&#x901A;&#x7528;&#x7684;Dapper&#x5DE5;&#x5177;</li>
</ol>
<hr>
<p>&#x51E0;&#x5E74;&#x524D;&#xFF0C;&#x5F53;Dapper&#x8FD8;&#x53EA;&#x662F;&#x4E2A;&#x539F;&#x578B;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5B83;&#x53EA;&#x80FD;&#x5728;Dapper&#x5F00;&#x53D1;&#x8005;&#x8010;&#x5FC3;&#x7684;&#x652F;&#x6301;&#x4E0B;&#x4F7F;&#x7528;&#x3002;&#x4ECE;&#x90A3;&#x65F6;&#x8D77;&#xFF0C;&#x6211;&#x4EEC;&#x9010;&#x6E10;&#x8FED;&#x4EE3;&#x7684;&#x5EFA;&#x7ACB;&#x4E86;&#x6536;&#x96C6;&#x7EC4;&#x4EF6;&#xFF0C;&#x7F16;&#x7A0B;&#x63A5;&#x53E3;&#xFF0C;&#x548C;&#x57FA;&#x4E8E;Web&#x7684;&#x4EA4;&#x4E92;&#x5F0F;&#x7528;&#x6237;&#x754C;&#x9762;&#xFF0C;&#x5E2E;&#x52A9;Dapper&#x7684;&#x7528;&#x6237;&#x72EC;&#x7ACB;&#x89E3;&#x51B3;&#x81EA;&#x5DF1;&#x7684;&#x95EE;&#x9898;&#x3002;&#x5728;&#x672C;&#x8282;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x603B;&#x7ED3;&#x4E00;&#x4E0B;&#x54EA;&#x4E9B;&#x7684;&#x65B9;&#x6CD5;&#x6709;&#x7528;&#xFF0C;&#x54EA;&#x4E9B;&#x7528;&#x5904;&#x4E0D;&#x5927;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x63D0;&#x4F9B;&#x5173;&#x4E8E;&#x8FD9;&#x4E9B;&#x901A;&#x7528;&#x7684;&#x5206;&#x6790;&#x5DE5;&#x5177;&#x7684;&#x57FA;&#x672C;&#x7684;&#x4F7F;&#x7528;&#x4FE1;&#x606F;&#x3002;</p>
<h2 id="5-1-Dapper-Depot-API"><a href="#5-1-Dapper-Depot-API" class="headerlink" title="5.1 Dapper Depot API"></a>5.1 Dapper Depot API</h2><p>Dapper&#x7684;&#x201C;Depot API&#x201D;&#x6216;&#x79F0;&#x4F5C;DAPI&#xFF0C;&#x63D0;&#x4F9B;&#x5728;Dapper&#x7684;&#x533A;&#x57DF;&#x4ED3;&#x5E93;&#x4E2D;&#x5BF9;&#x5206;&#x5E03;&#x5F0F;&#x8DDF;&#x8E2A;&#x6570;&#x636E;&#x4E00;&#x4E2A;&#x76F4;&#x63A5;&#x8BBF;&#x95EE;&#x3002;DAPI&#x548C;Dapper&#x8DDF;&#x8E2A;&#x4ED3;&#x5E93;&#x88AB;&#x8BBE;&#x8BA1;&#x6210;&#x4E32;&#x8054;&#x7684;&#xFF0C;&#x800C;&#x4E14;DAPI&#x610F;&#x5473;&#x7740;&#x5BF9;Dapper&#x4ED3;&#x5E93;&#x4E2D;&#x7684;&#x5143;&#x6570;&#x636E;&#x66B4;&#x9732;&#x4E00;&#x4E2A;&#x5E72;&#x51C0;&#x548C;&#x76F4;&#x89C2;&#x7684;&#x7684;&#x63A5;&#x53E3;&#x3002;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x4E86;&#x4EE5;&#x4E0B;&#x63A8;&#x8350;&#x7684;&#x4E09;&#x79CD;&#x65B9;&#x5F0F;&#x53BB;&#x66B4;&#x9732;&#x8FD9;&#x6837;&#x7684;&#x63A5;&#x53E3;&#xFF1A;</p>
<ul>
<li>&#x901A;&#x8FC7;&#x8DDF;&#x8E2A;ID&#x6765;&#x8BBF;&#x95EE;&#xFF1A;DAPI&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4ED6;&#x7684;&#x5168;&#x5C40;&#x552F;&#x4E00;&#x7684;&#x8DDF;&#x8E2A;ID&#x8BFB;&#x53D6;&#x4EFB;&#x4F55;&#x4E00;&#x6B21;&#x8DDF;&#x8E2A;&#x4FE1;&#x606F;&#x3002;</li>
<li>&#x6279;&#x91CF;&#x8BBF;&#x95EE;&#xFF1A;DAPI&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x7684;MapReduce&#x63D0;&#x4F9B;&#x5BF9;&#x4E0A;&#x4EBF;&#x6761;Dapper&#x8DDF;&#x8E2A;&#x6570;&#x636E;&#x7684;&#x5E76;&#x884C;&#x8BFB;&#x53D6;&#x3002;&#x7528;&#x6237;&#x91CD;&#x5199;&#x4E00;&#x4E2A;&#x865A;&#x62DF;&#x51FD;&#x6570;&#xFF0C;&#x5B83;&#x63A5;&#x53D7;&#x4E00;&#x4E2A;Dapper&#x7684;&#x8DDF;&#x8E2A;&#x4FE1;&#x606F;&#x4F5C;&#x4E3A;&#x5176;&#x552F;&#x4E00;&#x7684;&#x53C2;&#x6570;&#xFF0C;&#x8BE5;&#x6846;&#x67B6;&#x5C06;&#x5728;&#x7528;&#x6237;&#x6307;&#x5B9A;&#x7684;&#x65F6;&#x95F4;&#x7A97;&#x53E3;&#x4E2D;&#x8C03;&#x7528;&#x6BCF;&#x4E00;&#x6B21;&#x6536;&#x96C6;&#x5230;&#x7684;&#x8DDF;&#x8E2A;&#x4FE1;&#x606F;&#x3002;</li>
<li>&#x7D22;&#x5F15;&#x8BBF;&#x95EE;&#xFF1A;Dapper&#x7684;&#x4ED3;&#x5E93;&#x652F;&#x6301;&#x4E00;&#x4E2A;&#x7B26;&#x5408;&#x6211;&#x4EEC;&#x901A;&#x7528;&#x8C03;&#x7528;&#x6A21;&#x677F;&#x7684;&#x552F;&#x4E00;&#x7D22;&#x5F15;&#x3002;&#x8BE5;&#x7D22;&#x5F15;&#x6839;&#x636E;&#x901A;&#x7528;&#x8BF7;&#x6C42;&#x8DDF;&#x8E2A;&#x7279;&#x6027;(commonly-requested trace features)&#x8FDB;&#x884C;&#x7ED8;&#x5236;&#x6765;&#x8BC6;&#x522B;Dapper&#x7684;&#x8DDF;&#x8E2A;&#x4FE1;&#x606F;&#x3002;&#x56E0;&#x4E3A;&#x8DDF;&#x8E2A;ID&#x662F;&#x6839;&#x636E;&#x4F2A;&#x968F;&#x673A;&#x7684;&#x89C4;&#x5219;&#x521B;&#x5EFA;&#x7684;&#xFF0C;&#x8FD9;&#x662F;&#x6700;&#x597D;&#x7684;&#x529E;&#x6CD5;&#x53BB;&#x8BBF;&#x95EE;&#x8DDF;&#x67D0;&#x4E2A;&#x670D;&#x52A1;&#x6216;&#x4E3B;&#x673A;&#x76F8;&#x5173;&#x7684;&#x8DDF;&#x8E2A;&#x6570;&#x636E;&#x3002;</li>
</ul>
<p>&#x6240;&#x6709;&#x8FD9;&#x4E09;&#x79CD;&#x8BBF;&#x95EE;&#x6A21;&#x5F0F;&#x628A;&#x7528;&#x6237;&#x6307;&#x5411;&#x4E0D;&#x540C;&#x7684;Dapper&#x8DDF;&#x8E2A;&#x8BB0;&#x5F55;&#x3002;&#x6B63;&#x5982;&#x7B2C;2.1&#x8282;&#x6240;&#x8FF0;&#x7684;&#xFF0C;Dapper&#x7684;&#x7531;span&#x7EC4;&#x6210;&#x7684;&#x8DDF;&#x8E2A;&#x6570;&#x636E;&#x662F;&#x7528;&#x6811;&#x5F62;&#x7ED3;&#x6784;&#x5EFA;&#x6A21;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;&#x8DDF;&#x8E2A;&#x6570;&#x636E;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF0C;&#x4E5F;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x7531;span&#x7EC4;&#x6210;&#x904D;&#x5386;&#x6811;&#x3002;Span&#x5C31;&#x76F8;&#x5F53;&#x4E8E;RPC&#x8C03;&#x7528;&#xFF0C;&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;RPC&#x7684;&#x65F6;&#x95F4;&#x4FE1;&#x606F;&#x662F;&#x53EF;&#x7528;&#x7684;&#x3002;&#x5E26;&#x65F6;&#x95F4;&#x6233;&#x7684;&#x7279;&#x6B8A;&#x7684;&#x5E94;&#x7528;&#x6807;&#x6CE8;&#x4E5F;&#x662F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8FD9;&#x4E2A;span&#x7ED3;&#x6784;&#x6765;&#x8BBF;&#x95EE;&#x7684;&#x3002;</p>
<p>&#x9009;&#x62E9;&#x4E00;&#x4E2A;&#x5408;&#x9002;&#x7684;&#x81EA;&#x5B9A;&#x4E49;&#x7D22;&#x5F15;&#x662F;DAPI&#x8BBE;&#x8BA1;&#x4E2D;&#x6700;&#x5177;&#x6311;&#x6218;&#x6027;&#x7684;&#x90E8;&#x5206;&#x3002;&#x538B;&#x7F29;&#x5B58;&#x50A8;&#x8981;&#x6C42;&#x5728;&#x8DDF;&#x8E2A;&#x6570;&#x636E;&#x79CD;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;&#x7D22;&#x5F15;&#x7684;&#x60C5;&#x51B5;&#x53EA;&#x6BD4;&#x5B9E;&#x9645;&#x6570;&#x636E;&#x5C0F;26%&#xFF0C;&#x6240;&#x4EE5;&#x6D88;&#x8017;&#x662F;&#x5DE8;&#x5927;&#x7684;&#x3002;&#x6700;&#x521D;&#xFF0C;&#x6211;&#x4EEC;&#x90E8;&#x7F72;&#x4E86;&#x4E24;&#x4E2A;&#x7D22;&#x5F15;&#xFF1A;&#x7B2C;&#x4E00;&#x4E2A;&#x662F;&#x4E3B;&#x673A;&#x7D22;&#x5F15;&#xFF0C;&#x53E6;&#x4E00;&#x4E2A;&#x662F;&#x670D;&#x52A1;&#x540D;&#x7684;&#x7D22;&#x5F15;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x6211;&#x4EEC;&#x5E76;&#x6CA1;&#x6709;&#x627E;&#x5230;&#x4E3B;&#x673A;&#x7D22;&#x5F15;&#x548C;&#x5B58;&#x50A8;&#x6210;&#x672C;&#x4E4B;&#x95F4;&#x7684;&#x5229;&#x5BB3;&#x5173;&#x7CFB;&#x3002;&#x5F53;&#x7528;&#x6237;&#x5BF9;&#x6BCF;&#x4E00;&#x53F0;&#x4E3B;&#x673A;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4ED6;&#x4EEC;&#x4E5F;&#x4F1A;&#x5BF9;&#x7279;&#x5B9A;&#x7684;&#x670D;&#x52A1;&#x611F;&#x5174;&#x8DA3;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x6700;&#x7EC8;&#x9009;&#x62E9;&#x628A;&#x4E24;&#x8005;&#x76F8;&#x7ED3;&#x5408;&#xFF0C;&#x6210;&#x4E3A;&#x4E00;&#x4E2A;&#x7EC4;&#x5408;&#x7D22;&#x5F15;&#xFF0C;&#x5B83;&#x5141;&#x8BB8;&#x4EE5;&#x670D;&#x52A1;&#x540D;&#x79F0;&#xFF0C;&#x4E3B;&#x673A;&#xFF0C;&#x548C;&#x65F6;&#x95F4;&#x6233;&#x7684;&#x987A;&#x5E8F;&#x8FDB;&#x884C;&#x6709;&#x6548;&#x7684;&#x67E5;&#x627E;&#x3002;</p>
<h2 id="5-1-1-DAPI&#x5728;Google&#x5185;&#x90E8;&#x7684;&#x4F7F;&#x7528;"><a href="#5-1-1-DAPI&#x5728;Google&#x5185;&#x90E8;&#x7684;&#x4F7F;&#x7528;" class="headerlink" title="5.1.1 DAPI&#x5728;Google&#x5185;&#x90E8;&#x7684;&#x4F7F;&#x7528;"></a>5.1.1 DAPI&#x5728;Google&#x5185;&#x90E8;&#x7684;&#x4F7F;&#x7528;</h2><p>DAPI&#x5728;&#x8C37;&#x6B4C;&#x7684;&#x4F7F;&#x7528;&#x6709;&#x4E09;&#x7C7B;&#xFF1A;&#x4F7F;&#x5229;&#x7528;DAPI&#x7684;&#x6301;&#x7EED;&#x7684;&#x7EBF;&#x4E0A;Web&#x5E94;&#x7528;&#xFF0C;&#x7EF4;&#x62A4;&#x826F;&#x597D;&#x7684;&#x53EF;&#x4EE5;&#x5728;&#x63A7;&#x5236;&#x53F0;&#x4E0A;&#x8C03;&#x7528;&#x7684;&#x57FA;&#x4E8E;DAPI&#x7684;&#x5DE5;&#x5177;&#xFF0C;&#x53EF;&#x4EE5;&#x88AB;&#x5199;&#x5165;&#xFF0C;&#x8FD0;&#x884C;&#x3001;&#x4E0D;&#x8FC7;&#x5927;&#x90E8;&#x5206;&#x5DF2;&#x7ECF;&#x88AB;&#x5FD8;&#x8BB0;&#x4E86;&#x7684;&#x4E00;&#x6B21;&#x6027;&#x5206;&#x6790;&#x5DE5;&#x5177;&#x3002;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x7684;&#x6709;3&#x4E2A;&#x6301;&#x4E45;&#x6027;&#x7684;&#x57FA;&#x4E8E;DAPI&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;8&#x4E2A;&#x989D;&#x5916;&#x7684;&#x6309;&#x9700;&#x5B9A;&#x5236;&#x7684;&#x57FA;&#x4E8E;DAPI&#x5206;&#x6790;&#x5DE5;&#x5177;&#xFF0C;&#x4EE5;&#x53CA;&#x4F7F;&#x7528;DAPI&#x6846;&#x67B6;&#x6784;&#x5EFA;&#x7684;&#x7EA6;15~20&#x4E00;&#x6B21;&#x6027;&#x7684;&#x5206;&#x6790;&#x5DE5;&#x5177;&#x3002;&#x5728;&#x8FD9;&#x4E4B;&#x540E;&#x7684;&#x5DE5;&#x5177;&#x5C31;&#x8FD9;&#x662F;&#x5F88;&#x96BE;&#x8BF4;&#x660E;&#x4E86;&#xFF0C;&#x56E0;&#x4E3A;&#x5F00;&#x53D1;&#x8005;&#x53EF;&#x4EE5;&#x6784;&#x5EFA;&#x3001;&#x8FD0;&#x884C;&#x548C;&#x4E22;&#x5F03;&#x8FD9;&#x4E9B;&#x9879;&#x76EE;&#xFF0C;&#x800C;&#x4E0D;&#x9700;&#x8981;Dapper&#x56E2;&#x961F;&#x7684;&#x6280;&#x672F;&#x652F;&#x6301;&#x3002;</p>
<h2 id="5-2-Dapper&#x7684;&#x7528;&#x6237;&#x63A5;&#x53E3;"><a href="#5-2-Dapper&#x7684;&#x7528;&#x6237;&#x63A5;&#x53E3;" class="headerlink" title="5.2 Dapper&#x7684;&#x7528;&#x6237;&#x63A5;&#x53E3;"></a>5.2 Dapper&#x7684;&#x7528;&#x6237;&#x63A5;&#x53E3;</h2><p>&#x7EDD;&#x5927;&#x591A;&#x6570;&#x7528;&#x6237;&#x4F7F;&#x7528;&#x53D1;&#x751F;&#x5728;&#x57FA;&#x4E8E;web&#x7684;&#x7528;&#x6237;&#x4EA4;&#x4E92;&#x63A5;&#x53E3;&#x3002;&#x7BC7;&#x5E45;&#x6709;&#x9650;&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x80FD;&#x5217;&#x51FA;&#x6BCF;&#x4E00;&#x4E2A;&#x7279;&#x70B9;&#xFF0C;&#x800C;&#x53EA;&#x80FD;&#x628A;&#x5178;&#x578B;&#x7684;&#x7528;&#x6237;&#x5DE5;&#x4F5C;&#x6D41;&#x5728;&#x56FE;6&#x4E2D;&#x5C55;&#x793A;&#x3002;</p>
<p> <img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/b41f70334c63d7764d52713e71c0283b177041bc3188df7f80593b06a12ef09c" alt><br>&#x56FE;6</p>
<ol>
<li>&#x7528;&#x6237;&#x63CF;&#x8FF0;&#x7684;&#x4ED6;&#x4EEC;&#x5173;&#x5FC3;&#x7684;&#x670D;&#x52A1;&#x548C;&#x65F6;&#x95F4;&#xFF0C;&#x548C;&#x5176;&#x4ED6;&#x4EFB;&#x4F55;&#x4ED6;&#x4EEC;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x533A;&#x5206;&#x8DDF;&#x8E2A;&#x6A21;&#x677F;&#x7684;&#x4FE1;&#x606F;&#xFF08;&#x6BD4;&#x5982;&#xFF0C;span&#x7684;&#x540D;&#x79F0;&#xFF09;&#x3002;&#x4ED6;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x4E0E;&#x4ED6;&#x4EEC;&#x7684;&#x641C;&#x7D22;&#x6700;&#x76F8;&#x5173;&#x7684;&#x6210;&#x672C;&#x5EA6;&#x91CF;(cost metric)(&#x6BD4;&#x5982;&#xFF0C;&#x670D;&#x52A1;&#x54CD;&#x5E94;&#x65F6;&#x95F4;)&#x3002;</li>
<li>&#x4E00;&#x4E2A;&#x5173;&#x4E8E;&#x6027;&#x80FD;&#x6982;&#x8981;&#x7684;&#x5927;&#x8868;&#x683C;&#xFF0C;&#x5BF9;&#x5E94;&#x786E;&#x5B9A;&#x7684;&#x670D;&#x52A1;&#x5173;&#x8054;&#x7684;&#x6240;&#x6709;&#x5206;&#x5E03;&#x5F0F;&#x5904;&#x7406;&#x56FE;&#x8868;&#x3002;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x628A;&#x8FD9;&#x4E9B;&#x6267;&#x884C;&#x56FE;&#x6807;&#x6392;&#x5E8F;&#x6210;&#x4ED6;&#x4EEC;&#x60F3;&#x8981;&#x7684;&#xFF0C;&#x5E76;&#x9009;&#x62E9;&#x4E00;&#x79CD;&#x76F4;&#x65B9;&#x56FE;&#x53BB;&#x5C55;&#x73B0;&#x51FA;&#x66F4;&#x591A;&#x7684;&#x7EC6;&#x8282;&#x3002;</li>
<li>&#x4E00;&#x65E6;&#x67D0;&#x4E2A;&#x5355;&#x4E00;&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x6267;&#x884C;&#x90E8;&#x5206;&#x88AB;&#x9009;&#x4E2D;&#x540E;&#xFF0C;&#x7528;&#x6237;&#x80FD;&#x770B;&#x5230;&#x5173;&#x4E8E;&#x6267;&#x884C;&#x90E8;&#x5206;&#x7684;&#x7684;&#x56FE;&#x5F62;&#x5316;&#x63CF;&#x8FF0;&#x3002;&#x88AB;&#x9009;&#x4E2D;&#x7684;&#x670D;&#x52A1;&#x88AB;&#x9AD8;&#x4EAE;&#x5C55;&#x793A;&#x5728;&#x8BE5;&#x56FE;&#x7684;&#x4E2D;&#x5FC3;&#x3002;</li>
<li>&#x5728;&#x751F;&#x6210;&#x4E0E;&#x6B65;&#x9AA4;1&#x4E2D;&#x9009;&#x4E2D;&#x7684;&#x6210;&#x672C;&#x5EA6;&#x91CF;(cost metric)&#x7EF4;&#x5EA6;&#x76F8;&#x5173;&#x7684;&#x7EDF;&#x8BA1;&#x4FE1;&#x606F;&#x4E4B;&#x540E;&#xFF0C;Dapper&#x7684;&#x7528;&#x6237;&#x754C;&#x9762;&#x4F1A;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x76F4;&#x65B9;&#x56FE;&#x3002;&#x5728;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x4E00;&#x4E2A;&#x5927;&#x81F4;&#x7684;&#x6240;&#x9009;&#x4E2D;&#x90E8;&#x5206;&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x54CD;&#x5E94;&#x65F6;&#x95F4;&#x5206;&#x5E03;&#x56FE;&#x3002;&#x7528;&#x6237;&#x8FD8;&#x4F1A;&#x770B;&#x5230;&#x4E00;&#x4E2A;&#x5173;&#x4E8E;&#x5177;&#x4F53;&#x7684;&#x8DDF;&#x8E2A;&#x4FE1;&#x606F;&#x7684;&#x5217;&#x8868;&#xFF0C;&#x5C55;&#x73B0;&#x8DDF;&#x8E2A;&#x4FE1;&#x606F;&#x5728;&#x76F4;&#x65B9;&#x56FE;&#x4E2D;&#x88AB;&#x5212;&#x5206;&#x4E3A;&#x7684;&#x4E0D;&#x540C;&#x533A;&#x57DF;&#x3002;&#x5728;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x7528;&#x6237;&#x70B9;&#x51FB;&#x5217;&#x8868;&#x79CD;&#x7B2C;&#x4E8C;&#x4E2A;&#x8DDF;&#x8E2A;&#x4FE1;&#x606F;&#x5B9E;&#x4F8B;&#x65F6;&#xFF0C;&#x4F1A;&#x5728;&#x4E0B;&#x65B9;&#x770B;&#x5230;&#x8FD9;&#x4E2A;&#x8DDF;&#x8E2A;&#x4FE1;&#x606F;&#x7684;&#x8BE6;&#x7EC6;&#x89C6;&#x56FE;(&#x6B65;&#x9AA4;5)&#x3002;</li>
<li>&#x7EDD;&#x5927;&#x591A;&#x6570;Dapper&#x7684;&#x4F7F;&#x7528;&#x8005;&#x6700;&#x7EC8;&#x7684;&#x4F1A;&#x68C0;&#x67E5;&#x67D0;&#x4E2A;&#x8DDF;&#x8E2A;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5E0C;&#x671B;&#x80FD;&#x6536;&#x96C6;&#x4E00;&#x4E9B;&#x4FE1;&#x606F;&#x53BB;&#x4E86;&#x89E3;&#x7CFB;&#x7EDF;&#x884C;&#x4E3A;&#x7684;&#x6839;&#x6E90;&#x6240;&#x5728;&#x3002;&#x6211;&#x4EEC;&#x6CA1;&#x6709;&#x8DB3;&#x591F;&#x7684;&#x7A7A;&#x95F4;&#x6765;&#x505A;&#x8DDF;&#x8E2A;&#x89C6;&#x56FE;&#x7684;&#x5BA1;&#x67E5;&#xFF0C;&#x4F46;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x7531;&#x4E00;&#x4E2A;&#x5168;&#x5C40;&#x65F6;&#x95F4;&#x8F74;&#xFF08;&#x5728;&#x4E0A;&#x65B9;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF09;&#xFF0C;&#x5E76;&#x80FD;&#x591F;&#x5C55;&#x5F00;&#x548C;&#x6298;&#x53E0;&#x6811;&#x5F62;&#x7ED3;&#x6784;&#x7684;&#x4EA4;&#x4E92;&#x65B9;&#x5F0F;&#xFF0C;&#x8FD9;&#x4E5F;&#x5F88;&#x6709;&#x7279;&#x70B9;&#x3002;&#x5206;&#x5E03;&#x5F0F;&#x8DDF;&#x8E2A;&#x6811;&#x7684;&#x8FDE;&#x7EED;&#x5C42;&#x7528;&#x5185;&#x5D4C;&#x7684;&#x4E0D;&#x540C;&#x989C;&#x8272;&#x7684;&#x77E9;&#x5F62;&#x8868;&#x793A;&#x3002;&#x6BCF;&#x4E00;&#x4E2A;RPC&#x7684;span&#x88AB;&#x4ECE;&#x65F6;&#x95F4;&#x4E0A;&#x5206;&#x89E3;&#x4E3A;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x5668;&#x8FDB;&#x7A0B;&#x4E2D;&#x7684;&#x6D88;&#x8017;&#xFF08;&#x7EFF;&#x8272;&#x90E8;&#x5206;&#xFF09;&#x548C;&#x5728;&#x7F51;&#x7EDC;&#x4E0A;&#x7684;&#x6D88;&#x8017;&#xFF08;&#x84DD;&#x8272;&#x90E8;&#x5206;&#xFF09;&#x3002;&#x7528;&#x6237;Annotation&#x6CA1;&#x6709;&#x663E;&#x793A;&#x5728;&#x8FD9;&#x4E2A;&#x622A;&#x56FE;&#x4E2D;&#xFF0C;&#x4F46;&#x4ED6;&#x4EEC;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x6027;&#x7684;&#x4EE5;span&#x7684;&#x5F62;&#x5F0F;&#x5305;&#x542B;&#x5728;&#x5168;&#x5C40;&#x65F6;&#x95F4;&#x8F74;&#x4E0A;&#x3002;</li>
</ol>
<p>&#x4E3A;&#x4E86;&#x8BA9;&#x7528;&#x6237;&#x67E5;&#x8BE2;&#x5B9E;&#x65F6;&#x6570;&#x636E;&#xFF0C;Dapper&#x7684;&#x7528;&#x6237;&#x754C;&#x9762;&#x80FD;&#x591F;&#x76F4;&#x63A5;&#x4E0E;Dapper&#x6BCF;&#x4E00;&#x53F0;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E0B;&#x7684;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x7684;&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x8FDB;&#x884C;&#x4EA4;&#x4E92;&#x3002;&#x5728;&#x8BE5;&#x6A21;&#x5F0F;&#x4E0B;&#xFF0C;&#x4E0D;&#x53EF;&#x80FD;&#x6307;&#x671B;&#x80FD;&#x770B;&#x5230;&#x4E0A;&#x9762;&#x6240;&#x8BF4;&#x7684;&#x7CFB;&#x7EDF;&#x7EA7;&#x7684;&#x56FE;&#x8868;&#x5C55;&#x793A;&#xFF0C;&#x4F46;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x5F88;&#x5BB9;&#x6613;&#x57FA;&#x4E8E;&#x6027;&#x80FD;&#x548C;&#x7F51;&#x7EDC;&#x7279;&#x6027;&#x9009;&#x53D6;&#x4E00;&#x4E2A;&#x7279;&#x5B9A;&#x7684;&#x8DDF;&#x8E2A;&#x3002;&#x5728;&#x8FD9;&#x79CD;&#x6A21;&#x5F0F;&#x4E0B;&#xFF0C;&#x53EF;&#x5728;&#x51E0;&#x79D2;&#x949F;&#x5185;&#x67E5;&#x5230;&#x5B9E;&#x65F6;&#x7684;&#x6570;&#x636E;&#x3002;</p>
<p>&#x6839;&#x636E;&#x6211;&#x4EEC;&#x7684;&#x8BB0;&#x5F55;&#xFF0C;&#x5927;&#x7EA6;&#x6709;200&#x4E2A;&#x4E0D;&#x540C;&#x7684;Google&#x5DE5;&#x7A0B;&#x5E08;&#x5728;&#x4E00;&#x5929;&#x5185;&#x4F7F;&#x7528;&#x7684;Dapper&#x7684;UI;&#x5728;&#x4E00;&#x5468;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x5927;&#x7EA6;&#x6709;750-1000&#x4E0D;&#x540C;&#x7684;&#x7528;&#x6237;&#x3002;&#x8FD9;&#x4E9B;&#x7528;&#x6237;&#x6570;&#xFF0C;&#x5728;&#x65B0;&#x529F;&#x80FD;&#x7684;&#x5185;&#x90E8;&#x901A;&#x544A;&#x4E0A;&#xFF0C;&#x662F;&#x6309;&#x6708;&#x8FDE;&#x7EED;&#x7684;&#x3002;&#x901A;&#x5E38;&#x7528;&#x6237;&#x4F1A;&#x53D1;&#x9001;&#x7279;&#x5B9A;&#x8DDF;&#x8E2A;&#x7684;&#x8FDE;&#x63A5;&#xFF0C;&#x8FD9;&#x5C06;&#x4E0D;&#x53EF;&#x907F;&#x514D;&#x5730;&#x5728;&#x67E5;&#x8BE2;&#x8DDF;&#x8E2A;&#x60C5;&#x51B5;&#x65F6;&#x4E2D;&#x4EA7;&#x751F;&#x5F88;&#x591A;&#x4E00;&#x6B21;&#x6027;&#x7684;&#xFF0C;&#x6301;&#x7EED;&#x65F6;&#x95F4;&#x8F83;&#x77ED;&#x7684;&#x4EA4;&#x4E92;&#x3002;</p>
<ol start="6">
<li>&#x7ECF;&#x9A8C;</li>
</ol>
<hr>
<p>Dapper&#x5728;Google&#x88AB;&#x5E7F;&#x6CDB;&#x5E94;&#x7528;&#xFF0C;&#x4E00;&#x90E8;&#x5206;&#x76F4;&#x63A5;&#x901A;&#x8FC7;Dapper&#x7684;&#x7528;&#x6237;&#x754C;&#x9762;&#xFF0C;&#x53E6;&#x4E00;&#x90E8;&#x5206;&#x95F4;&#x63A5;&#x5730;&#x901A;&#x8FC7;&#x5BF9;Dapper API&#x7684;&#x4E8C;&#x6B21;&#x5F00;&#x53D1;&#x6216;&#x8005;&#x5EFA;&#x7ACB;&#x5728;&#x57FA;&#x4E8E;api&#x7684;&#x5E94;&#x7528;&#x4E0A;&#x3002;&#x5728;&#x672C;&#x8282;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5E76;&#x4E0D;&#x6253;&#x7B97;&#x7F57;&#x5217;&#x51FA;&#x6BCF;&#x4E00;&#x79CD;&#x5DF2;&#x77E5;&#x7684;Dapper&#x4F7F;&#x7528;&#x65B9;&#x5F0F;&#xFF0C;&#x800C;&#x662F;&#x8BD5;&#x56FE;&#x8986;&#x76D6;Dapper&#x4F7F;&#x7528;&#x65B9;&#x5F0F;&#x7684;&#x201C;&#x57FA;&#x672C;&#x5411;&#x91CF;&#x201D;&#xFF0C;&#x5E76;&#x52AA;&#x529B;&#x6765;&#x8BF4;&#x660E;&#x4EC0;&#x4E48;&#x6837;&#x7684;&#x5E94;&#x7528;&#x662F;&#x6700;&#x6210;&#x529F;&#x7684;&#x3002;</p>
<h2 id="6-1-&#x5728;&#x5F00;&#x53D1;&#x4E2D;&#x4F7F;&#x7528;Dapper"><a href="#6-1-&#x5728;&#x5F00;&#x53D1;&#x4E2D;&#x4F7F;&#x7528;Dapper" class="headerlink" title="6.1 &#x5728;&#x5F00;&#x53D1;&#x4E2D;&#x4F7F;&#x7528;Dapper"></a>6.1 &#x5728;&#x5F00;&#x53D1;&#x4E2D;&#x4F7F;&#x7528;Dapper</h2><p>Google AdWords&#x7CFB;&#x7EDF;&#x662F;&#x56F4;&#x7ED5;&#x4E00;&#x4E2A;&#x5927;&#x578B;&#x7684;&#x5173;&#x952E;&#x8BCD;&#x5B9A;&#x4F4D;&#x51C6;&#x5219;&#x548C;&#x76F8;&#x5173;&#x6587;&#x5B57;&#x5E7F;&#x544A;&#x7684;&#x6570;&#x636E;&#x5E93;&#x642D;&#x5EFA;&#x7684;&#x3002;&#x5F53;&#x65B0;&#x7684;&#x5173;&#x952E;&#x5B57;&#x6216;&#x5E7F;&#x544A;&#x88AB;&#x63D2;&#x5165;&#x6216;&#x4FEE;&#x6539;&#x65F6;&#xFF0C;&#x5B83;&#x4EEC;&#x5FC5;&#x987B;&#x901A;&#x8FC7;&#x670D;&#x52A1;&#x7B56;&#x7565;&#x672F;&#x8BED;&#x7684;&#x68C0;&#x67E5;&#xFF08;&#x5982;&#x68C0;&#x67E5;&#x4E0D;&#x6070;&#x5F53;&#x7684;&#x8BED;&#x8A00;&#xFF0C;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x5982;&#x679C;&#x4F7F;&#x7528;&#x81EA;&#x52A8;&#x590D;&#x67E5;&#x7CFB;&#x7EDF;&#x6765;&#x505A;&#x7684;&#x8BDD;&#x4F1A;&#x66F4;&#x52A0;&#x6709;&#x6548;&#xFF09;&#x3002;</p>
<p>&#x5F53;&#x8F6E;&#x5230;&#x4ECE;&#x5934;&#x91CD;&#x65B0;&#x8BBE;&#x8BA1;&#x4E00;&#x4E2A;&#x5E7F;&#x544A;&#x5BA1;&#x67E5;&#x670D;&#x52A1;&#x65F6;&#xFF0C;&#x8FD9;&#x4E2A;&#x56E2;&#x961F;&#x8FED;&#x4EE3;&#x7684;&#x4ECE;&#x7B2C;&#x4E00;&#x4E2A;&#x7CFB;&#x7EDF;&#x539F;&#x578B;&#x5F00;&#x59CB;&#x4F7F;&#x7528;Dapper&#xFF0C;&#x5E76;&#x4E14;&#xFF0C;&#x6700;&#x7EC8;&#x7528;Dapper&#x4E00;&#x76F4;&#x7EF4;&#x62A4;&#x7740;&#x4ED6;&#x4EEC;&#x7684;&#x7CFB;&#x7EDF;&#x3002;Dapper&#x5E2E;&#x52A9;&#x4ED6;&#x4EEC;&#x4ECE;&#x4EE5;&#x4E0B;&#x51E0;&#x4E2A;&#x65B9;&#x9762;&#x6539;&#x8FDB;&#x4E86;&#x4ED6;&#x4EEC;&#x7684;&#x670D;&#x52A1;&#xFF1A;</p>
<ul>
<li>&#x6027;&#x80FD;&#xFF1A;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x9488;&#x5BF9;&#x8BF7;&#x6C42;&#x5EF6;&#x8FDF;&#x7684;&#x76EE;&#x6807;&#x8FDB;&#x884C;&#x8DDF;&#x8E2A;&#xFF0C;&#x5E76;&#x5BF9;&#x5BB9;&#x6613;&#x4F18;&#x5316;&#x7684;&#x5730;&#x65B9;&#x8FDB;&#x884C;&#x5B9A;&#x4F4D;&#x3002;Dapper&#x4E5F;&#x88AB;&#x7528;&#x6765;&#x786E;&#x5B9A;&#x5728;&#x5173;&#x952E;&#x8DEF;&#x5F84;&#x4E0A;&#x4E0D;&#x5FC5;&#x8981;&#x7684;&#x4E32;&#x884C;&#x8BF7;&#x6C42;&#x2013;&#x901A;&#x5E38;&#x6765;&#x6E90;&#x4E8E;&#x4E0D;&#x662F;&#x5F00;&#x53D1;&#x8005;&#x81EA;&#x5DF1;&#x5F00;&#x53D1;&#x7684;&#x5B50;&#x7CFB;&#x7EDF;&#x2013;&#x5E76;&#x4FC3;&#x4F7F;&#x56E2;&#x961F;&#x6301;&#x7EED;&#x4FEE;&#x590D;&#x4ED6;&#x4EEC;&#x3002;</li>
<li>&#x6B63;&#x786E;&#x6027;&#xFF1A;&#x5E7F;&#x544A;&#x5BA1;&#x67E5;&#x670D;&#x52A1;&#x56F4;&#x7ED5;&#x5927;&#x578B;&#x6570;&#x636E;&#x5E93;&#x7CFB;&#x7EDF;&#x642D;&#x5EFA;&#x3002;&#x7CFB;&#x7EDF;&#x540C;&#x65F6;&#x5177;&#x6709;&#x53EA;&#x8BFB;&#x526F;&#x672C;&#x7B56;&#x7565;&#xFF08;&#x6570;&#x636E;&#x8BBF;&#x95EE;&#x5EC9;&#x4EF7;&#xFF09;&#x548C;&#x8BFB;&#x5199;&#x7684;&#x4E3B;&#x7B56;&#x7565;&#xFF08;&#x8BBF;&#x95EE;&#x4EE3;&#x4EF7;&#x9AD8;&#xFF09;&#x3002;Dapper&#x88AB;&#x7528;&#x6765;&#x5728;&#x5F88;&#x591A;&#x79CD;&#x60C5;&#x51B5;&#x4E2D;&#x786E;&#x5B9A;&#xFF0C;&#x54EA;&#x4E9B;&#x67E5;&#x8BE2;&#x662F;&#x65E0;&#x9700;&#x901A;&#x8FC7;&#x4E3B;&#x7B56;&#x7565;&#x8BBF;&#x95EE;&#x800C;&#x53EF;&#x4EE5;&#x91C7;&#x7528;&#x526F;&#x672C;&#x7B56;&#x7565;&#x8BBF;&#x95EE;&#x3002;Dapper&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x8D1F;&#x8D23;&#x76D1;&#x63A7;&#x54EA;&#x4E9B;&#x4E3B;&#x7B56;&#x7565;&#x88AB;&#x76F4;&#x63A5;&#x8BBF;&#x95EE;&#xFF0C;&#x5E76;&#x5BF9;&#x91CD;&#x8981;&#x7684;&#x7CFB;&#x7EDF;&#x5E38;&#x91CF;&#x8FDB;&#x884C;&#x4FDD;&#x969C;&#x3002;</li>
<li>&#x7406;&#x89E3;&#x6027;&#xFF1A;&#x5E7F;&#x544A;&#x5BA1;&#x67E5;&#x67E5;&#x8BE2;&#x8DE8;&#x8D8A;&#x4E86;&#x5404;&#x79CD;&#x7C7B;&#x578B;&#x7684;&#x7CFB;&#x7EDF;&#xFF0C;&#x5305;&#x62EC;BigTable&#x2014;&#x4E4B;&#x524D;&#x63D0;&#x5230;&#x7684;&#x90A3;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x591A;&#x7EF4;&#x7D22;&#x5F15;&#x670D;&#x52A1;&#xFF0C;&#x4EE5;&#x53CA;&#x5176;&#x4ED6;&#x5404;&#x79CD;C++&#x548C;Java&#x540E;&#x7AEF;&#x670D;&#x52A1;&#x3002;Dapper&#x7684;&#x8DDF;&#x8E2A;&#x7528;&#x6765;&#x8BC4;&#x4F30;&#x603B;&#x67E5;&#x8BE2;&#x6210;&#x672C;&#xFF0C;&#x4FC3;&#x8FDB;&#x91CD;&#x65B0;&#x5BF9;&#x4E1A;&#x52A1;&#x7684;&#x8BBE;&#x8BA1;&#xFF0C;&#x7528;&#x4EE5;&#x5728;&#x4ED6;&#x4EEC;&#x7684;&#x7CFB;&#x7EDF;&#x4F9D;&#x8D56;&#x4E0A;&#x51CF;&#x5C11;&#x8D1F;&#x8F7D;&#x3002;</li>
<li>&#x6D4B;&#x8BD5;&#xFF1A;&#x65B0;&#x7684;&#x4EE3;&#x7801;&#x7248;&#x672C;&#x4F1A;&#x7ECF;&#x8FC7;&#x4E00;&#x4E2A;&#x4F7F;&#x7528;Dapper&#x8FDB;&#x884C;&#x8DDF;&#x8E2A;&#x7684;QA&#x8FC7;&#x7A0B;&#xFF0C;&#x7528;&#x6765;&#x9A8C;&#x8BC1;&#x6B63;&#x786E;&#x7684;&#x7CFB;&#x7EDF;&#x884C;&#x4E3A;&#x548C;&#x6027;&#x80FD;&#x3002;&#x5728;&#x8DD1;&#x6D4B;&#x8BD5;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x80FD;&#x53D1;&#x73B0;&#x5F88;&#x591A;&#x95EE;&#x9898;&#xFF0C;&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#x6765;&#x81EA;&#x5E7F;&#x544A;&#x5BA1;&#x67E5;&#x7CFB;&#x7EDF;&#x81EA;&#x8EAB;&#x7684;&#x4EE3;&#x7801;&#x6216;&#x662F;&#x4ED6;&#x7684;&#x4F9D;&#x8D56;&#x5305;&#x3002;</li>
</ul>
<p>&#x5E7F;&#x544A;&#x5BA1;&#x67E5;&#x56E2;&#x961F;&#x5E7F;&#x6CDB;&#x4F7F;&#x7528;&#x4E86;Dapper Annotation API&#x3002;Guice[13]&#x5F00;&#x6E90;&#x7684;AOP&#x6846;&#x67B6;&#x7528;&#x6765;&#x5728;&#x91CD;&#x8981;&#x7684;&#x8F6F;&#x4EF6;&#x7EC4;&#x4EF6;&#x4E0A;&#x6807;&#x6CE8;&#x201C;@Traced&#x201D;&#x3002;&#x8FD9;&#x4E9B;&#x8DDF;&#x8E2A;&#x4FE1;&#x606F;&#x53EF;&#x4EE5;&#x8FDB;&#x4E00;&#x6B65;&#x88AB;&#x6807;&#x6CE8;&#xFF0C;&#x5305;&#x542B;&#xFF1A;&#x91CD;&#x8981;&#x5B50;&#x8DEF;&#x5F84;&#x7684;&#x8F93;&#x5165;&#x8F93;&#x51FA;&#x5927;&#x5C0F;&#x3001;&#x57FA;&#x7840;&#x4FE1;&#x606F;&#x3001;&#x5176;&#x4ED6;&#x8C03;&#x8BD5;&#x4FE1;&#x606F;&#xFF0C;&#x6240;&#x6709;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#x5C06;&#x4F1A;&#x989D;&#x5916;&#x53D1;&#x9001;&#x5230;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x4E2D;&#x3002;</p>
<p>&#x540C;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x53D1;&#x73B0;&#x4E86;&#x4E00;&#x4E9B;&#x5E7F;&#x544A;&#x5BA1;&#x67E5;&#x5C0F;&#x7EC4;&#x5728;&#x4F7F;&#x7528;&#x65B9;&#x9762;&#x7684;&#x4E0D;&#x8DB3;&#x3002;&#x6BD4;&#x5982;&#xFF1A;&#x4ED6;&#x4EEC;&#x60F3;&#x6839;&#x636E;&#x4ED6;&#x4EEC;&#x6240;&#x6709;&#x8DDF;&#x8E2A;&#x7684;Annotation&#x4FE1;&#x606F;&#xFF0C;&#x5728;&#x4E00;&#x4E2A;&#x4EA4;&#x4E92;&#x65F6;&#x95F4;&#x6BB5;&#x5185;&#x8FDB;&#x884C;&#x641C;&#x7D22;&#xFF0C;&#x7136;&#x800C;&#x8FD9;&#x5C31;&#x5FC5;&#x987B;&#x8DD1;&#x4E00;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x7684;MapReduce&#x6216;&#x8FDB;&#x884C;&#x6BCF;&#x4E00;&#x4E2A;&#x8DDF;&#x8E2A;&#x7684;&#x624B;&#x52A8;&#x68C0;&#x67E5;&#x3002;&#x53E6;&#x5916;&#xFF0C;&#x5728;Google&#x8FD8;&#x6709;&#x4E00;&#x4E9B;&#x5176;&#x4ED6;&#x7684;&#x7CFB;&#x7EDF;&#x5728;&#x4E5F;&#x4ECE;&#x901A;&#x7528;&#x8C03;&#x8BD5;&#x65E5;&#x5FD7;&#x4E2D;&#x6536;&#x96C6;&#x548C;&#x96C6;&#x4E2D;&#x4FE1;&#x606F;&#xFF0C;&#x628A;&#x90A3;&#x4E9B;&#x7CFB;&#x7EDF;&#x7684;&#x6D77;&#x91CF;&#x6570;&#x636E;&#x548C;Dapper&#x4ED3;&#x5E93;&#x6574;&#x5408;&#x4E5F;&#x662F;&#x6709;&#x4EF7;&#x503C;&#x7684;&#x3002;</p>
<p>&#x603B;&#x7684;&#x6765;&#x8BF4;&#xFF0C;&#x5373;&#x4FBF;&#x5982;&#x6B64;&#xFF0C;&#x5E7F;&#x544A;&#x5BA1;&#x67E5;&#x56E2;&#x961F;&#x4ECD;&#x7136;&#x5BF9;Dapper&#x7684;&#x4F5C;&#x7528;&#x8FDB;&#x884C;&#x4E86;&#x4EE5;&#x4E0B;&#x8BC4;&#x4F30;&#xFF0C;&#x901A;&#x8FC7;&#x4F7F;&#x7528;Dapper&#x7684;&#x8DDF;&#x8E2A;&#x5E73;&#x53F0;&#x7684;&#x6570;&#x636E;&#x5206;&#x6790;&#xFF0C;&#x4ED6;&#x4EEC;&#x7684;&#x670D;&#x52A1;&#x5EF6;&#x8FDF;&#x6027;&#x5DF2;&#x7ECF;&#x4F18;&#x5316;&#x4E86;&#x4E24;&#x4E2A;&#x6570;&#x91CF;&#x7EA7;&#x3002;</p>
<h2 id="6-1-1-&#x4E0E;&#x5F02;&#x5E38;&#x76D1;&#x63A7;&#x7684;&#x96C6;&#x6210;"><a href="#6-1-1-&#x4E0E;&#x5F02;&#x5E38;&#x76D1;&#x63A7;&#x7684;&#x96C6;&#x6210;" class="headerlink" title="6.1.1 &#x4E0E;&#x5F02;&#x5E38;&#x76D1;&#x63A7;&#x7684;&#x96C6;&#x6210;"></a>6.1.1 &#x4E0E;&#x5F02;&#x5E38;&#x76D1;&#x63A7;&#x7684;&#x96C6;&#x6210;</h2><p>Google&#x7EF4;&#x62A4;&#x4E86;&#x4E00;&#x4E2A;&#x4ECE;&#x8FD0;&#x884C;&#x8FDB;&#x7A0B;&#x4E2D;&#x4E0D;&#x65AD;&#x6536;&#x96C6;&#x5E76;&#x96C6;&#x4E2D;&#x5F02;&#x5E38;&#x4FE1;&#x606F;&#x62A5;&#x544A;&#x7684;&#x670D;&#x52A1;&#x3002;&#x5982;&#x679C;&#x8FD9;&#x4E9B;&#x5F02;&#x5E38;&#x53D1;&#x751F;&#x5728;Dapper&#x8DDF;&#x8E2A;&#x91C7;&#x6837;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#xFF0C;&#x90A3;&#x4E48;&#x76F8;&#x5E94;&#x7684;&#x8DDF;&#x8E2A;ID&#x548C;span&#x7684;ID&#x4E5F;&#x4F1A;&#x4F5C;&#x4E3A;&#x5143;&#x6570;&#x636E;&#x8BB0;&#x5F55;&#x5728;&#x5F02;&#x5E38;&#x62A5;&#x544A;&#x4E2D;&#x3002;&#x5F02;&#x5E38;&#x76D1;&#x6D4B;&#x670D;&#x52A1;&#x7684;&#x524D;&#x7AEF;&#x4F1A;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x94FE;&#x63A5;&#xFF0C;&#x4ECE;&#x7279;&#x5B9A;&#x7684;&#x5F02;&#x5E38;&#x4FE1;&#x606F;&#x7684;&#x62A5;&#x544A;&#x76F4;&#x63A5;&#x5BFC;&#x5411;&#x5230;&#x4ED6;&#x4EEC;&#x5404;&#x81EA;&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x8DDF;&#x8E2A;&#x3002;&#x5E7F;&#x544A;&#x5BA1;&#x67E5;&#x56E2;&#x961F;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x529F;&#x80FD;&#x53EF;&#x4EE5;&#x4E86;&#x89E3;bug&#x53D1;&#x751F;&#x7684;&#x66F4;&#x5927;&#x8303;&#x56F4;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x3002;&#x901A;&#x8FC7;&#x66B4;&#x9732;&#x57FA;&#x4E8E;&#x7B80;&#x5355;&#x7684;&#x552F;&#x4E00;ID&#x6784;&#x5EFA;&#x7684;&#x63A5;&#x53E3;&#xFF0C;Dapper&#x5E73;&#x53F0;&#x88AB;&#x96C6;&#x6210;&#x5230;&#x5176;&#x4ED6;&#x4E8B;&#x4EF6;&#x76D1;&#x6D4B;&#x7CFB;&#x7EDF;&#x4F1A;&#x76F8;&#x5BF9;&#x5BB9;&#x6613;&#x3002;</p>
<h2 id="6-2-&#x89E3;&#x51B3;&#x5EF6;&#x8FDF;&#x7684;&#x957F;&#x5C3E;&#x6548;&#x5E94;"><a href="#6-2-&#x89E3;&#x51B3;&#x5EF6;&#x8FDF;&#x7684;&#x957F;&#x5C3E;&#x6548;&#x5E94;" class="headerlink" title="6.2 &#x89E3;&#x51B3;&#x5EF6;&#x8FDF;&#x7684;&#x957F;&#x5C3E;&#x6548;&#x5E94;"></a>6.2 &#x89E3;&#x51B3;&#x5EF6;&#x8FDF;&#x7684;&#x957F;&#x5C3E;&#x6548;&#x5E94;</h2><p>&#x8003;&#x8651;&#x5230;&#x79FB;&#x52A8;&#x90E8;&#x4EF6;&#x7684;&#x6570;&#x91CF;&#x3001;&#x4EE3;&#x7801;&#x5E93;&#x7684;&#x89C4;&#x6A21;&#x3001;&#x90E8;&#x7F72;&#x7684;&#x8303;&#x56F4;&#xFF0C;&#x8C03;&#x8BD5;&#x4E00;&#x4E2A;&#x50CF;&#x5168;&#x6587;&#x641C;&#x7D22;&#x90A3;&#x6837;&#x670D;&#x52A1;&#xFF08;&#x7B2C;1&#x8282;&#x91CC;&#x63D0;&#x5230;&#x8FC7;&#xFF09;&#x662F;&#x975E;&#x5E38;&#x5177;&#x6709;&#x6311;&#x6218;&#x6027;&#x7684;&#x3002;&#x5728;&#x8FD9;&#x8282;&#xFF0C;&#x6211;&#x4EEC;&#x63CF;&#x8FF0;&#x4E86;&#x6211;&#x4EEC;&#x5728;&#x51CF;&#x8F7B;&#x5168;&#x6587;&#x641C;&#x7D22;&#x7684;&#x5EF6;&#x8FDF;&#x5206;&#x5E03;&#x7684;&#x957F;&#x5C3E;&#x6548;&#x5E94;&#x4E0A;&#x505A;&#x7684;&#x5404;&#x79CD;&#x52AA;&#x529B;&#x3002;Dapper&#x80FD;&#x591F;&#x9A8C;&#x8BC1;&#x7AEF;&#x5230;&#x7AEF;&#x7684;&#x5EF6;&#x8FDF;&#x7684;&#x5047;&#x8BBE;&#xFF0C;&#x66F4;&#x5177;&#x4F53;&#x5730;&#x8BF4;&#xFF0C;Dapper&#x80FD;&#x591F;&#x9A8C;&#x8BC1;&#x5BF9;&#x4E8E;&#x641C;&#x7D22;&#x8BF7;&#x6C42;&#x7684;&#x5173;&#x952E;&#x8DEF;&#x5F84;&#x3002;&#x5F53;&#x4E00;&#x4E2A;&#x7CFB;&#x7EDF;&#x4E0D;&#x4EC5;&#x6D89;&#x53CA;&#x6570;&#x4E2A;&#x5B50;&#x7CFB;&#x7EDF;&#xFF0C;&#x800C;&#x662F;&#x51E0;&#x5341;&#x4E2A;&#x5F00;&#x53D1;&#x56E2;&#x961F;&#x7684;&#x6D89;&#x53CA;&#x5230;&#x7684;&#x7CFB;&#x7EDF;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x7AEF;&#x5230;&#x7AEF;&#x6027;&#x80FD;&#x8F83;&#x5DEE;&#x7684;&#x6839;&#x672C;&#x539F;&#x56E0;&#x5230;&#x5E95;&#x5728;&#x54EA;&#xFF0C;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x5373;&#x4F7F;&#x662F;&#x6211;&#x4EEC;&#x6700;&#x597D;&#x7684;&#x548C;&#x6700;&#x6709;&#x7ECF;&#x9A8C;&#x7684;&#x5DE5;&#x7A0B;&#x5E08;&#x4E5F;&#x65E0;&#x6CD5;&#x6B63;&#x786E;&#x56DE;&#x7B54;&#x3002;&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;Dapper&#x53EF;&#x4EE5;&#x63D0;&#x4F9B;&#x6025;&#x9700;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x800C;&#x4E14;&#x53EF;&#x4EE5;&#x5BF9;&#x8BB8;&#x591A;&#x91CD;&#x8981;&#x7684;&#x6027;&#x80FD;&#x95EE;&#x9898;&#x5F97;&#x51FA;&#x7ED3;&#x8BBA;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/2778619cec249147376e1af27fdd4f6a5807445294e4b8ff40adf61d52b69d0d" alt><br>&#x56FE;7&#xFF1A;&#x5168;&#x5C40;&#x641C;&#x7D22;&#x7684;&#x8DDF;&#x8E2A;&#x7247;&#x6BB5;&#xFF0C;&#x5728;&#x4E0D;&#x5E38;&#x9047;&#x5230;&#x9AD8;&#x7F51;&#x7EDC;&#x5EF6;&#x8FDF;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5728;&#x6CBF;&#x7740;&#x5173;&#x952E;&#x8DEF;&#x5F84;&#x7684;&#x7AEF;&#x5230;&#x7AEF;&#x7684;&#x8BF7;&#x6C42;&#x5EF6;&#x8FDF;&#xFF0C;&#x5982;&#x56FE;&#x6240;&#x793A;&#x3002;</p>
<p>&#x5728;&#x8C03;&#x8BD5;&#x5EF6;&#x8FDF;&#x957F;&#x5C3E;&#x6548;&#x5E94;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x5DE5;&#x7A0B;&#x5E08;&#x53EF;&#x4EE5;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;&#x5C0F;&#x578B;&#x5E93;&#xFF0C;&#x8FD9;&#x4E2A;&#x5C0F;&#x578B;&#x5E93;&#x53EF;&#x4EE5;&#x6839;&#x636E;DAPI&#x8DDF;&#x8E2A;&#x5BF9;&#x8C61;&#x6765;&#x63A8;&#x65AD;&#x5173;&#x952E;&#x8DEF;&#x5F84;&#x7684;&#x5C42;&#x7EA7;&#x7ED3;&#x6784;&#x3002;&#x8FD9;&#x4E9B;&#x5173;&#x952E;&#x8DEF;&#x5F84;&#x7684;&#x7ED3;&#x6784;&#x53EF;&#x4EE5;&#x88AB;&#x7528;&#x6765;&#x8BCA;&#x65AD;&#x95EE;&#x9898;&#xFF0C;&#x5E76;&#x4E14;&#x4E3A;&#x5168;&#x6587;&#x641C;&#x7D22;&#x63D0;&#x4F9B;&#x53EF;&#x4F18;&#x5148;&#x5904;&#x7406;&#x7684;&#x9884;&#x671F;&#x7684;&#x6027;&#x80FD;&#x6539;&#x8FDB;&#x3002;Dapper&#x7684;&#x8FD9;&#x9879;&#x5DE5;&#x4F5C;&#x5BFC;&#x81F4;&#x4E86;&#x4E0B;&#x5217;&#x53D1;&#x73B0;&#xFF1A;</p>
<ul>
<li>&#x5728;&#x5173;&#x952E;&#x8DEF;&#x5F84;&#x4E0A;&#x7684;&#x77ED;&#x6682;&#x7684;&#x7F51;&#x7EDC;&#x6027;&#x80FD;&#x9000;&#x5316;&#x4E0D;&#x5F71;&#x54CD;&#x7CFB;&#x7EDF;&#x7684;&#x541E;&#x5410;&#x91CF;&#xFF0C;&#x4F46;&#x5B83;&#x53EF;&#x80FD;&#x4F1A;&#x5BF9;&#x5EF6;&#x8FDF;&#x5F02;&#x5E38;&#x503C;&#x4EA7;&#x751F;&#x6781;&#x5927;&#x7684;&#x5F71;&#x54CD;&#x3002;&#x5728;&#x56FE;7&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x5927;&#x90E8;&#x5206;&#x7684;&#x5168;&#x5C40;&#x641C;&#x7D22;&#x7684;&#x7F13;&#x6162;&#x7684;&#x8DDF;&#x8E2A;&#x90FD;&#x6765;&#x6E90;&#x4E8E;&#x5173;&#x952E;&#x8DEF;&#x5F84;&#x7684;&#x7F51;&#x7EDC;&#x6027;&#x80FD;&#x9000;&#x5316;&#x3002;</li>
<li>&#x8BB8;&#x591A;&#x95EE;&#x9898;&#x548C;&#x4EE3;&#x4EF7;&#x5F88;&#x9AD8;&#x7684;&#x67E5;&#x8BE2;&#x6A21;&#x5F0F;&#x6765;&#x6E90;&#x4E8E;&#x4E00;&#x4E9B;&#x610F;&#x60F3;&#x4E0D;&#x5230;&#x7684;&#x670D;&#x52A1;&#x4E4B;&#x95F4;&#x7684;&#x4EA4;&#x4E92;&#x3002;&#x4E00;&#x65E6;&#x53D1;&#x73B0;&#xFF0C;&#x5F80;&#x5F80;&#x5BB9;&#x6613;&#x7EA0;&#x6B63;&#x5B83;&#x4EEC;&#xFF0C;&#x4F46;&#x662F;Dapper&#x51FA;&#x73B0;&#x4E4B;&#x524D;&#x60F3;&#x627E;&#x51FA;&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#x662F;&#x76F8;&#x5F53;&#x56F0;&#x96BE;&#x7684;&#x3002;</li>
<li>&#x901A;&#x7528;&#x7684;&#x67E5;&#x8BE2;&#x4ECE;Dapper&#x4E4B;&#x5916;&#x7684;&#x5B89;&#x5168;&#x65E5;&#x5FD7;&#x4ED3;&#x5E93;&#x4E2D;&#x6536;&#x53D6;&#xFF0C;&#x5E76;&#x4F7F;&#x7528;Dapper&#x552F;&#x4E00;&#x7684;&#x8DDF;&#x8E2A;ID&#xFF0C;&#x4E0E;Dapper&#x7684;&#x4ED3;&#x5E93;&#x505A;&#x5173;&#x8054;&#x3002;&#x7136;&#x540E;&#xFF0C;&#x8BE5;&#x6620;&#x5C04;&#x7528;&#x6765;&#x5EFA;&#x7ACB;&#x5173;&#x4E8E;&#x5728;&#x5168;&#x5C40;&#x641C;&#x7D22;&#x4E2D;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;&#x72EC;&#x7ACB;&#x5B50;&#x7CFB;&#x7EDF;&#x90FD;&#x5F88;&#x6162;&#x7684;&#x5B9E;&#x4F8B;&#x67E5;&#x8BE2;&#x7684;&#x5217;&#x8868;&#x3002;</li>
</ul>
<h2 id="6-3-&#x63A8;&#x65AD;&#x670D;&#x52A1;&#x4F9D;&#x8D56;"><a href="#6-3-&#x63A8;&#x65AD;&#x670D;&#x52A1;&#x4F9D;&#x8D56;" class="headerlink" title="6.3 &#x63A8;&#x65AD;&#x670D;&#x52A1;&#x4F9D;&#x8D56;"></a>6.3 &#x63A8;&#x65AD;&#x670D;&#x52A1;&#x4F9D;&#x8D56;</h2><p>&#x5728;&#x4EFB;&#x4F55;&#x7ED9;&#x5B9A;&#x7684;&#x65F6;&#x95F4;&#x5185;&#xFF0C;Google&#x5185;&#x90E8;&#x7684;&#x4E00;&#x4E2A;&#x5178;&#x578B;&#x7684;&#x8BA1;&#x7B97;&#x96C6;&#x7FA4;&#x662F;&#x4E00;&#x4E2A;&#x6C47;&#x96C6;&#x4E86;&#x6210;&#x5343;&#x4E0A;&#x4E07;&#x4E2A;&#x903B;&#x8F91;&#x201C;&#x4EFB;&#x52A1;&#x201D;&#x7684;&#x4E3B;&#x673A;&#xFF0C;&#x4E00;&#x5957;&#x7684;&#x5904;&#x7406;&#x5668;&#x5728;&#x6267;&#x884C;&#x4E00;&#x4E2A;&#x901A;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#x3002;Google&#x7EF4;&#x62A4;&#x7740;&#x8BB8;&#x591A;&#x8FD9;&#x6837;&#x7684;&#x96C6;&#x7FA4;&#xFF0C;&#x5F53;&#x7136;&#xFF0C;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;&#x6211;&#x4EEC;&#x53D1;&#x73B0;&#x5728;&#x4E00;&#x4E2A;&#x96C6;&#x7FA4;&#x4E0A;&#x8BA1;&#x7B97;&#x7740;&#x7684;&#x8FD9;&#x4E9B;&#x4EFB;&#x52A1;&#x901A;&#x5E38;&#x4F9D;&#x8D56;&#x4E8E;&#x5176;&#x4ED6;&#x7684;&#x96C6;&#x7FA4;&#x4E0A;&#x7684;&#x4EFB;&#x52A1;&#x3002;&#x7531;&#x4E8E;&#x4EFB;&#x52A1;&#x4EEC;&#x4E4B;&#x95F4;&#x7684;&#x4F9D;&#x8D56;&#x662F;&#x52A8;&#x6001;&#x6539;&#x53D8;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x53EF;&#x80FD;&#x4EC5;&#x4ECE;&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#x4E0A;&#x63A8;&#x65AD;&#x51FA;&#x6240;&#x6709;&#x8FD9;&#x4E9B;&#x670D;&#x52A1;&#x4E4B;&#x95F4;&#x7684;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#x3002;&#x4E0D;&#x8FC7;&#xFF0C;&#x9664;&#x4E86;&#x5176;&#x4ED6;&#x65B9;&#x9762;&#x7684;&#x539F;&#x56E0;&#x4E4B;&#x5916;&#xFF0C;&#x5728;&#x516C;&#x53F8;&#x5185;&#x90E8;&#x7684;&#x5404;&#x4E2A;&#x6D41;&#x7A0B;&#x9700;&#x8981;&#x51C6;&#x786E;&#x7684;&#x670D;&#x52A1;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#x4FE1;&#x606F;&#xFF0C;&#x4EE5;&#x786E;&#x5B9A;&#x74F6;&#x9888;&#x6240;&#x5728;&#xFF0C;&#x4EE5;&#x53CA;&#x8BA1;&#x5212;&#x670D;&#x52A1;&#x7684;&#x8FC1;&#x79FB;&#x3002;Google&#x7684;&#x53EF;&#x79F0;&#x4E3A;&#x201C;Service<br> Dependencies&#x201D;&#x7684;&#x9879;&#x76EE;&#x662F;&#x901A;&#x8FC7;&#x4F7F;&#x7528;&#x8DDF;&#x8E2A;Annotation&#x548C;DAPI MapReduce&#x63A5;&#x53E3;&#x6765;&#x5B9E;&#x73B0;&#x81EA;&#x52A8;&#x5316;&#x786E;&#x5B9A;&#x670D;&#x52A1;&#x4F9D;&#x8D56;&#x5F52;&#x5C5E;&#x7684;&#x3002;</p>
<p>Dapper&#x6838;&#x5FC3;&#x7EC4;&#x4EF6;&#x4E0E;Dapper&#x8DDF;&#x8E2A;Annotation&#x4E00;&#x5E76;&#x4F7F;&#x7528;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x201C;Service Dependencies&#x201D;&#x9879;&#x76EE;&#x80FD;&#x591F;&#x63A8;&#x7B97;&#x51FA;&#x4EFB;&#x52A1;&#x5404;&#x81EA;&#x4E4B;&#x95F4;&#x7684;&#x4F9D;&#x8D56;&#xFF0C;&#x4EE5;&#x53CA;&#x4EFB;&#x52A1;&#x548C;&#x5176;&#x4ED6;&#x8F6F;&#x4EF6;&#x7EC4;&#x4EF6;&#x4E4B;&#x95F4;&#x7684;&#x4F9D;&#x8D56;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x6240;&#x6709;&#x7684;BigTable&#x7684;&#x64CD;&#x4F5C;&#x4F1A;&#x52A0;&#x4E0A;&#x4E0E;&#x53D7;&#x5F71;&#x54CD;&#x7684;&#x8868;&#x540D;&#x79F0;&#x76F8;&#x5173;&#x7684;&#x6807;&#x8BB0;&#x3002;&#x8FD0;&#x7528;Dapper&#x7684;&#x5E73;&#x53F0;&#xFF0C;Service Dependencies&#x56E2;&#x961F;&#x5C31;&#x53EF;&#x4EE5;&#x81EA;&#x52A8;&#x7684;&#x63A8;&#x7B97;&#x51FA;&#x4F9D;&#x8D56;&#x4E8E;&#x547D;&#x540D;&#x7684;&#x4E0D;&#x540C;&#x8D44;&#x6E90;&#x7684;&#x670D;&#x52A1;&#x7C92;&#x5EA6;&#x3002;</p>
<h2 id="6-4-&#x4E0D;&#x540C;&#x670D;&#x52A1;&#x7684;&#x7F51;&#x7EDC;&#x4F7F;&#x7528;&#x7387;"><a href="#6-4-&#x4E0D;&#x540C;&#x670D;&#x52A1;&#x7684;&#x7F51;&#x7EDC;&#x4F7F;&#x7528;&#x7387;" class="headerlink" title="6.4 &#x4E0D;&#x540C;&#x670D;&#x52A1;&#x7684;&#x7F51;&#x7EDC;&#x4F7F;&#x7528;&#x7387;"></a>6.4 &#x4E0D;&#x540C;&#x670D;&#x52A1;&#x7684;&#x7F51;&#x7EDC;&#x4F7F;&#x7528;&#x7387;</h2><p>Google&#x6295;&#x5165;&#x4E86;&#x5927;&#x91CF;&#x7684;&#x4EBA;&#x529B;&#x548C;&#x7269;&#x529B;&#x8D44;&#x6E90;&#x5728;&#x4ED6;&#x7684;&#x7F51;&#x7EDC;&#x7ED3;&#x6784;&#x4E0A;&#x3002;&#x4ECE;&#x524D;&#x7F51;&#x7EDC;&#x7BA1;&#x7406;&#x5458;&#x53EF;&#x80FD;&#x53EA;&#x5173;&#x6CE8;&#x72EC;&#x7ACB;&#x7684;&#x786C;&#x4EF6;&#x4FE1;&#x606F;&#x3001;&#x5E38;&#x7528;&#x5DE5;&#x5177;&#x53CA;&#x4EE5;&#x53CA;&#x642D;&#x5EFA;&#x51FA;&#x7684;&#x5404;&#x79CD;&#x5168;&#x5C40;&#x7F51;&#x7EDC;&#x9E1F;&#x77B0;&#x56FE;&#x7684;dashboard&#x4E0A;&#x7684;&#x4FE1;&#x606F;&#x3002;&#x7F51;&#x7EDC;&#x7BA1;&#x7406;&#x5458;&#x786E;&#x5B9E;&#x53EF;&#x4EE5;&#x4E00;&#x89C8;&#x6574;&#x4E2A;&#x7F51;&#x7EDC;&#x7684;&#x5065;&#x5EB7;&#x72B6;&#x51B5;&#xFF0C;&#x4F46;&#x662F;&#xFF0C;&#x5F53;&#x9047;&#x5230;&#x95EE;&#x9898;&#x65F6;&#xFF0C;&#x4ED6;&#x4EEC;&#x5F88;&#x5C11;&#x6709;&#x80FD;&#x591F;&#x51C6;&#x786E;&#x67E5;&#x627E;&#x7F51;&#x7EDC;&#x8D1F;&#x8F7D;&#x7684;&#x5DE5;&#x5177;&#xFF0C;&#x7528;&#x6765;&#x5B9A;&#x4F4D;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7EA7;&#x522B;&#x7684;&#x7F6A;&#x9B41;&#x7978;&#x9996;&#x3002;</p>
<p>&#x867D;&#x7136;Dapper&#x4E0D;&#x662F;&#x8BBE;&#x8BA1;&#x7528;&#x6765;&#x505A;&#x94FE;&#x8DEF;&#x7EA7;&#x7684;&#x76D1;&#x63A7;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x53D1;&#x73B0;&#xFF0C;&#x5B83;&#x662F;&#x975E;&#x5E38;&#x9002;&#x5408;&#x53BB;&#x505A;&#x96C6;&#x7FA4;&#x4E4B;&#x95F4;&#x7F51;&#x7EDC;&#x6D3B;&#x52A8;&#x6027;&#x7684;&#x5E94;&#x7528;&#x7EA7;&#x4EFB;&#x52A1;&#x7684;&#x5206;&#x6790;&#x3002;Google&#x80FD;&#x591F;&#x5229;&#x7528;Dapper&#x8FD9;&#x4E2A;&#x5E73;&#x53F0;&#xFF0C;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;&#x4E0D;&#x65AD;&#x66F4;&#x65B0;&#x7684;&#x63A7;&#x5236;&#x53F0;&#xFF0C;&#x6765;&#x663E;&#x793A;&#x96C6;&#x7FA4;&#x4E4B;&#x95F4;&#x6700;&#x6D3B;&#x8DC3;&#x7684;&#x7F51;&#x7EDC;&#x6D41;&#x91CF;&#x7684;&#x5E94;&#x7528;&#x7EA7;&#x7684;&#x70ED;&#x70B9;&#x3002;&#x6B64;&#x5916;&#xFF0C;&#x4F7F;&#x7528;Dapper&#x6211;&#x4EEC;&#x80FD;&#x591F;&#x4E3A;&#x6602;&#x8D35;&#x7684;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x63D0;&#x4F9B;&#x6307;&#x51FA;&#x7684;&#x6784;&#x6210;&#x539F;&#x56E0;&#x7684;&#x8DDF;&#x8E2A;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x9762;&#x5BF9;&#x4E0D;&#x540C;&#x670D;&#x52A1;&#x5668;&#x4E4B;&#x95F4;&#x7684;&#x4FE1;&#x606F;&#x5B64;&#x5C9B;&#x800C;&#x65E0;&#x6240;&#x9002;&#x4ECE;&#x3002;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;&#x57FA;&#x4E8E;Dapper API&#x7684;dashboard&#x603B;&#x5171;&#x6CA1;&#x82B1;&#x8D85;&#x8FC7;2&#x5468;&#x7684;&#x65F6;&#x95F4;&#x3002;</p>
<h2 id="6-5-&#x5206;&#x5C42;&#x548C;&#x5171;&#x4EAB;&#x5B58;&#x50A8;&#x7CFB;&#x7EDF;"><a href="#6-5-&#x5206;&#x5C42;&#x548C;&#x5171;&#x4EAB;&#x5B58;&#x50A8;&#x7CFB;&#x7EDF;" class="headerlink" title="6.5 &#x5206;&#x5C42;&#x548C;&#x5171;&#x4EAB;&#x5B58;&#x50A8;&#x7CFB;&#x7EDF;"></a>6.5 &#x5206;&#x5C42;&#x548C;&#x5171;&#x4EAB;&#x5B58;&#x50A8;&#x7CFB;&#x7EDF;</h2><p>&#x5728;Google&#x7684;&#x8BB8;&#x591A;&#x5B58;&#x50A8;&#x7CFB;&#x7EDF;&#x662F;&#x7531;&#x591A;&#x91CD;&#x72EC;&#x7ACB;&#x590D;&#x6742;&#x5C42;&#x7EA7;&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x57FA;&#x7840;&#x8BBE;&#x5907;&#x7EC4;&#x6210;&#x7684;&#x3002;&#x4F8B;&#x5982;&#xFF0C;Google&#x7684;App Engine[5]&#x5C31;&#x662F;&#x642D;&#x5EFA;&#x5728;&#x4E00;&#x4E2A;&#x53EF;&#x6269;&#x5C55;&#x7684;&#x5B9E;&#x4F53;&#x5B58;&#x50A8;&#x7CFB;&#x7EDF;&#x4E0A;&#x7684;&#x3002;&#x8BE5;&#x5B9E;&#x4F53;&#x5B58;&#x50A8;&#x7CFB;&#x7EDF;&#x5728;&#x57FA;&#x4E8E;BigTable&#x4E0A;&#x516C;&#x5F00;&#x67D0;&#x4E9B;RDBMS&#x529F;&#x80FD;&#x3002; BigTable&#x7684;&#x540C;&#x65F6;&#x4F7F;&#x7528;Chubby[7]&#xFF08;&#x5206;&#x5E03;&#x5F0F;&#x9501;&#x7CFB;&#x7EDF;&#xFF09;&#x53CA;GFS&#x3002;&#x518D;&#x8005;&#xFF0C;&#x50CF;BigTable&#x8FD9;&#x6837;&#x7684;&#x7CFB;&#x7EDF;&#x7B80;&#x5316;&#x4E86;&#x90E8;&#x7F72;&#xFF0C;&#x5E76;&#x66F4;&#x597D;&#x7684;&#x5229;&#x7528;&#x4E86;&#x8BA1;&#x7B97;&#x8D44;&#x6E90;&#x3002;</p>
<p>&#x5728;&#x8FD9;&#x79CD;&#x5206;&#x5C42;&#x7684;&#x7CFB;&#x7EDF;&#xFF0C;&#x5E76;&#x4E0D;&#x603B;&#x662F;&#x5F88;&#x5BB9;&#x6613;&#x786E;&#x5B9A;&#x6700;&#x7EC8;&#x7528;&#x6237;&#x8D44;&#x6E90;&#x7684;&#x6D88;&#x8D39;&#x6A21;&#x5F0F;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x6765;&#x81EA;&#x4E8E;&#x4E00;&#x4E2A;&#x7ED9;&#x5B9A;&#x7684;BigTable&#x5355;&#x5143;&#x683C;&#x7684;GFS&#x5927;&#x4FE1;&#x606F;&#x91CF;&#x4E3B;&#x8981;&#x6765;&#x81EA;&#x4E8E;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x6216;&#x662F;&#x7531;&#x591A;&#x4E2A;&#x7528;&#x6237;&#x4EA7;&#x751F;&#xFF0C;&#x4F46;&#x662F;&#x5728;GFS&#x5C42;&#x9762;&#xFF0C;&#x8FD9;&#x4E24;&#x79CD;&#x660E;&#x663E;&#x7684;&#x4F7F;&#x7528;&#x573A;&#x666F;&#x662F;&#x5F88;&#x96BE;&#x754C;&#x5B9A;&#x3002;&#x800C;&#x4E14;&#xFF0C;&#x5982;&#x679C;&#x7F3A;&#x4E4F;&#x4E00;&#x4E2A;&#x50CF;Dapper&#x4E00;&#x6837;&#x7684;&#x5DE5;&#x5177;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5BF9;&#x5171;&#x4EAB;&#x670D;&#x52A1;&#x7684;&#x7ADE;&#x4E89;&#x53EF;&#x80FD;&#x4F1A;&#x540C;&#x6837;&#x96BE;&#x4E8E;&#x8C03;&#x8BD5;&#x3002;</p>
<p>&#x7B2C;5.2&#x8282;&#x4E2D;&#x6240;&#x793A;&#x7684;Dapper&#x7684;&#x7528;&#x6237;&#x754C;&#x9762;&#x53EF;&#x4EE5;&#x805A;&#x5408;&#x90A3;&#x4E9B;&#x8C03;&#x7528;&#x4EFB;&#x610F;&#x516C;&#x5171;&#x670D;&#x52A1;&#x7684;&#x591A;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x8DDF;&#x8E2A;&#x7684;&#x6027;&#x80FD;&#x4FE1;&#x606F;&#x3002;&#x8FD9;&#x5C31;&#x5F88;&#x5BB9;&#x6613;&#x8BA9;&#x63D0;&#x4F9B;&#x8FD9;&#x4E9B;&#x670D;&#x52A1;&#x7684;&#x6E90;&#x4ECE;&#x591A;&#x4E2A;&#x7EF4;&#x5EA6;&#x7ED9;&#x4ED6;&#x4EEC;&#x7684;&#x7528;&#x6237;&#x6392;&#x540D;&#x3002;&#xFF08;&#x4F8B;&#x5982;&#xFF0C;&#x5165;&#x7AD9;&#x7684;&#x7F51;&#x7EDC;&#x8D1F;&#x8F7D;&#xFF0C;&#x51FA;&#x7AD9;&#x7684;&#x7F51;&#x7EDC;&#x8D1F;&#x8F7D;&#xFF0C;&#x6216;&#x670D;&#x52A1;&#x8BF7;&#x6C42;&#x7684;&#x603B;&#x65F6;&#x95F4;&#xFF09;</p>
<h2 id="6-6-Dapper&#x7684;&#x6551;&#x706B;&#x80FD;&#x529B;-Firefighting"><a href="#6-6-Dapper&#x7684;&#x6551;&#x706B;&#x80FD;&#x529B;-Firefighting" class="headerlink" title="6.6 Dapper&#x7684;&#x6551;&#x706B;&#x80FD;&#x529B;(Firefighting)"></a>6.6 Dapper&#x7684;&#x6551;&#x706B;&#x80FD;&#x529B;(Firefighting)</h2><p>&#x5BF9;&#x4E8E;&#x4E00;&#x4E9B;&#x201C;&#x6551;&#x706B;&#x201D;&#x4EFB;&#x52A1;&#xFF0C;Dapper&#x53EF;&#x4EE5;&#x5904;&#x7406;&#x5176;&#x4E2D;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x3002;&#x201C;&#x6551;&#x706B;&#x201D;&#x4EFB;&#x52A1;&#x5728;&#x8FD9;&#x91CC;&#x662F;&#x6307;&#x4E00;&#x4E9B;&#x6709;&#x98CE;&#x9669;&#x5F88;&#x9AD8;&#x7684;&#x5728;&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#x4E0A;&#x7684;&#x64CD;&#x4F5C;&#x3002;&#x901A;&#x5E38;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;Dapper&#x7528;&#x6237;&#x5F53;&#x6B63;&#x5728;&#x8FDB;&#x884C;&#x201C;&#x6551;&#x706B;&#x201D;&#x4EFB;&#x52A1;&#x65F6;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x65B0;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x5E76;&#x4E14;&#x6CA1;&#x6709;&#x65F6;&#x95F4;&#x5199;&#x65B0;&#x7684;DAPI&#x4EE3;&#x7801;&#x6216;&#x7B49;&#x5F85;&#x5468;&#x671F;&#x6027;&#x7684;&#x62A5;&#x544A;&#x8FD0;&#x884C;&#x3002;</p>
<p>&#x5BF9;&#x4E8E;&#x90A3;&#x4E9B;&#x9AD8;&#x5EF6;&#x8FDF;&#xFF0C;&#x4E0D;&#xFF0C;&#x53EF;&#x80FD;&#x66F4;&#x7CDF;&#x7CD5;&#x7684;&#x90A3;&#x4E9B;&#x5728;&#x6B63;&#x5E38;&#x8D1F;&#x8F7D;&#x4E0B;&#x90FD;&#x4F1A;&#x54CD;&#x5E94;&#x8D85;&#x65F6;&#x7684;&#x670D;&#x52A1;&#xFF0C;Dapper&#x7528;&#x6237;&#x754C;&#x9762;&#x901A;&#x5E38;&#x4F1A;&#x628A;&#x8FD9;&#x4E9B;&#x5EF6;&#x8FDF;&#x74F6;&#x9888;&#x7684;&#x4F4D;&#x7F6E;&#x9694;&#x79BB;&#x51FA;&#x6765;&#x3002;&#x901A;&#x8FC7;&#x4E0E;Dapper&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x7684;&#x76F4;&#x63A5;&#x901A;&#x4FE1;&#xFF0C;&#x90A3;&#x4E9B;&#x7279;&#x5B9A;&#x7684;&#x9AD8;&#x5EF6;&#x8FDF;&#x7684;&#x8DDF;&#x8E2A;&#x6570;&#x636E;&#x8F7B;&#x6613;&#x7684;&#x6536;&#x96C6;&#x5230;&#x3002;&#x5F53;&#x51FA;&#x73B0;&#x707E;&#x96BE;&#x6027;&#x6545;&#x969C;&#x65F6;&#xFF0C;&#x901A;&#x5E38;&#x662F;&#x6CA1;&#x6709;&#x5FC5;&#x8981;&#x53BB;&#x770B;&#x7EDF;&#x8BA1;&#x6570;&#x636E;&#x4EE5;&#x786E;&#x5B9A;&#x6839;&#x672C;&#x539F;&#x56E0;&#xFF0C;&#x53EA;&#x67E5;&#x770B;&#x793A;&#x4F8B;&#x8DDF;&#x8E2A;&#x5C31;&#x8DB3;&#x591F;&#x4E86;(&#x56E0;&#x4E3A;&#x524D;&#x6587;&#x63D0;&#x5230;&#x8FC7;&#x4ECE;Dapper&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x4E2D;&#x51E0;&#x4E4E;&#x53EF;&#x4EE5;&#x7ACB;&#x5373;&#x83B7;&#x5F97;&#x8DDF;&#x8E2A;&#x6570;&#x636E;)&#x3002;</p>
<p>&#x4F46;&#x662F;&#xFF0C;&#x5982;&#x5728;6.5&#x8282;&#x4E2D;&#x63CF;&#x8FF0;&#x7684;&#x5171;&#x4EAB;&#x7684;&#x5B58;&#x50A8;&#x670D;&#x52A1;&#xFF0C;&#x8981;&#x6C42;&#x5F53;&#x7528;&#x6237;&#x6D3B;&#x52A8;&#x8FC7;&#x7A0B;&#x4E2D;&#x7A81;&#x7136;&#x4E2D;&#x65AD;&#x65F6;&#x80FD;&#x5C3D;&#x53EF;&#x80FD;&#x5FEB;&#x7684;&#x6C47;&#x603B;&#x4FE1;&#x606F;&#x3002;&#x5BF9;&#x4E8E;&#x4E8B;&#x4EF6;&#x53D1;&#x751F;&#x4E4B;&#x540E;&#xFF0C;&#x5171;&#x4EAB;&#x670D;&#x52A1;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x6C47;&#x603B;&#x7684;&#x7684;Dapper&#x6570;&#x636E;&#xFF0C;&#x4F46;&#x662F;&#xFF0C;&#x9664;&#x975E;&#x6536;&#x96C6;&#x5230;&#x7684;Dapper&#x6570;&#x636E;&#x7684;&#x6279;&#x91CF;&#x5206;&#x6790;&#x80FD;&#x5728;&#x95EE;&#x9898;&#x51FA;&#x73B0;10&#x5206;&#x949F;&#x4E4B;&#x5185;&#x5B8C;&#x6210;&#xFF0C;&#x5426;&#x5219;Dapper&#x9762;&#x5BF9;&#x4E0E;&#x5171;&#x4EAB;&#x5B58;&#x50A8;&#x670D;&#x52A1;&#x76F8;&#x5173;&#x7684;&#x201C;&#x6551;&#x706B;&#x201D;&#x4EFB;&#x52A1;&#x5C31;&#x5F88;&#x96BE;&#x6309;&#x9884;&#x60F3;&#x7684;&#x90A3;&#x822C;&#x987A;&#x5229;&#x5B8C;&#x6210;&#x3002;</p>
<ol start="7">
<li>&#x5176;&#x4ED6;&#x6536;&#x83B7;</li>
</ol>
<hr>
<p>&#x867D;&#x7136;&#x8FC4;&#x4ECA;&#x4E3A;&#x6B62;&#xFF0C;&#x6211;&#x4EEC;&#x5728;Dapper&#x4E0A;&#x7684;&#x7ECF;&#x9A8C;&#x5DF2;&#x7ECF;&#x5927;&#x81F4;&#x7B26;&#x5408;&#x6211;&#x4EEC;&#x7684;&#x9884;&#x671F;&#xFF0C;&#x4F46;&#x662F;&#x4E5F;&#x51FA;&#x73B0;&#x4E86;&#x4E00;&#x4E9B;&#x79EF;&#x6781;&#x7684;&#x65B9;&#x9762;&#x662F;&#x6211;&#x4EEC;&#x6CA1;&#x6709;&#x5145;&#x5206;&#x9884;&#x6599;&#x5230;&#x7684;&#x3002;&#x9996;&#x5148;&#xFF0C;&#x6211;&#x4EEC;&#x83B7;&#x5F97;&#x4E86;&#x8D85;&#x51FA;&#x9884;&#x671F;&#x7684;Dapper&#x4F7F;&#x7528;&#x7528;&#x4F8B;&#x7684;&#x6570;&#x91CF;&#xFF0C;&#x5BF9;&#x6B64;&#x6211;&#x4EEC;&#x53EF;&#x8C13;&#x6B22;&#x5FC3;&#x9F13;&#x821E;&#x3002;&#x53E6;&#x5916;&#xFF0C;&#x5728;&#x9664;&#x4E86;&#x51E0;&#x4E2A;&#x7684;&#x5728;&#x7B2C;6&#x8282;&#x4F7F;&#x7528;&#x7ECF;&#x9A8C;&#x4E2D;&#x63D0;&#x5230;&#x8FC7;&#x7684;&#x4E00;&#x4E9B;&#x7528;&#x4F8B;&#x4E4B;&#x5916;&#xFF0C;&#x8FD8;&#x5305;&#x62EC;&#x8D44;&#x6E90;&#x6838;&#x7B97;&#x7CFB;&#x7EDF;&#xFF0C;&#x5BF9;&#x6307;&#x5B9A;&#x7684;&#x901A;&#x8BAF;&#x6A21;&#x5F0F;&#x654F;&#x611F;&#x7684;&#x670D;&#x52A1;&#x7684;&#x68C0;&#x67E5;&#x5DE5;&#x5177;&#xFF0C;&#x4EE5;&#x53CA;&#x4E00;&#x79CD;&#x5BF9;RPC&#x538B;&#x7F29;&#x7B56;&#x7565;&#x7684;&#x5206;&#x6790;&#x5668;&#xFF0C;&#x7B49;&#x7B49;&#x3002;&#x6211;&#x4EEC;&#x8BA4;&#x4E3A;&#x8FD9;&#x4E9B;&#x610F;&#x60F3;&#x4E0D;&#x5230;&#x7684;&#x7528;&#x4F8B;&#x4E00;&#x5B9A;&#x7A0B;&#x5EA6;&#x4E0A;&#x662F;&#x7531;&#x4E8E;&#x6211;&#x4EEC;&#x5411;&#x5F00;&#x53D1;&#x8005;&#x4EE5;&#x4E00;&#x79CD;&#x7B80;&#x5355;&#x7684;&#x7F16;&#x7A0B;&#x63A5;&#x53E3;&#x7684;&#x65B9;&#x5F0F;&#x5F00;&#x653E;&#x4E86;&#x8DDF;&#x8E2A;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x7684;&#x7F18;&#x6545;&#xFF0C;&#x8FD9;&#x4F7F;&#x5F97;&#x6211;&#x4EEC;&#x80FD;&#x591F;&#x5145;&#x5206;&#x5229;&#x7528;&#x8FD9;&#x4E2A;&#x5927;&#x7684;&#x591A;&#x7684;&#x793E;&#x533A;&#x7684;&#x521B;&#x9020;&#x529B;&#x3002;&#x9664;&#x6B64;&#x4E4B;&#x5916;&#xFF0C;Dapper&#x5BF9;&#x65E7;&#x7684;&#x8D1F;&#x8F7D;&#x7684;&#x652F;&#x6301;&#x4E5F;&#x6BD4;&#x9884;&#x671F;&#x7684;&#x8981;&#x7B80;&#x5355;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x5728;&#x7A0B;&#x5E8F;&#x4E2D;&#x5F15;&#x5165;&#x4E00;&#x4E2A;&#x7528;&#x65B0;&#x7248;&#x672C;&#x7684;&#x91CD;&#x65B0;&#x7F16;&#x8BD1;&#x8FC7;&#x7684;&#x516C;&#x5171;&#x7EC4;&#x4EF6;&#x5E93;(&#x5305;&#x542B;&#x5E38;&#x89C4;&#x7684;&#x7EBF;&#x7A0B;&#x4F7F;&#x7528;&#xFF0C;&#x63A7;&#x5236;&#x6D41;&#x548C;RPC&#x6846;&#x67B6;)&#x5373;&#x53EF;&#x3002;</p>
<p>Dapper&#x5728;Google&#x5185;&#x90E8;&#x7684;&#x5E7F;&#x6CDB;&#x4F7F;&#x7528;&#x8FD8;&#x4E3A;&#x6211;&#x4EEC;&#x5728;Dapper&#x7684;&#x5C40;&#x9650;&#x6027;&#x4E0A;&#x63D0;&#x4F9B;&#x4E86;&#x5B9D;&#x8D35;&#x7684;&#x53CD;&#x9988;&#x610F;&#x89C1;&#x3002;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x5C06;&#x4ECB;&#x7ECD;&#x4E00;&#x4E9B;&#x6211;&#x4EEC;&#x5DF2;&#x77E5;&#x7684;&#x6700;&#x91CD;&#x8981;&#x7684;Dapper&#x7684;&#x4E0D;&#x8DB3;&#xFF1A;</p>
<ul>
<li>&#x5408;&#x5E76;&#x7684;&#x5F71;&#x54CD;&#xFF1A;&#x6211;&#x4EEC;&#x7684;&#x6A21;&#x578B;&#x9690;&#x542B;&#x7684;&#x524D;&#x63D0;&#x662F;&#x4E0D;&#x540C;&#x7684;&#x5B50;&#x7CFB;&#x7EDF;&#x5728;&#x5904;&#x7406;&#x7684;&#x90FD;&#x662F;&#x6765;&#x81EA;&#x540C;&#x4E00;&#x4E2A;&#x88AB;&#x8DDF;&#x8E2A;&#x7684;&#x8BF7;&#x6C42;&#x3002;&#x5728;&#x67D0;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x7F13;&#x51B2;&#x4E00;&#x90E8;&#x5206;&#x8BF7;&#x6C42;&#xFF0C;&#x7136;&#x540E;&#x4E00;&#x6B21;&#x6027;&#x64CD;&#x4F5C;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x96C6;&#x4F1A;&#x66F4;&#x52A0;&#x6709;&#x6548;&#x3002;&#xFF08;&#x6BD4;&#x5982;&#xFF0C;&#x78C1;&#x76D8;&#x4E0A;&#x7684;&#x4E00;&#x6B21;&#x5408;&#x5E76;&#x5199;&#x5165;&#x64CD;&#x4F5C;&#xFF09;&#x3002;&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4E00;&#x4E2A;&#x88AB;&#x8DDF;&#x8E2A;&#x7684;&#x8BF7;&#x6C42;&#x53EF;&#x4EE5;&#x770B;&#x4F3C;&#x662F;&#x4E00;&#x4E2A;&#x5927;&#x578B;&#x5DE5;&#x4F5C;&#x5355;&#x5143;&#x3002;&#x6B64;&#x5916;&#xFF0C;&#x5F53;&#x6709;&#x591A;&#x4E2A;&#x8FFD;&#x8E2A;&#x8BF7;&#x6C42;&#x88AB;&#x6536;&#x96C6;&#x5728;&#x4E00;&#x8D77;&#xFF0C;&#x4ED6;&#x4EEC;&#x5F53;&#x4E2D;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x4F1A;&#x7528;&#x6765;&#x751F;&#x6210;&#x90A3;&#x4E2A;&#x552F;&#x4E00;&#x7684;&#x8DDF;&#x8E2A;ID&#xFF0C;&#x7528;&#x6765;&#x7ED9;&#x5176;&#x4ED6;span&#x4F7F;&#x7528;&#xFF0C;&#x6240;&#x4EE5;&#x5C31;&#x65E0;&#x6CD5;&#x8DDF;&#x8E2A;&#x4E0B;&#x53BB;&#x4E86;&#x3002;&#x6211;&#x4EEC;&#x6B63;&#x5728;&#x8003;&#x8651;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;&#x5E0C;&#x671B;&#x5728;&#x53EF;&#x4EE5;&#x8BC6;&#x522B;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x7684;&#x524D;&#x63D0;&#x4E0B;&#xFF0C;&#x7528;&#x5C3D;&#x53EF;&#x80FD;&#x5C11;&#x7684;&#x8BB0;&#x5F55;&#x6765;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;</li>
<li>&#x8DDF;&#x8E2A;&#x6279;&#x5904;&#x7406;&#x8D1F;&#x8F7D;&#xFF1A;Dapper&#x7684;&#x8BBE;&#x8BA1;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x9488;&#x5BF9;&#x5728;&#x7EBF;&#x670D;&#x52A1;&#x7CFB;&#x7EDF;&#xFF0C;&#x6700;&#x521D;&#x7684;&#x76EE;&#x6807;&#x662F;&#x4E86;&#x89E3;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x8BF7;&#x6C42;&#x4EA7;&#x751F;&#x7684;&#x7CFB;&#x7EDF;&#x884C;&#x4E3A;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x79BB;&#x7EBF;&#x7684;&#x5BC6;&#x96C6;&#x578B;&#x8D1F;&#x8F7D;&#xFF0C;&#x4F8B;&#x5982;&#x7B26;&#x5408;MapReduce[10]&#x6A21;&#x578B;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x53D7;&#x76CA;&#x4E8E;&#x6027;&#x80FD;&#x6316;&#x6F5C;&#x3002;&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x628A;&#x8DDF;&#x8E2A;ID&#x4E0E;&#x4E00;&#x4E9B;&#x5176;&#x4ED6;&#x7684;&#x6709;&#x610F;&#x4E49;&#x7684;&#x5DE5;&#x4F5C;&#x5355;&#x5143;&#x505A;&#x5173;&#x8054;&#xFF0C;&#x8BF8;&#x5982;&#x8F93;&#x5165;&#x6570;&#x636E;&#x4E2D;&#x7684;&#x952E;&#x503C;&#xFF08;&#x6216;&#x952E;&#x503C;&#x7684;&#x8303;&#x56F4;&#xFF09;&#xFF0C;&#x6216;&#x662F;&#x4E00;&#x4E2A;MapReduce shard&#x3002;</li>
<li>&#x5BFB;&#x627E;&#x6839;&#x6E90;&#xFF1A;Dapper&#x53EF;&#x4EE5;&#x6709;&#x6548;&#x5730;&#x786E;&#x5B9A;&#x7CFB;&#x7EDF;&#x4E2D;&#x7684;&#x54EA;&#x4E00;&#x90E8;&#x5206;&#x81F4;&#x4F7F;&#x7CFB;&#x7EDF;&#x6574;&#x4E2A;&#x901F;&#x5EA6;&#x53D8;&#x6162;&#xFF0C;&#x4F46;&#x5E76;&#x4E0D;&#x603B;&#x662F;&#x80FD;&#x591F;&#x627E;&#x51FA;&#x95EE;&#x9898;&#x7684;&#x6839;&#x6E90;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x5F88;&#x6162;&#x6709;&#x53EF;&#x80FD;&#x4E0D;&#x662F;&#x56E0;&#x4E3A;&#x5B83;&#x81EA;&#x5DF1;&#x7684;&#x884C;&#x4E3A;&#xFF0C;&#x800C;&#x662F;&#x7531;&#x4E8E;&#x961F;&#x5217;&#x4E2D;&#x5176;&#x4ED6;&#x6392;&#x5728;&#x5B83;&#x524D;&#x9762;&#x7684;(queued ahead of)&#x8BF7;&#x6C42;&#x8FD8;&#x6CA1;&#x5904;&#x7406;&#x5B8C;&#x3002;&#x7A0B;&#x5E8F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5E94;&#x7528;&#x7EA7;&#x7684;annotation&#x628A;&#x961F;&#x5217;&#x7684;&#x5927;&#x5C0F;&#x6216;&#x8FC7;&#x8F7D;&#x60C5;&#x51B5;&#x5199;&#x5165;&#x8DDF;&#x8E2A;&#x7CFB;&#x7EDF;&#x3002;&#x6B64;&#x5916;&#xFF0C;&#x5982;&#x679C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x5C61;&#x89C1;&#x4E0D;&#x9C9C;&#xFF0C;&#x90A3;&#x4E48;&#x5728;ProfileMe[11]&#x4E2D;&#x63D0;&#x5230;&#x7684;&#x6210;&#x5BF9;&#x7684;&#x91C7;&#x6837;&#x6280;&#x672F;&#x53EF;&#x4EE5;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;&#x5B83;&#x7531;&#x4E24;&#x4E2A;&#x65F6;&#x95F4;&#x91CD;&#x53E0;&#x7684;&#x91C7;&#x6837;&#x7387;&#x7EC4;&#x6210;&#xFF0C;&#x5E76;&#x89C2;&#x5BDF;&#x5B83;&#x4EEC;&#x5728;&#x6574;&#x4E2A;&#x7CFB;&#x7EDF;&#x4E2D;&#x7684;&#x76F8;&#x5BF9;&#x5EF6;&#x8FDF;&#x3002;</li>
<li>&#x8BB0;&#x5F55;&#x5185;&#x6838;&#x7EA7;&#x7684;&#x4FE1;&#x606F;&#xFF1A;&#x4E00;&#x4E9B;&#x5185;&#x6838;&#x53EF;&#x89C1;&#x7684;&#x4E8B;&#x4EF6;&#x7684;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#x6709;&#x65F6;&#x5BF9;&#x786E;&#x5B9A;&#x95EE;&#x9898;&#x6839;&#x6E90;&#x662F;&#x5F88;&#x6709;&#x7528;&#x7684;&#x3002;&#x6211;&#x4EEC;&#x6709;&#x4E00;&#x4E9B;&#x5DE5;&#x5177;&#xFF0C;&#x80FD;&#x591F;&#x8DDF;&#x8E2A;&#x6216;&#x4EE5;&#x5176;&#x4ED6;&#x65B9;&#x5F0F;&#x63CF;&#x8FF0;&#x5185;&#x6838;&#x7684;&#x6267;&#x884C;&#xFF0C;&#x4F46;&#x662F;&#xFF0C;&#x60F3;&#x7528;&#x901A;&#x7528;&#x7684;&#x6216;&#x662F;&#x4E0D;&#x90A3;&#x4E48;&#x7A81;&#x5140;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x662F;&#x5F88;&#x96BE;&#x628A;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#x5230;&#x6346;&#x7ED1;&#x5230;&#x7528;&#x6237;&#x7EA7;&#x522B;&#x7684;&#x8DDF;&#x8E2A;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x3002;&#x6211;&#x4EEC;&#x6B63;&#x5728;&#x7814;&#x7A76;&#x4E00;&#x79CD;&#x59A5;&#x534F;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x7528;&#x6237;&#x5C42;&#x9762;&#x4E0A;&#x628A;&#x4E00;&#x4E9B;&#x5185;&#x6838;&#x7EA7;&#x7684;&#x6D3B;&#x52A8;&#x53C2;&#x6570;&#x505A;&#x5FEB;&#x7167;&#xFF0C;&#x7136;&#x540E;&#x7ED1;&#x5B9A;&#x4ED6;&#x4EEC;&#x5230;&#x4E00;&#x4E2A;&#x6D3B;&#x52A8;&#x7684;span&#x4E0A;&#x3002;</li>
</ul>
<ol start="8">
<li>&#x76F8;&#x5173;&#x4EA7;&#x54C1;</li>
</ol>
<hr>
<p>&#x5728;&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#x8DDF;&#x8E2A;&#x9886;&#x57DF;&#xFF0C;&#x6709;&#x4E00;&#x5957;&#x5B8C;&#x6574;&#x7684;&#x4F53;&#x7CFB;&#xFF0C;&#x4E00;&#x90E8;&#x5206;&#x7CFB;&#x7EDF;&#x4E3B;&#x8981;&#x5173;&#x6CE8;&#x5B9A;&#x4F4D;&#x5230;&#x6545;&#x969C;&#x4F4D;&#x7F6E;&#xFF0C;&#x5176;&#x4ED6;&#x7684;&#x76EE;&#x6807;&#x662F;&#x9488;&#x5BF9;&#x6027;&#x80FD;&#x8FDB;&#x884C;&#x4F18;&#x5316;&#x3002; Dapper&#x786E;&#x5B9E;&#x88AB;&#x7528;&#x4E8E;&#x53D1;&#x73B0;&#x7CFB;&#x7EDF;&#x95EE;&#x9898;&#xFF0C;&#x4F46;&#x5B83;&#x66F4;&#x901A;&#x5E38;&#x7528;&#x4E8E;&#x63A2;&#x67E5;&#x6027;&#x80FD;&#x4E0D;&#x8DB3;&#xFF0C;&#x4EE5;&#x53CA;&#x63D0;&#x9AD8;&#x5168;&#x9762;&#x5927;&#x89C4;&#x6A21;&#x7684;&#x5DE5;&#x4F5C;&#x8D1F;&#x8F7D;&#x4E0B;&#x7684;&#x7CFB;&#x7EDF;&#x884C;&#x4E3A;&#x7684;&#x7406;&#x89E3;&#x3002;</p>
<p>&#x4E0E;Dapper&#x76F8;&#x5173;&#x7684;&#x9ED1;&#x76D2;&#x76D1;&#x63A7;&#x7CFB;&#x7EDF;&#xFF0C;&#x6BD4;&#x5982;Project5[1]&#xFF0C;WAP5[15]&#x548C;Sherlock[2]&#xFF0C;&#x53EF;&#x4EE5;&#x8BF4;&#x4E0D;&#x4F9D;&#x8D56;&#x8FD0;&#x884C;&#x5E93;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x9ED1;&#x76D2;&#x76D1;&#x63A7;&#x7CFB;&#x7EDF;&#x80FD;&#x591F;&#x5B9E;&#x73B0;&#x66F4;&#x9AD8;&#x7684;&#x5E94;&#x7528;&#x7EA7;&#x900F;&#x660E;&#x3002;&#x9ED1;&#x76D2;&#x7684;&#x7F3A;&#x70B9;&#x662F;&#x4E00;&#x5B9A;&#x7A0B;&#x5EA6;&#x4E0A;&#x4E0D;&#x591F;&#x7CBE;&#x786E;&#xFF0C;&#x5E76;&#x53EF;&#x80FD;&#x5728;&#x7EDF;&#x8BA1;&#x63A8;&#x65AD;&#x5173;&#x952E;&#x8DEF;&#x5F84;&#x65F6;&#x5E26;&#x6765;&#x66F4;&#x5927;&#x7684;&#x7CFB;&#x7EDF;&#x635F;&#x8017;&#x3002;</p>
<p>&#x5BF9;&#x4E8E;&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#x76D1;&#x63A7;&#x6765;&#x8BF4;&#xFF0C;&#x57FA;&#x4E8E;Annotation&#x7684;&#x4E2D;&#x95F4;&#x4EF6;&#x6216;&#x5E94;&#x7528;&#x81EA;&#x8EAB;&#x662F;&#x4E00;&#x4E2A;&#x53EF;&#x80FD;&#x662F;&#x66F4;&#x53D7;&#x6B22;&#x8FCE;&#x7684;&#x89E3;&#x51B3;&#x529E;&#x6CD5;.&#x62FF;Pip[14]&#x548C;Webmon[16]&#x7CFB;&#x7EDF;&#x4E3E;&#x4F8B;&#xFF0C;&#x4ED6;&#x4EEC;&#x66F4;&#x4F9D;&#x8D56;&#x4E8E;&#x5E94;&#x7528;&#x7EA7;&#x7684;Annotation&#xFF0C;&#x800C;X-Trace[12]&#xFF0C;Pinpoint[9]&#x548C;Magpie[3]&#x5927;&#x591A;&#x96C6;&#x4E2D;&#x5728;&#x5BF9;&#x5E93;&#x548C;&#x4E2D;&#x95F4;&#x4EF6;&#x7684;&#x4FEE;&#x6539;&#x3002;Dapper&#x66F4;&#x63A5;&#x8FD1;&#x540E;&#x8005;&#x3002;&#x50CF;Pinpoint&#xFF0C;X-Trace&#xFF0C;&#x548C;&#x65E9;&#x671F;&#x7248;&#x672C;&#x7684;Magpie&#x4E00;&#x6837;&#xFF0C;Dapper&#x91C7;&#x7528;&#x4E86;&#x5168;&#x5C40;&#x6807;&#x8BC6;&#x7B26;&#x628A;&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#x4E2D;&#x5404;&#x90E8;&#x5206;&#x76F8;&#x5173;&#x7684;&#x4E8B;&#x4EF6;&#x8054;&#x7CFB;&#x5728;&#x4E00;&#x8D77;&#x3002;&#x548C;&#x8FD9;&#x4E9B;&#x7CFB;&#x7EDF;&#x7C7B;&#x4F3C;&#xFF0C;Dapper&#x5C1D;&#x8BD5;&#x907F;&#x514D;&#x4F7F;&#x7528;&#x5E94;&#x7528;&#x7EA7;Annotation&#xFF0C;&#x800C;&#x662F;&#x628A;&#x7684;&#x690D;&#x5165;&#x9690;&#x85CF;&#x5728;&#x901A;&#x7528;&#x7EC4;&#x4EF6;&#x6A21;&#x5757;&#x5185;&#x3002;Magpie&#x653E;&#x5F03;&#x4F7F;&#x7528;&#x5168;&#x5C40;ID&#xFF0C;&#x4ECD;&#x7136;&#x8BD5;&#x56FE;&#x6B63;&#x786E;&#x7684;&#x5B8C;&#x6210;&#x8BF7;&#x6C42;&#x7684;&#x6B63;&#x786E;&#x4F20;&#x64AD;&#xFF0C;&#x4ED6;&#x901A;&#x8FC7;&#x91C7;&#x7528;&#x5E94;&#x7528;&#x7CFB;&#x7EDF;&#x5404;&#x81EA;&#x5199;&#x5165;&#x7684;&#x4E8B;&#x4EF6;&#x7B56;&#x7565;&#xFF0C;&#x6700;&#x7EC8;&#x4E5F;&#x80FD;&#x7CBE;&#x786E;&#x63CF;&#x8FF0;&#x4E0D;&#x540C;&#x4E8B;&#x4EF6;&#x4E4B;&#x95F4;&#x5173;&#x7CFB;&#x3002;&#x4F46;&#x662F;&#x76EE;&#x524D;&#x8FD8;&#x4E0D;&#x6E05;&#x695A;Magpie&#x5728;&#x5B9E;&#x9645;&#x73AF;&#x5883;&#x4E2D;&#x5B9E;&#x73B0;&#x900F;&#x660E;&#x6027;&#x8FD9;&#x4E9B;&#x7B56;&#x7565;&#x5230;&#x5E95;&#x591A;&#x4E48;&#x6709;&#x6548;&#x3002;<br> X-Trace&#x7684;&#x6838;&#x5FC3;Annotation&#x6BD4;Dapper&#x66F4;&#x6709;&#x91CE;&#x5FC3;&#x4E00;&#x4E9B;&#xFF0C;&#x56E0;&#x4E3A;X-Trace&#x7CFB;&#x7EDF;&#x5BF9;&#x4E8E;&#x8DDF;&#x8E2A;&#x7684;&#x6536;&#x96C6;&#xFF0C;&#x4E0D;&#x4EC5;&#x5728;&#x8DDF;&#x8E2A;&#x8282;&#x70B9;&#x5C42;&#x9762;&#x4E0A;&#xFF0C;&#x800C;&#x4E14;&#x5728;&#x8282;&#x70B9;&#x5185;&#x90E8;&#x4E0D;&#x540C;&#x7684;&#x8F6F;&#x4EF6;&#x5C42;&#x4E5F;&#x4F1A;&#x8FDB;&#x884C;&#x8DDF;&#x8E2A;&#x3002;&#x800C;&#x6211;&#x4EEC;&#x5BF9;&#x4E8E;&#x7EC4;&#x4EF6;&#x7684;&#x4F4E;&#x6027;&#x80FD;&#x635F;&#x8017;&#x7684;&#x8981;&#x6C42;&#x8FEB;&#x4F7F;&#x6211;&#x4EEC;&#x4E0D;&#x80FD;&#x91C7;&#x7528;X-Trace&#x8FD9;&#x6837;&#x7684;&#x6A21;&#x578B;&#xFF0C;&#x800C;&#x662F;&#x671D;&#x7740;&#x628A;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x8FDE;&#x63A5;&#x8D77;&#x6765;&#x5B8C;&#x6574;&#x8DDF;&#x8E2A;&#x6240;&#x80FD;&#x505A;&#x5230;&#x7684;&#x6700;&#x5C0F;&#x4EE3;&#x4EF7;&#x800C;&#x52AA;&#x529B;&#x3002;&#x800C;Dapper&#x7684;&#x8DDF;&#x8E2A;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x4ECE;&#x53EF;&#x9009;&#x7684;&#x5E94;&#x7528;&#x7EA7;Annotation&#x4E2D;&#x83B7;&#x76CA;&#x3002;</p>
<ol start="9">
<li>&#x603B;&#x7ED3;</li>
</ol>
<hr>
<p>&#x5728;&#x672C;&#x6587;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4ECB;&#x7ECD;Dapper&#x8FD9;&#x4E2A;Google&#x7684;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E0B;&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#x8DDF;&#x8E2A;&#x5E73;&#x53F0;&#xFF0C;&#x5E76;&#x6C47;&#x62A5;&#x4E86;&#x6211;&#x4EEC;&#x5F00;&#x53D1;&#x548C;&#x4F7F;&#x7528;&#x5B83;&#x7684;&#x76F8;&#x5173;&#x7ECF;&#x9A8C;&#x3002; Dapper&#x51E0;&#x4E4E;&#x5728;&#x90E8;&#x7F72;&#x5728;&#x6240;&#x6709;&#x7684;Google&#x7CFB;&#x7EDF;&#x4E0A;&#xFF0C;&#x5E76;&#x53EF;&#x4EE5;&#x5728;&#x4E0D;&#x9700;&#x8981;&#x5E94;&#x7528;&#x7EA7;&#x4FEE;&#x6539;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x8FDB;&#x884C;&#x8DDF;&#x8E2A;&#xFF0C;&#x800C;&#x4E14;&#x6CA1;&#x6709;&#x660E;&#x663E;&#x7684;&#x6027;&#x80FD;&#x5F71;&#x54CD;&#x3002;Dapper&#x5BF9;&#x4E8E;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x548C;&#x8FD0;&#x7EF4;&#x56E2;&#x961F;&#x5E26;&#x6765;&#x7684;&#x597D;&#x5904;&#xFF0C;&#x53EF;&#x4EE5;&#x4ECE;&#x6211;&#x4EEC;&#x4E3B;&#x8981;&#x7684;&#x8DDF;&#x8E2A;&#x7528;&#x6237;&#x754C;&#x9762;&#x7684;&#x5E7F;&#x6CDB;&#x4F7F;&#x7528;&#x4E0A;&#x770B;&#x51FA;&#x6765;&#xFF0C;&#x53E6;&#x5916;&#x6211;&#x4EEC;&#x8FD8;&#x5217;&#x4E3E;&#x4E86;&#x4E00;&#x4E9B;Dapper&#x7684;&#x4F7F;&#x7528;&#x7528;&#x4F8B;&#x6765;&#x8BF4;&#x660E;Dapper&#x7684;&#x4F5C;&#x7528;&#xFF0C;&#x8FD9;&#x4E9B;&#x7528;&#x4F8B;&#x6709;&#x4E9B;&#x751A;&#x81F3;&#x90FD;&#x6CA1;&#x6709;Dapper&#x5F00;&#x53D1;&#x56E2;&#x961F;&#x53C2;&#x4E0E;&#xFF0C;&#x800C;&#x662F;&#x88AB;&#x5E94;&#x7528;&#x7684;&#x5F00;&#x53D1;&#x8005;&#x5F00;&#x53D1;&#x51FA;&#x6765;&#x7684;&#x3002;</p>
<p>&#x636E;&#x6211;&#x4EEC;&#x6240;&#x77E5;&#xFF0C;&#x8FD9;&#x662F;&#x7B2C;&#x4E00;&#x7BC7;&#x6C47;&#x62A5;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E0B;&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#x8DDF;&#x8E2A;&#x6846;&#x67B6;&#x7684;&#x8BBA;&#x6587;&#x3002;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x4E3B;&#x8981;&#x8D21;&#x732E;&#x6E90;&#x4E8E;&#x8FD9;&#x4E2A;&#x4E8B;&#x5B9E;&#xFF1A;&#x8BBA;&#x6587;&#x4E2D;&#x56DE;&#x987E;&#x7684;&#x8FD9;&#x4E2A;&#x7CFB;&#x7EDF;&#x5DF2;&#x7ECF;&#x8FD0;&#x884C;&#x4E24;&#x5E74;&#x4E4B;&#x4E45;&#x3002;&#x6211;&#x4EEC;&#x53D1;&#x73B0;&#xFF0C;&#x7ED3;&#x5408;&#x5BF9;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x63D0;&#x4F9B;&#x7B80;&#x5355;API&#x548C;&#x5BF9;&#x5E94;&#x7528;&#x7CFB;&#x7EDF;&#x5B8C;&#x5168;&#x900F;&#x660E;&#x6765;&#x589E;&#x5F3A;&#x8DDF;&#x8E2A;&#x7684;&#x8FD9;&#x4E2A;&#x51B3;&#x5B9A;&#xFF0C;&#x662F;&#x975E;&#x5E38;&#x503C;&#x5F97;&#x7684;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x76F8;&#x4FE1;&#xFF0C;Dapper&#x6BD4;&#x4EE5;&#x524D;&#x7684;&#x57FA;&#x4E8E;Annotation&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x8DDF;&#x8E2A;&#x8FBE;&#x5230;&#x66F4;&#x9AD8;&#x7684;&#x5E94;&#x7528;&#x900F;&#x660E;&#x5EA6;&#xFF0C;&#x8FD9;&#x4E00;&#x70B9;&#x5DF2;&#x7ECF;&#x901A;&#x8FC7;&#x53EA;&#x9700;&#x8981;&#x5C11;&#x91CF;&#x4EBA;&#x5DE5;&#x5E72;&#x9884;&#x7684;&#x5DE5;&#x4F5C;&#x91CF;&#x5F97;&#x4EE5;&#x8BC1;&#x660E;&#x3002;&#x867D;&#x7136;&#x4E00;&#x5B9A;&#x7A0B;&#x5EA6;&#x4E0A;&#x5F97;&#x76CA;&#x4E8E;&#x6211;&#x4EEC;&#x7684;&#x7CFB;&#x7EDF;&#x7684;&#x540C;&#x8D28;&#x6027;&#xFF0C;&#x4F46;&#x5B83;&#x672C;&#x8EAB;&#x4ECD;&#x7136;&#x662F;&#x4E00;&#x4E2A;&#x91CD;&#x5927;&#x7684;&#x6311;&#x6218;&#x3002;&#x6700;&#x91CD;&#x8981;&#x7684;&#x662F;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x8BBE;&#x8BA1;&#x63D0;&#x51FA;&#x4E86;&#x4E00;&#x4E9B;&#x5B9E;&#x73B0;&#x5E94;&#x7528;&#x7EA7;&#x900F;&#x660E;&#x6027;&#x7684;&#x5145;&#x5206;&#x6761;&#x4EF6;&#xFF0C;&#x5BF9;&#x6B64;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x80FD;&#x591F;&#x5BF9;&#x66F4;&#x9519;&#x6742;&#x73AF;&#x5883;&#x4E0B;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x7684;&#x5F00;&#x53D1;&#x6709;&#x6240;&#x5E2E;&#x52A9;&#x3002;</p>
<p>&#x6700;&#x540E;&#xFF0C;&#x901A;&#x8FC7;&#x5F00;&#x653E;Dapper&#x8DDF;&#x8E2A;&#x4ED3;&#x5E93;&#x7ED9;&#x5185;&#x90E8;&#x5F00;&#x53D1;&#x8005;&#xFF0C;&#x6211;&#x4EEC;&#x4FC3;&#x4F7F;&#x66F4;&#x591A;&#x7684;&#x57FA;&#x4E8E;&#x8DDF;&#x8E2A;&#x4ED3;&#x5E93;&#x7684;&#x5206;&#x6790;&#x5DE5;&#x5177;&#x7684;&#x4EA7;&#x751F;&#xFF0C;&#x800C;&#x4EC5;&#x4EC5;&#x7531;Dapper&#x56E2;&#x961F;&#x9ED8;&#x9ED8;&#x7684;&#x5728;&#x4FE1;&#x606F;&#x5B64;&#x5C9B;&#x4E2D;&#x57CB;&#x5934;&#x82E6;&#x5E72;&#x7684;&#x7ED3;&#x679C;&#x8FDC;&#x8FBE;&#x4E0D;&#x5230;&#x73B0;&#x5728;&#x8FD9;&#x4E48;&#x5927;&#x7684;&#x89C4;&#x6A21;&#xFF0C;&#x8FD9;&#x4E2A;&#x51B3;&#x5B9A;&#x4FC3;&#x4F7F;&#x4E86;&#x8BBE;&#x8BA1;&#x548C;&#x5B9E;&#x65BD;&#x7684;&#x5C55;&#x5F00;&#x3002;</p>
<h3 id="Acknowledgments"><a href="#Acknowledgments" class="headerlink" title="Acknowledgments"></a>Acknowledgments</h3><p>We thank Mahesh Palekar, Cliff Biffle, Thomas Kotzmann, Kevin Gibbs, Yonatan Zunger, Michael Kleber, and Toby Smith for their experimental data and feedback about Dapper experiences. We also thank Silvius Rus for his assistance with load testing.<br> Most importantly, though, we thank the outstanding team of engineers who have continued to develop and improve Dapper over the years; in order of appearance, Sharon Perl, Dick Sites, Rob von Behren, Tony DeWitt, Don Pazel, Ofer Zajicek, Anthony<br> Zana, Hyang-Ah Kim, Joshua MacDonald, Dan Sturman, Glenn Willen, Alex Kehlenbeck, Brian McBarron, Michael Kleber, Chris Povirk, Bradley White, Toby Smith, Todd Derr, Michael De Rosa, and Athicha Muthitacharoen. They have all done a tremendous<br> amount of work to make Dapper a day-to-day reality at Google.</p>
<h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><p>[1] M. K. Aguilera, J. C. Mogul, J. L. Wiener, P. Reynolds, and A. Muthitacharoen. Performance Debugging for Distributed Systems of Black Boxes. In Proceedings of the 19th ACM Symposium on Operating Systems Principles, December 2003.</p>
<p>[2] P. Bahl, R. Chandra, A. Greenberg, S. Kandula, D. A. Maltz, and M. Zhang. Towards Highly Reliable Enterprise Network Services Via Inference of Multi-level Dependencies. In Proceedings of SIGCOMM, 2007.</p>
<p>[3] P. Barham, R. Isaacs, R. Mortier, and D. Narayanan. Magpie: online modelling and performance-aware systems. In Proceedings of USENIX HotOS IX, 2003.</p>
<p>[4] L. A. Barroso, J. Dean, and U. Holzle. Web Search for a Planet: The Google Cluster Architecture. IEEE Micro, 23(2):22&#x2013;28, March/April 2003.</p>
<p>[5] T. O. G. Blog. Developers, start your engines. <a href="/external_links/ba21ae0943336e35497dcc5c646af6f9.html" target="blank" rel="noopener">http://googleblog.blogspot.com/2008/04/developers-start-your-engines.html,2007</a>.</p>
<p>[6] T. O. G. Blog. Universal search: The best answer is still the best answer. <a href="/external_links/b7f0f1ad7664b9e815a9c85a72080248.html" target="blank" rel="noopener">http://googleblog.blogspot.com/2007/05/universal-search-best-answer-is-still.html</a>, 2007.</p>
<p>[7] M. Burrows. The Chubby lock service for loosely-coupled distributed systems. In Proceedings of the 7th USENIX Symposium on Operating Systems Design and Implementation, pages 335 &#x2013; 350, 2006. </p>
<p>[8] F. Chang, J. Dean, S. Ghemawat, W. C. Hsieh, D. A. Wallach, M. Burrows, T. Chandra, A. Fikes, and R. E. Gruber. Bigtable: A Distributed Storage System for Structured Data. In Proceedings of the 7th USENIX Symposium on Operating Systems Design<br> and Implementation (OSDI&#x2019;06), November 2006.</p>
<p>[9] M. Y. Chen, E. Kiciman, E. Fratkin, A. fox, and E. Brewer. Pinpoint: Problem Determination in Large, Dynamic Internet Services. In Proceedings of ACM International Conference on Dependable Systems and Networks, 2002.</p>
<p>[10] J. Dean and S. Ghemawat. MapReduce: Simplified Data Processing on Large Clusters. In Proceedings of the 6th USENIX Symposium on Operating Systems Design and Implementation (OSDI&#x2019;04), pages 137 &#x2013; 150, December 2004.</p>
<p>[11] J. Dean, J. E. Hicks, C. A. Waldspurger, W. E. Weihl, and G. Chrysos. ProfileMe: Hardware Support for Instruction-Level Profiling on Out-of-Order Processors. In Proceedings of the IEEE/ACM International Symposium on Microarchitecture, 1997.</p>
<p>[12] R. Fonseca, G. Porter, R. H. Katz, S. Shenker, and I. Stoica. X-Trace: A Pervasive Network Tracing Framework. In Proceedings of USENIX NSDI, 2007.</p>
<p>[13] B. Lee and K. Bourrillion. The Guice Project Home Page. <a href="/external_links/34bce97fa830f9983c9672db83ff5190.html" target="blank" rel="noopener">http://code.google.com/p/google-guice/</a>, 2007. </p>
<p>[14] P. Reynolds, C. Killian, J. L. Wiener, J. C. Mogul, M. A. Shah, and A. Vahdat. Pip: Detecting the Unexpected in Distributed Systems. In Proceedings of USENIX NSDI, 2006.</p>
<p>[15] P. Reynolds, J. L. Wiener, J. C. Mogul, M. K. Aguilera, and A. Vahdat. WAP5: Black Box Performance Debugging for Wide-Area Systems. In Proceedings of the 15th International World Wide Web Conference, 2006.</p>
<p>[16] P. K. G. T. Gschwind, K. Eshghi and K. Wurster. WebMon: A Performance Profiler for Web Transactions. In E-Commerce Workshop, 2002.</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/55f743f5dc47cbe6fa7059b21eda8e4f.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903512019566605.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903512019566605.html" itemprop="url">使用 Rust 构建分布式 Key-Value Store</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-20T14:10:44+08:00">
                2017-11-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x4F5C;&#x8005;&#xFF1A;&#x5510;&#x5218;</p>
<h2 id="&#x5F15;&#x5B50;"><a href="#&#x5F15;&#x5B50;" class="headerlink" title="&#x5F15;&#x5B50;"></a>&#x5F15;&#x5B50;</h2><p>&#x6784;&#x5EFA;&#x4E00;&#x4E2A;&#x5206;&#x5E03;&#x5F0F; Key-Value Store &#x5E76;&#x4E0D;&#x662F;&#x4E00;&#x4EF6;&#x5BB9;&#x6613;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x8003;&#x8651;&#x5F88;&#x591A;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x9996;&#x5148;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x7684;&#x7CFB;&#x7EDF;&#x5230;&#x5E95;&#x9700;&#x8981;&#x63D0;&#x4F9B;&#x4EC0;&#x4E48;&#x6837;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x8B6C;&#x5982;&#xFF1A;</p>
<ul>
<li>&#x4E00;&#x81F4;&#x6027;&#xFF1A;&#x6211;&#x4EEC;&#x662F;&#x5426;&#x9700;&#x8981;&#x4FDD;&#x8BC1;&#x6574;&#x4E2A;&#x7CFB;&#x7EDF;&#x7684;&#x7EBF;&#x6027;&#x4E00;&#x81F4;&#x6027;&#xFF0C;&#x8FD8;&#x662F;&#x80FD;&#x5BB9;&#x5FCD;&#x77ED;&#x65F6;&#x95F4;&#x7684;&#x6570;&#x636E;&#x4E0D;&#x4E00;&#x81F4;&#xFF0C;&#x53EA;&#x652F;&#x6301;&#x6700;&#x7EC8;&#x4E00;&#x81F4;&#x6027;&#x3002;</li>
<li>&#x7A33;&#x5B9A;&#x6027;&#xFF1A;&#x6211;&#x4EEC;&#x80FD;&#x5426;&#x4FDD;&#x8BC1;&#x7CFB;&#x7EDF; 7 x 24 &#x5C0F;&#x65F6;&#x7A33;&#x5B9A;&#x8FD0;&#x884C;&#x3002;&#x7CFB;&#x7EDF;&#x7684;&#x53EF;&#x7528;&#x6027;&#x662F; 4 &#x4E2A; 9&#xFF0C;&#x8FD8;&#x6709; 5 &#x4E2A; 9&#xFF1F;&#x5982;&#x679C;&#x51FA;&#x73B0;&#x4E86;&#x673A;&#x5668;&#x635F;&#x574F;&#x7B49;&#x707E;&#x96BE;&#x60C5;&#x51B5;&#xFF0C;&#x7CFB;&#x7EDF;&#x80FD;&#x5426;&#x505A;&#x7684;&#x81EA;&#x52A8;&#x6062;&#x590D;&#x3002;</li>
<li>&#x6269;&#x5C55;&#x6027;&#xFF1A;&#x5F53;&#x6570;&#x636E;&#x6301;&#x7EED;&#x589E;&#x591A;&#xFF0C;&#x80FD;&#x5426;&#x901A;&#x8FC7;&#x6DFB;&#x52A0;&#x673A;&#x5668;&#x5C31;&#x81EA;&#x52A8;&#x505A;&#x5230;&#x6570;&#x636E;&#x518D;&#x6B21;&#x5E73;&#x8861;&#xFF0C;&#x5E76;&#x4E14;&#x4E0D;&#x5F71;&#x54CD;&#x5916;&#x90E8;&#x670D;&#x52A1;&#x3002;</li>
<li>&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;&#xFF1A;&#x662F;&#x5426;&#x9700;&#x8981;&#x63D0;&#x4F9B;&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;&#x652F;&#x6301;&#xFF0C;&#x4E8B;&#x52A1;&#x9694;&#x79BB;&#x7B49;&#x7EA7;&#x9700;&#x8981;&#x652F;&#x6301;&#x5230;&#x4EC0;&#x4E48;&#x7A0B;&#x5EA6;&#x3002;</li>
</ul>
<p>&#x4E0A;&#x9762;&#x7684;&#x95EE;&#x9898;&#x5728;&#x7CFB;&#x7EDF;&#x8BBE;&#x8BA1;&#x4E4B;&#x521D;&#xFF0C;&#x5C31;&#x9700;&#x8981;&#x8003;&#x8651;&#x597D;&#xFF0C;&#x4F5C;&#x4E3A;&#x6574;&#x4E2A;&#x7CFB;&#x7EDF;&#x7684;&#x8BBE;&#x8BA1;&#x76EE;&#x6807;&#x3002;&#x4E3A;&#x4E86;&#x5B9E;&#x73B0;&#x8FD9;&#x4E9B;&#x7279;&#x6027;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x9700;&#x8981;&#x8003;&#x8651;&#x5230;&#x5E95;&#x91C7;&#x7528;&#x54EA;&#x4E00;&#x79CD;&#x5B9E;&#x73B0;&#x65B9;&#x6848;&#xFF0C;&#x53D6;&#x820D;&#x5404;&#x4E2A;&#x65B9;&#x9762;&#x7684;&#x5229;&#x5F0A;&#x7B49;&#x3002;</p>
<p>&#x540E;&#x9762;&#xFF0C;&#x6211;&#x5C06;&#x4EE5;&#x6211;&#x4EEC;&#x5F00;&#x53D1;&#x7684;&#x5206;&#x5E03;&#x5F0F; Key-Value <a href="/external_links/269014efbd7f1c2bbc2dc771f0bfc3d4.html" target="blank" rel="noopener">TiKV</a> &#x4F5C;&#x4E3A;&#x5B9E;&#x9645;&#x4F8B;&#x5B50;&#xFF0C;&#x6765;&#x8BF4;&#x660E;&#x4E0B;&#x6211;&#x4EEC;&#x662F;&#x5982;&#x4F55;&#x53D6;&#x820D;&#x5E76;&#x5B9E;&#x73B0;&#x7684;&#x3002;</p>
<h2 id="TiKV"><a href="#TiKV" class="headerlink" title="TiKV"></a>TiKV</h2><p>TiKV &#x662F;&#x4E00;&#x4E2A;&#x5206;&#x5E03;&#x5F0F; Key-Value store&#xFF0C;&#x5B83;&#x4F7F;&#x7528; Rust &#x5F00;&#x53D1;&#xFF0C;&#x91C7;&#x7528; Raft &#x4E00;&#x81F4;&#x6027;&#x534F;&#x8BAE;&#x4FDD;&#x8BC1;&#x6570;&#x636E;&#x7684;&#x5F3A;&#x4E00;&#x81F4;&#x6027;&#xFF0C;&#x4EE5;&#x53CA;&#x7A33;&#x5B9A;&#x6027;&#xFF0C;&#x540C;&#x65F6;&#x901A;&#x8FC7; Raft &#x7684; Configuration Change &#x673A;&#x5236;&#x5B9E;&#x73B0;&#x4E86;&#x7CFB;&#x7EDF;&#x7684;&#x53EF;&#x6269;&#x5C55;&#x6027;&#x3002;</p>
<p>TiKV &#x63D0;&#x4F9B;&#x4E86;&#x57FA;&#x672C;&#x7684; KV API &#x652F;&#x6301;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x901A;&#x5E38;&#x7684; Get&#xFF0C;Set&#xFF0C;Delete&#xFF0C;Scan &#x8FD9;&#x6837;&#x7684; API&#x3002;TiKV &#x4E5F;&#x63D0;&#x4F9B;&#x4E86;&#x652F;&#x6301; ACID &#x4E8B;&#x52A1;&#x7684; Transaction API&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; Begin &#x5F00;&#x542F;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#xFF0C;&#x5728;&#x4E8B;&#x52A1;&#x91CC;&#x9762;&#x5BF9; Key &#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#xFF0C;&#x6700;&#x540E;&#x518D;&#x7528; Commit &#x63D0;&#x4EA4;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#xFF0C;TiKV &#x652F;&#x6301; SI &#x4EE5;&#x53CA; SSI &#x4E8B;&#x52A1;&#x9694;&#x79BB;&#x7EA7;&#x522B;&#xFF0C;&#x7528;&#x6765;&#x6EE1;&#x8DB3;&#x7528;&#x6237;&#x7684;&#x4E0D;&#x540C;&#x4E1A;&#x52A1;&#x573A;&#x666F;&#x3002;</p>
<h2 id="Rust"><a href="#Rust" class="headerlink" title="Rust"></a>Rust</h2><p>&#x5728;&#x89C4;&#x5212;&#x597D; TiKV &#x7684;&#x7279;&#x6027;&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x8981;&#x5F00;&#x59CB;&#x8FDB;&#x884C; TiKV &#x7684;&#x5F00;&#x53D1;&#x3002;&#x8FD9;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x9762;&#x4E34;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#x5C31;&#x662F;&#x91C7;&#x7528;&#x4EC0;&#x4E48;&#x6837;&#x7684;&#x8BED;&#x8A00;&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#x3002;&#x5F53;&#x65F6;&#xFF0C;&#x6446;&#x5728;&#x6211;&#x4EEC;&#x773C;&#x524D;&#x7684;&#x6709;&#x51E0;&#x4E2A;&#x9009;&#x62E9;&#xFF1A;</p>
<ul>
<li>Go&#xFF0C;Go &#x662F;&#x6211;&#x4EEC;&#x56E2;&#x961F;&#x6700;&#x64C5;&#x957F;&#x7684;&#x4E00;&#x95E8;&#x8BED;&#x8A00;&#xFF0C;&#x800C;&#x4E14; Go &#x63D0;&#x4F9B;&#x7684; goroutine&#xFF0C;channel &#x8FD9;&#x4E9B;&#x673A;&#x5236;&#xFF0C;&#x5929;&#x751F;&#x7684;&#x9002;&#x5408;&#x5927;&#x89C4;&#x6A21;&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#x7684;&#x5F00;&#x53D1;&#xFF0C;&#x4F46;&#x7075;&#x6D3B;&#x65B9;&#x4FBF;&#x7684;&#x540C;&#x65F6;&#x4E5F;&#x6709;&#x4E00;&#x4E9B;&#x751C;&#x871C;&#x7684;&#x8D1F;&#x62C5;&#xFF0C;&#x9996;&#x5148;&#x5C31;&#x662F; GC&#xFF0C;&#x867D;&#x7136;&#x73B0;&#x5728; Go &#x7684; GC &#x8D8A;&#x6765;&#x8D8A;&#x5B8C;&#x5584;&#xFF0C;&#x4F46;&#x603B;&#x5F52;&#x4F1A;&#x6709;&#x77ED;&#x6682;&#x7684;&#x5361;&#x987F;&#xFF0C;&#x53E6;&#x5916; goroutine &#x7684;&#x8C03;&#x5EA6;&#x4E5F;&#x4F1A;&#x6709;&#x5207;&#x6362;&#x5F00;&#x9500;&#xFF0C;&#x8FD9;&#x4E9B;&#x90FD;&#x53EF;&#x80FD;&#x4F1A;&#x9020;&#x6210;&#x8BF7;&#x6C42;&#x7684;&#x5EF6;&#x8FDF;&#x589E;&#x9AD8;&#x3002;</li>
<li>Java&#xFF0C;&#x73B0;&#x5728;&#x4E16;&#x9762;&#x4E0A;&#x9762;&#x6709;&#x592A;&#x591A;&#x57FA;&#x4E8E; Java &#x505A;&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#x4E86;&#xFF0C;&#x4F46; Java &#x4E00;&#x6837;&#x6709; GC &#x7B49;&#x5F00;&#x9500;&#x95EE;&#x9898;&#xFF0C;&#x540C;&#x65F6;&#x6211;&#x4EEC;&#x56E2;&#x961F;&#x5728; Java &#x4E0A;&#x9762;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x5F00;&#x53D1;&#x7ECF;&#x9A8C;&#xFF0C;&#x6240;&#x4EE5;&#x6CA1;&#x6709;&#x91C7;&#x7528;&#x3002;</li>
<li>C++&#xFF0C;C++ &#x53EF;&#x4EE5;&#x8BA4;&#x4E3A;&#x662F;&#x5F00;&#x53D1;&#x9AD8;&#x6027;&#x80FD;&#x7CFB;&#x7EDF;&#x7684;&#x4EE3;&#x540D;&#x8BCD;&#xFF0C;&#x4F46;&#x6211;&#x4EEC;&#x56E2;&#x961F;&#x6CA1;&#x6709;&#x7279;&#x522B;&#x591A;&#x7684;&#x540C;&#x5B66;&#x80FD;&#x719F;&#x7EC3;&#x638C;&#x63E1; C++&#xFF0C;&#x6240;&#x4EE5;&#x5F00;&#x53D1;&#x5927;&#x578B; C++ &#x9879;&#x76EE;&#x5E76;&#x4E0D;&#x662F;&#x4E00;&#x4EF6;&#x975E;&#x5E38;&#x5BB9;&#x6613;&#x7684;&#x4E8B;&#x60C5;&#x3002;&#x867D;&#x7136;&#x4F7F;&#x7528;&#x73B0;&#x4EE3; C++ &#x7684;&#x7F16;&#x7A0B;&#x65B9;&#x5F0F;&#x80FD;&#x5927;&#x91CF;&#x51CF;&#x5C11; data race&#xFF0C;dangling pointer &#x7B49;&#x98CE;&#x9669;&#xFF0C;&#x6211;&#x4EEC;&#x4ECD;&#x7136;&#x53EF;&#x80FD;&#x72AF;&#x9519;&#x3002;</li>
</ul>
<p>&#x5F53;&#x6211;&#x4EEC;&#x6392;&#x9664;&#x4E86;&#x4E0A;&#x9762;&#x51E0;&#x79CD;&#x4E3B;&#x6D41;&#x8BED;&#x8A00;&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x53D1;&#x73B0;&#xFF0C;&#x4E3A;&#x4E86;&#x5F00;&#x53D1; TiKV&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x8FD9;&#x95E8;&#x8BED;&#x8A00;&#x5177;&#x6709;&#x5982;&#x4E0B;&#x7279;&#x6027;&#xFF1A;</p>
<ul>
<li>&#x9759;&#x6001;&#x8BED;&#x8A00;&#xFF0C;&#x8FD9;&#x6837;&#x624D;&#x80FD;&#x6700;&#x5927;&#x9650;&#x5EA6;&#x7684;&#x4FDD;&#x8BC1;&#x8FD0;&#x884C;&#x6027;&#x80FD;&#x3002;</li>
<li>&#x65E0; GC&#xFF0C;&#x5B8C;&#x5168;&#x624B;&#x52A8;&#x63A7;&#x5236;&#x5185;&#x5B58;&#x3002;</li>
<li>Memory safe&#xFF0C;&#x5C3D;&#x91CF;&#x907F;&#x514D; dangling pointer&#xFF0C;memory leak &#x7B49;&#x95EE;&#x9898;&#x3002;</li>
<li>Thread safe&#xFF0C;&#x4E0D;&#x4F1A;&#x9047;&#x5230; data race &#x7B49;&#x95EE;&#x9898;&#x3002;</li>
<li>&#x5305;&#x7BA1;&#x7406;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x975E;&#x5E38;&#x65B9;&#x4FBF;&#x7684;&#x4F7F;&#x7528;&#x7B2C;&#x4E09;&#x65B9;&#x5E93;&#x3002;</li>
<li>&#x9AD8;&#x6548;&#x7684; C &#x7ED1;&#x5B9A;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x80FD;&#x4F7F;&#x7528;&#x4E00;&#x4E9B; C library&#xFF0C;&#x6240;&#x4EE5;&#x8DDF; C &#x4EA4;&#x4E92;&#x4E0D;&#x80FD;&#x6709;&#x5F00;&#x9500;&#x3002;</li>
</ul>
<p>&#x7EFC;&#x4E0A;&#xFF0C;&#x6211;&#x4EEC;&#x51B3;&#x5B9A;&#x4F7F;&#x7528; <a href="/external_links/ab4d832338de94155cfa92d029d7d339.html" target="blank" rel="noopener">Rust</a>&#xFF0C;Rust &#x662F;&#x4E00;&#x95E8;&#x7CFB;&#x7EDF;&#x7F16;&#x7A0B;&#x8BED;&#x8A00;&#xFF0C;&#x5B83;&#x63D0;&#x4F9B;&#x4E86;&#x6211;&#x4EEC;&#x4E0A;&#x9762;&#x60F3;&#x8981;&#x7684;&#x8BED;&#x8A00;&#x7279;&#x6027;&#xFF0C;&#x4F46;&#x9009;&#x62E9; Rust &#x5BF9;&#x6211;&#x4EEC;&#x6765;&#x8BF4;&#x4E5F;&#x662F;&#x5F88;&#x6709;&#x98CE;&#x9669;&#x7684;&#xFF0C;&#x4E3B;&#x8981;&#x6709;&#x4E24;&#x70B9;&#xFF1A;</p>
<ol>
<li>&#x6211;&#x4EEC;&#x56E2;&#x961F;&#x6CA1;&#x6709;&#x4EFB;&#x4F55; Rust &#x5F00;&#x53D1;&#x7ECF;&#x9A8C;&#xFF0C;&#x5168;&#x90E8;&#x90FD;&#x9700;&#x8981;&#x82B1;&#x65F6;&#x95F4;&#x5B66;&#x4E60; Rust&#xFF0C;&#x800C;&#x504F;&#x504F; Rust &#x6709;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x9661;&#x5CED;&#x7684;&#x5B66;&#x4E60;&#x66F2;&#x7EBF;&#x3002;</li>
<li>&#x57FA;&#x7840;&#x7F51;&#x7EDC;&#x5E93;&#x7684;&#x7F3A;&#x5931;&#xFF0C;&#x867D;&#x7136;&#x90A3;&#x4E2A;&#x65F6;&#x5019; Rust &#x5DF2;&#x7ECF;&#x51FA;&#x4E86; 1.0&#xFF0C;&#x4F46;&#x6211;&#x4EEC;&#x53D1;&#x73B0;&#x5F88;&#x591A;&#x57FA;&#x7840;&#x5E93;&#x90FD;&#x6CA1;&#x6709;&#xFF0C;&#x8B6C;&#x5982;&#x5728;&#x7F51;&#x7EDC;&#x5E93;&#x4E0A;&#x9762;&#x53EA;&#x6709; mio&#xFF0C;&#x6CA1;&#x6709;&#x597D;&#x7528;&#x7684; RPC &#x6846;&#x67B6;&#xFF0C;HTTP &#x4E5F;&#x4E0D;&#x6210;&#x719F;&#x3002;</li>
</ol>
<p>&#x4F46;&#x6211;&#x4EEC;&#x8FD8;&#x662F;&#x51B3;&#x5B9A;&#x4F7F;&#x7528; Rust&#xFF0C;&#x5BF9;&#x4E8E;&#x7B2C;&#x4E00;&#x70B9;&#xFF0C;&#x6211;&#x4EEC;&#x56E2;&#x961F;&#x82B1;&#x4E86;&#x5C06;&#x8FD1;&#x4E00;&#x4E2A;&#x6708;&#x7684;&#x65F6;&#x95F4;&#x6765;&#x5B66;&#x4E60; Rust&#xFF0C;&#x8DDF; Rust &#x7F16;&#x8BD1;&#x5668;&#x4F5C;&#x6597;&#x4E89;&#xFF0C;&#x800C;&#x5BF9;&#x4E8E;&#x7B2C;&#x4E8C;&#x70B9;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x5B8C;&#x5168;&#x5F00;&#x59CB;&#x81EA;&#x5DF1;&#x5199;&#x3002;</p>
<p>&#x5E78;&#x8FD0;&#x7684;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x8D8A;&#x8FC7; Rust &#x90A3;&#x6BB5;&#x9635;&#x75DB;&#x671F;&#x4E4B;&#x540E;&#xFF0C;&#x53D1;&#x73B0;&#x7528; Rust &#x5F00;&#x53D1; TiKV &#x5F02;&#x5E38;&#x7684;&#x9AD8;&#x6548;&#xFF0C;&#x8FD9;&#x4E5F;&#x5C31;&#x662F;&#x4E3A;&#x5565;&#x6211;&#x4EEC;&#x80FD;&#x5728;&#x77ED;&#x65F6;&#x95F4;&#x5F00;&#x53D1;&#x51FA; TiKV &#x5E76;&#x5728;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E2D;&#x4E0A;&#x7EBF;&#x7684;&#x539F;&#x56E0;&#x3002;</p>
<h2 id="&#x4E00;&#x81F4;&#x6027;&#x534F;&#x8BAE;"><a href="#&#x4E00;&#x81F4;&#x6027;&#x534F;&#x8BAE;" class="headerlink" title="&#x4E00;&#x81F4;&#x6027;&#x534F;&#x8BAE;"></a>&#x4E00;&#x81F4;&#x6027;&#x534F;&#x8BAE;</h2><p>&#x5BF9;&#x4E8E;&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#x6765;&#x8BF4;&#xFF0C;CAP &#x662F;&#x4E00;&#x4E2A;&#x4E0D;&#x5F97;&#x4E0D;&#x8003;&#x8651;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x56E0;&#x4E3A; P &#x4E5F;&#x5C31;&#x662F; Partition Tolerance &#x662F;&#x4E00;&#x5B9A;&#x5B58;&#x5728;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5C31;&#x8981;&#x8003;&#x8651;&#x5230;&#x5E95;&#x662F;&#x9009;&#x62E9; C - Consistency &#x8FD8;&#x662F; A - Availability&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x5728;&#x8BBE;&#x8BA1; TiKV &#x7684;&#x65F6;&#x5019;&#x5C31;&#x51B3;&#x5B9A; - &#x5B8C;&#x5168;&#x4FDD;&#x8BC1;&#x6570;&#x636E;&#x5B89;&#x5168;&#x6027;&#xFF0C;&#x6240;&#x4EE5;&#x81EA;&#x7136;&#x5C31;&#x4F1A;&#x9009;&#x62E9; C&#xFF0C;&#x4F46;&#x5176;&#x5B9E;&#x6211;&#x4EEC;&#x5E76;&#x6CA1;&#x6709;&#x5B8C;&#x5168;&#x653E;&#x5F03; A&#xFF0C;&#x56E0;&#x4E3A;&#x591A;&#x6570;&#x65F6;&#x5019;&#xFF0C;&#x6BD5;&#x7ADF;&#x65AD;&#x7F51;&#xFF0C;&#x673A;&#x5668;&#x505C;&#x7535;&#x4E0D;&#x4F1A;&#x7279;&#x522B;&#x9891;&#x7E41;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x4FDD;&#x8BC1; HA - High Availability&#xFF0C;&#x4E5F;&#x5C31;&#x662F; 4 &#x4E2A; 9 &#x6216;&#x8005; 5 &#x4E2A; 9 &#x7684;&#x53EF;&#x7528;&#x6027;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;</p>
<p>&#x65E2;&#x7136;&#x9009;&#x62E9;&#x4E86; C&#xFF0C;&#x6211;&#x4EEC;&#x4E0B;&#x4E00;&#x4E2A;&#x5C31;&#x8003;&#x8651;&#x7684;&#x662F;&#x9009;&#x7528;&#x54EA;&#x4E00;&#x79CD;&#x5206;&#x5E03;&#x5F0F;&#x4E00;&#x81F4;&#x6027;&#x7B97;&#x6CD5;&#xFF0C;&#x73B0;&#x5728;&#x6D41;&#x884C;&#x7684;&#x65E0;&#x975E;&#x5C31;&#x662F; Paxos &#x6216;&#x8005; Raft&#xFF0C;&#x800C; Raft &#x56E0;&#x4E3A;&#x7B80;&#x5355;&#xFF0C;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#xFF0C;&#x4EE5;&#x53CA;&#x6709;&#x5F88;&#x591A;&#x73B0;&#x6210;&#x7684;&#x5F00;&#x6E90;&#x5E93;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#xFF0C;&#x81EA;&#x7136;&#x5C31;&#x6210;&#x4E86;&#x6211;&#x4EEC;&#x7684;&#x9996;&#x8981;&#x9009;&#x62E9;&#x3002;</p>
<p>&#x5728; Raft &#x7684;&#x5B9E;&#x73B0;&#x4E0A;&#xFF0C;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x53C2;&#x8003;&#x7684; <a href="/external_links/b7f1dae02dbb9c1867e17206ff368cfb.html" target="blank" rel="noopener">etcd</a> &#x7684; Raft&#x3002;etcd &#x5DF2;&#x7ECF;&#x88AB;&#x5927;&#x91CF;&#x7684;&#x516C;&#x53F8;&#x5728;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E2D;&#x4F7F;&#x7528;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x7684; Raft &#x5E93;&#x8D28;&#x91CF;&#x662F;&#x5F88;&#x6709;&#x4FDD;&#x969C;&#x7684;&#x3002;&#x867D;&#x7136; etcd &#x662F;&#x7528; Go &#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x4F46;&#x5B83;&#x7684; Raft library &#x662F;&#x7C7B;&#x4F3C; C &#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x6240;&#x4EE5;&#x975E;&#x5E38;&#x4FBF;&#x4E8E;&#x6211;&#x4EEC;&#x7528; Rust &#x76F4;&#x63A5;&#x7FFB;&#x8BD1;&#x3002;&#x5728;&#x7FFB;&#x8BD1;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x7ED9; etcd &#x7684; Raft fix &#x4E86;&#x4E00;&#x4E9B; bug&#xFF0C;&#x6DFB;&#x52A0;&#x4E86;&#x4E00;&#x4E9B;&#x529F;&#x80FD;&#xFF0C;&#x8BA9;&#x5176;&#x53D8;&#x5F97;&#x66F4;&#x52A0;&#x5065;&#x58EE;&#x548C;&#x6613;&#x7528;&#x3002;</p>
<p>&#x73B0;&#x5728; Raft &#x7684;&#x4EE3;&#x7801;&#x4ECD;&#x7136;&#x5728; TiKV &#x5DE5;&#x7A0B;&#x91CC;&#x9762;&#xFF0C;&#x4F46;&#x6211;&#x4EEC;&#x5F88;&#x5FEB;&#x4F1A;&#x5C06;&#x72EC;&#x7ACB;&#x51FA;&#x53BB;&#xFF0C;&#x53D8;&#x6210;&#x72EC;&#x7ACB;&#x7684; library&#xFF0C;&#x8FD9;&#x6837;&#x5927;&#x5BB6;&#x5C31;&#x80FD;&#x5728;&#x81EA;&#x5DF1;&#x7684; Rust &#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528; Raft &#x4E86;&#x3002;</p>
<p>&#x4F7F;&#x7528; Raft &#x4E0D;&#x5149;&#x80FD;&#x4FDD;&#x8BC1;&#x6570;&#x636E;&#x7684;&#x4E00;&#x81F4;&#x6027;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x501F;&#x52A9; Raft &#x7684; Configuration Change &#x673A;&#x5236;&#x5B9E;&#x73B0;&#x7CFB;&#x7EDF;&#x7684;&#x6C34;&#x5E73;&#x6269;&#x5C55;&#xFF0C;&#x8FD9;&#x4E2A;&#x6211;&#x4EEC;&#x4F1A;&#x5728;&#x540E;&#x9762;&#x7684;&#x6587;&#x7AE0;&#x4E2D;&#x8BE6;&#x7EC6;&#x7684;&#x8BF4;&#x660E;&#x3002;</p>
<h2 id="&#x5B58;&#x50A8;&#x5F15;&#x64CE;"><a href="#&#x5B58;&#x50A8;&#x5F15;&#x64CE;" class="headerlink" title="&#x5B58;&#x50A8;&#x5F15;&#x64CE;"></a>&#x5B58;&#x50A8;&#x5F15;&#x64CE;</h2><p>&#x9009;&#x62E9;&#x4E86;&#x5206;&#x5E03;&#x5F0F;&#x4E00;&#x81F4;&#x6027;&#x534F;&#x8BAE;&#xFF0C;&#x4E0B;&#x4E00;&#x4E2A;&#x5C31;&#x8981;&#x8003;&#x8651;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x7684;&#x95EE;&#x9898;&#x4E86;&#x3002;&#x5728; TiKV &#x91CC;&#x9762;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x5B58;&#x50A8; Raft log&#xFF0C;&#x7136;&#x540E;&#x4E5F;&#x4F1A;&#x5C06; Raft log &#x91CC;&#x9762;&#x5B9E;&#x9645;&#x7684;&#x5BA2;&#x6237;&#x8BF7;&#x6C42;&#x5E94;&#x7528;&#x5230;&#x72B6;&#x6001;&#x673A;&#x91CC;&#x9762;&#x3002;</p>
<p>&#x9996;&#x5148;&#x6765;&#x770B;&#x72B6;&#x6001;&#x673A;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4F1A;&#x5B58;&#x653E;&#x7528;&#x6237;&#x7684;&#x5B9E;&#x9645;&#x6570;&#x636E;&#xFF0C;&#x800C;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#x5B8C;&#x5168;&#x53EF;&#x80FD;&#x662F;&#x968F;&#x673A;&#x7684; key - value&#xFF0C;&#x4E3A;&#x4E86;&#x9AD8;&#x6548;&#x7684;&#x5904;&#x7406;&#x968F;&#x673A;&#x7684;&#x6570;&#x636E;&#x63D2;&#x5165;&#xFF0C;&#x81EA;&#x7136;&#x6211;&#x4EEC;&#x5C31;&#x8003;&#x8651;&#x4F7F;&#x7528;&#x73B0;&#x5728;&#x901A;&#x7528;&#x7684; LSM Tree &#x6A21;&#x578B;&#x3002;&#x800C;&#x5728;&#x8FD9;&#x79CD;&#x6A21;&#x578B;&#x4E0B;&#xFF0C;RocksDB &#x53EF;&#x4EE5;&#x8BA4;&#x4E3A;&#x662F;&#x73B0;&#x9636;&#x6BB5;&#x6700;&#x4F18;&#x7684;&#x4E00;&#x4E2A;&#x9009;&#x62E9;&#x3002;</p>
<p>RocksDB &#x662F; Facebook &#x56E2;&#x961F;&#x5728; LevelDB &#x7684;&#x57FA;&#x7840;&#x4E0A;&#x9762;&#x505A;&#x7684;&#x9AD8;&#x6027;&#x80FD; Key-Value Storage&#xFF0C;&#x5B83;&#x63D0;&#x4F9B;&#x4E86;&#x5F88;&#x591A;&#x914D;&#x7F6E;&#x9009;&#x9879;&#xFF0C;&#x80FD;&#x8BA9;&#x5927;&#x5BB6;&#x6839;&#x636E;&#x4E0D;&#x540C;&#x7684;&#x786C;&#x4EF6;&#x73AF;&#x5883;&#x53BB;&#x8C03;&#x4F18;&#x3002;&#x8FD9;&#x91CC;&#x6709;&#x4E00;&#x4E2A;&#x6897;&#xFF0C;&#x8BF4;&#x7684;&#x662F;&#x56E0;&#x4E3A; RocksDB &#x914D;&#x7F6E;&#x592A;&#x591A;&#xFF0C;&#x4EE5;&#x81F3;&#x4E8E;&#x8FDE; RocksDB team &#x7684;&#x540C;&#x5B66;&#x90FD;&#x4E0D;&#x6E05;&#x695A;&#x6240;&#x6709;&#x914D;&#x7F6E;&#x7684;&#x610F;&#x4E49;&#x3002;</p>
<p>&#x5173;&#x4E8E;&#x6211;&#x4EEC;&#x5728; TiKV &#x4E2D;&#x5982;&#x4F55;&#x4F7F;&#x7528;&#xFF0C;&#x4F18;&#x5316; RocksDB&#xFF0C;&#x4EE5;&#x53CA;&#x7ED9; RocksDB &#x6DFB;&#x52A0;&#x529F;&#x80FD;&#xFF0C;fix bug &#x8FD9;&#x4E9B;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x5728;&#x540E;&#x9762;&#x6587;&#x7AE0;&#x4E2D;&#x8BE6;&#x7EC6;&#x8BF4;&#x660E;&#x3002;</p>
<p>&#x800C;&#x5BF9;&#x4E8E; Raft Log&#xFF0C;&#x56E0;&#x4E3A;&#x4EFB;&#x610F; Log &#x7684; index &#x662F;&#x5B8C;&#x5168;&#x5355;&#x8C03;&#x9012;&#x589E;&#x7684;&#xFF0C;&#x8B6C;&#x5982; Log 1&#xFF0C;&#x90A3;&#x4E48;&#x4E0B;&#x4E00;&#x4E2A; Log &#x4E00;&#x5B9A;&#x662F; Log 2&#xFF0C;&#x6240;&#x4EE5; Log &#x7684;&#x63D2;&#x5165;&#x53EF;&#x4EE5;&#x8BA4;&#x4E3A;&#x662F;&#x987A;&#x5E8F;&#x63D2;&#x5165;&#x3002;&#x8FD9;&#x79CD;&#x7684;&#xFF0C;&#x6700;&#x901A;&#x5E38;&#x7684;&#x505A;&#x6CD5;&#x5C31;&#x662F;&#x81EA;&#x5DF1;&#x5199;&#x4E00;&#x4E2A; Segment File&#xFF0C;&#x4F46;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x4ECD;&#x7136;&#x4F7F;&#x7528;&#x7684;&#x662F; RocksDB&#xFF0C;&#x56E0;&#x4E3A; RocksDB &#x5BF9;&#x4E8E;&#x987A;&#x5E8F;&#x5199;&#x5165;&#x4E5F;&#x6709;&#x975E;&#x5E38;&#x9AD8;&#x7684;&#x6027;&#x80FD;&#xFF0C;&#x4E5F;&#x80FD;&#x6EE1;&#x8DB3;&#x6211;&#x4EEC;&#x7684;&#x9700;&#x6C42;&#x3002;&#x4F46;&#x6211;&#x4EEC;&#x4E0D;&#x6392;&#x9664;&#x540E;&#x9762;&#x4F7F;&#x7528;&#x81EA;&#x5DF1;&#x7684;&#x5F15;&#x64CE;&#x3002;</p>
<p>&#x56E0;&#x4E3A; RocksDB &#x63D0;&#x4F9B;&#x4E86; C API&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5728; Rust &#x91CC;&#x9762;&#x4F7F;&#x7528;&#xFF0C;&#x5927;&#x5BB6;&#x4E5F;&#x53EF;&#x4EE5;&#x5728;&#x81EA;&#x5DF1;&#x7684; Rust &#x9879;&#x76EE;&#x91CC;&#x9762;&#x901A;&#x8FC7; <a href="/external_links/dacb29884ecb5056bc6129cad8677a2c.html" target="blank" rel="noopener">rust-rocksdb</a> &#x8FD9;&#x4E2A;&#x5E93;&#x6765;&#x4F7F;&#x7528; RocksDB&#x3002;</p>
<h2 id="&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;"><a href="#&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;" class="headerlink" title="&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;"></a>&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;</h2><p>&#x8981;&#x652F;&#x6301;&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;&#xFF0C;&#x9996;&#x5148;&#x8981;&#x89E3;&#x51B3;&#x7684;&#x5C31;&#x662F;&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#x65F6;&#x95F4;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x7528;&#x4EC0;&#x4E48;&#x6765;&#x6807;&#x8BC6;&#x4E0D;&#x540C;&#x4E8B;&#x52A1;&#x7684;&#x987A;&#x5E8F;&#x3002;&#x901A;&#x5E38;&#x6709;&#x51E0;&#x79CD;&#x505A;&#x6CD5;&#xFF1A;</p>
<ul>
<li>TrueTime&#xFF0C;TrueTime &#x662F; Google Spanner &#x4F7F;&#x7528;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x4E0D;&#x8FC7;&#x5B83;&#x9700;&#x8981;&#x786C;&#x4EF6; GPS + &#x539F;&#x5B50;&#x949F;&#x652F;&#x6301;&#xFF0C;&#x800C;&#x4E14; Spanner &#x5E76;&#x6CA1;&#x6709;&#x5728;&#x8BBA;&#x6587;&#x91CC;&#x9762;&#x8BE6;&#x7EC6;&#x8BF4;&#x660E;&#x786C;&#x4EF6;&#x73AF;&#x5883;&#x662F;&#x5982;&#x4F55;&#x642D;&#x5EFA;&#x7684;&#xFF0C;&#x5916;&#x9762;&#x8981;&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#x96BE;&#x5EA6;&#x6BD4;&#x8F83;&#x5927;&#x3002;</li>
<li>HLC&#xFF0C;HLC &#x662F;&#x4E00;&#x79CD;&#x6DF7;&#x5408;&#x903B;&#x8F91;&#x65F6;&#x949F;&#xFF0C;&#x5B83;&#x4F7F;&#x7528; Physical Time &#x548C; Logical Clock &#x6765;&#x786E;&#x5B9A;&#x4E8B;&#x4EF6;&#x7684;&#x5148;&#x540E;&#x987A;&#x5E8F;&#xFF0C;HLC &#x5DF2;&#x7ECF;&#x5728;&#x4E00;&#x4E9B;&#x5E94;&#x7528;&#x4E2D;&#x4F7F;&#x7528;&#xFF0C;&#x4F46; HLC &#x4F9D;&#x8D56; NTP&#xFF0C;&#x5982;&#x679C; NTP &#x7CBE;&#x5EA6;&#x8BEF;&#x5DEE;&#x6BD4;&#x8F83;&#x5927;&#xFF0C;&#x5F88;&#x53EF;&#x80FD;&#x4F1A;&#x5F71;&#x54CD; commit wait time&#x3002;</li>
<li>TSO&#xFF0C;TSO &#x662F;&#x4E00;&#x4E2A;&#x5168;&#x5C40;&#x6388;&#x65F6;&#x5668;&#xFF0C;&#x5B83;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x5355;&#x70B9;&#x670D;&#x52A1;&#x6765;&#x5206;&#x914D;&#x65F6;&#x95F4;&#x3002;TSO &#x7684;&#x65B9;&#x5F0F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x4F46;&#x4F1A;&#x6709;&#x5355;&#x70B9;&#x6545;&#x969C;&#x95EE;&#x9898;&#xFF0C;&#x5355;&#x70B9;&#x4E5F;&#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x6027;&#x80FD;&#x95EE;&#x9898;&#x3002;</li>
</ul>
<p>TiKV &#x91C7;&#x7528;&#x4E86; TSO &#x7684;&#x65B9;&#x5F0F;&#x8FDB;&#x884C;&#x5168;&#x5C40;&#x6388;&#x65F6;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x4E3A;&#x4E86;&#x7B80;&#x5355;&#x3002;&#x81F3;&#x4E8E;&#x5355;&#x70B9;&#x6545;&#x969C;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x8FC7; Raft &#x505A;&#x5230;&#x4E86;&#x81EA;&#x52A8; fallover &#x5904;&#x7406;&#x3002;&#x800C;&#x5BF9;&#x4E8E;&#x5355;&#x70B9;&#x6027;&#x80FD;&#x95EE;&#x9898;&#xFF0C;TiKV &#x4E3B;&#x8981;&#x9488;&#x5BF9;&#x7684;&#x662F; PB &#x4EE5;&#x53CA; PB &#x4EE5;&#x4E0B;&#x7EA7;&#x522B;&#x7684;&#x4E2D;&#x5C0F;&#x89C4;&#x6A21;&#x96C6;&#x7FA4;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x6027;&#x80FD;&#x4E0A;&#x9762;&#x53EA;&#x8981;&#x80FD;&#x4FDD;&#x8BC1;&#x6BCF;&#x79D2;&#x767E;&#x4E07;&#x7EA7;&#x522B;&#x7684;&#x65F6;&#x95F4;&#x5206;&#x914D;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#xFF0C;&#x800C;&#x7F51;&#x7EDC;&#x5EF6;&#x8FDF;&#x4E0A;&#x9762;&#xFF0C;TiKV &#x5E76;&#x6CA1;&#x6709;&#x5168;&#x7403;&#x8DE8; IDC &#x7684;&#x9700;&#x6C42;&#xFF0C;&#x5728;&#x5355; IDC &#x6216;&#x8005;&#x540C;&#x57CE; IDC &#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x7F51;&#x7EDC;&#x901F;&#x5EA6;&#x90FD;&#x5F88;&#x5FEB;&#xFF0C;&#x5373;&#x4F7F;&#x662F;&#x5F02;&#x5730; IDC&#xFF0C;&#x4E5F;&#x56E0;&#x4E3A;&#x6709;&#x4E13;&#x7EBF;&#x4E0D;&#x4F1A;&#x6709;&#x592A;&#x5927;&#x7684;&#x5EF6;&#x8FDF;&#x3002;</p>
<p>&#x89E3;&#x51B3;&#x4E86;&#x65F6;&#x95F4;&#x95EE;&#x9898;&#xFF0C;&#x4E0B;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x91C7;&#x7528;&#x4F55;&#x79CD;&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;&#x7B97;&#x6CD5;&#xFF0C;&#x6700;&#x901A;&#x5E38;&#x7684;&#x5C31;&#x662F;&#x4F7F;&#x7528; 2 PC&#xFF0C;&#x4F46;&#x901A;&#x5E38;&#x7684; 2 PC &#x7B97;&#x6CD5;&#x5728;&#x4E00;&#x4E9B;&#x6781;&#x7AEF;&#x60C5;&#x51B5;&#x4E0B;&#x9762;&#x4F1A;&#x6709;&#x95EE;&#x9898;&#xFF0C;&#x6240;&#x4EE5;&#x4E1A;&#x754C;&#x8981;&#x4E0D;&#x901A;&#x8FC7; Paxos&#xFF0C;&#x8981;&#x4E0D;&#x5C31;&#x662F;&#x4F7F;&#x7528; 3 PC &#x7B49;&#x7B97;&#x6CD5;&#x3002;&#x5728;&#x8FD9;&#x91CC;&#xFF0C;TiKV &#x53C2;&#x8003; Percolator&#xFF0C;&#x4F7F;&#x7528;&#x4E86;&#x53E6;&#x4E00;&#x79CD;&#x589E;&#x5F3A;&#x7248;&#x7684; 2 PC &#x7B97;&#x6CD5;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x5148;&#x7B80;&#x5355;&#x4ECB;&#x7ECD;&#x4E0B; Percolator &#x7684;&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;&#x7B97;&#x6CD5;&#xFF0C;Percolator &#x4F7F;&#x7528;&#x4E86;&#x4E50;&#x89C2;&#x9501;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x4F1A;&#x5148;&#x7F13;&#x5B58;&#x4E8B;&#x52A1;&#x8981;&#x4FEE;&#x6539;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x7136;&#x540E;&#x5728; Commit &#x63D0;&#x4EA4;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5BF9;&#x8981;&#x66F4;&#x6539;&#x7684;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x52A0;&#x9501;&#x5904;&#x7406;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x66F4;&#x65B0;&#x3002;&#x91C7;&#x7528;&#x4E50;&#x89C2;&#x9501;&#x7684;&#x597D;&#x5904;&#x5728;&#x4E8E;&#x5BF9;&#x4E8E;&#x5F88;&#x591A;&#x573A;&#x666F;&#x80FD;&#x63D0;&#x9AD8;&#x6574;&#x4E2A;&#x7CFB;&#x7EDF;&#x7684;&#x5E76;&#x53D1;&#x5904;&#x7406;&#x80FD;&#x529B;&#xFF0C;&#x4F46;&#x5728;&#x51B2;&#x7A81;&#x4E25;&#x91CD;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x53CD;&#x800C;&#x6CA1;&#x6709;&#x60B2;&#x89C2;&#x9501;&#x9AD8;&#x6548;&#x3002;</p>
<p>&#x5BF9;&#x4E8E;&#x8981;&#x4FEE;&#x6539;&#x7684;&#x4E00;&#x884C;&#x6570;&#x636E;&#xFF0C;Percolator &#x4F1A;&#x6709;&#x4E09;&#x4E2A;&#x5B57;&#x6BB5;&#x4E0E;&#x4E4B;&#x5BF9;&#x5E94;&#xFF0C;Lock&#xFF0C;Write &#x548C; Data&#xFF1A;</p>
<ul>
<li>Lock&#xFF0C;&#x5C31;&#x662F;&#x8981;&#x4FEE;&#x6539;&#x6570;&#x636E;&#x7684;&#x5B9E;&#x9645; lock&#xFF0C;&#x5728;&#x4E00;&#x4E2A; Percolator &#x4E8B;&#x52A1;&#x91CC;&#x9762;&#xFF0C;&#x6709;&#x4E00;&#x4E2A; primary key&#xFF0C;&#x8FD8;&#x6709;&#x5176;&#x5B83; secondary keys&#xFF0C; &#x53EA;&#x6709; primary key &#x5148;&#x52A0;&#x9501;&#x6210;&#x529F;&#xFF0C;&#x6211;&#x4EEC;&#x624D;&#x4F1A;&#x518D;&#x53BB;&#x5C1D;&#x8BD5;&#x52A0;&#x9501;&#x540E;&#x7EED;&#x7684; secondary keys&#x3002;</li>
<li>Write&#xFF0C;&#x4FDD;&#x5B58;&#x7684;&#x662F;&#x6570;&#x636E;&#x5B9E;&#x9645;&#x63D0;&#x4EA4;&#x5199;&#x5165;&#x7684; commit timestamp&#xFF0C;&#x5F53;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x63D0;&#x4EA4;&#x6210;&#x529F;&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x4F1A;&#x5C06;&#x5BF9;&#x5E94;&#x7684;&#x4FEE;&#x6539;&#x884C;&#x7684; commit timestamp &#x5199;&#x5165;&#x5230; Write &#x4E0A;&#x9762;&#x3002;</li>
<li>Data&#xFF0C;&#x4FDD;&#x5B58;&#x5B9E;&#x9645;&#x884C;&#x7684;&#x6570;&#x636E;&#x3002;</li>
</ul>
<p>&#x5F53;&#x4E8B;&#x52A1;&#x5F00;&#x59CB;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x9996;&#x5148;&#x5F97;&#x5230;&#x4E00;&#x4E2A; start timestamp&#xFF0C;&#x7136;&#x540E;&#x518D;&#x53BB;&#x83B7;&#x53D6;&#x8981;&#x4FEE;&#x6539;&#x884C;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x5728; Get &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5982;&#x679C;&#x8FD9;&#x884C;&#x6570;&#x636E;&#x4E0A;&#x9762;&#x5DF2;&#x7ECF;&#x6709; Lock &#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x53EF;&#x80FD;&#x7EC8;&#x6B62;&#x5F53;&#x524D;&#x4E8B;&#x52A1;&#xFF0C;&#x6216;&#x8005;&#x5C1D;&#x8BD5;&#x6E05;&#x7406; Lock&#x3002;</p>
<p>&#x5F53;&#x6211;&#x4EEC;&#x8981;&#x63D0;&#x4EA4;&#x4E8B;&#x52A1;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5148;&#x5F97;&#x5230; commit timestamp&#xFF0C;&#x4F1A;&#x6709;&#x4E24;&#x4E2A;&#x9636;&#x6BB5;&#xFF1A;</p>
<ol>
<li>Prewrite&#xFF1A;&#x5148;&#x5C1D;&#x8BD5;&#x7ED9; primary key &#x52A0;&#x9501;&#xFF0C;&#x7136;&#x540E;&#x5C1D;&#x8BD5;&#x7ED9; second keys &#x52A0;&#x9501;&#x3002;&#x5982;&#x679C;&#x5BF9;&#x5E94; key &#x4E0A;&#x9762;&#x5DF2;&#x7ECF;&#x6709; Lock&#xFF0C;&#x6216;&#x8005;&#x5728; start timestamp &#x4E4B;&#x540E;&#xFF0C;Write &#x4E0A;&#x9762;&#x5DF2;&#x7ECF;&#x6709;&#x65B0;&#x7684;&#x5199;&#x5165;&#xFF0C;Prewrite &#x5C31;&#x4F1A;&#x5931;&#x8D25;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x4F1A;&#x7EC8;&#x6B62;&#x8FD9;&#x6B21;&#x4E8B;&#x52A1;&#x3002;&#x5728;&#x52A0;&#x9501;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x4F1A;&#x987A;&#x5E26;&#x5C06;&#x6570;&#x636E;&#x5199;&#x5165;&#x5230; Data &#x4E0A;&#x9762;&#x3002;</li>
<li>Commit&#xFF1A;&#x5F53;&#x6240;&#x6709;&#x6D89;&#x53CA;&#x7684;&#x6570;&#x636E;&#x90FD;&#x52A0;&#x9501;&#x6210;&#x529F;&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x63D0;&#x4EA4; primay key&#xFF0C;&#x8FD9;&#x65F6;&#x5019;&#x4F1A;&#x5148;&#x5224;&#x65AD;&#x4E4B;&#x524D;&#x52A0;&#x7684; Lock &#x662F;&#x5426;&#x8FD8;&#x5728;&#xFF0C;&#x5982;&#x679C;&#x8FD8;&#x5728;&#xFF0C;&#x5219;&#x5220;&#x6389; Lock&#xFF0C;&#x5C06; commit timestamp &#x5199;&#x5165;&#x5230; Write&#x3002;&#x5F53; primary key &#x63D0;&#x4EA4;&#x6210;&#x529F;&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x5F02;&#x6B65;&#x63D0;&#x4EA4; second keys&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x7528;&#x5728;&#x4E4E; primary keys &#x662F;&#x5426;&#x80FD;&#x63D0;&#x4EA4;&#x6210;&#x529F;&#xFF0C;&#x5373;&#x4F7F;&#x5931;&#x8D25;&#x4E86;&#xFF0C;&#x4E5F;&#x6709;&#x673A;&#x5236;&#x80FD;&#x4FDD;&#x8BC1;&#x6570;&#x636E;&#x88AB;&#x6B63;&#x5E38;&#x63D0;&#x4EA4;&#x3002;</li>
</ol>
<p>&#x5728; TiKV &#x91CC;&#x9762;&#xFF0C;&#x4E8B;&#x52A1;&#x7684;&#x5B9E;&#x73B0;&#x4E3B;&#x8981;&#x5305;&#x62EC;&#x4E24;&#x5757;&#xFF0C;&#x4E00;&#x4E2A;&#x662F;&#x96C6;&#x6210;&#x5728; TiDB &#x4E2D;&#x7684; <a href="/external_links/1872e642b63f46ff6c7a27f667926633.html" target="blank" rel="noopener">tikv client</a>&#xFF0C;&#x800C;&#x53E6;&#x4E00;&#x4E2A;&#x5219;&#x662F;&#x5728; TiKV &#x4E2D;&#x7684; <a href="/external_links/b0a518c9abfeb1ab077dea819738e365.html" target="blank" rel="noopener">storage</a> mod &#x91CC;&#x9762;&#xFF0C;&#x540E;&#x9762;&#x6211;&#x4EEC;&#x4F1A;&#x8BE6;&#x7EC6;&#x7684;&#x4ECB;&#x7ECD;&#x3002;</p>
<h2 id="RPC-&#x6846;&#x67B6;"><a href="#RPC-&#x6846;&#x67B6;" class="headerlink" title="RPC &#x6846;&#x67B6;"></a>RPC &#x6846;&#x67B6;</h2><p>RPC &#x5E94;&#x8BE5;&#x662F;&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#x91CC;&#x9762;&#x5E38;&#x7528;&#x7684;&#x4E00;&#x79CD;&#x7F51;&#x7EDC;&#x4EA4;&#x4E92;&#x65B9;&#x5F0F;&#xFF0C;&#x4F46;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x6613;&#x7528;&#x5E76;&#x4E14;&#x9AD8;&#x6548;&#x7684; RPC &#x6846;&#x67B6;&#x5E76;&#x4E0D;&#x662F;&#x4E00;&#x4EF6;&#x5BB9;&#x6613;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x5E78;&#x8FD0;&#x7684;&#x662F;&#xFF0C;&#x73B0;&#x5728;&#x6709;&#x5F88;&#x591A;&#x53EF;&#x4EE5;&#x4F9B;&#x6211;&#x4EEC;&#x8FDB;&#x884C;&#x9009;&#x62E9;&#x3002;</p>
<p>TiKV &#x4ECE;&#x6700;&#x5F00;&#x59CB;&#x8BBE;&#x8BA1;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x5E0C;&#x671B;&#x4F7F;&#x7528; gRPC&#xFF0C;&#x4F46; Rust &#x5F53;&#x65F6;&#x5E76;&#x6CA1;&#x6709;&#x80FD;&#x5728;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E2D;&#x53EF;&#x7528;&#x7684; gRPC &#x5B9E;&#x73B0;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x80FD;&#x5148;&#x57FA;&#x4E8E; mio &#x81EA;&#x5DF1;&#x505A;&#x4E86;&#x4E00;&#x4E2A; RPC &#x6846;&#x67B6;&#xFF0C;&#x4F46;&#x968F;&#x7740;&#x4E1A;&#x52A1;&#x7684;&#x590D;&#x6742;&#xFF0C;&#x8FD9;&#x5957; RPC &#x6846;&#x67B6;&#x5F00;&#x59CB;&#x4E0D;&#x80FD;&#x6EE1;&#x8DB3;&#x9700;&#x6C42;&#xFF0C;&#x4E8E;&#x662F;&#x6211;&#x4EEC;&#x51B3;&#x5B9A;&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528; Rust &#x5C01;&#x88C5; Google &#x5B98;&#x65B9;&#x7684; C gRPC&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x6709;&#x4E86; <a href="/external_links/c5a1f916d8abcaabdbacad94b3cbef64.html" target="blank" rel="noopener">grpc-rs</a>&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x5148;&#x8BF4;&#x4E00;&#x4E0B;&#x4E3A;&#x4EC0;&#x4E48;&#x6211;&#x4EEC;&#x51B3;&#x5B9A;&#x4F7F;&#x7528; gRPC&#xFF0C;&#x4E3B;&#x8981;&#x6709;&#x5982;&#x4E0B;&#x539F;&#x56E0;&#xFF1A;</p>
<ul>
<li>gRPC &#x5E94;&#x7528;&#x5E7F;&#x6CDB;&#xFF0C;&#x5F88;&#x591A;&#x77E5;&#x540D;&#x7684;&#x5F00;&#x6E90;&#x9879;&#x76EE;&#x90FD;&#x4F7F;&#x7528;&#x4E86;&#xFF0C;&#x8B6C;&#x5982; Kubernetes&#xFF0C;etcd &#x7B49;&#x3002;</li>
<li>gRPC &#x6709;&#x591A;&#x79CD;&#x8BED;&#x8A00;&#x652F;&#x6301;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x8981;&#x5B9A;&#x4E49;&#x597D;&#x534F;&#x8BAE;&#xFF0C;&#x5176;&#x4ED6;&#x8BED;&#x8A00;&#x90FD;&#x80FD;&#x76F4;&#x63A5;&#x5BF9;&#x63A5;&#x3002;</li>
<li>gRPC &#x6709;&#x4E30;&#x5BCC;&#x7684;&#x63A5;&#x53E3;&#xFF0C;&#x8B6C;&#x5982;&#x652F;&#x6301; unary&#xFF0C;client streaming&#xFF0C;server streaming &#x4EE5;&#x53CA; duplex streaming&#x3002;</li>
<li>gRPC &#x4F7F;&#x7528; protocol buffer&#xFF0C;&#x80FD;&#x9AD8;&#x6548;&#x7684;&#x5904;&#x7406;&#x6D88;&#x606F;&#x7684;&#x7F16;&#x89E3;&#x7801;&#x64CD;&#x4F5C;&#x3002;</li>
<li>gRPC &#x57FA;&#x4E8E; HTTP/2&#xFF0C;&#x4E00;&#x4E9B; HTTP/2 &#x7684;&#x7279;&#x6027;&#xFF0C;&#x8B6C;&#x5982; duplexing&#xFF0C;flow control &#x7B49;&#x3002;</li>
</ul>
<p>&#x6700;&#x5F00;&#x59CB;&#x5F00;&#x53D1; rust gRPC &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x5148;&#x51C6;&#x5907;&#x5C1D;&#x8BD5;&#x57FA;&#x4E8E;&#x4E00;&#x4E2A; rust &#x7684;&#x7248;&#x672C;&#x6765;&#x5F00;&#x53D1;&#xFF0C;&#x4F46;&#x65E0;&#x5948;&#x9047;&#x5230;&#x4E86;&#x592A;&#x591A;&#x7684; panic&#xFF0C;&#x679C;&#x65AD;&#x653E;&#x5F03;&#xFF0C;&#x4E8E;&#x662F;&#x5C31;&#x5C06;&#x76EE;&#x5149;&#x653E;&#x5230;&#x4E86; Google gRPC &#x5B98;&#x65B9;&#x7684;&#x5E93;&#x4E0A;&#x9762;&#x3002;Google gRPC &#x5E93;&#x63D0;&#x4F9B;&#x4E86;&#x591A;&#x79CD;&#x8BED;&#x8A00;&#x652F;&#x6301;&#xFF0C;&#x8B6C;&#x5982; C++&#xFF0C;C#&#xFF0C;Python&#xFF0C;&#x8FD9;&#x4E9B;&#x8BED;&#x8A00;&#x90FD;&#x662F;&#x57FA;&#x4E8E;&#x4E00;&#x4E2A;&#x6838;&#x5FC3;&#x7684; C gRPC &#x6765;&#x505A;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x81EA;&#x7136;&#x9009;&#x62E9;&#x5728; Rust &#x91CC;&#x9762;&#x76F4;&#x63A5;&#x4F7F;&#x7528; C gRPC&#x3002;</p>
<p>&#x56E0;&#x4E3A; Google &#x7684; C gRPC &#x662F;&#x4E00;&#x4E2A;&#x5F02;&#x6B65;&#x6A21;&#x578B;&#xFF0C;&#x4E3A;&#x4E86;&#x7B80;&#x5316;&#x5728; rust &#x91CC;&#x9762;&#x5F02;&#x6B65;&#x4EE3;&#x7801;&#x7F16;&#x5199;&#x7684;&#x96BE;&#x5EA6;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528; rust Future &#x5E93;&#x5C06;&#x5176;&#x91CD;&#x65B0;&#x5305;&#x88C5;&#xFF0C;&#x63D0;&#x4F9B;&#x4E86; Future API&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x80FD;&#x6309;&#x7167; Future &#x7684;&#x65B9;&#x5F0F;&#x7B80;&#x5355;&#x4F7F;&#x7528;&#x4E86;&#x3002;</p>
<p>&#x5173;&#x4E8E; gRPC &#x7684;&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;&#x4EE5;&#x53CA; rust gRPC &#x7684;&#x8BBE;&#x8BA1;&#x8FD8;&#x6709;&#x4F7F;&#x7528;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x5728;&#x540E;&#x9762;&#x7684;&#x6587;&#x7AE0;&#x4E2D;&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;&#x3002;</p>
<h2 id="&#x76D1;&#x63A7;"><a href="#&#x76D1;&#x63A7;" class="headerlink" title="&#x76D1;&#x63A7;"></a>&#x76D1;&#x63A7;</h2><p>&#x5F88;&#x96BE;&#x60F3;&#x8C61;&#x4E00;&#x4E2A;&#x6CA1;&#x6709;&#x76D1;&#x63A7;&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#x662F;&#x5982;&#x4F55;&#x80FD;&#x7A33;&#x5B9A;&#x8FD0;&#x884C;&#x7684;&#x3002;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x53EA;&#x6709;&#x4E00;&#x53F0;&#x673A;&#x5668;&#xFF0C;&#x53EF;&#x80FD;&#x65F6;&#x4E0D;&#x65F6;&#x770B;&#x4E0B;&#x8FD9;&#x53F0;&#x673A;&#x5668;&#x4E0A;&#x9762;&#x7684;&#x670D;&#x52A1;&#x8FD8;&#x5728;&#x4E0D;&#x5728;&#xFF0C;CPU &#x6709;&#x6CA1;&#x6709;&#x95EE;&#x9898;&#x8FD9;&#x4E9B;&#x53EF;&#x80FD;&#x5C31;&#x591F;&#x4E86;&#xFF0C;&#x4F46;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x6709;&#x6210;&#x767E;&#x4E0A;&#x5343;&#x53F0;&#x673A;&#x5668;&#xFF0C;&#x90A3;&#x4E48;&#x52BF;&#x5FC5;&#x8981;&#x4F9D;&#x8D56;&#x76D1;&#x63A7;&#x4E86;&#x3002;</p>
<p>TiKV &#x4F7F;&#x7528;&#x7684;&#x662F; Prometheus&#xFF0C;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x5F3A;&#x5927;&#x7684;&#x76D1;&#x63A7;&#x7CFB;&#x7EDF;&#x3002;Prometheus &#x4E3B;&#x8981;&#x6709;&#x5982;&#x4E0B;&#x7279;&#x6027;&#xFF1A;</p>
<ul>
<li>&#x57FA;&#x4E8E;&#x65F6;&#x5E8F;&#x7684;&#x591A;&#x7EF4;&#x6570;&#x636E;&#x6A21;&#x578B;&#xFF0C;&#x5BF9;&#x4E8E;&#x4E00;&#x4E2A; metric&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528;&#x591A;&#x79CD; tag &#x8FDB;&#x884C;&#x591A;&#x7EF4;&#x533A;&#x5206;&#x3002;</li>
<li>&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x62A5;&#x8B66;&#x673A;&#x5236;&#x3002;</li>
<li>&#x4E30;&#x5BCC;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#xFF0C;&#x63D0;&#x4F9B;&#x4E86; Counter&#xFF0C;Guage&#xFF0C;Histogram &#x8FD8;&#x6709; Summary &#x652F;&#x6301;&#x3002;</li>
<li>&#x5F3A;&#x5927;&#x7684;&#x67E5;&#x8BE2;&#x8BED;&#x8A00;&#x652F;&#x6301;&#x3002;</li>
<li>&#x63D0;&#x4F9B; pull &#x548C; push &#x4E24;&#x79CD;&#x6A21;&#x5F0F;&#x652F;&#x6301;&#x3002;</li>
<li>&#x652F;&#x6301;&#x670D;&#x52A1;&#x7684;&#x52A8;&#x6001;&#x53D1;&#x73B0;&#x548C;&#x9759;&#x6001;&#x914D;&#x7F6E;&#x3002;</li>
<li>&#x80FD;&#x8DDF; Grafana &#x6DF1;&#x5EA6;&#x6574;&#x5408;&#x3002;</li>
</ul>
<p>&#x56E0;&#x4E3A; Prometheus &#x5E76;&#x6CA1;&#x6709; Rust &#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4E8E;&#x662F;&#x6211;&#x4EEC;&#x5F00;&#x53D1;&#x4E86; <a href="/external_links/2ab16fbf30c7b1bcc07f494fb535cd33.html" target="blank" rel="noopener">rust-prometheus</a>&#x3002;Rust Prometheus &#x5728;&#x8BBE;&#x8BA1;&#x4E0A;&#x9762;&#x53C2;&#x8003;&#x4E86; Go Prometehus &#x7684; API&#xFF0C;&#x4F46;&#x6211;&#x4EEC;&#x53EA;&#x652F;&#x6301;&#x4E86; &#x6700;&#x5E38;&#x7528;&#x7684; Counter&#xFF0C;Guage &#x548C; Histogram&#xFF0C;&#x5E76;&#x6CA1;&#x6709;&#x5B9E;&#x73B0; Summary&#x3002;</p>
<p>&#x540E;&#x9762;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD; Prometheus &#x7684;&#x4F7F;&#x7528;&#xFF0C;&#x4EE5;&#x53CA;&#x4E0D;&#x540C;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x7684;&#x4F7F;&#x7528;&#x573A;&#x666F;&#x7B49;&#x3002;</p>
<h2 id="&#x6D4B;&#x8BD5;"><a href="#&#x6D4B;&#x8BD5;" class="headerlink" title="&#x6D4B;&#x8BD5;"></a>&#x6D4B;&#x8BD5;</h2><p>&#x8981;&#x505A;&#x597D;&#x4E00;&#x4E2A;&#x5206;&#x5E03;&#x5F0F;&#x7684; Key-Value Store&#xFF0C;&#x6D4B;&#x8BD5;&#x662F;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#x4E00;&#x73AF;&#x3002; &#x53EA;&#x6709;&#x7ECF;&#x8FC7;&#x4E86;&#x6700;&#x4E25;&#x683C;&#x7684;&#x6D4B;&#x8BD5;&#xFF0C;&#x6211;&#x4EEC;&#x624D;&#x80FD;&#x6709;&#x4FE1;&#x5FC3;&#x53BB;&#x4FDD;&#x8BC1;&#x6574;&#x4E2A;&#x7CFB;&#x7EDF;&#x662F;&#x53EF;&#x4EE5;&#x7A33;&#x5B9A;&#x8FD0;&#x884C;&#x7684;&#x3002;</p>
<p>&#x4ECE;&#x6700;&#x5F00;&#x59CB;&#x5F00;&#x53D1; TiKV &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x5C06;&#x6D4B;&#x8BD5;&#x6446;&#x5728;&#x4E86;&#x6700;&#x91CD;&#x8981;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x9664;&#x4E86;&#x5E38;&#x89C4;&#x7684; unit test&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x505A;&#x4E86;&#x66F4;&#x591A;&#xFF0C;&#x8B6C;&#x5982;&#xFF1A;</p>
<ul>
<li>Stability test&#xFF0C;&#x6211;&#x4EEC;&#x4E13;&#x95E8;&#x5199;&#x4E86;&#x4E00;&#x4E2A; stability test&#xFF0C;&#x968F;&#x673A;&#x7684;&#x5E72;&#x6270;&#x6574;&#x4E2A;&#x7CFB;&#x7EDF;&#xFF0C;&#x540C;&#x65F6;&#x8FD0;&#x884C;&#x6211;&#x4EEC;&#x7684;&#x6D4B;&#x8BD5;&#x7A0B;&#x5E8F;&#xFF0C;&#x770B;&#x7ED3;&#x679C;&#x7684;&#x6B63;&#x786E;&#x6027;&#x3002;</li>
<li>Jepsen&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528; Jepsen &#x6765;&#x9A8C;&#x8BC1; TiKV &#x7684;&#x7EBF;&#x6027;&#x4E00;&#x81F4;&#x6027;&#x3002;</li>
<li>Namazu&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528; Namazu &#x6765;&#x5E72;&#x6270;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x4EE5;&#x53CA; TiKV &#x7EBF;&#x7A0B;&#x8C03;&#x5EA6;&#x3002;</li>
<li>Failpoint&#xFF0C;&#x6211;&#x4EEC;&#x5728; TiKV &#x5F88;&#x591A;&#x5173;&#x952E;&#x903B;&#x8F91;&#x4E0A;&#x9762;&#x6CE8;&#x5165;&#x4E86; fail point&#xFF0C;&#x7136;&#x540E;&#x5728;&#x5916;&#x9762;&#x53BB;&#x89E6;&#x53D1;&#x8FD9;&#x4E9B; fail&#xFF0C;&#x5728;&#x9A8C;&#x8BC1;&#x5373;&#x4F7F;&#x51FA;&#x73B0;&#x4E86;&#x8FD9;&#x4E9B;&#x5F02;&#x5E38;&#x60C5;&#x51B5;&#xFF0C;&#x6570;&#x636E;&#x4ECD;&#x7136;&#x662F;&#x6B63;&#x786E;&#x7684;&#x3002;</li>
</ul>
<p>&#x4E0A;&#x9762;&#x4EC5;&#x4EC5;&#x662F;&#x6211;&#x4EEC;&#x7684;&#x4E00;&#x4E9B;&#x6D4B;&#x8BD5;&#x6848;&#x4F8B;&#xFF0C;&#x5F53;&#x4EE3;&#x7801; merge &#x5230; master &#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x7684; CI &#x7CFB;&#x7EDF;&#x5728;&#x6784;&#x5EFA;&#x597D;&#x7248;&#x672C;&#x4E4B;&#x540E;&#xFF0C;&#x5C31;&#x4F1A;&#x89E6;&#x53D1;&#x6240;&#x6709;&#x7684; test &#x6267;&#x884C;&#xFF0C;&#x53EA;&#x6709;&#x5F53;&#x6240;&#x6709;&#x7684; test &#x90FD;&#x5B8C;&#x5168;&#x8DD1;&#x8FC7;&#xFF0C;&#x6211;&#x4EEC;&#x624D;&#x4F1A;&#x653E;&#x51FA;&#x6700;&#x65B0;&#x7684;&#x7248;&#x672C;&#x3002;</p>
<p>&#x5728; Rust &#x8FD9;&#x8FB9;&#xFF0C;&#x6211;&#x4EEC;&#x6839;&#x636E; FreeBSD &#x7684; Failpoint &#x5F00;&#x53D1;&#x4E86; <a href="/external_links/c5d4e56bf3292ad9e6a5da12f7b6f75e.html" target="blank" rel="noopener">fail-rs</a>&#xFF0C;&#x5E76;&#x5DF2;&#x7ECF;&#x5728; TiKV &#x7684; Raft &#x4E2D;&#x6CE8;&#x5165;&#x4E86;&#x5F88;&#x591A; fail&#xFF0C;&#x540E;&#x9762;&#x8FD8;&#x4F1A;&#x5728;&#x66F4;&#x591A;&#x5730;&#x65B9;&#x6CE8;&#x5165;&#x3002;&#x6211;&#x4EEC;&#x4E5F;&#x4F1A;&#x57FA;&#x4E8E; Rust &#x5F00;&#x53D1;&#x66F4;&#x591A;&#x7684; test &#x5DE5;&#x5177;&#xFF0C;&#x7528;&#x6765;&#x6D4B;&#x8BD5;&#x6574;&#x4E2A;&#x7CFB;&#x7EDF;&#x3002;</p>
<h2 id="&#x5C0F;&#x7ED3;"><a href="#&#x5C0F;&#x7ED3;" class="headerlink" title="&#x5C0F;&#x7ED3;"></a>&#x5C0F;&#x7ED3;</h2><p>&#x4E0A;&#x9762;&#x4EC5;&#x4EC5;&#x5217;&#x51FA;&#x4E86;&#x6211;&#x4EEC;&#x7528; Rust &#x5F00;&#x53D1; TiKV &#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x4E00;&#x4E9B;&#x6838;&#x5FC3;&#x6A21;&#x5757;&#x7684;&#x8BBE;&#x8BA1;&#x601D;&#x8DEF;&#x3002;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4ECB;&#x7ECD;&#xFF0C;&#x540E;&#x9762;&#x6211;&#x4EEC;&#x4F1A;&#x9488;&#x5BF9;&#x6BCF;&#x4E00;&#x4E2A;&#x6A21;&#x5757;&#x8BE6;&#x7EC6;&#x7684;&#x8FDB;&#x884C;&#x8BF4;&#x660E;&#x3002;&#x8FD8;&#x6709;&#x4E00;&#x4E9B;&#x529F;&#x80FD;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x662F;&#x6CA1;&#x6709;&#x505A;&#x7684;&#xFF0C;&#x8B6C;&#x5982; open tracing&#xFF0C;&#x8FD9;&#x4E9B;&#x540E;&#x9762;&#x90FD;&#x4F1A;&#x6162;&#x6162;&#x5F00;&#x59CB;&#x5B8C;&#x5584;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x7684;&#x76EE;&#x6807;&#x662F;&#x901A;&#x8FC7; TiKV&#xFF0C;&#x5728;&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#x9886;&#x57DF;&#xFF0C;&#x63D0;&#x4F9B;&#x4E00;&#x5957; Rust &#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;&#x5F62;&#x6210;&#x4E00;&#x4E2A; Rust ecosystem&#x3002;&#x8FD9;&#x4E2A;&#x76EE;&#x6807;&#x5F88;&#x8FDC;&#x5927;&#xFF0C;&#x6B22;&#x8FCE;&#x4EFB;&#x4F55;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x540C;&#x5B66;&#x52A0;&#x5165;&#x3002;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/9ff6394e8dab552d937a3c5933807cfa.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903512040538125.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903512040538125.html" itemprop="url">痛入爽出 HTTP/2：代码实战1</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-20T14:10:42+08:00">
                2017-11-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x8FD9;&#x4E00;&#x671F;&#x5168;&#x662F;&#x5E72;&#x8D27;&#x3002;&#x5E72;&#x5F97;&#x4F60;&#x53E3;&#x6E34;&#x60F3;&#x559D;&#x6C34;&#x3002;</p>
<hr>
<h2 id="&#x73AF;&#x5883;&#x642D;&#x5EFA;"><a href="#&#x73AF;&#x5883;&#x642D;&#x5EFA;" class="headerlink" title="&#x73AF;&#x5883;&#x642D;&#x5EFA;"></a>&#x73AF;&#x5883;&#x642D;&#x5EFA;</h2><ol>
<li>&#x5B89;&#x88C5; Python&#x3002;&#x4F60;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x5B98;&#x7F51;&#x5B89;&#x88C5;&#x3001;Anaconda&#x5B89;&#x88C5;&#x6216;&#x8005;&#x4F60;&#x5DF2;&#x7ECF;&#x6709;&#x4E86; Python3.5 &#x4EE5;&#x4E0A;&#x7684;&#x7248;&#x672C;&#x3002;<a href="/external_links/63c92aa63a0fab79b287169f206b72fd.html" target="blank" rel="noopener">PyPy</a>&#x4E5F;&#x53EF;&#x4EE5;&#x7684;&#x3002;</li>
<li>&#x53EF;&#x9009;&#xFF1A;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; Python &#x865A;&#x62DF;&#x73AF;&#x5883;&#xFF08;&#x4E0D;&#x77E5;&#x6240;&#x4E91;&#x7684;&#x76F4;&#x63A5;&#x5FFD;&#x7565;&#x8FD9;&#x4E00;&#x6B65;&#xFF09;</li>
<li>&#x521B;&#x5EFA;&#x6211;&#x4EEC;&#x7684;&#x9879;&#x76EE;&#x6587;&#x4EF6;&#x5939;</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;# bash shell</span><br><span class="line">mkdir gethy</span><br><span class="line">cd gethy</span><br></pre></td></tr></table></figure>

<p>&#x5728; Windows &#x4E0A;&#x7684;&#x540C;&#x5B66;&#x4E0D;&#x7528;&#x62C5;&#x5FC3;&#xFF0C;&#x672C;&#x6559;&#x7A0B;&#x7684;&#x4E00;&#x5207;&#x64CD;&#x4F5C;&#x90FD;&#x662F;&#x53EF;&#x4EE5;&#x5728; Windows&#x3001;Linux &#x548C; Mac &#x4E0A;&#x5B8C;&#x6210;&#x7684;&#x3002;<br>4. &#x521B;&#x5EFA;&#x6D4B;&#x8BD5;&#x8DEF;&#x5F84;&#x548C;&#x6E90;&#x4EE3;&#x7801;&#x8DEF;&#x5F84;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;mkdir gethy  # Python &#x754C;&#x7684;&#x7EA6;&#x5B9A;&#x4FD7;&#x6210;&#x662F;&#x5728;&#x9879;&#x76EE;&#x6839;&#x76EE;&#x5F55;&#x4E0B;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x540C;&#x540D;&#x7684;&#x8DEF;&#x5F84;&#x6765;&#x653E;&#x6E90;&#x4EE3;&#x7801;</span><br><span class="line">mkdir test</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>&#x5B89;&#x88C5;&#x4F9D;&#x8D56;</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;pip install h2</span><br></pre></td></tr></table></figure>

<p>&#x6211;&#x4EEC;&#x8981;&#x7528;&#x5230; <a href="/external_links/03d51e992290320ce1b6313b3137b8fd.html" target="blank" rel="noopener">Lukasa</a> &#x5927;&#x795E;&#x5199;&#x7684; hyper-h2 &#x5E93;&#xFF1A;<a href="/external_links/6661f2a72d4d75e9ec12c8f2ee4056e0.html" target="blank" rel="noopener">https://github.com/python-hyper/hyper-h2</a></p>
<p>&#x8FD9;&#x4E2A;&#x5E93;&#x5B9E;&#x73B0;&#x4E86; h2 &#x534F;&#x8BAE;&#x7684;&#x5E95;&#x5C42;&#x90E8;&#x5206;&#xFF0C;&#x5305;&#x62EC;&#xFF1A;&#x7F16;&#x7801;&#x89E3;&#x7801; TCP &#x5C42;&#x5B57;&#x8282;&#x4E32;&#xFF08;hpack&#xFF09;&#xFF0C;&#x5EFA;&#x7ACB;&#x5E76;&#x7BA1;&#x7406; HTTP &#x8FDE;&#x63A5;&#x3002;<br>&#x4F46;&#x662F;&#xFF0C;&#x8FD9;&#x4E2A;&#x5E93;&#x5E76;&#x6CA1;&#x6709;&#x5B9E;&#x73B0; HTTP &#x5E94;&#x7528;&#x5C42;&#x7684;&#x65B9;&#x6CD5;&#xFF08;GET&#x3001;POST&#xFF09;&#x548C;&#x8BED;&#x4E49;&#xFF08;Requset &amp; Response&#xFF09;&#xFF0C;&#x4E5F;&#x6CA1;&#x6709;&#x5B9E;&#x73B0; Flow Control&#xFF08;&#x6D41;&#x91CF;&#x7BA1;&#x7406;&#xFF09;&#x548C; Server Push&#xFF08;&#x670D;&#x52A1;&#x5668;&#x63A8;&#x9001;&#xFF09;&#x3002;&#x8FD9;&#x4E9B;&#x4E5F;&#x662F;&#x6211;&#x4EEC;&#x8981;&#x5B9E;&#x73B0;&#x7684;&#x90E8;&#x5206;&#xFF08;&#x9664;&#x4E86; Server Push&#xFF09;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/450cc2c7e24567366ce0ea8ab0578873462f8ce83e49969221550c6550c24290" alt></p>
<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;HTTP&#x534F;&#x8BAE;&#x662F;5&#x3001;6&#x3001;7&#x5C42;&#x7684;&#x534F;&#x8BAE;&#xFF0C;&#x4F46;&#x662F; hyper-h2 &#x53EA;&#x5B9E;&#x73B0;&#x4E86;5&#x3001;6&#x5C42;&#x7684;&#x529F;&#x80FD;&#x3002;Web &#x5E94;&#x7528;&#x662F;&#x6CA1;&#x6709;&#x529E;&#x6CD5;&#x76F4;&#x63A5;&#x4F7F;&#x7528; hyper-h2 &#x3002;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x8981;&#x5728; hyper-h2 &#x7684;&#x57FA;&#x7840;&#x4E0A;&#xFF0C;&#x5B9E;&#x73B0;&#x5B8C;&#x6574;&#x7684; h2 &#x534F;&#x8BAE;&#x3002;</p>
<p>&#x5173;&#x4E8E;&#x7F51;&#x7EDC;&#x534F;&#x8BAE;&#x548C;&#x67B6;&#x6784;&#xFF0C;&#x8BF7;&#x53C2;&#x8003; <a href="/external_links/abe2b2d3cedebf4738f77aebb5e7731d.html" target="blank" rel="noopener">What&#x2019;s The Difference Between The OSI Seven-Layer Network Model And TCP/IP?</a></p>
<h2 id="&#x5F00;&#x59CB;&#x7F16;&#x7A0B;"><a href="#&#x5F00;&#x59CB;&#x7F16;&#x7A0B;" class="headerlink" title="&#x5F00;&#x59CB;&#x7F16;&#x7A0B;"></a>&#x5F00;&#x59CB;&#x7F16;&#x7A0B;</h2><h3 id="&#x5B9A;&#x4E49;-API"><a href="#&#x5B9A;&#x4E49;-API" class="headerlink" title="&#x5B9A;&#x4E49; API"></a>&#x5B9A;&#x4E49; API</h3><p>&#x6211;&#x4EEC;&#x9075;&#x5FAA;&#x81EA;&#x4E0A;&#x800C;&#x4E0B;&#x7684;&#x8BBE;&#x8BA1;&#x3002;&#x5148;&#x8BBE;&#x8BA1;API&#xFF0C;&#x518D;&#x5B9E;&#x73B0;&#x51FD;&#x6570;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;touch http2protocol.py event.py</span><br></pre></td></tr></table></figure>

<p>&#x7528;&#x4F60;&#x6700;&#x559C;&#x6B22;&#x7684;&#x7F16;&#x8F91;&#x5668;&#x6253;&#x5F00;<code>http2protocol.py</code>&#xFF0C;&#x52A0;&#x5165;&#x4EE5;&#x4E0B;&#x4EE3;&#x7801;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;class HTTP2Protocol:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    A pure in-memory H2 implementation for application level development.</span><br><span class="line">    It does not do IO.</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    </span><br><span class="line">    def __init__(self):</span><br><span class="line">        pass</span><br><span class="line"></span><br><span class="line">    def receive(self, data: bytes):</span><br><span class="line">        pass    </span><br><span class="line"></span><br><span class="line">    def send(self, stream: Stream):</span><br><span class="line">        pass</span><br></pre></td></tr></table></figure>

<p>&#x6211;&#x4EEC;&#x7684;&#x5E93;&#x53EA;&#x6709; 2 &#x4E2A;&#x516C;&#x5F00;API&#xFF0C;<code>receive</code>&#x548C;<code>send</code>&#x3002;</p>
<p><code>receive</code> &#x7528;&#x6765;&#x4ECE; TCP &#x5C42;&#x83B7;&#x53D6;&#x6570;&#x636E;&#x3002;<code>send</code> &#x5C06;&#x4E00;&#x4E2A;&#x5B8C;&#x6574;&#x7684; <code>Stream</code> &#x7F16;&#x7801;&#x4E3A; TCP &#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x63A5;&#x6536;&#x7684;&#x6570;&#x636E;&#x3002;</p>
<p>&#x503C;&#x5F97;&#x5F3A;&#x8C03;&#x7684;&#x662F;&#xFF0C;&#x8FD9;&#x4E2A;&#x5E93;&#x4E0D;&#x505A;&#x4EFB;&#x4F55; I/O&#x3002;&#x8FD9;&#x79CD;&#x5F00;&#x53D1;&#x8303;&#x5F0F;&#x53EB;&#x505A; I/O &#x72EC;&#x7ACB;&#x8303;&#x5F0F;&#x3002;&#x5E93;&#x7684;&#x4F7F;&#x7528;&#x8005;&#x5E94;&#x8BE5;&#x81EA;&#x5DF1;&#x51B3;&#x5B9A;&#x4F7F;&#x7528;&#x54EA;&#x4E00;&#x79CD; IO &#x65B9;&#x5F0F;&#x3002;&#x8FD9;&#x7ED9;&#x4E88;&#x4E86;&#x5F00;&#x53D1;&#x8005;&#x6700;&#x5927;&#x7684;&#x7075;&#x6D3B;&#x6027;&#x3002;&#x4E5F;&#x7B26;&#x5408; <a href="/external_links/9f5f0a351c4fbf08ca7295b14cd79278.html" target="blank" rel="noopener">Clean Architecture</a> &#x7684;&#x539F;&#x5219;&#x3002;</p>
<p>hyper-h2 &#x672C;&#x8EAB;&#x4E5F;&#x662F;&#x4E0D;&#x505A;&#x4EFB;&#x4F55; IO &#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x4FDD;&#x7559;&#x8FD9;&#x4E2A;&#x4F18;&#x826F;&#x4F20;&#x7EDF;&#x3002;</p>
<p>&#x82F1;&#x6587;&#x91CC;&#x53EB; sans-IO model&#xFF0C;&#x8BF7;&#x53C2;&#x8003;&#xFF1A;<a href="/external_links/44e605c763572fc9368cee0a4fc9f746.html" target="blank" rel="noopener">http://sans-io.readthedocs.io</a></p>
<h3 id="&#x5B9A;&#x4E49;-Stream"><a href="#&#x5B9A;&#x4E49;-Stream" class="headerlink" title="&#x5B9A;&#x4E49; Stream"></a>&#x5B9A;&#x4E49; Stream</h3><p>&#x9664;&#x4E86;<code>HTTP2Protocol</code>&#x7C7B;&#xFF0C;<code>Stream</code>&#x7C7B;&#x4E5F;&#x662F;&#x7528;&#x6237;&#x4F1A;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x7684;&#x7C7B;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;class Stream:</span><br><span class="line">	def __init__(self, stream_id: int, headers: iterable):</span><br><span class="line">		self.stream_id = stream_id</span><br><span class="line">		self.headers = headers</span><br><span class="line">		self.stream_ended = False</span><br><span class="line">		self.buffered_data = []</span><br><span class="line">		self.data = None</span><br></pre></td></tr></table></figure>

<p>&#x770B;&#x5230;&#x8FD9;&#x91CC;&#x5927;&#x5BB6;&#x53EF;&#x80FD;&#x5C31;&#x4F1A;&#x89C9;&#x5F97;&#x5F88;&#x4EB2;&#x5207;&#x4E86;&#x3002;&#x4E00;&#x4E2A; Stream &#x5176;&#x5B9E;&#x5C31;&#x4EE3;&#x8868;&#x4E86;&#x4E00;&#x4E2A;&#x5E38;&#x89C4;&#x7684; HTTP Request &#x6216;&#x8005; Response&#x3002;&#x6211;&#x4EEC;&#x6709;&#x5E38;&#x89C4;&#x7684; headers&#xFF0C;&#x5E38;&#x89C4;&#x7684; data&#xFF08;&#x6709;&#x4E9B;&#x4EBA;&#x53EB; body&#xFF09;&#x3002;&#x4E0E; HTTP/1.x &#x65F6;&#x4EE3;&#x552F;&#x4E00;&#x4E0D;&#x540C;&#x7684;&#x662F;&#xFF0C;&#x591A;&#x4E86;&#x4E00;&#x4E2A; stream id&#x3002;</p>
<h2 id="&#x5199;&#x6D4B;&#x8BD5;-TDD"><a href="#&#x5199;&#x6D4B;&#x8BD5;-TDD" class="headerlink" title="&#x5199;&#x6D4B;&#x8BD5; TDD"></a>&#x5199;&#x6D4B;&#x8BD5; TDD</h2><p>Test Driven Development &#x4E0E;&#x81EA;&#x4E0A;&#x800C;&#x4E0B;&#x5F97;&#x5230;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#x662F;&#x5BC6;&#x4E0D;&#x53EF;&#x5206;&#x7684;&#x3002;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x6709;&#x4E86;API&#xFF0C;&#x5199;&#x6D4B;&#x8BD5;&#x540C;&#x65F6;&#x4E5F;&#x4EA4;&#x4EE3;&#x4E86; API &#x7684;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;cd ../test</span><br><span class="line">touch test_all.py</span><br></pre></td></tr></table></figure>

<p>&#x6211;&#x4EEC;&#x7684;&#x5E93;&#x5F88;&#x5C0F;&#xFF0C;&#x4E00;&#x4E2A;&#x6D4B;&#x8BD5;&#x6587;&#x4EF6;&#x5C31;&#x591F;&#x4E86;&#x3002;&#x6211;&#x4EEC;&#x8FD8;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x5E2E;&#x52A9;&#x6A21;&#x7EC4;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;wget https://raw.githubusercontent.com/CreatCodeBuild/gethy/master/test/helpers.py</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x4E2A;&#x5E2E;&#x52A9;&#x6A21;&#x7EC4;&#x662F; <a href="/external_links/03d51e992290320ce1b6313b3137b8fd.html" target="blank" rel="noopener">Lusaka</a> &#x5927;&#x795E;&#x5728; <a href="/external_links/104c2f2957dc9b7b6cb1abc9c02c2a43.html" target="blank" rel="noopener">hyper-h2</a> &#x7684;&#x6D4B;&#x8BD5;&#x4E2D;&#x63D0;&#x4F9B;&#x7684;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x6765;&#x60F3;&#x8C61;&#x4E00;&#x4E0B; gethy &#x7684;&#x7528;&#x6CD5;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;# &#x4F2A;&#x4EE3;&#x7801;</span><br><span class="line">from gethy import HTTP2Protocol</span><br><span class="line">import Socket</span><br><span class="line">import SomeWebFramework</span><br><span class="line"></span><br><span class="line">protocol = HTTP2Protocol()</span><br><span class="line">socket = Socket()</span><br><span class="line">while True:</span><br><span class="line">    if socket.accept():</span><br><span class="line">        while True:</span><br><span class="line">            bytes = socket.receive()</span><br><span class="line">            if bytes:</span><br><span class="line">                requests = protocol.receive(bytes)</span><br><span class="line">                for request in requests:</span><br><span class="line">                    response = SomeWebFramework.handle(request)</span><br><span class="line">                    bytes_to_send = protocol.send(response)</span><br><span class="line">                    socket.send(bytes_to_send)</span><br><span class="line">            else:</span><br><span class="line">                break</span><br></pre></td></tr></table></figure>

<p>&#x5927;&#x5BB6;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x6211;&#x5728;&#x8FD9;&#x91CC;&#x5199;&#x4E86;&#x4E00;&#x4E2A;&#x4F2A;&#x4EE3;&#x7801;&#x7684;&#x5355;&#x7EBF;&#x7A0B;&#x963B;&#x585E;&#x5F0F;&#x540C;&#x6B65;&#x670D;&#x52A1;&#x5668;&#x3002;&#x6211;&#x4EEC;&#x7684;&#x5E93;&#x662F;&#x5B8C;&#x5168;&#x4E0D;&#x505A; IO &#x7684;&#x3002;&#x4E00;&#x5207;IO&#x90FD;&#x76F4;&#x63A5;&#x4EA4;&#x7ED9; Server &#x53BB;&#x5B8C;&#x6210;&#x3002;gethy &#x4EC5;&#x4EC5;&#x662F;&#x5728;&#x5185;&#x5B58;&#x91CC;&#x5904;&#x7406;&#x6570;&#x636E;&#x800C;&#x5DF2;&#x3002;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x4F8B;&#x5B50;&#x4E5F;&#x6E05;&#x695A;&#x5730;&#x5C55;&#x793A;&#x4E86;API&#x7684;&#x4F7F;&#x7528;&#x65B9;&#x5F0F;&#x3002;</p>
<p>&#x6D4B;&#x8BD5;&#x7F51;&#x7EDC;&#x534F;&#x8BAE;&#x7684;&#x5B9E;&#x73B0;&#x7684;&#x4E00;&#x5927;&#x96BE;&#x70B9;&#x5C31;&#x5728;&#x4E8E; IO&#x3002;&#x5982;&#x679C;&#x7C7B;&#x5E93;&#x6CA1;&#x6709; IO&#xFF0C;&#x90A3;&#x4E48;&#x6D4B;&#x8BD5;&#x5176;&#x5B9E;&#x53D8;&#x5F97;&#x7B80;&#x5355;&#x4E86;&#x3002;&#x90A3;&#x4E48;&#xFF0C;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x770B;&#x5177;&#x4F53;&#x7684;&#x6D4B;&#x8BD5;&#x600E;&#x4E48;&#x5199;&#x5427;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;# test_all.py</span><br><span class="line">def test_receive_headers_only():</span><br><span class="line">    pass</span><br><span class="line">    </span><br><span class="line">def test_receive_headers_and_data():</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line">def test_send_headers_only():</span><br><span class="line">    pass</span><br><span class="line">    </span><br><span class="line">def test_send_headers_and_data():</span><br><span class="line">    pass</span><br><span class="line">    </span><br><span class="line">def test_send_huge_data():</span><br><span class="line">    pass</span><br><span class="line">    </span><br><span class="line">def test_receive_huge_data():</span><br><span class="line">    pass</span><br></pre></td></tr></table></figure>

<p>&#x516D;&#x4E2A;&#x6D4B;&#x8BD5;&#x6848;&#x4F8B;&#xFF0C;&#x6D4B;&#x8BD5;&#x4E86;&#x53D1;&#x9001;&#x63A5;&#x6536;&#x4E0E;&#x56DE;&#x590D;&#x8BF7;&#x6C42;&#x3002;&#x6700;&#x540E;&#x4E24;&#x4E2A;&#x6D4B;&#x8BD5;&#x4F7F;&#x7528;&#x5DE8;&#x5927;&#x6570;&#x636E;&#x91CF;&#xFF0C;&#x662F;&#x4E3A;&#x4E86;&#x6D4B;&#x8BD5; Flow Control &#x7684;&#x6B63;&#x786E;&#x6027;&#x3002;&#x6211;&#x4EEC;&#x76EE;&#x524D;&#x53EF;&#x4EE5;&#x4E0D;&#x7BA1;&#x3002;</p>
<p>&#x5148;&#x5B9E;&#x73B0;&#x7B2C;&#x4E00;&#x4E2A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;# test_all.py</span><br><span class="line">from gethy import HTTP2Protocol</span><br><span class="line">from gethy.event import RequestEvent</span><br><span class="line"></span><br><span class="line">from helpers import FrameFactory</span><br><span class="line"></span><br><span class="line"># &#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x7684;&#x6D4B;&#x8BD5;&#x5F88;&#x5C11;&#xFF0C;&#x6240;&#x4EE5;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#x4E5F;OK</span><br><span class="line">frame_factory = FrameFactory()</span><br><span class="line">protocol = HTTP2Protocol()</span><br><span class="line">protocol.receive(frame_factory.preamble())  # h2 &#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x65F6;&#x8981;&#x6709;&#x7684;&#x5B57;&#x6BB5;</span><br><span class="line">headers = [</span><br><span class="line">	(&apos;:method&apos;, &apos;GET&apos;),</span><br><span class="line">	(&apos;:path&apos;, &apos;/&apos;),</span><br><span class="line">	(&apos;:scheme&apos;, &apos;https&apos;),  # scheme &#x548C; schema &#x5728;&#x82F1;&#x6587;&#x4E2D;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#x8BCD;&#x7684;&#x4E0D;&#x540C;&#x5199;&#x6CD5;</span><br><span class="line">	                       # &#x4E0D;&#x8FC7;&#xFF0C;&#x4E00;&#x822C;&#x5728; h2 &#x4E2D;&#x7528; shceme&#xFF0C;&#x8BF4;&#x5230;&#x6570;&#x636E;&#x6A21;&#x578B;&#x65F6;&#x7528; schema</span><br><span class="line">	(&apos;:authority&apos;, &apos;example.com&apos;),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def test_receive_headers_only():</span><br><span class="line">	&quot;&quot;&quot;</span><br><span class="line">	able to receive headers with no data</span><br><span class="line">	&quot;&quot;&quot;</span><br><span class="line">	# &#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x8D77;&#x7684; session &#x7684; stream id &#x662F;&#x5355;&#x6570;</span><br><span class="line">	# &#x670D;&#x52A1;&#x5668;&#x53D1;&#x8D77;&#x7684; session &#x7684; stream id &#x662F;&#x53CC;&#x6570;</span><br><span class="line">	# &#x4E00;&#x4E2A; session &#x5305;&#x542B;&#x4E00;&#x5BF9; request/response</span><br><span class="line">	# id 0 &#x4EE3;&#x8868;&#x6574;&#x4E2A; connection</span><br><span class="line">	stream_id = 1</span><br><span class="line">	</span><br><span class="line">    # &#x5728;&#x8FD9;&#x91CC;&#x624B;&#x52A8;&#x751F;&#x6210;&#x4E00;&#x4E2A; client &#x7684; request frame&#xFF0C;&#x6765;&#x6A21;&#x62DF;&#x5BA2;&#x6237;&#x7AEF;&#x8BF7;&#x6C42;</span><br><span class="line">	frame_from_client = frame_factory.build_headers_frame(headers, </span><br><span class="line">	                                                      stream_id=stream_id,</span><br><span class="line">	                                                      flags=[&apos;END_STREAM&apos;])</span><br><span class="line">	# &#x5C06;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x5E8F;&#x5217;&#x5316;&#x4E3A; TCP &#x53EF;&#x63A5;&#x53D7;&#x7684; bytes</span><br><span class="line">	data = frame_from_client.serialize()</span><br><span class="line">	# &#x670D;&#x52A1;&#x5668;&#x7AEF;&#x63A5;&#x6536;&#x8BF7;&#x6C42;&#xFF0C;&#x5F97;&#x5230;&#x4E00;&#x4E9B; gethy &#x5B9A;&#x4E49;&#x7684;&#x4E8B;&#x4EF6;</span><br><span class="line">	events = protocol.receive(data)</span><br><span class="line">    </span><br><span class="line">    # &#x56E0;&#x4E3A;&#x8BF7;&#x6C42;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#xFF0C;&#x6240;&#x4EE5;&#x4EC5;&#x53EF;&#x80FD;&#x6709;&#x4E00;&#x4E2A;&#x4E8B;&#x4EF6;&#xFF0C;&#x4E14;&#x4E3A; RequestEvent &#x4E8B;&#x4EF6;</span><br><span class="line">	assert len(events) == 1</span><br><span class="line">	assert isinstance(events[0], RequestEvent)</span><br><span class="line"></span><br><span class="line">	event = events[0]</span><br><span class="line">	assert event.stream.stream_id == stream_id</span><br><span class="line">	assert event.stream.headers == headers      #  &#x9A8C;&#x8BC1; Headers</span><br><span class="line">	assert event.stream.data == b&apos;&apos;             #  &#x9A8C;&#x8BC1;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x6570;&#x636E;</span><br><span class="line">	assert event.stream.buffered_data is None   #  &#x9A8C;&#x8BC1;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x6570;&#x636E;</span><br><span class="line">	assert event.stream.stream_ended is True    #  &#x9A8C;&#x8BC1;&#x8BF7;&#x6C42;&#x5B8C;&#x6574;&#xFF08;Stream &#x7ED3;&#x675F;&#xFF09;</span><br></pre></td></tr></table></figure>

<p>&#x9605;&#x8BFB;&#x4E0A;&#x9762;&#x7684;&#x6D4B;&#x8BD5;&#xFF0C;&#x5927;&#x5BB6;&#x53EF;&#x4EE5;&#x57FA;&#x672C;&#x4E0A;&#x77E5;&#x9053; gethy &#x7684;&#x7528;&#x6CD5;&#x548C; http2 &#x7684;&#x57FA;&#x672C;&#x8BED;&#x4E49;&#x3002;&#x5927;&#x5BB6;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#xFF0C;http2 &#x7684;&#x8BED;&#x4E49;&#x548C; http1 &#x57FA;&#x672C;&#x6CA1;&#x6709;&#x53D8;&#x5316;&#x3002;&#x552F;&#x4E00;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x5C31;&#x662F; headers &#x91CC;4&#x4E2A;<code>:xxx</code>&#x5B57;&#x6837;&#x7684; header&#x3002;<code>:</code>&#x5192;&#x53F7;&#x662F;&#x534F;&#x8BAE;&#x4F7F;&#x7528;&#x7684; header &#x7B26;&#x53F7;&#x3002;&#x5E94;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x7684; header &#x4E0D;&#x5E94;&#x8BE5;&#x4F7F;&#x7528;&#x5192;&#x53F7;&#x3002;&#x7136;&#x540E;&#xFF0C;&#x867D;&#x7136; http2 &#x534F;&#x8BAE;&#x672C;&#x8EAB;&#x662F;&#x5141;&#x8BB8;&#x5927;&#x5199;&#x5B57;&#x6BCD;&#xFF0C;&#x5E76;&#x4E14;&#x662F;&#x5927;&#x5C0F;&#x5199;&#x654F;&#x611F;&#x7684;&#xFF0C;&#x4F46;&#x662F; gethy &#x7684;&#x4F9D;&#x8D56;&#x5E93; hyper-h2 &#x53EA;&#x5141;&#x8BB8;&#x5C0F;&#x5199;&#x3002;</p>
<p>&#x73B0;&#x5728;&#x6765;&#x5B9E;&#x73B0;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;def test_receive_headers_and_data():</span><br><span class="line">	stream_id = 3</span><br><span class="line"></span><br><span class="line">	client_headers_frame = frame_factory.build_headers_frame(headers, stream_id=stream_id)</span><br><span class="line">	headers_bytes = client_headers_frame.serialize()</span><br><span class="line"></span><br><span class="line">	data = b&apos;some amount of data&apos;</span><br><span class="line">	client_data_frame = frame_factory.build_data_frame(data, stream_id=stream_id, flags=[&apos;END_STREAM&apos;])</span><br><span class="line">	data_bytes = client_data_frame.serialize()</span><br><span class="line"></span><br><span class="line">	events = protocol.receive(headers_bytes+data_bytes)</span><br><span class="line"></span><br><span class="line">	assert len(events) == 1</span><br><span class="line">	assert isinstance(events[0], RequestEvent)</span><br><span class="line"></span><br><span class="line">	event = events[0]</span><br><span class="line">	assert event.stream.stream_id == stream_id</span><br><span class="line">	assert event.stream.headers == headers     # &#x9A8C;&#x8BC1; Headers</span><br><span class="line">	assert event.stream.data == data           # &#x9A8C;&#x8BC1;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x6570;&#x636E;</span><br><span class="line">	assert event.stream.buffered_data is None  # &#x9A8C;&#x8BC1;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x6570;&#x636E;</span><br><span class="line">	assert event.stream.stream_ended is True   # &#x9A8C;&#x8BC1;&#x8BF7;&#x6C42;&#x5B8C;&#x6574;&#xFF08;Stream &#x7ED3;&#x675F;&#xFF09;</span><br></pre></td></tr></table></figure>

<p>&#x5E26;&#x6570;&#x636E;&#x7684;&#x8BF7;&#x6C42;&#x4E5F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x52A0;&#x4E0A;<code>DATA</code>frame&#x5373;&#x53EF;&#x3002;</p>
<p>&#x597D;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;&#x770B;&#x5982;&#x4F55;&#x53D1;&#x9001;&#x56DE;&#x590D;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;def test_send_headers_only():</span><br><span class="line">	stream_id = 1</span><br><span class="line">	response_headers = [(&apos;:status&apos;, &apos;200&apos;)]</span><br><span class="line"></span><br><span class="line">	stream = Stream(stream_id, response_headers)</span><br><span class="line">	stream.stream_ended = True</span><br><span class="line">	stream.buffered_data = None</span><br><span class="line">	stream.data = None</span><br><span class="line"></span><br><span class="line">	events = protocol.send(stream)</span><br><span class="line">	assert len(events) == 2</span><br><span class="line">	for event in events:</span><br><span class="line">		assert isinstance(event, MoreDataToSendEvent)</span><br></pre></td></tr></table></figure>

<p>&#x53EA;&#x53D1;&#x9001; Headers &#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;<code>Stream</code>&#xFF0C;&#x7136;&#x540E;&#x53D1;&#x9001;&#x5C31;&#x884C;&#x4E86;&#x3002;&#x76EE;&#x524D;&#x5927;&#x5BB6;&#x53EF;&#x4EE5;&#x5FFD;&#x7565;<code>MoreDataToSendEvent</code>&#x3002;&#x6211;&#x4F1A;&#x5728;&#x89C6;&#x9891;&#x548C;&#x540E;&#x7EED;&#x6587;&#x7AE0;&#x4E2D;&#x5A13;&#x5A13;&#x9053;&#x6765;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;def test_send_headers_and_data():</span><br><span class="line">	&quot;&quot;&quot;</span><br><span class="line">	able to receive headers and small amount data.</span><br><span class="line">	able to send headers and small amount of data</span><br><span class="line">	&quot;&quot;&quot;</span><br><span class="line">	stream_id = 3</span><br><span class="line">	response_headers = [(&apos;:status&apos;, &apos;400&apos;)]</span><br><span class="line">	size = 1024 * 64 - 2  # default flow control window size per stream is 64 KB - 1 byte</span><br><span class="line"></span><br><span class="line">	stream = Stream(stream_id, response_headers)</span><br><span class="line">	stream.stream_ended = True</span><br><span class="line">	stream.buffered_data = None</span><br><span class="line">	stream.data = bytes(size)</span><br><span class="line"></span><br><span class="line">	events = protocol.send(stream)</span><br><span class="line">	assert len(events) == size // protocol.block_size + 3</span><br><span class="line">	for event in events:</span><br><span class="line">		assert isinstance(event, MoreDataToSendEvent)</span><br><span class="line"></span><br><span class="line">	assert not protocol.outbound_streams</span><br><span class="line">	assert not protocol.inbound_streams</span><br></pre></td></tr></table></figure>

<p>&#x5982;&#x679C;&#x8981;&#x53D1;&#x9001;&#x6570;&#x636E;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x5C06;<code>stream.data</code>&#x8D4B;&#x503C;&#x3002;&#x6CE8;&#x610F;&#xFF0C;&#x4E00;&#x5B9A;&#x8981;&#x662F;<code>bytes</code>&#x7C7B;&#x578B;&#x3002;&#x4EE5;&#x4E0A;&#x6D4B;&#x8BD5;&#x4E5F;&#x6D89;&#x53CA;&#x5230;&#x4E86; Flow Control&#xFF08;&#x6D41;&#x91CF;&#x63A7;&#x5236;&#xFF09;&#xFF0C;&#x6211;&#x4F1A;&#x5728;&#x89C6;&#x9891;&#x548C;&#x540E;&#x7EED;&#x6587;&#x7AE0;&#x4E2D;&#x8BB2;&#x89E3;&#x3002;</p>
<h2 id="&#x7ED3;&#x8BED;"><a href="#&#x7ED3;&#x8BED;" class="headerlink" title="&#x7ED3;&#x8BED;"></a>&#x7ED3;&#x8BED;</h2><p>&#x597D;&#x5566;&#xFF0C;&#x60F3;&#x5FC5;&#x5230;&#x8FD9;&#x91CC;&#x4F60;&#x4E00;&#x5B9A;&#x5BF9; GetHy &#x6709;&#x4E86;&#x5927;&#x5C40;&#x89C2;&#x7684;&#x8BA4;&#x8BC6;&#xFF0C;&#x4E5F;&#x719F;&#x6089;&#x4E86; API &#x53CA;&#x5E94;&#x7528;&#x573A;&#x666F;&#x3002;&#x63A5;&#x4E0B;&#x6765;&#x5C31;&#x662F;&#x8981;&#x5B9E;&#x73B0;&#x5B83;&#x4E86;&#x3002;&#x6211;&#x4EEC;&#x4E0B;&#x4E00;&#x671F;&#x518D;&#x89C1;&#xFF01;</p>
<hr>
<h2 id="&#x8D44;&#x6E90;"><a href="#&#x8D44;&#x6E90;" class="headerlink" title="&#x8D44;&#x6E90;"></a>&#x8D44;&#x6E90;</h2><h3 id="&#x4EE3;&#x7801;"><a href="#&#x4EE3;&#x7801;" class="headerlink" title="&#x4EE3;&#x7801;"></a>&#x4EE3;&#x7801;</h3><p><a href="/external_links/80ff9e993b278e4930dfbe6a51327f7f.html" target="blank" rel="noopener">GitHub</a></p>
<h3 id="B&#x7AD9;"><a href="#B&#x7AD9;" class="headerlink" title="B&#x7AD9;"></a>B&#x7AD9;</h3><p><a href="/external_links/29c773791014b1f2227490b19eb12fd9.html" target="blank" rel="noopener">&#x75DB;&#x5165;&#x723D;&#x51FA; HTTP/2&#xFF1A;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;1</a></p>
<h3 id="&#x6CB9;&#x817B;&#x7684;&#x7BA1;&#x5B50;"><a href="#&#x6CB9;&#x817B;&#x7684;&#x7BA1;&#x5B50;" class="headerlink" title="&#x6CB9;&#x817B;&#x7684;&#x7BA1;&#x5B50;"></a>&#x6CB9;&#x817B;&#x7684;&#x7BA1;&#x5B50;</h3><p><a href="/external_links/cbc3f67d19b13928b2d712bc483f5a69.html" target="blank" rel="noopener">&#x75DB;&#x5165;&#x723D;&#x51FA; HTTP/2&#xFF1A;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;1</a></p>
<h3 id="&#x6587;&#x7AE0;"><a href="#&#x6587;&#x7AE0;" class="headerlink" title="&#x6587;&#x7AE0;"></a>&#x6587;&#x7AE0;</h3><p><a href="https://dev.newban.cn/6844903511495294990">&#x4E0A;&#x671F;</a>  </p>
<p><a href="https://dev.newban.cn/6844903521049903111">&#x4E0B;&#x671F;</a></p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/55d28972848b59047b23bcc29632153e.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903512325750797.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903512325750797.html" itemprop="url">linux namespace and cgroup nam</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-20T12:09:21+08:00">
                2017-11-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="namespace"><a href="#namespace" class="headerlink" title="namespace"></a>namespace</h1><p>&#x53C2;&#x8003; </p>
<ul>
<li><a href="/external_links/52cfb7f4b076cadb79c6b0c73dfd7519.html" target="blank" rel="noopener">coolshell.cn/articles/17&#x2026;</a></li>
<li><a href="/external_links/6f7e00949d277ca2e4748094bdfcb062.html" target="blank" rel="noopener">coolshell.cn/articles/17&#x2026;</a></li>
<li><a href="/external_links/32ade2c59223296ac862c5167e83c4f5.html" target="blank" rel="noopener">www.infoq.com/cn/articles&#x2026;</a></li>
<li><a href="/external_links/894161647814104476c6321ec005161e.html" target="blank" rel="noopener">www.ibm.com/developerwo&#x2026;</a></li>
<li><a href="/external_links/41dd984862d502e81fc8027cdbd3806f.html" target="blank" rel="noopener">yeasy.gitbooks.io/docker_prac&#x2026;</a></li>
<li><a href="/external_links/33f559671e764e7c4d29cdce16522ad3.html" target="blank" rel="noopener">coolshell.cn/articles/17&#x2026;</a></li>
<li><a href="/external_links/85079190a8d7a7b4b6d522ae2444930f.html" target="blank" rel="noopener">www.infoq.com/cn/articles&#x2026;</a></li>
<li><a href="/external_links/9c36c04d97a63b859404cf31e4705700.html" target="blank" rel="noopener">www.infoq.com/cn/articles&#x2026;</a></li>
<li><a href="/external_links/bc9e927e63fdf6df2d1aecd320ebcea1.html" target="blank" rel="noopener">www.infoq.com/cn/articles&#x2026;</a></li>
<li><a href="/external_links/3f070f51eba2513ac3faa36fd621a86c.html" target="blank" rel="noopener">lecury.cn/linux_names&#x2026;</a></li>
<li><a href="/external_links/ae1da467693264c8d5887473e3751da4.html" target="blank" rel="noopener">lwn.net/Articles/53&#x2026;</a></li>
<li><a href="/external_links/33f559671e764e7c4d29cdce16522ad3.html" target="blank" rel="noopener">coolshell.cn/articles/17&#x2026;</a></li>
<li><a href="/external_links/208774bdb769bbd4aa0df7ff5de66e47.html" target="blank" rel="noopener">www.cnblogs.com/caoxiaojian&#x2026;</a></li>
<li><a href="/external_links/9a5d1897eb6ddef90281a5d0877d5610.html" target="blank" rel="noopener">blog.csdn.net/zhangyifei2&#x2026;</a></li>
</ul>
<h2 id="&#x7B80;&#x4ECB;"><a href="#&#x7B80;&#x4ECB;" class="headerlink" title="&#x7B80;&#x4ECB;"></a>&#x7B80;&#x4ECB;</h2><p>Linux Namespace&#x662F;Linux&#x63D0;&#x4F9B;&#x7684;&#x4E00;&#x79CD;&#x5185;&#x6838;&#x7EA7;&#x522B;&#x73AF;&#x5883;&#x9694;&#x79BB;&#x7684;&#x65B9;&#x6CD5;&#x3002;<br>&#x63D0;&#x4F9B;&#x4E86;&#x5BF9;UTS&#x3001;IPC&#x3001;mount&#x3001;PID&#x3001;network&#x3001;User&#x7B49;&#x7684;&#x9694;&#x79BB;&#x673A;&#x5236;&#x3002;</p>
<h3 id="&#x5206;&#x7C7B;"><a href="#&#x5206;&#x7C7B;" class="headerlink" title="&#x5206;&#x7C7B;"></a>&#x5206;&#x7C7B;</h3><table>
<thead>
<tr>
<th></th>
<th>&#x5206;&#x7C7B;</th>
<th>&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x53C2;&#x6570;</th>
<th>&#x76F8;&#x5173;&#x5185;&#x6838;&#x7248;&#x672C;</th>
<th>&#x9694;&#x79BB;&#x5185;&#x5BB9;</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td>Mount namespaces</td>
<td>CLONE_NEWNS</td>
<td>Linux 2.4.19</td>
<td>&#x6302;&#x8F7D;&#x70B9;&#xFF08;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF09;</td>
</tr>
<tr>
<td></td>
<td>UTS namespaces</td>
<td>CLONE_NEWUTS</td>
<td>Linux 2.6.19</td>
<td>&#x4E3B;&#x673A;&#x540D;&#x4E0E;&#x57DF;&#x540D;,&#x5F71;&#x54CD;uname(hostname, domainname)</td>
</tr>
<tr>
<td></td>
<td>IPC namespaces</td>
<td>CLONE_NEWIPC</td>
<td>Linux 2.6.19</td>
<td>&#x4FE1;&#x53F7;&#x91CF;&#x3001;&#x6D88;&#x606F;&#x961F;&#x5217;&#x548C;&#x5171;&#x4EAB;&#x5185;&#x5B58;, inter-process communication&#xFF0C;&#x6709;&#x5168;&#x5C40;id</td>
</tr>
<tr>
<td></td>
<td>PID namespaces</td>
<td>CLONE_NEWPID</td>
<td>Linux 2.6.24</td>
<td>&#x8FDB;&#x7A0B;&#x7F16;&#x53F7;</td>
</tr>
<tr>
<td></td>
<td>Network namespaces</td>
<td>CLONE_NEWNET</td>
<td>&#x59CB;&#x4E8E;Linux 2.6.24 &#x5B8C;&#x6210;&#x4E8E; Linux 2.6.29</td>
<td>&#x7F51;&#x7EDC;&#x8BBE;&#x5907;&#x3001;&#x7F51;&#x7EDC;&#x6808;&#x3001;&#x7AEF;&#x53E3;&#x7B49;&#x7B49;</td>
</tr>
<tr>
<td></td>
<td>User namespaces</td>
<td>CLONE_NEWUSER</td>
<td>&#x59CB;&#x4E8E; Linux 2.6.23 &#x5B8C;&#x6210;&#x4E8E; Linux 3.8)</td>
<td>&#x7528;&#x6237;&#x548C;&#x7528;&#x6237;&#x7EC4;</td>
</tr>
</tbody></table>
<h3 id="&#x4E09;&#x4E2A;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;"><a href="#&#x4E09;&#x4E2A;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;" class="headerlink" title="&#x4E09;&#x4E2A;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;"></a>&#x4E09;&#x4E2A;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;</h3><table>
<thead>
<tr>
<th>&#x8C03;&#x7528;</th>
<th>&#x4F5C;&#x7528;</th>
</tr>
</thead>
<tbody><tr>
<td>clone()</td>
<td>&#x5B9E;&#x73B0;&#x7EBF;&#x7A0B;&#x7684;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#xFF0C;&#x7528;&#x6765;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x8FDB;&#x7A0B;&#xFF0C;&#x5E76;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8BBE;&#x8BA1;&#x4E0A;&#x8FF0;&#x53C2;&#x6570;&#x8FBE;&#x5230;&#x9694;&#x79BB;&#x3002;</td>
</tr>
<tr>
<td>unshare()</td>
<td>&#x4F7F;&#x67D0;&#x8FDB;&#x7A0B;&#x8131;&#x79BB;&#x67D0;&#x4E2A;namespace</td>
</tr>
<tr>
<td>setns()</td>
<td>&#x628A;&#x67D0;&#x8FDB;&#x7A0B;&#x52A0;&#x5165;&#x5230;&#x67D0;&#x4E2A;namespace</td>
</tr>
</tbody></table>
<h2 id="&#x8BE6;&#x89E3;"><a href="#&#x8BE6;&#x89E3;" class="headerlink" title="&#x8BE6;&#x89E3;"></a>&#x8BE6;&#x89E3;</h2><p>&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;#define _GNU_SOURCE</span><br><span class="line">#include &lt;sys/types.h&gt;</span><br><span class="line">#include &lt;sys/wait.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;sched.h&gt;</span><br><span class="line">#include &lt;signal.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line"></span><br><span class="line">/* &#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x7ED9; clone &#x7528;&#x7684;&#x6808;&#xFF0C;&#x6808;&#x5927;&#x5C0F;1M */</span><br><span class="line">#define STACK_SIZE (1024 * 1024)</span><br><span class="line">static char container_stack[STACK_SIZE];</span><br><span class="line"></span><br><span class="line">char* const container_args[] = {</span><br><span class="line">    &quot;/bin/bash&quot;,</span><br><span class="line">    NULL</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">int container_main(void* arg)</span><br><span class="line">{</span><br><span class="line">    printf(&quot;Container - inside the container!\n&quot;);</span><br><span class="line">    /* &#x76F4;&#x63A5;&#x6267;&#x884C;&#x4E00;&#x4E2A;shell&#xFF0C;&#x4EE5;&#x4FBF;&#x6211;&#x4EEC;&#x89C2;&#x5BDF;&#x8FD9;&#x4E2A;&#x8FDB;&#x7A0B;&#x7A7A;&#x95F4;&#x91CC;&#x7684;&#x8D44;&#x6E90;&#x662F;&#x5426;&#x88AB;&#x9694;&#x79BB;&#x4E86; */</span><br><span class="line">    sethostname(&quot;container&quot;,10); /* &#x8BBE;&#x7F6E;hostname */</span><br><span class="line"></span><br><span class="line">    execv(container_args[0], container_args); </span><br><span class="line">    printf(&quot;Something&apos;s wrong!\n&quot;);</span><br><span class="line">    return 1;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">{</span><br><span class="line">    printf(&quot;Parent - start a container!\n&quot;);</span><br><span class="line">    /* &#x8C03;&#x7528;clone&#x51FD;&#x6570;&#xFF0C;&#x5176;&#x4E2D;&#x4F20;&#x51FA;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x6808;&#x7A7A;&#x95F4;&#x7684;&#xFF08;&#x4E3A;&#x4EC0;&#x4E48;&#x4F20;&#x5C3E;&#x6307;&#x9488;&#xFF0C;&#x56E0;&#x4E3A;&#x6808;&#x662F;&#x53CD;&#x7740;&#x7684;&#xFF09; */</span><br><span class="line">    // int container_pid = clone(container_main, container_stack+STACK_SIZE, SIGCHLD, NULL);</span><br><span class="line">    // int container_pid = clone(container_main, container_stack+STACK_SIZE, </span><br><span class="line">            CLONE_NEWUTS | SIGCHLD, NULL); /*&#x542F;&#x7528;CLONE_NEWUTS Namespace&#x9694;&#x79BB; */</span><br><span class="line">    int container_pid = clone(container_main, container_stack+STACK_SIZE, </span><br><span class="line">            CLONE_NEWUTS | CLONE_NEWIPC | SIGCHLD, NULL);</span><br><span class="line"></span><br><span class="line">    /* &#x7B49;&#x5F85;&#x5B50;&#x8FDB;&#x7A0B;&#x7ED3;&#x675F; */</span><br><span class="line">    waitpid(container_pid, NULL, 0);</span><br><span class="line">    printf(&quot;Parent - container stopped!\n&quot;);</span><br><span class="line">    return 0;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="UTS-Namespace"><a href="#UTS-Namespace" class="headerlink" title="UTS Namespace"></a>UTS Namespace</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&#x52A0;&#x5165; </span><br><span class="line">sethostname(&quot;container&quot;,10); /* &#x8BBE;&#x7F6E;hostname */</span><br><span class="line"></span><br><span class="line">int container_pid = clone(container_main, container_stack+STACK_SIZE, </span><br><span class="line">            CLONE_NEWUTS | SIGCHLD, NULL); /*&#x542F;&#x7528;CLONE_NEWUTS Namespace&#x9694;&#x79BB; */</span><br><span class="line"></span><br><span class="line">root@container:~/testnamespace# uname -a</span><br><span class="line">Linux container 4.4.0-96-generic #119-Ubuntu SMP Tue Sep 12 14:59:54 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="line">root@container:~/testnamespace# hostname</span><br><span class="line">container</span><br></pre></td></tr></table></figure>

<h3 id="IPC-Namespace"><a href="#IPC-Namespace" class="headerlink" title="IPC Namespace"></a>IPC Namespace</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">// &#x5982;&#x679C;&#x9694;&#x79BB;&#x4E86; ipcs -q &#x770B;&#x4E0D;&#x5230;&#x5916;&#x9762;&#x7684;&#xFF0C;&#x5426;&#x5219;&#x80FD;&#x770B;&#x5230;</span><br><span class="line"></span><br><span class="line">root@kube-master:~/testnamespace# ipcs -a</span><br><span class="line"></span><br><span class="line">------ Message Queues --------</span><br><span class="line">key        msqid      owner      perms      used-bytes   messages</span><br><span class="line">0x10d91bac 0          root       644        0            0</span><br><span class="line">0xb92f99fd 32769      root       644        0            0</span><br><span class="line">0xfcebd528 65538      root       644        0            0</span><br><span class="line"></span><br><span class="line">------ Shared Memory Segments --------</span><br><span class="line">key        shmid      owner      perms      bytes      nattch     status</span><br><span class="line">0x00000000 0          root       644        80         2</span><br><span class="line">0x00000000 32769      root       644        16384      2</span><br><span class="line">0x00000000 65538      root       644        280        2</span><br><span class="line"></span><br><span class="line">------ Semaphore Arrays --------</span><br><span class="line">key        semid      owner      perms      nsems</span><br><span class="line">0x000000a7 0          root       600        1</span><br></pre></td></tr></table></figure>

<h3 id="PID-Namespace"><a href="#PID-Namespace" class="headerlink" title="PID Namespace"></a>PID Namespace</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801; int container_pid = clone(container_main, container_stack+STACK_SIZE, </span><br><span class="line">            CLONE_NEWUTS | CLONE_NEWPID | SIGCHLD, NULL); </span><br><span class="line"></span><br><span class="line">&#x6CA1;&#x6709;&#x9694;&#x79BB;</span><br><span class="line">root@container:~/testnamespace# ps -a</span><br><span class="line">  PID TTY          TIME CMD</span><br><span class="line">10079 pts/0    00:00:00 a.out</span><br><span class="line"></span><br><span class="line">&#x9694;&#x79BB;&#x4E4B;&#x540E;</span><br><span class="line">root@container:~# echo ?</span><br><span class="line">1</span><br><span class="line"></span><br><span class="line">&#x4F46;&#x662F; ps -a&#x6CA1;&#x6709;&#x53D8;&#x5316;&#xFF0C;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;ps, top&#x8FD9;&#x4E9B;&#x547D;&#x4EE4;&#x4F1A;&#x53BB;&#x8BFB;/proc&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF0C;&#x6240;&#x4EE5;&#xFF0C;&#x56E0;&#x4E3A;/proc&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x5728;&#x7236;&#x8FDB;&#x7A0B;&#x548C;&#x5B50;&#x8FDB;&#x7A0B;&#x90FD;&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x4E9B;&#x547D;&#x4EE4;&#x663E;&#x793A;&#x7684;&#x4E1C;&#x897F;&#x90FD;&#x662F;&#x4E00;&#x6837;&#x7684;</span><br></pre></td></tr></table></figure>

<p>pid 1 &#x662F;&#x4E00;&#x4E2A;&#x7279;&#x6B8A;&#x7684;pid&#x9700;&#x8981;&#x6709;&#x8FDB;&#x7A0B;&#x76D1;&#x63A7;&#x548C;&#x8D44;&#x6E90;&#x56DE;&#x6536;&#x7684;&#x80FD;&#x529B;&#xFF0C; docker 1.13 &#x5F15;&#x5165;&#x4E86;&#x4E00;&#x4E2A; &#x2013;init &#x53C2;&#x6570;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;<br>&#x2013;init false Run an init inside the container that forwards signals and reaps processes<br>&#x53C2;&#x8003; <a href="/external_links/e22a95dc9130565e89e7f39c7cb795f0.html" target="blank" rel="noopener">blog.phusion.nl/2015/01/20/&#x2026;</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&#x279C;  ke git:(alb) &#x2717; docker run  alpine  ps</span><br><span class="line">PID   USER     TIME   COMMAND</span><br><span class="line">    1 root       0:00 ps</span><br><span class="line">&#x279C;  ke git:(alb) &#x2717; docker run --init  alpine  ps</span><br><span class="line">PID   USER     TIME   COMMAND</span><br><span class="line">    1 root       0:00 /dev/init -- ps</span><br><span class="line">    5 root       0:00 ps</span><br></pre></td></tr></table></figure>

<p>unshare()&#x548C;setns()&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x5BF9;PID Namespace&#x7684;&#x5904;&#x7406;&#x4E0D;&#x592A;&#x76F8;&#x540C;&#xFF0C;&#x5F53;unshare PID namespace&#x65F6;&#xFF0C;&#x8C03;&#x7528;&#x8FDB;&#x7A0B;&#x4F1A;&#x4E3A;&#x5B83;&#x7684;&#x5B50;&#x8FDB;&#x7A0B;&#x5206;&#x914D;&#x4E00;&#x4E2A;&#x65B0;&#x7684;PID Namespace&#xFF0C;&#x4F46;&#x662F;&#x8C03;&#x7528;&#x8FDB;&#x7A0B;&#x672C;&#x8EAB;&#x4E0D;&#x4F1A;&#x88AB;&#x79FB;&#x5230;&#x65B0;&#x7684;Namespace&#x4E2D;&#x3002;&#x800C;&#x4E14;&#x8C03;&#x7528;&#x8FDB;&#x7A0B;&#x7B2C;&#x4E00;&#x4E2A;&#x521B;&#x5EFA;&#x7684;&#x5B50;&#x8FDB;&#x7A0B;&#x5728;&#x65B0;Namespace&#x4E2D;&#x7684;PID&#x4E3A;1&#xFF0C;&#x5E76;&#x6210;&#x4E3A;&#x65B0;Namespace&#x4E2D;&#x7684;init&#x8FDB;&#x7A0B;&#x3002;&#x4E3A;&#x4EC0;&#x4E48;&#x521B;&#x5EFA;&#x5176;&#x4ED6;&#x7684;Namespace&#x65F6;unshare()&#x548C;setns()&#x4F1A;&#x76F4;&#x63A5;&#x8FDB;&#x5165;&#x65B0;&#x7684;Namespace&#xFF0C;&#x800C;&#x552F;&#x72EC;PID Namespace&#x4E0D;&#x662F;&#x5982;&#x6B64;&#x5462;&#xFF1F;&#x56E0;&#x4E3A;&#x8C03;&#x7528;getpid()&#x51FD;&#x6570;&#x5F97;&#x5230;&#x7684;PID&#x662F;&#x6839;&#x636E;&#x8C03;&#x7528;&#x8005;&#x6240;&#x5728;&#x7684;PID Namespace&#x800C;&#x51B3;&#x5B9A;&#x8FD4;&#x56DE;&#x54EA;&#x4E2A;PID&#xFF0C;&#x8FDB;&#x5165;&#x65B0;&#x7684;PID namespace&#x4F1A;&#x5BFC;&#x81F4;PID&#x4EA7;&#x751F;&#x53D8;&#x5316;&#x3002;&#x800C;&#x5BF9;&#x7528;&#x6237;&#x6001;&#x7684;&#x7A0B;&#x5E8F;&#x548C;&#x5E93;&#x51FD;&#x6570;&#x6765;&#x8BF4;&#xFF0C;&#x4ED6;&#x4EEC;&#x90FD;&#x8BA4;&#x4E3A;&#x8FDB;&#x7A0B;&#x7684;PID&#x662F;&#x4E00;&#x4E2A;&#x5E38;&#x91CF;&#xFF0C;PID&#x7684;&#x53D8;&#x5316;&#x4F1A;&#x5F15;&#x8D77;&#x8FD9;&#x4E9B;&#x8FDB;&#x7A0B;&#x5954;&#x6E83;&#x3002;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;&#x4E00;&#x65E6;&#x7A0B;&#x5E8F;&#x8FDB;&#x7A0B;&#x521B;&#x5EFA;&#x4EE5;&#x540E;&#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x7684;PID namespace&#x7684;&#x5173;&#x7CFB;&#x5C31;&#x786E;&#x5B9A;&#x4E0B;&#x6765;&#x4E86;&#xFF0C;&#x8FDB;&#x7A0B;&#x4E0D;&#x4F1A;&#x53D8;&#x66F4;&#x4ED6;&#x4EEC;&#x5BF9;&#x5E94;&#x7684;PID namespace&#x3002;</p>
<h3 id="Mount-Namespace"><a href="#Mount-Namespace" class="headerlink" title="Mount Namespace"></a>Mount Namespace</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;#include &lt;stdlib.h&gt;</span><br><span class="line">system(&quot;mount -t proc proc /proc&quot;);</span><br><span class="line"> /* &#x542F;&#x7528;Mount Namespace - &#x589E;&#x52A0;CLONE_NEWNS&#x53C2;&#x6570; */</span><br><span class="line">int container_pid = clone(container_main, container_stack+STACK_SIZE, </span><br><span class="line">        CLONE_NEWUTS | CLONE_NEWPID | CLONE_NEWNS | SIGCHLD, NULL);</span><br><span class="line"></span><br><span class="line">// &#x8FD9;&#x65F6;&#x5019; ps&#x5C31;&#x5E72;&#x51C0;&#x591A;&#x4E86;</span><br><span class="line">root@vm-master:~/testnamespace# ps -aux</span><br><span class="line">USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">root         1  0.0  0.0  20036  3868 pts/1    S    12:24   0:00 /bin/bash</span><br><span class="line">root        15  0.0  0.0  36084  3228 pts/1    R+   12:24   0:00 ps -aux</span><br></pre></td></tr></table></figure>

<p>&#x5173;&#x4E8E;mount&#x547D;&#x4EE4;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&#x6A21;&#x4EFF;Docker&#x7684;Mount Namespace&#x3002;</span><br><span class="line">&#x5148;&#x8981;&#x505A;&#x4E00;&#x4E2A;rootfs&#x6587;&#x4EF6;&#x5939;</span><br><span class="line">hchen@ubuntu:~/rootfs$ ls</span><br><span class="line">bin  dev  etc  home  lib  lib64  mnt  opt  proc  root  run  sbin  sys  tmp  usr  var</span><br><span class="line"></span><br><span class="line">// &#x62F7;&#x8D1D;&#x5FC5;&#x8981;&#x7684;&#x547D;&#x4EE4;</span><br><span class="line">hchen@ubuntu:~/rootfs$ ls ./bin ./usr/bin</span><br><span class="line"></span><br><span class="line">./bin:</span><br><span class="line">bash   chown  gzip      less  mount       netstat  rm     tabs  tee      top       tty</span><br><span class="line">cat    cp     hostname  ln    mountpoint  ping     sed    tac   test     touch     umount</span><br><span class="line">chgrp  echo   ip        ls    mv          ps       sh     tail  timeout  tr        uname</span><br><span class="line">chmod  grep   kill      more  nc          pwd      sleep  tar   toe      truncate  which</span><br><span class="line"></span><br><span class="line">./usr/bin:</span><br><span class="line">awk  env  groups  head  id  mesg  sort  strace  tail  top  uniq  vi  wc  xargs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// &#x62F7;&#x8D1D;&#x547D;&#x4EE4;&#x8981;&#x7528;&#x7684;sso</span><br><span class="line">hchen@ubuntu:~/rootfs$ ls ./lib64 ./lib/x86_64-linux-gnu/</span><br><span class="line"></span><br><span class="line">./lib64:</span><br><span class="line">ld-linux-x86-64.so.2</span><br><span class="line"></span><br><span class="line">./lib/x86_64-linux-gnu/:</span><br><span class="line">libacl.so.1      libmemusage.so         libnss_files-2.19.so    libpython3.4m.so.1</span><br><span class="line">libacl.so.1.1.0  libmount.so.1          libnss_files.so.2       libpython3.4m.so.1.0</span><br><span class="line">libattr.so.1     libmount.so.1.1.0      libnss_hesiod-2.19.so   libresolv-2.19.so</span><br><span class="line">libblkid.so.1    libm.so.6              libnss_hesiod.so.2      libresolv.so.2</span><br><span class="line">libc-2.19.so     libncurses.so.5        libnss_nis-2.19.so      libselinux.so.1</span><br><span class="line">libcap.a         libncurses.so.5.9      libnss_nisplus-2.19.so  libtinfo.so.5</span><br><span class="line">libcap.so        libncursesw.so.5       libnss_nisplus.so.2     libtinfo.so.5.9</span><br><span class="line">libcap.so.2      libncursesw.so.5.9     libnss_nis.so.2         libutil-2.19.so</span><br><span class="line">libcap.so.2.24   libnsl-2.19.so         libpcre.so.3            libutil.so.1</span><br><span class="line">libc.so.6        libnsl.so.1            libprocps.so.3          libuuid.so.1</span><br><span class="line">libdl-2.19.so    libnss_compat-2.19.so  libpthread-2.19.so      libz.so.1</span><br><span class="line">libdl.so.2       libnss_compat.so.2     libpthread.so.0</span><br><span class="line">libgpm.so.2      libnss_dns-2.19.so     libpython2.7.so.1</span><br><span class="line">libm-2.19.so     libnss_dns.so.2        libpython2.7.so.1.0</span><br><span class="line"></span><br><span class="line">// &#x62F7;&#x8D1D;&#x5FC5;&#x8981;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;</span><br><span class="line">hchen@ubuntu:~/rootfs$ ls ./etc</span><br><span class="line">bash.bashrc  group  hostname  hosts  ld.so.cache  nsswitch.conf  passwd  profile  </span><br><span class="line">resolv.conf  shadow</span><br><span class="line"></span><br><span class="line">// &#x4F9B;&#x6302;&#x8F7D;&#x7528;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;</span><br><span class="line">hchen@ubuntu:~$ ls ./conf</span><br><span class="line">hostname     hosts     resolv.conf</span><br><span class="line"></span><br><span class="line">#define _GNU_SOURCE</span><br><span class="line">#include &lt;sys/types.h&gt;</span><br><span class="line">#include &lt;sys/wait.h&gt;</span><br><span class="line">#include &lt;sys/mount.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;sched.h&gt;</span><br><span class="line">#include &lt;signal.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line"></span><br><span class="line">#define STACK_SIZE (1024 * 1024)</span><br><span class="line"></span><br><span class="line">static char container_stack[STACK_SIZE];</span><br><span class="line">char* const container_args[] = {</span><br><span class="line">    &quot;/bin/bash&quot;,</span><br><span class="line">    &quot;-l&quot;,</span><br><span class="line">    NULL</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">int container_main(void* arg)</span><br><span class="line">{</span><br><span class="line">    printf(&quot;Container [%5d] - inside the container!\n&quot;, getpid());</span><br><span class="line"></span><br><span class="line">    //set hostname</span><br><span class="line">    sethostname(&quot;container&quot;,10);</span><br><span class="line"></span><br><span class="line">    //remount &quot;/proc&quot; to make sure the &quot;top&quot; and &quot;ps&quot; show container&apos;s information</span><br><span class="line">    if (mount(&quot;proc&quot;, &quot;rootfs/proc&quot;, &quot;proc&quot;, 0, NULL) !=0 ) {</span><br><span class="line">        perror(&quot;proc&quot;);</span><br><span class="line">    }</span><br><span class="line">    if (mount(&quot;sysfs&quot;, &quot;rootfs/sys&quot;, &quot;sysfs&quot;, 0, NULL)!=0) {</span><br><span class="line">        perror(&quot;sys&quot;);</span><br><span class="line">    }</span><br><span class="line">    if (mount(&quot;none&quot;, &quot;rootfs/tmp&quot;, &quot;tmpfs&quot;, 0, NULL)!=0) {</span><br><span class="line">        perror(&quot;tmp&quot;);</span><br><span class="line">    }</span><br><span class="line">    if (mount(&quot;udev&quot;, &quot;rootfs/dev&quot;, &quot;devtmpfs&quot;, 0, NULL)!=0) {</span><br><span class="line">        perror(&quot;dev&quot;);</span><br><span class="line">    }</span><br><span class="line">    if (mount(&quot;devpts&quot;, &quot;rootfs/dev/pts&quot;, &quot;devpts&quot;, 0, NULL)!=0) {</span><br><span class="line">        perror(&quot;dev/pts&quot;);</span><br><span class="line">    }</span><br><span class="line">    if (mount(&quot;shm&quot;, &quot;rootfs/dev/shm&quot;, &quot;tmpfs&quot;, 0, NULL)!=0) {</span><br><span class="line">        perror(&quot;dev/shm&quot;);</span><br><span class="line">    }</span><br><span class="line">    if (mount(&quot;tmpfs&quot;, &quot;rootfs/run&quot;, &quot;tmpfs&quot;, 0, NULL)!=0) {</span><br><span class="line">        perror(&quot;run&quot;);</span><br><span class="line">    }</span><br><span class="line">    /* </span><br><span class="line">     * &#x6A21;&#x4EFF;Docker&#x7684;&#x4ECE;&#x5916;&#x5411;&#x5BB9;&#x5668;&#x91CC;mount&#x76F8;&#x5173;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6; </span><br><span class="line">     * &#x4F60;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#xFF1A;/var/lib/docker/containers/&lt;container_id&gt;/&#x76EE;&#x5F55;&#xFF0C;</span><br><span class="line">     * &#x4F60;&#x4F1A;&#x770B;&#x5230;docker&#x7684;&#x8FD9;&#x4E9B;&#x6587;&#x4EF6;&#x7684;&#x3002;</span><br><span class="line">     */</span><br><span class="line">    if (mount(&quot;conf/hosts&quot;, &quot;rootfs/etc/hosts&quot;, &quot;none&quot;, MS_BIND, NULL)!=0 ||</span><br><span class="line">          mount(&quot;conf/hostname&quot;, &quot;rootfs/etc/hostname&quot;, &quot;none&quot;, MS_BIND, NULL)!=0 ||</span><br><span class="line">          mount(&quot;conf/resolv.conf&quot;, &quot;rootfs/etc/resolv.conf&quot;, &quot;none&quot;, MS_BIND, NULL)!=0 ) {</span><br><span class="line">        perror(&quot;conf&quot;);</span><br><span class="line">    }</span><br><span class="line">    /* &#x6A21;&#x4EFF;docker run&#x547D;&#x4EE4;&#x4E2D;&#x7684; -v, --volume=[] &#x53C2;&#x6570;&#x5E72;&#x7684;&#x4E8B; */</span><br><span class="line">    if (mount(&quot;/tmp/t1&quot;, &quot;rootfs/mnt&quot;, &quot;none&quot;, MS_BIND, NULL)!=0) {</span><br><span class="line">        perror(&quot;mnt&quot;);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /* chroot &#x9694;&#x79BB;&#x76EE;&#x5F55; */</span><br><span class="line">    if ( chdir(&quot;./rootfs&quot;) != 0 || chroot(&quot;./&quot;) != 0 ){</span><br><span class="line">        perror(&quot;chdir/chroot&quot;);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    execv(container_args[0], container_args);</span><br><span class="line">    perror(&quot;exec&quot;);</span><br><span class="line">    printf(&quot;Something&apos;s wrong!\n&quot;);</span><br><span class="line">    return 1;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">{</span><br><span class="line">    printf(&quot;Parent [%5d] - start a container!\n&quot;, getpid());</span><br><span class="line">    int container_pid = clone(container_main, container_stack+STACK_SIZE, </span><br><span class="line">            CLONE_NEWUTS | CLONE_NEWIPC | CLONE_NEWPID | CLONE_NEWNS | SIGCHLD, NULL);</span><br><span class="line">    waitpid(container_pid, NULL, 0);</span><br><span class="line">    printf(&quot;Parent - container stopped!\n&quot;);</span><br><span class="line">    return 0;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8FDB;&#x7A0B;&#x5728;&#x521B;&#x5EFA;mount namespace&#x65F6;&#xFF0C;&#x4F1A;&#x628A;&#x5F53;&#x524D;&#x7684;&#x6587;&#x4EF6;&#x7ED3;&#x6784;&#x590D;&#x5236;&#x7ED9;&#x65B0;&#x7684;namespace&#x3002;&#x65B0;namespace&#x4E2D;&#x7684;&#x6240;&#x6709;mount&#x64CD;&#x4F5C;&#x90FD;&#x53EA;&#x5F71;&#x54CD;&#x81EA;&#x8EAB;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF0C;&#x800C;&#x5BF9;&#x5916;&#x754C;&#x4E0D;&#x4F1A;&#x4EA7;&#x751F;&#x4EFB;&#x4F55;&#x5F71;&#x54CD;&#x3002;&#x8FD9;&#x6837;&#x505A;&#x975E;&#x5E38;&#x4E25;&#x683C;&#x5730;&#x5B9E;&#x73B0;&#x4E86;&#x9694;&#x79BB;&#xFF0C;&#x4F46;&#x662F;&#x67D0;&#x4E9B;&#x60C5;&#x51B5;&#x53EF;&#x80FD;&#x5E76;&#x4E0D;&#x9002;&#x7528;&#x3002;&#x6BD4;&#x5982;&#x7236;&#x8282;&#x70B9;namespace&#x4E2D;&#x7684;&#x8FDB;&#x7A0B;&#x6302;&#x8F7D;&#x4E86;&#x4E00;&#x5F20;CD-ROM&#xFF0C;&#x8FD9;&#x65F6;&#x5B50;&#x8282;&#x70B9;namespace&#x62F7;&#x8D1D;&#x7684;&#x76EE;&#x5F55;&#x7ED3;&#x6784;&#x5C31;&#x65E0;&#x6CD5;&#x81EA;&#x52A8;&#x6302;&#x8F7D;&#x4E0A;&#x8FD9;&#x5F20;CD-ROM&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x79CD;&#x64CD;&#x4F5C;&#x4F1A;&#x5F71;&#x54CD;&#x5230;&#x7236;&#x8282;&#x70B9;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x3002;</p>
<p>2006 &#x5E74;&#x5F15;&#x5165;&#x7684;&#x6302;&#x8F7D;&#x4F20;&#x64AD;&#xFF08;mount propagation&#xFF09;&#x89E3;&#x51B3;&#x4E86;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x6302;&#x8F7D;&#x4F20;&#x64AD;&#x5B9A;&#x4E49;&#x4E86;&#x6302;&#x8F7D;&#x5BF9;&#x8C61;&#xFF08;mount object&#xFF09;&#x4E4B;&#x95F4;&#x7684;&#x5173;&#x7CFB;&#xFF0C;&#x7CFB;&#x7EDF;&#x7528;&#x8FD9;&#x4E9B;&#x5173;&#x7CFB;&#x51B3;&#x5B9A;&#x4EFB;&#x4F55;&#x6302;&#x8F7D;&#x5BF9;&#x8C61;&#x4E2D;&#x7684;&#x6302;&#x8F7D;&#x4E8B;&#x4EF6;&#x5982;&#x4F55;&#x4F20;&#x64AD;&#x5230;&#x5176;&#x4ED6;&#x6302;&#x8F7D;&#x5BF9;&#x8C61;&#xFF08;&#x53C2;&#x8003;&#x81EA;&#xFF1A;<a href="/external_links/23fe52d97ce3b5bab634c8c365b055da.html" target="blank" rel="noopener">www.ibm.com/developerwo&#x2026;</a></p>
<p>&#x8FDB;&#x7A0B;&#x5728;&#x521B;&#x5EFA;Mount Namespace&#x65F6;&#xFF0C;&#x4F1A;&#x628A;&#x5F53;&#x524D;&#x7684;&#x6587;&#x4EF6;&#x7ED3;&#x6784;&#x590D;&#x5236;&#x7ED9;&#x65B0;&#x7684;Namespace&#xFF0C;&#x65B0;&#x7684;Namespace&#x4E2D;&#x7684;&#x6240;&#x6709;mount&#x64CD;&#x4F5C;&#x4EC5;&#x5F71;&#x54CD;&#x81EA;&#x8EAB;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x3002;&#x4F46;&#x968F;&#x7740;&#x5F15;&#x5165;&#x6302;&#x8F7D;&#x4F20;&#x64AD;&#x7684;&#x7279;&#x6027;&#xFF0C;Mount Namespace&#x53D8;&#x5F97;&#x5E76;&#x4E0D;&#x662F;&#x5B8C;&#x5168;&#x610F;&#x4E49;&#x4E0A;&#x7684;&#x8D44;&#x6E90;&#x9694;&#x79BB;&#xFF0C;&#x8FD9;&#x79CD;&#x4F20;&#x64AD;&#x7279;&#x6027;&#x4F7F;&#x5F97;&#x591A;Mount Namespace&#x4E4B;&#x95F4;&#x7684;&#x6302;&#x8F7D;&#x4E8B;&#x4EF6;&#x53EF;&#x4EE5;&#x76F8;&#x4E92;&#x5F71;&#x54CD;&#x3002;</p>
<p>&#x6302;&#x8F7D;&#x4F20;&#x64AD;&#x5B9A;&#x4E49;&#x4E86;&#x6302;&#x8F7D;&#x5BF9;&#x8C61;&#x4E4B;&#x95F4;&#x7684;&#x5173;&#x7CFB;&#xFF0C;&#x7CFB;&#x7EDF;&#x5229;&#x7528;&#x8FD9;&#x4E9B;&#x5173;&#x7CFB;&#x6765;&#x51B3;&#x5B9A;&#x6302;&#x8F7D;&#x5BF9;&#x8C61;&#x4E2D;&#x7684;&#x6302;&#x8F7D;&#x4E8B;&#x4EF6;&#x5BF9;&#x5176;&#x4ED6;&#x6302;&#x8F7D;&#x5BF9;&#x8C61;&#x7684;&#x5F71;&#x54CD;&#x3002;&#x5176;&#x4E2D;&#x6302;&#x8F7D;&#x5BF9;&#x8C61;&#x4E4B;&#x95F4;&#x7684;&#x5173;&#x7CFB;&#x63CF;&#x8FF0;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li>&#x5171;&#x4EAB;&#x5173;&#x7CFB;(MS_SHARED)&#xFF1A;&#x4E00;&#x4E2A;&#x6302;&#x8F7D;&#x5BF9;&#x8C61;&#x7684;&#x6302;&#x8F7D;&#x4E8B;&#x4EF6;&#x4F1A;&#x8DE8;Namespace&#x5171;&#x4EAB;&#x5230;&#x5176;&#x4ED6;&#x6302;&#x8F7D;&#x5BF9;&#x8C61;&#x3002;</li>
<li>&#x4ECE;&#x5C5E;&#x5173;&#x7CFB;(MS_SLAVE): &#x4F20;&#x64AD;&#x7684;&#x65B9;&#x5411;&#x662F;&#x5355;&#x5411;&#x7684;&#xFF0C;&#x5373;&#x53EA;&#x80FD;&#x4ECE;Master&#x4F20;&#x64AD;&#x5230;Slave&#x65B9;&#x5411;&#x3002;</li>
<li>&#x79C1;&#x6709;&#x5173;&#x7CFB;(MS_PRIVATE): &#x4E0D;&#x540C;Namespace&#x7684;&#x6302;&#x8F7D;&#x4E8B;&#x4EF6;&#x662F;&#x4E92;&#x4E0D;&#x5F71;&#x54CD;&#x7684;(&#x9ED8;&#x8BA4;&#x9009;&#x9879;)&#x3002;</li>
<li>&#x4E0D;&#x53EF;&#x7ED1;&#x5B9A;&#x5173;&#x7CFB;(MS_UNBINDABLE): &#x4E00;&#x4E2A;&#x4E0D;&#x53EF;&#x7ED1;&#x5B9A;&#x7684;&#x79C1;&#x6709;&#x6302;&#x8F7D;&#xFF0C;&#x4E0E;&#x79C1;&#x6709;&#x6302;&#x8F7D;&#x7C7B;&#x4F3C;&#xFF0C;&#x4F46;&#x662F;&#x4E0D;&#x80FD;&#x6267;&#x884C;&#x6302;&#x8F7D;&#x64CD;&#x4F5C;</li>
</ul>
<p>&#x4E00;&#x4E2A;&#x6302;&#x8F7D;&#x72B6;&#x6001;&#x53EF;&#x80FD;&#x4E3A;&#x5982;&#x4E0B;&#x7684;&#x5176;&#x4E2D;&#x4E00;&#x79CD;&#xFF1A;</p>
<ul>
<li>&#x5171;&#x4EAB;&#x6302;&#x8F7D;&#xFF08;shared&#xFF09;</li>
<li>&#x4ECE;&#x5C5E;&#x6302;&#x8F7D;&#xFF08;slave&#xFF09;</li>
<li>&#x5171;&#x4EAB;/&#x4ECE;&#x5C5E;&#x6302;&#x8F7D;&#xFF08;shared and slave&#xFF09;</li>
<li>&#x79C1;&#x6709;&#x6302;&#x8F7D;&#xFF08;private&#xFF09;</li>
<li>&#x4E0D;&#x53EF;&#x7ED1;&#x5B9A;&#x6302;&#x8F7D;&#xFF08;unbindable&#xFF09;</li>
</ul>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/fe581ad351c2a796148ed49b5d19f7f995b911733db2d26ca1e54aece5681100" alt="image"></p>
<p>image</p>
<p>&#x6302;&#x8F7D;&#x7684;&#x8FC7;&#x7A0B;&#x662F;&#x901A;&#x8FC7;mount&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x5B8C;&#x6210;&#x7684;&#xFF0C;&#x5B83;&#x6709;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#xFF1A;&#x4E00;&#x4E2A;&#x662F;&#x5DF2;&#x5B58;&#x5728;&#x7684;&#x666E;&#x901A;&#x6587;&#x4EF6;&#x540D;&#xFF0C;&#x4E00;&#x4E2A;&#x662F;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8BBF;&#x95EE;&#x7684;&#x7279;&#x6B8A;&#x6587;&#x4EF6;&#xFF0C;&#x4E00;&#x4E2A;&#x662F;&#x7279;&#x6B8A;&#x6587;&#x4EF6;&#x7684;&#x540D;&#x5B57;&#x3002;&#x8FD9;&#x4E2A;&#x7279;&#x6B8A;&#x6587;&#x4EF6;&#x4E00;&#x822C;&#x7528;&#x6765;&#x5173;&#x8054;&#x4E00;&#x4E9B;&#x5B58;&#x50A8;&#x5377;&#xFF0C;&#x8FD9;&#x4E2A;&#x5B58;&#x50A8;&#x5377;&#x53EF;&#x4EE5;&#x5305;&#x542B;&#x81EA;&#x5DF1;&#x7684;&#x76EE;&#x5F55;&#x5C42;&#x7EA7;&#x548C;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x7ED3;&#x6784;&#x3002;mount&#x6240;&#x8FBE;&#x5230;&#x7684;&#x6548;&#x679C;&#x662F;&#xFF1A;&#x50CF;&#x8BBF;&#x95EE;&#x4E00;&#x4E2A;&#x666E;&#x901A;&#x7684;&#x6587;&#x4EF6;&#x4E00;&#x6837;&#x8BBF;&#x95EE;&#x4F4D;&#x4E8E;&#x5176;&#x4ED6;&#x8BBE;&#x5907;&#x4E0A;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x7684;&#x6839;&#x76EE;&#x5F55;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5C06;&#x8BE5;&#x8BBE;&#x5907;&#x4E0A;&#x76EE;&#x5F55;&#x7684;&#x6839;&#x8282;&#x70B9;&#x6302;&#x5230;&#x4E86;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x7684;&#x9875;&#x8282;&#x70B9;&#x4E0A;&#xFF0C;&#x8FBE;&#x5230;&#x4E86;&#x7ED9;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x6269;&#x5145;&#x5BB9;&#x91CF;&#x7684;&#x76EE;&#x7684;&#x3002;</p>
<p>&#x53EF;&#x4EE5;&#x901A;&#x8FC7;/proc&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x67E5;&#x770B;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x7684;&#x6302;&#x8F7D;&#x4FE1;&#x606F;&#xFF0C;&#x5177;&#x4F53;&#x505A;&#x6CD5;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;cat /proc/$pid/mountinfo</span><br></pre></td></tr></table></figure>

<p><code>&#x7ED1;&#x5B9A;&#x6302;&#x8F7D;</code>&#x7684;&#x5F15;&#x5165;&#x4F7F;&#x5F97;mount&#x7684;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x4E0D;&#x4E00;&#x5B9A;&#x8981;&#x662F;&#x4E00;&#x4E2A;&#x7279;&#x6B8A;&#x6587;&#x4EF6;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x662F;&#x8BE5;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x4E0A;&#x7684;&#x4E00;&#x4E2A;&#x666E;&#x901A;&#x6587;&#x4EF6;&#x76EE;&#x5F55;&#x3002;Linux&#x4E2D;&#x7ED1;&#x5B9A;&#x6302;&#x8F7D;&#x7684;&#x7528;&#x6CD5;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;mount --bind /home/work /home/qiniu  </span><br><span class="line">mount -o bind /home/work /home/qiniu</span><br></pre></td></tr></table></figure>

<h3 id="User-Namespace"><a href="#User-Namespace" class="headerlink" title="User Namespace"></a>User Namespace</h3><p>&#x8981;&#x628A;&#x5BB9;&#x5668;&#x4E2D;&#x7684;uid&#x548C;&#x771F;&#x5B9E;&#x7CFB;&#x7EDF;&#x7684;uid&#x7ED9;&#x6620;&#x5C04;&#x5728;&#x4E00;&#x8D77;&#xFF0C;&#x9700;&#x8981;&#x4FEE;&#x6539; /proc//uid_map &#x548C; /proc//gid_map &#x8FD9;&#x4E24;&#x4E2A;&#x6587;&#x4EF6;&#x3002;&#x8FD9;&#x4E24;&#x4E2A;&#x6587;&#x4EF6;&#x7684;&#x683C;&#x5F0F;&#x4E3A;&#xFF1A;<br><code>ID-inside-ns ID-outside-ns length</code></p>
<ul>
<li>&#x7B2C;&#x4E00;&#x4E2A;&#x5B57;&#x6BB5;ID-inside-ns&#x8868;&#x793A;&#x5728;&#x5BB9;&#x5668;&#x663E;&#x793A;&#x7684;UID&#x6216;GID&#xFF0C;</li>
<li>&#x7B2C;&#x4E8C;&#x4E2A;&#x5B57;&#x6BB5;ID-outside-ns&#x8868;&#x793A;&#x5BB9;&#x5668;&#x5916;&#x6620;&#x5C04;&#x7684;&#x771F;&#x5B9E;&#x7684;UID&#x6216;GID&#x3002;</li>
<li>&#x7B2C;&#x4E09;&#x4E2A;&#x5B57;&#x6BB5;&#x8868;&#x793A;&#x6620;&#x5C04;&#x7684;&#x8303;&#x56F4;&#xFF0C;&#x4E00;&#x822C;&#x586B;1&#xFF0C;&#x8868;&#x793A;&#x4E00;&#x4E00;&#x5BF9;&#x5E94;&#x3002;</li>
</ul>
<p>User namespace&#x4E3B;&#x8981;&#x9694;&#x79BB;&#x4E86;&#x5B89;&#x5168;&#x76F8;&#x5173;&#x7684;&#x6807;&#x8BC6;&#x7B26;&#xFF08;identifiers&#xFF09;&#x548C;&#x5C5E;&#x6027;&#xFF08;attributes&#xFF09;&#xFF0C;&#x5305;&#x62EC;&#x7528;&#x6237;ID&#x3001;&#x7528;&#x6237;&#x7EC4;ID&#x3001;root&#x76EE;&#x5F55;&#x3001;key&#xFF08;&#x6307;&#x5BC6;&#x94A5;&#xFF09;&#x4EE5;&#x53CA;&#x7279;&#x6B8A;&#x6743;&#x9650;&#x3002;&#x8BF4;&#x5F97;&#x901A;&#x4FD7;&#x4E00;&#x70B9;&#xFF0C;&#x4E00;&#x4E2A;&#x666E;&#x901A;&#x7528;&#x6237;&#x7684;&#x8FDB;&#x7A0B;&#x901A;&#x8FC7;clone()&#x521B;&#x5EFA;&#x7684;&#x65B0;&#x8FDB;&#x7A0B;&#x5728;&#x65B0;user namespace&#x4E2D;&#x53EF;&#x4EE5;&#x62E5;&#x6709;&#x4E0D;&#x540C;&#x7684;&#x7528;&#x6237;&#x548C;&#x7528;&#x6237;&#x7EC4;&#x3002;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x5728;&#x5BB9;&#x5668;&#x5916;&#x5C5E;&#x4E8E;&#x4E00;&#x4E2A;&#x6CA1;&#x6709;&#x7279;&#x6743;&#x7684;&#x666E;&#x901A;&#x7528;&#x6237;&#xFF0C;&#x4F46;&#x662F;&#x4ED6;&#x521B;&#x5EFA;&#x7684;&#x5BB9;&#x5668;&#x8FDB;&#x7A0B;&#x5374;&#x5C5E;&#x4E8E;&#x62E5;&#x6709;&#x6240;&#x6709;&#x6743;&#x9650;&#x7684;&#x8D85;&#x7EA7;&#x7528;&#x6237;&#xFF0C;&#x8FD9;&#x4E2A;&#x6280;&#x672F;&#x4E3A;&#x5BB9;&#x5668;&#x63D0;&#x4F9B;&#x4E86;&#x6781;&#x5927;&#x7684;&#x81EA;&#x7531;&#x3002;<br>User Namespace&#x9664;&#x4E86;&#x9694;&#x79BB;&#x7528;&#x6237;ID&#x548C;&#x7528;&#x6237;&#x7EC4;ID&#x4E4B;&#x5916;&#xFF0C;&#x8FD8;&#x5BF9;&#x6BCF;&#x4E2A;Namespace&#x8FDB;&#x884C;&#x4E86;Capability&#x7684;&#x9694;&#x79BB;&#x548C;&#x63A7;&#x5236;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6DFB;&#x52A0;&#x548C;&#x5220;&#x9664;&#x76F8;&#x5E94;&#x7684;Capability&#x6765;&#x63A7;&#x5236;&#x65B0;Namespace&#x4E2D;&#x8FDB;&#x7A0B;&#x6240;&#x62E5;&#x6709;&#x7684;&#x6743;&#x9650;&#xFF0C;&#x6BD4;&#x5982;&#x4E3A;&#x65B0;&#x7684;Namespace&#x4E2D;&#x589E;&#x52A0;CAP_CHOWN&#x6743;&#x9650;&#xFF0C;&#x90A3;&#x4E48;&#x5728;&#x8FD9;&#x4E2A;Namespace&#x7684;&#x8FDB;&#x7A0B;&#x62E5;&#x6709;&#x6539;&#x53D8;&#x6587;&#x4EF6;&#x5C5E;&#x4E3B;&#x7684;&#x6743;&#x9650;&#x3002;</p>
<ul>
<li>user namespace&#x88AB;&#x521B;&#x5EFA;&#x540E;&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x88AB;&#x8D4B;&#x4E88;&#x4E86;&#x8BE5;namespace&#x4E2D;&#x7684;&#x5168;&#x90E8;&#x6743;&#x9650;&#xFF0C;&#x8FD9;&#x6837;&#x8FD9;&#x4E2A;init&#x8FDB;&#x7A0B;&#x5C31;&#x53EF;&#x4EE5;&#x5B8C;&#x6210;&#x6240;&#x6709;&#x5FC5;&#x8981;&#x7684;&#x521D;&#x59CB;&#x5316;&#x5DE5;&#x4F5C;&#xFF0C;&#x800C;&#x4E0D;&#x4F1A;&#x56E0;&#x6743;&#x9650;&#x4E0D;&#x8DB3;&#x800C;&#x51FA;&#x73B0;&#x9519;&#x8BEF;&#x3002;</li>
<li>&#x6211;&#x4EEC;&#x770B;&#x5230;namespace&#x5185;&#x90E8;&#x770B;&#x5230;&#x7684;UID&#x548C;GID&#x5DF2;&#x7ECF;&#x4E0E;&#x5916;&#x90E8;&#x4E0D;&#x540C;&#x4E86;&#xFF0C;&#x9ED8;&#x8BA4;&#x663E;&#x793A;&#x4E3A;65534&#xFF0C;&#x8868;&#x793A;&#x5C1A;&#x672A;&#x4E0E;&#x5916;&#x90E8;namespace&#x7528;&#x6237;&#x6620;&#x5C04;&#x3002;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5BF9;user namespace&#x5185;&#x90E8;&#x7684;&#x8FD9;&#x4E2A;&#x521D;&#x59CB;user&#x548C;&#x5176;&#x5916;&#x90E8;namespace&#x67D0;&#x4E2A;&#x7528;&#x6237;&#x5EFA;&#x7ACB;&#x6620;&#x5C04;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x4FDD;&#x8BC1;&#x5F53;&#x6D89;&#x53CA;&#x5230;&#x4E00;&#x4E9B;&#x5BF9;&#x5916;&#x90E8;namespace&#x7684;&#x64CD;&#x4F5C;&#x65F6;&#xFF0C;&#x7CFB;&#x7EDF;&#x53EF;&#x4EE5;&#x68C0;&#x9A8C;&#x5176;&#x6743;&#x9650;&#xFF08;&#x6BD4;&#x5982;&#x53D1;&#x9001;&#x4E00;&#x4E2A;&#x4FE1;&#x53F7;&#x6216;&#x64CD;&#x4F5C;&#x67D0;&#x4E2A;&#x6587;&#x4EF6;&#xFF09;&#x3002;&#x540C;&#x6837;&#x7528;&#x6237;&#x7EC4;&#x4E5F;&#x8981;&#x5EFA;&#x7ACB;&#x6620;&#x5C04;&#x3002;</li>
<li>&#x8FD8;&#x6709;&#x4E00;&#x70B9;&#x867D;&#x7136;&#x4E0D;&#x80FD;&#x4ECE;&#x8F93;&#x51FA;&#x4E2D;&#x770B;&#x51FA;&#x6765;&#xFF0C;&#x4F46;&#x662F;&#x503C;&#x5F97;&#x6CE8;&#x610F;&#x3002;&#x7528;&#x6237;&#x5728;&#x65B0;namespace&#x4E2D;&#x6709;&#x5168;&#x90E8;&#x6743;&#x9650;&#xFF0C;&#x4F46;&#x662F;&#x4ED6;&#x5728;&#x521B;&#x5EFA;&#x4ED6;&#x7684;&#x7236;namespace&#x4E2D;&#x4E0D;&#x542B;&#x4EFB;&#x4F55;&#x6743;&#x9650;&#x3002;&#x5C31;&#x7B97;&#x8C03;&#x7528;&#x548C;&#x521B;&#x5EFA;&#x4ED6;&#x7684;&#x8FDB;&#x7A0B;&#x6709;&#x5168;&#x90E8;&#x6743;&#x9650;&#x4E5F;&#x662F;&#x5982;&#x6B64;&#x3002;&#x6240;&#x4EE5;&#x54EA;&#x6015;&#x662F;root&#x7528;&#x6237;&#x8C03;&#x7528;&#x4E86;clone()&#x5728;user namespace&#x4E2D;&#x521B;&#x5EFA;&#x51FA;&#x7684;&#x65B0;&#x7528;&#x6237;&#x5728;&#x5916;&#x90E8;&#x4E5F;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x6743;&#x9650;&#x3002;</li>
<li>&#x6700;&#x540E;&#xFF0C;user namespace&#x7684;&#x521B;&#x5EFA;&#x5176;&#x5B9E;&#x662F;&#x4E00;&#x4E2A;&#x5C42;&#x5C42;&#x5D4C;&#x5957;&#x7684;&#x6811;&#x72B6;&#x7ED3;&#x6784;&#x3002;&#x6700;&#x4E0A;&#x5C42;&#x7684;&#x6839;&#x8282;&#x70B9;&#x5C31;&#x662F;root namespace&#xFF0C;&#x65B0;&#x521B;&#x5EFA;&#x7684;&#x6BCF;&#x4E2A;user namespace&#x90FD;&#x6709;&#x4E00;&#x4E2A;&#x7236;&#x8282;&#x70B9;user namespace&#x4EE5;&#x53CA;&#x96F6;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x5B50;&#x8282;&#x70B9;user namespace&#xFF0C;&#x8FD9;&#x4E00;&#x70B9;&#x4E0E;PID namespace&#x975E;&#x5E38;&#x76F8;&#x4F3C;&#x3002;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;#define _GNU_SOURCE</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;sys/types.h&gt;</span><br><span class="line">#include &lt;sys/wait.h&gt;</span><br><span class="line">#include &lt;sys/mount.h&gt;</span><br><span class="line">#include &lt;sys/capability.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;sched.h&gt;</span><br><span class="line">#include &lt;signal.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line"></span><br><span class="line">#define STACK_SIZE (1024 * 1024)</span><br><span class="line"></span><br><span class="line">static char container_stack[STACK_SIZE];</span><br><span class="line">char* const container_args[] = {</span><br><span class="line">    &quot;/bin/bash&quot;,</span><br><span class="line">    NULL</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">int pipefd[2];</span><br><span class="line"></span><br><span class="line">void set_map(char* file, int inside_id, int outside_id, int len) {</span><br><span class="line">    FILE* mapfd = fopen(file, &quot;w&quot;);</span><br><span class="line">    if (NULL == mapfd) {</span><br><span class="line">        perror(&quot;open file error&quot;);</span><br><span class="line">        return;</span><br><span class="line">    }</span><br><span class="line">    fprintf(mapfd, &quot;%d %d %d&quot;, inside_id, outside_id, len);</span><br><span class="line">    fclose(mapfd);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">void set_uid_map(pid_t pid, int inside_id, int outside_id, int len) {</span><br><span class="line">    char file[256];</span><br><span class="line">    sprintf(file, &quot;/proc/%d/uid_map&quot;, pid);</span><br><span class="line">    set_map(file, inside_id, outside_id, len);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">void set_gid_map(pid_t pid, int inside_id, int outside_id, int len) {</span><br><span class="line">    char file[256];</span><br><span class="line">    sprintf(file, &quot;/proc/%d/gid_map&quot;, pid);</span><br><span class="line">    set_map(file, inside_id, outside_id, len);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">int container_main(void* arg)</span><br><span class="line">{</span><br><span class="line"></span><br><span class="line">    printf(&quot;Container [%5d] - inside the container!\n&quot;, getpid());</span><br><span class="line"></span><br><span class="line">    printf(&quot;Container: eUID = %ld;  eGID = %ld, UID=%ld, GID=%ld\n&quot;,</span><br><span class="line">            (long) geteuid(), (long) getegid(), (long) getuid(), (long) getgid());</span><br><span class="line"></span><br><span class="line">    /* &#x7B49;&#x5F85;&#x7236;&#x8FDB;&#x7A0B;&#x901A;&#x77E5;&#x540E;&#x518D;&#x5F80;&#x4E0B;&#x6267;&#x884C;&#xFF08;&#x8FDB;&#x7A0B;&#x95F4;&#x7684;&#x540C;&#x6B65;&#xFF09; */</span><br><span class="line">    char ch;</span><br><span class="line">    close(pipefd[1]);</span><br><span class="line">    read(pipefd[0], &amp;ch, 1);</span><br><span class="line"></span><br><span class="line">    printf(&quot;Container [%5d] - setup hostname!\n&quot;, getpid());</span><br><span class="line">    //set hostname</span><br><span class="line">    sethostname(&quot;container&quot;,10);</span><br><span class="line"></span><br><span class="line">    //remount &quot;/proc&quot; to make sure the &quot;top&quot; and &quot;ps&quot; show container&apos;s information</span><br><span class="line">    mount(&quot;proc&quot;, &quot;/proc&quot;, &quot;proc&quot;, 0, NULL);</span><br><span class="line"></span><br><span class="line">    execv(container_args[0], container_args);</span><br><span class="line">    printf(&quot;Something&apos;s wrong!\n&quot;);</span><br><span class="line">    return 1;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">{</span><br><span class="line">    const int gid=getgid(), uid=getuid();</span><br><span class="line"></span><br><span class="line">    printf(&quot;Parent: eUID = %ld;  eGID = %ld, UID=%ld, GID=%ld\n&quot;,</span><br><span class="line">            (long) geteuid(), (long) getegid(), (long) getuid(), (long) getgid());</span><br><span class="line"></span><br><span class="line">    pipe(pipefd);</span><br><span class="line"></span><br><span class="line">    printf(&quot;Parent [%5d] - start a container!\n&quot;, getpid());</span><br><span class="line"></span><br><span class="line">    int container_pid = clone(container_main, container_stack+STACK_SIZE, </span><br><span class="line">            CLONE_NEWUTS  | CLONE_NEWNS | CLONE_NEWUSER | SIGCHLD, NULL);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    printf(&quot;Parent [%5d] - Container [%5d]!\n&quot;, getpid(), container_pid);</span><br><span class="line"></span><br><span class="line">    //To map the uid/gid, </span><br><span class="line">    //   we need edit the /proc/PID/uid_map (or /proc/PID/gid_map) in parent</span><br><span class="line">    //The file format is</span><br><span class="line">    //   ID-inside-ns   ID-outside-ns   length</span><br><span class="line">    //if no mapping, </span><br><span class="line">    //   the uid will be taken from /proc/sys/kernel/overflowuid</span><br><span class="line">    //   the gid will be taken from /proc/sys/kernel/overflowgid</span><br><span class="line">    set_uid_map(container_pid, 0, uid, 1);</span><br><span class="line">    set_gid_map(container_pid, 0, gid, 1);</span><br><span class="line"></span><br><span class="line">    printf(&quot;Parent [%5d] - user/group mapping done!\n&quot;, getpid());</span><br><span class="line"></span><br><span class="line">    /* &#x901A;&#x77E5;&#x5B50;&#x8FDB;&#x7A0B; */</span><br><span class="line">    close(pipefd[1]);</span><br><span class="line"></span><br><span class="line">    waitpid(container_pid, NULL, 0);</span><br><span class="line">    printf(&quot;Parent - container stopped!\n&quot;);</span><br><span class="line">    return 0;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x4E0A;&#x9762;&#x7684;&#x7A0B;&#x5E8F;&#xFF0C;&#x6211;&#x4EEC;&#x7528;&#x4E86;&#x4E00;&#x4E2A;pipe&#x6765;&#x5BF9;&#x7236;&#x5B50;&#x8FDB;&#x7A0B;&#x8FDB;&#x884C;&#x540C;&#x6B65;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x8FD9;&#x6837;&#x505A;&#xFF1F;&#x56E0;&#x4E3A;&#x5B50;&#x8FDB;&#x7A0B;&#x4E2D;&#x6709;&#x4E00;&#x4E2A;execv&#x7684;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#xFF0C;&#x8FD9;&#x4E2A;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x4F1A;&#x628A;&#x5F53;&#x524D;&#x5B50;&#x8FDB;&#x7A0B;&#x7684;&#x8FDB;&#x7A0B;&#x7A7A;&#x95F4;&#x7ED9;&#x5168;&#x90E8;&#x8986;&#x76D6;&#x6389;&#xFF0C;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x5728;execv&#x4E4B;&#x524D;&#x5C31;&#x505A;&#x597D;user namespace&#x7684;uid/gid&#x7684;&#x6620;&#x5C04;&#xFF0C;&#x8FD9;&#x6837;&#xFF0C;execv&#x8FD0;&#x884C;&#x7684;/bin/bash&#x5C31;&#x4F1A;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x8BBE;&#x7F6E;&#x4E86;uid&#x4E3A;0&#x7684;inside-uid&#x800C;&#x53D8;&#x6210;#&#x53F7;&#x7684;&#x63D0;&#x793A;&#x7B26;&#x3002;</span><br></pre></td></tr></table></figure>

<h3 id="Network-Namespace"><a href="#Network-Namespace" class="headerlink" title="Network Namespace"></a>Network Namespace</h3><p>&#x5728;Linux&#x4E0B;&#xFF0C;&#x6211;&#x4EEC;&#x4E00;&#x822C;&#x7528;ip&#x547D;&#x4EE4;&#x521B;&#x5EFA;Network Namespace  </p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/e194f606c4632d62b20cc244f33994c4e8b89289b812b766259dfacc058d725a" alt="image"></p>
<p>image</p>
<p>&#x4E00;&#x822C;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x7269;&#x7406;&#x7F51;&#x7EDC;&#x8BBE;&#x5907;&#x90FD;&#x5206;&#x914D;&#x5728;&#x6700;&#x521D;&#x7684;root namespace&#xFF08;&#x8868;&#x793A;&#x7CFB;&#x7EDF;&#x9ED8;&#x8BA4;&#x7684;namespace&#xFF0C;&#x5728;PID namespace&#x4E2D;&#x5DF2;&#x7ECF;&#x63D0;&#x53CA;&#xFF09;&#x4E2D;&#x3002;&#x4F46;&#x662F;&#x5982;&#x679C;&#x4F60;&#x6709;&#x591A;&#x5757;&#x7269;&#x7406;&#x7F51;&#x5361;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x628A;&#x5176;&#x4E2D;&#x4E00;&#x5757;&#x6216;&#x591A;&#x5757;&#x5206;&#x914D;&#x7ED9;&#x65B0;&#x521B;&#x5EFA;&#x7684;network namespace&#x3002;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x5F53;&#x65B0;&#x521B;&#x5EFA;&#x7684;network namespace&#x88AB;&#x91CA;&#x653E;&#x65F6;&#xFF08;&#x6240;&#x6709;&#x5185;&#x90E8;&#x7684;&#x8FDB;&#x7A0B;&#x90FD;&#x7EC8;&#x6B62;&#x5E76;&#x4E14;namespace&#x6587;&#x4EF6;&#x6CA1;&#x6709;&#x88AB;&#x6302;&#x8F7D;&#x6216;&#x6253;&#x5F00;&#xFF09;&#xFF0C;&#x5728;&#x8FD9;&#x4E2A;namespace&#x4E2D;&#x7684;&#x7269;&#x7406;&#x7F51;&#x5361;&#x4F1A;&#x8FD4;&#x56DE;&#x5230;root namespace&#x800C;&#x975E;&#x521B;&#x5EFA;&#x8BE5;&#x8FDB;&#x7A0B;&#x7684;&#x7236;&#x8FDB;&#x7A0B;&#x6240;&#x5728;&#x7684;network namespace&#x3002;</p>
<p>&#x5728;&#x5EFA;&#x7ACB;&#x8D77;veth pair&#x4E4B;&#x524D;&#xFF0C;&#x65B0;&#x65E7;namespace&#x8BE5;&#x5982;&#x4F55;&#x901A;&#x4FE1;&#x5462;&#xFF1F;&#x7B54;&#x6848;&#x662F;pipe&#xFF08;&#x7BA1;&#x9053;&#xFF09;&#x3002;&#x6211;&#x4EEC;&#x4EE5;Docker Daemon&#x5728;&#x542F;&#x52A8;&#x5BB9;&#x5668;dockerinit&#x7684;&#x8FC7;&#x7A0B;&#x4E3A;&#x4F8B;&#x3002;Docker Daemon&#x5728;&#x5BBF;&#x4E3B;&#x673A;&#x4E0A;&#x8D1F;&#x8D23;&#x521B;&#x5EFA;&#x8FD9;&#x4E2A;veth pair&#xFF0C;&#x901A;&#x8FC7;netlink&#x8C03;&#x7528;&#xFF0C;&#x628A;&#x4E00;&#x7AEF;&#x7ED1;&#x5B9A;&#x5230;docker0&#x7F51;&#x6865;&#x4E0A;&#xFF0C;&#x4E00;&#x7AEF;&#x8FDE;&#x8FDB;&#x65B0;&#x5EFA;&#x7684;network namespace&#x8FDB;&#x7A0B;&#x4E2D;&#x3002;&#x5EFA;&#x7ACB;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;Docker Daemon&#x548C;dockerinit&#x5C31;&#x901A;&#x8FC7;pipe&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#xFF0C;&#x5F53;Docker Daemon&#x5B8C;&#x6210;veth-pair&#x7684;&#x521B;&#x5EFA;&#x4E4B;&#x524D;&#xFF0C;dockerinit&#x5728;&#x7BA1;&#x9053;&#x7684;&#x53E6;&#x4E00;&#x7AEF;&#x5FAA;&#x73AF;&#x7B49;&#x5F85;&#xFF0C;&#x76F4;&#x5230;&#x7BA1;&#x9053;&#x53E6;&#x4E00;&#x7AEF;&#x4F20;&#x6765;Docker Daemon&#x5173;&#x4E8E;veth&#x8BBE;&#x5907;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x5E76;&#x5173;&#x95ED;&#x7BA1;&#x9053;&#x3002;dockerinit&#x624D;&#x7ED3;&#x675F;&#x7B49;&#x5F85;&#x7684;&#x8FC7;&#x7A0B;&#xFF0C;&#x5E76;&#x628A;&#x5B83;&#x7684;&#x201C;eth0&#x201D;&#x542F;&#x52A8;&#x8D77;&#x6765;&#x3002;&#x6574;&#x4E2A;&#x6548;&#x679C;&#x7C7B;&#x4F3C;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// docker &#x7F51;&#x7EDC;&#x672C;&#x8D28;&#x505A;&#x7684;&#x4E8B;&#x5C31;&#x662F; 1. &#x521B;&#x5EFA;&#x7F51;&#x6865;  2. &#x521B;&#x5EFA;veth &#x865A;&#x62DF;&#x7F51;&#x5361;,&#x4E00;&#x5934;&#x5728;docker ns1,&#x4E00;&#x5934;&#x63D2;&#x5728;&#x7F51;&#x6865;&#x4E0A; 3. &#x8BBE;&#x7F6E;ip,&#x8DEF;&#x7531;&#x89C4;&#x5219;,nat&#xFF0C;&#x8BA9;docker &#x7F51;&#x7EDC;&#x80FD;&#x7ECF;&#x8FC7;bridge &#x51FA;&#x53BB;  &#x5916;&#x90E8;&#x8BBF;&#x95EE;&#x5BB9;&#x5668;&#x7F51;&#x7EDC; &#x4E5F;&#x662F;&#x5728;&#x672C;&#x5730;&#x7684; iptable &#x7684; nat &#x8868;&#x4E2D;&#x6DFB;&#x52A0;&#x76F8;&#x5E94;&#x7684;&#x89C4;&#x5219; https://yeasy.gitbooks.io/docker_practice/content/advanced_network/port_mapping.html</span><br><span class="line">calico &#x4E5F;&#x662F;&#x7C7B;&#x4F3C;&#x5B9E;&#x73B0;&#xFF0C;&#x6CA1;&#x6709;&#x7528;bridge&#x6A21;&#x5F0F;</span><br><span class="line"></span><br><span class="line">## &#x9996;&#x5148;&#xFF0C;&#x6211;&#x4EEC;&#x5148;&#x589E;&#x52A0;&#x4E00;&#x4E2A;&#x7F51;&#x6865;lxcbr0&#xFF0C;&#x6A21;&#x4EFF;docker0</span><br><span class="line">brctl addbr lxcbr0</span><br><span class="line">brctl stp lxcbr0 off</span><br><span class="line">ifconfig lxcbr0 192.168.10.1/24 up #&#x4E3A;&#x7F51;&#x6865;&#x8BBE;&#x7F6E;IP&#x5730;&#x5740;</span><br><span class="line"></span><br><span class="line">## &#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x6211;&#x4EEC;&#x8981;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;network namespace - ns1</span><br><span class="line"></span><br><span class="line"># &#x589E;&#x52A0;&#x4E00;&#x4E2A;namesapce &#x547D;&#x4EE4;&#x4E3A; ns1 &#xFF08;&#x4F7F;&#x7528;ip netns add&#x547D;&#x4EE4;&#xFF09;</span><br><span class="line">ip netns add ns1 </span><br><span class="line"></span><br><span class="line"># &#x6FC0;&#x6D3B;namespace&#x4E2D;&#x7684;loopback&#xFF0C;&#x5373;127.0.0.1&#xFF08;&#x4F7F;&#x7528;ip netns exec ns1&#x6765;&#x64CD;&#x4F5C;ns1&#x4E2D;&#x7684;&#x547D;&#x4EE4;&#xFF09;</span><br><span class="line">ip netns exec ns1   ip link set dev lo up </span><br><span class="line"></span><br><span class="line">## &#x7136;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x589E;&#x52A0;&#x4E00;&#x5BF9;&#x865A;&#x62DF;&#x7F51;&#x5361;</span><br><span class="line"></span><br><span class="line"># &#x589E;&#x52A0;&#x4E00;&#x4E2A;pair&#x865A;&#x62DF;&#x7F51;&#x5361;&#xFF0C;&#x6CE8;&#x610F;&#x5176;&#x4E2D;&#x7684;veth&#x7C7B;&#x578B;&#xFF0C;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x7F51;&#x5361;&#x8981;&#x6309;&#x8FDB;&#x5BB9;&#x5668;&#x4E2D;</span><br><span class="line"># VETH &#x8BBE;&#x5907;&#x603B;&#x662F;&#x6210;&#x5BF9;&#x51FA;&#x73B0;&#xFF0C;&#x9001;&#x5230;&#x4E00;&#x7AEF;&#x8BF7;&#x6C42;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;&#x603B;&#x662F;&#x4ECE;&#x53E6;&#x4E00;&#x7AEF;&#x4EE5;&#x8BF7;&#x6C42;&#x63A5;&#x53D7;&#x7684;&#x5F62;&#x5F0F;&#x51FA;&#x73B0;&#x3002;&#x8BE5;&#x8BBE;&#x5907;&#x4E0D;&#x80FD;&#x88AB;&#x7528;&#x6237;&#x7A0B;&#x5E8F;&#x76F4;&#x63A5;&#x64CD;&#x4F5C;&#xFF0C;&#x4F46;&#x4F7F;&#x7528;&#x8D77;&#x6765;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#x3002;&#x521B;&#x5EFA;&#x5E76;&#x914D;&#x7F6E;&#x6B63;&#x786E;&#x540E;&#xFF0C;&#x5411;&#x5176;&#x4E00;&#x7AEF;&#x8F93;&#x5165;&#x6570;&#x636E;&#xFF0C;VETH &#x4F1A;&#x6539;&#x53D8;&#x6570;&#x636E;&#x7684;&#x65B9;&#x5411;&#x5E76;&#x5C06;&#x5176;&#x9001;&#x5165;&#x5185;&#x6838;&#x7F51;&#x7EDC;&#x6838;&#x5FC3;&#xFF0C;&#x5B8C;&#x6210;&#x6570;&#x636E;&#x7684;&#x6CE8;&#x5165;&#x3002;&#x5728;&#x53E6;&#x4E00;&#x7AEF;&#x80FD;&#x8BFB;&#x5230;&#x6B64;&#x6570;&#x636E;&#x3002;</span><br><span class="line"></span><br><span class="line">ip link add veth-ns1 type veth peer name lxcbr0.1</span><br><span class="line"></span><br><span class="line"># &#x628A; veth-ns1 &#x6309;&#x5230;namespace ns1&#x4E2D;&#xFF0C;&#x8FD9;&#x6837;&#x5BB9;&#x5668;&#x4E2D;&#x5C31;&#x4F1A;&#x6709;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x7F51;&#x5361;&#x4E86;</span><br><span class="line">ip link set veth-ns1 netns ns1</span><br><span class="line"></span><br><span class="line"># &#x628A;&#x5BB9;&#x5668;&#x91CC;&#x7684; veth-ns1&#x6539;&#x540D;&#x4E3A; eth0 &#xFF08;&#x5BB9;&#x5668;&#x5916;&#x4F1A;&#x51B2;&#x7A81;&#xFF0C;&#x5BB9;&#x5668;&#x5185;&#x5C31;&#x4E0D;&#x4F1A;&#x4E86;&#xFF09;</span><br><span class="line">ip netns exec ns1  ip link set dev veth-ns1 name eth0 </span><br><span class="line"></span><br><span class="line"># &#x4E3A;&#x5BB9;&#x5668;&#x4E2D;&#x7684;&#x7F51;&#x5361;&#x5206;&#x914D;&#x4E00;&#x4E2A;IP&#x5730;&#x5740;&#xFF0C;&#x5E76;&#x6FC0;&#x6D3B;&#x5B83;</span><br><span class="line">ip netns exec ns1 ifconfig eth0 192.168.10.11/24 up</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># &#x4E0A;&#x9762;&#x6211;&#x4EEC;&#x628A;veth-ns1&#x8FD9;&#x4E2A;&#x7F51;&#x5361;&#x6309;&#x5230;&#x4E86;&#x5BB9;&#x5668;&#x4E2D;&#xFF0C;&#x7136;&#x540E;&#x6211;&#x4EEC;&#x8981;&#x628A;lxcbr0.1&#x6DFB;&#x52A0;&#x4E0A;&#x7F51;&#x6865;&#x4E0A;</span><br><span class="line">brctl addif lxcbr0 lxcbr0.1</span><br><span class="line"></span><br><span class="line"># &#x4E3A;&#x5BB9;&#x5668;&#x589E;&#x52A0;&#x4E00;&#x4E2A;&#x8DEF;&#x7531;&#x89C4;&#x5219;&#xFF0C;&#x8BA9;&#x5BB9;&#x5668;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x5916;&#x9762;&#x7684;&#x7F51;&#x7EDC;</span><br><span class="line">ip netns exec ns1     ip route add default via 192.168.10.1</span><br><span class="line"></span><br><span class="line"># &#x5728;/etc/netns&#x4E0B;&#x521B;&#x5EFA;network namespce&#x540D;&#x79F0;&#x4E3A;ns1&#x7684;&#x76EE;&#x5F55;&#xFF0C;</span><br><span class="line"># &#x7136;&#x540E;&#x4E3A;&#x8FD9;&#x4E2A;namespace&#x8BBE;&#x7F6E;resolv.conf&#xFF0C;&#x8FD9;&#x6837;&#xFF0C;&#x5BB9;&#x5668;&#x5185;&#x5C31;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x57DF;&#x540D;&#x4E86;</span><br><span class="line">mkdir -p /etc/netns/ns1</span><br><span class="line">echo &quot;nameserver 8.8.8.8&quot; &gt; /etc/netns/ns1/resolv.conf</span><br></pre></td></tr></table></figure>

<h1 id="CGroup"><a href="#CGroup" class="headerlink" title="CGroup"></a>CGroup</h1><p>cgroups&#x53EF;&#x4EE5;&#x9650;&#x5236;&#x3001;&#x8BB0;&#x5F55;&#x3001;&#x9694;&#x79BB;&#x8FDB;&#x7A0B;&#x7EC4;&#x6240;&#x4F7F;&#x7528;&#x7684;&#x7269;&#x7406;&#x8D44;&#x6E90;&#xFF08;&#x5305;&#x62EC;&#xFF1A;CPU&#x3001;memory&#x3001;IO&#x7B49;&#xFF09;&#xFF0C;&#x4E3A;&#x5BB9;&#x5668;&#x5B9E;&#x73B0;&#x865A;&#x62DF;&#x5316;&#x63D0;&#x4F9B;&#x4E86;&#x57FA;&#x672C;&#x4FDD;&#x8BC1;&#xFF0C;&#x662F;&#x6784;&#x5EFA;Docker&#x7B49;&#x4E00;&#x7CFB;&#x5217;&#x865A;&#x62DF;&#x5316;&#x7BA1;&#x7406;&#x5DE5;&#x5177;&#x7684;&#x57FA;&#x77F3;&#x3002;</p>
<p>&#x4E3B;&#x8981;&#x63D0;&#x4F9B;&#x4E86;&#x5982;&#x4E0B;&#x529F;&#x80FD;&#xFF1A;</p>
<ul>
<li>Resource limitation: &#x9650;&#x5236;&#x8D44;&#x6E90;&#x4F7F;&#x7528;&#xFF0C;&#x6BD4;&#x5982;&#x5185;&#x5B58;&#x4F7F;&#x7528;&#x4E0A;&#x9650;&#x4EE5;&#x53CA;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x7684;&#x7F13;&#x5B58;&#x9650;&#x5236;&#x3002;</li>
<li>Prioritization: &#x4F18;&#x5148;&#x7EA7;&#x63A7;&#x5236;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;CPU&#x5229;&#x7528;&#x548C;&#x78C1;&#x76D8;IO&#x541E;&#x5410;&#x3002;</li>
<li>Accounting: &#x4E00;&#x4E9B;&#x5BA1;&#x8BA1;&#x6216;&#x4E00;&#x4E9B;&#x7EDF;&#x8BA1;&#xFF0C;&#x4E3B;&#x8981;&#x76EE;&#x7684;&#x662F;&#x4E3A;&#x4E86;&#x8BA1;&#x8D39;&#x3002;</li>
<li>Control: &#x6302;&#x8D77;&#x8FDB;&#x7A0B;&#xFF0C;&#x6062;&#x590D;&#x6267;&#x884C;&#x8FDB;&#x7A0B;&#x3002;</li>
</ul>
<p>&#x5BF9;&#x5F00;&#x53D1;&#x8005;&#x6765;&#x8BF4;&#xFF0C;cgroups&#x6709;&#x5982;&#x4E0B;&#x56DB;&#x4E2A;&#x6709;&#x8DA3;&#x7684;&#x7279;&#x70B9;&#xFF1A;</p>
<ul>
<li>cgroups&#x7684;API&#x4EE5;&#x4E00;&#x4E2A;&#x4F2A;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x7684;&#x65B9;&#x5F0F;&#x5B9E;&#x73B0;&#xFF0C;&#x5373;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6587;&#x4EF6;&#x64CD;&#x4F5C;&#x5B9E;&#x73B0;cgroups&#x7684;&#x7EC4;&#x7EC7;&#x7BA1;&#x7406;&#x3002;</li>
<li>cgroups&#x7684;&#x7EC4;&#x7EC7;&#x7BA1;&#x7406;&#x64CD;&#x4F5C;&#x5355;&#x5143;&#x53EF;&#x4EE5;&#x7EC6;&#x7C92;&#x5EA6;&#x5230;&#x7EBF;&#x7A0B;&#x7EA7;&#x522B;&#xFF0C;&#x7528;&#x6237;&#x6001;&#x4EE3;&#x7801;&#x4E5F;&#x53EF;&#x4EE5;&#x9488;&#x5BF9;&#x7CFB;&#x7EDF;&#x5206;&#x914D;&#x7684;&#x8D44;&#x6E90;&#x521B;&#x5EFA;&#x548C;&#x9500;&#x6BC1;cgroups&#xFF0C;&#x4ECE;&#x800C;&#x5B9E;&#x73B0;&#x8D44;&#x6E90;&#x518D;&#x5206;&#x914D;&#x548C;&#x7BA1;&#x7406;&#x3002;</li>
<li>&#x6240;&#x6709;&#x8D44;&#x6E90;&#x7BA1;&#x7406;&#x7684;&#x529F;&#x80FD;&#x90FD;&#x4EE5;&#x201C;subsystem&#xFF08;&#x5B50;&#x7CFB;&#x7EDF;&#xFF09;&#x201D;&#x7684;&#x65B9;&#x5F0F;&#x5B9E;&#x73B0;&#xFF0C;&#x63A5;&#x53E3;&#x7EDF;&#x4E00;&#x3002;</li>
<li>&#x5B50;&#x8FDB;&#x7A0B;&#x521B;&#x5EFA;&#x4E4B;&#x521D;&#x4E0E;&#x5176;&#x7236;&#x8FDB;&#x7A0B;&#x5904;&#x4E8E;&#x540C;&#x4E00;&#x4E2A;cgroups&#x7684;&#x63A7;&#x5236;&#x7EC4;&#x3002;</li>
</ul>
<p>&#x672C;&#x8D28;&#x4E0A;&#x6765;&#x8BF4;&#xFF0C;cgroups&#x662F;&#x5185;&#x6838;&#x9644;&#x52A0;&#x5728;&#x7A0B;&#x5E8F;&#x4E0A;&#x7684;&#x4E00;&#x7CFB;&#x5217;&#x94A9;&#x5B50;&#xFF08;hooks&#xFF09;&#xFF0C;&#x901A;&#x8FC7;&#x7A0B;&#x5E8F;&#x8FD0;&#x884C;&#x65F6;&#x5BF9;&#x8D44;&#x6E90;&#x7684;&#x8C03;&#x5EA6;&#x89E6;&#x53D1;&#x76F8;&#x5E94;&#x7684;&#x94A9;&#x5B50;&#x4EE5;&#x8FBE;&#x5230;&#x8D44;&#x6E90;&#x8FFD;&#x8E2A;&#x548C;&#x9650;&#x5236;&#x7684;&#x76EE;&#x7684;&#x3002;</p>
<p>&#x672F;&#x8BED;</p>
<ul>
<li>task&#xFF08;&#x4EFB;&#x52A1;&#xFF09;&#xFF1A;cgroups&#x7684;&#x672F;&#x8BED;&#x4E2D;&#xFF0C;task&#x5C31;&#x8868;&#x793A;&#x7CFB;&#x7EDF;&#x7684;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x3002;</li>
<li>cgroup&#xFF08;&#x63A7;&#x5236;&#x7EC4;&#xFF09;&#xFF1A;cgroups &#x4E2D;&#x7684;&#x8D44;&#x6E90;&#x63A7;&#x5236;&#x90FD;&#x4EE5;cgroup&#x4E3A;&#x5355;&#x4F4D;&#x5B9E;&#x73B0;&#x3002;cgroup&#x8868;&#x793A;&#x6309;&#x67D0;&#x79CD;&#x8D44;&#x6E90;&#x63A7;&#x5236;&#x6807;&#x51C6;&#x5212;&#x5206;&#x800C;&#x6210;&#x7684;&#x4EFB;&#x52A1;&#x7EC4;&#xFF0C;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x5B50;&#x7CFB;&#x7EDF;&#x3002;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#x53EF;&#x4EE5;&#x52A0;&#x5165;&#x67D0;&#x4E2A;cgroup&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4ECE;&#x67D0;&#x4E2A;cgroup&#x8FC1;&#x79FB;&#x5230;&#x53E6;&#x5916;&#x4E00;&#x4E2A;cgroup&#x3002;</li>
<li>subsystem&#xFF08;&#x5B50;&#x7CFB;&#x7EDF;&#xFF09;&#xFF1A;cgroups&#x4E2D;&#x7684;subsystem&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x8D44;&#x6E90;&#x8C03;&#x5EA6;&#x63A7;&#x5236;&#x5668;&#xFF08;Resource Controller&#xFF09;&#x3002;&#x6BD4;&#x5982;CPU&#x5B50;&#x7CFB;&#x7EDF;&#x53EF;&#x4EE5;&#x63A7;&#x5236;CPU&#x65F6;&#x95F4;&#x5206;&#x914D;&#xFF0C;&#x5185;&#x5B58;&#x5B50;&#x7CFB;&#x7EDF;&#x53EF;&#x4EE5;&#x9650;&#x5236;cgroup&#x5185;&#x5B58;&#x4F7F;&#x7528;&#x91CF;&#x3002;</li>
<li>hierarchy&#xFF08;&#x5C42;&#x7EA7;&#x6811;&#xFF09;&#xFF1A;hierarchy&#x7531;&#x4E00;&#x7CFB;&#x5217;cgroup&#x4EE5;&#x4E00;&#x4E2A;&#x6811;&#x72B6;&#x7ED3;&#x6784;&#x6392;&#x5217;&#x800C;&#x6210;&#xFF0C;&#x6BCF;&#x4E2A;hierarchy&#x901A;&#x8FC7;&#x7ED1;&#x5B9A;&#x5BF9;&#x5E94;&#x7684;subsystem&#x8FDB;&#x884C;&#x8D44;&#x6E90;&#x8C03;&#x5EA6;&#x3002;hierarchy&#x4E2D;&#x7684;cgroup&#x8282;&#x70B9;&#x53EF;&#x4EE5;&#x5305;&#x542B;&#x96F6;&#x6216;&#x591A;&#x4E2A;&#x5B50;&#x8282;&#x70B9;&#xFF0C;&#x5B50;&#x8282;&#x70B9;&#x7EE7;&#x627F;&#x7236;&#x8282;&#x70B9;&#x7684;&#x5C5E;&#x6027;&#x3002;&#x6574;&#x4E2A;&#x7CFB;&#x7EDF;&#x53EF;&#x4EE5;&#x6709;&#x591A;&#x4E2A;hierarchy</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;hchen@ubuntu:~$ mount -t cgroup #&#x6216;&#x8005;&#x4F7F;&#x7528;lssubsys -m&#x547D;&#x4EE4;&#xFF1A; # lscgroup &#x67E5;&#x8BE2;</span><br><span class="line">cgroup on /sys/fs/cgroup/cpuset type cgroup (rw,relatime,cpuset)</span><br><span class="line">cgroup on /sys/fs/cgroup/cpu type cgroup (rw,relatime,cpu)</span><br><span class="line">cgroup on /sys/fs/cgroup/cpuacct type cgroup (rw,relatime,cpuacct)</span><br><span class="line">cgroup on /sys/fs/cgroup/memory type cgroup (rw,relatime,memory)</span><br><span class="line">cgroup on /sys/fs/cgroup/devices type cgroup (rw,relatime,devices)</span><br><span class="line">cgroup on /sys/fs/cgroup/freezer type cgroup (rw,relatime,freezer)</span><br><span class="line">cgroup on /sys/fs/cgroup/blkio type cgroup (rw,relatime,blkio)</span><br><span class="line">cgroup on /sys/fs/cgroup/net_prio type cgroup (rw,net_prio)</span><br><span class="line">cgroup on /sys/fs/cgroup/net_cls type cgroup (rw,net_cls)</span><br><span class="line">cgroup on /sys/fs/cgroup/perf_event type cgroup (rw,relatime,perf_event)</span><br><span class="line">cgroup on /sys/fs/cgroup/hugetlb type cgroup (rw,relatime,hugetlb)</span><br></pre></td></tr></table></figure>

<h2 id="cgroups&#x7684;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#x7B80;&#x4ECB;"><a href="#cgroups&#x7684;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#x7B80;&#x4ECB;" class="headerlink" title="cgroups&#x7684;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#x7B80;&#x4ECB;"></a>cgroups&#x7684;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#x7B80;&#x4ECB;</h2><h3 id="&#x67E5;&#x8BE2;cgroup&#x53CA;&#x5B50;&#x7CFB;&#x7EDF;&#x6302;&#x8F7D;&#x72B6;&#x6001;"><a href="#&#x67E5;&#x8BE2;cgroup&#x53CA;&#x5B50;&#x7CFB;&#x7EDF;&#x6302;&#x8F7D;&#x72B6;&#x6001;" class="headerlink" title="&#x67E5;&#x8BE2;cgroup&#x53CA;&#x5B50;&#x7CFB;&#x7EDF;&#x6302;&#x8F7D;&#x72B6;&#x6001;"></a>&#x67E5;&#x8BE2;cgroup&#x53CA;&#x5B50;&#x7CFB;&#x7EDF;&#x6302;&#x8F7D;&#x72B6;&#x6001;</h3><ul>
<li>&#x67E5;&#x770B;&#x6240;&#x6709;&#x7684;cgroup&#xFF1A;lscgroup</li>
<li>&#x67E5;&#x770B;&#x6240;&#x6709;&#x652F;&#x6301;&#x7684;&#x5B50;&#x7CFB;&#x7EDF;&#xFF1A;lssubsys -a</li>
<li>&#x67E5;&#x770B;&#x6240;&#x6709;&#x5B50;&#x7CFB;&#x7EDF;&#x6302;&#x8F7D;&#x7684;&#x4F4D;&#x7F6E;&#xFF1A; lssubsys &#x2013;m</li>
<li>&#x67E5;&#x770B;&#x5355;&#x4E2A;&#x5B50;&#x7CFB;&#x7EDF;&#xFF08;&#x5982;memory&#xFF09;&#x6302;&#x8F7D;&#x4F4D;&#x7F6E;&#xFF1A;lssubsys &#x2013;m memory</li>
</ul>
<h3 id="&#x521B;&#x5EFA;hierarchy&#x5C42;&#x7EA7;&#x5E76;&#x6302;&#x8F7D;&#x5B50;&#x7CFB;&#x7EDF;"><a href="#&#x521B;&#x5EFA;hierarchy&#x5C42;&#x7EA7;&#x5E76;&#x6302;&#x8F7D;&#x5B50;&#x7CFB;&#x7EDF;" class="headerlink" title="&#x521B;&#x5EFA;hierarchy&#x5C42;&#x7EA7;&#x5E76;&#x6302;&#x8F7D;&#x5B50;&#x7CFB;&#x7EDF;"></a>&#x521B;&#x5EFA;hierarchy&#x5C42;&#x7EA7;&#x5E76;&#x6302;&#x8F7D;&#x5B50;&#x7CFB;&#x7EDF;</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// &#x865A;&#x62DF;&#x673A;&#x64CD;&#x4F5C;&#xFF0C;&#x4F1A;&#x5F71;&#x54CD;&#x7CFB;&#x7EDF;</span><br><span class="line">mount -t tmpfs cgroups /sys/fs/cgroup</span><br><span class="line">mkdir /sys/fs/cgroup/cg1</span><br><span class="line">// mount -t cgroup -o subsystems name /cgroup/name</span><br><span class="line">mount &#x2013;t cgroup &#x2013;o cpu,memory cpu_and_mem /sys/fs/cgroup/cg1</span><br></pre></td></tr></table></figure>

<h2 id="CPU-&#x9650;&#x5236;"><a href="#CPU-&#x9650;&#x5236;" class="headerlink" title="CPU &#x9650;&#x5236;"></a>CPU &#x9650;&#x5236;</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;root@container:~# mkdir -p  /sys/fs/cgroup/cpu/wanglei</span><br><span class="line">root@container:~# cat /sys/fs/cgroup/cpu/wanglei/cpu.cfs_quota_us</span><br><span class="line">-1</span><br><span class="line"></span><br><span class="line">&#x6D4B;&#x8BD5;&#x7A0B;&#x5E8F;</span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">    int i = 0;</span><br><span class="line">    for(;;) i++;</span><br><span class="line">    return 0;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">top-&gt;</span><br><span class="line">  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND</span><br><span class="line"> 6121 root      20   0    4224    684    612 R 100.0  0.0   0:05.89 a.out</span><br><span class="line"></span><br><span class="line">&#x5F00;&#x59CB;&#x9650;&#x5236;,6121&#x67E5;&#x5230;&#x662F;&#x6D4B;&#x8BD5;&#x7A0B;&#x5E8F;&#x7684;pid</span><br><span class="line">root@container:~/testcgroup# echo 20000 &gt; /sys/fs/cgroup/cpu/wanglei/cpu.cfs_quota_us</span><br><span class="line">root@container:~/testcgroup# echo 6121 &gt;&gt; /sys/fs/cgroup/cpu/wanglei/tasks</span><br><span class="line"></span><br><span class="line">top-&gt;</span><br><span class="line">  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND</span><br><span class="line"> 6121 root      20   0    4224    684    612 R  20.3  0.0   2:31.16 a.out</span><br></pre></td></tr></table></figure>

<p>&#x4E0B;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x662F;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x7684;&#x793A;&#x4F8B;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;#define _GNU_SOURCE         /* See feature_test_macros(7) */</span><br><span class="line"></span><br><span class="line">#include &lt;pthread.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;sys/stat.h&gt;</span><br><span class="line">#include &lt;sys/types.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;sys/syscall.h&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">const int NUM_THREADS = 5;</span><br><span class="line"></span><br><span class="line">void *thread_main(void *threadid)</span><br><span class="line">{</span><br><span class="line">    /* &#x628A;&#x81EA;&#x5DF1;&#x52A0;&#x5165;cgroup&#x4E2D;&#xFF08;syscall(SYS_gettid)&#x4E3A;&#x5F97;&#x5230;&#x7EBF;&#x7A0B;&#x7684;&#x7CFB;&#x7EDF;tid&#xFF09; */</span><br><span class="line">    char cmd[128];</span><br><span class="line">    sprintf(cmd, &quot;echo %ld &gt;&gt; /sys/fs/cgroup/cpu/haoel/tasks&quot;, syscall(SYS_gettid));</span><br><span class="line">    system(cmd); </span><br><span class="line">    sprintf(cmd, &quot;echo %ld &gt;&gt; /sys/fs/cgroup/cpuset/haoel/tasks&quot;, syscall(SYS_gettid));</span><br><span class="line">    system(cmd);</span><br><span class="line"></span><br><span class="line">    long tid;</span><br><span class="line">    tid = (long)threadid;</span><br><span class="line">    printf(&quot;Hello World! It&apos;s me, thread #%ld, pid #%ld!\n&quot;, tid, syscall(SYS_gettid));</span><br><span class="line"></span><br><span class="line">    int a=0; </span><br><span class="line">    while(1) {</span><br><span class="line">        a++;</span><br><span class="line">    }</span><br><span class="line">    pthread_exit(NULL);</span><br><span class="line">}</span><br><span class="line">int main (int argc, char *argv[])</span><br><span class="line">{</span><br><span class="line">    int num_threads;</span><br><span class="line">    if (argc &gt; 1){</span><br><span class="line">        num_threads = atoi(argv[1]);</span><br><span class="line">    }</span><br><span class="line">    if (num_threads&lt;=0 || num_threads&gt;=100){</span><br><span class="line">        num_threads = NUM_THREADS;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /* &#x8BBE;&#x7F6E;CPU&#x5229;&#x7528;&#x7387;&#x4E3A;50% */</span><br><span class="line">    mkdir(&quot;/sys/fs/cgroup/cpu/haoel&quot;, 755);</span><br><span class="line">    system(&quot;echo 50000 &gt; /sys/fs/cgroup/cpu/haoel/cpu.cfs_quota_us&quot;);</span><br><span class="line"></span><br><span class="line">    mkdir(&quot;/sys/fs/cgroup/cpuset/haoel&quot;, 755);</span><br><span class="line">    /* &#x9650;&#x5236;CPU&#x53EA;&#x80FD;&#x4F7F;&#x7528;#2&#x6838;&#x548C;#3&#x6838; */</span><br><span class="line">    system(&quot;echo \&quot;2,3\&quot; &gt; /sys/fs/cgroup/cpuset/haoel/cpuset.cpus&quot;);</span><br><span class="line"></span><br><span class="line">    pthread_t* threads = (pthread_t*) malloc (sizeof(pthread_t)*num_threads);</span><br><span class="line">    int rc;</span><br><span class="line">    long t;</span><br><span class="line">    for(t=0; t&lt;num_threads; t++){</span><br><span class="line">        printf(&quot;In main: creating thread %ld\n&quot;, t);</span><br><span class="line">        rc = pthread_create(&amp;threads[t], NULL, thread_main, (void *)t);</span><br><span class="line">        if (rc){</span><br><span class="line">            printf(&quot;ERROR; return code from pthread_create() is %d\n&quot;, rc);</span><br><span class="line">            exit(-1);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /* Last thing that main() should do */</span><br><span class="line">    pthread_exit(NULL);</span><br><span class="line">    free(threads);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h2 id="&#x5185;&#x5B58;&#x4F7F;&#x7528;&#x9650;&#x5236;"><a href="#&#x5185;&#x5B58;&#x4F7F;&#x7528;&#x9650;&#x5236;" class="headerlink" title="&#x5185;&#x5B58;&#x4F7F;&#x7528;&#x9650;&#x5236;"></a>&#x5185;&#x5B58;&#x4F7F;&#x7528;&#x9650;&#x5236;</h2><p>&#x6D4B;&#x8BD5;&#x4E00;&#x4E2A;&#x8017;&#x5C3D;&#x5185;&#x5B58;&#x7684;&#x7A0B;&#x5E8F;&#xFF0C;&#x9650;&#x5236;&#x5185;&#x5B58;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x7A0B;&#x5E8F;&#x4F1A;&#x88AB;kill</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">#include &lt;sys/types.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line"></span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">    int size = 0;</span><br><span class="line">    int chunk_size = 512;</span><br><span class="line">    void *p = NULL;</span><br><span class="line"></span><br><span class="line">    while(1) {</span><br><span class="line"></span><br><span class="line">        if ((p = malloc(chunk_size)) == NULL) {</span><br><span class="line">            printf(&quot;out of memory!!\n&quot;);</span><br><span class="line">            break;</span><br><span class="line">        }</span><br><span class="line">        memset(p, 1, chunk_size);</span><br><span class="line">        size += chunk_size;</span><br><span class="line">        printf(&quot;[%d] - memory is allocated [%8d] bytes \n&quot;, getpid(), size);</span><br><span class="line">        sleep(1);</span><br><span class="line">    }</span><br><span class="line">    return 0;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;root@container:~/testcgroup# mkdir /sys/fs/cgroup/memory/wanglei</span><br><span class="line">root@container:~/testcgroup# echo 64k &gt; /sys/fs/cgroup/memory/wanglei/memory.limit_in_bytes</span><br><span class="line">root@container:~/testcgroup# echo [pid] &gt; /sys/fs/cgroup/memory/haoel/tasks^C</span><br></pre></td></tr></table></figure>

<h2 id="&#x78C1;&#x76D8;I-O&#x9650;&#x5236;"><a href="#&#x78C1;&#x76D8;I-O&#x9650;&#x5236;" class="headerlink" title="&#x78C1;&#x76D8;I/O&#x9650;&#x5236;"></a>&#x78C1;&#x76D8;I/O&#x9650;&#x5236;</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;root@container:~/testcgroup# dd if=/dev/vda of=/dev/null</span><br><span class="line"></span><br><span class="line">iotop-&gt;</span><br><span class="line">  TID  PRIO  USER     DISK READ  DISK WRITE  SWAPIN     IO&gt;    COMMAND</span><br><span class="line">15660 be/4 root       73.81 M/s    0.00 B/s  0.00 % 82.47 % dd if=/dev/vda of=/dev/null</span><br><span class="line"></span><br><span class="line">root@container:~/testcgroup# mkdir /sys/fs/cgroup/blkio/wanglei</span><br><span class="line">root@container:~/testcgroup# ls -l /dev/vda</span><br><span class="line">brw-rw---- 1 root disk 253, 0 Sep 25 12:49 /dev/vda</span><br><span class="line">root@container:~/testcgroup# echo &quot;253:0 1048576&quot; &gt; /sys/fs/cgroup/blkio/wanglei/blkio.throttle.read_bps_device</span><br><span class="line">root@container:~/testcgroup# echo 16221  &gt; /sys/fs/cgroup/blkio/wanglei/tasks</span><br><span class="line"></span><br><span class="line">iotop-&gt; &#x9650;&#x5236;&#x5F97;&#x4E0D;&#x662F;&#x5F88;&#x51C6;</span><br><span class="line">  TID  PRIO  USER     DISK READ  DISK WRITE  SWAPIN     IO&gt;    COMMAND</span><br><span class="line">16221 be/4 root      978.21 K/s    0.00 B/s  0.00 % 95.28 % dd if=/dev/vda of=/dev/null</span><br></pre></td></tr></table></figure>

<h2 id="CGroup&#x7684;&#x5B50;&#x7CFB;&#x7EDF;"><a href="#CGroup&#x7684;&#x5B50;&#x7CFB;&#x7EDF;" class="headerlink" title="CGroup&#x7684;&#x5B50;&#x7CFB;&#x7EDF;"></a>CGroup&#x7684;&#x5B50;&#x7CFB;&#x7EDF;</h2><ul>
<li>blkio&#xFF1A; &#x8FD9;&#x4E2A;subsystem&#x53EF;&#x4EE5;&#x4E3A;&#x5757;&#x8BBE;&#x5907;&#x8BBE;&#x5B9A;&#x8F93;&#x5165;/&#x8F93;&#x51FA;&#x9650;&#x5236;&#xFF0C;&#x6BD4;&#x5982;&#x7269;&#x7406;&#x9A71;&#x52A8;&#x8BBE;&#x5907;&#xFF08;&#x5305;&#x62EC;&#x78C1;&#x76D8;&#x3001;&#x56FA;&#x6001;&#x786C;&#x76D8;&#x3001;USB&#x7B49;&#xFF09;&#x3002;</li>
<li>cpu&#xFF1A; &#x8FD9;&#x4E2A;subsystem&#x4F7F;&#x7528;&#x8C03;&#x5EA6;&#x7A0B;&#x5E8F;&#x63A7;&#x5236;task&#x5BF9;CPU&#x7684;&#x4F7F;&#x7528;&#x3002;</li>
<li>cpuacct&#xFF1A; &#x8FD9;&#x4E2A;subsystem&#x81EA;&#x52A8;&#x751F;&#x6210;cgroup&#x4E2D;task&#x5BF9;CPU&#x8D44;&#x6E90;&#x4F7F;&#x7528;&#x60C5;&#x51B5;&#x7684;&#x62A5;&#x544A;&#x3002;</li>
<li>cpuset&#xFF1A; &#x8FD9;&#x4E2A;subsystem&#x53EF;&#x4EE5;&#x4E3A;cgroup&#x4E2D;&#x7684;task&#x5206;&#x914D;&#x72EC;&#x7ACB;&#x7684;CPU&#xFF08;&#x6B64;&#x5904;&#x9488;&#x5BF9;&#x591A;&#x5904;&#x7406;&#x5668;&#x7CFB;&#x7EDF;&#xFF09;&#x548C;&#x5185;&#x5B58;&#x3002;</li>
<li>devices &#x8FD9;&#x4E2A;subsystem&#x53EF;&#x4EE5;&#x5F00;&#x542F;&#x6216;&#x5173;&#x95ED;cgroup&#x4E2D;task&#x5BF9;&#x8BBE;&#x5907;&#x7684;&#x8BBF;&#x95EE;&#x3002;</li>
<li>freezer &#x8FD9;&#x4E2A;subsystem&#x53EF;&#x4EE5;&#x6302;&#x8D77;&#x6216;&#x6062;&#x590D;cgroup&#x4E2D;&#x7684;task&#x3002;</li>
<li>memory &#x8FD9;&#x4E2A;subsystem&#x53EF;&#x4EE5;&#x8BBE;&#x5B9A;cgroup&#x4E2D;task&#x5BF9;&#x5185;&#x5B58;&#x4F7F;&#x7528;&#x91CF;&#x7684;&#x9650;&#x5B9A;&#xFF0C;&#x5E76;&#x4E14;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x8FD9;&#x4E9B;task&#x5BF9;&#x5185;&#x5B58;&#x8D44;&#x6E90;&#x4F7F;&#x7528;&#x60C5;&#x51B5;&#x7684;&#x62A5;&#x544A;&#x3002;</li>
<li>perfevent &#x8FD9;&#x4E2A;subsystem&#x4F7F;&#x7528;&#x540E;&#x4F7F;&#x5F97;cgroup&#x4E2D;&#x7684;task&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x7EDF;&#x4E00;&#x7684;&#x6027;&#x80FD;&#x6D4B;&#x8BD5;&#x3002;{![perf: Linux CPU&#x6027;&#x80FD;&#x63A2;&#x6D4B;&#x5668;&#xFF0C;&#x8BE6;&#x89C1;<a href="/external_links/dc07f9b78d7d47604a887fb751616d52.html" target="blank" rel="noopener">perf.wiki.kernel.org/index.php/M&#x2026;</a></li>
<li>*net_cls &#x8FD9;&#x4E2A;subsystem Docker&#x6CA1;&#x6709;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#xFF0C;&#x5B83;&#x901A;&#x8FC7;&#x4F7F;&#x7528;&#x7B49;&#x7EA7;&#x8BC6;&#x522B;&#x7B26;(classid)&#x6807;&#x8BB0;&#x7F51;&#x7EDC;&#x6570;&#x636E;&#x5305;&#xFF0C;&#x4ECE;&#x800C;&#x5141;&#x8BB8; Linux &#x6D41;&#x91CF;&#x63A7;&#x5236;&#x7A0B;&#x5E8F;&#xFF08;TC&#xFF1A;Traffic Controller&#xFF09;&#x8BC6;&#x522B;&#x4ECE;&#x5177;&#x4F53;cgroup&#x4E2D;&#x751F;&#x6210;&#x7684;&#x6570;&#x636E;&#x5305;&#x3002;</li>
</ul>
<h2 id="&#x7EC4;&#x7EC7;&#x7ED3;&#x6784;&#x4E0E;&#x57FA;&#x672C;&#x89C4;&#x5219;"><a href="#&#x7EC4;&#x7EC7;&#x7ED3;&#x6784;&#x4E0E;&#x57FA;&#x672C;&#x89C4;&#x5219;" class="headerlink" title="&#x7EC4;&#x7EC7;&#x7ED3;&#x6784;&#x4E0E;&#x57FA;&#x672C;&#x89C4;&#x5219;"></a>&#x7EC4;&#x7EC7;&#x7ED3;&#x6784;&#x4E0E;&#x57FA;&#x672C;&#x89C4;&#x5219;</h2><p>&#x5927;&#x5BB6;&#x5728;namespace&#x6280;&#x672F;&#x7684;&#x8BB2;&#x89E3;&#x4E2D;&#x5DF2;&#x7ECF;&#x4E86;&#x89E3;&#x5230;&#xFF0C;&#x4F20;&#x7EDF;&#x7684;Unix&#x8FDB;&#x7A0B;&#x7BA1;&#x7406;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x5148;&#x542F;&#x52A8;init&#x8FDB;&#x7A0B;&#x4F5C;&#x4E3A;&#x6839;&#x8282;&#x70B9;&#xFF0C;&#x518D;&#x7531;init&#x8282;&#x70B9;&#x521B;&#x5EFA;&#x5B50;&#x8FDB;&#x7A0B;&#x4F5C;&#x4E3A;&#x5B50;&#x8282;&#x70B9;&#xFF0C;&#x800C;&#x6BCF;&#x4E2A;&#x5B50;&#x8282;&#x70B9;&#x7531;&#x53EF;&#x4EE5;&#x521B;&#x5EFA;&#x65B0;&#x7684;&#x5B50;&#x8282;&#x70B9;&#xFF0C;&#x5982;&#x6B64;&#x5F80;&#x590D;&#xFF0C;&#x5F62;&#x6210;&#x4E00;&#x4E2A;&#x6811;&#x72B6;&#x7ED3;&#x6784;&#x3002;&#x800C;cgroups&#x4E5F;&#x662F;&#x7C7B;&#x4F3C;&#x7684;&#x6811;&#x72B6;&#x7ED3;&#x6784;&#xFF0C;&#x5B50;&#x8282;&#x70B9;&#x90FD;&#x4ECE;&#x7236;&#x8282;&#x70B9;&#x7EE7;&#x627F;&#x5C5E;&#x6027;&#x3002;</p>
<p>&#x5B83;&#x4EEC;&#x6700;&#x5927;&#x7684;&#x4E0D;&#x540C;&#x5728;&#x4E8E;&#xFF0C;&#x7CFB;&#x7EDF;&#x4E2D;cgroup&#x6784;&#x6210;&#x7684;hierarchy&#x53EF;&#x4EE5;&#x5141;&#x8BB8;&#x5B58;&#x5728;&#x591A;&#x4E2A;&#x3002;&#x5982;&#x679C;&#x8FDB;&#x7A0B;&#x6A21;&#x578B;&#x662F;&#x7531;init&#x4F5C;&#x4E3A;&#x6839;&#x8282;&#x70B9;&#x6784;&#x6210;&#x7684;&#x4E00;&#x68F5;&#x6811;&#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x4E48;cgroups&#x7684;&#x6A21;&#x578B;&#x5219;&#x662F;&#x7531;&#x591A;&#x4E2A;hierarchy&#x6784;&#x6210;&#x7684;&#x68EE;&#x6797;&#x3002;&#x8FD9;&#x6837;&#x505A;&#x7684;&#x76EE;&#x7684;&#x4E5F;&#x5F88;&#x597D;&#x7406;&#x89E3;&#xFF0C;&#x5982;&#x679C;&#x53EA;&#x6709;&#x4E00;&#x4E2A;hierarchy&#xFF0C;&#x90A3;&#x4E48;&#x6240;&#x6709;&#x7684;task&#x90FD;&#x8981;&#x53D7;&#x5230;&#x7ED1;&#x5B9A;&#x5176;&#x4E0A;&#x7684;subsystem&#x7684;&#x9650;&#x5236;&#xFF0C;&#x4F1A;&#x7ED9;&#x90A3;&#x4E9B;&#x4E0D;&#x9700;&#x8981;&#x8FD9;&#x4E9B;&#x9650;&#x5236;&#x7684;task&#x9020;&#x6210;&#x9EBB;&#x70E6;&#x3002;</p>
<p>&#x4E86;&#x89E3;&#x4E86;cgroups&#x7684;&#x7EC4;&#x7EC7;&#x7ED3;&#x6784;&#xFF0C;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x4E86;&#x89E3;cgroup&#x3001;task&#x3001;subsystem&#x4EE5;&#x53CA;hierarchy&#x56DB;&#x8005;&#x95F4;&#x7684;&#x76F8;&#x4E92;&#x5173;&#x7CFB;&#x53CA;&#x5176;&#x57FA;&#x672C;&#x89C4;&#x5219;{![&#x53C2;&#x7167;&#x81EA;&#xFF1A;<a href="/external_links/83a8001b8164522aea03e0c74ea640bb.html" target="blank" rel="noopener">access.redhat.com/documentati&#x2026;</a></p>
<p>&#x89C4;&#x5219;1&#xFF1A; &#x540C;&#x4E00;&#x4E2A;hierarchy&#x53EF;&#x4EE5;&#x9644;&#x52A0;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;subsystem&#x3002;&#x5982;&#x4E0B;&#x56FE;1&#xFF0C;cpu&#x548C;memory&#x7684;subsystem&#x9644;&#x52A0;&#x5230;&#x4E86;&#x4E00;&#x4E2A;hierarchy&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/7cec89dfc91eb3df234c07d5772f6ae6f0b047007d4a8d4531a26e51be653f90" alt="image"></p>
<p>image</p>
<p>&#x56FE;1 &#x540C;&#x4E00;&#x4E2A;hierarchy&#x53EF;&#x4EE5;&#x9644;&#x52A0;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;subsystem</p>
<p>&#x89C4;&#x5219;2&#xFF1A; &#x4E00;&#x4E2A;subsystem&#x53EF;&#x4EE5;&#x9644;&#x52A0;&#x5230;&#x591A;&#x4E2A;hierarchy&#xFF0C;&#x5F53;&#x4E14;&#x4EC5;&#x5F53;&#x8FD9;&#x4E9B;hierarchy&#x53EA;&#x6709;&#x8FD9;&#x552F;&#x4E00;&#x4E00;&#x4E2A;subsystem&#x3002;&#x5982;&#x4E0B;&#x56FE;2&#xFF0C;&#x5C0F;&#x5708;&#x4E2D;&#x7684;&#x6570;&#x5B57;&#x8868;&#x793A;subsystem&#x9644;&#x52A0;&#x7684;&#x65F6;&#x95F4;&#x987A;&#x5E8F;&#xFF0C;CPU subsystem&#x9644;&#x52A0;&#x5230;hierarchy A&#x7684;&#x540C;&#x65F6;&#x4E0D;&#x80FD;&#x518D;&#x9644;&#x52A0;&#x5230;hierarchy B&#xFF0C;&#x56E0;&#x4E3A;hierarchy B&#x5DF2;&#x7ECF;&#x9644;&#x52A0;&#x4E86;memory subsystem&#x3002;&#x5982;&#x679C;hierarchy B&#x4E0E;hierarchy A&#x72B6;&#x6001;&#x76F8;&#x540C;&#xFF0C;&#x6CA1;&#x6709;&#x9644;&#x52A0;&#x8FC7;memory subsystem&#xFF0C;&#x90A3;&#x4E48;CPU subsystem&#x540C;&#x65F6;&#x9644;&#x52A0;&#x5230;&#x4E24;&#x4E2A;hierarchy&#x662F;&#x53EF;&#x4EE5;&#x7684;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/1deb6215b34d7b38a4a9966b876fb8d0c8b8b7a1b4bec16a659971bf169c4355" alt="image"></p>
<p>image</p>
<p>&#x56FE;2 &#x4E00;&#x4E2A;&#x5DF2;&#x7ECF;&#x9644;&#x52A0;&#x5728;&#x67D0;&#x4E2A;hierarchy&#x4E0A;&#x7684;subsystem&#x4E0D;&#x80FD;&#x9644;&#x52A0;&#x5230;&#x5176;&#x4ED6;&#x542B;&#x6709;&#x522B;&#x7684;subsystem&#x7684;hierarchy&#x4E0A;<br>&#x89C4;&#x5219;3&#xFF1A; &#x7CFB;&#x7EDF;&#x6BCF;&#x6B21;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;hierarchy&#x65F6;&#xFF0C;&#x8BE5;&#x7CFB;&#x7EDF;&#x4E0A;&#x7684;&#x6240;&#x6709;task&#x9ED8;&#x8BA4;&#x6784;&#x6210;&#x4E86;&#x8FD9;&#x4E2A;&#x65B0;&#x5EFA;&#x7684;hierarchy&#x7684;&#x521D;&#x59CB;&#x5316;cgroup&#xFF0C;&#x8FD9;&#x4E2A;cgroup&#x4E5F;&#x79F0;&#x4E3A;root cgroup&#x3002;&#x5BF9;&#x4E8E;&#x4F60;&#x521B;&#x5EFA;&#x7684;&#x6BCF;&#x4E2A;hierarchy&#xFF0C;task&#x53EA;&#x80FD;&#x5B58;&#x5728;&#x4E8E;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;cgroup&#x4E2D;&#xFF0C;&#x5373;&#x4E00;&#x4E2A;task&#x4E0D;&#x80FD;&#x5B58;&#x5728;&#x4E8E;&#x540C;&#x4E00;&#x4E2A;hierarchy&#x7684;&#x4E0D;&#x540C;cgroup&#x4E2D;&#xFF0C;&#x4F46;&#x662F;&#x4E00;&#x4E2A;task&#x53EF;&#x4EE5;&#x5B58;&#x5728;&#x5728;&#x4E0D;&#x540C;hierarchy&#x4E2D;&#x7684;&#x591A;&#x4E2A;cgroup&#x4E2D;&#x3002;&#x5982;&#x679C;&#x64CD;&#x4F5C;&#x65F6;&#x628A;&#x4E00;&#x4E2A;task&#x6DFB;&#x52A0;&#x5230;&#x540C;&#x4E00;&#x4E2A;hierarchy&#x4E2D;&#x7684;&#x53E6;&#x4E00;&#x4E2A;cgroup&#x4E2D;&#xFF0C;&#x5219;&#x4F1A;&#x4ECE;&#x7B2C;&#x4E00;&#x4E2A;cgroup&#x4E2D;&#x79FB;&#x9664;&#x3002;&#x5728;&#x4E0B;&#x56FE;3&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;httpd&#x8FDB;&#x7A0B;&#x5DF2;&#x7ECF;&#x52A0;&#x5165;&#x5230;hierarchy A&#x4E2D;&#x7684;/cg1&#x800C;&#x4E0D;&#x80FD;&#x52A0;&#x5165;&#x540C;&#x4E00;&#x4E2A;hierarchy&#x4E2D;&#x7684;/cg2&#xFF0C;&#x4F46;&#x662F;&#x53EF;&#x4EE5;&#x52A0;&#x5165;hierarchy B&#x4E2D;&#x7684;/cg3&#x3002;&#x5B9E;&#x9645;&#x4E0A;&#x4E0D;&#x5141;&#x8BB8;&#x52A0;&#x5165;&#x540C;&#x4E00;&#x4E2A;hierarchy&#x4E2D;&#x7684;&#x5176;&#x4ED6;cgroup&#x91CE;&#x751F;&#x4E3A;&#x4E86;&#x9632;&#x6B62;&#x51FA;&#x73B0;&#x77DB;&#x76FE;&#xFF0C;&#x5982;CPU subsystem&#x4E3A;/cg1&#x5206;&#x914D;&#x4E86;30%&#xFF0C;&#x800C;&#x4E3A;/cg2&#x5206;&#x914D;&#x4E86;50%&#xFF0C;&#x6B64;&#x65F6;&#x5982;&#x679C;httpd&#x5728;&#x8FD9;&#x4E24;&#x4E2A;cgroup&#x4E2D;&#xFF0C;&#x5C31;&#x4F1A;&#x51FA;&#x73B0;&#x77DB;&#x76FE;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/b2ecb4620cea557a645d7a6fa5776be50dbc7bf6e3a215560673ef3f552fad30" alt="image"></p>
<p>image</p>
<p>&#x56FE;3 &#x4E00;&#x4E2A;task&#x4E0D;&#x80FD;&#x5C5E;&#x4E8E;&#x540C;&#x4E00;&#x4E2A;hierarchy&#x7684;&#x4E0D;&#x540C;cgroup<br>&#x89C4;&#x5219;4&#xFF1A; &#x8FDB;&#x7A0B;&#xFF08;task&#xFF09;&#x5728;fork&#x81EA;&#x8EAB;&#x65F6;&#x521B;&#x5EFA;&#x7684;&#x5B50;&#x4EFB;&#x52A1;&#xFF08;child task&#xFF09;&#x9ED8;&#x8BA4;&#x4E0E;&#x539F;task&#x5728;&#x540C;&#x4E00;&#x4E2A;cgroup&#x4E2D;&#xFF0C;&#x4F46;&#x662F;child task&#x5141;&#x8BB8;&#x88AB;&#x79FB;&#x52A8;&#x5230;&#x4E0D;&#x540C;&#x7684;cgroup&#x4E2D;&#x3002;&#x5373;fork&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x7236;&#x5B50;&#x8FDB;&#x7A0B;&#x95F4;&#x662F;&#x5B8C;&#x5168;&#x72EC;&#x7ACB;&#x7684;&#x3002;&#x5982;&#x4E0B;&#x56FE;4&#x4E2D;&#xFF0C;&#x5C0F;&#x5708;&#x4E2D;&#x7684;&#x6570;&#x5B57;&#x8868;&#x793A;task &#x51FA;&#x73B0;&#x7684;&#x65F6;&#x95F4;&#x987A;&#x5E8F;&#xFF0C;&#x5F53;httpd&#x521A;fork&#x51FA;&#x53E6;&#x4E00;&#x4E2A;httpd&#x65F6;&#xFF0C;&#x5728;&#x540C;&#x4E00;&#x4E2A;hierarchy&#x4E2D;&#x7684;&#x540C;&#x4E00;&#x4E2A;cgroup&#x4E2D;&#x3002;&#x4F46;&#x662F;&#x968F;&#x540E;&#x5982;&#x679C;PID&#x4E3A;4840&#x7684;httpd&#x9700;&#x8981;&#x79FB;&#x52A8;&#x5230;&#x5176;&#x4ED6;cgroup&#x4E5F;&#x662F;&#x53EF;&#x4EE5;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x7236;&#x5B50;&#x4EFB;&#x52A1;&#x95F4;&#x5DF2;&#x7ECF;&#x72EC;&#x7ACB;&#x3002;&#x603B;&#x7ED3;&#x8D77;&#x6765;&#x5C31;&#x662F;&#xFF1A;&#x521D;&#x59CB;&#x5316;&#x65F6;&#x5B50;&#x4EFB;&#x52A1;&#x4E0E;&#x7236;&#x4EFB;&#x52A1;&#x5728;&#x540C;&#x4E00;&#x4E2A;cgroup&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x79CD;&#x5173;&#x7CFB;&#x968F;&#x540E;&#x53EF;&#x4EE5;&#x6539;&#x53D8;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/229cec92b4fa1401e3e4e8b2607e9135a9f11cf24c452d2b44ec07fa41f46935" alt="image"></p>
<p>image</p>
<p>&#x56FE;4 &#x521A;fork&#x51FA;&#x7684;&#x5B50;&#x8FDB;&#x7A0B;&#x5728;&#x521D;&#x59CB;&#x72B6;&#x6001;&#x4E0E;&#x5176;&#x7236;&#x8FDB;&#x7A0B;&#x5904;&#x4E8E;&#x540C;&#x4E00;&#x4E2A;cgroup<br>&#x8865;&#x5145;<br>==</p>
<h2 id="systemd"><a href="#systemd" class="headerlink" title="systemd"></a>systemd</h2><p>kuberlet&#x6709;&#x4E2A;systemd&#x6587;&#x6863;&#x8FD9;&#x4E48;&#x8BF4;&#xFF1A;<br>This document describes how the node should be configured, and a set of enhancements that should be made to the kubelet to better integrate with these distributions independent of container runtime.</p>
<p>The Kernel direction for cgroup management is to promote a single-writer model rather than allowing multiple processes to independently write to parts of the file-system.In distributions that run systemd as their init system, the cgroup tree is managed by systemd by default since it implicitly interacts with the cgroup tree when starting units. Manual changes made by other cgroup managers to the cgroup tree are not guaranteed to be preserved unless systemd is made aware. systemd can be told to ignore sections of the cgroup tree by configuring the unit to have the Delegate= option.</p>
<p>&#x662F;&#x8BF4;&#x518D;linux&#x4E0A;&#x5C31;&#x63A8;&#x8350;&#x7528;systemd&#x6765;&#x7BA1;&#x7406;cgroup?&#x800C;&#x4E14;&#x8FD9;&#x6837;&#x8FD8;&#x80FD;&#x4E0D;&#x4F9D;&#x8D56;docker?</p>
<h2 id="sysctl"><a href="#sysctl" class="headerlink" title="sysctl"></a>sysctl</h2><p>&#x9664;&#x4E86;cgroup&#x505A;&#x8D44;&#x6E90;&#x9650;&#x5236;&#xFF0C;&#x5BF9;&#x4E8E;&#x7CFB;&#x7EDF;&#x7EA7;&#x522B;&#x7684;&#x8D44;&#x6E90;&#x9650;&#x5236;&#x76F8;&#x5173;&#x7684;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;sysctl&#x547D;&#x4EE4;<br>sysctl&#x547D;&#x4EE4;&#x88AB;&#x7528;&#x4E8E;&#x5728;&#x5185;&#x6838;&#x8FD0;&#x884C;&#x65F6;&#x52A8;&#x6001;&#x5730;&#x4FEE;&#x6539;&#x5185;&#x6838;&#x7684;&#x8FD0;&#x884C;&#x53C2;&#x6570;&#xFF0C;&#x53EF;&#x7528;&#x7684;&#x5185;&#x6838;&#x53C2;&#x6570;&#x5728;&#x76EE;&#x5F55;/proc/sys&#x4E2D;&#x3002;&#x5B83;&#x5305;&#x542B;&#x4E00;&#x4E9B;TCP/ip&#x5806;&#x6808;&#x548C;&#x865A;&#x62DF;&#x5185;&#x5B58;&#x7CFB;&#x7EDF;&#x7684;&#x9AD8;&#x7EA7;&#x9009;&#x9879;&#xFF0C; &#x8FD9;&#x53EF;&#x4EE5;&#x8BA9;&#x6709;&#x7ECF;&#x9A8C;&#x7684;&#x7BA1;&#x7406;&#x5458;&#x63D0;&#x9AD8;&#x5F15;&#x4EBA;&#x6CE8;&#x76EE;&#x7684;&#x7CFB;&#x7EDF;&#x6027;&#x80FD;&#x3002;&#x7528;sysctl&#x53EF;&#x4EE5;&#x8BFB;&#x53D6;&#x8BBE;&#x7F6E;&#x8D85;&#x8FC7;&#x4E94;&#x767E;&#x4E2A;&#x7CFB;&#x7EDF;&#x53D8;&#x91CF;&#x3002;<br> Parameters are available via /proc/sys/ virtual process file system. The parameters cover various subsystems such as:</p>
<ul>
<li>kernel (common prefix: kernel.)</li>
<li>networking (common prefix: net.)</li>
<li>virtual memory (common prefix: vm.)</li>
<li>MDADM (common prefix: dev.)</li>
</ul>
<p>docker privileged&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#xFF0C;&#x4F46;&#x662F;&#x6709;&#x4E9B;&#x53C2;&#x6570;&#x662F;&#x7CFB;&#x7EDF;&#x7EA7;&#x522B;&#x7684;&#xFF0C;&#x6CA1;&#x6709;&#x9694;&#x79BB;&#xFF0C;&#x6539;&#x4E86;&#x4F1A;&#x5F71;&#x54CD;&#x522B;&#x7684;&#x5BB9;&#x5668;&#x3002;&#x540E;&#x6765;&#x7248;&#x672C;docker&#x505A;&#x4E86;&#x9650;&#x5236;&#xFF0C;&#x53EA;&#x80FD;&#x6539;&#x4E00;&#x4E9B;whitelisted sysctls&#x3002;<br>Only namespaced kernel parameters can be modified<br>k8s&#x91CC;&#x9762;&#x7684;&#x8BBE;&#x7F6E;<a href="/external_links/0058fbbf97a30fd40c4a71fb1bf10aca.html" target="blank" rel="noopener">github.com/kubernetes/&#x2026;</a></p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/59ebab96df95b0ec2f43adecf6cb5743.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903512485150734.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903512485150734.html" itemprop="url">Go 中任务队列的简单实现</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-20T12:03:08+08:00">
                2017-11-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>At <a href="/external_links/3b9924111f4b4e42a6f5b355ace6c8a8.html" target="blank" rel="noopener">RapidLoop</a>, we use <a href="/external_links/f81accd2393b67eb852f5cd56ba50885.html" target="blank" rel="noopener">Go</a> for nearly everything, including our server, service and uptime monitoring product <a href="/external_links/d9639ec177271421876919d33f4f6b44.html" target="blank" rel="noopener">OpsDash</a>.</p>
<p>Go is quite good at asynchronous processing &#x2013; goroutines and channels are arguably simpler, less error-prone and yet as powerful compared to async/awaits, promises and futures from other languages. Read on to see some interesting Go code around <em>job queues</em>.</p>
<h4 id="The-&#x201C;No-Job-Queue&#x201D;-Job-Queue"><a href="#The-&#x201C;No-Job-Queue&#x201D;-Job-Queue" class="headerlink" title="The &#x201C;No-Job-Queue&#x201D; Job Queue"></a>The &#x201C;No-Job-Queue&#x201D; Job Queue</h4><p>Let&#x2019;s start with a bit of Zen &#x2013; sometimes you just don&#x2019;t need a job queue. Processing a job asynchronously can be done with:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;go process(job)</span><br></pre></td></tr></table></figure>

<p>This is indeed the best option for some needs, like firing off an email while handling an HTTP request. Whether you need a more elaborate infrastructure to deal with job processing depends mostly on scale and complexity. Queuing up your jobs and processing<br> them in a controlled manner allows you to add more functionality like bounding the number of concurrent jobs, producer throttling and so on.</p>
<h4 id="The-Simplest-Job-Queue"><a href="#The-Simplest-Job-Queue" class="headerlink" title="The Simplest Job Queue"></a>The Simplest Job Queue</h4><p>Here is a simple queue and a worker that processes jobs off the queue. Goroutines and channels are just the right abstractions needed to code this into an elegant, tight piece.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;func worker(jobChan &lt;-chan Job) {</span><br><span class="line">    for job := range jobChan {</span><br><span class="line">        process(job)</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// make a channel with a capacity of 100.</span><br><span class="line">jobChan := make(chan Job, 100)</span><br><span class="line"></span><br><span class="line">// start the worker</span><br><span class="line">go worker(jobChan)</span><br><span class="line"></span><br><span class="line">// enqueue a job</span><br><span class="line">jobChan &lt;- job</span><br></pre></td></tr></table></figure>

<p>The code basically creates a channel of <code>Job</code> objects, with a capacity of 100. It then starts a worker goroutine called <code>worker</code>. The worker pops jobs off the channel and processes them, one at a time. Jobs can be enqueued by pushing<br> a <code>Job</code> object into the channel.</p>
<p>Although there are just a few lines of code, there&#x2019;s a lot going on. First off, you have safe, correct, race-free code without having to mess with threads and mutexes.</p>
<p>Another feature is producer throttling.</p>
<h4 id="Producer-Throttling"><a href="#Producer-Throttling" class="headerlink" title="Producer Throttling"></a>Producer Throttling</h4><p>The channel is created with a capacity of 100:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// make a channel with a capacity of 100.</span><br><span class="line">jobChan := make(chan Job, 100)</span><br></pre></td></tr></table></figure>

<p>which means that the enqueuing of a job like so:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// enqueue a job</span><br><span class="line">jobChan &lt;- job</span><br></pre></td></tr></table></figure>

<p>will block, if there already are 100 jobs in the channel that the worker hasn&#x2019;t got around to servicing. This is usually a good thing. You don&#x2019;t want the backlog of jobs to grow too big if there is a SLA/QoS constraint, or even a reasonable assumption,<br> that a job must finish within a certain amount of time. For example, if a job takes 1 second to finish in the worst case, with a channel capacity of 100 you&#x2019;re looking at a worst case job finish time of 100 seconds.</p>
<p>If the channel is full, you&#x2019;ll want your caller to back off for a while, typically. For example, it this were a REST API call, you might return a 503 (service unavailable) error code and document that the caller has to retry after a wait. This way, you&#x2019;re<br> applying <strong>backpressure</strong> up the caller chain to maintain a predictable quality of service.</p>
<h4 id="Enqueueing-Without-Blocking"><a href="#Enqueueing-Without-Blocking" class="headerlink" title="Enqueueing Without Blocking"></a>Enqueueing Without Blocking</h4><p>So how would you only <em>try</em> to enqueue, and fail if the operation would block? That way you can fail the job submission operation, and say return a 503. The trick is to use a <code>select</code> with a <code>default</code> clause:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// TryEnqueue tries to enqueue a job to the given job channel. Returns true if</span><br><span class="line">// the operation was successful, and false if enqueuing would not have been</span><br><span class="line">// possible without blocking. Job is not enqueued in the latter case.</span><br><span class="line">func TryEnqueue(job Job, jobChan &lt;-chan Job) bool {</span><br><span class="line">    select {</span><br><span class="line">    case jobChan &lt;- job:</span><br><span class="line">        return true</span><br><span class="line">    default:</span><br><span class="line">        return false</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>With this, you can fail the submission this way:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;if !TryEnqueue(job, chan) {</span><br><span class="line">    http.Error(w, &quot;max capacity reached&quot;, 503)</span><br><span class="line">    return</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="Stopping-the-Worker"><a href="#Stopping-the-Worker" class="headerlink" title="Stopping the Worker"></a>Stopping the Worker</h4><p>OK, so far so good. Now how can we stop the worker gracefully? Assuming that we&#x2019;ve decided not to enqueue any more jobs and we want to let all the enqueued jobs finish, we can simply do:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;close(jobChan)</span><br></pre></td></tr></table></figure>

<p>Yes, that&#x2019;s all there is. This works because the worker pops jobs off the queue with a for..range loop:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;for job := range jobChan {...}</span><br></pre></td></tr></table></figure>

<p>and this loop will exit when the channel is closed. All jobs enqueued into the channel before the channel was closed, will be popped out by the worker and processed as usual.</p>
<h4 id="Waiting-for-the-Worker"><a href="#Waiting-for-the-Worker" class="headerlink" title="Waiting for the Worker"></a>Waiting for the Worker</h4><p>That was pretty easy. But <code>close(jobChan)</code> will not wait for the goroutine to exit. For that, we&#x2019;ll use a <code>sync.WaitGroup</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// use a WaitGroup </span><br><span class="line">var wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line">func worker(jobChan &lt;-chan Job) {</span><br><span class="line">    defer wg.Done()</span><br><span class="line"></span><br><span class="line">    for job := range jobChan {</span><br><span class="line">        process(job)</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// increment the WaitGroup before starting the worker</span><br><span class="line">wg.Add(1)</span><br><span class="line">go worker(jobChan)</span><br><span class="line"></span><br><span class="line">// to stop the worker, first close the job channel</span><br><span class="line">close(jobChan)</span><br><span class="line"></span><br><span class="line">// then wait using the WaitGroup</span><br><span class="line">wg.Wait()</span><br></pre></td></tr></table></figure>

<p>With this, we&#x2019;ll signal the worker to stop by closing the channel, and then wait for the worker goroutine to end with the <code>wg.Wait()</code>.</p>
<p>Note that we&#x2019;ve to increment the wait group <em>before</em> starting the goroutine, and decrement it <em>once</em> from <em>within</em> the goroutine when it exits, irrespective of the return path.</p>
<h4 id="Waiting-with-a-Timeout"><a href="#Waiting-with-a-Timeout" class="headerlink" title="Waiting with a Timeout"></a>Waiting with a Timeout</h4><p>The <code>wg.Wait()</code> will wait forever for the goroutine to exit. But what if we can&#x2019;t afford to wait indefinitely?</p>
<p>Here&#x2019;s a helper function that wraps <code>wg.Wait</code> and adds a timeout:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// WaitTimeout does a Wait on a sync.WaitGroup object but with a specified</span><br><span class="line">// timeout. Returns true if the wait completed without timing out, false</span><br><span class="line">// otherwise.</span><br><span class="line">func WaitTimeout(wg *sync.WaitGroup, timeout time.Duration) bool {</span><br><span class="line">    ch := make(chan struct{})</span><br><span class="line">    go func() {</span><br><span class="line">        wg.Wait()</span><br><span class="line">        close(ch)</span><br><span class="line">    }()</span><br><span class="line">    select {</span><br><span class="line">    case &lt;-ch:</span><br><span class="line">            return true</span><br><span class="line">    case &lt;-time.After(timeout):</span><br><span class="line">            return false</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// now use the WaitTimeout instead of wg.Wait()</span><br><span class="line">WaitTimeout(&amp;wg, 5 * time.Second)</span><br></pre></td></tr></table></figure>

<p>This now let&#x2019;s you wait for your worker to exit, but places a bound on the amount of time it may take to do so.</p>
<h4 id="Cancelling-Workers"><a href="#Cancelling-Workers" class="headerlink" title="Cancelling Workers"></a>Cancelling Workers</h4><p>So far we have allowed our worker the liberty to finish processing it&#x2019;s jobs even after we signalled it to stop. What if we need to say: &#x201C;drop the rest, let&#x2019;s get out of here!&#x201D; to the worker?</p>
<p>Here&#x2019;s how to do it with <code>context.Context</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// create a context that can be cancelled</span><br><span class="line">ctx, cancel := context.WithCancel(context.Background())</span><br><span class="line"></span><br><span class="line">// start the goroutine passing it the context</span><br><span class="line">go worker(ctx, jobChan)</span><br><span class="line"></span><br><span class="line">func worker(ctx context.Context, jobChan &lt;-chan Job) {</span><br><span class="line">    for {</span><br><span class="line">        select {</span><br><span class="line">        case &lt;-ctx.Done():</span><br><span class="line">            return</span><br><span class="line"></span><br><span class="line">        case job := &lt;-jobChan:</span><br><span class="line">            process(job)</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// Invoke cancel when the worker needs to be stopped. This *does not* wait</span><br><span class="line">// for the worker to exit.</span><br><span class="line">cancel()</span><br></pre></td></tr></table></figure>

<p>Basically, we create a &#x201C;cancellable context&#x201D;, and pass this to the worker. The worker waits on this, in addition to the job channel. The <code>ctx.Done()</code> becomes readable when <code>cancel</code> is invoked.</p>
<p>Like with the closing of the job channel, the <code>cancel()</code> will only signal, and does not wait. You&#x2019;ll have to add the wait group code if you need to wait for the worker to exit &#x2013; although the wait should be shorter as the worker will not process<br> the remaining jobs.</p>
<p>However, there is a bit of a gotcha with this code. Consider the case when you have a backlog in the channel (so that &lt;-jobChan will not block), and cancel() has been invoked (so that &lt;-ctx.Done() also will not block). Since neither cases will block,<br> the <code>select</code> has to choose between them. Fairly, one hopes.</p>
<p>Alas, in practice, this is not true. Not only is it plausible that &#x201C;&lt;-jobChan&#x201D; is selected despite &#x201C;&lt;-ctx.Done()&#x201D; also being non-blocking, it happens disconcertingly easily in practice. Even after a job is popped despite the cancellation and there<br> are more pending, the situation remains the same &#x2013; and the runtime is free to make the same &#x201C;mistake&#x201D; again.</p>
<p>To be fair (uh!), what we need is not fairness, but priority. The context cancellation case should have a higher priority than the other. However, there is no easy, built-in way to do this.</p>
<p>A flag might help:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;var flag uint64</span><br><span class="line"></span><br><span class="line">func worker(ctx context.Context, jobChan &lt;-chan Job) {</span><br><span class="line">    for {</span><br><span class="line">        select {</span><br><span class="line">        case &lt;-ctx.Done():</span><br><span class="line">            return</span><br><span class="line"></span><br><span class="line">        case job := &lt;-jobChan:</span><br><span class="line">            process(job)</span><br><span class="line">            if atomic.LoadUint64(&amp;flag) == 1 {</span><br><span class="line">                return</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// set the flag first, before cancelling</span><br><span class="line">atomic.StoreUint64(&amp;flag, 1)</span><br><span class="line">cancel()</span><br></pre></td></tr></table></figure>

<p>We don&#x2019;t check the flag before processing because since we popped the job, we might as well service it, to be consistent. Of course, if bailing out is a higher priority the check can be moved before the processing.</p>
<p>Bottom line? Either live with the fact that your worker might process a few extra jobs before exiting, or design your code carefully to work around the gotchas.</p>
<h4 id="Cancelling-Workers-Without-Context"><a href="#Cancelling-Workers-Without-Context" class="headerlink" title="Cancelling Workers Without Context"></a>Cancelling Workers Without Context</h4><p><code>context.Context</code> is not magic. In fact, for this particular case, not having the context makes the code cleaner and clearer:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// create a cancel channel</span><br><span class="line">cancelChan := make(chan struct{})</span><br><span class="line"></span><br><span class="line">// start the goroutine passing it the cancel channel </span><br><span class="line">go worker(jobChan, cancelChan)</span><br><span class="line"></span><br><span class="line">func worker(jobChan &lt;-chan Job, cancelChan &lt;-chan struct{}) {</span><br><span class="line">    for {</span><br><span class="line">        select {</span><br><span class="line">        case &lt;-cancelChan:</span><br><span class="line">            return</span><br><span class="line"></span><br><span class="line">        case job := &lt;-jobChan:</span><br><span class="line">            process(job)</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// to cancel the worker, close the cancel channel</span><br><span class="line">close(cancelChan)</span><br></pre></td></tr></table></figure>

<p>This is essentially what (simple, non-hierarchical) context cancellation does behind the scenes too. The same gotchas exist, unfortunately.</p>
<h4 id="A-Pool-of-Workers"><a href="#A-Pool-of-Workers" class="headerlink" title="A Pool of Workers"></a>A Pool of Workers</h4><p>And finally, having multiple workers lets you increase your job concurrency. The easiest way is to simply spawn multiple workers and have them read off the same job channel:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;for i:=0; i&lt;workerCount; i++ {</span><br><span class="line">    go worker(jobChan)</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>The rest of the code does not change. There will be multiple workers trying to read from the same channel &#x2013; this is valid, and safe. Only one of the workers will successfully read, and the rest will block.</p>
<p>Again, there is a question of fairness. Ideally, if 100 jobs were processed by 4 workers, each would do 25. However, this may or may not be the case, and your code should not assume fairness.</p>
<p>To wait for workers to exit, add a wait group as usual:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;for i:=0; i&lt;workerCount; i++ {</span><br><span class="line">    wg.Add(1)</span><br><span class="line">    go worker(jobChan)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// wait for all workers to exit</span><br><span class="line">wg.Wait()</span><br></pre></td></tr></table></figure>

<p>For cancelling, you&#x2019;ll have to use a cancel channel per worker, then close all of them.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// create cancel channels</span><br><span class="line">cancelChans := make([]chan struct{}, workerCount)</span><br><span class="line"></span><br><span class="line">for i:=0; i&lt;workerCount; i++ {</span><br><span class="line">    go worker(jobChan, cancelChans[i])</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">for i:=0; i&lt;workerCount; i++ {</span><br><span class="line">    close(cancelChans[i])</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="A-Generic-Job-Queue-Library"><a href="#A-Generic-Job-Queue-Library" class="headerlink" title="A Generic Job Queue Library?"></a>A Generic Job Queue Library?</h4><p>On the face of it, job queues appear simple, and wonderfully suited to spinning off into a generic, reusable component. In reality though, the nitty-gritty details for each different place you&#x2019;d want to use it will likely add to the complexity of the<br> &#x201C;generic&#x201D; component. Couple this with the fact that it&#x2019;s easier to write out a job queue in Go than in most other languages, you&#x2019;re <em>probably</em> better off writing job queues tailored to each requirement.</p>
<h4 id="License"><a href="#License" class="headerlink" title="License"></a>License</h4><p>All code listed above is published under the MIT license:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;Copyright (c) 2017 RapidLoop, Inc.</span><br><span class="line"></span><br><span class="line">Permission is hereby granted, free of charge, to any person obtaining a copy</span><br><span class="line">of this software and associated documentation files (the &quot;Software&quot;), to deal</span><br><span class="line">in the Software without restriction, including without limitation the rights</span><br><span class="line">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span><br><span class="line">copies of the Software, and to permit persons to whom the Software is</span><br><span class="line">furnished to do so, subject to the following conditions:</span><br><span class="line"></span><br><span class="line">The above copyright notice and this permission notice shall be included in</span><br><span class="line">all copies or substantial portions of the Software.</span><br><span class="line"></span><br><span class="line">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span><br><span class="line">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span><br><span class="line">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span><br><span class="line">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span><br><span class="line">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span><br><span class="line">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span><br><span class="line">THE SOFTWARE.</span><br></pre></td></tr></table></figure>

<h5 id="New-Here"><a href="#New-Here" class="headerlink" title="New Here?"></a>New Here?</h5><p>OpsDash is a server monitoring, service monitoring, and database monitoring solution for monitoring Docker, MySQL, PostgreSQL, MongoDB, memcache, Redis, Apache, Nginx, Elasticsearch and more. It provides intelligent, customizable dashboards and rule-based<br> alerting via email, HipChat, Slack, PagerDuty, OpsGenie, VictorOps and Webhooks. Send in your custom metrics with StatsD and Graphite interfaces built into each agent.</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/835ee0618f5094cde1d1469e940e65a9.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="../384/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="../../">1</a><span class="space">&hellip;</span><a class="page-number" href="../384/">384</a><span class="page-number current">385</span><a class="page-number" href="../386/">386</a><span class="space">&hellip;</span><a class="page-number" href="../399/">399</a><a class="extend next" rel="next" href="../386/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">开发者博客</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="https://dev.newban.cn/archives/">
              
                  <span class="site-state-item-count">3990</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">1304</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="../../atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">开发者博客</span>
  <div>
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
  </div>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




  <script type="text/javascript" async src="js/src/mermaid.min.js"></script>
  <script>
  if (window.mermaid) {
        var mermaid_config = {
            startOnLoad: true,
            theme: 'default',
            flowchart:{
                useMaxWidth: false,
                htmlLabels: true
            }                
        }
        mermaid.initialize(mermaid_config);
  }
  </script>
  

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="../../lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="../../lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="../../lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="../../lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="../../lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="../../lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="../../js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="../../js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="../../js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
