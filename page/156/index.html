<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">
<meta name="referrer" content="never">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="../../lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="../../lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="../../css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="../../images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="../../images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="../../images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="../../images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">





  <link rel="alternate" href="../../atom.xml" title="开发者博客 – IT技术 尽在开发者博客" type="application/atom+xml">






<meta property="og:type" content="website">
<meta property="og:title" content="开发者博客 – IT技术 尽在开发者博客">
<meta property="og:url" content="https://dev.newban.cn/page/156/index.html">
<meta property="og:site_name" content="开发者博客 – IT技术 尽在开发者博客">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="开发者博客 – IT技术 尽在开发者博客">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>
<!--谷歌广告验证代码-->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-2626449904708114",
          enable_page_level_ads: true
     });
</script>
<!--谷歌广告验证代码-->



  <link rel="canonical" href="https://dev.newban.cn/page/156/">





  <title>开发者博客 – IT技术 尽在开发者博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">开发者博客 – IT技术 尽在开发者博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">开发者博客 – 科技是第一生产力</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="http://dev.newban.cn/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="https://dev.newban.cn/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7035783640034312228.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7035783640034312228.html" itemprop="url">Kafka 的跨集群信息拷贝方案 MiirorMaker</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-11-29T08:35:52+08:00">
                2021-11-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x8FD9;&#x662F;&#x6211;&#x53C2;&#x4E0E;11&#x6708;&#x66F4;&#x6587;&#x6311;&#x6218;&#x7684;&#x7B2C;28&#x5929;&#xFF0C;&#x6D3B;&#x52A8;&#x8BE6;&#x60C5;&#x67E5;&#x770B;&#xFF1A;<a href="https://dev.newban.cn/7023643374569816095/">2021&#x6700;&#x540E;&#x4E00;&#x6B21;&#x66F4;&#x6587;&#x6311;&#x6218;</a></p>
<p>&#x76F8;&#x5173;&#xFF1A;<a href="https://dev.newban.cn/7034806241008287751">Kafka &#x76EE;&#x5F55;&#x91CC;&#x7684;&#x811A;&#x672C;&#x90A3;&#x4E48;&#x591A;&#xFF0C;&#x5B83;&#x4EEC;&#x90FD;&#x662F;&#x7528;&#x6765;&#x5E72;&#x4EC0;&#x4E48;&#x7684;&#xFF1F;</a></p>
<p>&#x5728; &#x300A;<a href="https://dev.newban.cn/7034806241008287751">Kafka &#x76EE;&#x5F55;&#x91CC;&#x7684;&#x811A;&#x672C;&#x90A3;&#x4E48;&#x591A;&#xFF0C;&#x5B83;&#x4EEC;&#x90FD;&#x662F;&#x7528;&#x6765;&#x5E72;&#x4EC0;&#x4E48;&#x7684;&#xFF1F;</a>&#x300B;&#x8FD9;&#x7BC7;&#x91CC;&#xFF0C;&#x4ECB;&#x7ECD;&#x4E86;&#x4E00;&#x4E9B; Kafka &#x8FD0;&#x7EF4;&#x811A;&#x672C;&#xFF0C;&#x5728; Kafka &#x7684;&#x811A;&#x672C;&#x76EE;&#x5F55;&#x4E2D;&#xFF0C;&#x8FD8;&#x6709;&#x4E00;&#x4E2A; <code>kafka-mirror-maker.sh</code> &#x811A;&#x672C;&#xFF0C;&#x8FD9;&#x7BC7;&#x4E0E;&#x5B83;&#x6709;&#x5173;&#x3002;</p>
<p>&#x5728;&#x7EDD;&#x5927;&#x591A;&#x6570;&#x751F;&#x4EA7;&#x573A;&#x666F;&#x4E0B;&#xFF0C;Kafka &#x90FD;&#x662F;&#x4F5C;&#x4E3A;&#x96C6;&#x7FA4;&#x6765;&#x4F7F;&#x7528;&#x7684;&#xFF0C;&#x5728;&#x707E;&#x5907;&#x3001;&#x57FA;&#x4E8E;&#x5730;&#x7406;&#x4F4D;&#x7F6E;&#x7684;&#x4F4E;&#x5EF6;&#x8FDF;&#x670D;&#x52A1;&#x7B49;&#x573A;&#x666F;&#x4E0B;&#xFF0C;&#x751A;&#x81F3;&#x4F1A;&#x90E8;&#x7F72;&#x591A;&#x4E2A;&#x96C6;&#x7FA4;&#xFF0C;&#x5728;&#x96C6;&#x7FA4;&#x4E4B;&#x95F4;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x540C;&#x6B65;&#x3002;&#x5F53;&#x524D;&#xFF0C;&#x5B9E;&#x73B0;&#x96C6;&#x7FA4;&#x95F4;&#x6570;&#x636E;&#x62F7;&#x8D1D;&#x7684;&#x65B9;&#x6848;&#x6709;&#x5F88;&#x591A;&#xFF0C;MirrorMaker &#x662F; Kafka &#x793E;&#x533A;&#x63D0;&#x4F9B;&#x7684;&#x65B9;&#x6848;&#xFF0C;&#x6700;&#x4E3B;&#x8981;&#x7684;&#x529F;&#x80FD;&#x5C31;&#x662F;&#x5B9E;&#x73B0;&#x96C6;&#x7FA4;&#x5230;&#x96C6;&#x7FA4;&#x7684;&#x6570;&#x636E;&#x62F7;&#x8D1D;&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x7B80;&#x5355;&#x4ECB;&#x7ECD; MirrorMaker&#x3002;</p>
<p>MirrorMaker &#x672C;&#x8D28;&#x4E0A;&#x662F;&#x4E00;&#x4E2A;&#x300C;&#x6D88;&#x8D39;&#x8005;+&#x751F;&#x4EA7;&#x8005;&#x300D;&#x7684;&#x7A0B;&#x5E8F;&#xFF0C;&#x5B83;&#x5B9E;&#x73B0;&#x6570;&#x636E;&#x62F7;&#x8D1D;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x662F;&#x4F5C;&#x4E3A;&#x6D88;&#x8D39;&#x8005;&#x4ECE;&#x6E90; Kafka &#x96C6;&#x7FA4;&#x83B7;&#x53D6;&#x6D88;&#x606F;&#xFF0C;&#x7136;&#x540E;&#x53C8;&#x4F5C;&#x4E3A;&#x751F;&#x4EA7;&#x8005;&#x628A;&#x6D88;&#x606F;&#x63D0;&#x4EA4;&#x5230;&#x76EE;&#x6807; Kafka &#x96C6;&#x7FA4;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/e13cf6a852c7fd071c6dfa8086421babd68b34d8c1ebe3ac68e4011221e060a7" alt="image.png"></p>
<p>&#x5982;&#x679C;&#x4E0D;&#x6DF1;&#x5165;&#x7EC6;&#x8282;&#x7684;&#x8BDD;&#xFF0C;&#x5B83;&#x7684;&#x539F;&#x7406;&#x770B;&#x8D77;&#x6765;&#x975E;&#x5E38;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#xFF0C;&#x4E0B;&#x9762;&#x770B;&#x4E00;&#x4E0B;&#x5B83;&#x7684;&#x7528;&#x6CD5;&#x3002;</p>
<p>&#x8FD0;&#x884C; MirrorMaker &#x4E3B;&#x8981;&#x662F;&#x901A;&#x8FC7; Kafka &#x76EE;&#x5F55;&#x4E0B;&#x7684; <code>bin/kafka-mirror-maker.sh</code> &#x811A;&#x672C;&#x5B8C;&#x6210;&#x7684;&#x3002;&#x8FD0;&#x884C;&#x811A;&#x672C;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x9700;&#x8981;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;&#x5982;&#x4E0B;&#x7684;&#x53C2;&#x6570;&#xFF1A;</p>
<ul>
<li><code>consumer.config</code>&#xFF1A;&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x7528;&#x6765;&#x6307;&#x5B9A;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#xFF0C;&#x4F5C;&#x4E3A; MirrorMaker &#x4F5C;&#x4E3A;&#x6D88;&#x8D39;&#x8005;&#x7684;&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#xFF0C;&#x5176;&#x4E2D;&#x6700;&#x91CD;&#x8981;&#x7684;&#x914D;&#x7F6E;&#x662F; <code>bootstrap.servers</code> &#x4E5F;&#x5C31;&#x662F;&#x6D88;&#x8D39;&#x6D88;&#x606F;&#x7684;&#x6E90; Kafka &#x96C6;&#x7FA4;&#x3002;&#x9664;&#x6B64;&#x4E4B;&#x5916;&#xFF0C;MirrorMaker &#x4F1A;&#x5728;&#x5185;&#x90E8;&#x521B;&#x5EFA;&#x4E0D;&#x6B62;&#x4E00;&#x4E2A;&#x6D88;&#x8D39;&#x8005;&#x5B9E;&#x4F8B;&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x518D;&#x6307;&#x5B9A;&#x4E00;&#x4E2A; <code>group.id</code>&#x3002;&#x4E3A;&#x4E86;&#x8BA9; MirrorMaker &#x53EF;&#x4EE5;&#x4ECE;&#x5934;&#x6D88;&#x8D39;&#x4FE1;&#x606F;&#xFF0C;&#x518D;&#x914D;&#x7F6E; <code>auto.offset.reset=earliest</code>&#x3002;&#x4EE5;&#x4E0A;&#x8FD9;&#x4E9B;&#x662F;&#x6700;&#x5C0F;&#x5FC5;&#x8981;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x5176;&#x5B83;&#x7684;&#x914D;&#x7F6E;&#x89C6;&#x60C5;&#x51B5;&#x800C;&#x5B9A;&#x3002;</li>
<li><code>producer.config</code>&#xFF1A;&#x4F5C;&#x7528;&#x4E0E; <code>consumer.config</code> &#x7C7B;&#x4F3C;&#xFF0C;&#x662F; MirrorMaker &#x4F5C;&#x4E3A;&#x751F;&#x4EA7;&#x8005;&#x7684;&#x914D;&#x7F6E;&#x53C2;&#x6570;&#x6587;&#x4EF6;&#xFF0C;&#x5728;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x6700;&#x5C11;&#x9700;&#x8981;&#x914D;&#x7F6E; <code>bootstrap.servers</code> &#x5373;&#x53EF;&#x3002;</li>
<li><code>num.streams</code>&#xFF1A;&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x7528;&#x6765;&#x544A;&#x8BC9; MirrorMaker&#xFF0C;&#x9700;&#x8981;&#x521B;&#x5EFA;&#x591A;&#x5C11;&#x4E2A;&#x6D88;&#x8D39;&#x8005;&#x5B9E;&#x4F8B;&#xFF0C;&#x5728; MirrorMaker &#x4E2D;&#xFF0C;&#x591A;&#x4E2A;&#x6D88;&#x8D39;&#x8005;&#x5B9E;&#x4F8B;&#x7684;&#x521B;&#x5EFA;&#x662F;&#x901A;&#x8FC7;&#x591A;&#x7EBF;&#x7A0B;&#x6765;&#x5B9E;&#x73B0;&#x7684;&#x3002;</li>
<li><code>whitelist</code>&#xFF1A;&#x8FD9;&#x91CC;&#x53EF;&#x4EE5;&#x8BA9;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x53EA;&#x6709;&#x540D;&#x79F0;&#x5339;&#x914D;&#x8FD9;&#x4E2A;&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x4E3B;&#x9898;&#x4F1A;&#x88AB;&#x62F7;&#x8D1D;&#x6570;&#x636E;&#x3002;&#x8FD9;&#x6837;&#xFF0C;&#x53EF;&#x4EE5;&#x5C06;&#x4E0D;&#x540C;&#x4E3B;&#x9898;&#x7684;&#x6570;&#x636E;&#x62F7;&#x8D1D;&#x5230;&#x4E0D;&#x540C;&#x7684;&#x76EE;&#x6807;&#x96C6;&#x7FA4;&#x4E2D;&#x3002;</li>
</ul>
<p>&#x7ED3;&#x5408;&#x8FD9;&#x4E9B;&#x53C2;&#x6570;&#xFF0C;&#x6700;&#x7EC8;&#x7684;&#x547D;&#x4EE4;&#x7C7B;&#x4F3C;&#x4E00;&#x4E0B;&#x5185;&#x5BB9;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">css&#x590D;&#x5236;&#x4EE3;&#x7801;$ bin/kafka-mirror-maker.sh --consumer.config path/to/consumer-config.properties --producer.config ./path/to/producer-config.properties --num.streams 7 --whitelist &quot;.*&quot;</span><br></pre></td></tr></table></figure>

<p>&#x5982;&#x679C;&#x5DF2;&#x7ECF;&#x6210;&#x529F;&#x542F;&#x52A8;&#x4E86;&#x6E90; Kafka &#x96C6;&#x7FA4;&#x548C;&#x76EE;&#x6807; Kafka &#x96C6;&#x7FA4;&#xFF0C;&#x90A3;&#x4E48;&#x5728;&#x9700;&#x8981;&#x542F;&#x52A8; MirrorMaker &#x7684;&#x673A;&#x5668;&#x4E0A;&#xFF0C;&#x8FD0;&#x884C;&#x8FD9;&#x4E2A;&#x547D;&#x4EE4;&#x5373;&#x53EF;&#x3002;</p>
<p>&#x6709;&#x4E00;&#x70B9;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x76EE;&#x6807;&#x96C6;&#x7FA4;&#x4E0A;&#x8FD8;&#x6CA1;&#x6709;&#x521B;&#x5EFA;&#x8981;&#x62F7;&#x8D1D;&#x6570;&#x636E;&#x7684; Topic&#xFF0C;&#x90A3;&#x4E48;&#xFF0C;&#x5B83;&#x4F1A;&#x6839;&#x636E; Broker &#x7AEF;&#x7684;&#x53C2;&#x6570;&#x91CD;&#x6307;&#x5B9A;&#x7684;&#x5206;&#x533A;&#x6570;&#x548C;&#x526F;&#x672C;&#x6570;&#xFF0C;&#x8FD9;&#x53EF;&#x80FD;&#x548C;&#x6E90; Kafka &#x96C6;&#x7FA4;&#x4E0A;&#x7684;&#x8BE5;&#x4E3B;&#x9898;&#x7684;&#x5206;&#x533A;&#x6570;&#x548C;&#x526F;&#x672C;&#x6570;&#x4E0D;&#x4E00;&#x81F4;&#xFF0C;&#x6216;&#x8005;&#x4E0D;&#x7B26;&#x5408;&#x6211;&#x4EEC;&#x7684;&#x9884;&#x671F;&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;&#x63A8;&#x8350;&#x63D0;&#x524D;&#x5728;&#x76EE;&#x6807;&#x96C6;&#x7FA4;&#x4E0A;&#x521B;&#x5EFA;&#x597D;&#x4E3B;&#x9898;&#x3002;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/26976a55ef1bf9bd83ef961e57b3d9fc.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7035781981048668173.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7035781981048668173.html" itemprop="url">从 Docker 的信号机制看容器的优雅停止</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-11-29T08:29:25+08:00">
                2021-11-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x6B64;&#x6587;&#x662F;&#x524D;&#x6BB5;&#x65F6;&#x95F4;&#x505A;&#x76F8;&#x5173;&#x5DE5;&#x4F5C;&#x65F6;&#x7B14;&#x8BB0;&#x7684;&#x6574;&#x7406;&#xFF0C;&#x4E4B;&#x524D;&#x81EA;&#x5DF1;&#x5BF9;&#x8FD9;&#x65B9;&#x9762;&#x7684;&#x5173;&#x6CE8;&#x4E0D;&#x591F;&#xFF0C;&#x56E0;&#x6B64;&#x505A;&#x4E0B;&#x8BB0;&#x5F55;&#x3002;</p>
<hr>
<p>&#x6709;&#x592A;&#x591A;&#x7684;&#x6587;&#x7AE0;&#x4ECB;&#x7ECD;&#x5982;&#x4F55;<strong>&#x8FD0;&#x884C;</strong>&#x5BB9;&#x5668;&#xFF0C;&#x7136;&#x800C;&#x5982;&#x4F55;<strong>&#x505C;&#x6B62;</strong>&#x5BB9;&#x5668;&#x7684;&#x6587;&#x7AE0;&#x76F8;&#x5BF9;&#x5C11;&#x5F88;&#x591A;&#x3002;</p>
<p>&#x6839;&#x636E;&#x8FD0;&#x884C;&#x7684;&#x5E94;&#x7528;&#x7C7B;&#x578B;&#xFF0C;&#x5E94;&#x7528;&#x7684;&#x505C;&#x6B62;&#x8FC7;&#x7A0B;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x3002;&#x5982;&#x679C;&#x5E94;&#x7528;&#x8981;&#x5199;&#x6587;&#x4EF6;&#xFF0C;&#x505C;&#x6B62;&#x524D;&#x8981;&#x4FDD;&#x8BC1;&#x6B63;&#x786E;&#x5237;&#x65B0;&#x6570;&#x636E;&#x5E76;&#x5173;&#x95ED;&#x6587;&#x4EF6;&#xFF1B;&#x5982;&#x679C;&#x662F; HTTP &#x670D;&#x52A1;&#xFF0C;&#x8981;&#x786E;&#x4FDD;&#x505C;&#x6B62;&#x524D;&#x5904;&#x7406;&#x6240;&#x6709;&#x672A;&#x5B8C;&#x6210;&#x7684;&#x8BF7;&#x6C42;&#x3002;</p>
<h2 id="&#x4FE1;&#x53F7;"><a href="#&#x4FE1;&#x53F7;" class="headerlink" title="&#x4FE1;&#x53F7;"></a>&#x4FE1;&#x53F7;</h2><p>&#x4FE1;&#x53F7;&#x662F; Linux &#x5185;&#x6838;&#x4E0E;&#x8FDB;&#x7A0B;&#x4EE5;&#x53CA;&#x8FDB;&#x7A0B;&#x95F4;&#x901A;&#x4FE1;&#x7684;&#x4E00;&#x79CD;&#x65B9;&#x5F0F;&#x3002;&#x9488;&#x5BF9;&#x6BCF;&#x4E2A;&#x4FE1;&#x53F7;&#x8FDB;&#x7A0B;&#x90FD;&#x6709;&#x4E2A;&#x9ED8;&#x8BA4;&#x7684;&#x52A8;&#x4F5C;&#xFF0C;&#x4E0D;&#x8FC7;&#x8FDB;&#x7A0B;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5B9A;&#x4E49;&#x4FE1;&#x53F7;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x6765;&#x8986;&#x76D6;&#x9ED8;&#x8BA4;&#x7684;&#x52A8;&#x4F5C;&#xFF0C;&#x9664;&#x4E86; <code>SIGSTOP</code> &#x548C; <code>SIGKILL</code>&#x3002;&#x4E8C;&#x8005;&#x90FD;&#x4E0D;&#x80FD;&#x88AB;&#x6355;&#x83B7;&#x6216;&#x91CD;&#x5199;&#xFF0C;&#x524D;&#x8005;&#x7528;&#x6765;&#x5C06;&#x8FDB;&#x7A0B;&#x6682;&#x505C;&#x5728;&#x5F53;&#x524D;&#x72B6;&#x6001;&#xFF0C;&#x800C;&#x540E;&#x8005;&#x5219;&#x662F;&#x4ECE;&#x5185;&#x6838;&#x5C42;&#x9762;&#x7ACB;&#x5373;&#x6740;&#x6389;&#x8FDB;&#x7A0B;&#x3002;</p>
<p>&#x6709;&#x4E24;&#x4E2A;&#x6BD4;&#x8F83;&#x91CD;&#x8981;&#x7684;&#x8FDB;&#x7A0B; <code>SIGTERM</code> &#x548C; <code>SIGKILL</code>&#x3002;<code>SIGTERM</code> &#x662F;&#x4F18;&#x96C5;&#x5730;&#x5173;&#x95ED;&#x547D;&#x4EE4;&#xFF0C;<code>SIGKILL</code> &#x5219;&#x662F;&#x66B4;&#x529B;&#x7684;&#x5173;&#x95ED;&#x547D;&#x4EE4;&#x3002;&#x6BD4;&#x5982; Docker&#xFF0C;&#x5BB9;&#x5668;&#x4F1A;&#x5148;&#x6536;&#x5230; <code>SIGTERM</code> &#x4FE1;&#x53F7;&#xFF0C;10s &#x540E;&#x4F1A;&#x6536;&#x5230; <code>SIGKILL</code> &#x4FE1;&#x53F7;&#x3002;</p>
<p>&#x8FD8;&#x6709;&#x5F88;&#x591A;&#x5176;&#x4ED6;&#x7684;&#x4FE1;&#x53F7;&#xFF0C;&#x53EA;&#x662F;&#x9650;&#x5B9A;&#x4E8E;&#x7279;&#x5B9A;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x3002;</p>
<h2 id="&#x4E2D;&#x65AD;"><a href="#&#x4E2D;&#x65AD;" class="headerlink" title="&#x4E2D;&#x65AD;"></a>&#x4E2D;&#x65AD;</h2><p>&#x786C;&#x4EF6;&#x7684;&#x4E2D;&#x65AD;&#x5C31;&#x50CF;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;&#x4FE1;&#x53F7;&#x3002;&#x901A;&#x5E38;&#x53D1;&#x751F;&#x5728;&#x786C;&#x4EF6;&#x60F3;&#x8981;&#x5411;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x6CE8;&#x518C;&#x4E8B;&#x4EF6;&#x65F6;&#x3002;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5FC5;&#x987B;&#x7ACB;&#x5373;&#x505C;&#x6B62;&#x8FD0;&#x884C;&#xFF0C;&#x5E76;&#x5904;&#x7406;&#x4E2D;&#x65AD;&#x3002;</p>
<p>&#x6BD4;&#x8F83;&#x5E38;&#x89C1;&#x7684;&#x4E2D;&#x65AD;&#x4F8B;&#x5B50;&#x5C31;&#x662F;&#x952E;&#x76D8;&#x4E2D;&#x65AD;&#xFF0C;&#x6BD4;&#x5982;&#x6309;&#x4E0B; <code>ctrl+z</code> &#x6216;&#x8005; <code>ctrl+c</code>&#x3002;Linux &#x5C06;&#x5176;&#x5206;&#x522B;&#x8F6C;&#x6362;&#x6210; <code>SIGTSTP</code> &#x548C; <code>SIGINT</code>&#x3002;&#x786C;&#x4EF6;&#x4E2D;&#x65AD;&#x8FC7;&#x53BB;&#x901A;&#x5E38;&#x7528;&#x6765;&#x5904;&#x7406;&#x952E;&#x76D8;&#x548C;&#x9F20;&#x6807;&#x8F93;&#x5165;&#xFF0C;&#x4F46;&#x5982;&#x4ECA;&#x88AB;&#x7528;&#x4F5C;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x8F6F;&#x4EF6;&#x9A71;&#x52A8;&#x5C42;&#x9762;&#x7684;&#x4FE1;&#x53F7;&#x8F6E;&#x8BAD;&#x3002;</p>
<h2 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h2><p>&#x524D;&#x9762;&#x8BF4;&#x4E86;&#x8FD9;&#x4E48;&#x591A;&#x7EC8;&#x4E8E;&#x6765;&#x5230; Docker&#xFF0C;&#x5BB9;&#x5668;&#x7684;&#x72EC;&#x7279;&#x4E4B;&#x5904;&#x5728;&#x4E8E;&#x901A;&#x5E38;&#x53EA;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x3002;&#x5373;&#x4F7F;&#x662F;&#x5355;&#x8FDB;&#x7A0B;&#xFF0C;&#x5BB9;&#x5668;&#x5185; PID &#x4E3A; 1 &#x7684;&#x8FDB;&#x7A0B;&#x4E5F;&#x5177;&#x6709; init &#x7CFB;&#x7EDF;&#x7684;&#x7279;&#x6B8A;&#x89C4;&#x5219;&#x548C;&#x804C;&#x8D23;&#x3002;</p>
<p>PID 1 &#x5728; Linux &#x4E2D;&#x975E;&#x5E38;&#x91CD;&#x8981;&#xFF0C;&#x901A;&#x5E38;&#x662F; init &#x8FDB;&#x7A0B;&#x3002;&#x901A;&#x5E38;&#x8FDB;&#x7A0B;&#x5728;&#x6536;&#x5230; <code>SIGTERM</code> &#x4FE1;&#x53F7;&#x540E;&#xFF0C;&#x5047;&#x5982;&#x4E0D;&#x5BF9;&#x4FE1;&#x53F7;&#x8FDB;&#x7A0B;&#x5904;&#x7406;&#xFF0C;&#x4F1A;&#x5FEB;&#x901F;&#x9000;&#x51FA;&#x3002;&#x4F46; PID 1 &#x7684;&#x8FDB;&#x7A0B;&#x6536;&#x5230; <code>SIGTERM</code> &#x4E4B;&#x540E;&#x5047;&#x5982;&#x4E0D;&#x5BF9;&#x4FE1;&#x53F7;&#x8FDB;&#x884C;&#x5904;&#x7406;&#x5219;<strong>&#x4EC0;&#x4E48;&#x90FD;&#x4E0D;&#x4F1A;&#x505A;</strong>&#x3002;</p>
<p>&#x5BB9;&#x5668;&#x5185; PID 1 &#x901A;&#x5E38;&#x6709;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#xFF1A; shell &#x8FDB;&#x7A0B; PID &#x4E3A; 1 &#x548C;&#x4F60;&#x7684;&#x8FDB;&#x7A0B; PID &#x4E3A; 1&#x3002;&#x5206;&#x522B;&#x5BF9;&#x5E94;&#x7740; shell &#x548C; exec &#x683C;&#x5F0F;&#x7684;&#x547D;&#x4EE4;&#x3002;</p>
<h3 id="shell-&#x683C;&#x5F0F;"><a href="#shell-&#x683C;&#x5F0F;" class="headerlink" title="shell &#x683C;&#x5F0F;"></a>shell &#x683C;&#x5F0F;</h3><p>Dockerfile &#x6709;&#x4E2A;&#x7279;&#x70B9;&#xFF0C;&#x5C31;&#x662F;&#x5982;&#x679C;&#x4E0D;&#x4F7F;&#x7528; <a href="/external_links/07bf7aef8ac48034a332ec8bcc83679e.html" target="blank" rel="noopener">JSON &#x683C;&#x5F0F;</a> &#x6765;&#x6307;&#x5B9A;&#x5BB9;&#x5668;&#x547D;&#x4EE4;&#xFF0C;&#x4F1A;&#x901A;&#x8FC7; shell &#x4EE5; <code>fork</code> &#x7684;&#x5F62;&#x5F0F;&#x6765;&#x6267;&#x884C;&#x547D;&#x4EE4;&#xFF0C;&#x4E5F;&#x5C31;&#x662F; <code>/bin/sh -c</code>&#x3002;</p>
<ul>
<li><code>docker run</code>&#xFF08;&#x5BBF;&#x4E3B;&#x673A;&#x4E0A;&#xFF09;<ul>
<li><code>/bin/sh -c</code>&#xFF08;PID 1&#xFF0C;&#x5BB9;&#x5668;&#x5185;&#xFF09;<ul>
<li><code>/loop.sh</code> &#xFF08;PID 2&#xFF0C;&#x5BB9;&#x5668;&#x5185;&#xFF09;</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>&#x8FD9;&#x79CD;&#x683C;&#x5F0F;&#x7684;&#x547D;&#x4EE4;&#x7279;&#x70B9;&#x662F;&#x4E0D;&#x4F1A;&#x5411;&#x4E1A;&#x52A1;&#x8FDB;&#x7A0B;&#x53D1;&#x9001;&#x4FE1;&#x53F7;&#x3002;&#x6BD4;&#x5982;&#x53D1;&#x9001;&#x7ED9; shell &#x7684; <code>SIGTERM</code> &#x4FE1;&#x53F7;&#x4E0D;&#x4F1A;&#x8F6C;&#x53D1;&#x7ED9;&#x5B50;&#x8FDB;&#x7A0B;&#xFF0C;&#x800C;&#x662F;&#x7B49;&#x5F85;&#x5B50;&#x8FDB;&#x7A0B;&#x7684;&#x9000;&#x51FA;&#x3002;&#x552F;&#x4E00;&#x6740;&#x6B7B;&#x5BB9;&#x5668;&#x7684;&#x65B9;&#x5F0F;&#x5C31;&#x662F;&#x53D1;&#x9001; <code>SIGKILL</code> &#x4FE1;&#x53F7;&#xFF0C;&#x6216;&#x8005;&#x78B0;&#x5DE7;&#x5B50;&#x8FDB;&#x7A0B;&#x81EA;&#x5DF1;&#x5D29;&#x6E83;&#x3002;</p>
<p>&#x6240;&#x4EE5;&#x5E94;&#x8BE5;&#x5C3D;&#x91CF;&#x907F;&#x514D;&#x4F7F;&#x7528;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#xFF0C;</p>
<h3 id="exec-&#x683C;&#x5F0F;"><a href="#exec-&#x683C;&#x5F0F;" class="headerlink" title="exec &#x683C;&#x5F0F;"></a>exec &#x683C;&#x5F0F;</h3><p>&#x8FD9;&#x4E2A;&#x5C31;&#x662F; Dockerfile &#x7684;&#x63A8;&#x8350;&#x8BED;&#x6CD5;&#x4E86;&#xFF0C;&#x4F60;&#x7684;&#x8FDB;&#x7A0B;&#x4F1A;&#x7ACB;&#x5373;&#x542F;&#x52A8;&#x5E76;&#x4F5C;&#x4E3A;&#x5BB9;&#x5668;&#x7684;&#x521D;&#x59CB;&#x5316;&#x8FDB;&#x7A0B;&#xFF0C;&#x7136;&#x540E;&#x5C31;&#x6709;&#x4E86;&#x4E0B;&#x9762;&#x7684;&#x8FDB;&#x7A0B;&#x6811;&#xFF1A;</p>
<ul>
<li><code>docker run</code>&#xFF08;&#x5BBF;&#x4E3B;&#x673A;&#x4E0A;&#xFF09;<ul>
<li><code>/loop.sh</code>&#xFF08;PID 1&#xFF0C;&#x5BB9;&#x5668;&#x5185;&#xFF09;</li>
</ul>
</li>
</ul>
<p>&#x8BF4;&#x4E86;&#x8FD9;&#x4E48;&#x591A;&#xFF0C;&#x5F88;&#x591A;&#x4EBA;&#x89C9;&#x5F97;&#x4E0D;&#x591F;&#x76F4;&#x89C2;&#x3002;&#x6211;&#x4EEC;&#x4F1A;&#x7528;&#x793A;&#x4F8B;&#x5E94;&#x7528;&#x6765;&#x8FDB;&#x884C;&#x8BF4;&#x660E;&#xFF0C;&#x4F46;&#x5728;&#x8FD9;&#x4E4B;&#x524D;&#x7B80;&#x5355;&#x8BF4;&#x4E0B;&#x5982;&#x4F55;&#x53D1;&#x9001;&#x4FE1;&#x53F7;&#x6765;&#x505C;&#x6B62;&#x5BB9;&#x5668;&#x3002;</p>
<h2 id="&#x53D1;&#x9001;&#x4FE1;&#x53F7;"><a href="#&#x53D1;&#x9001;&#x4FE1;&#x53F7;" class="headerlink" title="&#x53D1;&#x9001;&#x4FE1;&#x53F7;"></a>&#x53D1;&#x9001;&#x4FE1;&#x53F7;</h2><p>&#x6709;&#x51E0;&#x79CD;&#x65B9;&#x5F0F;&#x6765;&#x505C;&#x6B62;&#x5BB9;&#x5668;&#x3002;</p>
<h3 id="docker-stop"><a href="#docker-stop" class="headerlink" title="docker stop"></a>docker stop</h3><p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B; <code>docker stop</code> &#x547D;&#x4EE4;&#x4F1A;&#x5411;&#x5BB9;&#x5668;&#x53D1;&#x9001; <code>SIGTERM</code> &#x4FE1;&#x53F7;&#xFF0C;&#x7136;&#x540E;&#x7B49;&#x5F85; <code>10s</code>&#xFF0C;&#x5982;&#x679C;&#x5BB9;&#x5668;&#x6CA1;&#x505C;&#x6B62;&#x518D;&#x53D1;&#x9001; <code>SIGKILL</code> &#x4FE1;&#x53F7;&#x3002;</p>
<p>&#x5728; Dockerfile &#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>STOPSIGNAL</code> &#x6307;&#x4EE4;&#x6765;&#x8BBE;&#x7F6E;&#x9ED8;&#x8BA4;&#x7684;&#x9000;&#x51FA;&#x4FE1;&#x53F7;&#xFF0C;&#x6BD4;&#x5982; <code>STOPSIGNAL SIGKILL</code> &#x5C06;&#x9000;&#x51FA;&#x4FE1;&#x53F7;&#x8BBE;&#x7F6E;&#x4E3A; <code>SIGKILL</code>&#x3002;&#x6216;&#x8005;&#x5728; <code>docker run</code> &#x662F;&#x901A;&#x8FC7; <code>--stop-signal</code> &#x53C2;&#x6570;&#x6765;&#x8986;&#x76D6;&#x955C;&#x50CF;&#x4E2D;&#x7684; <code>STOPSIGNAL</code> &#x8BBE;&#x7F6E;&#x3002;</p>
<h3 id="docker-kill"><a href="#docker-kill" class="headerlink" title="docker kill"></a>docker kill</h3><p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B; <code>docker kill</code> &#x4F1A;&#x76F4;&#x63A5;&#x6740;&#x6B7B;&#x5BB9;&#x5668;&#xFF0C;&#x4E0D;&#x7ED9;&#x5BB9;&#x5668;&#x4EFB;&#x4F55;&#x673A;&#x4F1A;&#x8FDB;&#x884C;&#x4F18;&#x96C5;&#x505C;&#x6B62;&#xFF0C;&#x8FD9;&#x91CC;&#x53D1;&#x51FA;&#x7684;&#x5C31;&#x662F; <code>SIGKILL</code> &#x4FE1;&#x53F7;&#x3002;</p>
<p>&#x5F53;&#x7136; <code>docker kill</code> &#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>--signal</code> &#x6765;&#x6307;&#x5B9A;&#x8981;&#x53D1;&#x9001;&#x7684;&#x4FE1;&#x53F7;&#xFF0C;&#x7C7B;&#x4F3C; Linux &#x7684; <code>kill</code> &#x547D;&#x4EE4;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&#x590D;&#x5236;&#x4EE3;&#x7801;docker kill ----signal=SIGTERM foo</span><br></pre></td></tr></table></figure>

<h3 id="docker-rm-f"><a href="#docker-rm-f" class="headerlink" title="docker rm -f"></a>docker rm -f</h3><p>&#x901A;&#x5E38;&#x60C5;&#x51B5;&#x4E0B; <code>docker rm</code> &#x7528;&#x6765;&#x5220;&#x9664;&#x5DF2;&#x7ECF;&#x505C;&#x6B62;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x4F46;&#x662F;&#x52A0;&#x4E0A; <code>--force</code>&#xFF08;&#x7B80;&#x5199; <code>-f</code>&#xFF09;&#x4F1A;&#x5F3A;&#x5236;&#x5220;&#x9664;&#x6B63;&#x5728;&#x8FD0;&#x884C;&#x7684;&#x5BB9;&#x5668;&#x3002;&#x540C;&#x6837;&#xFF0C;&#x4E5F;&#x4E0D;&#x4F1A;&#x7ED9;&#x5BB9;&#x5668;&#x4EFB;&#x4F55;&#x4F18;&#x5316;&#x505C;&#x6B62;&#x7684;&#x673A;&#x4F1A;&#x3002;</p>
<h2 id="&#x4FE1;&#x53F7;&#x5904;&#x7406;"><a href="#&#x4FE1;&#x53F7;&#x5904;&#x7406;" class="headerlink" title="&#x4FE1;&#x53F7;&#x5904;&#x7406;"></a>&#x4FE1;&#x53F7;&#x5904;&#x7406;</h2><p>&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x5E94;&#x7528;&#x5BF9; shell &#x548C; exec &#x4E24;&#x79CD;&#x683C;&#x5F0F;&#x505A;&#x4E0B;&#x5BF9;&#x6BD4;&#x3002;&#x5728;&#x8FD9;&#x4E2A;&#x5E94;&#x7528;&#x4E2D;&#xFF0C;&#x5BF9; <code>SIGTERM</code> &#x8FDB;&#x884C;&#x5904;&#x7406;&#xFF1A;&#x6536;&#x5230;&#x4FE1;&#x53F7;&#x540E;&#x9000;&#x51FA;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell&#x590D;&#x5236;&#x4EE3;&#x7801;#!/usr/bin/env sh</span><br><span class="line">trap &apos;exit 0&apos; SIGTERM</span><br><span class="line">while true; do :; done</span><br></pre></td></tr></table></figure>

<p>&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x4E24;&#x79CD;&#x4E0D;&#x540C;&#x683C;&#x5F0F;&#x7684; <code>CMD</code> &#x6765;&#x6784;&#x5EFA;&#x955C;&#x50CF;&#x3002;</p>
<h3 id="shell-&#x683C;&#x5F0F;-1"><a href="#shell-&#x683C;&#x5F0F;-1" class="headerlink" title="shell &#x683C;&#x5F0F;"></a>shell &#x683C;&#x5F0F;</h3><p>&#x4F7F;&#x7528;&#x4E0B;&#x9762;&#x7684; Dockerfile &#x6765;&#x6784;&#x5EFA;&#x955C;&#x50CF; <em>term</em>&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vbnet&#x590D;&#x5236;&#x4EE3;&#x7801;FROM alpine:3.15.0</span><br><span class="line">COPY loop.sh /</span><br><span class="line">CMD /loop.sh</span><br></pre></td></tr></table></figure>

<p>&#x6267;&#x884C;&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;&#x6784;&#x5EFA;&#x955C;&#x50CF;&#x3001;&#x542F;&#x52A8;&#x5BB9;&#x5668;&#x3001;&#x505C;&#x6B62;&#x5BB9;&#x5668;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell&#x590D;&#x5236;&#x4EE3;&#x7801;docker build -t term .</span><br><span class="line">docker run --name term -d term</span><br><span class="line">docker stop term</span><br></pre></td></tr></table></figure>

<p>&#x6B64;&#x65F6;&#x4F60;&#x4F1A;&#x53D1;&#x73B0;&#x5BB9;&#x5668;&#x5E76;&#x6CA1;&#x6709;&#x7ACB;&#x523B;&#x505C;&#x6B62;&#xFF0C;&#x800C;&#x662F;&#x5927;&#x7EA6; 10s &#x4E4B;&#x540E;&#x624D;&#x88AB;&#x505C;&#x6B62;&#x3002;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x547D;&#x4EE4;&#x67E5;&#x770B;&#x5BB9;&#x5668;&#x7684;&#x9000;&#x51FA;&#x72B6;&#x6001;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell&#x590D;&#x5236;&#x4EE3;&#x7801;docker inspect -f &apos;{{.State.ExitCode}}&apos; term</span><br><span class="line">137</span><br></pre></td></tr></table></figure>

<p><code>137 = 128 + 9</code> &#x8BF4;&#x660E;&#x5BB9;&#x5668;&#x7684;&#x9000;&#x51FA;&#x4FE1;&#x53F7;&#x662F; <code>SIGKILL</code>&#x3002;</p>
<h3 id="exec-&#x683C;&#x5F0F;-1"><a href="#exec-&#x683C;&#x5F0F;-1" class="headerlink" title="exec &#x683C;&#x5F0F;"></a>exec &#x683C;&#x5F0F;</h3><p>&#x8C03;&#x6574;&#x4E0B; Dockerfile&#xFF0C;&#x5C06; <code>CMD</code> &#x4FEE;&#x6539;&#x4E3A;&#x63A8;&#x8350;&#x7684; JSON &#x683C;&#x5F0F;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sql&#x590D;&#x5236;&#x4EE3;&#x7801;FROM ubuntu:trusty</span><br><span class="line">COPY loop.sh /</span><br><span class="line">CMD [&quot;/loop.sh&quot;]</span><br></pre></td></tr></table></figure>

<p>&#x6267;&#x884C;&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;&#x6784;&#x5EFA;&#x955C;&#x50CF;&#x3001;&#x542F;&#x52A8;&#x5BB9;&#x5668;&#x3001;&#x505C;&#x6B62;&#x5BB9;&#x5668;&#x3002;&#xFF08;&#x9700;&#x8981;&#x5148;&#x6267;&#x884C; <code>docker rm term</code> &#x5220;&#x9664;&#x4E4B;&#x524D;&#x505C;&#x6B62;&#x7684;&#x5BB9;&#x5668;&#xFF09;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell&#x590D;&#x5236;&#x4EE3;&#x7801;docker build -t term .</span><br><span class="line">docker run --name term -d term</span><br><span class="line">docker stop term</span><br></pre></td></tr></table></figure>

<p>&#x6B64;&#x65F6;&#x5BB9;&#x5668;&#x4F1A;&#x7ACB;&#x523B;&#x9000;&#x51FA;&#x3002;&#x67E5;&#x770B;&#x5BB9;&#x5668;&#x7684;&#x9000;&#x51FA;&#x72B6;&#x6001;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell&#x590D;&#x5236;&#x4EE3;&#x7801;docker inspect -f &apos;{{.State.ExitCode}}&apos; term</span><br><span class="line">0</span><br></pre></td></tr></table></figure>

<h2 id="&#x603B;&#x7ED3;"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3;</h2><p><code>docker rm -f</code> &#x548C; <code>docker kill</code> &#x5E72;&#x6389;&#x5BB9;&#x5668;&#x5F88;&#x5BB9;&#x5668;&#xFF0C;&#x4F46;&#x662F;&#x4E3A;&#x4E86;&#x5B9E;&#x73B0;&#x5BB9;&#x5668;&#x7684;&#x4F18;&#x96C5;&#x9000;&#x51FA;&#xFF0C;&#x5E94;&#x8BE5;&#x4F7F;&#x7528; <code>docker stop</code> &#x547D;&#x4EE4;&#xFF0C;&#x540C;&#x65F6; Dockerfile &#x4E2D;&#x5E94;&#x5C3D;&#x91CF;&#x907F;&#x514D;&#x4F7F;&#x7528; shell &#x683C;&#x5F0F;&#x8BBE;&#x7F6E; <code>ENTRYPONT</code> &#x6216;&#x8005; <code>CMD</code>&#x3002;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/8a23e8cdfff18c1ae044e5dbd3e3abe5.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7035674437215059975.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7035674437215059975.html" itemprop="url">python中的编码问题 decode 与 encode详解</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-11-29T02:01:32+08:00">
                2021-11-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="decode-&#x4E0E;-encode&#x8BE6;&#x89E3;"><a href="#decode-&#x4E0E;-encode&#x8BE6;&#x89E3;" class="headerlink" title="decode &#x4E0E; encode&#x8BE6;&#x89E3;"></a>decode &#x4E0E; encode&#x8BE6;&#x89E3;</h1><p><strong>decode(&#x89E3;&#x7801;)&#x4F5C;&#x7528;&#xFF1A;&#x5C06;<code>&#x5176;&#x4ED6;&#x7F16;&#x7801;</code>&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x8F6C;&#x6362;&#x6210;<code>unicode</code>&#x7F16;&#x7801;</strong>  </p>
<p>&#x4F8B;&#xFF1A;<code>str1.decode(&#x2018;gb2312&#x2019;)</code>&#xFF0C;&#x8868;&#x793A;&#x5C06;gb2312&#x7F16;&#x7801;&#x7684;&#x5B57;&#x7B26;&#x4E32;str1&#x8F6C;&#x6362;&#x6210;unicode&#x7F16;&#x7801;&#x3002;</p>
<p><strong>encode(&#x7F16;&#x7801;)&#x4F5C;&#x7528;&#xFF1A;&#x5C06;<code>unicode</code>&#x7F16;&#x7801;&#x8F6C;&#x6362;&#x6210;<code>&#x5176;&#x4ED6;&#x7F16;&#x7801;</code>&#x7684;&#x5B57;&#x7B26;&#x4E32;</strong>  </p>
<p>&#x4F8B;&#xFF1A;<code>str2.encode(&#x2018;utf-8&#x2019;)</code>&#xFF0C;&#x8868;&#x793A;&#x5C06;unicode&#x7F16;&#x7801;&#x7684;&#x5B57;&#x7B26;&#x4E32;str2&#x8F6C;&#x6362;&#x6210;utf-8&#x7F16;&#x7801;&#x3002;</p>
<p><strong>&#x6CE8;&#x610F;&#xFF1A;decode&#x548C;encode&#x4E0D;&#x52A0;&#x53C2;&#x6570;&#x7684;&#x65F6;&#x5019;&#x9ED8;&#x8BA4;&#x53C2;&#x6570;&#x4E3A;&#x2019;utf-8</strong></p>
<blockquote>
<p>&#x5728;&#x505A;&#x7F16;&#x7801;&#x8F6C;&#x6362;&#x65F6;&#xFF0C;&#x901A;&#x5E38;&#x9700;&#x8981;&#x4EE5;unicode&#x4F5C;&#x4E3A;&#x4E2D;&#x95F4;&#x7F16;&#x7801;<br>&#xFF0C;&#x5373;&#x5148;&#x5C06;&#x5176;&#x4ED6;&#x7F16;&#x7801;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x89E3;&#x7801;&#xFF08;decode&#xFF09;&#x6210;unicode&#xFF0C;<br>&#x518D;&#x4ECE;unicode&#x7F16;&#x7801;&#xFF08;encode&#xFF09;&#x6210;&#x53E6;&#x4E00;&#x79CD;&#x7F16;&#x7801;&#x3002;</p>
</blockquote>
<h1 id="&#x722C;&#x866B;&#x4E2D;&#x7684;&#x7F16;&#x7801;&#x6CE8;&#x610F;&#x4E8B;&#x9879;"><a href="#&#x722C;&#x866B;&#x4E2D;&#x7684;&#x7F16;&#x7801;&#x6CE8;&#x610F;&#x4E8B;&#x9879;" class="headerlink" title="&#x722C;&#x866B;&#x4E2D;&#x7684;&#x7F16;&#x7801;&#x6CE8;&#x610F;&#x4E8B;&#x9879;"></a>&#x722C;&#x866B;&#x4E2D;&#x7684;&#x7F16;&#x7801;&#x6CE8;&#x610F;&#x4E8B;&#x9879;</h1><p>&#x6709;&#x7684;&#x65F6;&#x5019;&#x9700;&#x8981;&#x7528;&#x5230;&#x8BF7;&#x6C42;&#x5BF9;&#x8C61;&#x7684;&#x9650;&#x5236;&#xFF0C;&#x5373;&#xFF1A;</p>
<p><code>urlib.request.Request(url=url,data=data,headers=headers)</code></p>
<p>&#x5176;&#x4E2D;&#x7684;data&#x53C2;&#x6570;&#x4E00;&#x822C;&#x662F;&#x5B57;&#x5178;&#xFF0C;&#x90A3;&#x4E48;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x8F6C;&#x6362;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">python&#x590D;&#x5236;&#x4EE3;&#x7801;    import urllib.request</span><br><span class="line">    # &#x5F15;&#x5165;&#x683C;&#x5F0F;&#x8F6C;&#x6362;&#x7684;&#x6A21;&#x5757;</span><br><span class="line">    from urllib import parse</span><br><span class="line">    </span><br><span class="line">    # &#x8BF7;&#x6C42;&#x5BF9;&#x8C61;&#x7684;&#x9650;&#x5236;&#x6240;&#x9700;&#x6570;&#x636E;url,headers&#x4EE5;&#x53CA;data</span><br><span class="line">    url = &apos;htttp://www.baidu.com&apos;</span><br><span class="line">    headers = {</span><br><span class="line">        &apos;User-Agent&apos;: &apos;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36&apos;,</span><br><span class="line">    }</span><br><span class="line">    data = {</span><br><span class="line">        &apos;name&apos;:&apos;lihua&apos;,</span><br><span class="line">        &apos;age&apos;:&apos;15&apos;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    # &#x5B57;&#x5178;&#x7C7B;&#x578B;&#x7684;data&#x4E0D;&#x7B26;&#x5408;&#x8981;&#x6C42;&#xFF0C;&#x9700;&#x8FDB;&#x884C;&#x4EE5;&#x4E0B;&#x8F6C;&#x6362;&#xFF01;&#xFF01;&#xFF01;</span><br><span class="line">    # urlencode&#x5C06;&#x5B57;&#x5178;&#x7C7B;&#x578B;&#x7684;data&#x8F6C;&#x6362;&#x6210;URL&#x80FD;&#x8BC6;&#x522B;&#x7684;&#x53C2;&#x6570;&#x7C7B;&#x578B;</span><br><span class="line">    #    &#x5373;&#xFF1A;name=lihua&amp;age=15</span><br><span class="line">    # &#x540C;&#x65F6;&#x4F7F;&#x7528;encode()&#x5C06;&#x5176;&#x8F6C;&#x6362;&#x4E3A;utf-8&#x683C;&#x5F0F;&#xFF0C;&#x56E0;&#x4E3A;&#x8BF7;&#x6C42;&#x5BF9;&#x8C61;&#x7684;&#x9650;&#x5236;&#x4E2D;&#x7684;data&#x53C2;&#x6570;&#x4E3A;bytes&#x7C7B;&#x578B;</span><br><span class="line">    #    &#x5373;&#xFF1A;b&apos;name=lihua&amp;age=15&apos;</span><br><span class="line">    data = parse.urlencode(data).encode()</span><br><span class="line">    </span><br><span class="line">    # &#x8FDB;&#x884C;&#x8BF7;&#x6C42;&#x5BF9;&#x8C61;&#x7684;&#x9650;&#x5236;&#xFF0C;&#x8D4B;&#x4E88;request</span><br><span class="line">    request = urlib.request.Request(url=url,data=data,headers=headers)</span><br><span class="line">    #&#x6A21;&#x62DF;&#x6D4F;&#x89C8;&#x5668;&#x6253;&#x5F00;request</span><br><span class="line">    response = urllib.request.urlopen(request)</span><br><span class="line">    </span><br><span class="line">    # &#x83B7;&#x53D6;&#x5230;&#x7684;&#x67D0;&#x4E2A;&#x7F51;&#x9875;&#x6E90;&#x7801;&#x6709;&#x53EF;&#x80FD;&#x662F;utf-8,gb2312&#x7B49;&#x7F16;&#x7801;&#x683C;&#x5F0F;&#xFF0C;&#x8981;&#x60F3;&#x5728;&#x7EC8;&#x7AEF;&#x8F93;&#x51FA;&#x6E90;&#x7801;&#xFF0C;&#x5219;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x89E3;&#x7801;(decode)&#xFF0C;&#x53D8;&#x6210;unicode&#x7F16;&#x7801;</span><br><span class="line">    content = response.read().decode()</span><br><span class="line">    print(content)</span><br></pre></td></tr></table></figure>

<h1 id="&#x6587;&#x4EF6;&#x95EE;&#x9898;"><a href="#&#x6587;&#x4EF6;&#x95EE;&#x9898;" class="headerlink" title="&#x6587;&#x4EF6;&#x95EE;&#x9898;"></a>&#x6587;&#x4EF6;&#x95EE;&#x9898;</h1><p><strong>1.&#x5728;&#x6587;&#x4EF6;&#x4E2D;&#x76F4;&#x63A5;&#x5199;&#x5165;str&#x7C7B;&#x578B;&#x7684;&#x5B57;&#x7B26;&#xFF0C;&#x4F1A;&#x5BFC;&#x81F4;&#x4E71;&#x7801;</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;string = &apos;&#x4F60;&#x597D;&#xFF01;&#x6211;&#x662F;&#x4E2D;&#x6587;&apos;</span><br><span class="line">fp =open(&apos;test.txt&apos;,&apos;w&apos;)</span><br><span class="line">fp.write(string)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&#xFFFD;&#xFFFD;&#xE3;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;&#xFFFD;</p>
</blockquote>
<p><strong>2.&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x4E71;&#x7801;&#xFF0C;&#x5C06;str&#x7C7B;&#x578B;&#x8F6C;&#x6362;&#x4E3A;bytes&#x7C7B;&#x578B;&#xFF0C;&#x5728;&#x5199;&#x5165;</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">python&#x590D;&#x5236;&#x4EE3;&#x7801;    string = &apos;&#x4F60;&#x597D;&#xFF01;&#x6211;&#x662F;&#x4E2D;&#x6587;&apos;</span><br><span class="line">    # &#x5C06;&#x6587;&#x4EF6;&#x7F16;&#x7801;&#x4E3A;utf-8&#x683C;&#x5F0F;</span><br><span class="line">    string_exchange = string.encode()  # &lt;class &apos;bytes&apos;&gt;</span><br><span class="line">    # &#x53C2;&#x6570;:</span><br><span class="line">    #    &quot;w&quot;&#xA0;- &#x5199;&#x5165; - &#x6253;&#x5F00;&#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x5199;&#x5165;&#xFF0C;&#x5982;&#x679C;&#x6587;&#x4EF6;&#x4E0D;&#x5B58;&#x5728;&#x5219;&#x521B;&#x5EFA;&#x8BE5;&#x6587;&#x4EF6;</span><br><span class="line">    #    &quot;b&quot;&#xA0;- &#x4E8C;&#x8FDB;&#x5236; - &#x4E8C;&#x8FDB;&#x5236;&#x6A21;&#x5F0F;&#xFF08;&#x4F8B;&#x5982;&#x56FE;&#x50CF;&#xFF09;&#x3002;</span><br><span class="line">    fp =open(&apos;test.txt&apos;,&apos;wb&apos;)</span><br><span class="line">    fp.write(string_exchange)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&#x4F60;&#x597D;&#xFF01;&#x6211;&#x662F;&#x4E2D;&#x6587;</p>
</blockquote>
<p><strong>3.&#x89E3;&#x51B3;&#x4E71;&#x7801;&#x7684;&#x53E6;&#x4E00;&#x79CD;&#x5F62;&#x5F0F;</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">python&#x590D;&#x5236;&#x4EE3;&#x7801;    string = &apos;&#x4F60;&#x597D;&#xFF01;&#x6211;&#x662F;&#x4E2D;&#x6587;&apos; </span><br><span class="line">    </span><br><span class="line">    #open&#x51FD;&#x6570;&#x5185;&#x7F6E;encoding&#xFF0C;&#x4E3A;&#x53EF;&#x9009;&#x53C2;&#x6570;</span><br><span class="line">    fp =open(&apos;test.txt&apos;,&apos;w&apos;,encoding=&apos;utf-8&apos;) </span><br><span class="line">    fp.write(string)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&#x4F60;&#x597D;&#xFF01;&#x6211;&#x662F;&#x4E2D;&#x6587;</p>
</blockquote>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/201f7c5d46ced9e303b9d24f46e7b912.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7035673373447290893.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7035673373447290893.html" itemprop="url">AQS原理学习</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-11-29T01:26:10+08:00">
                2021-11-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x672C;&#x4EBA;CSDN&#x5730;&#x5740;&#xFF1A;<a href="/external_links/6542cc1323105f9818a2e61e42179133.html" target="blank" rel="noopener">blog.csdn.net/qq_43731074&#x2026;</a></p>
<p>AQS&#x662F;&#x6307;JUC&#x5305;&#x4E0B;&#x7684;AbstractQueuedSynchronizer&#x7684;&#x7B80;&#x79F0;&#xFF0C;&#x5B83;&#x662F;Java&#x9501;&#x4EE5;&#x53CA;&#x4E00;&#x4E9B;&#x540C;&#x6B65;&#x5668;(JUC&#x5305;)&#x5B9E;&#x73B0;&#x7684;&#x6838;&#x5FC3;&#xFF0C;&#x5927;&#x90E8;&#x5206;JUC&#x4E0B;&#x7684;&#x7C7B;&#x5185;&#x90E8;&#x7684;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x5B9E;&#x73B0;&#x4E86;AQS&#x7684;&#x5B50;&#x7C7B;&#x6765;&#x63D0;&#x4F9B;&#x8F85;&#x52A9;&#x3002;<br>AQS&#x8FD8;&#x7EE7;&#x627F;&#x4E86;&#x4E00;&#x4E2A;AbstractOwnableSynchronizer&#x7C7B;&#xFF0C;&#x5B83;&#x662F;AQS&#x7684;&#x5B9E;&#x73B0;&#x7684;&#x91CD;&#x8981;&#x57FA;&#x7840;&#x3002;<br>AQS&#x5B9E;&#x73B0;&#x4E3B;&#x8981;&#x662F;&#x4F9D;&#x8D56;&#x4E00;&#x4E2A;&#x5148;&#x8FDB;&#x5148;&#x51FA;(FIFO)&#x7684;&#x7B49;&#x5F85;&#x961F;&#x5217;&#x548C;&#x4E00;&#x4E2A;volatile&#x6807;&#x8BB0;&#x7684;int&#x578B;state&#x72B6;&#x6001;&#x6807;&#x8BB0;&#x3002;<br>AQS&#x7684;FIFO&#x7B49;&#x5F85;&#x961F;&#x5217;&#xFF0C;&#x662F;&#x57FA;&#x4E8E;&#x53CC;&#x5411;&#x94FE;&#x8868;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x662F;&#x5178;&#x578B;&#x7684;CLH&#x961F;&#x5217;&#x6539;&#x9020;&#x800C;&#x6765;<br>&#x9996;&#x5148;&#x6765;&#x770B;&#x4E00;&#x4E0B;AQS&#x7C7B;&#x7684;&#x4E00;&#x4E0B;&#x6210;&#x5458;&#x53D8;&#x91CF;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;public abstract class AbstractQueuedSynchronizer</span><br><span class="line">    extends AbstractOwnableSynchronizer</span><br><span class="line">    implements java.io.Serializable {</span><br><span class="line">	//&#x7B49;&#x5F85;&#x961F;&#x5217;&#x5934;&#x8282;&#x70B9;</span><br><span class="line">    private transient volatile Node head;</span><br><span class="line">	</span><br><span class="line">    //&#x7B49;&#x5F85;&#x961F;&#x5217;&#x7684;&#x5C3E;&#x8282;&#x70B9;</span><br><span class="line">    private transient volatile Node tail;</span><br><span class="line"> /**</span><br><span class="line">     * Wait queue node class.</span><br><span class="line">     *</span><br><span class="line">     * &lt;p&gt;The wait queue is a variant of a &quot;CLH&quot; (Craig, Landin, and</span><br><span class="line">     * Hagersten) lock queue. CLH locks are normally used for</span><br><span class="line">     * spinlocks.  We instead use them for blocking synchronizers, but</span><br><span class="line">     * use the same basic tactic of holding some of the control</span><br><span class="line">     * information about a thread in the predecessor of its node.  A</span><br><span class="line">     * &quot;status&quot; field in each node keeps track of whether a thread</span><br><span class="line">     * should block.  A node is signalled when its predecessor</span><br><span class="line">     * releases.  Each node of the queue otherwise serves as a</span><br><span class="line">     * specific-notification-style monitor holding a single waiting</span><br><span class="line">     * thread. The status field does NOT control whether threads are</span><br><span class="line">     * granted locks etc though.  A thread may try to acquire if it is</span><br><span class="line">     * first in the queue. But being first does not guarantee success;</span><br><span class="line">     * it only gives the right to contend.  So the currently released</span><br><span class="line">     * contender thread may need to rewait.</span><br><span class="line">     * &lt;p&gt;To enqueue into a CLH lock, you atomically splice it in as new</span><br><span class="line">     * tail. To dequeue, you just set the head field.</span><br><span class="line">     * &lt;pre&gt;</span><br><span class="line">     *      +------+  prev +-----+       +-----+</span><br><span class="line">     * head |      | &lt;---- |     | &lt;---- |     |  tail</span><br><span class="line">     *      +------+       +-----+       +-----+</span><br><span class="line">     * &lt;/pre&gt;</span><br><span class="line">     *</span><br><span class="line">     **/</span><br><span class="line">     //&#x9759;&#x6001;&#x5185;&#x90E8;&#x7C7B;&#xFF0C;&#x662F;&#x5B9E;&#x73B0;&#x7B49;&#x5F85;&#x961F;&#x5217;&#x7684;&#x6838;&#x5FC3;&#x7C7B;&#xFF0C;&#x4ECE;&#x4E0A;&#x9762;&#x5B98;&#x65B9;&#x89E3;&#x6790;&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x662F;&#x4E00;&#x4E2A;&#x53CC;&#x5411;&#x94FE;&#x8868;&#x5B9E;&#x73B0;&#x7684;&#x4E00;&#x4E2A;FIFO&#x961F;&#x5217;&#xFF0C;&#x8BE5;&#x7C7B;&#x4E3B;&#x8981;&#x662F;&#x5C01;&#x88C5;&#x7EBF;&#x7A0B;&#x548C;&#x7EF4;&#x62A4;&#x7EBF;&#x7A0B;&#x7684;&#x4E00;&#x4E9B;&#x72B6;&#x6001;&#x6807;&#x8BB0;</span><br><span class="line">     //&#x540E;&#x9762;&#x4F1A;&#x5355;&#x72EC;&#x5206;&#x6790;&#x8BE5;&#x5185;&#x90E8;&#x7C7B;</span><br><span class="line">    static final class Node{&#x7701;&#x7565;...}</span><br><span class="line">    </span><br><span class="line">    //&#x540C;&#x6B65;&#x72B6;&#x6001;&#x6807;&#x8BB0;&#xFF0C;&#x53EA;&#x6709;&#x8BE5;&#x72B6;&#x6001;&#x7B49;&#x4E8E;0&#x7684;&#x65F6;&#x5019;&#x624D;&#x8868;&#x793A;&#x53EF;&#x4EE5;&#x5F53;&#x524D;&#x662F;&#x7A7A;&#x95F2;&#x7684;&#x6CA1;&#x6709;&#x88AB;&#x5360;&#x7528;&#x7684;&#xFF0C;&#x6B64;&#x65F6;&#x53EF;&#x4EE5;&#x6362;&#x4E00;&#x4E2A;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x7684;&#x7EBF;&#x7A0B;&#x6765;&#x5360;&#x7528;</span><br><span class="line">    private volatile int state;</span><br><span class="line">	//&#x7701;&#x7565;....</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4E0B;&#x9762;&#x770B;&#x770B;node&#x7C7B;&#x662F;&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x7684;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;    static final class Node {</span><br><span class="line">        /**&#x5171;&#x4EAB;&#x6807;&#x8BB0;&#x6A21;&#x5F0F;&#x7684;&#x6807;&#x8BB0; */</span><br><span class="line">        static final Node SHARED = new Node();</span><br><span class="line">        /** &#x72EC;&#x5360;&#x6A21;&#x5F0F;&#x7684;&#x6807;&#x8BB0;&#x8282;&#x70B9; */</span><br><span class="line">        static final Node EXCLUSIVE = null;</span><br><span class="line"></span><br><span class="line">        /** waitStatus&#x72B6;&#x6001;&#x6807;&#x8BB0;&#x7B49;&#x4E8E;-1&#x8868;&#x793A;&#x8282;&#x70B9;&#x4EE5;&#x53CA;&#x88AB;&#x53D6;&#x6D88;*/</span><br><span class="line">        static final int CANCELLED =  1;</span><br><span class="line">        /** &#x8868;&#x793A;&#x540E;&#x7EE7;&#x8282;&#x70B9;&#x5904;&#x4E8E;&#x7B49;&#x5F85;&#x72B6;&#x6001;&#xFF0C;&#x5982;&#x679C;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x662F;&#x5426;&#x6216;&#x8005;&#x53D6;&#x6D88;&#x5219;&#x88AB;&#x5524;&#x9192; */</span><br><span class="line">        static final int SIGNAL    = -1;</span><br><span class="line">        /** waitStatus&#x8868;&#x793A;&#x7EBF;&#x7A0B;&#x6B63;&#x5728;condition&#x7B49;&#x5F85;&#x6761;&#x4EF6;&#x4E0A; */</span><br><span class="line">        static final int CONDITION = -2;</span><br><span class="line">        /** &#x4E0B;&#x4E00;&#x6B21;&#x7684;&#x5171;&#x4EAB;&#x6A21;&#x5F0F;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x7684;&#x83B7;&#x53D6;&#x5C06;&#x4F1A;&#x65E0;&#x6761;&#x4EF6;&#x7684;&#x4F20;&#x64AD; */</span><br><span class="line">        static final int PROPAGATE = -3;</span><br><span class="line">     	/* waitStatus&#x7684;&#x521D;&#x59CB;&#x503C;&#x65F6;0,&#x4F7F;&#x7528;CAS&#x6765;&#x4FEE;&#x6539;&#x8282;&#x70B9;&#x7684;&#x72B6;&#x6001; */</span><br><span class="line">        volatile int waitStatus;</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * &#x524D;&#x9A71;&#x8282;&#x70B9;</span><br><span class="line">         */</span><br><span class="line">        volatile Node prev;</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * &#x540E;&#x7EE7;&#x8282;&#x70B9;</span><br><span class="line">         */</span><br><span class="line">        volatile Node next;</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * &#x5165;&#x961F;&#x7B49;&#x5F85;&#x7684;&#x7EBF;&#x7A0B;</span><br><span class="line">         */</span><br><span class="line">        volatile Thread thread;</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * &#x94FE;&#x63A5;&#x5230;&#x4E0B;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x7684;&#x7B49;&#x5F85;&#x6761;&#x4EF6;,&#x6216;&#x7279;&#x6B8A;&#x7684;&#x503C;SHARED,&#x56E0;&#x4E3A;&#x6761;&#x4EF6;&#x961F;&#x5217;&#x53EA;&#x6709;&#x5728;&#x72EC;&#x5360;&#x6A21;&#x5F0F;&#x65F6;&#x624D;&#x80FD;&#x88AB;&#x8BBF;&#x95EE;,</span><br><span class="line">         * &#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x8FDE;&#x63A5;&#x961F;&#x5217;&#x5728;&#x7B49;&#x5F85;&#x7684;&#x65F6;&#x5019;&#x4FDD;&#x5B58;&#x8282;&#x70B9;,&#x7136;&#x540E;&#x628A;&#x5B83;&#x4EEC;&#x8F6C;&#x79FB;&#x5230;&#x961F;&#x5217;&#x4E2D;&#x91CD;&#x65B0;&#x83B7;&#x53D6;</span><br><span class="line">         * &#x56E0;&#x4E3A;&#x6761;&#x4EF6;&#x53EA;&#x80FD;&#x662F;&#x72EC;&#x5360;&#x6027;&#x7684;,&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x4F7F;&#x7528;&#x7279;&#x6B8A;&#x7684;&#x503C;&#x6765;&#x8868;&#x793A;&#x5171;&#x4EAB;&#x6A21;&#x5F0F;</span><br><span class="line">         */</span><br><span class="line">        Node nextWaiter;</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         *&#x5224;&#x65AD;&#x662F;&#x5426;&#x5171;&#x4EAB;&#x6A21;&#x5F0F;</span><br><span class="line">         */</span><br><span class="line">        final boolean isShared() {</span><br><span class="line">            return nextWaiter == SHARED;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * &#x83B7;&#x53D6;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;&#x524D;&#x9A71;&#x8282;&#x70B9;</span><br><span class="line">         * @return the predecessor of this node</span><br><span class="line">         */</span><br><span class="line">        final Node predecessor() throws NullPointerException {</span><br><span class="line">            Node p = prev;</span><br><span class="line">            if (p == null)</span><br><span class="line">                throw new NullPointerException();</span><br><span class="line">            else</span><br><span class="line">                return p;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        Node() {    // Used to establish initial head or SHARED marker</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        Node(Thread thread, Node mode) {     // &#x6307;&#x70B9;&#x7EBF;&#x7A0B;&#x548C;&#x6A21;&#x5F0F;&#x7684;&#x6784;&#x9020;&#x5668;</span><br><span class="line">            this.nextWaiter = mode;</span><br><span class="line">            this.thread = thread;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        Node(Thread thread, int waitStatus) { // &#x6307;&#x5B9A;&#x7EBF;&#x7A0B;&#x548C;&#x7EBF;&#x7A0B;&#x72B6;&#x6001;&#x7684;&#x6784;&#x9020;&#x5668;</span><br><span class="line">            this.waitStatus = waitStatus;</span><br><span class="line">            this.thread = thread;</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>AQS &#x7684;&#x5927;&#x4F53;&#x7ED3;&#x6784;&#x56FE;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/ade039c43cb5762e94946580c59be33d6fa6ba420dfb8a6b3b6867aa5f2c3aa1" alt="&#x5728;&#x8FD9;&#x91CC;&#x63D2;&#x5165;&#x56FE;&#x7247;&#x63CF;&#x8FF0;"><br>&#x4E0B;&#x9762;&#x4EE5;&#x5206;&#x6790;ReentrantLock&#x4E3A;&#x4F8B;&#x5206;&#x6790;&#x5206;&#x6790;&#x72EC;&#x5360;&#x6A21;&#x5F0F;&#x4E0B;&#xFF0C;&#x6574;&#x4E2A;&#x83B7;&#x53D6;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x6210;&#x529F;&#x4EE5;&#x53CA;&#x5931;&#x8D25;&#x7684;&#x5904;&#x7406;&#x8FC7;&#x7A0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;    public final void acquire(int arg) {</span><br><span class="line">        if (!tryAcquire(arg) &amp;&amp;</span><br><span class="line">            acquireQueued(addWaiter(Node.EXCLUSIVE), arg))</span><br><span class="line">            selfInterrupt();</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>&#x8BE5;&#x65B9;&#x6CD5;&#x4E3B;&#x8981;&#x662F;&#x7528;&#x4E8E;&#x83B7;&#x53D6;&#x540C;&#x6B65;&#x72B6;&#x6001;&#xFF0C;&#x4E3B;&#x8981;&#x5206;&#x4E3A;&#x51E0;&#x5927;&#x6B65;&#xFF0C;&#x7B2C;&#x4E00;&#x6B65;&#x5148;&#x901A;&#x8FC7;tryAcquire(arg)&#x7B2C;&#x4E00;&#x6B21;&#x5C1D;&#x8BD5;&#x83B7;&#x53D6;&#x540C;&#x6B65;&#x72B6;&#x6001;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;AQS&#x5E76;&#x6CA1;&#x6709;&#x5B9E;&#x73B0;&#xFF0C;&#x800C;&#x662F;&#x5728;&#x76F8;&#x5E94;&#x7684;&#x5B50;&#x7C7B;&#x4E2D;&#x5B9E;&#x73B0;&#x6BD4;&#x5982;Reentrantlock&#x5185;&#x90E8;&#x4E3A;&#x4E86;&#x5B9E;&#x73B0;&#x516C;&#x5E73;&#x9501;&#x548C;&#x975E;&#x516C;&#x5E73;&#x9501;&#x5206;&#x522B;&#x5B9E;&#x73B0;&#x4E86;&#x4E0D;&#x540C;&#x903B;&#x8F91;&#x7684;tryAcquire&#xFF0C;&#x5982;&#x679C;&#x8BE5;&#x65B9;&#x6CD5;&#x5C1D;&#x8BD5;&#x83B7;&#x53D6;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x5931;&#x8D25;&#xFF0C;&#x5C31;&#x8FDB;&#x884C;&#x7B2C;&#x4E8C;&#x6B65;&#x8FDB;&#x5165;addWaiter(Node.EXCLUSIVE)&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x4E3B;&#x8981;&#x662F;&#x628A;&#x5F53;&#x524D;&#x83B7;&#x53D6;&#x4E0D;&#x5230;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x7684;&#x7EBF;&#x7A0B;&#x8FDB;&#x884C;&#x5C01;&#x88C5;&#x6210;&#x529F;&#x4E00;&#x4E2A;node&#x8282;&#x70B9;&#x7136;&#x540E;&#x8FDB;&#x5165;&#x7B49;&#x5F85;&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x7B2C;&#x4E09;&#x6B65;&#x5C31;&#x662F;&#x8FDB;&#x5165;&#x7B49;&#x5F85;&#x961F;&#x5217;&#x4E4B;&#x540E;&#xFF0C;&#x8FD8;&#x597D;&#x91CD;&#x65B0;&#x901A;&#x8FC7;&#x81EA;&#x65CB;&#x5C1D;&#x8BD5;&#x83B7;&#x53D6;&#x540C;&#x6B65;&#x72B6;&#x6001;&#xFF0C;&#x81EA;&#x65CB;&#x5230;&#x4E00;&#x5B9A;&#x7A0B;&#x5EA6;&#xFF0C;&#x53D1;&#x73B0;&#x8FD8;&#x662F;&#x6CA1;&#x6709;&#x83B7;&#x53D6;&#x5230;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x5219;&#x901A;&#x8FC7;LockSupport&#x7C7B;&#x8FDB;&#x884C;&#x628A;&#x7EBF;&#x7A0B;&#x6302;&#x8D77;&#x64CD;&#x4F5C;&#x3002;&#x5982;&#x679C;&#x4E2D;&#x95F4;&#x51FA;&#x73B0;&#x88AB;&#x4E2D;&#x65AD;&#x5219;&#x7EBF;&#x7A0B;&#x8FDB;&#x884C;&#x81EA;&#x6211;&#x4E2D;&#x65AD;&#x3002;<br>&#x63A5;&#x7740;&#x770B;addWaiter&#x65B9;&#x6CD5;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;    /**</span><br><span class="line">     * Creates and enqueues node for current thread and given mode.</span><br><span class="line">     *</span><br><span class="line">     * @param mode Node.EXCLUSIVE for exclusive, Node.SHARED for shared</span><br><span class="line">     * @return the new node</span><br><span class="line">     */</span><br><span class="line">    private Node addWaiter(Node mode) {</span><br><span class="line">    	//&#x6839;&#x636E;&#x7EBF;&#x7A0B;&#x548C;&#x6A21;&#x5F0F;&#xFF0C;&#x5C01;&#x88C5;&#x6210;&#x4E00;&#x4E2A;node&#x8282;&#x70B9;</span><br><span class="line">        Node node = new Node(Thread.currentThread(), mode);</span><br><span class="line">        // Try the fast path of enq; backup to full enq on failure</span><br><span class="line">        Node pred = tail;</span><br><span class="line">        //&#x5982;&#x679C;&#x4E0D;&#x662F;&#x7B2C;&#x4E00;&#x6B21;&#x5165;&#x961F;</span><br><span class="line">        if (pred != null) {</span><br><span class="line">        	//&#x5C3E;&#x90E8;&#x6DFB;&#x52A0;&#x8BE5;&#x8282;&#x70B9;</span><br><span class="line">            node.prev = pred;</span><br><span class="line">            //&#x7136;&#x540E;&#x901A;&#x8FC7;cas&#x8BBE;&#x7F6E;&#x4E3A;&#x5C3E;&#x8282;&#x70B9;</span><br><span class="line">            if (compareAndSetTail(pred, node)) {</span><br><span class="line">                pred.next = node;</span><br><span class="line">                return node;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        //&#x5982;&#x679C;&#x7B2C;&#x4E00;&#x6B21;&#x5219;&#x8FDB;&#x5165;enq&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x521B;&#x5EFA;</span><br><span class="line">        enq(node);</span><br><span class="line">        return node;</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>addWaiter&#x65B9;&#x6CD5;&#x4E3B;&#x8981;&#x662F;&#x628A;&#x65E0;&#x6CD5;&#x83B7;&#x53D6;&#x5230;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x7684;&#x7EBF;&#x7A0B;&#x5C01;&#x88C5;&#x6210;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x7136;&#x540E;&#x8FDB;&#x5165;&#x7B49;&#x5F85;&#x961F;&#x5217;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x7B2C;&#x4E00;&#x6B21;&#x5165;&#x961F;&#xFF0C;&#x5219;&#x64E6;&#x9EC4;&#x91D1;&#x4E00;&#x4E2A;&#x7A7A;&#x8282;&#x70B9;&#x4F5C;&#x4E3A;&#x54E8;&#x5175;&#x8282;&#x70B9;&#x7528;&#x4E8E;&#x5524;&#x9192;&#x540E;&#x7EE7;&#x8282;&#x70B9;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x662F;&#x7B2C;&#x4E00;&#x6B21;&#x5165;&#x961F;&#xFF0C;&#x5219;&#x628A;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x7684;&#x5C01;&#x88C5;&#x7684;&#x8282;&#x70B9;&#x4ECE;&#x5C3E;&#x90E8;&#x6DFB;&#x52A0;&#xFF0C;&#x7136;&#x540E;&#x901A;&#x8FC7;cas&#x628A;&#x8BE5;&#x8282;&#x70B9;&#x8BBE;&#x7F6E;&#x4E3A;&#x5C3E;&#x8282;&#x70B9;&#x3002;<br>&#x4E0B;&#x9762;&#x6765;&#x770B;&#x770B;enq&#x662F;&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;    private Node enq(final Node node) {</span><br><span class="line">        for (;;) {</span><br><span class="line">        //&#x83B7;&#x53D6;&#x5C3E;&#x8282;&#x70B9;</span><br><span class="line">            Node t = tail;</span><br><span class="line">            if (t == null) { // &#x5982;&#x679C;&#x7B49;&#x4E8E;&#x7A7A;&#x5219;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x7A7A;&#x7684;node&#x8282;&#x70B9;&#xFF0C;&#x5E76;&#x901A;&#x8FC7;cas&#x8BBE;&#x7F6E;&#x4E3A;&#x5934;&#x8282;&#x70B9;</span><br><span class="line">                if (compareAndSetHead(new Node()))</span><br><span class="line">           			&#x540C;&#x65F6;&#x8BA9;&#x5C3E;&#x8282;&#x70B9;&#x6267;&#x884C;&#x540C;</span><br><span class="line">                    tail = head;</span><br><span class="line">            } else {</span><br><span class="line">            //&#x521B;&#x5EFA;&#x5B8C;&#x4E00;&#x4E2A;&#x961F;&#x5217;&#x540E;&#xFF0C;&#x975E;&#x7A7A;&#x72B6;&#x6001;&#x5219;&#x8FDB;&#x5165;&#x5F53;&#x524D;else&#x7136;&#x540E;&#x5728;&#x5C3E;&#x90E8;&#x6DFB;&#x52A0;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x5C01;&#x88C5;&#x7684;&#x8282;&#x70B9;&#xFF0C;&#x518D;&#x901A;&#x8FC7;cas&#x628A;&#x8282;&#x70B9;&#x8BBE;&#x7F6E;&#x6210;&#x5C3E;&#x8282;&#x70B9;</span><br><span class="line">                node.prev = t;</span><br><span class="line">                if (compareAndSetTail(t, node)) {</span><br><span class="line">                    t.next = node;</span><br><span class="line">                    return t;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>&#x6574;&#x4E2A;&#x65B9;&#x6CD5;&#x903B;&#x8F91;&#xFF1A;&#x9996;&#x5148;&#x901A;&#x8FC7;&#x81EA;&#x65CB;&#x5224;&#x65AD;&#x5C3E;&#x8282;&#x70B9;&#x662F;&#x5426;&#x4E3A;&#x7A7A;&#xFF0C;&#x5982;&#x679C;&#x4E3A;&#x7A7A;&#x5219;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x7A7A;&#x8282;&#x70B9;&#xFF0C;&#x5E76;&#x4E14;&#x8BBE;&#x7F6E;&#x4E3A;&#x5934;&#x8282;&#x70B9;&#x5E76;&#x4E14;&#x5C3E;&#x8282;&#x70B9;&#x6307;&#x5411;&#x5934;&#x8282;&#x70B9;&#xFF0C;&#x5F53;&#x518D;&#x6B21;&#x5FAA;&#x73AF;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6B64;&#x65F6;&#x5C3E;&#x8282;&#x70B9;&#x5DF2;&#x7ECF;&#x4E0D;&#x662F;&#x7A7A;&#x4E86;&#xFF0C;&#x8FD9;&#x65F6;&#x5019;&#x628A;&#x4F20;&#x5165;&#x7684;node&#x8282;&#x70B9;&#x8FDB;&#x884C;&#x8282;&#x70B9;&#x6DFB;&#x52A0;&#xFF0C;&#x5E76;&#x628A;&#x8BBE;&#x7F6E;&#x4E3A;&#x5C3E;&#x8282;&#x70B9;&#x3002;</p>
<p>&#x63A5;&#x7740;&#x770B;acquireQueued&#x5728;addwaiter&#x65B9;&#x6CD5;&#x6DFB;&#x52A0;&#x7EBF;&#x7A0B;&#x8FDB;&#x5165;&#x7B49;&#x5F85;&#x961F;&#x5217;&#x662F;&#x5982;&#x4F55;&#x901A;&#x8FC7;&#x8BE5;&#x65B9;&#x6CD5;&#x91CD;&#x65B0;&#x5C1D;&#x8BD5;&#x83B7;&#x53D6;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x4EE5;&#x53CA;&#x5931;&#x8D25;&#x540E;&#x662F;&#x5982;&#x4F55;&#x5904;&#x7406;&#x7684;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;    final boolean acquireQueued(final Node node, int arg) {</span><br><span class="line">    	//&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x64CD;&#x4F5C;&#x5931;&#x8D25;&#x6807;&#x8BB0;</span><br><span class="line">        boolean failed = true;</span><br><span class="line">        try {</span><br><span class="line">        //&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x4E2D;&#x65AD;&#x6807;&#x8BB0;&#x9ED8;&#x8BA4;&#x6CA1;&#x4E0D;&#x4E2D;&#x65AD;</span><br><span class="line">            boolean interrupted = false;</span><br><span class="line">            //&#x4E0B;&#x9762;&#x662F;&#x81EA;&#x65CB;</span><br><span class="line">            for (;;) {</span><br><span class="line">            //&#x83B7;&#x53D6;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x7684;&#x524D;&#x9A71;&#x8282;&#x70B9;</span><br><span class="line">                final Node p = node.predecessor();</span><br><span class="line">                //&#x5224;&#x65AD;&#x662F;&#x5426;&#x662F;&#x5934;&#x8282;&#x70B9;&#xFF0C;&#x540C;&#x65F6;&#x518D;&#x6B21;&#x901A;&#x8FC7;trayAcquire&#x83B7;&#x53D6;&#x540C;&#x6B65;&#x72B6;&#x6001;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x5934;&#x8282;&#x70B9;&#x5E76;&#x4E14;&#x83B7;&#x53D6;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x6210;&#x529F;(&#x8868;&#x660E;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;&#x7EBF;&#x7A0B;&#x5DF2;&#x7ECF;&#x88AB;&#x8BBE;&#x7F6E;&#x4E3A;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x7684;&#x62E5;&#x6709;&#x8005;)</span><br><span class="line">                if (p == head &amp;&amp; tryAcquire(arg)) {</span><br><span class="line">                    setHead(node);//&#x628A;&#x5F53;&#x524D;&#x4F20;&#x5165;&#x8FDB;&#x6765;&#x7684;&#x8282;&#x70B9;node&#x8BBE;&#x7F6E;&#x4E3A;&#x5934;&#x8282;&#x70B9;&#xFF0C;</span><br><span class="line">                    p.next = null; // &#x65AD;&#x5F00;&#x4E0E;&#x524D;&#x9A71;&#x8282;&#x70B9;&#x7684;&#x8FDE;&#x63A5;&#x4FBF;&#x4E8E;GC&#x56DE;&#x6536;</span><br><span class="line">                    failed = false;//&#x8868;&#x8868;&#x793A;&#x6210;&#x529F;&#x83B7;&#x53D6;&#x540C;&#x6B65;&#x72B6;&#x6001;&#xFF0C;&#x8FD4;&#x56DE;&#x4E2D;&#x65AD;&#x6807;&#x8BB0;</span><br><span class="line">                    return interrupted;</span><br><span class="line">                }</span><br><span class="line">                //&#x5982;&#x679C;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;&#x524D;&#x9A71;&#x8282;&#x70B9;&#x4E0D;&#x662F;&#x5934;&#x8282;&#x70B9;&#xFF0C;&#x5373;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x4E0D;&#x662F;&#x7B2C;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#xFF0C;&#x5219;&#x5C1D;&#x8BD5;&#x5224;&#x65AD;&#x662F;&#x5426;&#x5E94;&#x8BE5;&#x628A;&#x8BE5;&#x7EBF;&#x7A0B;&#x6302;&#x8D77;&#xFF0C;</span><br><span class="line">                //&#x5982;&#x679C;&#x9002;&#x5408;&#x6302;&#x8D77;&#x5219;&#x8C03;&#x7528;parkAndCheckInterrupt&#x8FDB;&#x884C;&#x6302;&#x8D77;(&#x5B9E;&#x73B0;&#x6302;&#x8D77;&#x64CD;&#x4F5C;&#x662F;&#x5229;&#x7528;LockSupport.park(this))</span><br><span class="line">                if (shouldParkAfterFailedAcquire(p, node) &amp;&amp;</span><br><span class="line">                    parkAndCheckInterrupt())</span><br><span class="line">                    interrupted = true;</span><br><span class="line">            }</span><br><span class="line">        } finally {</span><br><span class="line">        //&#x5982;&#x679C;&#x64CD;&#x4F5C;&#x5931;&#x8D25;&#x5219;&#x653E;&#x5F03;&#x83B7;&#x53D6;&#x540C;&#x6B65;&#x72B6;&#x6001;</span><br><span class="line">            if (failed)</span><br><span class="line">                cancelAcquire(node);</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>&#x8BE5;&#x65B9;&#x6CD5;&#x4E3B;&#x8981;&#x903B;&#x8F91;&#xFF1A;&#x9996;&#x5148;&#x5224;&#x65AD;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;&#x524D;&#x9A71;&#x8282;&#x70B9;&#x662F;&#x5426;&#x662F;&#x5934;&#x8282;&#x70B9;&#x5E76;&#x4E14;&#x901A;&#x8FC7;tryacquire&#x65B9;&#x6CD5;&#x518D;&#x6B21;&#x83B7;&#x53D6;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x5982;&#x679C;&#x6210;&#x529F;&#x5219;&#x8868;&#x660E;&#x8BE5;&#x7EBF;&#x7A0B;&#x662F;&#x7B2C;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x5219;&#x76F4;&#x63A5;&#x6267;&#x884C;&#xFF0C;&#x5E76;&#x628A;&#x8BE5;&#x8282;&#x70B9;&#x8BBE;&#x7F6E;&#x4E3A;&#x65B0;&#x7684;&#x5934;&#x8282;&#x70B9;&#xFF0C;&#x5E76;&#x628A;&#x524D;&#x9A71;&#x8282;&#x70B9;&#x65AD;&#x5F00;&#x4EE5;&#x4FBF;&#x4E8E;gc&#x56DE;&#x6536;&#xFF0C;&#x7136;&#x540E;&#x8FD4;&#x56DE;&#xFF0C;&#x7B2C;&#x4E8C;&#x79CD;&#x60C5;&#x51B5;&#x5C31;&#x662F;&#x975E;&#x7B2C;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#xFF0C;&#x5728;&#x8FDB;&#x5165;shouldParkAfterFailedAcquire&#x65B9;&#x6CD5;&#x5224;&#x65AD;&#x662F;&#x5426;&#x9002;&#x5408;&#x6302;&#x8D77;&#xFF0C;&#x5982;&#x679C;&#x9002;&#x5408;&#x5219;&#x8C03;&#x7528;parkAndCheckInterrupt&#x65B9;&#x6CD5;&#x53BB;&#x6267;&#x884C; LockSupport.park(this);&#x8FDB;&#x884C;&#x6302;&#x8D77;&#x64CD;&#x4F5C;&#x3002;<br>&#x63A5;&#x7740;&#x770B;&#x770B;shouldParkAfterFailedAcquire&#x662F;&#x5982;&#x4F55;&#x5224;&#x65AD;&#x662F;&#x5426;&#x5E94;&#x8BE5;&#x6302;&#x8D77;&#x7684;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;    private static boolean shouldParkAfterFailedAcquire(Node pred, Node node) {</span><br><span class="line">    	//&#x83B7;&#x53D6;&#x524D;&#x9A71;&#x8282;&#x70B9;&#x7684;ws&#x5224;&#x65AD;&#x5904;&#x4E8E;&#x90A3;&#x79CD;&#x72B6;&#x6001;&#x3002;</span><br><span class="line">        int ws = pred.waitStatus;</span><br><span class="line">        //&#x5982;&#x679C;&#x662F;SIGNAL(-1)&#x8868;&#x793A;&#x5F53;&#x524D;&#x524D;&#x9A71;&#x8282;&#x70B9;&#x91CA;&#x653E;&#x540E;&#x4F1A;&#x5524;&#x9192;&#x5F53;&#x524D;&#x8282;&#x70B9;node&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x5B89;&#x5168;&#x6302;&#x8D77;</span><br><span class="line">        if (ws == Node.SIGNAL)</span><br><span class="line">            return true;</span><br><span class="line">        if (ws &gt; 0) {</span><br><span class="line">            /*</span><br><span class="line">             * Predecessor was cancelled. Skip over predecessors and</span><br><span class="line">             * indicate retry.</span><br><span class="line">             * &#x5982;&#x679C;&#x524D;&#x9A71;&#x8282;&#x70B9;&#x7684;&#x72B6;&#x6001;&#x662F;&gt;0&#x8868;&#x793A;&#x5DF2;&#x7ECF;&#x88AB;&#x53D6;&#x6D88;&#x6216;&#x8005;&#x8BF4;&#x653E;&#x5F03;&#x4E86;&#xFF0C;&#x5219;&#x8DF3;&#x8FC7;&#x8BE5;&#x524D;&#x9A71;&#x8282;&#x70B9;&#xFF0C;&#x901A;&#x8FC7;&#x9009;&#x597D;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;&#x524D;&#x9A71;&#x8282;&#x70B9;&#x4E00;&#x76F4;</span><br><span class="line">             * &#x627E;&#x5230;&#x72B6;&#x6001;ws&lt;0&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x4E3A;&#x6B62;&#xFF0C;&#x7136;&#x540E;&#x628A;&#x5F53;&#x524D;node&#x8282;&#x70B9;&#x8FDE;&#x63A5;&#x5728;&#x8BE5;&#x8282;&#x70B9;&#x7684;&#x540E;&#x7EE7;&#x8282;&#x70B9;&#x4E0A;</span><br><span class="line">             */</span><br><span class="line">            do {</span><br><span class="line">                node.prev = pred = pred.prev;</span><br><span class="line">            } while (pred.waitStatus &gt; 0);</span><br><span class="line">            pred.next = node;</span><br><span class="line">        } else {</span><br><span class="line">            /*</span><br><span class="line">             * &#x5982;&#x679C;&#x524D;&#x9A71;&#x8282;&#x70B9;&#x662F;0&#x6216;&#x8005;propagate&#x5219;&#x8868;&#x793A;&#x524D;&#x9A71;&#x8282;&#x70B9;&#x6B63;&#x5728;&#x5360;&#x7528;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x6B64;&#x65F6;&#x9700;&#x8981;&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;signal&#xFF0C;&#x4E0D;&#x80FD;&#x6302;&#x8D77;&#xFF0C;</span><br><span class="line">             * &#x9700;&#x8981;&#x91CD;&#x65B0;&#x786E;&#x5B9A;&#x4E0D;&#x80FD;&#x83B7;&#x53D6;&#x4E4B;&#x540E;&#x624D;&#x53EF;&#x4EE5;&#x88AB;&#x6302;&#x8D77;</span><br><span class="line">             */</span><br><span class="line">            compareAndSetWaitStatus(pred, ws, Node.SIGNAL);</span><br><span class="line">        }</span><br><span class="line">        //&#x8FD4;&#x56DE;&#x4E0D;&#x80FD;&#x88AB;&#x6302;&#x8D77;</span><br><span class="line">        return false;</span><br><span class="line">    }</span><br><span class="line">   //&#x5982;&#x679C;&#x5224;&#x65AD;&#x91CA;&#x653E;&#x88AB;&#x6302;&#x8D77;&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;true&#x5219;&#x8C03;&#x7528;&#x8BE5;&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x6302;&#x8D77;&#x64CD;&#x4F5C;&#x3002;</span><br><span class="line">   private final boolean parkAndCheckInterrupt() {</span><br><span class="line">        LockSupport.park(this);</span><br><span class="line">        return Thread.interrupted();</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>&#x5224;&#x65AD;&#x91CA;&#x653E;&#x9002;&#x5408;&#x6302;&#x8D77;&#x65B9;&#x6CD5;&#xFF0C;&#x5206;&#x4E09;&#x6B65;&#xFF0C;&#x7B2C;&#x4E00;&#x6B65;&#x5224;&#x65AD;&#x524D;&#x9A71;&#x8282;&#x70B9;&#x91CA;&#x653E;&#x72B6;&#x6001;&#x4E4B;&#x540E;&#x4F1A;&#x5524;&#x9192;node&#x8282;&#x70B9;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x5B89;&#x5168;&#x7684;&#x6302;&#x8D77;&#xFF0C;&#x7B2C;&#x4E8C;&#x6B65;&#xFF0C;&#x5982;&#x679C;&#x524D;&#x9A71;&#x8282;&#x70B9;&#x5DF2;&#x7ECF;&#x653E;&#x5F03;&#x83B7;&#x53D6;&#xFF0C;&#x5219;&#x901A;&#x5FAA;&#x73AF;&#x83B7;&#x53D6;&#x7B2C;&#x4E00;&#x4E2A;&#x8FD8;&#x6CA1;&#x653E;&#x5F03;&#x83B7;&#x53D6;&#x7684;&#x8282;&#x70B9;&#x7136;&#x540E;&#x8BA9;node&#x8282;&#x70B9;&#x63A5;&#x4E0A;&#x53BB;&#x3002;&#x7B2C;&#x4E09;&#x6B65;&#xFF0C;&#x5982;&#x679C;&#x524D;&#x9A71;&#x8282;&#x70B9;&#x6B63;&#x5904;&#x4E8E;&#x6301;&#x6709;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x6216;&#x8005;&#x662F;&#x5171;&#x4EAB;&#x6A21;&#x5F0F;&#xFF0C;&#x5219;&#x9700;&#x8981;&#x8BBE;&#x7F6E;&#x524D;&#x9A71;&#x8282;&#x70B9;&#x7684;ws&#x72B6;&#x6001;&#x6807;&#x8BB0;&#x4E3A;SIGNAL&#x8868;&#x793A;&#x91CA;&#x653E;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x540E;&#x5524;&#x9192;&#x8BE5;&#x540E;&#x627F;&#x8282;&#x70B9;&#x3002;</p>
<p>&#x5982;&#x679C;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x83B7;&#x53D6;&#x5931;&#x8D25;&#xFF0C;&#x6302;&#x8D77;&#x4E5F;&#x5931;&#x8D25;&#x4E86;&#xFF0C;&#x5219;&#x4F1A;&#x6267;&#x884C;&#x53D6;&#x6D88;&#x83B7;&#x53D6;&#x65B9;&#x6CD5;cancelAcquire</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;    private void cancelAcquire(Node node) {</span><br><span class="line">        // &#x5224;&#x65AD;npe</span><br><span class="line">        if (node == null)</span><br><span class="line">            return;</span><br><span class="line">		&#x628A;&#x8282;&#x70B9;&#x7EBF;&#x7A0B;&#x7F6E;&#x4E3A;null</span><br><span class="line">        node.thread = null;</span><br><span class="line"></span><br><span class="line">        // &#x83B7;&#x53D6;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;&#x524D;&#x9A71;&#x8282;&#x70B9;&#x5E76;&#x4E14;&#x5224;&#x65AD;&#x72B6;&#x6001;&#x8BBE;&#x7F6E;&#x524D;&#x9A71;&#x8282;&#x70B9;</span><br><span class="line">        Node pred = node.prev;</span><br><span class="line">        //&#x5982;&#x679C;&#x524D;&#x9A71;&#x8282;&#x70B9;ws&gt;0&#x8868;&#x793A;&#x5DF2;&#x7ECF;&#x653E;&#x5F03;&#x83B7;&#x53D6;&#xFF0C;&#x5219;&#x5FAA;&#x73AF;&#x83B7;&#x53D6;ws&#x5C0F;&#x4E8E;0&#x7684;&#x5E76;&#x8FDE;&#x63A5;&#x8D77;&#x6765;</span><br><span class="line">        while (pred.waitStatus &gt; 0)</span><br><span class="line">            node.prev = pred = pred.prev;</span><br><span class="line"></span><br><span class="line">        // &#x83B7;&#x53D6;&#x524D;&#x9A71;&#x63A5;i&#x5355;&#x72EC;&#x540E;&#x7EE7;&#x8282;&#x70B9;</span><br><span class="line">        Node predNext = pred.next;</span><br><span class="line"></span><br><span class="line">        // &#x628A;node&#x8282;&#x70B9;&#x7684;&#x72B6;&#x6001;&#x6807;&#x8BB0;&#x6539;&#x5B8C;&#x53D6;&#x6D88;&#x72B6;&#x6001;</span><br><span class="line">        node.waitStatus = Node.CANCELLED;</span><br><span class="line"></span><br><span class="line">        // &#x5982;&#x679C;node&#x662F;&#x540E;&#x7EE7;&#x8282;&#x70B9;&#xFF0C;&#x5219;&#x901A;&#x8FC7;cas&#x628A;&#x524D;&#x9A71;&#x8282;&#x70B9;&#x8BBE;&#x7F6E;&#x6211;&#x4E3A;&#x5C3E;&#x8282;&#x70B9;&#xFF0C;&#x540C;&#x65F6;&#x628A;&#x540E;&#x7EE7;&#x8282;&#x70B9;&#x8BBE;&#x7F6E;&#x4E3A;null</span><br><span class="line">        if (node == tail &amp;&amp; compareAndSetTail(node, pred)) {</span><br><span class="line">            compareAndSetNext(pred, predNext, null);</span><br><span class="line">        } else {</span><br><span class="line">            // &#x5982;&#x679C;&#x524D;&#x9A71;&#x8282;&#x70B9;&#x4E0D;&#x662F;&#x5934;&#x8282;&#x70B9;&#xFF0C;ws&#x5C0F;&#x4E8E;0&#x4EE5;&#x53CA;&#x901A;&#x8FC7;cas&#x8BBE;&#x7F6E;&#x524D;&#x9A71;&#x8282;&#x70B9;ws&#x72B6;&#x6001;&#x4E3A;signal&#x6210;&#x529F;&#xFF0C;&#x5E76;&#x4E14;&#x524D;&#x9A71;&#x8282;&#x70B9;&#x7EBF;&#x7A0B;&#x4E0D;&#x4E3A;&#x7A7A;&#x5219;</span><br><span class="line">            //&#x5219;&#x628A;&#x524D;&#x9A71;&#x8282;&#x70B9;&#x7684;&#x540E;&#x7EE7;&#x8282;&#x70B9;&#x8BBE;&#x7F6E;&#x4E3A;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;&#x540E;&#x7EE7;&#x8282;&#x70B9;</span><br><span class="line">            int ws;</span><br><span class="line">            if (pred != head &amp;&amp;</span><br><span class="line">                ((ws = pred.waitStatus) == Node.SIGNAL ||</span><br><span class="line">                 (ws &lt;= 0 &amp;&amp; compareAndSetWaitStatus(pred, ws, Node.SIGNAL))) &amp;&amp;</span><br><span class="line">                pred.thread != null) {</span><br><span class="line">                Node next = node.next;</span><br><span class="line">                if (next != null &amp;&amp; next.waitStatus &lt;= 0)</span><br><span class="line">                    compareAndSetNext(pred, predNext, next);</span><br><span class="line">            } else {//&#x5982;&#x679C;&#x662F;&#x5934;&#x8282;&#x70B9;&#x5219;&#x5524;&#x9192;&#x4ED6;&#x7684;&#x540E;&#x7EE7;&#x8282;&#x70B9;</span><br><span class="line">                unparkSuccessor(node);</span><br><span class="line">            }</span><br><span class="line">			//&#x8BA9;node&#x8282;&#x70B9;&#x6307;&#x5411;node&#x65B9;&#x4FBF;GC</span><br><span class="line">            node.next = node; // help GC</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>&#x63A5;&#x7740;&#x770B;unparkSuccessor&#x662F;&#x5982;&#x4F55;&#x5524;&#x9192;&#x540E;&#x7EE7;&#x8282;&#x70B9;&#x7684;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;    private void unparkSuccessor(Node node) {</span><br><span class="line">        /*</span><br><span class="line">         * &#x83B7;&#x53D6;node&#x7684;ws&#xFF0C;&#x5982;&#x679C;&#x5C0F;&#x4E8E;0&#x5219;&#x901A;&#x8FC7;cas&#x8BBE;&#x7F6E;&#x4E3A;0</span><br><span class="line">         */</span><br><span class="line">        int ws = node.waitStatus;</span><br><span class="line">        if (ws &lt; 0)</span><br><span class="line">            compareAndSetWaitStatus(node, ws, 0);</span><br><span class="line"></span><br><span class="line">        /*</span><br><span class="line">         * &#x83B7;&#x53D6;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;&#x540E;&#x7EE7;&#x8282;&#x70B9;</span><br><span class="line">         */</span><br><span class="line">        Node s = node.next;</span><br><span class="line">        //&#x5224;&#x65AD;s&#xFF0C;&#x5982;&#x679C;&#x7B49;&#x4E8E;null&#x5E76;&#x4E14;ws&gt;0&#x653E;&#x5F03;&#x83B7;&#x53D6;</span><br><span class="line">        if (s == null || s.waitStatus &gt; 0) {</span><br><span class="line">            s = null;//&#x7F6E;&#x4E3A;null</span><br><span class="line">            //&#x4ECE;&#x5C3E;&#x8282;&#x70B9;&#x5F00;&#x59CB;&#x5FAA;&#x73AF;&#x83B7;&#x53D6;&#x524D;&#x9A71;&#x8282;&#x70B9;&#x76F4;&#x5230;&#x83B7;&#x53D6;&#x5230;&#x6700;&#x524D;&#x9762;&#x4E00;&#x4E2A;ws&#x5C0F;&#x4E8E;0&#x7684;&#x8282;&#x70B9;</span><br><span class="line">            for (Node t = tail; t != null &amp;&amp; t != node; t = t.prev)</span><br><span class="line">                if (t.waitStatus &lt;= 0)</span><br><span class="line">                    s = t;</span><br><span class="line">        }</span><br><span class="line">        &#x7136;&#x540E;&#x5982;&#x679C;s&#x8282;&#x70B9;&#x4E0D;&#x4E3A;null&#xFF0C;&#x8BC1;&#x660E;&#x83B7;&#x53D6;&#x5230;&#x4E86;&#x6700;&#x524D;&#x9762;&#x4E00;&#x4E2A;ws&#x5C0F;&#x4E8E;0&#x7684;&#x8282;&#x70B9;&#xFF0C;&#x5219;&#x76F4;&#x63A5;&#x5524;&#x9192;&#x8BE5;&#x8282;&#x70B9;&#x7684;&#x7EBF;&#x7A0B;&#x3002;</span><br><span class="line">        if (s != null)</span><br><span class="line">            LockSupport.unpark(s.thread);</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>&#x4E0B;&#x9762;&#x5206;&#x6790;AQS&#x4E2D;release()&#x65B9;&#x6CD5;&#x662F;&#x5982;&#x4F55;&#x91CA;&#x653E;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x5E76;&#x4E14;&#x5524;&#x9192;&#x7EBF;&#x7A0B;&#x6765;&#x6267;&#x884C;&#x7684;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;    public final boolean release(int arg) {</span><br><span class="line">    //tryrelease&#x65B9;&#x6CD5;&#x548C;tryacquire&#x65B9;&#x6CD5;&#x662F;&#x4E00;&#x5BF9;&#x7684;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x4E5F;&#x662F;&#x7531;&#x5B50;&#x7C7B;&#x6765;&#x5B9E;&#x73B0;</span><br><span class="line">        if (tryRelease(arg)) {</span><br><span class="line">            Node h = head;//&#x83B7;&#x53D6;&#x5934;&#x8282;&#x70B9;</span><br><span class="line">            //&#x5224;&#x65AD;&#x91CA;&#x653E;&#x4E0D;&#x7B49;&#x4E8E;&#x7A7A;&#xFF0C;&#x6216;&#x8005;&#x72B6;&#x6001;&#x91CA;&#x653E;&#x4E0D;&#x7B49;&#x4E8E;0&#xFF0C;&#x5982;&#x679C;&#x90FD;&#x7B26;&#x5408;&#x5219;&#x901A;&#x8FC7;unparkSuccessor&#x65B9;&#x6CD5;&#x5524;&#x9192;&#x540E;&#x7EE7;&#x8282;&#x70B9;</span><br><span class="line">            if (h != null &amp;&amp; h.waitStatus != 0)</span><br><span class="line">                unparkSuccessor(h);</span><br><span class="line">            return true;</span><br><span class="line">        }</span><br><span class="line">        return false;</span><br><span class="line">    }</span><br><span class="line">    //&#x8FD9;&#x91CC;&#x4E3E;&#x4F8B;reentrantlock&#x65B9;&#x6CD5;&#x4E2D;&#x975E;&#x516C;&#x5E73;&#x9501;&#x5B9E;&#x73B0;&#x7684;tryRelease&#x65B9;&#x6CD5;</span><br><span class="line">            protected final boolean tryRelease(int releases) {</span><br><span class="line">            //&#x83B7;&#x53D6;AQS&#x7684;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x503C;&#xFF0C;&#x7136;&#x540E;&#x51CF;&#x53BB;&#x91CA;&#x653E;&#x7684;&#x6570;&#x503C;</span><br><span class="line">            int c = getState() - releases;</span><br><span class="line">            //&#x5224;&#x65AD;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x91CA;&#x653E;&#x662F;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x62E5;&#x6709;&#x8005;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x662F;&#x5219;&#x629B;&#x51FA;&#x4E00;&#x4E2A;&#x5F02;&#x5E38;</span><br><span class="line">            if (Thread.currentThread() != getExclusiveOwnerThread())</span><br><span class="line">                throw new IllegalMonitorStateException();</span><br><span class="line">                //&#x6807;&#x8BB0;&#x91CA;&#x653E;&#x5931;&#x8D25;</span><br><span class="line">            boolean free = false;</span><br><span class="line">            //&#x5982;&#x679C;c==0&#x8868;&#x660E;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x5B8C;&#x5168;&#x91CA;&#x653E;&#x4E86;&#xFF08;&#x5B58;&#x5728;&#x91CD;&#x5165;&#x7684;&#x60C5;&#x51B5;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x53EF;&#x80FD;&#x5927;&#x4E8E;1&#xFF09;</span><br><span class="line">            if (c == 0) {</span><br><span class="line">                free = true;//&#x8BBE;&#x7F6E;&#x91CA;&#x653E;&#x6210;&#x529F;</span><br><span class="line">                setExclusiveOwnerThread(null);//&#x628A;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x6301;&#x6709;&#x7EBF;&#x7A0B;&#x4FEE;&#x6539;&#x4E3A;null</span><br><span class="line">            }</span><br><span class="line">            //&#x91CD;&#x65B0;&#x8BBE;&#x7F6E;AQS&#x72B6;&#x6001;(&#x8FD9;&#x91CC;&#x53EF;&#x80FD;&#x662F;0&#x6216;&#x8005;&#x5927;&#x4F59;1(&#x91CD;&#x5165;&#x7684;&#x60C5;&#x51B5;))</span><br><span class="line">            setState(c);</span><br><span class="line">            return free;</span><br><span class="line">        }</span><br></pre></td></tr></table></figure>

<p>&#x5230;&#x8FD9;&#x91CC;&#xFF0C;&#x72EC;&#x5360;&#x6A21;&#x5F0F;&#x540C;&#x6B65;&#x72B6;&#x6001;&#x7684;&#x83B7;&#x53D6;&#x4EE5;&#x53CA;&#x91CA;&#x653E;&#x8FC7;&#x7A0B;&#x90FD;&#x5206;&#x6790;&#x5B8C;&#xFF0C;&#x5176;&#x4ED6;&#x7684;&#x5F85;&#x7EED;&#x3002;&#x3002;&#x3002;&#x3002;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/d785b9d5c1089f5d257c35b6af8d3cdf.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7035671051480596510.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7035671051480596510.html" itemprop="url">架构知识实践与总结-锁 锁的本质 锁的实现 锁的问题 分布式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-11-29T01:21:13+08:00">
                2021-11-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x73B0;&#x4EE3;&#x8BA1;&#x7B97;&#x673A;&#x57FA;&#x672C;&#x90FD;&#x662F;&#x591A;&#x6838;&#xFF0C;&#x800C;&#x4E14;&#x6211;&#x4EEC;&#x7684;&#x4E1A;&#x52A1;&#x8FDB;&#x7A0B;&#x901A;&#x5E38;&#x4F1A;&#x8FD0;&#x884C;&#x5728;&#x591A;&#x53F0;&#x8BA1;&#x7B97;&#x673A;&#x4E0A;&#x3002;&#x4E0D;&#x7BA1;&#x662F;&#x4E00;&#x53F0;&#x8BA1;&#x7B97;&#x673A;&#x4E0A;&#x7684;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x8FD8;&#x662F;&#x8FD0;&#x884C;&#x5728;&#x591A;&#x53F0;&#x8BA1;&#x7B97;&#x4E0A;&#x7684;&#x4E0D;&#x540C;&#x8FDB;&#x7A0B;&#x5728;&#x5904;&#x7406;&#x7CFB;&#x7EDF;&#x8D44;&#x6E90;&#x65F6;&#x96BE;&#x514D;&#x4F1A;&#x51FA;&#x73B0;&#x51B2;&#x7A81;&#xFF0C;&#x4E3A;&#x4E86;&#x89E3;&#x51B3;<code>&#x5171;&#x4EAB;&#x8D44;&#x6E90;</code>&#x7684;&#x51B2;&#x7A81;&#x95EE;&#x9898;&#x6211;&#x4EEC;&#x7ECF;&#x5E38;&#x9700;&#x8981;&#x52A0;&#x9501;&#x5904;&#x7406;&#x3002;</p>
<p>&#x4E3E;&#x4E24;&#x4E2A;&#x5E38;&#x89C1;&#x7684;&#x4F8B;&#x5B50;&#x3002;</p>
<p>&#x4F8B;1&#xFF1A;a=0&#xFF0C;10&#x4E2A;&#x7EBF;&#x7A0B;&#x540C;&#x65F6;&#x6267;&#x884C;a++&#xFF0C;&#x5728;&#x7A0B;&#x5E8F;&#x8FD0;&#x884C;&#x591A;&#x6B21;&#x540E;&#x4F1A;&#x53D1;&#x73B0;&#x6BCF;&#x6B21;&#x5F97;&#x5230;a&#x7684;&#x503C;&#x662F;&#x4E0D;&#x786E;&#x5B9A;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x60F3;&#x4FDD;&#x8BC1;a&#x6700;&#x540E;&#x7684;&#x503C;&#x662F;10&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x52A0;&#x9501;&#xFF0C;&#x628A;&#x5E76;&#x53D1;&#x7684;&#x7EBF;&#x7A0B;&#x4E32;&#x884C;&#x5316;&#x3002;</p>
<p>&#x4F8B;2&#xFF1A;&#x67D0;&#x7535;&#x5546;&#x5E73;&#x53F0;&#x9650;&#x91CF;&#x62A2;&#x8D2D;&#x6D3B;&#x52A8;&#xFF0C;&#x5546;&#x54C1;A&#x53EA;&#x80FD;&#x62A2;&#x8D2D;50&#x4EF6;&#xFF0C;&#x5982;&#x4F55;&#x4FDD;&#x8BC1;&#x6700;&#x540E;&#x53EA;&#x5356;&#x51FA;&#x53BB;50&#x4EF6;&#x3002; &#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x4F9D;&#x8D56;&#x9501;&#x673A;&#x5236;&#xFF0C;&#x6BCF;&#x6B21;&#x6263;&#x4EF6;&#x5E93;&#x5B58;&#x90FD;&#x52A0;&#x9501;&#x3002;&#x8FD9;&#x91CC;&#x7684;&#x52A0;&#x9501;&#x4E0D;&#x4E00;&#x5B9A;&#x5FC5;&#x987B;&#x662F;&#x6211;&#x4EEC;&#x4E1A;&#x52A1;&#x4EE3;&#x7801;&#x52A0;&#x9501;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x662F;&#x6570;&#x636E;&#x5E93;&#x7684;&#x884C;&#x9501;&#x6216;&#x8005;&#x4F9D;&#x8D56;&#x5176;&#x5B83;&#x4E2D;&#x95F4;&#x4EF6;&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x9501;&#x3002;</p>
<h1 id="&#x9501;&#x7684;&#x672C;&#x8D28;"><a href="#&#x9501;&#x7684;&#x672C;&#x8D28;" class="headerlink" title="&#x9501;&#x7684;&#x672C;&#x8D28;"></a>&#x9501;&#x7684;&#x672C;&#x8D28;</h1><p>&#x7ED3;&#x5408;&#x4E0A;&#x9762;&#x7684;&#x4E24;&#x4E2A;&#x4F8B;&#x5B50;&#xFF0C;&#x8BF4;&#x4E00;&#x8BF4;&#x6211;&#x5BF9;&#x9501;&#x7684;&#x7406;&#x89E3;&#x3002;&#x9501;&#x7684;&#x672C;&#x8D28;&#x662F;&#xFF1A;&#x4E1A;&#x52A1;&#x573A;&#x666F;&#x4E2D;&#x5B58;&#x5728;<code>&#x5171;&#x4EAB;&#x8D44;&#x6E90;</code>&#xFF0C;&#x591A;&#x4E2A;&#x8FDB;&#x7A0B;&#x6216;&#x7EBF;&#x7A0B;&#x9700;&#x8981;&#x7ADE;&#x4E89;&#x83B7;&#x53D6;&#x5E76;&#x5904;&#x7406;&#x5171;&#x4EAB;&#x8D44;&#x6E90;&#xFF0C;&#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;&#x516C;&#x5E73;&#x3001;&#x53EF;&#x9760;&#x3001;&#x7ED3;&#x679C;&#x6B63;&#x786E;&#x7B49;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#xFF0C;&#x8981;&#x628A;&#x5E76;&#x53D1;&#x6267;&#x884C;&#x7684;&#x95EE;&#x9898;&#x53D8;&#x4E3A;&#x4E32;&#x884C;&#xFF0C;&#x4E32;&#x884C;&#x65F6;&#x5F15;&#x5165;&#x7B2C;&#x4E09;&#x65B9;<code>&#x9501;</code>&#x5F53;&#x6210;&#x8C01;&#x6709;&#x6743;&#x9650;&#x6765;&#x64CD;&#x4F5C;&#x5171;&#x4EAB;&#x8D44;&#x6E90;&#x7684;&#x5224;&#x65AD;&#x4F9D;&#x636E;&#x3002;</p>
<p>&#x8FD9;&#x5C31;&#x6210;&#x529F;&#x628A;&#x4E1A;&#x52A1;&#x95EE;&#x9898;&#x62BD;&#x8C61;&#x6210;&#x4E86;&#x53D6;<code>&#x9501;</code>&#x95EE;&#x9898;&#x3002;&#x90A3;&#x5728;&#x8BA1;&#x7B97;&#x673A;&#x4E2D;&#x662F;&#x5982;&#x4F55;&#x5904;&#x7406;&#x9501;&#x95EE;&#x9898;&#x7684;&#x5462;&#xFF1F;</p>
<h1 id="&#x9501;&#x7684;&#x5B9E;&#x73B0;"><a href="#&#x9501;&#x7684;&#x5B9E;&#x73B0;" class="headerlink" title="&#x9501;&#x7684;&#x5B9E;&#x73B0;"></a>&#x9501;&#x7684;&#x5B9E;&#x73B0;</h1><p>&#x9501;&#x7684;&#x5B9E;&#x73B0;&#x6700;&#x6839;&#x672C;&#x7684;&#x8FD8;&#x662F;&#x9700;&#x8981;&#x786C;&#x4EF6;&#x652F;&#x6301;&#xFF0C;CPU&#x63D0;&#x4F9B;&#x4E86;&#x539F;&#x5B50;&#x64CD;&#x4F5C;&#x7684;&#x6307;&#x4EE4;&#xFF0C;&#x6BD4;&#x5982;&#x5728;X86&#x3001;ARM&#x7B49;&#x67B6;&#x6784;&#x4E2D;&#x90FD;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E9B;&#x673A;&#x5236;&#x4FDD;&#x8BC1;&#x591A;&#x6761;&#x64CD;&#x4F5C;&#x6307;&#x4EE4;&#x5728;&#x4E00;&#x4E2A;&#x539F;&#x5B50;&#x64CD;&#x4F5C;&#x4E2D;&#x6267;&#x884C;&#x3002;&#x8FD9;&#x4E9B;&#x539F;&#x5B50;&#x64CD;&#x4F5C;&#x662F;&#x6211;&#x4EEC;&#x5B9E;&#x73B0;&#x9501;&#x7684;&#x57FA;&#x7840;&#x3002;</p>
<p>&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5BF9;CPU&#x63D0;&#x4F9B;&#x7684;&#x9501;&#x53C8;&#x8FDB;&#x4E00;&#x6B65;&#x8FDB;&#x884C;&#x4E86;&#x5C01;&#x88C5;&#xFF0C;&#x6BD4;&#x5982;Linux&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5C31;&#x63D0;&#x4F9B;&#x4E86;&#x81EA;&#x65CB;&#x9501;&#xFF08;spinlock&#xFF09;&#x3001;&#x4E92;&#x65A5;&#x9501;&#xFF08;mutex&#xFF09;&#x3001;&#x8BFB;&#x5199;&#x9501;&#xFF08;dwlock&#xFF09;&#x3001;RCU&#x9501;&#x7B49;&#x4E00;&#x4E9B;&#x5E38;&#x7528;&#x7684;&#x903B;&#x8F91;&#x9501;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x7528;&#x6765;&#x505A;&#x4E1A;&#x52A1;&#x5F00;&#x53D1;&#x7684;&#x5404;&#x79CD;&#x8BED;&#x8A00;&#x53C8;&#x5728;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x548C;&#x6C47;&#x7F16;&#x57FA;&#x7840;&#x4E4B;&#x4E0A;&#x7ED9;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;&#x4E86;&#x66F4;&#x52A0;&#x65B9;&#x4FBF;&#x7684;&#x3001;&#x5F00;&#x7BB1;&#x5373;&#x7528;&#x7684;&#x9501;&#x7ED3;&#x6784;&#x3002;&#x6BD4;&#x5982;Golang&#x4E2D;&#x7684;&#x4E92;&#x65A5;&#x9501;&#xFF08;sync.Mutex&#xFF09;&#x3001;&#x8BFB;&#x5199;&#x9501;&#xFF08;sync.RWMutex&#xFF09;&#x3001;automic&#x7684;&#x5404;&#x79CD;&#x539F;&#x5B50;&#x64CD;&#x4F5C;&#x3002;</p>
<h1 id="&#x9501;&#x7684;&#x95EE;&#x9898;"><a href="#&#x9501;&#x7684;&#x95EE;&#x9898;" class="headerlink" title="&#x9501;&#x7684;&#x95EE;&#x9898;"></a>&#x9501;&#x7684;&#x95EE;&#x9898;</h1><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x628A;&#x9501;&#x5206;&#x4E3A;&#x60B2;&#x89C2;&#x9501;&#x548C;&#x4E50;&#x89C2;&#x9501;&#x4E24;&#x7C7B;&#x3002;&#x6240;&#x8C13;&#x60B2;&#x89C2;&#x9501;&#x5C31;&#x662F;&#x5047;&#x5B9A;&#x5176;&#x5B83;&#x7EBF;&#x7A0B;&#x4F1A;&#x4EA7;&#x751F;&#x5171;&#x4EAB;&#x8D44;&#x6E90;&#x7684;&#x7ADE;&#x4E89;&#xFF0C;&#x4E00;&#x5B9A;&#x8981;&#x5148;&#x83B7;&#x53D6;&#x9501;&#x7ED3;&#x6784;&#x624D;&#x6267;&#x884C;&#x540E;&#x7EED;&#x7684;&#x903B;&#x8F91;&#x3002;&#x4E50;&#x89C2;&#x9501;&#x6070;&#x597D;&#x76F8;&#x53CD;&#xFF0C;&#x8BA4;&#x4E3A;&#x4E0D;&#x4E00;&#x5B9A;&#x4F1A;&#x4EA7;&#x751F;&#x7ADE;&#x4E89;&#xFF0C;&#x76F4;&#x63A5;&#x4FEE;&#x6539;&#x503C;&#x5982;&#x679C;&#x6210;&#x529F;&#x4E86;&#x5C31;&#x8FBE;&#x6210;&#x76EE;&#x6807;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x6210;&#x529F;&#x518D;&#x8FDB;&#x884C;&#x91CD;&#x8BD5;&#xFF0C;&#x76F4;&#x5230;&#x6210;&#x529F;&#x6216;&#x8005;&#x8D85;&#x65F6;&#x3002;</p>
<p>CAS&#xFF08;compare and swap&#xFF09;&#x662F;&#x5B9E;&#x73B0;&#x4E50;&#x89C2;&#x9501;&#x7684;&#x4E00;&#x79CD;&#x5178;&#x578B;&#x6280;&#x672F;&#x3002; &#x5728;CAS&#x673A;&#x5236;&#x4E2D;&#x5B58;&#x5728;&#x4E09;&#x4E2A;&#x57FA;&#x672C;&#x64CD;&#x4F5C;&#x503C;&#xFF0C;value&#x5185;&#x5B58;&#x503C;&#xFF0C;old&#x65E7;&#x9884;&#x671F;&#x503C;&#xFF0C;new&#x9884;&#x671F;&#x503C;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">go&#x590D;&#x5236;&#x4EE3;&#x7801;func&#xA0;compareAndSwap(value&#xA0;int,&#xA0;old&#xA0;int,&#xA0;new&#xA0;int)&#xA0;bool{</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;if&#xA0;(value&#xA0;!=old){</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;return&#xA0;False</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;}</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;*value=&#xA0;new</span><br><span class="line">&#xA0;&#xA0;&#xA0;&#xA0;return&#xA0;True</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5982;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x6211;&#x4EEC;&#x6BD4;&#x8F83;value&#x548C;old&#x662F;&#x5426;&#x76F8;&#x7B49;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x76F8;&#x7B49;&#x8BF4;&#x660E;old&#x503C;&#x5DF2;&#x7ECF;&#x88AB;&#x4FEE;&#x6539;&#xFF0C;&#x53D6;&#x9501;&#x5931;&#x8D25;&#xFF1B;&#x5982;&#x679C;&#x76F8;&#x7B49;&#x5219;&#x628A;new&#x8D4B;&#x503C;&#x7ED9;value&#xFF0C;&#x53D6;&#x9501;&#x6210;&#x529F;&#x3002;&#x5F53;&#x53D6;&#x9501;&#x5931;&#x8D25;&#x65F6;&#xFF0C;&#x4F1A;&#x4FEE;&#x6539;value&#x7684;&#x503C;&#x4E3A;&#x5F53;&#x524D;&#x503C;&#x7B49;&#x5F85;&#x8FDB;&#x884C;&#x4E0B;&#x4E00;&#x6B21;&#x53D6;&#x9501;&#xFF0C;&#x76F4;&#x5230;&#x8D85;&#x65F6;&#x6216;&#x8005;&#x53D6;&#x9501;&#x6210;&#x529F;&#x3002;</p>
<p>CAS&#x6709;&#x4E00;&#x4E2A;&#x5178;&#x578B;&#x7684;&#x95EE;&#x9898;&#xFF1A;ABA&#x3002;&#x6240;&#x8C13;ABA&#x95EE;&#x9898;&#x662F;&#x6307;&#xFF0C;&#x5728;&#x6267;&#x884C;CAS&#x64CD;&#x4F5C;&#x65F6;&#xFF0C;&#x5176;&#x5B83;&#x5E76;&#x53D1;&#x6267;&#x884C;&#x7684;&#x7EBF;&#x7A0B;&#x628A;&#x5185;&#x5B58;&#x503C;A&#x4FEE;&#x6539;&#x4E3A;B&#xFF0C;&#x4E4B;&#x540E;&#x53C8;&#x4FEE;&#x6539;&#x4E3A;A&#xFF0C;CAS&#x673A;&#x5236;&#x8BA4;&#x4E3A;A&#x6CA1;&#x6709;&#x53D8;&#x5316;&#xFF0C;&#x5176;&#x5B9E;A&#x4E2D;&#x95F4;&#x5DF2;&#x7ECF;&#x4EA7;&#x751F;&#x4E86;&#x53D8;&#x5316;&#x72B6;&#x6001;&#xFF0C;&#x8FD9;&#x5C31;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x540C;&#x65F6;&#x83B7;&#x53D6;&#x5230;&#x9501;&#x3002;&#x89E3;&#x51B3;ABA&#x95EE;&#x9898;&#x7684;&#x5178;&#x578B;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x662F;&#x589E;&#x52A0;&#x7248;&#x672C;&#x53F7;&#xFF0C;Golang&#x548C;Java&#x8BED;&#x8A00;&#x4E2D;&#x4E5F;&#x90FD;&#x6709;&#x76F8;&#x5173;&#x5B9E;&#x73B0;&#x3002;&#x52A0;&#x7248;&#x672C;&#x53F7;&#x7684;&#x5177;&#x4F53;&#x65B9;&#x6CD5;&#x662F;&#x5728;&#x5E76;&#x53D1;&#x6267;&#x884C;&#x7684;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x4FEE;&#x6539;&#x53D8;&#x91CF;A&#x65F6;&#xFF0C;&#x589E;&#x52A0;&#x4E00;&#x4E2A;&#x9012;&#x589E;&#x7684;&#x7248;&#x672C;&#x53F7;&#xFF0C;&#x6267;&#x884C;&#x6210;&#x529F;&#x7684;&#x6761;&#x4EF6;&#x9700;&#x8981;&#x7248;&#x672C;&#x53F7;&#x4E5F;&#x4FDD;&#x6301;&#x4E00;&#x81F4;&#xFF0C;&#x800C;&#x4E14;&#x6267;&#x884C;&#x6210;&#x529F;&#x540E;&#x7248;&#x672C;&#x53F7;+1&#xFF0C;&#x8FD9;&#x5C31;&#x4FDD;&#x8BC1;&#x4E86;&#x591A;&#x4E2A;&#x8FDB;&#x7A0B;&#x540C;&#x65F6;&#x53EA;&#x80FD;&#x6709;&#x4E00;&#x4E2A;&#x83B7;&#x53D6;&#x5230;&#x9501;&#xFF0C;&#x4E5F;&#x4E0D;&#x4F1A;&#x56E0;&#x4E3A;&#x91CD;&#x8BD5;&#x4EA7;&#x751F;&#x903B;&#x8F91;&#x95EE;&#x9898;&#x3002;</p>
<h1 id="&#x5206;&#x5E03;&#x5F0F;&#x9501;"><a href="#&#x5206;&#x5E03;&#x5F0F;&#x9501;" class="headerlink" title="&#x5206;&#x5E03;&#x5F0F;&#x9501;"></a>&#x5206;&#x5E03;&#x5F0F;&#x9501;</h1><p>&#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;&#x7CFB;&#x7EDF;&#x7684;&#x9AD8;&#x53EF;&#x7528;&#xFF0C;&#x5F88;&#x591A;&#x8FDB;&#x7A0B;&#x90FD;&#x9700;&#x8981;&#x90E8;&#x7F72;&#x591A;&#x4E2A;&#x5B9E;&#x4F8B;&#xFF0C;&#x4E3A;&#x4E86;&#x80FD;&#x8BA9;&#x591A;&#x4E2A;&#x5B9E;&#x4F8B;&#x6B63;&#x5E38;&#x5904;&#x7406;&#x5171;&#x4EAB;&#x8D44;&#x6E90;&#xFF0C;&#x5C31;&#x6CA1;&#x6CD5;&#x5728;&#x8FD9;&#x4E9B;&#x5B9E;&#x4F8B;&#x7684;&#x5185;&#x90E8;&#x7528;&#x540C;&#x4E00;&#x4E2A;&#x9501;&#xFF0C;&#x56E0;&#x6B64;&#x5FC5;&#x987B;&#x5F15;&#x5165;&#x7B2C;&#x4E09;&#x65B9;&#x7CFB;&#x7EDF;&#x6765;&#x5B9E;&#x73B0;&#x9501;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F9D;&#x8D56;MySQL&#x7684;&#x884C;&#x9501;&#x3001;Redis&#x7684;&#x539F;&#x5B50;&#x64CD;&#x4F5C;&#x7B49;&#x5B9E;&#x73B0;&#x9501;&#x3002;</p>
<p>&#x4F9D;&#x8D56;&#x7B2C;&#x4E09;&#x65B9;&#x7CFB;&#x7EDF;&#x751F;&#x6210;&#x9501;&#x7ED3;&#x6784;&#x65F6;&#xFF0C;&#x4E09;&#x65B9;&#x7CFB;&#x7EDF;&#x9700;&#x8981;&#x4FDD;&#x969C;&#x81EA;&#x5DF1;&#x9AD8;&#x53EF;&#x7528;&#x3002;&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x7528;&#x5355;&#x673A;&#x7684;Redis&#x6765;&#x5B9E;&#x73B0;&#x9501;&#x64CD;&#x4F5C;&#xFF0C;&#x5355;&#x673A;&#x7684;Redis&#x5982;&#x679C;&#x5B95;&#x673A;&#x4E86;&#x5C31;&#x4F1A;&#x9020;&#x6210;&#x6240;&#x6709;&#x8FDB;&#x7A0B;&#x53D6;&#x9501;&#x5931;&#x8D25;&#x3002;&#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;Redis&#x7684;&#x9AD8;&#x53EF;&#x7528;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x91C7;&#x7528;&#x4E3B;&#x4ECE;&#x7684;&#x67B6;&#x6784;&#x6A21;&#x5F0F;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x91C7;&#x7528;&#x4E3B;&#x4ECE;&#x67B6;&#x6784;&#x65F6;&#x4F1A;&#x5B58;&#x5728;Master&#x8282;&#x70B9;&#x540C;&#x6B65;&#x6570;&#x636E;&#x5230;Slave&#x8282;&#x70B9;&#x7684;&#x65F6;&#x95F4;&#x5EF6;&#x8FDF;&#x3002;&#x5982;&#x679C;AB&#x4E24;&#x4E2A;&#x8FDB;&#x7A0B;&#xFF0C;A&#x5728;Master&#x8282;&#x70B9;&#x83B7;&#x53D6;&#x5230;&#x9501;&#x7ED3;&#x6784;&#x4E4B;&#x540E;&#xFF0C;&#x6570;&#x636E;&#x540C;&#x6B65;&#x5230;Slave&#x8282;&#x70B9;&#x4E4B;&#x524D;&#xFF0C;B&#x8FDB;&#x7A0B;&#x8BFB;Slave&#x8282;&#x70B9;&#x7684;&#x6570;&#x636E;&#x53D1;&#x73B0;&#x6CA1;&#x6709;&#x6B64;&#x9501;&#xFF0C;&#x4E5F;&#x4FEE;&#x6539;&#x67D0;&#x4E2A;key&#x7684;&#x503C;&#x83B7;&#x53D6;&#x5230;&#x4E86;&#x9501;&#xFF0C;&#x8FD9;&#x5C31;&#x4F1A;&#x5BFC;&#x81F4;AB&#x540C;&#x65F6;&#x83B7;&#x5F97;&#x5230;&#x9501;&#xFF0C;&#x8FD9;&#x660E;&#x663E;&#x8FDD;&#x80CC;&#x4E86;&#x4F7F;&#x7528;&#x9501;&#x7684;&#x521D;&#x8877;&#x3002;</p>
<blockquote>
<p>Redis&#x505A;&#x5206;&#x5E03;&#x5F0F;&#x9501;&#x65F6;&#x4E5F;&#x5B58;&#x5728;&#x5176;&#x5B83;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x662F;&#x4E3E;&#x4F8B;&#x8BF4;&#x660E;&#x95EE;&#x9898;&#x3002;</p>
</blockquote>
<p>&#x7EFC;&#x4E0A;&#x6211;&#x4EEC;&#x4F9D;&#x8D56;&#x7684;&#x4E09;&#x65B9;&#x7CFB;&#x7EDF;&#x9700;&#x8981;&#x4FDD;&#x6301;&#x5176;<code>&#x5BF9;&#x5916;&#x6570;&#x636E;&#x7684;&#x4E00;&#x81F4;&#x6027;</code>&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x901A;&#x5E38;&#x6240;&#x8BF4;&#x7684;CAP&#x7406;&#x8BBA;&#x4E2D;&#x7684;C&#xFF08;Consistency&#xFF09;&#x7279;&#x6027;&#xFF0C;&#x57FA;&#x4E8E;&#x6B64;&#x7279;&#x6027;&#x5F00;&#x6E90;&#x8F6F;&#x4EF6;&#x4E2D;ETCD&#x548C;Zookeeper&#x90FD;&#x662F;&#x4E0D;&#x9519;&#x7684;&#x9009;&#x62E9;&#x3002;</p>
<p>&#x5728;&#x5B9E;&#x9645;&#x5DE5;&#x4F5C;&#x4E2D;&#x662F;&#x81EA;&#x7814;&#x8FD8;&#x662F;&#x9009;&#x62E9;&#x4E00;&#x79CD;&#x5F00;&#x6E90;&#x4EA7;&#x54C1;&#x505A;&#x5206;&#x5E03;&#x5F0F;&#x9501;&#xFF0C;&#x6700;&#x7EC8;&#x8FD8;&#x8981;&#x770B;&#x6211;&#x4EEC;&#x7684;&#x4E1A;&#x52A1;&#x573A;&#x666F;&#xFF0C;&#x5982;&#x679C;&#x9700;&#x8981;&#x5F3A;&#x4E00;&#x81F4;&#x7684;CP&#x6A21;&#x578B;&#xFF0C;&#x90A3;&#x6211;&#x4EEC;&#x9996;&#x9009;ETCD&#xFF0C;&#x5982;&#x679C;&#x53EF;&#x4EE5;&#x5B58;&#x5728;&#x4E00;&#x4E9B;&#x4E0D;&#x4E00;&#x81F4;&#x60C5;&#x51B5;Redis&#x4E5F;&#x662F;&#x4E0D;&#x9519;&#x7684;&#x9009;&#x62E9;&#x3002;&#x5F53;&#x7136;&#x8FD8;&#x8981;&#x7ED3;&#x5408;&#x4E1A;&#x52A1;&#x7684;&#x8C03;&#x7528;&#x91CF;&#x3001;&#x8FD0;&#x7EF4;&#x80FD;&#x529B;&#x7B49;&#x7EFC;&#x5408;&#x8003;&#x8651;&#x3002;</p>
<blockquote>
<p>&#x6CE8;&#x610F;&#x95EE;&#x9898;&#xFF1A;&#x9501;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x4E0D;&#x7BA1;&#x662F;CAS&#x8FD8;&#x662F;&#x5176;&#x5B83;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#x90FD;&#x6BD4;&#x8F83;&#x6D88;&#x8017;CPU&#x6027;&#x80FD;&#xFF0C;&#x6240;&#x4EE5;&#x5982;&#x679C;&#x80FD;&#x901A;&#x8FC7;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x8BBE;&#x8BA1;&#x907F;&#x514D;&#x4F7F;&#x7528;&#x9501;&#x662F;&#x6700;&#x597D;&#x7684;&#x3002;  </p>
<p>&#x9501;&#x7684;&#x529B;&#x5EA6;&#x8D8A;&#x5C0F;&#x8D8A;&#x597D;&#x3002;  </p>
<p>Sharding&#x662F;&#x63D0;&#x9AD8;&#x9501;&#x6548;&#x7387;&#x7684;&#x4E00;&#x79CD;&#x6709;&#x6548;&#x624B;&#x6BB5;&#x3002;</p>
</blockquote>
<h1 id="&#x603B;&#x7ED3;"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3;</h1><p>&#x672C;&#x6587;&#x6211;&#x4EEC;&#x4E3B;&#x8981;&#x4ECB;&#x7ECD;&#x4E86;&#x8BA1;&#x7B97;&#x673A;&#x4E2D;&#x7684;&#x9501;&#xFF0C;&#x7B80;&#x5355;&#x4ECB;&#x7ECD;&#x4E86;&#x9501;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#xFF0C;&#x9501;&#x7684;&#x5E38;&#x89C1;&#x95EE;&#x9898;&#x548C;&#x5982;&#x4F55;&#x9009;&#x62E9;&#x5206;&#x5E03;&#x5F0F;&#x9501;&#x3002;&#x6587;&#x4E2D;&#x6CA1;&#x6709;&#x5BF9;&#x5177;&#x4F53;&#x4E00;&#x79CD;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#x505A;&#x6E90;&#x7801;&#x7EA7;&#x7684;&#x5256;&#x6790;&#xFF0C;&#x66F4;&#x591A;&#x7684;&#x662F;&#x7AD9;&#x5728;&#x65C1;&#x89C2;&#x8005;&#x7684;&#x89D2;&#x5EA6;&#x601D;&#x8003;&#x9501;&#x95EE;&#x9898;&#x7684;&#x539F;&#x7406;&#x548C;&#x672C;&#x8D28;&#x3002;</p>
<p>&#x4EE5;&#x4E0A;&#x7EAF;&#x5C5E;&#x4E2A;&#x4EBA;&#x5B66;&#x4E60;&#x3001;&#x603B;&#x7ED3;&#x7684;&#x4E00;&#x4E9B;&#x89C2;&#x70B9;&#xFF0C;&#x6B22;&#x8FCE;&#x5927;&#x5BB6;&#x79C1;&#x4FE1;&#x4EA4;&#x6D41;&#x3002;</p>
<p>&#x8BDA;&#x9080;&#x5173;&#x6CE8;&#x516C;&#x4F17;&#x53F7;&#xFF1A;&#x4E00;&#x884C;&#x821F;  </p>
<p>&#x6BCF;&#x5468;&#x66F4;&#x65B0;&#x6280;&#x672F;&#x6587;&#x7AE0;&#xFF0C;&#x548C;&#x5927;&#x5BB6;&#x4E00;&#x8D77;&#x8FDB;&#x6B65;&#x3002;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/b768d2145b836a5de31434792ccd3d08.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7035668395051712542.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7035668395051712542.html" itemprop="url">Guava的FuturessuccessFulAsList</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-11-29T01:09:11+08:00">
                2021-11-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-&#x524D;&#x7F6E;&#x77E5;&#x8BC6;"><a href="#1-&#x524D;&#x7F6E;&#x77E5;&#x8BC6;" class="headerlink" title="1.&#x524D;&#x7F6E;&#x77E5;&#x8BC6;"></a>1.&#x524D;&#x7F6E;&#x77E5;&#x8BC6;</h1><p>&#x9996;&#x5148;&#x8981;&#x4E86;&#x89E3;Futures.successFulAsList&#x65B9;&#x6CD5;&#x539F;&#x7406;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4E00;&#x4E0B;&#x524D;&#x7F6E;&#x77E5;&#x8BC6;.</p>
<ul>
<li>ListenableFuture&#x8FD9;&#x4E2A;&#x63A5;&#x53E3;&#xFF0C;&#x5B83;&#x662F;&#x57FA;&#x4E8E;Future&#x7684;&#x5B50;&#x63A5;&#x53E3;&#xFF0C;&#x800C;Guava &#x5728;&#x7684;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x7C7B;&#x57FA;&#x672C;&#x90FD;&#x662F;&#x5B9E;&#x73B0;&#x4E86;&#x8FD9;&#x4E2A;&#x63A5;&#x53E3;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x800C;&#x5177;&#x4F53;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x7C7B;ListenableFutureTask&#x9664;&#x4E86;&#x5B9E;&#x73B0;&#x4E86;ListenableFuture&#x8FD9;&#x4E2A;&#x63A5;&#x53E3;&#x4E4B;&#x5916;&#x8FD8;&#x7EE7;&#x627F;&#x4E86;jdk&#x4E2D;&#x7684;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x7C7B;FutureTask&#xFF0C;</li>
<li>&#x7B80;&#x5355;&#x6765;&#x8BF4;ListenableFutureTask &#x5176;&#x5B9E;&#x5C31;&#x662F;&#x5BF9;FutureTask&#x8FDB;&#x884C;&#x4E86;&#x6269;&#x5C55;&#x5C01;&#x88C5;&#x3002;</li>
</ul>
<h2 id="2-Futures&#x6267;&#x884C;&#x6D41;&#x7A0B;&#x56FE;&#xFF1A;"><a href="#2-Futures&#x6267;&#x884C;&#x6D41;&#x7A0B;&#x56FE;&#xFF1A;" class="headerlink" title="2.Futures&#x6267;&#x884C;&#x6D41;&#x7A0B;&#x56FE;&#xFF1A;"></a>2.Futures&#x6267;&#x884C;&#x6D41;&#x7A0B;&#x56FE;&#xFF1A;</h2><p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/cb056715e0032632fad8fd45db145f8254087571955f6e3e948e7f471845f070" alt="Futures&#x6267;&#x884C;&#x6D41;&#x7A0B;.png"></p>
<p>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x8981;&#x770B;&#x5230;Futures.successFulAsList&#x7684;&#x6E90;&#x7801;&#x548C;&#x539F;&#x7406;&#x8FD8;&#x9700;&#x8981;&#x4E86;&#x89E3;FutureTask&#x7684;&#x539F;&#x7406;&#x3002;(&#x76F8;&#x5173;&#x539F;&#x7406;&#x53EF;&#x4EE5;&#x53C2;&#x8003; FutureTask&#x53C2;&#x8003;)</p>
<h2 id="3-&#x5BF9;&#x4E8E;ListenableFutureTask&#x8FD9;&#x4E2A;&#x7C7B;&#x7684;&#x5206;&#x6790;"><a href="#3-&#x5BF9;&#x4E8E;ListenableFutureTask&#x8FD9;&#x4E2A;&#x7C7B;&#x7684;&#x5206;&#x6790;" class="headerlink" title="3.&#x5BF9;&#x4E8E;ListenableFutureTask&#x8FD9;&#x4E2A;&#x7C7B;&#x7684;&#x5206;&#x6790;"></a>3.&#x5BF9;&#x4E8E;ListenableFutureTask&#x8FD9;&#x4E2A;&#x7C7B;&#x7684;&#x5206;&#x6790;</h2><p>ListenableFutureTask&#x662F;guava&#x6269;&#x5C55;futureTask&#x7684;&#x4E00;&#x4E2A;&#x5F88;&#x91CD;&#x8981;&#x7684;&#x7C7B;&#xFF0C;&#x540E;&#x7EED;guava&#x7684;Futures.successFulList&#x4E3A;&#x4EC0;&#x4E48;&#x80FD;&#x628A;&#x591A;&#x4E2A;futureTask&#x5408;&#x5E76;&#x4E5F;&#x662F;&#x57FA;&#x4E8E;&#x8BE5;&#x5B9E;&#x73B0;&#x7C7B;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x4E2A;&#x7C7B;&#x975E;&#x5E38;&#x91CD;&#x8981;&#xFF0C;&#x4E0B;&#x9762;&#x5F00;&#x59CB;&#x5BF9;&#x8FD9;&#x4E2A;&#x7C7B;&#x8FDB;&#x884C;&#x5206;&#x6790;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">typescript&#x590D;&#x5236;&#x4EE3;&#x7801;public class ListenableFutureTask&lt;V&gt; extends FutureTask&lt;V&gt;</span><br><span class="line">    implements ListenableFuture&lt;V&gt; {</span><br><span class="line"></span><br><span class="line"> // The execution list to hold our listeners.</span><br><span class="line"> private final ExecutionList executionList = new ExecutionList();</span><br><span class="line"></span><br><span class="line"> public static &lt;V&gt; ListenableFutureTask&lt;V&gt; create(Callable&lt;V&gt; callable) {</span><br><span class="line">    return new ListenableFutureTask&lt;V&gt;(callable);</span><br><span class="line"> }</span><br><span class="line">  @Override</span><br><span class="line"> public void addListener(Runnable listener, Executor exec) {</span><br><span class="line">    executionList.add(listener, exec);</span><br><span class="line"> }</span><br><span class="line"></span><br><span class="line">//&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x7ED3;&#x675F;&#x540E;&#x5C31;&#x4F1A;&#x8C03;&#x7528;ExecutionList&#x7684;execute&#x65B9;&#x6CD5;&#x5C31;&#x4F1A;&#x5F00;&#x59CB;&#x6267;&#x884C;&#x76D1;&#x542C;&#x5668;(&#x8FD9;&#x4E2A;&#x76D1;&#x542C;&#x5668;&#x5C31;&#x884C;&#x4E0B;&#x9762;&#x90A3;&#x4E2A;&#x95EE;&#x9898;&#x7684;&#x7B54;&#x6848;&#xFF0C;&#x4F55;&#x65F6;&#x5F00;&#x59CB;&#x6267;&#x884C;&#x4EFB;&#x52A1;future&#x7684;&#x76D1;&#x542C;&#x5668;&#x7C7B;&#x83B7;&#x53D6;&#x7ED3;&#x679C;&#x3002;)</span><br><span class="line"> @Override</span><br><span class="line"> protected void done() {</span><br><span class="line">    executionList.execute();</span><br><span class="line"> }</span><br></pre></td></tr></table></figure>

<p>&#x4ECE;&#x4E0A;&#x9762;&#x6E90;&#x7801;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;ListenableFutureTask&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x5BF9;FutureTask&#x8FDB;&#x884C;&#x6269;&#x5C55;&#x4E86;&#xFF0C;&#x5B83;&#x662F;&#x5982;&#x4F55;&#x6269;&#x5C55;&#xFF1F;&#x53EF;&#x4EE5;&#x770B;&#x5230;done()&#x65B9;&#x6CD5;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x5728;FutureTask&#x6267;&#x884C;&#x5B8C;&#x6210;&#x540E;&#x4F1A;&#x81EA;&#x52A8;&#x8C03;&#x7528;&#x8BE5;&#x94A9;&#x5B50;&#x65B9;&#x6CD5;&#xFF0C;&#x8868;&#x793A;FutureTask&#x4EFB;&#x52A1;&#x5DF2;&#x7ECF;&#x5B8C;&#x6210;&#xFF0C;&#x7136;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x6267;&#x884C;&#x76D1;&#x542C;&#x5668;&#x94FE;&#x4E86;&#x3002;&#x53E6;&#x5916;ListenableFutre&#x662F;&#x6709;&#x4E00;&#x4E2A;&#x76D1;&#x542C;&#x5668;&#x6267;&#x884C;&#x5217;&#x8868;&#x8BE5;&#x8868;&#x662F;&#x4E00;&#x4E2A;&#x5355;&#x94FE;&#x8868;&#xFF0C;&#x7528;&#x4E8E;&#x6267;&#x884C;&#x56DE;&#x8C03;&#x65B9;&#x6CD5;&#x7528;&#x7684;&#x3002;</p>
<h2 id="4-Futures-successFulAsList-&#x7684;&#x7B80;&#x5355;&#x4F7F;&#x7528;"><a href="#4-Futures-successFulAsList-&#x7684;&#x7B80;&#x5355;&#x4F7F;&#x7528;" class="headerlink" title="4.Futures.successFulAsList &#x7684;&#x7B80;&#x5355;&#x4F7F;&#x7528;"></a>4.Futures.successFulAsList &#x7684;&#x7B80;&#x5355;&#x4F7F;&#x7528;</h2><p>&#x9996;&#x5148;Futures.successFulAsList&#x5B83;&#x7684;&#x4F5C;&#x7528;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x591A;&#x4E2A;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x4E2A;&#x7684;&#x8C03;&#x7528;get&#x65B9;&#x6CD5;&#x83B7;&#x53D6;&#x7ED3;&#x679C;&#xFF0C;&#x800C;&#x4E14;&#x8FD9;&#x4E2A;&#x7ED9;&#x83B7;&#x53D6;&#x7ED3;&#x679C;&#x7684;&#x8FC7;&#x7A0B;&#x53EF;&#x80FD;&#x662F;&#x963B;&#x585E;&#x7684;(&#x4EFB;&#x52A1;&#x6CA1;&#x5B8C;&#x6210;&#x65F6;),&#x800C;&#x4E14;&#x9700;&#x8981;&#x6211;&#x4EEC;&#x4E00;&#x4E2A;&#x4E2A;&#x7684;&#x53BB;&#x8C03;&#x7528;&#xFF0C;&#x90A3;&#x4E48;successFulAsList&#x7684;&#x4F5C;&#x7528;&#x5C31;&#x662F;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x628A;&#x591A;&#x4E2A;future&#x7684;&#x805A;&#x5408;&#x6210;&#x4E00;&#x4E2A;ListtenableFutre<br>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x518D;&#x901A;&#x8FC7;&#x8C03;&#x7528;&#x805A;&#x4F1A;&#x540E;&#x7684;&#x8FD9;&#x4E2A;ListenableFutre&#x5C31;&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x5230;&#x6240;&#x6709;futre&#x7684;&#x7ED3;&#x679C;&#x96C6;&#x4E86;&#xFF08;&#x6574;&#x4E2A;&#x6574;&#x5408;&#x8FC7;&#x7A0B;&#x4E5F;&#x662F;&#x5F02;&#x6B65;&#x5904;&#x7406;&#x7684;&#xFF09;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;&#x4E0B;&#x9762;&#x662F;&#x7B80;&#x5355;&#x7528;&#x6CD5;&#x3002;</span><br><span class="line"></span><br><span class="line">ListeningExecutorService listeningExecutorService = MoreExecutors.listeningDecorator(Executors.newFixedThreadPool(5));</span><br><span class="line">ListenableFuture&lt;String&gt; lf1 = listeningExecutorService.submit(() -&gt; {</span><br><span class="line">    return &quot;listFuture1&quot;;</span><br><span class="line">});</span><br><span class="line">ListenableFuture&lt;String&gt; lf2 = listeningExecutorService.submit(() -&gt; {</span><br><span class="line">    return &quot;listFuture2&quot;;</span><br><span class="line">});</span><br><span class="line">List&lt;ListenableFuture&lt;String&gt;&gt; listenableFutures = Lists.newArrayList(lf1, lf2);</span><br><span class="line">ListenableFuture&lt;List&lt;String&gt;&gt; listListenableFuture = Futures.successfulAsList(listenableFutures);</span><br><span class="line">Thread thread = new Thread(() -&gt; {</span><br><span class="line">    while (true) {</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+&quot;&#x5E76;&#x53D1;&#x5DE5;&#x4F5C;&#x4E2D;.....&quot;);</span><br><span class="line"> if (listListenableFuture.isDone()){</span><br><span class="line">            break;</span><br><span class="line"> }</span><br><span class="line">    }</span><br><span class="line">},&quot;test-thread&quot;);</span><br><span class="line"></span><br><span class="line">System.out.println(listListenableFuture.get());</span><br></pre></td></tr></table></figure>

<h2 id="3-successFulAsList-&#x7684;&#x539F;&#x7406;&#x53CA;&#x6E90;&#x7801;&#x5206;&#x6790;"><a href="#3-successFulAsList-&#x7684;&#x539F;&#x7406;&#x53CA;&#x6E90;&#x7801;&#x5206;&#x6790;" class="headerlink" title="3.successFulAsList &#x7684;&#x539F;&#x7406;&#x53CA;&#x6E90;&#x7801;&#x5206;&#x6790;"></a>3.successFulAsList &#x7684;&#x539F;&#x7406;&#x53CA;&#x6E90;&#x7801;&#x5206;&#x6790;</h2><p>&#x9996;&#x5148;&#x5F53;successFulAsList&#x4F20;&#x5165;&#x591A;&#x4E2A;future&#x65F6;&#x540E;&#x4F1A;&#x8C03;&#x7528; Futures.lsitFuture&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x5176;&#x5B9E;&#x6CA1;&#x5E72;&#x5565;&#xFF0C;&#x5C31;&#x662F;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x7528;&#x6765;&#x6574;&#x5408;&#x591A;&#x4E2A;future&#x7684;CombinedFuture&#x7C7B;&#x4EE5;&#x53CA;&#x4E00;&#x4E2A;future&#x7ED3;&#x679C;&#x5904;&#x7406;&#x7684;FutureCombiner&#x63A5;&#x53E3;&#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;</p>
<ul>
<li>listFuture&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x5904;&#x7406;&#x4E3B;&#x8981;&#x662F;&#x901A;&#x8FC7;&#x628A;future&#x96C6;&#x4F20;&#x9012;&#x7ED9;CombinedFutre&#x8FD9;&#x4E2A;&#x7C7B;&#x6765;&#x5904;&#x7406;ListenableFuture&#x96C6;&#xFF0C;</li>
<li>&#x8FD9;&#x4E2A;CombinedFuture&#x529F;&#x80FD;&#x548C;&#x540D;&#x5B57;&#x4E00;&#x6837;&#x5C31;&#x662F;&#x8054;&#x5408;&#x51E0;&#x4E2A;future&#x96C6;&#x4E00;&#x8D77;&#x5904;&#x7406;&#xFF0C;&#x4E00;&#x822C;&#x9700;&#x8981;&#x4F20;&#x5165;&#x4E00;&#x4E2A;Future&#x96C6;&#xFF0C;&#x4EE5;&#x53CA;&#x6267;&#x884C;&#x76D1;&#x542C;&#x5668;&#x4EFB;&#x52A1;&#x7684;&#x7EBF;&#x7A0B;&#x6C60;&#xFF0C;</li>
<li>&#x540C;&#x65F6;&#x9700;&#x8981;&#x4F20;&#x5165;FutureCombiner&#x63A5;&#x53E3;&#x7684;&#x5B9E;&#x73B0;&#x7C7B;&#xFF0C;&#x8FD9;&#x4E2A;&#x63A5;&#x53E3;&#x4E3B;&#x8981;&#x662F;&#x7528;&#x6765;&#x628A;CombinedFutre&#x5185;&#x90E8;&#x6267;&#x884C;&#x5B8C;Future&#x96C6;&#x4E4B;&#x540E;&#x7684;&#x7ED3;&#x679C;&#x662F;&#x5982;&#x4F55;&#x5904;&#x7406;&#x7684;&#xFF0C;</li>
<li>&#x800C;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x662F;&#x628A;&#x7ED3;&#x679C;&#x96C6;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;list&#x5B58;&#x50A8;&#x8D77;&#x6765;&#x8FD4;&#x56DE;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x4E2A;ListenableFuture&#x5176;&#x5B9E;&#x4E3B;&#x8981;&#x529F;&#x80FD;&#x5C31;&#x662F;&#x53EF;&#x4EE5;&#x63D0;&#x4EA4;&#x4E00;&#x4E2A;List&#x7684;Future&#x53BB;&#x5904;&#x7406;&#x5E76;&#x4E14;&#x8FD4;&#x56DE;&#x591A;&#x4E2A;Future&#x6267;&#x884C;&#x7ED3;&#x679C;&#x96C6;&#xFF0C;&#x800C;&#x4E0D;&#x9700;&#x8981;&#x7C7B;&#x4F3C;&#x4E8E;Java&#x4E2D;FutureTask,&#x4E00;&#x4E2A;&#x4E00;&#x4E2A;&#x83B7;&#x53D6;&#x7ED3;&#x679C;&#xFF0C;&#x7136;&#x540E;&#x5B58;&#x50A8;&#x5728;list&#x4E2D;&#xFF0C;guava&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x628A;&#x8FD9;&#x4E00;&#x822C;&#x8FDB;&#x884C;&#x5C01;&#x88C5;&#xFF0C;&#x540C;&#x65F6;&#x6269;&#x5C55;&#x4E86;future&#x6267;&#x884C;&#x5B8C;&#x6210;&#x540E;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x8FD9;&#x4E9B;future&#x7684;&#x76D1;&#x542C;&#x5668;&#xFF0C;&#x4EE5;&#x53CA;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x3002;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">swift&#x590D;&#x5236;&#x4EE3;&#x7801;//&#x4F20;&#x5165;&#x591A;&#x4E2A;Futres&#x7136;&#x540E;&#x4EE5;&#x53CA;&#x7EBF;&#x7A0B;&#x6C60;&#x53BB;&#x5904;&#x7406;&#xFF0C;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;futeres &#x6267;&#x884C;&#x6210;&#x529F;&#x7684;&#x7ED3;&#x679C;&#x96C6;&#x3002;</span><br><span class="line">@Beta</span><br><span class="line">  public static &lt;V&gt; ListenableFuture&lt;List&lt;V&gt;&gt; successfulAsList(</span><br><span class="line">      Iterable&lt;? extends ListenableFuture&lt;? extends V&gt;&gt; futures) {</span><br><span class="line">		  //&#x5148;&#x901A;&#x8FC7;&#x62F7;&#x8D1D;&#x5143;&#x7D20;&#x628A;ListenableFuture&#x96C6;&#x53D8;&#x6210;&#x4E00;&#x4E2A;&#x4E0D;&#x53EF;&#x53D8;&#xFF0C;&#x7136;&#x540E;&#x8C03;&#x7528;listFuture&#xFF0C;&#x4F20;&#x5165;listenableFuture&#x96C6;&#xFF0C;&#x662F;&#x5426;&#x5168;&#x90E8;&#x7684;&#x5FC5;&#x987B;&#x6210;&#x529F;&#x4EE5;&#x53CA;&#x7EBF;&#x7A0B;&#x6C60;&#xFF0C;listFuture&#x6B63;&#x65B9;&#x6CD5;&#x662F;&#x628A;futures&#x505A;&#x5904;&#x7406;&#x7684;</span><br><span class="line">    return listFuture(ImmutableList.copyOf(futures), false, directExecutor());</span><br><span class="line">  }</span><br><span class="line">  </span><br><span class="line">   private static &lt;V&gt; ListenableFuture&lt;List&lt;V&gt;&gt; listFuture(</span><br><span class="line">     ImmutableList&lt;ListenableFuture&lt;? extends V&gt;&gt; futures,</span><br><span class="line">     boolean allMustSucceed, Executor listenerExecutor) {</span><br><span class="line">   return new CombinedFuture&lt;V, List&lt;V&gt;&gt;(</span><br><span class="line">       futures, allMustSucceed, listenerExecutor,</span><br><span class="line">	   //&#x8FD9;&#x76F4;&#x63A5;new&#x4E86;&#x4E00;&#x4E2A;&#x63A5;&#x53E3;&#x7136;&#x540E;&#x5199;&#x4E86;&#x5982;&#x4F55;&#x628A;future&#x7ED3;&#x679C;&#x7ED3;&#x5408;&#x8D77;&#x6765;&#x8FD4;&#x56DE;&#x3002;</span><br><span class="line">       new FutureCombiner&lt;V, List&lt;V&gt;&gt;() {</span><br><span class="line">         @Override</span><br><span class="line">		//&#x7531;&#x4E8E;&#x8FD9;&#x4E9B;&#x53EF;&#x80FD;&#x5B58;&#x5728;&#x5219;npe&#x95EE;&#x9898;&#xFF0C;&#x6240;&#x4EE5;&#x5185;&#x90E8;&#x5904;&#x7406;&#x7684;&#x65F6;&#x5019;&#x91C7;&#x7528;&#x4E86;Optional&#x6765;&#x5904;&#x7406;&#x907F;&#x514D;NPE</span><br><span class="line">         public List&lt;V&gt; combine(List&lt;Optional&lt;V&gt;&gt; values) {</span><br><span class="line">           List&lt;V&gt; result = Lists.newArrayList();</span><br><span class="line">           for (Optional&lt;V&gt; element : values) {</span><br><span class="line">			  //&#x5982;&#x679C;&#x662F;&#x5F02;&#x5E38;&#x6216;&#x8005;&#x6CA1;&#x6709;&#x6570;&#x636E;&#xFF0C;&#x5219;&#x6DFB;&#x52A0;null&#x5904;&#x7406;</span><br><span class="line">             result.add(element != null ? element.orNull() : null);</span><br><span class="line">           }</span><br><span class="line">		   //&#x6700;&#x540E;</span><br><span class="line">           return Collections.unmodifiableList(result);</span><br><span class="line">         }</span><br><span class="line">       });</span><br><span class="line">  }</span><br></pre></td></tr></table></figure>

<h4 id="3-1-CombinedFuture&#x7C7B;&#x5206;&#x6790;"><a href="#3-1-CombinedFuture&#x7C7B;&#x5206;&#x6790;" class="headerlink" title="3.1 CombinedFuture&#x7C7B;&#x5206;&#x6790;"></a>3.1 CombinedFuture&#x7C7B;&#x5206;&#x6790;</h4><p>CombinedFuture&#x4E3B;&#x8981;&#x662F;&#x7ED9;&#x591A;&#x4E2A;Future&#x8BBE;&#x7F6E;&#x76D1;&#x542C;&#x5668;&#xFF0C;&#x7136;&#x540E;&#x901A;&#x8FC7;&#x7EBF;&#x7A0B;&#x6C60;&#x6267;&#x884C;&#x76D1;&#x542C;&#x5668;&#x94FE;&#xFF0C;&#x6BCF;&#x4E2A;&#x76D1;&#x542C;&#x5668;&#x90FD;&#x4F1A;&#x8C03;&#x7528;setOneValue&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x91CC;&#x8FDB;&#x884C;&#x81EA;&#x65CB;&#x83B7;&#x53D6;future&#x7684;&#x7ED3;&#x679C;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x5148;&#x770B;&#x770B;CombinedFuture&#x7C7B;&#x7684;&#x76F8;&#x5173;&#x6210;&#x5458;&#x53D8;&#x91CF;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">scala&#x590D;&#x5236;&#x4EE3;&#x7801;/CombinedFuture&#x662F;&#x4E00;&#x4E2A;&#x628A;&#x591A;&#x4E2A;future&#x8054;&#x5408;&#x5904;&#x7406;&#x7684;&#x4E00;&#x4E2A;&#x9759;&#x6001;&#x5185;&#x90E8;&#x7C7B;</span><br><span class="line">  private static class CombinedFuture&lt;V, C&gt; extends AbstractFuture&lt;C&gt; {</span><br><span class="line">    private static final Logger logger = Logger.getLogger(CombinedFuture.class.getName());</span><br><span class="line">	//ListenableFuture &#x4EFB;&#x52A1;&#x96C6;</span><br><span class="line">    ImmutableCollection&lt;? extends ListenableFuture&lt;? extends V&gt;&gt; futures;</span><br><span class="line">	//&#x662F;&#x5426;&#x5FC5;&#x987B;&#x533A;&#x522B;&#x6267;&#x884C;&#x6210;&#x529F;&#xFF0C;SuccessASFuture&#x53EA;&#x8FD4;&#x56DE;&#x6267;&#x884C;&#x6210;&#x529F;&#x7684;&#xFF0C;allAsFuture&#x9700;&#x8981;&#x533A;&#x522B;&#x6267;&#x884C;&#x6210;&#x529F;&#xFF0C;&#x6709;&#x4E00;&#x4E2A;&#x5931;&#x8D25;&#x90FD;&#x8FD4;&#x56DE;&#x5931;&#x8D25;&#x7ED3;&#x679C;</span><br><span class="line">    final boolean allMustSucceed;</span><br><span class="line">	//&#x8BB0;&#x5F55;&#x5269;&#x4F59;&#x9700;&#x8981;&#x6267;&#x884C;&#x7684;future&#x4E2A;&#x6570;</span><br><span class="line">    final AtomicInteger remaining;</span><br><span class="line">	//&#x628A;futre&#x4EFB;&#x52A1;&#x7ED3;&#x679C;&#x5904;&#x7406;&#x7684;&#x4E00;&#x4E2A;&#x7C7B;</span><br><span class="line">    FutureCombiner&lt;V, C&gt; combiner;</span><br><span class="line">    List&lt;Optional&lt;V&gt;&gt; values;</span><br><span class="line">	//&#x5F02;&#x5E38;&#x9501;</span><br><span class="line">    final Object seenExceptionsLock = new Object();</span><br><span class="line">	//&#x5B58;&#x50A8;&#x51FA;&#x73B0;&#x7684;&#x5F02;&#x5E38;&#x4FE1;&#x606F;</span><br><span class="line">    Set&lt;Throwable&gt; seenExceptions;</span><br><span class="line">    </span><br><span class="line">//&#x6784;&#x9020;&#x51FD;&#x6570;&#x521D;&#x59CB;&#x5316;&#x76F8;&#x5173;&#x53C2;&#x6570;&#x5E76;&#x4E14;&#x8C03;&#x7528;init&#x5F00;&#x59CB;&#x6267;&#x884C;&#x83B7;&#x53D6;future&#x7ED3;&#x679C;</span><br><span class="line">    CombinedFuture(</span><br><span class="line">        ImmutableCollection&lt;? extends ListenableFuture&lt;? extends V&gt;&gt; futures,</span><br><span class="line">        boolean allMustSucceed, Executor listenerExecutor,</span><br><span class="line">        FutureCombiner&lt;V, C&gt; combiner) {</span><br><span class="line">		//&#x5148;&#x521D;&#x59CB;&#x5316;&#x53C2;&#x6570;</span><br><span class="line">      this.futures = futures;</span><br><span class="line">      this.allMustSucceed = allMustSucceed;</span><br><span class="line">	  //&#x521D;&#x59CB;&#x5316;&#x6CA1;&#x6267;&#x884C;&#x7684;future&#x4E2A;&#x6570;&#x4E3A;future&#x96C6;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x4E3B;&#x8981;&#x8FD9;&#x4E2A;&#x7C7B;&#x662F;&#x539F;&#x5B50;&#x7C7B;&#xFF0C;&#x662F;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x7684;&#x3002;</span><br><span class="line">      this.remaining = new AtomicInteger(futures.size());</span><br><span class="line">      this.combiner = combiner;</span><br><span class="line">	  //&#x5B58;&#x50A8;&#x7ED3;&#x679C;&#x7684;&#x4E00;&#x4E2A;list&#xFF0C;&#x4F1A;&#x5148;&#x6839;&#x636E;futures&#x7684;&#x5927;&#x5C0F;&#x521B;&#x5EFA;</span><br><span class="line">      this.values = Lists.newArrayListWithCapacity(futures.size());</span><br><span class="line">	  //&#x521D;&#x59CB;&#x5316;&#x65B9;&#x6CD5;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x4F5C;&#x4E1A;&#x662F;&#x83B7;&#x53D6;future&#x7ED3;&#x679C;&#xFF0C;&#x5E76;&#x4E14;&#x589E;&#x52A0;CombinedFuture&#x7C7B;&#x7684;&#x76D1;&#x542C;&#x5668;&#xFF0C;future&#x96C6;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x4E4B;&#x540E;&#x76F8;&#x5173;&#x53C2;&#x6570;&#x6E05;&#x9664;&#x3002;</span><br><span class="line">	  //&#x800C;&#x4E14;&#x5B83;&#x5FC5;&#x987B;&#x5728;&#x6784;&#x9020;&#x51FD;&#x6570;&#x7ED3;&#x5C3E;&#x8C03;&#x7528;&#xFF0C;init&#x65B9;&#x6CD5;&#x4F7F;&#x7528;&#x4E86;&#x5F88;&#x591A;ConbinedFuture&#x7684;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x3002;</span><br><span class="line">      init(listenerExecutor);</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x4E2A;init&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x5BF9;&#x4E0A;&#x9762;&#x7684;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x8FDB;&#x884C;&#x521D;&#x59CB;&#x5316;&#x4EE5;&#x53CA;&#x4E3A;&#x5404;&#x4E2A;ListenableFuture&#x8BBE;&#x7F6E;&#x76D1;&#x542C;&#x5668;&#x6765;&#x56DE;&#x8C03;setOneValue &#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x4F1A;&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;&#x76D1;&#x542C;&#x5668;&#x662F;&#x5904;&#x7406;future&#x7ED3;&#x675F;&#x8FDB;&#x884C;&#x6E05;&#x7406;&#x5DE5;&#x4F5C;&#x7684;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;    protected void init(final Executor listenerExecutor) {</span><br><span class="line">      //&#x5148;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x76D1;&#x542C;&#x5668;&#x5904;&#x7406;futre&#x6267;&#x884C;&#x5B8C;&#x6210;&#x540E;&#x8FDB;&#x884C;&#x76F8;&#x5173;&#x6E05;&#x7406;&#x5DE5;&#x4F5C;</span><br><span class="line">      addListener(new Runnable() {</span><br><span class="line">        @Override</span><br><span class="line">        public void run() {</span><br><span class="line">          // &#x904D;&#x5386;&#x8C03;&#x7528;future.cancel&#x65B9;&#x6CD5;&#x5904;&#x7406;.</span><br><span class="line">          if (CombinedFuture.this.isCancelled()) {</span><br><span class="line">            for (ListenableFuture&lt;?&gt; future : CombinedFuture.this.futures) {</span><br><span class="line">              future.cancel(CombinedFuture.this.wasInterrupted());</span><br><span class="line">            }</span><br><span class="line">          }</span><br><span class="line"></span><br><span class="line">         //&#x628A;futures&#x7684;&#x5F15;&#x7528;&#x662F;&#x5426;&#xFF0C;&#x7B49;&#x5F85;gc&#x56DE;&#x6536;</span><br><span class="line">          CombinedFuture.this.futures = null;</span><br><span class="line"></span><br><span class="line">          // By now the values array has either been set as the Future&apos;s value,</span><br><span class="line">          // or (in case of failure) is no longer useful.</span><br><span class="line">          CombinedFuture.this.values = null;</span><br><span class="line"></span><br><span class="line">          // The combiner may also hold state, so free that as well</span><br><span class="line">          CombinedFuture.this.combiner = null;</span><br><span class="line">        }</span><br><span class="line">      }, directExecutor());</span><br><span class="line"></span><br><span class="line">      //&#x5982;&#x679C;futures&#x662F;&#x7A7A;&#x7684;&#x5219;&#x8C03;&#x7528;AbstractFuture&#x62BD;&#x8C61;&#x7C7B;&#x4E0A;&#x7684;set&#x65B9;&#x6CD5;&#x628A;&#x628A;&#x7A7A;&#x7684;&#x4E0D;&#x53EF;&#x53D8;&#x7ED3;&#x679C;&#x96C6;&#x8BBE;&#x7F6E;&#x4E3A;Future&#x7684;&#x7ED3;&#x679C;,&#x5185;&#x90E8;&#x6709;&#x4E00;&#x4E2A;&#x57FA;&#x4E8E;AQS&#x7684;&#x5B50;&#x7C7B;Sync&#x901A;&#x8FC7;cas&#x5904;&#x7406;</span><br><span class="line">      if (futures.isEmpty()) {</span><br><span class="line">		  //&#x5148;&#x8C03;&#x7528;FutureCombiner&#x7684;combine&#x65B9;&#x6CD5;&#x628A;&#x8FD9;&#x4E2A;&#x7ED3;&#x679C;&#x904D;&#x5386;&#x6DFB;&#x52A0;&#x7684;list&#x91CC;&#x9762;&#xFF08;&#x5F00;&#x5934;&#x90A3;&#x4E2A;&#x63A5;&#x53E3;&#x91CC;&#x6709;combine&#x76F8;&#x5173;&#x5904;&#x7406;&#x6D41;&#x7A0B;&#xFF09;</span><br><span class="line">        set(combiner.combine(ImmutableList.&lt;Optional&lt;V&gt;&gt;of()));</span><br><span class="line">        return;</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      // &#x5B83;&#x4F1A;&#x5148;&#x628A;&#x7ED3;&#x679C;&#x96C6;&#x5168;&#x90E8;&#x7528;null&#x5360;&#x4F4D;.</span><br><span class="line">      for (int i = 0; i &lt; futures.size(); ++i) {</span><br><span class="line">        values.add(null);</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">	//&#x904D;&#x5386;future&#x4EFB;&#x52A1;&#x96C6;&#xFF0C;&#x5E76;&#x4E14;&#x4E3A;&#x6BCF;&#x4E2A;future&#x6DFB;&#x52A0;&#x76D1;&#x542C;&#x5668;&#xFF0C;</span><br><span class="line">	//future&#x4EFB;&#x52A1;&#x90FD;&#x5B8C;&#x6210;&#x4E4B;&#x540E;&#x5C31;&#x4F1A;&#x8C03;&#x7528;&#x76D1;&#x542C;&#x5668;&#xFF0C;</span><br><span class="line">      int i = 0;</span><br><span class="line">      for (final ListenableFuture&lt;? extends V&gt; listenable : futures) {</span><br><span class="line">        final int index = i++;</span><br><span class="line">        listenable.addListener(new Runnable() {</span><br><span class="line">          @Override</span><br><span class="line">          public void run() {</span><br><span class="line">			//setOneValue&#x662F;&#x8C03;&#x7528;linstenable.get()(&#x5176;&#x5B9E;&#x5C31;&#x662F;future.get())</span><br><span class="line">            setOneValue(index, listenable);</span><br><span class="line">          }</span><br><span class="line">        }, listenerExecutor);</span><br><span class="line">      }</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>&#x4E0A;&#x56FE;&#x4E2D;&#x7684;&#x7B2C;&#x4E8C;&#x4E2A;addListener&#x589E;&#x52A0;&#x76D1;&#x542C;&#x5668;&#x540E;&#x4F1A;&#x8DD1;&#x5230;ListenableFutureTask &#x8FD9;&#x4E2A;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x7C7B;&#x4E2D;&#x6DFB;&#x52A0;&#x76D1;&#x542C;&#x5668;&#xFF0C;&#x5B83;&#x6709;&#x4E00;&#x4E2A;executionList&#x76D1;&#x542C;&#x5668;&#x6210;&#x5458;&#x53D8;&#x91CF;&#xFF0C;&#x8FD9;&#x4E2A;&#x53D8;&#x91CF;&#x662F;&#x4E00;&#x4E2A;&#x5355;&#x94FE;&#x8868;&#x7684;&#x6267;&#x884C;&#x5668;&#x7C7B;</p>
<p>&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x662F;ListenableFutureTask &#x7684;addListener:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">typescript&#x590D;&#x5236;&#x4EE3;&#x7801;  @Override</span><br><span class="line"> public void addListener(Runnable listener, Executor exec) {</span><br><span class="line">    executionList.add(listener, exec);</span><br><span class="line"> }</span><br></pre></td></tr></table></figure>

<p>&#x4E0B;&#x9762;&#x6765;&#x770B;&#x4E00;&#x4E0B;ExecutionList&#x8FD9;&#x4E2A;&#x7C7B;&#x662F;&#x5982;&#x4F55;&#x5904;&#x7406;&#x65B0;&#x589E;&#x7684;&#x76D1;&#x542C;&#x5668;&#x7684;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;//executionList &#x548C;&#x5B57;&#x9762;&#x610F;&#x8BC6;&#x4E00;&#x6837;&#x662F;&#x4E00;&#x4E2A;&#x6267;&#x884C;&#x5217;&#x8868;&#xFF0C;&#x4ED6;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x5305;&#x542B;&#x591A;&#x4E2A;Runnable&#x7684;list&#x52A0;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x7EC4;&#x5408;</span><br><span class="line">//&#x524D;&#x7F6E;&#x77E5;&#x8BC6;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x6267;&#x884C;&#x6D41;&#x7A0B;</span><br><span class="line">public final class ExecutionList {</span><br><span class="line">  </span><br><span class="line">  @VisibleForTesting static final Logger log = Logger.getLogger(ExecutionList.class.getName());</span><br><span class="line">	//&#x4E00;&#x4E2A;&#x5C01;&#x88C5;&#x4E86;Runnable &#x548C;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x5355;&#x94FE;&#x8868;&#x7C7B;</span><br><span class="line">  @GuardedBy(&quot;this&quot;)</span><br><span class="line">  private RunnableExecutorPair runnables;</span><br><span class="line">  //&#x5224;&#x65AD;&#x8FD9;&#x4E2A;&#x6267;&#x884C;&#x5217;&#x8868;&#x7C7B;&#x7684;runnables&#x8FD9;&#x4E2A;&#x5355;&#x94FE;&#x8868;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x88AB;&#x6267;&#x884C;&#x8FC7;</span><br><span class="line">  @GuardedBy(&quot;this&quot;)</span><br><span class="line">  private boolean executed;</span><br><span class="line"></span><br><span class="line">  /** Creates a new, empty {@link ExecutionList}. */</span><br><span class="line">  public ExecutionList() {}</span><br><span class="line">  </span><br><span class="line">  //&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#xFF0C;&#x9700;&#x8981;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x57FA;&#x4E8E;runnable&#x63A5;&#x53E3;&#x7684;&#x5B9E;&#x73B0;&#x7C7B;&#x4EE5;&#x53CA;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x6C60;</span><br><span class="line">  public void add(Runnable runnable, Executor executor) {</span><br><span class="line">   </span><br><span class="line">    Preconditions.checkNotNull(runnable, &quot;Runnable was null.&quot;);</span><br><span class="line">    Preconditions.checkNotNull(executor, &quot;Executor was null.&quot;);</span><br><span class="line"></span><br><span class="line">    //&#x5728;&#x6267;&#x884C;&#x94FE;&#x8868;&#x6DFB;&#x52A0;&#x8282;&#x70B9;&#x65F6;&#xFF0C;&#x901A;&#x8FC7;synchronized&#x9501;&#x4F4F;&#x8FD9;&#x4E2A;&#x7C7B;&#xFF0C;&#x907F;&#x514D;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x95EE;&#x9898;</span><br><span class="line">    synchronized (this) {</span><br><span class="line">      if (!executed) {</span><br><span class="line">        runnables = new RunnableExecutorPair(runnable, executor, runnables);</span><br><span class="line">        return;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">    //&#x9ED8;&#x8BA4;&#x6DFB;&#x52A0;&#x5B8C;&#x4E4B;&#x540E;&#x4F1A;&#xFF0C;&#x53C2;&#x6570;&#x628A;&#x8FD9;&#x4E2A;&#x4EFB;&#x52A1;&#x4E22;&#x4E2A;&#x7EBF;&#x7A0B;&#x6C60;&#x53BB;&#x5904;&#x7406;&#xFF0C;&#x5E76;&#x4E0D;&#x4E00;&#x5B9A;&#x80FD;&#x5904;&#x7406;&#x6210;&#x529F;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x5B58;&#x50A8;&#x5728;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x963B;&#x585E;&#x961F;&#x5217;&#x91CC;</span><br><span class="line">    executeListener(runnable, executor);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  //&#x5177;&#x4F53;&#x6267;&#x884C;&#x65B9;&#x6CD5;&#xFF0C;&#x4ED6;&#x4F1A;&#x5148;&#x5224;&#x65AD;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x8C03;&#x7528;&#x8FC7;execute&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x6267;&#x884C;&#x94FE;&#x8868;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#xFF0C;</span><br><span class="line">  //&#x5219;&#x62FF;&#x5230;&#x6267;&#x884C;&#x94FE;&#x8868;&#x7684;&#x8868;&#x5934;&#x7528;&#x4E00;&#x4E2A;&#x4E34;&#x65F6;&#x94FE;&#x8868;&#x5B58;&#x50A8;&#x8868;&#x5934;&#xFF0C;&#x7136;&#x540E;&#x628A;&#x8FD9;&#x4E2A;&#x7C7B;&#x7684;&#x94FE;&#x8868;&#x7F6E;&#x7A7A;</span><br><span class="line">  //&#x7531;&#x4E8E;&#x6DFB;&#x52A0;&#x94FE;&#x8868;&#x8282;&#x70B9;&#x7684;&#x65F6;&#x5019;&#x91C7;&#x7528;&#x7684;&#x662F;&#x5934;&#x63D2;&#x6CD5;&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x4E00;&#x6B21;&#x94FE;&#x8868;&#x53CD;&#x8F6C;&#xFF0C;&#x7136;&#x540E;&#x904D;&#x5386;&#x94FE;&#x8868;&#x628A;runnbale&#x4EA4;&#x7ED9;&#x7EBF;&#x7A0B;&#x6C60;&#x5904;&#x7406;&#xFF0C;</span><br><span class="line">  //&#x8FD9;&#x4E2A;&#x6709;&#x4E2A;&#x5751;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x719F;&#x6089;&#x7EBF;&#x7A0B;&#x6C60;&#x6267;&#x884C;&#x6D41;&#x7A0B;&#x7684;&#x8BDD;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x4EE5;&#x4E3A;&#xFF0C;&#x8FD9;&#x91CC;&#x94FE;&#x8868;&#x5B58;&#x50A8;&#x4E86;&#x4E00;&#x6B21;&#xFF0C;&#x7136;&#x540E;add&#x5B8C;&#x4E4B;&#x540E;&#x4EA4;&#x7ED9;&#x7EBF;&#x7A0B;&#x6C60;&#x8981;&#x4E48;&#x6267;&#x884C;&#xFF0C;&#x8981;&#x4E48;&#x5B58;&#x653E;&#x5728;&#x963B;&#x585E;&#x961F;&#x5217;&#x91CC;&#xFF0C;</span><br><span class="line">  //&#x4F1A;&#x4EE5;&#x4E3A;&#x51FA;&#x73B0;&#x4E24;&#x6B21;&#x6267;&#x884C;&#xFF0C;&#x4F46;&#x662F;&#x5982;&#x679C;&#x770B;&#x8FC7;&#x7EBF;&#x7A0B;&#x6C60;&#x6E90;&#x7801;&#x7684;&#x8BDD;&#xFF0C;&#x5176;&#x5B9E;&#x4F60;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x5F53;runnable&#x88AB;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x5B8C;&#x4E4B;&#x540E;&#xFF0C;&#x4F1A;&#x628A;&#x8FD9;&#x4E2A;runnable&#x7F6E;&#x7A7A;&#xFF0C;&#x7136;&#x540E;&#x7ED3;&#x5408;Java&#x7684;&#x57FA;&#x7840;&#x77E5;&#x8BC6;</span><br><span class="line">  //&#x5305;&#x88C5;&#x7C7B;&#x578B;&#x4EE5;&#x53CA;&#x5BF9;&#x8C61;&#x7C7B;&#x578B;&#x3001;&#x6570;&#x7EC4;&#x7C7B;&#x578B;&#x7B49;&#x53C2;&#x6570;&#x4F20;&#x9012;&#x8FC7;&#x7A0B;&#x662F;&#x4F20;&#x9012;&#x5BF9;&#x8C61;&#x7684;&#x5730;&#x5740;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x4FEE;&#x6539;&#x4F20;&#x9012;&#x7684;&#x5BF9;&#x8C61;&#x65F6;&#xFF0C;&#x5B58;&#x653E;&#x5728;&#x5176;&#x4ED6;&#x5730;&#x65B9;&#x7684;&#x5F15;&#x7528;&#x4E5F;&#x4F1A;&#x53D1;&#x751F;&#x6539;&#x53D8;&#xFF0C;&#x6240;&#x4EE5;&#x5982;&#x679C;runnable&#x6267;&#x884C;&#x8FC7;</span><br><span class="line">  //&#x90A3;&#x4E48;&#x5728;executeList&#x4E2D;&#x7684;&#x6267;&#x884C;&#x94FE;&#x4E2D;&#x8FD9;&#x4E2A;runnable&#x662F;&#x5DF2;&#x7ECF;&#x88AB;&#x7F6E;&#x7A7A;&#x4E86;&#x7684;&#xFF0C;&#x7136;&#x540E;&#x7EBF;&#x7A0B;&#x6C60;&#x5728;&#x7EBF;&#x7A0B;&#x6267;&#x884C;</span><br><span class="line">  public void execute() {</span><br><span class="line">    // Lock while we update our state so the add method above will finish adding</span><br><span class="line">    // any listeners before we start to run them.</span><br><span class="line">    RunnableExecutorPair list;</span><br><span class="line">    synchronized (this) {</span><br><span class="line">      if (executed) {</span><br><span class="line">        return;</span><br><span class="line">      }</span><br><span class="line">	 //&#x628A;&#x8868;&#x793A;&#x8868;&#x793A;&#x4E3A;&#x5DF2;&#x7ECF;&#x6267;&#x884C;&#x8FC7;</span><br><span class="line">      executed = true;</span><br><span class="line">	  //&#x62FF;&#x5230;&#x6267;&#x884C;&#x94FE;&#x8868;&#x5934;</span><br><span class="line">      list = runnables;</span><br><span class="line">	  //&#x7F6E;&#x7A7A;&#xFF0C;&#x7B49;&#x5F85;GC&#x56DE;&#x6536;</span><br><span class="line">      runnables = null;  // allow GC to free listeners even if this stays around for a while.</span><br><span class="line">    }</span><br><span class="line">	</span><br><span class="line">	//&#x7EBF;&#x7A0B;&#x6C60;Executor&#x4E2D;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#x7684;&#x65B9;&#x6CD5;</span><br><span class="line">	 final void runWorker(Worker w) {</span><br><span class="line">        Thread wt = Thread.currentThread();</span><br><span class="line">		//&#x62FF;&#x5230; Worker &#x4E2D;&#x7684;runnable</span><br><span class="line">        Runnable task = w.firstTask;</span><br><span class="line">        w.firstTask = null;</span><br><span class="line">        w.unlock(); // allow interrupts</span><br><span class="line">        boolean completedAbruptly = true;</span><br><span class="line">        try {</span><br><span class="line">			//&#x8FD9;&#x4E9B;&#x662F;&#x5148;&#x6267;&#x884C;&#x5F53;&#x524D;worker&#x8282;&#x70B9;&#x4E2D;&#x7684;&#x4EFB;&#x52A1;&#xFF0C;&#x6267;&#x884C;&#x5B8C;&#x4E4B;&#x540E;&#x4F1A;&#x4ECE;&#x4EFB;&#x52A1;&#x961F;&#x5217;&#x91CC;&#x4E00;&#x76F4;&#x5FAA;&#x73AF;&#x53D6;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x4EFB;&#x52A1;,</span><br><span class="line">			//&#x6267;&#x884C;&#x5B8C;&#x4E00;&#x4E2A;runnable&#x4EFB;&#x52A1;&#x540E;&#x4F1A;&#x7F6E;&#x4E3A;&#x7A7A;&#x7B49;&#x5F85;GC&#x56DE;&#x6536;</span><br><span class="line">            while (task != null || (task = getTask()) != null) {</span><br><span class="line">                w.lock();</span><br><span class="line">                // If pool is stopping, ensure thread is interrupted;</span><br><span class="line">                // if not, ensure thread is not interrupted.  This</span><br><span class="line">                // requires a recheck in second case to deal with</span><br><span class="line">                // shutdownNow race while clearing interrupt</span><br><span class="line">                if ((runStateAtLeast(ctl.get(), STOP) ||</span><br><span class="line">                     (Thread.interrupted() &amp;&amp;</span><br><span class="line">                      runStateAtLeast(ctl.get(), STOP))) &amp;&amp;</span><br><span class="line">                    !wt.isInterrupted())</span><br><span class="line">                    wt.interrupt();</span><br><span class="line">                try {</span><br><span class="line">                    beforeExecute(wt, task);</span><br><span class="line">                    Throwable thrown = null;</span><br><span class="line">                    try {</span><br><span class="line">                        task.run();</span><br><span class="line">                    } catch (RuntimeException x) {</span><br><span class="line">                        thrown = x; throw x;</span><br><span class="line">                    } catch (Error x) {</span><br><span class="line">                        thrown = x; throw x;</span><br><span class="line">                    } catch (Throwable x) {</span><br><span class="line">                        thrown = x; throw new Error(x);</span><br><span class="line">                    } finally {</span><br><span class="line">                        afterExecute(task, thrown);</span><br><span class="line">                    }</span><br><span class="line">                } finally {</span><br><span class="line">                    task = null;</span><br><span class="line">                    w.completedTasks++;</span><br><span class="line">                    w.unlock();</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            completedAbruptly = false;</span><br><span class="line">        } finally {</span><br><span class="line">            processWorkerExit(w, completedAbruptly);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">	//&#x94FE;&#x8868;&#x53CD;&#x8F6C;</span><br><span class="line">    RunnableExecutorPair reversedList = null;</span><br><span class="line">    while (list != null) {</span><br><span class="line">      RunnableExecutorPair tmp = list;</span><br><span class="line">      list = list.next;</span><br><span class="line">      tmp.next = reversedList;</span><br><span class="line">      reversedList = tmp;</span><br><span class="line">    }</span><br><span class="line">	//&#x904D;&#x5386;&#x94FE;&#x8868;&#x4EA4;&#x7ED9;&#x7EBF;&#x7A0B;&#x6C60;&#x6267;&#x884C;</span><br><span class="line">    while (reversedList != null) {</span><br><span class="line">      executeListener(reversedList.runnable, reversedList.executor);</span><br><span class="line">      reversedList = reversedList.next;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  //&#x6DFB;&#x52A0;&#x5B8C;&#x6210;&#x540E;&#x5C1D;&#x8BD5;&#x628A;&#x8FD9;&#x4E2A;&#x4EFB;&#x52A1;&#x4E22;&#x4E2A;&#x7EBF;&#x7A0B;&#x6C60;&#x5904;&#x7406;</span><br><span class="line">  private static void executeListener(Runnable runnable, Executor executor) {</span><br><span class="line">    try {</span><br><span class="line">      executor.execute(runnable);</span><br><span class="line">    } catch (RuntimeException e) {</span><br><span class="line">      log.log(Level.SEVERE, &quot;RuntimeException while executing runnable &quot;</span><br><span class="line">          + runnable + &quot; with executor &quot; + executor, e);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">//&#x9759;&#x6001;&#x5185;&#x90E8;&#x7C7B;&#xFF0C;&#x5C01;&#x88C5;runnable&#x4EE5;&#x53CA;&#x5BF9;&#x5E94;&#x6267;&#x884C;runnbale&#x7684;&#x7EBF;&#x7A0B;&#x6C60;</span><br><span class="line">  private static final class RunnableExecutorPair {</span><br><span class="line">    final Runnable runnable;</span><br><span class="line">    final Executor executor;</span><br><span class="line">    @Nullable RunnableExecutorPair next;</span><br><span class="line">	//&#x57FA;&#x4E8E;&#x5934;&#x63D2;&#x6CD5;&#x6DFB;&#x52A0;</span><br><span class="line">    RunnableExecutorPair(Runnable runnable, Executor executor, RunnableExecutorPair next) {</span><br><span class="line">      this.runnable = runnable;</span><br><span class="line">      this.executor = executor;</span><br><span class="line">      this.next = next;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5728;&#x4E0A;&#x9762;&#x8FD9;&#x4E2A;ExecutionList&#x8FD9;&#x4E2A;&#x7C7B;&#x4E2D;&#x5148;add&#x65B9;&#x6CD5;&#x5224;&#x65AD;&#x8FD9;&#x4E2A;&#x6267;&#x884C;&#x94FE;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x5F00;&#x59CB;&#x6267;&#x884C;&#x4E86;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x5F00;&#x59CB;&#x6267;&#x884C;&#x4ED6;&#x4F1A;&#x5148;&#x6DFB;&#x52A0;&#x5230;&#x94FE;&#x8868;&#x5934;&#xFF0C;&#x7136;&#x540E;&#x8FD4;&#x56DE;&#xFF0C;&#x5982;&#x679C;&#x5DF2;&#x7ECF;&#x5F00;&#x59CB;&#x6267;&#x884C;&#x4E86;&#x5219;&#x8C03;&#x7528;executeListener&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x8BA9;&#x7EBF;&#x7A0B;&#x6C60;&#x6267;&#x884C;&#x3002;</p>
<h5 id="&#x90A3;&#x4E48;&#x8FD9;&#x4E9B;Future&#x7684;&#x76D1;&#x542C;&#x5668;&#x662F;&#x4F55;&#x65F6;&#x5F00;&#x59CB;&#x6267;&#x884C;&#x7684;&#xFF1F;"><a href="#&#x90A3;&#x4E48;&#x8FD9;&#x4E9B;Future&#x7684;&#x76D1;&#x542C;&#x5668;&#x662F;&#x4F55;&#x65F6;&#x5F00;&#x59CB;&#x6267;&#x884C;&#x7684;&#xFF1F;" class="headerlink" title="&#x90A3;&#x4E48;&#x8FD9;&#x4E9B;Future&#x7684;&#x76D1;&#x542C;&#x5668;&#x662F;&#x4F55;&#x65F6;&#x5F00;&#x59CB;&#x6267;&#x884C;&#x7684;&#xFF1F;"></a>&#x90A3;&#x4E48;&#x8FD9;&#x4E9B;Future&#x7684;&#x76D1;&#x542C;&#x5668;&#x662F;&#x4F55;&#x65F6;&#x5F00;&#x59CB;&#x6267;&#x884C;&#x7684;&#xFF1F;</h5><p>(&#x8FD9;&#x4E2A;&#x53EF;&#x4EE5;&#x53BB;&#x770B;&#x6211;&#x53E6;&#x5916;&#x4E00;&#x7BC7;&#x535A;&#x5BA2;FutureTask&#x6E90;&#x7801;&#x5206;&#x6790;&#xFF0C;&#x91CC;&#x9762;&#x4F1A;&#x63D0;&#x5230;<a href="https://dev.newban.cn/7035659125518237703/">:)</a></p>
<p>&#x8FD9;&#x4E2A;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x7ED9;future&#x8BBE;&#x7F6E;&#x7684;&#x76D1;&#x542C;&#x5668;&#x5904;&#x7406;&#xFF0C;&#x7136;&#x540E;&#x5185;&#x90E8;&#x6709;&#x4E00;&#x4E2A;&#x4FC3;&#x53D1;&#x56DE;&#x8C03;&#x673A;&#x5236;&#xFF0C;&#x4FC3;&#x53D1;&#x4E4B;&#x540E;&#x5C31;&#x6267;&#x884C;&#x76D1;&#x542C;&#x5668;&#x65B9;&#x6CD5;&#x4F1A;&#x56DE;&#x8C03;setOneValue&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x3002;<br>&#x4E0B;&#x9762;&#x770B;&#x770B;setOneValue&#x65B9;&#x6CD5;&#x662F;&#x662F;&#x600E;&#x4E48;&#x5904;&#x7406;&#x7684;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">scss&#x590D;&#x5236;&#x4EE3;&#x7801;   /**</span><br><span class="line">     * &#x6839;&#x636E;&#x6307;&#x5B9A;&#x7D22;&#x5F15;index&#xFF0C;&#x628A;future&#x7684;&#x7ED3;&#x679C;&#x8BBE;&#x7F6E;&#x8FDB;values&#x8FD9;&#x4E2A;&#x7ED3;&#x679C;&#x96C6;&#x3002;</span><br><span class="line">     */</span><br><span class="line">    private void setOneValue(int index, Future&lt;? extends V&gt; future) {</span><br><span class="line">      List&lt;Optional&lt;V&gt;&gt; localValues = values;</span><br><span class="line">      //&#x5982;&#x679C;&#x4EFB;&#x52A1;&#x5DF2;&#x7ECF;&#x5B8C;&#x6210;&#x6216;&#x8005;&#x7ED3;&#x679C;&#x96C6;&#x4E3A;&#x7A7A;&#xFF0C;&#x7136;&#x540E;&#x8FDB;&#x884C;&#x5224;&#x65AD;&#x662F;&#x5426;&#x662F;&#x9700;&#x8981;&#x6240;&#x6709;&#x7684;Future&#x6210;&#x529F;&#x624D;&#x5904;&#x7406;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x96C6;&#xFF0C;&#x5426;&#x5219;&#x8FD9;&#x4E2A;&#x4E00;&#x6BB5;&#x903B;&#x8F91;&#x4E0D;&#x53D7;&#x5F71;&#x54CD;</span><br><span class="line">      if (isDone() || localValues == null) {</span><br><span class="line">        // Some other future failed or has been cancelled, causing this one to</span><br><span class="line">        // also be cancelled or have an exception set. This should only happen</span><br><span class="line">        // if allMustSucceed is true or if the output itself has been</span><br><span class="line">        // cancelled.</span><br><span class="line">        checkState(allMustSucceed || isCancelled(),</span><br><span class="line">            &quot;Future was done before all dependencies completed&quot;);</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      try {</span><br><span class="line">		  //&#x5224;&#x65AD;&#x5F53;&#x524D;&#x4F20;&#x5165;&#x9700;&#x8981;&#x83B7;&#x53D6;&#x7ED3;&#x679C;&#x8FD9;&#x4E2A;future&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x5B8C;&#x6210;.</span><br><span class="line">        checkState(future.isDone(),</span><br><span class="line">            &quot;Tried to set value from future which is not done&quot;);</span><br><span class="line">			//&#x8C03;&#x7528;&#x4E0D;&#x53EF;&#x4E2D;&#x65AD;&#x65B9;&#x6CD5;&#x81EA;&#x65CB;&#x83B7;&#x53D6;future&#x7ED3;&#x679C;</span><br><span class="line">        V returnValue = getUninterruptibly(future);</span><br><span class="line">        if (localValues != null) {</span><br><span class="line">			//&#x7136;&#x540E;&#x5982;&#x679C;&#x7ED3;&#x679C;&#x5B58;&#x5728;&#x5219;&#x628A;&#x7ED3;&#x679C;&#x8BBE;&#x7F6E;&#x4E3A;&#x6307;&#x5B9A;&#x7D22;&#x5F15;&#x7684;&#x4F4D;&#x7F6E;</span><br><span class="line">          localValues.set(index, Optional.fromNullable(returnValue));</span><br><span class="line">        }</span><br><span class="line">      } catch (CancellationException e) {</span><br><span class="line">        if (allMustSucceed) {</span><br><span class="line">          // Set ourselves as cancelled. Let the input futures keep running</span><br><span class="line">          // as some of them may be used elsewhere.</span><br><span class="line">          cancel(false);</span><br><span class="line">        }</span><br><span class="line">      } catch (ExecutionException e) {</span><br><span class="line">        setExceptionAndMaybeLog(e.getCause());</span><br><span class="line">      } catch (Throwable t) {</span><br><span class="line">        setExceptionAndMaybeLog(t);</span><br><span class="line">      } finally {</span><br><span class="line">		 //&#x8BB0;&#x5F55;&#x5269;&#x4F59;&#x6CA1;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x7684;future&#x4E2A;&#x6570;</span><br><span class="line">        int newRemaining = remaining.decrementAndGet();</span><br><span class="line">        checkState(newRemaining &gt;= 0, &quot;Less than 0 remaining futures&quot;);</span><br><span class="line">		//&#x5982;&#x679C;&#x8FD9;&#x4E2A;&#x4E2A;&#x6570;&#x7B49;&#x4E8E;&#x96F6;&#x8BC1;&#x660E;&#x662F;&#x6700;&#x540E;&#x4E00;&#x4E2A;</span><br><span class="line">		//&#x5219;&#x901A;&#x8FC7;combiner&#x63A5;&#x53E3;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x6CD5;&#x53BB;&#x628A;&#x7ED3;&#x679C;&#x8054;&#x5408;&#x8D77;&#x6765;&#x5E76;&#x4E14;&#x8BBE;&#x7F6E;&#x5230;AbstractFuture&#x4E2D;&#x7684;value(&#x8FD9;&#x4E2A;value&#x5C31;&#x662F;get()&#x65B9;&#x6CD5;&#x83B7;&#x53D6;&#x7684;&#x7ED3;&#x679C;&#x96C6;)</span><br><span class="line">        if (newRemaining == 0) {</span><br><span class="line">          FutureCombiner&lt;V, C&gt; localCombiner = combiner;</span><br><span class="line">          if (localCombiner != null &amp;&amp; localValues != null) {</span><br><span class="line">			 //&#x8C03;&#x7528;AbstractFuture&#x7684;set&#x65B9;&#x6CD5;&#x628A; FutureCombine.combine&#x5904;&#x7406;&#x540E;&#x7684;&#x7ED3;&#x679C;&#x96C6;&#x8BBE;&#x7F6E;&#x5230;value&#x4E2D;.</span><br><span class="line">            set(localCombiner.combine(localValues));</span><br><span class="line">          } else {</span><br><span class="line">            checkState(isDone());</span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br></pre></td></tr></table></figure>

<p>&#x6BCF;&#x6B21;future&#x7684;&#x76D1;&#x542C;&#x5668;&#x6267;&#x884C;&#x540E;&#x4F1A;&#x6267;&#x884C;setOneValue&#x65B9;&#x6CD5;&#xFF0C;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4F1A;&#x5224;&#x65AD;&#x5F53;&#x524D;&#x8FD9;&#x4E2A;future&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x6267;&#x884C;&#x8FC7;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x5B8C;&#x6210;&#x4EFB;&#x52A1;&#x5219;&#x8C03;&#x7528;getUniterruptible&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4E0D;&#x53EF;&#x4E2D;&#x65AD;&#x7684;&#x81EA;&#x65CB;&#x8C03;&#x7528;future.get&#x65B9;&#x6CD5;&#x83B7;&#x53D6;&#x7ED3;&#x679C;<br>&#x7136;&#x540E;&#x5B58;&#x50A8;&#x5728;&#x4E34;&#x65F6;&#x7ED3;&#x679C;&#x96C6;&#x7684;value&#x4E2D;&#x3002;&#x7136;&#x540E;&#x5F53;&#x6267;&#x884C;&#x5230;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x662F;&#x4F1A;&#x901A;&#x8FC7;set&#x65B9;&#x6CD5;&#x628A;&#x6574;&#x4E2A;&#x805A;&#x4F1A;&#x540E;&#x7684;&#x7ED3;&#x679C;&#x96C6;&#x8D4B;&#x503C;&#x5230;futureTask &#x7684;value&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;//Uninterruptibles&#x7C7B;&#x4E2D;&#x7684;getUniterruptible &#x4E0D;&#x95F4;&#x65AD;&#x7684;&#x8C03;&#x7528;get&#x65B9;&#x6CD5; &#x5176;&#x5B9E;&#x5C31;&#x662F;&#x7C7B;&#x4F3C;&#x4E8E;Future&#x4E2D;get&#x65B9;&#x6CD5;&#x83B7;&#x53D6;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x7684;&#x7ED3;&#x679C;&#xFF0C;</span><br><span class="line">//&#x800C;&#x4E14;&#x662F;&#x4E0D;&#x53EF;&#x88AB;&#x4E2D;&#x65AD;&#x7684;&#xFF0C;&#x4E2D;&#x65AD;&#x4E4B;&#x540E;&#x91CD;&#x65B0;&#x8BBE;&#x7F6E;&#x53EF;&#x4E2D;&#x65AD;&#x6807;&#x8BB0;&#x4E3A;TRUE</span><br><span class="line">  public static &lt;V&gt; V getUninterruptibly(Future&lt;V&gt; future)</span><br><span class="line">      throws ExecutionException {</span><br><span class="line">    boolean interrupted = false;</span><br><span class="line">    try {</span><br><span class="line">		//&#x81EA;&#x65CB;&#x662F;&#x4E3A;&#x4E86;&#x5982;&#x679C;&#x88AB;&#x4E2D;&#x65AD;&#xFF0C;&#x91CD;&#x65B0;&#x8BBE;&#x7F6E;&#x4E2D;&#x65AD;&#x6807;&#x8BB0;&#x540E;&#x91CD;&#x65B0;&#x6267;&#x884C;get&#xFF0C;&#x4ECE;&#x800C;&#x8FBE;&#x5230;&#x4E0D;&#x53EF;&#x4E2D;&#x65AD;&#x7684;&#x6548;&#x679C;</span><br><span class="line">      while (true) {</span><br><span class="line">        try {</span><br><span class="line">          return future.get();</span><br><span class="line">        } catch (InterruptedException e) {</span><br><span class="line">          interrupted = true;</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    } finally {</span><br><span class="line">		//&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x4E4B;&#x540E;&#x624D;&#x628A;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x4E2D;&#x65AD;</span><br><span class="line">      if (interrupted) {</span><br><span class="line">        Thread.currentThread().interrupt();</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  </span><br><span class="line">  //AbstractFuture&#x62BD;&#x8C61;&#x7C7B;&#x4E2D;set&#x65B9;&#x6CD5;&#x8C03;&#x7528;aqs&#x5B50;&#x7C7B;syn.set&#x8BBE;&#x7F6E;&#x7ED3;&#x679C;&#x96C6;&#xFF0C;&#x7136;&#x540E;&#x5F00;&#x59CB;&#x8C03;&#x7528;&#x6267;&#x884C;&#x76D1;&#x542C;&#x5668;&#x6267;&#x884C;&#x94FE;</span><br><span class="line">    protected boolean set(@Nullable V value) {</span><br><span class="line">	//&#x8C03;&#x7528;&#x5185;&#x90E8;aqs&#x5B50;&#x7C7B;&#x7684;sync&#x901A;&#x8FC7;cas&#x8BBE;&#x7F6E;AbstractFutre&#x7684;&#x7ED3;&#x679C;</span><br><span class="line">    boolean result = sync.set(value);</span><br><span class="line">	//&#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x6210;&#x529F;&#x5219;&#x5224;&#x65AD;&#x8BBE;&#x7F6E;&#x6210;&#x529F;&#xFF0C;&#x5982;&#x679C;&#x6210;&#x529F;&#x5219;&#x8BC1;&#x660E;listenablefuture&#x4EFB;&#x52A1;&#x96C6;&#x6267;&#x884C;&#x5B8C;&#x6210;&#xFF0C;&#x5F00;&#x59CB;&#x6267;&#x884C;&#x76D1;&#x542C;&#x5668;&#x6267;&#x884C;&#x94FE;</span><br><span class="line">    if (result) {</span><br><span class="line">      executionList.execute();</span><br><span class="line">    }</span><br><span class="line">    return result;</span><br><span class="line">  }</span><br></pre></td></tr></table></figure>

<p>&#x603B;&#x7ED3;&#xFF1A;successFulList&#x662F;&#x5982;&#x4F55;&#x5408;&#x5E76;&#x591A;&#x4E2A;Future&#x7ED3;&#x679C;&#x7684;&#xFF1A;successFulAsList&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x6838;&#x5FC3;&#x539F;&#x7406;&#xFF1A; &#x5229;&#x7528;ListenableFuture &#x8FD9;&#x4E2A;&#x63A5;&#x53E3;&#x7684;&#x76D1;&#x542C;&#x5668;&#x65B9;&#x6CD5;&#x7136;&#x540E; &#x6BCF;&#x4E2A;&#x8FD9;&#x4E2A;&#x63A5;&#x53E3;&#x7684;&#x5B9E;&#x73B0;&#x7C7B;&#x90FD;&#x4F1A;&#x6709;&#x6709;&#x4E00;&#x4E2A;ExecutionList&#x7C7B;&#x7684;&#x6210;&#x5458;&#x53D8;&#x91CF;&#xFF0C;&#x7136;&#x540E;&#x8FD9;&#x4E2A;ExecutionList&#x5185;&#x90E8;&#x4E00;&#x4E2A;&#x5C01;&#x88C5;&#x7740;Runnable&#x4EE5;&#x53CA;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x5355;&#x94FE;&#x8868;&#xFF0C;&#x9664;&#x6B64;&#x4E4B;&#x5916;&#x8FD9;&#x4E2A;ExecutionList&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x53D8;&#x91CF;executed&#xFF0C;&#x8FD9;&#x4E2A;&#x53D8;&#x91CF;&#x662F;&#x7528;&#x6765;&#x63A7;&#x5236;&#x5BF9;&#x4E8E;ListenableFuture&#x76F8;&#x5173;&#x5B9E;&#x73B0;&#x7C7B;&#x65B0;&#x589E;&#x76D1;&#x542C;&#x5668;&#x65F6;&#xFF0C;&#x662F;&#x5426;&#x7ACB;&#x523B;&#x6267;&#x884C;&#x8FD8;&#x662F;&#x6DFB;&#x52A0;&#x5728;&#x94FE;&#x8868;&#x91CC;&#x9762;&#xFF0C;&#x53E6;&#x5916;&#x5F53;ListenableFuture&#x8FD9;&#x4E2A;&#x7C7B;&#x7684;&#x5B50;&#x4EFB;&#x52A1;&#x7C7B;&#xFF0C;&#x5F53;&#x4EFB;&#x52A1;&#x7684;future&#x7C7B;&#x5B8C;&#x6210;&#x65F6;&#x5C31;&#x4F1A;&#x4FC3;&#x53D1;&#x8C03;&#x7528;ExecutionList&#x8FD9;&#x4E2A;&#x7C7B;&#x7684;execute&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x6267;&#x884C;&#x6BCF;&#x4E2A;future&#x7684;&#x76D1;&#x542C;&#x5668;&#xFF0C;&#x5728;SuccessFulList&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4E2D;&#x901A;&#x8FC7;&#x521B;&#x5EFA;CombinedFuture&#x7C7B;&#x53BB;&#x7ED9;&#x5404;&#x4E2A;&#x4EFB;&#x52A1;&#x7684;future&#x6DFB;&#x52A0;&#x76D1;&#x542C;&#x5668;&#x53BB;&#x8C03;&#x7528;setOneValue&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x7136;&#x540E;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x53BB;&#x83B7;&#x53D6;future&#x7ED3;&#x679C;.&#x5F53;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;Future&#x7ED3;&#x679C;&#x83B7;&#x53D6;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x5C31;&#x628A;&#x7ED3;&#x679C;&#x8BBE;&#x7F6E;&#x5230;&#x9876;&#x5C42;&#x7684;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/3857439a02c0c86cd7c895cd9eb1efc7.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7035662338292187150.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7035662338292187150.html" itemprop="url">JDK8-Lambda表达式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-11-29T00:51:32+08:00">
                2021-11-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x8FD9;&#x662F;&#x6211;&#x53C2;&#x4E0E;11&#x6708;&#x66F4;&#x6587;&#x6311;&#x6218;&#x7684;&#x7B2C;19&#x5929;&#xFF0C;&#x6D3B;&#x52A8;&#x8BE6;&#x60C5;&#x67E5;&#x770B;&#xFF1A;<a href="https://dev.newban.cn/7023643374569816095/">2021&#x6700;&#x540E;&#x4E00;&#x6B21;&#x66F4;&#x6587;&#x6311;&#x6218;</a></p>
<blockquote>
<p>&#x6B22;&#x8FCE;&#x5173;&#x6CE8;&#x516C;&#x4F17;&#x53F7;OpenCoder&#xFF0C;&#x6765;&#x548C;&#x6211;&#x505A;&#x670B;&#x53CB;&#x5427;~&#x2764;&#x1F618;&#x1F601;&#x1F431;&#x200D;&#x1F409;&#x1F440;</p>
</blockquote>
<h2 id="Lambda&#x8868;&#x8FBE;&#x5F0F;"><a href="#Lambda&#x8868;&#x8FBE;&#x5F0F;" class="headerlink" title="Lambda&#x8868;&#x8FBE;&#x5F0F;"></a>Lambda&#x8868;&#x8FBE;&#x5F0F;</h2><h3 id="&#x6982;&#x8FF0;"><a href="#&#x6982;&#x8FF0;" class="headerlink" title="&#x6982;&#x8FF0;"></a>&#x6982;&#x8FF0;</h3><h4 id="&#x5B98;&#x7F51;&#x5BF9;lambda&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x63CF;&#x8FF0;"><a href="#&#x5B98;&#x7F51;&#x5BF9;lambda&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x63CF;&#x8FF0;" class="headerlink" title="&#x5B98;&#x7F51;&#x5BF9;lambda&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x63CF;&#x8FF0;"></a>&#x5B98;&#x7F51;&#x5BF9;lambda&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x63CF;&#x8FF0;</h4><blockquote>
<p>&#x5B98;&#x7F51;&#xFF1A;<a href="/external_links/3db111f301f4882df7fb9e7f780ca0e8.html" target="blank" rel="noopener">docs.oracle.com/javase/tuto&#x2026;</a></p>
</blockquote>
<p>&#x200B; One issue with anonymous classes is that if the implementation of your anonymous class is very simple, such as an interface that contains only one method, then the syntax of anonymous classes may seem unwieldy and unclear. In these cases, you&#x2019;re usually trying to pass functionality as an argument to another method, such as what action should be taken when someone clicks a button. Lambda expressions enable you to do this, to treat functionality as method argument, or code as data.</p>
<p>&#x200B; &#x533F;&#x540D;&#x7C7B;&#x7684;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x533F;&#x540D;&#x7C7B;&#x7684;&#x5B9E;&#x73B0;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x4F8B;&#x5982;&#x53EA;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#x7684;&#x63A5;&#x53E3;&#xFF0C;&#x90A3;&#x4E48;&#x533F;&#x540D;&#x7C7B;&#x7684;&#x8BED;&#x6CD5;&#x53EF;&#x80FD;&#x4F1A;&#x663E;&#x5F97;&#x7B28;&#x62D9;&#x548C;&#x4E0D;&#x6E05;&#x695A;&#x3002;&#x5728;&#x8FD9;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x60A8;&#x901A;&#x5E38;&#x4F1A;&#x5C1D;&#x8BD5;&#x5C06;&#x529F;&#x80FD;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x4F20;&#x9012;&#x7ED9;&#x53E6;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x4F8B;&#x5982;&#x5F53;&#x6709;&#x4EBA;&#x5355;&#x51FB;&#x6309;&#x94AE;&#x65F6;&#x5E94;&#x8BE5;&#x91C7;&#x53D6;&#x4EC0;&#x4E48;&#x64CD;&#x4F5C;&#x3002; Lambda &#x8868;&#x8FBE;&#x5F0F;&#x4F7F;&#x60A8;&#x80FD;&#x591F;&#x505A;&#x5230;&#x8FD9;&#x4E00;&#x70B9;&#xFF0C;&#x5C06;&#x529F;&#x80FD;&#x89C6;&#x4E3A;&#x65B9;&#x6CD5;&#x53C2;&#x6570;&#xFF0C;&#x6216;&#x5C06;&#x4EE3;&#x7801;&#x89C6;&#x4E3A;&#x6570;&#x636E;&#x3002;</p>
<blockquote>
<p>&#x63CF;&#x8FF0;&#x4E2D;&#x5305;&#x542B;&#x4E86;&#x4E09;&#x5C42;&#x542B;&#x4E49;</p>
</blockquote>
<ul>
<li>lambda&#x8868;&#x8FBE;&#x5F0F;&#x662F;&#x5BF9;&#x533F;&#x540D;&#x7C7B;&#x7684;&#x7B80;&#x5316;</li>
<li>lambda&#x4F7F;&#x7528;&#x7684;&#x524D;&#x63D0;<ul>
<li>&#x4E00;&#x4E2A;&#x63A5;&#x53E3;</li>
<li>&#x63A5;&#x53E3;&#x4E2D;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;</li>
</ul>
</li>
<li>lambda&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x7406;&#x89E3;&#xFF1A;&#x5C06;&#x529F;&#x80FD;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x4F20;&#x9012;&#x7ED9;&#x53E6;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;</li>
</ul>
<h4 id="&#x793A;&#x4F8B;&#x4EE3;&#x7801;"><a href="#&#x793A;&#x4F8B;&#x4EE3;&#x7801;" class="headerlink" title="&#x793A;&#x4F8B;&#x4EE3;&#x7801;"></a>&#x793A;&#x4F8B;&#x4EE3;&#x7801;</h4><ul>
<li>&#x521B;&#x5EFA;&#x5E76;&#x5F00;&#x542F;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#xFF0C;&#x4F7F;&#x7528;&#x533F;&#x540D;&#x5185;&#x90E8;&#x7C7B;&#x7684;&#x65B9;&#x5F0F;&#x5B9E;&#x73B0;Runnable&#xFF0C;&#x91CD;&#x5199;run&#x65B9;&#x6CD5;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;public static void main(String[] args) {</span><br><span class="line">    new Thread(new Runnable() { // &#x533F;&#x540D;&#x5185;&#x90E8;&#x7C7B;</span><br><span class="line">        @Override</span><br><span class="line">        public void run() {</span><br><span class="line">            System.out.println(&quot;&#x6211;&#x662F;&#x7EBF;&#x7A0B;&#x5F00;&#x542F;&#x6267;&#x884C;&#x7684;&#x4EE3;&#x7801;&quot;);</span><br><span class="line">        }</span><br><span class="line">    }).start();</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<ul>
<li>Runnable&#x63A5;&#x53E3;&#x4E2D;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x62BD;&#x8C61;&#x65B9;&#x6CD5;run&#x3002;&#x7528;lambda&#x8868;&#x8FBE;&#x5F0F;&#x6539;&#x5199;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;// @FunctionalInterface</span><br><span class="line">// public interface Runnable {</span><br><span class="line">//    public abstract void run();</span><br><span class="line">// }</span><br><span class="line">public static void main(String[] args) {</span><br><span class="line">    new Thread(() -&gt; System.out.println(&quot;&#x6211;&#x662F;&#x7EBF;&#x7A0B;&#x5F00;&#x542F;&#x6267;&#x884C;&#x7684;&#x4EE3;&#x7801;&quot;)).start();</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<ul>
<li>&#x8BF4;&#x660E;</li>
</ul>
<p><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/0010c25780eb2cfde1d3e7ac6e2c5f2546fd45a6d6deb1860b46cd8846738cfd" alt="image-20211122211356351"></p>
<h3 id="&#x8BED;&#x6CD5;"><a href="#&#x8BED;&#x6CD5;" class="headerlink" title="&#x8BED;&#x6CD5;"></a>&#x8BED;&#x6CD5;</h3><h4 id="&#x57FA;&#x672C;&#x8BED;&#x6CD5;"><a href="#&#x57FA;&#x672C;&#x8BED;&#x6CD5;" class="headerlink" title="&#x57FA;&#x672C;&#x8BED;&#x6CD5;"></a>&#x57FA;&#x672C;&#x8BED;&#x6CD5;</h4><blockquote>
<p>&#x4ECE;&#x4E0A;&#x8FF0;&#x6848;&#x4F8B;&#x4E2D;&#xFF0C;&#x4F7F;&#x7528;lambda&#x8868;&#x8FBE;&#x5F0F;&#x662F;&#x5BF9;Runnable&#x63A5;&#x53E3;&#x4E2D;&#x7684;run&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x4E86;&#x91CD;&#x5199;</p>
<p>&#x683C;&#x5F0F;&#xFF1A;(&#x62BD;&#x8C61;&#x65B9;&#x6CD5;&#x7684;&#x53C2;&#x6570;&#x5217;&#x8868;) -&gt; {&#x91CD;&#x5199;&#x7684;&#x4EE3;&#x7801;}</p>
</blockquote>
<h4 id="&#x793A;&#x4F8B;&#x4EE3;&#x7801;-1"><a href="#&#x793A;&#x4F8B;&#x4EE3;&#x7801;-1" class="headerlink" title="&#x793A;&#x4F8B;&#x4EE3;&#x7801;"></a>&#x793A;&#x4F8B;&#x4EE3;&#x7801;</h4><blockquote>
<p>&#x5220;&#x9664;&#x96C6;&#x5408;&#x4E2D;&#x5927;&#x4E8E;3&#x7684;&#x5143;&#x7D20;</p>
</blockquote>
<ul>
<li>&#x533F;&#x540D;&#x5185;&#x90E8;&#x7C7B;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;List&lt;Integer&gt; list = new ArrayList&lt;&gt;(Arrays.asList(1,2,3,4,5));</span><br><span class="line">list.removeIf(new Predicate&lt;Integer&gt;() {</span><br><span class="line">    @Override</span><br><span class="line">    public boolean test(Integer i) {</span><br><span class="line">        return i &gt; 3;</span><br><span class="line">    }</span><br><span class="line">});</span><br><span class="line">System.out.println(list); // [1, 2, 3]</span><br></pre></td></tr></table></figure>

<ul>
<li>lambda&#x8868;&#x8FBE;&#x5F0F;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;List&lt;Integer&gt; list = new ArrayList&lt;&gt;(Arrays.asList(1,2,3,4,5));</span><br><span class="line">list.removeIf((Integer i) -&gt; {return i &gt; 3;});</span><br><span class="line">System.out.println(list); // [1, 2, 3]</span><br></pre></td></tr></table></figure>

<ul>
<li>&#x8BF4;&#x660E;</li>
</ul>
<p><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/e0ab49b111dcb2d90a6740064fe389ae05d44cd7772aee372ad9a25b88ad4dd7" alt="image-20211122215836842"></p>
<h4 id="&#x7B80;&#x5199;&#x8BED;&#x6CD5;"><a href="#&#x7B80;&#x5199;&#x8BED;&#x6CD5;" class="headerlink" title="&#x7B80;&#x5199;&#x8BED;&#x6CD5;"></a>&#x7B80;&#x5199;&#x8BED;&#x6CD5;</h4><blockquote>
<p>&#x53C2;&#x6570;&#x7684;&#x7B80;&#x5199;</p>
<ul>
<li>&#x62BD;&#x8C61;&#x65B9;&#x6CD5;&#x53C2;&#x6570;&#x7684;&#x4E2A;&#x6570;<ul>
<li>&#x7A7A;&#x53C2;&#xFF1A;&#x4E0D;&#x7701;&#x7565;&#x3002;</li>
<li>&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#xFF1A;&#x7701;&#x7565;&#x5C0F;&#x62EC;&#x53F7;&#xFF0C;&#x7701;&#x7565;&#x53C2;&#x6570;&#x7C7B;&#x578B;&#x3002;<ul>
<li>&#x7701;&#x7565;&#x524D;&#xFF1A;(Integer i) -&gt; {}</li>
<li>&#x7701;&#x7565;&#x540E;&#xFF1A;i -&gt; {}</li>
</ul>
</li>
<li>&#x591A;&#x4E2A;&#x53C2;&#x6570;&#xFF1A;&#x7701;&#x7565;&#x53C2;&#x6570;&#x7C7B;&#x578B;&#x3002;<ul>
<li>&#x7701;&#x7565;&#x524D;&#xFF1A;(String a, Integer b) -&gt; {}</li>
<li>&#x7701;&#x7565;&#x540E;&#xFF1A; (a,b) -&gt; {}</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>&#x65B9;&#x6CD5;&#x4F53;&#x7684;&#x7B80;&#x5199;</p>
<ul>
<li>&#x65B9;&#x6CD5;&#x4F53;&#x4E2D;&#x53EA;&#x6709;&#x4E00;&#x884C;&#x8868;&#x8FBE;&#x5F0F;&#xFF1A;&#x7701;&#x7565;&#x5927;&#x62EC;&#x53F7;&#x3001;return&#x3001;&#x5206;&#x53F7;&#x3002;<ul>
<li>&#x7701;&#x7565;&#x524D;&#xFF1A;(Integer i) -&gt; {return i &gt; 3;}</li>
<li>&#x7701;&#x7565;&#x540E;&#xFF1A;i -&gt; i &gt; 3</li>
</ul>
</li>
</ul>
</blockquote>
<h4 id="&#x793A;&#x4F8B;&#x4EE3;&#x7801;-2"><a href="#&#x793A;&#x4F8B;&#x4EE3;&#x7801;-2" class="headerlink" title="&#x793A;&#x4F8B;&#x4EE3;&#x7801;"></a>&#x793A;&#x4F8B;&#x4EE3;&#x7801;</h4><ul>
<li>lambda&#x8868;&#x8FBE;&#x5F0F;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;List&lt;Integer&gt; list = new ArrayList&lt;&gt;(Arrays.asList(1,2,3,4,5));</span><br><span class="line">list.removeIf((Integer i) -&gt; {return i &gt; 3;});</span><br><span class="line">System.out.println(list); // [1, 2, 3]</span><br></pre></td></tr></table></figure>

<ul>
<li>&#x7B80;&#x5199;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;List&lt;Integer&gt; list = new ArrayList&lt;&gt;(Arrays.asList(1,2,3,4,5));</span><br><span class="line">list.removeIf(i -&gt; i &gt; 3);</span><br><span class="line">System.out.println(list); // [1, 2, 3]</span><br></pre></td></tr></table></figure>

<h3 id="&#x51FD;&#x6570;&#x5F0F;&#x63A5;&#x53E3;"><a href="#&#x51FD;&#x6570;&#x5F0F;&#x63A5;&#x53E3;" class="headerlink" title="&#x51FD;&#x6570;&#x5F0F;&#x63A5;&#x53E3;"></a>&#x51FD;&#x6570;&#x5F0F;&#x63A5;&#x53E3;</h3><h4 id="&#x6982;&#x8FF0;-1"><a href="#&#x6982;&#x8FF0;-1" class="headerlink" title="&#x6982;&#x8FF0;"></a>&#x6982;&#x8FF0;</h4><blockquote>
<p>&#x51FD;&#x6570;&#x5F0F;&#x63A5;&#x53E3;&#xFF1A;&#x6709;&#x4E00;&#x4E2A;&#x62BD;&#x8C61;&#x65B9;&#x6CD5;&#x7684;&#x63A5;&#x53E3;</p>
<p>jdk&#x4E3A;&#x51FD;&#x6570;&#x5F0F;&#x63A5;&#x53E3;&#x63D0;&#x4F9B;&#x4E86;&#x6CE8;&#x89E3;&#xFF1A;@FunctionalInterface&#x3002;</p>
<p>&#x6CE8;&#x89E3;&#x4F5C;&#x7528;&#x5728;&#x63A5;&#x53E3;&#x4E0A;&#xFF0C;&#x7528;&#x4E8E;&#x6821;&#x9A8C;&#x8BE5;&#x63A5;&#x53E3;&#x662F;&#x5426;&#x4E3A;&#x51FD;&#x6570;&#x5F0F;&#x63A5;&#x53E3;</p>
</blockquote>
<h4 id="&#x793A;&#x4F8B;"><a href="#&#x793A;&#x4F8B;" class="headerlink" title="&#x793A;&#x4F8B;"></a>&#x793A;&#x4F8B;</h4><ul>
<li>Inter&#x63A5;&#x53E3;&#x4E2D;&#x5305;&#x542B;&#x4E24;&#x4E2A;&#x62BD;&#x8C61;&#x65B9;&#x6CD5;</li>
</ul>
<p><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/b6b8ba8c7b7a8631f8e94a3280198041cb8cffa961d2cbf86f35e08447795494" alt="image-20211122221857068"></p>
<h4 id="JDK-8-&#x4E2D;&#x65B0;&#x589E;&#x7684;&#x51FD;&#x6570;&#x5F0F;&#x63A5;&#x53E3;"><a href="#JDK-8-&#x4E2D;&#x65B0;&#x589E;&#x7684;&#x51FD;&#x6570;&#x5F0F;&#x63A5;&#x53E3;" class="headerlink" title="JDK 8 &#x4E2D;&#x65B0;&#x589E;&#x7684;&#x51FD;&#x6570;&#x5F0F;&#x63A5;&#x53E3;"></a>JDK 8 &#x4E2D;&#x65B0;&#x589E;&#x7684;&#x51FD;&#x6570;&#x5F0F;&#x63A5;&#x53E3;</h4><blockquote>
<p>&#x5728;java.util.function&#x5305;&#x4E2D;&#x65B0;&#x589E;&#x591A;&#x4E2A;&#x51FD;&#x6570;&#x5F0F;&#x63A5;&#x53E3;</p>
<p>&#x4F8B;&#x5982;&#xFF1A;Predicate&#x3001;Supplier&#x3001;Function&#x3001;Consumer</p>
</blockquote>
<h3 id="&#x539F;&#x7406;"><a href="#&#x539F;&#x7406;" class="headerlink" title="&#x539F;&#x7406;"></a>&#x539F;&#x7406;</h3><h4 id="debug&#x8C03;&#x8BD5;"><a href="#debug&#x8C03;&#x8BD5;" class="headerlink" title="debug&#x8C03;&#x8BD5;"></a>debug&#x8C03;&#x8BD5;</h4><ul>
<li>Demo.java</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;public class Demo {</span><br><span class="line">    public static void main(String[] args) {</span><br><span class="line">        new Thread(() -&gt; {</span><br><span class="line">            System.out.println(&quot;&#x6211;&#x662F;&#x7EBF;&#x7A0B;&#x542F;&#x52A8;&#x540E;&#x6267;&#x884C;&#x7684;&#x4EE3;&#x7801;&quot;);</span><br><span class="line">        }).start();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<ul>
<li>debug&#x8FD0;&#x884C;</li>
</ul>
<p><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/c26374daa6cbe95275741d100b5703e3375c5f5ec7eb016f47b2d71d0b3c2a97" alt="image-20211123000547877"></p>
<ul>
<li>&#x8BF4;&#x660E;</li>
</ul>
<pre><code>+ run:748,Thread(java.lang)&#xFF1A;&#x8C03;&#x7528;Thread&#x4E2D;&#x7684;run&#x65B9;&#x6CD5;
+ run:-1,1156060786(`org.example.Demo$$Lambda$1`)&#xFF1A;&#x8C03;&#x7528;`Demo$$Lambda$1`&#x4E2D;&#x7684;run&#x65B9;&#x6CD5;
+ `lambda$main$0:10`&#xFF0C;Demo(org.example)&#xFF1A; &#x65B9;&#x6CD5;`lambda$main$0`&#x4E2D;&#x6267;&#x884C;&#x4E86; &#x6253;&#x5370;&#x8BED;&#x53E5;</code></pre><ul>
<li>&#x5C0F;&#x7ED3;</li>
</ul>
<pre><code>+ `Demo$$Lambda$1`&#x8FD9;&#x4E2A;&#x7C7B;&#x4E2D;&#x7684;run&#x65B9;&#x6CD5; &#x8C03;&#x7528; -----&gt; `lambda$main$0`&#x65B9;&#x6CD5; -------&gt; &#x6267;&#x884C; lambda&#x8868;&#x8FBE;&#x5F0F;&#x4EE3;&#x7801;&#x5757;&#x7684;&#x4EE3;&#x7801;&#xFF08;&#x6253;&#x5370;&#x8BED;&#x53E5;&#xFF09;</code></pre><h4 id="&#x4FDD;&#x7559;lambda&#x8BED;&#x53E5;&#x4EA7;&#x751F;&#x7684;&#x5B57;&#x8282;&#x7801;&#x6587;&#x4EF6;"><a href="#&#x4FDD;&#x7559;lambda&#x8BED;&#x53E5;&#x4EA7;&#x751F;&#x7684;&#x5B57;&#x8282;&#x7801;&#x6587;&#x4EF6;" class="headerlink" title="&#x4FDD;&#x7559;lambda&#x8BED;&#x53E5;&#x4EA7;&#x751F;&#x7684;&#x5B57;&#x8282;&#x7801;&#x6587;&#x4EF6;"></a>&#x4FDD;&#x7559;lambda&#x8BED;&#x53E5;&#x4EA7;&#x751F;&#x7684;&#x5B57;&#x8282;&#x7801;&#x6587;&#x4EF6;</h4><ul>
<li>java&#x547D;&#x4EE4;+&#x53C2;&#x6570;&#x3002;&#x5728;&#x786C;&#x76D8;&#x4E2D;&#x4EA7;&#x751F;&#x4E00;&#x4E2A;&#x65B0;&#x7684;class&#x6587;&#x4EF6;&#xFF08;Demo$$Lambda$1.class&#xFF09;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&#x590D;&#x5236;&#x4EE3;&#x7801;java -Djdk.internal.lambda.dumpProxyClasses Demo.class</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/6d2597a5369a9e05c58853322936ed44b436682a269ef03cc7a52abb8d246885" alt="image-20211123001203190"></p>
<ul>
<li>&#x5C06;&#x8BE5;&#x6587;&#x4EF6;&#x62D6;&#x5165;&#x7684;idea&#x4E2D;</li>
</ul>
<pre><code>+ `Demo$$Lambda$1`&#x662F;Runnable&#x7684;&#x5B9E;&#x73B0;&#x7C7B;
+ run&#x65B9;&#x6CD5;&#x4E2D;&#x8C03;&#x7528;`Demo.lambda$main$0()`&#x65B9;&#x6CD5;![image-20211123001344875](https://gitee.com/songjianzaina/juejin_p6/raw/master/img/ff9a719fe2fd3db0c2131a34232b3bc2cc204513d24e047dc8d3bc66f4744023)</code></pre><h4 id="&#x539F;&#x7406;&#x7406;&#x89E3;"><a href="#&#x539F;&#x7406;&#x7406;&#x89E3;" class="headerlink" title="&#x539F;&#x7406;&#x7406;&#x89E3;"></a>&#x539F;&#x7406;&#x7406;&#x89E3;</h4><p><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/1d6e52914a2832538aaf538ca39adf8cb4e3373f72cda2ca871e4c3ec6fccf0e" alt="image-20211123002803105"></p>
<h2 id="&#x65B9;&#x6CD5;&#x5F15;&#x7528;-Method-references"><a href="#&#x65B9;&#x6CD5;&#x5F15;&#x7528;-Method-references" class="headerlink" title="&#x65B9;&#x6CD5;&#x5F15;&#x7528;(Method references)"></a>&#x65B9;&#x6CD5;&#x5F15;&#x7528;(Method references)</h2><h3 id="&#x6982;&#x8FF0;-2"><a href="#&#x6982;&#x8FF0;-2" class="headerlink" title="&#x6982;&#x8FF0;"></a>&#x6982;&#x8FF0;</h3><h4 id="&#x5B98;&#x7F51;&#x5BF9;&#x65B9;&#x6CD5;&#x5F15;&#x7528;&#x7684;&#x63CF;&#x8FF0;"><a href="#&#x5B98;&#x7F51;&#x5BF9;&#x65B9;&#x6CD5;&#x5F15;&#x7528;&#x7684;&#x63CF;&#x8FF0;" class="headerlink" title="&#x5B98;&#x7F51;&#x5BF9;&#x65B9;&#x6CD5;&#x5F15;&#x7528;&#x7684;&#x63CF;&#x8FF0;"></a>&#x5B98;&#x7F51;&#x5BF9;&#x65B9;&#x6CD5;&#x5F15;&#x7528;&#x7684;&#x63CF;&#x8FF0;</h4><blockquote>
<p>&#x5B98;&#x7F51;&#xFF1A;<a href="/external_links/7690d19612639a92dc801f422874dd82.html" target="blank" rel="noopener">docs.oracle.com/javase/tuto&#x2026;</a></p>
</blockquote>
<p>&#x200B; You use lambda expressions to create anonymous methods. Sometimes, however, a lambda expression does nothing but call an existing method. In those cases, it&#x2019;s often clearer to refer to the existing method by name. Method references enable you to do this; they are compact, easy-to-read lambda expressions for methods that already have a name.</p>
<p>&#x200B; &#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; lambda &#x8868;&#x8FBE;&#x5F0F;&#x6765;&#x521B;&#x5EFA;&#x533F;&#x540D;&#x65B9;&#x6CD5;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x6709;&#x65F6; lambda &#x8868;&#x8FBE;&#x5F0F;&#x9664;&#x4E86;&#x8C03;&#x7528;&#x73B0;&#x6709;&#x65B9;&#x6CD5;&#x4E4B;&#x5916;&#x4EC0;&#x4E48;&#x90FD;&#x4E0D;&#x505A;&#x3002;&#x5728;&#x8FD9;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6309;&#x540D;&#x79F0;&#x5F15;&#x7528;&#x73B0;&#x6709;&#x65B9;&#x6CD5;&#x901A;&#x5E38;&#x4F1A;&#x66F4;&#x6E05;&#x695A;&#x3002;&#x65B9;&#x6CD5;&#x5F15;&#x7528;&#x4F7F;&#x60A8;&#x80FD;&#x591F;&#x505A;&#x5230;&#x8FD9;&#x4E00;&#x70B9;&#xFF1B;&#x5B83;&#x4EEC;&#x662F;&#x7528;&#x4E8E;&#x5DF2;&#x5177;&#x6709;&#x540D;&#x79F0;&#x7684;&#x65B9;&#x6CD5;&#x7684;&#x7D27;&#x51D1;&#x3001;&#x6613;&#x4E8E;&#x9605;&#x8BFB;&#x7684; lambda &#x8868;&#x8FBE;&#x5F0F;&#x3002;</p>
<blockquote>
<p>&#x63CF;&#x8FF0;&#x4E2D;&#x5305;&#x542B;&#x4E24;&#x5C42;&#x542B;&#x4E49;</p>
<ul>
<li>&#x65B9;&#x6CD5;&#x5F15;&#x7528;&#xFF0C;&#x7528;&#x4E8E;labmda&#x8868;&#x8FBE;&#x5F0F;&#x4E2D;</li>
<li>&#x524D;&#x63D0;&#xFF1A;lambda &#x8868;&#x8FBE;&#x5F0F;&#x9664;&#x4E86;&#x8C03;&#x7528;&#x73B0;&#x6709;&#x65B9;&#x6CD5;&#x4E4B;&#x5916;&#x4EC0;&#x4E48;&#x90FD;&#x4E0D;&#x505A;&#x3002;&#xFF08;&#x4E0B;&#x4E00;&#x8282;&#x8BED;&#x6CD5;&#x4E2D;&#x7684;&#x6848;&#x4F8B;&#x8FDB;&#x884C;&#x8BF4;&#x660E;&#xFF09;<ul>
<li>lambda&#x8868;&#x8FBE;&#x5F0F;&#x4E2D;&#x7684;&#x53C2;&#x6570;&#x8C03;&#x7528;&#x65B9;&#x6CD5;<ul>
<li>&#x793A;&#x4F8B;&#xFF1A;(String s) -&gt; s.toLowerCase()</li>
</ul>
</li>
<li>labmda&#x8868;&#x8FBE;&#x5F0F;&#x4E2D;&#x7684;&#x53C2;&#x6570;&#x4F5C;&#x4E3A;&#x5176;&#x4ED6;&#x65B9;&#x6CD5;&#x7684;&#x53C2;&#x6570;<ul>
<li>&#x793A;&#x4F8B;&#xFF1A;(Ineger i) -&gt; String.valueOf(i)</li>
</ul>
</li>
</ul>
</li>
</ul>
</blockquote>
<h3 id="&#x8BED;&#x6CD5;-1"><a href="#&#x8BED;&#x6CD5;-1" class="headerlink" title="&#x8BED;&#x6CD5;"></a>&#x8BED;&#x6CD5;</h3><blockquote>
<p>&#x5B98;&#x7F51;&#xFF1A;<a href="/external_links/7690d19612639a92dc801f422874dd82.html" target="blank" rel="noopener">docs.oracle.com/javase/tuto&#x2026;</a></p>
</blockquote>
<p>There are four kinds of method references:</p>
<table>
<thead>
<tr>
<th>Kind</th>
<th>Syntax</th>
<th>Examples</th>
</tr>
</thead>
<tbody><tr>
<td>Reference to a static method</td>
<td><code>ContainingClass::staticMethodName</code></td>
<td><code>Person::compareByAge</code> <code>MethodReferencesExamples::appendStrings</code></td>
</tr>
<tr>
<td>Reference to an instance method of a particular object</td>
<td><code>containingObject::instanceMethodName</code></td>
<td><code>myComparisonProvider::compareByName</code> <code>myApp::appendStrings2</code></td>
</tr>
<tr>
<td>Reference to an instance method of an arbitrary object of a particular type</td>
<td><code>ContainingType::methodName</code></td>
<td><code>String::compareToIgnoreCase</code> <code>String::concat</code></td>
</tr>
<tr>
<td>Reference to a constructor</td>
<td><code>ClassName::new</code></td>
<td><code>HashSet::new</code></td>
</tr>
</tbody></table>
<p>&#x56DB;&#x79CD;&#x65B9;&#x6CD5;&#x5F15;&#x7528;</p>
<table>
<thead>
<tr>
<th>&#x79CD;&#x7C7B;</th>
<th>&#x8BED;&#x6CD5;</th>
<th>&#x793A;&#x4F8B;</th>
</tr>
</thead>
<tbody><tr>
<td>&#x5F15;&#x7528;&#x9759;&#x6001;&#x65B9;&#x6CD5;</td>
<td><code>&#x7C7B;&#x540D;::&#x9759;&#x6001;&#x65B9;&#x6CD5;&#x540D;</code></td>
<td><code>Person::compareByAge</code> <code>MethodReferencesExamples::appendStrings</code></td>
</tr>
<tr>
<td>&#x5BF9;&#x7279;&#x5B9A;&#x5BF9;&#x8C61;&#x7684;&#x5B9E;&#x4F8B;&#x65B9;&#x6CD5;&#x7684;&#x5F15;&#x7528;</td>
<td><code>&#x5BF9;&#x8C61;&#x540D;::&#x65B9;&#x6CD5;&#x540D;</code></td>
<td><code>myComparisonProvider::compareByName</code> <code>myApp::appendStrings2</code></td>
</tr>
<tr>
<td>&#x5BF9;&#x7279;&#x5B9A;&#x7C7B;&#x578B;&#x7684;&#x4EFB;&#x610F;&#x5BF9;&#x8C61;&#x7684;&#x5B9E;&#x4F8B;&#x65B9;&#x6CD5;&#x7684;&#x5F15;&#x7528;</td>
<td><code>&#x7C7B;&#x540D;::&#x65B9;&#x6CD5;&#x540D;</code></td>
<td><code>String::compareToIgnoreCase</code> <code>String::concat</code></td>
</tr>
<tr>
<td>&#x5F15;&#x7528;&#x6784;&#x9020;&#x65B9;&#x6CD5;</td>
<td><code>&#x7C7B;&#x540D;::new</code></td>
<td><code>HashSet::new</code></td>
</tr>
</tbody></table>
<p>&#x4E0B;&#x9762;&#x7684;&#x6848;&#x4F8B;&#x4E2D;&#x4F1A;&#x7528;&#x5230;Stream&#x76F8;&#x5173;API&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x5728;&#x540E;&#x7EED;&#x7684;&#x6587;&#x7AE0;&#x4E2D;&#x8FDB;&#x884C;&#x8BE6;&#x7EC6;&#x8BA8;&#x8BBA;&#x3002;</p>
<ul>
<li>&#x5F15;&#x7528;&#x9759;&#x6001;&#x65B9;&#x6CD5;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;// &#x5C06;&#x96C6;&#x5408;&#x4E2D;&#x7684;Integer &#x8F6C;&#x6362;&#x4E3A; String&#xFF0C; &#x5E76;&#x6536;&#x96C6;&#x5230;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x96C6;&#x5408;&#x4E2D;</span><br><span class="line">List&lt;Integer&gt; integerList = new ArrayList&lt;&gt;(Arrays.asList(1,2,3,4,5));</span><br><span class="line">List&lt;String&gt; stringList = integerList.stream()</span><br><span class="line">    // &#x53C2;&#x6570;i &#x4F5C;&#x4E3A;String&#x9759;&#x6001;&#x65B9;&#x6CD5;valueOf&#x7684;&#x53C2;&#x6570;&#x3002;&#x5E76;&#x4E14;lambda&#x8868;&#x8FBE;&#x5F0F;&#x4E2D;&#x9664;&#x4E86;&#x65B9;&#x6CD5;&#x7684;&#x8C03;&#x7528;&#x4EE5;&#x5916;&#x5176;&#x4ED6;&#x4EC0;&#x4E48;&#x90FD;&#x6CA1;&#x505A;</span><br><span class="line">    // .map(i -&gt; String.valueOf(i))</span><br><span class="line">    .map(String::valueOf) // &#x5F15;&#x7528;String&#x7C7B;&#x4E2D;&#x7684;&#x9759;&#x6001;&#x65B9;&#x6CD5;valueOf&#x3002;&#x7C7B;&#x540D;::&#x9759;&#x6001;&#x65B9;&#x6CD5;&#x540D;</span><br><span class="line">    .collect(Collectors.toList());</span><br><span class="line">System.out.println(stringList);</span><br></pre></td></tr></table></figure>

<ul>
<li>&#x5BF9;&#x7279;&#x5B9A;&#x5BF9;&#x8C61;&#x7684;&#x5B9E;&#x4F8B;&#x65B9;&#x6CD5;&#x7684;&#x5F15;&#x7528;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;public class Demo {</span><br><span class="line">    public static void main(String[] args) {</span><br><span class="line">        Test test = new Test();</span><br><span class="line">        List&lt;Integer&gt; integerList = new ArrayList&lt;&gt;(Arrays.asList(1,2,3,4,5));</span><br><span class="line">        integerList.stream()</span><br><span class="line">                /*</span><br><span class="line">                    1.&#x4E0E;&#x9759;&#x6001;&#x65B9;&#x6CD5;&#x4E0D;&#x540C;&#xFF0C;&#x8981;&#x60F3;&#x4F7F;&#x7528;Test&#x7C7B;&#x4E2D;&#x7684;show&#x65B9;&#x6CD5; &#x9700;&#x8981;&#x5148;&#x6709;Test&#x7C7B;&#x7684;&#x5B9E;&#x4F8B;</span><br><span class="line">                    2.&#x53C2;&#x6570;i &#x4F5C;&#x4E3A;test&#x5BF9;&#x8C61;show&#x65B9;&#x6CD5;&#x7684;&#x53C2;&#x6570;</span><br><span class="line">                    3.&#x5E76;&#x4E14;lambda&#x8868;&#x8FBE;&#x5F0F;&#x4E2D;&#x9664;&#x4E86;&#x65B9;&#x6CD5;&#x7684;&#x8C03;&#x7528;&#x4EE5;&#x5916;&#x5176;&#x4ED6;&#x4EC0;&#x4E48;&#x90FD;&#x6CA1;&#x505A;</span><br><span class="line">                 */</span><br><span class="line">                // .forEach(i -&gt; test.show(i));</span><br><span class="line">                .forEach(test::show); // &#x5F15;&#x7528;test&#x5BF9;&#x8C61;&#x4E2D;&#x7684;&#x65B9;&#x6CD5;show&#x3002;&#x5BF9;&#x8C61;&#x540D;::&#x65B9;&#x6CD5;&#x540D;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">class Test{</span><br><span class="line">    public void show(Object o){</span><br><span class="line">        System.out.println(o);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<ul>
<li>&#x5BF9;&#x7279;&#x5B9A;&#x7C7B;&#x578B;&#x7684;&#x4EFB;&#x610F;&#x5BF9;&#x8C61;&#x7684;&#x5B9E;&#x4F8B;&#x65B9;&#x6CD5;&#x7684;&#x5F15;&#x7528;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;// &#x5C06;&#x96C6;&#x5408;&#x4E2D;&#x7684;&#x5143;&#x7D20;&#x8F6C;&#x6210;&#x5927;&#x5199;&#xFF0C;&#x5E76;&#x6536;&#x96C6;&#x5230;&#x65B0;&#x7684;&#x96C6;&#x5408;&#x4E2D;</span><br><span class="line">List&lt;String&gt; list = new ArrayList&lt;&gt;(Arrays.asList(&quot;a&quot;,&quot;b&quot;,&quot;c&quot;));</span><br><span class="line">List&lt;String&gt; list2 = list.stream()</span><br><span class="line">    /*</span><br><span class="line">       1.&#x53C2;&#x6570;s &#x4F5C;&#x4E3A;toUpperCase&#x65B9;&#x6CD5;&#x7684;&#x8C03;&#x7528;&#x8005;</span><br><span class="line">       2.&#x5E76;&#x4E14;lambda&#x8868;&#x8FBE;&#x5F0F;&#x4E2D;&#x9664;&#x4E86;&#x65B9;&#x6CD5;&#x7684;&#x8C03;&#x7528;&#x4EE5;&#x5916;&#x5176;&#x4ED6;&#x4EC0;&#x4E48;&#x90FD;&#x6CA1;&#x505A;</span><br><span class="line">       3.&#x5F15;&#x7528;&#x7684;&#x7C7B;&#x578B;&#x4E3A;&#x53C2;&#x6570;s&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;String</span><br><span class="line">    */</span><br><span class="line">    // .map(s -&gt; s.toUpperCase())</span><br><span class="line">    .map(String::toUpperCase) // &#x5F15;&#x7528;String&#x7C7B;&#x4E2D;&#x7684;&#x65B9;&#x6CD5;toUpperCase&#x3002;&#x7C7B;&#x540D;::&#x65B9;&#x6CD5;&#x540D;</span><br><span class="line">    .collect(Collectors.toList());</span><br></pre></td></tr></table></figure>

<ul>
<li>&#x5F15;&#x7528;&#x6784;&#x9020;&#x65B9;&#x6CD5;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;// &#x5C06;&#x96C6;&#x5408;&#x4E2D;&#x7684;&#x5143;&#x7D20;&#x8F6C;&#x6210;Person&#x5BF9;&#x8C61;&#xFF0C;&#x5E76;&#x6536;&#x96C6;&#x5230;&#x65B0;&#x7684;&#x96C6;&#x5408;&#x4E2D;</span><br><span class="line">public class Demo {</span><br><span class="line">    public static void main(String[] args) {</span><br><span class="line">        List&lt;String&gt; stringList = new ArrayList&lt;&gt;(Arrays.asList(&quot;&#x5F20;&#x4E09;&quot;,&quot;&#x674E;&#x56DB;&quot;,&quot;&#x738B;&#x4E94;&quot;));</span><br><span class="line"></span><br><span class="line">        List&lt;Person&gt; personList = stringList.stream()</span><br><span class="line">                /*</span><br><span class="line">                    1.&#x53C2;&#x6570;s &#x4F5C;&#x4E3A;Person&#x7C7B;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x7684;&#x53C2;&#x6570;</span><br><span class="line">                    2.&#x5E76;&#x4E14;lambda&#x8868;&#x8FBE;&#x5F0F;&#x4E2D;&#x9664;&#x4E86;&#x65B9;&#x6CD5;&#x7684;&#x8C03;&#x7528;&#x4EE5;&#x5916;&#x5176;&#x4ED6;&#x4EC0;&#x4E48;&#x90FD;&#x6CA1;&#x505A;</span><br><span class="line">                 */</span><br><span class="line">                // .map(s -&gt; new Person(s))</span><br><span class="line">                .map(Person::new) // &#x5F15;&#x7528;Person&#x7C7B;&#x4E2D;&#x7684;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x3002;&#x7C7B;&#x540D;::new</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">class Person{</span><br><span class="line">    private String name;</span><br><span class="line"></span><br><span class="line">    public Person(String name) {</span><br><span class="line">        this.name = name;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h2 id="&#x4E0B;&#x671F;&#x9884;&#x544A;"><a href="#&#x4E0B;&#x671F;&#x9884;&#x544A;" class="headerlink" title="&#x4E0B;&#x671F;&#x9884;&#x544A;"></a>&#x4E0B;&#x671F;&#x9884;&#x544A;</h2><p>Stream&#x76F8;&#x5173;API&#x548C;&#x539F;&#x7406;</p>
<blockquote>
<p>&#x6B22;&#x8FCE;&#x5173;&#x6CE8;&#x516C;&#x4F17;&#x53F7;OpenCoder&#xFF0C;&#x6765;&#x548C;&#x6211;&#x505A;&#x670B;&#x53CB;&#x5427;~&#x2764;&#x1F618;&#x1F601;&#x1F431;&#x200D;&#x1F409;&#x1F440;</p>
</blockquote>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/270d92d3c5d45e42e70fc050dfa2b438.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7035660743429062669.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7035660743429062669.html" itemprop="url">Spring Boot（十）：集成邮件发送功能</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-11-29T00:43:11+08:00">
                2021-11-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>&#x300C;&#x8FD9;&#x662F;&#x6211;&#x53C2;&#x4E0E;11&#x6708;&#x66F4;&#x6587;&#x6311;&#x6218;&#x7684;&#x7B2C;21&#x5929;&#xFF0C;&#x6D3B;&#x52A8;&#x8BE6;&#x60C5;&#x67E5;&#x770B;&#xFF1A;<a href="https://dev.newban.cn/7023643374569816095/">2021&#x6700;&#x540E;&#x4E00;&#x6B21;&#x66F4;&#x6587;&#x6311;&#x6218;</a>&#x300D;&#x3002;</p>
</blockquote>
<p>&#x5728; Spring Boot &#x9879;&#x76EE;&#x5F00;&#x53D1;&#x4E2D;&#xFF0C;&#x6216;&#x591A;&#x6216;&#x5C11;&#x4F1A;&#x63A5;&#x89E6;&#x5230;&#x90AE;&#x4EF6;&#x53D1;&#x9001;&#x8FD9;&#x4E2A;&#x529F;&#x80FD;&#xFF0C;&#x82E5;&#x8981;&#x5728; Spring &#x9879;&#x76EE;&#x4E2D;&#x5B9E;&#x73B0;&#x53D1;&#x9001;&#x90AE;&#x4EF6;&#xFF0C;&#x9700;&#x8981;&#x5C01;&#x88C5;&#x8F83;&#x4E3A;&#x590D;&#x6742;&#x7684;&#x6D88;&#x606F;&#x4F53;&#xFF0C;&#x4F46;&#x5728; Spring Boot &#x9879;&#x76EE;&#x4E2D;&#x4EC5;&#x9700;&#x5BFC;&#x5165;&#x7B2C;&#x4E09;&#x65B9;&#x4F9D;&#x8D56;&#x4EE5;&#x53CA;&#x914D;&#x7F6E;&#x5373;&#x53EF;&#x5B8C;&#x6210;&#x3002;</p>
<p>&#x672C;&#x6587;&#x4EE5; 163 &#x90AE;&#x7BB1;&#x4E3A;&#x4F8B;&#x6F14;&#x793A;&#x90AE;&#x4EF6;&#x53D1;&#x9001;&#x529F;&#x80FD;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x5176;&#x4ED6;&#x90AE;&#x7BB1;&#x7684;&#x914D;&#x7F6E;&#x5927;&#x540C;&#x5C0F;&#x5F02;&#x3002;</p>
<ol>
<li>&#x83B7;&#x53D6;&#x90AE;&#x7BB1;&#x7684;&#x6388;&#x6743;&#x7801;</li>
</ol>
<hr>
<p>&#x5E38;&#x7528;&#x7684;&#x90AE;&#x4EF6;&#x4F20;&#x8F93;&#x534F;&#x8BAE;&#x6709; <code>POP3</code>&#x3001;<code>SMTP</code>&#x3001;<code>IMAP</code>&#xFF0C;&#x8FD9;&#x91CC;&#x9009;&#x62E9; <code>SMTP</code> &#x534F;&#x8BAE;&#x8FDB;&#x884C;&#x6F14;&#x793A;&#x3002;</p>
<p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x767B;&#x5F55;&#x81EA;&#x5DF1;&#x7684;&#x90AE;&#x7BB1;&#xFF0C;&#x5728;&#x8BBE;&#x7F6E;&#x4E2D;&#x627E;&#x5230;&#x534F;&#x8BAE;&#x5730;&#x5740;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/42c48b065d745c35916d3155e247cbb302a1381b8ec171bceaec6b28687d7983" alt></p>
<p>&#x7136;&#x540E;&#x70B9;&#x51FB;&#x5F00;&#x542F;&#x670D;&#x52A1;&#xFF0C;&#x83B7;&#x5F97;&#x6388;&#x6743;&#x7801;&#xFF08;&#x6388;&#x6743;&#x7801;&#x4EC5;&#x663E;&#x793A;&#x4E00;&#x6B21;&#xFF0C;&#x52A1;&#x5FC5;&#x4FDD;&#x7BA1;&#x597D;&#xFF09;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/874895f699721a8015a9b0cb30b664f98a10fc823931a7e9ad9711738cd11475" alt></p>
<p>&#x5982;&#x4E0B;&#x662F;&#x7F51;&#x6613;&#x90AE;&#x7BB1;&#x5BF9;&#x5E94;&#x7684;&#x4E09;&#x79CD;&#x534F;&#x8BAE;&#x4E3B;&#x673A;&#x5730;&#x5740;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/8e927a91e775b4b4a46da47fb4ef5de5dc3ded7a769ff359ba2cfbb1daef3d3c" alt></p>
<ol start="2">
<li>&#x5F15;&#x5165;&#x4F9D;&#x8D56;</li>
</ol>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xml&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-mail&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>&#x914D;&#x7F6E;&#x90AE;&#x7BB1;&#x4FE1;&#x606F;</li>
</ol>
<hr>
<p>&#x2B50;&#x6CE8;&#x610F;&#xFF1A;&#x5982;&#x4E0B; <code>password</code> &#x6307;&#x5411;&#x7684;&#x662F;&#x521A;&#x521A;&#x4FDD;&#x5B58;&#x7684;<strong>&#x6388;&#x6743;&#x7801;</strong>&#xFF0C;&#x800C;&#x975E;&#x4E2A;&#x4EBA;&#x90AE;&#x7BB1;&#x5BC6;&#x7801;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">yaml&#x590D;&#x5236;&#x4EE3;&#x7801;spring:</span><br><span class="line">  mail:</span><br><span class="line">    default-encoding: utf-8</span><br><span class="line">    # &#x4E3B;&#x673A;&#x5730;&#x5740;</span><br><span class="line">    host: smtp.163.com</span><br><span class="line">    # &#x90AE;&#x7BB1;&#x540D;</span><br><span class="line">    username: xxx@163.com</span><br><span class="line">    # &#x6388;&#x6743;&#x7801; (&#x975E;&#x90AE;&#x7BB1;&#x5BC6;&#x7801;)</span><br><span class="line">    password: xxxxxxxxxxxxxxx</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>&#x53D1;&#x9001;&#x90AE;&#x4EF6;</li>
</ol>
<hr>
<h3 id="4-1-&#x7EAF;&#x6587;&#x672C;&#x90AE;&#x4EF6;"><a href="#4-1-&#x7EAF;&#x6587;&#x672C;&#x90AE;&#x4EF6;" class="headerlink" title="4.1 &#x7EAF;&#x6587;&#x672C;&#x90AE;&#x4EF6;"></a>4.1 &#x7EAF;&#x6587;&#x672C;&#x90AE;&#x4EF6;</h3><p>&#x5982;&#x4E0B;&#x5C01;&#x88C5;&#x4E86; <code>SimpleMailMessage</code> &#x6D88;&#x606F;&#x5185;&#x5BB9;&#xFF0C;&#x6CE8;&#x5165; <code>JavaMailSender</code> &#x5E76;&#x8C03;&#x7528;&#x5176; <code>send()</code> &#x4EE5;&#x5B8C;&#x6210;&#x90AE;&#x4EF6;&#x53D1;&#x9001;&#x529F;&#x80FD;&#x3002;&#x5176;&#x4E2D;&#x6536;&#x4EF6;&#x4EBA;&#x548C;&#x6284;&#x9001;&#x4EBA;&#x53EF;&#x652F;&#x6301;&#x591A;&#x4E2A;&#x540C;&#x65F6;&#x53D1;&#x9001;&#xFF0C;&#x591A;&#x4E2A;&#x5730;&#x5740;&#x95F4;&#x4F7F;&#x7528; <code>,</code> &#x62FC;&#x63A5;&#x5373;&#x53EF;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;@RestController</span><br><span class="line">public class EmailController {</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private JavaMailSender javaMailSender;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(&quot;/sendMail&quot;)</span><br><span class="line">    public void send() {</span><br><span class="line">        SimpleMailMessage message = new SimpleMailMessage();</span><br><span class="line">        // &#x53D1;&#x4EF6;&#x4EBA;</span><br><span class="line">        message.setFrom(&quot;xxx@163.com&quot;);</span><br><span class="line">        // &#x6536;&#x4EF6;&#x4EBA;(&#x53EF;&#x5B9E;&#x73B0;&#x6279;&#x91CF;&#x53D1;&#x9001;)</span><br><span class="line">        message.setTo(&quot;xxx1@qq.com&quot;, &quot;xxx2@qq.com&quot;);</span><br><span class="line">        // &#x90AE;&#x7BB1;&#x6807;&#x9898;</span><br><span class="line">        message.setSubject(&quot;Java&#x53D1;&#x9001;&#x90AE;&#x7BB1;Demo&quot;);</span><br><span class="line">        // &#x90AE;&#x7BB1;&#x5185;&#x5BB9;</span><br><span class="line">        message.setText(&quot;&#x6D4B;&#x8BD5; Spring Boot &#x96C6;&#x6210;&#x90AE;&#x7BB1;&#x53D1;&#x9001;&#x529F;&#x80FD;&#x7684;&#xFF01;&quot;);</span><br><span class="line">        // &#x6284;&#x9001;&#x4EBA;</span><br><span class="line">        message.setCc(&quot;xxx?@163.com&quot;);</span><br><span class="line">        // &#x53D1;&#x9001;&#x90AE;&#x4EF6;</span><br><span class="line">        javaMailSender.send(message);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/5592534ff4adeb3a7e2601ce289870693b949914e4a398244397151e9b9c8545" alt></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/36329b637498fb75bcc12e0c8d55146cecb1fd02376f4ed9b73e17a622fc2a5c" alt></p>
<h3 id="4-2-HTML-&#x683C;&#x5F0F;&#x90AE;&#x4EF6;&#x2B50;"><a href="#4-2-HTML-&#x683C;&#x5F0F;&#x90AE;&#x4EF6;&#x2B50;" class="headerlink" title="4.2 HTML &#x683C;&#x5F0F;&#x90AE;&#x4EF6;&#x2B50;"></a>4.2 HTML &#x683C;&#x5F0F;&#x90AE;&#x4EF6;&#x2B50;</h3><p>&#x4E0E;&#x53D1;&#x9001;&#x7EAF;&#x6587;&#x672C;&#x4E0D;&#x540C;&#x7684;&#x662F;&#xFF0C;&#x53D1;&#x9001; HTML &#x683C;&#x5F0F;&#x9700;&#x8981;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; <code>MIME</code> &#x6D88;&#x606F;&#xFF0C;&#x5E76;&#x5C06;&#x5176;&#x6CE8;&#x5165;&#x5230; <code>MimeMessageHelper</code> &#x5BF9;&#x8C61;&#x4E2D;&#xFF0C;&#x4F46;&#x4ECD;&#x662F;&#x4EE5; <code>JavaMailSender</code> &#x63A5;&#x53E3;&#x8FDB;&#x884C;&#x53D1;&#x9001;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;@RestController</span><br><span class="line">public class EmailController {</span><br><span class="line"></span><br><span class="line">    @RequestMapping(&quot;/sendHtmlMail&quot;)</span><br><span class="line">    public void sendHtmlMsg() throws MessagingException {</span><br><span class="line">        MimeMessage message = javaMailSender.createMimeMessage();</span><br><span class="line">        MimeMessageHelper mimeHelper = new MimeMessageHelper(message, true);</span><br><span class="line">        // &#x53D1;&#x4EF6;&#x4EBA;</span><br><span class="line">        mimeHelper.setFrom(&quot;xxx@163.com&quot;);</span><br><span class="line">        // &#x6536;&#x4EF6;&#x4EBA;</span><br><span class="line">        mimeHelper.setTo(&quot;xxx@qq.com&quot;);</span><br><span class="line">        // &#x90AE;&#x7BB1;&#x6807;&#x9898;</span><br><span class="line">        mimeHelper.setSubject(&quot;Java&#x53D1;&#x9001;&#x90AE;&#x7BB1;Demo&quot;);</span><br><span class="line">        // &#x90AE;&#x7BB1;&#x5185;&#x5BB9;</span><br><span class="line">        mimeHelper.setText(&quot;&lt;h2&gt;MimeMessageHelper&#x6D4B;&#x8BD5;&lt;/h2&gt;&quot;, true);</span><br><span class="line"></span><br><span class="line">        // &#x4ECD;&#x7136;&#x4F7F;&#x7528; JavaMailSender &#x63A5;&#x53E3;&#x53D1;&#x9001;&#x90AE;&#x4EF6;</span><br><span class="line">        javaMailSender.send(message);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/48b620da4cdb9c2ccddc1d4a1b9d96c501d577f9838a63ca423acc6cd980a8e0" alt></p>
<h3 id="4-3-&#x643A;&#x5E26;&#x9644;&#x4EF6;&#x7684;&#x90AE;&#x4EF6;&#x2B50;"><a href="#4-3-&#x643A;&#x5E26;&#x9644;&#x4EF6;&#x7684;&#x90AE;&#x4EF6;&#x2B50;" class="headerlink" title="4.3 &#x643A;&#x5E26;&#x9644;&#x4EF6;&#x7684;&#x90AE;&#x4EF6;&#x2B50;"></a>4.3 &#x643A;&#x5E26;&#x9644;&#x4EF6;&#x7684;&#x90AE;&#x4EF6;&#x2B50;</h3><p>&#x76F8;&#x5BF9;&#x4E8E;&#x53D1;&#x9001; HTML &#x4EC5;&#x591A;&#x589E;&#x52A0;&#x4E86; <code>addAttachment()</code> &#x65B9;&#x6CD5;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;@RestController</span><br><span class="line">public class EmailController {</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private JavaMailSender javaMailSender;</span><br><span class="line">    </span><br><span class="line">	@RequestMapping(&quot;/addAttachment&quot;)</span><br><span class="line">    public void sendMailWithAttachment() throws MessagingException {</span><br><span class="line">        MimeMessage message = javaMailSender.createMimeMessage();</span><br><span class="line">        MimeMessageHelper mimeWithAttachment = new MimeMessageHelper(message, true);</span><br><span class="line">        // &#x53D1;&#x4EF6;&#x4EBA;</span><br><span class="line">        mimeWithAttachment.setFrom(&quot;w577159462@163.com&quot;);</span><br><span class="line">        // &#x6536;&#x4EF6;&#x4EBA;</span><br><span class="line">        mimeWithAttachment.setTo(&quot;577159462@qq.com&quot;);</span><br><span class="line">        // &#x90AE;&#x7BB1;&#x6807;&#x9898;</span><br><span class="line">        mimeWithAttachment.setSubject(&quot;&#x53D1;&#x9001;&#x90AE;&#x4EF6;(&#x5E26;&#x9644;&#x4EF6;)&quot;);</span><br><span class="line">        // &#x90AE;&#x7BB1;&#x5185;&#x5BB9;</span><br><span class="line">        mimeWithAttachment.setText(&quot;&#x6DFB;&#x52A0;&#x9644;&#x4EF6;..&quot;);</span><br><span class="line"></span><br><span class="line">        // 1 &#x9644;&#x4EF6;&#x6DFB;&#x52A0;&#x56FE;&#x7247;</span><br><span class="line">        mimeWithAttachment.addAttachment(&quot;1.jpg&quot;, new File(&quot;D:\\Temp\\_mail\\1.jpg&quot;));</span><br><span class="line">        // 2. &#x9644;&#x4EF6;&#x6DFB;&#x52A0;word&#x6587;&#x6863;</span><br><span class="line">        mimeWithAttachment.addAttachment(&quot;test.docx&quot;, new File(&quot;D:\\Temp\\_mail\\test.docx&quot;));</span><br><span class="line"></span><br><span class="line">        // &#x4ECD;&#x7136;&#x4F7F;&#x7528; JavaMailSender &#x63A5;&#x53E3;&#x53D1;&#x9001;&#x90AE;&#x4EF6;</span><br><span class="line">        javaMailSender.send(message);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/9bf1e0bff62081f247f84ae31a9b07b71c129a6195eb6e78e86ef5be41bfc592" alt></p>
<h3 id="4-4-&#x5185;&#x5D4C;&#x56FE;&#x7247;&#x90AE;&#x4EF6;"><a href="#4-4-&#x5185;&#x5D4C;&#x56FE;&#x7247;&#x90AE;&#x4EF6;" class="headerlink" title="4.4 &#x5185;&#x5D4C;&#x56FE;&#x7247;&#x90AE;&#x4EF6;"></a>4.4 &#x5185;&#x5D4C;&#x56FE;&#x7247;&#x90AE;&#x4EF6;</h3><p><code>addInline()</code> &#x5B9E;&#x73B0;&#x53D1;&#x9001;&#x56FE;&#x7247;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;@RestController</span><br><span class="line">public class EmailController {</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private JavaMailSender javaMailSender;</span><br><span class="line">    </span><br><span class="line">    @RequestMapping(&quot;/embeddedPic&quot;)</span><br><span class="line">    public void mailWithEmbeddedPic() throws MessagingException {</span><br><span class="line">        MimeMessage message = javaMailSender.createMimeMessage();</span><br><span class="line">        MimeMessageHelper embeddedPic = new MimeMessageHelper(message, true);</span><br><span class="line">        // &#x53D1;&#x4EF6;&#x4EBA;</span><br><span class="line">        embeddedPic.setFrom(&quot;xxx@163.com&quot;);</span><br><span class="line">        // &#x6536;&#x4EF6;&#x4EBA;</span><br><span class="line">        embeddedPic.setTo(&quot;xxx@qq.com&quot;);</span><br><span class="line">        // &#x90AE;&#x7BB1;&#x6807;&#x9898;</span><br><span class="line">        embeddedPic.setSubject(&quot;&#x53D1;&#x9001;&#x90AE;&#x4EF6;(&#x5185;&#x5D4C;&#x56FE;&#x7247;)&quot;);</span><br><span class="line">        // &#x90AE;&#x7BB1;&#x5185;&#x5BB9;</span><br><span class="line">        embeddedPic.setText(&quot;&#x53D1;&#x9001;&#x5185;&#x5D4C;&#x56FE;&#x7247;..&quot;);</span><br><span class="line">        // &#x6DFB;&#x52A0;&#x5185;&#x5D4C;&#x56FE;&#x7247;</span><br><span class="line">        embeddedPic.addInline(&quot;img1.jpg&quot;, new FileSystemResource(&quot;D:\\Temp\\_mail\\1.jpg&quot;));</span><br><span class="line"></span><br><span class="line">        // &#x4ECD;&#x7136;&#x4F7F;&#x7528; JavaMailSender &#x63A5;&#x53E3;&#x53D1;&#x9001;&#x90AE;&#x4EF6;</span><br><span class="line">        javaMailSender.send(message);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/129ed059c83ac48516fbc2739abe778dc7cbf709d258ad823beab1f9c067093f" alt></p>
<p>&#x81F3;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x5728; Spring Boot &#x73AF;&#x5883;&#x4E2D;&#x5FEB;&#x901F;&#x5B9E;&#x73B0;&#x4E86;&#x90AE;&#x4EF6;&#x53D1;&#x9001;&#x529F;&#x80FD;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x6BD4;&#x60F3;&#x8C61;&#x4E2D;&#x7684;&#x8FD8;&#x8981;&#x7B80;&#x5355;&#x4E14;&#x8FC5;&#x901F;&#xFF1F;&#xFF01;</p>
<p><strong>&#x5E0C;&#x671B;&#x672C;&#x6587;&#x5BF9;&#x4F60;&#x6709;&#x6240;&#x5E2E;&#x52A9;</strong>&#x1F9E0;  </p>
<p><strong>&#x6B22;&#x8FCE;&#x5728;&#x8BC4;&#x8BBA;&#x533A;&#x7559;&#x4E0B;&#x4F60;&#x7684;&#x770B;&#x6CD5;</strong>&#x1F30A;&#xFF0C;<strong>&#x6211;&#x4EEC;&#x4E00;&#x8D77;&#x8BA8;&#x8BBA;&#x4E0E;&#x5206;&#x4EAB;</strong>&#x1F525;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/bc8c5c46a5f4b1cedd4eb57242b3cda4.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7035651061633253389.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7035651061633253389.html" itemprop="url">RDS 类数据库设计规范</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-11-29T00:02:27+08:00">
                2021-11-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href>&#x8FD9;&#x662F;&#x6211;&#x53C2;&#x4E0E;11&#x6708;&#x66F4;&#x6587;&#x6311;&#x6218;&#x7684;&#x7B2C;5&#x5929;&#xFF0C;&#x6D3B;&#x52A8;&#x8BE6;&#x60C5;&#x67E5;&#x770B;&#xFF1A;<a href="https://dev.newban.cn/7023643374569816095">2021&#x6700;&#x540E;&#x4E00;&#x6B21;&#x66F4;&#x6587;&#x6311;&#x6218;</a></a></p>
<h3 id="&#x8BF4;&#x660E;&#xFF1A;&#x672C;&#x89C4;&#x8303;&#x662F;&#x81EA;&#x5DF1;&#x57FA;&#x4E8E;&#x591A;&#x5BB6;&#x516C;&#x53F8;&#x7ECF;&#x9A8C;&#xFF0C;&#x6709;&#x81EA;&#x5DF1;&#x5F00;&#x53D1;&#x7ECF;&#x9A8C;&#x4E5F;&#x6709;&#x884C;&#x4E1A;&#x89C4;&#x8303;&#x8981;&#x6C42;&#xFF0C;&#x5217;&#x4E3E;&#x4E00;&#x4E9B;&#x5E38;&#x7528;&#x7684;&#x573A;&#x666F;&#x800C;&#x6210;&#x6587;&#xFF0C;&#x63D0;&#x4F9B;&#x7ED9;&#x521D;&#x521B;&#x56E2;&#x961F;&#x53C2;&#x8003;&#x4F7F;&#x7528;&#xFF0C;&#x53EF;&#x6839;&#x636E;&#x5B9E;&#x9645;&#x5F00;&#x53D1;&#x53C2;&#x8003;"><a href="#&#x8BF4;&#x660E;&#xFF1A;&#x672C;&#x89C4;&#x8303;&#x662F;&#x81EA;&#x5DF1;&#x57FA;&#x4E8E;&#x591A;&#x5BB6;&#x516C;&#x53F8;&#x7ECF;&#x9A8C;&#xFF0C;&#x6709;&#x81EA;&#x5DF1;&#x5F00;&#x53D1;&#x7ECF;&#x9A8C;&#x4E5F;&#x6709;&#x884C;&#x4E1A;&#x89C4;&#x8303;&#x8981;&#x6C42;&#xFF0C;&#x5217;&#x4E3E;&#x4E00;&#x4E9B;&#x5E38;&#x7528;&#x7684;&#x573A;&#x666F;&#x800C;&#x6210;&#x6587;&#xFF0C;&#x63D0;&#x4F9B;&#x7ED9;&#x521D;&#x521B;&#x56E2;&#x961F;&#x53C2;&#x8003;&#x4F7F;&#x7528;&#xFF0C;&#x53EF;&#x6839;&#x636E;&#x5B9E;&#x9645;&#x5F00;&#x53D1;&#x53C2;&#x8003;" class="headerlink" title="&#x8BF4;&#x660E;&#xFF1A;&#x672C;&#x89C4;&#x8303;&#x662F;&#x81EA;&#x5DF1;&#x57FA;&#x4E8E;&#x591A;&#x5BB6;&#x516C;&#x53F8;&#x7ECF;&#x9A8C;&#xFF0C;&#x6709;&#x81EA;&#x5DF1;&#x5F00;&#x53D1;&#x7ECF;&#x9A8C;&#x4E5F;&#x6709;&#x884C;&#x4E1A;&#x89C4;&#x8303;&#x8981;&#x6C42;&#xFF0C;&#x5217;&#x4E3E;&#x4E00;&#x4E9B;&#x5E38;&#x7528;&#x7684;&#x573A;&#x666F;&#x800C;&#x6210;&#x6587;&#xFF0C;&#x63D0;&#x4F9B;&#x7ED9;&#x521D;&#x521B;&#x56E2;&#x961F;&#x53C2;&#x8003;&#x4F7F;&#x7528;&#xFF0C;&#x53EF;&#x6839;&#x636E;&#x5B9E;&#x9645;&#x5F00;&#x53D1;&#x53C2;&#x8003;"></a><strong>&#x8BF4;&#x660E;&#xFF1A;&#x672C;&#x89C4;&#x8303;&#x662F;&#x81EA;&#x5DF1;&#x57FA;&#x4E8E;&#x591A;&#x5BB6;&#x516C;&#x53F8;&#x7ECF;&#x9A8C;&#xFF0C;&#x6709;&#x81EA;&#x5DF1;&#x5F00;&#x53D1;&#x7ECF;&#x9A8C;&#x4E5F;&#x6709;&#x884C;&#x4E1A;&#x89C4;&#x8303;&#x8981;&#x6C42;&#xFF0C;&#x5217;&#x4E3E;&#x4E00;&#x4E9B;&#x5E38;&#x7528;&#x7684;&#x573A;&#x666F;&#x800C;&#x6210;&#x6587;&#xFF0C;&#x63D0;&#x4F9B;&#x7ED9;&#x521D;&#x521B;&#x56E2;&#x961F;&#x53C2;&#x8003;&#x4F7F;&#x7528;&#xFF0C;&#x53EF;&#x6839;&#x636E;&#x5B9E;&#x9645;&#x5F00;&#x53D1;&#x53C2;&#x8003;</strong></h3><h2 id="&#x4E00;-&#x6838;&#x5FC3;&#x7406;&#x5FF5;"><a href="#&#x4E00;-&#x6838;&#x5FC3;&#x7406;&#x5FF5;" class="headerlink" title="&#x4E00;. &#x6838;&#x5FC3;&#x7406;&#x5FF5;"></a>&#x4E00;. &#x6838;&#x5FC3;&#x7406;&#x5FF5;</h2><p><strong>&#x5236;&#x5B9A;&#x89C4;&#x8303;&#x7684;&#x76F4;&#x63A5;&#x76EE;&#x7684;&#x662F;&#x7EA6;&#x675F;&#x8BBE;&#x8BA1;&#x884C;&#x4E3A;&#xFF0C;&#x6700;&#x7EC8;&#x76EE;&#x7684;&#x662F;&#x786E;&#x4FDD;&#x8BBE;&#x8BA1;&#x7684;&#x5408;&#x7406;&#x7EDF;&#x4E00;&#x3002;&#x89C4;<br>&#x8303;&#x867D;&#x7136;&#x662F;&#x6709;&#x4E30;&#x5BCC;&#x9879;&#x76EE;&#x7ECF;&#x9A8C;&#x7684;&#x4EBA;&#x5236;&#x5B9A;&#x7684;&#xFF0C;&#x4F46;&#x7EF4;&#x62A4;&#x7684;&#x5374;&#x4E0D;&#x662F;&#x67D0;&#x4E2A;&#x4EBA;&#x7684;&#x610F;&#x5FD7;&#xFF0C;&#x800C;&#x662F;&#x9879;&#x76EE;*&#x7684;&#x610F;&#x5FD7;&#xFF0C;&#x56E0;&#x4E3A;&#x9075;&#x5B88;&#x6B64;&#x89C4;&#x8303;&#x5BF9;&#x9879;&#x76EE;&#x662F;&#x597D;&#x7684;&#x6709;&#x5229;&#x7684;&#xFF0C;&#x6B64;&#x89C4;&#x8303;&#x624D;&#x6709;&#x610F;&#x4E49;</strong>&#x3002;</p>
<p>&#x5BF9;&#x4E8E;&#x6570;&#x636E;&#x5E93;&#x6838;&#x5FC3;&#x7406;&#x5FF5;&#x53EF;&#x4EE5;&#x5F52;&#x7EB3;&#x4E3A;&#x4EE5;&#x4E0B;&#x51E0;&#x70B9;&#xFF1A;</p>
<p>&#x25C6;&#x4E0D;&#x5728;&#x6570;&#x636E;&#x5E93;&#x505A;&#x8BA1;&#x7B97;&#xFF0C;cpu &#x8BA1;&#x7B97;&#x52A1;&#x5FC5;&#x79FB;&#x81F3;&#x4E1A;&#x52A1;&#x5C42;</p>
<p>&#x25C6;&#x63A7;&#x5236;&#x5355;&#x8868;&#x6570;&#x636E;&#x91CF;&#xFF0C;&#x5355;&#x8868;&#x8BB0;&#x5F55;&#x63A7;&#x5236;&#x5728;&#x5343;&#x4E07;&#x7EA7;</p>
<p>&#x25C6;&#x63A7;&#x5236;&#x5217;&#x6570;&#x91CF;&#xFF0C;&#x5B57;&#x6BB5;&#x6570;&#x63A7;&#x5236;&#x5728; 30 &#x4EE5;&#x5185;</p>
<p>&#x25C6;&#x5E73;&#x8861;&#x8303;&#x5F0F;&#x4E0E;&#x5197;&#x4F59;&#xFF0C;&#x4E3A;&#x63D0;&#x9AD8;&#x6548;&#x7387;&#x53EF;&#x4EE5;&#x727A;&#x7272;&#x8303;&#x5F0F;&#x8BBE;&#x8BA1;&#xFF0C;&#x5197;&#x4F59;&#x6570;&#x636E;</p>
<p>&#x25C6;&#x62D2;&#x7EDD; 3B(big)&#xFF0C;&#x5927; sql&#xFF0C;&#x5927;&#x4E8B;&#x52A1;&#xFF0C;&#x5927;&#x6279;&#x91CF;</p>
<h2 id="&#x4E8C;-&#x8868;&#x7ED3;&#x6784;&#x8BBE;&#x8BA1;"><a href="#&#x4E8C;-&#x8868;&#x7ED3;&#x6784;&#x8BBE;&#x8BA1;" class="headerlink" title="&#x4E8C;. &#x8868;&#x7ED3;&#x6784;&#x8BBE;&#x8BA1;"></a>&#x4E8C;. &#x8868;&#x7ED3;&#x6784;&#x8BBE;&#x8BA1;</h2><p>2.1 &#x7981;&#x7528;&#x4FDD;&#x7559;&#x5B57;&#x4F5C;&#x4E3A;&#x5B57;&#x6BB5;&#x540D;&#x6216;&#x8868;&#x540D;</p>
<ul>
<li>desc&#x3001;range&#x3001;match&#x3001;delayed&#x3001;comment &#x7B49;&#x52A0;&#x4E0A;&#x5F15;&#x53F7;&#x4E5F;&#x4E0D;&#x884C;</li>
</ul>
<p>2.3 &#x6807;&#x5FD7;&#x7C7B;&#x5B57;&#x6BB5;&#x4F18;&#x5148;&#x4F7F;&#x7528; tinyint</p>
<ul>
<li>&#x542F;&#x7528;&#x6807;&#x8BB0;&#x3001;&#x72B6;&#x6001;&#x6807;&#x8BB0;&#x3001;&#x7EB3;&#x7A0E;&#x4EBA;&#x72B6;&#x6001;&#x7B49;&#x7EDF;&#x4E00;&#x4F7F;&#x7528; tinyint &#x5B58;&#x50A8;</li>
<li>&#x6807;&#x8BB0;&#x7C7B;&#x5B57;&#x6BB5;&#x5FC5;&#x987B;&#x4E3A;&#x975E;&#x7A7A;&#x4E14;&#x5E26;&#x6709;&#x9ED8;&#x8BA4;&#x503C;</li>
<li>&#x5BF9;&#x4E8E;&#x6807;&#x8BB0;&#x7279;&#x6B8A;&#x7C7B;&#x578B;&#x5EFA;&#x8BAE;&#x91C7;&#x7528;&#x8D1F;&#x503C;&#x8BB0;&#x5F55;</li>
<li>&#x542F;&#x7528;&#x6807;&#x8BB0;&#x4E00;&#x822C;&#x60C5;&#x51B5;&#x9ED8;&#x8BA4;&#x90FD;&#x662F;&#x542F;&#x7528;,&#x542F;&#x7528;&#x4F7F;&#x7528; 1 &#x8868;&#x793A;</li>
</ul>
<p>2.4 &#x907F;&#x514D;&#x4F7F;&#x7528; NULL &#x5B57;&#x6BB5;<br>*NULL &#x7684;&#x5217;&#x4F7F;&#x7D22;&#x5F15;/&#x7D22;&#x5F15;&#x7EDF;&#x8BA1;/&#x503C;&#x6BD4;&#x8F83;&#x90FD;&#x66F4;&#x52A0;&#x590D;&#x6742;&#xFF0C;&#x5BF9; MySQL &#x6765;&#x8BF4;&#x66F4;&#x96BE;&#x4F18;&#x5316;</p>
<ul>
<li>NULL &#x5B57;&#x6BB5;&#x7684;&#x7D22;&#x5F15;&#x9700;&#x8981;&#x989D;&#x5916;&#x7A7A;&#x95F4;</li>
<li>NULL &#x5B57;&#x6BB5;&#x7684;&#x590D;&#x5408;&#x7D22;&#x5F15;&#x65E0;&#x6548;</li>
<li>&#x53EF;&#x4EE5;&#x4E3A;&#x7A7A;&#x65F6;&#x8981;&#x989D;&#x5916;&#x8BE6;&#x7EC6;&#x8BF4;&#x660E;&#x539F;&#x56E0;</li>
<li>NOT NULL &#x4E4B;&#x540E;&#x80FD;&#x6709;&#x9ED8;&#x8BA4;&#x6700;&#x597D;&#x6709;&#x9ED8;&#x8BA4;&#x503C;</li>
<li>&#x5BF9; null &#x7684;&#x5904;&#x7406;&#x65F6;&#x5019;&#xFF0C;&#x53EA;&#x80FD;&#x91C7;&#x7528; is null &#x6216; is not null&#xFF0C;&#x800C;&#x4E0D;&#x80FD;&#x91C7;&#x7528;=&#x3001;in&#x3001;&lt;&#x3001;&lt;&gt;&#x3001;!=&#x3001;not in &#x8FD9;&#x4E9B;&#x64CD;&#x4F5C;&#x7B26;&#x53F7;&#x3002;&#x5982;&#xFF1A;where name!=&#x2019;zhuyungao&#x2019;&#xFF0C;&#x5982;&#x679C;&#x5B58;&#x5728; name &#x4E3A;null &#x503C;&#x7684;&#x8BB0;&#x5F55;&#xFF0C;&#x67E5;&#x8BE2;&#x7ED3;&#x679C;&#x5C31;&#x4E0D;&#x4F1A;&#x5305;&#x542B; name &#x4E3A; null &#x503C;&#x7684;&#x8BB0;&#x5F55;</li>
</ul>
<p>2.7 &#x7981;&#x6B62;&#x5728;&#x4E3B;&#x8868;&#x4E2D;&#x4F7F;&#x7528; TEXT&#x3001;BLOB &#x7C7B;&#x578B;</p>
<ul>
<li>&#x4F1A;&#x6D6A;&#x8D39;&#x66F4;&#x591A;&#x7684;&#x78C1;&#x76D8;&#x548C;&#x5185;&#x5B58;&#x7A7A;&#x95F4;&#xFF0C;&#x975E;&#x5FC5;&#x8981;&#x7684;&#x5927;&#x91CF;&#x7684;&#x5927;&#x5B57;&#x6BB5;&#x67E5;&#x8BE2;&#x4F1A;&#x6DD8;&#x6C70;&#x6389;&#x70ED;&#x6570;&#x636E;&#xFF0C;&#x5BFC;&#x81F4;&#x5185;&#x5B58;&#x547D;&#x4E2D;&#x7387;&#x6025;&#x5267;&#x964D;&#x4F4E;&#xFF0C;&#x5F71;&#x54CD;&#x6570;&#x636E;&#x5E93;&#x6027;&#x80FD;</li>
<li>&#x53EF;&#x4EE5;&#x5728;&#x4E3B;&#x8868;&#x4E2D;&#x5B58;&#x50A8;&#x7D22;&#x5F15;,&#x5229;&#x7528;&#x7D22;&#x5F15;&#x5230;&#x660E;&#x7EC6;&#x8868;&#x5177;&#x4F53;&#x67E5;&#x8BE2;</li>
<li>&#x5BF9;&#x4E8E;&#x5927;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x5185;&#x5BB9;,&#x53EF;&#x4EE5;&#x5728;&#x4E3B;&#x8868;&#x4E2D;&#x5B58;&#x50A8; MD5 &#x6458;&#x8981;&#x8FDB;&#x884C;&#x5339;&#x914D;</li>
<li>&#x4E0D;&#x5141;&#x8BB8;&#x5BF9;&#x5927;&#x5B57;&#x6BB5;&#x8FDB;&#x884C;&#x5217;&#x8868;&#x67E5;&#x8BE2;</li>
<li>&#x5BF9;&#x4E8E;&#x56FE;&#x7247;&#x3001;&#x97F3;&#x9891;&#x7B49;,&#x53EF;&#x4EE5;&#x5B58;&#x653E;&#x5728; OSS &#x4E0A;,&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x5B58; URI</li>
</ul>
<p>2.8 &#x539F;&#x5219;&#x4E0A;&#x7981;&#x6B62;&#x4F7F;&#x7528;&#x6D6E;&#x70B9;&#x7C7B;&#x578B;</p>
<ul>
<li>&#x6D6E;&#x70B9;&#x6570;&#x548C;&#x673A;&#x5668;&#x7CBE;&#x5EA6;&#x76F8;&#x5173;,&#x5BB9;&#x6613;&#x5BFC;&#x81F4;&#x504F;&#x5DEE;</li>
<li>&#x4E00;&#x5B9A;&#x8981;&#x4F7F;&#x7528;&#x5C0F;&#x6570;&#x5FC5;&#x987B;&#x4F7F;&#x7528; decimal &#x7C7B;&#x578B;</li>
</ul>
<p>2.9 &#x5FC5;&#x987B;&#x4F7F;&#x7528; varchar(20 &#x6216; 50)&#x5B58;&#x50A8;&#x624B;&#x673A;&#x53F7;</p>
<ul>
<li>&#x6D89;&#x53CA;&#x5230;&#x533A;&#x53F7;&#x6216;&#x8005;&#x56FD;&#x5BB6;&#x4EE3;&#x53F7;&#xFF0C;&#x53EF;&#x80FD;&#x51FA;&#x73B0;+-()</li>
<li>&#x624B;&#x673A;&#x53F7;&#x5E76;&#x4E0D;&#x4F1A;&#x505A;&#x6570;&#x5B66;&#x8FD0;&#x7B97;</li>
<li>varchar &#x53EF;&#x4EE5;&#x652F;&#x6301;&#x6A21;&#x7CCA;&#x67E5;&#x8BE2;</li>
</ul>
<p>2.11 &#x5FC5;&#x987B;&#x5305;&#x542B;&#x663E;&#x5F0F;&#x4E3B;&#x952E;</p>
<ul>
<li>&#x4E3B;&#x952E;&#x63A8;&#x8350;&#x4E3A;&#x6574;&#x6570;,&#x4E14;&#x5FC5;&#x987B;&#x8BBE;&#x7F6E;&#x81EA;&#x589E;, &#x81EA;&#x589E;&#x4ECE; 10000 &#x5F00;&#x59CB;</li>
<li>&#x7981;&#x6B62;&#x4F7F;&#x7528; varchar &#x4F5C;&#x4E3A;&#x4E3B;&#x952E;</li>
<li>&#x7981;&#x6B62;&#x4F7F;&#x7528;&#x590D;&#x5408;&#x5217;&#x4F5C;&#x4E3A;&#x4E3B;&#x952E;</li>
</ul>
<p>2.12 &#x7981;&#x6B62;&#x4F7F;&#x7528;&#x5916;&#x952E;</p>
<ul>
<li>&#x5916;&#x952E;&#x903B;&#x8F91;&#x5728;&#x7A0B;&#x5E8F;&#x91CC;&#x5904;&#x7406;</li>
</ul>
<p>2.13 &#x5EFA;&#x8BAE;&#x4F7F;&#x7528; InnoDB &#x5B58;&#x50A8;&#x5F15;&#x64CE;</p>
<ul>
<li>&#x5F53;&#x524D;&#x4E1A;&#x52A1;&#x6765;&#x770B;&#x4E0D;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x5176;&#x5B83;&#x5F15;&#x64CE;</li>
<li>InnoDB &#x5F15;&#x64CE;&#x652F;&#x6301;&#x4E8B;&#x52A1;&#x3001;&#x884C;&#x7EA7;&#x9501;&#x3001;&#x5E76;&#x53D1;&#x6027;&#x80FD;&#x66F4;&#x597D;&#x3001;CPU &#x53CA;&#x5185;&#x5B58;&#x7F13;&#x5B58;&#x9875;&#x4F18;&#x5316;&#x4F7F;&#x5F97;&#x8D44;&#x6E90;&#x5229;&#x7528;&#x7387;&#x66F4;&#x9AD8;</li>
<li>&#x6211;&#x4EEC;&#x7684; RDS &#x9ED8;&#x8BA4;&#x5C31;&#x662F; InnoDB &#x5F15;&#x64CE;,&#x4E0D;&#x6307;&#x5B9A;&#x5373;&#x53EF;</li>
</ul>
<p>2.14 &#x5FC5;&#x987B;&#x4F7F;&#x7528; UTF-8 &#x5B57;&#x7B26;&#x96C6;</p>
<ul>
<li>&#x6211;&#x4EEC;&#x7684; RDS &#x9ED8;&#x8BA4;&#x5C31;&#x662F; UTF-8 &#x5B57;&#x7B26;&#x96C6;</li>
<li>&#x5982;&#x679C;&#x9700;&#x8981;&#x5B58;&#x50A8;&#x8868;&#x60C5;&#x5B57;&#x7B26;,&#x5219;&#x9700;&#x8981;&#x663E;&#x5F0F;&#x6307;&#x5B9A;&#x4E3A; UTF-8-mb4</li>
</ul>
<p>2.15 &#x6570;&#x636E;&#x8868;&#x3001;&#x6570;&#x636E;&#x5B57;&#x6BB5;&#x5FC5;&#x987B;&#x52A0;&#x5165;&#x4E2D;&#x6587;&#x6CE8;&#x91CA;</p>
<ul>
<li>&#x8868;&#x7ED3;&#x6784;&#x662F;&#x9700;&#x8981;&#x7ED9;&#x5176;&#x4ED6;&#x4EBA;&#x6216;&#x540E;&#x6765;&#x7EF4;&#x62A4;&#x8005;&#x770B;&#x7684;</li>
<li>&#x7279;&#x522B;&#x6CE8;&#x610F;&#x4FEE;&#x6539;&#x5B57;&#x6BB5;&#x4E4B;&#x540E;&#x8981;&#x540C;&#x65F6;&#x4FEE;&#x6539;&#x6CE8;&#x91CA;</li>
</ul>
<p>2.16 &#x7981;&#x6B62;&#x4F7F;&#x7528;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x3001;&#x89E6;&#x53D1;&#x5668;&#x3001;Event</p>
<ul>
<li>&#x9AD8;&#x5E76;&#x53D1;&#x5927;&#x6570;&#x636E;&#x7684;&#x4E92;&#x8054;&#x7F51;&#x4E1A;&#x52A1;&#xFF0C;&#x67B6;&#x6784;&#x8BBE;&#x8BA1;&#x601D;&#x8DEF;&#x662F;&#x201C;&#x89E3;&#x653E;&#x6570;&#x636E;&#x5E93; CPU&#xFF0C;&#x5C06;&#x8BA1;&#x7B97;&#x8F6C;&#x79FB;&#x5230;&#x670D;&#x52A1;&#x5C42;&#x201D;&#xFF0C;&#x5E76;&#x53D1;&#x91CF;&#x5927;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8FD9;&#x4E9B;&#x529F;&#x80FD;&#x5F88;&#x53EF;&#x80FD;&#x5C06;&#x6570;&#x636E;&#x5E93;&#x62D6;&#x6B7B;&#xFF0C;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x653E;&#x5230;&#x670D;&#x52A1;&#x5C42;&#x5177;&#x5907;&#x66F4;&#x597D;&#x7684;&#x6269;&#x5C55;&#x6027;&#xFF0C;&#x80FD;&#x591F;&#x8F7B;&#x6613;&#x5B9E;&#x73B0;&#x201C;&#x589E;&#x673A;&#x5668;&#x5C31;&#x52A0;&#x6027;&#x80FD;&#x201D;&#x3002;&#x6570;&#x636E;&#x5E93;&#x64C5;&#x957F;&#x5B58;&#x50A8;&#x4E0E;&#x7D22;&#x5F15;&#xFF0C;CPU &#x8BA1;&#x7B97;&#x8FD8;&#x662F;&#x4E0A;&#x79FB;&#x5427;</li>
<li>RDS &#x672C;&#x8EAB;&#x5BF9;&#x8FD9;&#x4E9B;&#x529F;&#x80FD;&#x7684;&#x652F;&#x6301;&#x6709;&#x4E00;&#x5B9A;&#x7684;&#x5C40;&#x9650;&#x6027;</li>
<li>&#x53EF;&#x4EE5;&#x4E00;&#x5B9A;&#x7A0B;&#x5EA6;&#x4F7F;&#x7528;&#x89C6;&#x56FE;</li>
</ul>
<p>2.18 &#x8868;&#x540D;&#x548C;&#x5B57;&#x6BB5;&#x540D;&#x547D;&#x540D;&#x89C4;&#x8303;</p>
<ul>
<li>&#x90FD;&#x7EDF;&#x4E00;&#x4F7F;&#x7528;&#x5927;&#x5199;,&#x4E0B;&#x5212;&#x7EBF;&#x98CE;&#x683C;,&#x4E0D;&#x8D85;&#x8FC7; 30 &#x4E2A;&#x5B57;,&#x6839;&#x636E;&#x4E1A;&#x52A1;&#x547D;&#x540D;,&#x4E0D;&#x5F97;&#x4E2D;&#x82F1;&#x6DF7;&#x7528;</li>
<li>&#x82F1;&#x6587;&#x5C3D;&#x91CF;&#x4E0D;&#x8981;&#x4F7F;&#x7528;&#x7F29;&#x5199;</li>
<li>&#x8868;&#x540D;&#x5982;&#x679C;&#x662F;&#x82F1;&#x6587;&#x547D;&#x540D;&#x8BF7;&#x4F7F;&#x7528;&#x5355;&#x6570;</li>
</ul>
<p>2.19 &#x539F;&#x5219;&#x4E0A;&#x8868;&#x5B57;&#x6BB5;&#x5FC5;&#x987B;&#x5C0F;&#x4E8E; 30 &#x4E2A; l &#x8FC7;&#x591A;&#x5B57;&#x6BB5;&#x5E94;&#x8BE5;&#x8003;&#x8651;&#x4F7F;&#x7528;&#x6269;&#x5C55;&#x8868;</p>
<ul>
<li>&#x8BE5;&#x89C4;&#x5219;&#x6839;&#x672C;&#x76EE;&#x7684;&#x662F;&#x4E3A;&#x4E86;&#x9632;&#x6B62;&#x8868;&#x8FC7;&#x5927;</li>
<li>&#x5982;&#x679C;&#x6BCF;&#x4E2A;&#x5B57;&#x6BB5;&#x90FD;&#x5F88;&#x8F7B;,&#x53EF;&#x4EE5;&#x5141;&#x8BB8;&#x8D85;&#x51FA;</li>
<li>&#x4ECE;&#x5176;&#x4ED6;&#x6570;&#x636E;&#x5E93;&#x540C;&#x6B65;&#x3001;&#x5176;&#x4ED6;&#x65B9;&#x5F0F;&#x5BFC;&#x5165;&#x7B49;&#x573A;&#x666F;&#x4F8B;&#x5916;</li>
</ul>
<p>2.20 &#x56FA;&#x5B9A;&#x957F;&#x5EA6;&#x5B57;&#x7B26;&#x5217;&#x5C3D;&#x91CF;&#x4F7F;&#x7528;&#x5B9A;&#x957F; char</p>
<ul>
<li>&#x5BF9;&#x4E8E;&#x6570;&#x636E;&#x5927;&#x591A;&#x5728;&#x56FA;&#x5B9A;&#x957F;&#x5EA6;&#x8303;&#x56F4;&#x7684; varchar &#x53EF;&#x8F6C;&#x6362;&#x4E3A; char</li>
<li>&#x4F7F;&#x7528; char &#x7684;&#x65F6;&#x5019;&#x5FC5;&#x987B;&#x662F; not null</li>
</ul>
<p>2.21 &#x5B57;&#x6BB5;&#x8981;&#x9002;&#x5F53;&#x5197;&#x4F59;</p>
<ul>
<li>&#x6253;&#x7834;&#x8303;&#x5F0F;&#x8BBE;&#x8BA1;,&#x9002;&#x5F53;&#x5197;&#x4F59;&#x907F;&#x514D;&#x5927;&#x91CF;&#x67E5;&#x8BE2;,&#x1A00;&#x9AD8;&#x67E5;&#x8BE2;&#x6027;&#x80FD;</li>
<li>&#x5197;&#x4F59;&#x7684;&#x5B57;&#x6BB5;&#x5E94;&#x8BE5;&#x66F4;&#x65B0;&#x4E0D;&#x4F1A;&#x8FC7;&#x4E8E;&#x9891;&#x7E41;,&#x6216;&#x8005;&#x6709;&#x624B;&#x6BB5;&#x80FD;&#x8BA9;&#x5176;&#x66F4;&#x65B0;&#x4E0D;&#x9891;&#x7E41;</li>
</ul>
<p>2.22 &#x5BF9;&#x4E8E;&#x5355;&#x8868;&#x6570;&#x636E;&#x8D85;&#x8FC7; 300 &#x4E07;&#x884C;&#x624D;&#x5141;&#x8BB8;&#x5206;&#x5E93;&#x5206;&#x8868;</p>
<ul>
<li>&#x8BBE;&#x8BA1;&#x65F6;&#x5E94;&#x8BC4;&#x4F30;&#x4E09;&#x5E74;&#x5185;&#x7684;&#x6570;&#x636E;&#x91CF;&#x60C5;&#x51B5;,&#x80FD;&#x8FBE;&#x5230; 300 &#x4E07;&#x884C;&#x6570;&#x636E;&#x7684;&#x624D;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x5206;&#x5E93;&#x5206;&#x8868;</li>
<li>&#x5BF9;&#x4E8E;&#x672C;&#x8EAB;&#x6570;&#x636E;&#x91CF;&#x4E0D;&#x5927;&#x7684;&#x8868;&#x4E25;&#x7981;&#x5206;&#x5E93;&#x5206;&#x8868;</li>
</ul>
<p>2.23 &#x9009;&#x62E9;&#x9002;&#x5F53;&#x7684;&#x5B58;&#x50A8;&#x957F;&#x5EA6;</p>
<ul>
<li>&#x6DF1;&#x5165;&#x4E86;&#x89E3;&#x4E1A;&#x52A1;,&#x6839;&#x636E;&#x4E1A;&#x52A1;&#x573A;&#x666F;&#x9009;&#x62E9;&#x5408;&#x9002;&#x7684;&#x957F;&#x5EA6;,&#x80FD;&#x7701;&#x5219;&#x7701;</li>
<li>&#x5BF9;&#x4E8E; varchar &#x7B49;&#x53EF;&#x6269;&#x5C55;&#x683C;&#x5F0F;,&#x4E0D;&#x5B9C;&#x5728;&#x6700;&#x521D;&#x5C31;&#x8BBE;&#x5B9A;&#x4E00;&#x4E2A;&#x8D85;&#x957F;&#x503C;</li>
<li>&#x5728;&#x9009;&#x62E9;&#x957F;&#x5EA6;&#x65F6;&#x5E94;&#x8003;&#x8651;&#x5404;&#x7CFB;&#x7EDF;&#x6807;&#x51C6;&#x89C4;&#x8303;,&#x5982;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x5728; windows &#x4E0B;&#x6807;&#x51C6;&#x4E3A; 255</li>
<li>&#x4E5F;&#x8981;&#x8003;&#x8651;&#x6A2A;&#x5411;&#x7B2C;&#x4E09;&#x65B9;&#x7CFB;&#x7EDF;&#x517C;&#x5BB9;&#x6027;,&#x8001;&#x65E7;&#x7CFB;&#x7EDF;&#x517C;&#x5BB9;&#x6027;,&#x7279;&#x522B;&#x662F;&#x91D1;&#x4E09;&#x7CFB;&#x7EDF;</li>
</ul>
<p>2.24 &#x5B57;&#x6BB5;&#x547D;&#x540D;&#x4E0E;&#x53D6;&#x957F;&#x5C3D;&#x529B;&#x4FDD;&#x6301;&#x5DF2;&#x77E5;&#x4E60;&#x60EF;</p>
<ul>
<li>&#x4E1A;&#x5185;&#x77E5;&#x540D;&#x7684;&#x5FC5;&#x987B;&#x4F7F;&#x7528;,&#x5982; qymc&#x3001;nsrsbh&#x3001;shxydm &#x7B49; l &#x5927;&#x5BB6;&#x5DF2;&#x7ECF;&#x4E60;&#x60EF;&#x7684;&#x5F3A;&#x70C8;&#x5EFA;&#x8BAE;&#x4FDD;&#x6301;,&#x6BD4;&#x5982; xxsx(&#x663E;&#x5F0F;&#x987A;&#x5E8F;)&#x3001;node_id &#x7B49; l &#x76EE;&#x524D;&#x7CFB;&#x7EDF;&#x8BB0;&#x5F55;&#x4F5C;&#x8005;&#x5B57;&#x6BB5;&#x91C7;&#x7528;&#x4E86; varchar(30),&#x90A3;&#x4E48;&#x540E;&#x7EED;&#x5E94;&#x5C3D;&#x91CF;&#x4F7F;&#x7528;&#x8BE5;&#x957F;&#x5EA6;</li>
</ul>
<h2 id="&#x4E09;-SQL-&#x8BED;&#x53E5;&#x89C4;&#x8303;"><a href="#&#x4E09;-SQL-&#x8BED;&#x53E5;&#x89C4;&#x8303;" class="headerlink" title="&#x4E09;. SQL &#x8BED;&#x53E5;&#x89C4;&#x8303;"></a>&#x4E09;. SQL &#x8BED;&#x53E5;&#x89C4;&#x8303;</h2><p>3.1 SQL &#x8BED;&#x53E5;&#x8981;&#x5C3D;&#x53EF;&#x80FD;&#x7B80;&#x5355;</p>
<ul>
<li>&#x4E00;&#x6761; SQL &#x53EA;&#x80FD;&#x5728;&#x4E00;&#x4E2A; CPU &#x4E2D;&#x8FD0;&#x7B97;,&#x4E00;&#x6761;&#x5927;&#x7684; SQL &#x53EF;&#x4EE5;&#x957F;&#x671F;&#x5360;&#x6709; CPU &#x6700;&#x7EC8;&#x4F1A;&#x5835;&#x6B7B;&#x6574;&#x4E2A;&#x6570;&#x636E;&#x5E93;,&#x4E14;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x4E2D;&#x65AD;&#x5904;&#x7406;&#x63AA;&#x65BD;.</li>
<li>&#x628A;&#x5927;&#x8BED;&#x53E5;&#x62C6;&#x6210;&#x5C0F;&#x8BED;&#x53E5;,&#x901A;&#x8FC7;&#x4EE3;&#x7801;&#x903B;&#x8F91;&#x591A;&#x6B21;&#x6267;&#x884C;,&#x51CF;&#x5C11;&#x9501;&#x65F6;&#x95F4;</li>
<li>&#x5982;&#x679C;&#x6D89;&#x53CA;&#x5230;&#x4E8B;&#x52A1;,&#x66F4;&#x52A0;&#x8981;&#x6CE8;&#x610F;&#x4E8B;&#x52A1;&#x8981;&#x5C3D;&#x53EF;&#x80FD;&#x7684;&#x5C0F;,&#x6267;&#x884C;&#x65F6;&#x95F4;&#x77ED;,&#x6BD4;&#x5982;&#x4E0A;&#x4F20;&#x56FE;&#x7247;&#x3001;&#x52A0;&#x5DE5;&#x8868;&#x6570;&#x636E;&#x5C31;&#x51B3;&#x4E0D;&#x80FD;&#x4F7F;&#x7528;&#x4E8B;&#x52A1;,&#x5E26;&#x4E8B;&#x52A1;&#x7684;&#x5904;&#x7406;&#x5FC5;&#x987B;&#x5728; 100ms &#x4EE5;&#x5185;</li>
<li>&#x5728; DRDS &#x6A21;&#x5F0F;&#x4E0B;,&#x7981;&#x6B62;&#x4F7F;&#x7528;&#x89E6;&#x53D1;&#x5668;&#x548C;&#x51FD;&#x6570;,&#x5728; SQL &#x91CC;&#x4E5F;&#x4E0D;&#x5141;&#x8BB8;&#x51FA;&#x73B0;&#x81EA;&#x5B9A;&#x4E49;&#x51FD;&#x6570;,&#x5B98;&#x65B9;&#x51FD;&#x6570;&#x9664;&#x805A;&#x5408;&#x51FD;&#x6570;&#x4E4B;&#x5916;&#x4E5F;&#x5E94;&#x8BE5;&#x5C3D;&#x91CF;&#x5C11;&#x4F7F;&#x7528;</li>
<li>&#x6240;&#x6709; SQL &#x5FC5;&#x987B;&#x5728; 1000ms &#x5185;&#x8FD4;&#x56DE;,&#x539F;&#x5219;&#x4E0A;&#x5728; 100ms &#x5185;&#x8FD4;&#x56DE;</li>
</ul>
<p>3.2 &#x7981;&#x6B62;&#x4F7F;&#x7528; SELECT *</p>
<ul>
<li>SELECT &#x4F1A;&#x989D;&#x5916;&#x6D88;&#x8017; CPU&#x3001;IO&#x3001;&#x7F51;&#x7EDC;&#x8D44;&#x6E90;</li>
<li>SELECT * &#x4E5F;&#x4E0D;&#x5229;&#x4E8E;&#x7A0B;&#x5E8F;&#x6269;&#x5C55;&#x6027;,&#x4E00;&#x65E6;&#x5B57;&#x6BB5;&#x53D8;&#x52A8;&#x7A0B;&#x5E8F;&#x5C31;&#x4F1A;&#x51FA;&#x73B0;&#x95EE;&#x9898;</li>
<li>&#x4E0D;&#x80FD;&#x6709;&#x6548;&#x7684;&#x5229;&#x7528;&#x8986;&#x76D6;&#x7D22;&#x5F15;</li>
</ul>
<p>3.3 limit &#x9AD8;&#x6548;&#x5206;&#x9875;</p>
<ul>
<li>limit &#x8D8A;&#x5927;&#xFF0C;&#x6548;&#x7387;&#x8D8A;&#x4F4E;,&#x6240;&#x4EE5;&#x5F53;&#x5B58;&#x5728;&#x5F88;&#x5927;&#x7684; limit &#x60C5;&#x51B5;&#x65F6;&#x5E94;&#x8003;&#x8651;&#x901A;&#x8FC7;&#x7EBF;&#x6027; ID&#x6765;&#x53D6;&#x5DE7;&#x8BBE;&#x8BA1;.select id from t limit 1000000, 10; &#x53EF;&#x4EE5;&#x6539;&#x4E3A; =&gt;select id from t where id &gt; 1000000 limit 10;</li>
<li>&#x5F53; limit &#x8D77;&#x59CB;&#x4E3A;&#x5F88;&#x5927;&#x6570;&#x65F6;,&#x5E94;&#x8003;&#x8651;&#x4E1A;&#x52A1;&#x4E0A;&#x7ED9;&#x4E88;&#x9650;&#x5236;,&#x6BD4;&#x5982;&#x5206;&#x9875;&#x7ED3;&#x679C;&#x5E94;&#x8BE5;&#x9650;&#x5236;&#x6700;&#x591A;&#x7FFB;&#x5230; 1000 &#x9875;.</li>
</ul>
<p>3.4 &#x5EFA;&#x8BAE;&#x4F7F;&#x7528; union all &#x66FF;&#x4EE3; union</p>
<ul>
<li>union &#x6709;&#x53BB;&#x91CD;&#x5F00;&#x9500;,&#x9996;&#x5148;&#x4E1A;&#x52A1;&#x4E0A;&#x67E5;&#x8BE2;&#x65F6;&#x5C31;&#x4E0D;&#x5E94;&#x8BE5;&#x5B58;&#x5728;&#x91CD;&#x590D;,&#x786E;&#x6709;&#x91CD;&#x590D;&#x53EF;&#x4EE5;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x53BB;&#x9664;</li>
<li>&#x5927;&#x591A;&#x6570;&#x4E1A;&#x52A1;&#x573A;&#x666F;&#x90FD;&#x53EF;&#x4EE5;&#x5728;&#x4E1A;&#x52A1;&#x7AEF;&#x4FDD;&#x8BC1;&#x4E0D;&#x91CD;&#x590D;</li>
<li>&#x8981;&#x6B63;&#x786E;&#x8BA4;&#x8BC6;&#x548C;&#x5728;&#x6B63;&#x786E;&#x573A;&#x666F;&#x4E0B;&#x5206;&#x522B;&#x4F7F;&#x7528; union all &#x548C; union</li>
</ul>
<p>3.5 &#x7EDF;&#x4E00;&#x4F7F;&#x7528; count(*)</p>
<ul>
<li>count(*)&#x662F; SQL &#x6807;&#x51C6;&#x5199;&#x6CD5;</li>
<li>count(*)&#x4F1A;&#x7EDF;&#x8BA1;&#x503C;&#x4E3A; NULL &#x7684;&#x884C;&#xFF0C;&#x800C; count(&#x5217;&#x540D;)&#x4E0D;&#x4F1A;&#x7EDF;&#x8BA1;,&#x4F46;&#x662F;&#x51FA;&#x73B0;&#x7EDF;&#x8BA1;&#x975E; NULL &#x884C;&#x8FD9;&#x79CD;&#x4E1A;&#x52A1;&#x672C;&#x8EAB;&#x5C31;&#x4E0D;&#x5408;&#x7406;</li>
<li>&#x4E00;&#x5B9A;&#x8981;&#x7EDF;&#x8BA1;&#x6307;&#x5B9A;&#x5217;&#x975E;&#x7A7A;&#x573A;&#x666F;&#x5219;&#x81F3;&#x5C11;&#x5E94;&#x8BE5;&#x4F7F;&#x7528; count(distinct &#x5217;&#x540D;)</li>
</ul>
<p>3.6 JOIN &#x4F7F;&#x7528;&#x89C4;&#x8303;</p>
<ul>
<li>&#x5C3D;&#x91CF;&#x4E0D;&#x7528;&#x8FDE;&#x63A5; JOIN,&#x4FDD;&#x6301;&#x5355;&#x8868;&#x67E5;&#x8BE2;</li>
<li>JOIN &#x8FDE;&#x63A5;&#x5B57;&#x6BB5;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x4FDD;&#x6301;&#x4E00;&#x81F4;,&#x907F;&#x514D;&#x7C7B;&#x578B;&#x8F6C;&#x6362;,&#x751A;&#x81F3;&#x5168;&#x8868;&#x626B;&#x19FF;</li>
<li>JOIN &#x8FDE;&#x63A5;&#x5B57;&#x6BB5;&#x539F;&#x5219;&#x5EFA;&#x8BAE;&#x90FD;&#x5E26;&#x6709;&#x7D22;&#x5F15;,&#x4E3B;&#x8868;&#x4FA7;&#x5FC5;&#x987B;&#x5E26;&#x6709;&#x7D22;&#x5F15;</li>
<li>&#x8868;&#x5F88;&#x5C0F;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x53EF;&#x4EE5;&#x6CA1;&#x6709;&#x7D22;&#x5F15;,&#x4FDD;&#x6301;&#x7D22;&#x5F15;&#x533A;&#x5206;&#x5EA6;</li>
<li>&#x539F;&#x5219;&#x4E0A;&#x7981;&#x6B62; 3 &#x5F20;&#x81EA;&#x5EFA;&#x4E1A;&#x52A1;&#x8868;&#x4EE5;&#x4E0A;&#x7684; JOIN</li>
<li>&#x7981;&#x6B62;&#x5927;&#x8868;&#x4F7F;&#x7528; JOIN,&#x4F1A;&#x4EA7;&#x751F;&#x5927;&#x91CF;&#x4E34;&#x65F6;&#x8868;,&#x6781;&#x5927;&#x6D88;&#x8017;&#x6570;&#x636E;&#x5E93;&#x5185;&#x5B58;</li>
</ul>
<p>3.7 &#x7981;&#x6B62;&#x4F7F;&#x7528; OR</p>
<ul>
<li>RDS &#x5BF9; OR &#x5B50;&#x53E5;&#x7684;&#x652F;&#x6301;&#x5F88;&#x5DEE;,&#x867D;&#x7136; MySQL &#x540E;&#x7EED;&#x7248;&#x672C;&#x5DF2;&#x7ECF;&#x4F18;&#x5316;,&#x4F46;&#x662F;&#x5F53;&#x524D; RDS&#x8FD8;&#x662F;&#x5B58;&#x5728;&#x4E25;&#x91CD; OR &#x5B50;&#x53E5;&#x95EE;&#x9898;</li>
<li>&#x53EF;&#x4EE5;&#x628A; OR &#x6539;&#x5199;&#x4E3A; IN &#x5B50;&#x53E5;&#x6216;&#x8005; UNION &#x5B50;&#x53E5;</li>
</ul>
<p>3.8 &#x7981;&#x6B62;&#x4F7F;&#x7528; INSERT INTO &#x8868;&#x540D; VALUES(xxx)</p>
<ul>
<li>&#x5FC5;&#x987B;&#x663E;&#x793A;&#x6307;&#x5B9A;&#x63D2;&#x5165;&#x7684;&#x5217;&#x6E05;&#x5355;,&#x5BB9;&#x6613;&#x5728;&#x589E;&#x52A0;&#x6216;&#x8005;&#x5220;&#x9664;&#x5B57;&#x6BB5;&#x540E;&#x51FA;&#x73B0;&#x7A0B;&#x5E8F; BUG</li>
</ul>
<p>3.9 &#x7981;&#x6B62;&#x4F7F;&#x7528;&#x5C5E;&#x6027;&#x9690;&#x5F0F;&#x8F6C;&#x6362;</p>
<ul>
<li>&#x7981;&#x6B62;&#x67E5;&#x8BE2;&#x65F6;&#x7C7B;&#x578B;&#x4E0D;&#x5339;&#x914D;,&#x5982;&#x6570;&#x636E;&#x5E93;&#x662F;&#x5B57;&#x7B26;&#x4E32;&#x7C7B;&#x578B;,&#x67E5;&#x8BE2;&#x65F6;&#x7ED9;&#x4E86; int &#x7C7B;&#x578B;,&#x4F1A;&#x5BFC;&#x81F4;&#x5168;&#x8868;&#x626B;&#x6BD4;&#x5982;: SELECT xxx FROM &#x8868;&#x540D; WHERE &#x5B57;&#x7B26;&#x4E32;&#x7C7B;=123456</li>
</ul>
<p>3.10 &#x7981;&#x6B62;&#x5728; WHERE &#x6761;&#x4EF6;&#x7684;&#x5C5E;&#x6027;&#x4E0A;&#x4F7F;&#x7528;&#x51FD;&#x6570;&#x6216;&#x8005;&#x8868;&#x8FBE;&#x5F0F;</p>
<ul>
<li>&#x5E94;&#x8BE5;&#x5BF9;&#x6761;&#x4EF6;&#x503C;&#x4F7F;&#x7528;&#x51FD;&#x6570;&#x800C;&#x4E0D;&#x662F;&#x5BF9;&#x6761;&#x4EF6;&#x5217;&#x4F7F;&#x7528;&#x51FD;&#x6570;,&#x7981;&#x6B62;&#x5BF9;&#x6761;&#x4EF6;&#x5217;&#x4F7F;&#x7528;&#x51FD;&#x6570; &#x5982;:SELECT xxx FROM &#x8868;&#x540D; WHERE from_unixtime(day)&gt;=&#x2019;2017-02-15&#x2019;&#x6B63;&#x786E;&#x7684;&#x5199;&#x6CD5;&#x662F;:SELECT xxx FROM &#x8868;&#x540D; WHERE day&gt;= unix_timestamp(&#x2018;2017-02-15&#x2019;)</li>
</ul>
<p>3.11 &#x7981;&#x6B62;&#x8D1F;&#x5411;&#x67E5;&#x8BE2;</p>
<ul>
<li>&#x8D1F;&#x5411;&#x67E5;&#x8BE2;&#x6761;&#x4EF6;&#xFF1A;NOT&#x3001;!=&#x3001;&lt;&gt;&#x3001;!&lt;&#x3001;!&gt;&#x3001;NOT IN&#x3001;NOT LIKE &#x7B49;&#xFF0C;&#x4F1A;&#x5BFC;&#x81F4;&#x5168;&#x8868;&#x626B;</li>
</ul>
<p>3.12 &#x7981;&#x6B62;&#x5DE6;&#x6A21;&#x7CCA;&#x5339;&#x914D;</p>
<ul>
<li>%&#x5F00;&#x5934;&#x7684;&#x5DE6;&#x6A21;&#x7CCA;&#x67E5;&#x8BE2;&#x65E0;&#x6CD5;&#x5229;&#x7528;&#x7D22;&#x5F15;,&#x4F1A;&#x5BFC;&#x81F4;&#x5168;&#x8868;&#x626B;</li>
</ul>
<p>3.13 &#x4F7F;&#x7528; ISNULL()&#x6765;&#x5224;&#x65AD;&#x662F;&#x5426; NULL &#x503C; l NULL = NULL &#x7684;&#x7ED3;&#x679C;&#x8FD4;&#x56DE;&#x503C;&#x662F; NULL &#x800C;&#x4E0D;&#x662F; true</p>
<ul>
<li>NULL=1 &#x7684;&#x7ED3;&#x679C;&#x8FD4;&#x56DE;&#x503C;&#x662F; NULL &#x800C;&#x4E0D;&#x662F; true</li>
<li>&#x5BF9; null &#x7684;&#x5904;&#x7406;&#x65F6;&#x5019;&#xFF0C;&#x53EA;&#x80FD;&#x91C7;&#x7528; is null &#x6216; is not null&#xFF0C;&#x800C;&#x4E0D;&#x80FD;&#x91C7;&#x7528;=&#x3001;in&#x3001;&lt;&#x3001;&lt;&gt;&#x3001;!=&#x3001;not in &#x8FD9;&#x4E9B;&#x64CD;&#x4F5C;&#x7B26;&#x53F7;&#x3002;&#x5982;&#xFF1A;WHERE name != &#x2019;zhuyungao&#x2019;&#xFF0C;&#x5982;&#x679C;&#x5B58;&#x5728; name &#x4E3A;null &#x503C;&#x7684;&#x8BB0;&#x5F55;&#xFF0C;&#x67E5;&#x8BE2;&#x7ED3;&#x679C;&#x5C31;&#x4E0D;&#x4F1A;&#x5305;&#x542B; name &#x4E3A; null &#x503C;&#x7684;&#x8BB0;&#x5F55;</li>
</ul>
<p>3.14 &#x67E5;&#x8BE2;&#x5C3D;&#x91CF;&#x5229;&#x7528;&#x7D22;&#x5F15;</p>
<ul>
<li>&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#x9700;&#x6CE8;&#x610F; where &#x6761;&#x4EF6;&#x4EE5;&#x53CA;&#x6392;&#x5E8F;&#x3001;&#x5206;&#x7EC4;,&#x6BD4;&#x5982;&#x6709;&#x8054;&#x5408;&#x7D22;&#x5F15; idx_a_b_c<br>where a=1 and b=2 and c=3 &#x53EF;&#x4EE5;&#x5B8C;&#x5168;&#x5229;&#x7528;&#x7D22;&#x5F15;<br>where a=1 and c=3 and b=2 &#x4E5F;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x7D22;&#x5F15;,&#x4F46;&#x662F;&#x9700;&#x8981;&#x4E00;&#x5C42;&#x5185;&#x5B58;&#x8F6C;&#x6362;&#x6D88;&#x8017;<br>where a=1 and b&gt;2 and c=3 &#x4EC5;&#x53EF;&#x4EE5;&#x5229;&#x7528; a&#x3001;b &#x5217;&#x7D22;&#x5F15;<br>where a=1 and b like &#x2018;hello%&#x2019; order by 3 &#x4EC5;&#x53EF;&#x4EE5;&#x5229;&#x7528; a&#x3001;b &#x5217;&#x7D22;&#x5F15;<br>where a=1 and b=2 group by c &#x53EF;&#x4EE5;&#x5229;&#x7528; a&#x3001;b&#x3001;c &#x5217;&#x7D22;&#x5F15;</li>
<li>&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x6267;&#x884C;&#x8BA1;&#x5212;&#x786E;&#x8BA4;&#x7D22;&#x5F15;&#x4F7F;&#x7528;&#x60C5;&#x51B5;<br>*&#x81F3;&#x5C11;&#x9700;&#x8981;&#x8FBE;&#x5230; range &#x7EA7;&#x522B;&#x4EE5;&#x4E0A;</li>
</ul>
<p>3.15 &#x7981;&#x6B62;&#x4F7F;&#x7528; DELETE &#x8BED;&#x53E5;<br>*&#x4E1A;&#x52A1;&#x8868;&#x6570;&#x636E;&#x90FD;&#x901A;&#x8FC7;&#x8F6F;&#x5220;&#x9664;&#x6765;&#x5904;&#x7406;</p>
<ul>
<li>DELETE &#x8BED;&#x53E5;&#x4E00;&#x5F8B;&#x8FD0;&#x7EF4;&#x64CD;&#x4F5C;&#x6267;&#x884C;</li>
</ul>
<p>3.16 &#x6570;&#x636E;&#x5E93;&#x4E00;&#x6B21;&#x67E5;&#x8BE2;&#x884C;&#x6570;&#x5FC5;&#x987B;&#x5C0F;&#x4E8E; 1000 &#x884C; l &#x8D85;&#x8FC7; 1000 &#x884C;&#x4E00;&#x5B9A;&#x8981;&#x5206;&#x9875;&#x67E5;&#x8BE2;<br>3.17 &#x7981;&#x6B62; IN &#x914D;&#x5408; SQL &#x5B50;&#x53E5;<br>*IN (params),&#x5FC5;&#x987B;&#x4FDD;&#x8BC1; params &#x4E3A;&#x5E38;&#x91CF;&#x503C;,&#x800C;&#x4E0D;&#x80FD;&#x662F; SQL &#x5B50;&#x53E5;</p>
<ul>
<li>&#x5C3D;&#x91CF;&#x5E94;&#x8F6C;&#x6362;&#x4E3A; JOIN &#x67E5;&#x8BE2;</li>
</ul>
<p>3.18 SQL &#x4E2D;&#x4E0D;&#x5141;&#x8BB8;&#x51FA;&#x73B0;&#x5BC6;&#x94A5;&#x6216;&#x5BC6;&#x7801;</p>
<ul>
<li>&#x53EF;&#x4EE5;&#x5148;&#x4F7F;&#x7528;&#x5360;&#x4F4D;&#x7B26;&#x4EE3;&#x66FF;&#x5728;&#x79C1;&#x804A;&#x7ED9;&#x6570;&#x636E;&#x5E93;&#x6267;&#x884C;&#x4EBA;</li>
</ul>
<h2 id="&#x56DB;-&#x7D22;&#x5F15;&#x89C4;&#x8303;"><a href="#&#x56DB;-&#x7D22;&#x5F15;&#x89C4;&#x8303;" class="headerlink" title="&#x56DB;. &#x7D22;&#x5F15;&#x89C4;&#x8303;"></a>&#x56DB;. &#x7D22;&#x5F15;&#x89C4;&#x8303;</h2><p>4.1 &#x552F;&#x4E00;&#x7279;&#x6027;&#x7EC4;&#x5408;&#x5B57;&#x6BB5;&#x5FC5;&#x987B;&#x6709;&#x7D22;&#x5F15;</p>
<ul>
<li>&#x4E1A;&#x52A1;&#x4E0A;&#x552F;&#x4E00;&#x7684;&#x5355;&#x4E2A;&#x5B57;&#x6BB5;&#x5FC5;&#x987B;&#x52A0;&#x4E0A;&#x552F;&#x4E00;&#x7D22;&#x5F15;</li>
<li>&#x4E1A;&#x52A1;&#x4E0A;&#x591A;&#x4E2A;&#x5B57;&#x6BB5;&#x7EC4;&#x5408;&#x903B;&#x8F91;&#x552F;&#x4E00;&#x5FC5;&#x987B;&#x52A0;&#x4E0A;&#x8054;&#x5408;&#x552F;&#x4E00;&#x7D22;&#x5F15;,&#x4E0D;&#x80FD;&#x4EC5;&#x5728;&#x7A0B;&#x5E8F;&#x91CC;&#x903B;&#x8F91;&#x4FDD;&#x8BC1;</li>
</ul>
<p>4.2 JOIN &#x5217;&#x5FC5;&#x987B;&#x6709;&#x7D22;&#x5F15;</p>
<ul>
<li>JOIN &#x5217;&#x4E0A;&#x52A1;&#x5FC5;&#x6709;&#x7D22;&#x5F15;&#x4E14;&#x7C7B;&#x578B;&#x76F8;&#x540C;,&#x9632;&#x6B62;&#x5168;&#x8868;&#x626B;&#x19FF;</li>
</ul>
<p>4.3 &#x5C3D;&#x91CF;&#x4E0D;&#x8981;&#x5728; varchar &#x4E0A;&#x5EFA;&#x7ACB;&#x7D22;&#x5F15;</p>
<ul>
<li>&#x5728; varchar &#x5B57;&#x6BB5;&#x4E0A;&#x9700;&#x8981;&#x7D22;&#x5F15;&#x8BF4;&#x660E;&#x8868;&#x8BBE;&#x8BA1;&#x5B58;&#x5728;&#x4E00;&#x5B9A;&#x7684;&#x7F3A;&#x9677;&#x6216;&#x4E1A;&#x52A1;&#x6D41;&#x7A0B;&#x4E3A;&#x80FD;&#x7406;&#x6E05;</li>
<li>&#x4E00;&#x5B9A;&#x8981;&#x5728; varchar &#x4E0A;&#x5EFA;&#x7ACB;&#x7D22;&#x5F15;&#x5219;&#x5FC5;&#x987B;&#x6307;&#x5B9A;&#x7D22;&#x5F15;&#x957F;&#x5EA6;</li>
</ul>
<p>4.4 &#x8054;&#x5408;&#x7D22;&#x5F15;&#x987A;&#x5E8F;&#x89C4;&#x8303;</p>
<ul>
<li>&#x8054;&#x5408;&#x7D22;&#x5F15;&#x9996;&#x5148;&#x6309;&#x7167;&#x5E38;&#x4F7F;&#x7528;&#x7684;&#x4E1A;&#x52A1;&#x67E5;&#x8BE2;&#x987A;&#x5E8F;&#x6392;&#x5217;,&#x9002;&#x5F53;&#x8C03;&#x6574;&#x4E1A;&#x52A1;&#x67E5;&#x8BE2;&#x987A;&#x5E8F;</li>
<li>&#x518D;&#x8005;&#x6309;&#x7167;&#x5217;&#x7684;&#x533A;&#x5206;&#x7A0B;&#x5EA6;&#x9AD8;&#x4F4E;&#x987A;&#x5E8F;&#x6392;&#x5217;,&#x533A;&#x5206;&#x7A0B;&#x5EA6;&#x9AD8;&#x7684;&#x4E00;&#x5B9A;&#x8981;&#x5728;&#x524D;</li>
<li>ORDER BY &#x7684;&#x5B57;&#x6BB5;&#x653E;&#x5728;&#x8054;&#x5408;&#x7D22;&#x5F15;&#x6700;&#x540E;,&#x9632;&#x6B62; file_sort</li>
</ul>
<p>4.5 &#x5355;&#x8868;&#x7D22;&#x5F15;&#x4E0D;&#x5F97;&#x8D85;&#x8FC7; 5 &#x4E2A; l &#x53EF;&#x4EE5;&#x8003;&#x8651;&#x4F7F;&#x7528;&#x8054;&#x5408;&#x7D22;&#x5F15;&#x5408;&#x5E76;&#x591A;&#x4E2A;&#x7D22;&#x5F15;,MySQL &#x4E2D;&#x8054;&#x5408;&#x7D22;&#x5F15;&#x652F;&#x6301;&#x5DE6;&#x5339;&#x914D;<br>4.6 &#x4E00;&#x4E2A;&#x7D22;&#x5F15;&#x7684;&#x5B57;&#x6BB5;&#x4E0D;&#x5F97;&#x8D85;&#x8FC7; 6 &#x4E2A; l &#x4E00;&#x4E2A;&#x4E1A;&#x52A1;&#x7279;&#x6027;&#x9700;&#x8981;&#x7D22;&#x5F15; 6 &#x4E2A;&#x5217;&#x6765;&#x533A;&#x5206;,&#x672C;&#x8EAB;&#x5C31;&#x5B58;&#x5728;&#x95EE;&#x9898;<br>4.7 &#x5EFA;&#x7ACB;&#x7D22;&#x5F15;&#x7684;&#x533A;&#x5206;&#x5EA6;&#x5FC5;&#x987B;&#x5C0F;&#x4E8E;&#x5343;&#x5206;&#x4E4B;&#x4E00;</p>
<ul>
<li>&#x7D22;&#x5F15;&#x80FD;&#x5B9A;&#x4F4D;&#x5230;&#x7684;&#x884C;&#x5360;&#x603B;&#x884C;&#x7684;&#x5343;&#x5206;&#x4E4B;&#x4E00;&#x4EE5;&#x4E0B;</li>
<li>&#x533A;&#x5206;&#x5EA6;&#x4F4E;&#x7684;&#x7D22;&#x5F15;&#x4E0D;&#x4EC5;&#x4E0D;&#x80FD;&#x1A00;&#x9AD8;&#x67E5;&#x8BE2;&#x6548;&#x7387;,&#x53CD;&#x800C;&#x5927;&#x5E45;&#x964D;&#x4F4E;&#x63D2;&#x5165;&#x6548;&#x7387;</li>
<li>&#x8986;&#x76D6;&#x8BB0;&#x5F55;&#x6761;&#x6570;&#x8FC7;&#x591A;&#x7684;&#x5217;&#x7EDD;&#x4E0D;&#x80FD;&#x5EFA;&#x7D22;&#x5F15;&#xFF0C;&#x4F8B;&#x5982;&#x201C;&#x6027;&#x522B;&#x201D;</li>
</ul>
<p>4.8 &#x7D22;&#x5F15;&#x547D;&#x540D;&#x89C4;&#x8303;</p>
<ul>
<li>&#x552F;&#x4E00;&#x7D22;&#x5F15;&#x4F7F;&#x7528; uk_xxxx,&#x6839;&#x636E;&#x4E1A;&#x52A1;&#x53D6;&#x540D;,&#x4E0D;&#x5F97;&#x4E2D;&#x82F1;&#x6DF7;&#x5408;,&#x4E0D;&#x5F97;&#x8D85;&#x8FC7; 32 &#x4E2A;&#x5B57;</li>
<li>&#x5176;&#x5B83;&#x7D22;&#x5F15;&#x4F7F;&#x7528; idx_xxxx,&#x6839;&#x636E;&#x4E1A;&#x52A1;&#x53D6;&#x540D;,&#x4E0D;&#x5F97;&#x4E2D;&#x82F1;&#x6DF7;&#x5408;,&#x4E0D;&#x5F97;&#x8D85;&#x8FC7; 32 &#x4E2A;&#x5B57;</li>
</ul>
<h2 id="&#x4E94;-&#x4E1A;&#x52A1;&#x7C7B;&#x89C4;&#x8303;"><a href="#&#x4E94;-&#x4E1A;&#x52A1;&#x7C7B;&#x89C4;&#x8303;" class="headerlink" title="&#x4E94;. &#x4E1A;&#x52A1;&#x7C7B;&#x89C4;&#x8303;"></a>&#x4E94;. &#x4E1A;&#x52A1;&#x7C7B;&#x89C4;&#x8303;</h2><p>5.1 &#x4E1A;&#x52A1;&#x8868;&#x524D;&#x7F00;&#x6307;&#x5B9A;</p>
<ul>
<li>A&#x4E1A;&#x52A1;&#x8868;&#x7EDF;&#x4E00;&#x4F7F;&#x7528;&#x524D;&#x7F00; A_ l</li>
</ul>
<p>5.2 &#x4E1A;&#x52A1;&#x8868;&#x5FC5;&#x987B;&#x5305;&#x542B;&#x5B57;&#x6BB5;</p>
<ul>
<li>&#x5FC5;&#x987B;&#x5305;&#x542B; creator &#x5B57;&#x6BB5;,&#x7528;&#x4E8E;&#x8BB0;&#x5F55;&#x884C;&#x521B;&#x5EFA;&#x4EBA;,&#x4E0D;&#x7528;&#x4E8E;&#x4E1A;&#x52A1;&#x8BB0;&#x5F55;</li>
<li>&#x5FC5;&#x987B;&#x5305;&#x542B; creator_date &#x5B57;&#x6BB5;,&#x7528;&#x4E8E;&#x8BB0;&#x5F55;&#x884C;&#x521B;&#x5EFA;&#x65F6;&#x95F4;,&#x4E0D;&#x7528;&#x4E8E;&#x4E1A;&#x52A1;&#x8BB0;&#x5F55;</li>
<li>&#x5FC5;&#x987B;&#x5305;&#x542B; modifier &#x5B57;&#x6BB5;,&#x7528;&#x4E8E;&#x8BB0;&#x5F55;&#x884C;&#x4FEE;&#x6539;&#x4EBA;</li>
<li>&#x5FC5;&#x987B;&#x5305;&#x542B; modification_date &#x5B57;&#x6BB5;,&#x7528;&#x4E8E;&#x8BB0;&#x5F55;&#x884C;&#x4FEE;&#x6539;&#x65F6;&#x95F4;</li>
<li>&#x62FC;&#x97F3;&#x6A21;&#x5F0F;&#x4E0B;&#x4E3A; cjr&#x3001;cjsj&#x3001;xgr&#x3001;xgsj</li>
</ul>
<p>5.3 &#x4E1A;&#x52A1;&#x5B57;&#x6BB5;&#x547D;&#x540D;&#x89C4;&#x8303;</p>
<ul>
<li>&#x624B;&#x673A;&#x53F7;&#x7801;&#x7EDF;&#x4E00;&#x82F1;&#x6587;&#x4F7F;&#x7528; mobile&#x3001;&#x62FC;&#x97F3;&#x7EDF;&#x4E00;&#x4F7F;&#x7528; sjhm</li>
<li>&#x542F;&#x7528;&#x6807;&#x8BB0;&#x7EDF;&#x4E00;&#x82F1;&#x6587;&#x4F7F;&#x7528; enabled&#x3001;&#x62FC;&#x97F3;&#x7EDF;&#x4E00;&#x4F7F;&#x7528; qybj</li>
</ul>
<p>5.4 &#x52A0;&#x5BC6;&#x7C7B;&#x89C4;&#x8303;</p>
<ul>
<li>&#x53CD;&#x5C04; Bean &#x548C; Mapper &#x6587;&#x4EF6;&#x65F6;&#x5FC5;&#x987B;&#x4F7F;&#x7528;&#x516C;&#x53F8;&#x7684;&#x53CD;&#x5C04;&#x5DE5;&#x5177;</li>
<li>&#x516C;&#x53F8;&#x7684;&#x53CD;&#x5C04;&#x5DE5;&#x5177;&#x901A;&#x8FC7;&#x5B57;&#x6BB5;&#x6CE8;&#x91CA;&#x6765;&#x533A;&#x5206;&#x91C7;&#x7528;&#x4F55;&#x79CD;&#x65B9;&#x5F0F;&#x52A0;&#x5BC6;&#x5E76;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x52A0;&#x89E3;&#x5BC6; TypeHandler</li>
<li>#CryptBase36#&#x4EE3;&#x8868;&#x52A0;&#x5BC6;&#x7ED3;&#x679C;&#x96C6;&#x5728; 26 &#x4E2A;&#x5B57;&#x6BCD;+10 &#x4E2A;&#x6570;&#x5B57;&#x8303;&#x56F4;&#x5185;</li>
<li>#CryptBase52#&#x4EE3;&#x8868;&#x52A0;&#x5BC6;&#x7ED3;&#x679C;&#x96C6;&#x5728; 52 &#x4E2A;&#x5B57;&#x6BCD;+10 &#x4E2A;&#x6570;&#x5B57;&#x8303;&#x56F4;&#x5185;</li>
<li>#CryptSimple#&#x52A0;&#x5BC6;&#x7ED3;&#x679C;&#x5728;&#x5B57;&#x7B26;&#x4E32;&#x8303;&#x56F4;&#x5185;</li>
</ul>
<h2 id="&#x516D;-&#x7A0B;&#x5E8F;&#x4F7F;&#x7528;&#x89C4;&#x8303;"><a href="#&#x516D;-&#x7A0B;&#x5E8F;&#x4F7F;&#x7528;&#x89C4;&#x8303;" class="headerlink" title="&#x516D;. &#x7A0B;&#x5E8F;&#x4F7F;&#x7528;&#x89C4;&#x8303;"></a>&#x516D;. &#x7A0B;&#x5E8F;&#x4F7F;&#x7528;&#x89C4;&#x8303;</h2><p>6.1 &#x7981;&#x6B62;&#x4F7F;&#x7528; Mybatis &#x7684;&#x90E8;&#x5206;&#x7528;&#x6CD5;</p>
<ul>
<li>&#x7981;&#x6B62;&#x4F7F;&#x7528; association &#x5173;&#x952E;&#x5B57;</li>
<li>&#x7981;&#x6B62;&#x4F7F;&#x7528; collection &#x4F5C;&#x4E3A;&#x6620;&#x5C04;&#x4E2D;&#x5173;&#x952E;&#x5B57;</li>
<li>&#x7981;&#x6B62;&#x4F7F;&#x7528; select &#x4F5C;&#x4E3A;&#x7ED3;&#x679C;&#x6620;&#x5C04;&#x4E2D;&#x5173;&#x952E;&#x5B57;</li>
</ul>
<h2 id="&#x4E03;-&#x5176;&#x4ED6;&#x89C4;&#x8303;"><a href="#&#x4E03;-&#x5176;&#x4ED6;&#x89C4;&#x8303;" class="headerlink" title="&#x4E03;. &#x5176;&#x4ED6;&#x89C4;&#x8303;"></a>&#x4E03;. &#x5176;&#x4ED6;&#x89C4;&#x8303;</h2><p>7.1 &#x6570;&#x636E;&#x5E93;&#x5BA1;&#x6279;&#x6D41;&#x7A0B;&#x9644;&#x4EF6;&#x5FC5;&#x987B;&#x4EE5;.sql &#x7ED3;&#x5C3E;</p>
<ul>
<li>SQL &#x5FC5;&#x987B;&#x4EE5;&#x9644;&#x4EF6;&#x5F62;&#x5F0F;&#x51FA;&#x73B0;</li>
<li>&#x9644;&#x4EF6;&#x5FC5;&#x987B;&#x4EE5;.sql &#x7ED3;&#x5C3E;</li>
</ul>
<p>7.2 &#x8868;&#x7ED3;&#x6784;&#x4FEE;&#x6539;&#x5FC5;&#x987B;&#x8BF4;&#x660E;&#x76EE;&#x7684;</p>
<ul>
<li>&#x6D89;&#x53CA;&#x5230;&#x7ED3;&#x6784;&#x4FEE;&#x6539;&#x5E94;&#x8BF4;&#x660E;&#x4FEE;&#x6539;&#x76EE;&#x7684;&#x3001;&#x8BBE;&#x8BA1;&#x601D;&#x7EF4;</li>
<li>&#x53E6;&#x9700;&#x5BF9;&#x6BD4;&#x8BF4;&#x660E;&#x539F;&#x6765;&#x4E3A;&#x4F55;&#x5982;&#x6B64;&#x8BBE;&#x8BA1;&#x3001;&#x73B0;&#x5728;&#x8FD9;&#x6837;&#x6539;&#x5E26;&#x6765;&#x7684;&#x597D;&#x5904;</li>
</ul>
<p>7.3 &#x5BA1;&#x6279;&#x6D41;&#x7A0B;&#x4EC5;&#x6307;&#x6267;&#x884C;&#x751F;&#x4EA7;&#x5E93;</p>
<ul>
<li>&#x5F00;&#x53D1;&#x5E93;&#x53EF;&#x4EE5;&#x7531;&#x5F00;&#x53D1;&#x81EA;&#x884C;&#x6267;&#x884C;</li>
<li>&#x6D4B;&#x8BD5;&#x5E93;&#x5728;&#x4E8B;&#x4E1A;&#x90E8;&#x8D1F;&#x8D23;&#x4EBA;&#x540C;&#x610F;&#x60C5;&#x51B5;&#x4E0B;&#x53EF;&#x81EA;&#x884C;&#x6267;&#x884C;</li>
</ul>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/095b9daaf3aaaea5a111f04da84c514f.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7035650968460984327.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7035650968460984327.html" itemprop="url">【Redis】重学主从模式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-11-28T23:59:19+08:00">
                2021-11-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x8FD9;&#x662F;&#x6211;&#x53C2;&#x4E0E;11&#x6708;&#x66F4;&#x6587;&#x6311;&#x6218;&#x7684;&#x7B2C;27&#x5929;&#xFF0C;&#x6D3B;&#x52A8;&#x8BE6;&#x60C5;&#x67E5;&#x770B;&#xFF1A;<a href="https://dev.newban.cn/7023643374569816095">2021&#x6700;&#x540E;&#x4E00;&#x6B21;&#x66F4;&#x6587;&#x6311;&#x6218;</a></p>
<h2 id="&#x4E00;&#x3001;&#x6982;&#x8FF0;"><a href="#&#x4E00;&#x3001;&#x6982;&#x8FF0;" class="headerlink" title="&#x4E00;&#x3001;&#x6982;&#x8FF0;"></a>&#x4E00;&#x3001;&#x6982;&#x8FF0;</h2><blockquote>
<p>&#x5373;&#x4F7F;&#x7528;&#x4E86; <code>AOF</code> &#x548C; <code>RDB</code>&#xFF0C;<strong>&#x5355;&#x673A; <code>Redis</code></strong> &#x4E5F;&#x4F9D;&#x7136;&#x5B58;&#x5728;&#x670D;&#x52A1;&#x4E0D;&#x53EF;&#x7528;&#x7684;&#x95EE;&#x9898;&#x3002;<br>&#x4F8B;&#x5982;&#xFF1A;&#x4E00;&#x4E2A; <code>Redis</code> &#x5B9E;&#x4F8B;&#x5B95;&#x673A;&#x4E86;&#xFF0C;&#x4E4B;&#x540E;&#x5728;&#x6062;&#x590D;&#x671F;&#x95F4;&#xFF0C;&#x662F;&#x65E0;&#x6CD5;&#x670D;&#x52A1;&#x65B0;&#x6765;&#x7684;&#x6570;&#x636E;&#x3002;</p>
</blockquote>
<p><strong><code>Redis</code> &#x5177;&#x6709;&#x9AD8;&#x53EF;&#x9760;&#x6027;&#xFF0C;&#x610F;&#x5473;&#x7740;&#xFF1A;</strong></p>
<ol>
<li><strong>&#x6570;&#x636E;&#x5C3D;&#x91CF;&#x5C11;&#x4E22;&#x5931;</strong>&#xFF1A;<code>AOF</code> &#x548C; <code>RDB</code> &#x4FDD;&#x8BC1;&#x4E86;&#x3002;</li>
<li><strong>&#x670D;&#x52A1;&#x5C3D;&#x91CF;&#x5C11;&#x4E2D;&#x65AD;</strong>&#xFF1A;&#x589E;&#x52A0;&#x526F;&#x672C;&#x5197;&#x4F59;&#x91CF;&#x3002;</li>
</ol>
<blockquote>
<p>&#x5373;&#x5C06;&#x4E00;&#x4EFD;&#x6570;&#x636E;&#x540C;&#x65F6;&#x4FDD;&#x5B58;&#x5728;&#x591A;&#x4E2A;&#x5B9E;&#x4F8B;&#x4E0A;&#x3002;<br>&#x5373;&#x4F7F;&#x6709;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;&#x51FA;&#x73B0;&#x4E86;&#x6545;&#x969C;&#xFF0C;&#x9700;&#x8981;&#x8FC7;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x624D;&#x80FD;&#x6062;&#x590D;&#xFF0C;&#x5176;&#x4ED6;&#x5B9E;&#x4F8B;&#x4E5F;&#x53EF;&#x4EE5;&#x5BF9;&#x5916;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#xFF0C;&#x4E0D;&#x4F1A;&#x5F71;&#x54CD;&#x4E1A;&#x52A1;&#x4F7F;&#x7528;&#x3002;</p>
</blockquote>
<p><strong>&#x5355;&#x673A;&#x7684; <code>redis</code> &#x51E0;&#x4E4E;&#x4E0D;&#x592A;&#x53EF;&#x80FD; <code>QPS</code> &#x8D85;&#x8FC7; 10w&#x3002;</strong></p>
<blockquote>
<p>&#x8981;&#x63D0;&#x9AD8;&#x5E76;&#x53D1;&#xFF0C;&#x4E00;&#x822C;&#x7684;&#x65B9;&#x6848;&#x662F; <strong>&#x8BFB;&#x5199;&#x5206;&#x79BB;</strong>&#x3002;</p>
</blockquote>
<p><strong>&#x591A;&#x5B9E;&#x4F8B;&#x4FDD;&#x5B58;&#x540C;&#x4E00;&#x4EFD;&#x6570;&#x636E;&#xFF0C;&#x5C31;&#x4F1A;&#x5B58;&#x5728;&#x591A;&#x5B9E;&#x4F8B;&#xFF08;&#x526F;&#x672C;&#xFF09;&#x4E4B;&#x95F4;&#x7684;&#x6570;&#x636E;&#x5982;&#x4F55;&#x4FDD;&#x6301;&#x4E00;&#x81F4;&#x6027;&#x95EE;&#x9898;&#xFF1F;</strong></p>
<blockquote>
<p><code>Redis</code> &#x63D0;&#x4F9B;&#x4E86;&#x4E3B;&#x4ECE;&#x6A21;&#x5F0F;&#xFF0C;&#x4EE5;&#x4FDD;&#x8BC1;&#x6570;&#x636E;&#x526F;&#x672C;&#x7684;&#x4E00;&#x81F4;&#xFF0C;&#x4E3B;&#x4ECE;&#x5E93;&#x4E4B;&#x95F4;&#x91C7;&#x7528;&#x8BFB;&#x5199;&#x5206;&#x79BB;&#x65B9;&#x5F0F;&#xFF1A;</p>
<ol>
<li><strong>&#x8BFB;&#x64CD;&#x4F5C;</strong>&#xFF1A;&#x4E3B;&#x5E93;&#x3001;&#x4ECE;&#x5E93;&#x8BFB;&#x53EF;&#x4EE5;&#x63A5;&#x6536;&#x3002;&#xFF08;&#x4E3B;&#x8981;&#x662F;&#x4ECE;&#x5E93;&#xFF09;</li>
<li><strong>&#x5199;&#x64CD;&#x4F5C;</strong>&#xFF1A;&#x9996;&#x5148;&#x5230;&#x4E3B;&#x5E93;&#x6267;&#x884C;&#xFF0C;&#x4E4B;&#x540E;&#x4E3B;&#x5E93;&#x540C;&#x6B65;&#x7ED9;&#x4ECE;&#x5E93;<br><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/beedc62bf8f003d46d2d537d2d6b328afffddc5f62e017ac9dc77716d382ca23" alt="2021-11-2716-32-37.png"></li>
</ol>
</blockquote>
<p>&#x90A3;&#x4E48;&#x95EE;&#x9898;&#x6765;&#x4E86;&#xFF1A;&#x4E3B;&#x4ECE;&#x5E93;&#x540C;&#x6B65;&#x662F;&#x5982;&#x4F55;&#x5B8C;&#x6210;&#x7684;&#x5462;&#xFF1F;</p>
<h3 id="&#x4E3B;&#x4ECE;&#x5E93;&#x540C;&#x6B65;"><a href="#&#x4E3B;&#x4ECE;&#x5E93;&#x540C;&#x6B65;" class="headerlink" title="&#x4E3B;&#x4ECE;&#x5E93;&#x540C;&#x6B65;"></a>&#x4E3B;&#x4ECE;&#x5E93;&#x540C;&#x6B65;</h3><p>&#x5148;&#x6765;&#x4E86;&#x89E3;&#x4E0B;&#xFF0C;<code>Redis</code> &#x4E3B;&#x4ECE;&#x5E93;&#x540C;&#x6B65;&#x4E09;&#x79CD;&#x6A21;&#x5F0F;&#xFF1A;</p>
<ul>
<li>&#x5168;&#x91CF;&#x590D;&#x5236;</li>
<li>&#x57FA;&#x4E8E;&#x957F;&#x8FDE;&#x63A5;&#x7684;&#x547D;&#x4EE4;&#x4F20;&#x64AD;</li>
<li>&#x589E;&#x91CF;&#x590D;&#x5236;</li>
</ul>
<p>&#x542F;&#x52A8;&#x591A;&#x4E2A; <code>Redis</code> &#x5B9E;&#x4F8B;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>replicaof</code> &#xFF08;<code>Redis 5.0</code> &#x4E4B;&#x524D;&#x4F7F;&#x7528; <code>slaveof</code>&#xFF09;&#x547D;&#x4EE4;&#x6765;&#x5F62;&#x6210;&#x4E3B;&#x5E93;&#x548C;&#x4ECE;&#x5E93;&#x5173;&#x7CFB;&#x3002;</p>
<p><strong>&#x4E3E;&#x4E2A;&#x6817;&#x5B50;&#xFF1A;</strong></p>
<ul>
<li>&#x5B9E;&#x4F8B;1 &#xFF08;<code>ip</code>: <code>172.16.19.3</code>&#xFF09;</li>
<li>&#x5B9E;&#x4F8B;2 &#xFF08;<code>ip</code>&#xFF1A;<code>172.16.19.5</code>&#xFF09;</li>
</ul>
<p>&#x5728;&#x5B9E;&#x4F8B;2&#x4E0A;&#x6267;&#x884C; <code>replicaof</code> &#x547D;&#x4EE4;&#xFF0C;&#x4F7F;&#x5B9E;&#x4F8B;2&#x53D8;&#x4E3A;&#x5B9E;&#x4F8B;1&#x7684;&#x4ECE;&#x5E93;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&#x590D;&#x5236;&#x4EE3;&#x7801;replicaof  172.16.19.3  6379</span><br></pre></td></tr></table></figure>

<p><strong>&#x4E3B;&#x4ECE;&#x5E93;&#x6570;&#x636E;&#x540C;&#x6B65;&#x7684;&#x4E09;&#x4E2A;&#x9636;&#x6BB5;&#xFF0C;&#x5982;&#x4E0B;&#xFF1A;</strong></p>
<ul>
<li>&#x7B2C;&#x4E00;&#x9636;&#x6BB5;&#xFF1A;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#xFF0C;&#x534F;&#x5546;&#x540C;&#x6B65;</li>
<li>&#x7B2C;&#x4E8C;&#x9636;&#x6BB5;&#xFF1A;&#x4E3B;&#x5E93;&#x540C;&#x6B65;&#x6570;&#x636E;&#x7ED9;&#x4ECE;&#x5E93;</li>
<li>&#x7B2C;&#x4E09;&#x9636;&#x6BB5;&#xFF1A;&#x4E3B;&#x5E93;&#x53D1;&#x9001;&#x65B0;&#x5199;&#x547D;&#x4EE4;&#x7ED9;&#x4ECE;&#x5E93;<br><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/8f1405516731524d799b8745ba346cd0f88b1495a175a23ffc697d9bb22ed37c" alt="2021-11-2716-46-21.png"></li>
</ul>
<h4 id="&#x7B2C;&#x4E00;&#x9636;&#x6BB5;&#xFF1A;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#xFF0C;&#x534F;&#x5546;&#x540C;&#x6B65;"><a href="#&#x7B2C;&#x4E00;&#x9636;&#x6BB5;&#xFF1A;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#xFF0C;&#x534F;&#x5546;&#x540C;&#x6B65;" class="headerlink" title="&#x7B2C;&#x4E00;&#x9636;&#x6BB5;&#xFF1A;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#xFF0C;&#x534F;&#x5546;&#x540C;&#x6B65;"></a>&#x7B2C;&#x4E00;&#x9636;&#x6BB5;&#xFF1A;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#xFF0C;&#x534F;&#x5546;&#x540C;&#x6B65;</h4><p>&#x7B2C;&#x4E00;&#x9636;&#x6BB5;&#xFF1A;&#x662F;&#x4E3B;&#x4ECE;&#x5E93;&#x95F4;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x3001;&#x534F;&#x5546;&#x540C;&#x6B65;&#x7684;&#x8FC7;&#x7A0B;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x4E3A;&#x5168;&#x91CF;&#x590D;&#x5236;&#x505A;&#x51C6;&#x5907;&#x3002;</p>
<ol>
<li><strong>&#x4ECE;&#x5E93;&#x53D1;&#x9001;&#x547D;&#x4EE4; <code>psync</code>&#xFF1A;</strong><br>&#x4ECE;&#x5E93;&#x4F1A;&#x53D1;&#x9001; <code>psync</code> &#x547D;&#x4EE4;&#xFF08;&#x8868;&#x793A;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x540C;&#x6B65;&#xFF09;&#x7ED9;&#x4E3B;&#x5E93;&#xFF0C;&#x4E3B;&#x5E93;&#x4F1A;&#x6839;&#x636E;&#x547D;&#x4EE4;&#x7684;&#x53C2;&#x6570;&#x6765;&#x8FDB;&#x884C;&#x590D;&#x5236;&#x3002;<br><code>psync</code> &#x547D;&#x4EE4;&#x5305;&#x542B;&#x4E86;&#x4E3B;&#x5E93;&#x7684; <code>runID</code> &#x548C; &#x590D;&#x5236;&#x8FDB;&#x5EA6; <code>offset</code>&#xFF1A;</li>
</ol>
<ul>
<li><code>runID</code>&#xFF1A;&#x662F;&#x6BCF;&#x4E2A; <code>Redis</code> &#x5B9E;&#x4F8B;&#x542F;&#x52A8;&#x65F6;&#x90FD;&#x4F1A;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;&#x4E00;&#x4E2A;&#x968F;&#x673A; <code>ID</code>&#xFF0C;&#x7528;&#x6765;&#x552F;&#x4E00;&#x6807;&#x8BB0;&#x8FD9;&#x4E2A;&#x5B9E;&#x4F8B;&#x3002;</li>
</ul>
<blockquote>
<p>&#x5F53;&#x4ECE;&#x5E93;&#x548C;&#x4E3B;&#x5E93;&#x7B2C;&#x4E00;&#x6B21;&#x590D;&#x5236;&#x65F6;&#xFF0C;&#x56E0;&#x4E3A;&#x4E0D;&#x77E5;&#x9053;&#x4E3B;&#x5E93;&#x7684; <code>runID</code>&#xFF0C;&#x6240;&#x4EE5;&#x5C06; <code>runID</code> &#x8BBE;&#x4E3A;&#x201C;&#xFF1F;&#x201D;&#x3002;</p>
</blockquote>
<ul>
<li><code>offset</code>&#xFF1A;&#x6B64;&#x65F6;&#x8BBE;&#x4E3A; -1&#xFF0C;&#x8868;&#x793A;&#x7B2C;&#x4E00;&#x6B21;&#x590D;&#x5236;&#x3002;</li>
</ul>
<ol start="2">
<li><strong>&#x4E3B;&#x5E93;&#x63A5;&#x6536; <code>psync</code> &#x547D;&#x4EE4;&#x540E;&#xFF1A;&#x4F1A;&#x7528; <code>FULLRESYNC</code> &#x547D;&#x4EE4;&#x8FDB;&#x884C;&#x54CD;&#x5E94;</strong></li>
</ol>
<ul>
<li>&#x4E3B;&#x5E93;&#x4F1A;&#x6267;&#x884C; <code>bgsave</code> &#x547D;&#x4EE4;&#xFF0C;&#x751F;&#x6210;&#x5BF9;&#x5E94;&#x7684; <code>RDB</code> &#x6587;&#x4EF6;&#x3002;</li>
</ul>
<blockquote>
<p><code>FULLRESYNC</code> &#x54CD;&#x5E94;&#x8868;&#x793A;&#x7B2C;&#x4E00;&#x6B21;&#x590D;&#x5236;&#x91C7;&#x7528;&#x7684;&#x5168;&#x91CF;&#x590D;&#x5236;&#x3002;<br>&#x53C2;&#x6570;&#xFF1A;&#x4E3B;&#x5E93; <code>runID</code> &#x548C; &#x4E3B;&#x5E93;&#x76EE;&#x524D;&#x7684;&#x590D;&#x5236;&#x8FDB;&#x5EA6; <code>offset</code></p>
</blockquote>
<h4 id="&#x7B2C;&#x4E8C;&#x9636;&#x6BB5;&#xFF1A;&#x4E3B;&#x5E93;&#x540C;&#x6B65;&#x6570;&#x636E;&#x7ED9;&#x4ECE;&#x5E93;"><a href="#&#x7B2C;&#x4E8C;&#x9636;&#x6BB5;&#xFF1A;&#x4E3B;&#x5E93;&#x540C;&#x6B65;&#x6570;&#x636E;&#x7ED9;&#x4ECE;&#x5E93;" class="headerlink" title="&#x7B2C;&#x4E8C;&#x9636;&#x6BB5;&#xFF1A;&#x4E3B;&#x5E93;&#x540C;&#x6B65;&#x6570;&#x636E;&#x7ED9;&#x4ECE;&#x5E93;"></a>&#x7B2C;&#x4E8C;&#x9636;&#x6BB5;&#xFF1A;&#x4E3B;&#x5E93;&#x540C;&#x6B65;&#x6570;&#x636E;&#x7ED9;&#x4ECE;&#x5E93;</h4><ol>
<li><strong>&#x4ECE;&#x5E93;&#xFF1A;</strong><br>&#x4ECE;&#x5E93;&#x63A5;&#x6536;&#x5230; <code>RDB</code> &#x6587;&#x4EF6;&#x540E;&#xFF0C;&#x4F1A;&#x5148;&#x6E05;&#x7A7A;&#x5F53;&#x524D;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x7136;&#x540E;&#x52A0;&#x8F7D; <code>RDB</code> &#x6587;&#x4EF6;&#x3002;</li>
</ol>
<blockquote>
<p>&#x56E0;&#x4E3A;&#x662F;&#x7B2C;&#x4E00;&#x6B21;&#x5168;&#x91CF;&#x590D;&#x5236;&#xFF0C;&#x6240;&#x4EE5;&#x4ECE;&#x5E93;&#x91CC;&#x4E4B;&#x524D;&#x7684;&#x6570;&#x636E;&#x90FD;&#x662F;&#x810F;&#x6570;&#x636E;&#x3002;</p>
</blockquote>
<ol start="2">
<li><strong>&#x4E3B;&#x5E93;&#xFF1A;</strong><br>&#x4E3B;&#x5E93;&#x4F1A;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x7528;&#x4E13;&#x95E8;&#x7684; <code>replication buffer</code>&#xFF0C;&#x8BB0;&#x5F55; <code>RDB</code> &#x6587;&#x4EF6;&#x751F;&#x6210;&#x540E;&#x6536;&#x5230;&#x7684;&#x6240;&#x6709;&#x5199;&#x64CD;&#x4F5C;&#x3002;</li>
</ol>
<blockquote>
<p>&#x5168;&#x91CF;&#x590D;&#x5236;&#x53EA;&#x662F;&#x5F53;&#x524D;&#x7684;&#x65F6;&#x523B;&#x4E3B;&#x5E93;&#x7684;&#x5168;&#x91CF;&#xFF0C;&#x4E4B;&#x540E;&#x4F1A;&#x6709;&#x589E;&#x91CF;&#x540C;&#x6B65;&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x8BB0;&#x5F55;&#x5165;&#x6BCF;&#x4E2A;&#x4ECE;&#x5E93;&#x7684;&#x8FDB;&#x5EA6;&#x3002;</p>
</blockquote>
<h4 id="&#x7B2C;&#x4E09;&#x9636;&#x6BB5;&#xFF1A;&#x4E3B;&#x5E93;&#x53D1;&#x9001;&#x65B0;&#x5199;&#x547D;&#x4EE4;&#x7ED9;&#x4ECE;&#x5E93;"><a href="#&#x7B2C;&#x4E09;&#x9636;&#x6BB5;&#xFF1A;&#x4E3B;&#x5E93;&#x53D1;&#x9001;&#x65B0;&#x5199;&#x547D;&#x4EE4;&#x7ED9;&#x4ECE;&#x5E93;" class="headerlink" title="&#x7B2C;&#x4E09;&#x9636;&#x6BB5;&#xFF1A;&#x4E3B;&#x5E93;&#x53D1;&#x9001;&#x65B0;&#x5199;&#x547D;&#x4EE4;&#x7ED9;&#x4ECE;&#x5E93;"></a>&#x7B2C;&#x4E09;&#x9636;&#x6BB5;&#xFF1A;&#x4E3B;&#x5E93;&#x53D1;&#x9001;&#x65B0;&#x5199;&#x547D;&#x4EE4;&#x7ED9;&#x4ECE;&#x5E93;</h4><p>&#x8FD9;&#x4E2A;&#x9636;&#x6BB5;&#x662F;&#x589E;&#x91CF;&#x540C;&#x6B65;&#x3002;</p>
<p>&#x5F53;&#x4E3B;&#x4ECE;&#x5E93;&#x5B8C;&#x6210;&#x4E86;&#x5168;&#x91CF;&#x590D;&#x5236;&#xFF0C;&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x5C31;&#x4F1A;&#x4E00;&#x76F4;&#x7EF4;&#x62A4;&#x4E00;&#x4E2A;&#x7F51;&#x7EDC;&#x8FDE;&#x63A5;&#xFF1A;&#x907F;&#x514D;&#x9891;&#x7E41;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x3002;</p>
<ol>
<li><strong>&#x4E3B;&#x5E93;&#xFF1A;</strong><br>&#x540C;&#x6B65;&#x4E4B;&#x540E;&#x7684;&#x5199;&#x547D;&#x4EE4;&#x7ED9;&#x4ECE;&#x5E93;&#x3002;</li>
</ol>
<ul>
<li>&#x53D1;&#x9001;&#x5199;&#x547D;&#x4EE4;</li>
<li>&#x540C;&#x65F6;&#x4F1A;&#x5728; <code>replication buffer</code> &#x4E2D;&#x4FEE;&#x6539;&#x5BF9;&#x5E94;&#x64CD;&#x4F5C;</li>
</ul>
<ol start="2">
<li><strong>&#x4ECE;&#x5E93;&#xFF1A;</strong><br>&#x4ECE;&#x5E93;&#x53EA;&#x9700;&#x63A5;&#x6536;&#x547D;&#x4EE4;&#xFF0C;&#x5728;&#x672C;&#x5730;&#x5185;&#x5B58;&#x4E2D;&#x6267;&#x884C;&#x3002;</li>
</ol>
<h2 id="&#x4E8C;&#x3001;&#x95EE;&#x9898;"><a href="#&#x4E8C;&#x3001;&#x95EE;&#x9898;" class="headerlink" title="&#x4E8C;&#x3001;&#x95EE;&#x9898;"></a>&#x4E8C;&#x3001;&#x95EE;&#x9898;</h2><h3 id="&#xFF08;1&#xFF09;&#x96C6;&#x7FA4;&#x8FC7;&#x5927;&#xFF1A;&#x4E3B;&#x4ECE;&#x7EA7;&#x8054;&#x6A21;&#x5F0F;"><a href="#&#xFF08;1&#xFF09;&#x96C6;&#x7FA4;&#x8FC7;&#x5927;&#xFF1A;&#x4E3B;&#x4ECE;&#x7EA7;&#x8054;&#x6A21;&#x5F0F;" class="headerlink" title="&#xFF08;1&#xFF09;&#x96C6;&#x7FA4;&#x8FC7;&#x5927;&#xFF1A;&#x4E3B;&#x4ECE;&#x7EA7;&#x8054;&#x6A21;&#x5F0F;"></a>&#xFF08;1&#xFF09;&#x96C6;&#x7FA4;&#x8FC7;&#x5927;&#xFF1A;&#x4E3B;&#x4ECE;&#x7EA7;&#x8054;&#x6A21;&#x5F0F;</h3><p><strong>&#x5F53;&#x96C6;&#x7FA4;&#x8FC7;&#x5927;&#x540E;&#xFF0C;&#x5F71;&#x54CD;&#x4E3B;&#x5E93;&#x4E3B;&#x8981;&#x64CD;&#x4F5C;&#x6709;&#xFF1A;</strong></p>
<ol>
<li><code>fork</code> &#x64CD;&#x4F5C;&#xFF1A;&#x5982;&#x679C;&#x4ECE;&#x5E93;&#x6570;&#x91CF;&#x8FC7;&#x591A;&#xFF0C;&#x4E14;&#x90FD;&#x8981;&#x548C;&#x4E3B;&#x5E93;&#x8FDB;&#x884C;&#x5168;&#x91CF;&#x590D;&#x5236;&#xFF0C;&#x5C31;&#x4F1A;&#x5BFC;&#x81F4;&#x4E3B;&#x5E93;&#x5FD9;&#x4E8E; <code>fork</code> &#x5B50;&#x8FDB;&#x7A0B;&#x8FDB;&#x884C; <code>RDB</code> &#x6587;&#x4EF6;&#x3002;</li>
</ol>
<blockquote>
<p><code>fork</code> &#x64CD;&#x4F5C;&#x4F1A;&#x963B;&#x585E;&#x4E3B;&#x7EBF;&#x7A0B;&#x5904;&#x7406;&#x6B63;&#x5E38;&#x8BF7;&#x6C42;&#xFF0C;&#x4ECE;&#x800C;&#x5BFC;&#x81F4;&#x4E3B;&#x5E93;&#x54CD;&#x5E94;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x8BF7;&#x6C42;&#x901F;&#x5EA6;&#x53D8;&#x6162;&#x3002;</p>
</blockquote>
<ol start="2">
<li>&#x4F20;&#x8F93; <code>RDB</code> &#x6587;&#x4EF6;&#xFF1A;&#x5360;&#x7528;&#x4E3B;&#x5E93;&#x7684;&#x7F51;&#x7EDC;&#x5E26;&#x5BBD;</li>
</ol>
<p><strong>&#x4E3A;&#x4E86;&#x5206;&#x62C5;&#x4E3B;&#x5E93;&#x538B;&#x529B;&#xFF1A;&#x53EF;&#x4EE5;&#x91C7;&#x7528; <code>&#x4E3B; - &#x4ECE; - &#x4ECE;</code> &#x6A21;&#x5F0F;&#x3002;</strong></p>
<blockquote>
<p>&#x8BF4;&#x767D;&#x4E86;&#xFF0C;&#x628A;&#x4ECE;&#x5E93;&#x5047;&#x88C5;&#x6210;&#x4E3B;&#x5E93;&#xFF0C;&#x5728;&#x5176;&#x4E0B;&#x5728;&#x8FDB;&#x884C;&#x5173;&#x8054;&#x5B50;&#x4ECE;&#x5E93;&#x3002;</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell&#x590D;&#x5236;&#x4EE3;&#x7801;# &#x547D;&#x4EE4;&#x64CD;&#x4F5C;&#x7C7B;&#x4F3C;&#xFF1A;</span><br><span class="line">replicatof &#x6240;&#x9009;&#x4ECE;&#x5E93;IP 6379</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/2901b1f18af580a11561eb02864a52bf44cba2a6135759abe0341bb576dbd00e" alt="2021-11-2809-23-15.png"></p>
<h3 id="&#xFF08;2&#xFF09;&#x4E3B;&#x4ECE;&#x5E93;&#x65AD;&#x8FDE;&#x4F1A;&#x600E;&#x6837;&#xFF1F;&#x65AD;&#x8FDE;&#x91CD;&#x8FDE;&#x53C8;&#x662F;&#x5982;&#x4F55;&#xFF1F;"><a href="#&#xFF08;2&#xFF09;&#x4E3B;&#x4ECE;&#x5E93;&#x65AD;&#x8FDE;&#x4F1A;&#x600E;&#x6837;&#xFF1F;&#x65AD;&#x8FDE;&#x91CD;&#x8FDE;&#x53C8;&#x662F;&#x5982;&#x4F55;&#xFF1F;" class="headerlink" title="&#xFF08;2&#xFF09;&#x4E3B;&#x4ECE;&#x5E93;&#x65AD;&#x8FDE;&#x4F1A;&#x600E;&#x6837;&#xFF1F;&#x65AD;&#x8FDE;&#x91CD;&#x8FDE;&#x53C8;&#x662F;&#x5982;&#x4F55;&#xFF1F;"></a>&#xFF08;2&#xFF09;&#x4E3B;&#x4ECE;&#x5E93;&#x65AD;&#x8FDE;&#x4F1A;&#x600E;&#x6837;&#xFF1F;&#x65AD;&#x8FDE;&#x91CD;&#x8FDE;&#x53C8;&#x662F;&#x5982;&#x4F55;&#xFF1F;</h3><h4 id="1&#xFF09;&#x4E3B;&#x4ECE;&#x65AD;&#x8FDE;&#xFF1A;&#x53EF;&#x80FD;&#x4F1A;&#x9020;&#x6210;&#x6570;&#x636E;&#x4E0D;&#x4E00;&#x81F4;"><a href="#1&#xFF09;&#x4E3B;&#x4ECE;&#x65AD;&#x8FDE;&#xFF1A;&#x53EF;&#x80FD;&#x4F1A;&#x9020;&#x6210;&#x6570;&#x636E;&#x4E0D;&#x4E00;&#x81F4;" class="headerlink" title="1&#xFF09;&#x4E3B;&#x4ECE;&#x65AD;&#x8FDE;&#xFF1A;&#x53EF;&#x80FD;&#x4F1A;&#x9020;&#x6210;&#x6570;&#x636E;&#x4E0D;&#x4E00;&#x81F4;"></a>1&#xFF09;&#x4E3B;&#x4ECE;&#x65AD;&#x8FDE;&#xFF1A;&#x53EF;&#x80FD;&#x4F1A;&#x9020;&#x6210;&#x6570;&#x636E;&#x4E0D;&#x4E00;&#x81F4;</h4><p><strong>&#x5F53;&#x4E3B;&#x4ECE;&#x5E93;&#x65AD;&#x8FDE;&#x540E;&#xFF1A;</strong></p>
<ol>
<li>&#x4E3B;&#x5E93;&#x4F1A;&#x628A;&#x65AD;&#x8FDE;&#x671F;&#x95F4;&#x6536;&#x5230;&#x7684;&#x5199;&#x64CD;&#x4F5C;&#x547D;&#x4EE4;&#xFF0C;&#x5199;&#x5165; <code>replication buffer</code>&#xFF1A;<strong>&#x5B58;&#x50A8;&#x5199;&#x547D;&#x4EE4;</strong></li>
<li>&#x540C;&#x65F6;&#x4E5F;&#x4F1A;&#x628A;&#x8FD9;&#x4E9B;&#x64CD;&#x4F5C;&#x547D;&#x4EE4;&#x5199;&#x5165; <code>repl_backlog_buffer</code> &#x7F13;&#x51B2;&#x533A;&#xFF1A;<strong>&#x5B58;&#x50A8;&#x8BB0;&#x5F55;</strong></li>
</ol>
<blockquote>
<p><strong><code>repl_backlog_buffer</code> &#x662F;&#x4E00;&#x4E2A;&#x73AF;&#x5F62;&#x7F13;&#x5B58;&#x533A;&#xFF1A;</strong></p>
<ul>
<li>&#x4E3B;&#x5E93;&#x4F1A;&#x8BB0;&#x5F55;&#x81EA;&#x5DF1;&#x5199;&#x9053;&#x7684;&#x4F4D;&#x7F6E;</li>
<li>&#x4ECE;&#x5E93;&#x5219;&#x4F1A;&#x8BB0;&#x5F55;&#x81EA;&#x5DF1;&#x5DF2;&#x7ECF;&#x8BFB;&#x5230;&#x7684;&#x4F4D;&#x7F6E;</li>
</ul>
</blockquote>
<p><strong><code>repl_backlog_buffer</code> &#x662F;&#x4E00;&#x4E2A;&#x73AF;&#x5F62;&#x7F13;&#x51B2;&#x533A;&#xFF0C;&#x5F53;&#x5199;&#x6EE1;&#x4E4B;&#x540E;&#xFF0C;&#x4F1A;&#x8986;&#x76D6;&#x4E4B;&#x524D;&#x5199;&#x5165;&#x7684;&#x64CD;&#x4F5C;&#x3002;</strong></p>
<p>&#x5982;&#x679C;&#x4ECE;&#x5E93;&#x7684;&#x8BFB;&#x53D6;&#x901F;&#x5EA6;&#x6162;&#xFF0C;&#x5C31;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x4ECE;&#x5E93;&#x8FD8;&#x672A;&#x8BFB;&#x53D6;&#xFF0C;&#x4E3B;&#x5E93;&#x5DF2;&#x7ECF;&#x5F00;&#x59CB;&#x8986;&#x76D6;&#x5199;&#x5165;&#x4E86;&#x3002;&#x8FD9;&#x5C31;&#x4F1A;&#x9020;&#x6210;&#x4E3B;&#x4ECE;&#x5E93;&#x95F4;&#x7684;&#x6570;&#x636E;&#x4E0D;&#x4E00;&#x81F4;&#x3002;</p>
<p><strong>&#x4E3A;&#x907F;&#x514D;&#x8FD9;&#x4E00;&#x60C5;&#x51B5;&#xFF0C;&#x9700;&#x8981;&#x6839;&#x636E;&#x5B9E;&#x9645;&#x73AF;&#x5883;&#x8BA1;&#x7B97;&#x51FA;&#x5408;&#x7406;&#x7684;&#x7F13;&#x5B58;&#x533A;&#x5927;&#x5C0F;&#xFF1A;</strong></p>
<ul>
<li>&#x7F13;&#x51B2;&#x7A7A;&#x95F4;&#x7684;&#x8BA1;&#x7B97;&#x516C;&#x5F0F;&#x662F;&#xFF1A;&#x7F13;&#x51B2;&#x7A7A;&#x95F4;&#x5927;&#x5C0F; = &#x4E3B;&#x5E93;&#x5199;&#x5165;&#x547D;&#x4EE4;&#x901F;&#x5EA6; * &#x64CD;&#x4F5C;&#x5927;&#x5C0F; - &#x4E3B;&#x4ECE;&#x5E93;&#x95F4;&#x7F51;&#x7EDC;&#x4F20;&#x8F93;&#x547D;&#x4EE4;&#x901F;&#x5EA6; * &#x64CD;&#x4F5C;&#x5927;&#x5C0F;&#x3002;</li>
<li>&#x5728;&#x5B9E;&#x9645;&#x5E94;&#x7528;&#x4E2D;&#xFF0C;&#x9700;&#x8981;&#x8003;&#x8651;&#x5230;&#x53EF;&#x80FD;&#x5B58;&#x5728;&#x4E00;&#x4E9B;&#x7A81;&#x53D1;&#x7684;&#x8BF7;&#x6C42;&#x538B;&#x529B;&#xFF0C;&#x901A;&#x5E38;&#x9700;&#x8981;&#x628A;&#x8FD9;&#x4E2A;&#x7F13;&#x51B2;&#x7A7A;&#x95F4;&#x6269;&#x5927;&#x4E00;&#x500D;&#xFF0C;&#x5373; <code>repl_backlog_size</code> = &#x7F13;&#x51B2;&#x7A7A;&#x95F4;&#x5927;&#x5C0F; * 2&#x3002;</li>
</ul>
<p><strong>&#x4E3E;&#x4E2A;&#x6817;&#x5B50;&#xFF1A;</strong></p>
<ul>
<li>&#x4E3B;&#x5E93;&#x6BCF;&#x79D2;&#x5199;&#x5165; 2000 &#x4E2A;&#x64CD;&#x4F5C;</li>
<li>&#x6BCF;&#x4E2A;&#x64CD;&#x4F5C;&#x5927;&#x5C0F;&#x4E3A; <code>2KB</code></li>
<li>&#x7F51;&#x7EDC;&#x6BCF;&#x79D2;&#x80FD;&#x4F20;&#x8F93; 1000 &#x4E2A;&#x64CD;&#x4F5C;</li>
</ul>
<p>&#x8FD9;&#x65F6;&#x5019;&#x5C31;&#x6709; 1000 &#x4E2A;&#x64CD;&#x4F5C;&#x9700;&#x8981;&#x7F13;&#x51B2;&#x8D77;&#x6765;&#xFF0C;&#x5C31;&#x81F3;&#x5C11;&#x9700;&#x8981; <code>2MB</code> &#x7684;&#x7F13;&#x51B2;&#x533A;&#xFF08;<code>repl_backlog_size</code>&#xFF09;&#x3002;</p>
<p>&#x4E3A;&#x4E86;&#x5E94;&#x5BF9;&#x53EF;&#x80FD;&#x7684;&#x7A81;&#x53D1;&#x538B;&#x529B;&#xFF0C;&#x53EF;&#x4EE5;&#x628A; <code>repl_backlog_size</code> &#x8BBE;&#x7F6E;&#x4E3A; <code>4MB</code></p>
<h4 id="2&#xFF09;&#x65AD;&#x8FDE;&#x540E;&#x53C8;&#x91CD;&#x8FDE;"><a href="#2&#xFF09;&#x65AD;&#x8FDE;&#x540E;&#x53C8;&#x91CD;&#x8FDE;" class="headerlink" title="2&#xFF09;&#x65AD;&#x8FDE;&#x540E;&#x53C8;&#x91CD;&#x8FDE;"></a>2&#xFF09;&#x65AD;&#x8FDE;&#x540E;&#x53C8;&#x91CD;&#x8FDE;</h4><p>&#x5927;&#x81F4;&#x6D41;&#x7A0B;&#x5982;&#x4E0B;&#xFF1A;<br><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/6b5792fc2e7ae0db3db5c35099adbf6274e30ea834112bf10fce9217ffccaca9" alt="2021-11-2809-56-00.png"></p>
<p>&#x65AD;&#x5F00;&#x91CD;&#x8FDE;&#xFF0C;&#x9700;&#x8981;&#x77E5;&#x9053;&#x4E3B;&#x4ECE;&#x53CC;&#x65B9;&#x9700;&#x8981;&#x77E5;&#x9053;&#x5BF9;&#x65B9;&#x60C5;&#x51B5;&#xFF1A;</p>
<ul>
<li>&#x4ECE;&#x5E93;&#xFF1A;&#x6211;&#x7684;&#x72B6;&#x51B5;&#x662F;&#x8FD9;&#x6837;&#x7684;</li>
<li>&#x4E3B;&#x5E93;&#xFF1A;&#x6211;&#x770B;&#x4F60;&#x9700;&#x8981;&#x8FD9;&#x6837;&#x7684;</li>
</ul>
<p>&#x6240;&#x4EE5;&#xFF0C;&#x4E3B;&#x4ECE;&#x5E93;&#x7684;&#x8FDE;&#x63A5;&#x6062;&#x590D;&#x4E4B;&#x540E;&#xFF1A;</p>
<ul>
<li>&#x4ECE;&#x5E93;&#x9996;&#x5148;&#x4F1A;&#x7ED9;&#x4E3B;&#x5E93;&#x53D1;&#x9001; <code>psync</code> &#x547D;&#x4EE4;&#xFF0C;&#x5E76;&#x628A;&#x81EA;&#x5DF1;&#x5F53;&#x524D;&#x7684; <code>slave_repl_offset</code> &#x53D1;&#x7ED9;&#x4E3B;&#x5E93;</li>
<li>&#x4E3B;&#x5E93;&#x4F1A;&#x5224;&#x65AD;&#x81EA;&#x5DF1;&#x7684; <code>master_repl_offset</code> &#x548C; <code>slave_repl_offset</code> &#x4E4B;&#x95F4;&#x7684;&#x5DEE;&#x8DDD;<ul>
<li><code>master_repl_offset</code>&#xFF1A;&#x4E3B;&#x5E93;&#x5199;&#x5165;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x504F;&#x79FB;&#x91CF;</li>
<li><code>slave_repl_offset</code>&#xFF1A;&#x4ECE;&#x5E93;&#x5DF2;&#x590D;&#x5236;&#x7684;&#x504F;&#x79FB;&#x91CF;</li>
</ul>
</li>
</ul>
<p>&#x5728;&#x7F51;&#x7EDC;&#x65AD;&#x8FDE;&#x9636;&#x6BB5;&#xFF0C;&#x4E3B;&#x5E93;&#x53EF;&#x80FD;&#x4F1A;&#x6536;&#x5230;&#x65B0;&#x7684;&#x5199;&#x64CD;&#x4F5C;&#x547D;&#x4EE4;&#xFF0C;&#x6240;&#x4EE5;&#xFF0C;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;<code>master_repl_offset</code> &#x4F1A;&#x5927;&#x4E8E; <code>slave_repl_offset</code>&#x3002;</p>
<p>&#x6B64;&#x65F6;&#xFF0C;&#x4E3B;&#x5E93;&#x53EA;&#x7528;&#x628A; <code>master_repl_offset</code> &#x548C; <code>slave_repl_offset</code> &#x4E4B;&#x95F4;&#x7684;&#x547D;&#x4EE4;&#x64CD;&#x4F5C;&#x540C;&#x6B65;&#x7ED9;&#x4ECE;&#x5E93;&#x5C31;&#x884C;&#x3002;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/a078f2b8886046086322bb12fd2a8279.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="../155/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="../../">1</a><span class="space">&hellip;</span><a class="page-number" href="../155/">155</a><span class="page-number current">156</span><a class="page-number" href="../157/">157</a><span class="space">&hellip;</span><a class="page-number" href="../399/">399</a><a class="extend next" rel="next" href="../157/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">开发者博客</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="https://dev.newban.cn/archives/">
              
                  <span class="site-state-item-count">3990</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">1304</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="../../atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">开发者博客</span>
  <div>
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
  </div>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




  <script type="text/javascript" async src="js/src/mermaid.min.js"></script>
  <script>
  if (window.mermaid) {
        var mermaid_config = {
            startOnLoad: true,
            theme: 'default',
            flowchart:{
                useMaxWidth: false,
                htmlLabels: true
            }                
        }
        mermaid.initialize(mermaid_config);
  }
  </script>
  

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="../../lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="../../lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="../../lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="../../lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="../../lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="../../lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="../../js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="../../js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="../../js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
