<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">
<meta name="referrer" content="never">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="../../lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="../../lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="../../css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="../../images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="../../images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="../../images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="../../images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">





  <link rel="alternate" href="../../atom.xml" title="开发者博客 – IT技术 尽在开发者博客" type="application/atom+xml">






<meta property="og:type" content="website">
<meta property="og:title" content="开发者博客 – IT技术 尽在开发者博客">
<meta property="og:url" content="https://dev.newban.cn/page/253/index.html">
<meta property="og:site_name" content="开发者博客 – IT技术 尽在开发者博客">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="开发者博客 – IT技术 尽在开发者博客">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>
<!--谷歌广告验证代码-->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-2626449904708114",
          enable_page_level_ads: true
     });
</script>
<!--谷歌广告验证代码-->



  <link rel="canonical" href="https://dev.newban.cn/page/253/">





  <title>开发者博客 – IT技术 尽在开发者博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">开发者博客 – IT技术 尽在开发者博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">开发者博客 – 科技是第一生产力</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="http://dev.newban.cn/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="https://dev.newban.cn/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903529056829454.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903529056829454.html" itemprop="url">Golang中遇到的一些关于JSON处理的坑 前言 坑 参考</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-14T11:46:53+08:00">
                2017-12-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="&#x524D;&#x8A00;"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00;</h1><p>&#x4E00;&#x4E2A;&#x4EBA;&#x4E0D;&#x4F1A;&#x4E24;&#x6B21;&#x6389;&#x8FDB;&#x540C;&#x4E00;&#x4E2A;&#x5751;&#x91CC;&#xFF0C;&#x4F46;&#x662F;&#x5982;&#x679C;&#x4ED6;&#xFF08;&#x5979;&#xFF09;&#x5FD8;&#x8BB0;&#x4E86;&#x5751;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x90A3;&#x5C31;&#x4E0D;&#x4E00;&#x5B9A;&#x4E86;&#x3002;</p>
<p>&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x8BB0;&#x5F55;&#x4E86;&#x6700;&#x8FD1;&#x4F7F;&#x7528;Golang&#x5904;&#x7406;JSON&#x9047;&#x5230;&#x7684;&#x4E00;&#x4E9B;&#x5751;&#x3002;</p>
<h1 id="&#x5751;"><a href="#&#x5751;" class="headerlink" title="&#x5751;"></a>&#x5751;</h1><h2 id="1&#x53F7;&#x5751;&#xFF1A;omitempty&#x7684;&#x884C;&#x4E3A;"><a href="#1&#x53F7;&#x5751;&#xFF1A;omitempty&#x7684;&#x884C;&#x4E3A;" class="headerlink" title="1&#x53F7;&#x5751;&#xFF1A;omitempty&#x7684;&#x884C;&#x4E3A;"></a>1&#x53F7;&#x5751;&#xFF1A;<code>omitempty</code>&#x7684;&#x884C;&#x4E3A;</h2><p>C#&#x4E2D;&#x6700;&#x5E38;&#x7528;&#x7684;JSON&#x5E8F;&#x5217;&#x5316;&#x7C7B;&#x5E93;<code>Newtonsoft.Json</code>&#x4E2D;&#xFF0C;&#x628A;&#x4E00;&#x4E2A;&#x7C7B;&#x7684;&#x5B9E;&#x4F8B;&#x5E8F;&#x5217;&#x5316;&#x6210;JSON&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x4E0D;&#x60F3;&#x8BA9;&#x67D0;&#x4E2A;&#x5C5E;&#x6027;&#x8F93;&#x51FA;&#x5230;JSON&#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>property annotation</code>&#x6216;&#x8005;<code>ShouldSerialize method</code>&#x7B49;&#x65B9;&#x6CD5;&#xFF0C;&#x544A;&#x77E5;&#x5E8F;&#x5217;&#x5316;&#x7A0B;&#x5E8F;&#x3002;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// &#x901A;&#x8FC7;ShouldSerialize method&#x6307;&#x793A;&#x4E0D;&#x8981;&#x5E8F;&#x5217;&#x5316;ObsoleteSetting&#x5C5E;&#x6027;</span><br><span class="line">class Config</span><br><span class="line">{</span><br><span class="line">    public Fizz ObsoleteSetting { get; set; }</span><br><span class="line"></span><br><span class="line">    public bool ShouldSerializeObsoleteSetting()</span><br><span class="line">    {</span><br><span class="line">        return false;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// &#x901A;&#x8FC7;JsonIgnore&#x7684;annotation&#x6307;&#x793A;&#x4E0D;&#x9700;&#x8981;&#x5E8F;&#x5217;&#x5316;ObsoleteSetting&#x5C5E;&#x6027;</span><br><span class="line">class Config</span><br><span class="line">{</span><br><span class="line">    [JsonIgnore]</span><br><span class="line">    public Fizz ObsoleteSetting { get; set; }</span><br><span class="line"></span><br><span class="line">    public Bang ReplacementSetting { get; set; }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5173;&#x4E8E;<code>Newtonsoft.Json</code>&#x7684;Conditional Property Serialization&#x7684;&#x66F4;&#x591A;&#x5185;&#x5BB9;&#x53C2;&#x8003;&#xFF1A;</p>
<ul>
<li><a href="/external_links/720574d9e14467799e43646cbb2de2ad.html" target="blank" rel="noopener">Conditional Property Serialization</a></li>
<li><a href="/external_links/763211587eec3a8f731792143955fe52.html" target="blank" rel="noopener">Making a property deserialize but not serialize with json.net</a></li>
</ul>
<p>&#x5F00;&#x59CB;&#x4F7F;&#x7528;Golang&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4EE5;&#x4E3A;<code>omitempty</code>&#x7684;&#x884C;&#x4E3A;&#x548C;C#&#x4E2D;&#x4E00;&#x6837;&#x7528;&#x6765;&#x63A7;&#x5236;&#x662F;&#x5426;&#x5E8F;&#x5217;&#x5316;&#x5B57;&#x6BB5;&#xFF0C;&#x7ED3;&#x679C;&#x4F7F;&#x7528;&#x7684;&#x65F6;&#x5019;&#x78B0;&#x4E86;&#x4E00;&#x5934;&#x9489;&#x5B50;&#x3002;&#x56DE;&#x5934;&#x9605;&#x8BFB;<a href="/external_links/27dcc52a7b2918ebe4d238ae8e737977.html" target="blank" rel="noopener">encoding/json package&#x7684;&#x5B98;&#x65B9;&#x6587;&#x6863;</a>&#xFF0C;&#x627E;&#x5230;&#x5BF9;<code>omitempty</code>&#x884C;&#x4E3A;&#x7684;&#x63CF;&#x8FF0;&#xFF1A;</p>
<blockquote>
<p>Struct values encode as JSON objects. Each exported struct field becomes a member of the object unless</p>
<ul>
<li>the field&#x2019;s tag is &#x201C;-&#x201C;, or</li>
<li>the field is empty and its tag specifies the &#x201C;omitempty&#x201D; option.</li>
</ul>
<p>The empty values are false, 0, any nil pointer or interface value, and any array, slice, map, or string of length zero. The object&#x2019;s default key string is the struct field name but can be specified in the struct field&#x2019;s tag value. The &#x201C;json&#x201D; key<br> in the struct field&#x2019;s tag value is the key name, followed by an optional comma and options. Examples:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&gt; &#x590D;&#x5236;&#x4EE3;&#x7801;&gt; // Field is ignored by this package.</span><br><span class="line">&gt; &gt; Field int `json:&quot;-&quot;`</span><br><span class="line">&gt; &gt;</span><br><span class="line">&gt; &gt; // Field appears in JSON as key &quot;myName&quot;.</span><br><span class="line">&gt; &gt; Field int `json:&quot;myName&quot;`</span><br><span class="line">&gt; &gt;</span><br><span class="line">&gt; &gt; // Field appears in JSON as key &quot;myName&quot; and</span><br><span class="line">&gt; &gt; // the field is omitted from the object if its value is empty,</span><br><span class="line">&gt; &gt; // as defined above.</span><br><span class="line">&gt; &gt; Field int `json:&quot;myName,omitempty&quot;`</span><br><span class="line">&gt; &gt;</span><br><span class="line">&gt; &gt; // Field appears in JSON as key &quot;Field&quot; (the default), but</span><br><span class="line">&gt; &gt; // the field is skipped if empty.</span><br><span class="line">&gt; &gt; // Note the leading comma.</span><br><span class="line">&gt; &gt; Field int `json:&quot;,omitempty&quot;`</span><br><span class="line">&gt; &gt;</span><br><span class="line">&gt; </span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>Golang&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x6307;&#x5B9A;&#x4E00;&#x4E2A;<code>field</code>&#x5E8F;&#x5217;&#x5316;&#x6210;JSON&#x7684;&#x53D8;&#x91CF;&#x540D;&#x5B57;&#x4E3A;<code>-</code>&#xFF0C;&#x5219;&#x5E8F;&#x5217;&#x5316;&#x7684;&#x65F6;&#x5019;&#x81EA;&#x52A8;&#x5FFD;&#x7565;&#x8FD9;&#x4E2A;<code>field</code>&#x3002;&#x8FD9;&#x79CD;&#x7528;&#x6CD5;&#xFF0C;&#x624D;&#x662F;&#x548C;&#x4E0A;&#x9762;<code>JsonIgnore</code>&#x7684;&#x7528;&#x6CD5;&#x7684;&#x4F5C;&#x7528;&#x662F;&#x4E00;&#x6837;&#x7684;&#x3002;</p>
<p>&#x800C;<code>omitempty</code>&#x7684;&#x4F5C;&#x7528;&#x662F;&#x5F53;&#x4E00;&#x4E2A;<code>field</code>&#x7684;&#x503C;&#x662F;<code>empty</code>&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5E8F;&#x5217;&#x5316;JSON&#x65F6;&#x5019;&#x5FFD;&#x7565;&#x8FD9;&#x4E2A;<code>field</code>&#xFF08;<code>Newtonsoft.Json</code>&#x7684;&#x7C7B;&#x4F3C;&#x7528;&#x6CD5;&#x53C2;&#x8003;<a href="/external_links/f2531a9166cd0634330a871000ea3e53.html" target="blank" rel="noopener">&#x8FD9;&#x91CC;</a>&#x548C;<br> <a href="/external_links/568c86f9d4b94b833dab6faad052555e.html" target="blank" rel="noopener">&#x4F8B;&#x5B50;</a>&#xFF09;&#x3002;&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#x5173;&#x4E8E;<code>emtpty</code>&#x7684;&#x5B9A;&#x4E49;&#xFF1A;</p>
<blockquote>
<p>The empty values are false, 0, any nil pointer or interface value, and any array, slice, map, or string of length zero.</p>
</blockquote>
<p>&#x901A;&#x8FC7;&#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x6765;&#x52A0;&#x6DF1;&#x5BF9;<code>empty values</code>&#x7684;&#x4E86;&#x89E3;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">    &quot;bytes&quot;</span><br><span class="line">    &quot;encoding/json&quot;</span><br><span class="line">    &quot;log&quot;</span><br><span class="line">    &quot;os&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">type S1 struct {</span><br><span class="line">    I1 int</span><br><span class="line">    I2 int `json:&quot;,omitempty&quot;`</span><br><span class="line"></span><br><span class="line">    F1 float64</span><br><span class="line">    F2 float64 `json:&quot;,omitempty&quot;`</span><br><span class="line"></span><br><span class="line">    S1 string</span><br><span class="line">    S2 string `json:&quot;,omitempty&quot;`</span><br><span class="line"></span><br><span class="line">    B1 bool</span><br><span class="line">    B2 bool `json:&quot;,omitempty&quot;`</span><br><span class="line"></span><br><span class="line">    Slice1 []int</span><br><span class="line">    Slice2 []int `json:&quot;,omitempty&quot;`</span><br><span class="line">    Slice3 []int `json:&quot;,omitempty&quot;`</span><br><span class="line"></span><br><span class="line">    Map1 map[string]string</span><br><span class="line">    Map2 map[string]string `json:&quot;,omitempty&quot;`</span><br><span class="line">    Map3 map[string]string `json:&quot;,omitempty&quot;`</span><br><span class="line"></span><br><span class="line">    O1 interface{}</span><br><span class="line">    O2 interface{} `json:&quot;,omitempty&quot;`</span><br><span class="line">    O3 interface{} `json:&quot;,omitempty&quot;`</span><br><span class="line">    O4 interface{} `json:&quot;,omitempty&quot;`</span><br><span class="line">    O5 interface{} `json:&quot;,omitempty&quot;`</span><br><span class="line">    O6 interface{} `json:&quot;,omitempty&quot;`</span><br><span class="line">    O7 interface{} `json:&quot;,omitempty&quot;`</span><br><span class="line">    O8 interface{} `json:&quot;,omitempty&quot;`</span><br><span class="line"></span><br><span class="line">    P1 *int</span><br><span class="line">    P2 *int               `json:&quot;,omitempty&quot;`</span><br><span class="line">    P3 *int               `json:&quot;,omitempty&quot;`</span><br><span class="line">    P4 *float64           `json:&quot;,omitempty&quot;`</span><br><span class="line">    P5 *string            `json:&quot;,omitempty&quot;`</span><br><span class="line">    P6 *bool              `json:&quot;,omitempty&quot;`</span><br><span class="line">    P7 *[]int             `json:&quot;,omitempty&quot;`</span><br><span class="line">    P8 *map[string]string `json:&quot;,omitempty&quot;`</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">func main() {</span><br><span class="line"></span><br><span class="line">    p3 := 0</span><br><span class="line">    p4 := float64(0)</span><br><span class="line">    p5 := &quot;&quot;</span><br><span class="line">    p6 := false</span><br><span class="line">    p7 := []int{}</span><br><span class="line">    p8 := map[string]string{}</span><br><span class="line"></span><br><span class="line">    s1 := S1{</span><br><span class="line">        I1: 0,</span><br><span class="line">        I2: 0,</span><br><span class="line"></span><br><span class="line">        F1: 0,</span><br><span class="line">        F2: 0,</span><br><span class="line"></span><br><span class="line">        S1: &quot;&quot;,</span><br><span class="line">        S2: &quot;&quot;,</span><br><span class="line"></span><br><span class="line">        B1: false,</span><br><span class="line">        B2: false,</span><br><span class="line"></span><br><span class="line">        Slice1: []int{},</span><br><span class="line">        Slice2: nil,</span><br><span class="line">        Slice3: []int{},</span><br><span class="line"></span><br><span class="line">        Map1: map[string]string{},</span><br><span class="line">        Map2: nil,</span><br><span class="line">        Map3: map[string]string{},</span><br><span class="line"></span><br><span class="line">        O1: nil,</span><br><span class="line">        O2: nil,</span><br><span class="line">        O3: int(0),</span><br><span class="line">        O4: float64(0),</span><br><span class="line">        O5: &quot;&quot;,</span><br><span class="line">        O6: false,</span><br><span class="line">        O7: []int{},</span><br><span class="line">        O8: map[string]string{},</span><br><span class="line"></span><br><span class="line">        P1: nil,</span><br><span class="line">        P2: nil,</span><br><span class="line">        P3: &amp;p3,</span><br><span class="line">        P4: &amp;p4,</span><br><span class="line">        P5: &amp;p5,</span><br><span class="line">        P6: &amp;p6,</span><br><span class="line">        P7: &amp;p7,</span><br><span class="line">        P8: &amp;p8,</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    b, err := json.Marshal(s1)</span><br><span class="line">    if err != nil {</span><br><span class="line">        log.Printf(&quot;marshal error: %v&quot;, err)</span><br><span class="line">        return</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    var out bytes.Buffer</span><br><span class="line">    json.Indent(&amp;out, b, &quot;&quot;, &quot;\t&quot;)</span><br><span class="line">    out.WriteTo(os.Stdout)</span><br><span class="line">    //Output:</span><br><span class="line">    //{</span><br><span class="line">    //	&quot;I1&quot;: 0,</span><br><span class="line">    //	&quot;F1&quot;: 0,</span><br><span class="line">    //	&quot;S1&quot;: &quot;&quot;,</span><br><span class="line">    //	&quot;B1&quot;: false,</span><br><span class="line">    //	&quot;Slice1&quot;: [],</span><br><span class="line">    //	&quot;Map1&quot;: {},</span><br><span class="line">    //	&quot;O1&quot;: null,</span><br><span class="line">    //	&quot;O3&quot;: 0,</span><br><span class="line">    //	&quot;O4&quot;: 0,</span><br><span class="line">    //	&quot;O5&quot;: &quot;&quot;,</span><br><span class="line">    //	&quot;O6&quot;: false,</span><br><span class="line">    //	&quot;O7&quot;: [],</span><br><span class="line">    //	&quot;O8&quot;: {},</span><br><span class="line">    //	&quot;P1&quot;: null,</span><br><span class="line">    //	&quot;P2&quot;: 0</span><br><span class="line">    //}%</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x70B9;&#x51FB;<a href="/external_links/aca98e2f49e8d3a70c763b113fb0eeaa.html" target="blank" rel="noopener">&#x8FD9;&#x91CC;</a>&#x6267;&#x884C;&#x4E0A;&#x9762;&#x7684;&#x7A0B;&#x5E8F;</p>
<p>&#x5173;&#x4E8E;<code>empty value</code>&#x7684;&#x5B9A;&#x4E49;&#xFF0C;&#x8FD9;&#x91CC;&#x9762;&#x9690;&#x85CF;&#x4E86;&#x4E00;&#x4E9B;&#x5751;&#x3002;&#x4E0B;&#x9762;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#x6765;&#x8BF4;&#x660E;&#x3002;</p>
<p>&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x6709;&#x4E00;&#x4E2A;&#x793E;&#x4EA4;&#x7C7B;App&#xFF0C;&#x901A;&#x8FC7;Restful API&#x5F62;&#x5F0F;&#x4ECE;&#x670D;&#x52A1;&#x7AEF;&#x83B7;&#x53D6;&#x5F53;&#x524D;&#x767B;&#x5F55;&#x7528;&#x6237;&#x57FA;&#x672C;&#x4FE1;&#x606F;&#x53CA;&#x7C89;&#x4E1D;&#x6570;&#x91CF;&#x3002;&#x5982;&#x679C;&#x670D;&#x52A1;&#x7AEF;&#x5BF9;Response&#x4E2D;<code>User</code>&#x5BF9;&#x8C61;&#x7684;&#x5B9A;&#x4E49;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;type User struct {</span><br><span class="line">    ID        int `json:&quot;id&quot;`                  // &#x7528;&#x6237;id</span><br><span class="line">    // &#x5176;&#x5B83;field</span><br><span class="line">    FansCount int `json:&quot;fansCount,omitempty&quot;` // &#x7C89;&#x4E1D;&#x6570;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5982;&#x679C;&#x6B63;&#x5728;&#x4F7F;&#x7528;App&#x65F6;&#x4E00;&#x4E2A;&#x8FD8;&#x6CA1;&#x6709;&#x7C89;&#x4E1D;&#x7684;&#x7528;&#x6237;&#xFF0C;&#x8BBF;&#x95EE;Restful API&#x7684;&#x5F97;&#x5230;Response&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;{</span><br><span class="line">    &quot;id&quot;: 1000386,</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x65F6;&#x5019;&#x4F60;&#x4F1A;&#x53D1;&#x73B0;Response&#x7684;User&#x5BF9;&#x8C61;&#x4E2D;&#x6CA1;&#x6709;<code>fansCount</code>&#xFF0C;&#x56E0;&#x4E3A;<code>fansCount</code>&#x662F;&#x4E2A;<code>int</code>&#x7C7B;&#x578B;&#x4E14;&#x503C;&#x4E3A;0&#xFF0C;&#x5E8F;&#x5217;&#x5316;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x88AB;&#x5FFD;&#x7565;&#x3002;&#x8BED;&#x4E49;&#x4E0A;&#xFF0C;<code>User</code>&#x5BF9;&#x8C61;&#x4E2D;&#x6CA1;&#x6709;<code>fansCount</code>&#x5E94;&#x8BE5;&#x7406;&#x89E3;&#x4E3A;<strong>&#x7C89;&#x4E1D;&#x6570;&#x91CF;&#x672A;&#x77E5;</strong>&#xFF0C;&#x800C;&#x4E0D;&#x662F;<strong>&#x6CA1;&#x6709;&#x7C89;&#x4E1D;</strong>&#x3002;</p>
<p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x505A;&#x5230;&#x80FD;&#x591F;&#x533A;&#x5206;<strong>&#x7C89;&#x4E1D;&#x6570;&#x672A;&#x77E5;</strong>&#x548C;<strong>&#x6CA1;&#x6709;&#x7C89;&#x4E1D;</strong>&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x9700;&#x8981;&#x4FEE;&#x6539;<code>User</code>&#x7684;&#x5B9A;&#x4E49;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;type User struct {</span><br><span class="line">    ID        int  `json:&quot;id&quot;`                  // &#x7528;&#x6237;id</span><br><span class="line">    // &#x5176;&#x5B83;field</span><br><span class="line">    FansCount *int `json:&quot;fansCount,omitempty&quot;` // &#x7C89;&#x4E1D;&#x6570;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5C06;<code>FansCount</code>&#x4FEE;&#x6539;&#x4E3A;&#x6307;&#x9488;&#x7C7B;&#x578B;&#xFF0C;&#x5982;&#x679C;&#x4E3A;<code>nil</code>&#xFF0C;&#x8868;&#x793A;&#x7C89;&#x4E1D;&#x6570;&#x672A;&#x77E5;&#xFF1B;&#x5982;&#x679C;&#x4E3A;&#x6574;&#x6570;&#xFF08;&#x5305;&#x62EC;0&#xFF09;&#xFF0C;&#x8868;&#x793A;&#x7C89;&#x4E1D;&#x6570;&#x3002;</p>
<p>&#x8FD9;&#x4E48;&#x4FEE;&#x6539;&#x8BED;&#x4E49;&#x4E0A;&#x6CA1;&#x6709;&#x6F0F;&#x6D1E;&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x4EE3;&#x7801;&#x4E2D;&#x8981;&#x7ED9;<code>FansCount</code>&#x8D4B;&#x503C;&#x7684;&#x65F6;&#x5019;&#x5374;&#x8981;&#x591A;&#x4E00;&#x53E5;&#x5E9F;&#x8BDD;&#x3002;&#x5FC5;&#x987B;&#x5148;&#x5C06;&#x4ECE;&#x6570;&#x636E;&#x6E90;&#x67E5;&#x8BE2;&#x51FA;&#x7C89;&#x4E1D;&#x6570;&#x8D4B;&#x7ED9;&#x4E00;&#x4E2A;&#x53D8;&#x91CF;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x5C06;&#x53D8;&#x91CF;&#x7684;&#x6307;&#x9488;&#x4F20;&#x7ED9;<code>FansCount</code>&#x3002;&#x4EE3;&#x7801;&#x8BFB;&#x8D77;&#x6765;&#x5B9E;&#x5728;&#x662F;&#x5570;&#x55E6;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// FansCount&#x662F;int&#x7C7B;&#x578B;&#x65F6;&#x5019;</span><br><span class="line">user := dataAccess.GetUserInfo(userId)</span><br><span class="line">user.FansCount = dataAccess.GetFansCount(userId)</span><br><span class="line"></span><br><span class="line">// FansCount&#x662F;*int&#x7C7B;&#x578B;&#x7684;&#x65F6;&#x5019;</span><br><span class="line">user := dataAccess.GetUserInfo(userId)</span><br><span class="line">fansCount := dataAccess.GetFansCount(userId)</span><br><span class="line">user.FansCount = &amp;fansCount</span><br></pre></td></tr></table></figure>

<h2 id="2&#x53F7;&#x5751;&#xFF1A;JSON&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x6210;interface-&#x5BF9;Number&#x7684;&#x5904;&#x7406;"><a href="#2&#x53F7;&#x5751;&#xFF1A;JSON&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x6210;interface-&#x5BF9;Number&#x7684;&#x5904;&#x7406;" class="headerlink" title="2&#x53F7;&#x5751;&#xFF1A;JSON&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x6210;interface{}&#x5BF9;Number&#x7684;&#x5904;&#x7406;"></a>2&#x53F7;&#x5751;&#xFF1A;JSON&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x6210;interface{}&#x5BF9;Number&#x7684;&#x5904;&#x7406;</h2><p><a href="/external_links/826e297bd140256651594b61772df743.html" target="blank" rel="noopener">JSON&#x7684;&#x89C4;&#x8303;</a>&#x4E2D;&#xFF0C;&#x5BF9;&#x4E8E;&#x6570;&#x5B57;&#x7C7B;&#x578B;&#xFF0C;&#x5E76;&#x4E0D;&#x533A;&#x5206;&#x662F;&#x6574;&#x578B;&#x8FD8;&#x662F;&#x6D6E;&#x70B9;&#x578B;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/ba98abc84887130061982fa7c877a6954878559326ac342f0c89d186003d6600" alt></p>
<p>&#x5BF9;&#x4E8E;&#x5982;&#x4E0B;JSON&#x6587;&#x672C;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;{</span><br><span class="line">    &quot;name&quot;: &quot;ethancai&quot;,</span><br><span class="line">    &quot;fansCount&quot;: 9223372036854775807</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5982;&#x679C;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x7684;&#x65F6;&#x5019;&#x6307;&#x5B9A;&#x660E;&#x786E;&#x7684;&#x7ED3;&#x6784;&#x4F53;&#x548C;&#x53D8;&#x91CF;&#x7C7B;&#x578B;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">    &quot;encoding/json&quot;</span><br><span class="line">    &quot;fmt&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">type User struct {</span><br><span class="line">    Name      string</span><br><span class="line">    FansCount int64</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">func main() {</span><br><span class="line">    const jsonStream = `</span><br><span class="line">        {&quot;name&quot;:&quot;ethancai&quot;, &quot;fansCount&quot;: 9223372036854775807}</span><br><span class="line">    `</span><br><span class="line">    var user User  // &#x7C7B;&#x578B;&#x4E3A;User</span><br><span class="line">    err := json.Unmarshal([]byte(jsonStream), &amp;user)</span><br><span class="line">    if err != nil {</span><br><span class="line">        fmt.Println(&quot;error:&quot;, err)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    fmt.Printf(&quot;%+v \n&quot;, user)</span><br><span class="line">}</span><br><span class="line">// Output:</span><br><span class="line">//  {Name:ethancai FansCount:9223372036854775807}</span><br></pre></td></tr></table></figure>

<p>&#x70B9;&#x51FB;<a href="/external_links/52fbef6a8a1606967535d74c7c37f37b.html" target="blank" rel="noopener">&#x8FD9;&#x91CC;</a>&#x6267;&#x884C;&#x4E0A;&#x9762;&#x7684;&#x7A0B;&#x5E8F;</p>
<p>&#x5982;&#x679C;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x4E0D;&#x6307;&#x5B9A;&#x7ED3;&#x6784;&#x4F53;&#x7C7B;&#x578B;&#x6216;&#x8005;&#x53D8;&#x91CF;&#x7C7B;&#x578B;&#xFF0C;&#x5219;JSON&#x4E2D;&#x7684;&#x6570;&#x5B57;&#x7C7B;&#x578B;&#xFF0C;&#x9ED8;&#x8BA4;&#x88AB;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x6210;<code>float64</code>&#x7C7B;&#x578B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">    &quot;encoding/json&quot;</span><br><span class="line">    &quot;fmt&quot;</span><br><span class="line">    &quot;reflect&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func main() {</span><br><span class="line">    const jsonStream = `</span><br><span class="line">        {&quot;name&quot;:&quot;ethancai&quot;, &quot;fansCount&quot;: 9223372036854775807}</span><br><span class="line">    `</span><br><span class="line">    var user interface{}  // &#x4E0D;&#x6307;&#x5B9A;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x7684;&#x7C7B;&#x578B;</span><br><span class="line">    err := json.Unmarshal([]byte(jsonStream), &amp;user)</span><br><span class="line">    if err != nil {</span><br><span class="line">        fmt.Println(&quot;error:&quot;, err)</span><br><span class="line">    }</span><br><span class="line">    m := user.(map[string]interface{})</span><br><span class="line"></span><br><span class="line">    fansCount := m[&quot;fansCount&quot;]</span><br><span class="line"></span><br><span class="line">    fmt.Printf(&quot;%+v \n&quot;, reflect.TypeOf(fansCount).Name())</span><br><span class="line">    fmt.Printf(&quot;%+v \n&quot;, fansCount.(float64))</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// Output:</span><br><span class="line">// 	float64</span><br><span class="line">//  	9.223372036854776e+18</span><br></pre></td></tr></table></figure>

<p>&#x70B9;&#x51FB;<a href="/external_links/c81217582589169158260190cd8a005d.html" target="blank" rel="noopener">&#x8FD9;&#x91CC;</a>&#x6267;&#x884C;&#x4E0A;&#x9762;&#x7684;&#x7A0B;&#x5E8F;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">    &quot;encoding/json&quot;</span><br><span class="line">    &quot;fmt&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">type User struct {</span><br><span class="line">    Name      string</span><br><span class="line">    FansCount interface{}  // &#x4E0D;&#x6307;&#x5B9A;FansCount&#x53D8;&#x91CF;&#x7684;&#x7C7B;&#x578B;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">func main() {</span><br><span class="line">    const jsonStream = `</span><br><span class="line">        {&quot;name&quot;:&quot;ethancai&quot;, &quot;fansCount&quot;: 9223372036854775807}</span><br><span class="line">    `</span><br><span class="line">    var user User</span><br><span class="line">    err := json.Unmarshal([]byte(jsonStream), &amp;user)</span><br><span class="line">    if err != nil {</span><br><span class="line">        fmt.Println(&quot;error:&quot;, err)</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    fmt.Printf(&quot;%+v \n&quot;, user)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// Output:</span><br><span class="line">// 	{Name:ethancai FansCount:9.223372036854776e+18}</span><br></pre></td></tr></table></figure>

<p>&#x70B9;&#x51FB;<a href="/external_links/759bb78c97d7529ed53e4765599d91e9.html" target="blank" rel="noopener">&#x8FD9;&#x91CC;</a>&#x6267;&#x884C;&#x4E0A;&#x9762;&#x7684;&#x7A0B;&#x5E8F;</p>
<p>&#x4ECE;&#x4E0A;&#x9762;&#x7684;&#x7A0B;&#x5E8F;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#xFF0C;&#x5982;&#x679C;<code>fansCount</code>&#x7CBE;&#x5EA6;&#x6BD4;&#x8F83;&#x9AD8;&#xFF0C;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x6210;<code>float64</code>&#x7C7B;&#x578B;&#x7684;&#x6570;&#x503C;&#x65F6;&#x5B58;&#x5728;&#x4E22;&#x5931;&#x7CBE;&#x5EA6;&#x7684;&#x95EE;&#x9898;&#x3002;</p>
<p>&#x5982;&#x4F55;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x5148;&#x770B;&#x4E0B;&#x9762;&#x7A0B;&#x5E8F;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">    &quot;encoding/json&quot;</span><br><span class="line">    &quot;fmt&quot;</span><br><span class="line">    &quot;reflect&quot;</span><br><span class="line">    &quot;strings&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func main() {</span><br><span class="line">    const jsonStream = `</span><br><span class="line">        {&quot;name&quot;:&quot;ethancai&quot;, &quot;fansCount&quot;: 9223372036854775807}</span><br><span class="line">    `</span><br><span class="line"></span><br><span class="line">    decoder := json.NewDecoder(strings.NewReader(jsonStream))</span><br><span class="line">    decoder.UseNumber()    // UseNumber causes the Decoder to unmarshal a number into an interface{} as a Number instead of as a float64.</span><br><span class="line"></span><br><span class="line">    var user interface{}</span><br><span class="line">    if err := decoder.Decode(&amp;user); err != nil {</span><br><span class="line">        fmt.Println(&quot;error:&quot;, err)</span><br><span class="line">            return</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    m := user.(map[string]interface{})</span><br><span class="line">    fansCount := m[&quot;fansCount&quot;]</span><br><span class="line">    fmt.Printf(&quot;%+v \n&quot;, reflect.TypeOf(fansCount).PkgPath() + &quot;.&quot; + reflect.TypeOf(fansCount).Name())</span><br><span class="line"></span><br><span class="line">     v, err := fansCount.(json.Number).Int64()</span><br><span class="line">    if err != nil {</span><br><span class="line">        fmt.Println(&quot;error:&quot;, err)</span><br><span class="line">            return</span><br><span class="line">    }</span><br><span class="line">    fmt.Printf(&quot;%+v \n&quot;, v)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// Output:</span><br><span class="line">// 	encoding/json.Number</span><br><span class="line">// 	9223372036854775807</span><br></pre></td></tr></table></figure>

<p>&#x70B9;&#x51FB;<a href="/external_links/e7b1f5935ac746f19d4cb90d0984a1a2.html" target="blank" rel="noopener">&#x8FD9;&#x91CC;</a>&#x6267;&#x884C;&#x4E0A;&#x9762;&#x7684;&#x7A0B;&#x5E8F;</p>
<p>&#x4E0A;&#x9762;&#x7684;&#x7A0B;&#x5E8F;&#xFF0C;&#x4F7F;&#x7528;&#x4E86;<code>func (*Decoder) UseNumber</code>&#x65B9;&#x6CD5;&#x544A;&#x8BC9;&#x53CD;&#x5E8F;&#x5217;&#x5316;JSON&#x7684;&#x6570;&#x5B57;&#x7C7B;&#x578B;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E0D;&#x8981;&#x76F4;&#x63A5;&#x8F6C;&#x6362;&#x6210;<code>float64</code>&#xFF0C;&#x800C;&#x662F;&#x8F6C;&#x6362;&#x6210;<code>json.Number</code>&#x7C7B;&#x578B;&#x3002;<code>json.Number</code>&#x5185;&#x90E8;&#x5B9E;&#x73B0;&#x673A;&#x5236;&#x662F;&#x4EC0;&#x4E48;&#xFF0C;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x770B;&#x6E90;&#x7801;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// A Number represents a JSON number literal.</span><br><span class="line">type Number string</span><br><span class="line"></span><br><span class="line">// String returns the literal text of the number.</span><br><span class="line">func (n Number) String() string { return string(n) }</span><br><span class="line"></span><br><span class="line">// Float64 returns the number as a float64.</span><br><span class="line">func (n Number) Float64() (float64, error) {</span><br><span class="line">    return strconv.ParseFloat(string(n), 64)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// Int64 returns the number as an int64.</span><br><span class="line">func (n Number) Int64() (int64, error) {</span><br><span class="line">    return strconv.ParseInt(string(n), 10, 64)</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><code>json.Number</code>&#x672C;&#x8D28;&#x662F;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x7684;&#x65F6;&#x5019;&#x5C06;JSON&#x7684;&#x6570;&#x503C;&#x5148;&#x8F6C;&#x6210;<code>json.Number</code>&#xFF0C;&#x5176;&#x5B9E;&#x662F;&#x4E00;&#x79CD;&#x5EF6;&#x8FDF;&#x5904;&#x7406;&#x7684;&#x624B;&#x6BB5;&#xFF0C;&#x5F85;&#x540E;&#x7EED;&#x903B;&#x8F91;&#x9700;&#x8981;&#x65F6;&#x5019;&#xFF0C;&#x518D;&#x628A;<code>json.Number</code>&#x8F6C;&#x6210;<code>float64</code>&#x6216;&#x8005;<code>int64</code>&#x3002;</p>
<p>&#x5BF9;&#x6BD4;&#x5176;&#x5B83;&#x8BED;&#x8A00;&#xFF0C;Golang&#x5BF9;JSON&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x5904;&#x7406;&#x771F;&#x662F;&#x6613;&#x7528;&#x6027;&#x592A;&#x5DEE;&#xFF08;&#x201C;&#x86CB;&#x75BC;&#x201D;&#xFF09;&#x3002;</p>
<p>JavaScript&#x4E2D;&#x6240;&#x6709;&#x7684;&#x6570;&#x503C;&#x90FD;&#x662F;&#x53CC;&#x7CBE;&#x5EA6;&#x6D6E;&#x70B9;&#x6570;&#xFF08;&#x53C2;&#x8003;<a href="/external_links/6942bb2c97d89fdacd43554ffead97fc.html" target="blank" rel="noopener">&#x8FD9;&#x91CC;</a>&#xFF09;&#xFF0C;&#x53CD;&#x5E8F;&#x5217;&#x5316;JSON&#x7684;&#x65F6;&#x5019;&#x4E0D;&#x7528;&#x8003;&#x8651;&#x6570;&#x503C;&#x7C7B;&#x578B;&#x5339;&#x914D;&#x95EE;&#x9898;&#x3002;&#x8FD9;&#x91CC;&#x591A;&#x8BF4;&#x4E24;&#x53E5;&#xFF0C;JSON&#x7684;&#x5168;&#x540D;JavaScript Object Notation&#xFF08;&#x4ECE;&#x540D;&#x5B57;&#x4E0A;&#x5C31;&#x80FD;&#x770B;&#x51FA;&#x548C;JavaScript&#x7684;&#x5173;&#x7CFB;&#x975E;&#x5E38;&#x7D27;&#x5BC6;&#xFF09;&#xFF0C;&#x53D1;&#x660E;&#x4EBA;&#x662F;Douglas Crockford&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x81EA;&#x79F0;&#x719F;&#x6089;JavaScript&#x800C;&#x4E0D;&#x77E5;&#x9053;<br> <a href="/external_links/0d00397b6b5d4a82114893b9145e6217.html" target="blank" rel="noopener">Douglas Crockford</a>&#x662F;&#x8C01;&#xFF0C;&#x5C31;&#x50CF;&#x662F;&#x81EA;&#x79F0;&#x662F;&#x82F9;&#x679C;&#x7C89;&#x4E1D;&#x5374;&#x4E0D;&#x77E5;&#x9053;&#x4E54;&#x5E03;&#x65AF;&#x662F;&#x8C01;&#x3002;</p>
<p>C#&#x8BED;&#x8A00;&#x7684;&#x7B2C;&#x4E09;&#x65B9;JSON&#x5904;&#x7406;library <a href="/external_links/23a12ffd8d9e0bdf34b8945d758d3dce.html" target="blank" rel="noopener">Json.NET</a>&#x53CD;&#x5E8F;&#x5217;&#x5316;JSON&#x5BF9;&#x6570;&#x503C;&#x7684;&#x5904;&#x7406;&#x4E5F;&#x6BD4;Golang&#x8981;&#x4F18;&#x96C5;&#x7684;&#x591A;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;using System;</span><br><span class="line">using Newtonsoft.Json;</span><br><span class="line"></span><br><span class="line">public class Program</span><br><span class="line">{</span><br><span class="line">    public static void Main()</span><br><span class="line">    {</span><br><span class="line">        string json = @&quot;{</span><br><span class="line">  &apos;Name&apos;: &apos;Ethan&apos;,</span><br><span class="line">  &apos;FansCount&apos;: 121211,</span><br><span class="line">  &apos;Price&apos;: 99.99</span><br><span class="line">}&quot;;</span><br><span class="line"></span><br><span class="line">        Product m = JsonConvert.DeserializeObject&lt;Product&gt;(json);</span><br><span class="line"></span><br><span class="line">        Console.WriteLine(m.FansCount);</span><br><span class="line">        Console.WriteLine(m.FansCount.GetType().FullName);</span><br><span class="line"></span><br><span class="line">        Console.WriteLine(m.Price);</span><br><span class="line">        Console.WriteLine(m.Price.GetType().FullName);</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">public class Product</span><br><span class="line">{</span><br><span class="line">    public string Name</span><br><span class="line">    {</span><br><span class="line">        get;</span><br><span class="line">        set;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public object FansCount</span><br><span class="line">    {</span><br><span class="line">        get;</span><br><span class="line">        set;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public object Price</span><br><span class="line">    {</span><br><span class="line">        get;</span><br><span class="line">        set;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// Output:</span><br><span class="line">//      121211</span><br><span class="line">//      System.Int64</span><br><span class="line">//      99.99</span><br><span class="line">//      System.Double</span><br></pre></td></tr></table></figure>

<p>&#x70B9;&#x51FB;<a href="/external_links/13a4d7f23e9b01a766071c1bedb958fb.html" target="blank" rel="noopener">&#x8FD9;&#x91CC;</a>&#x6267;&#x884C;&#x4E0A;&#x9762;&#x7684;&#x7A0B;&#x5E8F;</p>
<p><code>Json.NET</code>&#x5728;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x7684;&#x65F6;&#x5019;&#x81EA;&#x52A8;&#x8BC6;&#x522B;&#x6570;&#x503C;&#x662F;&#x6D6E;&#x70B9;&#x578B;&#x8FD8;&#x662F;&#x6574;&#x578B;&#xFF0C;&#x8FD9;&#x4E00;&#x70B9;&#x5BF9;&#x5F00;&#x53D1;&#x8005;&#x975E;&#x5E38;&#x53CB;&#x597D;&#x3002;</p>
<h2 id="3&#x53F7;&#x5751;&#xFF1A;&#x9009;&#x62E9;&#x4EC0;&#x4E48;&#x683C;&#x5F0F;&#x8868;&#x793A;&#x65E5;&#x671F;"><a href="#3&#x53F7;&#x5751;&#xFF1A;&#x9009;&#x62E9;&#x4EC0;&#x4E48;&#x683C;&#x5F0F;&#x8868;&#x793A;&#x65E5;&#x671F;" class="headerlink" title="3&#x53F7;&#x5751;&#xFF1A;&#x9009;&#x62E9;&#x4EC0;&#x4E48;&#x683C;&#x5F0F;&#x8868;&#x793A;&#x65E5;&#x671F;"></a>3&#x53F7;&#x5751;&#xFF1A;&#x9009;&#x62E9;&#x4EC0;&#x4E48;&#x683C;&#x5F0F;&#x8868;&#x793A;&#x65E5;&#x671F;</h2><p>JSON&#x7684;&#x89C4;&#x8303;&#x4E2D;&#x5E76;&#x6CA1;&#x6709;&#x65E5;&#x671F;&#x7C7B;&#x578B;&#xFF0C;&#x4E0D;&#x540C;&#x8BED;&#x8A00;&#x7684;library&#x5BF9;&#x65E5;&#x671F;&#x5E8F;&#x5217;&#x5316;&#x7684;&#x5904;&#x7406;&#x4E5F;&#x4E0D;&#x5B8C;&#x5168;&#x4E00;&#x81F4;&#xFF1A;</p>
<p>Go&#x8BED;&#x8A00;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">    &quot;encoding/json&quot;</span><br><span class="line">    &quot;fmt&quot;</span><br><span class="line">    &quot;os&quot;</span><br><span class="line">    &quot;time&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func main() {</span><br><span class="line">    type Product struct {</span><br><span class="line">        Name      string</span><br><span class="line">        CreatedAt time.Time</span><br><span class="line">    }</span><br><span class="line">    pdt := Product{</span><br><span class="line">        Name:      &quot;Reds&quot;,</span><br><span class="line">        CreatedAt: time.Now(),</span><br><span class="line">    }</span><br><span class="line">    b, err := json.Marshal(pdt)</span><br><span class="line">    if err != nil {</span><br><span class="line">        fmt.Println(&quot;error:&quot;, err)</span><br><span class="line">    }</span><br><span class="line">    os.Stdout.Write(b)</span><br><span class="line">}</span><br><span class="line">// Output</span><br><span class="line">//      {&quot;Name&quot;:&quot;Reds&quot;,&quot;CreatedAt&quot;:&quot;2016-06-27T07:40:54.69292134+08:00&quot;}</span><br></pre></td></tr></table></figure>

<p>JavaScript&#x8BED;&#x8A00;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&#x279C;  ~ node</span><br><span class="line">&gt; var jo = { name: &quot;ethan&quot;, createdAt: Date.now() };</span><br><span class="line">undefined</span><br><span class="line">&gt; JSON.stringify(jo)</span><br><span class="line">&apos;{&quot;name&quot;:&quot;ethan&quot;,&quot;createdAt&quot;:1466984665633}&apos;</span><br></pre></td></tr></table></figure>

<p>C#&#x8BED;&#x8A00;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;using System;</span><br><span class="line">using Newtonsoft.Json;</span><br><span class="line"></span><br><span class="line">public class Program</span><br><span class="line">{</span><br><span class="line">    public static void Main()</span><br><span class="line">    {</span><br><span class="line">        Product product = new Product();</span><br><span class="line">        product.Name = &quot;Apple&quot;;</span><br><span class="line">        product.CreatedAt = DateTime.Now;</span><br><span class="line"></span><br><span class="line">        string json = JsonConvert.SerializeObject(product,</span><br><span class="line">                            Newtonsoft.Json.Formatting.Indented,</span><br><span class="line">                            new JsonSerializerSettings {</span><br><span class="line">                                NullValueHandling = NullValueHandling.Ignore</span><br><span class="line">                            });</span><br><span class="line">        Console.WriteLine(json);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">public class Product</span><br><span class="line">{</span><br><span class="line">    public string Name</span><br><span class="line">    {</span><br><span class="line">        get;</span><br><span class="line">        set;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public DateTime CreatedAt</span><br><span class="line">    {</span><br><span class="line">        get;</span><br><span class="line">        set;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line">// Output:</span><br><span class="line">//      {</span><br><span class="line">//        &quot;Name&quot;: &quot;Apple&quot;,</span><br><span class="line">//        &quot;CreatedAt&quot;: &quot;2016-06-26T23:46:57.3244307+00:00&quot;</span><br><span class="line">//      }</span><br></pre></td></tr></table></figure>

<p>Go&#x7684;<code>encoding/json</code> package&#x3001;C#&#x7684;Json.NET&#x9ED8;&#x8BA4;&#x628A;&#x65E5;&#x671F;&#x7C7B;&#x578B;&#x5E8F;&#x5217;&#x5316;&#x6210;<a href="/external_links/7a5ce4bac99c2628da0d6a48f280d36d.html" target="blank" rel="noopener">ISO 8601&#x6807;&#x51C6;</a>&#x7684;&#x683C;&#x5F0F;&#xFF0C;JavaScript&#x9ED8;&#x8BA4;&#x628A;<code>Date</code>&#x5E8F;&#x5217;&#x5316;&#x4ECE;1970&#x5E74;1&#x6708;1&#x65E5;0&#x70B9;0&#x5206;0&#x79D2;&#x7684;&#x6BEB;&#x79D2;&#x6570;&#x3002;&#x4F46;JavaScript&#x7684;<code>dateObj.toISOString()</code>&#x80FD;&#x591F;&#x5C06;&#x65E5;&#x671F;&#x7C7B;&#x578B;&#x8F6C;&#x6210;ISO&#x683C;&#x5F0F;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;<code>Date.parse(dateString)</code>&#x65B9;&#x6CD5;&#x80FD;&#x591F;&#x5C06;ISO&#x683C;&#x5F0F;&#x7684;&#x65E5;&#x671F;&#x5B57;&#x7B26;&#x4E32;&#x8F6C;&#x6210;&#x65E5;&#x671F;&#x3002;</p>
<p>&#x4E2A;&#x4EBA;&#x8BA4;&#x4E3A;ISO&#x683C;&#x5F0F;&#x7684;&#x65E5;&#x671F;&#x5B57;&#x7B26;&#x4E32;&#x53EF;&#x8BFB;&#x6027;&#x66F4;&#x597D;&#xFF0C;&#x4F46;&#x5E8F;&#x5217;&#x5316;&#x548C;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x65F6;&#x7684;&#x6027;&#x80FD;&#x5E94;&#x8BE5;&#x6BD4;&#x6574;&#x6570;&#x66F4;&#x4F4E;&#x3002;&#x8FD9;&#x4E00;&#x70B9;&#x4ECE;Go&#x8BED;&#x8A00;&#x4E2D;<code>time.Time</code>&#x7684;&#x5B9A;&#x4E49;&#x770B;&#x51FA;&#x6765;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;type Time struct {</span><br><span class="line">    // sec gives the number of seconds elapsed since</span><br><span class="line">    // January 1, year 1 00:00:00 UTC.</span><br><span class="line">    sec int64</span><br><span class="line"></span><br><span class="line">    // nsec specifies a non-negative nanosecond</span><br><span class="line">    // offset within the second named by Seconds.</span><br><span class="line">    // It must be in the range [0, 999999999].</span><br><span class="line">    nsec int32</span><br><span class="line"></span><br><span class="line">    // loc specifies the Location that should be used to</span><br><span class="line">    // determine the minute, hour, month, day, and year</span><br><span class="line">    // that correspond to this Time.</span><br><span class="line">    // Only the zero Time has a nil Location.</span><br><span class="line">    // In that case it is interpreted to mean UTC.</span><br><span class="line">    loc *Location</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5177;&#x4F53;&#x9009;&#x62E9;&#x54EA;&#x79CD;&#x5F62;&#x5F0F;&#x5728;JSON&#x4E2D;&#x8868;&#x793A;&#x65E5;&#x671F;&#xFF0C;&#x6709;&#x5982;&#x4E0B;&#x51E0;&#x70B9;&#x9700;&#x8981;&#x6CE8;&#x610F;&#xFF1A;</p>
<ul>
<li>&#x9009;&#x62E9;&#x6807;&#x51C6;&#x683C;&#x5F0F;&#x3002;&#x66FE;&#x8BB0;&#x5F97;.NET Framework&#x5B98;&#x65B9;&#x5E8F;&#x5217;&#x5316;JSON&#x7684;&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x4F1A;&#x628A;&#x65E5;&#x671F;&#x8F6C;&#x6210;&#x5982;<code>&quot;\/Date(1343660352227+0530)\/&quot;</code>&#x7684;&#x4E13;&#x6709;&#x683C;&#x5F0F;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x4E13;&#x6709;&#x683C;&#x5F0F;&#x5BF9;&#x8DE8;&#x8BED;&#x8A00;&#x7684;&#x8BBF;&#x95EE;&#x7279;&#x522B;&#x4E0D;&#x53CB;&#x597D;&#x3002;</li>
<li>&#x5982;&#x679C;&#x4F60;&#x503E;&#x5411;&#x6027;&#x80FD;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x6574;&#x6570;&#x3002;&#x5982;&#x679C;&#x4F60;&#x503E;&#x5411;&#x53EF;&#x8BFB;&#x6027;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;ISO&#x5B57;&#x7B26;&#x4E32;&#x3002;</li>
<li>&#x5982;&#x679C;&#x4F7F;&#x7528;&#x6574;&#x6570;&#x8868;&#x793A;&#x65E5;&#x671F;&#xFF0C;&#x800C;&#x4F60;&#x7684;&#x5E94;&#x7528;&#x53C8;&#x662F;&#x9700;&#x8981;&#x652F;&#x6301;&#x8DE8;&#x65F6;&#x533A;&#x7684;&#xFF0C;&#x6CE8;&#x610F;&#x4E00;&#x5B9A;&#x8981;&#x662F;&#x4ECE;<code>1970-1-1 00:00:00 UTC</code>&#x5F00;&#x59CB;&#x8BA1;&#x7B97;&#x7684;&#x6BEB;&#x79D2;&#x6570;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5F53;&#x524D;&#x65F6;&#x533A;&#x7684;<code>1970-1-1 00:00:00</code>&#x3002;</li>
</ul>
<h1 id="&#x53C2;&#x8003;"><a href="#&#x53C2;&#x8003;" class="headerlink" title="&#x53C2;&#x8003;"></a>&#x53C2;&#x8003;</h1><p>&#x6587;&#x7AE0;&#xFF1A;</p>
<ul>
<li><a href="/external_links/27dcc52a7b2918ebe4d238ae8e737977.html" target="blank" rel="noopener">package encoding/json in Go</a></li>
<li><a href="/external_links/68faf0f1eb84ce53bed9b006499441d3.html" target="blank" rel="noopener">docs.studygolang.com/src/encodin&#x2026;</a></li>
<li><a href="/external_links/80ec9252cd04e9a69a10106d3a25da8d.html" target="blank" rel="noopener">The Go Blog: JSON and Go</a></li>
<li><a href="/external_links/5d90685604204dcf681e4c40fe8f7e5e.html" target="blank" rel="noopener">Go by example: JSON</a></li>
<li><a href="/external_links/7c14e3b5d689dade05d1b2399bc61f16.html" target="blank" rel="noopener">JSON decoding in Go</a></li>
<li><a href="/external_links/c13e7aeacf741bec7e0d012bf6512cdd.html" target="blank" rel="noopener">go and json</a></li>
<li><a href="/external_links/00577d925c645007b0cbf113c55bf16a.html" target="blank" rel="noopener">Decode JSON Documents In Go</a></li>
<li><a href="/external_links/51de0f477f57e1bac86a38724dee115a.html" target="blank" rel="noopener">ffjson: faster JSON serialization for Golang</a></li>
<li><a href="/external_links/8b4ad9a840bc4bd8619c027b39e32da3.html" target="blank" rel="noopener">Serialization in Go</a></li>
</ul>
<p>&#x7B2C;&#x4E09;&#x65B9;&#x7C7B;&#x5E93;&#xFF1A;</p>
<ul>
<li><a href="/external_links/0aa296a2c7e0a8407051a8b9fec64313.html" target="blank" rel="noopener">ffjson</a>: faster JSON serialization for Go</li>
<li><a href="/external_links/281a2087988880249c024e9841d3e879.html" target="blank" rel="noopener">go-simplejson</a>: a Go package to interact with arbitrary JSON</li>
<li><a href="/external_links/1cfa79dd392981943f8e07490b1e47fa.html" target="blank" rel="noopener">Jason</a>: Easy-to-use JSON Library for Go</li>
<li><a href="/external_links/a4c00461b46a9cd9ecaf9859cb39db7d.html" target="blank" rel="noopener">easyjson</a></li>
<li><a href="/external_links/1c16e19cf39f7dc2ff1a95dde970f809.html" target="blank" rel="noopener">gabs</a></li>
<li><a href="/external_links/f60c4de7d83cacb5d7fb78ab55859a0e.html" target="blank" rel="noopener">jsonparser</a></li>
</ul>
<p>&#x5DE5;&#x5177;&#xFF1A;</p>
<ul>
<li><a href="/external_links/0c089e98fdc232d5c4cdab25bebc52f8.html" target="blank" rel="noopener">JSON-to-Go</a>: instantly converts JSON into a Go type definition</li>
</ul>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/2a829176880aa6d4b9d4ab5527ebbb32.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903528394129422.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903528394129422.html" itemprop="url">MySQL 性能调优技巧</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-14T11:06:00+08:00">
                2017-12-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><em>&#x6458;&#x8981;&#xFF1A;&#x9488;&#x5BF9;&#x8D2D;&#x7269;&#x65FA;&#x5B63;&#x7F51;&#x7AD9;&#x6D41;&#x91CF;&#x4F1A;&#x5BF9;&#x6570;&#x636E;&#x5E93;&#x9020;&#x6210;&#x7684;&#x538B;&#x529B;&#xFF0C;&#x4F5C;&#x8005;&#x7ED9;&#x51FA;&#x4E86;MySQL&#x6027;&#x80FD;&#x8C03;&#x4F18;&#x7684;&#x4E00;&#x4E9B;&#x6280;&#x5DE7;&#xFF0C;&#x8FD9;&#x4E9B;&#x6280;&#x5DE7;&#x6781;&#x5177;&#x53C2;&#x8003;&#x4EF7;&#x503C;&#xFF0C;&#x901A;&#x8FC7;&#x8FD9;&#x4E9B;&#x8C03;&#x4F18;&#xFF0C;&#x53EF;&#x4EE5;&#x6709;&#x6548;&#x907F;&#x514D;&#x56E0;&#x4E3A;&#x6D41;&#x91CF;&#x8FC7;&#x5927;&#x9020;&#x6210;&#x670D;&#x52A1;&#x5668;&#x5B95;&#x673A;&#xFF0C;&#x4ECE;&#x800C;&#x7ED9;&#x4F01;&#x4E1A;&#x9020;&#x6210;&#x7ECF;&#x6D4E;&#x635F;&#x5931;&#x3002;&#x4EE5;&#x4E0B;&#x662F;&#x8BD1;&#x6587;</em></p>
</blockquote>
<p>&#x4E07;&#x5723;&#x8282;&#x5DF2;&#x7ECF;&#x8FC7;&#x53BB;&#x5F88;&#x4E45;&#x4E86;&#xFF0C;&#x8BE5;&#x662F;&#x628A;&#x6CE8;&#x610F;&#x529B;&#x96C6;&#x4E2D;&#x5728;&#x5373;&#x5C06;&#x5230;&#x6765;&#x7684;&#x5047;&#x65E5;&#x5B63;&#x8282;&#x7684;&#x65F6;&#x5019;&#x4E86;&#x3002;&#x9996;&#x5148;&#x662F;&#x611F;&#x6069;&#x8282;&#xFF0C;&#x63A5;&#x7740;&#x5C31;&#x662F;&#x9ED1;&#x8272;&#x661F;&#x671F;&#x4E94;&#x548C;&#x7F51;&#x7EDC;&#x661F;&#x671F;&#x4E00;&#xFF0C;&#x6700;&#x7EC8;&#x5728;&#x5723;&#x8BDE;&#x8282;/&#x8282;&#x793C;&#x5468;&#xFF08;&#x4ECE;12&#x6708;26&#x65E5;&#x7684;&#x8282;&#x793C;&#x65E5;&#x5F00;&#x59CB;&#xFF0C;&#x5230;12&#x6708;31&#x65E5;&#x7684;&#x9664;&#x5915;&#x7ED3;&#x675F;&#x4E3A;&#x671F;&#x516D;&#x5929;&#x6216;&#x66F4;&#x957F;&#x65F6;&#x95F4;&#x3002;&#x8FD9;&#x4E2A;&#x8BCD;&#x662F;&#x7531;&#x96F6;&#x552E;&#x4E1A;&#x5728;2000&#x5E74;&#x4EE3;&#x4E2D;&#x671F;&#x5DE6;&#x53F3;&#x53D1;&#x660E;&#x7684;&#xFF0C;&#x8BD5;&#x56FE;&#x5EF6;&#x957F;&#x4ED6;&#x4EEC;&#x7684;&#x8282;&#x793C;&#x65E5;&#x9500;&#x552E;&#xFF09;&#x8FBE;&#x5230;&#x8D2D;&#x7269;&#x9AD8;&#x6F6E;&#x3002;&#x5BF9;&#x4E8E;&#x4F01;&#x4E1A;&#x4E3B;&#x6765;&#x8BF4;&#xFF0C;&#x4E00;&#x5E74;&#x7684;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x6807;&#x5FD7;&#x7740;&#x4EBA;&#x4EEC;&#x671F;&#x5F85;&#x5DF2;&#x4E45;&#x7684;&#x5E74;&#x5E95;&#x83B7;&#x5229;&#x4E86;&#x7ED3;&#x3002;&#x5BF9;&#x4E8E;&#x4E00;&#x4E9B;DBA&#x6765;&#x8BF4;&#xFF0C;&#x5B83;&#x4F1A;&#x5E26;&#x6765;&#x6050;&#x60E7;&#xFF0C;&#x4E0D;&#x5B89;&#xFF0C;&#x751A;&#x81F3;&#x662F;&#x4E0D;&#x7720;&#x4E4B;&#x591C;&#xFF0C;&#x4ED6;&#x4EEC;&#x8981;&#x52AA;&#x529B;&#x4F7F;&#x7CFB;&#x7EDF;&#x91CD;&#x65B0;&#x4E0A;&#x7EBF;&#x3002;</p>
<p>&#x503C;&#x5F97;&#x5E86;&#x5E78;&#x662F;&#xFF0C;&#x60C5;&#x51B5;&#x5E76;&#x975E;&#x5982;&#x6B64;&#x3002;&#x901A;&#x8FC7;&#x5BF9;MySQL&#x6027;&#x80FD;&#x53D8;&#x91CF;&#x505A;&#x4E00;&#x4E9B;&#x4E3B;&#x52A8;&#x8C03;&#x6574;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x6570;&#x636E;&#x5E93;&#x670D;&#x52A1;&#x5668;&#x514D;&#x53D7;&#x8D2D;&#x7269;&#x65FA;&#x5B63;&#x5E26;&#x6765;&#x7684;&#x9700;&#x6C42;&#x589E;&#x52A0;&#x7684;&#x51B2;&#x51FB;&#x3002;</p>
<h3 id="&#x6280;&#x5DE7;-1&#xFF1A;&#x786E;&#x5B9A;MySQL&#x7684;&#x6700;&#x5927;&#x8FDE;&#x63A5;&#x6570;"><a href="#&#x6280;&#x5DE7;-1&#xFF1A;&#x786E;&#x5B9A;MySQL&#x7684;&#x6700;&#x5927;&#x8FDE;&#x63A5;&#x6570;" class="headerlink" title="&#x6280;&#x5DE7;#1&#xFF1A;&#x786E;&#x5B9A;MySQL&#x7684;&#x6700;&#x5927;&#x8FDE;&#x63A5;&#x6570;"></a>&#x6280;&#x5DE7;#1&#xFF1A;&#x786E;&#x5B9A;MySQL&#x7684;&#x6700;&#x5927;&#x8FDE;&#x63A5;&#x6570;</h3><p>&#x5BF9;&#x4E8E;MySQL&#x7684;&#x6700;&#x5927;&#x8FDE;&#x63A5;&#x6570;&#xFF0C;&#x4E00;&#x6B21;&#x6700;&#x597D;&#x662F;&#x53D1;&#x9001;5&#x4E2A;&#x8BF7;&#x6C42;&#x5230;Web&#x670D;&#x52A1;&#x5668;&#x3002;&#x5BF9;Web&#x670D;&#x52A1;&#x5668;&#x7684;5&#x4E2A;&#x8BF7;&#x6C42;&#x4E2D;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x5C06;&#x7528;&#x4E8E;CSS&#x6837;&#x5F0F;&#x8868;&#xFF0C;&#x56FE;&#x50CF;&#x548C;&#x811A;&#x672C;&#x7B49;&#x8D44;&#x6E90;&#x3002;&#x7531;&#x4E8E;&#x8BF8;&#x5982;&#x6D4F;&#x89C8;&#x5668;&#x7F13;&#x5B58;&#x7B49;&#x539F;&#x56E0;&#xFF0C;&#x8981;&#x83B7;&#x5F97;&#x51C6;&#x786E;&#x7684;MySQL&#x5230;Web&#x670D;&#x52A1;&#x5668;&#x7684;&#x8BF7;&#x6C42;&#x6BD4;&#x7387;&#x53EF;&#x80FD;&#x5F88;&#x56F0;&#x96BE;; &#x8981;&#x60F3;&#x5F97;&#x5230;&#x4E00;&#x4E2A;&#x786E;&#x5207;&#x7684;&#x6570;&#x5B57;&#xFF0C;&#x5C31;&#x9700;&#x8981;&#x5206;&#x6790;Web&#x670D;&#x52A1;&#x5668;&#x7684;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x53EF;&#x4EE5;&#x624B;&#x52A8;&#x8BBF;&#x95EE;Apache&#x7684;&#x201C;access_log&#x201D;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<a href="/external_links/27a050ee8a741361f3d0a6429132fde2.html" target="blank" rel="noopener">Analog</a>&#x6216;<a href="/external_links/4fbd331fb286e0a0219196c5d2059168.html" target="blank" rel="noopener">Webalizer</a>&#x7B49;&#x5B9E;&#x7528;&#x7A0B;&#x5E8F;&#x8BBF;&#x95EE;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x3002;</p>
<p>&#x4E00;&#x65E6;&#x6709;&#x4E86;&#x5BF9;&#x7279;&#x5B9A;&#x4F7F;&#x7528;&#x60C5;&#x51B5;&#x7684;&#x51C6;&#x786E;&#x4F30;&#x8BA1;&#xFF0C;&#x8BF7;&#x5C06;&#x8BE5;&#x6BD4;&#x7387;&#x4E58;&#x4EE5;Web&#x670D;&#x52A1;&#x5668;&#x7684;&#x6700;&#x5927;&#x8FDE;&#x63A5;&#x6570;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;Web&#x670D;&#x52A1;&#x5668;&#x914D;&#x7F6E;&#x4E3A;&#x6700;&#x591A;&#x4E3A;256&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#xFF0C;MySQL&#x8BF7;&#x6C42;&#x4E0E;Web&#x8BF7;&#x6C42;&#x7684;&#x6BD4;&#x7387;&#x4E3A;1/8&#xFF0C;&#x5219;&#x6700;&#x597D;&#x5C06;&#x6700;&#x5927;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#x6570;&#x8BBE;&#x7F6E;&#x4E3A;32&#x3002;&#x8FD8;&#x8981;&#x8003;&#x8651;&#x7559;&#x6709;&#x5B89;&#x5168;&#x4F59;&#x91CF;&#xFF0C;&#x628A;&#x8FD9;&#x4E2A;&#x6570;&#x4E58;&#x4EE5;2&#xFF0C;&#x5F97;&#x5230;&#x6700;&#x7EC8;&#x7684;&#x6570;&#x91CF;&#x3002;&#x53EA;&#x6709;&#x5728;&#x57FA;&#x7840;&#x8BBE;&#x65BD;&#x652F;&#x6301;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x624D;&#x80FD;&#x5C1D;&#x8BD5;&#x5C06;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#x6570;&#x7684;&#x6700;&#x5927;&#x6570;&#x91CF;&#x4E0E;Web&#x670D;&#x52A1;&#x5668;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x9650;&#x5236;&#x76F8;&#x5339;&#x914D;&#x3002;&#x5728;&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6700;&#x597D;&#x4FDD;&#x6301;&#x63A5;&#x8FD1;32&#x3002;</p>
<p><strong>&#x5728;Monyog&#x4E2D;&#x67E5;&#x770B;MySQL&#x8FDE;&#x63A5;</strong></p>
<p>&#x5728;MySQL&#x6570;&#x636E;&#x5E93;&#x4E2D;&#xFF0C;MySQL&#x7684;&#x6700;&#x5927;&#x5E76;&#x53D1;&#x8FDE;&#x63A5;&#x6570;&#x662F;&#x5B58;&#x50A8;&#x5728;&#x5168;&#x5C40;&#x53D8;&#x91CF;max_connections&#x4E2D;&#x7684;&#x3002;Monyog&#x62A5;&#x544A;&#x53D8;&#x91CF;&#x201C;max_connections&#x201D;&#x4F5C;&#x4E3A;&#x5F53;&#x524D;&#x8FDE;&#x63A5;&#x76D1;&#x63A7;&#x7EC4;&#x4E2D;&#x7684;&#x201C;&#x6700;&#x5927;&#x5141;&#x8BB8;&#x201D;&#x6307;&#x6807;&#x3002;&#x5B83;&#x8FD8;&#x5C06;&#x8BE5;&#x6570;&#x5B57;&#x9664;&#x4EE5;&#x6253;&#x5F00;&#x7684;&#x8FDE;&#x63A5;&#x6570;&#xFF0C;&#x4EE5;&#x751F;&#x6210;&#x8FDE;&#x63A5;&#x4F7F;&#x7528;&#x767E;&#x5206;&#x6BD4;&#xFF1A;</p>
<p>&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#x5386;&#x53F2;&#x8BB0;&#x5F55;&#x76D1;&#x63A7;&#xFF0C;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x8BA1;&#x7B97;&#x6700;&#x4F73;&#x7684;&#x6700;&#x5927;&#x5E76;&#x53D1;&#x8FDE;&#x63A5;&#x6570;&#x3002;&#x5B83;&#x5305;&#x62EC;&#x5C1D;&#x8BD5;&#xFF0C;&#x62D2;&#x7EDD;&#x548C;&#x6210;&#x529F;&#x8FDE;&#x63A5;&#x7684;&#x6570;&#x91CF;&#x3002;&#x6B64;&#x5916;&#xFF0C;&#x5141;&#x8BB8;&#x8FBE;&#x5230;&#x7684;&#x6700;&#x5927;&#x6307;&#x6807;&#x7684;&#x767E;&#x5206;&#x6BD4;&#x663E;&#x793A;&#x4E3A;&#x4E00;&#x4E2A;&#x8FDB;&#x5EA6;&#x6761;&#xFF0C;&#x53EF;&#x4EE5;&#x8BA9;&#x4F60;&#x5FEB;&#x901F;&#x8BC4;&#x4F30;&#x670D;&#x52A1;&#x5668;&#x5728;&#x8FC7;&#x53BB;&#x8FBE;&#x5230;&#x7684;&#x6700;&#x5927;&#x5E76;&#x53D1;&#x8FDE;&#x63A5;&#x6570;&#xFF1A;</p>
<h3 id="&#x6280;&#x5DE7;-2&#xFF1A;&#x4E3A;&#x4E34;&#x65F6;&#x8868;&#x5206;&#x914D;&#x8DB3;&#x591F;&#x7684;&#x5185;&#x5B58;"><a href="#&#x6280;&#x5DE7;-2&#xFF1A;&#x4E3A;&#x4E34;&#x65F6;&#x8868;&#x5206;&#x914D;&#x8DB3;&#x591F;&#x7684;&#x5185;&#x5B58;" class="headerlink" title="&#x6280;&#x5DE7;#2&#xFF1A;&#x4E3A;&#x4E34;&#x65F6;&#x8868;&#x5206;&#x914D;&#x8DB3;&#x591F;&#x7684;&#x5185;&#x5B58;"></a>&#x6280;&#x5DE7;#2&#xFF1A;&#x4E3A;&#x4E34;&#x65F6;&#x8868;&#x5206;&#x914D;&#x8DB3;&#x591F;&#x7684;&#x5185;&#x5B58;</h3><p>&#x5728;&#x67D0;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x5728;&#x5904;&#x7406;&#x8BED;&#x53E5;&#x65F6;&#x4F1A;&#x521B;&#x5EFA;&#x5185;&#x90E8;&#x4E34;&#x65F6;&#x8868;&#x3002;&#x4E34;&#x65F6;&#x8868;&#x7528;&#x4E8E;&#x5185;&#x90E8;&#x64CD;&#x4F5C;&#x5982;GROUP BY&#x548C;distinct&#xFF0C;&#x8FD8;&#x6709;&#x4E00;&#x4E9B;ORDER BY&#x67E5;&#x8BE2;&#x4EE5;&#x53CA;UNION&#x548C;FROM&#x5B50;&#x53E5;&#xFF08;&#x6D3E;&#x751F;&#x8868;&#xFF09;&#x4E2D;&#x7684;&#x5B50;&#x67E5;&#x8BE2;&#x3002;&#x8FD9;&#x4E9B;&#x90FD;&#x662F;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x521B;&#x5EFA;&#x7684;&#x5185;&#x5B58;&#x8868;&#x3002;&#x5185;&#x5B58;&#x4E2D;&#x4E34;&#x65F6;&#x8868;&#x7684;&#x6700;&#x5927;&#x5927;&#x5C0F;&#x7531;tmp_table_size&#x548C;max_heap_table_size&#x4E2D;&#x8F83;&#x5C0F;&#x7684;&#x503C;&#x786E;&#x5B9A;&#x3002;&#x5982;&#x679C;&#x4E34;&#x65F6;&#x8868;&#x7684;&#x5927;&#x5C0F;&#x8D85;&#x8FC7;&#x8FD9;&#x4E2A;&#x9608;&#x503C;&#xFF0C;&#x5219;&#x5C06;&#x5176;&#x8F6C;&#x6362;&#x4E3A;&#x78C1;&#x76D8;&#x4E0A;&#x7684;InnoDB&#x6216;MyISAM&#x8868;&#x3002;&#x6B64;&#x5916;&#xFF0C;&#x5982;&#x679C;&#x67E5;&#x8BE2;&#x6D89;&#x53CA;BLOB&#x6216;TEXT&#x5217;&#xFF0C;&#x800C;&#x8FD9;&#x4E9B;&#x5217;&#x4E0D;&#x80FD;&#x5B58;&#x50A8;&#x5728;&#x5185;&#x5B58;&#x8868;&#x4E2D;&#xFF0C;&#x4E34;&#x65F6;&#x8868;&#x603B;&#x662F;&#x76F4;&#x63A5;&#x6307;&#x5411;&#x78C1;&#x76D8;&#x3002;</p>
<p>&#x8FD9;&#x79CD;&#x8F6C;&#x6362;&#x7684;&#x4EE3;&#x4EF7;&#x5F88;&#x5927;&#xFF0C;&#x6240;&#x4EE5;&#x8003;&#x8651;&#x589E;&#x52A0;max_heap_table_size&#x548C;tmp_table_size&#x53D8;&#x91CF;&#x7684;&#x5927;&#x5C0F;&#x6765;&#x5E2E;&#x52A9;&#x51CF;&#x5C11;&#x5728;&#x78C1;&#x76D8;&#x4E0A;&#x521B;&#x5EFA;&#x4E34;&#x65F6;&#x8868;&#x7684;&#x6570;&#x91CF;&#x3002;&#x8BF7;&#x8BB0;&#x4F4F;&#xFF0C;&#x8FD9;&#x5C06;&#x9700;&#x8981;&#x5927;&#x91CF;&#x5185;&#x5B58;&#xFF0C;&#x56E0;&#x4E3A;&#x5185;&#x5B58;&#x4E2D;&#x4E34;&#x65F6;&#x8868;&#x7684;&#x5927;&#x5C0F;&#x662F;&#x57FA;&#x4E8E;&#x201C;&#x6700;&#x574F;&#x60C5;&#x51B5;&#x201D;&#x7684;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5185;&#x5B58;&#x8868;&#x603B;&#x662F;&#x4F7F;&#x7528;&#x56FA;&#x5B9A;&#x957F;&#x5EA6;&#x7684;&#x5217;&#xFF0C;&#x6240;&#x4EE5;&#x5B57;&#x7B26;&#x5217;&#x4F7F;&#x7528;VARCHAR&#xFF08;255&#xFF09;&#x3002;&#x8FD9;&#x53EF;&#x4EE5;&#x4F7F;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x4E34;&#x65F6;&#x8868;&#x6BD4;&#x60F3;&#x8C61;&#x7684;&#x8981;&#x5927;&#x5F97;&#x591A;&#x2014;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;&#x8FD9;&#x6BD4;&#x67E5;&#x8BE2;&#x8868;&#x7684;&#x603B;&#x5927;&#x5C0F;&#x8981;&#x5927;&#x5F88;&#x591A;&#x500D;&#xFF01;&#x5F53;&#x589E;&#x52A0;max_heap_table_size&#x548C;tmp_table_sizevariables&#x7684;&#x5927;&#x5C0F;&#x65F6;&#xFF0C;&#x4E00;&#x5B9A;&#x8981;&#x76D1;&#x89C6;&#x670D;&#x52A1;&#x5668;&#x7684;&#x5185;&#x5B58;&#x4F7F;&#x7528;&#x60C5;&#x51B5;&#xFF0C;&#x56E0;&#x4E3A;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x4E34;&#x65F6;&#x8868;&#x53EF;&#x80FD;&#x4F1A;&#x589E;&#x52A0;&#x8FBE;&#x5230;&#x670D;&#x52A1;&#x5668;&#x5185;&#x5B58;&#x5BB9;&#x91CF;&#x7684;&#x98CE;&#x9669;&#x3002;</p>
<p>&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;32M&#x5230;64M&#x662F;&#x5EFA;&#x8BAE;&#x503C;&#xFF0C;&#x4ECE;&#x8FD9;&#x4E24;&#x4E2A;&#x53D8;&#x91CF;&#x5F00;&#x59CB;&#x5E76;&#x6839;&#x636E;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x8C03;&#x4F18;&#x3002;</p>
<p><strong>&#x5728;Monyog&#x4E2D;&#x7684;&#x4E34;&#x65F6;&#x8868;&#x76D1;&#x6D4B;</strong></p>
<p>&#x4E34;&#x65F6;&#x8868;&#x7684;&#x76D1;&#x6D4B;&#x662F;&#x8BB8;&#x591A;&#x9884;&#x5B9A;&#x4E49;&#x7684;Monyog&#x76D1;&#x6D4B;&#x4E4B;&#x4E00;&#x3002;&#x5B83;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E9B;&#x4E34;&#x65F6;&#x8868;&#x4F7F;&#x7528;&#x7684;&#x6307;&#x6807;&#xFF0C;&#x5305;&#x62EC;&#xFF1A;</p>
<ul>
<li><strong>&#x5141;&#x8BB8;&#x7684;&#x6700;&#x5927;&#x503C;</strong>&#xFF1A;&#x663E;&#x793A;tmp_table_size&#x670D;&#x52A1;&#x5668;&#x53D8;&#x91CF;&#x7684;&#x503C;&#xFF0C;&#x5B83;&#x5B9A;&#x4E49;&#x4E86;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x521B;&#x5EFA;&#x7684;&#x4E34;&#x65F6;&#x8868;&#x7684;&#x6700;&#x5927;&#x5927;&#x5C0F;&#x3002;&#x4E0E;max_heap_table_size&#x4E00;&#x8D77;&#xFF0C;&#x8FD9;&#x4E2A;&#x503C;&#x5B9A;&#x4E49;&#x4E86;&#x53EF;&#x4EE5;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x521B;&#x5EFA;&#x7684;&#x4E34;&#x65F6;&#x8868;&#x7684;&#x6700;&#x5927;&#x5927;&#x5C0F;&#x3002;&#x5982;&#x679C;&#x5185;&#x5B58;&#x4E34;&#x65F6;&#x8868;&#x5927;&#x4E8E;&#x6B64;&#x5927;&#x5C0F;&#xFF0C;&#x5219;&#x5C06;&#x5176;&#x5B58;&#x50A8;&#x5728;&#x78C1;&#x76D8;&#x4E0A;&#x3002;</li>
<li><strong>&#x5185;&#x5B58;&#x8868;&#x7684;&#x6700;&#x5927;&#x5927;&#x5C0F;</strong>&#xFF1A;&#x663E;&#x793A;max_heap_table_size&#x670D;&#x52A1;&#x5668;&#x53D8;&#x91CF;&#x7684;&#x503C;&#xFF0C;&#x8BE5;&#x503C;&#x5B9A;&#x4E49;&#x4E86;&#x663E;&#x5F0F;&#x521B;&#x5EFA;&#x7684;MEMORY&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x8868;&#x7684;&#x6700;&#x5927;&#x5927;&#x5C0F;&#x3002;</li>
<li><strong>&#x521B;&#x5EFA;&#x7684;&#x4E34;&#x65F6;&#x8868;&#x603B;&#x6570;</strong>&#xFF1A;&#x663E;&#x793A;created_tmp_tables&#x670D;&#x52A1;&#x5668;&#x53D8;&#x91CF;&#x7684;&#x503C;&#xFF0C;&#x5B83;&#x5B9A;&#x4E49;&#x4E86;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x521B;&#x5EFA;&#x7684;&#x4E34;&#x65F6;&#x8868;&#x7684;&#x6570;&#x91CF;&#x3002;</li>
<li><strong>&#x5728;&#x78C1;&#x76D8;&#x4E0A;&#x521B;&#x5EFA;&#x7684;&#x4E34;&#x65F6;&#x8868;</strong>&#xFF1A;&#x663E;&#x793A;created_tmp_disk_tables&#x670D;&#x52A1;&#x5668;&#x53D8;&#x91CF;&#x7684;&#x503C;&#xFF0C;&#x8BE5;&#x53D8;&#x91CF;&#x5B9A;&#x4E49;&#x4E86;&#x5728;&#x78C1;&#x76D8;&#x4E0A;&#x521B;&#x5EFA;&#x7684;&#x4E34;&#x65F6;&#x8868;&#x7684;&#x6570;&#x91CF;&#x3002;&#x5982;&#x679C;&#x8FD9;&#x4E2A;&#x503C;&#x5F88;&#x9AD8;&#xFF0C;&#x5219;&#x5E94;&#x8BE5;&#x8003;&#x8651;&#x589E;&#x52A0;tmp_table_size&#x548C;max_heap_table_size&#x7684;&#x503C;&#xFF0C;&#x4EE5;&#x4FBF;&#x589E;&#x52A0;&#x521B;&#x5EFA;&#x5185;&#x5B58;&#x4E34;&#x65F6;&#x8868;&#x7684;&#x6570;&#x91CF;&#xFF0C;&#x4ECE;&#x800C;&#x51CF;&#x5C11;&#x5728;&#x78C1;&#x76D8;&#x4E0A;&#x521B;&#x5EFA;&#x4E34;&#x65F6;&#x8868;&#x7684;&#x6570;&#x91CF;&#x3002;</li>
<li><strong>&#x78C1;&#x76D8;&#xFF1A;&#x603B;&#x6BD4;&#x7387;</strong>&#xFF1A;&#x57FA;&#x4E8E;created_tmp_disk_tables&#x9664;&#x4EE5;created_tmp_tables&#x7684;&#x8BA1;&#x7B97;&#x503C;&#x3002;&#x7531;&#x4E8E;tmp_table_size&#x6216;max_heap_table_size&#x4E0D;&#x8DB3;&#x800C;&#x5728;&#x78C1;&#x76D8;&#x4E0A;&#x521B;&#x5EFA;&#x7684;&#x4E34;&#x65F6;&#x8868;&#x7684;&#x767E;&#x5206;&#x6BD4;&#x3002;Monyog&#x5C06;&#x8FD9;&#x4E2A;&#x6570;&#x5B57;&#x663E;&#x793A;&#x4E3A;&#x4E00;&#x4E2A;&#x8FDB;&#x5EA6;&#x6761;&#x548C;&#x767E;&#x5206;&#x6BD4;&#xFF0C;&#x4EE5;&#x4FBF;&#x5FEB;&#x901F;&#x786E;&#x5B9A;&#x6709;&#x591A;&#x5C11;&#x78C1;&#x76D8;&#x7528;&#x4E8E;&#x4E34;&#x65F6;&#x8868;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5185;&#x5B58;&#x3002;</li>
</ul>
<p>&#x8D8B;&#x52BF;&#x56FE;&#x53EF;&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x7684;&#x603B;&#x8868;&#xFF0C;&#x78C1;&#x76D8;&#x4E0A;&#x521B;&#x5EFA;&#x7684;&#x8868;&#x548C;&#x78C1;&#x76D8;&#x7684;&#x603B;&#x6BD4;&#x503C;&#x3002;&#x8FD9;&#x4E9B;&#x8BA9;&#x6211;&#x4EEC;&#x770B;&#x5230;&#x4E86;&#x5B83;&#x4EEC;&#x968F;&#x7740;&#x65F6;&#x95F4;&#x7684;&#x6F14;&#x53D8;&#xFF1A;</p>
<h3 id="&#x6280;&#x5DE7;-3&#xFF1A;&#x589E;&#x52A0;&#x7EBF;&#x7A0B;&#x7F13;&#x5B58;&#x5927;&#x5C0F;"><a href="#&#x6280;&#x5DE7;-3&#xFF1A;&#x589E;&#x52A0;&#x7EBF;&#x7A0B;&#x7F13;&#x5B58;&#x5927;&#x5C0F;" class="headerlink" title="&#x6280;&#x5DE7;#3&#xFF1A;&#x589E;&#x52A0;&#x7EBF;&#x7A0B;&#x7F13;&#x5B58;&#x5927;&#x5C0F;"></a>&#x6280;&#x5DE7;#3&#xFF1A;&#x589E;&#x52A0;&#x7EBF;&#x7A0B;&#x7F13;&#x5B58;&#x5927;&#x5C0F;</h3><p>&#x8FDE;&#x63A5;&#x7BA1;&#x7406;&#x5668;&#x7EBF;&#x7A0B;&#x5904;&#x7406;&#x670D;&#x52A1;&#x5668;&#x76D1;&#x542C;&#x7684;&#x7F51;&#x7EDC;&#x63A5;&#x53E3;&#x4E0A;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#x3002;&#x8FDE;&#x63A5;&#x7BA1;&#x7406;&#x5668;&#x7EBF;&#x7A0B;&#x5C06;&#x6BCF;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x8FDE;&#x63A5;&#x4E0E;&#x4E13;&#x7528;&#x4E8E;&#x5B83;&#x7684;&#x7EBF;&#x7A0B;&#x5173;&#x8054;&#xFF0C;&#x8BE5;&#x7EBF;&#x7A0B;&#x8D1F;&#x8D23;&#x5904;&#x7406;&#x8BE5;&#x8FDE;&#x63A5;&#x7684;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x548C;&#x6240;&#x6709;&#x8BF7;&#x6C42;&#x5904;&#x7406;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x7EBF;&#x7A0B;&#x548C;&#x5F53;&#x524D;&#x8FDE;&#x63A5;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x4E4B;&#x95F4;&#x662F;&#x4E00;&#x5BF9;&#x4E00;&#x7684;&#x6BD4;&#x4F8B;&#x3002;&#x786E;&#x4FDD;&#x7EBF;&#x7A0B;&#x7F13;&#x5B58;&#x8DB3;&#x591F;&#x5927;&#x4EE5;&#x5BB9;&#x7EB3;&#x6240;&#x6709;&#x4F20;&#x5165;&#x8BF7;&#x6C42;&#x662F;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#x3002;</p>
<p>MySQL&#x63D0;&#x4F9B;&#x4E86;&#x8BB8;&#x591A;&#x4E0E;&#x8FDE;&#x63A5;&#x7EBF;&#x7A0B;&#x76F8;&#x5173;&#x7684;&#x670D;&#x52A1;&#x5668;&#x53D8;&#x91CF;&#xFF1A;</p>
<p>&#x7EBF;&#x7A0B;&#x7F13;&#x5B58;&#x5927;&#x5C0F;&#x7531;thread_cache_size&#x7CFB;&#x7EDF;&#x53D8;&#x91CF;&#x51B3;&#x5B9A;&#x3002;&#x9ED8;&#x8BA4;&#x503C;&#x4E3A;0&#xFF08;&#x65E0;&#x7F13;&#x5B58;&#xFF09;&#xFF0C;&#x8FD9;&#x5C06;&#x5BFC;&#x81F4;&#x4E3A;&#x6BCF;&#x4E2A;&#x65B0;&#x8FDE;&#x63A5;&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#xFF0C;&#x5E76;&#x5728;&#x8FDE;&#x63A5;&#x7EC8;&#x6B62;&#x65F6;&#x9700;&#x8981;&#x5904;&#x7406;&#x8BE5;&#x7EBF;&#x7A0B;&#x3002;&#x5982;&#x679C;&#x5E0C;&#x671B;&#x670D;&#x52A1;&#x5668;&#x6BCF;&#x79D2;&#x63A5;&#x6536;&#x6570;&#x767E;&#x4E2A;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#xFF0C;&#x90A3;&#x4E48;&#x5E94;&#x8BE5;&#x5C06;thread_cache_size&#x8BBE;&#x7F6E;&#x7684;&#x8DB3;&#x591F;&#x9AD8;&#xFF0C;&#x4EE5;&#x4FBF;&#x5927;&#x591A;&#x6570;&#x65B0;&#x8FDE;&#x63A5;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x7F13;&#x5B58;&#x7EBF;&#x7A0B;&#x3002;&#x53EF;&#x4EE5;&#x5728;&#x670D;&#x52A1;&#x5668;&#x542F;&#x52A8;&#x6216;&#x8FD0;&#x884C;&#x65F6;&#x8BBE;&#x7F6E;max_connections&#x7684;&#x503C;&#x3002;</p>
<p>&#x8FD8;&#x5E94;&#x8BE5;&#x76D1;&#x89C6;&#x7F13;&#x5B58;&#x4E2D;&#x7684;&#x7EBF;&#x7A0B;&#x6570;&#xFF08;Threads_cached&#xFF09;&#x4EE5;&#x53CA;&#x521B;&#x5EFA;&#x4E86;&#x591A;&#x5C11;&#x4E2A;&#x7EBF;&#x7A0B;&#xFF0C;&#x56E0;&#x4E3A;&#x65E0;&#x6CD5;&#x4ECE;&#x7F13;&#x5B58;&#x4E2D;&#x83B7;&#x53D6;&#x7EBF;&#x7A0B;&#xFF08;Threads_created&#xFF09;&#x3002;&#x5173;&#x4E8E;&#x540E;&#x8005;&#xFF0C;&#x5982;&#x679C;Threads_created&#x7EE7;&#x7EED;&#x4EE5;&#x6BCF;&#x5206;&#x949F;&#x591A;&#x4E8E;&#x51E0;&#x4E2A;&#x7EBF;&#x7A0B;&#x7684;&#x589E;&#x52A0;&#xFF0C;&#x8BF7;&#x8003;&#x8651;&#x589E;&#x52A0;thread_cache_size&#x7684;&#x503C;&#x3002;</p>
<p>&#x4F7F;&#x7528;MySQL show status&#x547D;&#x4EE4;&#x663E;&#x793A;MySQL&#x7684;&#x53D8;&#x91CF;&#x548C;&#x72B6;&#x6001;&#x4FE1;&#x606F;&#x3002;&#x8FD9;&#x91CC;&#x6709;&#x51E0;&#x4E2A;&#x4F8B;&#x5B50;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;SHOW GLOBAL STATUS LIKE &apos;%Threads_connected%&apos;;</span><br><span class="line">&#xA0;</span><br><span class="line">+-------------------+-------+</span><br><span class="line">&#xA0;</span><br><span class="line">| Variable_name&#xA0;&#xA0;&#xA0;&#xA0; | Value |</span><br><span class="line">&#xA0;</span><br><span class="line">+-------------------+-------+</span><br><span class="line">&#xA0;</span><br><span class="line">| Threads_connected | 2&#xA0;&#xA0;&#xA0;&#xA0; |</span><br><span class="line">&#xA0;</span><br><span class="line">+-------------------+-------+</span><br><span class="line">SHOW GLOBAL STATUS LIKE &apos;%Threads_running%&apos;;</span><br><span class="line">&#xA0;</span><br><span class="line">+-----------------+-------+</span><br><span class="line">&#xA0;</span><br><span class="line">| Variable_name&#xA0;&#xA0; | Value |</span><br><span class="line">&#xA0;</span><br><span class="line">+-----------------+-------+</span><br><span class="line">&#xA0;</span><br><span class="line">| Threads_running | 1&#xA0;&#xA0;&#xA0;&#xA0; |</span><br><span class="line">&#xA0;</span><br><span class="line">+-----------------+-------+</span><br></pre></td></tr></table></figure>

<p><strong>Monyog&#x7EBF;&#x7A0B;&#x7F13;&#x5B58;&#x76D1;&#x6D4B;</strong></p>
<p>Monyog&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x76D1;&#x63A7;&#x7EBF;&#x7A0B;&#x7F13;&#x5B58;&#x7684;&#x5C4F;&#x5E55;&#xFF0C;&#x540D;&#x4E3A;&#x201C;&#x7EBF;&#x7A0B;&#x201D;&#x3002;&#x4E0E;MySQL&#x7EBF;&#x7A0B;&#x76F8;&#x5173;&#x7684;&#x670D;&#x52A1;&#x5668;&#x53D8;&#x91CF;&#x6620;&#x5C04;&#x5230;&#x4EE5;&#x4E0B;Monyog&#x6307;&#x6807;&#xFF1A;</p>
<ul>
<li>thread_cache_size&#xFF1A;&#x53EF;&#x4EE5;&#x7F13;&#x5B58;&#x7684;&#x7EBF;&#x7A0B;&#x6570;&#x3002;</li>
<li>Threads_cached&#xFF1A;&#x7F13;&#x5B58;&#x4E2D;&#x7684;&#x7EBF;&#x7A0B;&#x6570;&#x3002;</li>
<li>Threads_created&#xFF1A;&#x521B;&#x5EFA;&#x7528;&#x4E8E;&#x5904;&#x7406;&#x8FDE;&#x63A5;&#x7684;&#x7EBF;&#x7A0B;&#x3002;</li>
</ul>
<p>Monyog&#x7EBF;&#x7A0B;&#x5C4F;&#x5E55;&#x8FD8;&#x5305;&#x62EC;&#x201C;&#x7EBF;&#x7A0B;&#x7F13;&#x5B58;&#x547D;&#x4E2D;&#x7387;&#x201D;&#x6307;&#x6807;&#x3002;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x63D0;&#x793A;&#x7EBF;&#x7A0B;&#x7F13;&#x5B58;&#x547D;&#x4E2D;&#x7387;&#x7684;&#x6307;&#x6807;&#x3002;&#x5982;&#x679C;&#x503C;&#x8F83;&#x4F4E;&#xFF0C;&#x5219;&#x5E94;&#x8BE5;&#x8003;&#x8651;&#x589E;&#x52A0;&#x7EBF;&#x7A0B;&#x7F13;&#x5B58;&#x3002;&#x5728;&#x72B6;&#x6001;&#x680F;&#x4EE5;&#x767E;&#x5206;&#x6BD4;&#x5F62;&#x5F0F;&#x663E;&#x793A;&#x8BE5;&#x503C;&#xFF1B;&#x5B83;&#x7684;&#x503C;&#x8D8A;&#x63A5;&#x8FD1;100&#xFF05;&#x8D8A;&#x597D;&#x3002;</p>
<p>&#x5982;&#x679C;&#x8FD9;&#x4E9B;&#x6307;&#x6807;&#x7684;&#x503C;&#x7B49;&#x4E8E;&#x6216;&#x8D85;&#x8FC7;&#x6307;&#x5B9A;&#x503C;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x5C06;&#x6BCF;&#x4E00;&#x4E2A;&#x6307;&#x6807;&#x914D;&#x7F6E;&#x4E3A;&#x53D1;&#x51FA;&#x8B66;&#x544A;&#x548C;/&#x6216;&#x4E25;&#x91CD;&#x8B66;&#x62A5;&#x3002;</p>
<h3 id="&#x5176;&#x4ED6;&#x76F8;&#x5173;&#x7684;&#x670D;&#x52A1;&#x5668;&#x53D8;&#x91CF;"><a href="#&#x5176;&#x4ED6;&#x76F8;&#x5173;&#x7684;&#x670D;&#x52A1;&#x5668;&#x53D8;&#x91CF;" class="headerlink" title="&#x5176;&#x4ED6;&#x76F8;&#x5173;&#x7684;&#x670D;&#x52A1;&#x5668;&#x53D8;&#x91CF;"></a>&#x5176;&#x4ED6;&#x76F8;&#x5173;&#x7684;&#x670D;&#x52A1;&#x5668;&#x53D8;&#x91CF;</h3><p>&#x9664;&#x4E86;&#x4E0A;&#x8FF0;&#x6307;&#x6807;&#x4EE5;&#x5916;&#xFF0C;&#x8FD8;&#x5E94;&#x8BE5;&#x76D1;&#x63A7;&#x4EE5;&#x4E0B;&#x5185;&#x5BB9;&#xFF1A;</p>
<ol>
<li><strong>InnoDB&#x7F13;&#x51B2;&#x6C60;&#x5927;&#x5C0F;</strong>&#xFF1A; InnoDB&#x7F13;&#x51B2;&#x6C60;&#x5927;&#x5C0F;&#x5728;&#x4F7F;&#x7528;InnoDB&#x7684;MySQL&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x8D77;&#x7740;&#x81F3;&#x5173;&#x91CD;&#x8981;&#x7684;&#x4F5C;&#x7528;&#x3002;&#x7F13;&#x51B2;&#x6C60;&#x540C;&#x65F6;&#x7F13;&#x5B58;&#x6570;&#x636E;&#x548C;&#x7D22;&#x5F15;&#x3002;&#x5B83;&#x7684;&#x503C;&#x5E94;&#x8BE5;&#x5C3D;&#x53EF;&#x80FD;&#x7684;&#x5927;&#xFF0C;&#x4EE5;&#x786E;&#x4FDD;&#x6570;&#x636E;&#x5E93;&#x4F7F;&#x7528;&#x5185;&#x5B58;&#x800C;&#x4E0D;&#x662F;&#x786C;&#x76D8;&#x9A71;&#x52A8;&#x5668;&#x8FDB;&#x884C;&#x8BFB;&#x53D6;&#x64CD;&#x4F5C;&#x3002;</li>
<li><strong>&#x4E34;&#x65F6;&#x8868;&#x5927;&#x5C0F;</strong>&#xFF1A; MySQL&#x4F7F;&#x7528;max_heap_table_size&#x548C;tmp_table_size&#x4E2D;&#x8F83;&#x5C0F;&#x7684;&#x4E00;&#x4E2A;&#x6765;&#x9650;&#x5236;&#x5185;&#x5B58;&#x4E2D;&#x4E34;&#x65F6;&#x8868;&#x7684;&#x5927;&#x5C0F;&#x3002;&#x62E5;&#x6709;&#x8F83;&#x5927;&#x7684;&#x503C;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x51CF;&#x5C11;&#x5728;&#x78C1;&#x76D8;&#x4E0A;&#x521B;&#x5EFA;&#x4E34;&#x65F6;&#x8868;&#x7684;&#x6570;&#x91CF;&#xFF0C;&#x4F46;&#x4E5F;&#x4F1A;&#x589E;&#x52A0;&#x670D;&#x52A1;&#x5668;&#x5185;&#x5B58;&#x5BB9;&#x91CF;&#x7684;&#x98CE;&#x9669;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x4E2A;&#x6307;&#x6807;&#x9002;&#x7528;&#x4E8E;&#x6BCF;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x3002;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;32M&#x5230;64M&#x662F;&#x5EFA;&#x8BAE;&#x7684;&#x503C;&#xFF0C;&#x4ECE;&#x8FD9;&#x4E24;&#x4E2A;&#x53D8;&#x91CF;&#x5F00;&#x59CB;&#x5E76;&#x6839;&#x636E;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x8C03;&#x4F18;&#x3002;</li>
<li><strong>InnoDB&#x65E5;&#x5FD7;&#x7F13;&#x51B2;&#x533A;&#x5927;&#x5C0F;</strong>&#xFF1A; MySQL&#x6BCF;&#x6B21;&#x5199;&#x5165;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x65F6;&#xFF0C;&#x5B83;&#x90FD;&#x4F1A;&#x5229;&#x7528;&#x53EF;&#x7528;&#x4E8E;&#x5904;&#x7406;&#x9500;&#x552E;&#x6570;&#x636E;&#x7684;&#x91CD;&#x8981;&#x7CFB;&#x7EDF;&#x8D44;&#x6E90;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5C06;InnoDB&#x65E5;&#x5FD7;&#x7F13;&#x51B2;&#x533A;&#x5927;&#x5C0F;&#x8BBE;&#x7F6E;&#x4E3A;&#x8F83;&#x5927;&#x503C;&#x624D;&#x6709;&#x610F;&#x4E49;&#x3002;&#x8FD9;&#x6837;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x5728;&#x5927;&#x578B;&#x4E8B;&#x52A1;&#x4E2D;&#x5199;&#x5165;&#x78C1;&#x76D8;&#x7684;&#x6B21;&#x6570;&#x5C31;&#x51CF;&#x5C11;&#x4E86;&#xFF0C;&#x4ECE;&#x800C;&#x6700;&#x5927;&#x9650;&#x5EA6;&#x5730;&#x51CF;&#x5C11;&#x4E86;&#x8FD9;&#x4E9B;&#x8017;&#x65F6;&#x7684;&#x64CD;&#x4F5C;&#x3002;64M&#x662F;&#x8FD9;&#x4E2A;&#x53D8;&#x91CF;&#x7684;&#x4E00;&#x4E2A;&#x5F88;&#x597D;&#x7684;&#x8D77;&#x70B9;&#x3002;</li>
</ol>
<h3 id="&#x7ED3;&#x8BBA;"><a href="#&#x7ED3;&#x8BBA;" class="headerlink" title="&#x7ED3;&#x8BBA;"></a>&#x7ED3;&#x8BBA;</h3><p>&#x867D;&#x7136;&#x5373;&#x4FBF;&#x662F;&#x6700;&#x5927;&#x7684;&#x516C;&#x53F8;&#x7F51;&#x7AD9;&#x4E5F;&#x4F1A;&#x56E0;&#x5B95;&#x673A;&#x800C;&#x906D;&#x53D7;&#x635F;&#x5931;&#xFF0C;&#x4F46;&#x8FD9;&#x79CD;&#x5F71;&#x54CD;&#x5BF9;&#x4E8E;&#x5904;&#x7406;&#x7F51;&#x4E0A;&#x9500;&#x552E;&#x7684;&#x4E2D;&#x5C0F;&#x578B;&#x4F01;&#x4E1A;&#x5C24;&#x5176;&#x5173;&#x952E;&#x3002;&#x6839;&#x636E;<a href="/external_links/db0a0993d5952246b623e42b01885812.html" target="blank" rel="noopener">&#x6700;&#x8FD1;&#x7684;&#x4E00;&#x4EFD;&#x8C03;&#x67E5;&#x62A5;&#x544A;</a>&#x663E;&#x793A;&#xFF0C;&#x4E00;&#x5206;&#x949F;&#x7684;&#x5B95;&#x673A;&#x5BFC;&#x81F4;&#x4F01;&#x4E1A;&#x5E73;&#x5747;&#x635F;&#x5931;&#x7EA6;5000&#x7F8E;&#x5143;&#x3002;&#x4E0D;&#x8981;&#x8BA9;&#x4F60;&#x7684;&#x4E1A;&#x52A1;&#x6210;&#x4E3A;&#x90A3;&#x79CD;&#x7EDF;&#x8BA1;&#x6570;&#x636E;&#xFF08;&#x56E0;&#x4E3A;&#x5B95;&#x673A;&#x9020;&#x6210;&#x7684;&#x635F;&#x5931;&#xFF09;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x3002;&#x5728;&#x5047;&#x65E5;&#x7E41;&#x5FD9;&#x4E4B;&#x524D;&#xFF0C;&#x4E3B;&#x52A8;&#x8C03;&#x4F18;MySQL&#x6570;&#x636E;&#x5E93;&#x670D;&#x52A1;&#x5668;&#xFF08;S&#xFF09;&#x5E76;&#x6536;&#x83B7;&#x56DE;&#x62A5;&#x5427;&#xFF01;</p>
<p> 1 &#x8D5E;  1 &#x6536;&#x85CF;  <a href="#article-comment">2 &#x8BC4;&#x8BBA;</a> </p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/f2b9a7e439033cb397564d40cde0c81b.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903524996743176.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903524996743176.html" itemprop="url">【译】Python的enumerate()函数揭秘</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-14T10:17:18+08:00">
                2017-12-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>&#x4ECA;&#x5929;&#x7684;&#x539F;&#x6587;&#x7684;&#x4F5C;&#x8005;&#x662F;&#x6765;&#x81EA;&#x56FD;&#x5916;&#x7684;&#x4EE5;&#x4E3A;Python&#x201C;&#x5E03;&#x9053;&#x5E08;&#x201D;<a href="/external_links/3df87d7025c1240779186dc2036a6d17.html" target="blank" rel="noopener">Dan Bader</a>&#xFF0C;&#x4ED6;&#x7684;&#x535A;&#x5BA2;&#x5B8C;&#x5168;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x4E2A;&#x4EBA;&#x54C1;&#x724C;&#x7684;&#x5B66;&#x6821;&#x3002;&#x6709;&#x8DDF;&#x591A;Python&#x6280;&#x5DE7;&#xFF0C;&#x6709;&#x5F88;&#x591A;&#x4ED6;&#x5F55;&#x5236;&#x7684;Youtube&#x89C6;&#x9891;&#xFF0C;&#x56FD;&#x5185;&#x7684;Pythonista&#x4EEC;&#xFF0C;&#x4E0D;&#x59A8;&#x8BA2;&#x9605;&#x4E00;&#x4E0B;&#x4ED6;&#x7684;&#x6BCF;&#x5468;&#x90AE;&#x4EF6;&#x63A8;&#x9001;&#x3002;<a href="/external_links/ed1bf619198074ef4138711486e2d769.html" target="blank" rel="noopener">&#x8BA2;&#x9605;&#x94FE;&#x63A5;</a></p>
<p>&#x4ECA;&#x5929;&#x7684;&#x8BD1;&#x6587;&#x662F;&#x4ED6;&#x535A;&#x5BA2;&#x4E2D;&#x7684;&#x4E00;&#x7BC7;&#xFF0C;&#x70B9;&#x51FB;<a href="/external_links/14783d23bd1f4246bea9990dca70125e.html" target="blank" rel="noopener">&#x67E5;&#x770B;&#x539F;&#x6587;</a></p>
</blockquote>
<p>&#x5982;&#x4F55;&#x4EE5;&#x53BB;&#x5199;&#x4EE5;&#x53CA;&#x4E3A;&#x4EC0;&#x4E48;&#x4F60;&#x5E94;&#x8BE5;&#x4F7F;&#x7528;Python&#x4E2D;&#x7684;&#x5185;&#x7F6E;&#x679A;&#x4E3E;&#x51FD;&#x6570;&#x6765;&#x7F16;&#x5199;&#x66F4;&#x5E72;&#x51C0;&#x66F4;&#x52A0;Pythonic&#x7684;&#x5FAA;&#x73AF;&#x8BED;&#x53E5;&#xFF1F;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/aca000c28e96658fdfa9292128f9da7d1cce861ba4729413adcf7241162516bd" alt="python-enumerate.jpg"></p>
<p>Python&#x7684;<code>enumerate</code>&#x51FD;&#x6570;&#x662F;&#x4E00;&#x4E2A;&#x795E;&#x8BDD;&#x822C;&#x7684;&#x5B58;&#x5728;&#xFF0C;&#x4EE5;&#x81F3;&#x4E8E;&#x5B83;&#x5F88;&#x96BE;&#x7528;&#x4E00;&#x53E5;&#x8BDD;&#x53BB;&#x603B;&#x7ED3;&#x5B83;&#x7684;&#x76EE;&#x7684;&#x548C;&#x7528;&#x5904;&#x3002;</p>
<p>&#x4F46;&#x662F;&#xFF0C;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x6709;&#x7528;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x8BB8;&#x591A;&#x521D;&#x5B66;&#x8005;&#xFF0C;&#x751A;&#x81F3;&#x4E2D;&#x7EA7;Pythonistas&#x662F;&#x5E76;&#x6CA1;&#x6709;&#x771F;&#x6B63;&#x610F;&#x8BC6;&#x5230;&#x3002;&#x7B80;&#x5355;&#x6765;&#x8BF4;&#xFF0C;<code>enumerate()</code>&#x662F;&#x7528;&#x6765;&#x904D;&#x5386;&#x4E00;&#x4E2A;&#x53EF;&#x8FED;&#x4EE3;&#x5BB9;&#x5668;&#x4E2D;&#x7684;&#x5143;&#x7D20;&#xFF0C;&#x540C;&#x65F6;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x8BA1;&#x6570;&#x5668;&#x53D8;&#x91CF;&#x8BB0;&#x5F55;&#x5F53;&#x524D;&#x5143;&#x7D20;&#x6240;&#x5BF9;&#x5E94;&#x7684;&#x7D22;&#x5F15;&#x503C;&#x3002;</p>
<p>&#x8BA9;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E00;&#x4E2A;&#x793A;&#x4F8B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;names = [&apos;Bob&apos;, &apos;Alice&apos;, &apos;Guido&apos;]</span><br><span class="line">for index, value in enumerate(names):</span><br><span class="line">    print(f&apos;{index}: {value}&apos;)</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x4F1A;&#x8F93;&#x5165;&#x5982;&#x4E0B;&#x5185;&#x5BB9;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;0: Bob</span><br><span class="line">1: Alice</span><br><span class="line">2: Guido</span><br></pre></td></tr></table></figure>

<p>&#x6B63;&#x5982;&#x4F60;&#x6240;&#x770B;&#x5230;&#x7684;&#xFF0C;&#x8FD9;&#x4E2A;&#x5FAA;&#x73AF;&#x904D;&#x5386;&#x4E86;<code>names</code>&#x5217;&#x8868;&#x7684;&#x6240;&#x6709;&#x5143;&#x7D20;&#xFF0C;&#x5E76;&#x901A;&#x8FC7;&#x589E;&#x52A0;&#x4ECE;&#x96F6;&#x5F00;&#x59CB;&#x7684;&#x8BA1;&#x6570;&#x5668;&#x53D8;&#x91CF;&#x6765;&#x4E3A;&#x6BCF;&#x4E2A;&#x5143;&#x7D20;&#x751F;&#x6210;&#x7D22;&#x5F15;&#x3002;</p>
<p><em>[&#x5982;&#x679C;&#x60A8;&#x60F3;&#x77E5;&#x9053;&#x4E0A;&#x9762;&#x4F8B;&#x5B50;&#x4E2D;&#x4F7F;&#x7528;&#x7684;f&#x2019;&#x2026;&#x2019;&#x5B57;&#x7B26;&#x4E32;&#x8BED;&#x6CD5;&#xFF0C;&#x8FD9;&#x662F;Python 3.6&#x53CA;&#x66F4;&#x9AD8;&#x7248;&#x672C;&#x4E2D;&#x63D0;&#x4F9B;&#x7684;&#x4E00;&#x79CD;&#x65B0;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x683C;&#x5F0F;&#x5316;&#x6280;&#x5DE7;&#x3002;]</em></p>
<h2 id="&#x7528;enumerate-&#x8BA9;&#x4F60;&#x7684;&#x5FAA;&#x73AF;&#x66F4;&#x52A0;Pythonic"><a href="#&#x7528;enumerate-&#x8BA9;&#x4F60;&#x7684;&#x5FAA;&#x73AF;&#x66F4;&#x52A0;Pythonic" class="headerlink" title="&#x7528;enumerate()&#x8BA9;&#x4F60;&#x7684;&#x5FAA;&#x73AF;&#x66F4;&#x52A0;Pythonic"></a>&#x7528;<code>enumerate()</code>&#x8BA9;&#x4F60;&#x7684;&#x5FAA;&#x73AF;&#x66F4;&#x52A0;Pythonic</h2><p>&#x90A3;&#x4E48;&#x4E3A;&#x4EC0;&#x4E48;&#x7528;<code>enumerate()</code>&#x51FD;&#x6570;&#x53BB;&#x4FDD;&#x5B58;&#x8FD0;&#x884C;&#x4E2D;&#x7684;&#x7D22;&#x5F15;&#x5F88;&#x6709;&#x7528;&#x5462;&#xFF1F;</p>
<p>&#x6211;&#x53D1;&#x73B0;&#xFF0C;&#x6709;&#x5F88;&#x591A;&#x4ECE;C&#x6216;Java&#x80CC;&#x666F;&#x8F6C;&#x8FC7;&#x6765;&#x7684;&#x65B0;&#x7684;Python&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x6709;&#x65F6;&#x4F7F;&#x7528;&#x4E0B;&#x9762;&#x8FD9;&#x79CD;<code>range(len(...))</code>&#x65B9;&#x6CD5;&#x6765;&#x4FDD;&#x5B58;&#x8FD0;&#x884C;&#x4E2D;&#x6BCF;&#x4E2A;&#x5143;&#x7D20;&#x7684;&#x7D22;&#x5F15;&#xFF0C;&#x540C;&#x65F6;&#x518D;&#x7528;<code>for</code>&#x5FAA;&#x73AF;&#x904D;&#x5386;&#x5217;&#x8868;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;# &#x8B66;&#x544A;: &#x4E0D;&#x5EFA;&#x8BAE;&#x8FD9;&#x4E48;&#x5199;</span><br><span class="line">for i in range(len(my_items)):</span><br><span class="line">    print(i, my_items[i])</span><br></pre></td></tr></table></figure>

<p>&#x901A;&#x8FC7;&#x5DE7;&#x5999;&#x5730;&#x4F7F;&#x7528;<code>enumerate()</code>&#x51FD;&#x6570;&#xFF0C;&#x5C31;&#x50CF;&#x6211;&#x5728;&#x4E0A;&#x9762;&#x7684;&#x201C;names&#x201D;&#x4F8B;&#x5B50;&#x4E2D;&#x5199;&#x7684;&#x90A3;&#x6837;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;<a href="/external_links/46221dc8e6d9be0ec756391788841570.html" target="blank" rel="noopener">&#x4F7F;&#x4F60;&#x7684;&#x5FAA;&#x73AF;&#x7ED3;&#x6784;&#x770B;&#x8D77;&#x6765;&#x66F4;Pythonic</a>&#x548C;&#x5730;&#x9053;&#x3002;</p>
<p>&#x4F60;&#x4E0D;&#x518D;&#x9700;&#x8981;&#x5728;Python&#x4EE3;&#x7801;&#x4E2D;&#x4E13;&#x95E8;&#x53BB;&#x751F;&#x6210;&#x5143;&#x7D20;&#x7D22;&#x5F15;&#xFF0C;&#x800C;&#x662F;&#x5C06;&#x6240;&#x6709;&#x8FD9;&#x4E9B;&#x5DE5;&#x4F5C;&#x90FD;&#x4EA4;&#x7ED9;<code>enumerate()</code>&#x51FD;&#x6570;&#x5904;&#x7406;&#x5373;&#x53EF;&#x3002;&#x8FD9;&#x6837;&#xFF0C;&#x4F60;&#x7684;&#x4EE3;&#x7801;&#x5C06;&#x66F4;&#x5BB9;&#x6613;&#x88AB;&#x9605;&#x8BFB;&#xFF0C;&#x800C;&#x4E14;&#x51CF;&#x5C11;&#x5199;&#x9519;&#x4EE3;&#x7801;&#x7684;&#x5F71;&#x54CD;&#x3002;<em>&#xFF08;&#x8BD1;&#x8005;&#x6CE8;&#xFF1A;&#x5199;&#x7684;&#x4EE3;&#x7801;&#x8D8A;&#x591A;&#xFF0C;&#x51FA;&#x9519;&#x51E0;&#x7387;&#x8D8A;&#x9AD8;&#xFF0C;&#x5C3D;&#x91CF;&#x5C06;&#x81EA;&#x5DF1;&#x7684;&#x4EE3;&#x7801;&#x770B;&#x8D77;&#x6765;&#x7B80;&#x6D01;&#xFF0C;&#x6613;&#x8BFB;&#xFF0C;Pythonic&#xFF0C;&#x624D;&#x662F;&#x6211;&#x4EEC;&#x7684;&#x8FFD;&#x6C42;&#xFF09;</em></p>
<h2 id="&#x4FEE;&#x6539;&#x8D77;&#x59CB;&#x7D22;&#x5F15;"><a href="#&#x4FEE;&#x6539;&#x8D77;&#x59CB;&#x7D22;&#x5F15;" class="headerlink" title="&#x4FEE;&#x6539;&#x8D77;&#x59CB;&#x7D22;&#x5F15;"></a>&#x4FEE;&#x6539;&#x8D77;&#x59CB;&#x7D22;&#x5F15;</h2><p>&#x53E6;&#x4E00;&#x4E2A;&#x6709;&#x7528;&#x7684;&#x7279;&#x6027;&#x662F;&#xFF0C;<code>enumerate()</code>&#x51FD;&#x6570;&#x5141;&#x8BB8;&#x6211;&#x4EEC;&#x4E3A;&#x5FAA;&#x73AF;&#x81EA;&#x5B9A;&#x4E49;&#x8D77;&#x59CB;&#x7D22;&#x5F15;&#x503C;&#x3002;<code>enumerate()</code>&#x51FD;&#x6570;&#x4E2D;&#x63A5;&#x53D7;&#x4E00;&#x4E2A;&#x53EF;&#x9009;&#x53C2;&#x6570;&#xFF0C;&#x8BE5;&#x53C2;&#x6570;&#x5141;&#x8BB8;&#x4F60;&#x4E3A;&#x672C;&#x6B21;&#x5FAA;&#x73AF;&#x4E2D;&#x7684;&#x8BA1;&#x6570;&#x5668;&#x53D8;&#x91CF;&#x8BBE;&#x7F6E;&#x521D;&#x59CB;&#x503C;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;names = [&apos;Bob&apos;, &apos;Alice&apos;, &apos;Guido&apos;]</span><br><span class="line">for index, value in enumerate(names, 1):</span><br><span class="line">    print(f&apos;{index}: {value}&apos;)</span><br></pre></td></tr></table></figure>

<p>&#x5728;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x6211;&#x5C06;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x6539;&#x4E3A;<code>enumerate(names, 1)</code>&#xFF0C;&#x540E;&#x9762;&#x7684;&#x53C2;&#x6570;1&#x5C31;&#x662F;&#x672C;&#x6B21;&#x5FAA;&#x73AF;&#x7684;&#x8D77;&#x59CB;&#x7D22;&#x5F15;&#xFF0C;&#x66FF;&#x6362;&#x9ED8;&#x8BA4;&#x7684;0&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;1: Bob</span><br><span class="line">2: Alice</span><br><span class="line">3: Guido</span><br></pre></td></tr></table></figure>

<p>OK&#xFF0C;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x6F14;&#x793A;&#x7684;&#x5C31;&#x662F;&#x5982;&#x4F55;&#x5C06;Python&#x7684;<code>enumerate()</code>&#x51FD;&#x6570;&#x9ED8;&#x8BA4;0&#x8D77;&#x59CB;&#x7D22;&#x5F15;&#x503C;&#x4FEE;&#x6539;&#x4E3A;1&#xFF08;&#x6216;&#x8005;&#x5176;&#x4ED6;&#x4EFB;&#x4F55;&#x6574;&#x5F62;&#x503C;&#xFF0C;&#x6839;&#x636E;&#x9700;&#x6C42;&#x53BB;&#x8BBE;&#x7F6E;&#x4E0D;&#x540C;&#x503C;&#xFF09;</p>
<h2 id="enumerate-&#x80CC;&#x540E;&#x662F;&#x5982;&#x4F55;&#x5DE5;&#x4F5C;&#x7684;"><a href="#enumerate-&#x80CC;&#x540E;&#x662F;&#x5982;&#x4F55;&#x5DE5;&#x4F5C;&#x7684;" class="headerlink" title="enumerate()&#x80CC;&#x540E;&#x662F;&#x5982;&#x4F55;&#x5DE5;&#x4F5C;&#x7684;"></a><code>enumerate()</code>&#x80CC;&#x540E;&#x662F;&#x5982;&#x4F55;&#x5DE5;&#x4F5C;&#x7684;</h2><p>&#x4F60;&#x53EF;&#x80FD;&#x60F3;&#x77E5;&#x9053;<code>enumerate()</code>&#x51FD;&#x6570;&#x80CC;&#x540E;&#x662F;&#x5982;&#x4F55;&#x5DE5;&#x4F5C;&#x7684;&#x3002;&#x4E8B;&#x5B9E;&#x4E0A;&#x4ED6;&#x7684;&#x90E8;&#x5206;&#x9B54;&#x6CD5;&#x662F;&#x901A;&#x8FC7;<a href="/external_links/36a39269310e0b87ffe3505808916237.html" target="blank" rel="noopener">Python&#x8FED;&#x4EE3;&#x5668;</a>&#x6765;&#x5B9E;&#x73B0;&#x7684;&#x3002;&#x610F;&#x601D;&#x5C31;&#x662F;&#x6BCF;&#x4E2A;&#x5143;&#x7D20;&#x7684;&#x7D22;&#x5F15;&#x662F;&#x61D2;&#x52A0;&#x8F7D;&#x7684;&#xFF08;&#x4E00;&#x4E2A;&#x63A5;&#x4E00;&#x4E2A;&#xFF0C;&#x7528;&#x7684;&#x65F6;&#x5019;&#x751F;&#x6210;&#xFF09;&#xFF0C;&#x8FD9;&#x4F7F;&#x5F97;&#x5185;&#x5B58;&#x4F7F;&#x7528;&#x91CF;&#x5F88;&#x4F4E;&#x5E76;&#x4E14;&#x4FDD;&#x6301;&#x8FD9;&#x4E2A;&#x7ED3;&#x6784;&#x8FD0;&#x884C;&#x5F88;&#x5FEB;&#x3002;</p>
<p>&#x8BA9;&#x6211;&#x4EEC;&#x6F14;&#x793A;&#x4E00;&#x4E9B;&#x66F4;&#x591A;&#x7684;&#x4EE3;&#x7801;&#x6765;&#x8868;&#x8FBE;&#x6211;&#x7684;&#x610F;&#x601D;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&gt;&gt;&gt; names = [&apos;Bob&apos;, &apos;Alice&apos;, &apos;Guido&apos;]</span><br><span class="line">&gt;&gt;&gt; enumerate(names)</span><br><span class="line">&lt;enumerate object at 0x1057f4120&gt;</span><br></pre></td></tr></table></figure>

<p>&#x5728;&#x4E0A;&#x9762;&#x8FD9;&#x4E2A;&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#x4E2D;&#xFF0C;&#x6B63;&#x5982;&#x4F60;&#x6240;&#x89C1;&#xFF0C;&#x6211;&#x4F7F;&#x7528;&#x4E86;&#x548C;&#x524D;&#x9762;&#x4E00;&#x6837;&#x7684;&#x793A;&#x4F8B;&#x4EE3;&#x7801;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x8C03;&#x7528;<code>enumerate()</code>&#x51FD;&#x6570;&#x5E76;&#x4E0D;&#x4F1A;&#x7ACB;&#x5373;&#x8FD4;&#x56DE;&#x5FAA;&#x73AF;&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x800C;&#x53EA;&#x662F;&#x5728;&#x63A7;&#x5236;&#x53F0;&#x4E2D;&#x8FD4;&#x56DE;&#x4E86;&#x4E00;&#x4E2A;<code>enumerate</code>&#x5BF9;&#x8C61;&#x3002;</p>
<p>&#x6B63;&#x5982;&#x4F60;&#x6240;&#x770B;&#x5230;&#x7684;&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x201C;&#x679A;&#x4E3E;&#x5BF9;&#x8C61;&#x201D;&#x3002;&#x5B83;&#x7684;&#x786E;&#x662F;&#x4E00;&#x4E2A;&#x8FED;&#x4EE3;&#x5668;&#x3002;&#x5C31;&#x50CF;&#x6211;&#x8BF4;&#x7684;&#xFF0C;&#x5B83;&#x4F1A;&#x5728;&#x5FAA;&#x73AF;&#x8BF7;&#x6C42;&#x65F6;&#x61D2;&#x52A0;&#x8F7D;&#x5730;&#x8F93;&#x51FA;&#x6BCF;&#x4E2A;&#x5143;&#x7D20;&#x3002;</p>
<p>&#x4E3A;&#x4E86;&#x9A8C;&#x8BC1;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x53D6;&#x51FA;&#x90A3;&#x4E9B;&#x201C;&#x61D2;&#x52A0;&#x8F7D;&#x201D;&#x7684;&#x5143;&#x7D20;&#xFF0C;&#x6211;&#x8BA1;&#x5212;&#x5728;&#x8FD9;&#x4E2A;&#x8FED;&#x4EE3;&#x5668;&#x4E0A;&#x8C03;&#x7528;Python&#x7684;&#x5185;&#x7F6E;&#x51FD;&#x6570;<code>list()</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&gt;&gt;&gt; list(enumerate(names))</span><br><span class="line">[(0, &apos;Bob&apos;), (1, &apos;Alice&apos;), (2, &apos;Guido&apos;)]</span><br></pre></td></tr></table></figure>

<p>&#x5BF9;&#x4E8E;&#x8F93;&#x5165;<code>list()</code>&#x4E2D;&#x7684;&#x6BCF;&#x4E2A;<code>enumerate()</code>&#x8FED;&#x4EE3;&#x5668;&#x5143;&#x7D20;&#xFF0C;&#x8FED;&#x4EE3;&#x5668;&#x4F1A;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x5F62;&#x5F0F;&#x4E3A;<code>&#xFF08;index&#xFF0C;element&#xFF09;</code>&#x7684;&#x5143;&#x7EC4;&#x4F5C;&#x4E3A;list&#x7684;&#x5143;&#x7D20;&#x3002;&#x5728;&#x5178;&#x578B;&#x7684;for-in&#x5FAA;&#x73AF;&#x4E2D;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x5229;&#x7528;Python&#x7684;<a href="/external_links/377a362b0ecef3a320e17c91e369f036.html" target="blank" rel="noopener">&#x6570;&#x636E;&#x7ED3;&#x6784;&#x89E3;&#x5305;</a>&#x529F;&#x80FD;&#x6765;&#x5145;&#x5206;&#x5229;&#x7528;&#x8FD9;&#x4E00;&#x70B9;&#x7279;&#x6027;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;for index, element in enumerate(iterable):</span><br><span class="line">    # ...</span><br></pre></td></tr></table></figure>

<h2 id="&#x603B;&#x7ED3;&#xFF1A;Python&#x4E2D;&#x7684;enumerate&#x51FD;&#x6570;-&#x5173;&#x952E;&#x70B9;"><a href="#&#x603B;&#x7ED3;&#xFF1A;Python&#x4E2D;&#x7684;enumerate&#x51FD;&#x6570;-&#x5173;&#x952E;&#x70B9;" class="headerlink" title="&#x603B;&#x7ED3;&#xFF1A;Python&#x4E2D;&#x7684;enumerate&#x51FD;&#x6570; - &#x5173;&#x952E;&#x70B9;"></a>&#x603B;&#x7ED3;&#xFF1A;Python&#x4E2D;&#x7684;enumerate&#x51FD;&#x6570; - &#x5173;&#x952E;&#x70B9;</h2><ul>
<li><code>enumerate</code>&#x662F;Python&#x7684;&#x4E00;&#x4E2A;&#x5185;&#x7F6E;&#x51FD;&#x6570;&#x3002;&#x4F60;&#x5E94;&#x8BE5;&#x5145;&#x5206;&#x5229;&#x7528;&#x5B83;&#x901A;&#x8FC7;&#x5FAA;&#x73AF;&#x8FED;&#x4EE3;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;&#x7D22;&#x5F15;&#x53D8;&#x91CF;&#x3002;</li>
<li>&#x7D22;&#x5F15;&#x503C;&#x9ED8;&#x8BA4;&#x4ECE;0&#x5F00;&#x59CB;&#xFF0C;&#x4F46;&#x4E5F;&#x53EF;&#x4EE5;&#x5C06;&#x5176;&#x8BBE;&#x7F6E;&#x4E3A;&#x4EFB;&#x4F55;&#x6574;&#x6570;&#x3002;</li>
<li><code>enumerate</code>&#x51FD;&#x6570;&#x662F;&#x4ECE;2.3&#x7248;&#x672C;&#x5F00;&#x59CB;&#x88AB;&#x6DFB;&#x52A0;&#x5230;Python&#x4E2D;&#x7684;&#xFF0C;&#x8BE6;&#x60C5;&#x89C1;<a href="/external_links/bb43dd193534215b8acb6a135261289b.html" target="blank" rel="noopener">PEP279</a>&#x3002;</li>
<li>Python&#x7684;<code>enumerate</code>&#x51FD;&#x6570;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x4F60;&#x7F16;&#x5199;&#x51FA;&#x66F4;&#x52A0;Pythonic&#x548C;&#x5730;&#x9053;&#x7684;&#x5FAA;&#x73AF;&#x7ED3;&#x6784;&#xFF0C;&#x907F;&#x514D;&#x4F7F;&#x7528;&#x7B28;&#x91CD;&#x4E14;&#x5BB9;&#x6613;&#x51FA;&#x9519;&#x7684;&#x624B;&#x52A8;&#x751F;&#x6210;&#x7D22;&#x5F15;&#x3002;</li>
<li>&#x4E3A;&#x4E86;&#x5145;&#x5206;&#x5229;&#x7528;<code>enumerate</code>&#x7684;&#x7279;&#x6027;&#xFF0C;&#x4E00;&#x5B9A;&#x8981;&#x7814;&#x7A76;Python&#x7684;&#x8FED;&#x4EE3;&#x5668;&#x548C;<a href="/external_links/377a362b0ecef3a320e17c91e369f036.html" target="blank" rel="noopener">&#x6570;&#x636E;&#x7ED3;&#x6784;&#x89E3;&#x5305;</a>&#x529F;&#x80FD;&#x3002;</li>
</ul>
<blockquote>
<p>&#x8BD1;&#x8005;&#x535A;&#x5BA2;&#xFF1A;<a href="/external_links/e4b5d1d86c886349cd6f165457f185a1.html" target="blank" rel="noopener">vimiix.com</a></p>
</blockquote>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/0f473a06fdca7ab833695bfd920dc3bf.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903528025047054.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903528025047054.html" itemprop="url">游戏开发—协议设计 一、知识图谱  二、协议三个层次 二、安</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-14T10:16:05+08:00">
                2017-12-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>&#x672C;&#x7BC7;&#x662F;&#x6E38;&#x620F;&#x5F00;&#x53D1;&#x7CFB;&#x5217;&#x7B2C;&#x4E00;&#x7BC7;&#xFF0C;&#x5982;&#x82E5;&#x4F60;&#x6709;&#x5174;&#x8DA3;&#xFF0C;&#x8BF7;&#x6301;&#x7EED;&#x5173;&#x6CE8;&#xFF0C;&#x540E;&#x671F;&#x4F1A;&#x6301;&#x7EED;&#x66F4;&#x65B0;&#x3002;&#x5176;&#x4ED6;&#x6587;&#x7AE0;&#x5217;&#x8868;&#x5982;&#x4E0B;:</p>
<p><a href="/external_links/4c83c651d9ff83477a3110ec6f5d9365.html" target="blank" rel="noopener">&#x6E38;&#x620F;&#x5F00;&#x53D1;&#x2014;&#x534F;&#x8BAE;&#x8BBE;&#x8BA1;</a></p>
<p><a href="/external_links/35b7d8721568da2c89187918387b5ae9.html" target="blank" rel="noopener">&#x6E38;&#x620F;&#x5F00;&#x53D1;&#x2014;&#x534F;&#x8BAE;-protobuf</a></p>
<p><a href="/external_links/64078be88bd4493aa139a9e7124af361.html" target="blank" rel="noopener">&#x6E38;&#x620F;&#x5F00;&#x53D1;-&#x534F;&#x8BAE;-protobuf&#x539F;&#x7406;&#x8BE6;&#x89E3;</a></p>
</blockquote>
<p>&#x901A;&#x4FD7;&#x5730;&#x8BF4;&#xFF0C;&#x534F;&#x8BAE;&#x5C31;&#x662F;&#x901A;&#x4FE1;&#x53CC;&#x65B9;&#x80FD;&#x591F;&#x7406;&#x89E3;&#x7684;&#x4E00;&#x79CD;&#x6570;&#x636E;&#x683C;&#x5F0F;&#x3002;&#x7EF4;&#x57FA;&#x767E;&#x79D1;&#x8FD9;&#x4E48;&#x5B9A;&#x4E49;&#x7F51;&#x7EDC;&#x534F;&#x8BAE;&#xFF1A;</p>
<blockquote>
<p>&#x7F51;&#x7EDC;&#x534F;&#x8BAE;&#x4E3A;&#x8BA1;&#x7B97;&#x673A;&#x7F51;&#x7EDC;&#x4E2D;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x4EA4;&#x6362;&#x800C;&#x5EFA;&#x7ACB;&#x7684;&#x89C4;&#x5219;&#x3001;&#x6807;&#x51C6;&#x6216;&#x7EA6;&#x5B9A;&#x7684;&#x96C6;&#x5408;&#x3002;</p>
</blockquote>
<p>&#x534F;&#x8BAE;&#x8BBE;&#x8BA1;&#x5305;&#x542B;&#x4E09;&#x8981;&#x7D20;&#xFF1A;</p>
<blockquote>
<p>&#x8BED;&#x6CD5;&#xFF1A;&#x8BED;&#x6CD5;&#x662F;&#x7528;&#x6237;&#x6570;&#x636E;&#x4E0E;&#x63A7;&#x5236;&#x4FE1;&#x606F;&#x7684;&#x7ED3;&#x6784;&#x4E0E;&#x683C;&#x5F0F;&#xFF0C;&#x4EE5;&#x53CA;&#x6570;&#x636E;&#x51FA;&#x73B0;&#x7684;&#x987A;&#x5E8F;&#x3002;</p>
<p>&#x8BED;&#x4E49;&#xFF1A;&#x89E3;&#x91CA;&#x63A7;&#x5236;&#x4FE1;&#x606F;&#x6BCF;&#x4E2A;&#x90E8;&#x5206;&#x7684;&#x610F;&#x4E49;&#x3002;&#x5B83;&#x89C4;&#x5B9A;&#x4E86;&#x9700;&#x8981;&#x53D1;&#x51FA;&#x4F55;&#x79CD;&#x63A7;&#x5236;&#x4FE1;&#x606F;&#xFF0C;&#x4EE5;&#x53CA;&#x5B8C;&#x6210;&#x7684;&#x52A8;&#x4F5C;&#x4E0E;&#x505A;&#x51FA;&#x4EC0;&#x4E48;&#x6837;&#x7684;&#x54CD;&#x5E94;&#x3002;</p>
<p>&#x65F6;&#x5E8F;&#xFF1A;&#x65F6;&#x5E8F;&#x662F;&#x5BF9;&#x4E8B;&#x4EF6;&#x53D1;&#x751F;&#x987A;&#x5E8F;&#x7684;&#x8BE6;&#x7EC6;&#x8BF4;&#x660E;</p>
</blockquote>
<p>&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x8BED;&#x4E49;&#x8868;&#x793A;&#x8981;&#x505A;&#x4EC0;&#x4E48;&#xFF0C;&#x8BED;&#x6CD5;&#x8868;&#x793A;&#x8981;&#x600E;&#x4E48;&#x505A;&#xFF0C;&#x65F6;&#x5E8F;&#x8868;&#x793A;&#x505A;&#x7684;&#x987A;&#x5E8F;&#x3002;&#x6211;&#x4EEC;&#x8981;&#x57FA;&#x4E8E;&#x6B64;&#x6765;&#x8BBE;&#x8BA1;&#x6211;&#x7684;&#x534F;&#x8BAE;&#x3002;</p>
<p><strong>&#x901A;&#x5E38;&#x6E38;&#x620F;&#x6709;&#x4E00;&#x4E9B;&#x7279;&#x6B8A;&#x6027;&#xFF0C;&#x6BD4;&#x5982;&#x6D41;&#x91CF;&#x8981;&#x5C3D;&#x91CF;&#x7684;&#x5C11;&#xFF0C;&#x5B89;&#x5168;&#x6027;&#x8981;&#x6C42;&#x66F4;&#x9AD8;&#xFF0C;&#x4EE5;&#x53CA;&#x5BF9;&#x5E73;&#x53F0;&#x652F;&#x6301;&#x8DB3;&#x591F;&#x591A;&#x7B49;&#x7B49;&#x3002;&#x8FD9;&#x4E00;&#x5207;&#x7684;&#x9700;&#x6C42;&#x5C31;&#x8981;&#x6C42;&#x6E38;&#x620F;&#x534F;&#x8BAE;&#x8BBE;&#x8BA1;&#xFF0C;&#x5C3D;&#x91CF;&#x7B80;&#x5355;&#x3001;&#x901A;&#x7528;&#xFF0C;&#x4EE5;&#x53CA;&#x4EE3;&#x7801;&#x5C42;&#x4E0A;&#x6613;&#x6269;&#x5C55;&#x3001;&#x89E3;&#x6790;&#x6548;&#x7387;&#x8DB3;&#x591F;&#x9AD8;&#x7B49;&#x7279;&#x70B9;&#x3002;</strong></p>
<p>&#x57FA;&#x4E8E;&#x6B64;&#xFF0C;&#x6211;&#x9700;&#x8981;&#x4ECE;&#x4EE5;&#x4E0B;&#x51E0;&#x4E2A;&#x5C42;&#x6B21;&#x6765;&#x8003;&#x8651;&#x6E38;&#x620F;&#x534F;&#x8BAE;&#x7684;&#x8BBE;&#x8BA1;&#x65B9;&#x6848;&#x3002;</p>
<h1 id="&#x4E00;&#x3001;&#x77E5;&#x8BC6;&#x56FE;&#x8C31;"><a href="#&#x4E00;&#x3001;&#x77E5;&#x8BC6;&#x56FE;&#x8C31;" class="headerlink" title="&#x4E00;&#x3001;&#x77E5;&#x8BC6;&#x56FE;&#x8C31;"></a>&#x4E00;&#x3001;&#x77E5;&#x8BC6;&#x56FE;&#x8C31;</h1><blockquote>
<p>&#x56E0;&#x4E3A;&#x77E5;&#x8BC6;&#x70B9;&#x6BD4;&#x8F83;&#x591A;&#xFF0C;&#x5EFA;&#x8BAE;&#x5148;&#x8BFB;&#x77E5;&#x8BC6;&#x56FE;&#x8C31;&#xFF0C;&#x5BF9;&#x6574;&#x4F53;&#x7ED3;&#x6784;&#x6709;&#x4E00;&#x4E2A;&#x6E05;&#x6670;&#x7684;&#x7EFC;&#x62EC;&#x3002;</p>
</blockquote>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/1a5ba0661d044244f8ef5027481930314e79ea9609327aa4f71d8ca178490beb" alt></p>
<h1 id="&#x4E8C;&#x3001;&#x534F;&#x8BAE;&#x4E09;&#x4E2A;&#x5C42;&#x6B21;"><a href="#&#x4E8C;&#x3001;&#x534F;&#x8BAE;&#x4E09;&#x4E2A;&#x5C42;&#x6B21;" class="headerlink" title="&#x4E8C;&#x3001;&#x534F;&#x8BAE;&#x4E09;&#x4E2A;&#x5C42;&#x6B21;"></a>&#x4E8C;&#x3001;&#x534F;&#x8BAE;&#x4E09;&#x4E2A;&#x5C42;&#x6B21;</h1><h2 id="&#x5E94;&#x7528;&#x5C42;"><a href="#&#x5E94;&#x7528;&#x5C42;" class="headerlink" title="&#x5E94;&#x7528;&#x5C42;"></a>&#x5E94;&#x7528;&#x5C42;</h2><p>&#x5E94;&#x7528;&#x5C42;&#x4E3B;&#x8981;&#x662F;&#x5E38;&#x7528;&#x662F;&#x89E3;&#x6790;&#x65B9;&#x5F0F;&#x5B9A;&#x4E49;&#x548C;&#x89E3;&#x6790;&#xFF0C;&#x4E3B;&#x8981;&#x7684;&#x9009;&#x578B;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x770B;&#x4F60;&#x57FA;&#x4E8E;&#x4EC0;&#x4E48;&#x9700;&#x6C42;&#x4E86;&#xFF0C;&#x9002;&#x7528;&#x4E8E;&#x5B9E;&#x9645;&#x9700;&#x6C42;&#x5C31;&#x597D;&#x3002;&#x6211;&#x4EEC;&#x5E38;&#x7528;&#x7684;&#x534F;&#x8BAE;&#x7C7B;&#x578B;&#xFF0C;&#x4E3B;&#x8981;&#x6709;&#x8FD9;&#x4E24;&#x79CD;&#xFF1A;&#x6587;&#x672C;&#x534F;&#x8BAE;&#x3001;&#x4E8C;&#x8FDB;&#x5236;&#x534F;&#x8BAE;</p>
<h3 id="1&#x3001;&#x6587;&#x672C;&#x534F;&#x8BAE;&#xFF1A;"><a href="#1&#x3001;&#x6587;&#x672C;&#x534F;&#x8BAE;&#xFF1A;" class="headerlink" title="1&#x3001;&#x6587;&#x672C;&#x534F;&#x8BAE;&#xFF1A;"></a>1&#x3001;&#x6587;&#x672C;&#x534F;&#x8BAE;&#xFF1A;</h3><p>&#x6587;&#x672C;&#x534F;&#x8BAE;&#x8BBE;&#x8BA1;&#x7684;&#x76EE;&#x7684;&#x5C31;&#x662F;&#x65B9;&#x4FBF;&#x4EBA;&#x4EEC;&#x7406;&#x89E3;&#xFF0C;&#x8BFB;&#x61C2;&#x3002;&#x5982;&#x5E38;&#x89C1;&#x7684;http&#x534F;&#x8BAE;&#xFF0C;&#x4E00;&#x822C;&#x7684;&#x5E38;&#x89C1;http&#x534F;&#x8BAE;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;GET/sample.Jsp HTTP/1.1</span><br><span class="line">Accept:image/gif.image/jpeg,*/*</span><br><span class="line">Accept-Language:zh-cn</span><br><span class="line">Connection:Keep-Alive</span><br><span class="line">Host:localhost</span><br><span class="line">User-Agent:Mozila/4.0(compatible;MSIE5.01;Window NT5.0)</span><br><span class="line">Accept-Encoding:gzip,deflate</span><br><span class="line">username=test&amp;password=1234</span><br></pre></td></tr></table></figure>




<p>&#x8FD9;&#x79CD;&#x683C;&#x5F0F;&#x975E;&#x5E38;&#x8D34;&#x8FD1;&#x6211;&#x4EEC;&#x7684;&#x6587;&#x5B57;&#x63CF;&#x8FF0;&#xFF0C;&#x65B9;&#x4FBF;&#x9605;&#x8BFB;&#xFF0C;&#x800C;&#x4E14;&#x76EE;&#x524D;HTTP&#x4E5F;&#x662F;&#x5BA2;&#x6237;&#x7AEF;&#x6D4F;&#x89C8;&#x5668;&#x6216;&#x5176;&#x4ED6;&#x7A0B;&#x5E8F;&#x4E0E;<a href="/external_links/7bfb0eb17067a9aee3a581faad1f6f7f.html" target="blank" rel="noopener">Web&#x670D;&#x52A1;</a>&#x5668;&#x4E4B;&#x95F4;&#x7684;&#x5E94;&#x7528;&#x5C42;&#x901A;&#x4FE1;&#x534F;&#x8BAE;&#xFF0C;&#x9002;&#x7528;&#x975E;&#x5E38;&#x5E7F;&#x6CDB;&#x3002;&#x4F46;&#x4F60;&#x4E5F;&#x770B;&#x5230;&#xFF0C;&#x6709;&#x65F6;&#x5019;&#x57FA;&#x4E8E;&#x4E00;&#x4E2A;&#x5F88;&#x7B80;&#x5355;&#x5E94;&#x7B54;&#xFF0C;&#x5C31;&#x8981;&#x5E26;&#x4E0A;&#x5F88;&#x591A;&#x5176;&#x4ED6;&#x7684;&#x5934;&#x4FE1;&#x606F;&#xFF0C;&#x8FD9;&#x5BF9;&#x4E8E;&#x5BF9;&#x6D41;&#x91CF;&#x6709;&#x8981;&#x6C42;&#x7684;&#x6E38;&#x620F;&#x5E94;&#x7528;&#x6765;&#x8BF4;&#xFF0C;&#x8FD8;&#x662F;&#x5F88;&#x6D6A;&#x8D39;&#x7684;&#x3002;</p>
<p><strong>&#x4F18;&#x70B9;</strong>&#xFF1A;</p>
<blockquote>
<p>1&#x3001;&#x901A;&#x7528;&#xFF0C;&#x9002;&#x7528;&#x5E7F;&#x6CDB;</p>
<p>2&#x3001;&#x65B9;&#x4FBF;&#x7406;&#x89E3;&#xFF0C;&#x53EF;&#x8BFB;&#x6027;&#x597D;</p>
</blockquote>
<p><strong>&#x7F3A;&#x70B9;</strong>:</p>
<blockquote>
<p>1&#x3001;&#x57FA;&#x4E8E;&#x884C;&#x8BFB;&#xFF0C;&#x89E3;&#x6790;&#x6548;&#x7387;&#x4E00;&#x822C;</p>
<p>2&#x3001;&#x643A;&#x5E26;&#x9644;&#x5E26;&#x4FE1;&#x606F;&#x8FC7;&#x591A;&#xFF0C;&#x4F20;&#x8F93;&#x7684;&#x6548;&#x7387;&#x4F4E;&#x4E0B;</p>
<p>3&#x3001;&#x65E0;&#x72B6;&#x6001;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x4E0D;&#x77E5;&#x9053;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x5FC5;&#x987B;&#x57FA;&#x4E8E;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x8BF7;&#x6C42;&#x6765;&#x56DE;&#x5E94;&#xFF0C;&#x5B9E;&#x65F6;&#x6027;&#x4F4E;</p>
<p>4&#x3001;&#x5F88;&#x96BE;&#x5D4C;&#x5165;&#x5176;&#x4ED6;&#x6570;&#x636E;&#xFF0C;&#x5BF9;&#x4E8C;&#x8FDB;&#x5236;&#x652F;&#x6301;&#x5DEE;</p>
</blockquote>
<p>&#x5982;&#x679C;&#x4F60;&#x7684;&#x6E38;&#x620F;&#x5BF9;&#x5B9E;&#x65F6;&#x6027;&#x8981;&#x6C42;&#x4E0D;&#x9AD8;&#xFF0C;&#x800C;&#x4E14;&#x5BF9;&#x6D41;&#x91CF;&#x8981;&#x6C42;&#x4E0D;&#x4E5F;&#x662F;&#x592A;&#x9AD8;&#xFF0C;&#x6587;&#x672C;&#x534F;&#x8BAE;&#x4E5F;&#x662F;&#x4E2A;&#x4E0D;&#x9519;&#x7684;&#x65B9;&#x5F0F;&#x3002;&#x4E00;&#x822C;&#x77ED;&#x8FDE;&#x63A5;&#x6E38;&#x620F;&#x591A;&#x9002;&#x7528;&#x8FD9;&#x4E2A;&#x3002;</p>
<h3 id="2&#x3001;&#x4E8C;&#x8FDB;&#x5236;&#x534F;&#x8BAE;"><a href="#2&#x3001;&#x4E8C;&#x8FDB;&#x5236;&#x534F;&#x8BAE;" class="headerlink" title="2&#x3001;&#x4E8C;&#x8FDB;&#x5236;&#x534F;&#x8BAE;"></a>2&#x3001;&#x4E8C;&#x8FDB;&#x5236;&#x534F;&#x8BAE;</h3><p>&#x4E8C;&#x8FDB;&#x5236;&#x534F;&#x8BAE;&#x5C31;&#x662F;&#x4E00;&#x4E32;&#x5B57;&#x8282;&#x6D41;&#xFF0C;&#x662F;&#x4E00;&#x4E2A;&#x5178;&#x578B;&#x7684;Ip&#x534F;&#x8BAE;&#xFF0C;&#x4E00;&#x822C;&#x901A;&#x5E38;&#x5305;&#x62EC;&#x6D88;&#x606F;&#x5934;(header)&#x548C;&#x53D8;&#x957F;&#x7684;&#x6D88;&#x606F;&#x4F53;(body)&#xFF0C;&#x6D88;&#x606F;&#x5934;&#x7684;&#x957F;&#x5EA6;&#x56FA;&#x5B9A;&#xFF0C;&#x6D88;&#x606F;&#x4F53;&#x957F;&#x5EA6;&#x4E0D;&#x56FA;&#x5B9A;&#xFF0C;&#x5305;&#x542B;&#x4E3B;&#x8981;&#x7684;&#x5185;&#x5BB9;&#x4E3B;&#x4F53;&#x3002;&#x4E00;&#x822C;&#x6D88;&#x606F;&#x5934;&#x4F1A;&#x5305;&#x542B;&#x6D88;&#x606F;&#x4F53;&#x7684;&#x957F;&#x5EA6;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x80FD;&#x57FA;&#x4E8E;&#x5934;&#x4FE1;&#x606F;&#x4ECE;&#x6570;&#x636E;&#x6D41;&#x4E2D;&#x89E3;&#x6790;&#x51FA;&#x4E00;&#x4E2A;&#x5B8C;&#x6574;&#x7684;&#x4E8C;&#x673A;&#x5236;&#x6D88;&#x606F;&#x4E86;&#x3002;</p>
<p>&#x4E00;&#x822C;&#x7684;&#x683C;&#x5F0F;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/a01d5828e02c9f3a3f37d60998b4a6077d63f0ec0e266a4e36592c26d402afcf" alt></p>
<p>&#x6211;&#x4EEC;&#x770B;&#x5230;head&#x90E8;&#x5206;&#x5B9A;&#x4E49;&#x5305;&#x542B;:</p>
<blockquote>
<p>cmd:&#x547D;&#x4EE4;&#x5B57;</p>
<p>sign&#xFF1A;&#x9A8C;&#x8BC1;&#x4E32;</p>
<p>content-leg:&#x6D88;&#x606F;&#x4F53;&#x957F;&#x5EA6;</p>
<p>HeaderCRC&#xFF1A;&#x5934;&#x9A8C;&#x8BC1;&#xFF08;&#x4E0D;&#x662F;&#x5FC5;&#x987B;&#xFF09;</p>
</blockquote>
<p>&#x5176;&#x4E2D;&#x547D;&#x4EE4;&#x5B57;&#x662F;&#x53CC;&#x65B9;&#x534F;&#x8BAE;&#x6587;&#x6863;&#x4E2D;&#x89C4;&#x5B9A;&#x597D;&#x7684;&#xFF0C;&#x6BD4;&#x5982;0x01&#x8868;&#x793A;&#x767B;&#x9646;&#xFF0C;0x02&#x8868;&#x793A;&#x6CE8;&#x518C;&#x7B49;&#x7B49;&#xFF0C;&#x8FD9;&#x4E9B;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x547D;&#x4EE4;&#x53F7;&#x3002;</p>
<p>sign&#x662F;&#x4E00;&#x4E2A;&#x9A8C;&#x8BC1;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x5BF9;&#x6D88;&#x606F;&#x4F53;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x4E00;&#x5B9A;&#x52A0;&#x5BC6;&#x9A8C;&#x8BC1;&#xFF0C;&#x4FDD;&#x8BC1;&#x6570;&#x636E;&#x5B89;&#x5168;&#x3002;</p>
<p>content-leg&#x662F;&#x672C;&#x6B21;&#x6D88;&#x606F;&#x4F53;&#x7684;&#x957F;&#x5EA6;&#x3002;</p>
<p>body&#x90E8;&#x5206;&#xFF0C;&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x5982;&#x4E0B;&#x5B9A;&#x4E49;:</p>
<blockquote>
<p>message:login{</p>
<p>string username;</p>
<p>int64 passwoard;</p>
<p>}</p>
</blockquote>
<p>&#x6211;&#x4EEC;&#x770B;&#x5230;&#xFF0C;&#x56E0;&#x4E3A;&#x5B57;&#x6BB5;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x6709;&#x5B9A;&#x4E49;&#xFF0C;&#x987A;&#x5E8F;&#x4E5F;&#x6709;&#x5B9A;&#x4E49;&#xFF08;&#x7B2C;&#x4E00;&#x4E2A;&#x662F;string,&#x7B2C;&#x4E8C;&#x4E2A;&#x662F;int64&#xFF09;&#xFF0C;&#x6574;&#x4E2A;&#x4E8C;&#x8FDB;&#x5236;&#x6D41;&#x8BFB;&#x53D6;&#x7684;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x57FA;&#x4E8E;&#x987A;&#x5E8F;&#x8BFB;&#x53D6;&#x5C31;&#x53EF;&#x4EE5;&#x5F88;&#x5FEB;&#x7684;&#x53D6;&#x51FA;&#x4E86;&#x3002;</p>
<p><strong>&#x4F18;&#x70B9;</strong>&#xFF1A;</p>
<blockquote>
<p>1&#x3001;&#x6CA1;&#x6709;&#x5197;&#x4F59;&#x5B57;&#x6BB5;&#xFF0C;&#x4F20;&#x8F93;&#x9AD8;&#x6548;&#xFF0C;&#x8017;&#x8D39;&#x6D41;&#x91CF;&#x5C0F;</p>
<p>2&#x3001;&#x89E3;&#x6790;&#x901F;&#x5EA6;&#x5FEB;&#xFF0C;&#x57FA;&#x4E8E;&#x57FA;&#x7840;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x64CD;&#x4F5C;</p>
</blockquote>
<p><strong>&#x7F3A;&#x70B9;</strong>:</p>
<blockquote>
<p>1&#x3001;&#x53EF;&#x8BFB;&#x6027;&#x5DEE;&#xFF0C;&#x4E0D;&#x5229;&#x4E8E;&#x8C03;&#x8BD5;</p>
<p>2&#x3001;&#x6269;&#x5C55;&#x6027;&#x5DEE;&#xFF0C;&#x5BF9;&#x590D;&#x6742;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x652F;&#x6301;&#x4E0D;&#x591F;</p>
</blockquote>
<p>&#x5982;&#x679C;&#x4F60;&#x7684;&#x6E38;&#x620F;&#xFF0C;&#x5BF9;&#x5B9E;&#x65F6;&#x6027;&#x8981;&#x6C42;&#x6BD4;&#x8F83;&#x9AD8;&#xFF0C;&#x6D41;&#x91CF;&#x6709;&#x8981;&#x6C42;&#xFF0C;&#x7528;&#x4E8C;&#x8FDB;&#x5236;&#x6BD4;&#x8F83;&#x597D;&#xFF0C;&#x4E00;&#x822C;&#x5927;&#x578B;&#x591A;&#x4EBA;&#x7F51;&#x6E38;&#xFF0C;&#x4F7F;&#x7528;&#x4E8C;&#x8FDB;&#x5236;&#x534F;&#x8BAE;&#x6765;&#x8BBE;&#x8BA1;&#x3002;</p>
<h3 id="3&#x3001;&#x6570;&#x636E;&#x683C;&#x5F0F;"><a href="#3&#x3001;&#x6570;&#x636E;&#x683C;&#x5F0F;" class="headerlink" title="3&#x3001;&#x6570;&#x636E;&#x683C;&#x5F0F;"></a>3&#x3001;&#x6570;&#x636E;&#x683C;&#x5F0F;</h3><p>&#x4EE5;&#x4E0A;&#x6211;&#x4EEC;&#x770B;&#x5230;&#x4E86;&#x4E24;&#x79CD;&#x534F;&#x8BAE;&#x7C7B;&#x578B;&#xFF0C;&#x4F46;&#x5BF9;&#x4E8E;&#x6D88;&#x606F;&#x4F53;&#x7684;&#x89E3;&#x6790;&#x4ECB;&#x7ECD;&#x5F88;&#x5C11;&#xFF0C;&#x6D88;&#x606F;&#x4F53;&#x7684;&#x683C;&#x5F0F;&#x51B3;&#x5B9A;&#x4E86;&#x7684;&#x4ED6;&#x7684;&#x8BED;&#x4E49;&#x548C;&#x65F6;&#x5E8F;&#xFF0C;&#x683C;&#x5F0F;&#x4E0D;&#x540C;&#x6570;&#x636E;&#x7684;&#x5E8F;&#x5217;&#x5316;&#x548C;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x4E5F;&#x662F;&#x4E0D;&#x540C;&#x3002;&#x6BD4;&#x5982;message:login&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x57FA;&#x4E8E;json&#x6765;&#x5B9A;&#x4E49;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x57FA;&#x4E8E;xml&#x6765;&#x5B9A;&#x4E49;&#xFF0C;&#x5B9A;&#x4E49;&#x4E0D;&#x540C;&#x89E3;&#x6790;&#x65B9;&#x5F0F;&#x4E5F;&#x5404;&#x4E0D;&#x76F8;&#x540C;&#x3002;</p>
<p>&#x4E00;&#x822C;&#x7684;&#x6D88;&#x606F;&#x4F53;&#x683C;&#x5F0F;&#x4E3B;&#x8981;&#x6709;&#x4EE5;&#x4E0B;&#x51E0;&#x79CD;:json&#x3001;protocolBuff&#x3001;xml&#x3001;&#x81EA;&#x5B9A;&#x4E49;</p>
<p><strong>json</strong></p>
<blockquote>
<p><strong>json</strong> &#x662F;&#x4E00;&#x79CD;&#x8F7B;&#x91CF;&#x7EA7;&#x7684;&#x6570;&#x636E;&#x4EA4;&#x6362;&#x683C;&#x5F0F;,&#x4E92;&#x8054;&#x7F51;&#x5E94;&#x7528;&#x7684;&#x5F88;&#x5E7F;&#x6CDB;&#x4E86;&#x3002;&#x5E38;&#x7528;&#x7684;&#x6846;&#x67B6;&#x4E5F;&#x5F88;&#x591A;&#xFF0C;&#x63A8;&#x8350;fastJson,&#x89E3;&#x6790;&#x901F;&#x5EA6;&#x8FD8;&#x662F;&#x4E0D;&#x9519;&#x7684;&#x3002;json&#x7684;&#x597D;&#x5904;&#x662F;&#xFF0C;&#x5F00;&#x6E90;&#xFF0C;&#x683C;&#x5F0F;&#x7EDF;&#x4E00;&#xFF0C;&#x89E3;&#x6790;&#x901F;&#x5EA6;&#x4E5F;&#x8FD8;&#x53EF;&#x4EE5;&#x3002;&#x7F3A;&#x70B9;&#x5C31;&#x662F;&#x4F1A;&#x6709;&#x4E00;&#x4E9B;&#x5197;&#x4F59;&#x5B57;&#x7B26;&#xFF0C;&#x4E0D;&#x591F;&#x7B80;&#x6D01;&#x3002;</p>
</blockquote>
<p><strong>protocolBuff</strong></p>
<blockquote>
<p>protocolBuff&#x662F;&#x662F;google&#x63D0;&#x4F9B;&#x7684;&#x4E00;&#x4E2A;&#x5F00;&#x6E90;&#x5E8F;&#x5217;&#x5316;&#x6846;&#x67B6;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E8E;XML&#xFF0C;JSON&#x8FD9;&#x6837;&#x7684;&#x6570;&#x636E;&#x8868;&#x793A;&#x8BED;&#x8A00;&#x3002;&#x4F46;&#x662F;&#x6BD4;&#x8FD9;&#x4E9B;&#x5360;&#x7528;&#x7A7A;&#x95F4;&#x90FD;&#x5C0F;&#xFF0C;&#x6CA1;&#x6709;&#x5197;&#x4F59;&#x5B57;&#x6BB5;&#x3002;&#x800C;&#x4E14;&#x597D;&#x5904;&#x662F;&#x7075;&#x6D3B;&#xFF0C;&#x89E3;&#x6790;&#x901F;&#x5EA6;&#x5FEB;&#xFF0C;&#x6613;&#x4E8E;&#x5F00;&#x53D1;&#xFF08;&#x57FA;&#x4E8E;&#x914D;&#x7F6E;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x4EE3;&#x7801;&#xFF09;&#xFF0C;&#x53EF;&#x652F;&#x6301;&#x8BED;&#x8A00;&#x4E5F;&#x6BD4;&#x8F83;&#x591A;&#x3002;&#x4E00;&#x6761;&#x6D88;&#x606F;&#x6570;&#x636E;&#xFF0C;&#x7528;protobuf&#x5E8F;&#x5217;&#x5316;&#x540E;&#x7684;&#x5927;&#x5C0F;&#x662F;json&#x7684;10&#x5206;&#x4E4B;&#x4E00;&#xFF0C;xml&#x683C;&#x5F0F;&#x7684;20&#x5206;&#x4E4B;&#x4E00;&#xFF0C;&#x662F;&#x4E8C;&#x8FDB;&#x5236;&#x5E8F;&#x5217;&#x5316;&#x7684;10&#x5206;&#x4E4B;&#x4E00;</p>
</blockquote>
<p><strong>xml</strong></p>
<blockquote>
<p>&#x4E0D;&#x591A;&#x89E3;&#x91CA;&#x4E86;&#xFF0C;&#x5927;&#x5BB6;&#x90FD;&#x7528;&#x6709;&#x8FC7;&#xFF0C;&#x5F3A;&#x70C8;&#x4E0D;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528;&#x8FD9;&#x79CD;&#xFF0C;&#x9664;&#x4E86;&#x65E0;&#x6548;&#x5B57;&#x7B26;&#x8FC7;&#x591A;&#xFF08;&#x6807;&#x7B7E;&#xFF09;&#xFF0C;&#x800C;&#x4E14;&#x89E3;&#x6790;&#x6548;&#x7387;&#x6BD4;&#x4E0A;&#x9762;&#x4E24;&#x79CD;&#x90FD;&#x662F;&#x5F88;&#x4F4E;&#x7684;&#x3002;</p>
</blockquote>
<p><strong>&#x81EA;&#x5B9A;&#x4E49;</strong></p>
<blockquote>
<p>&#x81EA;&#x5DF1;&#x5B9A;&#x4E49;&#x5C31;&#x662F;&#x81EA;&#x5DF1;&#x5B9A;&#x4E49;&#x89E3;&#x6790;&#x65B9;&#x5F0F;&#xFF0C;&#x6BD4;&#x5982;&#x901A;&#x8FC7;&#x6587;&#x6863;&#x5B9A;&#x4E49;&#x597D;&#x4E00;&#x4E2A;&#x6D88;&#x606F;&#x7684;&#x7ED3;&#x6784;&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;&#x5B57;&#x6BB5;&#x662F;&#x4EC0;&#x4E48;&#x7C7B;&#x578B;&#xFF0C;&#x7B2C;&#x4E8C;&#x4E2A;&#x5B57;&#x6BB5;&#x4EC0;&#x4E48;&#x7C7B;&#x578B;&#x2026;&#x7B49;&#x7B49;&#xFF0C;&#x57FA;&#x4E8E;&#x6B64;&#x81EA;&#x5DF1;&#x5199;&#x5DE5;&#x5177;&#x89E3;&#x6790;&#x3002;&#x597D;&#x5904;&#x662F;&#x5BF9;&#x5916;&#x534F;&#x8BAE;&#x4E0D;&#x900F;&#x660E;&#xFF0C;&#x89E3;&#x6790;&#x6548;&#x7387;&#x548C;&#x4F20;&#x9001;&#x6548;&#x7387;&#x90FD;&#x8FD8;&#x4E0D;&#x9519;&#xFF0C;&#x7F3A;&#x70B9;&#x5C31;&#x662F;&#x5F00;&#x53D1;&#x96BE;&#x5EA6;&#x9AD8;&#xFF0C;&#x4E0D;&#x5BB9;&#x6613;&#x7EF4;&#x62A4;&#x3002;</p>
</blockquote>
<p>&#x5404;&#x79CD;&#x683C;&#x5F0F;&#x4F18;&#x7F3A;&#x70B9;&#x5982;&#x4E0B;:</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/ed65b2f6d70d684f5d6d5765212685a93f1df3937dfd4da0e948f9fa249fc3ac" alt></p>
<h1 id="&#x4E8C;&#x3001;&#x5B89;&#x5168;&#x5C42;"><a href="#&#x4E8C;&#x3001;&#x5B89;&#x5168;&#x5C42;" class="headerlink" title="&#x4E8C;&#x3001;&#x5B89;&#x5168;&#x5C42;"></a>&#x4E8C;&#x3001;&#x5B89;&#x5168;&#x5C42;</h1><p>&#x6E38;&#x620F;&#x901A;&#x4FE1;&#xFF0C;&#x5B89;&#x5168;&#x4E5F;&#x5F88;&#x91CD;&#x8981;&#xFF0C;&#x4E0D;&#x7136;&#x534F;&#x8BAE;&#x88AB;&#x7834;&#x89E3;&#xFF0C;&#x7528;&#x6237;&#x5237;&#x8D44;&#x6E90;&#xFF0C;&#x6574;&#x4E2A;&#x6E38;&#x620F;&#x7684;&#x5E73;&#x8861;&#x6027;&#x5C31;&#x88AB;&#x7834;&#x574F;&#x4E86;&#xFF0C;&#x8F7B;&#x8005;&#x5F71;&#x54CD;&#x5176;&#x4ED6;&#x73A9;&#x5BB6;&#x4F53;&#x9A8C;&#xFF0C;&#x91CD;&#x5219;&#x6E38;&#x620F;&#x76F4;&#x63A5;&#x88AB;&#x5E9F;&#x3002;</p>
<p>&#x4E00;&#x822C;&#x7684;&#x5B89;&#x5168;&#x5904;&#x7406;&#x5C31;&#x662F;&#x5BF9;&#x534F;&#x8BAE;&#x8FDB;&#x884C;&#x52A0;&#x5BC6;&#x3002;&#x4E00;&#x822C;&#x6709;&#x4EE5;&#x4E0B;&#x51E0;&#x79CD;:</p>
<h3 id="1&#x3001;&#x5E38;&#x89C4;&#x52A0;&#x5BC6;"><a href="#1&#x3001;&#x5E38;&#x89C4;&#x52A0;&#x5BC6;" class="headerlink" title="1&#x3001;&#x5E38;&#x89C4;&#x52A0;&#x5BC6;"></a>1&#x3001;&#x5E38;&#x89C4;&#x52A0;&#x5BC6;</h3><p>&#x91C7;&#x7528;&#x5BF9;&#x79F0;&#x52A0;&#x5BC6;&#x6216;&#x8005;hash&#x52A0;&#x5BC6;&#x6765;&#x5BF9;&#x6D88;&#x606F;&#x5185;&#x5BB9;&#x8FDB;&#x884C;&#x52A0;&#x5BC6;&#xFF0C;&#x4E24;&#x7AEF;&#x91C7;&#x7528;&#x540C;&#x4E00;&#x79CD;&#x52A0;&#x5BC6;&#x7B97;&#x6CD5;&#xFF0C;&#x57FA;&#x4E8E;&#x540C;&#x4E00;&#x4E2A;&#x5BC6;&#x94A5;&#x5BF9;&#x6D88;&#x606F;&#x4F53;&#x8FDB;&#x884C;&#x52A0;&#x5BC6;&#x6362;&#x7B97;&#xFF0C;&#x4EE5;&#x6B64;&#x6765;&#x67E5;&#x770B;&#x6570;&#x636E;&#x662F;&#x5426;&#x4E00;&#x81F4;&#x3002;</p>
<p>&#x5BC6;&#x94A5;&#x53EF;&#x4EE5;&#x7528;&#x6237;&#x767B;&#x9646;&#x7684;&#x65F6;&#x5019;&#x83B7;&#x53D6;&#x4E00;&#x6B21;&#x3002;&#x8FD8;&#x6709;&#x4E00;&#x79CD;&#x662F;&#x57FA;&#x4E8E;&#x6BCF;&#x4E2A;&#x7528;&#x6237;&#x5BC6;&#x94A5;&#x4E0D;&#x540C;&#xFF0C;&#x4EE5;&#x6B64;&#x9632;&#x6B62;&#x5BC6;&#x94A5;&#x6CC4;&#x9732;&#x5927;&#x8303;&#x56F4;&#x5F71;&#x54CD;&#x5168;&#x670D;&#x73A9;&#x5BB6;&#x3002;</p>
<h3 id="2&#x3001;&#x52A8;&#x6001;&#x52A0;&#x5BC6;"><a href="#2&#x3001;&#x52A8;&#x6001;&#x52A0;&#x5BC6;" class="headerlink" title="2&#x3001;&#x52A8;&#x6001;&#x52A0;&#x5BC6;"></a>2&#x3001;&#x52A8;&#x6001;&#x52A0;&#x5BC6;</h3><p>&#x52A8;&#x6001;&#x52A0;&#x5BC6;&#xFF0C;&#x53EF;&#x4EE5;&#x63D0;&#x524D;&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;&#x79C1;&#x6709;&#x5BC6;&#x94A5;&#x5E93;&#xFF0C;&#x91CC;&#x9762;&#x5305;&#x542B;&#x4E00;&#x5B9A;&#x6570;&#x91CF;&#x7684;&#x5BC6;&#x94A5;&#xFF0C;&#x6BCF;&#x6B21;&#x5BA2;&#x6237;&#x7AEF;&#x8BF7;&#x6C42;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x57FA;&#x4E8E;&#x534F;&#x8BAE;&#x53F7;&#x6765;&#x8BBE;&#x8BA1;&#x4E00;&#x4E2A;&#x7B97;&#x6CD5;&#x83B7;&#x53D6;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x5BC6;&#x94A5;&#x3002;&#x6BCF;&#x4E2A;&#x534F;&#x8BAE;&#x7684;&#x5BC6;&#x94A5;&#x90FD;&#x662F;&#x5728;&#x534F;&#x8BAE;&#x5230;&#x8FBE;&#x7684;&#x65F6;&#x5019;&#x65F6;&#x65F6;&#x83B7;&#x53D6;&#x7684;&#xFF0C;&#x8FD9;&#x6837;&#x5373;&#x4FBF;&#x67D0;&#x4E00;&#x4E2A;&#x534F;&#x8BAE;&#x7684;&#x5BC6;&#x94A5;&#x88AB;&#x7834;&#x89E3;&#xFF0C;&#x5BF9;&#x5176;&#x4ED6;&#x534F;&#x8BAE;&#x4F9D;&#x7136;&#x65E0;&#x6548;&#x3002;</p>
<h3 id="3&#x3001;&#x5176;&#x4ED6;"><a href="#3&#x3001;&#x5176;&#x4ED6;" class="headerlink" title="3&#x3001;&#x5176;&#x4ED6;"></a>3&#x3001;&#x5176;&#x4ED6;</h3><p>&#x91C7;&#x7528;&#x975E;&#x5BF9;&#x79F0;&#x52A0;&#x5BC6;&#xFF0C;&#x6216;&#x8005;&#x52A0;&#x76D0;&#x5904;&#x7406;&#x3002;&#x975E;&#x5BF9;&#x79F0;&#x52A0;&#x5BC6;&#x901F;&#x5EA6;&#x592A;&#x6162;&#x4E86;&#xFF0C;&#x4E0D;&#x5EFA;&#x8BAE;&#x3002;</p>
<h1 id="&#x4E09;&#x3001;&#x4F20;&#x9001;&#x5C42;"><a href="#&#x4E09;&#x3001;&#x4F20;&#x9001;&#x5C42;" class="headerlink" title="&#x4E09;&#x3001;&#x4F20;&#x9001;&#x5C42;"></a>&#x4E09;&#x3001;&#x4F20;&#x9001;&#x5C42;</h1><p>&#x8003;&#x8651;&#x670D;&#x52A1;&#x7AEF;&#x7684;&#x627F;&#x8F7D;&#x6210;&#x672C;&#xFF0C;&#x4EE5;&#x53CA;&#x624B;&#x673A;&#x6E38;&#x620F;&#x4E0A;&#x7F51;&#x7EDC;&#x73AF;&#x5883;&#x5DEE;&#xFF0C;&#x539F;&#x5219;&#x4E0A;UDP&#x662F;&#x6BD4;TCP&#x66F4;&#x9002;&#x5408;&#x7684;&#x65B9;&#x5F0F;&#x3002;&#x4F46;&#x662F;&#x7531;&#x4E8E;&#x6E38;&#x620F;&#x5BF9;&#x4E8E;&#x6570;&#x636E;&#x5B8C;&#x6574;&#x6027;&#x3001;&#x5B89;&#x5168;&#x6027;&#x8981;&#x6C42;&#x6BD4;&#x8F83;&#x9AD8;&#xFF0C;&#x91C7;&#x7528;TCP&#x7684;&#x53C8;&#x53EF;&#x9760;&#x4E0E;&#x5B89;&#x5168;&#x3002;</p>
<p>&#x76EE;&#x524D;&#x91C7;&#x7528;netty&#x4F5C;&#x4E3A;&#x63A8;&#x9001;&#x670D;&#x52A1;&#x5668;&#x7684;&#x4E5F;&#x6709;&#x652F;&#x6301;&#x4E0A;&#x767E;&#x4E07;&#x8FDE;&#x63A5;&#x7684;&#x5E94;&#x7528;&#x4E86;&#xFF0C;tcp&#x8FD9;&#x5757;&#x6027;&#x80FD;&#x5BF9;&#x4E8E;&#x4E00;&#x822C;&#x6E38;&#x620F;&#x652F;&#x6301;&#x8DB3;&#x591F;&#x4E86;&#x3002;&#x957F;&#x94FE;&#x63A5;&#x6E38;&#x620F;&#x591A;&#x91C7;&#x7528;&#x5206;&#x533A;&#x5206;&#x670D;&#x6765;&#x5E94;&#x5BF9;&#x9AD8;&#x5E76;&#x53D1;&#x538B;&#x529B;&#xFF0C;&#x77ED;&#x94FE;&#x63A5;&#x591A;&#x91C7;&#x7528;&#x5206;&#x5E03;&#x5F0F;&#x6765;&#x5E94;&#x5BF9;&#x3002;</p>
<h1 id="&#x56DB;&#x3001;&#x4E00;&#x4E9B;&#x95EE;&#x9898;"><a href="#&#x56DB;&#x3001;&#x4E00;&#x4E9B;&#x95EE;&#x9898;" class="headerlink" title="&#x56DB;&#x3001;&#x4E00;&#x4E9B;&#x95EE;&#x9898;"></a>&#x56DB;&#x3001;&#x4E00;&#x4E9B;&#x95EE;&#x9898;</h1><h3 id="1&#x3001;&#x5B57;&#x8282;&#x5E8F;"><a href="#1&#x3001;&#x5B57;&#x8282;&#x5E8F;" class="headerlink" title="1&#x3001;&#x5B57;&#x8282;&#x5E8F;"></a>1&#x3001;&#x5B57;&#x8282;&#x5E8F;</h3><p>&#x4E8C;&#x8FDB;&#x5236;&#x534F;&#x8BAE;&#x4E2D;&#xFF0C;&#x5B57;&#x8282;&#x5E8F;&#x9700;&#x8981;&#x6CE8;&#x610F;&#xFF0C;&#x8DE8;&#x8BED;&#x8A00;&#x3001;&#x5E73;&#x53F0;&#x901A;&#x4FE1;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x51FA;&#x73B0;&#x4E71;&#x7801;&#x95EE;&#x9898;&#x3002;&#x76EE;&#x524D;&#x7684;&#x5B57;&#x8282;&#x5E8F;&#x4E3B;&#x8981;&#x6709;&#xFF0C;Little endian&#x548C;Big endian&#x4E4B;&#x5206;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5E38;&#x8BF4;&#x7684;&#x5927;&#x5934;&#x548C;&#x5C0F;&#x5934;&#x4E4B;&#x5206;&#x3002;</p>
<p>&#x5177;&#x4F53;&#x662F;&#x5927;&#x5934;&#x5728;&#x524D;&#x8FD8;&#x662F;&#x5C0F;&#x5934;&#x5728;&#x524D;&#xFF0C;&#x8FD9;&#x4E2A;&#x548C;&#x4E3B;&#x673A;&#x7684;cpu&#x6709;&#x5173;&#x7CFB;PowerPC&#x7CFB;&#x5217;&#x91C7;&#x7528;big endian&#x65B9;&#x5F0F;&#x5B58;&#x50A8;&#x6570;&#x636E;&#xFF0C;&#x800C;x86&#x7CFB;&#x5217;&#x5219;&#x91C7;&#x7528;little endian&#x65B9;&#x5F0F;&#x5B58;&#x50A8;&#x6570;&#x636E;&#x3002;&#x8FD9;&#x4E2A;&#x5728;&#x624B;&#x673A;&#x4E3B;&#x673A;&#x4E0A;&#x4E5F;&#x4F1A;&#x51FA;&#x73B0;&#x3002;</p>
<p>&#x5E94;&#x5BF9;&#x65B9;&#x6848;&#x662F;&#xFF1A;</p>
<blockquote>
<p>&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x7AEF;&#x5F3A;&#x5236;&#x91C7;&#x7528;&#x4E00;&#x79CD;&#x5B57;&#x8282;&#x5E8F;&#xFF0C;&#x4E00;&#x822C;&#x91C7;&#x7528;&#x7F51;&#x7EDC;&#x5B57;&#x8282;&#x5E8F;&#xFF08;big endian&#xFF09;</p>
</blockquote>
<h3 id="2&#x3001;&#x6D6E;&#x70B9;&#x6570;"><a href="#2&#x3001;&#x6D6E;&#x70B9;&#x6570;" class="headerlink" title="2&#x3001;&#x6D6E;&#x70B9;&#x6570;"></a>2&#x3001;&#x6D6E;&#x70B9;&#x6570;</h3><p>&#x534F;&#x8BAE;&#x4E2D;&#x51FA;&#x73B0;&#x6D6E;&#x70B9;&#x7C7B;&#x578B;&#x8981;&#x7279;&#x522B;&#x6CE8;&#x610F;&#xFF0C;&#x6D6E;&#x70B9;&#x7C7B;&#x578B;&#x7684;&#x4F20;&#x9001;&#x4E0A;&#x9762;&#x5B57;&#x8282;&#x5E8F;&#x5904;&#x7406;OK&#x4E86;&#xFF0C;&#x8FD8;&#x5F97;&#x6CE8;&#x610F;&#x6D6E;&#x70B9;&#x6570;&#x7684;&#x591A;&#x5E73;&#x53F0;&#x8FD0;&#x7B97;&#x4E0D;&#x4E00;&#x81F4;&#x95EE;&#x9898;&#x3002;</p>
<p>&#x6BD4;&#x5982;&#x6E38;&#x620F;&#x4E2D;&#x8981;&#x5BF9;&#x5BFB;&#x8DEF;&#x3001;&#x6218;&#x6597;&#x7B49;&#x516C;&#x5F0F;&#x8BA1;&#x7B97;&#xFF0C;&#x7275;&#x626F;&#x5230;&#x6D6E;&#x70B9;&#x6570;&#x4E86;&#xFF0C;&#x6709;&#x53EF;&#x80FD;&#x524D;&#x540E;&#x7AEF;&#x7B97;&#x51FA;&#x7684;&#x4E0D;&#x4E00;&#x81F4;&#xFF0C;&#x4EE5;Arm&#x4E3A;&#x4F8B;&#xFF0C;Arm&#x7684;&#x6D6E;&#x70B9;&#x6570;&#x5C31;&#x6709;&#x8F6F;&#x6A21;&#x62DF;&#x3001;&#x786C;&#x4EF6;IEEE-754&#x517C;&#x5BB9;&#x3001;SIMD&#x4E0B;IEEE-754&#x4E0D;&#x517C;&#x5BB9;&#x4E09;&#x79CD;&#x60C5;&#x51B5;&#x3002;</p>
<p>&#x6B64;&#x65F6;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;</p>
<blockquote>
<p>1&#x3001;&#x7EDF;&#x4E00;&#x4E00;&#x79CD;&#x683C;&#x5F0F;&#xFF0C;&#x6BD4;&#x5982;&#x524D;&#x540E;&#x7AEF;&#x90FD;&#x91C7;&#x7528;&#x8F6F;&#x6A21;&#x62DF;&#xFF0C;&#x6216;&#x8005;&#x5F3A;&#x5236;&#x91C7;&#x7528;&#x786C;&#x4EF6;IEEE-754&#xFF08;&#x8F6F;&#x6A21;&#x62DF;&#x901F;&#x5EA6;&#x6162;&#xFF09;</p>
<p>2&#x3001;&#x8F6C;&#x6362;&#x4E3A;&#x5B9A;&#x70B9;&#x6570;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6D6E;&#x70B9;&#x8F6C;&#x6362;&#x4E3A;&#x6574;&#x6570;&#xFF08;&#x901F;&#x5EA6;&#x5FEB;&#xFF09;</p>
</blockquote>
<p>&#x626B;&#x63CF;&#x5173;&#x6CE8;&#x6211;&#x7684;&#x516C;&#x4F17;&#x53F7;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/7c695ece2f7eaa4f555239151be684304df05ddfc7f9321de65ea4a037da1372" alt></p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/016465431bda690f0dce32d5ac258ca2.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903527551074317.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903527551074317.html" itemprop="url">Go 中 slice 的那些事</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-14T10:07:21+08:00">
                2017-12-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/1295e6183c8a633dce6f872f97cab7641d31c010482f1b9bdff34a432b478b55" alt="Go"></p>
<h3 id="&#x4E00;&#x3001;&#x5B9A;&#x4E49;"><a href="#&#x4E00;&#x3001;&#x5B9A;&#x4E49;" class="headerlink" title="&#x4E00;&#x3001;&#x5B9A;&#x4E49;"></a>&#x4E00;&#x3001;&#x5B9A;&#x4E49;</h3><p>&#x6211;&#x4EEC;&#x90FD;&#x77E5;&#x9053;&#x5728; Go &#x8BED;&#x8A00;&#x4E2D;&#xFF0C;&#x6570;&#x7EC4;&#x7684;&#x957F;&#x5EA6;&#x662F;&#x4E0D;&#x53EF;&#x53D8;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x4E3A;&#x4E86;&#x66F4;&#x52A0;&#x7075;&#x6D3B;&#x7684;&#x5904;&#x7406;&#x6570;&#x636E;&#xFF0C;Go &#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x79CD;&#x529F;&#x80FD;&#x5F3A;&#x608D;&#x7684;&#x7C7B;&#x578B;&#x5207;&#x7247;&#xFF08;slice&#xFF09;&#xFF0C;slice &#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A; &#x201C;&#x52A8;&#x6001;&#x6570;&#x7EC4;&#x201D;&#x3002;&#x4F46;&#x662F; slice &#x5E76;&#x4E0D;&#x662F;&#x771F;&#x6B63;&#x610F;&#x4E49;&#x4E0A;&#x7684;&#x52A8;&#x6001;&#x6570;&#x7EC4;&#xFF0C;&#x800C;&#x662F;&#x4E00;&#x4E2A;&#x5F15;&#x7528;&#x7C7B;&#x578B;&#x3002;slice &#x603B;&#x662F;&#x6307;&#x5411;&#x4E00;&#x4E2A;&#x5E95;&#x5C42; array&#xFF0C;slice &#x7684;&#x58F0;&#x660E;&#x4E5F;&#x53EF;&#x4EE5;&#x50CF; array &#x4E00;&#x6837;&#xFF0C;&#x53EA;&#x662F;&#x4E0D;&#x9700;&#x8981;&#x957F;&#x5EA6;&#x3002;slice &#x7684;&#x58F0;&#x660E;&#x548C;&#x6570;&#x7EC4;&#x7C7B;&#x4F3C;&#xFF0C;&#x5982;&#x4E0B;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;var iSlice []int</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x91CC;&#x7684;&#x58F0;&#x660E;&#x548C;&#x6570;&#x7EC4;&#x4E00;&#x6837;&#xFF0C;&#x53EA;&#x662F;&#x5C11;&#x4E86;&#x957F;&#x5EA6;&#xFF0C;&#x6CE8;&#x610F;&#x4E24;&#x8005;&#x7684;&#x6BD4;&#x8F83;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;//&#x58F0;&#x660E;&#x4E00;&#x4E2A;&#x4FDD;&#x5B58; int &#x7684; slice</span><br><span class="line">var iSlice []int</span><br><span class="line"></span><br><span class="line">//&#x58F0;&#x660E;&#x4E00;&#x4E2A;&#x957F;&#x5EA6;&#x4E3A; 10 &#x7684; int &#x6570;&#x7EC4;</span><br><span class="line">var iArray [10]int</span><br></pre></td></tr></table></figure>

<p>&#x8FD8;&#x6709;&#x4E00;&#x79CD;&#x58F0;&#x660E;&#x7684;&#x65B9;&#x6CD5;&#x662F;&#x4F7F;&#x7528; make() &#x51FD;&#x6570;&#xFF0C;&#x5982;&#x4E0B;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;slice1 := make([]int, 5, 10)</span><br></pre></td></tr></table></figure>

<p>&#x7528; make() &#x51FD;&#x6570;&#x521B;&#x5EFA;&#x7684;&#x65F6;&#x5019;&#x6709;&#x4E09;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;<code>make(type, len[, cap])</code> &#xFF0C;&#x4F9D;&#x6B21;&#x662F;&#x7C7B;&#x578B;&#x3001;&#x957F;&#x5EA6;&#x3001;&#x5BB9;&#x91CF;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/b464c1dd89a1bd39ce499e23f1e5cb7724767a0b42a29811bf7bdf3eac6acdfb" alt="slice1"></p>
<p>&#x5982;&#x56FE;&#x6240;&#x793A;&#xFF0C;&#x4E0A;&#x56FE;&#x8868;&#x793A;&#x521B;&#x5EFA;&#x4E86; slice1 &#xFF0C;&#x957F;&#x5EA6;&#x662F; 5&#xFF0C;&#x9ED8;&#x8BA4;&#x7684;&#x503C;&#x90FD;&#x662F; 0&#xFF0C;&#x5BB9;&#x91CF;&#x662F; 10&#xFF0C;&#x8FD9;&#x6837;&#x58F0;&#x660E;&#x5C31;&#x5F00;&#x8F9F;&#x4E86;&#x4E00;&#x5757;&#x5BB9;&#x91CF;&#x662F; 10<br>&#x7684;&#x8FDE;&#x7EED;&#x7684;&#x4E00;&#x5757;&#x5185;&#x5B58;&#x3002;&#x5F53;&#x7136;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x4E0D;&#x6307;&#x5B9A;&#x5BB9;&#x91CF;&#x4E5F;&#x662F;&#x53EF;&#x4EE5;&#x7684;&#xFF0C;&#x5982;&#x4E0B;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;slice2 := make([]int, 5)</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x6837;&#x5C31;&#x4F1A;&#x6839;&#x636E;&#x5B9E;&#x9645;&#x60C5;&#x51B5;&#x52A8;&#x6001;&#x5206;&#x914D;&#x5185;&#x5B58;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x6700;&#x5F00;&#x59CB;&#x6307;&#x5B9A;&#x4E00;&#x5757;&#x56FA;&#x5B9A;&#x5927;&#x5C0F;&#x7684;&#x5185;&#x5B58;&#x3002;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#x6211;&#x4EEC;&#x4E00;&#x822C;&#x4F7F;&#x7528; make() &#x51FD;&#x6570;&#x6765;&#x521B;&#x5EFA; slice&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6307;&#x5B9A; slice &#x7684;&#x5BB9;&#x91CF;&#xFF0C;&#x8FD9;&#x6837;&#x5728;&#x6700;&#x5F00;&#x59CB;&#x521B;&#x5EFA;&#x7684;&#x65F6;&#x5019;&#x5C31;&#x5206;&#x914D;&#x597D;&#x7A7A;&#x95F4;&#xFF0C;&#x907F;&#x514D;&#x6570;&#x636E;&#x591A;&#x6B21;&#x6539;&#x53D8;&#x5BFC;&#x81F4;&#x591A;&#x6B21;&#x91CD;&#x65B0;&#x6539;&#x53D8; cap &#x5206;&#x914D;&#x7A7A;&#x95F4;&#x5E26;&#x6765;&#x4E0D;&#x5FC5;&#x8981;&#x7684;&#x5F00;&#x9500;&#x3002;</p>
<h3 id="&#x4E8C;&#x3001;slice-&#x7684;&#x7279;&#x6027;"><a href="#&#x4E8C;&#x3001;slice-&#x7684;&#x7279;&#x6027;" class="headerlink" title="&#x4E8C;&#x3001;slice &#x7684;&#x7279;&#x6027;"></a>&#x4E8C;&#x3001;slice &#x7684;&#x7279;&#x6027;</h3><p>&#x5173;&#x4E8E; slice &#x7684;&#x4E00;&#x4E9B;&#x57FA;&#x672C;&#x7279;&#x6027;&#xFF0C;<a href="/external_links/3bdf1e3c43b89092816b9000b996da57.html" target="blank" rel="noopener">&#x300A;Go Web &#x7F16;&#x7A0B;&#x300B;</a> &#x8FD9;&#x672C;&#x4E66;&#x91CC;&#x5DF2;&#x7ECF;&#x8BB2;&#x7684;&#x5F88;&#x8BE6;&#x7EC6;&#xFF0C;&#x6709;&#x5BF9;&#x57FA;&#x672C;&#x77E5;&#x8BC6;&#x4E0D;&#x6E05;&#x695A;&#x7684;&#x7AE5;&#x978B;&#x53EF;&#x4EE5;&#x53BB;&#x8865;&#x4E60;&#x4E00;&#x4E0B;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x4E00;&#x4E00;&#x53D9;&#x8FF0;&#x4E86;&#x3002;&#x6211;&#x4E48;&#x6765;&#x770B;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#xFF0C;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func main() {</span><br><span class="line">	aSlice := []int{1, 2, 3, 4, 5}</span><br><span class="line">	fmt.Printf(&quot;aSlice length = %d, cap = %d, self = %v\n&quot;, len(aSlice), cap(aSlice), aSlice)</span><br><span class="line">	aSlice = append(aSlice, 6)</span><br><span class="line">	fmt.Printf(&quot;aSlice length= %d, cap = %d, self = %v&quot;, len(aSlice), cap(aSlice), aSlice)</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x8FD0;&#x884C;&#xFF0C;&#x63A7;&#x5236;&#x53F0;&#x6253;&#x5370;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/ade92eb842df9de7a46769f3fa7a0069d51251a772bdb5ca162d5203bf3fe8a5" alt></p>
<p>&#x6211;&#x4EEC;&#x4F1A;&#x770B;&#x5230; aSlice &#x8FDB;&#x884C; append &#x64CD;&#x4F5C;&#x4EE5;&#x540E;&#xFF0C;&#x5B83;&#x7684;&#x5BB9;&#x91CF;&#x589E;&#x52A0;&#x4E86;&#x4E00;&#x500D;&#xFF0C;cap &#x5E76;&#x6CA1;&#x6709;&#x53D8;&#x6210;&#x6211;&#x4EEC;&#x60F3;&#x8C61;&#x4E2D;&#x7684; 6 &#xFF0C;&#x800C;&#x662F;&#x53D8;&#x6210;&#x4E86; 10<br><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/8eb89a8e742eab0d80a868fb2acba0ec28488401ce467f8526e03cc6d626d8fa" alt="aSlice"></p>
<p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x6700;&#x5F00;&#x59CB; slice &#x7684;&#x5BB9;&#x91CF;&#x662F; 10&#xFF0C;&#x957F;&#x5EA6;&#x662F; 5 &#xFF0C;&#x90A3;&#x4E48;&#x518D;&#x52A0;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x662F;&#x4E0D;&#x4F1A;&#x6539;&#x53D8;&#x5207;&#x7247;&#x7684;&#x5BB9;&#x91CF;&#x7684;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x5F80; slice&#x4E2D;&#x589E;&#x52A0;&#x5143;&#x7D20;&#x8D85;&#x8FC7;&#x539F;&#x6765;&#x7684;&#x5BB9;&#x91CF;&#x65F6;&#xFF0C;slice &#x4F1A;&#x81EA;&#x589E;&#x5BB9;&#x91CF;&#xFF0C;&#x5F53;&#x73B0;&#x6709;&#x957F;&#x5EA6; &lt; 1024 &#x65F6; cap &#x589E;&#x957F;&#x662F;&#x7FFB;&#x500D;&#x7684;&#xFF0C;&#x5F53;&#x8D85;&#x8FC7; 1024&#xFF0C;cap &#x7684;&#x589E;&#x957F;&#x662F; 1.25 &#x500D;&#x589E;&#x957F;&#x3002;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E00;&#x4E0B; <a href="/external_links/4b73fc2e883de9f71ff5ce07358862c3.html" target="blank" rel="noopener">slice.go</a> &#x7684;&#x6E90;&#x7801;&#x4F1A;&#x53D1;&#x73B0;&#x6709;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x91CC;&#x9762;&#x8BF4;&#x660E;&#x4E86; cap &#x7684;&#x589E;&#x957F;&#x89C4;&#x5219;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;func growslice(et *_type, old slice, cap int) slice {</span><br><span class="line">/**</span><br><span class="line">    ....&#x7701;&#x7565;....</span><br><span class="line">**/</span><br><span class="line">	newcap := old.cap</span><br><span class="line">	doublecap := newcap + newcap</span><br><span class="line">	if cap &gt; doublecap {</span><br><span class="line">		newcap = cap</span><br><span class="line">	} else {</span><br><span class="line">		if old.len &lt; 1024 {</span><br><span class="line">			newcap = doublecap</span><br><span class="line">		} else {</span><br><span class="line">			// Check 0 &lt; newcap to detect overflow</span><br><span class="line">			// and prevent an infinite loop.</span><br><span class="line">			for 0 &lt; newcap &amp;&amp; newcap &lt; cap {</span><br><span class="line">				newcap += newcap / 4</span><br><span class="line">			}</span><br><span class="line">			// Set newcap to the requested cap when</span><br><span class="line">			// the newcap calculation overflowed.</span><br><span class="line">			if newcap &lt;= 0 {</span><br><span class="line">				newcap = cap</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">/**</span><br><span class="line">    ....&#x7701;&#x7565;....</span><br><span class="line">**/</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4ECE;&#x4E0A;&#x9762;&#x7684;&#x6E90;&#x7801;&#xFF0C;&#x5728;&#x5BF9; slice &#x8FDB;&#x884C; append &#x7B49;&#x64CD;&#x4F5C;&#x65F6;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x9020;&#x6210; slice &#x7684;&#x81EA;&#x52A8;&#x6269;&#x5BB9;&#x3002;&#x5176;&#x6269;&#x5BB9;&#x65F6;&#x7684;&#x5927;&#x5C0F;&#x589E;&#x957F;&#x89C4;&#x5219;&#x662F;&#xFF1A;</p>
<ul>
<li>&#x5982;&#x679C;&#x65B0;&#x7684; slice &#x5927;&#x5C0F;&#x662F;&#x5F53;&#x524D;&#x5927;&#x5C0F;2&#x500D;&#x4EE5;&#x4E0A;&#xFF0C;&#x5219;&#x5927;&#x5C0F;&#x589E;&#x957F;&#x4E3A;&#x65B0;&#x5927;&#x5C0F;</li>
<li>&#x5426;&#x5219;&#x5FAA;&#x73AF;&#x4EE5;&#x4E0B;&#x64CD;&#x4F5C;&#xFF1A;&#x5982;&#x679C;&#x5F53;&#x524D;slice&#x5927;&#x5C0F;&#x5C0F;&#x4E8E;1024&#xFF0C;&#x6309;&#x6BCF;&#x6B21; 2 &#x500D;&#x589E;&#x957F;&#xFF0C;&#x5426;&#x5219;&#x6BCF;&#x6B21;&#x6309;&#x5F53;&#x524D;&#x5927;&#x5C0F; 1/4 &#x589E;&#x957F;&#xFF0C;&#x76F4;&#x5230;&#x589E;&#x957F;&#x7684;&#x5927;&#x5C0F;&#x8D85;&#x8FC7;&#x6216;&#x7B49;&#x4E8E;&#x65B0;&#x5927;&#x5C0F;&#x3002;</li>
<li>append &#x7684;&#x5B9E;&#x73B0;&#x53EA;&#x662F;&#x7B80;&#x5355;&#x7684;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x5C06;&#x65E7; slice &#x590D;&#x5236;&#x7ED9;&#x65B0; slice</li>
</ul>
<p>&#x6765;&#x770B;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#xFF0C;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;package main</span><br><span class="line"></span><br><span class="line">import &quot;fmt&quot;</span><br><span class="line"></span><br><span class="line">func main() {</span><br><span class="line"></span><br><span class="line">	aSlice := make([]int, 3, 5)</span><br><span class="line">	bSlice := append(aSlice, 1, 2)</span><br><span class="line">	fmt.Printf(&quot;a %v , cap = %d, len = %d\n&quot;, aSlice, cap(aSlice), len(aSlice))</span><br><span class="line">	fmt.Printf(&quot;b %v , cap = %d, len = %d\n&quot;, bSlice, cap(bSlice), len(bSlice))</span><br><span class="line">	aSlice[0] = 6</span><br><span class="line">	fmt.Printf(&quot;a %v , cap = %d, len = %d\n&quot;, aSlice, cap(aSlice), len(aSlice))</span><br><span class="line">	fmt.Printf(&quot;b %v , cap = %d, len = %d&quot;, bSlice, cap(bSlice), len(bSlice))</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x6211;&#x4EEC;&#x4F1A;&#x770B;&#x5230;&#x63A7;&#x5236;&#x53F0;&#x8F93;&#x51FA;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/86e459b5b93fa13743d1817bbe55a266e80fcd39cd5fcd12a981725fedf34122" alt="print"></p>
<p>&#x53D8;&#x5316;&#x8FC7;&#x7A0B;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;<br><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/0a9d24cb326fae834922430fc595a0201f569db55b798ffa6c029daf798b5223" alt="slice&#x53D8;&#x5316;"></p>
<p>&#x4E0A;&#x9762;&#x8BF4;&#x660E;&#xFF0C;&#x5728; slice &#x7684; cap &#x8303;&#x56F4;&#x5185;&#x589E;&#x52A0;&#x5143;&#x7D20;&#xFF0C; slice &#x53EA;&#x4F1A;&#x53D1;&#x751F; len &#x7684;&#x53D8;&#x5316;&#x4E0D;&#x4F1A;&#x53D1;&#x751F; cap &#x7684;&#x53D8;&#x5316;&#xFF0C;&#x540C;&#x6837;&#x4E5F;&#x8BF4;&#x660E; slice &#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x6307;&#x5411;&#x4E00;&#x4E2A;&#x5E95;&#x5C42;&#x7684;&#x6570;&#x7EC4;&#xFF0C;&#x5F53;&#x591A;&#x4E2A; slice &#x6307;&#x5411;&#x540C;&#x4E00;&#x4E2A;&#x5E95;&#x5C42;&#x6570;&#x7EC4;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x6539;&#x53D8;&#xFF0C;&#x5176;&#x4F59;&#x7684;&#x4E5F;&#x4F1A;&#x8DDF;&#x7740;&#x6539;&#x53D8;&#xFF0C;&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x4E00;&#x4E0B;&#x3002;&#x6211;&#x4EEC;&#x540C;&#x6837;&#x4ECE; <a href="/external_links/4b73fc2e883de9f71ff5ce07358862c3.html" target="blank" rel="noopener">slice.go</a> &#x7684;&#x6E90;&#x7801;&#x4E2D; slice &#x7684;&#x5B9A;&#x4E49;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;type slice struct {</span><br><span class="line">	array unsafe.Pointer</span><br><span class="line">	len   int</span><br><span class="line">	cap   int</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x91CC;&#x5173;&#x4E8E;&#x5E95;&#x5C42;&#x7684;&#x4E1C;&#x897F;&#x5C31;&#x4E0D;&#x591A;&#x53D9;&#x8FF0;&#xFF0C;&#x6709;&#x5174;&#x8DA3;&#x7684;&#x53EF;&#x4EE5;&#x770B;&#x770B; <a href="/external_links/b6a69eecd70960c6817d7be83c6dcd9a.html" target="blank" rel="noopener">&#x4E00;&#x7F15;&#x6B87;&#x6D41;&#x5316;&#x9690;&#x534A;&#x8FB9;&#x51B0;&#x971C;</a> &#x51B0;&#x971C;&#x7684; <a href="/external_links/1987cdaa241ae48e8a25b02d989b7e3c.html" target="blank" rel="noopener">&#x6DF1;&#x5165;&#x89E3;&#x6790; Go &#x4E2D; Slice &#x5E95;&#x5C42;&#x5B9E;&#x73B0;</a> &#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#xFF0C;&#x5BF9; slice &#x7684;&#x5E95;&#x5C42;&#x5B9E;&#x73B0;&#x7684;&#x8BB2;&#x89E3;&#x3002;&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x628A;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x6539;&#x53D8;&#x4E00;&#x4E0B;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;package main</span><br><span class="line"></span><br><span class="line">import &quot;fmt&quot;</span><br><span class="line"></span><br><span class="line">func main() {</span><br><span class="line"></span><br><span class="line">	aSlice := make([]int, 3, 5)</span><br><span class="line">	bSlice := append(aSlice, 1, 2, 3, 4)</span><br><span class="line">	fmt.Printf(&quot;a %v , cap = %d, len = %d\n&quot;, aSlice, cap(aSlice), len(aSlice))</span><br><span class="line">	fmt.Printf(&quot;b %v , cap = %d, len = %d\n&quot;, bSlice, cap(bSlice), len(bSlice))</span><br><span class="line">	aSlice[0] = 6</span><br><span class="line">	fmt.Printf(&quot;a %v , cap = %d, len = %d\n&quot;, aSlice, cap(aSlice), len(aSlice))</span><br><span class="line">	fmt.Printf(&quot;b %v , cap = %d, len = %d&quot;, bSlice, cap(bSlice), len(bSlice))</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x4E0B;&#x9762;&#x7684;&#x8F93;&#x51FA;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/400312630ce4e7f31be1734634c38e0cd33965200a70f84d399431dbe46d6032" alt="&#x6539;&#x53D8;&#x540E;&#x7684; print"></p>
<p>&#x4E0A;&#x9762;&#x4EE3;&#x7801;&#x53EF;&#x4EE5;&#x7528;&#x4E0B;&#x56FE;&#x8BF4;&#x660E;<br><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/3ef0d7f6073aabab2cab44ed3e22a4444f337e27ee3fd7d1fd39e3728e95108e" alt="slice append"></p>
<p>&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x5F53; append &#x7684;&#x6570;&#x636E;&#x8D85;&#x8FC7;&#x539F;&#x6765;&#x7684;&#x5BB9;&#x91CF;&#x4EE5;&#x540E;&#xFF0C;&#x5C31;&#x4F1A;&#x91CD;&#x65B0;&#x5206;&#x914D;&#x4E00;&#x5757;&#x65B0;&#x7684;&#x5185;&#x5B58;&#xFF0C;&#x5E76;&#x628A;&#x539F;&#x6765;&#x7684;&#x6570;&#x636E; copy &#x8FC7;&#x6765;&#xFF0C;&#x5E76;&#x4E14;&#x4FDD;&#x7559;&#x539F;&#x6765;&#x7684;&#x7A7A;&#x95F4;&#xFF0C;&#x4F9B;&#x539F;&#x6765;&#x7684; slice&#xFF08;aSlice&#xFF09; &#x4F7F;&#x7528;&#x8FD9;&#x6837; aSlice &#x548C; bSlice &#x5C31;&#x5404;&#x81EA;&#x6307;&#x5411;&#x4E0D;&#x540C;&#x7684;&#x5730;&#x5740;&#xFF0C;&#x5F53; aSlice &#x6539;&#x53D8;&#x65F6;&#xFF0C;bSlice &#x4E0D;&#x4F1A;&#x6539;&#x53D8;&#x3002;<br>&#x5173;&#x4E8E; cap &#x8FD8;&#x6709;&#x4E00;&#x70B9;&#x9700;&#x8981;&#x6CE8;&#x610F;&#xFF0C;&#x6211;&#x4EEC;&#x6765;&#x7528;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#x8BF4;&#x660E;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;package main</span><br><span class="line"></span><br><span class="line">import &quot;fmt&quot;</span><br><span class="line"></span><br><span class="line">func main() {</span><br><span class="line"></span><br><span class="line">	Array_a := [10]byte{&apos;a&apos;, &apos;b&apos;, &apos;c&apos;, &apos;d&apos;, &apos;e&apos;, &apos;f&apos;, &apos;g&apos;, &apos;h&apos;, &apos;i&apos;, &apos;j&apos;}</span><br><span class="line">	Slice_a := Array_a[2:5]</span><br><span class="line">	Slice_b := Slice_a[6:7]</span><br><span class="line">	fmt.Printf(&quot;Slice_a %v , cap = %d, len = %d\n&quot;, string(Slice_a), cap(Slice_a), len(Slice_a))</span><br><span class="line">	fmt.Printf(&quot;Slice_b %v , cap = %d, len = %d\n&quot;, string(Slice_b), cap(Slice_b), len(Slice_b))</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x63A7;&#x5236;&#x53F0;&#x6253;&#x5370;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/b10a59229a80247c35790fd27589ef27bb24abd7f1ed39a8015d96d223d05061" alt="reslice print"></p>
<p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x4F1A;&#x53D1;&#x73B0; Slice_b &#x5BF9; Slice_a &#x8FDB;&#x884C;&#x91CD;&#x65B0;&#x5207;&#x7247;&#x540E;&#xFF0C;&#x5E76;&#x6CA1;&#x6709;&#x62A5;&#x9519;&#xFF0C;&#x800C;&#x662F;&#x8FD8;&#x6709;&#x8F93;&#x51FA;&#xFF0C;&#x8FD9;&#x662F;&#x56E0;&#x4E3A; Slice_a &#x7684; cap &#x662F; 8 &#xFF0C;&#x5E76;&#x4E0D;&#x662F;&#x6211;&#x4EEC;&#x60F3;&#x8C61;&#x7684; 3&#xFF0C;slice &#x6307;&#x5411;&#x7684;&#x662F;&#x4E00;&#x5757;&#x8FDE;&#x7EED;&#x7684;&#x5185;&#x5B58;&#xFF0C;&#x6240;&#x4EE5; Slice_a &#x7684;&#x5BB9;&#x91CF;&#x5176;&#x5B9E;&#x662F;&#x4E00;&#x76F4;&#x5230; Array_a &#x7684;&#x6700;&#x540E;&#x7684;&#x3002;&#x6240;&#x4EE5;&#x8FD9;&#x91CC; Array_b &#x5BF9; Array_a &#x8FDB;&#x884C;&#x5207;&#x7247;&#x540E;&#x4F1A;&#x5F97;&#x5230;&#x503C;&#xFF0C;<a href="/external_links/3bdf1e3c43b89092816b9000b996da57.html" target="blank" rel="noopener">&#x300A;Go Web &#x7F16;&#x7A0B;&#x300B;</a> &#x4E0A;&#x8FD9;&#x5F20;&#x56FE;&#x5F62;&#x8C61;&#x7684;&#x89E3;&#x91CA;&#x4E86;&#x5BF9;&#x6570;&#x7EC4;&#x7684;&#x5207;&#x7247;&#x7ED3;&#x679C;&#xFF0C;&#x8FD9;&#x91CC;&#x662F;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x4E00;&#x4E2A;&#x70B9;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/53bc18ebb7ddf01f2692b611b5978d375f13189b8920fbdfbaac158f75589d6f" alt="slice"></p>
<h3 id="&#x4E09;&#x3001;&#x5173;&#x4E8E;-copy"><a href="#&#x4E09;&#x3001;&#x5173;&#x4E8E;-copy" class="headerlink" title="&#x4E09;&#x3001;&#x5173;&#x4E8E; copy"></a>&#x4E09;&#x3001;&#x5173;&#x4E8E; copy</h3><p>&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E0B;&#x9762;&#x4EE3;&#x7801;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;package main</span><br><span class="line"></span><br><span class="line">import &quot;fmt&quot;</span><br><span class="line"></span><br><span class="line">func main() {</span><br><span class="line"></span><br><span class="line">	aSlice := []int{1, 2, 3}</span><br><span class="line">	bSlice := []int{4, 5, 6, 7, 8, 9}</span><br><span class="line">	copy(bSlice, aSlice)</span><br><span class="line">	fmt.Println(aSlice, bSlice)//[1 2 3] [1 2 3 7 8 9]</span><br><span class="line">       //&#x5982;&#x679C;&#x662F; copy( aSlice, bSlice) &#x5219;&#x7ED3;&#x679C;&#x662F; [4 5 6] </span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4E5F;&#x5C31;&#x662F;&#x8BF4; copy() &#x51FD;&#x6570;&#x6709;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x4E00;&#x4E2A;&#x662F; to &#x4E00;&#x4E2A;&#x662F; from&#xFF0C;&#x5C31;&#x662F;&#x5C06;&#x7B2C;&#x4E8C;&#x4E2A; copy &#x5230;&#x7B2C;&#x4E00;&#x4E2A;&#x4E0A;&#x9762;&#xFF0C;&#x5982;&#x679C;&#x7B2C;&#x4E00;&#x4E2A;&#x957F;&#x5EA6;&#x5C0F;&#x4E8E;&#x7B2C;&#x4E8C;&#x4E2A;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x4F1A; copy &#x4E0E;&#x7B2C;&#x4E00;&#x4E2A;&#x7B49;&#x957F;&#x5EA6;&#x7684;&#x503C;&#xFF0C;&#x5982; copy( aSlice, bSlice) &#x7684;&#x7ED3;&#x679C;&#x662F; [4 5 6] &#xFF0C;&#x53CD;&#x4E4B;&#x5219;&#x662F;&#x77ED;&#x7684;&#x8986;&#x76D6;&#x957F;&#x7684;&#x524D;&#x51E0;&#x4F4D;&#x3002;&#x5F53;&#x7136;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x590D;&#x5236;&#x957F;&#x5EA6;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;package main</span><br><span class="line"></span><br><span class="line">import &quot;fmt&quot;</span><br><span class="line"></span><br><span class="line">func main() {</span><br><span class="line"></span><br><span class="line">	aSlice := []int{1, 2, 3}</span><br><span class="line">	bSlice := []int{4, 5, 6, 7, 8, 9}</span><br><span class="line">	copy(bSlice[2:5], aSlice)</span><br><span class="line">	fmt.Println(aSlice, bSlice)//[1 2 3] [4 5 1 2 3 9]</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5173;&#x4E8E; slice &#x7684; copy &#x7684;&#x89C4;&#x5219;&#x903B;&#x8F91;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x5728;&#x6E90;&#x7801;&#x4E2D;&#x770B;&#x51FA;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;func slicecopy(to, fm slice, width uintptr) int {</span><br><span class="line">	if fm.len == 0 || to.len == 0 {</span><br><span class="line">		return 0</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	n := fm.len</span><br><span class="line">	if to.len &lt; n {</span><br><span class="line">		n = to.len</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	if width == 0 {</span><br><span class="line">		return n</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	if raceenabled {</span><br><span class="line">		callerpc := getcallerpc()</span><br><span class="line">		pc := funcPC(slicecopy)</span><br><span class="line">		racewriterangepc(to.array, uintptr(n*int(width)), callerpc, pc)</span><br><span class="line">		racereadrangepc(fm.array, uintptr(n*int(width)), callerpc, pc)</span><br><span class="line">	}</span><br><span class="line">	if msanenabled {</span><br><span class="line">		msanwrite(to.array, uintptr(n*int(width)))</span><br><span class="line">		msanread(fm.array, uintptr(n*int(width)))</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	size := uintptr(n) * width</span><br><span class="line">	if size == 1 { // common case worth about 2x to do here</span><br><span class="line">		// TODO: is this still worth it with new memmove impl?</span><br><span class="line">		*(*byte)(to.array) = *(*byte)(fm.array) // known to be a byte pointer</span><br><span class="line">	} else {</span><br><span class="line">		memmove(to.array, fm.array, size)</span><br><span class="line">	}</span><br><span class="line">	return n</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x6211;&#x4EEC;&#x770B;&#x6E90;&#x7801;&#x63A5;&#x7740;&#x5F80;&#x4E0B;&#x770B;&#x4F1A;&#x53D1;&#x73B0;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;func slicestringcopy(to []byte, fm string) int {</span><br><span class="line">	if len(fm) == 0 || len(to) == 0 {</span><br><span class="line">		return 0</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	n := len(fm)</span><br><span class="line">	if len(to) &lt; n {</span><br><span class="line">		n = len(to)</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	if raceenabled {</span><br><span class="line">		callerpc := getcallerpc()</span><br><span class="line">		pc := funcPC(slicestringcopy)</span><br><span class="line">		racewriterangepc(unsafe.Pointer(&amp;to[0]), uintptr(n), callerpc, pc)</span><br><span class="line">	}</span><br><span class="line">	if msanenabled {</span><br><span class="line">		msanwrite(unsafe.Pointer(&amp;to[0]), uintptr(n))</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	memmove(unsafe.Pointer(&amp;to[0]), stringStructOf(&amp;fm).str, uintptr(n))</span><br><span class="line">	return n</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x6211;&#x4EEC;&#x4F1A;&#x53D1;&#x73B0;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#x5206;&#x522B;&#x662F; []byte &#x548C; string &#xFF0C;&#x8FD9;&#x91CC;&#x5176;&#x5B9E;&#x662F; Go &#x5B9E;&#x73B0;&#x4E86;&#x4E00;&#x4E2A;&#x5C06; string &#x590D;&#x5236;&#x5230; []byte &#x4E0A;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x6709;&#x4EC0;&#x4E48;&#x7528;&#xFF0C;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E2A;&#x4F8B;&#x5B50;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;package main</span><br><span class="line"></span><br><span class="line">import &quot;fmt&quot;</span><br><span class="line"></span><br><span class="line">func main() {</span><br><span class="line"></span><br><span class="line">	s := &quot;hello&quot;</span><br><span class="line">	c := []byte(s) // &#x5C06;&#x5B57;&#x7B26;&#x4E32; s &#x8F6C;&#x6362;&#x4E3A; []byte &#x7C7B;&#x578B;</span><br><span class="line">	c[0] = &apos;c&apos;</span><br><span class="line">	s2 := string(c) // &#x518D;&#x8F6C;&#x6362;&#x56DE; string &#x7C7B;&#x578B;</span><br><span class="line">	fmt.Printf(&quot;%s\n&quot;, s2)</span><br><span class="line">	fmt.Printf(&quot;s-%x, c-%x, s2-%x&quot;, &amp;s, &amp;c, &amp;s2)</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x63A7;&#x5236;&#x53F0;&#x8F93;&#x51FA;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/57af7489bb6be95607aaa741277ac5ba8cd41b06b86c69f7eb70e98482320c7f" alt="&#x5B57;&#x7B26;&#x4E32;&#x6539;&#x53D8;"></p>
<p>&#x5728; Go &#x4E2D;&#x5B57;&#x7B26;&#x4E32;&#x662F;&#x4E0D;&#x53EF;&#x4EE5;&#x6539;&#x53D8;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528;&#x4E0A;&#x9762;&#x7684;&#x65B9;&#x6CD5;&#x6765;&#x6539;&#x53D8;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x8FD9;&#x91CC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x662F;&#x5B9E;&#x73B0;&#x4E86; string &#x548C; []byte &#x7684;&#x4E92;&#x76F8;&#x8F6C;&#x6362;&#xFF0C;&#x8FBE;&#x5230;&#x4E86;&#x4FEE;&#x6539; string &#x7684;&#x76EE;&#x7684;&#x3002;&#x6211;&#x4EEC;&#x53BB;&#x770B;&#x770B; <a href="/external_links/bbdeeb4d99f00ded8589c59e46f58a50.html" target="blank" rel="noopener">string.go</a> &#x7684;&#x6E90;&#x7801;&#x4F1A;&#x53D1;&#x73B0;&#xFF0C;&#x6709;&#x4E0B;&#x9762;&#x7684;&#x65B9;&#x6CD5;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;func stringtoslicebyte(buf *tmpBuf, s string) []byte {</span><br><span class="line">	var b []byte</span><br><span class="line">	if buf != nil &amp;&amp; len(s) &lt;= len(buf) {</span><br><span class="line">		*buf = tmpBuf{}</span><br><span class="line">		b = buf[:len(s)]</span><br><span class="line">	} else {</span><br><span class="line">		b = rawbyteslice(len(s))</span><br><span class="line">	}</span><br><span class="line">	copy(b, s)</span><br><span class="line">	return b</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x4E0A;&#x9762;&#x6709;&#x4E2A; copy(b, s) &#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x662F;&#x5C06; string &#x590D;&#x5236;&#x5230; []byte &#x4E0A;&#xFF0C;&#x5728; slice.go &#x5DF2;&#x7ECF;&#x5B9E;&#x73B0;&#x8FC7;&#x4E86;&#x7684;&#x3002;&#x4ECE;&#x6E90;&#x7801;&#x4E2D;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x6BCF;&#x6B21; b &#x90FD;&#x662F;&#x91CD;&#x65B0;&#x5206;&#x914D;&#x7684;&#xFF0C;&#x7136;&#x540E;&#x5C06; s &#x590D;&#x5236; &#x7ED9; b&#xFF0C;&#x4ECE;&#x6211;&#x4EEC;&#x4E0A;&#x9762;&#x7A0B;&#x63A7;&#x5236;&#x53F0;&#x8F93;&#x51FA;&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6BCF;&#x6B21;&#x5730;&#x5740;&#x90FD;&#x6709;&#x53D8;&#x5316;&#xFF0C;&#x6240;&#x4EE5;&#x8BF4; string &#x548C; []byte &#x7684;&#x76F8;&#x4E92;&#x8F6C;&#x6362;&#x662F;&#x6709;&#x5185;&#x5B58;&#x5F00;&#x9500;&#x7684;&#xFF0C;&#x4E0D;&#x8FC7;&#x5BF9;&#x4E8E;&#x73B0;&#x5728;&#x7684;&#x673A;&#x5668;&#x6765;&#x8BF4;&#xFF0C;&#x8FD9;&#x70B9;&#x5F00;&#x9500;&#x4E5F;&#x4E0D;&#x7B97;&#x4EC0;&#x4E48;&#x3002;</p>
<p>&#x6700;&#x540E;&#xFF0C;&#x8FD9;&#x662F;&#x6211;&#x5B66;&#x4E60; Go &#x7684; slice &#x7684;&#x4E00;&#x4E9B;&#x7406;&#x89E3;&#x4E0E;&#x603B;&#x7ED3;&#xFF0C;&#x7531;&#x4E8E;&#x80FD;&#x529B;&#x6709;&#x9650;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x7406;&#x89E3;&#x4E0D;&#x5230;&#x4F4D;&#x7684;&#x5730;&#x65B9;&#xFF0C;&#x53EF;&#x4EE5;&#x968F;&#x65F6;&#x7559;&#x8A00;&#x4E0E;&#x6211;&#x4EA4;&#x6D41;&#x3002;</p>
<blockquote>
<p>&#x53C2;&#x8003;:</p>
<ul>
<li>1&#x3001; <strong><a href="/external_links/50e3fe1c5c9817c4b91a794e962820ad.html" target="blank" rel="noopener">build-web-application-with-golang</a></strong></li>
<li>2&#x3001;<strong><a href="/external_links/9ada988b350746ad2ae5eb10664f71ce.html" target="blank" rel="noopener">go</a></strong></li>
</ul>
</blockquote>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/aa37434d2040008d91cb238d7c18d5a2.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903526884179982.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903526884179982.html" itemprop="url">源码 批量执行invokeAll()&&多选一invokeA</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-14T09:18:33+08:00">
                2017-12-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ExecutorService&#x4E2D;&#x5B9A;&#x4E49;&#x4E86;&#x4E24;&#x4E2A;&#x6279;&#x91CF;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;invokeAll()&#x548C;invokeAny()&#xFF0C;&#x5728;&#x6279;&#x91CF;&#x6267;&#x884C;&#x6216;&#x591A;&#x9009;&#x4E00;&#x7684;&#x4E1A;&#x52A1;&#x573A;&#x666F;&#x4E2D;&#x975E;&#x5E38;&#x65B9;&#x4FBF;&#x3002;invokeAll()&#x5728;&#x6240;&#x6709;&#x4EFB;&#x52A1;&#x90FD;&#x5B8C;&#x6210;&#xFF08;&#x5305;&#x62EC;&#x6210;&#x529F;/&#x88AB;&#x4E2D;&#x65AD;/&#x8D85;&#x65F6;&#xFF09;&#x540E;&#x624D;&#x4F1A;&#x8FD4;&#x56DE;&#xFF0C;invokeAny()&#x5728;&#x4EFB;&#x610F;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#x6210;&#x529F;&#xFF08;&#x6216;ExecutorService&#x88AB;&#x4E2D;&#x65AD;/&#x8D85;&#x65F6;&#xFF09;&#x540E;&#x5C31;&#x4F1A;&#x8FD4;&#x56DE;&#x3002;</p>
<p>AbstractExecutorService&#x5B9E;&#x73B0;&#x4E86;&#x8FD9;&#x4E24;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x672C;&#x6587;&#x5C06;&#x5148;&#x540E;&#x5206;&#x6790;invokeAll()&#x548C;invokeAny()&#x4E24;&#x4E2A;&#x65B9;&#x6CD5;&#x7684;&#x6E90;&#x7801;&#x5B9E;&#x73B0;&#x3002;</p>
<blockquote>
<p>JDK&#x7248;&#x672C;&#xFF1A;oracle java 1.8.0_102</p>
</blockquote>
<h1 id="invokeAll"><a href="#invokeAll" class="headerlink" title="invokeAll()"></a>invokeAll()</h1><p>invokeAll()&#x5728;&#x6240;&#x6709;&#x4EFB;&#x52A1;&#x90FD;&#x5B8C;&#x6210;&#xFF08;&#x5305;&#x62EC;&#x6210;&#x529F;/&#x88AB;&#x4E2D;&#x65AD;/&#x8D85;&#x65F6;&#xFF09;&#x540E;&#x624D;&#x4F1A;&#x8FD4;&#x56DE;&#x3002;&#x6709;&#x4E0D;&#x9650;&#x65F6;&#x548C;&#x9650;&#x65F6;&#x7248;&#x672C;&#xFF0C;&#x4ECE;&#x66F4;&#x7B80;&#x5355;&#x7684;&#x4E0D;&#x9650;&#x65F6;&#x7248;&#x5165;&#x624B;&#x3002;</p>
<h2 id="&#x4E0D;&#x9650;&#x65F6;&#x7248;"><a href="#&#x4E0D;&#x9650;&#x65F6;&#x7248;" class="headerlink" title="&#x4E0D;&#x9650;&#x65F6;&#x7248;"></a>&#x4E0D;&#x9650;&#x65F6;&#x7248;</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public &lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)</span><br><span class="line">    throws InterruptedException {</span><br><span class="line">    if (tasks == null)</span><br><span class="line">        throw new NullPointerException();</span><br><span class="line">    ArrayList&lt;Future&lt;T&gt;&gt; futures = new ArrayList&lt;Future&lt;T&gt;&gt;(tasks.size());</span><br><span class="line">    boolean done = false;</span><br><span class="line">    try {</span><br><span class="line">        for (Callable&lt;T&gt; t : tasks) {</span><br><span class="line">            RunnableFuture&lt;T&gt; f = newTaskFor(t);</span><br><span class="line">            futures.add(f);</span><br><span class="line">            execute(f);</span><br><span class="line">        }</span><br><span class="line">        for (int i = 0, size = futures.size(); i &lt; size; i++) {</span><br><span class="line">            Future&lt;T&gt; f = futures.get(i);</span><br><span class="line">            if (!f.isDone()) {</span><br><span class="line">                try {</span><br><span class="line">                    f.get(); // &#x65E0;&#x6240;&#x8C13;&#x5148;&#x6267;&#x884C;&#x54EA;&#x4E2A;&#x4EFB;&#x52A1;&#x7684;get()&#x65B9;&#x6CD5;</span><br><span class="line">                } catch (CancellationException ignore) {</span><br><span class="line">                } catch (ExecutionException ignore) {</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        done = true;</span><br><span class="line">        return futures;</span><br><span class="line">    } finally {</span><br><span class="line">        if (!done)</span><br><span class="line">            for (int i = 0, size = futures.size(); i &lt; size; i++)</span><br><span class="line">                futures.get(i).cancel(true);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>8-12&#x884C;&#xFF0C;&#x5148;&#x5C06;&#x6240;&#x6709;&#x4EFB;&#x52A1;&#x90FD;&#x63D0;&#x4EA4;&#x5230;&#x7EBF;&#x7A0B;&#x6C60;&#xFF08;&#x5F53;&#x7136;&#xFF0C;&#x4EFB;&#x4F55;ExecutorService&#x5747;&#x53EF;&#xFF09;&#x4E2D;&#x3002;</p>
<blockquote>
<p>&#x4E25;&#x683C;&#x6765;&#x8BF4;&#xFF0C;&#x4E0D;&#x662F;&#x201C;&#x63D0;&#x4EA4;&#x201D;&#xFF0C;&#x800C;&#x662F;&#x201C;&#x6267;&#x884C;&#x201D;&#x3002;&#x6267;&#x884C;&#x53EF;&#x80FD;&#x662F;&#x540C;&#x6B65;&#x6216;&#x5F02;&#x6B65;&#x7684;&#xFF0C;&#x53D6;&#x51B3;&#x4E8E;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x7B56;&#x7565;&#x3002;&#x4E0D;&#x8FC7;&#x7531;&#x4E8E;&#x6211;&#x4EEC;&#x4EC5;&#x8BA8;&#x8BBA;&#x5F02;&#x6B65;&#x60C5;&#x51B5;&#xFF08;&#x540C;&#x6B65;&#x540C;&#x7406;&#xFF09;&#xFF0C;&#x7528;&#x201C;&#x63D0;&#x4EA4;&#x201D;&#x4E00;&#x8BCD;&#x66F4;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#x3002;&#x4E0B;&#x540C;&#x3002;</p>
</blockquote>
<p>13-22&#x884C;&#xFF0C;for&#x5FAA;&#x73AF;&#x7684;&#x76EE;&#x7684;&#x662F;&#x963B;&#x585E;&#x8C03;&#x7528;invokeAll&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x76F4;&#x5230;&#x6240;&#x6709;&#x4EFB;&#x52A1;&#x90FD;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#x3002;&#x5F53;&#x7136;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5176;&#x4ED6;&#x65B9;&#x5F0F;&#x5B9E;&#x73B0;&#x963B;&#x585E;&#xFF0C;&#x4E0D;&#x8FC7;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x662F;&#x6700;&#x7B80;&#x5355;&#x7684;&#xFF1A;</p>
<ul>
<li>15&#x884C;&#x5982;&#x679C;f.isDone()&#x8FD4;&#x56DE;true&#xFF0C;&#x5219;&#x5F53;&#x524D;&#x4EFB;&#x52A1;&#x5DF2;&#x7ED3;&#x675F;&#xFF0C;&#x7EE7;&#x7EED;&#x68C0;&#x67E5;&#x4E0B;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#xFF1B;&#x5426;&#x5219;&#xFF0C;&#x8C03;&#x7528;f.get()&#x8BA9;&#x7EBF;&#x7A0B;&#x963B;&#x585E;&#xFF0C;&#x76F4;&#x5230;&#x5F53;&#x524D;&#x4EFB;&#x52A1;&#x7ED3;&#x675F;&#x3002;</li>
<li>17&#x884C;<strong>&#x65E0;&#x6240;&#x8C13;&#x5148;&#x6267;&#x884C;&#x54EA;&#x4E00;&#x4E2A;FutureTask&#x5B9E;&#x4F8B;&#x7684;get()&#x65B9;&#x6CD5;</strong>&#x3002;&#x7531;&#x4E8E;&#x6240;&#x6709;&#x4EFB;&#x52A1;&#x5E76;&#x53D1;&#x6267;&#x884C;&#xFF0C;&#x603B;&#x4F53;&#x963B;&#x585E;&#x65F6;&#x95F4;&#x53D6;&#x51B3;&#x4E8E;&#x4E8E;&#x662F;&#x8017;&#x65F6;&#x6700;&#x957F;&#x7684;&#x4EFB;&#x52A1;&#xFF0C;&#x4ECE;&#x800C;&#x5B9E;&#x73B0;&#x4E86;invodeAll&#x7684;&#x963B;&#x585E;&#x8C03;&#x7528;&#x3002;</li>
<li>18-20&#x884C;&#x6CA1;&#x6709;&#x6355;&#x83B7;InterruptedException&#x3002;&#x5982;&#x679C;&#x6709;&#x4EFB;&#x52A1;&#x88AB;&#x4E2D;&#x65AD;&#xFF0C;&#x4E3B;&#x7EBF;&#x7A0B;&#x5C06;&#x629B;&#x51FA;InterruptedException&#xFF0C;&#x4EE5;&#x54CD;&#x5E94;&#x4E2D;&#x65AD;&#x3002;</li>
</ul>
<p>&#x6700;&#x540E;&#xFF0C;&#x4E3A;&#x9632;&#x6B62;&#x5728;&#x5168;&#x90E8;&#x4EFB;&#x52A1;&#x7ED3;&#x675F;&#x4E4B;&#x524D;&#x8FC7;&#x65E9;&#x9000;&#x51FA;&#xFF0C;23&#x884C;&#x3001;25-29&#x884C;&#x76F8;&#x914D;&#x5408;&#xFF0C;&#x5982;&#x679C;done&#x4E0D;&#x4E3A;true&#xFF08;&#x672A;&#x6267;&#x884C;&#x5230;40&#x884C;&#x5C31;&#x9000;&#x51FA;&#x4E86;&#xFF09;&#x5219;&#x53D6;&#x6D88;&#x5168;&#x90E8;&#x4EFB;&#x52A1;&#x3002;</p>
<h2 id="&#x9650;&#x65F6;&#x7248;"><a href="#&#x9650;&#x65F6;&#x7248;" class="headerlink" title="&#x9650;&#x65F6;&#x7248;"></a>&#x9650;&#x65F6;&#x7248;</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public &lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks,</span><br><span class="line">                                     long timeout, TimeUnit unit)</span><br><span class="line">    throws InterruptedException {</span><br><span class="line">    if (tasks == null)</span><br><span class="line">        throw new NullPointerException();</span><br><span class="line">    long nanos = unit.toNanos(timeout);</span><br><span class="line">    ArrayList&lt;Future&lt;T&gt;&gt; futures = new ArrayList&lt;Future&lt;T&gt;&gt;(tasks.size());</span><br><span class="line">    boolean done = false;</span><br><span class="line">    try {</span><br><span class="line">        for (Callable&lt;T&gt; t : tasks)</span><br><span class="line">            futures.add(newTaskFor(t));</span><br><span class="line"></span><br><span class="line">        final long deadline = System.nanoTime() + nanos;</span><br><span class="line">        final int size = futures.size();</span><br><span class="line"></span><br><span class="line">        // Interleave time checks and calls to execute in case</span><br><span class="line">        // executor doesn&apos;t have any/much parallelism.</span><br><span class="line">        for (int i = 0; i &lt; size; i++) {</span><br><span class="line">            execute((Runnable)futures.get(i));</span><br><span class="line">            nanos = deadline - System.nanoTime();</span><br><span class="line">            if (nanos &lt;= 0L) // &#x53CA;&#x65F6;&#x68C0;&#x67E5;&#x662F;&#x5426;&#x8D85;&#x65F6;</span><br><span class="line">                return futures;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        for (int i = 0; i &lt; size; i++) {</span><br><span class="line">            Future&lt;T&gt; f = futures.get(i);</span><br><span class="line">            if (!f.isDone()) {</span><br><span class="line">                if (nanos &lt;= 0L) // &#x53CA;&#x65F6;&#x68C0;&#x67E5;&#x662F;&#x5426;&#x8D85;&#x65F6;</span><br><span class="line">                    return futures;</span><br><span class="line">                try {</span><br><span class="line">                    f.get(nanos, TimeUnit.NANOSECONDS);</span><br><span class="line">                } catch (CancellationException ignore) {</span><br><span class="line">                } catch (ExecutionException ignore) {</span><br><span class="line">                } catch (TimeoutException toe) {</span><br><span class="line">                    return futures;</span><br><span class="line">                }</span><br><span class="line">                nanos = deadline - System.nanoTime();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        done = true;</span><br><span class="line">        return futures;</span><br><span class="line">    } finally {</span><br><span class="line">        if (!done)</span><br><span class="line">            for (int i = 0, size = futures.size(); i &lt; size; i++)</span><br><span class="line">                futures.get(i).cancel(true);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>10-11&#x884C;&#xFF0C;&#x5148;&#x5C06;&#x6240;&#x6709;&#x4EFB;&#x52A1;&#x5C01;&#x88C5;&#x4E3A;FutureTask&#xFF0C;&#x6DFB;&#x52A0;&#x5230;futures&#x5217;&#x8868;&#x4E2D;&#x3002;</p>
<p>18-23&#x884C;&#xFF0C;&#x6BCF;&#x63D0;&#x4EA4;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#xFF0C;&#x5C31;&#x7ACB;&#x523B;&#x5224;&#x65AD;&#x662F;&#x5426;&#x8D85;&#x65F6;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x5982;&#x679C;&#x5728;&#x4EFB;&#x52A1;&#x5168;&#x90E8;&#x63D0;&#x4EA4;&#x5230;&#x7EBF;&#x7A0B;&#x6C60;&#x4E2D;&#x4E4B;&#x524D;&#xFF0C;&#x5C31;&#x5DF2;&#x7ECF;&#x8FBE;&#x5230;&#x4E86;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#xFF0C;&#x5219;&#x80FD;&#x591F;&#x5C3D;&#x5FEB;&#x68C0;&#x67E5;&#x51FA;&#x8D85;&#x65F6;&#xFF0C;&#x7ED3;&#x675F;&#x63D0;&#x4EA4;&#x5E76;&#x9000;&#x51FA;&#x3002;</p>
<blockquote>
<p>&#x5BF9;&#x4E8E;&#x9650;&#x65F6;&#x7248;&#xFF0C;&#x5C06;&#x5C01;&#x88C5;&#x4EFB;&#x52A1;&#x4E0E;&#x63D0;&#x4EA4;&#x4EFB;&#x52A1;&#x62C6;&#x5F00;&#x662F;&#x5FC5;&#x8981;&#x7684;&#x3002;</p>
</blockquote>
<p>28-29&#x884C;&#xFF0C;&#x6BCF;&#x6B21;&#x5728;&#x8C03;&#x7528;&#x9650;&#x65F6;&#x7248;f.get()&#x8FDB;&#x5165;&#x963B;&#x585E;&#x72B6;&#x6001;&#x4E4B;&#x524D;&#xFF0C;&#x5148;&#x68C0;&#x67E5;&#x662F;&#x5426;&#x8D85;&#x65F6;&#x3002;&#x8FD9;&#x91CC;&#x4E5F;&#x662F;&#x5E0C;&#x671B;&#x8D85;&#x65F6;&#x540E;&#xFF0C;&#x80FD;&#x591F;&#x5C3D;&#x5FEB;&#x53D1;&#x73B0;&#x5E76;&#x9000;&#x51FA;&#x3002;</p>
<p>&#x5176;&#x4ED6;&#x540C;&#x4E0D;&#x9650;&#x65F6;&#x7248;&#x3002;</p>
<h1 id="invokeAny"><a href="#invokeAny" class="headerlink" title="invokeAny()"></a>invokeAny()</h1><p>invokeAny()&#x5728;&#x4EFB;&#x610F;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#x6210;&#x529F;&#xFF08;&#x6216;ExecutorService&#x88AB;&#x4E2D;&#x65AD;/&#x8D85;&#x65F6;&#xFF09;&#x540E;&#x5C31;&#x4F1A;&#x8FD4;&#x56DE;&#x3002;&#x4E5F;&#x5206;&#x4E3A;&#x4E0D;&#x9650;&#x65F6;&#x548C;&#x9650;&#x65F6;&#x7248;&#x672C;&#xFF0C;&#x4F46;&#x4E3A;&#x4E86;&#x8FDB;&#x4E00;&#x6B65;&#x4FDD;&#x969C;&#x6027;&#x80FD;&#xFF0C;invokeAny()&#x7684;&#x5B9E;&#x73B0;&#x601D;&#x8DEF;&#x4E0E;invokeAll()&#x7565;&#x6709;&#x4E0D;&#x540C;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public &lt;T&gt; T invokeAny(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)</span><br><span class="line">    throws InterruptedException, ExecutionException {</span><br><span class="line">    try {</span><br><span class="line">        return doInvokeAny(tasks, false, 0);</span><br><span class="line">    } catch (TimeoutException cannotHappen) {</span><br><span class="line">        assert false;</span><br><span class="line">        return null;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line">public &lt;T&gt; T invokeAny(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks,</span><br><span class="line">                       long timeout, TimeUnit unit)</span><br><span class="line">    throws InterruptedException, ExecutionException, TimeoutException {</span><br><span class="line">    return doInvokeAny(tasks, true, unit.toNanos(timeout));</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5185;&#x90E8;&#x8C03;&#x7528;&#x4E86;doInvokeAny()&#x3002;</p>
<blockquote>
<p>&#x5B66;&#x4E60;5-8&#x884C;&#x7684;&#x5199;&#x6CD5;&#xFF0C;&#x4EE3;&#x7801;&#x81EA;&#x89E3;&#x91CA;&#x3002;</p>
</blockquote>
<h2 id="doInvokeAny"><a href="#doInvokeAny" class="headerlink" title="doInvokeAny()"></a>doInvokeAny()</h2><p>&#x7B80;&#x5316;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;private &lt;T&gt; T doInvokeAny(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks,</span><br><span class="line">                          boolean timed, long nanos)</span><br><span class="line">    throws InterruptedException, ExecutionException, TimeoutException {</span><br><span class="line">...</span><br><span class="line">    ArrayList&lt;Future&lt;T&gt;&gt; futures = new ArrayList&lt;Future&lt;T&gt;&gt;(ntasks);</span><br><span class="line">    ExecutorCompletionService&lt;T&gt; ecs =</span><br><span class="line">        new ExecutorCompletionService&lt;T&gt;(this);</span><br><span class="line">...</span><br><span class="line">    try {</span><br><span class="line">        ExecutionException ee = null;</span><br><span class="line">        final long deadline = timed ? System.nanoTime() + nanos : 0L;</span><br><span class="line">        Iterator&lt;? extends Callable&lt;T&gt;&gt; it = tasks.iterator();</span><br><span class="line"></span><br><span class="line">        futures.add(ecs.submit(it.next()));</span><br><span class="line">        --ntasks;</span><br><span class="line">        int active = 1;</span><br><span class="line"></span><br><span class="line">        for (;;) {</span><br><span class="line">            Future&lt;T&gt; f = ecs.poll();</span><br><span class="line">            if (f == null) {</span><br><span class="line">                if (ntasks &gt; 0) {</span><br><span class="line">                    --ntasks;</span><br><span class="line">                    futures.add(ecs.submit(it.next()));</span><br><span class="line">                    ++active;</span><br><span class="line">                }</span><br><span class="line">                else if (active == 0)</span><br><span class="line">                    break;</span><br><span class="line">                else if (timed) {</span><br><span class="line">                    f = ecs.poll(nanos, TimeUnit.NANOSECONDS);</span><br><span class="line">                    if (f == null)</span><br><span class="line">                        throw new TimeoutException();</span><br><span class="line">                    nanos = deadline - System.nanoTime();</span><br><span class="line">                }</span><br><span class="line">                else</span><br><span class="line">                    f = ecs.take();</span><br><span class="line">            }</span><br><span class="line">            if (f != null) {</span><br><span class="line">                --active;</span><br><span class="line">                try {</span><br><span class="line">                    return f.get();</span><br><span class="line">                } catch (...) {</span><br><span class="line">                    ee = ...;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">...</span><br><span class="line">        throw ee;</span><br><span class="line">    } finally {</span><br><span class="line">        for (int i = 0, size = futures.size(); i &lt; size; i++)</span><br><span class="line">            futures.get(i).cancel(true);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8981;&#x70B9;&#xFF1A;</p>
<ul>
<li>ntasks&#x7EF4;&#x62A4;&#x672A;&#x63D0;&#x4EA4;&#x7684;&#x4EFB;&#x52A1;&#x6570;&#xFF0C;active&#x7EF4;&#x62A4;&#x5DF2;&#x63D0;&#x4EA4;&#x672A;&#x7ED3;&#x675F;&#x7684;&#x4EFB;&#x52A1;&#x6570;&#x3002;</li>
<li>&#x5185;&#x90E8;&#x4F7F;&#x7528;<strong>ExecutorCompletionService</strong>&#x7EF4;&#x62A4;&#x5DF2;&#x5B8C;&#x6210;&#x7684;&#x4EFB;&#x52A1;&#x3002;</li>
<li>&#x5982;&#x679C;&#x6CA1;&#x6709;&#x4EFB;&#x52A1;&#x6210;&#x529F;&#x7ED3;&#x675F;&#xFF0C;&#x5219;&#x8FD4;&#x56DE;&#x6355;&#x83B7;&#x7684;<strong>&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x5F02;&#x5E38;</strong>&#x3002;</li>
<li>&#x7B2C;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#x662F;&#x5FC5;&#x5C06;&#x88AB;&#x6267;&#x884C;&#x7684;&#xFF0C;&#x5176;&#x4ED6;&#x4EFB;&#x52A1;&#x6309;&#x7167;&#x8FED;&#x4EE3;&#x5668;&#x987A;&#x5E8F;<strong>&#x589E;&#x91CF;&#x63D0;&#x4EA4;</strong>&#x3002;</li>
</ul>
<p>&#x589E;&#x91CF;&#x63D0;&#x4EA4;&#x6709;&#x4EC0;&#x4E48;&#x597D;&#x5904;&#x5462;&#xFF1F;<strong>&#x8282;&#x7701;&#x8D44;&#x6E90;</strong>&#xFF0C;&#x5982;&#x679C;&#x5728;&#x63D0;&#x4EA4;&#x8FC7;&#x7A0B;&#x4E2D;&#x5C31;&#x6709;&#x4EFB;&#x52A1;&#x5B8C;&#x6210;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x6CA1;&#x5FC5;&#x8981;&#x7EE7;&#x7EED;&#x63D0;&#x4EA4;&#x4EFB;&#x52A1;&#x8017;&#x8D39;&#x65F6;&#x95F4;&#x548C;&#x7A7A;&#x95F4;&#xFF1B;<strong>&#x964D;&#x4F4E;&#x5EF6;&#x8FDF;</strong>&#xFF0C;&#x5982;&#x679C;&#x6709;&#x4EFB;&#x52A1;&#x5B8C;&#x6210;&#xFF0C;&#x4E0E;&#x5168;&#x91CF;&#x63D0;&#x4EA4;&#x76F8;&#x6BD4;&#xFF0C;&#x80FD;&#x66F4;&#x65E9;&#x88AB;&#x53D1;&#x73B0;&#x3002;</p>
<p>14&#x884C;&#x5148;&#x5411;&#x7EBF;&#x7A0B;&#x6C60;&#x63D0;&#x4EA4;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#xFF08;&#x8FED;&#x4EE3;&#x5668;&#x7B2C;&#x4E00;&#x4E2A;&#xFF09;&#xFF0C;ntasks&#x2013;&#xFF0C;active=1&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;futures.add(ecs.submit(it.next()));</span><br><span class="line">--ntasks;</span><br><span class="line">int active = 1;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&#x8FD9;&#x91CC;&#x662F;&#x771F;&#x201C;&#x63D0;&#x4EA4;&#x201D;&#x4E86;&#xFF0C;&#x4E0D;&#x662F;&#x201C;&#x6267;&#x884C;&#x201D;&#x3002;</p>
</blockquote>
<p>&#x7136;&#x540E;18-45&#x884C;&#x5FAA;&#x73AF;&#x68C0;&#x67E5;&#x662F;&#x5426;&#x6709;&#x4EFB;&#x52A1;&#x6210;&#x529F;&#x7ED3;&#x675F;&#x3002;</p>
<p>&#x9996;&#x5148;&#xFF0C;19&#x884C;&#x901A;&#x8FC7;&#x53CA;&#x65F6;&#x8FD4;&#x56DE;&#x7684;poll()&#x65B9;&#x6CD5;&#xFF0C;&#x5C1D;&#x8BD5;&#x53D6;&#x51FA;&#x4E00;&#x4E2A;&#x5DF2;&#x5B8C;&#x6210;&#x7684;&#x4EFB;&#x52A1;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;Future&lt;T&gt; f = ecs.poll();</span><br></pre></td></tr></table></figure>

<p>&#x6839;&#x636E;f&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x5206;&#x6210;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#x8BA8;&#x8BBA;&#x3002;</p>
<blockquote>
<p>ExecutorCompletionService&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;LinkedBlockingQueue&#x4F5C;&#x4E3A;&#x4EFB;&#x52A1;&#x961F;&#x5217;&#x3002;&#x5BF9;LinkedBlockingQueue&#x4E0D;&#x719F;&#x6089;&#x7684;&#x53EF;&#x53C2;&#x7167;<a href="/external_links/0f354d5435a8d87b6641a16afe348381.html" target="blank" rel="noopener">&#x6E90;&#x7801;|&#x5E76;&#x53D1;&#x4E00;&#x679D;&#x82B1;&#x4E4B;BlockingQueue</a>&#x3002;</p>
</blockquote>
<h3 id="case1&#xFF1A;&#x5982;&#x679C;&#x6709;&#x4EFB;&#x52A1;&#x5B8C;&#x6210;"><a href="#case1&#xFF1A;&#x5982;&#x679C;&#x6709;&#x4EFB;&#x52A1;&#x5B8C;&#x6210;" class="headerlink" title="case1&#xFF1A;&#x5982;&#x679C;&#x6709;&#x4EFB;&#x52A1;&#x5B8C;&#x6210;"></a>case1&#xFF1A;&#x5982;&#x679C;&#x6709;&#x4EFB;&#x52A1;&#x5B8C;&#x6210;</h3><p>&#x5982;&#x679C;&#x6709;&#x4EFB;&#x52A1;&#x5B8C;&#x6210;&#xFF0C;&#x5219;f&#x4E0D;&#x4E3A;null&#xFF0C;&#x8FDB;&#x5165;40-49&#x884C;&#xFF0C;active&#x2013;&#xFF0C;&#x5E76;&#x5C1D;&#x8BD5;&#x53D6;&#x51FA;&#x4EFB;&#x52A1;&#x7ED3;&#x679C;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;if (f != null) {</span><br><span class="line">    --active;</span><br><span class="line">    try {</span><br><span class="line">        return f.get();</span><br><span class="line">    } catch (...) {</span><br><span class="line">        ee = ...;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<ul>
<li>&#x5982;&#x679C;&#x80FD;&#x591F;&#x6210;&#x529F;&#x53D6;&#x51FA;&#xFF0C;&#x5373;&#x5F53;&#x524D;&#x4EFB;&#x52A1;&#x5DF2;&#x6210;&#x529F;&#x7ED3;&#x675F;&#xFF0C;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x3002;</li>
<li>&#x5982;&#x679C;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#xFF0C;&#x5219;&#x5F53;&#x524D;&#x4EFB;&#x52A1;&#x5F02;&#x5E38;&#x7ED3;&#x675F;&#xFF0C;&#x4F7F;&#x7528;ee&#x8BB0;&#x5F55;&#x5F02;&#x5E38;&#x3002;</li>
</ul>
<p>&#x663E;&#x7136;&#xFF0C;&#x5982;&#x679C;&#x5DF2;&#x5B8C;&#x6210;&#x7684;&#x4EFB;&#x52A1;&#x662F;&#x5F02;&#x5E38;&#x7ED3;&#x675F;&#x7684;&#xFF0C;invokeAny()&#x4E0D;&#x4F1A;&#x9000;&#x51FA;&#xFF0C;&#x800C;&#x662F;&#x7EE7;&#x7EED;&#x67E5;&#x770B;&#x5176;&#x5B83;&#x4EFB;&#x52A1;&#x3002;</p>
<blockquote>
<p>FutureTask#get()&#x7684;&#x7528;&#x6CD5;&#x53C2;&#x7167;<a href="/external_links/a6bf130984ae364831ad59ec9b191f6f.html" target="blank" rel="noopener">&#x6E90;&#x7801;|&#x4F7F;&#x7528;FutureTask&#x7684;&#x6B63;&#x786E;&#x59FF;&#x52BF;</a>&#x3002;</p>
</blockquote>
<h3 id="case2&#xFF1A;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x4EFB;&#x52A1;&#x5B8C;&#x6210;"><a href="#case2&#xFF1A;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x4EFB;&#x52A1;&#x5B8C;&#x6210;" class="headerlink" title="case2&#xFF1A;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x4EFB;&#x52A1;&#x5B8C;&#x6210;"></a>case2&#xFF1A;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x4EFB;&#x52A1;&#x5B8C;&#x6210;</h3><p>&#x5982;&#x679C;&#x6CA1;&#x6709;&#x4EFB;&#x52A1;&#x5B8C;&#x6210;&#xFF0C;&#x5219;f&#x4E3A;null&#xFF0C;&#x8FDB;&#x5165;23-39&#x884C;&#xFF0C;&#x5224;&#x65AD;&#x662F;&#x7EE7;&#x7EED;&#x63D0;&#x4EA4;&#x4EFB;&#x52A1;&#x3001;&#x9000;&#x51FA;&#x8FD8;&#x662F;&#x7B49;&#x5F85;&#x4EFB;&#x52A1;&#x7ED3;&#x679C;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;if (f == null) {</span><br><span class="line">    if (ntasks &gt; 0) { // check1</span><br><span class="line">        --ntasks;</span><br><span class="line">        futures.add(ecs.submit(it.next()));</span><br><span class="line">        ++active;</span><br><span class="line">    }</span><br><span class="line">    else if (active == 0) // check2</span><br><span class="line">        break;</span><br><span class="line">    else if (timed) { // check3</span><br><span class="line">        f = ecs.poll(nanos, TimeUnit.NANOSECONDS);</span><br><span class="line">        if (f == null)</span><br><span class="line">            throw new TimeoutException();</span><br><span class="line">        nanos = deadline - System.nanoTime();</span><br><span class="line">    }</span><br><span class="line">    else // check4</span><br><span class="line">        f = ecs.take();</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<ul>
<li>check1&#xFF1A;&#x5982;&#x679C;&#x8FD8;&#x6709;&#x5269;&#x4F59;&#x4EFB;&#x52A1;&#xFF08;ntasks &gt; 0&#xFF09;&#xFF0C;&#x90A3;&#x5C31;&#x7EE7;&#x7EED;&#x63D0;&#x4EA4;&#xFF0C;&#x540C;&#x65F6;ntasks&#x2013;&#xFF0C;active++&#x3002;</li>
<li>check2&#xFF1A;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x5269;&#x4F59;&#x4EFB;&#x52A1;&#x4E86;&#xFF0C;&#x4E14;&#x4E5F;&#x6CA1;&#x6709;&#x5DF2;&#x63D0;&#x4EA4;&#x672A;&#x7ED3;&#x675F;&#x7684;&#x4EFB;&#x52A1;&#xFF08;active == 0&#xFF09;&#xFF0C;&#x5219;&#x8868;&#x793A;&#x5168;&#x90E8;&#x4EFB;&#x52A1;&#x5747;&#x5DF2;&#x6267;&#x884C;&#x7ED3;&#x675F;&#xFF0C;&#x4F46;&#x6CA1;&#x6709;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#x662F;&#x6210;&#x529F;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x9000;&#x51FA;&#x5FAA;&#x73AF;&#x3002;&#x9000;&#x51FA;&#x5FAA;&#x73AF;&#x540E;&#xFF0C;&#x5C06;&#x5728;47&#x884C;&#x629B;&#x51FA;ee&#x8BB0;&#x5F55;&#x7684;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x5F02;&#x5E38;&#x3002;</li>
<li>check3&#xFF1A;&#x5982;&#x679C;&#x53EF;&#x4EE5;&#x6CA1;&#x6709;&#x5269;&#x4F59;&#x4EFB;&#x52A1;&#xFF0C;&#x4F46;&#x8FD8;&#x6709;&#x5DF2;&#x63D0;&#x4EA4;&#x672A;&#x7ED3;&#x675F;&#x7684;&#x4EFB;&#x52A1;&#xFF0C;&#x4E14;&#x5F00;&#x542F;&#x4E86;&#x8D85;&#x65F6;&#x673A;&#x5236;&#xFF0C;&#x5219;&#x5C1D;&#x8BD5;&#x4F7F;&#x7528;&#x8D85;&#x65F6;&#x7248;poll()&#x7B49;&#x5F85;&#x4EFB;&#x52A1;&#x5B8C;&#x6210;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#x8D85;&#x65F6;&#x4E86;&#xFF0C;&#x5C31;&#x8868;&#x793A;&#x6574;&#x4E2A;invokeAny()&#x65B9;&#x6CD5;&#x8D85;&#x65F6;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;poll()&#x8FD4;&#x56DE;null&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8981;&#x4E3B;&#x52A8;&#x629B;&#x51FA;TimeoutException&#x3002;</li>
<li>check4&#xFF1A;&#x5982;&#x679C;&#x53EF;&#x4EE5;&#x6CA1;&#x6709;&#x5269;&#x4F59;&#x4EFB;&#x52A1;&#xFF0C;&#x4F46;&#x8FD8;&#x6709;&#x5DF2;&#x63D0;&#x4EA4;&#x672A;&#x7ED3;&#x675F;&#x7684;&#x4EFB;&#x52A1;&#xFF0C;&#x4E14;&#x672A;&#x5F00;&#x542F;&#x8D85;&#x65F6;&#x673A;&#x5236;&#xFF0C;&#x5219;&#x4F7F;&#x7528;&#x65E0;&#x9650;&#x963B;&#x585E;&#x7684;take()&#x65B9;&#x6CD5;&#xFF0C;&#x7B49;&#x5F85;&#x4EFB;&#x52A1;&#x5B8C;&#x6210;&#x3002;</li>
</ul>
<blockquote>
<p>&#x8FD9;&#x79CD;&#x4E00;&#x5806;if-else&#x7684;&#x4EE3;&#x7801;&#x5F88;&#x4E11;&#x3002;&#x53EF;&#x4FEE;&#x6539;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&gt; &#x590D;&#x5236;&#x4EE3;&#x7801;if (f == null) { // check1</span><br><span class="line">&gt;    if (ntasks &gt; 0) {</span><br><span class="line">&gt;         --ntasks;</span><br><span class="line">&gt;         futures.add(ecs.submit(it.next()));</span><br><span class="line">&gt;         ++active;</span><br><span class="line">&gt;         continue;</span><br><span class="line">&gt;     }</span><br><span class="line">&gt;     if (active == 0) { // check2</span><br><span class="line">&gt;         assert ntasks == 0; // &#x9632;&#x6B62;&#x81EA;&#x5DF1;&#x6539;&#x5427;&#x6539;&#x5427;&#x628A;&#x5B83;&#x8FD9;&#x53E5;&#x5224;&#x65AD;&#x632A;&#x5230;&#x4E86;&#x524D;&#x9762;</span><br><span class="line">&gt;         break;</span><br><span class="line">&gt;     }</span><br><span class="line">&gt;    if (timed) { // check3</span><br><span class="line">&gt;        f = ecs.poll(nanos, TimeUnit.NANOSECONDS);</span><br><span class="line">&gt;        if (f == null) {</span><br><span class="line">&gt;            throw new TimeoutException();</span><br><span class="line">&gt;        }</span><br><span class="line">&gt;        nanos = deadline - System.nanoTime();</span><br><span class="line">&gt;    } else { // check4</span><br><span class="line">&gt;        f = ecs.take();</span><br><span class="line">&gt;    }</span><br><span class="line">&gt; }</span><br><span class="line">&gt; </span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>&#x4FEE;&#x6539;&#x4F9D;&#x636E;&#xFF1A;</p>
<ul>
<li>check1&#x3001;check2&#x3001;check3/check4&#x6CA1;&#x6709;&#x5E76;&#x5217;&#x7684;&#x5224;&#x65AD;&#x5173;&#x7CFB;</li>
<li>check3&#x3001;check4&#x6709;&#x5E76;&#x5217;&#x7684;&#x5224;&#x65AD;&#x5173;&#x7CFB;&#xFF0C;&#x975E;&#x6B64;&#x5373;&#x5F7C;</li>
<li>&#x7ED3;&#x6784;&#x66F4;&#x6E05;&#x723D;</li>
</ul>
</blockquote>
<h1 id="&#x603B;&#x7ED3;"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3;</h1><p>&#x4E0D;&#x4F1A;&#x5199;&#x603B;&#x7ED3;&#x3002;&#x3002;&#x3002;</p>
<blockquote>
<p>&#x4F46;&#x662F;&#x4F1A;&#x5199;&#x5410;&#x69FD;&#x554A;&#xFF01;&#xFF01;&#xFF01;</p>
<p>&#x7334;&#x5B50;&#x73B0;&#x5728;&#x6BCF;&#x6B21;&#x5199;&#x535A;&#x5BA2;&#x90FD;&#x7ECF;&#x5386;&#x7740;&#x4ECE;&#x201C;&#x5367;&#x69FD;&#x4F3C;&#x4E4E;&#x5F88;&#x7B80;&#x5355;&#x554A;&#xFF0C;&#x5199;&#x4E2A;&#x6BDB;&#x201D;&#x5230;&#x201C;&#x5367;&#x69FD;&#x8FD9;&#x8DDF;&#x60F3;&#x8C61;&#x7684;&#x4E0D;&#x4E00;&#x6837;&#x554A;&#xFF01;&#x5367;&#x69FD;&#x5DE8;&#x5E05;&#xFF01;&#x201D;&#x7684;&#x5FC3;&#x6001;&#x5D29;&#x584C;&#xFF0C;&#x5404;&#x4F4D;&#x5DE8;&#x5DE8;&#x5199;&#x7684;&#x4EE3;&#x7801;&#x662F;&#x771F;&#x597D;&#x770B;&#xFF0C;&#x6027;&#x80FD;&#x8FD8;&#x68D2;&#x68D2;&#x54D2;&#xFF0C;&#x7FA1;&#x6155;&#x5D07;&#x62DC;&#x6253;&#x9E21;&#x8840;&#x3002;&#x54CE;&#xFF0C;&#xFF0C;&#xFF0C;&#x4FDD;&#x6301;&#x8C26;&#x5351;&#xFF0C;&#x5E76;&#x7FA1;&#x6155;&#x8138;&#x9065;&#x62DC;&#x5404;&#x4F4D;&#x5DE8;&#x5DE8;&#x3002;</p>
</blockquote>
<hr>
<blockquote>
<p>&#x672C;&#x6587;&#x94FE;&#x63A5;&#xFF1A;<a href="/external_links/f11ee9f3286a6375302204c894030892.html" target="blank" rel="noopener">&#x6E90;&#x7801;|&#x6279;&#x91CF;&#x6267;&#x884C;invokeAll()&amp;&amp;&#x591A;&#x9009;&#x4E00;invokeAny()</a>  </p>
<p>&#x4F5C;&#x8005;&#xFF1A;<a href="mailto:monkeysayhi7@gmail.com" target="_blank" rel="noopener">&#x7334;&#x5B50;007</a>  </p>
<p>&#x51FA;&#x5904;&#xFF1A;<a href="/external_links/8bfa8dc3a9648d74d2788759ace24805.html" target="blank" rel="noopener">monkeysayhi.github.io</a>  </p>
<p>&#x672C;&#x6587;&#x57FA;&#x4E8E;<a href="/external_links/6f1da3ff281999354d4abd56d1551468.html" target="blank" rel="noopener">&#x77E5;&#x8BC6;&#x5171;&#x4EAB;&#x7F72;&#x540D;-&#x76F8;&#x540C;&#x65B9;&#x5F0F;&#x5171;&#x4EAB; 4.0</a>&#x56FD;&#x9645;&#x8BB8;&#x53EF;&#x534F;&#x8BAE;&#x53D1;&#x5E03;&#xFF0C;&#x6B22;&#x8FCE;&#x8F6C;&#x8F7D;&#xFF0C;&#x6F14;&#x7ECE;&#x6216;&#x7528;&#x4E8E;&#x5546;&#x4E1A;&#x76EE;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x5FC5;&#x987B;&#x4FDD;&#x7559;&#x672C;&#x6587;&#x7684;&#x7F72;&#x540D;&#x53CA;&#x94FE;&#x63A5;&#x3002;</p>
</blockquote>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/f44c3175f6af68effb57d265afdcd5d2.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903526460555272.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903526460555272.html" itemprop="url">怎么样去理解 Python 中的装饰器 怎么样去理解 Pyt</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-13T23:46:09+08:00">
                2017-12-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="&#x600E;&#x4E48;&#x6837;&#x53BB;&#x7406;&#x89E3;-Python-&#x4E2D;&#x7684;&#x88C5;&#x9970;&#x5668;"><a href="#&#x600E;&#x4E48;&#x6837;&#x53BB;&#x7406;&#x89E3;-Python-&#x4E2D;&#x7684;&#x88C5;&#x9970;&#x5668;" class="headerlink" title="&#x600E;&#x4E48;&#x6837;&#x53BB;&#x7406;&#x89E3; Python &#x4E2D;&#x7684;&#x88C5;&#x9970;&#x5668;"></a>&#x600E;&#x4E48;&#x6837;&#x53BB;&#x7406;&#x89E3; Python &#x4E2D;&#x7684;&#x88C5;&#x9970;&#x5668;</h1><p>&#x9996;&#x5148;&#xFF0C;&#x672C;&#x5783;&#x573E;&#x6587;&#x6863;&#x5DE5;&#x7A0B;&#x5E08;&#x53C8;&#x6765;&#x4E86;&#x3002;&#x5F00;&#x59CB;&#x65E5;&#x5E38;&#x7684;&#x6C34;&#x6587;&#x5199;&#x4F5C;&#x3002;&#x8D77;&#x56E0;&#x662F;&#x770B;&#x5230;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;<a href="/external_links/97bb0fcffee935ad8a12466fb0b5681e.html" target="blank" rel="noopener">&#x5982;&#x4F55;&#x7406;&#x89E3;Python&#x88C5;&#x9970;&#x5668;&#xFF1F;</a>&#xFF0C;&#x6B63;&#x597D;&#x4E0D;&#x4E45;&#x524D;&#x7ED9;&#x4EBA;&#x8BB2;&#x8FC7;&#x8FD9;&#x4E9B;&#xFF0C;&#x672C;&#x5783;&#x573E;&#x4E8E;&#x662F;&#x53C8;&#x5F00;&#x59CB;&#x65B0;&#x7684;&#x4E00;&#x8F6E;&#x8FA3;&#x9E21;&#x6587;&#x7AE0;&#x5199;&#x4F5C;&#x884C;&#x4E3A;&#x4E86;&#x3002;</p>
<h2 id="&#x9884;&#x5907;&#x77E5;&#x8BC6;"><a href="#&#x9884;&#x5907;&#x77E5;&#x8BC6;" class="headerlink" title="&#x9884;&#x5907;&#x77E5;&#x8BC6;"></a>&#x9884;&#x5907;&#x77E5;&#x8BC6;</h2><p>&#x9996;&#x5148;&#x8981;&#x7406;&#x89E3;&#x88C5;&#x9970;&#x5668;&#xFF0C;&#x9996;&#x5148;&#x8981;&#x5148;&#x7406;&#x89E3;&#x5728; Python &#x4E2D;&#x5F88;&#x91CD;&#x8981;&#x7684;&#x4E00;&#x4E2A;&#x6982;&#x5FF5;&#x5C31;&#x662F;&#xFF1A;&#x201C;&#x51FD;&#x6570;&#x662F; First Class Member&#x201D; &#x3002;&#x8FD9;&#x53E5;&#x8BDD;&#x518D;&#x7FFB;&#x8BD1;&#x4E00;&#x4E0B;&#xFF0C;&#x51FD;&#x6570;&#x662F;&#x4E00;&#x79CD;&#x7279;&#x6B8A;&#x7C7B;&#x578B;&#x7684;&#x53D8;&#x91CF;&#xFF0C;&#x53EF;&#x4EE5;&#x548C;&#x5176;&#x4F59;&#x53D8;&#x91CF;&#x4E00;&#x6837;&#xFF0C;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x4F20;&#x9012;&#x7ED9;&#x51FD;&#x6570;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;&#x8FD4;&#x56DE;&#x503C;&#x8FD4;&#x56DE;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">def abc():</span><br><span class="line">    print(&quot;abc&quot;)</span><br><span class="line"></span><br><span class="line">def abc1(func):</span><br><span class="line">    func()</span><br><span class="line"></span><br><span class="line">abc1(abc)</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x7684;&#x8F93;&#x51FA;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x5728;&#x51FD;&#x6570; <code>abc</code> &#x4E2D;&#x8F93;&#x51FA;&#x7684; <code>abc</code> &#x5B57;&#x7B26;&#x4E32;&#x3002;&#x8FC7;&#x7A0B;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x51FD;&#x6570; <code>abc</code> &#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x4F20;&#x9012;&#x7ED9; <code>abc1</code> &#xFF0C;&#x7136;&#x540E;&#xFF0C;&#x5728; <code>abc1</code> &#x4E2D;&#x8C03;&#x7528;&#x4F20;&#x5165;&#x7684;&#x51FD;&#x6570;</p>
<p>&#x518D;&#x6765;&#x770B;&#x4E00;&#x6BB5;&#x4EE3;&#x7801;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">def abc1():</span><br><span class="line">    def abc():</span><br><span class="line">        print(&quot;abc&quot;)</span><br><span class="line">    return abc</span><br><span class="line">abc1()()</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x8F93;&#x51FA;&#x548C;&#x4E4B;&#x524D;&#x7684;&#x4E00;&#x6837;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x5C06;&#x5728; <code>abc1</code> &#x5185;&#x90E8;&#x5B9A;&#x4E49;&#x7684;&#x51FD;&#x6570; <code>abc</code> &#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x53D8;&#x91CF;&#x8FD4;&#x56DE;&#xFF0C;&#x7136;&#x540E;&#x6211;&#x4EEC;&#x5728;&#x8C03;&#x7528; <code>abc1</code> &#x83B7;&#x53D6;&#x5230;&#x8FD4;&#x56DE;&#x503C;&#x540E;&#xFF0C;&#x7EE7;&#x7EED;&#x8C03;&#x7528;&#x8FD4;&#x56DE;&#x7684;&#x51FD;&#x6570;&#x3002;</p>
<p>&#x597D;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x505A;&#x4E00;&#x4E2A;&#x601D;&#x8003;&#x9898;&#xFF0C;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x51FD;&#x6570; <code>add</code> &#xFF0C;&#x8FBE;&#x5230; <code>add(m)(n)</code> &#x7B49;&#x4EF7;&#x4E8E; <code>m+n</code> &#x7684;&#x6548;&#x679C;&#x3002;&#x8FD9;&#x9898;&#x5982;&#x679C;&#x628A;&#x4E4B;&#x524D;&#x7684; First-Class Member &#x8FD9;&#x4E00;&#x6982;&#x5FF5;&#x7406;&#x6E05;&#x695A;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x4FBF;&#x80FD;&#x5F88;&#x6E05;&#x695A;&#x7684;&#x5199;&#x51FA;&#x6765;&#x4E86;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;def add(m):</span><br><span class="line">    def temp(n):</span><br><span class="line">        return m+n</span><br><span class="line">    return temp</span><br><span class="line">print(add(1)(2))</span><br></pre></td></tr></table></figure>

<p>&#x55EF;&#xFF0C;&#x8FD9;&#x91CC;&#x8F93;&#x51FA;&#x5C31;&#x662F; 3 &#x3002;</p>
<h2 id="&#x6B63;&#x6587;"><a href="#&#x6B63;&#x6587;" class="headerlink" title="&#x6B63;&#x6587;"></a>&#x6B63;&#x6587;</h2><p>&#x770B;&#x4E86;&#x524D;&#x9762;&#x7684;&#x9884;&#x5907;&#x77E5;&#x8BC6;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x4FBF;&#x53EF;&#x4EE5;&#x5F00;&#x59CB;&#x4ECA;&#x5929;&#x7684;&#x4E3B;&#x9898;&#x4E86;</p>
<h3 id="&#x5148;&#x6765;&#x770B;&#x4E00;&#x4E2A;&#x9700;&#x6C42;&#x5427;"><a href="#&#x5148;&#x6765;&#x770B;&#x4E00;&#x4E2A;&#x9700;&#x6C42;&#x5427;" class="headerlink" title="&#x5148;&#x6765;&#x770B;&#x4E00;&#x4E2A;&#x9700;&#x6C42;&#x5427;"></a>&#x5148;&#x6765;&#x770B;&#x4E00;&#x4E2A;&#x9700;&#x6C42;&#x5427;</h3><p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x6709;&#x4E00;&#x4E2A;&#x51FD;&#x6570;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">def range_loop(a,b):</span><br><span class="line">    for i in range(a,b):</span><br><span class="line">        temp_result=a+b</span><br><span class="line">    return temp_result</span><br></pre></td></tr></table></figure>

<p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x8981;&#x7ED9;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x52A0;&#x4E0A;&#x4E00;&#x4E9B;&#x4EE3;&#x7801;&#xFF0C;&#x6765;&#x8BA1;&#x7B97;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x5927;&#x6982;&#x4E00;&#x60F3;&#xFF0C;&#x5199;&#x51FA;&#x4E86;&#x8FD9;&#x6837;&#x7684;&#x4EE3;&#x7801;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;import time</span><br><span class="line">def range_loop(a,b):</span><br><span class="line">    time_flag=time.time()</span><br><span class="line">    for i in range(a,b):</span><br><span class="line">        temp_result=a+b</span><br><span class="line">    print(time.time()-time_flag)</span><br><span class="line">    return temp_result</span><br></pre></td></tr></table></figure>

<p>&#x5148;&#x4E14;&#x4E0D;&#x8BBA;&#xFF0C;&#x8FD9;&#x6837;&#x8BA1;&#x7B97;&#x65F6;&#x95F4;&#x662F;&#x4E0D;&#x662F;&#x51C6;&#x786E;&#x7684;&#xFF0C;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x8981;&#x7ED9;&#x5982;&#x4E0B;&#x5F88;&#x591A;&#x51FD;&#x6570;&#x52A0;&#x4E0A;&#x4E00;&#x4E2A;&#x65F6;&#x95F4;&#x8BA1;&#x7B97;&#x7684;&#x529F;&#x80FD;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;import time</span><br><span class="line">def range_loop(a,b):</span><br><span class="line">    time_flag=time.time()</span><br><span class="line">    for i in range(a,b):</span><br><span class="line">        temp_result=a+b</span><br><span class="line">    print(time.time()-time_flag)</span><br><span class="line">    return temp_result</span><br><span class="line">def range_loop1(a,b):</span><br><span class="line">    time_flag=time.time()</span><br><span class="line">    for i in range(a,b):</span><br><span class="line">        temp_result=a+b</span><br><span class="line">    print(time.time()-time_flag)</span><br><span class="line">    return temp_result</span><br><span class="line">def range_loop2(a,b):</span><br><span class="line">    time_flag=time.time()</span><br><span class="line">    for i in range(a,b):</span><br><span class="line">        temp_result=a+b</span><br><span class="line">    print(time.time()-time_flag)</span><br><span class="line">    return temp_result</span><br></pre></td></tr></table></figure>

<p>&#x6211;&#x4EEC;&#x521D;&#x7565;&#x4E00;&#x60F3;&#xFF0C;&#x55EF;&#xFF0C;Ctrl+C,Ctrl+V&#x3002;emmmm &#x597D;&#x4E86;&#xFF0C;&#x73B0;&#x5728;&#x4F60;&#x4EEC;&#x4E0D;&#x89C9;&#x5F97;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x7279;&#x522B;&#x810F;&#x4E48;&#xFF1F;&#x6211;&#x4EEC;&#x60F3;&#x8BA9;&#x4ED6;&#x53D8;&#x5F97;&#x5E72;&#x51C0;&#x70B9;&#x600E;&#x4E48;&#x529E;&#xFF1F;</p>
<p>&#x6211;&#x4EEC;&#x60F3;&#x4E86;&#x60F3;&#xFF0C;&#x6309;&#x7167;&#x4E4B;&#x524D;&#x8BF4;&#x7684; First-Class Member &#x7684;&#x6982;&#x5FF5;&#x3002;&#x7136;&#x540E;&#x5199;&#x51FA;&#x4E86;&#x5982;&#x4E0B;&#x7684;&#x4EE3;&#x7801;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;import time</span><br><span class="line">def time_count(func,a,b):</span><br><span class="line">    time_flag=time.time()</span><br><span class="line">    temp_result=func(a,b)</span><br><span class="line">    print(time.time()-time_flag)</span><br><span class="line">    return temp_result</span><br><span class="line">    </span><br><span class="line">def range_loop(a,b):</span><br><span class="line">    for i in range(a,b):</span><br><span class="line">        temp_result=a+b</span><br><span class="line">    return temp_result</span><br><span class="line">def range_loop1(a,b):</span><br><span class="line">    for i in range(a,b):</span><br><span class="line">        temp_result=a+b</span><br><span class="line">    return temp_result</span><br><span class="line">def range_loop2(a,b):</span><br><span class="line">    for i in range(a,b):</span><br><span class="line">        temp_result=a+b</span><br><span class="line">    return temp_result</span><br><span class="line">time_count(range_loop,a,b)</span><br><span class="line">time_count(range_loop1,a,b)</span><br><span class="line">time_count(range_loop2,a,b)</span><br></pre></td></tr></table></figure>

<p>&#x55EF;&#xFF0C;&#x770B;&#x8D77;&#x6765;&#x50CF;&#x90A3;&#x4E48;&#x56DE;&#x4E8B;&#xFF0C;&#x597D;&#x4E86;&#x597D;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x65B0;&#x7684;&#x95EE;&#x9898;&#x53C8;&#x6765;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x662F;&#x5047;&#x8BBE;&#xFF0C;&#x6211;&#x4EEC;&#x6240;&#x6709;&#x51FD;&#x6570;&#x90FD;&#x53EA;&#x6709;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#x4F20;&#x5165;&#xFF0C;&#x90A3;&#x4E48;&#x73B0;&#x5728;&#x5982;&#x679C;&#x60F3;&#x652F;&#x6301;&#x4EFB;&#x610F;&#x53C2;&#x6570;&#x7684;&#x4F20;&#x5165;&#x600E;&#x4E48;&#x529E;&#xFF1F;&#x6211;&#x4EEC;&#x7709;&#x5934;&#x4E00;&#x76B1;&#xFF0C;&#x5199;&#x4E0B;&#x4E86;&#x5982;&#x4E0B;&#x7684;&#x4EE3;&#x7801;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">import time</span><br><span class="line">def time_count(func,*args,**kwargs):</span><br><span class="line">    time_flag=time.time()</span><br><span class="line">    temp_result=func(*args,**kwargs)</span><br><span class="line">    print(time.time()-time_flag)</span><br><span class="line">    return temp_result</span><br><span class="line">    </span><br><span class="line">def range_loop(a,b):</span><br><span class="line">    for i in range(a,b):</span><br><span class="line">        temp_result=a+b</span><br><span class="line">    return temp_result</span><br><span class="line">def range_loop1(a,b):</span><br><span class="line">    for i in range(a,b):</span><br><span class="line">        temp_result=a+b</span><br><span class="line">    return temp_result</span><br><span class="line">def range_loop2(a,b):</span><br><span class="line">    for i in range(a,b):</span><br><span class="line">        temp_result=a+b</span><br><span class="line">    return temp_result</span><br><span class="line">time_count(range_loop,a,b)</span><br><span class="line">time_count(range_loop1,a,b)</span><br><span class="line">time_count(range_loop2,a,b)</span><br></pre></td></tr></table></figure>

<p>&#x597D;&#x4E86;&#xFF0C;&#x73B0;&#x5728;&#x770B;&#x8D77;&#x6765;&#xFF0C;&#x6709;&#x70B9;&#x50CF;&#x6A21;&#x50CF;&#x6837;&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x518D;&#x60F3;&#x60F3;&#xFF0C;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x5B9E;&#x9645;&#x4E0A;&#x6539;&#x53D8;&#x4E86;&#x6211;&#x4EEC;&#x7684;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x65B9;&#x5F0F;&#xFF0C;&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x8FD0;&#x884C; <code>range_loop(a,b)</code> &#x8FD8;&#x662F;&#x6CA1;&#x6709;&#x529E;&#x6CD5;&#x83B7;&#x53D6;&#x5230;&#x51FD;&#x6570;&#x6267;&#x884C;&#x65F6;&#x95F4;&#x3002;&#x90A3;&#x4E48;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5982;&#x679C;&#x4E0D;&#x60F3;&#x6539;&#x53D8;&#x51FD;&#x6570;&#x7684;&#x8C03;&#x7528;&#x65B9;&#x5F0F;&#xFF0C;&#x53C8;&#x60F3;&#x83B7;&#x53D6;&#x5230;&#x51FD;&#x6570;&#x7684;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x600E;&#x4E48;&#x529E;&#xFF1F;</p>
<p>&#x5F88;&#x7B80;&#x5355;&#x561B;&#xFF0C;&#x66FF;&#x6362;&#x4E00;&#x4E0B;&#x4E0D;&#x5C31;&#x597D;&#x4E86;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">import time</span><br><span class="line">def time_count(func):</span><br><span class="line">    def wrap(*args,**kwargs):</span><br><span class="line">        time_flag=time.time()</span><br><span class="line">        temp_result=func(*args,**kwargs)</span><br><span class="line">        print(time.time()-time_flag)</span><br><span class="line">        return temp_result</span><br><span class="line">    return wrap</span><br><span class="line">    </span><br><span class="line">def range_loop(a,b):</span><br><span class="line">    for i in range(a,b):</span><br><span class="line">        temp_result=a+b</span><br><span class="line">    return temp_result</span><br><span class="line">def range_loop1(a,b):</span><br><span class="line">    for i in range(a,b):</span><br><span class="line">        temp_result=a+b</span><br><span class="line">    return temp_result</span><br><span class="line">def range_loop2(a,b):</span><br><span class="line">    for i in range(a,b):</span><br><span class="line">        temp_result=a+b</span><br><span class="line">    return temp_result</span><br><span class="line">range_loop=time_count(range_loop)</span><br><span class="line">range_loop1=time_count(range_loop1)</span><br><span class="line">range_loop2=time_count(range_loop2)</span><br><span class="line">range_loop(1,2)</span><br><span class="line">range_loop1(1,2)</span><br><span class="line">range_loop2(1,2)</span><br></pre></td></tr></table></figure>

<p>emmmm&#xFF0C;&#x8FD9;&#x6837;&#x770B;&#x8D77;&#x6765;&#x611F;&#x89C9;&#x8212;&#x670D;&#x591A;&#x4E86;&#xFF1F;&#x65E2;&#x6CA1;&#x6709;&#x6539;&#x53D8;&#x539F;&#x6709;&#x7684;&#x8FD0;&#x884C;&#x65B9;&#x5F0F;&#xFF0C;&#x4E5F;&#x8F93;&#x51FA;&#x4E86;&#x51FD;&#x6570;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x3002;</p>
<p>&#x4F46;&#x662F;&#x3002;&#x3002;&#x3002;&#x4F60;&#x4EEC;&#x4E0D;&#x89C9;&#x5F97;&#x624B;&#x52A8;&#x66FF;&#x6362;&#x592A;&#x6076;&#x5FC3;&#x4E86;&#x4E48;&#xFF1F;&#xFF1F;&#xFF1F;&#x55B5;&#x55B5;&#x55B5;&#xFF1F;&#xFF1F;&#xFF1F;&#x8FD8;&#x6709;&#x4EC0;&#x4E48;&#x53EF;&#x4EE5;&#x7B80;&#x5316;&#x4E0B;&#x7684;&#x4E48;&#xFF1F;&#xFF1F;</p>
<p>&#x597D;&#x4E86;&#xFF0C;Python &#x77E5;&#x9053;&#x6211;&#x4EEC;&#x662F;&#x7231;&#x5403;&#x7CD6;&#x7684;&#x5B69;&#x5B50;&#xFF0C;&#x7ED9;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x8BED;&#x6CD5;&#x7CD6;&#xFF0C;&#x8FD9;&#x4E5F;&#x662F;&#x4ECA;&#x5929;&#x7684;&#x7537;&#x4E00;&#x53F7;&#xFF0C;Decorator &#x88C5;&#x9970;&#x5668;</p>
<h3 id="&#x8BF4;&#x8BF4;-Decorator"><a href="#&#x8BF4;&#x8BF4;-Decorator" class="headerlink" title="&#x8BF4;&#x8BF4; Decorator"></a>&#x8BF4;&#x8BF4; Decorator</h3><p>&#x6211;&#x4EEC;&#x524D;&#x9762;&#x5DF2;&#x7ECF;&#x5B9E;&#x73B0;&#x4E86;&#xFF0C;&#x5728;&#x4E0D;&#x6539;&#x53D8;&#x51FD;&#x6570;&#x7279;&#x6027;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x7ED9;&#x539F;&#x6709;&#x7684;&#x4EE3;&#x7801;&#x65B0;&#x589E;&#x4E00;&#x70B9;&#x529F;&#x80FD;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x4E5F;&#x89C9;&#x5F97;&#x8FD9;&#x6837;&#x624B;&#x52A8;&#x7684;&#x66FF;&#x6362;&#xFF0C;&#x592A;&#x6076;&#x5FC3;&#x4E86;&#xFF0C;&#x662F;&#x7684; Python &#x5B98;&#x65B9;&#x4E5F;&#x89C9;&#x5F97;&#x8FD9;&#x6837;&#x5F88;&#x6076;&#x5FC3;&#xFF0C;&#x6240;&#x4EE5;&#x65B0;&#x7684;&#x8BED;&#x6CD5;&#x7CD6;&#x6765;&#x4E86;</p>
<p>&#x6211;&#x4EEC;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x53EF;&#x4EE5;&#x5199;&#x6210;&#x8FD9;&#x6837;&#x4E86;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">import time</span><br><span class="line">def time_count(func):</span><br><span class="line">    def wrap(*args,**kwargs):</span><br><span class="line">        time_flag=time.time()</span><br><span class="line">        temp_result=func(*args,**kwargs)</span><br><span class="line">        print(time.time()-time_flag)</span><br><span class="line">        return temp_result</span><br><span class="line">    return wrap</span><br><span class="line">@time_count    </span><br><span class="line">def range_loop(a,b):</span><br><span class="line">    for i in range(a,b):</span><br><span class="line">        temp_result=a+b</span><br><span class="line">    return temp_result</span><br><span class="line">@time_count</span><br><span class="line">def range_loop1(a,b):</span><br><span class="line">    for i in range(a,b):</span><br><span class="line">        temp_result=a+b</span><br><span class="line">    return temp_result</span><br><span class="line">@time_count</span><br><span class="line">def range_loop2(a,b):</span><br><span class="line">    for i in range(a,b):</span><br><span class="line">        temp_result=a+b</span><br><span class="line">    return temp_result</span><br><span class="line">range_loop(1,2)</span><br><span class="line">range_loop1(1,2)</span><br><span class="line">range_loop2(1,2)</span><br></pre></td></tr></table></figure>

<p>&#x54C7;&#xFF0C;&#x5199;&#x5230;&#x8FD9;&#x91CC;&#xFF0C;&#x4F60;&#x662F;&#x4E0D;&#x662F;&#x604D;&#x7136;&#x5927;&#x609F;&#xFF01;&#x307E;&#x3055;&#x304B;&#xFF1F;&#xFF1F;&#xFF1F;&#x662F;&#x7684;&#xFF0C;&#x5176;&#x5B9E; <code>@</code> &#x7B26;&#x53F7;&#x5176;&#x5B9E;&#x662F;&#x4E00;&#x4E2A;&#x8BED;&#x6CD5;&#x7CD6;&#xFF0C;&#x4ED6;&#x5C06;&#x6211;&#x4EEC;&#x4E4B;&#x524D;&#x7684;&#x624B;&#x52A8;&#x66FF;&#x6362;&#x7684;&#x8FC7;&#x7A0B;&#x4EA4;&#x7ED9;&#x4E86;&#x73AF;&#x5883;&#x6267;&#x884C;&#x3002;&#x597D;&#x4E86;&#x7528;&#x4EBA;&#x8BDD;&#x63CF;&#x8FF0;&#x4E0B;&#xFF0C;<code>@</code> &#x7684;&#x4F5C;&#x7528;&#x662F;&#x5C06;&#x88AB;&#x5305;&#x88F9;&#x7684;&#x51FD;&#x6570;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x53D8;&#x91CF;&#x4F20;&#x9012;&#x7ED9;&#x88C5;&#x9970;&#x51FD;&#x6570;/&#x7C7B;&#xFF0C;&#x5C06;&#x88C5;&#x9970;&#x51FD;&#x6570;/&#x7C7B;&#x8FD4;&#x56DE;&#x7684;&#x503C;&#x66FF;&#x6362;&#x539F;&#x672C;&#x7684;&#x51FD;&#x6570;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;@decorator</span><br><span class="line">def abc():</span><br><span class="line">    pass</span><br></pre></td></tr></table></figure>

<p>&#x5982;&#x540C;&#x524D;&#x9762;&#x6240;&#x8BB2;&#x7684;&#x4E00;&#x6837;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x53D1;&#x751F;&#x4E86;&#x4E00;&#x4E2A;&#x7279;&#x6B8A;&#x7684;&#x66FF;&#x6362;&#x8FC7;&#x7A0B; <code>abc=decorator(abc)</code> &#xFF0C;&#x597D;&#x4E86;&#x6211;&#x4EEC;&#x6765;&#x505A;&#x51E0;&#x4E2A;&#x9898;&#x6765;&#x7EC3;&#x4E60;&#x4E0B;&#x5427;&#xFF1F;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">def decorator(func):</span><br><span class="line">    return 1</span><br><span class="line">@decorator</span><br><span class="line">def abc():</span><br><span class="line">    pass</span><br><span class="line">abc()</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x4F1A;&#x53D1;&#x751F;&#x4EC0;&#x4E48;&#xFF1F;&#x7B54;&#xFF1A;&#x4F1A;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#x3002;&#x4E3A;&#x5565;&#x554A;&#xFF1F;&#x7B54;&#xFF1A;&#x56E0;&#x4E3A;&#x88C5;&#x9970;&#x7684;&#x65F6;&#x5019;&#x53D1;&#x751F;&#x4E86;&#x66FF;&#x6362;&#xFF0C;<code>abc=decorator(abc)</code> &#xFF0C;&#x66FF;&#x6362;&#x540E; <code>abc</code> &#x7684;&#x503C;&#x4E3A; 1 &#x3002;&#x6574;&#x6570;&#x9ED8;&#x8BA4;&#x4E0D;&#x80FD;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x8FDB;&#x884C;&#x8C03;&#x7528;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">def time_count(func):</span><br><span class="line">    def wrap(*args,**kwargs):</span><br><span class="line">        time_flag=time.time()</span><br><span class="line">        temp_result=func(*args,**kwargs)</span><br><span class="line">        print(time.time()-time_flag)</span><br><span class="line">        return temp_result</span><br><span class="line">    return wrap</span><br><span class="line"></span><br><span class="line">def decorator(func):</span><br><span class="line">    def wrap(*args,**kwargs):</span><br><span class="line">        temp_result=func(*args,**kwargs)</span><br><span class="line">        return temp_result</span><br><span class="line">    return wrap</span><br><span class="line"></span><br><span class="line">def decorator1(func):</span><br><span class="line">    def wrap(*args,**kwargs):</span><br><span class="line">        temp_result=func(*args,**kwargs)</span><br><span class="line">        return temp_result</span><br><span class="line">    return wrap</span><br><span class="line"></span><br><span class="line">@time_count</span><br><span class="line">@decorator</span><br><span class="line">@decorator1    </span><br><span class="line">def range_loop(a,b):</span><br><span class="line">    for i in range(a,b):</span><br><span class="line">        temp_result=a+b</span><br><span class="line">    return temp_result</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x600E;&#x4E48;&#x66FF;&#x6362;&#x7684;&#xFF1F;&#x7B54;&#xFF1A;<code>time_count(decorator(decorator1(range_loop)))</code></p>
<p>&#x55EF;&#xFF0C;&#x73B0;&#x5728;&#x662F;&#x4E0D;&#x662F;&#x5BF9;&#x88C5;&#x9970;&#x5668;&#x4EC0;&#x4E48;&#x7684;&#x6709;&#x4E86;&#x57FA;&#x672C;&#x7684;&#x4E86;&#x89E3;&#xFF1F;</p>
<h3 id="&#x6269;&#x5C55;&#x4E00;&#x4E0B;"><a href="#&#x6269;&#x5C55;&#x4E00;&#x4E0B;" class="headerlink" title="&#x6269;&#x5C55;&#x4E00;&#x4E0B;"></a>&#x6269;&#x5C55;&#x4E00;&#x4E0B;</h3><p>&#x73B0;&#x5728;&#xFF0C;&#x6211;&#x60F3;&#x4FEE;&#x6539;&#x4E0B;&#x524D;&#x9762;&#x5199;&#x7684; <code>time_count</code> &#x51FD;&#x6570;&#xFF0C;&#x8BA9;&#x4ED6;&#x652F;&#x6301;&#x4F20;&#x5165;&#x4E00;&#x4E2A; <code>flag</code> &#x53C2;&#x6570;&#xFF0C;&#x5F53; <code>flag</code> &#x4E3A; <code>True</code> &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8F93;&#x51FA;&#x51FD;&#x6570;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#xFF0C;&#x4E3A; <code>False</code> &#x7684;&#x65F6;&#x5019;&#x4E0D;&#x8F93;&#x51FA;&#x65F6;&#x95F4;</p>
<p>&#x6211;&#x4EEC;&#x4E00;&#x6B65;&#x6B65;&#x6765;&#xFF0C;&#x6211;&#x4EEC;&#x5148;&#x5047;&#x8BBE;&#x65B0;&#x7684;&#x51FD;&#x6570;&#x53EB;&#x505A; <code>time_count_plus</code></p>
<p>&#x6211;&#x4EEC;&#x60F3;&#x5B9E;&#x73B0;&#x7684;&#x6548;&#x679C;&#x662F;&#x8FD9;&#x6837;&#x7684;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;@time_count_plus(flag=True)</span><br><span class="line">def range_loop(a,b):</span><br><span class="line">    for i in range(a,b):</span><br><span class="line">        temp_result=a+b</span><br><span class="line">    return temp_result</span><br></pre></td></tr></table></figure>

<p>&#x55EF;&#xFF0C;&#x6211;&#x4EEC;&#x770B;&#x4E86;&#x4E0B;&#xFF0C;&#x9996;&#x5148;&#x6211;&#x4EEC;&#x8C03;&#x7528;&#x4E86; <code>time_count_plus(flag=True)</code> &#x4E00;&#x6B21;&#xFF0C;&#x5C06;&#x5B83;&#x8FD4;&#x56DE;&#x7684;&#x503C;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x88C5;&#x9970;&#x51FD;&#x6570;&#x6765;&#x66FF;&#x6362; <code>range_loop</code> &#xFF0C;OK &#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x9996;&#x5148; <code>time_count_plus</code> &#x8981;&#x63A5;&#x6536;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x5BF9;&#x5427;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;def time_count_plus(flag=True):</span><br><span class="line">    def wrap1(func):</span><br><span class="line">        pass</span><br><span class="line">    return wrap1</span><br></pre></td></tr></table></figure>

<p>&#x597D;&#x4E86;&#xFF0C;&#x73B0;&#x5728;&#x8FD4;&#x56DE;&#x4E86;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x6765;&#x4F5C;&#x4E3A;&#x88C5;&#x9970;&#x51FD;&#x6570;&#xFF0C;&#x7136;&#x540E;&#x6211;&#x4EEC;&#x8BF4;&#x4E86; <code>@</code> &#x5176;&#x5B9E;&#x89E6;&#x53D1;&#x4E86;&#x4E00;&#x6B21;&#x66FF;&#x6362;&#x8FC7;&#x7A0B;&#xFF0C;&#x597D;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x7684;&#x66FF;&#x6362;&#x662F;&#x4E0D;&#x662F; <code>range_loop=time_count_plus(flag=True)(range_loop)</code> &#x597D;&#x4E86;&#xFF0C;&#x73B0;&#x5728;&#x5927;&#x5BB6;&#x5E94;&#x8BE5;&#x5F88;&#x6E05;&#x695A;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x5728; <code>wrap1</code> &#x91CC;&#x9762;&#x662F;&#x4E0D;&#x662F;&#x8FD8;&#x5E94;&#x8BE5;&#x6709;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x5E76;&#x8FD4;&#x56DE;&#xFF1F;</p>
<p>&#x55EF;&#xFF0C;&#x6700;&#x7EC8;&#x7684;&#x4EE3;&#x7801;&#x5982;&#x4E0B;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;def time_count_plus(flag=True):</span><br><span class="line">    def wrap1(func):</span><br><span class="line">        def wrap2(*args,**kwargs):</span><br><span class="line">            if flag:</span><br><span class="line">                time_flag=time.time()</span><br><span class="line">                temp_result=func(*args,**kwargs)</span><br><span class="line">                print(time.time()-time_flag)</span><br><span class="line">            else:</span><br><span class="line">                temp_result=func(*args,**kwargs)</span><br><span class="line">            return temp_result</span><br><span class="line">        return wrap2</span><br><span class="line">    return wrap1</span><br><span class="line">@time_count_plus(flag=True)</span><br><span class="line">def range_loop(a,b):</span><br><span class="line">    for i in range(a,b):</span><br><span class="line">        temp_result=a+b</span><br><span class="line">    return temp_result</span><br></pre></td></tr></table></figure>

<p>&#x662F;&#x4E0D;&#x662F;&#x8FD9;&#x6837;&#x5C31;&#x6E05;&#x695A;&#x591A;&#x5566;&#xFF01;</p>
<h3 id="&#x6269;&#x5C55;&#x4E24;&#x4E0B;"><a href="#&#x6269;&#x5C55;&#x4E24;&#x4E0B;" class="headerlink" title="&#x6269;&#x5C55;&#x4E24;&#x4E0B;"></a>&#x6269;&#x5C55;&#x4E24;&#x4E0B;</h3><p>&#x597D;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x6709;&#x65B0;&#x7684;&#x9700;&#x6C42;&#x6765;&#x4E86;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;m=3</span><br><span class="line">n=2</span><br><span class="line">def add(a,b):</span><br><span class="line">    return a+b</span><br><span class="line"></span><br><span class="line">def sub(a,b):</span><br><span class="line">    return a-b</span><br><span class="line"></span><br><span class="line">def mul(a,b):</span><br><span class="line">    return a*b</span><br><span class="line"></span><br><span class="line">def div(a,b):</span><br><span class="line">    return a/b</span><br></pre></td></tr></table></figure>

<p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x6709;&#x5B57;&#x7B26;&#x4E32; <code>a</code> , <code>a</code> &#x7684;&#x503C;&#x53EF;&#x80FD;&#x4E3A; <code>+</code>&#x3001;<code>-</code>&#x3001;<code>*</code>&#x3001;<code>/</code> &#x90A3;&#x4E48;&#x73B0;&#x5728;&#xFF0C;&#x6211;&#x4EEC;&#x60F3;&#x6839;&#x636E; <code>a</code> &#x7684;&#x503C;&#x6765;&#x8C03;&#x7528;&#x5BF9;&#x5E94;&#x7684;&#x51FD;&#x6570;&#x600E;&#x4E48;&#x529E;&#xFF1F;</p>
<p>&#x6211;&#x4EEC;&#x714E;&#x86CB;&#x4E00;&#x60F3;&#xFF0C;&#x55EF;&#xFF0C;&#x903B;&#x8F91;&#x5224;&#x65AD;&#x561B;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">m=3</span><br><span class="line">n=2</span><br><span class="line">def add(a,b):</span><br><span class="line">    return a+b</span><br><span class="line"></span><br><span class="line">def sub(a,b):</span><br><span class="line">    return a-b</span><br><span class="line"></span><br><span class="line">def mul(a,b):</span><br><span class="line">    return a*b</span><br><span class="line"></span><br><span class="line">def div(a,b):</span><br><span class="line">    return a/b</span><br><span class="line">a=input(&apos;&#x8BF7;&#x8F93;&#x5165; + - * / &#x4E2D;&#x7684;&#x4EFB;&#x610F;&#x4E00;&#x4E2A;\n&apos;)</span><br><span class="line">if a==&apos;+&apos;:</span><br><span class="line">    print(add(m,n))</span><br><span class="line">elif a==&apos;-&apos;:</span><br><span class="line">    print(sub(m-n))</span><br><span class="line">elif a==&apos;*&apos;:</span><br><span class="line">    print(mul(m,n))</span><br><span class="line">elif a==&apos;/&apos;:</span><br><span class="line">    print(div(m,n))</span><br></pre></td></tr></table></figure>

<p>&#x4F46;&#x662F;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#xFF0C;if else &#x662F;&#x4E0D;&#x662F;&#x592A;&#x591A;&#x4E86;&#x70B9;&#xFF1F;&#x6211;&#x4EEC;&#x4ED4;&#x7EC6;&#x4E00;&#x60F3;&#xFF0C;&#x7528;&#x4E00;&#x4E0B; First-Class Member &#x7684;&#x7279;&#x6027;&#xFF0C;&#x7136;&#x540E;&#x914D;&#x5408; dict &#x5B9E;&#x73B0;&#x64CD;&#x4F5C;&#x7B26;&#x548C;&#x51FD;&#x6570;&#x4E4B;&#x95F4;&#x7684;&#x5173;&#x8054;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;m=3</span><br><span class="line">n=2</span><br><span class="line">def add(a,b):</span><br><span class="line">    return a+b</span><br><span class="line"></span><br><span class="line">def sub(a,b):</span><br><span class="line">    return a-b</span><br><span class="line"></span><br><span class="line">def mul(a,b):</span><br><span class="line">    return a*b</span><br><span class="line"></span><br><span class="line">def div(a,b):</span><br><span class="line">    return a/b</span><br><span class="line">func_dict={&quot;+&quot;:add,&quot;-&quot;:sub,&quot;*&quot;:mul,&quot;/&quot;:div}</span><br><span class="line">a=input(&apos;&#x8BF7;&#x8F93;&#x5165; + - * / &#x4E2D;&#x7684;&#x4EFB;&#x610F;&#x4E00;&#x4E2A;\n&apos;)</span><br><span class="line">func_dict[a](m,n)</span><br></pre></td></tr></table></figure>

<p>emmmm&#xFF0C;&#x770B;&#x8D77;&#x6765;&#x4E0D;&#x9519;&#x554A;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x6CE8;&#x518C;&#x7684;&#x8FC7;&#x7A0B;&#x80FD;&#x4E0D;&#x80FD;&#x518D;&#x7B80;&#x5316;&#x4E00;&#x70B9;&#xFF1F; &#x55EF;&#xFF0C;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x88C5;&#x9970;&#x5668;&#x8BED;&#x6CD5;&#x7279;&#x6027;&#x5C31;&#x80FD;&#x7528;&#x4E0A;&#x4E86;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;m=3</span><br><span class="line">n=2</span><br><span class="line">func_dict={}</span><br><span class="line">def register(operator):</span><br><span class="line">    def wrap(func):</span><br><span class="line">        func_dict[operator]=func</span><br><span class="line">        return func</span><br><span class="line">    return wrap</span><br><span class="line">@register(operator=&quot;+&quot;)</span><br><span class="line">def add(a,b):</span><br><span class="line">    return a+b</span><br><span class="line">@register(operator=&quot;-&quot;)</span><br><span class="line">def sub(a,b):</span><br><span class="line">    return a-b</span><br><span class="line">@register(operator=&quot;*&quot;)</span><br><span class="line">def mul(a,b):</span><br><span class="line">    return a*b</span><br><span class="line">@register(operator=&quot;/&quot;)</span><br><span class="line">def div(a,b):</span><br><span class="line">    return a/b</span><br><span class="line"></span><br><span class="line">a=input(&apos;&#x8BF7;&#x8F93;&#x5165; + - * / &#x4E2D;&#x7684;&#x4EFB;&#x610F;&#x4E00;&#x4E2A;\n&apos;)</span><br><span class="line">func_dict[a](m,n)</span><br></pre></td></tr></table></figure>

<p>&#x55EF;&#xFF0C;&#x8FD8;&#x8BB0;&#x5F97;&#x6211;&#x4EEC;&#x524D;&#x9762;&#x8BF4;&#x7684;&#x4F7F;&#x7528; <code>@</code> &#x8BED;&#x6CD5;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x89E6;&#x53D1;&#x4E86;&#x4E00;&#x4E2A;&#x66FF;&#x6362;&#x7684;&#x8FC7;&#x7A0B;&#x4E48;&#xFF1F;&#x8FD9;&#x91CC;&#x5C31;&#x662F;&#x5229;&#x7528;&#x8FD9;&#x4E00;&#x7279;&#x6027;&#xFF0C;&#x5728;&#x88C5;&#x9970;&#x5668;&#x89E6;&#x53D1;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6CE8;&#x518C;&#x51FD;&#x6570;&#x6620;&#x5C04;&#xFF0C;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x6839;&#x636E; &#x2018;a&#x2019; &#x7684;&#x503C;&#x6765;&#x83B7;&#x53D6;&#x51FD;&#x6570;&#x5904;&#x7406;&#x6570;&#x636E;&#x3002;&#x53E6;&#x5916;&#x8BF7;&#x6CE8;&#x610F;&#x4E00;&#x70B9;&#xFF0C;&#x6211;&#x4EEC;&#x8FD9;&#x91CC;&#x6CA1;&#x6709;&#x5FC5;&#x8981;&#x4FEE;&#x6539;&#x539F;&#x51FD;&#x6570;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x6CA1;&#x6709;&#x5FC5;&#x8981;&#x5199;&#x7B2C;&#x4E09;&#x5C42;&#x7684;&#x51FD;&#x6570;&#x3002;</p>
<p>&#x5982;&#x679C;&#x6709;&#x719F;&#x6089; Flask &#x540C;&#x5B66;&#x5C31;&#x77E5;&#x9053;&#xFF0C;&#x5728;&#x8C03;&#x7528; <code>route</code> &#x65B9;&#x6CD5;&#x6CE8;&#x518C;&#x8DEF;&#x7531;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E5F;&#x662F;&#x4F7F;&#x7528;&#x4E86;&#x8FD9;&#x4E00;&#x7279;&#x6027; &#xFF0C;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x53E6;&#x5916;&#x4E00;&#x7BC7;&#x5F88;&#x4E45;&#x524D;&#x5199;&#x7684;&#x5783;&#x573E;&#x6C34;&#x6587; <a href="/external_links/05e4e055b714b810b86fd39349ca4b84.html" target="blank" rel="noopener">&#x83DC;&#x9E1F;&#x9605;&#x8BFB; Flask &#x6E90;&#x7801;&#x7CFB;&#x5217;&#xFF08;1&#xFF09;&#xFF1A;Flask&#x7684;router&#x521D;&#x63A2;</a></p>
<h2 id="&#x603B;&#x7ED3;"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3;</h2><p>&#x5176;&#x5B9E;&#x5168;&#x6587;&#x4E0B;&#x6765;&#xFF0C;&#x5927;&#x5BB6;&#x5E94;&#x8BE5;&#x80FD;&#x77E5;&#x9053;&#x8FD9;&#x6837;&#x4E00;&#x70B9;&#x4E1C;&#x897F;&#x3002;Python &#x4E2D;&#x7684;&#x88C5;&#x9970;&#x5668;&#x5176;&#x5B9E;&#x662F; First-Class Member &#x6982;&#x5FF5;&#x7684;&#x66F4;&#x8FDB;&#x4E00;&#x5C42;&#x5E94;&#x7528;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x51FD;&#x6570;&#x4F20;&#x9012;&#x7ED9;&#x5176;&#x4F59;&#x51FD;&#x6570;&#xFF0C;&#x5305;&#x88F9;&#x4E0A;&#x65B0;&#x7684;&#x529F;&#x80FD;&#x540E;&#x518D;&#x884C;&#x8FD4;&#x56DE;&#x3002;<code>@</code> &#x5176;&#x5B9E;&#x53EA;&#x662F;&#x5C06;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x8FC7;&#x7A0B;&#x8FDB;&#x884C;&#x4E86;&#x7B80;&#x5316;&#x800C;&#x5DF2;&#x3002;&#x5728; Python &#x4E2D;&#xFF0C;&#x88C5;&#x9970;&#x5668;&#x65E0;&#x5904;&#x4E0D;&#x5728;&#xFF0C;&#x5F88;&#x591A;&#x5B98;&#x65B9;&#x5E93;&#x4E2D;&#x7684;&#x5B9E;&#x73B0;&#x4E5F;&#x4F9D;&#x8D56;&#x4E8E;&#x88C5;&#x9970;&#x5668;&#xFF0C;&#x6BD4;&#x5982;&#x5F88;&#x4E45;&#x4E4B;&#x524D;&#x5199;&#x8FC7;&#x8FD9;&#x6837;&#x4E00;&#x7BC7;&#x5783;&#x573E;&#x6C34;&#x6587; <a href="/external_links/7fcfb4325f2aa7825aa765fb179d92fb.html" target="blank" rel="noopener">Python &#x63CF;&#x8FF0;&#x7B26;&#x5165;&#x95E8;&#x6307;&#x5317;</a>&#x3002;</p>
<p>&#x55EF;&#xFF0C;&#x4ECA;&#x5929;&#x5C31;&#x5148;&#x5199;&#x5230;&#x8FD9;&#x91CC;&#x5427;&#xFF01;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/9c6904ab98d856aa7ad561d2cafb7cc2.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903521624522760.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903521624522760.html" itemprop="url">HTTP 代理服务器技术选型之旅 背景 代理服务器工作模型</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-13T17:20:59+08:00">
                2017-12-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x597D;&#x4E45;&#x4E0D;&#x5199;&#x535A;&#x5BA2;&#x4E86;&#xFF0C;&#x5728;&#x5143;&#x65E6;&#x5230;&#x6765;&#x524D;&#x6C34;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;&#xFF0C;&#x804A;&#x804A;&#x6211;&#x5728;&#x5B9E;&#x73B0;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x9047;&#x5230;&#x7684;&#x4E00;&#x4E9B;&#x5751;&#xFF0C;&#x540C;&#x65F6;&#x795D;&#x5404;&#x4F4D;&#x8BFB;&#x8005;&#x65B0;&#x5E74;&#x5FEB;&#x4E50;&#x3002;</p>
<h1 id="&#x80CC;&#x666F;"><a href="#&#x80CC;&#x666F;" class="headerlink" title="&#x80CC;&#x666F;"></a>&#x80CC;&#x666F;</h1><p>&#x957F;&#x671F;&#x4EE5;&#x6765;&#xFF0C;&#x8D34;&#x5427;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x591A;&#xFF0C;&#x4E1A;&#x52A1;&#x8026;&#x5408;&#x5927;&#xFF0C;&#x9700;&#x6C42;&#x53D8;&#x5316;&#x9891;&#x7E41;&#xFF0C;&#x56E0;&#x6B64;&#x5BB9;&#x6613;&#x4EA7;&#x751F; bug&#x3002;&#x800C;&#x6211;&#x6240;&#x8D1F;&#x8D23;&#x7684;&#x5E7F;&#x544A;&#x76F8;&#x5173;&#x4E1A;&#x52A1;&#xFF0C;&#x548C; UI &#x5BC6;&#x5207;&#x76F8;&#x5173;&#xFF0C;&#x4E00;&#x65E6;&#x56E0;&#x4E3A;&#x67D0;&#x79CD;&#x539F;&#x56E0;(&#x751A;&#x81F3;&#x662F;&#x88AB;&#x522B;&#x4EBA;&#x6539;&#x4E86;&#x4EE3;&#x7801;)&#x4EA7;&#x751F;&#x4E86; bug&#xFF0C;&#x5FC5;&#x7136;&#x5927;&#x5E45;&#x5EA6;&#x5F71;&#x54CD;&#x5E7F;&#x544A;&#x6536;&#x5165;&#x3002;</p>
<p>&#x89E3;&#x51B3;&#x95EE;&#x9898;&#x7684;&#x4E00;&#x79CD;&#x65B9;&#x6CD5;&#x5728;&#x4E8E;&#x9891;&#x7E41;&#x7684;&#x6D4B;&#x8BD5;&#xFF0C;&#x65E2;&#x7136;&#x907F;&#x514D;&#x4E0D;&#x4E86;&#x4EE3;&#x7801;&#x5C42;&#x9762;&#x7684;&#x8026;&#x5408;&#xFF0C;&#x90A3;&#x603B;&#x662F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5B9A;&#x65F6;&#x7684;&#x68C0;&#x67E5;&#x6765;&#x907F;&#x514D;&#x95EE;&#x9898;&#x3002;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x7EF4;&#x62A4;&#x4E86;&#x4E00;&#x7EC4;&#x6838;&#x5FC3; case&#xFF0C;&#x5BC6;&#x5207;&#x5173;&#x6CE8;&#x6700;&#x6838;&#x5FC3;&#x7684;&#x529F;&#x80FD;&#x3002;&#x9009;&#x62E9;&#x6838;&#x5FC3; case &#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x5728;&#x8986;&#x76D6;&#x9762;&#x548C;&#x6D4B;&#x8BD5;&#x6210;&#x672C;&#x4E4B;&#x95F4;&#x7684;&#x6743;&#x8861;&#xFF0C;&#x7136;&#x800C;&#x591A;&#x4E2A; case &#x6709;&#x4E0D;&#x540C;&#x7684;&#x6D4B;&#x8BD5;&#x6B65;&#x9AA4;&#xFF0C;&#x6D4B;&#x8BD5;&#x6548;&#x7387;&#x59CB;&#x7EC8;&#x96BE;&#x4EE5;&#x63D0;&#x9AD8;&#x3002;</p>
<p>&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x76EE;&#x6807;&#x662F;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#xFF0C;<strong>&#x80FD;&#x591F;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#x628A;&#x4EFB;&#x4F55;&#x5305;(&#x5305;&#x62EC;&#x7EBF;&#x4E0A;&#x5305;)&#x7684;&#x6570;&#x636E;&#x6539;&#x6210;&#x6211;&#x5E0C;&#x671B;&#x7684;&#x6837;&#x5B50;</strong>&#x3002;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;&#x8FD9;&#x4E2A;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#x4E5F;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;&#x4E00;&#x4E2A;&#x79C1;&#x670D;&#xFF0C;&#x5B83;&#x80FD;&#x591F;&#x83B7;&#x5F97;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x8BF7;&#x6C42;&#x6570;&#x636E;&#x5E76;&#x4F5C;&#x51FA;&#x4FEE;&#x6539;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x83B7;&#x5F97;&#x670D;&#x52A1;&#x7AEF;&#x7684;&#x54CD;&#x5E94;&#x6570;&#x636E;&#x5E76;&#x505A;&#x4FEE;&#x6539;&#x3002;</p>
<h1 id="&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#x5DE5;&#x4F5C;&#x6A21;&#x578B;"><a href="#&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#x5DE5;&#x4F5C;&#x6A21;&#x578B;" class="headerlink" title="&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#x5DE5;&#x4F5C;&#x6A21;&#x578B;"></a>&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#x5DE5;&#x4F5C;&#x6A21;&#x578B;</h1><p>&#x5728;&#x65E9;&#x671F;&#x7248;&#x672C;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x9009;&#x62E9;&#x4E86;&#x7B80;&#x5355;&#x7684; HTTP &#x534F;&#x8BAE;&#x3002;&#x8FD9;&#x79CD;&#x9009;&#x62E9;&#x5BF9;&#x6280;&#x672F;&#x7684;&#x8981;&#x6C42;&#x6700;&#x4F4E;&#xFF0C;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#x4E86;&#x4E00;&#x4E2A;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x5F00;&#x542F; socket&#xFF0C;&#x76D1;&#x542C;&#x7AEF;&#x53E3;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x8BF7;&#x6C42;&#x53D1;&#x9001;&#x7ED9;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x518D;&#x628A;&#x670D;&#x52A1;&#x5668;&#x7684;&#x8FD4;&#x56DE;&#x6570;&#x636E;&#x4F20;&#x56DE;&#x5BA2;&#x6237;&#x7AEF;&#x3002;&#x8FD9;&#x79CD;&#x6A21;&#x5F0F;&#x4E5F;&#x88AB;&#x79F0;&#x4E3A;:&#x201C;&#x4E2D;&#x95F4;&#x4EBA;&#x6A21;&#x5F0F;&#x201D;(MITM: Man In The Middle)&#x3002;</p>
<p>&#x867D;&#x7136;&#x9053;&#x7406;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x4F46;&#x5B9E;&#x73B0;&#x8D77;&#x6765;&#x8FD8;&#x662F;&#x6709;&#x4E9B;&#x5730;&#x65B9;&#x8981;&#x6CE8;&#x610F;&#x3002;&#x9996;&#x5148;&#xFF0C;&#x5F53; socket &#x63A5;&#x53D7;&#x6570;&#x636E;&#x540E;&#xFF0C;&#x5E94;&#x8BE5;&#x65B0;&#x5F00;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;/&#x7EBF;&#x7A0B; &#x8FDB;&#x884C;&#x5904;&#x7406;&#x3002;&#x65E2;&#x7136;&#x6D89;&#x53CA;&#x5230;&#x65B0;&#x7684;&#x8FDB;&#x7A0B;/&#x7EBF;&#x7A0B;&#xFF0C;&#x5C31;&#x4E00;&#x5B9A;&#x8981;&#x6CE8;&#x610F;&#x5B83;&#x7684;&#x91CA;&#x653E;&#x65F6;&#x673A;&#xFF0C;&#x5426;&#x5219;&#x4F1A;&#x5BFC;&#x81F4;&#x5185;&#x5B58;&#x65E0;&#x9650;&#x5236;&#x589E;&#x52A0;&#x3002;</p>
<p>&#x5176;&#x6B21;&#xFF0C;&#x5BF9;&#x4E8E; <code>socket</code> &#x6765;&#x8BF4;&#xFF0C;&#x5B83;&#x5E76;&#x6CA1;&#x6709;&#x7B49;&#x5F85;&#x51FD;&#x6570;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x6211;&#x65E0;&#x4ECE;&#x5F97;&#x77E5;&#x4F55;&#x65F6;&#x6709;&#x6570;&#x636E;&#x53EF;&#x8BFB;&#xFF0C;&#x56E0;&#x6B64;&#x8FD9;&#x4E2A;&#x8270;&#x5DE8;&#x7684;&#x4EFB;&#x52A1;&#x5C31;&#x4EA4;&#x7ED9;&#x4E86; <code>select</code>&#x3002;&#x6211;&#x4EEC;&#x628A;&#x9700;&#x8981;&#x76D1;&#x542C;&#x7684; socket &#x5BF9;&#x8C61;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x4F20;&#x5165;&#x5176;&#x4E2D;&#xFF0C;&#x51FD;&#x6570;&#x4F1A;&#x4E00;&#x76F4;&#x963B;&#x585E;&#xFF0C;&#x76F4;&#x5230;&#x6709;&#x53EF;&#x8BFB;&#x3001;&#x53EF;&#x5199;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x6216;&#x8005;&#x8FBE;&#x5230;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#x3002;</p>
<p><code>Keep-Alive</code> &#x5B57;&#x6BB5;&#x53EF;&#x4EE5;&#x590D;&#x7528; TCP &#x8FDE;&#x63A5;&#xFF0C;&#x662F;&#x4E00;&#x79CD;&#x5E38;&#x89C1;&#x7684; HTTP &#x534F;&#x8BAE;&#x7684;&#x4F18;&#x5316;&#x65B9;&#x5F0F;&#xFF0C;&#x5728; HTTP 1.1 &#x4E2D;&#x5DF2;&#x7ECF;&#x662F;&#x9ED8;&#x8BA4;&#x9009;&#x9879;&#x3002;&#x586B;&#x5199;&#x8FD9;&#x4E2A;&#x5B57;&#x6BB5;&#x540E;&#xFF0C;Server &#x8FD4;&#x56DE;&#x7684;&#x6570;&#x636E;&#x53EF;&#x80FD;&#x662F;&#x5206;&#x6279;&#x6B21;&#x7684;&#xFF0C;&#x8FD9;&#x6837;&#x80FD;&#x591F;&#x6539;&#x5584;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#xFF0C;&#x4F46;&#x4E5F;&#x4F1A;&#x589E;&#x52A0;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#x7684;&#x5B9E;&#x73B0;&#x96BE;&#x5EA6;&#x3002;&#x6240;&#x4EE5;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#x5728;&#x4F5C;&#x4E3A;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x5411;&#x771F;&#x6B63;&#x670D;&#x52A1;&#x5668;&#x8BF7;&#x6C42;&#x6570;&#x636E;&#x65F6;&#xFF0C;&#x5E94;&#x8BE5;&#x5220;&#x9664;&#x8FD9;&#x4E2A;&#x5B57;&#x6BB5;&#x3002;</p>
<p>&#x7531;&#x4E8E;&#x6574;&#x5957;&#x6D41;&#x7A0B;&#x90FD;&#x662F;&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#xFF0C;&#x56E0;&#x6B64;&#x53EF;&#x4EE5;&#x6BD4;&#x8F83;&#x5BB9;&#x6613;&#x7684; HOOK &#x4F4F;&#x4E0A;&#x4E0B;&#x884C;&#x6570;&#x636E;&#x5E76;&#x505A;&#x4FEE;&#x6539;&#x3002;&#x53EA;&#x6709;&#x6CE8;&#x610F;&#x5728;&#x63A5;&#x6536;&#x5230;&#x5168;&#x90E8;&#x6570;&#x636E;&#x540E;&#x518D;&#x505A;&#x4FEE;&#x6539;&#x5373;&#xFF0C;&#x6574;&#x4E2A;&#x6D41;&#x7A0B;&#x53EF;&#x4EE5;&#x7528;&#x4E0B;&#x56FE;&#x7B80;&#x5355;&#x8868;&#x793A;:</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/04f20e9ff731e49eca28be184415047f371173e5011d3c8ab14d6b4e258f5798" alt="&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#x7684;&#x5DE5;&#x4F5C;&#x6A21;&#x5F0F;"></p>
<p>&#x5F53;&#x65F6;&#x505A;&#x5B8C;&#x8FD9;&#x4E00;&#x5957;&#x4E1C;&#x897F;&#x4EE5;&#x540E;&#xFF0C;&#x6211;&#x5728;&#x56E2;&#x961F;&#x5185;&#x90E8;&#x505A;&#x4E86;&#x4E00;&#x6B21;&#x5206;&#x4EAB;&#xFF0C; &#x611F;&#x5174;&#x8DA3;&#x7684;&#x8BFB;&#x8005;&#x53EF;&#x4EE5;&#x53BB; <a href="/external_links/cb35637b7fa833d3e9abb25209611932.html" target="blank" rel="noopener">images.bestswifter.com/Proxy 2.key</a> &#x4E0B;&#x8F7D; PPT&#x3002;</p>
<h1 id="&#x6280;&#x672F;&#x9009;&#x578B;"><a href="#&#x6280;&#x672F;&#x9009;&#x578B;" class="headerlink" title="&#x6280;&#x672F;&#x9009;&#x578B;"></a>&#x6280;&#x672F;&#x9009;&#x578B;</h1><h2 id="&#x77ED;&#x8FDE;&#x63A5;"><a href="#&#x77ED;&#x8FDE;&#x63A5;" class="headerlink" title="&#x77ED;&#x8FDE;&#x63A5;"></a>&#x77ED;&#x8FDE;&#x63A5;</h2><p>&#x7531;&#x4E8E;&#x957F;&#x8FDE;&#x63A5;&#x57FA;&#x4E8E; TCP&#xFF0C;&#x4E0D;&#x7528;&#x6BCF;&#x6B21;&#x65B0;&#x5EFA;&#x8FDE;&#x63A5;&#xFF0C;&#x4E5F;&#x7701;&#x7565;&#x4E86;&#x4E0D;&#x5FC5;&#x8981;&#x7684; HTTP &#x62A5;&#x6587;&#x5934;&#x90E8;&#xFF0C;&#x6548;&#x7387;&#x660E;&#x663E;&#x4F18;&#x4E8E; HTTP&#x3002;&#x6240;&#x4EE5;&#x5404;&#x5927;&#x516C;&#x53F8;&#x57FA;&#x672C;&#x4E0A;&#x9009;&#x62E9;&#x4E86;&#x957F;&#x8FDE;&#x63A5;&#x4F5C;&#x4E3A;&#x5B9E;&#x9645;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E0B;&#x7684;&#x8FDE;&#x63A5;&#x65B9;&#x5F0F;&#x3002;&#x7136;&#x800C;&#x7531;&#x4E8E;&#x4E0D;&#x719F;&#x6089; WebSocket &#x534F;&#x8BAE;&#xFF0C;&#x5E76;&#x4E14;&#x6211;&#x4EEC;&#x4F9D;&#x7136;&#x652F;&#x6301;&#x77ED;&#x8FDE;&#x63A5;&#xFF0C;&#x6240;&#x4EE5;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#x6700;&#x7EC8;&#x9009;&#x62E9;&#x4E86; HTTP &#x534F;&#x8BAE;&#x3002;</p>
<p>&#x8981;&#x60F3;&#x5B9E;&#x73B0;&#x8FD9;&#x4E00;&#x70B9;&#xFF0C; &#x5C31;&#x5F97;&#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#xFF0C;&#x6A21;&#x62DF;&#x540E;&#x53F0;&#x5411;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x4E00;&#x6BB5;&#x63A7;&#x5236;&#x4FE1;&#x606F;&#xFF0C;&#x5F3A;&#x5236;&#x5BA2;&#x6237;&#x7AEF;&#x9009;&#x62E9; HTTP &#x8BF7;&#x6C42;&#x3002;&#x8FD9;&#x6837;&#x4E00;&#x6765;&#xFF0C;&#x5373;&#x4F7F;&#x662F;&#x7EBF;&#x4E0A;&#x5305;&#x4E5F;&#x53EF;&#x4EE5;&#x8D70;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#x3002;</p>
<h2 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h2><p>&#x7531;&#x4E8E;&#x82F9;&#x679C;&#x5F3A;&#x5236;&#x8981;&#x6C42;&#x4F7F;&#x7528; HTTPS&#xFF0C;&#x867D;&#x7136;&#x5DF2;&#x7ECF;&#x5EF6;&#x671F;&#xFF0C;&#x4F46;&#x4E5F;&#x662F;&#x660E;&#x5E74;&#x7684;&#x8D8B;&#x52BF;&#x3002;&#x8003;&#x8651;&#x5230;&#x540E;&#x7EED;&#x7684;&#x4F7F;&#x7528;&#xFF0C;&#x6211;&#x4EEC;&#x51B3;&#x5B9A;&#x5BF9;&#x4E4B;&#x524D;&#x5B9E;&#x73B0;&#x7684;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#x8FDB;&#x884C;&#x5347;&#x7EA7;&#x3002;&#x7531;&#x4E8E; HTTPS &#x6D89;&#x53CA;&#x5230;&#x8BF7;&#x6C42;&#x534F;&#x8BAE;&#x7684;&#x89E3;&#x6790;&#xFF0C;&#x4EE5;&#x53CA;&#x52A0;&#x5BC6;&#x89E3;&#x5BC6;&#x548C;&#x8BC1;&#x4E66;&#x7BA1;&#x7406;&#xFF0C;&#x4E0A;&#x8FF0;&#x81EA;&#x7814;&#x65B9;&#x6848;&#x5F88;&#x96BE; hold &#x4F4F;&#x3002;&#x7ECF;&#x8FC7;&#x4E00;&#x756A;&#x8C03;&#x7814;&#xFF0C;&#x6700;&#x540E;&#x9009;&#x62E9;&#x4E86;&#x4E00;&#x4E2A;&#x6BD4;&#x8F83;&#x77E5;&#x540D;&#x7684;&#x5F00;&#x6E90;&#x5E93; <a href="/external_links/2f578a8f52c4e59451a10319ae372885.html" target="blank" rel="noopener">mitmproxy</a>&#x3002;</p>
<h1 id="Mitmproxy"><a href="#Mitmproxy" class="headerlink" title="Mitmproxy"></a>Mitmproxy</h1><p>&#x9009;&#x62E9;&#x8FD9;&#x4E2A;&#x5E93;&#x6700;&#x4E3B;&#x8981;&#x7684;&#x7406;&#x7531;&#x662F;&#x5B83;&#x76F4;&#x63A5;&#x652F;&#x6301; HTTPS&#xFF0C;&#x4E0D;&#x8FC7;&#x6CA1;&#x6709;&#x4E2D;&#x6587;&#x6587;&#x6863;&#xFF0C;&#x56FD;&#x5185;&#x7684;&#x4F7F;&#x7528;&#x76F8;&#x5BF9;&#x6765;&#x8BF4;&#x6BD4;&#x8F83;&#x5C11;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x63A5;&#x5165;&#x7684;&#x65F6;&#x5019;&#x53EF;&#x80FD;&#x4F1A;&#x7565;&#x82B1;&#x4E00;&#x70B9;&#x65F6;&#x95F4;&#x3002;</p>
<p>&#x8FD9;&#x662F;&#x4E00;&#x4E2A; python &#x5E93;&#xFF0C; &#x9996;&#x5148;&#x8981;&#x5B89;&#x88C5; <code>virtualenv</code>&#xFF0C;&#x5982;&#x679C;&#x672C;&#x5730;&#x6CA1;&#x88C5;&#x7684;&#x8BDD;&#x8F93;&#x5165;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;sudo pip install virtualenv</span><br></pre></td></tr></table></figure>

<p>&#x5B89;&#x88C5;&#x597D;&#x4E86;&#x4EE5;&#x540E;&#xFF0C;&#x8FDB;&#x5165; <code>mitmproxy/venv3.5/bin</code> &#x6587;&#x4EF6;&#x5939;&#x8F93;&#x5165;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;source ./active</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x6837;&#x5C31;&#x53EF;&#x4EE5;&#x542F;&#x7528; virtualenv &#x73AF;&#x5883;&#x4E86;&#x3002;</p>
<h2 id="Hook-&#x811A;&#x672C;"><a href="#Hook-&#x811A;&#x672C;" class="headerlink" title="Hook &#x811A;&#x672C;"></a>Hook &#x811A;&#x672C;</h2><p>&#x8FD9;&#x4E2A;&#x5E93;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;&#x547D;&#x4EE4;&#x884C;&#x4E2D;&#x53EF;&#x4EA4;&#x4E92;&#x7248;&#x672C;&#x7684; Charles&#xFF0C;&#x4E0D;&#x8FC7;&#x6211;&#x5E76;&#x4E0D;&#x6253;&#x7B97;&#x7528;&#x5B83;&#x7684;&#x8FD9;&#x4E2A;&#x529F;&#x80FD;&#x3002;&#x56E0;&#x4E3A;&#x6211;&#x7684;&#x9700;&#x6C42;&#x4E3B;&#x8981;&#x662F;&#x5229;&#x7528;&#x811A;&#x672C;&#x6765; Hook &#x8BF7;&#x6C42;&#xFF0C; &#x6240;&#x4EE5;&#x6211;&#x9009;&#x62E9;&#x4E86; mitmdump &#x8FD9;&#x4E2A;&#x5DE5;&#x5177;&#x3002;&#x4F7F;&#x7528;&#x5B83;&#x7684;&#x65F6;&#x5019;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x811A;&#x672C;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;mitmdump -s &quot;xxx.py&quot;</span><br></pre></td></tr></table></figure>

<p>&#x811A;&#x672C;&#x4E5F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x91CD;&#x5199; <code>requeest</code> &#x6216;&#x8005; <code>receive</code> &#x51FD;&#x6570;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;def request(flow):</span><br><span class="line">flow.response.content = &quot;&lt;p&gt;hello world&lt;/p&gt;&quot;</span><br></pre></td></tr></table></figure>

<p>&#x8FD0;&#x884C;&#x811A;&#x672C;&#x4EE5;&#x540E;&#xFF0C;&#x628A;&#x624B;&#x673A;&#x7684;&#x4EE3;&#x7406;&#x8BBE;&#x4E3A;&#x672C;&#x673A; ip &#x5730;&#x5740;&#xFF0C;&#x7AEF;&#x53E3;&#x53F7;&#x6539;&#x4E3A; 8080&#xFF0C;&#x7136;&#x540E;&#x7528;&#x624B;&#x673A;&#x6D4F;&#x89C8;&#x5668;&#x6253;&#x5F00; <a href="/external_links/3d840a1caec92cc5dff274658a93c079.html" target="blank" rel="noopener">mitm.it/</a>&#xFF0C;&#x5982;&#x679C;&#x4E00;&#x5207;&#x914D;&#x7F6E;&#x987A;&#x5229;&#xFF0C;&#x4F60;&#x4F1A;&#x770B;&#x5230;&#x8BC1;&#x4E66;&#x7684;&#x5B89;&#x88C5;&#x754C;&#x9762;&#x3002;</p>
<p>&#x5B89;&#x88C5;&#x597D;&#x8BC1;&#x4E66;&#x540E;&#xFF0C;&#x7528;&#x624B;&#x673A;&#x8BBF;&#x95EE;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x7F51;&#x7AD9;(&#x5305;&#x62EC; HTTPS)&#xFF0C;&#x4F60;&#x5E94;&#x8BE5;&#x90FD;&#x4F1A;&#x770B;&#x5230;&#x4E00;&#x4E2A;&#x5C0F;&#x5C0F;&#x7684; <code>hello world</code>&#xFF0C;&#x81F3;&#x6B64;&#x6240;&#x6709;&#x7684;&#x914D;&#x7F6E;&#x5C31;&#x5B8C;&#x6210;&#x4E86;&#x3002;</p>
<h2 id="bug-&#x4FEE;&#x6539;"><a href="#bug-&#x4FEE;&#x6539;" class="headerlink" title="bug &#x4FEE;&#x6539;"></a>bug &#x4FEE;&#x6539;</h2><p>&#x8FD9;&#x4E2A;&#x5F00;&#x6E90;&#x5E93;&#x6709;&#x4E00;&#x4E2A;&#x5F88;&#x4E25;&#x91CD;&#x7684; bug&#xFF0C;&#x5728;&#x89E3;&#x6790; multipart &#x7C7B;&#x578B;&#x7684;&#x6570;&#x636E;&#x65F6;&#x53EF;&#x80FD;&#x4F1A;&#x53D1;&#x751F;&#x3002;&#x5B83;&#x4F7F;&#x7528;&#x4E86; <code>splitline</code> &#x65B9;&#x6CD5;&#x6765;&#x5206;&#x5272;&#x6362;&#x884C;&#x7B26;&#xFF0C;&#x7136;&#x800C;&#x5982;&#x679C;&#x6570;&#x636E;&#x4E2D;&#x6709; <code>\n</code> &#x7684;&#x8BDD;&#xFF0C;&#x5C31;&#x4F1A;&#x56E0;&#x6B64;&#x4E22;&#x5931;&#x3002;&#x5F88;&#x4E0D;&#x5E78;&#x7684;&#x662F;&#xFF0C;&#x5F88;&#x591A; protobuf &#x7F16;&#x7801;&#x540E;&#x7684;&#x6570;&#x636E;&#x90FD;&#x6709; <code>\n</code>&#xFF0C;&#x4E00;&#x65E6;&#x4E22;&#x5931;&#x5C31;&#x4F1A;&#x5BFC;&#x81F4;&#x89E3;&#x6790;&#x5931;&#x8D25;&#x3002;</p>
<p>&#x5982;&#x679C;&#x4F60;&#x4E0D;&#x5E78;&#x9047;&#x5230;&#x4E86;&#x548C;&#x6211;&#x4E00;&#x6837;&#x7684;&#x5751;&#xFF0C;&#x53EF;&#x4EE5;&#x628A;&#x76F8;&#x5173;&#x4EE3;&#x7801;&#x6539;&#x6210;&#x6211;&#x7684;&#x7248;&#x672C;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;for i in content.split(b&quot;--&quot; + boundary):</span><br><span class="line">parts = i.split(b&apos;\r\n\r\n&apos;, 2)</span><br><span class="line">if len(parts) &gt; 1 and parts[0][0:2] != b&quot;--&quot;:</span><br><span class="line">match = rx.search(parts[0])</span><br><span class="line">if match:</span><br><span class="line">key = match.group(1)</span><br><span class="line">value = parts[1][0:len(parts[1])-2] # Remove last \r\n</span><br><span class="line">r.append((key, value))</span><br></pre></td></tr></table></figure>

<h2 id="More"><a href="#More" class="headerlink" title="More"></a>More</h2><p>&#x5230;&#x4E86;&#x8FD9;&#x4E00;&#x6B65;&#xFF0C;&#x57FA;&#x672C;&#x4E0A;&#x5DF2;&#x7ECF;&#x6210;&#x529F;&#x5B9E;&#x73B0;&#x652F;&#x6301; HTTPS &#x7684;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#x4E86;&#x3002;&#x540E;&#x7EED;&#x8981;&#x5904;&#x7406;&#x7684;&#x53EF;&#x80FD;&#x5C31;&#x662F;&#x89E3;&#x6790; protobuf&#xFF0C;&#x5B8C;&#x5584;&#x4E1A;&#x52A1;&#x4EE3;&#x7801;&#x7B49;&#x7B49;&#x7410;&#x788E;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x53EA;&#x8981;&#x5C0F;&#x5FC3;&#x8C28;&#x614E;&#xFF0C;&#x57FA;&#x672C;&#x4E0A;&#x4E0D;&#x4F1A;&#x6709;&#x95EE;&#x9898;&#x3002;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/c655d311fc32973fd01a7b1ca04438fb.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903522639544334.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903522639544334.html" itemprop="url">Nodejs 中遇到含空格 URL 的神奇“Bug”——小</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-13T17:07:41+08:00">
                2017-12-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><a href="/external_links/396070a860be2f2cac3b71cc0d3f7430.html" target="blank" rel="noopener">&#x672C;&#x6587;</a>&#x9996;&#x53D1;&#x4E8E;&#x77E5;&#x4E4E;&#x4E13;&#x680F;<a href="/external_links/303a163ec7f63284c65ee0f4d933c11f.html" target="blank" rel="noopener">&#x8682;&#x8681;&#x91D1;&#x670D;&#x4F53;&#x9A8C;&#x79D1;&#x6280;</a>&#x3002;</p>
</blockquote>
<p>&#x9996;&#x5148;&#x58F0;&#x660E;&#xFF0C;&#x6211;&#x5728;&#x201C;Bug&#x201D;&#x5B57;&#x773C;&#x4E0A;&#x52A0;&#x4E86;&#x5F15;&#x53F7;&#xFF0C;&#x81EA;&#x7136;&#x662F;&#x4E3A;&#x4E86;&#x8BF4;&#x660E;&#x5B83;&#x5E76;&#x975E;&#x4E00;&#x4E2A;&#x771F; Bug&#x3002;</p>
<h2 id="&#x95EE;&#x9898;&#x629B;&#x51FA;"><a href="#&#x95EE;&#x9898;&#x629B;&#x51FA;" class="headerlink" title="&#x95EE;&#x9898;&#x629B;&#x51FA;"></a>&#x95EE;&#x9898;&#x629B;&#x51FA;</h2><p>&#x6628;&#x5929;&#x6709;&#x4E2A;&#x7AE5;&#x978B;&#x5728;&#x770B;&#x540E;&#x53F0;&#x76D1;&#x63A7;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x7A81;&#x7136;&#x53D1;&#x73B0;&#x4E86;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yaml&#x590D;&#x5236;&#x4EE3;&#x7801;[error] 000001#0: ... upstream prematurely closed connection while reading response header from upstream.</span><br><span class="line">  client: 10.10.10.10</span><br><span class="line">  server: foo.com</span><br><span class="line">  request: &quot;GET /foo/bar?rmicmd,begin run clean docker images job HTTP/1.1&quot;</span><br><span class="line">  upstream: &quot;http://...&quot;</span><br></pre></td></tr></table></figure>

<p>&#x5927;&#x6982;&#x610F;&#x601D;&#x5C31;&#x662F;&#x8BF4;&#xFF1A;&#x4E00;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x901A;&#x8FC7; HTTP &#x534F;&#x8BAE;&#x53BB;&#x8BF7;&#x6C42;&#x53E6;&#x4E00;&#x53F0;&#x670D;&#x52A1;&#x5668;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5355;&#x65B9;&#x9762;&#x88AB;&#x5BF9;&#x65B9;&#x670D;&#x52A1;&#x5668;&#x65AD;&#x5F00;&#x4E86;&#x8FDE;&#x63A5;&#x2014;&#x2014;&#x5E76;&#x4E14;&#x5E76;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x8FD4;&#x56DE;&#x3002;</p>
<h2 id="&#x5F00;&#x59CB;&#x91CD;&#x73B0;"><a href="#&#x5F00;&#x59CB;&#x91CD;&#x73B0;" class="headerlink" title="&#x5F00;&#x59CB;&#x91CD;&#x73B0;"></a>&#x5F00;&#x59CB;&#x91CD;&#x73B0;</h2><h3 id="&#x5BA2;&#x6237;&#x7AEF;-CURL-&#x6307;&#x4EE4;"><a href="#&#x5BA2;&#x6237;&#x7AEF;-CURL-&#x6307;&#x4EE4;" class="headerlink" title="&#x5BA2;&#x6237;&#x7AEF; CURL &#x6307;&#x4EE4;"></a>&#x5BA2;&#x6237;&#x7AEF; CURL &#x6307;&#x4EE4;</h3><p>&#x5176;&#x5B9E;&#x8FD9;&#x6B21;&#x8BF7;&#x6C42;&#x7684;&#x4E00;&#x4E9B;&#x732B;&#x817B;&#x5F88;&#x5BB9;&#x6613;&#x5C31;&#x80FD;&#x53D1;&#x73B0;&#x2014;&#x2014;&#x5728; URL &#x4E2D;&#x6709;&#x7A7A;&#x683C;&#x3002;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x80FD;&#x7B80;&#x5316;&#x51FA;&#x4E00;&#x6761;&#x6700;&#x7B80;&#x5355;&#x7684; CURL &#x6307;&#x4EE4;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh&#x590D;&#x5236;&#x4EE3;&#x7801;$ curl &quot;http://foo/bar baz&quot; -v</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>&#x6CE8;&#x610F;</strong>&#xFF1A;&#x4E0D;&#x5E26;&#x4EFB;&#x4F55;&#x8F6C;&#x4E49;&#x3002;</p>
</blockquote>
<h3 id="&#x6700;&#x5C0F;-Node-js-&#x6E90;&#x7801;"><a href="#&#x6700;&#x5C0F;-Node-js-&#x6E90;&#x7801;" class="headerlink" title="&#x6700;&#x5C0F; Node.js &#x6E90;&#x7801;"></a>&#x6700;&#x5C0F; Node.js &#x6E90;&#x7801;</h3><p>&#x597D;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x63A5;&#x4E0B;&#x53BB;&#x5F00;&#x59CB;&#x5199;&#x76F8;&#x5E94;&#x7684;&#x6700;&#x7B80;&#x5355;&#x7684; Node.js HTTP &#x670D;&#x52A1;&#x7AEF;&#x6E90;&#x7801;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">js&#x590D;&#x5236;&#x4EE3;&#x7801;&apos;use strict&apos;;</span><br><span class="line"></span><br><span class="line">const http = require(&apos;http&apos;);</span><br><span class="line"></span><br><span class="line">const server = http.createServer(function(req, resp) {</span><br><span class="line">    console.log(&apos;&#x1F31A;&apos;);</span><br><span class="line">    resp.end(&apos;hello world&apos;);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">server.listen(5555);</span><br></pre></td></tr></table></figure>

<p>&#x5927;&#x529F;&#x544A;&#x6210;&#xFF0C;&#x542F;&#x52A8;&#x8FD9;&#x6BB5; Node.js &#x4EE3;&#x7801;&#xFF0C;&#x5F00;&#x59CB;&#x8BD5;&#x8BD5;&#x770B;&#x4E0A;&#x9762;&#x7684;&#x6307;&#x4EE4;&#x5427;&#x3002;</p>
<p>&#x5982;&#x679C;&#x4F60;&#x4E5F;&#x6B63;&#x5728;&#x8DDF;&#x7740;&#x5C1D;&#x8BD5;&#x8FD9;&#x4EF6;&#x4E8B;&#x60C5;&#x7684;&#x8BDD;&#xFF0C;&#x4F60;&#x5C31;&#x4F1A;&#x53D1;&#x73B0; Node.js &#x7684;&#x547D;&#x4EE4;&#x884C;&#x6CA1;&#x6709;&#x8F93;&#x51FA;&#x4EFB;&#x4F55;&#x4FE1;&#x606F;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x5632;&#x8BBD;&#x7684; <code>&apos;&#x1F31A;&apos;</code>&#xFF0C;&#x800C;&#x5728; CURL &#x7684;&#x7ED3;&#x679C;&#x4E2D;&#xFF0C;&#x4F60;&#x5C06;&#x4F1A;&#x770B;&#x89C1;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">shell&#x590D;&#x5236;&#x4EE3;&#x7801;$ curl &apos;http://127.0.0.1:5555/d d&apos; -v</span><br><span class="line">*   Trying 127.0.0.1...</span><br><span class="line">* TCP_NODELAY set</span><br><span class="line">* Connected to 127.0.0.1 (127.0.0.1) port 5555 (#0)</span><br><span class="line">&gt; GET /d d HTTP/1.1</span><br><span class="line">&gt; Host: 127.0.0.1:5555</span><br><span class="line">&gt; User-Agent: curl/7.54.0</span><br><span class="line">&gt; Accept: */*</span><br><span class="line">&gt;</span><br><span class="line">* Empty reply from server</span><br><span class="line">* Connection #0 to host 127.0.0.1 left intact</span><br><span class="line">curl: (52) Empty reply from server</span><br></pre></td></tr></table></figure>

<p>&#x77A7;&#xFF0C;<strong>Empty reply from server</strong>&#x3002;</p>
<h3 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h3><p>&#x53D1;&#x73B0;&#x4E86;&#x95EE;&#x9898;&#x4E4B;&#x540E;&#xFF0C;&#x5C31;&#x6709;&#x53E6;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#x503C;&#x5F97;&#x601D;&#x8003;&#x4E86;&#xFF1A;&#x5C31; Node.js &#x4F1A;&#x51FA;&#x73B0;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x5462;&#xFF0C;&#x8FD8;&#x662F;&#x5176;&#x5B83;&#x4E00;&#x4E9B; HTTP &#x670D;&#x52A1;&#x5668;&#x4E5F;&#x4F1A;&#x6709;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x5462;&#x3002;</p>
<p>&#x4E8E;&#x662F;&#x62FF;&#x5C0F;&#x767D;&#x9F20; Nginx &#x505A;&#x4E86;&#x4E2A;&#x5B9E;&#x9A8C;&#x3002;&#x6211;&#x5199;&#x4E86;&#x8FD9;&#x4E48;&#x4E00;&#x4E2A;&#x914D;&#x7F6E;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">nginx&#x590D;&#x5236;&#x4EE3;&#x7801;server {</span><br><span class="line">    listen 5555;</span><br><span class="line"></span><br><span class="line">    location / {</span><br><span class="line">        return 200 $uri;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x63A5;&#x7740;&#x4E5F;&#x6267;&#x884C;&#x4E00;&#x904D; CURL&#xFF0C;&#x5F97;&#x5230;&#x4E86;&#x5982;&#x4E0B;&#x7684;&#x7ED3;&#x679C;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">yaml&#x590D;&#x5236;&#x4EE3;&#x7801;$ curl &apos;http://127.0.0.1:5555/d d&apos; -v</span><br><span class="line">*   Trying 127.0.0.1...</span><br><span class="line">* TCP_NODELAY set</span><br><span class="line">* Connected to 127.0.0.1 (127.0.0.1) port 5555 (#0)</span><br><span class="line">&gt; GET /d d HTTP/1.1</span><br><span class="line">&gt; Host: 127.0.0.1:5555</span><br><span class="line">&gt; User-Agent: curl/7.54.0</span><br><span class="line">&gt; Accept: */*</span><br><span class="line">&gt;</span><br><span class="line">&lt; HTTP/1.1 200 OK</span><br><span class="line">&lt; Server: openresty/1.11.2.1</span><br><span class="line">&lt; Date: Tue, 12 Dec 2017 09:07:56 GMT</span><br><span class="line">&lt; Content-Type: application/octet-stream</span><br><span class="line">&lt; Content-Length: 4</span><br><span class="line">&lt; Connection: keep-alive</span><br><span class="line">&lt;</span><br><span class="line">* Connection #0 to host xcoder.in left intact</span><br><span class="line">/d d</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/afb065ae7869b393cd18cde2c1598836d55c9b0d075e97513f4a4fa4669ffb4a" alt><br>&#x5389;&#x5BB3;&#x4E86;&#xFF0C;&#x6211;&#x7684; Nginx<br>&#x4E8E;&#x662F;&#x4E4E;&#xFF0C;&#x7406;&#x6240;&#x5F53;&#x7136;&#xFF0C;&#x6211;<strong>&#x6682;&#x65F6;</strong>&#x5C06;&#x8FD9;&#x4E2A;&#x4E8B;&#x4EF6;&#x5B9A;&#x6027;&#x4E3A; Node.js &#x7684;&#x4E00;&#x4E2A; Bug&#x3002;</p>
<h2 id="Node-js-&#x6E90;&#x7801;&#x6392;&#x67E5;"><a href="#Node-js-&#x6E90;&#x7801;&#x6392;&#x67E5;" class="headerlink" title="Node.js &#x6E90;&#x7801;&#x6392;&#x67E5;"></a>Node.js &#x6E90;&#x7801;&#x6392;&#x67E5;</h2><p>&#x8BA4;&#x5B9A;&#x4E86;&#x5B83;&#x662F;&#x4E2A; Bug &#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x5C31;&#x5F00;&#x59CB;&#x4E86;&#x4E00;&#x8D2F;&#x7684;&#x770B;&#x6E90;&#x7801;&#x73AF;&#x8282;&#x2014;&#x2014;&#x7531;&#x4E8E;&#x8FD9;&#x4E2A; Bug &#x7684;&#x590D;&#x73B0;&#x6761;&#x4EF6;&#x6BD4;&#x8F83;&#x660E;&#x663E;&#xFF0C;&#x6211;&#x6682;&#x65F6;&#x5C06;&#x5176;&#x5B9A;&#x6027;&#x4E3A;&#x201C;Node.js HTTP &#x670D;&#x52A1;&#x7AEF;&#x6A21;&#x5757;&#x5728;&#x63A5;&#x5230;&#x8BF7;&#x6C42;&#x540E;&#x89E3;&#x6790; HTTP &#x6570;&#x636E;&#x5305;&#x7684;&#x65F6;&#x5019;&#x89E3;&#x6790; URI &#x65F6;&#x51FA;&#x4E86;&#x95EE;&#x9898;&#x201D;&#x3002;</p>
<h3 id="http-js-gt-http-server-js-gt-http-common-js"><a href="#http-js-gt-http-server-js-gt-http-common-js" class="headerlink" title="http.js -&gt; _http_server.js -&gt; _http_common.js"></a>http.js -&gt; _http_server.js -&gt; _http_common.js</h3><blockquote>
<p>&#x6E90;&#x7801;&#x4EE5; <a href="/external_links/c68d19c6b4ac60d669a02c1bc44896a8.html" target="blank" rel="noopener">Node.js 8.9.2</a> &#x4E3A;&#x51C6;&#x3002;</p>
</blockquote>
<p>&#x8FD9;&#x91CC;&#x5148;&#x9884;&#x7559;&#x4E00;&#x4E0B;&#x6211;&#x4EEC;&#x80FD;&#x9A6C;&#x4E0A;&#x60F3;&#x5230;&#x7684; <strong>node_http_parser.cc</strong>&#xFF0C;&#x800C;&#x5148;&#x8BB2;&#x8FD9;&#x51E0;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x662F;&#x6709;&#x539F;&#x56E0;&#x7684;&#x2014;&#x2014;&#x8FD9;&#x6D89;&#x53CA;&#x5230;&#x6700;&#x540E;&#x7684;&#x4E00;&#x4E2A;&#x5E94;&#x5BF9;&#x65B9;&#x5F0F;&#x3002;</p>
<p>&#x9996;&#x5148;&#x770B;&#x770B; <a href="/external_links/82bebbefc17c3aafd4449130749b3d92.html" target="blank" rel="noopener"><strong>lib/http.js</strong></a> &#x7684;&#x76F8;&#x5E94;&#x6E90;&#x7801;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">js&#x590D;&#x5236;&#x4EE3;&#x7801;...</span><br><span class="line">const server = require(&apos;_http_server&apos;);</span><br><span class="line"></span><br><span class="line">const { Server } = server;</span><br><span class="line"></span><br><span class="line">function createServer(requestListener) {</span><br><span class="line">  return new Server(requestListener);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x90A3;&#x4E48;&#xFF0C;&#x9A6C;&#x4E0A;&#x8FDB;&#x5165; <strong>lib/_http_server.js</strong> &#x770B;&#x5427;&#x3002;</p>
<p>&#x9996;&#x5148;&#x662F;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; HttpParser &#x5E76;&#x7ED1;&#x4E0A;&#x76D1;&#x542C;&#x83B7;&#x53D6;&#x5230; HTTP &#x6570;&#x636E;&#x5305;&#x540E;&#x89E3;&#x6790;&#x7ED3;&#x679C;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x7684;&#x4EE3;&#x7801;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">js&#x590D;&#x5236;&#x4EE3;&#x7801;const {</span><br><span class="line">  parsers,</span><br><span class="line">  ...</span><br><span class="line">} = require(&apos;_http_common&apos;);</span><br><span class="line"></span><br><span class="line">function connectionListener(socket) {</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  var parser = parsers.alloc();</span><br><span class="line">  parser.reinitialize(HTTPParser.REQUEST);</span><br><span class="line">  parser.socket = socket;</span><br><span class="line">  socket.parser = parser;</span><br><span class="line">  parser.incoming = null;</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  state.onData = socketOnData.bind(undefined, this, socket, parser, state);</span><br><span class="line">  ...</span><br><span class="line">  socket.on(&apos;data&apos;, state.onData);</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">function socketOnData(server, socket, parser, state, d) {</span><br><span class="line">  assert(!socket._paused);</span><br><span class="line">  debug(&apos;SERVER socketOnData %d&apos;, d.length);</span><br><span class="line"></span><br><span class="line">  var ret = parser.execute(d);</span><br><span class="line">  onParserExecuteCommon(server, socket, parser, state, ret, d);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4ECE;&#x6E90;&#x7801;&#x4E2D;&#x6587;&#x6211;&#x4EEC;&#x80FD;&#x770B;&#x5230;&#xFF0C;&#x5F53;&#x4E00;&#x4E2A; HTTP &#x8BF7;&#x6C42;&#x8FC7;&#x6765;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x76D1;&#x542C;&#x51FD;&#x6570; <code>connectionListener()</code> &#x4F1A;&#x62FF;&#x7740; Socket &#x5BF9;&#x8C61;&#x52A0;&#x4E0A;&#x4E00;&#x4E2A; <code>data</code> &#x4E8B;&#x4EF6;&#x76D1;&#x542C;&#x2014;&#x2014;&#x4E00;&#x65E6;&#x6709;&#x8BF7;&#x6C42;&#x8FDE;&#x63A5;&#x8FC7;&#x6765;&#xFF0C;&#x5C31;&#x53BB;&#x6267;&#x884C; <code>socketOnData()</code> &#x51FD;&#x6570;&#x3002;</p>
<p>&#x800C;&#x5728; <code>socketOnData()</code> &#x51FD;&#x6570;&#x4E2D;&#xFF0C;&#x505A;&#x7684;&#x4E3B;&#x8981;&#x4E8B;&#x60C5;&#x5C31;&#x662F; <code>parser.execute(d)</code> &#x6765;&#x89E3;&#x6790; HTTP &#x6570;&#x636E;&#x5305;&#xFF0C;&#x5728;&#x89E3;&#x6790;&#x5B8C;&#x6210;&#x540E;&#x6267;&#x884C;&#x4E00;&#x4E0B;&#x56DE;&#x8C03;&#x51FD;&#x6570; <code>onParserExecuteCommon()</code>&#x3002;</p>
<p>&#x81F3;&#x4E8E;&#x8FD9;&#x4E2A; <code>parser</code>&#xFF0C;&#x6211;&#x4EEC;&#x80FD;&#x770B;&#x5230;&#x5B83;&#x662F;&#x4ECE; <a href="/external_links/a3d2ad1b2994e6d80776144afa89caa6.html" target="blank" rel="noopener"><strong>lib/_http_common.js</strong></a> &#x4E2D;&#x6765;&#x7684;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">js&#x590D;&#x5236;&#x4EE3;&#x7801;var parsers = new FreeList(&apos;parsers&apos;, 1000, function() {</span><br><span class="line">  var parser = new HTTPParser(HTTPParser.REQUEST);</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  parser[kOnHeaders] = parserOnHeaders;</span><br><span class="line">  parser[kOnHeadersComplete] = parserOnHeadersComplete;</span><br><span class="line">  parser[kOnBody] = parserOnBody;</span><br><span class="line">  parser[kOnMessageComplete] = parserOnMessageComplete;</span><br><span class="line">  parser[kOnExecute] = null;</span><br><span class="line"></span><br><span class="line">  return parser;</span><br><span class="line">});</span><br></pre></td></tr></table></figure>

<p>&#x80FD;&#x770B;&#x51FA;&#x6765; <code>parsers</code> &#x662F; <code>HTTPParser</code> &#x7684;&#x4E00;&#x6761; Free List&#xFF08;&#x6548;&#x679C;&#x7C7B;&#x4F3C;&#x4E8E;&#x6700;&#x7B80;&#x6613;&#x7684;&#x52A8;&#x6001;&#x5185;&#x5B58;&#x6C60;&#xFF09;&#xFF0C;&#x6BCF;&#x4E2A; Parser &#x5728;&#x521D;&#x59CB;&#x5316;&#x7684;&#x65F6;&#x5019;&#x7ED1;&#x5B9A;&#x4E0A;&#x4E86;&#x5404;&#x79CD;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x3002;&#x5177;&#x4F53;&#x7684;&#x4E00;&#x4E9B;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x5C31;&#x4E0D;&#x7EC6;&#x8BB2;&#x4E86;&#xFF0C;&#x6709;&#x5174;&#x8DA3;&#x7684;&#x7AE5;&#x978B;&#x53EF;&#x81EA;&#x884C;&#x7FFB;&#x9605;&#x3002;</p>
<p>&#x8FD9;&#x4E48;&#x4E00;&#x6765;&#xFF0C;&#x94FE;&#x8DEF;&#x5C31;&#x6BD4;&#x8F83;&#x660E;&#x6670;&#x4E86;&#xFF1A;</p>
<p><strong>&#x8BF7;&#x6C42;&#x8FDB;&#x6765;&#x7684;&#x65F6;&#x5019;&#xFF0C;Server &#x5BF9;&#x8C61;&#x4F1A;&#x4E3A;&#x8BE5;&#x6B21;&#x8BF7;&#x6C42;&#x7684; Socket &#x5206;&#x914D;&#x4E00;&#x4E2A; <code>HttpParser</code> &#x5BF9;&#x8C61;&#xFF0C;&#x5E76;&#x8C03;&#x7528;&#x5176; <code>execute()</code> &#x51FD;&#x6570;&#x8FDB;&#x884C;&#x89E3;&#x6790;&#xFF0C;&#x5728;&#x89E3;&#x6790;&#x5B8C;&#x6210;&#x540E;&#x8C03;&#x7528; <code>onParserExecuteCommon()</code> &#x51FD;&#x6570;&#x3002;</strong></p>
<h3 id="node-http-parser-cc"><a href="#node-http-parser-cc" class="headerlink" title="node_http_parser.cc"></a>node_http_parser.cc</h3><p>&#x6211;&#x4EEC;&#x5728; <strong>lib/_http_common.js</strong> &#x4E2D;&#x80FD;&#x53D1;&#x73B0;&#xFF0C;<code>HTTPParser</code> &#x7684;&#x5B9E;&#x73B0;&#x5B58;&#x5728;&#x4E8E; <strong>src/node_http_parser.cc</strong> &#x4E2D;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">js&#x590D;&#x5236;&#x4EE3;&#x7801;const binding = process.binding(&apos;http_parser&apos;);</span><br><span class="line">const { methods, HTTPParser } = binding;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&#x81F3;&#x4E8E;&#x4E3A;&#x4EC0;&#x4E48; <code>const binding = process.binding(&apos;http_parser&apos;)</code> &#x5C31;&#x662F;&#x5BF9;&#x5E94;&#x5230; <strong>src/node_http_parser.cc</strong> &#x6587;&#x4EF6;&#xFF0C;&#x4EE5;&#x53CA;&#x8FD9;&#x4E00;&#x5C0F;&#x8282;&#x4E2D;&#x4E0B;&#x9762;&#x7684;&#x4E00;&#x4E9B; C++ &#x6E90;&#x7801;&#x76F8;&#x5173;&#x5206;&#x6790;&#xFF0C;&#x4E0D;&#x660E;&#x767D;&#x4E14;&#x6709;&#x5174;&#x8DA3;&#x7684;&#x7AE5;&#x978B;&#x53EF;&#x81EA;&#x884C;&#x53BB;&#x9605;&#x8BFB;&#x66F4;&#x6DF1;&#x4E00;&#x5C42;&#x7684;&#x6E90;&#x7801;&#xFF0C;&#x6216;&#x8005;&#x7F51;&#x4E0A;&#x641C;&#x7D22;&#x7B54;&#x6848;&#xFF0C;&#x6216;&#x8005;&#x6211;&#x63D0;&#x524D;&#x65E0;&#x803B;&#x786C;&#x5E7F;&#x4E00;&#x4E0B;&#x6211;&#x5FEB;&#x8981;&#x4E0A;&#x5E02;&#x7684;&#x4E66;&#x300A;Node.js&#xFF1A;&#x6765;&#x4E00;&#x6253; C++ &#x6269;&#x5C55;&#x300B;&#x2014;&#x2014;&#x91CC;&#x9762;&#x4E5F;&#x6709;&#x8BF4;&#x660E;&#xFF0C;&#x4EE5;&#x53CA;&#x6211;&#x7684;&#x6709;&#x4E00;&#x573A;&#x77E5;&#x4E4E; Live&#x300A;&#x6DF1;&#x5165;&#x7406;&#x89E3; Node.js &#x5305;&#x4E0E;&#x6A21;&#x5757;&#x673A;&#x5236;&#x300B;&#x3002;</p>
</blockquote>
<p>&#x603B;&#x800C;&#x8A00;&#x4E4B;&#xFF0C;&#x6211;&#x4EEC;&#x63A5;&#x4E0B;&#x53BB;&#x8981;&#x770B;&#x7684;&#x5C31;&#x662F; <a href="/external_links/5c6abd32c8f24e03d4233c64f827f97b.html" target="blank" rel="noopener"><strong>src/node_http_parser.cc</strong></a> &#x4E86;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cpp&#x590D;&#x5236;&#x4EE3;&#x7801;env-&gt;SetProtoMethod(t, &quot;close&quot;, Parser::Close);</span><br><span class="line">env-&gt;SetProtoMethod(t, &quot;execute&quot;, Parser::Execute);</span><br><span class="line">env-&gt;SetProtoMethod(t, &quot;finish&quot;, Parser::Finish);</span><br><span class="line">env-&gt;SetProtoMethod(t, &quot;reinitialize&quot;, Parser::Reinitialize);</span><br><span class="line">env-&gt;SetProtoMethod(t, &quot;pause&quot;, Parser::Pause&lt;true&gt;);</span><br><span class="line">env-&gt;SetProtoMethod(t, &quot;resume&quot;, Parser::Pause&lt;false&gt;);</span><br><span class="line">env-&gt;SetProtoMethod(t, &quot;consume&quot;, Parser::Consume);</span><br><span class="line">env-&gt;SetProtoMethod(t, &quot;unconsume&quot;, Parser::Unconsume);</span><br><span class="line">env-&gt;SetProtoMethod(t, &quot;getCurrentBuffer&quot;, Parser::GetCurrentBuffer);</span><br></pre></td></tr></table></figure>

<p>&#x5982;&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#x6240;&#x793A;&#xFF0C;&#x524D;&#x6587;&#x4E2D; <code>parser.execute()</code> &#x6240;&#x5BF9;&#x5E94;&#x7684;&#x51FD;&#x6570;&#x5C31;&#x662F; <code>Parser::Execute()</code> &#x4E86;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">cpp&#x590D;&#x5236;&#x4EE3;&#x7801;class Parser : public AsyncWrap {</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  static void Execute(const FunctionCallbackInfo&lt;Value&gt;&amp; args) {</span><br><span class="line">    Parser* parser;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    Local&lt;Object&gt; buffer_obj = args[0].As&lt;Object&gt;();</span><br><span class="line">    char* buffer_data = Buffer::Data(buffer_obj);</span><br><span class="line">    size_t buffer_len = Buffer::Length(buffer_obj);</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    Local&lt;Value&gt; ret = parser-&gt;Execute(buffer_data, buffer_len);</span><br><span class="line"></span><br><span class="line">    if (!ret.IsEmpty())</span><br><span class="line">      args.GetReturnValue().Set(ret);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  Local&lt;Value&gt; Execute(char* data, size_t len) {</span><br><span class="line">    EscapableHandleScope scope(env()-&gt;isolate());</span><br><span class="line"></span><br><span class="line">    current_buffer_len_ = len;</span><br><span class="line">    current_buffer_data_ = data;</span><br><span class="line">    got_exception_ = false;</span><br><span class="line"></span><br><span class="line">    size_t nparsed =</span><br><span class="line">      http_parser_execute(&amp;parser_, &amp;settings, data, len);</span><br><span class="line"></span><br><span class="line">    Save();</span><br><span class="line"></span><br><span class="line">    // Unassign the &apos;buffer_&apos; variable</span><br><span class="line">    current_buffer_.Clear();</span><br><span class="line">    current_buffer_len_ = 0;</span><br><span class="line">    current_buffer_data_ = nullptr;</span><br><span class="line"></span><br><span class="line">    // If there was an exception in one of the callbacks</span><br><span class="line">    if (got_exception_)</span><br><span class="line">      return scope.Escape(Local&lt;Value&gt;());</span><br><span class="line"></span><br><span class="line">    Local&lt;Integer&gt; nparsed_obj = Integer::New(env()-&gt;isolate(), nparsed);</span><br><span class="line">    // If there was a parse error in one of the callbacks</span><br><span class="line">    // TODO(bnoordhuis) What if there is an error on EOF?</span><br><span class="line">    if (!parser_.upgrade &amp;&amp; nparsed != len) {</span><br><span class="line">      enum http_errno err = HTTP_PARSER_ERRNO(&amp;parser_);</span><br><span class="line"></span><br><span class="line">      Local&lt;Value&gt; e = Exception::Error(env()-&gt;parse_error_string());</span><br><span class="line">      Local&lt;Object&gt; obj = e-&gt;ToObject(env()-&gt;isolate());</span><br><span class="line">      obj-&gt;Set(env()-&gt;bytes_parsed_string(), nparsed_obj);</span><br><span class="line">      obj-&gt;Set(env()-&gt;code_string(),</span><br><span class="line">               OneByteString(env()-&gt;isolate(), http_errno_name(err)));</span><br><span class="line"></span><br><span class="line">      return scope.Escape(e);</span><br><span class="line">    }</span><br><span class="line">    return scope.Escape(nparsed_obj);</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x9996;&#x5148;&#x8FDB;&#x5165; <code>Parser</code> &#x7684;&#x9759;&#x6001; <code>Execute()</code> &#x51FD;&#x6570;&#xFF0C;&#x6211;&#x4EEC;&#x770B;&#x5230;&#x5B83;&#x628A;&#x4F20;&#x8FDB;&#x6765;&#x7684; <code>Buffer</code> &#x8F6C;&#x5316;&#x4E3A; C++ &#x4E0B;&#x7684; <code>char*</code> &#x6307;&#x9488;&#xFF0C;&#x5E76;&#x8BB0;&#x5F55;&#x5176;&#x6570;&#x636E;&#x957F;&#x5EA6;&#xFF0C;&#x540C;&#x65F6;&#x53BB;&#x6267;&#x884C;&#x5F53;&#x524D;&#x8C03;&#x7528;&#x7684; <code>parser</code> &#x5BF9;&#x8C61;&#x6240;&#x5BF9;&#x5E94;&#x7684; <code>Execute()</code> &#x51FD;&#x6570;&#x3002;</p>
<p>&#x5728;&#x8FD9;&#x4E2A; <code>Execute()</code> &#x51FD;&#x6570;&#x4E2D;&#xFF0C;&#x6709;&#x4E2A;&#x6700;&#x91CD;&#x8981;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x5C31;&#x662F;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cpp&#x590D;&#x5236;&#x4EE3;&#x7801;size_t nparsed =</span><br><span class="line">    http_parser_execute(&amp;parser_, &amp;settings, data, len);</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x662F;&#x8C03;&#x7528;&#x771F;&#x6B63;&#x89E3;&#x6790; HTTP &#x6570;&#x636E;&#x5305;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x5B83;&#x662F; Node.js &#x8FD9;&#x4E2A;&#x9879;&#x76EE;&#x7684;&#x4E00;&#x4E2A;&#x81EA;&#x7814;&#x4F9D;&#x8D56;&#xFF0C;&#x53EB; <a href="/external_links/f657e3f8df4393e909f3a59a27cdb3d2.html" target="blank" rel="noopener">http-parser</a>&#x3002;&#x5B83;&#x72EC;&#x7ACB;&#x7684;&#x9879;&#x76EE;&#x5730;&#x5740;&#x5728; <a href="/external_links/913990ebfbad888ec7859ae0237ae15b.html" target="blank" rel="noopener">github.com/nodejs/http&#x2026;</a>&#xFF0C;&#x6211;&#x4EEC;&#x672C;&#x6587;&#x4E2D;&#x7528;&#x7684;&#x662F; Node.js v8.9.2 &#x4E2D;&#x6240;&#x4F9D;&#x8D56;&#x7684;&#x6E90;&#x7801;&#xFF0C;&#x5E94;&#x8BE5;&#x4F1A;&#x6709;&#x504F;&#x5DEE;&#x3002;</p>
<h3 id="http-parser"><a href="#http-parser" class="headerlink" title="http-parser"></a>http-parser</h3><h4 id="HTTP-Request-&#x6570;&#x636E;&#x5305;&#x4F53;"><a href="#HTTP-Request-&#x6570;&#x636E;&#x5305;&#x4F53;" class="headerlink" title="HTTP Request &#x6570;&#x636E;&#x5305;&#x4F53;"></a>HTTP Request &#x6570;&#x636E;&#x5305;&#x4F53;</h4><blockquote>
<p>&#x5982;&#x679C;&#x4F60;&#x5DF2;&#x7ECF;&#x5BF9; HTTP &#x5305;&#x4F53;&#x4E86;&#x89E3;&#x4E86;&#xFF0C;&#x53EF;&#x4EE5;&#x7565;&#x8FC7;&#x8FD9;&#x4E00;&#x8282;&#x3002;</p>
</blockquote>
<p>HTTP &#x7684; Request &#x6570;&#x636E;&#x5305;&#x5176;&#x5B9E;&#x662F;&#x6587;&#x672C;&#x683C;&#x5F0F;&#x7684;&#xFF0C;&#x5728; Raw &#x7684;&#x72B6;&#x6001;&#x4E0B;&#xFF0C;&#x5927;&#x6982;&#x662F;&#x4EE5;&#x8FD9;&#x6837;&#x7684;&#x5F62;&#x5F0F;&#x5B58;&#x5728;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">makefile&#x590D;&#x5236;&#x4EE3;&#x7801;&#x65B9;&#x6CD5; URI HTTP/&#x7248;&#x672C;</span><br><span class="line">&#x5934;1: &#x6211;&#x662F;&#x5934;1</span><br><span class="line">&#x5934;2: &#x6211;&#x662F;&#x5934;2</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&#x7B80;&#x5355;&#x8D77;&#x89C1;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x5199;&#x51FA;&#x6700;&#x57FA;&#x7840;&#x7684;&#x4E00;&#x4E9B;&#x5185;&#x5BB9;&#xFF0C;&#x81F3;&#x4E8E; Body &#x4EC0;&#x4E48;&#x7684;&#x5927;&#x5BB6;&#x81EA;&#x5DF1;&#x627E;&#x8D44;&#x6599;&#x770B;&#x5427;&#x3002;</p>
</blockquote>
<p>&#x4E0A;&#x9762;&#x7684;&#x662F;&#x4EC0;&#x4E48;&#x610F;&#x601D;&#x5462;&#xFF1F;&#x6211;&#x4EEC;&#x770B;&#x770B; CURL &#x7684;&#x7ED3;&#x679C;&#x5C31;&#x77E5;&#x9053;&#x4E86;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x5BF9;&#x5E94; <code>curl ... -v</code> &#x7684;&#x4E2D;&#x95F4;&#x8F93;&#x51FA;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">makefile&#x590D;&#x5236;&#x4EE3;&#x7801;GET /test HTTP/1.1</span><br><span class="line">Host: 127.0.0.1:5555</span><br><span class="line">User-Agent: curl/7.54.0</span><br><span class="line">Accept: */*</span><br></pre></td></tr></table></figure>

<p>&#x6240;&#x4EE5;&#x5B9E;&#x9645;&#x4E0A;&#x5927;&#x5BB6;&#x5E73;&#x65F6;&#x5728;&#x6587;&#x7AE0;&#x4E2D;&#x3001;&#x6D4F;&#x89C8;&#x5668;&#x8C03;&#x8BD5;&#x5DE5;&#x5177;&#x4E2D;&#x770B;&#x5230;&#x7684;&#x4EC0;&#x4E48;&#x8BF7;&#x6C42;&#x5934;&#x554A;&#x4EC0;&#x4E48;&#x7684;&#xFF0C;&#x90FD;&#x662F;&#x4EE5;&#x6587;&#x672C;&#x5F62;&#x5F0F;&#x5B58;&#x5728;&#x7684;&#xFF0C;&#x4EE5;&#x6362;&#x884C;&#x7B26;&#x5206;&#x5272;&#x3002;</p>
<p>&#x800C;&#x2014;&#x2014;&#x91CD;&#x70B9;&#x6765;&#x4E86;&#xFF0C;&#x5BFC;&#x81F4;&#x6211;&#x4EEC;&#x672C;&#x6587;&#x6240;&#x8FF0;&#x201C;Bug&#x201D;&#x51FA;&#x73B0;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x5B83;&#x7684;&#x8BF7;&#x6C42;&#x5305;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">makefile&#x590D;&#x5236;&#x4EE3;&#x7801;GET /foo bar HTTP/1.1</span><br><span class="line">Host: 127.0.0.1:5555</span><br><span class="line">User-Agent: curl/7.54.0</span><br><span class="line">Accept: */*</span><br></pre></td></tr></table></figure>

<p>&#x91CD;&#x70B9;&#x5728;&#x7B2C;&#x4E00;&#x884C;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash&#x590D;&#x5236;&#x4EE3;&#x7801;GET /foo bar HTTP/1.1</span><br></pre></td></tr></table></figure>

<h4 id="&#x6E90;&#x7801;&#x89E3;&#x6790;"><a href="#&#x6E90;&#x7801;&#x89E3;&#x6790;" class="headerlink" title="&#x6E90;&#x7801;&#x89E3;&#x6790;"></a>&#x6E90;&#x7801;&#x89E3;&#x6790;</h4><p>&#x8BDD;&#x4E0D;&#x591A;&#x5C11;&#xFF0C;&#x6211;&#x4EEC;&#x4E4B;&#x95F4;&#x524D;&#x5F80; http-parser &#x7684; <a href="/external_links/77017139e997b662f76e070c376e86c5.html" target="blank" rel="noopener">http_parser.c</a> &#x770B; <code>http_parser_execute ()</code> &#x51FD;&#x6570;&#x4E2D;&#x7684;&#x72B6;&#x6001;&#x673A;&#x53D8;&#x5316;&#x3002;</p>
<p>&#x4ECE;&#x6E90;&#x7801;&#x4E2D;&#x6587;&#x6211;&#x4EEC;&#x80FD;&#x770B;&#x5230;&#xFF0C;http-parser &#x7684;&#x6D41;&#x7A0B;&#x662F;&#x4ECE;&#x5934;&#x5230;&#x5C3E;&#x4EE5; O(n) &#x7684;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x5BF9;&#x5B57;&#x7B26;&#x4E32;&#x9010;&#x5B57;&#x626B;&#x63CF;&#xFF0C;&#x5E76;&#x4E14;&#x4E0D;&#x540E;&#x9000;&#x4E5F;&#x4E0D;&#x5F80;&#x524D;&#x8DF3;&#x3002;</p>
<p>&#x90A3;&#x4E48;&#x626B;&#x63CF;&#x5230;&#x6BCF;&#x4E2A;&#x5B57;&#x7B26;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x90FD;&#x6709;&#x5C5E;&#x4E8E;&#x5F53;&#x524D;&#x7684;&#x4E00;&#x4E2A;&#x72B6;&#x6001;&#xFF0C;&#x5982;&#x201C;&#x6B63;&#x5728;&#x626B;&#x63CF;&#x5904;&#x7406; uri&#x201D;&#x3001;&#x201C;&#x6B63;&#x5728;&#x626B;&#x63CF;&#x5904;&#x7406; HTTP &#x534F;&#x8BAE;&#x5E76;&#x4E14;&#x5904;&#x7406;&#x5230;&#x4E86; H&#x201D;&#x3001;&#x201C;&#x6B63;&#x5728;&#x626B;&#x63CF;&#x5904;&#x7406; HTTP &#x534F;&#x8BAE;&#x5E76;&#x4E14;&#x5904;&#x7406;&#x5230;&#x4E86; HT&#x201D;&#x3001;&#x201C;&#x6B63;&#x5728;&#x626B;&#x63CF;&#x5904;&#x7406; HTTP &#x534F;&#x8BAE;&#x5E76;&#x4E14;&#x5904;&#x7406;&#x5230;&#x4E86; HTT&#x201D;&#x3001;&#x201C;&#x6B63;&#x5728;&#x626B;&#x63CF;&#x5904;&#x7406; HTTP &#x534F;&#x8BAE;&#x5E76;&#x4E14;&#x5904;&#x7406;&#x5230;&#x4E86; HTTP&#x201D;&#x3001;&#x2026;&#x2026;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/bb636618c2a355d55b4c85d1641161f35709f4ed07be3366154c8c87e5ea37b7" alt><br>&#x618B;&#x7B11;&#xFF0C;&#x8FD9;&#x662F;&#x771F;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x770B;&#x770B;&#x4EE3;&#x7801;&#x5C31;&#x77E5;&#x9053;&#x4E86;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">c&#x590D;&#x5236;&#x4EE3;&#x7801;case s_req_server:</span><br><span class="line">case s_req_server_with_at:</span><br><span class="line">case s_req_path:</span><br><span class="line">case s_req_query_string_start:</span><br><span class="line">case s_req_query_string:</span><br><span class="line">case s_req_fragment_start:</span><br><span class="line">case s_req_fragment:</span><br><span class="line">{</span><br><span class="line">  switch (ch) {</span><br><span class="line">    case &apos; &apos;:</span><br><span class="line">      UPDATE_STATE(s_req_http_start);</span><br><span class="line">      CALLBACK_DATA(url);</span><br><span class="line">      break;</span><br><span class="line">    case CR:</span><br><span class="line">    case LF:</span><br><span class="line">      parser-&gt;http_major = 0;</span><br><span class="line">      parser-&gt;http_minor = 9;</span><br><span class="line">      UPDATE_STATE((ch == CR) ?</span><br><span class="line">        s_req_line_almost_done :</span><br><span class="line">        s_header_field_start);</span><br><span class="line">      CALLBACK_DATA(url);</span><br><span class="line">      break;</span><br><span class="line">    default:</span><br><span class="line">      UPDATE_STATE(parse_url_char(CURRENT_STATE(), ch));</span><br><span class="line">      if (UNLIKELY(CURRENT_STATE() == s_dead)) {</span><br><span class="line">        SET_ERRNO(HPE_INVALID_URL);</span><br><span class="line">        goto error;</span><br><span class="line">      }</span><br><span class="line">  }</span><br><span class="line">  break;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5728;&#x626B;&#x63CF;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5982;&#x679C;&#x5F53;&#x524D;&#x72B6;&#x6001;&#x662F; URI &#x76F8;&#x5173;&#x7684;&#xFF08;&#x5982; <code>s_req_path</code>&#x3001;<code>s_req_query_string</code> &#x7B49;&#xFF09;&#xFF0C;&#x5219;&#x6267;&#x884C;&#x4E00;&#x4E2A;&#x5B50; <code>switch</code>&#xFF0C;&#x91CC;&#x9762;&#x7684;&#x5904;&#x7406;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li>&#x82E5;&#x5F53;&#x524D;&#x5B57;&#x7B26;&#x662F;&#x7A7A;&#x683C;&#xFF0C;&#x5219;&#x5C06;&#x72B6;&#x6001;&#x6539;&#x53D8;&#x4E3A; <code>s_req_http_start</code> &#x5E76;&#x8BA4;&#x4E3A; URI &#x5DF2;&#x7ECF;&#x89E3;&#x6790;&#x597D;&#x4E86;&#xFF0C;&#x901A;&#x8FC7;&#x5B8F; <code>CALLBACK_DATA()</code> &#x89E6;&#x53D1; URI &#x89E3;&#x6790;&#x597D;&#x7684;&#x4E8B;&#x4EF6;&#xFF1B;</li>
<li>&#x82E5;&#x5F53;&#x524D;&#x5B57;&#x7B26;&#x662F;&#x6362;&#x884C;&#x7B26;&#xFF0C;&#x5219;&#x8BF4;&#x660E;&#x8FD8;&#x5728;&#x89E3;&#x6790; URI &#x7684;&#x65F6;&#x5019;&#x5C31;&#x88AB;&#x6362;&#x884C;&#x4E86;&#xFF0C;&#x540E;&#x9762;&#x5C31;&#x4E0D;&#x53EF;&#x80FD;&#x8DDF;&#x7740; HTTP &#x534F;&#x8BAE;&#x7248;&#x672C;&#x7684;&#x7533;&#x660E;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x8BBE;&#x7F6E;&#x9ED8;&#x8BA4;&#x7684; HTTP &#x7248;&#x672C;&#x4E3A; <code>0.9</code>&#xFF0C;&#x5E76;&#x4FEE;&#x6539;&#x5F53;&#x524D;&#x72B6;&#x6001;&#xFF0C;&#x6700;&#x540E;&#x8BA4;&#x4E3A; URI &#x5DF2;&#x7ECF;&#x89E3;&#x6790;&#x597D;&#x4E86;&#xFF0C;&#x901A;&#x8FC7;&#x5B8F; <code>CALLBACK_DATA()</code> &#x89E6;&#x53D1; URI &#x89E3;&#x6790;&#x597D;&#x7684;&#x4E8B;&#x4EF6;&#xFF1B;</li>
<li>&#x5176;&#x4F59;&#x60C5;&#x51B5;&#xFF08;&#x6240;&#x6709;&#x5176;&#x5B83;&#x5B57;&#x7B26;&#xFF09;&#x4E0B;&#xFF0C;&#x901A;&#x8FC7;&#x8C03;&#x7528; <code>parse_url_char()</code> &#x51FD;&#x6570;&#x6765;&#x89E3;&#x6790;&#x4E00;&#x4E9B;&#x4E1C;&#x897F;&#x5E76;&#x66F4;&#x65B0;&#x5F53;&#x524D;&#x72B6;&#x6001;&#x3002;&#xFF08;&#x56E0;&#x4E3A;&#x54EA;&#x6015;&#x662F;&#x5728;&#x89E3;&#x6790; URI &#x72B6;&#x6001;&#x4E2D;&#xFF0C;&#x4E5F;&#x8FD8;&#x6709;&#x5404;&#x79CD;&#x4E0D;&#x540C;&#x7684;&#x7EC6;&#x5206;&#xFF0C;&#x5982; <code>s_req_path</code>&#x3001;<code>s_req_query_string</code> &#xFF09;</li>
</ul>
<p>&#x8FD9;&#x91CC;&#x7684;&#x91CD;&#x70B9;&#x8FD8;&#x662F;&#x5F53;&#x72B6;&#x6001;&#x4E3A;&#x89E3;&#x6790; URI &#x7684;&#x65F6;&#x5019;&#x9047;&#x5230;&#x4E86;&#x7A7A;&#x683C;&#x7684;&#x5904;&#x7406;&#xFF0C;&#x4E0A;&#x9762;&#x4E5F;&#x89E3;&#x91CA;&#x8FC7;&#x4E86;&#xFF0C;&#x4E00;&#x65E6;&#x9047;&#x5230;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x5219;&#x4F1A;&#x8BA4;&#x4E3A; URI &#x5DF2;&#x7ECF;&#x89E3;&#x6790;&#x597D;&#x4E86;&#xFF0C;&#x5E76;&#x4E14;&#x5C06;&#x72B6;&#x6001;&#x4FEE;&#x6539;&#x4E3A; <code>s_req_http_start</code>&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x6709;&#x201C;Bug&#x201D;&#x7684;&#x90A3;&#x4E2A;&#x6570;&#x636E;&#x5305;<br><code>GET /foo bar HTTP/1.1</code> &#x5728;&#x89E3;&#x6790;&#x5230; <code>foo</code> &#x540E;&#x9762;&#x7684;&#x7A7A;&#x683C;&#x7684;&#x65F6;&#x5019;&#x5B83;&#x5C31;&#x5C06;&#x72B6;&#x6001;&#x6539;&#x4E3A; <code>s_req_http_start</code> &#x5E76;&#x4E14;&#x8BA4;&#x4E3A; URI &#x5DF2;&#x7ECF;&#x89E3;&#x6790;&#x7ED3;&#x675F;&#x4E86;&#x3002;</p>
<p>&#x597D;&#x7684;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x770B;&#x770B; <code>s_req_http_start</code> &#x600E;&#x4E48;&#x5904;&#x7406;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">c&#x590D;&#x5236;&#x4EE3;&#x7801;case s_req_http_start:</span><br><span class="line">  switch (ch) {</span><br><span class="line">    case &apos;H&apos;:</span><br><span class="line">      UPDATE_STATE(s_req_http_H);</span><br><span class="line">      break;</span><br><span class="line">    case &apos; &apos;:</span><br><span class="line">      break;</span><br><span class="line">    default:</span><br><span class="line">      SET_ERRNO(HPE_INVALID_CONSTANT);</span><br><span class="line">      goto error;</span><br><span class="line">  }</span><br><span class="line">  break;</span><br><span class="line"></span><br><span class="line">case s_req_http_H:</span><br><span class="line">  STRICT_CHECK(ch != &apos;T&apos;);</span><br><span class="line">  UPDATE_STATE(s_req_http_HT);</span><br><span class="line">  break;</span><br><span class="line"></span><br><span class="line">case s_req_http_HT:</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">case s_req_http_HTT:</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">case s_req_http_HTTP:</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">case s_req_first_http_major:</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure>

<p>&#x5982;&#x4EE3;&#x7801;&#x6240;&#x89C1;&#xFF0C;&#x82E5;&#x5F53;&#x524D;&#x72B6;&#x6001;&#x4E3A; <code>s_req_http_start</code>&#xFF0C;&#x5219;&#x5148;&#x5224;&#x65AD;&#x5F53;&#x524D;&#x5B57;&#x7B26;&#x662F;&#x4E0D;&#x662F;&#x5408;&#x6807;&#x3002;&#x56E0;&#x4E3A;&#x5C31; HTTP &#x8BF7;&#x6C42;&#x5305;&#x4F53;&#x7684;&#x683C;&#x5F0F;&#x6765;&#x770B;&#xFF0C;&#x5982;&#x679C; URI &#x89E3;&#x6790;&#x7ED3;&#x675F;&#x7684;&#x8BDD;&#xFF0C;&#x7406;&#x5E94;&#x51FA;&#x73B0;&#x7C7B;&#x4F3C; <code>HTTP/1.1</code> &#x7684;&#x8FD9;&#x4E48;&#x4E00;&#x4E2A;&#x7248;&#x672C;&#x7533;&#x660E;&#x3002;&#x6240;&#x4EE5;&#x8FD9;&#x4E2A;&#x65F6;&#x5019; http-parser &#x4F1A;&#x76F4;&#x63A5;&#x5224;&#x65AD;&#x5F53;&#x524D;&#x5B57;&#x7B26;&#x662F;&#x5426;&#x4E3A; <code>H</code>&#x3002;</p>
<ul>
<li>&#x82E5;&#x662F; <code>H</code>&#xFF0C;&#x5219;&#x5C06;&#x72B6;&#x6001;&#x6539;&#x4E3A; <code>s_req_http_H</code> &#x5E76;&#x7EE7;&#x7EED;&#x626B;&#x63CF;&#x5FAA;&#x73AF;&#x7684;&#x4E0B;&#x4E00;&#x4F4D;&#xFF0C;&#x540C;&#x7406;&#x5728; <code>s_req_http_H</code> &#x4E0B;&#x82E5;&#x5408;&#x6CD5;&#x72B6;&#x6001;&#x5C31;&#x4F1A;&#x53D8;&#x6210; <code>s_req_http_HT</code>&#xFF0C;&#x4EE5;&#x6B64;&#x7C7B;&#x63A8;&#xFF1B;</li>
</ul>
<p>+&#x82E5;&#x662F;&#x7A7A;&#x683C;&#xFF0C;&#x5219;&#x8BA4;&#x4E3A;&#x662F;&#x591A;&#x4F59;&#x7684;&#x7A7A;&#x683C;&#xFF0C;&#x90A3;&#x4E48;&#x5F53;&#x524D;&#x72B6;&#x6001;&#x4E0D;&#x505A;&#x4EFB;&#x4F55;&#x6539;&#x53D8;&#xFF0C;&#x5E76;&#x7EE7;&#x7EED;&#x4E0B;&#x4E00;&#x4E2A;&#x626B;&#x63CF;&#xFF1B;</p>
<ul>
<li>&#x4F46;&#x5982;&#x679C;&#x5F53;&#x524D;&#x5B57;&#x7B26;&#x65E2;&#x4E0D;&#x662F;&#x7A7A;&#x683C;&#x4E5F;&#x4E0D;&#x662F; <code>H</code>&#xFF0C;&#x90A3;&#x4E48;&#x597D;&#x4E86;&#xFF0C;http-parser &#x76F4;&#x63A5;&#x8BA4;&#x4E3A;&#x4F60;&#x7684;&#x8BF7;&#x6C42;&#x5305;&#x4E0D;&#x5408;&#x6CD5;&#xFF0C;&#x5C06;&#x4F60;&#x672C;&#x6B21;&#x7684;&#x89E3;&#x6790;&#x8BBE;&#x7F6E;&#x9519;&#x8BEF; <code>HPE_INVALID_CONSTANT</code> &#x5E76; <code>goto</code> &#x5230; <code>error</code> &#x4EE3;&#x7801;&#x5757;&#x3002;</li>
</ul>
<p>&#x81F3;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x57FA;&#x672C;&#x4E0A;&#x5DF2;&#x7ECF;&#x660E;&#x767D;&#x4E86;&#x539F;&#x56E0;&#x4E86;&#xFF1A;</p>
<p><strong>http-parser &#x8BA4;&#x4E3A;&#x5728; HTTP &#x8BF7;&#x6C42;&#x5305;&#x4F53;&#x4E2D;&#xFF0C;&#x7B2C;&#x4E00;&#x884C;&#x7684; URI &#x89E3;&#x6790;&#x9636;&#x6BB5;&#x4E00;&#x65E6;&#x51FA;&#x73B0;&#x4E86;&#x7A7A;&#x683C;&#xFF0C;&#x5C31;&#x4F1A;&#x8BA4;&#x4E3A; URI &#x89E3;&#x6790;&#x5B8C;&#x6210;&#xFF0C;&#x7EE7;&#x800C;&#x89E3;&#x6790; HTTP &#x534F;&#x8BAE;&#x7248;&#x672C;&#x3002;&#x4F46;&#x82E5;&#x6B64;&#x65F6;&#x7D27;&#x8DDF;&#x7740;&#x7684;&#x4E0D;&#x662F; HTTP &#x534F;&#x8BAE;&#x7248;&#x672C;&#x7684;&#x6807;&#x51C6;&#x683C;&#x5F0F;&#xFF0C;http-parser &#x5C31;&#x4F1A;&#x8BA4;&#x4E3A;&#x4F60;&#x8FD9;&#x662F;&#x4E00;&#x4E2A; <code>HPE_INVALID_CONSTANT</code> &#x7684;&#x6570;&#x636E;&#x5305;&#x3002;</strong></p>
<p>&#x4E0D;&#x8FC7;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x662F;&#x7EE7;&#x7EED;&#x770B;&#x770B;&#x5B83;&#x7684; <code>error</code> &#x4EE3;&#x7801;&#x5757;&#x5427;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">c&#x590D;&#x5236;&#x4EE3;&#x7801;error:</span><br><span class="line">  if (HTTP_PARSER_ERRNO(parser) == HPE_OK) {</span><br><span class="line">    SET_ERRNO(HPE_UNKNOWN);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  RETURN(p - data);</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x4E2D;&#x9996;&#x5148;&#x5224;&#x65AD;&#x4E00;&#x4E0B;&#x5F53;&#x8DF3;&#x5230;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x7684;&#x65F6;&#x5019;&#x6709;&#x6CA1;&#x6709;&#x8BBE;&#x7F6E;&#x9519;&#x8BEF;&#xFF0C;&#x82E5;&#x6CA1;&#x6709;&#x8BBE;&#x7F6E;&#x9519;&#x8BEF;&#x5219;&#x5C06;&#x9519;&#x8BEF;&#x8BBE;&#x7F6E;&#x4E3A;&#x672A;&#x77E5;&#x9519;&#x8BEF;&#xFF08;<code>HPE_UNKNOWN</code>&#xFF09;&#xFF0C;&#x7136;&#x540E;&#x8FD4;&#x56DE;&#x5DF2;&#x89E3;&#x6790;&#x7684;&#x6570;&#x636E;&#x5305;&#x957F;&#x5EA6;&#x3002;</p>
<blockquote>
<p><code>p</code> &#x662F;&#x5F53;&#x524D;&#x89E3;&#x6790;&#x5B57;&#x7B26;&#x6307;&#x9488;&#xFF0C;<code>data</code> &#x662F;&#x8FD9;&#x4E2A;&#x6570;&#x636E;&#x5305;&#x7684;&#x8D77;&#x59CB;&#x6307;&#x9488;&#xFF0C;&#x6240;&#x4EE5; <code>p - data</code> &#x5C31;&#x662F;&#x5DF2;&#x89E3;&#x6790;&#x7684;&#x6570;&#x636E;&#x957F;&#x5EA6;&#x3002;&#x5982;&#x679C;&#x6210;&#x529F;&#x89E3;&#x6790;&#x5B8C;&#xFF0C;&#x8FD9;&#x4E2A;&#x6570;&#x636E;&#x5305;&#x7406;&#x8BBA;&#x4E0A;&#x662F;&#x7B49;&#x4E8E;&#x8FD9;&#x4E2A;&#x6570;&#x636E;&#x5305;&#x7684;&#x5B8C;&#x6574;&#x957F;&#x5EA6;&#xFF0C;&#x82E5;&#x4E0D;&#x7B49;&#x5219;&#x7406;&#x8BBA;&#x4E0A;&#x8BF4;&#x660E;&#x80AF;&#x5B9A;&#x662F;&#x4E2D;&#x9014;&#x51FA;&#x9519;&#x63D0;&#x524D;&#x8FD4;&#x56DE;&#x3002;</p>
</blockquote>
<h3 id="&#x56DE;&#x5230;-node-http-parser-cc"><a href="#&#x56DE;&#x5230;-node-http-parser-cc" class="headerlink" title="&#x56DE;&#x5230; node_http_parser.cc"></a>&#x56DE;&#x5230; node_http_parser.cc</h3><p>&#x770B;&#x5B8C;&#x4E86; http-parser &#x7684;&#x539F;&#x7406;&#x540E;&#xFF0C;&#x5F88;&#x591A;&#x5730;&#x65B9;&#x8305;&#x585E;&#x987F;&#x5F00;&#x3002;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x56DE;&#x5230;&#x5B83;&#x7684;&#x8C03;&#x7528;&#x5730; <a href="/external_links/5c6abd32c8f24e03d4233c64f827f97b.html" target="blank" rel="noopener"><strong>node_http_parser.cc</strong></a> &#x7EE7;&#x7EED;&#x9605;&#x8BFB;&#x5427;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">cpp&#x590D;&#x5236;&#x4EE3;&#x7801;Local&lt;Value&gt; Execute(char* data, size_t len) {</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  size_t nparsed =</span><br><span class="line">    http_parser_execute(&amp;parser_, &amp;settings, data, len);</span><br><span class="line"></span><br><span class="line">  Local&lt;Integer&gt; nparsed_obj = Integer::New(env()-&gt;isolate(), nparsed);</span><br><span class="line">  if (!parser_.upgrade &amp;&amp; nparsed != len) {</span><br><span class="line">    enum http_errno err = HTTP_PARSER_ERRNO(&amp;parser_);</span><br><span class="line"></span><br><span class="line">    Local&lt;Value&gt; e = Exception::Error(env()-&gt;parse_error_string());</span><br><span class="line">    Local&lt;Object&gt; obj = e-&gt;ToObject(env()-&gt;isolate());</span><br><span class="line">    obj-&gt;Set(env()-&gt;bytes_parsed_string(), nparsed_obj);</span><br><span class="line">    obj-&gt;Set(env()-&gt;code_string(),</span><br><span class="line">             OneByteString(env()-&gt;isolate(), http_errno_name(err)));</span><br><span class="line"></span><br><span class="line">    return scope.Escape(e);</span><br><span class="line">  }</span><br><span class="line">  return scope.Escape(nparsed_obj);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4ECE;&#x8C03;&#x7528;&#x5904;&#x6211;&#x4EEC;&#x80FD;&#x770B;&#x89C1;&#xFF0C;&#x5728;&#x6267;&#x884C;&#x5B8C; <code>http_parser_execute()</code> &#x540E;&#x6709;&#x4E00;&#x4E2A;&#x5224;&#x65AD;&#xFF0C;&#x82E5;&#x5F53;&#x524D;&#x8BF7;&#x6C42;&#x4E0D;&#x662F; <code>upgrade</code> &#x8BF7;&#x6C42;&#xFF08;&#x5373;&#x8BF7;&#x6C42;&#x5934;&#x4E2D;&#x6709;&#x8BF4;&#x660E; <code>Upgrade</code>&#xFF0C;&#x901A;&#x5E38;&#x7528;&#x4E8E; WebSocket&#xFF09;&#xFF0C;&#x5E76;&#x4E14;&#x89E3;&#x6790;&#x957F;&#x5EA6;&#x4E0D;&#x7B49;&#x4E8E;&#x539F;&#x6570;&#x636E;&#x5305;&#x957F;&#x5EA6;&#xFF08;&#x524D;&#x6587;&#x8BF4;&#x4E86;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x5C5E;&#x4E8E;&#x51FA;&#x9519;&#x4E86;&#xFF09;&#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x4E48;&#x8FDB;&#x5165;&#x4E2D;&#x95F4;&#x7684;&#x9519;&#x8BEF;&#x4EE3;&#x7801;&#x5757;&#x3002;</p>
<p>&#x5728;&#x9519;&#x8BEF;&#x4EE3;&#x7801;&#x5757;&#x4E2D;&#xFF0C;&#x5148; <code>HTTP_PARSER_ERRNO(&amp;parser_)</code> &#x62FF;&#x5230;&#x9519;&#x8BEF;&#x7801;&#xFF0C;&#x7136;&#x540E;&#x901A;&#x8FC7; <code>Exception::Error()</code> &#x751F;&#x6210;&#x9519;&#x8BEF;&#x5BF9;&#x8C61;&#xFF0C;&#x5C06;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x585E;&#x8FDB;&#x9519;&#x8BEF;&#x5BF9;&#x8C61;&#x4E2D;&#xFF0C;&#x6700;&#x540E;&#x8FD4;&#x56DE;&#x9519;&#x8BEF;&#x5BF9;&#x8C61;&#x3002;</p>
<p>&#x5982;&#x679C;&#x6CA1;&#x9519;&#xFF0C;&#x5219;&#x8FD4;&#x56DE;&#x89E3;&#x6790;&#x957F;&#x5EA6;&#xFF08;<code>nparsed_obj</code> &#x5373; <code>nparsed</code>&#xFF09;&#x3002;</p>
<blockquote>
<p>&#x5728;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x773C;&#x5C16;&#x7684;&#x7AE5;&#x978B;&#x53EF;&#x80FD;&#x53D1;&#x73B0;&#x4E86;&#xFF0C;&#x6267;&#x884C; <code>Execute()</code> &#x6709;&#x597D;&#x591A;&#x5904;&#xFF0C;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#x5B9E;&#x9645;&#x4E0A;&#x4E00;&#x4E2A; HTTP &#x8BF7;&#x6C42;&#x53EF;&#x80FD;&#x662F;&#x6D41;&#x5F0F;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x6709;&#x65F6;&#x5019;&#x53EF;&#x80FD;&#x4F1A;&#x53EA;&#x62FF;&#x5230;&#x90E8;&#x5206;&#x6570;&#x636E;&#x5305;&#x3002;&#x6240;&#x4EE5;&#x6700;&#x540E;&#x6709;&#x4E00;&#x4E2A;&#x7ED3;&#x675F;&#x7B26;&#x9700;&#x8981;&#x88AB;&#x786E;&#x8BA4;&#x3002;<strong>&#x8FD9;&#x4E5F;&#x662F;&#x4E3A;&#x4EC0;&#x4E48; http-parser &#x5728;&#x89E3;&#x6790;&#x7684;&#x65F6;&#x5019;&#x53EA;&#x80FD;&#x9010;&#x5B57;&#x89E3;&#x6790;&#x800C;&#x4E0D;&#x80FD;&#x8DF3;&#x8DC3;&#x6216;&#x8005;&#x540E;&#x9000;&#x4E86;&#x3002;</strong></p>
</blockquote>
<h3 id="&#x56DE;&#x5230;-http-server-js"><a href="#&#x56DE;&#x5230;-http-server-js" class="headerlink" title="&#x56DE;&#x5230; _http_server.js"></a>&#x56DE;&#x5230; _http_server.js</h3><p>&#x6211;&#x4EEC;&#x628A; <code>Parser::Execute()</code> &#x4E5F;&#x5C31;&#x662F; JavaScript &#x4EE3;&#x7801;&#x4E2D;&#x7684; <code>parser.execute()</code> &#x7ED9;&#x641E;&#x6E05;&#x695A;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x80FD;&#x56DE;&#x5230; <a href="/external_links/0c943f140f1b0ef05f96601694eb5702.html" target="blank" rel="noopener">_http_server.js</a> &#x770B;&#x4EE3;&#x7801;&#x4E86;&#x3002;</p>
<p>&#x524D;&#x6587;&#x8BF4;&#x4E86;&#xFF0C;<code>socketOnData</code> &#x5728;&#x89E3;&#x6790;&#x5B8C;&#x6570;&#x636E;&#x5305;&#x540E;&#x4F1A;&#x6267;&#x884C; <code>onParserExecuteCommon</code> &#x51FD;&#x6570;&#xFF0C;&#x73B0;&#x5728;&#x5C31;&#x6765;&#x770B;&#x770B;&#x8FD9;&#x4E2A; <code>onParserExecuteCommon()</code> &#x51FD;&#x6570;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">js&#x590D;&#x5236;&#x4EE3;&#x7801;function onParserExecuteCommon(server, socket, parser, state, ret, d) {</span><br><span class="line">  resetSocketTimeout(server, socket, state);</span><br><span class="line"></span><br><span class="line">  if (ret instanceof Error) {</span><br><span class="line">    debug(&apos;parse error&apos;, ret);</span><br><span class="line">    socketOnError.call(socket, ret);</span><br><span class="line">  } else if (parser.incoming &amp;&amp; parser.incoming.upgrade) {</span><br><span class="line">    ...</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x957F;&#x957F;&#x7684;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x88AB;&#x6211;&#x7CBE;&#x7B80;&#x6210;&#x8FD9;&#x4E48;&#x51E0;&#x53E5;&#x8BDD;&#xFF0C;&#x91CD;&#x70B9;&#x5F88;&#x660E;&#x663E;&#x3002;<code>ret</code> &#x5C31;&#x662F;&#x4ECE; <code>socketOnData</code> &#x4F20;&#x8FDB;&#x6765;&#x5DF2;&#x89E3;&#x6790;&#x7684;&#x6570;&#x636E;&#x957F;&#x5EA6;&#xFF0C;&#x4F46;&#x662F;&#x5728; C++ &#x4EE3;&#x7801;&#x4E2D;&#x6211;&#x4EEC;&#x4E5F;&#x770B;&#x5230;&#x4E86;&#x5B83;&#x8FD8;&#x6709;&#x53EF;&#x80FD;&#x662F;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#x5BF9;&#x8C61;&#x3002;&#x6240;&#x4EE5;&#x5728;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x4E2D;&#x4E00;&#x5F00;&#x59CB;&#x5C31;&#x505A;&#x4E86;&#x4E00;&#x4E2A;&#x5224;&#x65AD;&#xFF0C;&#x5224;&#x65AD;&#x89E3;&#x6790;&#x7684;&#x7ED3;&#x679C;&#x662F;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#x5BF9;&#x8C61;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x9519;&#x8BEF;&#x5BF9;&#x8C61;&#x5219;&#x8C03;&#x7528; <code>socketOnError()</code>&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">js&#x590D;&#x5236;&#x4EE3;&#x7801;function socketOnError(e) {</span><br><span class="line">  // Ignore further errors</span><br><span class="line">  this.removeListener(&apos;error&apos;, socketOnError);</span><br><span class="line">  this.on(&apos;error&apos;, () =&gt; {});</span><br><span class="line"></span><br><span class="line">  if (!this.server.emit(&apos;clientError&apos;, e, this))</span><br><span class="line">    this.destroy(e);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x6211;&#x4EEC;&#x770B;&#x5230;&#xFF0C;&#x5982;&#x679C;&#x771F;&#x7684;&#x4E0D;&#x5C0F;&#x5FC3;&#x8D70;&#x5230;&#x8FD9;&#x4E00;&#x6B65;&#x7684;&#x8BDD;&#xFF0C;HTTP Server &#x5BF9;&#x8C61;&#x4F1A;&#x89E6;&#x53D1;&#x4E00;&#x4E2A; <code>clientError</code> &#x4E8B;&#x4EF6;&#x3002;</p>
<p>&#x6574;&#x4E2A;&#x4E8B;&#x60C5;&#x4E32;&#x8054;&#x8D77;&#x6765;&#x4E86;&#xFF1A;</p>
<ul>
<li>&#x6536;&#x5230;&#x8BF7;&#x6C42;&#x540E;&#x4F1A;&#x901A;&#x8FC7; http-parser &#x89E3;&#x6790;&#x6570;&#x636E;&#x5305;&#xFF1B;</li>
<li><code>GET /foo bar HTTP/1.1</code> &#x4F1A;&#x88AB;&#x89E3;&#x6790;&#x51FA;&#x9519;&#x5E76;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#x5BF9;&#x8C61;&#xFF1B;</li>
<li>&#x9519;&#x8BEF;&#x5BF9;&#x8C61;&#x4F1A;&#x8FDB;&#x5165; <code>if (ret instanceof Error)</code> &#x6761;&#x4EF6;&#x5206;&#x652F;&#x5E76;&#x8C03;&#x7528; <code>socketOnError()</code> &#x51FD;&#x6570;&#xFF1B;</li>
<li><code>socketOnError()</code> &#x51FD;&#x6570;&#x4E2D;&#x4F1A;&#x5BF9;&#x670D;&#x52A1;&#x5668;&#x89E6;&#x53D1;&#x4E00;&#x4E2A; <code>clientError</code> &#x4E8B;&#x4EF6;&#xFF1B;&#xFF08;<code>this.server.emit(&apos;clientError&apos;, e, this)</code>&#xFF09;</li>
<li><strong>&#x81F3;&#x6B64;&#xFF0C;HTTP Server &#x5E76;&#x4E0D;&#x4F1A;&#x8D70;&#x5230;&#x4F60;&#x7684;&#x90A3;&#x4E2A; <code>function(req, resp)</code> &#x4E2D;&#x53BB;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x4F1A;&#x6709;&#x4EFB;&#x4F55;&#x7684;&#x6570;&#x636E;&#x88AB;&#x8FD4;&#x56DE;&#x5C31;&#x7ED3;&#x675F;&#x4E86;&#xFF0C;&#x4E5F;&#x5C31;&#x89E3;&#x7B54;&#x4E86;&#x4E00;&#x5F00;&#x59CB;&#x7684;&#x95EE;&#x9898;&#x2014;&#x2014;&#x6536;&#x4E0D;&#x5230;&#x4EFB;&#x4F55;&#x6570;&#x636E;&#x5C31;&#x8BF7;&#x6C42;&#x7ED3;&#x675F;&#x3002;</strong></li>
</ul>
<p>&#x8FD9;&#x5C31;&#x662F;&#x6211;&#x8981;&#x9010;&#x7EA7;&#x8FDB;&#x6765;&#x770B;&#x4EE3;&#x7801;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x76F4;&#x8FBE; http-parser &#x7684;&#x539F;&#x56E0;&#x4E86;&#x2014;&#x2014;<code>clientError</code> &#x662F;&#x4E00;&#x4E2A;&#x5173;&#x952E;&#x3002;</p>
<h2 id="&#x5904;&#x7406;&#x529E;&#x6CD5;"><a href="#&#x5904;&#x7406;&#x529E;&#x6CD5;" class="headerlink" title="&#x5904;&#x7406;&#x529E;&#x6CD5;"></a>&#x5904;&#x7406;&#x529E;&#x6CD5;</h2><p>&#x8981;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x201C;Bug&#x201D;&#x5176;&#x5B9E;&#x4E0D;&#x96BE;&#xFF0C;&#x76F4;&#x63A5;&#x76D1;&#x542C; <a href="/external_links/af2eec066b5c5ba2e44799e2c4f5b617.html" target="blank" rel="noopener"><code>clientError</code> &#x4E8B;&#x4EF6;</a>&#x5E76;&#x505A;&#x4E00;&#x4E9B;&#x5904;&#x7406;&#x5373;&#x53EF;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">js&#x590D;&#x5236;&#x4EE3;&#x7801;&apos;use strict&apos;;</span><br><span class="line"></span><br><span class="line">const http = require(&apos;http&apos;);</span><br><span class="line"></span><br><span class="line">const server = http.createServer(function(req, resp) {</span><br><span class="line">    console.log(&apos;&#x1F31A;&apos;);</span><br><span class="line">    resp.end(&apos;hello world&apos;);</span><br><span class="line">}).on(&apos;clientError&apos;, function(err, sock) {</span><br><span class="line">    console.log(&apos;&#x1F437;&apos;);</span><br><span class="line">    sock.end(&apos;HTTP/1.1 400 Bad Request\r\n\r\n&apos;);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">server.listen(5555);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>**&#x6CE8;&#x610F;&#xFF1A;**&#x7531;&#x4E8E;&#x8FD0;&#x884C;&#x5230; <code>clientError</code> &#x4E8B;&#x4EF6;&#x65F6;&#xFF0C;&#x5E76;&#x6CA1;&#x6709;&#x4EFB;&#x4F55; Request &#x548C; Response &#x7684;&#x5C01;&#x88C5;&#xFF0C;&#x4F60;&#x80FD;&#x62FF;&#x5230;&#x7684;&#x662F;&#x4E00;&#x4E2A; Node.js &#x4E2D;&#x539F;&#x59CB;&#x7684; Socket &#x5BF9;&#x8C61;&#xFF0C;&#x6240;&#x4EE5;&#x5F53;&#x4F60;&#x8981;&#x8FD4;&#x56DE;&#x6570;&#x636E;&#x7684;&#x65F6;&#x5019;&#x9700;&#x8981;&#x81EA;&#x5DF1;&#x6309;&#x7167; HTTP &#x8FD4;&#x56DE;&#x6570;&#x636E;&#x5305;&#x7684;&#x683C;&#x5F0F;&#x6765;&#x8F93;&#x51FA;&#x3002;</p>
</blockquote>
<p>&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x518D;&#x6325;&#x8D77;&#x4F60;&#x7684;&#x5C0F;&#x624B;&#x8BD5;&#x4E00;&#x4E0B; CURL &#x5427;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">perl&#x590D;&#x5236;&#x4EE3;&#x7801;$ curl &apos;http://127.0.0.1:5555/d d&apos; -v</span><br><span class="line">*   Trying 127.0.0.1...</span><br><span class="line">* TCP_NODELAY set</span><br><span class="line">* Connected to 127.0.0.1 (127.0.0.1) port 5555 (#0)</span><br><span class="line">&gt; GET /d d HTTP/1.1</span><br><span class="line">&gt; Host: 127.0.0.1:5555</span><br><span class="line">&gt; User-Agent: curl/7.54.0</span><br><span class="line">&gt; Accept: */*</span><br><span class="line">&gt;</span><br><span class="line">&lt; HTTP/1.1 400 Bad Request</span><br><span class="line">* no chunk, no close, no size. Assume close to signal end</span><br><span class="line">&lt;</span><br><span class="line">* Closing connection 0</span><br></pre></td></tr></table></figure>

<p>&#x5982;&#x613F;&#x4EE5;&#x507F;&#x5730;&#x8F93;&#x51FA;&#x4E86; 400 &#x72B6;&#x6001;&#x7801;&#x3002;</p>
<h2 id="&#x5F15;&#x7533;"><a href="#&#x5F15;&#x7533;" class="headerlink" title="&#x5F15;&#x7533;"></a>&#x5F15;&#x7533;</h2><p>&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x8981;&#x5F15;&#x7533;&#x8BA8;&#x8BBA;&#x7684;&#x4E00;&#x4E2A;&#x70B9;&#x662F;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x8FD9;&#x8D27;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x771F;&#x6B63;&#x610F;&#x4E49;&#x4E0A;&#x7684; Bug&#x3002;</p>
<p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x770B;&#x770B; Nginx &#x8FD9;&#x4E48;&#x5B9E;&#x73B0;&#x8FD9;&#x4E2A;&#x9ED1;&#x79D1;&#x6280;&#x7684;&#x5427;&#x3002;</p>
<h3 id="Nginx-&#x5B9E;&#x73B0;"><a href="#Nginx-&#x5B9E;&#x73B0;" class="headerlink" title="Nginx &#x5B9E;&#x73B0;"></a>Nginx &#x5B9E;&#x73B0;</h3><p>&#x6253;&#x5F00; Nginx &#x6E90;&#x7801;&#x7684;<a href="/external_links/ed47d928056a11ec8b8972cf43676c82.html" target="blank" rel="noopener">&#x76F8;&#x5E94;&#x4F4D;&#x7F6E;</a>&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x80FD;&#x770B;&#x5230;&#x5B83;&#x7684;&#x72B6;&#x6001;&#x673A;&#x5BF9;&#x4E8E; URI &#x548C; HTTP &#x534F;&#x8BAE;&#x58F0;&#x660E;&#x4E2D;&#x95F4;&#x591A;&#x4E86;&#x4E00;&#x4E2A;&#x4E2D;&#x95F4;&#x72B6;&#x6001;&#xFF0C;&#x53EB; <code>sw_check_uri_http_09</code>&#xFF0C;&#x4E13;&#x95E8;&#x5904;&#x7406; URI &#x540E;&#x9762;&#x7684;&#x7A7A;&#x683C;&#x3002;</p>
<p>&#x5728;&#x5404;&#x79CD; URI &#x89E3;&#x6790;&#x72B6;&#x6001;&#x4E2D;&#xFF0C;&#x57FA;&#x672C;&#x4E0A;&#x90FD;&#x80FD;&#x627E;&#x5230;&#x8FD9;&#x4E48;&#x4E00;&#x53E5;&#x8BDD;&#xFF0C;&#x8868;&#x793A;&#x82E5;&#x5F53;&#x524D;&#x72B6;&#x6001;&#x6B63;&#x5219;&#x89E3;&#x6790; URI &#x7684;&#x5404;&#x79CD;&#x72B6;&#x6001;&#x5E76;&#x4E14;&#x9047;&#x5230;&#x7A7A;&#x683C;&#x7684;&#x8BDD;&#xFF0C;&#x5219;&#x5C06;&#x72B6;&#x6001;&#x6539;&#x4E3A; <code>sw_check_uri_http_09</code>&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">c&#x590D;&#x5236;&#x4EE3;&#x7801;case sw_check_uri:</span><br><span class="line">  switch (ch) {</span><br><span class="line">  case &apos; &apos;:</span><br><span class="line">    r-&gt;uri_end = p;</span><br><span class="line">    state = sw_check_uri_http_09;</span><br><span class="line">    break;</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  ...</span><br></pre></td></tr></table></figure>

<p>&#x7136;&#x540E;&#x5728; <code>sw_check_uri_http_09</code> &#x72B6;&#x6001;&#x65F6;&#x4F1A;&#x505A;&#x4E00;&#x4E9B;&#x68C0;&#x67E5;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">c&#x590D;&#x5236;&#x4EE3;&#x7801;case sw_check_uri_http_09:</span><br><span class="line">    switch (ch) {</span><br><span class="line">    case &apos; &apos;:</span><br><span class="line">        break;</span><br><span class="line">    case CR:</span><br><span class="line">        r-&gt;http_minor = 9;</span><br><span class="line">        state = sw_almost_done;</span><br><span class="line">        break;</span><br><span class="line">    case LF:</span><br><span class="line">        r-&gt;http_minor = 9;</span><br><span class="line">        goto done;</span><br><span class="line">    case &apos;H&apos;:</span><br><span class="line">        r-&gt;http_protocol.data = p;</span><br><span class="line">        state = sw_http_H;</span><br><span class="line">        break;</span><br><span class="line">    default:</span><br><span class="line">        r-&gt;space_in_uri = 1;</span><br><span class="line">        state = sw_check_uri;</span><br><span class="line">        p--;</span><br><span class="line">        break;</span><br><span class="line">    }</span><br><span class="line">    break;</span><br></pre></td></tr></table></figure>

<p>&#x4F8B;&#x5982;&#xFF1A;</p>
<ul>
<li>&#x9047;&#x5230;&#x7A7A;&#x683C;&#x5219;&#x7EE7;&#x7EED;&#x4FDD;&#x6301;&#x5F53;&#x524D;&#x72B6;&#x6001;&#x5F00;&#x59CB;&#x626B;&#x63CF;&#x4E0B;&#x4E00;&#x4F4D;&#xFF1B;</li>
<li>&#x5982;&#x679C;&#x662F;&#x6362;&#x884C;&#x7B26;&#x5219;&#x8BBE;&#x7F6E;&#x9ED8;&#x8BA4; HTTP &#x7248;&#x672C;&#x5E76;&#x7EE7;&#x7EED;&#x626B;&#x63CF;&#xFF1B;</li>
<li>&#x5982;&#x679C;&#x9047;&#x5230;&#x7684;&#x662F; <code>H</code> &#x624D;&#x4FEE;&#x6539;&#x72B6;&#x6001;&#x4E3A; <code>sw_http_H</code> &#x8BA4;&#x4E3A;&#x63A5;&#x4E0B;&#x53BB;&#x5F00;&#x59CB; HTTP &#x7248;&#x672C;&#x626B;&#x63CF;&#xFF1B;</li>
<li>&#x5982;&#x679C;&#x662F;&#x5176;&#x5B83;&#x5B57;&#x7B26;&#xFF0C;&#x5219;&#x6807;&#x660E;&#x4E00;&#x4E0B; URI &#x4E2D;&#x6709;&#x7A7A;&#x683C;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x72B6;&#x6001;&#x6539;&#x56DE; <code>sw_check_uri</code>&#xFF0C;&#x7136;&#x540E;&#x5012;&#x9000;&#x56DE;&#x4E00;&#x683C;&#x4EE5; <code>sw_check_uri</code> &#x7EE7;&#x7EED;&#x626B;&#x63CF;&#x5F53;&#x524D;&#x7684;&#x7A7A;&#x683C;&#x3002;</li>
</ul>
<p>&#x5728;&#x7406;&#x89E3;&#x4E86;&#x8FD9;&#x4E2A;&#x201C;&#x9ED1;&#x79D1;&#x6280;&#x201D;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x5F88;&#x5FEB;&#x80FD;&#x627E;&#x5230;&#x4E00;&#x4E2A;&#x5F88;&#x597D;&#x73A9;&#x7684;&#x70B9;&#xFF0C;&#x5F00;&#x542F;&#x4F60;&#x7684; Nginx &#x5E76;&#x7528; CURL &#x8BF7;&#x6C42;&#x4EE5;&#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x4E00;&#x4E0B;&#x5B83;&#x770B;&#x770B;&#x5427;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">xml&#x590D;&#x5236;&#x4EE3;&#x7801;$ curl &apos;http://xcoder.in:5555/d H&apos; -v</span><br><span class="line">*   Trying 103.238.225.181...</span><br><span class="line">* TCP_NODELAY set</span><br><span class="line">* Connected to xcoder.in (103.238.225.181) port 5555 (#0)</span><br><span class="line">&gt; GET /d H HTTP/1.1</span><br><span class="line">&gt; Host: xcoder.in:5555</span><br><span class="line">&gt; User-Agent: curl/7.54.0</span><br><span class="line">&gt; Accept: */*</span><br><span class="line">&gt;</span><br><span class="line">&lt; HTTP/1.1 400 Bad Request</span><br><span class="line">&lt; Server: openresty/1.11.2.1</span><br><span class="line">&lt; Date: Tue, 12 Dec 2017 11:18:13 GMT</span><br><span class="line">&lt; Content-Type: text/html</span><br><span class="line">&lt; Content-Length: 179</span><br><span class="line">&lt; Connection: close</span><br><span class="line">&lt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;&lt;title&gt;400 Bad Request&lt;/title&gt;&lt;/head&gt;</span><br><span class="line">&lt;body bgcolor=&quot;white&quot;&gt;</span><br><span class="line">&lt;center&gt;&lt;h1&gt;400 Bad Request&lt;/h1&gt;&lt;/center&gt;</span><br><span class="line">&lt;hr&gt;&lt;center&gt;openresty/1.11.2.1&lt;/center&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">* Closing connection 0</span><br></pre></td></tr></table></figure>

<p>&#x600E;&#x4E48;&#x6837;&#xFF1F;&#x662F;&#x4E0D;&#x662F;&#x53D1;&#x73B0;&#x7ED3;&#x679C;&#x8DDF;&#x4E4B;&#x524D;&#x7684;&#x4E0D;&#x4E00;&#x6837;&#x4E86;&#x2014;&#x2014;&#x5B83;&#x5C45;&#x7136;&#x4E5F;&#x8FD4;&#x56DE;&#x4E86; 400 Bad Request&#x3002;</p>
<p>&#x539F;&#x56E0;&#x4E3A;&#x4F55;&#x5C31;&#x4EA4;&#x7ED9;&#x7AE5;&#x978B;&#x4EEC;&#x81EA;&#x5DF1;&#x8003;&#x8651;&#x5427;&#x3002;</p>
<h3 id="RFC-2616-&#x4E0E;-RFC-2396"><a href="#RFC-2616-&#x4E0E;-RFC-2396" class="headerlink" title="RFC 2616 &#x4E0E; RFC 2396"></a>RFC 2616 &#x4E0E; RFC 2396</h3><p>&#x90A3;&#x4E48;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x5373;&#x4F7F;&#x5728; Nginx &#x652F;&#x6301;&#x7A7A;&#x683C; URI &#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6211;&#x8FD8;&#x8BF4; Node.js &#x8FD9;&#x4E2A;&#x4E0D;&#x7B97; Bug&#xFF0C;&#x5E76;&#x4E14;&#x6307;&#x660E; Nginx &#x662F;&#x201C;&#x9ED1;&#x79D1;&#x6280;&#x201D;&#x5462;&#xFF1F;</p>
<p>&#x540E;&#x6765;&#x6211;&#x53BB;&#x770B;&#x4E86; HTTP &#x534F;&#x8BAE; RFC&#x3002;</p>
<p>&#x539F;&#x56E0;&#x5728;&#x4E8E; Network Working Group &#x7684; <a href="/external_links/1957bcdfebd486b9e0b0c924d317ef06.html" target="blank" rel="noopener">RFC 2616</a>&#xFF0C;&#x5173;&#x4E8E; HTTP &#x534F;&#x8BAE;&#x7684;&#x89C4;&#x8303;&#x3002;</p>
<p>&#x5728; RFC 2616 &#x7684; <a href="/external_links/77e3c7f5d513590f66d6404c6f9f2178.html" target="blank" rel="noopener">3.2.1 &#x8282;</a>&#x4E2D;&#x505A;&#x4E86;&#x4E00;&#x4E9B;&#x8BF4;&#x660E;&#xFF0C;&#x5B83;&#x8BF4;&#x4E86;&#x5728; HTTP &#x534F;&#x8BAE;&#x4E2D;&#x5173;&#x4E8E; URI &#x7684;&#x6587;&#x6CD5;&#x548C;&#x8BED;&#x4E49;&#x53C2;&#x7167;&#x4E86; <a href="/external_links/d14a4429195a3f2198d020ce8a68697a.html" target="blank" rel="noopener">RFC 2396</a>&#x3002;</p>
<blockquote>
<p>URIs in HTTP can be represented in absolute form or relative to some known base URI, depending upon the context of their use. The two forms are differentiated by the fact that absolute URIs always begin with a scheme name followed by a colon. For definitive information on URL syntax and semantics, see &#x201C;Uniform Resource Identifiers (URI): Generic Syntax and Semantics,&#x201D; RFC 2396 (which replaces RFCs 1738 and RFC 1808). This specification adopts the definitions of &#x201C;URI-reference&#x201D;, &#x201C;absoluteURI&#x201D;, &#x201C;relativeURI&#x201D;, &#x201C;port&#x201D;, &#x201C;host&#x201D;,&#x201D;abs_path&#x201D;, &#x201C;rel_path&#x201D;, and &#x201C;authority&#x201D; from that specification.</p>
</blockquote>
<p>&#x800C;&#x5728; <a href="/external_links/d14a4429195a3f2198d020ce8a68697a.html" target="blank" rel="noopener">RFC 2396</a> &#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x540C;&#x6837;&#x627E;&#x5230;&#x4E86;&#x5B83;&#x7684; <a href="/external_links/d14a4429195a3f2198d020ce8a68697a.html" target="blank" rel="noopener">2.4.3 &#x8282;</a>&#x3002;&#x91CC;&#x9762;&#x5BF9;&#x4E8E; Disallow &#x7684; US-ASCII &#x5B57;&#x7B26;&#x505A;&#x4E86;&#x89E3;&#x91CA;&#xFF0C;&#x5176;&#x4E2D;&#x6709;&#xFF1A;</p>
<ul>
<li>&#x63A7;&#x5236;&#x7B26;&#xFF0C;&#x6307; ASCII &#x7801;&#x5728; 0x00-0x1F &#x8303;&#x56F4;&#x5185;&#x4EE5;&#x53CA; 0x7F&#xFF1B;</li>
</ul>
<p>&#x63A7;&#x5236;&#x7B26;&#x901A;&#x5E38;&#x4E0D;&#x53EF;&#x89C1;&#xFF1B;</p>
<ul>
<li>&#x7A7A;&#x683C;&#xFF0C;&#x6307; 0x20&#xFF1B;</li>
</ul>
<p>&#x7A7A;&#x683C;&#x4E0D;&#x53EF;&#x63A7;&#xFF0C;&#x5982;&#x7ECF;&#x7531;&#x4E00;&#x4E9B;&#x6392;&#x7248;&#x8F6F;&#x4EF6;&#x8F6C;&#x5F55;&#x540E;&#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x53D8;&#x5316;&#xFF0C;&#x800C;&#x5230;&#x4E86; HTTP &#x534F;&#x8BAE;&#x8FD9;&#x5C42;&#x65F6;&#xFF0C;&#x53CD;&#x6B63;&#x7A7A;&#x683C;&#x4E0D;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x5C31;&#x7D22;&#x6027;&#x7528;&#x7A7A;&#x683C;&#x4F5C;&#x4E3A;&#x9996;&#x884C;&#x5206;&#x9694;&#x7B26;&#x4E86;&#xFF1B;</p>
<ul>
<li>&#x5206;&#x9694;&#x7B26;&#xFF0C;<code>&quot;&lt;&quot;</code>&#x3001;<code>&quot;&gt;&quot;</code>&#x3001;<code>&quot;#&quot;</code>&#x3001;<code>&quot;%&quot;</code>&#x3001;<code>&quot;\&quot;&quot;</code>&#x3002;</li>
</ul>
<p>&#x5982; <code>#</code> &#x5C06;&#x7528;&#x4E8E;&#x6D4F;&#x89C8;&#x5668;&#x5730;&#x5740;&#x680F;&#x7684; Hash&#xFF1B;&#x800C; <code>%</code> &#x5219;&#x4F1A;&#x4E0E; URI &#x8F6C;&#x4E49;&#x4E00;&#x540C;&#x4F7F;&#x7528;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x5E94;&#x5355;&#x72EC;&#x51FA;&#x73B0;&#x5728; URI &#x4E2D;&#x3002;</p>
<p><strong>&#x4E8E;&#x662F;&#x4E4E;&#xFF0C;HTTP &#x8BF7;&#x6C42;&#x4E2D;&#xFF0C;&#x5305;&#x4F53;&#x7684; URI &#x4F3C;&#x4E4E;&#x672C;&#x5C31;&#x4E0D;&#x5E94;&#x8BE5;&#x51FA;&#x73B0;&#x7A7A;&#x683C;&#xFF0C;&#x800C; Nginx &#x662F;&#x4E00;&#x4E2A;&#x9ED1;&#x9B54;&#x6CD5;&#x7684;&#x59FF;&#x52BF;&#x3002;</strong></p>
<h2 id="&#x5C0F;&#x7ED3;"><a href="#&#x5C0F;&#x7ED3;" class="headerlink" title="&#x5C0F;&#x7ED3;"></a>&#x5C0F;&#x7ED3;</h2><p>&#x56AF;&#xFF0C;&#x5199;&#x5F97;&#x7D2F;&#x6B7B;&#x4E86;&#x3002;&#x672C;&#x6B21;&#x7684;&#x4E00;&#x4E2A;&#x63A2;&#x7D22;&#x57FA;&#x4E8E;&#x4E86;&#x4E00;&#x4E2A;&#x6709;&#x7A7A;&#x683C;&#x975E;&#x6B63;&#x5E38;&#x7684; URI &#x901A;&#x8FC7; CURL &#x6216;&#x8005;&#x5176;&#x5B83;&#x4E00;&#x4E9B;&#x5BA2;&#x6237;&#x7AEF;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;Node.js &#x51FA;&#x73B0;&#x7684; Bug &#x72B6;&#x6001;&#x3002;</p>
<blockquote>
<p>&#x5B9E;&#x9645;&#x4E0A;&#x53D1;&#x73B0;&#x8FD9;&#x4E2A; Bug &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x8BF7;&#x6C42;&#x4F3C;&#x4E4E;&#x662F;&#x56E0;&#x4E3A;&#x90A3;&#x8FB9;&#x7684;&#x5F00;&#x53D1;&#x8005;&#x624B;&#x6296;&#xFF0C;&#x4E0D;&#x5C0F;&#x5FC3;&#x5C06;&#x4E0D;&#x5E94;&#x8BE5;&#x62FC;&#x63A5;&#x8FDB;&#x6765;&#x7684;&#x5185;&#x5BB9;&#x7ED9;&#x62FC;&#x63A5;&#x5230;&#x4E86; URL &#x4E2D;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E8E; <code>$ rm -rf /</code>&#x3002;</p>
</blockquote>
<p>&#x4E00;&#x5F00;&#x59CB;&#x6211;&#x4EE5;&#x4E3A;&#x8FD9;&#x662F; Node.js &#x7684; Bug&#xFF0C;&#x5728;&#x63A2;&#x5BFB;&#x4E4B;&#x540E;&#x53D1;&#x73B0;&#x662F;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x6CA1;&#x7528; Node.js HTTP Server &#x63D0;&#x4F9B;&#x7684; <code>clientError</code> &#x4E8B;&#x4EF6;&#x505A;&#x6B63;&#x786E;&#x7684;&#x5904;&#x7406;&#x3002;&#x800C; Nginx &#x7684;&#x6B63;&#x5E38;&#x8BF7;&#x6C42;&#x5219;&#x662F;&#x5B83;&#x7684;&#x9ED1;&#x79D1;&#x6280;&#x3002;&#x8FD9;&#x4E9B;&#x7B54;&#x6848;&#x90FD;&#x80FD;&#x4ECE; RFC &#x4E2D;&#x5BFB;&#x627E;&#x2014;&#x2014;<strong>&#x518D;&#x6B21;&#x4F53;&#x73B0;&#x4E86;&#x9047;&#x5230;&#x95EE;&#x9898;&#x770B;&#x6E90;&#x7801;&#x770B;&#x89C4;&#x8303;&#x7684;&#x91CD;&#x8981;&#x6027;&#x3002;</strong></p>
<p>&#x53E6;&#xFF0C;&#x6211;&#x672C;&#x6253;&#x7B97;&#x7ED9; http-parser &#x4E5F;&#x52A0;&#x4E0A;&#x9ED1;&#x9B54;&#x6CD5;&#xFF0C;&#x540E;&#x6765;&#x6211;&#x5FEB;&#x5199;&#x597D;&#x7684;&#x65F6;&#x5019;&#x53D1;&#x73B0;&#x5B83;&#x662F;&#x6D41;&#x5F0F;&#x7684;&#xFF0C;&#x5F88;&#x591A;&#x72B6;&#x6001;&#x6CA1;&#x6CD5;&#x5728;&#x73B0;&#x6709;&#x7684;&#x4F53;&#x7CFB;&#x4E2D;&#x4FDD;&#x7559;&#x4E0B;&#x6765;&#xFF0C;&#x6700;&#x540E;&#x653E;&#x5F03;&#x4E86;&#xFF0C;&#x53CD;&#x6B63;&#x8FD9;&#x4E5F;&#x4E0D;&#x7B97; Bug&#x3002;&#x4E0D;&#x8FC7;&#x5728;&#x4EE5;&#x540E;&#x6709;&#x65F6;&#x95F4;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x611F;&#x89C9;&#x8FD8;&#x662F;&#x53EF;&#x4EE5;&#x597D;&#x597D;&#x6574;&#x7406;&#x4E00;&#x4E0B;&#x4EE3;&#x7801;&#xFF0C;&#x597D;&#x597D;&#x4FEE;&#x6539;&#x4E00;&#x4E0B;&#x7ED9;&#x63D0;&#x4E2A; PR &#x4E0A;&#x53BB;&#xFF0C;&#x4EE5;&#x6B64;&#x81EA;&#x52C9;&#x3002;</p>
<p>&#x6700;&#x540E;&#xFF0C;&#x6C42; fafa&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/0b887742e121ba06b2a501b9e85a55bfa84c9ab6374f4a7d3bc226f0a162423f" alt></p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/8e7a41f77409815e75dbb42643ffbda5.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903522513747982.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903522513747982.html" itemprop="url">从JDK源码看OutputStream</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-13T16:27:21+08:00">
                2017-12-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="&#x6982;&#x51B5;"><a href="#&#x6982;&#x51B5;" class="headerlink" title="&#x6982;&#x51B5;"></a>&#x6982;&#x51B5;</h2><p>&#x524D;&#x9762;&#x5DF2;&#x7ECF;&#x4E86;&#x89E3;&#x4E86;&#x8F93;&#x5165;&#x6D41;&#x300A;<a href="/external_links/d29a341ffd63a753893e08b049417407.html" target="blank" rel="noopener">&#x4ECE;JDK&#x6E90;&#x7801;&#x770B;InputStream</a>&#x300B;&#xFF0C;&#x63A5;&#x7740;&#x770B;&#x5BF9;&#x5E94;&#x7684;&#x8F93;&#x51FA;&#x6D41;&#xFF0C;JDK &#x7ED9;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;&#x4E86;&#x5F88;&#x591A;&#x5B9E;&#x7528;&#x7684;&#x8F93;&#x51FA;&#x6D41; xxxOutputStream&#xFF0C;&#x800C; OutputStream &#x662F;&#x6240;&#x6709;&#x5B57;&#x8282;&#x8F93;&#x51FA;&#x6D41;&#x7684;&#x62BD;&#x8C61;&#x3002;&#x5305;&#x62EC; ByteArrayOutputStream &#x3001;FilterOutputStream &#x3001;BufferedOutputStream &#x3001;DataOutputStream &#x548C; PushbackOutputStream &#x7B49;&#x7B49;&#x3002;</p>
<h2 id="&#x7EE7;&#x627F;&#x7ED3;&#x6784;"><a href="#&#x7EE7;&#x627F;&#x7ED3;&#x6784;" class="headerlink" title="&#x7EE7;&#x627F;&#x7ED3;&#x6784;"></a>&#x7EE7;&#x627F;&#x7ED3;&#x6784;</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;--java.lang.Object</span><br><span class="line">  --java.io.OutputStream</span><br></pre></td></tr></table></figure>

<h2 id="&#x7C7B;&#x5B9A;&#x4E49;"><a href="#&#x7C7B;&#x5B9A;&#x4E49;" class="headerlink" title="&#x7C7B;&#x5B9A;&#x4E49;"></a>&#x7C7B;&#x5B9A;&#x4E49;</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public abstract class OutputStream implements Closeable, Flushable</span><br></pre></td></tr></table></figure>

<p>OutputStream &#x88AB;&#x5B9A;&#x4E3A; public &#x4E14; abstract &#x7684;&#x7C7B;&#xFF0C;&#x5B9E;&#x73B0;&#x4E86; Closeable &#x548C; Flushable &#x63A5;&#x53E3;&#x3002;</p>
<p>Closeable &#x63A5;&#x53E3;&#x8868;&#x793A; OutputStream &#x53EF;&#x4EE5;&#x88AB;close&#xFF0C;&#x63A5;&#x53E3;&#x5B9A;&#x4E49;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public interface Closeable extends AutoCloseable {</span><br><span class="line">    public void close() throws IOException;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x800C; Flushable &#x63A5;&#x53E3;&#x8868;&#x793A; OutputStream &#x53EF;&#x4EE5;&#x8FDB;&#x884C; flush &#x64CD;&#x4F5C;&#xFF0C;&#x63A5;&#x53E3;&#x5B9A;&#x4E49;&#x5982;&#x4E0B;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public interface Flushable {</span><br><span class="line">    void flush() throws IOException;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h2 id="&#x4E3B;&#x8981;&#x5C5E;&#x6027;"><a href="#&#x4E3B;&#x8981;&#x5C5E;&#x6027;" class="headerlink" title="&#x4E3B;&#x8981;&#x5C5E;&#x6027;"></a>&#x4E3B;&#x8981;&#x5C5E;&#x6027;</h2><p>&#x6CA1;&#x6709;&#x5C5E;&#x6027;</p>
<h2 id="&#x4E3B;&#x8981;&#x65B9;&#x6CD5;"><a href="#&#x4E3B;&#x8981;&#x65B9;&#x6CD5;" class="headerlink" title="&#x4E3B;&#x8981;&#x65B9;&#x6CD5;"></a>&#x4E3B;&#x8981;&#x65B9;&#x6CD5;</h2><h3 id="write&#x65B9;&#x6CD5;"><a href="#write&#x65B9;&#x6CD5;" class="headerlink" title="write&#x65B9;&#x6CD5;"></a>write&#x65B9;&#x6CD5;</h3><p>&#x4E00;&#x5171;&#x6709;&#x4E09;&#x4E2A; write &#x65B9;&#x6CD5;&#xFF0C;&#x5176;&#x4E2D;&#x6709;&#x4E00;&#x4E2A;&#x62BD;&#x8C61;&#x7684; write &#x65B9;&#x6CD5;&#xFF0C;&#x5176;&#x4F59;&#x4E24;&#x4E2A; write &#x65B9;&#x6CD5;&#x90FD;&#x4F1A;&#x8C03;&#x7528;&#x8FD9;&#x4E2A;&#x62BD;&#x8C61;&#x65B9;&#x6CD5;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x7528;&#x4E8E;&#x5C06;&#x4E00;&#x4E2A;&#x5B57;&#x8282;&#x5199;&#x5165;&#x4E00;&#x4E2A;&#x8F93;&#x51FA;&#x6D41;&#x8BFB;&#x3002;</p>
<p>&#x4E3B;&#x8981;&#x770B;&#x7B2C;&#x4E09;&#x4E2A; write &#x65B9;&#x6CD5;&#x5373;&#x53EF;&#xFF0C;&#x5B83;&#x4F20;&#x5165;&#x7684;&#x4E09;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;byte&#x6570;&#x7EC4;&#x3001;&#x504F;&#x79FB;&#x91CF;&#x548C;&#x6570;&#x7EC4;&#x957F;&#x5EA6;&#x3002;&#x8BE5;&#x65B9;&#x6CD5;&#x4E3B;&#x8981;&#x662F;&#x5C06;&#x6307;&#x5B9A;&#x957F;&#x5EA6;&#x7684;&#x5B57;&#x8282;&#x6570;&#x636E;&#x5199;&#x5165;&#x5230;&#x8F93;&#x51FA;&#x6D41;&#x4E2D;&#xFF0C;&#x800C;&#x5728;&#x5199;&#x5165;&#x524D;&#x4F1A;&#x68C0;&#x67E5;&#x6570;&#x7EC4;&#x662F;&#x5426;&#x4E3A;&#x7A7A;&#xFF0C;&#x504F;&#x79FB;&#x91CF;&#x548C;&#x957F;&#x5EA6;&#x662F;&#x5426;&#x6EE1;&#x8DB3;&#x6B63;&#x786E;&#x7684;&#x6761;&#x4EF6;&#x7B49;&#x7B49;&#x3002;&#x6700;&#x540E;&#x624D;&#x662F;&#x8C03;&#x7528;&#x62BD;&#x8C61;&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x5199;&#x64CD;&#x4F5C;&#xFF0C;&#x62BD;&#x8C61;&#x65B9;&#x6CD5;&#x4E00;&#x822C;&#x90FD;&#x7531;&#x5B50;&#x7C7B;&#x5B9E;&#x73B0;&#x5177;&#x4F53;&#x7684;&#x903B;&#x8F91;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">public abstract void write(int b) throws IOException;</span><br><span class="line"></span><br><span class="line">    public void write(byte b[]) throws IOException {</span><br><span class="line">        write(b, 0, b.length);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    public void write(byte b[], int off, int len) throws IOException {</span><br><span class="line">        if (b == null) {</span><br><span class="line">            throw new NullPointerException();</span><br><span class="line">        } else if ((off &lt; 0) || (off &gt; b.length) || (len &lt; 0) ||</span><br><span class="line">                   ((off + len) &gt; b.length) || ((off + len) &lt; 0)) {</span><br><span class="line">            throw new IndexOutOfBoundsException();</span><br><span class="line">        } else if (len == 0) {</span><br><span class="line">            return;</span><br><span class="line">        }</span><br><span class="line">        for (int i = 0 ; i &lt; len ; i++) {</span><br><span class="line">            write(b[off + i]);</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<h3 id="flush&#x65B9;&#x6CD5;"><a href="#flush&#x65B9;&#x6CD5;" class="headerlink" title="flush&#x65B9;&#x6CD5;"></a>flush&#x65B9;&#x6CD5;</h3><p>&#x5BF9;&#x8BE5;&#x8F93;&#x51FA;&#x6D41;&#x4E2D;&#x7F13;&#x51B2;&#x7684;&#x5B57;&#x8282;&#x8FDB;&#x884C; flush &#x64CD;&#x4F5C;&#xFF0C;&#x5373;&#x4E4B;&#x524D;&#x5199;&#x5165;&#x8BE5;&#x8F93;&#x51FA;&#x6D41;&#x7F13;&#x51B2;&#x533A;&#x7684;&#x5B57;&#x8282;&#x5C06;&#x88AB;&#x5F3A;&#x5236; flush &#x5230;&#x76EE;&#x7684;&#x5730;&#x3002;&#x5176;&#x4E2D;&#x76EE;&#x7684;&#x5730;&#x53EF;&#x80FD;&#x7684;&#x60C5;&#x51B5;&#x4E3A;&#xFF1A;</p>
<ol>
<li>&#x5982;&#x679C;&#x662F;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x90A3;&#x4E48; flush &#x64CD;&#x4F5C;&#x53EA;&#x80FD;&#x4FDD;&#x8BC1;&#x8BE5;&#x8F93;&#x51FA;&#x6D41;&#x7F13;&#x51B2;&#x533A;&#x7684;&#x5B57;&#x8282;&#x6570;&#x636E;&#x5199;&#x5165;&#x5230;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x4E2D;&#x7B49;&#x5F85;&#x5199;&#x5165;&#xFF0C;&#x800C;&#x5E76;&#x4E0D;&#x80FD;&#x4FDD;&#x8BC1;&#x5C06;&#x5176;&#x5199;&#x5230;&#x78C1;&#x76D8;&#x4E0A;&#x3002;</li>
<li>&#x5982;&#x679C;&#x662F;&#x5957;&#x63A5;&#x5B57;&#xFF0C;&#x90A3;&#x4E48; flush &#x64CD;&#x4F5C;&#x53EA;&#x80FD;&#x4FDD;&#x8BC1;&#x5199;&#x5165;&#x5230;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x4E2D;&#x7B49;&#x5F85;&#x4F20;&#x5230;&#x5176;&#x4ED6;&#x8282;&#x70B9;&#xFF0C;&#x800C;&#x4E0D;&#x80FD;&#x4FDD;&#x8BC1;&#x5176;&#x80FD;&#x7ACB;&#x523B;&#x5199;&#x5165;&#x5230;&#x8FDC;&#x7A0B;&#x8282;&#x70B9;&#x3002;</li>
<li>&#x5982;&#x679C;&#x662F;&#x5176;&#x4ED6;&#x8BBE;&#x5907;&#xFF0C;&#x90A3;&#x4E48; flush &#x4E5F;&#x53EA;&#x662F;&#x5C06;&#x5176;&#x5199;&#x5165;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#xFF0C;&#x800C;&#x5230;&#x8FBE;&#x5176;&#x4ED6;&#x8BBE;&#x5907;&#x5219;&#x7531;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x63A7;&#x5236;&#x3002;</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public void flush() throws IOException {}</span><br></pre></td></tr></table></figure>

<h3 id="close&#x65B9;&#x6CD5;"><a href="#close&#x65B9;&#x6CD5;" class="headerlink" title="close&#x65B9;&#x6CD5;"></a>close&#x65B9;&#x6CD5;</h3><p>&#x6B64;&#x65B9;&#x6CD5;&#x7528;&#x4E8E;&#x5173;&#x95ED;&#x8F93;&#x51FA;&#x6D41;&#xFF0C;&#x5E76;&#x4E14;&#x91CA;&#x653E;&#x76F8;&#x5173;&#x8D44;&#x6E90;&#xFF0C;&#x4F5C;&#x4E3A;&#x62BD;&#x8C61;&#x7C7B;&#xFF0C;&#x8FD9;&#x91CC;&#x5173;&#x95ED;&#x52A8;&#x4F5C;&#x4E0D;&#x505A;&#x4EFB;&#x4F55;&#x4E8B;&#x3002;&#x53E6;&#x5916;&#x5173;&#x95ED;&#x4E86;&#x7684;&#x6D41;&#x65E0;&#x6CD5;&#x518D;&#x91CD;&#x65B0;&#x6253;&#x5F00;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public void close() throws IOException {}</span><br></pre></td></tr></table></figure>

<p>=============&#x5E7F;&#x544A;&#x65F6;&#x95F4;===============</p>
<p>&#x516C;&#x4F17;&#x53F7;&#x7684;&#x83DC;&#x5355;&#x5DF2;&#x5206;&#x4E3A;&#x201C;&#x5206;&#x5E03;&#x5F0F;&#x201D;&#x3001;&#x201C;&#x673A;&#x5668;&#x5B66;&#x4E60;&#x201D;&#x3001;&#x201C;&#x6DF1;&#x5EA6;&#x5B66;&#x4E60;&#x201D;&#x3001;&#x201C;NLP&#x201D;&#x3001;&#x201C;Java&#x6DF1;&#x5EA6;&#x201D;&#x3001;&#x201C;Java&#x5E76;&#x53D1;&#x6838;&#x5FC3;&#x201D;&#x3001;&#x201C;JDK&#x6E90;&#x7801;&#x201D;&#x3001;&#x201C;Tomcat&#x5185;&#x6838;&#x201D;&#x7B49;&#xFF0C;&#x53EF;&#x80FD;&#x6709;&#x4E00;&#x6B3E;&#x9002;&#x5408;&#x4F60;&#x7684;&#x80C3;&#x53E3;&#x3002;</p>
<p>&#x9119;&#x4EBA;&#x7684;&#x65B0;&#x4E66;&#x300A;Tomcat&#x5185;&#x6838;&#x8BBE;&#x8BA1;&#x5256;&#x6790;&#x300B;&#x5DF2;&#x7ECF;&#x5728;&#x4EAC;&#x4E1C;&#x9500;&#x552E;&#x4E86;&#xFF0C;&#x6709;&#x9700;&#x8981;&#x7684;&#x670B;&#x53CB;&#x53EF;&#x4EE5;&#x8D2D;&#x4E70;&#x3002;&#x611F;&#x8C22;&#x5404;&#x4F4D;&#x670B;&#x53CB;&#x3002;</p>
<p><a href="/external_links/1054677517988dca01f26bb397d50624.html" target="blank" rel="noopener">&#x4E3A;&#x4EC0;&#x4E48;&#x5199;&#x300A;Tomcat&#x5185;&#x6838;&#x8BBE;&#x8BA1;&#x5256;&#x6790;&#x300B;</a></p>
<p>=========================</p>
<p>&#x76F8;&#x5173;&#x9605;&#x8BFB;&#xFF1A;</p>
<p><a href="/external_links/d29a341ffd63a753893e08b049417407.html" target="blank" rel="noopener">&#x4ECE;JDK&#x6E90;&#x7801;&#x770B;InputStream</a></p>
<p><a href="/external_links/50d1a2ed389d27442a46c1476e3b1956.html" target="blank" rel="noopener">&#x4ECE;JDK&#x6E90;&#x7801;&#x770B;Writer</a></p>
<p>&#x6B22;&#x8FCE;&#x5173;&#x6CE8;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/49c7893013f0846ec41bb77b74a7cccfeaeb884211243724b3cd261c2c8cc5ed" alt="&#x8FD9;&#x91CC;&#x5199;&#x56FE;&#x7247;&#x63CF;&#x8FF0;"></p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/b84f04a664d3c99072fe6ab74c249cba.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="../252/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="../../">1</a><span class="space">&hellip;</span><a class="page-number" href="../252/">252</a><span class="page-number current">253</span><a class="page-number" href="../254/">254</a><span class="space">&hellip;</span><a class="page-number" href="../298/">298</a><a class="extend next" rel="next" href="../254/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">开发者博客</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="https://dev.newban.cn/archives/">
              
                  <span class="site-state-item-count">2975</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">1162</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="../../atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">开发者博客</span>
  <div>
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
  </div>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




  <script type="text/javascript" async src="js/src/mermaid.min.js"></script>
  <script>
  if (window.mermaid) {
        var mermaid_config = {
            startOnLoad: true,
            theme: 'default',
            flowchart:{
                useMaxWidth: false,
                htmlLabels: true
            }                
        }
        mermaid.initialize(mermaid_config);
  }
  </script>
  

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="../../lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="../../lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="../../lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="../../lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="../../lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="../../lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="../../js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="../../js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="../../js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
