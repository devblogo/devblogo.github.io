<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">
<meta name="referrer" content="never">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="../../lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="../../lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="../../css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="../../images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="../../images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="../../images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="../../images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">





  <link rel="alternate" href="../../atom.xml" title="开发者博客 – IT技术 尽在开发者博客" type="application/atom+xml">






<meta property="og:type" content="website">
<meta property="og:title" content="开发者博客 – IT技术 尽在开发者博客">
<meta property="og:url" content="https://dev.newban.cn/page/386/index.html">
<meta property="og:site_name" content="开发者博客 – IT技术 尽在开发者博客">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="开发者博客 – IT技术 尽在开发者博客">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>
<!--谷歌广告验证代码-->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-2626449904708114",
          enable_page_level_ads: true
     });
</script>
<!--谷歌广告验证代码-->



  <link rel="canonical" href="https://dev.newban.cn/page/386/">





  <title>开发者博客 – IT技术 尽在开发者博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">开发者博客 – IT技术 尽在开发者博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">开发者博客 – 科技是第一生产力</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="http://dev.newban.cn/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="https://dev.newban.cn/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903512413831181.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903512413831181.html" itemprop="url">redis源码分析之有序集SortedSet</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-20T12:00:24+08:00">
                2017-11-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>&#x6709;&#x5E8F;&#x96C6;SortedSet&#x7B97;&#x662F;redis&#x4E2D;&#x4E00;&#x4E2A;&#x5F88;&#x6709;&#x7279;&#x8272;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF0C;&#x901A;&#x8FC7;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x6765;&#x603B;&#x7ED3;&#x4E00;&#x4E0B;&#x8FD9;&#x5757;&#x77E5;&#x8BC6;&#x70B9;&#x3002;</p>
</blockquote>
<p>&#x539F;&#x6587;&#x5730;&#x5740;&#xFF1A;<a href="/external_links/99b417882107c32f516d2dedb23fa150.html" target="blank" rel="noopener">www.jianshu.com/p/75ca5a359&#x2026;</a></p>
<h3 id="&#x4E00;&#x3001;&#x6709;&#x5E8F;&#x96C6;SortedSet&#x547D;&#x4EE4;&#x7B80;&#x4ECB;"><a href="#&#x4E00;&#x3001;&#x6709;&#x5E8F;&#x96C6;SortedSet&#x547D;&#x4EE4;&#x7B80;&#x4ECB;" class="headerlink" title="&#x4E00;&#x3001;&#x6709;&#x5E8F;&#x96C6;SortedSet&#x547D;&#x4EE4;&#x7B80;&#x4ECB;"></a>&#x4E00;&#x3001;&#x6709;&#x5E8F;&#x96C6;SortedSet&#x547D;&#x4EE4;&#x7B80;&#x4ECB;</h3><p>redis&#x4E2D;&#x7684;&#x6709;&#x5E8F;&#x96C6;&#xFF0C;&#x5141;&#x8BB8;&#x7528;&#x6237;&#x4F7F;&#x7528;&#x6307;&#x5B9A;&#x503C;&#x5BF9;&#x653E;&#x8FDB;&#x53BB;&#x7684;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#xFF0C;&#x5E76;&#x4E14;&#x57FA;&#x4E8E;&#x8BE5;&#x5DF2;&#x6392;&#x5E8F;&#x7684;&#x96C6;&#x5408;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x7CFB;&#x5217;&#x4E30;&#x5BCC;&#x7684;&#x64CD;&#x4F5C;&#x96C6;&#x5408;&#x7684;API&#x3002;<br>&#x4E3E;&#x4F8B;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;//&#x6DFB;&#x52A0;&#x5143;&#x7D20;&#xFF0C;table1&#x4E3A;&#x6709;&#x5E8F;&#x96C6;&#x7684;&#x540D;&#x5B57;&#xFF0C;100&#x4E3A;&#x7528;&#x4E8E;&#x6392;&#x5E8F;&#x5B57;&#x6BB5;&#xFF08;redis&#x628A;&#x5B83;&#x53EB;&#x505A;score&#xFF09;&#xFF0C;a&#x4E3A;&#x6211;&#x4EEC;&#x8981;&#x5B58;&#x50A8;&#x7684;&#x5143;&#x7D20;</span><br><span class="line">127.0.0.1:6379&gt; zadd table1 100 a</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; zadd table1 200 b</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; zadd table1 300 c</span><br><span class="line">(integer) 1</span><br><span class="line">//&#x6309;&#x7167;&#x5143;&#x7D20;&#x7D22;&#x5F15;&#x8FD4;&#x56DE;&#x6709;&#x5E8F;&#x96C6;&#x4E2D;&#x7684;&#x5143;&#x7D20;&#xFF0C;&#x7D22;&#x5F15;&#x4ECE;0&#x5F00;&#x59CB;</span><br><span class="line">127.0.0.1:6379&gt; zrange table1 0 1</span><br><span class="line">1) &quot;a&quot;</span><br><span class="line">2) &quot;b&quot;</span><br><span class="line">//&#x6309;&#x7167;&#x5143;&#x7D20;&#x6392;&#x5E8F;&#x8303;&#x56F4;&#x8FD4;&#x56DE;&#x6709;&#x5E8F;&#x96C6;&#x4E2D;&#x7684;&#x5143;&#x7D20;&#xFF0C;&#x8FD9;&#x91CC;&#x7528;&#x4E8E;&#x6392;&#x5E8F;&#x7684;&#x5B57;&#x6BB5;&#x5728;redis&#x4E2D;&#x53EB;&#x505A;score</span><br><span class="line">127.0.0.1:6379&gt; zrangebyscore table1 150 400</span><br><span class="line">1) &quot;b&quot;</span><br><span class="line">2) &quot;c&quot;</span><br><span class="line">//&#x5220;&#x9664;&#x5143;&#x7D20;</span><br><span class="line">127.0.0.1:6379&gt; zrem table1 b</span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure>

<p><strong>&#x5728;&#x6709;&#x5E8F;&#x96C6;&#x4E2D;&#xFF0C;&#x7528;&#x4E8E;&#x6392;&#x5E8F;&#x7684;&#x503C;&#x53EB;&#x505A;score&#xFF0C;&#x5B9E;&#x9645;&#x5B58;&#x50A8;&#x7684;&#x503C;&#x53EB;&#x505A;member&#x3002;</strong></p>
<p>&#x7531;&#x4E8E;&#x6709;&#x5E8F;&#x96C6;&#x4E2D;&#x63D0;&#x4F9B;&#x7684;API&#x8F83;&#x591A;&#xFF0C;&#x8FD9;&#x91CC;&#x53EA;&#x4E3E;&#x4E86;&#x51E0;&#x4E2A;&#x5E38;&#x89C1;&#x7684;&#xFF0C;&#x5177;&#x4F53;&#x53EF;&#x4EE5;&#x53C2;&#x8003;redis&#x6587;&#x6863;&#x3002;</p>
<p>&#x5173;&#x4E8E;&#x6709;&#x5E8F;&#x96C6;&#xFF0C;&#x6211;&#x4EEC;&#x6709;&#x4E00;&#x4E2A;&#x5341;&#x5206;&#x5E38;&#x89C1;&#x7684;&#x4F7F;&#x7528;&#x573A;&#x666F;&#x5C31;&#x662F;&#x7528;&#x6237;&#x8BC4;&#x8BBA;&#x3002;&#x5728;APP&#x6216;&#x8005;&#x7F51;&#x7AD9;&#x4E0A;&#x53D1;&#x5E03;&#x4E00;&#x6761;&#x6D88;&#x606F;&#xFF0C;&#x4E0B;&#x9762;&#x4F1A;&#x6709;&#x5F88;&#x591A;&#x8BC4;&#x8BBA;&#xFF0C;&#x901A;&#x5E38;&#x5C55;&#x793A;&#x662F;&#x6309;&#x7167;&#x53D1;&#x5E03;&#x65F6;&#x95F4;&#x5012;&#x5E8F;&#x6392;&#x5217;&#xFF0C;&#x8FD9;&#x4E2A;&#x9700;&#x6C42;&#x5C31;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x6709;&#x5E8F;&#x96C6;&#xFF0C;&#x4EE5;&#x53D1;&#x5E03;&#x8BC4;&#x8BBA;&#x7684;&#x65F6;&#x95F4;&#x6233;&#x4F5C;&#x4E3A;score&#xFF0C;&#x7136;&#x540E;&#x6309;&#x7167;&#x5C55;&#x793A;&#x8BC4;&#x8BBA;&#x7684;&#x6570;&#x91CF;&#x5012;&#x5E8F;&#x67E5;&#x627E;&#x6709;&#x5E8F;&#x96C6;&#x3002;</p>
<h3 id="&#x4E8C;&#x3001;&#x6709;&#x5E8F;&#x96C6;SortedSet&#x547D;&#x4EE4;&#x6E90;&#x7801;&#x5206;&#x6790;"><a href="#&#x4E8C;&#x3001;&#x6709;&#x5E8F;&#x96C6;SortedSet&#x547D;&#x4EE4;&#x6E90;&#x7801;&#x5206;&#x6790;" class="headerlink" title="&#x4E8C;&#x3001;&#x6709;&#x5E8F;&#x96C6;SortedSet&#x547D;&#x4EE4;&#x6E90;&#x7801;&#x5206;&#x6790;"></a>&#x4E8C;&#x3001;&#x6709;&#x5E8F;&#x96C6;SortedSet&#x547D;&#x4EE4;&#x6E90;&#x7801;&#x5206;&#x6790;</h3><p>&#x8001;&#x89C4;&#x77E9;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x662F;&#x4ECE;server.c&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x547D;&#x4EE4;&#x8868;&#x4E2D;&#x627E;&#x5230;&#x76F8;&#x5173;&#x547D;&#x4EE4;&#x7684;&#x5904;&#x7406;&#x51FD;&#x6570;&#xFF0C;&#x7136;&#x540E;&#x4E00;&#x4E00;&#x5206;&#x6790;&#x3002;<br>&#x4F9D;&#x65E7;&#x4ECE;&#x6DFB;&#x52A0;&#x5143;&#x7D20;&#x5F00;&#x59CB;&#xFF0C;zaddCommand&#x51FD;&#x6570;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;void zaddCommand(client *c) {</span><br><span class="line">    zaddGenericCommand(c,ZADD_NONE);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x91CC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6D41;&#x7A0B;&#x8F6C;&#x5411;&#x4E86;zaddGenericCommand&#xFF0C;&#x5E76;&#x4E14;&#x4F20;&#x5165;&#x4E86;&#x4E00;&#x4E2A;&#x6A21;&#x5F0F;&#x6807;&#x8BB0;&#x3002;<br>&#x5173;&#x4E8E;SortedSet&#x7684;&#x64CD;&#x4F5C;&#x6A21;&#x5F0F;&#x8FD9;&#x91CC;&#x7B80;&#x5355;&#x8BF4;&#x660E;&#x4E00;&#x4E0B;&#xFF0C;&#x5148;&#x6765;&#x770B;&#x4E00;&#x6761;&#x5B8C;&#x6574;&#x7684;zadd&#x547D;&#x4EE4;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;zadd key [NX|XX] [CH] [INCR] score member [score member ...]</span><br></pre></td></tr></table></figure>

<p>&#x5176;&#x4E2D;&#x7684;&#x53EF;&#x9009;&#x9879;&#x6211;&#x4EEC;&#x4F9D;&#x6B21;&#x770B;&#x4E0B;&#xFF1A;</p>
<ol>
<li>NX&#x8868;&#x793A;&#x5982;&#x679C;&#x5143;&#x7D20;&#x5B58;&#x5728;&#xFF0C;&#x5219;&#x4E0D;&#x6267;&#x884C;&#x66FF;&#x6362;&#x64CD;&#x4F5C;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x3002;</li>
<li>XX&#x8868;&#x793A;&#x53EA;&#x64CD;&#x4F5C;&#x5DF2;&#x5B58;&#x5728;&#x7684;&#x5143;&#x7D20;&#x3002;</li>
<li>CH&#x8868;&#x793A;&#x8FD4;&#x56DE;&#x4FEE;&#x6539;&#xFF08;&#x5305;&#x62EC;&#x6DFB;&#x52A0;&#xFF0C;&#x66F4;&#x65B0;&#xFF09;&#x5143;&#x7D20;&#x7684;&#x6570;&#x91CF;&#xFF0C;&#x53EA;&#x80FD;&#x88AB;ZADD&#x547D;&#x4EE4;&#x4F7F;&#x7528;&#x3002;</li>
<li>INCR&#x8868;&#x793A;&#x5728;&#x539F;&#x6765;&#x7684;score&#x57FA;&#x7840;&#x4E0A;&#x52A0;&#x4E0A;&#x65B0;&#x7684;score&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x66FF;&#x6362;&#x3002;</li>
</ol>
<p>&#x4E0A;&#x9762;&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#x4E2D;&#x7684;ZADD_NONE&#x8868;&#x793A;&#x666E;&#x901A;&#x64CD;&#x4F5C;&#x3002;</p>
<p>&#x63A5;&#x4E0B;&#x6765;&#x770B;&#x4E0B;zaddGenericCommand&#x51FD;&#x6570;&#x7684;&#x6E90;&#x7801;&#xFF0C;&#x5F88;&#x957F;&#xFF0C;&#x8010;&#x5FC3;&#x4E00;&#x70B9;&#x70B9;&#x770B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;void zaddGenericCommand(client *c, int flags) {</span><br><span class="line">    //&#x4E00;&#x6761;&#x9519;&#x8BEF;&#x63D0;&#x793A;&#x4FE1;&#x606F;</span><br><span class="line">    static char *nanerr = &quot;resulting score is not a number (NaN)&quot;;</span><br><span class="line">    //&#x6709;&#x5E8F;&#x96C6;&#x540D;&#x5B57;</span><br><span class="line">    robj *key = c-&gt;argv[1];</span><br><span class="line">    robj *zobj;</span><br><span class="line">    sds ele;</span><br><span class="line">    double score = 0, *scores = NULL;</span><br><span class="line">    int j, elements;</span><br><span class="line">    int scoreidx = 0;</span><br><span class="line">    //&#x8BB0;&#x5F55;&#x5143;&#x7D20;&#x64CD;&#x4F5C;&#x4E2A;&#x6570;</span><br><span class="line">    int added = 0;     </span><br><span class="line">    int updated = 0;    </span><br><span class="line">    int processed = 0;  </span><br><span class="line"></span><br><span class="line">    //&#x67E5;&#x627E;score&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x9ED8;&#x8BA4;score&#x5728;&#x4F4D;&#x7F6E;2&#x4E0A;&#xFF0C;&#x4F46;&#x7531;&#x4E8E;&#x6709;&#x5404;&#x79CD;&#x6A21;&#x5F0F;&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x5224;&#x65AD;</span><br><span class="line">    scoreidx = 2;</span><br><span class="line">    while(scoreidx &lt; c-&gt;argc) {</span><br><span class="line">        char *opt = c-&gt;argv[scoreidx]-&gt;ptr;</span><br><span class="line">        //&#x5224;&#x65AD;&#x547D;&#x4EE4;&#x4E2D;&#x662F;&#x5426;&#x8BBE;&#x7F6E;&#x4E86;&#x5404;&#x79CD;&#x6A21;&#x5F0F;</span><br><span class="line">        if (!strcasecmp(opt,&quot;nx&quot;)) flags |= ZADD_NX;</span><br><span class="line">        else if (!strcasecmp(opt,&quot;xx&quot;)) flags |= ZADD_XX;</span><br><span class="line">        else if (!strcasecmp(opt,&quot;ch&quot;)) flags |= ZADD_CH;</span><br><span class="line">        else if (!strcasecmp(opt,&quot;incr&quot;)) flags |= ZADD_INCR;</span><br><span class="line">        else break;</span><br><span class="line">        scoreidx++;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    //&#x8BBE;&#x7F6E;&#x6A21;&#x5F0F;</span><br><span class="line">    int incr = (flags &amp; ZADD_INCR) != 0;</span><br><span class="line">    int nx = (flags &amp; ZADD_NX) != 0;</span><br><span class="line">    int xx = (flags &amp; ZADD_XX) != 0;</span><br><span class="line">    int ch = (flags &amp; ZADD_CH) != 0;</span><br><span class="line"></span><br><span class="line">    //&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x89E3;&#x6790;&#xFF0C;scoreidx&#x4E3A;&#x771F;&#x5B9E;&#x7684;&#x521D;&#x59CB;score&#x7684;&#x7D22;&#x5F15;&#x4F4D;&#x7F6E;</span><br><span class="line">    //&#x8FD9;&#x91CC;&#x5BA2;&#x6237;&#x7AEF;&#x53C2;&#x6570;&#x6570;&#x91CF;&#x51CF;&#x53BB;scoreidx&#x5C31;&#x662F;&#x5269;&#x4F59;&#x6240;&#x6709;&#x5143;&#x7D20;&#x7684;&#x6570;&#x91CF;</span><br><span class="line">    elements = c-&gt;argc - scoreidx;</span><br><span class="line">    //&#x7531;&#x4E8E;&#x6709;&#x5E8F;&#x96C6;&#x4E2D;score&#xFF0C;member&#x6210;&#x5BF9;&#x51FA;&#x73B0;&#xFF0C;&#x6240;&#x4EE5;&#x52A0;&#x4E00;&#x5C42;&#x5224;&#x65AD;</span><br><span class="line">    if (elements % 2 || !elements) {</span><br><span class="line">        addReply(c,shared.syntaxerr);</span><br><span class="line">        return;</span><br><span class="line">    }</span><br><span class="line">    //&#x8FD9;&#x91CC;&#x8BA1;&#x7B97;score&#xFF0C;member&#x6709;&#x591A;&#x5C11;&#x5BF9;</span><br><span class="line">    elements /= 2; </span><br><span class="line"></span><br><span class="line">    //&#x53C2;&#x6570;&#x5408;&#x6CD5;&#x6027;&#x6821;&#x9A8C;</span><br><span class="line">    if (nx &amp;&amp; xx) {</span><br><span class="line">        addReplyError(c,</span><br><span class="line">            &quot;XX and NX options at the same time are not compatible&quot;);</span><br><span class="line">        return;</span><br><span class="line">    }</span><br><span class="line">    //&#x53C2;&#x6570;&#x5408;&#x6CD5;&#x6027;&#x6821;&#x9A8C;</span><br><span class="line">    if (incr &amp;&amp; elements &gt; 1) {</span><br><span class="line">        addReplyError(c,</span><br><span class="line">            &quot;INCR option supports a single increment-element pair&quot;);</span><br><span class="line">        return;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    //&#x8FD9;&#x91CC;&#x5F00;&#x59CB;&#x89E3;&#x6790;score&#xFF0C;&#x5148;&#x521D;&#x59CB;&#x5316;scores&#x6570;&#x7EC4;</span><br><span class="line">    scores = zmalloc(sizeof(double)*elements);</span><br><span class="line">    for (j = 0; j &lt; elements; j++) {</span><br><span class="line">        //&#x586B;&#x5145;&#x6570;&#x7EC4;&#xFF0C;&#x8FD9;&#x91CC;&#x6CE8;&#x610F;&#x5143;&#x7D20;&#x662F;&#x6210;&#x5BF9;&#x51FA;&#x73B0;&#xFF0C;&#x6240;&#x4EE5;&#x5404;&#x4E2A;score&#x4E4B;&#x95F4;&#x8981;&#x9694;&#x4E00;&#x4E2A;member</span><br><span class="line">        if (getDoubleFromObjectOrReply(c,c-&gt;argv[scoreidx+j*2],&amp;scores[j],NULL)</span><br><span class="line">            != C_OK) goto cleanup;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    //&#x8FD9;&#x91CC;&#x9996;&#x5148;&#x5728;client&#x5BF9;&#x5E94;&#x7684;db&#x4E2D;&#x67E5;&#x627E;&#x8BE5;key&#xFF0C;&#x5373;&#x6709;&#x5E8F;&#x96C6;</span><br><span class="line">    zobj = lookupKeyWrite(c-&gt;db,key);</span><br><span class="line">    if (zobj == NULL) {</span><br><span class="line">        //&#x6CA1;&#x6709;&#x6307;&#x5B9A;&#x6709;&#x5E8F;&#x96C6;&#x4E14;&#x6A21;&#x5F0F;&#x4E3A;XX&#xFF08;&#x53EA;&#x64CD;&#x4F5C;&#x5DF2;&#x5B58;&#x5728;&#x7684;&#x5143;&#x7D20;&#xFF09;&#xFF0C;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;</span><br><span class="line">        if (xx) goto reply_to_client; </span><br><span class="line">        //&#x6839;&#x636E;&#x5143;&#x7D20;&#x6570;&#x91CF;&#x9009;&#x62E9;&#x4E0D;&#x540C;&#x7684;&#x5B58;&#x50A8;&#x7ED3;&#x6784;&#x521D;&#x59CB;&#x5316;&#x6709;&#x5E8F;&#x96C6;</span><br><span class="line">        if (server.zset_max_ziplist_entries == 0 ||</span><br><span class="line">            server.zset_max_ziplist_value &lt; sdslen(c-&gt;argv[scoreidx+1]-&gt;ptr))</span><br><span class="line">        {</span><br><span class="line">            //&#x54C8;&#x5E0C;&#x8868; + &#x8DF3;&#x8868;&#x7684;&#x7EC4;&#x5408;&#x6A21;&#x5F0F;</span><br><span class="line">            zobj = createZsetObject();</span><br><span class="line">        } else {</span><br><span class="line">            //ziplist&#xFF08;&#x538B;&#x7F29;&#x94FE;&#x8868;&#xFF09;&#x6A21;&#x5F0F;</span><br><span class="line">            zobj = createZsetZiplistObject();</span><br><span class="line">        }</span><br><span class="line">        //&#x52A0;&#x5165;db&#x4E2D;</span><br><span class="line">        dbAdd(c-&gt;db,key,zobj);</span><br><span class="line">    } else {</span><br><span class="line">        //&#x5982;&#x679C;ZADD&#x64CD;&#x4F5C;&#x7684;&#x96C6;&#x5408;&#x7C7B;&#x578B;&#x4E0D;&#x5BF9;&#xFF0C;&#x5219;&#x8FD4;&#x56DE;</span><br><span class="line">        if (zobj-&gt;type != OBJ_ZSET) {</span><br><span class="line">            addReply(c,shared.wrongtypeerr);</span><br><span class="line">            goto cleanup;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    //&#x8FD9;&#x91CC;&#x5F00;&#x59CB;&#x5F80;&#x6709;&#x5E8F;&#x96C6;&#x4E2D;&#x6DFB;&#x52A0;&#x5143;&#x7D20;</span><br><span class="line">    for (j = 0; j &lt; elements; j++) {</span><br><span class="line">        double newscore;</span><br><span class="line">        //&#x53D6;&#x51FA;client&#x4F20;&#x8FC7;&#x6765;&#x7684;score</span><br><span class="line">        score = scores[j];</span><br><span class="line">        int retflags = flags;</span><br><span class="line">        //&#x53D6;&#x51FA;&#x4E0E;&#x4E4B;&#x5BF9;&#x5E94;&#x7684;member</span><br><span class="line">        ele = c-&gt;argv[scoreidx+1+j*2]-&gt;ptr;</span><br><span class="line">        //&#x5411;&#x6709;&#x5E8F;&#x96C6;&#x4E2D;&#x6DFB;&#x52A0;&#x5143;&#x7D20;&#xFF0C;&#x53C2;&#x6570;&#x4F9D;&#x6B21;&#x662F;&#x6709;&#x5E8F;&#x96C6;&#xFF0C;&#x8981;&#x6DFB;&#x52A0;&#x7684;&#x5143;&#x7D20;&#x7684;score&#xFF0C;&#x8981;&#x6DFB;&#x52A0;&#x7684;&#x5143;&#x7D20;&#xFF0C;&#x64CD;&#x4F5C;&#x6A21;&#x5F0F;&#xFF0C;&#x65B0;&#x7684;score</span><br><span class="line">        int retval = zsetAdd(zobj, score, ele, &amp;retflags, &amp;newscore);</span><br><span class="line">        //&#x6DFB;&#x52A0;&#x5931;&#x8D25;&#x5219;&#x8FD4;&#x56DE;</span><br><span class="line">        if (retval == 0) {</span><br><span class="line">            addReplyError(c,nanerr);</span><br><span class="line">            goto cleanup;</span><br><span class="line">        }</span><br><span class="line">        //&#x8BB0;&#x5F55;&#x64CD;&#x4F5C;</span><br><span class="line">        if (retflags &amp; ZADD_ADDED) added++;</span><br><span class="line">        if (retflags &amp; ZADD_UPDATED) updated++;</span><br><span class="line">        if (!(retflags &amp; ZADD_NOP)) processed++;</span><br><span class="line">        //&#x8BBE;&#x7F6E;&#x65B0;score&#x503C;</span><br><span class="line">        score = newscore;</span><br><span class="line">    }</span><br><span class="line">    //&#x64CD;&#x4F5C;&#x8BB0;&#x5F55;</span><br><span class="line">    server.dirty += (added+updated);</span><br><span class="line"></span><br><span class="line">//&#x8FD4;&#x56DE;&#x903B;&#x8F91;</span><br><span class="line">reply_to_client:</span><br><span class="line">    if (incr) {</span><br><span class="line">        if (processed)</span><br><span class="line">            addReplyDouble(c,score);</span><br><span class="line">        else</span><br><span class="line">            addReply(c,shared.nullbulk);</span><br><span class="line">    } else {</span><br><span class="line">        addReplyLongLong(c,ch ? added+updated : added);</span><br><span class="line">    }</span><br><span class="line">//&#x6E05;&#x7406;&#x903B;&#x8F91;</span><br><span class="line">cleanup:</span><br><span class="line">    zfree(scores);</span><br><span class="line">    if (added || updated) {</span><br><span class="line">        signalModifiedKey(c-&gt;db,key);</span><br><span class="line">        notifyKeyspaceEvent(NOTIFY_ZSET,</span><br><span class="line">            incr ? &quot;zincr&quot; : &quot;zadd&quot;, key, c-&gt;db-&gt;id);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4EE3;&#x7801;&#x6709;&#x70B9;&#x957F;&#xFF0C;&#x6765;&#x5F20;&#x56FE;&#x770B;&#x4E00;&#x4E0B;&#x5B58;&#x50A8;&#x7ED3;&#x6784;&#xFF1A;  </p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/e47d0cc3bc38617571beb1cfc1b09f9dde482b68120a9250d8a87f310c00c046" alt="&#x6709;&#x5E8F;&#x96C6;&#x5B58;&#x50A8;&#x7ED3;&#x6784;"></p>
<p>&#x6709;&#x5E8F;&#x96C6;&#x5B58;&#x50A8;&#x7ED3;&#x6784;</p>
<p><strong>&#x6CE8;&#xFF1A;&#x6BCF;&#x4E2A;entry&#x90FD;&#x662F;&#x7531;score+member&#x7EC4;&#x6210;</strong><br>&#x6709;&#x4E86;&#x4E0A;&#x9762;&#x7684;&#x7ED3;&#x6784;&#x56FE;&#x4EE5;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x60F3;&#x5230;&#x5220;&#x9664;&#x64CD;&#x4F5C;&#x5E94;&#x8BE5;&#x5C31;&#x662F;&#x6839;&#x636E;&#x4E0D;&#x540C;&#x7684;&#x5B58;&#x50A8;&#x7ED3;&#x6784;&#x8FDB;&#x884C;&#xFF0C;&#x5982;&#x679C;&#x662F;ziplist&#x5C31;&#x6267;&#x884C;&#x94FE;&#x8868;&#x5220;&#x9664;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x54C8;&#x5E0C;&#x8868;+&#x8DF3;&#x8868;&#x7ED3;&#x6784;&#xFF0C;&#x90A3;&#x5C31;&#x8981;&#x628A;&#x4E24;&#x4E2A;&#x96C6;&#x5408;&#x90FD;&#x8FDB;&#x884C;&#x5220;&#x9664;&#x3002;&#x771F;&#x5B9E;&#x903B;&#x8F91;&#x662F;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;<br>&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E0B;&#x5220;&#x9664;&#x51FD;&#x6570;zremCommand&#x7684;&#x6E90;&#x7801;&#xFF0C;&#x76F8;&#x5BF9;&#x77ED;&#x4E00;&#x70B9;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;void zremCommand(client *c) {</span><br><span class="line">    //&#x83B7;&#x53D6;&#x6709;&#x5E8F;&#x96C6;&#x540D;</span><br><span class="line">    robj *key = c-&gt;argv[1];</span><br><span class="line">    robj *zobj;</span><br><span class="line">    int deleted = 0, keyremoved = 0, j;</span><br><span class="line">    //&#x505A;&#x6821;&#x9A8C;</span><br><span class="line">    if ((zobj = lookupKeyWriteOrReply(c,key,shared.czero)) == NULL ||</span><br><span class="line">        checkType(c,zobj,OBJ_ZSET)) return;</span><br><span class="line"></span><br><span class="line">    for (j = 2; j &lt; c-&gt;argc; j++) {</span><br><span class="line">        //&#x4E00;&#x6B21;&#x5220;&#x9664;&#x6307;&#x5B9A;&#x5143;&#x7D20;</span><br><span class="line">        if (zsetDel(zobj,c-&gt;argv[j]-&gt;ptr)) deleted++;</span><br><span class="line">        //&#x5982;&#x679C;&#x6709;&#x5E8F;&#x96C6;&#x4E2D;&#x5168;&#x90E8;&#x5143;&#x7D20;&#x90FD;&#x88AB;&#x5220;&#x9664;&#xFF0C;&#x5219;&#x56DE;&#x6536;&#x6709;&#x5E8F;&#x8868;</span><br><span class="line">        if (zsetLength(zobj) == 0) {</span><br><span class="line">            dbDelete(c-&gt;db,key);</span><br><span class="line">            keyremoved = 1;</span><br><span class="line">            break;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    //&#x540C;&#x6B65;&#x64CD;&#x4F5C;</span><br><span class="line">    if (deleted) {</span><br><span class="line">        notifyKeyspaceEvent(NOTIFY_ZSET,&quot;zrem&quot;,key,c-&gt;db-&gt;id);</span><br><span class="line">        if (keyremoved)</span><br><span class="line">            notifyKeyspaceEvent(NOTIFY_GENERIC,&quot;del&quot;,key,c-&gt;db-&gt;id);</span><br><span class="line">        signalModifiedKey(c-&gt;db,key);</span><br><span class="line">        server.dirty += deleted;</span><br><span class="line">    }</span><br><span class="line">    //&#x8FD4;&#x56DE;</span><br><span class="line">    addReplyLongLong(c,deleted);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x770B;&#x4E0B;&#x5177;&#x4F53;&#x7684;&#x5220;&#x9664;&#x64CD;&#x4F5C;&#x6E90;&#x7801;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;//&#x53C2;&#x6570;zobj&#x4E3A;&#x6709;&#x5E8F;&#x96C6;&#xFF0C;ele&#x4E3A;&#x8981;&#x5220;&#x9664;&#x7684;&#x5143;&#x7D20;</span><br><span class="line">int zsetDel(robj *zobj, sds ele) {</span><br><span class="line">    //&#x4E0E;&#x6DFB;&#x52A0;&#x5143;&#x7D20;&#x76F8;&#x540C;&#xFF0C;&#x6839;&#x636E;&#x4E0D;&#x540C;&#x7684;&#x5B58;&#x50A8;&#x7ED3;&#x6784;&#x6267;&#x884C;&#x4E0D;&#x540C;&#x7684;&#x5220;&#x9664;&#x903B;&#x8F91;</span><br><span class="line">    if (zobj-&gt;encoding == OBJ_ENCODING_ZIPLIST) {</span><br><span class="line">        unsigned char *eptr;</span><br><span class="line">        //ziplist&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x94FE;&#x8868;&#x5220;&#x9664;&#x8282;&#x70B9;&#x64CD;&#x4F5C;</span><br><span class="line">        if ((eptr = zzlFind(zobj-&gt;ptr,ele,NULL)) != NULL) {</span><br><span class="line">            zobj-&gt;ptr = zzlDelete(zobj-&gt;ptr,eptr);</span><br><span class="line">            return 1;</span><br><span class="line">        }</span><br><span class="line">    } else if (zobj-&gt;encoding == OBJ_ENCODING_SKIPLIST) {</span><br><span class="line">        zset *zs = zobj-&gt;ptr;</span><br><span class="line">        dictEntry *de;</span><br><span class="line">        double score;</span><br><span class="line"></span><br><span class="line">        de = dictUnlink(zs-&gt;dict,ele);</span><br><span class="line">        if (de != NULL) {</span><br><span class="line">            //&#x67E5;&#x8BE2;&#x8BE5;&#x5143;&#x7D20;&#x7684;score</span><br><span class="line">            score = *(double*)dictGetVal(de);</span><br><span class="line">            //&#x4ECE;&#x54C8;&#x5E0C;&#x8868;&#x4E2D;&#x5220;&#x9664;&#x5143;&#x7D20;</span><br><span class="line">            dictFreeUnlinkedEntry(zs-&gt;dict,de);</span><br><span class="line"></span><br><span class="line">            //&#x4ECE;&#x8DF3;&#x8868;&#x4E2D;&#x5220;&#x9664;&#x5143;&#x7D20;</span><br><span class="line">            int retval = zslDelete(zs-&gt;zsl,score,ele,NULL);</span><br><span class="line">            serverAssert(retval);</span><br><span class="line">            //&#x5982;&#x679C;&#x6709;&#x9700;&#x8981;&#x5219;&#x5BF9;&#x54C8;&#x5E0C;&#x8868;&#x8FDB;&#x884C;resize&#x64CD;&#x4F5C;</span><br><span class="line">            if (htNeedsResize(zs-&gt;dict)) dictResize(zs-&gt;dict);</span><br><span class="line">            return 1;</span><br><span class="line">        }</span><br><span class="line">    } else {</span><br><span class="line">        serverPanic(&quot;Unknown sorted set encoding&quot;);</span><br><span class="line">    }</span><br><span class="line">    //&#x6CA1;&#x6709;&#x627E;&#x5230;&#x6307;&#x5B9A;&#x5143;&#x7D20;&#x8FD4;&#x56DE;0</span><br><span class="line">    return 0;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x6700;&#x540E;&#x770B;&#x4E00;&#x4E2A;&#x67E5;&#x8BE2;&#x51FD;&#x6570;zrangeCommand&#x6E90;&#x7801;&#xFF0C;&#x4E5F;&#x662F;&#x5F88;&#x957F;&#xFF0C;&#x6C57;<del>~</del>&#xFF0C;&#x4E0D;&#x8FC7;&#x653E;&#x5FC3;&#xFF0C;&#x6709;&#x4E86;&#x4E0A;&#x9762;&#x7684;&#x57FA;&#x7840;&#xFF0C;&#x5927;&#x81F4;&#x4E5F;&#x80FD;&#x731C;&#x5230;&#x67E5;&#x8BE2;&#x903B;&#x8F91;&#x5E94;&#x8BE5;&#x662F;&#x4EC0;&#x4E48;&#x6837;&#x5B50;&#x7684;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;void zrangeCommand(client *c) {</span><br><span class="line">    //&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;0&#x8868;&#x793A;&#x987A;&#x5E8F;&#xFF0C;1&#x8868;&#x793A;&#x5012;&#x5E8F;</span><br><span class="line">    zrangeGenericCommand(c,0);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">void zrangeGenericCommand(client *c, int reverse) {</span><br><span class="line">    //&#x6709;&#x5E8F;&#x96C6;&#x540D;</span><br><span class="line">    robj *key = c-&gt;argv[1];</span><br><span class="line">    robj *zobj;</span><br><span class="line">    int withscores = 0;</span><br><span class="line">    long start;</span><br><span class="line">    long end;</span><br><span class="line">    int llen;</span><br><span class="line">    int rangelen;</span><br><span class="line">    //&#x53C2;&#x6570;&#x6821;&#x9A8C;</span><br><span class="line">    if ((getLongFromObjectOrReply(c, c-&gt;argv[2], &amp;start, NULL) != C_OK) ||</span><br><span class="line">        (getLongFromObjectOrReply(c, c-&gt;argv[3], &amp;end, NULL) != C_OK)) return;</span><br><span class="line"></span><br><span class="line">    //&#x6839;&#x636E;&#x53C2;&#x6570;&#x9644;&#x52A0;&#x4FE1;&#x606F;&#x5224;&#x65AD;&#x662F;&#x5426;&#x9700;&#x8981;&#x8FD4;&#x56DE;score</span><br><span class="line">    if (c-&gt;argc == 5 &amp;&amp; !strcasecmp(c-&gt;argv[4]-&gt;ptr,&quot;withscores&quot;)) {</span><br><span class="line">        withscores = 1;</span><br><span class="line">    } else if (c-&gt;argc &gt;= 5) {</span><br><span class="line">        addReply(c,shared.syntaxerr);</span><br><span class="line">        return;</span><br><span class="line">    }</span><br><span class="line">    //&#x6709;&#x5E8F;&#x96C6;&#x6821;&#x9A8C;</span><br><span class="line">    if ((zobj = lookupKeyReadOrReply(c,key,shared.emptymultibulk)) == NULL</span><br><span class="line">         || checkType(c,zobj,OBJ_ZSET)) return;</span><br><span class="line"></span><br><span class="line">    //&#x7D22;&#x5F15;&#x503C;&#x91CD;&#x7F6E;</span><br><span class="line">    llen = zsetLength(zobj);</span><br><span class="line">    if (start &lt; 0) start = llen+start;</span><br><span class="line">    if (end &lt; 0) end = llen+end;</span><br><span class="line">    if (start &lt; 0) start = 0;</span><br><span class="line">     //&#x8FD4;&#x56DE;&#x7A7A;&#x96C6;</span><br><span class="line">    if (start &gt; end || start &gt;= llen) {</span><br><span class="line">        addReply(c,shared.emptymultibulk);</span><br><span class="line">        return;</span><br><span class="line">    }</span><br><span class="line">    if (end &gt;= llen) end = llen-1;</span><br><span class="line">    rangelen = (end-start)+1;</span><br><span class="line"></span><br><span class="line">    //&#x8FD4;&#x56DE;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;&#x7ED3;&#x679C;&#x957F;&#x5EA6;</span><br><span class="line">    addReplyMultiBulkLen(c, withscores ? (rangelen*2) : rangelen);</span><br><span class="line">    //&#x540C;&#x6837;&#x662F;&#x6839;&#x636E;&#x6709;&#x5E8F;&#x96C6;&#x7684;&#x4E0D;&#x540C;&#x7ED3;&#x6784;&#x6267;&#x884C;&#x4E0D;&#x540C;&#x7684;&#x67E5;&#x8BE2;&#x903B;&#x8F91;</span><br><span class="line">    if (zobj-&gt;encoding == OBJ_ENCODING_ZIPLIST) {</span><br><span class="line">        unsigned char *zl = zobj-&gt;ptr;</span><br><span class="line">        unsigned char *eptr, *sptr;</span><br><span class="line">        unsigned char *vstr;</span><br><span class="line">        unsigned int vlen;</span><br><span class="line">        long long vlong;</span><br><span class="line">        //&#x6839;&#x636E;&#x6B63;&#x5E8F;&#x8FD8;&#x662F;&#x5012;&#x5E8F;&#x8BA1;&#x7B97;&#x8D77;&#x59CB;&#x7D22;&#x5F15;</span><br><span class="line">        if (reverse)</span><br><span class="line">            eptr = ziplistIndex(zl,-2-(2*start));</span><br><span class="line">        else</span><br><span class="line">            eptr = ziplistIndex(zl,2*start);</span><br><span class="line"></span><br><span class="line">        serverAssertWithInfo(c,zobj,eptr != NULL);</span><br><span class="line">        sptr = ziplistNext(zl,eptr);</span><br><span class="line"></span><br><span class="line">        while (rangelen--) {</span><br><span class="line">            serverAssertWithInfo(c,zobj,eptr != NULL &amp;&amp; sptr != NULL);</span><br><span class="line">            //&#x6CE8;&#x610F;&#x5D4C;&#x5957;&#x7684;ziplistGet&#x65B9;&#x6CD5;&#x5C31;&#x662F;&#x628A;eptr&#x7D22;&#x5F15;&#x7684;&#x503C;&#x8BFB;&#x51FA;&#x6765;&#x4FDD;&#x5B58;&#x5728;&#x540E;&#x9762;&#x4E09;&#x4E2A;&#x53C2;&#x6570;&#x4E2D;</span><br><span class="line">            serverAssertWithInfo(c,zobj,ziplistGet(eptr,&amp;vstr,&amp;vlen,&amp;vlong));</span><br><span class="line">            //&#x8FD4;&#x56DE;value</span><br><span class="line">            if (vstr == NULL)</span><br><span class="line">                addReplyBulkLongLong(c,vlong);</span><br><span class="line">            else</span><br><span class="line">                addReplyBulkCBuffer(c,vstr,vlen);</span><br><span class="line">            //&#x5982;&#x679C;&#x9700;&#x8981;&#x5219;&#x8FD4;&#x56DE;score</span><br><span class="line">            if (withscores)</span><br><span class="line">                addReplyDouble(c,zzlGetScore(sptr));</span><br><span class="line">            //&#x5012;&#x5E8F;&#x4ECE;&#x540E;&#x5F80;&#x524D;&#xFF0C;&#x6B63;&#x5E8F;&#x4ECE;&#x524D;&#x5F80;&#x540E;</span><br><span class="line">            if (reverse)</span><br><span class="line">                zzlPrev(zl,&amp;eptr,&amp;sptr);</span><br><span class="line">            else</span><br><span class="line">                zzlNext(zl,&amp;eptr,&amp;sptr);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    } else if (zobj-&gt;encoding == OBJ_ENCODING_SKIPLIST) {</span><br><span class="line">        zset *zs = zobj-&gt;ptr;</span><br><span class="line">        zskiplist *zsl = zs-&gt;zsl;</span><br><span class="line">        zskiplistNode *ln;</span><br><span class="line">        sds ele;</span><br><span class="line"></span><br><span class="line">        //&#x627E;&#x5230;&#x8D77;&#x59CB;&#x8282;&#x70B9;</span><br><span class="line">        if (reverse) {</span><br><span class="line">            ln = zsl-&gt;tail;</span><br><span class="line">            if (start &gt; 0)</span><br><span class="line">                ln = zslGetElementByRank(zsl,llen-start);</span><br><span class="line">        } else {</span><br><span class="line">            ln = zsl-&gt;header-&gt;level[0].forward;</span><br><span class="line">            if (start &gt; 0)</span><br><span class="line">                ln = zslGetElementByRank(zsl,start+1);</span><br><span class="line">        }</span><br><span class="line">         //&#x904D;&#x5386;&#x5E76;&#x8FD4;&#x56DE;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;</span><br><span class="line">        while(rangelen--) {</span><br><span class="line">            serverAssertWithInfo(c,zobj,ln != NULL);</span><br><span class="line">            ele = ln-&gt;ele;</span><br><span class="line">            addReplyBulkCBuffer(c,ele,sdslen(ele));</span><br><span class="line">            if (withscores)</span><br><span class="line">                addReplyDouble(c,ln-&gt;score);</span><br><span class="line">            ln = reverse ? ln-&gt;backward : ln-&gt;level[0].forward;</span><br><span class="line">        }</span><br><span class="line">    } else {</span><br><span class="line">        serverPanic(&quot;Unknown sorted set encoding&quot;);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4E0A;&#x9762;&#x5C31;&#x662F;&#x5173;&#x4E8E;&#x6709;&#x5E8F;&#x96C6;SortedSet&#x7684;&#x6DFB;&#x52A0;&#xFF0C;&#x5220;&#x9664;&#xFF0C;&#x67E5;&#x627E;&#x7684;&#x6E90;&#x7801;&#x3002;&#x53EF;&#x4EE5;&#x770B;&#x51FA;SortedSet&#x4F1A;&#x6839;&#x636E;&#x5B58;&#x653E;&#x5143;&#x7D20;&#x7684;&#x6570;&#x91CF;&#x9009;&#x62E9;ziplist&#x6216;&#x8005;&#x54C8;&#x5E0C;&#x8868;+&#x8DF3;&#x8868;&#x4E24;&#x79CD;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x8FDB;&#x884C;&#x5B9E;&#x73B0;&#xFF0C;&#x4E4B;&#x6240;&#x4EE5;&#x6E90;&#x7801;&#x770B;&#x4E0A;&#x53BB;&#x5F88;&#x957F;&#xFF0C;&#x4E3B;&#x8981;&#x539F;&#x56E0;&#x4E5F;&#x5C31;&#x662F;&#x8981;&#x6839;&#x636E;&#x4E0D;&#x540C;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x8FDB;&#x884C;&#x4E0D;&#x540C;&#x7684;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;&#x3002;&#x53EA;&#x8981;&#x638C;&#x63E1;&#x4E86;&#x8FD9;&#x4E2A;&#x6838;&#x5FC3;&#x601D;&#x8DEF;&#xFF0C;&#x518D;&#x770B;&#x6E90;&#x7801;&#x5C31;&#x4E0D;&#x4F1A;&#x592A;&#x96BE;&#x3002;</p>
<h3 id="&#x4E09;&#x3001;&#x6709;&#x5E8F;&#x96C6;SortedSet&#x547D;&#x4EE4;&#x603B;&#x7ED3;"><a href="#&#x4E09;&#x3001;&#x6709;&#x5E8F;&#x96C6;SortedSet&#x547D;&#x4EE4;&#x603B;&#x7ED3;" class="headerlink" title="&#x4E09;&#x3001;&#x6709;&#x5E8F;&#x96C6;SortedSet&#x547D;&#x4EE4;&#x603B;&#x7ED3;"></a>&#x4E09;&#x3001;&#x6709;&#x5E8F;&#x96C6;SortedSet&#x547D;&#x4EE4;&#x603B;&#x7ED3;</h3><p>&#x6709;&#x5E8F;&#x96C6;&#x7684;&#x903B;&#x8F91;&#x4E0D;&#x96BE;&#xFF0C;&#x5C31;&#x662F;&#x4EE3;&#x7801;&#x6709;&#x70B9;&#x957F;&#xFF0C;&#x6D89;&#x53CA;&#x5230;ziplist&#xFF0C;skiplist&#xFF0C;dict&#x4E09;&#x5957;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF0C;&#x5176;&#x4E2D;&#x9664;&#x4E86;&#x5E38;&#x89C4;&#x7684;dict&#x4E4B;&#x5916;&#xFF0C;&#x53E6;&#x5916;&#x4E24;&#x4E2A;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x5185;&#x5BB9;&#x90FD;&#x4E0D;&#x5C11;&#xFF0C;&#x51C6;&#x5907;&#x4E13;&#x95E8;&#x5199;&#x6587;&#x7AE0;&#x8FDB;&#x884C;&#x603B;&#x7ED3;&#xFF0C;&#x5C31;&#x4E0D;&#x5728;&#x8FD9;&#x91CC;&#x8D58;&#x8FF0;&#x4E86;&#x3002;&#x672C;&#x6587;&#x4E3B;&#x8981;&#x76EE;&#x7684;&#x662F;&#x603B;&#x7ED3;&#x4E00;&#x4E0B;&#x6709;&#x5E8F;&#x96C6;SortedSet&#x7684;&#x5B9E;&#x73B0;&#x539F;&#x7406;&#x3002;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/9dd82fedd54b6388013c9c6f3107429a.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903512455774216.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903512455774216.html" itemprop="url">Unix Web服务</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-20T11:58:50+08:00">
                2017-11-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h3><p>Web&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x5668;&#x7684;&#x4EA4;&#x4E92;&#x7528;&#x7684;&#x662F;&#x4E00;&#x4E2A;&#x57FA;&#x4E8E;&#x6587;&#x672C;&#x7684;&#x5E94;&#x7528;&#x7EA7;&#x534F;&#x8BAE; &#x2014;&#x2014; HTTP(Hypertext Transfer Protocol)&#x3002;&#x5BA2;&#x6237;&#x7AEF;&#x4E0E;&#x670D;&#x52A1;&#x5668;&#x7684;&#x4E00;&#x4E2A;&#x5178;&#x578B;&#x4EA4;&#x4E92;&#x8FC7;&#x7A0B;&#x4E3A;&#xFF1A;&#x4E00;&#x4E2A;Web&#x5BA2;&#x6237;&#x7AEF;(&#x5373;&#x6D4F;&#x89C8;&#x5668;)&#x6253;&#x5F00;&#x4E00;&#x4E2A;&#x5230;&#x670D;&#x52A1;&#x5668;&#x7684;&#x56E0;&#x7279;&#x7F51;&#x8FDE;&#x63A5;&#xFF0C;&#x5E76;&#x4E14;&#x8BF7;&#x6C42;&#x67D0;&#x4E9B;&#x5185;&#x5BB9;&#xFF1B;&#x670D;&#x52A1;&#x5668;&#x54CD;&#x5E94;&#x6240;&#x8BF7;&#x6C42;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x7136;&#x540E;&#x5173;&#x95ED;&#x8FDE;&#x63A5;&#xFF1B;&#x6D4F;&#x89C8;&#x5668;&#x8BFB;&#x53D6;&#x8FD9;&#x4E9B;&#x5185;&#x5BB9;&#xFF0C;&#x5E76;&#x628A;&#x5B83;&#x663E;&#x793A;&#x5728;&#x5C4F;&#x5E55;&#x4E0A;&#x3002;</p>
<p>Web&#x4E0E;&#x5E38;&#x89C4;&#x7684;&#x6587;&#x4EF6;&#x68C0;&#x7D22;&#x670D;&#x52A1;(&#x5982;FTP)&#x7684;&#x4E3B;&#x8981;&#x533A;&#x522B;&#x662F;: Web&#x5185;&#x5BB9;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;HTML(Hypertext Markup Language)&#x6765;&#x7F16;&#x5199;&#xFF0C;&#x63D0;&#x4F9B;&#x683C;&#x5F0F;&#x548C;&#x5E03;&#x5C40;&#x7684;&#x63A7;&#x5236;&#xFF0C;&#x5E76;&#x4E14;&#x5305;&#x542B;&#x8D85;&#x94FE;&#x63A5;&#x3002;</p>
<h3 id="Web&#x5185;&#x5BB9;"><a href="#Web&#x5185;&#x5BB9;" class="headerlink" title="Web&#x5185;&#x5BB9;"></a>Web&#x5185;&#x5BB9;</h3><p>&#x5BF9;&#x4E8E;Web&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x5668;&#x800C;&#x8A00;&#xFF0C;&#x5185;&#x5BB9;&#x662F;&#x4E0E;&#x4E00;&#x4E2A;MIME(Multipurpose Internet Mail Extensions)&#x7C7B;&#x578B;&#x76F8;&#x5173;&#x7684;&#x5B57;&#x8282;&#x5E8F;&#x5217;&#x3002;</p>
<p>Web&#x670D;&#x52A1;&#x5668;&#x4EE5;&#x4E24;&#x79CD;&#x4E0D;&#x540C;&#x7684;&#x65B9;&#x5F0F;&#x5411;&#x5BA2;&#x6237;&#x7AEF;&#x63D0;&#x4F9B;&#x5185;&#x5BB9;:</p>
<ol>
<li>&#x53D6;&#x4E00;&#x4E2A;&#x78C1;&#x76D8;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x5C06;&#x5B83;&#x7684;&#x5185;&#x5BB9;&#x8FD4;&#x56DE;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;&#x3002;</li>
<li>&#x8FD0;&#x884C;&#x4E00;&#x4E2A;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x5C06;&#x5B83;&#x7684;&#x8F93;&#x51FA;&#x8FD4;&#x56DE;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;&#x3002;</li>
</ol>
<p>&#x6BCF;&#x6761;&#x7531;Web&#x670D;&#x52A1;&#x5668;&#x8FD4;&#x56DE;&#x7684;&#x5185;&#x5BB9;&#x90FD;&#x662F;&#x548C;&#x5B83;&#x7BA1;&#x7406;&#x7684;&#x7684;&#x67D0;&#x4E2A;&#x6587;&#x4EF6;&#x76F8;&#x5173;&#x8054;&#x7684;&#x3002;&#x8FD9;&#x4E9B;&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;&#x90FD;&#x6709;&#x552F;&#x4E00;&#x7684;&#x540D;&#x5B57;&#xFF0C;&#x53EB;&#x505A;URL(Universal Resource Locator)&#x3002;&#x4F8B;&#x5982;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;http://www.google.com:80/index.html</span><br></pre></td></tr></table></figure>

<p>&#x6807;&#x8BC6;&#x56E0;&#x7279;&#x7F51;&#x4E3B;&#x673A;<a href="/external_links/217ea0eddb56326ed6f492a502629060.html" target="blank" rel="noopener">www.google.com&#x4E0A;&#x4E00;&#x4E2A;&#x79F0;&#x4E3A;/index.html&#x7684;HTML&#x6587;&#x4EF6;&#xFF0C;&#x5B83;&#x662F;&#x7531;&#x4E00;&#x4E2A;&#x76D1;&#x542C;&#x7AEF;&#x53E3;80&#x7684;Web&#x670D;&#x52A1;&#x5668;&#x7BA1;&#x7406;&#x7684;&#x3002;</a></p>
<p>&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x7684;URL&#x53EF;&#x4EE5;&#x5728;&#x6587;&#x4EF6;&#x540D;&#x540E;&#x5305;&#x62EC;&#x7A0B;&#x5E8F;&#x53C2;&#x6570;&#x3002;<code>?</code>&#x5206;&#x9694;&#x6587;&#x4EF6;&#x540D;&#x548C;&#x53C2;&#x6570;&#xFF0C;&#x800C;&#x4E14;&#x6BCF;&#x4E2A;&#x53C2;&#x6570;&#x90FD;&#x7528;<code>&amp;</code>&#x5206;&#x9694;&#x5F00;&#x3002;&#x4F8B;&#x5982;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;http://example.com:80/cig-bin/adder?123&amp;345</span><br></pre></td></tr></table></figure>

<p>&#x6807;&#x8BC6;&#x4E86;&#x4E00;&#x4E2A;&#x53EB;&#x505A;/cig-bin/adder&#x7684;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#xFF0C;&#x4F1A;&#x5E26;&#x4E24;&#x4E2A;&#x53C2;&#x6570;123&#x548C;345&#x6765;&#x8C03;&#x7528;&#x5B83;&#x3002;&#x5728;&#x4E8B;&#x52A1;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x5668;&#x4F7F;&#x7528;&#x7684;URL&#x7684;&#x4E0D;&#x540C;&#x90E8;&#x5206;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x4F7F;&#x7528;&#x524D;&#x7F00;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;http://www.google.com:80</span><br></pre></td></tr></table></figure>

<p>&#x6765;&#x51B3;&#x5B9A;&#x4E0E;&#x54EA;&#x7C7B;&#x670D;&#x52A1;&#x5668;&#x8054;&#x7CFB;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x5728;&#x54EA;&#xFF0C;&#x4EE5;&#x53CA;&#x5B83;&#x76D1;&#x542C;&#x7684;&#x7AEF;&#x53E3;&#x53F7;&#x662F;&#x591A;&#x5C11;&#x3002;&#x670D;&#x52A1;&#x5668;&#x4F7F;&#x7528;&#x540E;&#x7F00;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;/index.html</span><br></pre></td></tr></table></figure>

<p>&#x6765;&#x53D1;&#x73B0;&#x5728;&#x5B83;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x4E2D;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x786E;&#x5B9A;&#x8BF7;&#x6C42;&#x7684;&#x662F;&#x52A8;&#x6001;&#x5185;&#x5BB9;&#x8FD8;&#x662F;&#x9759;&#x6001;&#x5185;&#x5BB9;&#x3002;</p>
<h3 id="HTTP&#x4E8B;&#x52A1;"><a href="#HTTP&#x4E8B;&#x52A1;" class="headerlink" title="HTTP&#x4E8B;&#x52A1;"></a>HTTP&#x4E8B;&#x52A1;</h3><p>HTTP&#x4E8B;&#x52A1;&#x662F;&#x6307;&#x7531;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x8D77;HTTP&#x8BF7;&#x6C42;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x8FD4;&#x56DE;HTTP&#x54CD;&#x5E94;&#xFF0C;&#x7136;&#x540E;&#x5173;&#x95ED;&#x8FDE;&#x63A5;&#x3002;</p>
<h4 id="1-HTTP&#x8BF7;&#x6C42;"><a href="#1-HTTP&#x8BF7;&#x6C42;" class="headerlink" title="1.HTTP&#x8BF7;&#x6C42;"></a>1.HTTP&#x8BF7;&#x6C42;</h4><p>HTTP&#x8BF7;&#x6C42;&#x7684;&#x7EC4;&#x6210;:</p>
<ol>
<li>&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x884C;(request line)</li>
<li>(&#x7D27;&#x8DDF;&#x7740;)&#x96F6;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x8BF7;&#x6C42;&#x62A5;&#x5934;(request header)</li>
<li>(&#x6700;&#x540E;&#x4EE5;)&#x4E00;&#x4E2A;&#x7A7A;&#x7684;&#x6587;&#x672C;&#x884C;&#x6765;&#x7EC8;&#x6B62;&#x62A5;&#x5934;&#x5217;&#x8868;</li>
<li>(POST&#x65B9;&#x6CD5;&#x53EF;&#x80FD;&#x4F1A;&#x5728;&#x8FD9;&#x589E;&#x52A0;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x4E3B;&#x4F53;)</li>
</ol>
<p>&#x6BCF;&#x4E2A;&#x6587;&#x672C;&#x884C;&#x90FD;&#x7531;&#x4E00;&#x5BF9;&#x56DE;&#x8F66;&#x548C;&#x6362;&#x884C;&#x7B26;&#x7ED3;&#x675F;<code>\r\n</code></p>
<p>&#x8BF7;&#x6C42;&#x884C;&#x7684;&#x5F62;&#x5F0F;&#x662F;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;method&gt; &lt;uri&gt; &lt;version&gt;</span><br></pre></td></tr></table></figure>

<p><code>&lt;method&gt;</code>&#x662F;HTTP&#x652F;&#x6301;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5305;&#x62EC;GET&#x3001;POST&#x3001;OPTIONS&#x3001;HEAD&#x3001;PUT&#x3001;DELETE&#x548C;TRACE&#x3002;&#x5E94;&#x7528;&#x6700;&#x591A;&#x7684;GET&#x65B9;&#x6CD5;&#x6307;&#x5BFC;&#x670D;&#x52A1;&#x5668;&#x751F;&#x6210;&#x548C;&#x8FD4;&#x56DE;<code>&lt;URI&gt;</code>(Uniform Resource Identifier)&#x6807;&#x8BC6;&#x7684;&#x5185;&#x5BB9;&#x3002;POST&#x65B9;&#x6CD5;&#x7ECF;&#x5E38;&#x7528;&#x4E8E;&#x63D0;&#x4EA4;&#x8868;&#x5355;&#x3002;HEAD&#x65B9;&#x6CD5;&#x7C7B;&#x4F3C;&#x4E0E;GET&#x65B9;&#x6CD5;&#xFF0C;&#x5F53;&#x670D;&#x52A1;&#x5668;&#x63A5;&#x53D7;&#x5230;HEAD&#x65B9;&#x6CD5;&#x7684;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x5C06;&#x4F1A;&#x7528;&#x4E00;&#x4E2A;HTTP&#x62A5;&#x6587;&#x8FDB;&#x884C;&#x54CD;&#x5E94;&#xFF0C;&#x4F46;&#x662F;&#x5E76;&#x4E0D;&#x8FD4;&#x56DE;&#x8BF7;&#x6C42;&#x4E3B;&#x4F53;&#x3002;PUT&#x65B9;&#x6CD5;&#x5E38;&#x4E0E;Web&#x53D1;&#x884C;&#x5DE5;&#x5177;&#x8054;&#x5408;&#x4F7F;&#x7528;&#xFF0C;&#x7528;&#x6237;&#x4F7F;&#x7528;&#x5B83;&#x4E0A;&#x4F20;&#x5BF9;&#x8C61;&#x5230;&#x6307;&#x5B9A;&#x7684;Web&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x7684;&#x6307;&#x5B9A;&#x8DEF;&#x5F84;&#x3002;DELETE&#x65B9;&#x6CD5;&#x5141;&#x8BB8;&#x7528;&#x6237;&#x5220;&#x9664;Web&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x7684;&#x5185;&#x5BB9;&#x3002;</p>
<p><code>&lt;uri&gt;</code>&#x662F;&#x76F8;&#x5E94;URL&#x7684;&#x540E;&#x7F00;&#xFF0C;&#x5305;&#x62EC;&#x6587;&#x4EF6;&#x540D;&#x548C;&#x53EF;&#x9009;&#x7684;&#x53C2;&#x6570;&#x3002;</p>
<p><code>&lt;version&gt;</code>&#x8868;&#x660E;&#x4E86;&#x8BE5;&#x8BF7;&#x6C42;&#x9075;&#x5FAA;&#x7684;HTTP&#x7248;&#x672C;&#x3002;</p>
<p>&#x8BF7;&#x6C42;&#x62A5;&#x5934;&#x4E3A;&#x670D;&#x52A1;&#x5668;&#x63D0;&#x4F9B;&#x4E86;&#x989D;&#x5916;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x4F8B;&#x5982;&#x6D4F;&#x89C8;&#x5668;&#x7684;&#x5546;&#x6807;&#x540D;&#xFF0C;&#x6216;&#x8005;&#x6D4F;&#x89C8;&#x5668;&#x7406;&#x89E3;&#x7684;MIME&#x7C7B;&#x578B;&#x3002;&#x8BF7;&#x6C42;&#x62A5;&#x5934;&#x7684;&#x683C;&#x5F0F;&#x4E3A;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;header name&gt;: &lt;header data&gt;</span><br></pre></td></tr></table></figure>

<p>&#x9488;&#x5BF9;HTTP/1.1&#x8BF7;&#x6C42;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;HOST&#x62A5;&#x5934;&#xFF0C;&#x5982;<code>Host: www.google.com</code>&#xFF0C;&#x5B83;&#x7684;&#x6570;&#x636E;&#x6307;&#x793A;&#x4E86;&#x539F;&#x59CB;&#x670D;&#x52A1;&#x5668;&#x7684;&#x57DF;&#x540D;&#x3002;</p>
<h4 id="2-HTTP&#x54CD;&#x5E94;"><a href="#2-HTTP&#x54CD;&#x5E94;" class="headerlink" title="2.HTTP&#x54CD;&#x5E94;"></a>2.HTTP&#x54CD;&#x5E94;</h4><p>HTTP&#x54CD;&#x5E94;&#x7684;&#x7EC4;&#x6210;:</p>
<ol>
<li>&#x4E00;&#x4E2A;&#x54CD;&#x5E94;&#x884C;(response line)</li>
<li>(&#x7D27;&#x8DDF;&#x7740;)&#x96F6;&#x4E2A;&#x6216;&#x66F4;&#x591A;&#x7684;&#x54CD;&#x5E94;&#x62A5;&#x5934;(response header)</li>
<li>(&#x5728;&#x7D27;&#x8DDF;&#x7740;)&#x4E00;&#x4E2A;&#x7EC8;&#x6B62;&#x62A5;&#x5934;&#x7684;&#x7A7A;&#x767D;&#x884C;</li>
<li>(&#x518D;&#x7D27;&#x8DDF;&#x7740;)&#x4E00;&#x4E2A;&#x54CD;&#x5E94;&#x4E3B;&#x4F53;(response body)</li>
</ol>
<p>&#x4E00;&#x4E2A;&#x54CD;&#x5E94;&#x884C;&#x7684;&#x683C;&#x5F0F;&#x662F;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;version&gt; &lt;status code&gt; &lt;status message&gt;</span><br></pre></td></tr></table></figure>

<p><code>&lt;version&gt;</code>&#x63CF;&#x8FF0;&#x4E86;&#x54CD;&#x5E94;&#x6240;&#x9075;&#x5FAA;&#x7684;HTTP&#x7248;&#x672C;&#x3002;<code>&lt;status code&gt;</code>&#x662F;&#x4E00;&#x4E2A;&#x4E09;&#x4F4D;&#x7684;&#x6B63;&#x6574;&#x6570;&#xFF0C;&#x6307;&#x660E;&#x5BF9;&#x8BF7;&#x6C42;&#x7684;&#x5904;&#x7406;&#xFF0C;<code>&lt;status message&gt;</code>&#x7ED9;&#x51FA;&#x4E0E;&#x9519;&#x8BEF;&#x7801;&#x7B49;&#x4EF7;&#x7684;&#x82F1;&#x6587;&#x63CF;&#x8FF0;&#x3002;&#x4EE5;&#x4E0B;&#x662F;&#x4E00;&#x4E9B;&#x5E38;&#x89C1;&#x7684;&#x72B6;&#x6001;&#x7801;:</p>
<table>
<thead>
<tr>
<th>Status Code</th>
<th>Status Message</th>
<th>&#x63CF;&#x8FF0;</th>
</tr>
</thead>
<tbody><tr>
<td>200</td>
<td>&#x6210;&#x529F;</td>
<td>&#x5904;&#x7406;&#x8BF7;&#x6C42;&#x65E0;&#x8BEF;</td>
</tr>
<tr>
<td>301</td>
<td>&#x6C38;&#x4E45;&#x79FB;&#x52A8;</td>
<td>&#x5185;&#x5BB9;&#x5DF2;&#x79FB;&#x81F3;&#x7531;&#x54CD;&#x5E94;&#x62A5;&#x5934;Location&#x6307;&#x660E;&#x7684;&#x65B0;URL&#x4E0A;</td>
</tr>
<tr>
<td>400</td>
<td>&#x9519;&#x8BEF;&#x8BF7;&#x6C42;</td>
<td>&#x670D;&#x52A1;&#x5668;&#x4E0D;&#x80FD;&#x7406;&#x89E3;&#x8BF7;&#x6C42;</td>
</tr>
<tr>
<td>403</td>
<td>&#x7981;&#x6B62;</td>
<td>&#x670D;&#x52A1;&#x5668;&#x65E0;&#x6743;&#x8BBF;&#x95EE;&#x8BF7;&#x6C42;&#x7684;&#x6587;&#x4EF6;</td>
</tr>
<tr>
<td>404</td>
<td>&#x672A;&#x53D1;&#x73B0;</td>
<td>&#x670D;&#x52A1;&#x5668;&#x627E;&#x4E0D;&#x5230;&#x6240;&#x8BF7;&#x6C42;&#x7684;&#x6587;&#x4EF6;</td>
</tr>
<tr>
<td>501</td>
<td>&#x672A;&#x5B9E;&#x73B0;</td>
<td>&#x670D;&#x52A1;&#x5668;&#x4E0D;&#x652F;&#x6301;&#x8BF7;&#x6C42;&#x7684;&#x65B9;&#x6CD5;</td>
</tr>
<tr>
<td>505</td>
<td>HTTP&#x7248;&#x672C;&#x4E0D;&#x652F;&#x6301;</td>
<td>&#x670D;&#x52A1;&#x5668;&#x4E0D;&#x652F;&#x6301;&#x8BF7;&#x6C42;&#x7684;&#x7248;&#x672C;</td>
</tr>
</tbody></table>
<p><em>&#x72B6;&#x6001;&#x7801;&#x5206;&#x7C7B;&#xFF1A;1xx&#x6D88;&#x606F;&#xFF0C;2xx&#x6210;&#x529F;&#xFF0C;3xx&#x91CD;&#x5B9A;&#x5411;&#xFF0C;4xx&#x5BA2;&#x6237;&#x7AEF;&#x9519;&#x8BEF;&#xFF0C;5xx&#x670D;&#x52A1;&#x5668;&#x9519;&#x8BEF;</em></p>
<p>&#x54CD;&#x5E94;&#x62A5;&#x5934;&#x63D0;&#x4F9B;&#x4E86;&#x5173;&#x4E8E;&#x54CD;&#x5E94;&#x7684;&#x9644;&#x52A0;&#x4FE1;&#x606F;&#x3002;&#x6BD4;&#x5982;<code>Content-Type</code>&#x544A;&#x8BC9;&#x5BA2;&#x6237;&#x7AEF;&#x54CD;&#x5E94;&#x4E3B;&#x4F53;&#x4E2D;&#x5185;&#x5BB9;&#x7684;MIME&#x7C7B;&#x578B;&#xFF1B;<code>Content-Length</code>&#x6307;&#x793A;&#x54CD;&#x5E94;&#x4E3B;&#x4F53;&#x7684;&#x5927;&#x5C0F;&#x3002;</p>
<p>&#x7EC8;&#x6B62;&#x54CD;&#x5E94;&#x62A5;&#x5934;&#x7684;&#x7A7A;&#x6587;&#x672C;&#x884C;&#x4E4B;&#x540E;&#xFF0C;&#x8DDF;&#x968F;&#x7684;&#x662F;&#x54CD;&#x5E94;&#x4E3B;&#x4F53;&#xFF0C;&#x54CD;&#x5E94;&#x4E3B;&#x4F53;&#x4E2D;&#x5305;&#x542B;&#x7740;&#x88AB;&#x8BF7;&#x6C42;&#x7684;&#x5185;&#x5BB9;&#x3002;</p>
<h3 id="&#x670D;&#x52A1;&#x52A8;&#x6001;&#x5185;&#x5BB9;"><a href="#&#x670D;&#x52A1;&#x52A8;&#x6001;&#x5185;&#x5BB9;" class="headerlink" title="&#x670D;&#x52A1;&#x52A8;&#x6001;&#x5185;&#x5BB9;"></a>&#x670D;&#x52A1;&#x52A8;&#x6001;&#x5185;&#x5BB9;</h3><p>CGI(Common Gateway Interface)&#x7684;&#x5B9E;&#x9645;&#x6807;&#x51C6;&#x7528;&#x6765;&#x89E3;&#x51B3;&#x5982;&#x4E0B;&#x95EE;&#x9898;:</p>
<ol>
<li>&#x5BA2;&#x6237;&#x7AEF;&#x5982;&#x4F55;&#x5C06;&#x53C2;&#x6570;&#x4F20;&#x9012;&#x7ED9;&#x670D;&#x52A1;&#x5668;</li>
</ol>
<p>Get&#x8BF7;&#x6C42;&#x7684;&#x53C2;&#x6570;&#x5728;URL&#x4E2D;&#x4F20;&#x9012;&#x3002;&#x4E00;&#x4E2A;<code>?</code>&#x5206;&#x5272;&#x6587;&#x4EF6;&#x540D;&#x548C;&#x53C2;&#x6570;&#xFF0C;&#x800C;&#x6BCF;&#x4E2A;&#x53C2;&#x6570;&#x90FD;&#x7528;&#x4E00;&#x4E2A;<code>&amp;</code>&#x5B57;&#x7B26;&#x9694;&#x5F00;&#x3002;&#x53C2;&#x6570;&#x4E2D;&#x4E0D;&#x5141;&#x8BB8;&#x6709;&#x7A7A;&#x683C;&#xFF0C;&#x800C;&#x5FC5;&#x987B;&#x7528;&#x5B57;&#x7B26;&#x4E32;<code>%20</code>&#x6765;&#x8868;&#x793A;&#xFF0C;&#x5BF9;&#x4E8E;&#x5176;&#x4ED6;&#x7279;&#x6B8A;&#x5B57;&#x7B26;&#xFF0C;&#x4E5F;&#x5B58;&#x5728;&#x7740;&#x76F8;&#x4F3C;&#x7684;&#x7F16;&#x7801;&#x3002;POST&#x8BF7;&#x6C42;&#x7684;&#x53C2;&#x6570;&#x662F;&#x5728;&#x8BF7;&#x6C42;&#x4E3B;&#x4F53;&#x4E2D;&#x800C;&#x4E0D;&#x662F;&#x5728;URI&#x4E2D;&#x4F20;&#x9012;&#x7684;&#x3002;<br>2. &#x670D;&#x52A1;&#x5668;&#x5982;&#x4F55;&#x5C06;&#x53C2;&#x6570;&#x4F20;&#x9012;&#x7ED9;&#x5B50;&#x8FDB;&#x7A0B;</p>
<p>&#x5728;&#x670D;&#x52A1;&#x5668;&#x63A5;&#x6536;&#x5230;&#x4E00;&#x4E2A;&#x5982;&#x4E0B;&#x7684;&#x8BF7;&#x6C42;&#x540E;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801; GET /cgi-bin/adder?123&amp;345 HTTP/1.1</span><br></pre></td></tr></table></figure>

<p>&#x5B83;&#x8C03;&#x7528;<code>fork</code>&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5B50;&#x8FDB;&#x7A0B;&#xFF0C;&#x5E76;&#x8C03;&#x7528;<code>execve</code>&#x5728;&#x5B50;&#x8FDB;&#x7A0B;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x6267;&#x884C;<code>/cgi-bin/adder</code>&#x7A0B;&#x5E8F;&#x3002;&#x50CF;<code>adder</code>&#x8FD9;&#x6837;&#x7684;&#x7A0B;&#x5E8F;&#xFF0C;&#x5E38;&#x5E38;&#x88AB;&#x79F0;&#x4E3A;CGI&#x7A0B;&#x5E8F;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x9075;&#x5B88;CGI&#x6807;&#x51C6;&#x3002;&#x5728;&#x8C03;&#x7528;<code>execve</code>&#x4E4B;&#x524D;&#xFF0C;&#x5B50;&#x8FDB;&#x7A0B;&#x5C06;CGI&#x73AF;&#x5883;&#x53D8;&#x91CF;<code>QUERY_STRING</code>&#x8BBE;&#x7F6E;&#x4E3A;<code>123&amp;345</code>&#xFF0C;<code>adder</code>&#x7A0B;&#x5E8F;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;Unix<br> <code>getenv</code>&#x51FD;&#x6570;&#x6765;&#x5F15;&#x7528;&#x5B83;&#x3002;<br>3. &#x670D;&#x52A1;&#x5668;&#x5982;&#x4F55;&#x5C06;&#x5176;&#x4ED6;&#x4FE1;&#x606F;&#x4F20;&#x9012;&#x7ED9;&#x5B50;&#x8FDB;&#x7A0B;</p>
<p>CGI&#x5B9A;&#x4E49;&#x4E86;&#x5927;&#x91CF;&#x7684;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#xFF0C;&#x4E00;&#x4E2A;CGI&#x7A0B;&#x5E8F;&#x5728;&#x5B83;&#x8FD0;&#x884C;&#x65F6;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x8FD9;&#x4E9B;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x3002;</p>
<table>
<thead>
<tr>
<th>&#x73AF;&#x5883;&#x53D8;&#x91CF;</th>
<th>&#x63CF;&#x8FF0;</th>
</tr>
</thead>
<tbody><tr>
<td>QUERY_STRING</td>
<td>&#x7A0B;&#x5E8F;&#x53C2;&#x6570;</td>
</tr>
<tr>
<td>SERVER_PORT</td>
<td>&#x7236;&#x8FDB;&#x7A0B;&#x76D1;&#x542C;&#x7684;&#x7AEF;&#x53E3;</td>
</tr>
<tr>
<td>REQUEST_METHOD</td>
<td>GET&#x6216;POST</td>
</tr>
<tr>
<td>REMOTE_HOST</td>
<td>&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x57DF;&#x540D;</td>
</tr>
<tr>
<td>REMOTE_ADDR</td>
<td>&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x70B9;&#x5206;&#x5341;&#x8FDB;&#x5236;IP&#x5730;&#x5740;</td>
</tr>
<tr>
<td>CONTENT_TYPE</td>
<td>&#x53EA;&#x5BF9;POST&#x800C;&#x8A00;: &#x8BF7;&#x6C42;&#x4F53;&#x7684;MIME&#x7C7B;&#x578B;</td>
</tr>
<tr>
<td>CONTEMT_LENGTH</td>
<td>&#x53EA;&#x5BF9;POST&#x800C;&#x8A00;: &#x8BF7;&#x6C42;&#x4F53;&#x7684;&#x5B57;&#x8282;&#x5927;&#x5C0F;</td>
</tr>
<tr>
<td>4. &#x5B50;&#x8FDB;&#x7A0B;&#x5C06;&#x5B83;&#x7684;&#x8F93;&#x51FA;&#x53D1;&#x9001;&#x5230;&#x54EA;&#x91CC;</td>
<td></td>
</tr>
</tbody></table>
<p>&#x4E00;&#x4E2A;CGI&#x7A0B;&#x5E8F;&#x5C06;&#x5B83;&#x7684;&#x52A8;&#x6001;&#x5185;&#x5BB9;&#x53D1;&#x9001;&#x5230;&#x6807;&#x51C6;&#x8F93;&#x51FA;&#x3002;&#x5728;&#x5B50;&#x8FDB;&#x7A0B;&#x4E2D;&#x52A0;&#x8F7D;&#x5E76;&#x8FD0;&#x884C;CGI&#x7A0B;&#x5E8F;&#x4E4B;&#x524D;&#xFF0C;&#x5B83;&#x4F7F;&#x7528;Unix <code>dup2</code>&#x51FD;&#x6570;&#x5C06;&#x6807;&#x51C6;&#x8F93;&#x51FA;&#x91CD;&#x5B9A;&#x5411;&#x5230;&#x548C;&#x5BA2;&#x6237;&#x7AEF;&#x76F8;&#x5173;&#x8054;&#x7684;&#x5DF2;&#x8FDE;&#x63A5;&#x63CF;&#x8FF0;&#x7B26;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x4EFB;&#x4F55;CGI&#x7A0B;&#x5E8F;&#x5199;&#x5230;&#x6807;&#x51C6;&#x8F93;&#x51FA;&#x7684;&#x5185;&#x5BB9;&#x90FD;&#x4F1A;&#x76F4;&#x63A5;&#x5230;&#x8FBE;&#x5BA2;&#x6237;&#x7AEF;&#x3002; &#x56E0;&#x4E3A;&#x7236;&#x8FDB;&#x7A0B;&#x4E0D;&#x77E5;&#x9053;&#x5B50;&#x8FDB;&#x7A0B;&#x751F;&#x6210;&#x7684;&#x5185;&#x5BB9;&#x7684;&#x7C7B;&#x578B;&#x548C;&#x5927;&#x5C0F;&#xFF0C;&#x6240;&#x4EE5;&#x5B50;&#x8FDB;&#x7A0B;&#x8D1F;&#x8D23;&#x751F;&#x6210;<code>Content-type</code>&#x548C;<code>Content-length</code>&#x54CD;&#x5E94;&#x62A5;&#x5934;&#xFF0C;&#x4EE5;&#x53CA;&#x7EC8;&#x6B62;&#x62A5;&#x5934;&#x7684;&#x7A7A;&#x884C;&#x3002;</p>
<h3 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h3><p>HTTP&#x670D;&#x52A1;&#x5668;&#x662F;&#x65E0;&#x72B6;&#x6001;&#x7684;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x540C;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x5411;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x5668;&#x53D1;&#x9001;&#x4E0D;&#x540C;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x4E0D;&#x80FD;&#x8BC6;&#x5230;&#x8FD9;&#x4E9B;&#x8BF7;&#x6C42;&#x6765;&#x81EA;&#x6765;&#x81EA;&#x540C;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x3002;</p>
<p>&#x7136;&#x800C;&#x4E00;&#x4E2A;Web&#x7AD9;&#x70B9;&#x901A;&#x5E38;&#x5E0C;&#x671B;&#x80FD;&#x591F;&#x8BC6;&#x522B;&#x7528;&#x6237;&#xFF0C;&#x4E3A;&#x6B64;HTTP&#x4F7F;&#x7528;&#x4E86;cookie&#x3002;cookie&#x7684;&#x5DE5;&#x4F5C;&#x8FC7;&#x7A0B;&#x4E3A;:</p>
<ol>
<li>&#x7528;&#x6237;&#x6D4F;&#x89C8;&#x5668;&#x5411;&#x670D;&#x52A1;&#x5668;&#x53D1;&#x9001;&#x8BF7;&#x6C42;</li>
<li>&#x670D;&#x52A1;&#x5668;&#x63A5;&#x6536;&#x7684;&#x8BF7;&#x6C42;&#x540E;&#xFF0C;&#x4EA7;&#x751F;&#x4E00;&#x4E2A;&#x552F;&#x4E00;&#x7684;&#x6807;&#x8BC6;&#x7801;<code>&lt;identification code&gt;</code>&#xFF0C;&#x5E76;&#x4EE5;&#x6B64;&#x4E3A;&#x7D22;&#x5F15;&#x5728;&#x5B83;&#x7684;&#x540E;&#x7AEF;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x4EA7;&#x751F;&#x4E00;&#x4E2A;&#x8868;&#x9879;</li>
<li>&#x670D;&#x52A1;&#x5668;&#x7528;&#x4E00;&#x4E2A;&#x5305;&#x542B;<code>Set-cookie: &lt;identification code&gt;</code>&#x54CD;&#x5E94;&#x62A5;&#x5934;&#x7684;&#x54CD;&#x5E94;&#x62A5;&#x6587;&#x5BF9;&#x7528;&#x6237;&#x6D4F;&#x89C8;&#x5668;&#x8FDB;&#x884C;&#x54CD;&#x5E94;</li>
<li>&#x7528;&#x6237;&#x6D4F;&#x89C8;&#x5668;&#x6536;&#x5230;&#x8BE5;HTTP&#x54CD;&#x5E94;&#x62A5;&#x6587;&#x65F6;&#xFF0C;&#x5B83;&#x4F1A;&#x770B;&#x5230;<code>Set-cookie</code>&#x62A5;&#x5934;&#xFF0C;&#x8BE5;&#x6D4F;&#x89C8;&#x5668;&#x5728;&#x5B83;&#x7BA1;&#x7406;&#x7684;&#x7279;&#x5B9A;cookie&#x6587;&#x4EF6;&#x4E2D;&#x6DFB;&#x52A0;&#x4E00;&#x884C;&#xFF0C;&#x6539;&#x884C;&#x5305;&#x542B;&#x670D;&#x52A1;&#x5668;&#x7684;&#x4E3B;&#x673A;&#x540D;&#x548C;&#x5728;<code>Set-cookie</code>&#x62A5;&#x5934;&#x4E2D;&#x58F0;&#x660E;&#x7684;<code>&lt;identification code&gt;</code></li>
<li>&#x4E4B;&#x540E;&#x5F53;&#x7528;&#x6237;&#x6D4F;&#x89C8;&#x5668;&#x7EE7;&#x7EED;&#x5411;&#x76F8;&#x540C;&#x670D;&#x52A1;&#x5668;&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;HTTP&#x8BF7;&#x6C42;&#x62A5;&#x6587;&#x90FD;&#x5305;&#x542B;<code>Cookie: &lt;identification code&gt;</code>&#x8BF7;&#x6C42;&#x62A5;&#x5934;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x53EF;&#x4EE5;&#x636E;&#x6B64;&#x8DDF;&#x8E2A;&#x7528;&#x6237;&#xFF0C;&#x4FDD;&#x5B58;&#x7528;&#x6237;&#x72B6;&#x6001;</li>
</ol>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/9dc5f57218e4061b1e561ac43ca223aa.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903512459968520.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903512459968520.html" itemprop="url">ConcurrentLinkedQueue的实现具体分析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-20T11:58:36+08:00">
                2017-11-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##&#x5F15;&#x8A00;## &#x5728;&#x5E76;&#x53D1;&#x7F16;&#x7A0B;&#x4E2D;&#x6211;&#x4EEC;&#x6709;&#x65F6;&#x5019;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x7684;&#x961F;&#x5217;&#x3002;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x8981;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x7684;&#x961F;&#x5217;&#x6709;&#x4E24;&#x79CD;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#x4E00;&#x79CD;&#x662F;&#x4F7F;&#x7528;&#x963B;&#x585E;&#x7B97;&#x6CD5;&#xFF0C;&#x53E6;&#x4E00;&#x79CD;&#x662F;&#x4F7F;&#x7528;&#x975E;&#x963B;&#x585E;&#x7B97;&#x6CD5;&#x3002;&#x4F7F;&#x7528;&#x963B;&#x585E;&#x7B97;&#x6CD5;&#x7684;&#x961F;&#x5217;&#x53EF;&#x4EE5;&#x7528;&#x4E00;&#x4E2A;&#x9501;&#xFF08;&#x5165;&#x961F;&#x548C;&#x51FA;&#x961F;&#x7528;&#x540C;&#x4E00;&#x628A;&#x9501;&#xFF09;&#x6216;&#x4E24;&#x4E2A;&#x9501;&#xFF08;&#x5165;&#x961F;&#x548C;&#x51FA;&#x961F;&#x7528;&#x4E0D;&#x540C;&#x7684;&#x9501;&#xFF09;&#x7B49;&#x65B9;&#x5F0F;&#x6765;&#x5B9E;&#x73B0;&#xFF0C;&#x800C;&#x975E;&#x963B;&#x585E;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#x5219;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5FAA;&#x73AF;CAS&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x5B9E;&#x73B0;&#xFF0C;&#x672C;&#x6587;&#x8BA9;&#x6211;&#x4EEC;&#x4E00;&#x8D77;&#x6765;&#x7814;&#x7A76;&#x4E0B;Doug Lea&#x662F;&#x5982;&#x4F55;&#x4F7F;&#x7528;&#x975E;&#x963B;&#x585E;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x5B9E;&#x73B0;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x961F;&#x5217;ConcurrentLinkedQueue&#x7684;&#xFF0C;&#x76F8;&#x4FE1;&#x4ECE;&#x5927;&#x5E08;&#x8EAB;&#x4E0A;&#x6211;&#x4EEC;&#x80FD;&#x5B66;&#x5230;&#x4E0D;&#x5C11;&#x5E76;&#x53D1;&#x7F16;&#x7A0B;&#x7684;&#x6280;&#x5DE7;&#x3002; ##ConcurrentLinkedQueue&#x7684;&#x4ECB;&#x7ECD;##<br> ConcurrentLinkedQueue&#x662F;&#x4E00;&#x4E2A;&#x57FA;&#x4E8E;&#x94FE;&#x63A5;&#x8282;&#x70B9;&#x7684;&#x65E0;&#x754C;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x961F;&#x5217;&#xFF0C;&#x5B83;&#x91C7;&#x7528;&#x5148;&#x8FDB;&#x5148;&#x51FA;&#x7684;&#x89C4;&#x5219;&#x5BF9;&#x8282;&#x70B9;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5B83;&#x4F1A;&#x6DFB;&#x52A0;&#x5230;&#x961F;&#x5217;&#x7684;&#x5C3E;&#x90E8;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x83B7;&#x53D6;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x65F6;&#xFF0C;&#x5B83;&#x4F1A;&#x8FD4;&#x56DE;&#x961F;&#x5217;&#x5934;&#x90E8;&#x7684;&#x5143;&#x7D20;&#x3002;&#x5B83;&#x91C7;&#x7528;&#x4E86;&#x201C;wait&#xFF0D;free&#x201D;&#x7B97;&#x6CD5;&#x6765;&#x5B9E;&#x73B0;&#xFF0C;&#x8BE5;&#x7B97;&#x6CD5;&#x5728;Michael &amp; Scott&#x7B97;&#x6CD5;&#x4E0A;&#x8FDB;&#x884C;&#x4E86;&#x4E00;&#x4E9B;&#x4FEE;&#x6539;&#x3002; ##ConcurrentLinkedQueue&#x7684;&#x7ED3;&#x6784;## &#x6211;&#x4EEC;&#x901A;&#x8FC7;ConcurrentLinkedQueue&#x7684;&#x7C7B;&#x56FE;&#x6765;&#x5206;&#x6790;&#x4E00;&#x4E0B;&#x5B83;&#x7684;&#x7ED3;&#x6784;&#x3002; <img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/52904b78207e3caf52bc41d775ea86ef43317ccacd1791675146117056a92bcb" alt="&#x5728;&#x6B64;&#x8F93;&#x5165;&#x56FE;&#x7247;&#x63CF;&#x8FF0;"> ConcurrentLinkedQueue&#x7531;head&#x8282;&#x70B9;&#x548C;tair&#x8282;&#x70B9;&#x7EC4;&#x6210;&#xFF0C;&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#xFF08;Node&#xFF09;&#x7531;&#x8282;&#x70B9;&#x5143;&#x7D20;&#xFF08;item&#xFF09;&#x548C;&#x6307;&#x5411;&#x4E0B;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x7684;&#x5F15;&#x7528;(next)&#x7EC4;&#x6210;&#xFF0C;&#x8282;&#x70B9;&#x4E0E;&#x8282;&#x70B9;&#x4E4B;&#x95F4;&#x5C31;&#x662F;&#x901A;&#x8FC7;&#x8FD9;&#x4E2A;next&#x5173;&#x8054;&#x8D77;&#x6765;&#xFF0C;&#x4ECE;&#x800C;&#x7EC4;&#x6210;&#x4E00;&#x5F20;&#x94FE;&#x8868;&#x7ED3;&#x6784;&#x7684;&#x961F;&#x5217;&#x3002;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;head&#x8282;&#x70B9;&#x5B58;&#x50A8;&#x7684;&#x5143;&#x7D20;&#x4E3A;&#x7A7A;&#xFF0C;tair&#x8282;&#x70B9;&#x7B49;&#x4E8E;head&#x8282;&#x70B9;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;private transient volatile Node&lt;e&gt; tail = head;</span><br></pre></td></tr></table></figure>

<p>##&#x5165;&#x961F;&#x5217;## <strong>&#x5165;&#x961F;&#x5217;&#x5C31;&#x662F;&#x5C06;&#x5165;&#x961F;&#x8282;&#x70B9;&#x6DFB;&#x52A0;&#x5230;&#x961F;&#x5217;&#x7684;&#x5C3E;&#x90E8;</strong>&#x3002;&#x4E3A;&#x4E86;&#x65B9;&#x4FBF;&#x7406;&#x89E3;&#x5165;&#x961F;&#x65F6;&#x961F;&#x5217;&#x7684;&#x53D8;&#x5316;&#xFF0C;&#x4EE5;&#x53CA;head&#x8282;&#x70B9;&#x548C;tair&#x8282;&#x70B9;&#x7684;&#x53D8;&#x5316;&#xFF0C;&#x6BCF;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x6211;&#x5C31;&#x505A;&#x4E86;&#x4E00;&#x4E2A;&#x961F;&#x5217;&#x7684;&#x5FEB;&#x7167;&#x56FE;&#x3002; <img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/475f0bdbab8fa620ae7f963a94e9386cd997b884d90ed3962fd4f8b005d0356e" alt="&#x5728;&#x6B64;&#x8F93;&#x5165;&#x56FE;&#x7247;&#x63CF;&#x8FF0;"></p>
<p><strong>&#x7B2C;&#x4E00;&#x6B65;&#x6DFB;&#x52A0;&#x5143;&#x7D20;1</strong>&#xFF1A;&#x961F;&#x5217;&#x66F4;&#x65B0;head&#x8282;&#x70B9;&#x7684;next&#x8282;&#x70B9;&#x4E3A;&#x5143;&#x7D20;1&#x8282;&#x70B9;&#x3002;&#x53C8;&#x56E0;&#x4E3A;tail&#x8282;&#x70B9;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#x7B49;&#x4E8E;head&#x8282;&#x70B9;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x4EEC;&#x7684;next&#x8282;&#x70B9;&#x90FD;&#x6307;&#x5411;&#x5143;&#x7D20;1&#x8282;&#x70B9;&#x3002; <strong>&#x7B2C;&#x4E8C;&#x6B65;&#x6DFB;&#x52A0;&#x5143;&#x7D20;2</strong>&#xFF1A;&#x961F;&#x5217;&#x9996;&#x5148;&#x8BBE;&#x7F6E;&#x5143;&#x7D20;1&#x8282;&#x70B9;&#x7684;next&#x8282;&#x70B9;&#x4E3A;&#x5143;&#x7D20;2&#x8282;&#x70B9;&#xFF0C;&#x7136;&#x540E;&#x66F4;&#x65B0;tail&#x8282;&#x70B9;&#x6307;&#x5411;&#x5143;&#x7D20;2&#x8282;&#x70B9;&#x3002; <strong>&#x7B2C;&#x4E09;&#x6B65;&#x6DFB;&#x52A0;&#x5143;&#x7D20;3</strong>&#xFF1A;&#x8BBE;&#x7F6E;tail&#x8282;&#x70B9;&#x7684;next&#x8282;&#x70B9;&#x4E3A;&#x5143;&#x7D20;3&#x8282;&#x70B9;&#x3002; <strong>&#x7B2C;&#x56DB;&#x6B65;&#x6DFB;&#x52A0;&#x5143;&#x7D20;4</strong>&#xFF1A;&#x8BBE;&#x7F6E;&#x5143;&#x7D20;3&#x7684;next&#x8282;&#x70B9;&#x4E3A;&#x5143;&#x7D20;4&#x8282;&#x70B9;&#xFF0C;&#x7136;&#x540E;&#x5C06;tail&#x8282;&#x70B9;&#x6307;&#x5411;&#x5143;&#x7D20;4&#x8282;&#x70B9;&#x3002;</p>
<p>&#x901A;&#x8FC7;debug&#x5165;&#x961F;&#x8FC7;&#x7A0B;&#x5E76;&#x89C2;&#x5BDF;head&#x8282;&#x70B9;&#x548C;tail&#x8282;&#x70B9;&#x7684;&#x53D8;&#x5316;&#xFF0C;&#x53D1;&#x73B0;&#x5165;&#x961F;&#x4E3B;&#x8981;&#x505A;&#x4E24;&#x4EF6;&#x4E8B;&#x60C5;&#xFF0C;&#x7B2C;&#x4E00;&#x662F;&#x5C06;&#x5165;&#x961F;&#x8282;&#x70B9;&#x8BBE;&#x7F6E;&#x6210;&#x5F53;&#x524D;&#x961F;&#x5217;&#x5C3E;&#x8282;&#x70B9;&#x7684;&#x4E0B;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x3002;&#x7B2C;&#x4E8C;&#x662F;&#x66F4;&#x65B0;tail&#x8282;&#x70B9;&#xFF0C;&#x5982;&#x679C;tail&#x8282;&#x70B9;&#x7684;next&#x8282;&#x70B9;&#x4E0D;&#x4E3A;&#x7A7A;&#xFF0C;&#x5219;&#x5C06;&#x5165;&#x961F;&#x8282;&#x70B9;&#x8BBE;&#x7F6E;&#x6210;tail&#x8282;&#x70B9;&#xFF0C;&#x5982;&#x679C;tail&#x8282;&#x70B9;&#x7684;next&#x8282;&#x70B9;&#x4E3A;&#x7A7A;&#xFF0C;&#x5219;&#x5C06;&#x5165;&#x961F;&#x8282;&#x70B9;&#x8BBE;&#x7F6E;&#x6210;tail&#x7684;next&#x8282;&#x70B9;&#xFF0C;&#x6240;&#x4EE5;tail&#x8282;&#x70B9;&#x4E0D;&#x603B;&#x662F;&#x5C3E;&#x8282;&#x70B9;&#xFF0C;&#x7406;&#x89E3;&#x8FD9;&#x4E00;&#x70B9;&#x5BF9;&#x4E8E;&#x6211;&#x4EEC;&#x7814;&#x7A76;&#x6E90;&#x7801;&#x4F1A;&#x975E;&#x5E38;&#x6709;&#x5E2E;&#x52A9;&#x3002;</p>
<p>&#x4E0A;&#x9762;&#x7684;&#x5206;&#x6790;&#x8BA9;&#x6211;&#x4EEC;&#x4ECE;&#x5355;&#x7EBF;&#x7A0B;&#x5165;&#x961F;&#x7684;&#x89D2;&#x5EA6;&#x6765;&#x7406;&#x89E3;&#x5165;&#x961F;&#x8FC7;&#x7A0B;&#xFF0C;&#x4F46;&#x662F;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x540C;&#x65F6;&#x8FDB;&#x884C;&#x5165;&#x961F;&#x60C5;&#x51B5;&#x5C31;&#x53D8;&#x5F97;&#x66F4;&#x52A0;&#x590D;&#x6742;&#xFF0C;&#x56E0;&#x4E3A;&#x53EF;&#x80FD;&#x4F1A;&#x51FA;&#x73B0;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x63D2;&#x961F;&#x7684;&#x60C5;&#x51B5;&#x3002;&#x5982;&#x679C;&#x6709;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x6B63;&#x5728;&#x5165;&#x961F;&#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x5FC5;&#x987B;&#x5148;&#x83B7;&#x53D6;&#x5C3E;&#x8282;&#x70B9;&#xFF0C;&#x7136;&#x540E;&#x8BBE;&#x7F6E;&#x5C3E;&#x8282;&#x70B9;&#x7684;&#x4E0B;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x4E3A;&#x5165;&#x961F;&#x8282;&#x70B9;&#xFF0C;&#x4F46;&#x8FD9;&#x65F6;&#x53EF;&#x80FD;&#x6709;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x63D2;&#x961F;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x961F;&#x5217;&#x7684;&#x5C3E;&#x8282;&#x70B9;&#x5C31;&#x4F1A;&#x53D1;&#x751F;&#x53D8;&#x5316;&#xFF0C;&#x8FD9;&#x65F6;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x8981;&#x6682;&#x505C;&#x5165;&#x961F;&#x64CD;&#x4F5C;&#xFF0C;&#x7136;&#x540E;&#x91CD;&#x65B0;&#x83B7;&#x53D6;&#x5C3E;&#x8282;&#x70B9;&#x3002;&#x8BA9;&#x6211;&#x4EEC;&#x518D;&#x901A;&#x8FC7;&#x6E90;&#x7801;&#x6765;&#x8BE6;&#x7EC6;&#x5206;&#x6790;&#x4E0B;&#x5B83;&#x662F;&#x5982;&#x4F55;&#x4F7F;&#x7528;CAS&#x7B97;&#x6CD5;&#x6765;&#x5165;&#x961F;&#x7684;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public boolean offer(E e) {</span><br><span class="line">    if (e == null) throw new NullPointerException();</span><br><span class="line"></span><br><span class="line">    //&#x5165;&#x961F;&#x524D;&#xFF0C;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5165;&#x961F;&#x8282;&#x70B9;</span><br><span class="line">    Node&lt;E&gt; n = new Node&lt;E&gt;(e);</span><br><span class="line"></span><br><span class="line">    retry:</span><br><span class="line">        //&#x6B7B;&#x5FAA;&#x73AF;&#xFF0C;&#x5165;&#x961F;&#x4E0D;&#x6210;&#x529F;&#x53CD;&#x590D;&#x5165;&#x961F;&#x3002;</span><br><span class="line">        for (;;) {</span><br><span class="line">            //&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x6307;&#x5411;tail&#x8282;&#x70B9;&#x7684;&#x5F15;&#x7528;</span><br><span class="line">            Node&lt;E&gt; t = tail;</span><br><span class="line">            //p&#x7528;&#x6765;&#x8868;&#x793A;&#x961F;&#x5217;&#x7684;&#x5C3E;&#x8282;&#x70B9;&#xFF0C;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#x7B49;&#x4E8E;tail&#x8282;&#x70B9;&#x3002;</span><br><span class="line">            Node&lt;E&gt; p = t;</span><br><span class="line"></span><br><span class="line">            for (int hops = 0; ; hops++) {</span><br><span class="line">                //&#x83B7;&#x5F97;p&#x8282;&#x70B9;&#x7684;&#x4E0B;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x3002;</span><br><span class="line">                Node&lt;E&gt; next = succ(p);</span><br><span class="line">                //next&#x8282;&#x70B9;&#x4E0D;&#x4E3A;&#x7A7A;&#xFF0C;&#x8BF4;&#x660E;p&#x4E0D;&#x662F;&#x5C3E;&#x8282;&#x70B9;&#xFF0C;&#x9700;&#x8981;&#x66F4;&#x65B0;p&#x540E;&#x5728;&#x5C06;&#x5B83;&#x6307;&#x5411;next&#x8282;&#x70B9;</span><br><span class="line">                if (next != null) {</span><br><span class="line">                    //&#x5FAA;&#x73AF;&#x4E86;&#x4E24;&#x6B21;&#x53CA;&#x5176;&#x4EE5;&#x4E0A;&#xFF0C;&#x5E76;&#x4E14;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x8FD8;&#x662F;&#x4E0D;&#x7B49;&#x4E8E;&#x5C3E;&#x8282;&#x70B9;</span><br><span class="line">                    if (hops &gt; HOPS &amp;&amp; t != tail)</span><br><span class="line">                        continue retry;</span><br><span class="line">                    p = next;</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                //&#x5982;&#x679C;p&#x662F;&#x5C3E;&#x8282;&#x70B9;&#xFF0C;&#x5219;&#x8BBE;&#x7F6E;p&#x8282;&#x70B9;&#x7684;next&#x8282;&#x70B9;&#x4E3A;&#x5165;&#x961F;&#x8282;&#x70B9;&#x3002;</span><br><span class="line">                else if (p.casNext(null, n)) {</span><br><span class="line">                    //&#x5982;&#x679C;tail&#x8282;&#x70B9;&#x6709;&#x5927;&#x4E8E;&#x7B49;&#x4E8E;1&#x4E2A;next&#x8282;&#x70B9;&#xFF0C;&#x5219;&#x5C06;&#x5165;&#x961F;&#x8282;&#x70B9;&#x8BBE;&#x7F6E;&#x6210;tair&#x8282;&#x70B9;&#xFF0C;&#x66F4;&#x65B0;&#x5931;&#x8D25;&#x4E86;&#x4E5F;&#x6CA1;&#x5173;&#x7CFB;&#xFF0C;&#x56E0;&#x4E3A;&#x5931;&#x8D25;&#x4E86;&#x8868;&#x793A;&#x6709;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x6210;&#x529F;&#x66F4;&#x65B0;&#x4E86;tair&#x8282;&#x70B9;</span><br><span class="line">                    if (hops &gt;= HOPS)</span><br><span class="line">                        casTail(t, n); // &#x66F4;&#x65B0;tail&#x8282;&#x70B9;&#xFF0C;&#x5141;&#x8BB8;&#x5931;&#x8D25;</span><br><span class="line">                    return true;</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                // p&#x6709;next&#x8282;&#x70B9;,&#x8868;&#x793A;p&#x7684;next&#x8282;&#x70B9;&#x662F;&#x5C3E;&#x8282;&#x70B9;&#xFF0C;&#x5219;&#x91CD;&#x65B0;&#x8BBE;&#x7F6E;p&#x8282;&#x70B9;</span><br><span class="line">                else {</span><br><span class="line">                    p = succ(p);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><strong>&#x4ECE;&#x6E90;&#x4EE3;&#x7801;&#x89D2;&#x5EA6;&#x6765;&#x770B;&#x6574;&#x4E2A;&#x5165;&#x961F;&#x8FC7;&#x7A0B;&#x4E3B;&#x8981;&#x505A;&#x4E8C;&#x4EF6;&#x4E8B;&#x60C5;</strong>&#x3002;&#x7B2C;&#x4E00;&#x662F;&#x5B9A;&#x4F4D;&#x51FA;&#x5C3E;&#x8282;&#x70B9;&#xFF0C;&#x7B2C;&#x4E8C;&#x662F;&#x4F7F;&#x7528;CAS&#x7B97;&#x6CD5;&#x80FD;&#x5C06;&#x5165;&#x961F;&#x8282;&#x70B9;&#x8BBE;&#x7F6E;&#x6210;&#x5C3E;&#x8282;&#x70B9;&#x7684;next&#x8282;&#x70B9;&#xFF0C;&#x5982;&#x4E0D;&#x6210;&#x529F;&#x5219;&#x91CD;&#x8BD5;&#x3002;</p>
<p><strong>&#x7B2C;&#x4E00;&#x6B65;&#x5B9A;&#x4F4D;&#x5C3E;&#x8282;&#x70B9;</strong>&#x3002;tail&#x8282;&#x70B9;&#x5E76;&#x4E0D;&#x603B;&#x662F;&#x5C3E;&#x8282;&#x70B9;&#xFF0C;&#x6240;&#x4EE5;&#x6BCF;&#x6B21;&#x5165;&#x961F;&#x90FD;&#x5FC5;&#x987B;&#x5148;&#x901A;&#x8FC7;tail&#x8282;&#x70B9;&#x6765;&#x627E;&#x5230;&#x5C3E;&#x8282;&#x70B9;&#xFF0C;&#x5C3E;&#x8282;&#x70B9;&#x53EF;&#x80FD;&#x5C31;&#x662F;tail&#x8282;&#x70B9;&#xFF0C;&#x4E5F;&#x53EF;&#x80FD;&#x662F;tail&#x8282;&#x70B9;&#x7684;next&#x8282;&#x70B9;&#x3002;&#x4EE3;&#x7801;&#x4E2D;&#x5FAA;&#x73AF;&#x4F53;&#x4E2D;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;if&#x5C31;&#x662F;&#x5224;&#x65AD;tail&#x662F;&#x5426;&#x6709;next&#x8282;&#x70B9;&#xFF0C;&#x6709;&#x5219;&#x8868;&#x793A;next&#x8282;&#x70B9;&#x53EF;&#x80FD;&#x662F;&#x5C3E;&#x8282;&#x70B9;&#x3002;&#x83B7;&#x53D6;tail&#x8282;&#x70B9;&#x7684;next&#x8282;&#x70B9;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;p&#x8282;&#x70B9;&#x7B49;&#x4E8E;p&#x7684;next&#x8282;&#x70B9;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x53EA;&#x6709;&#x4E00;&#x79CD;&#x53EF;&#x80FD;&#x5C31;&#x662F;p&#x8282;&#x70B9;&#x548C;p&#x7684;next&#x8282;&#x70B9;&#x90FD;&#x7B49;&#x4E8E;&#x7A7A;&#xFF0C;&#x8868;&#x793A;&#x8FD9;&#x4E2A;&#x961F;&#x5217;&#x521A;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x6B63;&#x51C6;&#x5907;&#x6DFB;&#x52A0;&#x7B2C;&#x4E00;&#x6B21;&#x8282;&#x70B9;&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x8FD4;&#x56DE;head&#x8282;&#x70B9;&#x3002;&#x83B7;&#x53D6;p&#x8282;&#x70B9;&#x7684;next&#x8282;&#x70B9;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;final Node&lt;E&gt; succ(Node&lt;E&gt; p) {</span><br><span class="line">    Node&lt;E&gt; next = p.getNext();</span><br><span class="line">    return (p == next) ? head : next;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><strong>&#x7B2C;&#x4E8C;&#x6B65;&#x8BBE;&#x7F6E;&#x5165;&#x961F;&#x8282;&#x70B9;&#x4E3A;&#x5C3E;&#x8282;&#x70B9;</strong>&#x3002;p.casNext(null, n)&#x65B9;&#x6CD5;&#x7528;&#x4E8E;&#x5C06;&#x5165;&#x961F;&#x8282;&#x70B9;&#x8BBE;&#x7F6E;&#x4E3A;&#x5F53;&#x524D;&#x961F;&#x5217;&#x5C3E;&#x8282;&#x70B9;&#x7684;next&#x8282;&#x70B9;&#xFF0C;p&#x5982;&#x679C;&#x662F;null&#x8868;&#x793A;p&#x662F;&#x5F53;&#x524D;&#x961F;&#x5217;&#x7684;&#x5C3E;&#x8282;&#x70B9;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x4E3A;null&#x8868;&#x793A;&#x6709;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x66F4;&#x65B0;&#x4E86;&#x5C3E;&#x8282;&#x70B9;&#xFF0C;&#x5219;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x83B7;&#x53D6;&#x5F53;&#x524D;&#x961F;&#x5217;&#x7684;&#x5C3E;&#x8282;&#x70B9;&#x3002;</p>
<p><strong>hops&#x7684;&#x8BBE;&#x8BA1;&#x610F;&#x56FE;</strong>&#x3002;&#x4E0A;&#x9762;&#x5206;&#x6790;&#x8FC7;&#x5BF9;&#x4E8E;&#x5148;&#x8FDB;&#x5148;&#x51FA;&#x7684;&#x961F;&#x5217;&#x5165;&#x961F;&#x6240;&#x8981;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#x5C31;&#x662F;&#x5C06;&#x5165;&#x961F;&#x8282;&#x70B9;&#x8BBE;&#x7F6E;&#x6210;&#x5C3E;&#x8282;&#x70B9;&#xFF0C;doug lea&#x5199;&#x7684;&#x4EE3;&#x7801;&#x548C;&#x903B;&#x8F91;&#x8FD8;&#x662F;&#x7A0D;&#x5FAE;&#x6709;&#x70B9;&#x590D;&#x6742;&#x3002;&#x90A3;&#x4E48;&#x6211;&#x7528;&#x4EE5;&#x4E0B;&#x65B9;&#x5F0F;&#x6765;&#x5B9E;&#x73B0;&#x884C;&#x4E0D;&#x884C;&#xFF1F;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public boolean offer(E e) {</span><br><span class="line">    if (e == null)</span><br><span class="line">        throw new NullPointerException();</span><br><span class="line">    Node&lt;/e&gt;&lt;e&gt; n = new Node&lt;/e&gt;&lt;e&gt;(e);</span><br><span class="line">    for (;;) {</span><br><span class="line">        Node&lt;/e&gt;&lt;e&gt; t = tail;</span><br><span class="line">        if (t.casNext(null, n) &amp;&amp; casTail(t, n)) {</span><br><span class="line">            return true;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8BA9;tail&#x8282;&#x70B9;&#x6C38;&#x8FDC;&#x4F5C;&#x4E3A;&#x961F;&#x5217;&#x7684;&#x5C3E;&#x8282;&#x70B9;&#xFF0C;&#x8FD9;&#x6837;&#x5B9E;&#x73B0;&#x4EE3;&#x7801;&#x91CF;&#x975E;&#x5E38;&#x5C11;&#xFF0C;&#x800C;&#x4E14;&#x903B;&#x8F91;&#x975E;&#x5E38;&#x6E05;&#x695A;&#x548C;&#x6613;&#x61C2;&#x3002;&#x4F46;&#x662F;&#x8FD9;&#x4E48;&#x505A;&#x6709;&#x4E2A;&#x7F3A;&#x70B9;&#x5C31;&#x662F;&#x6BCF;&#x6B21;&#x90FD;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x5FAA;&#x73AF;CAS&#x66F4;&#x65B0;tail&#x8282;&#x70B9;&#x3002;&#x5982;&#x679C;&#x80FD;&#x51CF;&#x5C11;CAS&#x66F4;&#x65B0;tail&#x8282;&#x70B9;&#x7684;&#x6B21;&#x6570;&#xFF0C;&#x5C31;&#x80FD;&#x63D0;&#x9AD8;&#x5165;&#x961F;&#x7684;&#x6548;&#x7387;&#xFF0C;&#x6240;&#x4EE5;doug lea&#x4F7F;&#x7528;hops&#x53D8;&#x91CF;&#x6765;&#x63A7;&#x5236;&#x5E76;&#x51CF;&#x5C11;tail&#x8282;&#x70B9;&#x7684;&#x66F4;&#x65B0;&#x9891;&#x7387;&#xFF0C;&#x5E76;&#x4E0D;&#x662F;&#x6BCF;&#x6B21;&#x8282;&#x70B9;&#x5165;&#x961F;&#x540E;&#x90FD;&#x5C06; tail&#x8282;&#x70B9;&#x66F4;&#x65B0;&#x6210;&#x5C3E;&#x8282;&#x70B9;&#xFF0C;&#x800C;&#x662F;&#x5F53; tail&#x8282;&#x70B9;&#x548C;&#x5C3E;&#x8282;&#x70B9;&#x7684;&#x8DDD;&#x79BB;&#x5927;&#x4E8E;&#x7B49;&#x4E8E;&#x5E38;&#x91CF;HOPS&#x7684;&#x503C;&#xFF08;&#x9ED8;&#x8BA4;&#x7B49;&#x4E8E;1&#xFF09;&#x65F6;&#x624D;&#x66F4;&#x65B0;tail&#x8282;&#x70B9;&#xFF0C;tail&#x548C;&#x5C3E;&#x8282;&#x70B9;&#x7684;&#x8DDD;&#x79BB;&#x8D8A;&#x957F;&#x4F7F;&#x7528;CAS&#x66F4;&#x65B0;tail&#x8282;&#x70B9;&#x7684;&#x6B21;&#x6570;&#x5C31;&#x4F1A;&#x8D8A;&#x5C11;&#xFF0C;&#x4F46;&#x662F;&#x8DDD;&#x79BB;&#x8D8A;&#x957F;&#x5E26;&#x6765;&#x7684;&#x8D1F;&#x9762;&#x6548;&#x679C;&#x5C31;&#x662F;&#x6BCF;&#x6B21;&#x5165;&#x961F;&#x65F6;&#x5B9A;&#x4F4D;&#x5C3E;&#x8282;&#x70B9;&#x7684;&#x65F6;&#x95F4;&#x5C31;&#x8D8A;&#x957F;&#xFF0C;&#x56E0;&#x4E3A;&#x5FAA;&#x73AF;&#x4F53;&#x9700;&#x8981;&#x591A;&#x5FAA;&#x73AF;&#x4E00;&#x6B21;&#x6765;&#x5B9A;&#x4F4D;&#x51FA;&#x5C3E;&#x8282;&#x70B9;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x6837;&#x4ECD;&#x7136;&#x80FD;&#x63D0;&#x9AD8;&#x5165;&#x961F;&#x7684;&#x6548;&#x7387;&#xFF0C;&#x56E0;&#x4E3A;&#x4ECE;&#x672C;&#x8D28;&#x4E0A;&#x6765;&#x770B;&#x5B83;&#x901A;&#x8FC7;&#x589E;&#x52A0;&#x5BF9;volatile&#x53D8;&#x91CF;&#x7684;&#x8BFB;&#x64CD;&#x4F5C;&#x6765;&#x51CF;&#x5C11;&#x4E86;&#x5BF9;volatile&#x53D8;&#x91CF;&#x7684;&#x5199;&#x64CD;&#x4F5C;&#xFF0C;&#x800C;&#x5BF9;volatile&#x53D8;&#x91CF;&#x7684;&#x5199;&#x64CD;&#x4F5C;&#x5F00;&#x9500;&#x8981;&#x8FDC;&#x8FDC;&#x5927;&#x4E8E;&#x8BFB;&#x64CD;&#x4F5C;&#xFF0C;&#x6240;&#x4EE5;&#x5165;&#x961F;&#x6548;&#x7387;&#x4F1A;&#x6709;&#x6240;&#x63D0;&#x5347;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;private static final int HOPS = 1;</span><br></pre></td></tr></table></figure>

<p>&#x8FD8;&#x6709;&#x4E00;&#x70B9;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#x5165;&#x961F;&#x65B9;&#x6CD5;&#x6C38;&#x8FDC;&#x8FD4;&#x56DE;true&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x8981;&#x901A;&#x8FC7;&#x8FD4;&#x56DE;&#x503C;&#x5224;&#x65AD;&#x5165;&#x961F;&#x662F;&#x5426;&#x6210;&#x529F;&#x3002; ##&#x51FA;&#x961F;&#x5217;## &#x51FA;&#x961F;&#x5217;&#x7684;&#x5C31;&#x662F;&#x4ECE;&#x961F;&#x5217;&#x91CC;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x5143;&#x7D20;&#xFF0C;&#x5E76;&#x6E05;&#x7A7A;&#x8BE5;&#x8282;&#x70B9;&#x5BF9;&#x5143;&#x7D20;&#x7684;&#x5F15;&#x7528;&#x3002;&#x8BA9;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x51FA;&#x961F;&#x7684;&#x5FEB;&#x7167;&#x6765;&#x89C2;&#x5BDF;&#x4E0B;head&#x8282;&#x70B9;&#x7684;&#x53D8;&#x5316;&#x3002; <img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/62337be5ad01d4464929783e7f27ade346aa0d63f8d3a5fdf479c7c1d54ca1dc" alt="&#x5728;&#x6B64;&#x8F93;&#x5165;&#x56FE;&#x7247;&#x63CF;&#x8FF0;"></p>
<p>&#x4ECE;&#x4E0A;&#x56FE;&#x53EF;&#x77E5;&#xFF0C;&#x5E76;&#x4E0D;&#x662F;&#x6BCF;&#x6B21;&#x51FA;&#x961F;&#x65F6;&#x90FD;&#x66F4;&#x65B0;head&#x8282;&#x70B9;&#xFF0C;&#x5F53;head&#x8282;&#x70B9;&#x91CC;&#x6709;&#x5143;&#x7D20;&#x65F6;&#xFF0C;&#x76F4;&#x63A5;&#x5F39;&#x51FA;head&#x8282;&#x70B9;&#x91CC;&#x7684;&#x5143;&#x7D20;&#xFF0C;&#x800C;&#x4E0D;&#x4F1A;&#x66F4;&#x65B0;head&#x8282;&#x70B9;&#x3002;&#x53EA;&#x6709;&#x5F53;head&#x8282;&#x70B9;&#x91CC;&#x6CA1;&#x6709;&#x5143;&#x7D20;&#x65F6;&#xFF0C;&#x51FA;&#x961F;&#x64CD;&#x4F5C;&#x624D;&#x4F1A;&#x66F4;&#x65B0;head&#x8282;&#x70B9;&#x3002;&#x8FD9;&#x79CD;&#x505A;&#x6CD5;&#x4E5F;&#x662F;&#x901A;&#x8FC7;hops&#x53D8;&#x91CF;&#x6765;&#x51CF;&#x5C11;&#x4F7F;&#x7528;CAS&#x66F4;&#x65B0;head&#x8282;&#x70B9;&#x7684;&#x6D88;&#x8017;&#xFF0C;&#x4ECE;&#x800C;&#x63D0;&#x9AD8;&#x51FA;&#x961F;&#x6548;&#x7387;&#x3002;&#x8BA9;&#x6211;&#x4EEC;&#x518D;&#x901A;&#x8FC7;&#x6E90;&#x7801;&#x6765;&#x6DF1;&#x5165;&#x5206;&#x6790;&#x4E0B;&#x51FA;&#x961F;&#x8FC7;&#x7A0B;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public E poll() {</span><br><span class="line">    Node&lt;E&gt; h = head;</span><br><span class="line"></span><br><span class="line">    // p&#x8868;&#x793A;&#x5934;&#x8282;&#x70B9;&#xFF0C;&#x9700;&#x8981;&#x51FA;&#x961F;&#x7684;&#x8282;&#x70B9;</span><br><span class="line">    Node&lt;E&gt; p = h;</span><br><span class="line">    for (int hops = 0;; hops++) {</span><br><span class="line">        // &#x83B7;&#x53D6;p&#x8282;&#x70B9;&#x7684;&#x5143;&#x7D20;</span><br><span class="line">        E item = p.getItem();</span><br><span class="line"></span><br><span class="line">        // &#x5982;&#x679C;p&#x8282;&#x70B9;&#x7684;&#x5143;&#x7D20;&#x4E0D;&#x4E3A;&#x7A7A;&#xFF0C;&#x4F7F;&#x7528;CAS&#x8BBE;&#x7F6E;p&#x8282;&#x70B9;&#x5F15;&#x7528;&#x7684;&#x5143;&#x7D20;&#x4E3A;null,&#x5982;&#x679C;&#x6210;&#x529F;&#x5219;&#x8FD4;&#x56DE;p&#x8282;&#x70B9;&#x7684;&#x5143;&#x7D20;&#x3002;</span><br><span class="line">        if (item != null &amp;&amp; p.casItem(item, null)) {</span><br><span class="line">            if (hops &gt;= HOPS) {</span><br><span class="line">                // &#x5C06;p&#x8282;&#x70B9;&#x4E0B;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x8BBE;&#x7F6E;&#x6210;head&#x8282;&#x70B9;</span><br><span class="line">                Node&lt;E&gt; q = p.getNext();</span><br><span class="line"></span><br><span class="line">                updateHead(h, (q != null) ? q : p);</span><br><span class="line">            }</span><br><span class="line">            return item;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        // &#x5982;&#x679C;&#x5934;&#x8282;&#x70B9;&#x7684;&#x5143;&#x7D20;&#x4E3A;&#x7A7A;&#x6216;&#x5934;&#x8282;&#x70B9;&#x53D1;&#x751F;&#x4E86;&#x53D8;&#x5316;&#xFF0C;&#x8FD9;&#x8BF4;&#x660E;&#x5934;&#x8282;&#x70B9;&#x5DF2;&#x7ECF;&#x88AB;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x4FEE;&#x6539;&#x4E86;&#x3002;&#x90A3;&#x4E48;&#x83B7;&#x53D6;p&#x8282;&#x70B9;&#x7684;&#x4E0B;&#x4E00;&#x4E2A;&#x8282;&#x70B9;</span><br><span class="line">        Node&lt;E&gt; next = succ(p);</span><br><span class="line"></span><br><span class="line">        // &#x5982;&#x679C;p&#x7684;&#x4E0B;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x4E5F;&#x4E3A;&#x7A7A;&#xFF0C;&#x8BF4;&#x660E;&#x8FD9;&#x4E2A;&#x961F;&#x5217;&#x5DF2;&#x7ECF;&#x7A7A;&#x4E86;</span><br><span class="line">        if (next == null) {</span><br><span class="line">            // &#x66F4;&#x65B0;&#x5934;&#x8282;&#x70B9;&#x3002;</span><br><span class="line">            updateHead(h, p);</span><br><span class="line">            break;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        // &#x5982;&#x679C;&#x4E0B;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x4E0D;&#x4E3A;&#x7A7A;&#xFF0C;&#x5219;&#x5C06;&#x5934;&#x8282;&#x70B9;&#x7684;&#x4E0B;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x8BBE;&#x7F6E;&#x6210;&#x5934;&#x8282;&#x70B9;</span><br><span class="line">        p = next;</span><br><span class="line">    }</span><br><span class="line">    return null;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x9996;&#x5148;&#x83B7;&#x53D6;&#x5934;&#x8282;&#x70B9;&#x7684;&#x5143;&#x7D20;&#xFF0C;&#x7136;&#x540E;&#x5224;&#x65AD;&#x5934;&#x8282;&#x70B9;&#x5143;&#x7D20;&#x662F;&#x5426;&#x4E3A;&#x7A7A;&#xFF0C;&#x5982;&#x679C;&#x4E3A;&#x7A7A;&#xFF0C;&#x8868;&#x793A;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x5DF2;&#x7ECF;&#x8FDB;&#x884C;&#x4E86;&#x4E00;&#x6B21;&#x51FA;&#x961F;&#x64CD;&#x4F5C;&#x5C06;&#x8BE5;&#x8282;&#x70B9;&#x7684;&#x5143;&#x7D20;&#x53D6;&#x8D70;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x4E3A;&#x7A7A;&#xFF0C;&#x5219;&#x4F7F;&#x7528;CAS&#x7684;&#x65B9;&#x5F0F;&#x5C06;&#x5934;&#x8282;&#x70B9;&#x7684;&#x5F15;&#x7528;&#x8BBE;&#x7F6E;&#x6210;null&#xFF0C;&#x5982;&#x679C;CAS&#x6210;&#x529F;&#xFF0C;&#x5219;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x5934;&#x8282;&#x70B9;&#x7684;&#x5143;&#x7D20;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x6210;&#x529F;&#xFF0C;&#x8868;&#x793A;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x5DF2;&#x7ECF;&#x8FDB;&#x884C;&#x4E86;&#x4E00;&#x6B21;&#x51FA;&#x961F;&#x64CD;&#x4F5C;&#x66F4;&#x65B0;&#x4E86;head&#x8282;&#x70B9;&#xFF0C;&#x5BFC;&#x81F4;&#x5143;&#x7D20;&#x53D1;&#x751F;&#x4E86;&#x53D8;&#x5316;&#xFF0C;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x83B7;&#x53D6;&#x5934;&#x8282;&#x70B9;&#x3002;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/2cd2e11c4946c76876b80761707010f5.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903512480940045.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903512480940045.html" itemprop="url">OpenResty 1136 发布</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-20T11:36:09+08:00">
                2017-11-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>upgraded the <a href="/external_links/6bf5aafc77d409f2ed0bf13aa4c7b41e.html" target="blank" rel="noopener">Nginx</a> core to 1.13.6.<ul>
<li>see the changes here: <a href="/external_links/8e9b2880f13f91db0cf77a98fa80a527.html" target="blank" rel="noopener">nginx.org/en/CHANGES</a></li>
</ul>
</li>
<li>bundled the new component, <a href="/external_links/722a3d6fd324e32af338f115c1a8b5df.html" target="blank" rel="noopener">ngx_stream_lua_module</a> 0.0.4, which is also enabled by default. One can disable this 3rd-party <a href="/external_links/6bf5aafc77d409f2ed0bf13aa4c7b41e.html" target="blank" rel="noopener">Nginx</a> C module by passing <code>--without-stream_lua_module</code> to the <code>./configure</code> script. We provide compatible Lua API with <a href="/external_links/314758c7aa1e42a02c531f47c13bb496.html" target="blank" rel="noopener">ngx_lua</a> wherever it makes sense. Currently<br>we support <a href="/external_links/314758c7aa1e42a02c531f47c13bb496.html" target="blank" rel="noopener">content_by_lua*</a>, preread_by_lua* (similar to <a href="/external_links/314758c7aa1e42a02c531f47c13bb496.html" target="blank" rel="noopener">ngx_lua</a>&#x2018;s <a href="/external_links/314758c7aa1e42a02c531f47c13bb496.html" target="blank" rel="noopener">access_by_lua*</a> ), <a href="/external_links/314758c7aa1e42a02c531f47c13bb496.html" target="blank" rel="noopener">log_by_lua*</a>, and <a href="/external_links/314758c7aa1e42a02c531f47c13bb496.html" target="blank" rel="noopener">balancer_by_lua*</a> in the stream subsystem. thanks Mashape Inc. for<br>sponsoring the <a href="/external_links/13b99122def6e36569f7236b2c24953c.html" target="blank" rel="noopener">OpenResty Inc.</a> team to do the development work on rewriting <a href="/external_links/722a3d6fd324e32af338f115c1a8b5df.html" target="blank" rel="noopener">ngx_stream_lua</a> for recent <a href="/external_links/6bf5aafc77d409f2ed0bf13aa4c7b41e.html" target="blank" rel="noopener">nginx</a> core version.</li>
<li>change: applied a patch to the <a href="/external_links/6bf5aafc77d409f2ed0bf13aa4c7b41e.html" target="blank" rel="noopener">nginx</a> core to make sure the &#x201C;server&#x201D; header in HTTP/2 response shows &#x201C;openresty&#x201D; when the <code>server_tokens</code> diretive is turned off.</li>
<li>feature: added <a href="/external_links/6bf5aafc77d409f2ed0bf13aa4c7b41e.html" target="blank" rel="noopener">nginx</a> core patches needed by <a href="/external_links/722a3d6fd324e32af338f115c1a8b5df.html" target="blank" rel="noopener">ngx_stream_lua_module</a>&#x2018;s <a href="/external_links/314758c7aa1e42a02c531f47c13bb496.html" target="blank" rel="noopener">balancer_by_lua*</a>.</li>
<li>win32: upgraded PCRE to 8.41.</li>
<li>upgraded <a href="/external_links/314758c7aa1e42a02c531f47c13bb496.html" target="blank" rel="noopener">ngx_lua</a> to 0.10.11.<ul>
<li>feature: shdict: added pure C API for getting free page size and total capacity for <a href="/external_links/0914b5973b5b89e20f48d8e339f191b3.html" target="blank" rel="noopener">lua-resty-core</a>. thanks Hiroaki Nakamura for the patch.</li>
<li>feature: added pure C functions for <a href="/external_links/314758c7aa1e42a02c531f47c13bb496.html" target="blank" rel="noopener">shdict:ttl</a>() and <a href="/external_links/314758c7aa1e42a02c531f47c13bb496.html" target="blank" rel="noopener">shdict:expire</a>() API functions.<br>thanks Thibault Charbonnier for the patch.</li>
<li>bugfix: <code>*_by_lua_block</code> directives might break <a href="/external_links/6bf5aafc77d409f2ed0bf13aa4c7b41e.html" target="blank" rel="noopener">nginx</a> config dump (<code>-T</code> switch). thanks Oleg A. Mamontov for the patch.</li>
<li>bugfix: segmentation faults might happen when pipelined http requests are used in the downsteram connection. thanks Gao Yan for the report.</li>
<li>bugfix: the ssl connections might be drained and reused prematurely when <a href="/external_links/314758c7aa1e42a02c531f47c13bb496.html" target="blank" rel="noopener">ssl_certificate_by_lua*</a> or <a href="/external_links/314758c7aa1e42a02c531f47c13bb496.html" target="blank" rel="noopener">ssl_session_fetch_by_lua*</a> were used. this might lead to segmentation faults under load. thanks guanglinlv for the report and the original patch.</li>
<li>bugfix: <a href="/external_links/314758c7aa1e42a02c531f47c13bb496.html" target="blank" rel="noopener">tcpsock:connect()</a>: when the <a href="/external_links/6bf5aafc77d409f2ed0bf13aa4c7b41e.html" target="blank" rel="noopener">nginx</a> resolver&#x2019;s <code>send()</code> immediately fails without yielding, we<br>didn&#x2019;t clean up the coroutine ctx state properly. This might lead to segmentation faults. thanks xiaocang for the report and root for the patch.</li>
<li>bugfix: added fallthrough comment to silence GCC 7&#x2019;s <code>-Wimplicit-fallthrough</code>. thanks Andriy Kornatskyy for the report and spacewander for the patch.</li>
<li>bugfix: <a href="/external_links/314758c7aa1e42a02c531f47c13bb496.html" target="blank" rel="noopener">tcpsock:settimeout</a>, <a href="/external_links/314758c7aa1e42a02c531f47c13bb496.html" target="blank" rel="noopener">tcpsock:settimeouts</a>: throws an error when the timeout<br>argument values overflow. Here we only support timeout values no greater than the max value of a 32 bits integer. thanks spacewander for the patch.</li>
<li>doc: added &#x201C;413 Request Entity Too Large&#x201D; to the possible short circuit response list. thanks Datong Sun for the patch.</li>
</ul>
</li>
<li>upgraded <a href="/external_links/0914b5973b5b89e20f48d8e339f191b3.html" target="blank" rel="noopener">lua-resty-core</a> to 0.1.13.<ul>
<li>feature: <a href="/external_links/40223c84cbb6168a0e84374db8944ed9.html" target="blank" rel="noopener">ngx.balancer</a> now supports the <a href="/external_links/722a3d6fd324e32af338f115c1a8b5df.html" target="blank" rel="noopener">ngx_stream_lua</a>; also disabled<br>all the other <a href="/external_links/97b014ff1c68ec54b7d941efebb1888c.html" target="blank" rel="noopener">FFI</a> APIs for the stream subsystem for now.</li>
<li>feature: <a href="/external_links/8a7d038c26dd6c0e5c5b27f99f0d9de5.html" target="blank" rel="noopener">resty.core.shdict</a>: added new methods <a href="/external_links/314758c7aa1e42a02c531f47c13bb496.html" target="blank" rel="noopener">shdict:free_space</a>()<br>and <a href="/external_links/314758c7aa1e42a02c531f47c13bb496.html" target="blank" rel="noopener">shdict:capacity</a>(). thanks Hiroaki Nakamura for the patch.</li>
<li>feature: implemented the <a href="/external_links/314758c7aa1e42a02c531f47c13bb496.html" target="blank" rel="noopener">ngx.re.gmatch</a> function with <a href="/external_links/97b014ff1c68ec54b7d941efebb1888c.html" target="blank" rel="noopener">FFI</a>. thanks spacewander for the patch.</li>
<li>bugfix: <a href="/external_links/7e19908d52ba385c4dd43c3f6e146c74.html" target="blank" rel="noopener">ngx.re</a>: fix an edge-case where <a href="/external_links/7e19908d52ba385c4dd43c3f6e146c74.html" target="blank" rel="noopener">re.split()</a> might<br>not destroy compiled regexes. thanks Thibault Charbonnier for the patch.</li>
<li>feature: implemented the <a href="/external_links/314758c7aa1e42a02c531f47c13bb496.html" target="blank" rel="noopener">shdict:ttl</a>() and <a href="/external_links/314758c7aa1e42a02c531f47c13bb496.html" target="blank" rel="noopener">shdict:expire</a>() API functions using<br><a href="/external_links/97b014ff1c68ec54b7d941efebb1888c.html" target="blank" rel="noopener">FFI</a>.</li>
</ul>
</li>
<li>upgraded <a href="/external_links/855b9eebfae191fe84c8bc5da1d2edad.html" target="blank" rel="noopener">lua-resty-dns</a> to 0.20.<ul>
<li>feature: allows <code>RRTYPE</code> values larger than 255. thanks Peter Wu for the patch.</li>
</ul>
</li>
<li>upgraded <a href="/external_links/896093e0a52ee077b66a2b57a8d3d56b.html" target="blank" rel="noopener">lua-resty-limit-traffic</a> to 0.05.<ul>
<li>feature: added new module <a href="/external_links/fd30f0b585ec985a56f97b611fd61a9f.html" target="blank" rel="noopener">resty.limit.count</a> for GitHub API style request count limiting. thanks Ke Zhu for the original patch<br>and Ming Wen for the followup tweaks.</li>
<li>bugfix: <a href="/external_links/a882d157af146b4f1f703c79776261e4.html" target="blank" rel="noopener">resty.limit.traffic</a>: we might not uncommit previous limiters if a limiter got rejected while committing a state. thanks<br>Thibault Charbonnier for the patch.</li>
<li>bugfix: <a href="/external_links/b9e947a88ceb4c6f433200a48ad4b072.html" target="blank" rel="noopener">resty.limit.conn</a>: we incorrectly specified the exceeded connection count as the initial value for the shdict key decrement<br>which may lead to dead locks when the key has been evicted in very busy systems. thanks bug had appeared in v0.04.</li>
</ul>
</li>
<li>upgraded <a href="/external_links/2a2391d5f02227a853195851db4cb50d.html" target="blank" rel="noopener">resty-cli</a> to 0.20.<ul>
<li>feature: resty: impelented the <code>-j off</code> option to turn off the JIT compiler.</li>
<li>feature: resty: implemented the <code>-j v</code> and <code>-j dump</code> options similar to luajit&#x2019;s.</li>
<li>feature: resty: added new command-line option <code>-l LIB</code> to mimic lua and luajit -l parameter. thanks Michal Cichra for the patch.</li>
<li>bugfix: resty: handle <code>SIGPIPE</code> ourselves by simply killing the process. thanks Ingy dot Net for the report.</li>
<li>bugfix: resty: hot looping Lua scripts failed to respond to the <code>INT</code> signal.</li>
</ul>
</li>
<li>upgraded <a href="/external_links/40a1159f4d527dfd02f7d87711950775.html" target="blank" rel="noopener">opm</a> to 0.0.4.<ul>
<li>bugfix: <a href="/external_links/40a1159f4d527dfd02f7d87711950775.html" target="blank" rel="noopener">opm</a>: when curl uses HTTP/2 by default <a href="/external_links/40a1159f4d527dfd02f7d87711950775.html" target="blank" rel="noopener">opm</a> would complain about &#x201C;bad response status line received&#x201D;. thanks Donal Byrne<br>and Andrew Redden for the report.</li>
<li>debug: <a href="/external_links/40a1159f4d527dfd02f7d87711950775.html" target="blank" rel="noopener">opm</a>: added more details in the &#x201C;bad response status line received from server&#x201D; error.</li>
</ul>
</li>
<li>upgraded <a href="/external_links/3342a90c0206a90d88f91d7d15d75667.html" target="blank" rel="noopener">ngx_headers_more</a> to 0.33.<ul>
<li>feature: add wildcard match support for <a href="/external_links/3342a90c0206a90d88f91d7d15d75667.html" target="blank" rel="noopener">more_clear_input_headers</a>.</li>
<li>doc: fixed <a href="/external_links/3342a90c0206a90d88f91d7d15d75667.html" target="blank" rel="noopener">more_clear_input_headers</a> usage examples. thanks Daniel Paniagua for the patch.</li>
</ul>
</li>
<li>upgraded <a href="/external_links/33192d0426b641426225ab4d2ab239ed.html" target="blank" rel="noopener">ngx_encrypted_session</a> to 0.07.<ul>
<li>bugfix: fixed one potential memory leak in an error condition. thanks dyu for the patch.</li>
</ul>
</li>
<li>upgraded <a href="/external_links/7f19fcea07bc9c879c5f15158170c8d8.html" target="blank" rel="noopener">ngx_rds_json</a> to 0.15.<ul>
<li>bugfix: fixed warnings with C compilers without variadic macro support.</li>
<li>doc: added context info for all the config directives.</li>
</ul>
</li>
<li>upgraded <a href="/external_links/af31545f35bb1dc862c92a016f4d45b6.html" target="blank" rel="noopener">ngx_rds_csv</a> to 0.08.<ul>
<li>tests: varous changes in the test suite.</li>
</ul>
</li>
<li>upgraded LuaJIT to v2.1-20171103: <a href="/external_links/c77e789bee595bb60c47bc345e8bb2a6.html" target="blank" rel="noopener">github.com/openresty/l&#x2026;</a><ul>
<li>optimize: use more appressive JIT compiler parameters as the default to help large OpenResty Lua apps. We now use the following jit.opt defaults: <code>maxtrace=8000 maxrecord=16000 minstitch=3 maxmcode=40960 -- in KB</code>.</li>
<li>imported Mike Pall&#x2019;s latest changes:<ul>
<li><code>LJ_GC64</code>: Make <code>ASMREF_L</code> references 64 bit.</li>
<li><code>LJ_GC64</code>: Fix ir_khash for non-string GCobj.</li>
<li>DynASM/x86: Fix potential <code>REL_A</code> overflow. Thanks to Joshua Haberman.</li>
<li>MIPS64: Hide internal function.</li>
<li>x64/<code>LJ_GC64</code>: Fix type-check-only variant of SLOAD. Thanks to Peter Cawley.</li>
<li>PPC: Add soft-float support to JIT compiler backend. Contributed by Djordje Kovacevic and Stefan Pejic from RT-RK.com. Sponsored by Cisco Systems, Inc.</li>
<li>x64/<code>LJ_GC64</code>: Fix fallback case of <code>asm_fuseloadk64()</code>. Contributed by Peter Cawley.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/1f395b2a5d295c1b3deeb773fa09323b.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903512443207688.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903512443207688.html" itemprop="url">AI 学习之路——轻松初探 Python 篇（三）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-20T10:16:19+08:00">
                2017-11-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x559C;&#x6B22;&#x5C0F;&#x4E4B;&#x7684;&#x6587;&#x7AE0;&#x7684;&#x53EF;&#x4EE5;&#x5173;&#x6CE8;&#x516C;&#x4F17;&#x53F7;&#x300C;WeaponZhi&#x300D;&#x6301;&#x7EED;&#x5173;&#x6CE8;&#x52A8;&#x6001;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/ccfaa49e56c6cd877763ea498db6e10ef3bb040651a1ce8f6774aedfae1dea08" alt></p>
<blockquote>
<p>&#x8FD9;&#x662F;&#x300C;AI &#x5B66;&#x4E60;&#x4E4B;&#x8DEF;&#x300D;&#x7684;&#x7B2C; 3 &#x7BC7;&#xFF0C;&#x300C;Python &#x5B66;&#x4E60;&#x300D;&#x7684;&#x7B2C; 3 &#x7BC7;</p>
</blockquote>
<p>Python &#x5B57;&#x7B26;&#x4E32;&#x4F7F;&#x7528;&#x548C; C &#x8BED;&#x8A00;&#x6BD4;&#x8F83;&#x7C7B;&#x4F3C;&#xFF0C;&#x4F46;&#x8FD8;&#x6709;&#x4E00;&#x4E9B;&#x6211;&#x4EEC;&#x503C;&#x5F97;&#x6CE8;&#x610F;&#x7684;&#x5730;&#x65B9;&#x9700;&#x8981;&#x5173;&#x6CE8;&#xFF0C;&#x7528;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x6765;&#x5E2E;&#x52A9;&#x5927;&#x5BB6;&#x638C;&#x63E1; Python &#x7684;&#x5B57;&#x7B26;&#x4E32;&#x5427;&#xFF01;</p>
<h2 id="&#x7F16;&#x7801;"><a href="#&#x7F16;&#x7801;" class="headerlink" title="&#x7F16;&#x7801;"></a>&#x7F16;&#x7801;</h2><p>&#x4E0D;&#x8BBA;&#x4EC0;&#x4E48;&#x8BED;&#x8A00;&#xFF0C;&#x6211;&#x4EEC;&#x90FD;&#x9700;&#x8981;&#x8003;&#x8651;&#x4E00;&#x4E0B;&#x8FD9;&#x4E2A;&#x8BED;&#x8A00;&#x7684;&#x7F16;&#x7801;&#x95EE;&#x9898;&#x3002;&#x300C;ASCII&#x300D;&#x7F16;&#x7801;&#x662F;&#x6211;&#x4EEC;&#x6700;&#x719F;&#x6089;&#x7684;&#x7F16;&#x7801;&#xFF0C;&#x4F46;&#x5B83;&#x53EA;&#x6709; 127 &#x4E2A;&#x5B57;&#x7B26;&#x88AB;&#x7F16;&#x7801;&#x5230;&#x8BA1;&#x7B97;&#x673A;&#x91CC;&#x9762;&#x4E86;&#xFF0C;&#x663E;&#x7136;&#xFF0C;&#x50CF;&#x4E2D;&#x65E5;&#x97E9;&#x8FD9;&#x7C7B;&#x56FD;&#x5BB6;&#xFF0C;&#x8BED;&#x8A00;&#x6587;&#x5B57;&#x6BD4;&#x8F83;&#x7279;&#x6B8A;&#xFF0C;&#x5C31;&#x9700;&#x8981;&#x81EA;&#x5DF1;&#x6765;&#x6307;&#x5B9A;&#x7F16;&#x7801;&#x683C;&#x5F0F;&#x3002;</p>
<p>&#x6BD4;&#x5982;&#xFF0C;&#x4E2D;&#x56FD;&#x81EA;&#x5DF1;&#x5C31;&#x5236;&#x5B9A;&#x4E86;&#x300C;GB2312&#x300D;&#x7F16;&#x7801;&#xFF0C;&#x97E9;&#x6587;&#x5219;&#x662F;&#x300C;EUC_KR&#x300D;&#xFF0C;&#x4FC4;&#x8BED;&#x662F;&#x300C;KOI8-R&#x300D;&#xFF0C;&#x663E;&#x7136;&#xFF0C;&#x5982;&#x679C;&#x6BCF;&#x4E00;&#x4E2A;&#x56FD;&#x5BB6;&#x90FD;&#x9700;&#x8981;&#x5236;&#x4F5C;&#x4E00;&#x4E2A;&#x9002;&#x914D;&#x7684;&#x7F16;&#x7801;&#xFF0C;&#x90A3;&#x6211;&#x4EEC;&#x7684;&#x8BA1;&#x7B97;&#x673A;&#x4E16;&#x754C;&#x5C31;&#x8981;&#x4E71;&#x5957;&#x4E86;&#xFF0C;&#x4E0D;&#x540C;&#x56FD;&#x5BB6;&#x4E4B;&#x95F4;&#x4FE1;&#x606F;&#x7684;&#x4F20;&#x8F93;&#x5C06;&#x53D8;&#x7684;&#x5BF8;&#x6B65;&#x96BE;&#x884C;&#x3002;&#x5982;&#x679C;&#x7535;&#x8111;&#x91CC;&#x6CA1;&#x6709;&#x67D0;&#x4E2A;&#x8BED;&#x8A00;&#x7684;&#x7F16;&#x7801;&#xFF0C;&#x90A3;&#x5C31;&#x4F1A;&#x4EA7;&#x751F;&#x4E71;&#x7801;&#x51B2;&#x7A81;&#xFF0C;&#x8FD9;&#x662F;&#x76F8;&#x5F53;&#x9EBB;&#x70E6;&#x7684;&#x3002;</p>
<p>&#x6240;&#x4EE5;&#xFF0C;&#x5927;&#x5BB6;&#x5546;&#x91CF;&#x4E86;&#x4E00;&#x4E0B;&#xFF0C;&#x5C31;&#x505A;&#x51FA;&#x4E86;&#x300C;Unicode&#x300D;&#x8FD9;&#x4E48;&#x4E2A;&#x7F16;&#x7801;&#x683C;&#x5F0F;&#xFF0C;&#x5B83;&#x5E72;&#x8106;&#x628A;&#x6240;&#x6709;&#x7684;&#x7F16;&#x7801;&#x90FD;&#x7EDF;&#x4E00;&#x4E86;&#xFF0C;&#x53EA;&#x8981;&#x4F60;&#x7528; Unicode &#x5B83;&#x5C31;&#x80FD;&#x4FDD;&#x8BC1;&#x6CA1;&#x6709;&#x4E71;&#x7801;&#x95EE;&#x9898;&#x3002;</p>
<p>&#x4F46; Unicode &#x4E5F;&#x6709;&#x7F3A;&#x70B9;&#x3002;&#x6BD4;&#x5982;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x662F;&#x7EAF;&#x82F1;&#x6587;&#x6765;&#x5199;&#x7684;&#xFF0C;&#x90A3;&#x6240;&#x6709;&#x7684;&#x5B57;&#x7B26;&#x5B9E;&#x9645;&#x4E0A;&#x90FD;&#x53EF;&#x4EE5;&#x7528;&#x8FC7; ASCII &#x7684; 8 &#x4F4D;&#x4E8C;&#x8FDB;&#x5236;&#x6765;&#x8868;&#x793A;&#x3002;&#x6211;&#x4EEC;&#x77E5;&#x9053; Unicode &#x662F;&#x901A;&#x8FC7;&#x8865; 0 &#x6765;&#x8868;&#x793A;&#x4E00;&#x4E9B;&#x4F4E;&#x4F4D;&#x6570;&#x7684;&#x5B57;&#x7B26;&#x7684;&#xFF0C;&#x8FD9;&#x6837;&#xFF0C;&#x4E3A;&#x4E86;&#x4FDD;&#x6301;&#x517C;&#x5BB9;&#x6027;&#xFF0C;&#x4F60;&#x5B9E;&#x9645;&#x4E0A;&#x767D;&#x767D;&#x6D6A;&#x8D39;&#x4E86;&#x4E24;&#x500D;&#x7684;&#x7A7A;&#x95F4;&#x3002;</p>
<p>UTF-8 &#x5C31;&#x662F;&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#x800C;&#x51FA;&#x73B0;&#x7684;&#x3002;&#x5B83;&#x662F;&#x4E00;&#x4E2A;**&#x300C;&#x53EF;&#x53D8;&#x957F;&#x7F16;&#x7801;&#x300D;**&#xFF0C;&#x4F60;&#x4E0D;&#x662F;&#x5ACC;&#x7A7A;&#x95F4;&#x6D6A;&#x8D39;&#x5417;&#xFF0C;&#x90A3;&#x4E48;&#x73B0;&#x5728;&#x53EA;&#x8981;&#x4F60;&#x7528;&#x4E86; UTF-8&#xFF0C;&#x4ECE;&#x6B64;&#x4EE5;&#x540E;&#x82F1;&#x6587;&#x5B57;&#x6BCD;&#x54B1;&#x5C31;&#x53EF;&#x4EE5;&#x7528; 1 &#x4E2A;&#x5B57;&#x8282;&#x6765;&#x5B58;&#x50A8;&#x4E86;&#xFF0C;&#x5982;&#x679C;&#x9047;&#x5230;&#x50CF;&#x4E2D;&#x6587;&#x8FD9;&#x79CD;&#x300C;&#x9AD8;&#x5927;&#x4E0A;&#x300D;&#x4F46;&#x53C8;&#x6BD4;&#x8F83;&#x590D;&#x6742;&#x7684;&#x5B57;&#x4F53;&#xFF0C;&#x6211;&#x4EEC;&#x7075;&#x6D3B;&#x5BF9;&#x5F85;&#xFF0C;&#x7528;&#x4E09;&#x4E2A;&#x5B57;&#x8282;&#x6765;&#x8868;&#x793A;&#xFF0C;&#x5B9E;&#x5728;&#x6709;&#x67D0;&#x4E9B;&#x66F4;&#x52A0;&#x53D8;&#x6001;&#x800C;&#x590D;&#x6742;&#x7684;&#x5B57;&#x4F53;&#xFF0C;&#x90A3;&#x6700;&#x591A;&#x53EF;&#x4EE5;&#x62D3;&#x5C55;&#x5230;&#x7528; 6 &#x4E2A;&#x5B57;&#x8282;&#x6765;&#x5B58;&#x50A8;&#x3002;&#x603B;&#x4E4B;&#xFF0C;&#x8FD9;&#x6837;&#x4E0B;&#x53BB;&#xFF0C;&#x65E2;&#x89E3;&#x51B3;&#x4E86;&#x517C;&#x5BB9;&#x6027;&#x95EE;&#x9898;&#xFF0C;&#x53C8;&#x53EF;&#x4EE5;&#x8282;&#x7EA6;&#x8D44;&#x6E90;&#xFF0C;&#x8D44;&#x6E90;&#x95EE;&#x9898;&#x8FCE;&#x5203;&#x800C;&#x89E3;&#x4E86;&#x3002;</p>
<p>Python &#x4E2D;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x662F;&#x7528; Unicode &#x7F16;&#x7801;&#x7684;&#xFF0C;&#x6240;&#x4EE5; Python &#x53EF;&#x4EE5;&#x652F;&#x6301;&#x591A;&#x8BED;&#x8A00;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x4FDD;&#x5B58;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x628A; Unicode &#x8F6C;&#x6362;&#x4E3A; UTF-8&#xFF0C;&#x4F7F;&#x7528;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x518D;&#x4ECE;&#x6587;&#x4EF6;&#x4E2D;&#x8F6C;&#x6362; UTF-8 &#x5230; Unicode &#x5230;&#x5185;&#x5B58;&#x4E2D;&#x3002;</p>
<p><strong>&#x901A;&#x8FC7;&#x7F16;&#x7801;&#x7684;&#x8FD9;&#x79CD;&#x6F14;&#x8FDB;&#x8FC7;&#x7A0B;&#xFF0C;&#x6211;&#x4EEC;&#x662F;&#x4E0D;&#x662F;&#x4F1A;&#x6709;&#x6240;&#x542F;&#x53D1;&#x5462;&#xFF1F;</strong></p>
<p>**&#x4F60;&#x4F1A;&#x53D1;&#x73B0;&#xFF0C;&#x4E00;&#x5207;&#x6280;&#x672F;&#x7684;&#x4EA7;&#x751F;&#x548C;&#x53D1;&#x5C55;&#xFF0C;&#x90FD;&#x662F;&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x95EE;&#x9898;&#x800C;&#x51FA;&#x73B0;&#x7684;&#x3002;**&#x5927;&#x5BB6;&#x5982;&#x679C;&#x7EC6;&#x7EC6;&#x7684;&#x601D;&#x8003;&#x4E00;&#x4E0B;&#xFF0C;&#x4E0D;&#x8BBA;&#x662F;&#x8BED;&#x8A00;&#x3001;&#x6280;&#x672F;&#x3001;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#x3001;&#x67B6;&#x6784;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x4ED6;&#x4EEC;&#x7684;&#x53D1;&#x5C55;&#x8FC7;&#x7A0B;&#x5E76;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x51ED;&#x7A7A;&#x7684;&#x6280;&#x672F;&#x5347;&#x7EA7;&#x884C;&#x4E3A;&#xFF0C;&#x800C;&#x662F;&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x67D0;&#x79CD;&#x95EE;&#x9898;&#x800C;&#x8BDE;&#x751F;&#x7684;&#x3002;</p>
<p>&#x300C;GB2312&#x300D;&#x662F;&#x4E3A;&#x4E86;&#x89E3;&#x51B3; ASCII &#x6CA1;&#x6709;&#x4E2D;&#x6587;&#x800C;&#x624D;&#x521B;&#x9020;&#x51FA;&#x6765;&#x7684;&#xFF0C;&#x300C;Unicode&#x300D;&#x662F;&#x56E0;&#x4E3A;&#x5404;&#x56FD;&#x8BED;&#x8A00;&#x4E0D;&#x517C;&#x5BB9;&#x800C;&#x521B;&#x9020;&#x51FA;&#x6765;&#x7684;&#x3002;&#x800C; Unicode &#x5BF9;&#x4E8E;&#x8D44;&#x6E90;&#x7684;&#x6D6A;&#x8D39;&#x53C8;&#x4FC3;&#x6210;&#x4E86; UTF-8 &#x7684;&#x4EA7;&#x751F;&#x3002;&#x6700;&#x5178;&#x578B;&#x7684;&#x95EE;&#x9898;&#x9A71;&#x52A8;&#x6280;&#x672F;&#xFF0C;&#x5C31;&#x662F;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#x4E86;&#xFF0C;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#x7684;&#x4EA7;&#x751F;&#x5B9E;&#x9645;&#x4E0A;&#x5C31;&#x662F;&#x5404;&#x79CD;&#x4E3A;&#x89E3;&#x51B3;&#x67D0;&#x4E9B;&#x7279;&#x5B9A;&#x95EE;&#x9898;&#x800C;&#x603B;&#x7ED3;&#x51FA;&#x6765;&#x7684;&#x65B9;&#x6848;&#x3002;</p>
<p>&#x6240;&#x4EE5;&#x5728;&#x6280;&#x672F;&#x4E0A;&#xFF0C;&#x9047;&#x5230;&#x95EE;&#x9898;&#x5E76;&#x4E0D;&#x53EF;&#x6015;&#xFF0C;<strong>&#x95EE;&#x9898;&#x6070;&#x6070;&#x662F;&#x6700;&#x80FD;&#x5E2E;&#x52A9;&#x81EA;&#x5DF1;&#x63D0;&#x5347;&#x7684;&#xFF0C;&#x95EE;&#x9898;&#x662F;&#x521B;&#x9020;&#x529B;&#x7684;&#x6E90;&#x5934;&#x4E4B;&#x4E00;</strong>&#x3002;&#x6211;&#x4EEC;&#x540C;&#x65F6;&#x5728;&#x5E73;&#x65F6;&#x770B;&#x4E66;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E5F;&#x8981;&#x62B1;&#x7740;&#x89E3;&#x51B3;&#x95EE;&#x9898;&#x7684;&#x89D2;&#x5EA6;&#x6765;&#x5B66;&#x4E60;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x5355;&#x7EAF;&#x7684;&#x53BB;&#x8BFB;&#x4E00;&#x672C;&#x6280;&#x672F;&#x4E66;&#xFF0C;&#x8FD9;&#x672C;&#x4E66;&#x53C8;&#x53EA;&#x6709;&#x7406;&#x8BBA;&#x548C;&#x4EE3;&#x7801;&#xFF0C;&#x4F60;&#x4F1A;&#x89C9;&#x5F97;&#x5F88;&#x67AF;&#x71E5;&#x3002;&#x5982;&#x679C;&#x4E66;&#x91CC;&#x53EF;&#x4EE5;&#x7ED3;&#x5408;&#x4E00;&#x4E9B;&#x6848;&#x4F8B;&#x548C;&#x95EE;&#x9898;&#xFF0C;&#x4ECE;&#x8FD9;&#x91CC;&#x5C55;&#x5F00;&#x8BB2;&#x89E3;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x4ECB;&#x7ECD;&#x4E00;&#x4E9B;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x548C;&#x4EE3;&#x7801;&#xFF0C;&#x8FD9;&#x79CD;&#x6559;&#x5B66;&#x65B9;&#x5F0F;&#x6548;&#x679C;&#x5C31;&#x4F1A;&#x7279;&#x522B;&#x597D;&#x3002;&#x6BD4;&#x5982;&#x6211;&#x4E4B;&#x524D;&#x770B;&#x8FC7;&#x7684;&#x4E00;&#x672C;&#x4E66;&#x300C;Android &#x6E90;&#x7801;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#x300D;&#xFF0C;&#x5B83;&#x5C31;&#x662F;&#x7528;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x6765;&#x8FDB;&#x884C;&#x5C55;&#x5F00;&#x7684;&#x8BF4;&#x660E;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#x7684;&#x573A;&#x666F;&#xFF0C;&#x770B;&#x5B8C;&#x4E86;&#x8FD9;&#x672C;&#x4E66;&#x540E;&#xFF0C;&#x4EE5;&#x540E;&#x9762;&#x5BF9;&#x67D0;&#x79CD;&#x573A;&#x666F;&#xFF0C;&#x6211;&#x5C31;&#x7279;&#x522B;&#x5BB9;&#x6613;&#x56DE;&#x60F3;&#x8D77;&#x4E4B;&#x524D;&#x4E66;&#x4E2D;&#x5199;&#x8FC7;&#x7684;&#x4E00;&#x4E9B;&#x573A;&#x666F;&#xFF0C;&#x4ECE;&#x800C;&#x4EA7;&#x751F;&#x8BB0;&#x5FC6;&#x8054;&#x60F3;&#x3002;</p>
<p>&#x4E0D;&#x4EC5;&#x5982;&#x6B64;&#xFF0C;&#x5982;&#x679C;&#x60F3;&#x7684;&#x518D;&#x6DF1;&#x4E00;&#x70B9;&#xFF0C;&#x4F60;&#x5C31;&#x4F1A;&#x7A81;&#x7136;&#x9192;&#x609F;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x4EBA;&#x7C7B;&#x793E;&#x4F1A;&#x597D;&#x50CF;&#x4E5F;&#x662F;&#x4EE5;&#x8FD9;&#x79CD;&#x5F62;&#x5F0F;&#x6765;&#x53D1;&#x5C55;&#x7684;&#x2026;</p>
<p>&#x662F;&#x4E0D;&#x662F;&#x6709;&#x70B9;&#x626F;&#x8FDC;&#x4E86;&#xFF1F;&#x6211;&#x4EEC;&#x8FD8;&#x662F;&#x6765;&#x770B;&#x770B;&#x5B57;&#x7B26;&#x4E32;&#x5427;&#x3002;</p>
<h2 id="&#x5B57;&#x7B26;&#x4E32;"><a href="#&#x5B57;&#x7B26;&#x4E32;" class="headerlink" title="&#x5B57;&#x7B26;&#x4E32;"></a>&#x5B57;&#x7B26;&#x4E32;</h2><p>Python &#x7684;&#x5B57;&#x7B26;&#x4E32;&#x548C; C &#x8BED;&#x8A00;&#x6709;&#x4E9B;&#x7C7B;&#x4F3C;&#x3002;&#x6211;&#x4EEC;&#x7B80;&#x5355;&#x7684;&#x628A;&#x5E38;&#x7528;&#x7684;&#x7528;&#x6CD5;&#x4ECB;&#x7ECD;&#x4E00;&#x4E0B;&#x5373;&#x53EF;&#xFF0C;&#x5E73;&#x65F6;&#x53EA;&#x8981;&#x591A;&#x5199;&#x51E0;&#x6B21;&#xFF0C;&#x5C31;&#x80FD;&#x6BD4;&#x8F83;&#x719F;&#x7EC3;&#x7684;&#x638C;&#x63E1;&#x4E86;(&#x6B64;&#x8282;&#x5F15;&#x7528;&#x5ED6;&#x96EA;&#x5CF0;&#x6559;&#x7A0B;&#x793A;&#x4F8B;&#xFF0C;&#x4F5C;&#x4E86;&#x7B80;&#x5316;)&#x3002;</p>
<h3 id="ord-&#x548C;-chr"><a href="#ord-&#x548C;-chr" class="headerlink" title="ord() &#x548C; chr()"></a>ord() &#x548C; chr()</h3><p>&#x4F7F;&#x7528; ord() &#x83B7;&#x53D6;&#x5B57;&#x7B26;&#x7684;&#x6574;&#x6570;&#x8868;&#x793A;&#xFF0C;chr() &#x5219;&#x662F;&#x628A;&#x7F16;&#x7801;&#x8F6C;&#x5316;&#x4E3A;&#x5B57;&#x7B26;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&gt;&gt;&gt; ord(&apos;A&apos;)</span><br><span class="line">65</span><br><span class="line">&gt;&gt;&gt; ord(&apos;&#x4E2D;&apos;)</span><br><span class="line">20013</span><br><span class="line">&gt;&gt;&gt; chr(66)</span><br><span class="line">&apos;B&apos;</span><br><span class="line">&gt;&gt;&gt; chr(25991)</span><br><span class="line">&apos;&#x6587;&apos;</span><br></pre></td></tr></table></figure>

<h3 id="bytes"><a href="#bytes" class="headerlink" title="bytes"></a>bytes</h3><p>&#x7528;&#x5E26;&#x300C;b&#x300D;&#x524D;&#x7F00;&#x7684;&#x5355;&#x5F15;&#x53F7;&#x6216;&#x8005;&#x53CC;&#x5F15;&#x53F7;&#x5B57;&#x7B26;&#x6765;&#x8868;&#x793A;&#x300C;bytes&#x300D;&#x7C7B;&#x578B;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x975E;&#x5E38;&#x65B9;&#x4FBF;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;x = b&apos;ABC&apos;</span><br><span class="line">encode() &#x548C; decode()</span><br></pre></td></tr></table></figure>

<p>&#x5F00;&#x53D1;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x7ECF;&#x5E38;&#x8981;&#x628A; str &#x548C; bytes &#x8FDB;&#x884C;&#x76F8;&#x4E92;&#x8F6C;&#x6362;, str &#x901A;&#x8FC7; encode() &#x8F6C;&#x5316;&#x4E3A; bytes&#xFF0C;bytes &#x901A;&#x8FC7; decode() &#x8F6C;&#x5316;&#x4E3A; str</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&gt;&gt;&gt; &apos;ABC&apos;.encode(&apos;ascii&apos;)</span><br><span class="line">b&apos;ABC&apos;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; &apos;&#x4E2D;&#x6587;&apos;.encode(&apos;utf-8&apos;)</span><br><span class="line">b&apos;\xe4\xb8\xad\xe6\x96\x87&apos;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; &apos;&#x4E2D;&#x6587;&apos;.encode(&apos;ascii&apos;)</span><br><span class="line">Trace back (most recent call last):</span><br><span class="line">    File &quot;&lt;stdin&gt;&quot;, line 1, in&lt;module&gt;</span><br><span class="line">UnicodeEncodeError</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; b&apos;ABC&apos;.decode(&apos;ascii&apos;)</span><br><span class="line">&apos;ABC&apos;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; b&apos;\xe4\xb8\xad\xe6\x96\x87&apos;</span><br><span class="line">&apos;&#x4E2D;&#x6587;&apos;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; b&apos;\xe4\xb8\xad\xff&apos;.decode(&apos;utf-8&apos;)</span><br><span class="line">Tradeback(most recent call last):</span><br><span class="line">    ...</span><br><span class="line">UnicodeDecodeError</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x91CC;&#x8981;&#x6CE8;&#x610F;&#x5BB9;&#x9519;&#xFF0C;encode &#x4E0D;&#x80FD;&#x8F6C;&#x5316;&#x8D85;&#x8FC7;&#x53C2;&#x6570;&#x7F16;&#x7801;&#x8303;&#x56F4;&#x7684;&#x5B57;&#x7B26;&#xFF0C;&#x800C;&#x5982;&#x679C; bytes &#x4E2D;&#x5305;&#x542B;&#x7F16;&#x7801;&#x683C;&#x5F0F;&#x65E0;&#x6CD5;&#x89E3;&#x6790;&#x7684;&#x5B57;&#x7B26;&#xFF0C;decode() &#x4E5F;&#x4F1A;&#x62A5;&#x9519;&#x3002;</p>
<h3 id="len"><a href="#len" class="headerlink" title="len()"></a>len()</h3><p>&#x901A;&#x8FC7; len &#x8BA1;&#x7B97;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x5B57;&#x7B26;&#x6570;&#x6216;&#x8005; bytes &#x7684;&#x5B57;&#x8282;&#x6570;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&gt;&gt;&gt; len(&apos;ABC&apos;)</span><br><span class="line">3</span><br><span class="line">&gt;&gt;&gt; len(&apos;&#x4E2D;&#x6587;&apos;)</span><br><span class="line">2</span><br><span class="line">&gt;&gt;&gt; len(b&apos;ABC&apos;)</span><br><span class="line">3</span><br><span class="line">&gt;&gt;&gt; len(b&apos;\xe4\xb8\xad\xe6\x87&apos;)</span><br><span class="line">6</span><br><span class="line">&gt;&gt;&gt; len(&apos;&#x4E2D;&#x6587;&apos;.encode(&apos;utf-8&apos;))</span><br><span class="line">6</span><br></pre></td></tr></table></figure>

<p>&#x4ECE;&#x8F93;&#x51FA;&#x7ED3;&#x679C;&#x53D1;&#x73B0;&#xFF0C;&#x4E2D;&#x6587;&#x5360; 3 &#x4E2A;&#x5B57;&#x8282;&#xFF0C;&#x82F1;&#x6587;&#x5360; 1 &#x4E2A;&#x5B57;&#x8282;</p>
<h3 id="&#x58F0;&#x660E;&#x7F16;&#x7801;&#x683C;&#x5F0F;"><a href="#&#x58F0;&#x660E;&#x7F16;&#x7801;&#x683C;&#x5F0F;" class="headerlink" title="&#x58F0;&#x660E;&#x7F16;&#x7801;&#x683C;&#x5F0F;"></a>&#x58F0;&#x660E;&#x7F16;&#x7801;&#x683C;&#x5F0F;</h3><p>&#x5982;&#x679C;&#x5E0C;&#x671B; Python &#x89E3;&#x91CA;&#x5668;&#x53EF;&#x4EE5;&#x6309; UTF-8 &#x7F16;&#x7801;&#x6765;&#x8BFB;&#x53D6; .py &#x6587;&#x4EF6;&#xFF0C;&#x9700;&#x8981;&#x5728;&#x6587;&#x4EF6;&#x4E2D;&#x58F0;&#x660E;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;#1 /usr/bin/env python3</span><br><span class="line"># -*- coding: utf-8 -*-</span><br></pre></td></tr></table></figure>

<p>&#x7B2C;&#x4E00;&#x884C;&#x53EA;&#x5BF9; Linux/OS X &#x6709;&#x6548;&#xFF0C;&#x5B83;&#x544A;&#x8BC9;&#x7CFB;&#x7EDF;&#x8FD9;&#x662F;&#x4E00;&#x4E2A; Python &#x53EF;&#x6267;&#x884C;&#x7A0B;&#x5E8F;&#x3002;&#x7B2C;&#x4E8C;&#x884C;&#x5219;&#x544A;&#x8BC9; Python &#x89E3;&#x91CA;&#x5668;&#xFF0C;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x8981;&#x6309;&#x7167; UTF-8 &#x7F16;&#x7801;&#x3002;&#x5982;&#x679C;&#x4E0D;&#x8FD9;&#x6837;&#x5199;&#xFF0C;&#x4E2D;&#x6587;&#x8F93;&#x51FA;&#x4F1A;&#x6709;&#x4E71;&#x7801;&#x3002;</p>
<p>&#x5B57;&#x7B26;&#x4E32;&#x683C;&#x5F0F;&#x5316;</p>
<p>&#x683C;&#x5F0F;&#x5316;&#x548C; C &#x6709;&#x70B9;&#x50CF;&#xFF0C;&#x7528;&#x300C;%&#x300D;&#x5B9E;&#x73B0;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&gt;&gt;&gt; &apos;Hello,%s&apos; % &apos;world&apos;</span><br><span class="line">&apos;Hello , world&apos;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; &apos;&#x4F60;&#x597D;%s&#xFF0C;&#x4F60;&#x6709; &#xFFE5;%d &#x5417;&apos; % (&apos;&#x5C0F;&#x4E4B;&apos;,50)</span><br><span class="line">&apos;&#x4F60;&#x597D;&#x5C0F;&#x4E4B;&#xFF0C;&#x4F60;&#x6709; &#xFFE5;50 &#x5417;&apos;</span><br></pre></td></tr></table></figure>

<p>&#x5360;&#x4F4D;&#x7B26;&#x4E2D;&#xFF0C;%d &#x4EE3;&#x8868;&#x6574;&#x6570;&#xFF0C;%f &#x4EE3;&#x8868;&#x6D6E;&#x70B9;&#x6570;&#xFF0C;%s &#x4EE3;&#x8868;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;%x &#x4EE3;&#x8868;&#x5341;&#x516D;&#x8FDB;&#x5236;&#x6574;&#x6570;&#xFF0C;&#x5360;&#x4F4D;&#x7B26;&#x8981;&#x548C; % &#x53F7;&#x540E;&#x9762;&#x7684;&#x53D8;&#x91CF;&#x6216;&#x8005;&#x503C;&#x4E00;&#x4E00;&#x5BF9;&#x5E94;&#xFF0C;&#x5982;&#x679C;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x5360;&#x4F4D;&#x7B26;&#xFF0C;% &#x53F7;&#x540E;&#x4E0D;&#x9700;&#x8981;&#x62EC;&#x53F7;&#x3002;</p>
<p>&#x5360;&#x4F4D;&#x7B26;&#x8FD8;&#x53EF;&#x4EE5;&#x63A7;&#x5236;&#x7A7A;&#x683C;&#x3001;&#x5C0F;&#x6570;&#x70B9;&#x548C;&#x8865; 0 &#x7684;&#x4F4D;&#x6570;&#x3002;&#x6BD4;&#x5982;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&gt;&gt;&gt; print(&apos;%2d-%02d&apos; % (5,1))</span><br><span class="line">  5-01</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; print(&apos;%.2f&apos; % 3.1415)</span><br><span class="line">3.14</span><br></pre></td></tr></table></figure>

<p>&#x6CE8;&#x610F;&#xFF0C;&#x300C;5-01&#x300D;&#x4E2D;&#xFF0C;5 &#x7684;&#x524D;&#x9762;&#x662F;&#x6709;&#x4E24;&#x4E2A;&#x7A7A;&#x683C;&#x7684;&#x3002;</p>
<p>&#x5982;&#x679C;&#x4F60;&#x9700;&#x8981;&#x4F7F;&#x7528; % &#x8FD9;&#x4E2A;&#x5B57;&#x7B26;&#x663E;&#x793A;&#x5728;&#x5B57;&#x7B26;&#x4E32;&#x4E2D;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x9700;&#x8981;&#x8F6C;&#x4E49;&#x4E86;&#xFF0C;%% &#x8868;&#x793A;&#x4E00;&#x4E2A; %</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&gt;&gt;&gt; &apos;&#x5C0F;&#x4E4B;&#x516C;&#x4F17;&#x53F7;&#x7684;&#x70B9;&#x8D5E;&#x7387;&#x7ADF;&#x7136;&#x8D85;&#x8FC7;&#x4E86; %d%%&apos; % 50</span><br><span class="line">&apos;&#x5C0F;&#x4E4B;&#x516C;&#x4F17;&#x53F7;&#x7684;&#x70B9;&#x8D5E;&#x7387;&#x7ADF;&#x7136;&#x8D85;&#x8FC7;&#x4E86; 50%&apos;</span><br></pre></td></tr></table></figure>

<hr>
<p><strong>&#x6B22;&#x8FCE;&#x5173;&#x6CE8;&#x6211;&#x7684;&#x516C;&#x4F17;&#x53F7;</strong></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/73169e8463cb820fad64395bd8037b34f2d8bb52d7647c1a0cf60f600af4e91e" alt></p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/82706b48c3c64614cdb54dfa406ceb2f.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903512413831182.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903512413831182.html" itemprop="url">JDK不同操作系统的FileSystem（Windows）中</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-20T08:35:30+08:00">
                2017-11-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="&#x524D;&#x8A00;"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00;</h2><p>&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x4E0D;&#x540C;&#x7684;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x6709;&#x5404;&#x81EA;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF0C;&#x8FD9;&#x4E9B;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x53C8;&#x5B58;&#x5728;&#x5F88;&#x591A;&#x5DEE;&#x5F02;&#xFF0C;&#x800C;Java &#x56E0;&#x4E3A;&#x662F;&#x8DE8;&#x5E73;&#x53F0;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x5FC5;&#x987B;&#x8981;&#x7EDF;&#x4E00;&#x5904;&#x7406;&#x8FD9;&#x4E9B;&#x4E0D;&#x540C;&#x5E73;&#x53F0;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x4E4B;&#x95F4;&#x7684;&#x5DEE;&#x5F02;&#xFF0C;&#x624D;&#x80FD;&#x5F80;&#x4E0A;&#x63D0;&#x4F9B;&#x7EDF;&#x4E00;&#x7684;&#x5165;&#x53E3;&#x3002;</p>
<h2 id="&#x5173;&#x4E8E;FileSystem&#x7C7B;"><a href="#&#x5173;&#x4E8E;FileSystem&#x7C7B;" class="headerlink" title="&#x5173;&#x4E8E;FileSystem&#x7C7B;"></a>&#x5173;&#x4E8E;FileSystem&#x7C7B;</h2><p>JDK &#x91CC;&#x9762;&#x62BD;&#x8C61;&#x51FA;&#x4E86;&#x4E00;&#x4E2A; FileSystem &#x6765;&#x8868;&#x793A;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF0C;&#x4E0D;&#x540C;&#x7684;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x901A;&#x8FC7;&#x7EE7;&#x627F;&#x8BE5;&#x7C7B;&#x5B9E;&#x73B0;&#x5404;&#x81EA;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF0C;&#x6BD4;&#x5982; Windows NT/2000 &#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5219;&#x4E3A; WinNTFileSystem&#xFF0C;&#x800C; unix-like &#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x4E3A; UnixFileSystem&#x3002;</p>
<p>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x4E00;&#x70B9;&#x662F;&#xFF0C;WinNTFileSystem&#x7C7B; &#x548C; UnixFileSystem&#x7C7B;&#x5E76;&#x4E0D;&#x662F;&#x5728;&#x540C;&#x4E00;&#x4E2A; JDK &#x91CC;&#x9762;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x5B83;&#x4EEC;&#x662F;&#x5206;&#x5F00;&#x7684;&#xFF0C;&#x4F60;&#x53EA;&#x80FD;&#x5728; Windows &#x7248;&#x672C;&#x7684; JDK &#x4E2D;&#x627E;&#x5230; WinNTFileSystem&#xFF0C;&#x800C;&#x5728; Linux &#x7248;&#x672C;&#x7684; JDK &#x4E2D;&#x627E;&#x5230; UnixFileSystem&#xFF0C;&#x540C;&#x6837;&#x5730;&#xFF0C;&#x5176;&#x4ED6;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x4E5F;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x5B9E;&#x73B0;&#x7C7B;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x5206;&#x6210;&#x4E24;&#x4E2A;&#x7CFB;&#x5217;&#x5206;&#x6790; JDK &#x5BF9;&#x4E24;&#x79CD;&#xFF08;Windows &#x548C;Linux&#xFF09;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x7684;&#x5B9E;&#x73B0;&#x7C7B;&#xFF0C;&#x5148;&#x8BB2; Windows&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#xFF0C;&#x5BF9;&#x5E94;&#x4E3A; WinNTFileSystem &#x7C7B;&#x3002; &#x7531;&#x4E8E;&#x7BC7;&#x5E45;&#x8F83;&#x957F;&#xFF0C;&#x300A;JDK&#x4E0D;&#x540C;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;FileSystem&#xFF08;Windows&#xFF09;&#x300B;&#x5206;&#x4E3A;&#x4E0A;&#x4E2D;&#x4E0B;&#x7BC7;&#xFF0C;&#x6B64;&#x4E3A;&#x4E2D;&#x7BC7;&#x3002;</p>
<h2 id="&#x7EE7;&#x627F;&#x7ED3;&#x6784;"><a href="#&#x7EE7;&#x627F;&#x7ED3;&#x6784;" class="headerlink" title="&#x7EE7;&#x627F;&#x7ED3;&#x6784;"></a>&#x7EE7;&#x627F;&#x7ED3;&#x6784;</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;--java.lang.Object</span><br><span class="line">  --java.io.FileSystem</span><br><span class="line">    --java.io.WinNTFileSystem</span><br></pre></td></tr></table></figure>

<h3 id="getDefaultParent&#x65B9;&#x6CD5;"><a href="#getDefaultParent&#x65B9;&#x6CD5;" class="headerlink" title="getDefaultParent&#x65B9;&#x6CD5;"></a>getDefaultParent&#x65B9;&#x6CD5;</h3><p>&#x8FD4;&#x56DE;&#x9ED8;&#x8BA4;&#x7684;&#x7236;&#x8DEF;&#x5F84;&#xFF0C;&#x76F4;&#x63A5;&#x8FD4;&#x56DE; slash &#x5373;<code>\</code>&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public String getDefaultParent() {</span><br><span class="line">        return (&quot;&quot; + slash);</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<h3 id="fromURIPath&#x65B9;&#x6CD5;"><a href="#fromURIPath&#x65B9;&#x6CD5;" class="headerlink" title="fromURIPath&#x65B9;&#x6CD5;"></a>fromURIPath&#x65B9;&#x6CD5;</h3><p>&#x8BE5;&#x65B9;&#x6CD5;&#x4E3B;&#x8981;&#x662F;&#x683C;&#x5F0F;&#x5316;&#x8DEF;&#x5F84;&#x3002;&#x4E3B;&#x8981;&#x903B;&#x8F91;&#x662F;&#x5B8C;&#x6210;&#x7C7B;&#x4F3C;&#x4EE5;&#x4E0B;&#x7684;&#x8F6C;&#x6362;&#x5904;&#x7406;&#xFF1A;</p>
<ol>
<li><code>/c:/test</code> &#x2013;&gt; <code>c:/test</code>&#x3002;</li>
<li><code>c:/test/</code> &#x2013;&gt; <code>c:/test</code>&#xFF0C;&#x4F46;&#x8981;&#x6CE8;&#x610F;&#xFF0C;<code>c:/</code> &#x2013;&gt; <code>c:/</code>&#xFF0C;&#x8FD9;&#x662F;&#x901A;&#x8FC7;&#x957F;&#x5EA6;&#x6765;&#x9650;&#x5236;&#x7684;&#xFF0C;&#x5373;&#x5F53;&#x957F;&#x5EA6;&#x8D85;&#x8FC7;3&#x65F6;&#x624D;&#x4F1A;&#x53BB;&#x6389;&#x5C3E;&#x90E8;&#x7684; <code>/</code>&#x3002;</li>
<li><code>/test/</code> &#x2013;&gt; <code>/test</code>&#x3002;</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public String fromURIPath(String path) {</span><br><span class="line">        String p = path;</span><br><span class="line">        if ((p.length() &gt; 2) &amp;&amp; (p.charAt(2) == &apos;:&apos;)) {</span><br><span class="line">            p = p.substring(1);</span><br><span class="line">            if ((p.length() &gt; 3) &amp;&amp; p.endsWith(&quot;/&quot;))</span><br><span class="line">                p = p.substring(0, p.length() - 1);</span><br><span class="line">        } else if ((p.length() &gt; 1) &amp;&amp; p.endsWith(&quot;/&quot;)) {</span><br><span class="line">            p = p.substring(0, p.length() - 1);</span><br><span class="line">        }</span><br><span class="line">        return p;</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<h3 id="isAbsolute&#x65B9;&#x6CD5;"><a href="#isAbsolute&#x65B9;&#x6CD5;" class="headerlink" title="isAbsolute&#x65B9;&#x6CD5;"></a>isAbsolute&#x65B9;&#x6CD5;</h3><p>&#x5224;&#x65AD;&#x6587;&#x4EF6;&#x662F;&#x5426;&#x662F;&#x7EDD;&#x5BF9;&#x8DEF;&#x5F84;&#xFF0C;&#x5148;&#x83B7;&#x53D6;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x5934;&#x90E8;&#x957F;&#x5EA6;&#xFF0C;&#x5982;&#x679C;&#x957F;&#x5EA6;&#x4E3A;3&#x5219;&#x4E3A;&#x7EDD;&#x5BF9;&#x8DEF;&#x5F84;&#xFF0C;&#x5982;&#x679C;&#x957F;&#x5EA6;&#x4E3A;2&#x4E14;&#x8DEF;&#x5F84;&#x7B2C;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E3A;<code>\</code>&#x4E5F;&#x4E3A;&#x7EDD;&#x5BF9;&#x8DEF;&#x5F84;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;    public boolean isAbsolute(File f) {</span><br><span class="line">        int pl = f.getPrefixLength();</span><br><span class="line">        return (((pl == 2) &amp;&amp; (f.getPath().charAt(0) == slash))</span><br><span class="line">                || (pl == 3));</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<h3 id="canonicalize&#x65B9;&#x6CD5;"><a href="#canonicalize&#x65B9;&#x6CD5;" class="headerlink" title="canonicalize&#x65B9;&#x6CD5;"></a>canonicalize&#x65B9;&#x6CD5;</h3><p>&#x8BE5;&#x65B9;&#x6CD5;&#x7528;&#x6765;&#x6807;&#x51C6;&#x5316;&#x4E00;&#x4E2A;&#x8DEF;&#x5F84;&#xFF0C;&#x6807;&#x51C6;&#x8DEF;&#x5F84;&#x4E0D;&#x4EC5;&#x662F;&#x4E00;&#x4E2A;&#x7EDD;&#x5BF9;&#x8DEF;&#x5F84;&#x800C;&#x4E14;&#x8FD8;&#x662F;&#x552F;&#x4E00;&#x7684;&#x8DEF;&#x5F84;&#xFF0C;&#x800C;&#x4E14;&#x6807;&#x51C6;&#x7684;&#x5B9A;&#x4E49;&#x662F;&#x4F9D;&#x8D56;&#x4E8E;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;&#xFF0C;&#x4E00;&#x822C;&#x5728;&#x6807;&#x51C6;&#x5316;&#x8DEF;&#x5F84;&#x65F6;&#x4F1A;&#x5148;&#x5C06;&#x8DEF;&#x5F84;&#x8F6C;&#x6210;&#x7EDD;&#x5BF9;&#x8DEF;&#x5F84;&#xFF0C;&#x7136;&#x540E;&#x624D;&#x6839;&#x636E;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x89E3;&#x6790;&#x6210;&#x552F;&#x4E00;&#x5F62;&#x5F0F;&#x7684;&#x8DEF;&#x5F84;&#x3002;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x6BD4;&#x8F83;&#x5178;&#x578B;&#x7684;&#x5C31;&#x662F;&#x5904;&#x7406;&#x5305;&#x542B;&#x201D;.&#x201D;&#x6216;&#x201D;..&#x201D;&#x7684;&#x8DEF;&#x5F84;&#xFF0C;&#x8FD8;&#x6709;&#x7B26;&#x53F7;&#x94FE;&#x63A5;&#x548C;&#x9A71;&#x52A8;&#x76D8;&#x7B26;&#x53F7;&#x5927;&#x5C0F;&#x5199;&#x7B49;&#x3002;</p>
<ol>
<li>&#x5982;&#x679C;&#x8DEF;&#x5F84;&#x957F;&#x5EA6;&#x4E3A;2&#xFF0C;&#x4E14;&#x8DEF;&#x5F84;&#x7B2C;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E3A;&#x5B57;&#x6BCD;&#xFF0C;&#x4E14;&#x8DEF;&#x5F84;&#x7B2C;&#x4E8C;&#x4E2A;&#x5B57;&#x7B26;&#x4E3A;<code>:</code>&#xFF0C;&#x6B64;&#x65F6;&#x8DEF;&#x5F84;&#x7C7B;&#x4F3C;&#x4E3A;<code>c:</code>&#xFF0C;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x8DEF;&#x5F84;&#x6216;&#x52A0;&#x4E0A;<code>:</code>&#x8FD4;&#x56DE;&#x3002;</li>
<li>&#x5982;&#x679C;&#x8DEF;&#x5F84;&#x957F;&#x5EA6;&#x4E3A;3&#xFF0C;&#x4E14;&#x8DEF;&#x5F84;&#x7B2C;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E3A;&#x5B57;&#x6BCD;&#xFF0C;&#x4E14;&#x8DEF;&#x5F84;&#x7B2C;&#x4E8C;&#x4E2A;&#x5B57;&#x7B26;&#x4E3A;<code>:</code>&#xFF0C;&#x4E14;&#x8DEF;&#x5F84;&#x7B2C;&#x4E09;&#x4E2A;&#x5B57;&#x7B26;&#x4E3A;<code>\</code>&#xFF0C;&#x6B64;&#x65F6;&#x8DEF;&#x5F84;&#x7C7B;&#x4F3C;&#x4E3A;<code>c:\</code>&#xFF0C;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x8DEF;&#x5F84;&#x6216;&#x52A0;&#x4E0A;<code>:</code>&#x8FD4;&#x56DE;&#x3002;</li>
<li>&#x5982;&#x679C;&#x4E0D;&#x4F7F;&#x7528;&#x7F13;&#x5B58;&#x5219;&#x76F4;&#x63A5;&#x8C03;&#x7528; canonicalize0 &#x672C;&#x5730;&#x65B9;&#x6CD5;&#x83B7;&#x53D6;&#x6807;&#x51C6;&#x5316;&#x8DEF;&#x5F84;&#x3002;</li>
<li>&#x5982;&#x679C;&#x4F7F;&#x7528;&#x4E86;&#x7F13;&#x5B58;&#x5219;&#x5728;&#x7F13;&#x5B58;&#x4E2D;&#x67E5;&#x627E;&#xFF0C;&#x5B58;&#x5728;&#x5219;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#xFF0C;&#x5426;&#x5219;&#x5148;&#x8C03;&#x7528; canonicalize0 &#x672C;&#x5730;&#x65B9;&#x6CD5;&#x83B7;&#x53D6;&#x6807;&#x51C6;&#x5316;&#x8DEF;&#x5F84;&#xFF0C;&#x518D;&#x5C06;&#x8DEF;&#x5F84;&#x653E;&#x8FDB;&#x7F13;&#x5B58;&#x4E2D;&#x3002;</li>
<li>&#x53E6;&#x5916;&#xFF0C;&#x8FD8;&#x63D0;&#x4F9B;&#x4E86;&#x524D;&#x7F00;&#x7F13;&#x5B58;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#xFF0C;&#x5B83;&#x7F13;&#x5B58;&#x4E86;&#x6807;&#x51C6;&#x8DEF;&#x5F84;&#x7684;&#x7236;&#x76EE;&#x5F55;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x53EF;&#x4EE5;&#x8282;&#x7701;&#x4E86;&#x524D;&#x7F00;&#x90E8;&#x5206;&#x7684;&#x5904;&#x7406;&#xFF0C;&#x524D;&#x7F00;&#x7F13;&#x5B58;&#x7684;&#x903B;&#x8F91;&#x4E5F;&#x662F;&#x7B2C;&#x4E00;&#x6B21;&#x6807;&#x51C6;&#x5316;&#x540E;&#x5C06;&#x5176;&#x7F13;&#x5B58;&#x8D77;&#x6765;&#xFF0C;&#x4E0B;&#x6B21;&#x5219;&#x53EF;&#x4ECE;&#x524D;&#x7F00;&#x7F13;&#x5B58;&#x4E2D;&#x67E5;&#x8BE2;&#x3002;</li>
<li>&#x4F7F;&#x7528;&#x524D;&#x7F00;&#x7F13;&#x5B58;&#x6765;&#x6807;&#x51C6;&#x5316;&#x8DEF;&#x5F84;&#x65F6;&#x662F;&#x8C03;&#x7528; canonicalizeWithPrefix &#x65B9;&#x6CD5;&#x7684;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x6700;&#x7EC8;&#x4E5F;&#x662F;&#x8C03;&#x4E00;&#x4E2A;&#x672C;&#x5730;&#x65B9;&#x6CD5; canonicalizeWithPrefix0&#xFF0C;&#x8FD9;&#x91CC;&#x4E0D;&#x518D;&#x5217;&#x51FA;&#x8BE5;&#x65B9;&#x6CD5;&#x4EE3;&#x7801;&#xFF0C;&#x6B64;&#x672C;&#x5730;&#x65B9;&#x6CD5;&#x4E0E;&#x524D;&#x9762;&#x7684; canonicalize0 &#x65B9;&#x6CD5;&#x7684;&#x903B;&#x8F91;&#x5DEE;&#x4E0D;&#x591A;&#xFF0C;&#x552F;&#x4E00;&#x4E0D;&#x540C;&#x7684;&#x662F;&#x5B83;&#x4E0D;&#x7528;&#x904D;&#x5386;&#x6574;&#x4E2A;&#x8DEF;&#x5F84;&#x4ECE;&#x5934;&#x5F00;&#x59CB;&#x68C0;&#x67E5;&#x8DEF;&#x5F84;&#x7684;&#x6709;&#x6548;&#x6027;&#xFF0C;&#x800C;&#x53EA;&#x9700;&#x8981;&#x68C0;&#x67E5;&#x4E00;&#x6B21;&#x6574;&#x4E2A;&#x8DEF;&#x5F84;&#x7684;&#x6709;&#x6548;&#x6027;&#xFF0C;&#x8FD9;&#x4E5F;&#x662F;&#x5B58;&#x5728;&#x524D;&#x7F00;&#x7F13;&#x5B58;&#x7684;&#x539F;&#x56E0;&#xFF0C;&#x8282;&#x7701;&#x4E86;&#x4E00;&#x4E9B;&#x5DE5;&#x4F5C;&#x3002;</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;    public String canonicalize(String path) throws IOException {</span><br><span class="line">        int len = path.length();</span><br><span class="line">        if ((len == 2) &amp;&amp;</span><br><span class="line">            (isLetter(path.charAt(0))) &amp;&amp;</span><br><span class="line">            (path.charAt(1) == &apos;:&apos;)) {</span><br><span class="line">            char c = path.charAt(0);</span><br><span class="line">            if ((c &gt;= &apos;A&apos;) &amp;&amp; (c &lt;= &apos;Z&apos;))</span><br><span class="line">                return path;</span><br><span class="line">            return &quot;&quot; + ((char) (c-32)) + &apos;:&apos;;</span><br><span class="line">        } else if ((len == 3) &amp;&amp;</span><br><span class="line">                   (isLetter(path.charAt(0))) &amp;&amp;</span><br><span class="line">                   (path.charAt(1) == &apos;:&apos;) &amp;&amp;</span><br><span class="line">                   (path.charAt(2) == &apos;\\&apos;)) {</span><br><span class="line">            char c = path.charAt(0);</span><br><span class="line">            if ((c &gt;= &apos;A&apos;) &amp;&amp; (c &lt;= &apos;Z&apos;))</span><br><span class="line">                return path;</span><br><span class="line">            return &quot;&quot; + ((char) (c-32)) + &apos;:&apos; + &apos;\\&apos;;</span><br><span class="line">        }</span><br><span class="line">        if (!useCanonCaches) {</span><br><span class="line">            return canonicalize0(path);</span><br><span class="line">        } else {</span><br><span class="line">            String res = cache.get(path);</span><br><span class="line">            if (res == null) {</span><br><span class="line">                String dir = null;</span><br><span class="line">                String resDir = null;</span><br><span class="line">                if (useCanonPrefixCache) {</span><br><span class="line">                    dir = parentOrNull(path);</span><br><span class="line">                    if (dir != null) {</span><br><span class="line">                        resDir = prefixCache.get(dir);</span><br><span class="line">                        if (resDir != null) {</span><br><span class="line">                            String filename = path.substring(1 + dir.length());</span><br><span class="line">                            res = canonicalizeWithPrefix(resDir, filename);</span><br><span class="line">                            cache.put(dir + File.separatorChar + filename, res);</span><br><span class="line">                        }</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">                if (res == null) {</span><br><span class="line">                    res = canonicalize0(path);</span><br><span class="line">                    cache.put(path, res);</span><br><span class="line">                    if (useCanonPrefixCache &amp;&amp; dir != null) {</span><br><span class="line">                        resDir = parentOrNull(res);</span><br><span class="line">                        if (resDir != null) {</span><br><span class="line">                            File f = new File(res);</span><br><span class="line">                            if (f.exists() &amp;&amp; !f.isDirectory()) {</span><br><span class="line">                                prefixCache.put(dir, resDir);</span><br><span class="line">                            }</span><br><span class="line">                        }</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            return res;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">private native String canonicalize0(String path)</span><br><span class="line">            throws IOException;</span><br><span class="line"></span><br><span class="line">private String canonicalizeWithPrefix(String canonicalPrefix,</span><br><span class="line">            String filename) throws IOException</span><br><span class="line">    {</span><br><span class="line">        return canonicalizeWithPrefix0(canonicalPrefix,</span><br><span class="line">                canonicalPrefix + File.separatorChar + filename);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">private native String canonicalizeWithPrefix0(String canonicalPrefix,</span><br><span class="line">            String pathWithCanonicalPrefix)</span><br><span class="line">            throws IOException;</span><br></pre></td></tr></table></figure>

<p>&#x56E0;&#x4E3A;&#x6807;&#x51C6;&#x5316;&#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x662F;&#x4F9D;&#x8D56;&#x4E8E;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x90E8;&#x5206;&#x5DE5;&#x4F5C;&#x4EA4;&#x7531;&#x672C;&#x5730;&#x65B9;&#x6CD5;&#x53BB;&#x505A;&#xFF0C;&#x4E3B;&#x8981;&#x903B;&#x8F91;&#x5982;&#x4E0B;&#xFF0C;</p>
<ul>
<li>&#x6807;&#x51C6;&#x8DEF;&#x5F84;&#x6700;&#x5927;&#x957F;&#x5EA6;&#x662F; MAX_PATH_LENGTH &#x5373;1024&#x4E2A;&#x5B57;&#x7B26;&#x3002;</li>
<li>&#x83B7;&#x53D6;&#x8DEF;&#x5F84;&#x957F;&#x5EA6;&#x5E76;&#x4E14;&#x901A;&#x8FC7; currentDirLength &#x51FD;&#x6570;&#x83B7;&#x53D6;&#x5F53;&#x524D;&#x5DE5;&#x4F5C;&#x76EE;&#x5F55;&#x957F;&#x5EA6;&#xFF0C;&#x8BE5;&#x51FD;&#x6570;&#x4EE3;&#x7801;&#x4E0D;&#x518D;&#x8D34;&#x51FA;&#x6765;&#xFF0C;&#x4E3B;&#x8981;&#x903B;&#x8F91;&#x662F;&#x5224;&#x65AD;&#x662F;&#x5426;&#x4E3A;&#x9A71;&#x52A8;&#x76D8;&#x76F8;&#x5BF9;&#x8DEF;&#x5F84;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x7684;&#x8BDD;&#x5219;&#x6839;&#x636E;&#x9A71;&#x52A8;&#x76D8;&#x7B26;&#x53F7;&#x83B7;&#x53D6;&#x5BF9;&#x5E94;&#x9A71;&#x52A8;&#x76D8;&#x7684;&#x5DE5;&#x4F5C;&#x76EE;&#x5F55;&#x5E76;&#x8FD4;&#x56DE;&#x8BE5;&#x76EE;&#x5F55;&#x957F;&#x5EA6;&#x3002;&#x5426;&#x5219;&#x5C31;&#x6839;&#x636E;C&#x7684;API&#x51FD;&#x6570; _wgetcwd &#x83B7;&#x53D6;&#x5DE5;&#x4F5C;&#x76EE;&#x5F55;&#x5E76;&#x8FD4;&#x56DE;&#x957F;&#x5EA6;&#x3002;&#x8DEF;&#x5F84;&#x957F;&#x5EA6;&#x52A0;&#x4E0A;&#x5DE5;&#x4F5C;&#x76EE;&#x5F55;&#x957F;&#x5EA6;&#x5219;&#x4E3A;&#x603B;&#x957F;&#x5EA6;&#x3002;</li>
<li>&#x901A;&#x8FC7; malloc &#x5206;&#x914D;&#x7A7A;&#x95F4;&#xFF0C;&#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x662F;&#x5BBD;&#x5B57;&#x7B26;&#x3002;</li>
<li>&#x6700;&#x540E;&#x901A;&#x8FC7; wcanonicalize &#x51FD;&#x6570;&#x6807;&#x51C6;&#x5316;&#x8DEF;&#x5F84;&#x3002;&#x4EE3;&#x7801;&#x8F83;&#x957F;&#xFF0C;&#x4E0D;&#x518D;&#x8D34;&#x51FA;&#xFF0C;&#x4E3B;&#x8981;&#x903B;&#x8F91;&#x662F;&#xFF0C;</li>
</ul>
<ol>
<li>&#x68C0;&#x67E5;&#x8DEF;&#x5F84;&#x662F;&#x5426;&#x5305;&#x542B;&#x901A;&#x914D;&#x7B26;&#xFF0C;&#x662F;&#x5219;&#x6807;&#x51C6;&#x5316;&#x5931;&#x8D25;&#x3002;</li>
<li>&#x901A;&#x8FC7; _wfullpath &#x51FD;&#x6570;&#x83B7;&#x53D6;&#x7EDD;&#x5BF9;&#x8DEF;&#x5F84;&#xFF0C;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x4ED6;&#x4F1A;&#x5904;&#x7406; <code>\</code>&#x548C;<code>..</code>&#x7B49;&#x7B26;&#x53F7;&#xFF0C;&#x6BD4;&#x5982; &#x201C;test&#x201D;&#x3001;&#x201D;\test&#x201D; &#x548C;&#x201D;..\test&#x201D;&#xFF0C;&#x5219;&#x4F1A;&#x5904;&#x7406;&#x6210;&#x201D;C:\Documents and Settings\user\My Documents\test&#x201D;&#x3001;&#x201D;C:\test&#x201D;&#x548C;&#x201D;C:\Documents and Settings\user\test&#x201D;&#x3002;</li>
<li>&#x68C0;&#x67E5;&#x8DEF;&#x5F84;&#x4E2D;&#x662F;&#x5426;&#x5305;&#x542B;&#x4E86;&#x975E;&#x6CD5;&#x7684; <code>.</code>&#x3002;</li>
<li>&#x83B7;&#x53D6;&#x6807;&#x51C6;&#x5316;&#x9A71;&#x52A8;&#x76D8;&#x7B26;&#x53F7;&#xFF0C;&#x5C06;&#x5176;&#x5927;&#x5199;&#xFF0C;&#x4FDD;&#x5B58;&#x5230;&#x7ED3;&#x679C;&#x5B57;&#x7B26;&#x6570;&#x7EC4;&#x4E2D;&#x3002;</li>
<li>&#x5982;&#x679C;&#x662F; UNC &#x8DEF;&#x5F84;&#x7684;&#x8BDD;&#xFF0C;UNC&#x8DEF;&#x5F84;&#x683C;&#x5F0F;&#x5982;<code>\\server\share\file_path</code>&#xFF0C;&#x5219;&#x6B64;&#x65F6;&#x5206;&#x522B;&#x83B7;&#x53D6; server &#x548C; share&#xFF0C;&#x5C06;&#x5176;&#x4FDD;&#x5B58;&#x5230;&#x7ED3;&#x679C;&#x5B57;&#x7B26;&#x6570;&#x7EC4;&#x4E2D;&#x3002;</li>
<li>&#x901A;&#x8FC7;&#x5FAA;&#x73AF;&#x68C0;&#x6D4B;&#x5269;&#x4F59;&#x8DEF;&#x5F84;&#x7684;&#x6709;&#x6548;&#x6027;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x4F7F;&#x7528; FindFirstFileW &#x51FD;&#x6570;&#x83B7;&#x53D6;&#x8DEF;&#x5F84;&#x5BF9;&#x5E94;&#x6587;&#x4EF6;&#x7684;&#x5C5E;&#x6027;&#x4FE1;&#x606F;&#xFF0C;&#x6839;&#x636E;&#x8FD4;&#x56DE;&#x503C;&#x53EF;&#x5224;&#x65AD;&#x5176;&#x6709;&#x6548;&#x6027;&#xFF0C;&#x6709;&#x6548;&#x5730;&#x8DEF;&#x5F84;&#x5219;&#x4FDD;&#x5B58;&#x5230;&#x7ED3;&#x679C;&#x5B57;&#x7B26;&#x6570;&#x7EC4;&#x4E2D;&#x3002;</li>
<li>&#x6700;&#x7EC8;&#x7ED3;&#x679C;&#x5B57;&#x7B26;&#x6570;&#x7EC4;&#x5219;&#x4E3A;&#x6807;&#x51C6;&#x5316;&#x540E;&#x7684;&#x8DEF;&#x5F84;&#x3002;</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;JNIEXPORT jstring JNICALL</span><br><span class="line">Java_java_io_WinNTFileSystem_canonicalize0(JNIEnv *env, jobject this,</span><br><span class="line">                                           jstring pathname)</span><br><span class="line">{</span><br><span class="line">    jstring rv = NULL;</span><br><span class="line">    WCHAR canonicalPath[MAX_PATH_LENGTH];</span><br><span class="line"></span><br><span class="line">    WITH_UNICODE_STRING(env, pathname, path) {</span><br><span class="line">        int len = (int)wcslen(path);</span><br><span class="line">        len += currentDirLength(path, len);</span><br><span class="line">        if (len  &gt; MAX_PATH_LENGTH - 1) {</span><br><span class="line">            WCHAR *cp = (WCHAR*)malloc(len * sizeof(WCHAR));</span><br><span class="line">            if (cp != NULL) {</span><br><span class="line">                if (wcanonicalize(path, cp, len) &gt;= 0) {</span><br><span class="line">                    rv = (*env)-&gt;NewString(env, cp, (jsize)wcslen(cp));</span><br><span class="line">                }</span><br><span class="line">                free(cp);</span><br><span class="line">            }</span><br><span class="line">        } else</span><br><span class="line">        if (wcanonicalize(path, canonicalPath, MAX_PATH_LENGTH) &gt;= 0) {</span><br><span class="line">            rv = (*env)-&gt;NewString(env, canonicalPath, (jsize)wcslen(canonicalPath));</span><br><span class="line">        }</span><br><span class="line">    } END_UNICODE_STRING(env, path);</span><br><span class="line">    if (rv == NULL) {</span><br><span class="line">        JNU_ThrowIOExceptionWithLastError(env, &quot;Bad pathname&quot;);</span><br><span class="line">    }</span><br><span class="line">    return rv;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="getBooleanAttributes&#x65B9;&#x6CD5;"><a href="#getBooleanAttributes&#x65B9;&#x6CD5;" class="headerlink" title="getBooleanAttributes&#x65B9;&#x6CD5;"></a>getBooleanAttributes&#x65B9;&#x6CD5;</h3><p>&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x672C;&#x5730;&#x65B9;&#x6CD5;&#xFF0C;&#x5B83;&#x4E3B;&#x8981;&#x7684;&#x4F5C;&#x7528;&#x662F;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x5224;&#x65AD; File &#x5BF9;&#x8C61;&#x5BF9;&#x5E94;&#x7684;&#x6587;&#x4EF6;&#x6216;&#x76EE;&#x5F55;&#x662F;&#x5426;&#x5B58;&#x5728;&#xFF0C;&#x5224;&#x65AD; File &#x5BF9;&#x8C61;&#x5BF9;&#x5E94;&#x7684;&#x662F;&#x4E0D;&#x662F;&#x6587;&#x4EF6;&#xFF0C;&#x5224;&#x65AD; File &#x5BF9;&#x8C61;&#x5BF9;&#x5E94;&#x7684;&#x662F;&#x4E0D;&#x662F;&#x76EE;&#x5F55;&#xFF0C;&#x5224;&#x65AD; File &#x5BF9;&#x8C61;&#x662F;&#x4E0D;&#x662F;&#x9690;&#x85CF;&#x6587;&#x4EF6;&#x6216;&#x76EE;&#x5F55;&#x3002;</p>
<p>&#x4F46;&#x8FD9;&#x91CC;&#x4E3A;&#x4EC0;&#x4E48;&#x8FD4;&#x56DE;&#x7684;&#x662F;&#x4E00;&#x4E2A; int &#x7C7B;&#x578B;&#x5462;&#xFF1F;&#x56E0;&#x4E3A;&#x8FD9;&#x91CC;&#x4E3A;&#x4E86;&#x9AD8;&#x6548;&#x5229;&#x7528;&#x6570;&#x636E;&#xFF0C;&#x7528;&#x4F4D;&#x4F5C;&#x4E3A;&#x4E0D;&#x540C;&#x5C5E;&#x6027;&#x7684;&#x6807;&#x8BC6;&#xFF0C;&#x5206;&#x522B;&#x4E3A;<br><code>0x01&#x3001;0x02&#x3001;0x04&#x3001;0x08</code>&#xFF0C;&#x5206;&#x522B;&#x4EE3;&#x8868;&#x662F;&#x5426;&#x5B58;&#x5728;&#x3001;&#x662F;&#x5426;&#x4E3A;&#x6587;&#x4EF6;&#x3001;&#x662F;&#x5426;&#x4E3A;&#x76EE;&#x5F55;&#x548C;&#x662F;&#x5426;&#x4E3A;&#x9690;&#x85CF;&#x6587;&#x4EF6;&#x6216;&#x76EE;&#x5F55;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public native int getBooleanAttributes(File f);</span><br></pre></td></tr></table></figure>

<p>&#x672C;&#x5730;&#x65B9;&#x6CD5;&#x7684;&#x4E3B;&#x8981;&#x903B;&#x8F91;&#x662F;&#x5148;&#x5F97;&#x5230;&#x6587;&#x4EF6;&#x7684;&#x8DEF;&#x5F84;&#xFF0C;&#x518D;&#x5224;&#x65AD;&#x8DEF;&#x5F84;&#x662F;&#x5426;&#x4E3A; windows &#x4FDD;&#x7559;&#x8BBE;&#x5907;&#x540D;&#x79F0;&#xFF0C;&#x5B83;&#x5305;&#x62EC;&#x4EE5;&#x4E0B;&#x8FD9;&#x4E9B;&#xFF0C;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;static WCHAR* ReservedDEviceNames[] = {</span><br><span class="line">    L&quot;CON&quot;, L&quot;PRN&quot;, L&quot;AUX&quot;, L&quot;NUL&quot;,</span><br><span class="line">    L&quot;COM1&quot;, L&quot;COM2&quot;, L&quot;COM3&quot;, L&quot;COM4&quot;, L&quot;COM5&quot;, L&quot;COM6&quot;, L&quot;COM7&quot;, L&quot;COM8&quot;, L&quot;COM9&quot;,</span><br><span class="line">    L&quot;LPT1&quot;, L&quot;LPT2&quot;, L&quot;LPT3&quot;, L&quot;LPT4&quot;, L&quot;LPT5&quot;, L&quot;LPT6&quot;, L&quot;LPT7&quot;, L&quot;LPT8&quot;, L&quot;LPT9&quot;,</span><br><span class="line">    L&quot;CLOCK$&quot;</span><br><span class="line">};</span><br></pre></td></tr></table></figure>

<p>&#x63A5;&#x7740;&#x901A;&#x8FC7; GetFileAttributesExW &#x51FD;&#x6570;&#x83B7;&#x53D6;&#x6587;&#x4EF6;&#x5C5E;&#x6027;&#xFF0C;&#x5982;&#x679C;&#x6587;&#x4EF6;&#x5C5E;&#x4E8E;&#x8D85;&#x94FE;&#x63A5;&#x6216;&#x8005;&#x5FEB;&#x6377;&#x65B9;&#x5F0F;&#xFF0C;&#x5219;&#x9700;&#x8981;&#x518D;&#x901A;&#x8FC7; CreateFileW &#x51FD;&#x6570;&#x4E0E; GetFileInformationByHandle &#x51FD;&#x6570;&#x7EC4;&#x5408;&#x83B7;&#x53D6;&#x6587;&#x4EF6;&#x4FE1;&#x606F;&#xFF0C;&#x5176;&#x4E2D; CreateFileW &#x51FD;&#x6570;&#x8981;&#x4F7F;&#x7528; OPEN_EXISTING &#x8868;&#x793A;&#x4EC5;&#x4EC5;&#x6253;&#x5F00;&#x6587;&#x4EF6;&#x800C;&#x4E0D;&#x662F;&#x521B;&#x5EFA;&#x3002;&#x5F97;&#x5230;&#x6587;&#x4EF6;&#x5C5E;&#x6027;&#x540E;&#x901A;&#x8FC7;&#x4F4D;&#x7684;&#x6216;&#x64CD;&#x4F5C;&#x6765;&#x6807;&#x8BC6;&#x662F;&#x5426;&#x5B58;&#x5728;&#x3001;&#x662F;&#x5426;&#x6587;&#x4EF6;&#x3001;&#x662F;&#x5426;&#x76EE;&#x5F55;&#x3001;&#x662F;&#x5426;&#x9690;&#x85CF;&#x3002;</p>
<p>&#x6B64;&#x5916;&#x6709;&#x4E00;&#x4E2A;&#x7279;&#x4F8B;&#x4E5F;&#x9700;&#x8981;&#x5904;&#x7406;&#xFF0C;&#x5C31;&#x662F; pagefile.sys &#x6587;&#x4EF6;&#xFF0C;&#x5B83;&#x6BD4;&#x8F83;&#x7279;&#x6B8A;&#xFF0C;&#x4E3B;&#x8981;&#x7528;&#x4E8E;&#x865A;&#x62DF;&#x5185;&#x5B58;&#xFF0C;&#x5B83;&#x662F;&#x6587;&#x4EF6;&#x800C;&#x4E0D;&#x662F;&#x76EE;&#x5F55;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;JNIEXPORT jint JNICALL</span><br><span class="line">Java_java_io_WinNTFileSystem_getBooleanAttributes(JNIEnv *env, jobject this,</span><br><span class="line">                                                  jobject file)</span><br><span class="line">{</span><br><span class="line"></span><br><span class="line">    jint rv = 0;</span><br><span class="line">    jint pathlen;</span><br><span class="line"></span><br><span class="line">#define SPECIALFILE_NAMELEN 12</span><br><span class="line"></span><br><span class="line">    WCHAR *pathbuf = fileToNTPath(env, file, ids.path);</span><br><span class="line">    WIN32_FILE_ATTRIBUTE_DATA wfad;</span><br><span class="line">    if (pathbuf == NULL)</span><br><span class="line">        return rv;</span><br><span class="line">    if (!isReservedDeviceNameW(pathbuf)) {</span><br><span class="line">        if (GetFileAttributesExW(pathbuf, GetFileExInfoStandard, &amp;wfad)) {</span><br><span class="line">            DWORD a = getFinalAttributesIfReparsePoint(pathbuf, wfad.dwFileAttributes);</span><br><span class="line">            if (a != INVALID_FILE_ATTRIBUTES) {</span><br><span class="line">                rv = (java_io_FileSystem_BA_EXISTS</span><br><span class="line">                    | ((a &amp; FILE_ATTRIBUTE_DIRECTORY)</span><br><span class="line">                        ? java_io_FileSystem_BA_DIRECTORY</span><br><span class="line">                        : java_io_FileSystem_BA_REGULAR)</span><br><span class="line">                    | ((a &amp; FILE_ATTRIBUTE_HIDDEN)</span><br><span class="line">                        ? java_io_FileSystem_BA_HIDDEN : 0));</span><br><span class="line">            }</span><br><span class="line">        } else { </span><br><span class="line">            if (GetLastError() == ERROR_SHARING_VIOLATION) {</span><br><span class="line">                rv = java_io_FileSystem_BA_EXISTS;</span><br><span class="line">                if ((pathlen = (jint)wcslen(pathbuf)) &gt;= SPECIALFILE_NAMELEN &amp;&amp;</span><br><span class="line">                    (_wcsicmp(pathbuf + pathlen - SPECIALFILE_NAMELEN,</span><br><span class="line">                              L&quot;pagefile.sys&quot;) == 0) ||</span><br><span class="line">                    (_wcsicmp(pathbuf + pathlen - SPECIALFILE_NAMELEN,</span><br><span class="line">                              L&quot;hiberfil.sys&quot;) == 0))</span><br><span class="line">                  rv |= java_io_FileSystem_BA_REGULAR;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    free(pathbuf);</span><br><span class="line">    return rv;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="checkAccess&#x65B9;&#x6CD5;"><a href="#checkAccess&#x65B9;&#x6CD5;" class="headerlink" title="checkAccess&#x65B9;&#x6CD5;"></a>checkAccess&#x65B9;&#x6CD5;</h3><p>&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x672C;&#x5730;&#x65B9;&#x6CD5;&#xFF0C;&#x5B83;&#x4E3B;&#x8981;&#x7684;&#x4F5C;&#x7528;&#x662F;&#x5224;&#x65AD;&#x67D0;&#x4E2A;&#x6587;&#x4EF6;&#x6216;&#x76EE;&#x5F55;&#x662F;&#x5426;&#x53EF;&#x8BFB;&#x3001;&#x662F;&#x5426;&#x53EF;&#x5199;&#x3001;&#x662F;&#x5426;&#x53EF;&#x6267;&#x884C;&#x3002;&#x8FD9;&#x91CC;&#x540C;&#x6837;&#x7528;&#x4F4D;&#x6807;&#x8BC6;&#x8FD9;&#x4E9B;&#x5C5E;&#x6027;&#xFF0C;&#x5206;&#x522B;&#x7528;<code>0x01&#x3001;0x02&#x3001;0x04</code>&#x8868;&#x793A;&#x53EF;&#x6267;&#x884C;&#x3001;&#x53EF;&#x5199;&#x3001;&#x53EF;&#x8BFB;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public native boolean checkAccess(File f, int access);</span><br></pre></td></tr></table></figure>

<p>&#x672C;&#x5730;&#x65B9;&#x6CD5;&#x7684;&#x903B;&#x8F91;&#x662F;&#x5148;&#x83B7;&#x53D6;&#x6587;&#x4EF6;&#x6216;&#x76EE;&#x5F55;&#x8DEF;&#x5F84;&#xFF0C;&#x63A5;&#x7740;&#x901A;&#x8FC7; GetFileAttributesW &#x51FD;&#x6570;&#x83B7;&#x53D6;&#x6587;&#x4EF6;&#x5C5E;&#x6027;&#xFF0C;&#x5982;&#x679C;&#x6587;&#x4EF6;&#x5C5E;&#x4E8E;&#x8D85;&#x94FE;&#x63A5;&#x6216;&#x8005;&#x5FEB;&#x6377;&#x65B9;&#x5F0F;&#xFF0C;&#x5219;&#x9700;&#x8981;&#x518D;&#x901A;&#x8FC7; CreateFileW &#x51FD;&#x6570;&#x4E0E; GetFileInformationByHandle &#x51FD;&#x6570;&#x7EC4;&#x5408;&#x83B7;&#x53D6;&#x6587;&#x4EF6;&#x4FE1;&#x606F;&#xFF0C;&#x5176;&#x4E2D; CreateFileW &#x51FD;&#x6570;&#x8981;&#x4F7F;&#x7528; OPEN_EXISTING &#x8868;&#x793A;&#x4EC5;&#x4EC5;&#x6253;&#x5F00;&#x6587;&#x4EF6;&#x800C;&#x4E0D;&#x662F;&#x521B;&#x5EFA;&#x3002;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5982;&#x679C;&#x4E3A; INVALID_FILE_ATTRIBUTES &#x5219;&#x662F;&#x83B7;&#x53D6;&#x5931;&#x8D25;&#x4E86;&#xFF0C;&#x6B64;&#x65F6;&#x4EFB;&#x4F55;&#x6743;&#x9650;&#x90FD;&#x662F;&#x6CA1;&#x6709;&#x7684;&#x3002;&#x83B7;&#x53D6;&#x6210;&#x529F;&#x5219;&#x5F53;&#x5224;&#x65AD;&#x53EF;&#x8BFB;&#x6027;&#x548C;&#x53EF;&#x6267;&#x884C;&#x6027;&#x65F6;&#x90FD;&#x8FD4;&#x56DE;true&#xFF0C;&#x4F46;&#x68C0;&#x67E5;&#x53EF;&#x5199;&#x65F6;&#x5219;&#x8FD8;&#x8981;&#x5224;&#x65AD;&#x662F;&#x5426;&#x4E3A;&#x76EE;&#x5F55;&#xFF08;&#x76EE;&#x5F55;&#x76F4;&#x63A5;&#x53EF;&#x5199;&#xFF09;&#xFF0C;&#x800C;&#x4E14;&#x8FD8;&#x8981;&#x770B;&#x6587;&#x4EF6;&#x5C5E;&#x6027;&#x662F;&#x5426;&#x4E3A; FILE_ATTRIBUTE_READONLY&#xFF0C;&#x53EA;&#x8BFB;&#x7684;&#x8BDD;&#x5219;&#x4E0D;&#x53EF;&#x5199;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;JNIEXPORT jboolean</span><br><span class="line">JNICALL Java_java_io_WinNTFileSystem_checkAccess(JNIEnv *env, jobject this,</span><br><span class="line">                                                 jobject file, jint access)</span><br><span class="line">{</span><br><span class="line">    DWORD attr;</span><br><span class="line">    WCHAR *pathbuf = fileToNTPath(env, file, ids.path);</span><br><span class="line">    if (pathbuf == NULL)</span><br><span class="line">        return JNI_FALSE;</span><br><span class="line">    attr = GetFileAttributesW(pathbuf);</span><br><span class="line">    attr = getFinalAttributesIfReparsePoint(pathbuf, attr);</span><br><span class="line">    free(pathbuf);</span><br><span class="line">    if (attr == INVALID_FILE_ATTRIBUTES)</span><br><span class="line">        return JNI_FALSE;</span><br><span class="line">    switch (access) {</span><br><span class="line">    case java_io_FileSystem_ACCESS_READ:</span><br><span class="line">    case java_io_FileSystem_ACCESS_EXECUTE:</span><br><span class="line">        return JNI_TRUE;</span><br><span class="line">    case java_io_FileSystem_ACCESS_WRITE:</span><br><span class="line">        if ((attr &amp; FILE_ATTRIBUTE_DIRECTORY) ||</span><br><span class="line">            (attr &amp; FILE_ATTRIBUTE_READONLY) == 0)</span><br><span class="line">            return JNI_TRUE;</span><br><span class="line">        else</span><br><span class="line">            return JNI_FALSE;</span><br><span class="line">    default:</span><br><span class="line">        assert(0);</span><br><span class="line">        return JNI_FALSE;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="getLastModifiedTime&#x65B9;&#x6CD5;"><a href="#getLastModifiedTime&#x65B9;&#x6CD5;" class="headerlink" title="getLastModifiedTime&#x65B9;&#x6CD5;"></a>getLastModifiedTime&#x65B9;&#x6CD5;</h3><p>&#x8BE5;&#x65B9;&#x6CD5;&#x7528;&#x4E8E;&#x83B7;&#x53D6;&#x6587;&#x4EF6;&#x6216;&#x76EE;&#x5F55;&#x7684;&#x6700;&#x540E;&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF0C;&#x672C;&#x5730;&#x65B9;&#x6CD5;&#x5148;&#x83B7;&#x53D6; File &#x5BF9;&#x8C61;&#x7684;&#x8DEF;&#x5F84;&#xFF0C;&#x518D;&#x901A;&#x8FC7; CreateFileW &#x51FD;&#x6570;&#x548C; GetFileTime &#x51FD;&#x6570;&#x83B7;&#x53D6;&#x6700;&#x540E;&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#xFF0C;&#x5176;&#x4E2D; CreateFileW &#x51FD;&#x6570;&#x8981;&#x4F7F;&#x7528; OPEN_EXISTING &#x8868;&#x793A;&#x4EC5;&#x4EC5;&#x6253;&#x5F00;&#x6587;&#x4EF6;&#x800C;&#x4E0D;&#x662F;&#x521B;&#x5EFA;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public native long getLastModifiedTime(File f);</span><br><span class="line"></span><br><span class="line">JNIEXPORT jlong JNICALL</span><br><span class="line">Java_java_io_WinNTFileSystem_getLastModifiedTime(JNIEnv *env, jobject this,</span><br><span class="line">                                                 jobject file)</span><br><span class="line">{</span><br><span class="line">    jlong rv = 0;</span><br><span class="line">    LARGE_INTEGER modTime;</span><br><span class="line">    FILETIME t;</span><br><span class="line">    HANDLE h;</span><br><span class="line">    WCHAR *pathbuf = fileToNTPath(env, file, ids.path);</span><br><span class="line">    if (pathbuf == NULL)</span><br><span class="line">        return rv;</span><br><span class="line">    h = CreateFileW(pathbuf,</span><br><span class="line">                    0,</span><br><span class="line">                    FILE_SHARE_DELETE | FILE_SHARE_READ | FILE_SHARE_WRITE,</span><br><span class="line">                    NULL,</span><br><span class="line">                    OPEN_EXISTING,</span><br><span class="line">                    FILE_FLAG_BACKUP_SEMANTICS,</span><br><span class="line">                    NULL);</span><br><span class="line">    if (h != INVALID_HANDLE_VALUE) {</span><br><span class="line">        if (GetFileTime(h, NULL, NULL, &amp;t)) {</span><br><span class="line">            modTime.LowPart = (DWORD) t.dwLowDateTime;</span><br><span class="line">            modTime.HighPart = (LONG) t.dwHighDateTime;</span><br><span class="line">            rv = modTime.QuadPart / 10000;</span><br><span class="line">            rv -= 11644473600000;</span><br><span class="line">        }</span><br><span class="line">        CloseHandle(h);</span><br><span class="line">    }</span><br><span class="line">    free(pathbuf);</span><br><span class="line">    return rv;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="getLength&#x65B9;&#x6CD5;"><a href="#getLength&#x65B9;&#x6CD5;" class="headerlink" title="getLength&#x65B9;&#x6CD5;"></a>getLength&#x65B9;&#x6CD5;</h3><p>&#x8BE5;&#x65B9;&#x6CD5;&#x5FA1;&#x7528;&#x83B7;&#x53D6;&#x6587;&#x4EF6;&#x6216;&#x76EE;&#x5F55;&#x7684;&#x957F;&#x5EA6;&#x3002;&#x903B;&#x8F91;&#x4E3A;&#xFF0C;</p>
<ol>
<li>&#x83B7;&#x53D6; File &#x5BF9;&#x8C61;&#x7684;&#x8DEF;&#x5F84;&#x3002;</li>
<li>&#x901A;&#x8FC7; GetFileAttributesExW &#x51FD;&#x6570;&#x83B7;&#x53D6;&#x6587;&#x4EF6;&#x5C5E;&#x6027;&#xFF0C;&#x7136;&#x540E;&#x901A;&#x8FC7; nFileSizeHigh &#x548C; nFileSizeLow &#x5F97;&#x5230;&#x6587;&#x4EF6;&#x7684;&#x957F;&#x5EA6;&#x3002;</li>
<li>&#x5982;&#x679C;&#x6587;&#x4EF6;&#x5C5E;&#x4E8E;&#x8D85;&#x94FE;&#x63A5;&#x6216;&#x8005;&#x5FEB;&#x6377;&#x65B9;&#x5F0F;&#xFF0C;&#x5219;&#x9700;&#x8981;&#x518D;&#x901A;&#x8FC7; CreateFileW &#x51FD;&#x6570;&#x4E0E; GetFileInformationByHandle &#x51FD;&#x6570;&#x7EC4;&#x5408;&#x83B7;&#x53D6;&#x6587;&#x4EF6;&#x4FE1;&#x606F;&#xFF0C;&#x5176;&#x4E2D; CreateFileW &#x51FD;&#x6570;&#x8981;&#x4F7F;&#x7528; OPEN_EXISTING &#x8868;&#x793A;&#x4EC5;&#x4EC5;&#x6253;&#x5F00;&#x6587;&#x4EF6;&#x800C;&#x4E0D;&#x662F;&#x521B;&#x5EFA;&#xFF0C;&#x7136;&#x540E;&#x901A;&#x8FC7; nFileSizeHigh &#x548C; nFileSizeLow &#x5F97;&#x5230;&#x6587;&#x4EF6;&#x7684;&#x957F;&#x5EA6;&#x3002;</li>
<li>&#x5982;&#x679C;&#x53E6;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x5728;&#x4F7F;&#x7528;&#x6587;&#x4EF6;&#xFF0C;&#x5219;&#x4E0D;&#x80FD;&#x8BBF;&#x95EE;&#x8BE5;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x62A5;&#x9519; ERROR_SHARING_VIOLATION&#xFF0C;&#x6B64;&#x65F6;&#x5C1D;&#x8BD5;&#x7528; _wstati64 &#x51FD;&#x6570;&#x83B7;&#x53D6;&#x6587;&#x4EF6;&#x7684;&#x957F;&#x5EA6;&#x3002;</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801; public native long getLength(File f);</span><br><span class="line"></span><br><span class="line">JNIEXPORT jlong JNICALL</span><br><span class="line">Java_java_io_WinNTFileSystem_getLength(JNIEnv *env, jobject this, jobject file)</span><br><span class="line">{</span><br><span class="line">    jlong rv = 0;</span><br><span class="line">    WIN32_FILE_ATTRIBUTE_DATA wfad;</span><br><span class="line">    WCHAR *pathbuf = fileToNTPath(env, file, ids.path);</span><br><span class="line">    if (pathbuf == NULL)</span><br><span class="line">        return rv;</span><br><span class="line">    if (GetFileAttributesExW(pathbuf,</span><br><span class="line">                             GetFileExInfoStandard,</span><br><span class="line">                             &amp;wfad)) {</span><br><span class="line">        if ((wfad.dwFileAttributes &amp; FILE_ATTRIBUTE_REPARSE_POINT) == 0) {</span><br><span class="line">            rv = wfad.nFileSizeHigh * ((jlong)MAXDWORD + 1) + wfad.nFileSizeLow;</span><br><span class="line">        } else {</span><br><span class="line">            BY_HANDLE_FILE_INFORMATION finfo;</span><br><span class="line">            if (getFileInformation(pathbuf, &amp;finfo)) {</span><br><span class="line">                rv = finfo.nFileSizeHigh * ((jlong)MAXDWORD + 1) +</span><br><span class="line">                    finfo.nFileSizeLow;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    } else {</span><br><span class="line">        if (GetLastError() == ERROR_SHARING_VIOLATION) {</span><br><span class="line">            struct _stati64 sb;</span><br><span class="line">            if (_wstati64(pathbuf, &amp;sb) == 0) {</span><br><span class="line">                rv = sb.st_size;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    free(pathbuf);</span><br><span class="line">    return rv;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="setPermission&#x65B9;&#x6CD5;"><a href="#setPermission&#x65B9;&#x6CD5;" class="headerlink" title="setPermission&#x65B9;&#x6CD5;"></a>setPermission&#x65B9;&#x6CD5;</h3><p>&#x8BE5;&#x65B9;&#x6CD5;&#x4E3B;&#x8981;&#x7528;&#x4E8E;&#x8BBE;&#x7F6E; File &#x5BF9;&#x8C61;&#x7684;&#x8BBF;&#x95EE;&#x6743;&#x9650;&#x3002;&#x903B;&#x8F91;&#x5982;&#x4E0B;&#xFF0C;</p>
<ol>
<li>&#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x989D;&#x6743;&#x9650;&#x4E3A; ACCESS_READ &#x6216; ACCESS_EXECUTE&#xFF0C;&#x5219;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x4F20;&#x5165;&#x7684;&#x53C2;&#x6570;enable&#x3002;</li>
<li>&#x83B7;&#x53D6; File &#x5BF9;&#x8C61;&#x7684;&#x8DEF;&#x5F84;&#x3002;</li>
<li>&#x901A;&#x8FC7; GetFileAttributesW &#x51FD;&#x6570;&#x83B7;&#x53D6;&#x6587;&#x4EF6;&#x5C5E;&#x6027;&#x3002;</li>
<li>&#x5982;&#x679C;&#x6587;&#x4EF6;&#x5C5E;&#x4E8E;&#x8D85;&#x94FE;&#x63A5;&#x6216;&#x8005;&#x5FEB;&#x6377;&#x65B9;&#x5F0F;&#xFF0C;&#x5219;&#x5148;&#x83B7;&#x53D6;&#x5BF9;&#x5E94;&#x7684;&#x6700;&#x7EC8;&#x8DEF;&#x5F84;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x7528; GetFileAttributesW &#x51FD;&#x6570;&#x83B7;&#x53D6;&#x6587;&#x4EF6;&#x5C5E;&#x6027;&#x3002;</li>
<li>&#x5224;&#x65AD;&#x5982;&#x679C;&#x4E0D;&#x662F;&#x76EE;&#x5F55;&#x7684;&#x8BDD;&#x5219;&#x6839;&#x636E;&#x4F20;&#x5165;&#x7684;&#x53C2;&#x6570;enable&#x8BBE;&#x7F6E;&#x5C5E;&#x6027;&#xFF0C;&#x5E76;&#x4E14;&#x901A;&#x8FC7; SetFileAttributesW &#x51FD;&#x6570;&#x8BBE;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x8BFB;&#x5199;&#x6743;&#x9650;&#x3002;</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public native boolean setPermission(File f, int access, boolean enable,</span><br><span class="line">            boolean owneronly);</span><br><span class="line"></span><br><span class="line">JNIEXPORT jboolean JNICALL</span><br><span class="line">Java_java_io_WinNTFileSystem_setPermission(JNIEnv *env, jobject this,</span><br><span class="line">                                           jobject file,</span><br><span class="line">                                           jint access,</span><br><span class="line">                                           jboolean enable,</span><br><span class="line">                                           jboolean owneronly)</span><br><span class="line">{</span><br><span class="line">    jboolean rv = JNI_FALSE;</span><br><span class="line">    WCHAR *pathbuf;</span><br><span class="line">    DWORD a;</span><br><span class="line">    if (access == java_io_FileSystem_ACCESS_READ ||</span><br><span class="line">        access == java_io_FileSystem_ACCESS_EXECUTE) {</span><br><span class="line">        return enable;</span><br><span class="line">    }</span><br><span class="line">    pathbuf = fileToNTPath(env, file, ids.path);</span><br><span class="line">    if (pathbuf == NULL)</span><br><span class="line">        return JNI_FALSE;</span><br><span class="line">    a = GetFileAttributesW(pathbuf);</span><br><span class="line"></span><br><span class="line">    if ((a != INVALID_FILE_ATTRIBUTES) &amp;&amp;</span><br><span class="line">        ((a &amp; FILE_ATTRIBUTE_REPARSE_POINT) != 0))</span><br><span class="line">    {</span><br><span class="line">        WCHAR *fp = getFinalPath(env, pathbuf);</span><br><span class="line">        if (fp == NULL) {</span><br><span class="line">            a = INVALID_FILE_ATTRIBUTES;</span><br><span class="line">        } else {</span><br><span class="line">            free(pathbuf);</span><br><span class="line">            pathbuf = fp;</span><br><span class="line">            a = GetFileAttributesW(pathbuf);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    if ((a != INVALID_FILE_ATTRIBUTES) &amp;&amp;</span><br><span class="line">        ((a &amp; FILE_ATTRIBUTE_DIRECTORY) == 0))</span><br><span class="line">    {</span><br><span class="line">        if (enable)</span><br><span class="line">            a =  a &amp; ~FILE_ATTRIBUTE_READONLY;</span><br><span class="line">        else</span><br><span class="line">            a =  a | FILE_ATTRIBUTE_READONLY;</span><br><span class="line">        if (SetFileAttributesW(pathbuf, a))</span><br><span class="line">            rv = JNI_TRUE;</span><br><span class="line">    }</span><br><span class="line">    free(pathbuf);</span><br><span class="line">    return rv;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4EE5;&#x4E0B;&#x662F;<strong><em>&#x5E7F;&#x544A;</em></strong>&#x548C;<strong><em>&#x76F8;&#x5173;&#x9605;&#x8BFB;</em></strong></p>
<p>========&#x5E7F;&#x544A;&#x65F6;&#x95F4;========</p>
<p>&#x9119;&#x4EBA;&#x7684;&#x65B0;&#x4E66;&#x300A;Tomcat&#x5185;&#x6838;&#x8BBE;&#x8BA1;&#x5256;&#x6790;&#x300B;&#x5DF2;&#x7ECF;&#x5728;&#x4EAC;&#x4E1C;&#x9500;&#x552E;&#x4E86;&#xFF0C;&#x6709;&#x9700;&#x8981;&#x7684;&#x670B;&#x53CB;&#x53EF;&#x4EE5;&#x5230; <a href="/external_links/f595bc3995af2e5f462672d39500238d.html" target="blank" rel="noopener">item.jd.com/12185360.ht&#x2026;</a> &#x8FDB;&#x884C;&#x9884;&#x5B9A;&#x3002;&#x611F;&#x8C22;&#x5404;&#x4F4D;&#x670B;&#x53CB;&#x3002;</p>
<p><a href="/external_links/1054677517988dca01f26bb397d50624.html" target="blank" rel="noopener">&#x4E3A;&#x4EC0;&#x4E48;&#x5199;&#x300A;Tomcat&#x5185;&#x6838;&#x8BBE;&#x8BA1;&#x5256;&#x6790;&#x300B;</a></p>
<p>=========================</p>
<p>&#x76F8;&#x5173;&#x9605;&#x8BFB;&#xFF1A;</p>
<p><a href="/external_links/81ffc7be5928b5be9872c364d9d95f55.html" target="blank" rel="noopener">JDK&#x4E0D;&#x540C;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;FileSystem&#xFF08;Windows&#xFF09;&#x4E0A;&#x7BC7;</a></p>
<p>&#x6B22;&#x8FCE;&#x5173;&#x6CE8;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/45c488056f371451c91549de71082f085eb0795c9b0a1a447b8aca5cdf43c311" alt="&#x8FD9;&#x91CC;&#x5199;&#x56FE;&#x7247;&#x63CF;&#x8FF0;"></p>
<p>&#x8FD9;&#x91CC;&#x5199;&#x56FE;&#x7247;&#x63CF;&#x8FF0;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/5cea826361bd82fa36a4b125a51dd4473776cc66a4d921bd0eea1193a259ed96" alt="&#x8FD9;&#x91CC;&#x5199;&#x56FE;&#x7247;&#x63CF;&#x8FF0;"></p>
<p>&#x8FD9;&#x91CC;&#x5199;&#x56FE;&#x7247;&#x63CF;&#x8FF0;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/ff14e8eeb2797283ab1e38eeed11329d.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903512405442567.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903512405442567.html" itemprop="url">SpringMvc4x高级配置(五) Spring MVC</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-20T07:18:05+08:00">
                2017-11-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/dd9bad57dd6e5a51ecd88569611df838fd5b433d00ebb23a1c2e19360d95578c" alt></p>
<h2 id="&#x4E00;-&#x70B9;&#x775B;"><a href="#&#x4E00;-&#x70B9;&#x775B;" class="headerlink" title="&#x4E00;. &#x70B9;&#x775B;"></a>&#x4E00;. &#x70B9;&#x775B;</h2><p>&#x6D4B;&#x8BD5;&#x662F;&#x4FDD;&#x8BC1;&#x8F6F;&#x4EF6;&#x8D28;&#x91CF;&#x7684;&#x5173;&#x952E;&#xFF0C;&#x5728;&#x4E4B;&#x524D;&#x7684;&#x8BB2;&#x89E3;&#x4E2D;&#x53EA;&#x662F;&#x4ECB;&#x7ECD;&#x4E86;&#x7B80;&#x5355;&#x7684;&#x6D4B;&#x8BD5;&#xFF0C;&#x4E0B;&#x9762;&#x8981;&#x8FDB;&#x884C;&#x4E00;&#x4E9B;&#x548C;<code>Spring</code> <code>MVC</code>&#x76F8;&#x5173;&#x7684;&#x6D4B;&#x8BD5;&#xFF0C;&#x4E3B;&#x8981;&#x6D89;&#x53CA;&#x63A7;&#x5236;&#x5668;&#x7684;&#x6D4B;&#x8BD5;&#x3002;</p>
<p>&#x4E3A;&#x4E86;&#x6D4B;&#x8BD5;<code>Web</code>&#x9879;&#x76EE;&#x901A;&#x5E38;&#x4E0D;&#x9700;&#x8981;&#x542F;&#x52A8;&#x9879;&#x76EE;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4E00;&#x4E9B;<code>Servlet</code>&#x76F8;&#x5173;&#x7684;&#x6A21;&#x62DF;&#x5BF9;&#x8C61;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;<code>MockMVC</code>&#xFF0C;<code>MockHttpServletRequest</code>&#xFF0C;<code>MockHttpServletResponse</code>&#xFF0C;<code>MockHttpSession</code>&#x7B49;&#x3002;</p>
<p>&#x5728;<code>Spring</code>&#x91CC;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;<code>@WebAppConfiguration</code>&#x6307;&#x5B9A;&#x52A0;&#x8F7D;&#x7684;<code>ApplicationContext</code>&#x662F;&#x4E00;&#x4E2A;<code>WebAppConfiguration</code>&#x3002;</p>
<p>&#x5728;&#x4E0B;&#x9762;&#x7684;&#x793A;&#x4F8B;&#x91CC;&#x9762;&#x501F;&#x52A9;<code>JUnit</code>&#x548C;<code>Spring TestContext framework</code>&#xFF0C;&#x5206;&#x522B;&#x6F14;&#x793A;&#x5BF9;&#x666E;&#x901A;&#x9875;&#x9762;&#x8F6C;&#x5411;&#x5F62;&#x63A7;&#x5236;&#x5668;&#x548C;<code>RestController</code>&#x8FDB;&#x884C;&#x6D4B;&#x8BD5;&#x3002;</p>
<h2 id="&#x4E8C;-&#x793A;&#x4F8B;&#xFF1A;"><a href="#&#x4E8C;-&#x793A;&#x4F8B;&#xFF1A;" class="headerlink" title="&#x4E8C;. &#x793A;&#x4F8B;&#xFF1A;"></a>&#x4E8C;. &#x793A;&#x4F8B;&#xFF1A;</h2><ol>
<li>&#x6D4B;&#x8BD5;&#x4F9D;&#x8D56;</li>
</ol>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;        &lt;!-- spring-test --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-test&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;${spring-framework.version}&lt;/version&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- junit --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;4.11&lt;/version&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h2 id="&#x4EE3;&#x7801;&#x89E3;&#x91CA;&#xFF1A;"><a href="#&#x4EE3;&#x7801;&#x89E3;&#x91CA;&#xFF1A;" class="headerlink" title="&#x4EE3;&#x7801;&#x89E3;&#x91CA;&#xFF1A;"></a>&#x4EE3;&#x7801;&#x89E3;&#x91CA;&#xFF1A;</h2><blockquote>
<p>&#x8FD9;&#x91CC;<code>&lt;scope&gt;test&lt;/scope&gt;</code>&#x8BF4;&#x660E;&#x8FD9;&#x4E9B;&#x5305;&#x7684;&#x5B58;&#x6D3B;&#x662F;&#x5728;<code>test</code>&#x5468;&#x671F;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x610F;&#x5473;&#x7740;&#x53D1;&#x5E03;&#x65F6;&#x6211;&#x4EEC;&#x5C06;&#x4E0D;&#x5305;&#x542B;&#x8FD9;&#x4E9B;<code>jar</code>&#x5305;&#x3002;</p>
</blockquote>
<ol start="2">
<li>&#x6F14;&#x793A;&#x670D;&#x52A1;&#xFF1A;</li>
</ol>
<hr>
<p>&#x5728;<code>src/main/java</code>&#x4E0B;&#x65B0;&#x589E;<code>DemoService</code> &#x7C7B;&#xFF0C;<strong>&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;package org.light4j.springMvc4.service;</span><br><span class="line"></span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">public class DemoService {</span><br><span class="line"></span><br><span class="line">    public String saySomething(){</span><br><span class="line">        return &quot;hello&quot;;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>&#x6D4B;&#x8BD5;&#x7528;&#x4F8B;</li>
</ol>
<hr>
<p>&#x5728;<code>src/test/java</code>&#x4E0B;&#x65B0;&#x5EFA;<code>TestControllerIntegrationTests</code>&#x7C7B;&#xFF0C;<strong>&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;package org.light4j.springMvc4.web;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;</span><br><span class="line">import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.content;</span><br><span class="line">import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.forwardedUrl;</span><br><span class="line">import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.model;</span><br><span class="line">import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;</span><br><span class="line">import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.view;</span><br><span class="line"></span><br><span class="line">import org.junit.Before;</span><br><span class="line">import org.junit.Test;</span><br><span class="line">import org.junit.runner.RunWith;</span><br><span class="line">import org.light4j.springMvc4.MyMvcConfig;</span><br><span class="line">import org.light4j.springMvc4.service.DemoService;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.mock.web.MockHttpServletRequest;</span><br><span class="line">import org.springframework.mock.web.MockHttpSession;</span><br><span class="line">import org.springframework.test.context.ContextConfiguration;</span><br><span class="line">import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line">import org.springframework.test.context.web.WebAppConfiguration;</span><br><span class="line">import org.springframework.test.web.servlet.MockMvc;</span><br><span class="line">import org.springframework.test.web.servlet.setup.MockMvcBuilders;</span><br><span class="line">import org.springframework.web.context.WebApplicationContext;</span><br><span class="line"></span><br><span class="line">@RunWith(SpringJUnit4ClassRunner.class)</span><br><span class="line">@ContextConfiguration(classes = {MyMvcConfig.class})</span><br><span class="line">@WebAppConfiguration(&quot;src/main/resources&quot;) //&#x2460;</span><br><span class="line">public class TestControllerIntegrationTests {</span><br><span class="line">    private MockMvc mockMvc; //&#x2461;</span><br><span class="line"></span><br><span class="line">   @Autowired</span><br><span class="line">   private DemoService demoService;//&#x2462;</span><br><span class="line"></span><br><span class="line">   @Autowired </span><br><span class="line">   WebApplicationContext wac; //&#x2463;</span><br><span class="line"></span><br><span class="line">    @Autowired </span><br><span class="line">    MockHttpSession session; //&#x2464;</span><br><span class="line"></span><br><span class="line">    @Autowired </span><br><span class="line">    MockHttpServletRequest request; //&#x2465;</span><br><span class="line"></span><br><span class="line">    @Before //7</span><br><span class="line">    public void setup() {</span><br><span class="line">        mockMvc =</span><br><span class="line">                MockMvcBuilders.webAppContextSetup(this.wac).build(); //&#x2461;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testNormalController() throws Exception{</span><br><span class="line">        mockMvc.perform(get(&quot;/normal&quot;)) //&#x2467;</span><br><span class="line">                .andExpect(status().isOk())//&#x2468;</span><br><span class="line">                .andExpect(view().name(&quot;page&quot;))//&#x2469;</span><br><span class="line">                .andExpect(forwardedUrl(&quot;/WEB-INF/classes/views/page.jsp&quot;))//11</span><br><span class="line">                .andExpect(model().attribute(&quot;msg&quot;, demoService.saySomething()));//12</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testRestController() throws Exception{</span><br><span class="line">        mockMvc.perform(get(&quot;/testRest&quot;)) //13</span><br><span class="line">        .andExpect(status().isOk())</span><br><span class="line">         .andExpect(content().contentType(&quot;text/plain;charset=UTF-8&quot;))//14</span><br><span class="line">        .andExpect(content().string(demoService.saySomething()));//15</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h2 id="&#x4EE3;&#x7801;&#x89E3;&#x91CA;&#xFF1A;-1"><a href="#&#x4EE3;&#x7801;&#x89E3;&#x91CA;&#xFF1A;-1" class="headerlink" title="&#x4EE3;&#x7801;&#x89E3;&#x91CA;&#xFF1A;"></a>&#x4EE3;&#x7801;&#x89E3;&#x91CA;&#xFF1A;</h2><blockquote>
<p>&#x2460; <code>@WebAppConfiguration</code>&#x6CE8;&#x89E3;&#x5728;&#x7C7B;&#x4E0A;&#xFF0C;&#x7528;&#x6765;&#x58F0;&#x660E;&#x52A0;&#x8F7D;&#x7684;<code>ApplicationContext</code>&#x662F;&#x4E00;&#x4E2A;<code>WebApplicationContext</code>&#x3002;&#x5B83;&#x7684;&#x5C5E;&#x6027;&#x6307;&#x5B9A;&#x7684;&#x662F;<code>Web</code>&#x8D44;&#x6E90;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;<code>src/main/webapp</code>,&#x672C;&#x4F8B;&#x4FEE;&#x6539;&#x4E3A;<code>src/main/resource</code>&#x3002;<br> &#x2461; <code>MockMvc</code>&#x6A21;&#x62DF;<code>MVC</code>&#x5BF9;&#x8C61;&#xFF0C;&#x901A;&#x8FC7;<code>MockMvcBuilders.webAppContextSetup(this.wac).build()</code>&#x8FDB;&#x884C;&#x521D;&#x59CB;&#x5316;&#x3002;<br> &#x2462; &#x53EF;&#x4EE5;&#x5728;&#x6D4B;&#x8BD5;&#x7528;&#x4F8B;&#x4E2D;&#x6CE8;&#x5165;<code>Spring</code>&#x7684;<code>Bean</code>&#x3002;<br> &#x2463; &#x53EF;&#x6CE8;&#x5165;<code>WebApplicationContext</code>&#x3002;<br> &#x2464; &#x53EF;&#x6CE8;&#x5165;&#x6A21;&#x62DF;&#x7684;<code>http session</code>&#xFF0C;&#x6B64;&#x5904;&#x4EC5;&#x4F5C;&#x6F14;&#x793A;&#xFF0C;&#x6CA1;&#x6709;&#x4F7F;&#x7528;&#x3002;<br> &#x2465; &#x53EF;&#x6CE8;&#x5165;&#x6A21;&#x62DF;&#x7684;<code>http request</code>&#xFF0C;&#x6B64;&#x5904;&#x4EC5;&#x4F5C;&#x6F14;&#x793A;&#xFF0C;&#x6CA1;&#x6709;&#x4F7F;&#x7528;&#x3002;<br> &#x2466; <code>@Before</code> &#x5728;&#x6D4B;&#x8BD5;&#x5F00;&#x59CB;&#x524D;&#x8FDB;&#x884C;&#x7684;&#x521D;&#x59CB;&#x5316;&#x5DE5;&#x4F5C;&#x3002;<br> &#x2467; &#x6A21;&#x62DF;&#x5411;<code>/normal</code>&#x8FDB;&#x884C;<code>get</code>&#x8BF7;&#x6C42;&#x3002;<br> &#x2468; &#x9884;&#x671F;&#x63A7;&#x5236;&#x8FD4;&#x56DE;&#x72B6;&#x6001;&#x4E3A;<code>200</code>.<br> &#x2469; &#x9884;&#x671F;<code>view</code>&#x7684;&#x540D;&#x79F0;&#x4E3A;<code>page</code>&#x3002;<br> 11 &#x9884;&#x671F;&#x9875;&#x9762;&#x8F6C;&#x5411;&#x7684;&#x771F;&#x6B63;&#x8DEF;&#x5F84;&#x4E3A;<code>/WEB-INF/classes/views/page.jsp</code>&#x3002;<br> 12 &#x9884;&#x671F;<code>model</code>&#x91CC;&#x9762;&#x7684;&#x503C;&#x662F;<code>demoService.saySomething()</code>&#x8FD4;&#x56DE;&#x503C;<code>hello</code>&#x3002;<br> 13.&#x6A21;&#x62DF;&#x5411;<code>/testRest</code>&#x8FDB;&#x884C;<code>get</code>&#x8BF7;&#x6C42;&#x3002;<br> 14 &#x9884;&#x671F;&#x8FD4;&#x56DE;&#x503C;&#x7684;&#x5A92;&#x4F53;&#x7C7B;&#x578B;&#x662F;<code>text/plain;charset=UTF-8</code>&#x3002;<br> 15 &#x9884;&#x671F;&#x8FD4;&#x56DE;&#x503C;&#x7684;&#x5185;&#x5BB9;&#x4E3A;<code>demoService.saySomething()</code>&#x8FD4;&#x56DE;&#x503C;<code>hello</code>&#x3002;</p>
</blockquote>
<p>&#x6B64;&#x65F6;&#xFF0C;&#x8FD0;&#x884C;&#x8BE5;&#x6D4B;&#x8BD5;&#xFF0C;<strong>&#x6548;&#x679C;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#xFF1A;</strong><br> <img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/6d809945e71bbecd7b411b20c12128739eeaee4d114c494206ea0456a8b8215c" alt="xxx"></p>
<ol start="4">
<li>&#x7F16;&#x5199;&#x666E;&#x901A;&#x63A7;&#x5236;&#x5668;</li>
</ol>
<hr>
<p>&#x5728;<code>src/main/java</code>&#x4E0B;&#x65B0;&#x589E;<code>NormalController</code> &#x7C7B;&#xFF0C;<strong>&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;package org.light4j.springMvc4.web;</span><br><span class="line"></span><br><span class="line">import org.light4j.springMvc4.service.DemoService;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line">import org.springframework.ui.Model;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line">@Controller</span><br><span class="line">public class NormalController {</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    DemoService demoService;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(&quot;/normal&quot;)</span><br><span class="line">    public  String testPage(Model model){</span><br><span class="line">        model.addAttribute(&quot;msg&quot;, demoService.saySomething());</span><br><span class="line">        return &quot;page&quot;;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>&#x7F16;&#x5199;&#x666E;&#x901A;&#x63A7;&#x5236;&#x5668;&#x7684;&#x6F14;&#x793A;&#x9875;&#x9762;</li>
</ol>
<hr>
<p>&#x5728;<code>src/main/resources/view</code>&#x4E0B;&#x65B0;&#x5EFA;<code>page.jsp</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;</span><br><span class="line">    pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;</span><br><span class="line">&lt;title&gt;Test page&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;pre&gt;</span><br><span class="line">        Welcome to Spring MVC world</span><br><span class="line">    &lt;/pre&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>&#x7F16;&#x5199;RestController&#x63A7;&#x5236;&#x5668;</li>
</ol>
<hr>
<p>&#x5728;<code>src/main/java</code>&#x4E0B;&#x65B0;&#x589E;<code>RestController</code>&#x7C7B;&#xFF0C;<strong>&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;package org.light4j.springMvc4.web;</span><br><span class="line"></span><br><span class="line">import org.light4j.springMvc4.service.DemoService;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line">@RestController</span><br><span class="line">public class MyRestController {</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    DemoService demoService;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(value = &quot;/testRest&quot; ,produces=&quot;text/plain;charset=UTF-8&quot;)</span><br><span class="line">    public @ResponseBody String testRest(){</span><br><span class="line">        return demoService.saySomething();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>&#x8FD0;&#x884C;&#x6D4B;&#x8BD5;</li>
</ol>
<hr>
<p><strong>&#x6548;&#x679C;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#xFF1A;</strong><br> <img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/2899612dab12cc241a94680fe9824bc485e93852f54f4617feb60897cc146cd1" alt="xxx"></p>
<h2 id="&#x4E09;-&#x6E90;&#x4EE3;&#x7801;&#x793A;&#x4F8B;&#xFF1A;"><a href="#&#x4E09;-&#x6E90;&#x4EE3;&#x7801;&#x793A;&#x4F8B;&#xFF1A;" class="headerlink" title="&#x4E09;. &#x6E90;&#x4EE3;&#x7801;&#x793A;&#x4F8B;&#xFF1A;"></a>&#x4E09;. &#x6E90;&#x4EE3;&#x7801;&#x793A;&#x4F8B;&#xFF1A;</h2><blockquote>
<p><code>github</code>&#x5730;&#x5740;&#xFF1A;<a href="/external_links/52a6cc988ba9ca6a44c36089ee814e55.html" target="blank" rel="noopener">&#x70B9;&#x51FB;&#x67E5;&#x770B;</a><br> &#x7801;&#x4E91;&#x5730;&#x5740;&#xFF1A;<a href="/external_links/7c5e009076de21957c4407cfe2ff51cc.html" target="blank" rel="noopener">&#x70B9;&#x51FB;&#x67E5;&#x770B;</a></p>
</blockquote>
<p><a href="/external_links/e94a0bfceb5172f503f7c819f9c8a17e.html" target="blank" rel="noopener">&#x6253;&#x8D4F;</a> <strong>&#x6B22;&#x8FCE;&#x5173;&#x6CE8;&#x4EBA;&#x751F;&#x8BBE;&#x8BA1;&#x5E08;&#x7684;&#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x8D26;&#x53F7;</strong><br> <strong>&#x516C;&#x4F17;&#x53F7;ID&#xFF1A;longjiazuoA</strong> <img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/2acb01ef64a935cd2dcd1469910a1a95379daf550df3ac4ae44648dc2db6b2ec" alt>  </p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/655696470fd551198faa3e3fdd5d1719.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903512359305223.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903512359305223.html" itemprop="url">Docker的那点事儿</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-19T19:59:32+08:00">
                2017-11-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Docker&#x662F;&#x4EC0;&#x4E48;&#xFF1F;"><a href="#Docker&#x662F;&#x4EC0;&#x4E48;&#xFF1F;" class="headerlink" title="Docker&#x662F;&#x4EC0;&#x4E48;&#xFF1F;"></a>Docker&#x662F;&#x4EC0;&#x4E48;&#xFF1F;</h3><hr>
<p>Docker&#x662F;&#x4E00;&#x4E2A;&#x57FA;&#x4E8E;&#x8F7B;&#x91CF;&#x7EA7;&#x865A;&#x62DF;&#x5316;&#x6280;&#x672F;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x6574;&#x4E2A;&#x9879;&#x76EE;&#x57FA;&#x4E8E;Go&#x8BED;&#x8A00;&#x5F00;&#x53D1;&#xFF0C;&#x5E76;&#x91C7;&#x7528;&#x4E86;Apache 2.0&#x534F;&#x8BAE;&#x3002;Docker&#x53EF;&#x4EE5;&#x5C06;&#x6211;&#x4EEC;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6253;&#x5305;&#x5C01;&#x88C5;&#x5230;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x4E2D;&#xFF0C;&#x8BE5;&#x5BB9;&#x5668;&#x5305;&#x542B;&#x4E86;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x4EE3;&#x7801;&#x3001;&#x8FD0;&#x884C;&#x73AF;&#x5883;&#x3001;&#x4F9D;&#x8D56;&#x5E93;&#x3001;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7B49;&#x5FC5;&#x9700;&#x7684;&#x8D44;&#x6E90;&#xFF0C;&#x901A;&#x8FC7;&#x5BB9;&#x5668;&#x5C31;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x65B9;&#x4FBF;&#x5FEB;&#x901F;&#x5E76;&#x4E14;&#x4E0E;&#x5E73;&#x53F0;&#x89E3;&#x8026;&#x7684;&#x81EA;&#x52A8;&#x5316;&#x90E8;&#x7F72;&#x65B9;&#x5F0F;&#xFF0C;&#x65E0;&#x8BBA;&#x4F60;&#x90E8;&#x7F72;&#x65F6;&#x7684;&#x73AF;&#x5883;&#x5982;&#x4F55;&#xFF0C;&#x5BB9;&#x5668;&#x4E2D;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x90FD;&#x4F1A;&#x8FD0;&#x884C;&#x5728;&#x540C;&#x4E00;&#x79CD;&#x73AF;&#x5883;&#x4E0B;&#x3002;</p>
<p>&#x4E3E;&#x4E2A;&#x6817;&#x5B50;&#xFF0C;&#x5C0F;&#x660E;&#x5199;&#x4E86;&#x4E00;&#x4E2A;CMS&#x7CFB;&#x7EDF;&#xFF0C;&#x8BE5;&#x7CFB;&#x7EDF;&#x7684;&#x6280;&#x672F;&#x6808;&#x975E;&#x5E38;&#x5E7F;&#xFF0C;&#x9700;&#x8981;&#x4F9D;&#x8D56;&#x4E8E;&#x5404;&#x79CD;&#x5F00;&#x6E90;&#x5E93;&#x548C;&#x4E2D;&#x95F4;&#x4EF6;&#x3002;&#x5982;&#x679C;&#x6309;&#x7167;&#x7EAF;&#x624B;&#x52A8;&#x7684;&#x90E8;&#x7F72;&#x65B9;&#x5F0F;&#xFF0C;&#x5C0F;&#x660E;&#x9700;&#x8981;&#x5B89;&#x88C5;&#x5404;&#x79CD;&#x5F00;&#x6E90;&#x8F6F;&#x4EF6;&#xFF0C;&#x8FD8;&#x9700;&#x8981;&#x5199;&#x597D;&#x6BCF;&#x4E2A;&#x5F00;&#x6E90;&#x8F6F;&#x4EF6;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002;&#x5982;&#x679C;&#x53EA;&#x662F;&#x90E8;&#x7F72;&#x4E00;&#x6B21;&#xFF0C;&#x8FD9;&#x70B9;&#x65F6;&#x95F4;&#x5F00;&#x9500;&#x8FD8;&#x662F;&#x53EF;&#x4EE5;&#x63A5;&#x53D7;&#x7684;&#xFF0C;&#x4F46;&#x5982;&#x679C;&#x5C0F;&#x660E;&#x6BCF;&#x9694;&#x51E0;&#x5929;&#x5C31;&#x9700;&#x8981;&#x6362;&#x4E2A;&#x670D;&#x52A1;&#x5668;&#x53BB;&#x90E8;&#x7F72;&#x4ED6;&#x7684;&#x7A0B;&#x5E8F;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x4E9B;&#x7E41;&#x7410;&#x7684;&#x91CD;&#x590D;&#x5DE5;&#x4F5C;&#x65E0;&#x7591;&#x662F;&#x4F1A;&#x4EE4;&#x4EBA;&#x53D1;&#x72C2;&#x7684;&#x3002;&#x8FD9;&#x65F6;&#x5019;&#xFF0C;Docker&#x7684;&#x7528;&#x5904;&#x5C31;&#x6D3E;&#x4E0A;&#x573A;&#x4E86;&#xFF0C;&#x5C0F;&#x660E;&#x53EA;&#x9700;&#x8981;&#x6839;&#x636E;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x90E8;&#x7F72;&#x6B65;&#x9AA4;&#x7F16;&#x5199;&#x4E00;&#x4EFD;Dockerfile&#x6587;&#x4EF6;&#xFF08;&#x5C06;&#x5B89;&#x88C5;&#x3001;&#x914D;&#x7F6E;&#x7B49;&#x64CD;&#x4F5C;&#x4EA4;&#x7531;Docker&#x81EA;&#x52A8;&#x5316;&#x5904;&#x7406;&#xFF09;&#xFF0C;&#x7136;&#x540E;&#x6784;&#x5EFA;&#x5E76;&#x53D1;&#x5E03;&#x4ED6;&#x7684;&#x955C;&#x50CF;&#xFF0C;&#x8FD9;&#x6837;&#xFF0C;&#x4E0D;&#x7BA1;&#x5728;&#x4EC0;&#x4E48;&#x673A;&#x5668;&#x4E0A;&#xFF0C;&#x5C0F;&#x660E;&#x90FD;&#x53EA;&#x9700;&#x8981;&#x62C9;&#x53D6;&#x4ED6;&#x9700;&#x8981;&#x7684;&#x955C;&#x50CF;&#xFF0C;&#x7136;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x90E8;&#x7F72;&#x8FD0;&#x884C;&#x4E86;&#xFF0C;&#x8FD9;&#x6B63;&#x662F;Docker&#x7684;&#x9B45;&#x529B;&#x6240;&#x5728;&#x3002;</p>
<p>&#x90A3;&#x4E48;&#x955C;&#x50CF;&#x53C8;&#x662F;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;&#x955C;&#x50CF;&#x662F;Docker&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x91CD;&#x8981;&#x6982;&#x5FF5;&#xFF1A;</p>
<ul>
<li>Image&#xFF08;&#x955C;&#x50CF;&#xFF09;&#xFF1A;&#x5B83;&#x7C7B;&#x4F3C;&#x4E8E;&#x865A;&#x62DF;&#x673A;&#x4E2D;&#x4F7F;&#x7528;&#x5230;&#x7684;&#x955C;&#x50CF;&#xFF0C;&#x7531;&#x4E8E;&#x4EFB;&#x4F55;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x90FD;&#x9700;&#x8981;&#x6709;&#x5B83;&#x81EA;&#x5DF1;&#x7684;&#x8FD0;&#x884C;&#x73AF;&#x5883;&#xFF0C;Image&#x5C31;&#x662F;&#x7528;&#x6765;&#x63D0;&#x4F9B;&#x6240;&#x9700;&#x8FD0;&#x884C;&#x73AF;&#x5883;&#x7684;&#x4E00;&#x4E2A;&#x6A21;&#x677F;&#x3002;</li>
<li>Container&#xFF08;&#x5BB9;&#x5668;&#xFF09;&#xFF1A;Container&#x662F;Docker&#x63D0;&#x4F9B;&#x7684;&#x4E00;&#x4E2A;&#x62BD;&#x8C61;&#x5C42;&#xFF0C;&#x5B83;&#x5C31;&#x50CF;&#x4E00;&#x4E2A;&#x8F7B;&#x91CF;&#x7EA7;&#x7684;&#x6C99;&#x76D2;&#xFF0C;&#x5176;&#x4E2D;&#x5305;&#x542B;&#x4E86;&#x4E00;&#x4E2A;&#x6781;&#x7B80;&#x7684;Linux&#x7CFB;&#x7EDF;&#x73AF;&#x5883;&#x4E0E;&#x8FD0;&#x884C;&#x5728;&#x5176;&#x4E2D;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;Container&#x662F;Image&#x7684;&#x8FD0;&#x884C;&#x5B9E;&#x4F8B;&#xFF08;Image&#x672C;&#x8EAB;&#x662F;&#x53EA;&#x8BFB;&#x7684;&#xFF0C;Container&#x542F;&#x52A8;&#x65F6;&#xFF0C;Docker&#x4F1A;&#x5728;Image&#x7684;&#x4E0A;&#x5C42;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x53EF;&#x5199;&#x5C42;&#xFF0C;&#x4EFB;&#x4F55;&#x5728;Container&#x4E2D;&#x7684;&#x4FEE;&#x6539;&#x90FD;&#x4E0D;&#x4F1A;&#x5F71;&#x54CD;&#x5230;Image&#xFF0C;&#x5982;&#x679C;&#x60F3;&#x8981;&#x5728;Image&#x4FDD;&#x5B58;Container&#x4E2D;&#x7684;&#x4FEE;&#x6539;&#xFF0C;Docker&#x91C7;&#x7528;&#x4E86;&#x57FA;&#x4E8E;Container&#x751F;&#x6210;&#x65B0;&#x7684;Image&#x5C42;&#x7684;&#x7B56;&#x7565;&#xFF09;&#xFF0C;Docker&#x5F15;&#x64CE;&#x5229;&#x7528;Container&#x6765;&#x64CD;&#x4F5C;&#x5E76;&#x9694;&#x79BB;&#x6BCF;&#x4E2A;&#x5E94;&#x7528;&#xFF08;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x6BCF;&#x4E2A;&#x5BB9;&#x5668;&#x4E2D;&#x7684;&#x5E94;&#x7528;&#x90FD;&#x662F;&#x4E92;&#x76F8;&#x72EC;&#x7ACB;&#x7684;&#xFF09;&#x3002;</li>
</ul>
<p>&#x5176;&#x5B9E;&#x4ECE;Docker&#x4E0E;Container&#x7684;&#x82F1;&#x6587;&#x5355;&#x8BCD;&#x539F;&#x610F;&#x4E2D;&#x5C31;&#x53EF;&#x4EE5;&#x4F53;&#x4F1A;&#x51FA;Docker&#x7684;&#x601D;&#x60F3;&#x3002;Container&#x53EF;&#x4EE5;&#x91CA;&#x4E49;&#x4E3A;&#x96C6;&#x88C5;&#x7BB1;&#xFF0C;&#x96C6;&#x88C5;&#x7BB1;&#x662F;&#x4E00;&#x4E2A;&#x53EF;&#x4EE5;&#x4FBF;&#x4E8E;&#x673A;&#x68B0;&#x8BBE;&#x5907;&#x88C5;&#x5378;&#x7684;&#x5C01;&#x88C5;&#x8D27;&#x7269;&#x7684;&#x901A;&#x7528;&#x6807;&#x51C6;&#x89C4;&#x683C;&#xFF0C;&#x5B83;&#x7684;&#x53D1;&#x660E;&#x7B80;&#x5316;&#x4E86;&#x7269;&#x6D41;&#x8FD0;&#x8F93;&#x7684;&#x673A;&#x68B0;&#x5316;&#x8FC7;&#x7A0B;&#xFF0C;&#x4F7F;&#x5176;&#x5EFA;&#x7ACB;&#x8D77;&#x4E86;&#x4E00;&#x5957;&#x6807;&#x51C6;&#x5316;&#x7684;&#x7269;&#x6D41;&#x8FD0;&#x8F93;&#x4F53;&#x7CFB;&#x3002;&#x800C;Docker&#x7684;&#x610F;&#x601D;&#x4E3A;&#x7801;&#x5934;&#x5DE5;&#x4EBA;&#xFF0C;&#x53EF;&#x4EE5;&#x8BA4;&#x4E3A;&#xFF0C;Docker&#x5C31;&#x50CF;&#x662F;&#x5728;&#x7801;&#x5934;&#x4E0A;&#x8F9B;&#x52E4;&#x5DE5;&#x4F5C;&#x7684;&#x5DE5;&#x4EBA;&#xFF0C;&#x628A;&#x5E94;&#x7528;&#x6253;&#x5305;&#x6210;&#x4E00;&#x4E2A;&#x4E2A;&#x5177;&#x6709;&#x67D0;&#x79CD;&#x6807;&#x51C6;&#x5316;&#x89C4;&#x683C;&#x7684;&#x201D;&#x96C6;&#x88C5;&#x7BB1;&#x201D;&#xFF08;&#x5176;&#x5B9E;&#x8FD9;&#x91CC;&#x6307;&#x51FA;&#x7684;&#x96C6;&#x88C5;&#x7BB1;&#x5BF9;&#x5E94;&#x7684;&#x662F;Image&#xFF0C;&#x5728;Docker&#x4E2D;Container&#x66F4;&#x50CF;&#x662F;&#x4E00;&#x4E2A;&#x8FD0;&#x884C;&#x4E2D;&#x7684;&#x6C99;&#x76D2;&#xFF09;&#xFF0C;&#x5F53;&#x8D27;&#x7269;&#x8FD0;&#x8F93;&#x5230;&#x76EE;&#x7684;&#x5730;&#x540E;&#xFF0C;&#x7801;&#x5934;&#x5DE5;&#x4EBA;&#x4EEC;&#xFF08;Docker&#xFF09;&#x5C31;&#x53EF;&#x4EE5;&#x628A;&#x96C6;&#x88C5;&#x7BB1;&#x62C6;&#x5F00;&#x53D6;&#x51FA;&#x5176;&#x4E2D;&#x7684;&#x8D27;&#x7269;&#xFF08;&#x57FA;&#x4E8E;Image&#x6765;&#x521B;&#x5EFA;Container&#x5E76;&#x8FD0;&#x884C;&#xFF09;&#x3002;&#x8FD9;&#x79CD;&#x6807;&#x51C6;&#x5316;&#x4E0E;&#x9694;&#x79BB;&#x6027;&#x53EF;&#x4EE5;&#x5F88;&#x65B9;&#x4FBF;&#x5730;&#x7EC4;&#x5408;&#x4F7F;&#x7528;&#x591A;&#x4E2A;Image&#x6765;&#x6784;&#x5EFA;&#x4F60;&#x7684;&#x5E94;&#x7528;&#x73AF;&#x5883;&#xFF08;Docker&#x4E5F;&#x63D0;&#x5021;&#x6BCF;&#x4E2A;Image&#x90FD;&#x9075;&#x5FAA;&#x5355;&#x4E00;&#x804C;&#x8D23;&#x539F;&#x5219;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x53EA;&#x505A;&#x597D;&#x4E00;&#x4EF6;&#x4E8B;&#xFF09;&#xFF0C;&#x6216;&#x8005;&#x4E0E;&#x5176;&#x4ED6;&#x4EBA;&#x5171;&#x4EAB;&#x4F60;&#x7684;Image&#x3002;</p>
<blockquote>
<p>&#x672C;&#x6587;&#x4F5C;&#x8005;&#x4E3A;<a href="/external_links/5b52fd82daec1d99f5e4ee652dfe1afd.html" target="blank" rel="noopener">SylvanasSun(sylvanas.sun@gmail.com)</a>&#xFF0C;&#x9996;&#x53D1;&#x4E8E;<a href="/external_links/ee05ddcd09d6517ffe37ca3b1f17bb6d.html" target="blank" rel="noopener">SylvanasSun&#x2019;s Blog</a>&#x3002;<br>&#x539F;&#x6587;&#x94FE;&#x63A5;&#xFF1A;<a href="/external_links/4959705a6445aa38c3c6067148b7d8ac.html" target="blank" rel="noopener">sylvanassun.github.io/2017/11/19/&#x2026;</a><br>&#xFF08;&#x8F6C;&#x8F7D;&#x8BF7;&#x52A1;&#x5FC5;&#x4FDD;&#x7559;&#x672C;&#x6BB5;&#x58F0;&#x660E;&#xFF0C;&#x5E76;&#x4E14;&#x4FDD;&#x7559;&#x8D85;&#x94FE;&#x63A5;&#x3002;&#xFF09;</p>
</blockquote>
<h3 id="Docker-VS-&#x865A;&#x62DF;&#x673A;"><a href="#Docker-VS-&#x865A;&#x62DF;&#x673A;" class="headerlink" title="Docker VS &#x865A;&#x62DF;&#x673A;"></a>Docker VS &#x865A;&#x62DF;&#x673A;</h3><hr>
<p>&#x5728;&#x4E0A;&#x6587;&#x4E2D;&#x6211;&#x4EEC;&#x63D0;&#x5230;&#x4E86;Docker&#x662F;&#x57FA;&#x4E8E;&#x8F7B;&#x91CF;&#x7EA7;&#x865A;&#x62DF;&#x5316;&#x6280;&#x672F;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x4E0E;&#x6211;&#x4EEC;&#x5E73;&#x5E38;&#x4F7F;&#x7528;&#x7684;&#x865A;&#x62DF;&#x673A;&#x662F;&#x4E0D;&#x4E00;&#x6837;&#x7684;&#x3002;&#x865A;&#x62DF;&#x673A;&#x6280;&#x672F;&#x53EF;&#x4EE5;&#x5206;&#x6210;&#x4EE5;&#x4E0B;&#x4E24;&#x7C7B;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/ff99f050ebb10b13a144e72c59a29ac75e34492b88c3afb9d2dc87ccfcfb7698" alt="&#x7CFB;&#x7EDF;&#x865A;&#x62DF;&#x673A;"></p>
<p>&#x7CFB;&#x7EDF;&#x865A;&#x62DF;&#x673A;</p>
<ul>
<li>&#x7CFB;&#x7EDF;&#x865A;&#x62DF;&#x673A;&#xFF1A;&#x901A;&#x8FC7;&#x8F6F;&#x4EF6;&#x5BF9;&#x8BA1;&#x7B97;&#x673A;&#x7CFB;&#x7EDF;&#x7684;&#x6A21;&#x62DF;&#x6765;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x771F;&#x5B9E;&#x8BA1;&#x7B97;&#x673A;&#x7684;&#x66FF;&#x4EE3;&#x54C1;&#x3002;&#x5B83;&#x662F;&#x7269;&#x7406;&#x786C;&#x4EF6;&#x7684;&#x62BD;&#x8C61;&#x5E76;&#x63D0;&#x4F9B;&#x4E86;&#x8FD0;&#x884C;&#x5B8C;&#x6574;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x6240;&#x9700;&#x7684;&#x529F;&#x80FD;&#x3002;&#x865A;&#x62DF;&#x673A;&#x901A;&#x8FC7;&#x7269;&#x7406;&#x673A;&#x5668;&#x6765;&#x7BA1;&#x7406;&#x548C;&#x5171;&#x4EAB;&#x786C;&#x4EF6;&#xFF0C;&#x8FD9;&#x6837;&#x5B9E;&#x73B0;&#x4E86;&#x591A;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#x73AF;&#x5883;&#x5F7C;&#x6B64;&#x4E4B;&#x95F4;&#x7684;&#x9694;&#x79BB;&#xFF0C;&#x4E00;&#x53F0;&#x673A;&#x5668;&#x4E0A;&#x53EF;&#x4EE5;&#x8FD0;&#x884C;&#x591A;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x6BCF;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#x5305;&#x62EC;&#x4E00;&#x4E2A;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;&#x5B8C;&#x6574;&#x526F;&#x672C;&#x3002;&#x5728;&#x7CFB;&#x7EDF;&#x865A;&#x62DF;&#x673A;&#x4E2D;&#xFF0C;&#x6240;&#x8FD0;&#x884C;&#x7684;&#x6240;&#x6709;&#x8F6F;&#x4EF6;&#x6216;&#x64CD;&#x4F5C;&#x90FD;&#x53EA;&#x4F1A;&#x5F71;&#x54CD;&#x5230;&#x8BE5;&#x865A;&#x62DF;&#x673A;&#x7684;&#x73AF;&#x5883;&#x3002;&#x6211;&#x4EEC;&#x7ECF;&#x5E38;&#x4F7F;&#x7528;&#x7684;VMWare&#x5C31;&#x662F;&#x7CFB;&#x7EDF;&#x865A;&#x62DF;&#x673A;&#x7684;&#x5B9E;&#x73B0;&#x3002;</li>
<li>&#x7A0B;&#x5E8F;&#x865A;&#x62DF;&#x673A;&#xFF1A;&#x5141;&#x8BB8;&#x7A0B;&#x5E8F;&#x72EC;&#x7ACB;&#x8FD0;&#x884C;&#x5728;&#x5E73;&#x53F0;&#x4E4B;&#x5916;&#x3002;&#x6BD4;&#x8F83;&#x5178;&#x578B;&#x7684;&#x4F8B;&#x5B50;&#x5C31;&#x662F;JVM&#xFF0C;Java&#x901A;&#x8FC7;JVM&#x8FD9;&#x4E00;&#x62BD;&#x8C61;&#x5C42;&#x4F7F;&#x5F97;Java&#x7A0B;&#x5E8F;&#x4E0E;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x548C;&#x786C;&#x4EF6;&#x5E73;&#x53F0;&#x89E3;&#x8026;&#xFF08;&#x56E0;&#x4E3A;&#x6BCF;&#x4E2A;Java&#x7A0B;&#x5E8F;&#x90FD;&#x662F;&#x8FD0;&#x884C;&#x5728;JVM&#x4E2D;&#x7684;&#xFF09;&#xFF0C;&#x56E0;&#x6B64;&#x5B9E;&#x73B0;&#x4E86;&#x6240;&#x8C13;&#x7684;compile once, run everywhere&#x3002;</li>
</ul>
<p>Docker&#x6240;&#x7528;&#x5230;&#x7684;&#x6280;&#x672F;&#x4E0E;&#x4E0A;&#x8FF0;&#x4E24;&#x79CD;&#x90FD;&#x4E0D;&#x76F8;&#x540C;&#xFF0C;&#x5B83;&#x4F7F;&#x7528;&#x4E86;&#x66F4;&#x8F7B;&#x91CF;&#x7EA7;&#x7684;&#x865A;&#x62DF;&#x5316;&#x6280;&#x672F;&#xFF0C;&#x591A;&#x4E2A;Container&#x5171;&#x4EAB;&#x4E86;&#x540C;&#x4E00;&#x4E2A;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5185;&#x6838;&#xFF0C;&#x5E76;&#x4E14;&#x5C31;&#x50CF;&#x8FD0;&#x884C;&#x5728;&#x672C;&#x5730;&#x4E0A;&#x4E00;&#x6837;&#x3002;Container&#x6280;&#x672F;&#x76F8;&#x5BF9;&#x4E8E;&#x865A;&#x62DF;&#x673A;&#x6765;&#x8BF4;&#xFF0C;&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5C42;&#x7684;&#x62BD;&#x8C61;&#xFF0C;&#x5B83;&#x5C06;&#x4EE3;&#x7801;&#x4E0E;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#x6253;&#x5305;&#x5230;&#x4E00;&#x8D77;&#xFF0C;&#x591A;&#x4E2A;Container&#x53EF;&#x4EE5;&#x5728;&#x540C;&#x4E00;&#x53F0;&#x673A;&#x5668;&#x4E0A;&#x8FD0;&#x884C;&#xFF08;&#x610F;&#x5473;&#x7740;&#x4E00;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#x4E0A;&#x4E5F;&#x53EF;&#x4EE5;&#x8FD0;&#x884C;&#x591A;&#x4E2A;Container&#xFF09;&#xFF0C;&#x5E76;&#x4E0E;&#x5176;&#x5B83;Container&#x5171;&#x4EAB;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5185;&#x6838;&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A;Container&#x90FD;&#x5728;&#x7528;&#x6237;&#x7A7A;&#x95F4;&#x4E2D;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x72EC;&#x7ACB;&#x7684;&#x8FDB;&#x7A0B;&#x8FD0;&#x884C;&#xFF0C;&#x8FD9;&#x4E9B;&#x7279;&#x6027;&#x90FD;&#x8BC1;&#x660E;&#x4E86;Container&#x8981;&#x6BD4;&#x865A;&#x62DF;&#x673A;&#x66F4;&#x52A0;&#x7075;&#x6D3B;&#x4E0E;&#x8F7B;&#x91CF;&#xFF08;&#x4E00;&#x822C;&#x90FD;&#x662F;&#x7ED3;&#x5408;&#x865A;&#x62DF;&#x673A;&#x4E0E;Docker&#x4E00;&#x8D77;&#x4F7F;&#x7528;&#xFF09;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/1e01e57f4653537be5740b84557938f44c8a8556cde441af54f72e8787fd8e2a" alt></p>
<p>Container&#x6280;&#x672F;&#x5176;&#x5B9E;&#x5E76;&#x4E0D;&#x662F;&#x4E2A;&#x65B0;&#x9C9C;&#x4E8B;&#x7269;&#xFF0C;&#x6700;&#x65E9;&#x53EF;&#x4EE5;&#x8FFD;&#x6EAF;&#x5230;UNIX&#x4E2D;&#x7684;chroot&#xFF08;&#x5728;1979&#x5E74;&#x7684;V7 Unix&#x4E2D;&#x5F15;&#x5165;&#xFF09;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x6539;&#x53D8;&#x5F53;&#x524D;&#x6B63;&#x5728;&#x8FD0;&#x884C;&#x7684;&#x8FDB;&#x7A0B;&#x53CA;&#x5176;&#x5B50;&#x76EE;&#x5F55;&#x7684;&#x6839;&#x76EE;&#x5F55;&#xFF0C;&#x5728;&#x8FD9;&#x79CD;&#x4FEE;&#x6539;&#x8FC7;&#x7684;&#x73AF;&#x5883;&#x4E0B;&#x8FD0;&#x884C;&#x7684;&#x7A0B;&#x5E8F;&#x4E0D;&#x80FD;&#x5728;&#x6307;&#x5B9A;&#x7684;&#x76EE;&#x5F55;&#x6811;&#x4E4B;&#x5916;&#x8BBF;&#x95EE;&#x6587;&#x4EF6;&#xFF0C;&#x4ECE;&#x800C;&#x9650;&#x5236;&#x7528;&#x6237;&#x7684;&#x6D3B;&#x52A8;&#x8303;&#x56F4;&#xFF0C;&#x4E3A;&#x8FDB;&#x7A0B;&#x63D0;&#x4F9B;&#x4E86;&#x9694;&#x79BB;&#x7A7A;&#x95F4;&#x3002;</p>
<p>&#x4E4B;&#x540E;&#x5404;&#x79CD;Unix&#x7248;&#x672C;&#x6D8C;&#x73B0;&#x51FA;&#x5F88;&#x591A;Container&#x6280;&#x672F;&#xFF0C;&#x5728;2006&#x5E74;&#xFF0C;Google&#x63D0;&#x51FA;&#x4E86;&#x201D;Process Containers&#x201D;&#x671F;&#x671B;&#x5728;Linux&#x5185;&#x6838;&#x4E2D;&#x5B9E;&#x73B0;&#x8FDB;&#x7A0B;&#x8D44;&#x6E90;&#x9694;&#x79BB;&#x7684;&#x76F8;&#x5173;&#x7279;&#x6027;&#xFF0C;&#x7531;&#x4E8E;Container&#x5728;Linux&#x5185;&#x6838;&#x4E2D;&#x7684;&#x5B9A;&#x4E49;&#x8FC7;&#x4E8E;&#x5BBD;&#x6CDB;&#x6DF7;&#x4E71;&#xFF0C;&#x540E;&#x6765;&#x8BE5;&#x9879;&#x76EE;&#x6539;&#x540D;&#x4E3A;CGroups&#xFF08;Control Groups&#xFF09;&#xFF0C;&#x5B9E;&#x73B0;&#x4E86;&#x5BF9;&#x8FDB;&#x7A0B;&#x7684;&#x8D44;&#x6E90;&#x9650;&#x5236;&#x3002;</p>
<p>2008&#x5E74;&#xFF0C;LXC&#xFF08;Linux Containers&#xFF09;&#x53D1;&#x5E03;&#xFF0C;&#x5B83;&#x662F;&#x4E00;&#x79CD;&#x5728;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5C42;&#x7EA7;&#x4E0A;&#x7684;&#x865A;&#x62DF;&#x5316;&#x65B9;&#x6CD5;&#xFF0C;&#x7528;&#x4E8E;&#x5728;Linux&#x7CFB;&#x7EDF;&#x4E0A;&#x901A;&#x8FC7;&#x5171;&#x4EAB;&#x4E00;&#x4E2A;&#x5185;&#x6838;&#x6765;&#x8FD0;&#x884C;&#x591A;&#x4E2A;&#x4E92;&#x76F8;&#x9694;&#x79BB;&#x7684;&#x7A0B;&#x5E8F;&#xFF08;Container&#xFF09;&#x3002;LXC&#x6B63;&#x662F;&#x7ED3;&#x5408;&#x4E86;Linux&#x5185;&#x6838;&#x4E2D;&#x7684;CGroups&#x548C;&#x5BF9;&#x5206;&#x79BB;&#x7684;&#x540D;&#x79F0;&#x7A7A;&#x95F4;&#x7684;&#x652F;&#x6301;&#x6765;&#x4E3A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x9694;&#x79BB;&#x7684;&#x73AF;&#x5883;&#x3002;&#x800C;Docker&#x4E5F;&#x662F;&#x57FA;&#x4E8E;LXC&#x5B9E;&#x73B0;&#x7684;&#xFF08;Docker&#x7684;&#x524D;&#x8EAB;&#x662F;dotClound&#x516C;&#x53F8;&#x4E2D;&#x7684;&#x5185;&#x90E8;&#x9879;&#x76EE;&#xFF0C;&#x5B83;&#x662F;&#x4E00;&#x5BB6;&#x63D0;&#x4F9B;PaaS&#x670D;&#x52A1;&#x7684;&#x516C;&#x53F8;&#x3002;&#xFF09;&#xFF0C;&#x5E76;&#x4F5C;&#x51FA;&#x4E86;&#x8BB8;&#x591A;&#x6539;&#x8FDB;&#x3002;</p>
<h3 id="&#x4F7F;&#x7528;Docker"><a href="#&#x4F7F;&#x7528;Docker" class="headerlink" title="&#x4F7F;&#x7528;Docker"></a>&#x4F7F;&#x7528;Docker</h3><hr>
<p>&#x5728;&#x4F7F;&#x7528;Docker&#x4E4B;&#x524D;&#x4F60;&#x9700;&#x8981;&#x5148;&#x5B89;&#x88C5;Docker&#xFF08;&#x8FD9;&#x597D;&#x50CF;&#x662F;&#x4E00;&#x53E5;&#x5E9F;&#x8BDD;&#x3002;&#x3002;&#x3002;&#xFF09;&#xFF0C;&#x6839;&#x636E;&#x4E0D;&#x540C;&#x7684;&#x5E73;&#x53F0;&#x5B89;&#x88C5;&#x65B9;&#x6CD5;&#x90FD;&#x4E0D;&#x76F8;&#x540C;&#xFF0C;&#x53EF;&#x4EE5;&#x53BB;&#x53C2;&#x8003;<a href="/external_links/47fe57ed485bd5d3faa72d391dce002e.html" target="blank" rel="noopener">Install Docker | Docker Documentation</a>&#x6216;&#x8005;&#x81EA;&#x884C;Google&#x3002;</p>
<p>&#x5B89;&#x88C5;&#x5B8C;&#x6BD5;&#x4E4B;&#x540E;&#xFF0C;&#x8F93;&#x5165;<code>docker --version</code>&#x6765;&#x786E;&#x8BA4;&#x662F;&#x5426;&#x5B89;&#x88C5;&#x6210;&#x529F;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;$ docker --version</span><br><span class="line">Docker version 17.05.0-ce-rc1, build 2878a85</span><br></pre></td></tr></table></figure>

<p>&#x4ECE;<a href="/external_links/939085619eb0ae46b4cc41c488483967.html" target="blank" rel="noopener">Docker Hub</a>&#x4E2D;&#x53EF;&#x4EE5;pull&#x5230;&#x5176;&#x4ED6;&#x4EBA;&#x53D1;&#x5E03;&#x7684;Image&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x6CE8;&#x518C;&#x4E00;&#x4E2A;&#x8D26;&#x53F7;&#x53BB;&#x53D1;&#x5E03;&#x81EA;&#x5DF1;&#x7684;Image&#x4E0E;&#x4ED6;&#x4EBA;&#x5171;&#x4EAB;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;[root@Jack ~]# docker search redis # &#x67E5;&#x770B;redis&#x955C;&#x50CF;&#x662F;&#x5426;&#x5B58;&#x5728;</span><br><span class="line">[root@Jack ~]# docker pull redis # &#x62C9;&#x53D6;redis&#x955C;&#x50CF;&#x5230;&#x672C;&#x673A;</span><br><span class="line">Using default tag: latest</span><br><span class="line">Trying to pull repository docker.io/library/redis ... </span><br><span class="line">latest: Pulling from docker.io/library/redis</span><br><span class="line">Digest: sha256:cd277716dbff2c0211c8366687d275d2b53112fecbf9d6c86e9853edb0900956</span><br><span class="line">[root@Jack ~]# docker images # &#x67E5;&#x770B;&#x955C;&#x50CF;&#x4FE1;&#x606F;</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">docker.io/python    3.6-onbuild         7195f9298ffb        2 weeks ago         691.1 MB</span><br><span class="line">docker.io/mongo     latest              d22888af0ce0        2 weeks ago         360.9 MB</span><br><span class="line">docker.io/redis     latest              8f2e175b3bd1        2 weeks ago         106.6 MB</span><br></pre></td></tr></table></figure>

<p>&#x6709;&#x4E86;Image&#xFF0C;&#x4E4B;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x5728;&#x5176;&#x4E4B;&#x4E0A;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;Container&#x4E86;&#xFF0C;&#x547D;&#x4EE4;&#x5982;&#x4E0B;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;[root@Jack ~]# docker run -d -p 6379:6379 redis # &#x8FD0;&#x884C;redis&#xFF0C;-p&#x4EE3;&#x8868;&#x5C06;&#x672C;&#x673A;&#x4E0A;6379&#x7AEF;&#x53E3;&#x6620;&#x5C04;&#x5230;Container&#x7684;6379&#x7AEF;&#x53E3; -d&#x4EE3;&#x8868;&#x5728;&#x540E;&#x53F0;&#x542F;&#x52A8;</span><br><span class="line">[root@Jack ~]# docker ps -a # &#x67E5;&#x770B;&#x5BB9;&#x5668;&#x4FE1;&#x606F;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x52A0;-a&#x53EA;&#x4F1A;&#x663E;&#x793A;&#x5F53;&#x524D;&#x8FD0;&#x884C;&#x4E2D;&#x7684;&#x5BB9;&#x5668;</span><br><span class="line"># &#x5982;&#x679C;&#x60F3;&#x8981;&#x8FDB;&#x5165;&#x5BB9;&#x5668;&#x4E2D;&#xFF0C;&#x90A3;&#x4E48;&#x9700;&#x8981;&#x6267;&#x884C;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;</span><br><span class="line">[root@Jack ~]# docker ps # &#x5148;&#x83B7;&#x5F97;&#x5BB9;&#x5668;&#x7684;id</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES</span><br><span class="line">1f928073b7eb        redis               &quot;docker-entrypoint.sh&quot;   45 seconds ago      Up 44 seconds       0.0.0.0:6379-&gt;6379/tcp   desperate_khorana</span><br><span class="line">[root@Jack ~]# docker exec -it 1f928073b7eb /bin/bash # &#x7136;&#x540E;&#x518D;&#x6267;&#x884C;&#x8BE5;&#x547D;&#x4EE4;&#x8FDB;&#x5165;&#x5230;&#x5BB9;&#x5668;&#x4E2D;</span><br><span class="line">root@1f928073b7eb:/data# touch hello_docker.txt # &#x5728;&#x5BB9;&#x5668;&#x4E2D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;</span><br><span class="line">root@1f928073b7eb:/data# exit # &#x9000;&#x51FA;</span><br><span class="line">exit</span><br><span class="line">[root@Jack ~]# </span><br><span class="line"># &#x4E5F;&#x53EF;&#x4EE5;&#x5728;&#x542F;&#x52A8;&#x65F6;&#x76F4;&#x63A5;&#x8FDB;&#x5165; &#x547D;&#x4EE4;&#x5982;&#x4E0B;</span><br><span class="line">[root@Jack ~]# docker run -d -it -p 6379:6379 redis /bin/bash</span><br></pre></td></tr></table></figure>

<p>&#x6211;&#x4EEC;&#x5BF9;Container&#x505A;&#x51FA;&#x4E86;&#x4FEE;&#x6539;&#xFF0C;&#x5982;&#x679C;&#x60F3;&#x8981;&#x4FDD;&#x7559;&#x8FD9;&#x4E2A;&#x4FEE;&#x6539;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;commit&#x547D;&#x4EE4;&#x6765;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x65B0;&#x7684;Image&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;# -m&#x4E3A;&#x63CF;&#x8FF0;&#x4FE1;&#x606F; -a&#x4E3A;&#x4F5C;&#x8005; 1f9&#x662F;&#x4F60;&#x8981;&#x4FDD;&#x5B58;&#x7684;&#x5BB9;&#x5668;id &#x53D6;&#x524D;3&#x4E2A;&#x5B57;&#x7B26; docker&#x53EF;&#x4EE5;&#x81EA;&#x884C;&#x8BC6;&#x522B;</span><br><span class="line"># sylvanassun/redis&#x4E3A;&#x955C;&#x50CF;&#x540D; :test &#x4E3A;&#x4E00;&#x4E2A;tag &#x4E00;&#x822C;&#x7528;&#x4E8E;&#x6807;&#x8BC6;&#x7248;&#x672C;</span><br><span class="line">[root@Jack ~]# docker commit -m &quot;test&quot; -a &quot;SylvanasSun&quot; 1f9 sylvanassun/redis:test</span><br><span class="line">sha256:e7073e8e5bd70b8d58092fd6bd8c2551e65dd29241c235eddf2a7f4b4b25cbbd</span><br><span class="line">[root@Jack ~]# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">sylvanassun/redis   test                e7073e8e5bd7        2 seconds ago       106.6 MB</span><br><span class="line">docker.io/python    3.6-onbuild         7195f9298ffb        2 weeks ago         691.1 MB</span><br><span class="line">docker.io/mongo     latest              d22888af0ce0        2 weeks ago         360.9 MB</span><br><span class="line">docker.io/redis     latest              8f2e175b3bd1        2 weeks ago         106.6 MB</span><br></pre></td></tr></table></figure>

<p>&#x60F3;&#x5220;&#x9664;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x6216;&#x955C;&#x50CF;&#x4E5F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x4F46;&#x5728;&#x5220;&#x9664;&#x955C;&#x50CF;&#x524D;&#x9700;&#x8981;&#x5148;&#x5220;&#x9664;&#x4F9D;&#x8D56;&#x4E8E;&#x5B83;&#x7684;&#x5BB9;&#x5668;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;[root@Jack ~]# docker stop 1f9 # &#x5173;&#x95ED;&#x8FD0;&#x884C;&#x4E2D;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x76F8;&#x5E94;&#x7684;&#x4E5F;&#x6709;docker start id&#x547D;&#x4EE4;&#x6765;&#x542F;&#x52A8;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;</span><br><span class="line">1f9</span><br><span class="line">[root@Jack ~]# docker rm 1f9 # &#x5220;&#x9664;&#x5BB9;&#x5668;</span><br><span class="line">1f9</span><br><span class="line">[root@Jack ~]# docker rmi e70 # &#x5220;&#x9664;&#x4E0A;&#x9762;&#x4FDD;&#x5B58;&#x7684;&#x955C;&#x50CF;</span><br><span class="line">Untagged: sylvanassun/redis:test</span><br><span class="line">Deleted: sha256:e7073e8e5bd70b8d58092fd6bd8c2551e65dd29241c235eddf2a7f4b4b25cbbd</span><br><span class="line">Deleted: sha256:751db4a870e5f703082b31c1614a19c86e0c967334a61f5d22b2511072aef56d</span><br></pre></td></tr></table></figure>

<p>&#x5982;&#x679C;&#x60F3;&#x8981;&#x81EA;&#x5DF1;&#x6784;&#x5EFA;&#x4E00;&#x4E2A;&#x955C;&#x50CF;&#xFF0C;&#x90A3;&#x4E48;&#x9700;&#x8981;&#x7F16;&#x5199;Dockerfile&#x6587;&#x4EF6;&#xFF0C;&#x8BE5;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x4E86;&#x955C;&#x50CF;&#x7684;&#x4F9D;&#x8D56;&#x73AF;&#x5883;&#x4EE5;&#x53CA;&#x5982;&#x4F55;&#x914D;&#x7F6E;&#x4F60;&#x7684;&#x5E94;&#x7528;&#x73AF;&#x5883;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;# &#x4F7F;&#x7528;python:2.7-slim &#x4F5C;&#x4E3A;&#x7236;&#x955C;&#x50CF;</span><br><span class="line">FROM python:2.7-slim</span><br><span class="line"></span><br><span class="line"># &#x8DF3;&#x8F6C;&#x5230;/app &#x5176;&#x5B9E;&#x5C31;&#x662F;cd&#x547D;&#x4EE4;</span><br><span class="line">WORKDIR /app</span><br><span class="line"></span><br><span class="line"># &#x5C06;&#x5F53;&#x524D;&#x76EE;&#x5F55;&#x7684;&#x5185;&#x5BB9;(.)&#x590D;&#x5236;&#x5230;&#x955C;&#x50CF;&#x7684;/app&#x76EE;&#x5F55;&#x4E0B;</span><br><span class="line">ADD . /app</span><br><span class="line"></span><br><span class="line"># RUN&#x4EE3;&#x8868;&#x8FD0;&#x884C;&#x7684;shell&#x547D;&#x4EE4;&#xFF0C;&#x4E0B;&#x9762;&#x8FD9;&#x6761;&#x547D;&#x4EE4;&#x662F;&#x6839;&#x636E;requirements.txt&#x5B89;&#x88C5;python&#x5E94;&#x7528;&#x7684;&#x4F9D;&#x8D56;&#x5305;</span><br><span class="line">RUN pip install --trusted-host pypi.python.org -r requirements.txt</span><br><span class="line"></span><br><span class="line"># &#x66B4;&#x9732;80&#x7AEF;&#x53E3;&#x8BA9;&#x5916;&#x754C;&#x8BBF;&#x95EE;</span><br><span class="line">EXPOSE 80</span><br><span class="line"></span><br><span class="line"># &#x5B9A;&#x4E49;&#x73AF;&#x5883;&#x53D8;&#x91CF;</span><br><span class="line">ENV NAME World</span><br><span class="line"></span><br><span class="line"># &#x5F53;&#x5BB9;&#x5668;&#x542F;&#x52A8;&#x65F6;&#x6267;&#x884C;&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x5B83;&#x4E0E;RUN&#x4E0D;&#x540C;&#xFF0C;&#x53EA;&#x5728;&#x5BB9;&#x5668;&#x542F;&#x52A8;&#x65F6;&#x6267;&#x884C;&#x4E00;&#x6B21;</span><br><span class="line">CMD [&quot;python&quot;, &quot;app.py&quot;]</span><br></pre></td></tr></table></figure>

<p>&#x7136;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>docker build -t xxx/xxxx .</code>&#x547D;&#x4EE4;&#x6765;&#x6784;&#x5EFA;&#x955C;&#x50CF;&#xFF0C;<code>-t</code>&#x540E;&#x9762;&#x662F;&#x955C;&#x50CF;&#x540D;&#x4E0E;tag&#x7B49;&#x4FE1;&#x606F;&#xFF0C;&#x6CE8;&#x610F;<code>.</code>&#x8868;&#x793A;&#x5728;&#x5F53;&#x524D;&#x76EE;&#x5F55;&#x4E0B;&#x5BFB;&#x627E;Dockerfile&#x6587;&#x4EF6;&#x3002;</p>
<p>&#x5B66;&#x4F1A;&#x5982;&#x4F55;&#x6784;&#x5EFA;&#x81EA;&#x5DF1;&#x7684;&#x955C;&#x50CF;&#x4E4B;&#x540E;&#xFF0C;&#x4F60;&#x662F;&#x5426;&#x4E5F;&#x60F3;&#x5C06;&#x5B83;&#x53D1;&#x5E03;&#x5230;<a href="/external_links/939085619eb0ae46b4cc41c488483967.html" target="blank" rel="noopener">Docker Hub</a>&#x4E0A;&#x4E0E;&#x4ED6;&#x4EBA;&#x5206;&#x4EAB;&#x5462;&#xFF1F;&#x8981;&#x60F3;&#x505A;&#x5230;&#x8FD9;&#x4E00;&#x70B9;&#xFF0C;&#x9700;&#x8981;&#x5148;&#x6CE8;&#x518C;&#x4E00;&#x4E2A;<a href="/external_links/939085619eb0ae46b4cc41c488483967.html" target="blank" rel="noopener">Docker Hub</a>&#x8D26;&#x53F7;&#xFF0C;&#x4E4B;&#x540E;&#x901A;&#x8FC7;<code>docker login</code>&#x547D;&#x4EE4;&#x767B;&#x5F55;&#xFF0C;&#x7136;&#x540E;&#x518D;<code>docker push image name</code>&#xFF0C;&#x5C31;&#x50CF;&#x5728;&#x4F7F;&#x7528;Git&#x4E00;&#x6837;&#x7B80;&#x5355;&#x3002;</p>
<p>&#x5173;&#x4E8E;Docker&#x7684;&#x66F4;&#x591A;&#x547D;&#x4EE4;&#x4E0E;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#xFF0C;&#x8BF7;&#x53C2;&#x8003;<a href="/external_links/df79dce6c14ba39e68ae4f23f8105818.html" target="blank" rel="noopener">Docker Documentation | Docker Documentation</a>&#xFF0C;&#x53E6;&#x5916;&#x6211;&#x8FD8;&#x63A8;&#x8350;&#x4F7F;&#x7528;<a href="/external_links/b290a7295e2f3753bd8c2d0761a6a41f.html" target="blank" rel="noopener">Docker Compose</a>&#x6765;&#x6784;&#x5EFA;&#x955C;&#x50CF;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x5F88;&#x65B9;&#x4FBF;&#x5730;&#x7EC4;&#x5408;&#x7BA1;&#x7406;&#x591A;&#x4E2A;&#x955C;&#x50CF;&#x3002;</p>
<h3 id="&#x7ED3;&#x8BED;"><a href="#&#x7ED3;&#x8BED;" class="headerlink" title="&#x7ED3;&#x8BED;"></a>&#x7ED3;&#x8BED;</h3><hr>
<p>Docker&#x63D0;&#x4F9B;&#x4E86;&#x975E;&#x5E38;&#x5F3A;&#x5927;&#x7684;&#x81EA;&#x52A8;&#x5316;&#x90E8;&#x7F72;&#x65B9;&#x5F0F;&#x4E0E;&#x7075;&#x6D3B;&#x6027;&#xFF0C;&#x5BF9;&#x591A;&#x4E2A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E4B;&#x95F4;&#x505A;&#x5230;&#x4E86;&#x89E3;&#x8026;&#xFF0C;&#x63D0;&#x4F9B;&#x4E86;&#x5F00;&#x53D1;&#x4E0A;&#x7684;&#x654F;&#x6377;&#x6027;&#x3001;&#x53EF;&#x63A7;&#x6027;&#x4EE5;&#x53CA;&#x53EF;&#x79FB;&#x690D;&#x6027;&#x3002;&#x540C;&#x65F6;&#xFF0C;Docker&#x4E5F;&#x5728;&#x4E0D;&#x65AD;&#x5730;&#x5E2E;&#x52A9;&#x8D8A;&#x6765;&#x8D8A;&#x591A;&#x7684;&#x4F01;&#x4E1A;&#x5B9E;&#x73B0;&#x4E86;&#x5411;&#x4E91;&#x7AEF;&#x8FC1;&#x79FB;&#x3001;&#x5411;&#x5FAE;&#x670D;&#x52A1;&#x8F6C;&#x578B;&#x4EE5;&#x53CA;&#x5411;DevOps&#x6A21;&#x5F0F;&#x7684;&#x5B9E;&#x8DF5;&#x3002;</p>
<p>&#x5982;&#x4ECA;&#xFF0C;&#x5FAE;&#x670D;&#x52A1;&#x4E0E;DevOps&#x706B;&#x7206;&#x7A0B;&#x5EA6;&#x65E5;&#x76CA;&#x6E10;&#x9AD8;&#xFF0C;&#x4F60;&#x53C8;&#x6709;&#x4F55;&#x7406;&#x7531;&#x9009;&#x62E9;&#x62D2;&#x7EDD;Docker&#x5462;&#xFF1F;&#x8BA9;&#x6211;&#x4EEC;&#x4E00;&#x8D77;&#x9009;&#x62E9;&#x62E5;&#x62B1;Docker&#xFF0C;&#x62E5;&#x62B1;&#x672A;&#x6765;&#xFF01;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/a53168ade50751ea8a6e5d20ef838dab.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903512350916616.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903512350916616.html" itemprop="url">四叉树上如何求希尔伯特曲线的邻居 ？</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-19T18:48:47+08:00">
                2017-11-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x5173;&#x4E8E;&#x90BB;&#x5C45;&#x7684;&#x5B9A;&#x4E49;&#xFF0C;&#x76F8;&#x90BB;&#x5373;&#x4E3A;&#x90BB;&#x5C45;&#xFF0C;&#x90A3;&#x4E48;&#x90BB;&#x5C45;&#x5206;&#x4E3A;2&#x79CD;&#xFF0C;&#x8FB9;&#x76F8;&#x90BB;&#x548C;&#x70B9;&#x76F8;&#x90BB;&#x3002;&#x8FB9;&#x76F8;&#x90BB;&#x7684;&#x6709;4&#x4E2A;&#x65B9;&#x5411;&#xFF0C;&#x4E0A;&#x4E0B;&#x5DE6;&#x53F3;&#x3002;&#x70B9;&#x76F8;&#x90BB;&#x7684;&#x4E5F;&#x6709;4&#x4E2A;&#x65B9;&#x5411;&#xFF0C;&#x5373;4&#x4E2A;&#x9876;&#x70B9;&#x76F8;&#x90BB;&#x7684;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/3b9b6f909be25496cda18772d8f4b5bc8e0ccd574343636d6e03a3299e4f610a" alt></p>
<p>&#x5982;&#x4E0A;&#x56FE;&#xFF0C;&#x7EFF;&#x8272;&#x7684;&#x533A;&#x57DF;&#x662F;&#x4E00;&#x9897;&#x56DB;&#x53C9;&#x6811;&#x8868;&#x793A;&#x7684;&#x8303;&#x56F4;&#xFF0C;&#x56DB;&#x53C9;&#x6811;&#x4E0A;&#x9762;&#x6709;&#x4E00;&#x4E2A;&#x70B9;&#xFF0C;&#x56FE;&#x4E2D;&#x9EC4;&#x8272;&#x533A;&#x57DF;&#x6807;&#x660E;&#x7684;&#x70B9;&#x3002;&#x73B0;&#x5728;&#x60F3;&#x6C42;&#x56DB;&#x53C9;&#x6811;&#x4E0A;&#x9EC4;&#x8272;&#x7684;&#x70B9;&#x7684;&#x5E0C;&#x5C14;&#x4F2F;&#x7279;&#x66F2;&#x7EBF;&#x90BB;&#x5C45;&#x3002;&#x56FE;&#x4E2D;&#x9ED1;&#x8272;&#x7684;&#x7EBF;&#x5C31;&#x662F;&#x4E00;&#x9897;&#x7A7F;&#x8FC7;&#x56DB;&#x53C9;&#x6811;&#x7684;&#x5E0C;&#x5C14;&#x4F2F;&#x7279;&#x66F2;&#x7EBF;&#x3002;&#x5E0C;&#x5C14;&#x4F2F;&#x7279;&#x66F2;&#x7EBF;&#x7684;&#x8D77;&#x70B9;0&#x5728;&#x5DE6;&#x4E0A;&#x89D2;&#x7684;&#x65B9;&#x683C;&#x4E2D;&#xFF0C;&#x7EC8;&#x70B9;63&#x5728;&#x53F3;&#x4E0A;&#x89D2;&#x7684;&#x65B9;&#x683C;&#x4E2D;&#x3002;</p>
<p>&#x7EA2;&#x8272;&#x7684;&#x56DB;&#x4E2A;&#x683C;&#x5B50;&#x662F;&#x9EC4;&#x8272;&#x683C;&#x5B50;&#x8FB9;&#x76F8;&#x90BB;&#x90BB;&#x5C45;&#xFF0C;&#x84DD;&#x8272;&#x7684;&#x56DB;&#x4E2A;&#x683C;&#x5B50;&#x662F;&#x9EC4;&#x8272;&#x683C;&#x5B50;&#x7684;&#x9876;&#x70B9;&#x76F8;&#x90BB;&#x7684;&#x90BB;&#x5C45;&#xFF0C;&#x6240;&#x4EE5;&#x9EC4;&#x8272;&#x683C;&#x5B50;&#x7684;&#x90BB;&#x5C45;&#x4E3A;8&#x4E2A;&#x683C;&#x5B50;&#xFF0C;&#x5206;&#x522B;&#x8868;&#x793A;&#x7684;&#x70B9;&#x662F;8&#xFF0C;9&#xFF0C;54&#xFF0C;11&#xFF0C;53&#xFF0C;30&#xFF0C;31&#xFF0C;32 &#x3002;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x6765;&#x8FD9;&#x4E9B;&#x90BB;&#x5C45;&#x5728;&#x8868;&#x793A;&#x7684;&#x70B9;&#x4E0A;&#x9762;&#x5E76;&#x4E0D;&#x662F;&#x76F8;&#x90BB;&#x7684;&#x3002;</p>
<p>&#x90A3;&#x4E48;&#x600E;&#x4E48;&#x6C42;&#x56DB;&#x53C9;&#x6811;&#x4E0A;&#x4EFB;&#x610F;&#x4E00;&#x70B9;&#x7684;&#x5E0C;&#x5C14;&#x4F2F;&#x7279;&#x66F2;&#x7EBF;&#x90BB;&#x5C45;&#x5462;&#xFF1F;</p>
<h2 id="&#x4E00;-&#x8FB9;&#x90BB;&#x5C45;"><a href="#&#x4E00;-&#x8FB9;&#x90BB;&#x5C45;" class="headerlink" title="&#x4E00;. &#x8FB9;&#x90BB;&#x5C45;"></a>&#x4E00;. &#x8FB9;&#x90BB;&#x5C45;</h2><p>&#x8FB9;&#x90BB;&#x5C45;&#x6700;&#x76F4;&#x63A5;&#x7684;&#x60F3;&#x6CD5;&#x5C31;&#x662F; &#x5148;&#x62FF;&#x5230;&#x4E2D;&#x5FC3;&#x70B9;&#x7684;&#x5750;&#x6807; (i&#xFF0C;j) &#xFF0C;&#x7136;&#x540E;&#x901A;&#x8FC7;&#x5750;&#x6807;&#x7CFB;&#x7684;&#x5173;&#x7CFB;&#xFF0C;&#x62FF;&#x5230;&#x4E0E;&#x5B83;&#x8FB9;&#x76F8;&#x90BB;&#x7684; Cell &#x7684;&#x5750;&#x6807; (i + 1&#xFF0C;j) &#xFF0C; (i - 1&#xFF0C;j) &#xFF0C; (i&#xFF0C;j - 1) &#xFF0C; (i&#xFF0C;j + 1) &#x3002;</p>
<p>&#x5B9E;&#x9645;&#x505A;&#x6CD5;&#x4E5F;&#x662F;&#x5982;&#x6B64;&#x3002;&#x4E0D;&#x8FC7;&#x8FD9;&#x91CC;&#x6D89;&#x53CA;&#x5230;&#x9700;&#x8981;&#x8F6C;&#x6362;&#x7684;&#x5730;&#x65B9;&#x3002;&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x628A;&#x5E0C;&#x5C14;&#x4F2F;&#x7279;&#x66F2;&#x7EBF;&#x4E0A;&#x7684;&#x70B9;&#x8F6C;&#x6362;&#x6210;&#x5750;&#x6807;&#x4EE5;&#x540E;&#x624D;&#x80FD;&#x6309;&#x7167;&#x4E0A;&#x9762;&#x7684;&#x601D;&#x8DEF;&#x6765;&#x8BA1;&#x7B97;&#x8FB9;&#x90BB;&#x5C45;&#x3002;</p>
<p>&#x5173;&#x4E8E; CellID &#x7684;&#x751F;&#x6210;&#x4E0E;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF0C;&#x89C1;&#x7B14;&#x8005;&#x8FD9;&#x7BC7;<a href="/external_links/81ea90798b2b64d6c2984c9ff549785f.html" target="blank" rel="noopener">&#x300A;Google S2 &#x4E2D;&#x7684; CellID &#x662F;&#x5982;&#x4F55;&#x751F;&#x6210;&#x7684; &#xFF1F;&#x300B;</a></p>
<p>&#x6309;&#x7167;&#x4E0A;&#x8FF0;&#x7684;&#x601D;&#x8DEF;&#xFF0C;&#x5B9E;&#x73B0;&#x51FA;&#x6765;&#x7684;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line"></span><br><span class="line">func (ci CellID) EdgeNeighbors() [4]CellID {</span><br><span class="line">    level := ci.Level()</span><br><span class="line">    size := sizeIJ(level)</span><br><span class="line">    f, i, j, _ := ci.faceIJOrientation()</span><br><span class="line">    return [4]CellID{</span><br><span class="line">        cellIDFromFaceIJWrap(f, i, j-size).Parent(level),</span><br><span class="line">        cellIDFromFaceIJWrap(f, i+size, j).Parent(level),</span><br><span class="line">        cellIDFromFaceIJWrap(f, i, j+size).Parent(level),</span><br><span class="line">        cellIDFromFaceIJWrap(f, i-size, j).Parent(level),</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8FB9;&#x6309;&#x7167;&#xFF0C;&#x4E0B;&#x8FB9;&#xFF0C;&#x53F3;&#x8FB9;&#xFF0C;&#x4E0A;&#x8FB9;&#xFF0C;&#x5DE6;&#x8FB9;&#xFF0C;&#x9006;&#x65F6;&#x9488;&#x7684;&#x65B9;&#x5411;&#x4F9D;&#x6B21;&#x7F16;&#x53F7;0&#xFF0C;1&#xFF0C;2&#xFF0C;3 &#x3002;</p>
<p>&#x63A5;&#x4E0B;&#x6765;&#x5177;&#x4F53;&#x5206;&#x6790;&#x4E00;&#x4E0B;&#x91CC;&#x9762;&#x7684;&#x5B9E;&#x73B0;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">func sizeIJ(level int) int {</span><br><span class="line">    return 1 &lt;&lt; uint(maxLevel-level)</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>sizeIJ &#x4FDD;&#x5B58;&#x7684;&#x662F;&#x5F53;&#x524D; Level &#x7684;&#x683C;&#x5B50;<strong>&#x8FB9;&#x957F;</strong>&#x5927;&#x5C0F;&#x3002;&#x8FD9;&#x4E2A;&#x5927;&#x5C0F;&#x662F;&#x76F8;&#x5BF9;&#x4E8E; Level 30 &#x6765;&#x8BF4;&#x7684;&#x3002;&#x6BD4;&#x5982; level = 29&#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x7684; sizeIJ &#x5C31;&#x662F;2&#xFF0C;&#x4EE3;&#x8868; Level 29 &#x7684;&#x4E00;&#x4E2A;&#x683C;&#x5B50;&#x8FB9;&#x957F;&#x662F;&#x7531;2&#x4E2A; Level 30 &#x7684;&#x683C;&#x5B50;&#x7EC4;&#x6210;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x4E5F;&#x5C31;&#x662F;2^2^=4&#x4E2A;&#x5C0F;&#x683C;&#x5B50;&#x7EC4;&#x6210;&#x7684;&#x3002;&#x5982;&#x679C;&#x662F; level = 28&#xFF0C;&#x90A3;&#x4E48;&#x8FB9;&#x957F;&#x5C31;&#x662F;4&#xFF0C;&#x7531;16&#x4E2A;&#x5C0F;&#x683C;&#x5B50;&#x7EC4;&#x6210;&#x3002;&#x5176;&#x4ED6;&#x90FD;&#x4EE5;&#x6B64;&#x7C7B;&#x63A8;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">func (ci CellID) faceIJOrientation() (f, i, j, orientation int) {</span><br><span class="line"></span><br><span class="line">    f = ci.Face()</span><br><span class="line">    orientation = f &amp; swapMask</span><br><span class="line">    nbits := maxLevel - 7*lookupBits // first iteration</span><br><span class="line"></span><br><span class="line">    for k := 7; k &gt;= 0; k-- {</span><br><span class="line">        orientation += (int(uint64(ci)&gt;&gt;uint64(k*2*lookupBits+1)) &amp; ((1 &lt;&lt; uint((2 * nbits))) - 1)) &lt;&lt; 2</span><br><span class="line">        orientation = lookupIJ[orientation]</span><br><span class="line">        i += (orientation &gt;&gt; (lookupBits + 2)) &lt;&lt; uint(k*lookupBits)</span><br><span class="line">        j += ((orientation &gt;&gt; 2) &amp; ((1 &lt;&lt; lookupBits) - 1)) &lt;&lt; uint(k*lookupBits)</span><br><span class="line">        orientation &amp;= (swapMask | invertMask)</span><br><span class="line">        nbits = lookupBits // following iterations</span><br><span class="line">    }</span><br><span class="line">    // &#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x5224;&#x65AD;&#x8BE6;&#x7EC6;&#x89E3;&#x91CA;</span><br><span class="line">    if ci.lsb()&amp;0x1111111111111110 != 0 {</span><br><span class="line">        orientation ^= swapMask</span><br><span class="line">    }</span><br><span class="line">    return</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x5C31;&#x662F;&#x628A; CellID &#x518D;&#x5206;&#x89E3;&#x56DE;&#x539F;&#x6765;&#x7684; i &#x548C; j&#x3002;&#x8FD9;&#x91CC;&#x5177;&#x4F53;&#x7684;&#x8FC7;&#x7A0B;&#x5728;&#x7B14;&#x8005;&#x8FD9;&#x7BC7;<a href="/external_links/81ea90798b2b64d6c2984c9ff549785f.html" target="blank" rel="noopener">&#x300A;Google S2 &#x4E2D;&#x7684; CellID &#x662F;&#x5982;&#x4F55;&#x751F;&#x6210;&#x7684; &#xFF1F;&#x300B;</a>&#x91CC;&#x9762;&#x7684; cellIDFromFaceIJ &#x65B9;&#x6CD5;&#x91CC;&#x9762;&#x6709;&#x8BE6;&#x7EC6;&#x7684;&#x53D9;&#x8FF0;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x518D;&#x8D58;&#x8FF0;&#x4E86;&#x3002;cellIDFromFaceIJ &#x65B9;&#x6CD5;&#x548C; faceIJOrientation &#x65B9;&#x6CD5;&#x662F;&#x4E92;&#x4E3A;&#x9006;&#x65B9;&#x6CD5;&#x3002;<br>cellIDFromFaceIJ &#x662F;&#x628A; face&#xFF0C;i&#xFF0C;j &#x8FD9;&#x4E2A;&#x5F53;&#x5165;&#x53C2;&#x4F20;&#x8FDB;&#x53BB;&#xFF0C;&#x8FD4;&#x56DE;&#x503C;&#x662F; CellID&#xFF0C;faceIJOrientation &#x662F;&#x628A; CellID &#x5206;&#x89E3;&#x6210; face&#xFF0C;i&#xFF0C;j&#xFF0C;orientation&#x3002;faceIJOrientation &#x6BD4; cellIDFromFaceIJ &#x5206;&#x89E3;&#x51FA;&#x6765;&#x591A;&#x4E00;&#x4E2A; orientation&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x91CD;&#x70B9;&#x89E3;&#x91CA;&#x7684;&#x662F; orientation &#x600E;&#x4E48;&#x8BA1;&#x7B97;&#x51FA;&#x6765;&#x7684;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x77E5;&#x9053; CellID &#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x662F; 3&#x4F4D; face + 60&#x4F4D; position + 1&#x4F4D;&#x6807;&#x5FD7;&#x4F4D;&#x3002;&#x90A3;&#x4E48;&#x5BF9;&#x4E8E; Level - n &#x7684;&#x975E;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#xFF0C;3&#x4F4D; face &#x4E4B;&#x540E;&#xFF0C;&#x4E00;&#x5B9A;&#x662F;&#x6709; 2  <em>n &#x4F4D;&#x4E8C;&#x8FDB;&#x5236;&#x4F4D;&#xFF0C;&#x7136;&#x540E;&#x7D27;&#x63A5;&#x7740; 2</em>(maxLevel - n) + 1 &#x4F4D;&#x4EE5;1&#x5F00;&#x5934;&#x7684;&#xFF0C;&#x672B;&#x5C3E;&#x90FD;&#x662F;0&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x4F4D;&#x3002;maxLevel = 30 &#x3002;</p>
<p>&#x4F8B;&#x5982; Level - 16&#xFF0C;&#x4E2D;&#x95F4;&#x4E00;&#x5B9A;&#x662F;&#x6709;32&#x4F4D;&#x4E8C;&#x8FDB;&#x5236;&#x4F4D;&#xFF0C;&#x7136;&#x540E;&#x7D27;&#x63A5;&#x7740; 2*(30 - 16) + 1 = 29&#x4F4D;&#x3002;&#x8FD9;29&#x4F4D;&#x662F;&#x9996;&#x4F4D;&#x4E3A;1&#xFF0C;&#x672B;&#x5C3E;&#x4E3A;0&#x7EC4;&#x6210;&#x7684;&#x3002;3 + 32 + 29 = 64 &#x4F4D;&#x3002;64&#x4F4D; CellID &#x5C31;&#x8FD9;&#x6837;&#x7EC4;&#x6210;&#x7684;&#x3002;</p>
<p>&#x5F53; n = 30&#xFF0C;3 + 60 + 1 = 64&#xFF0C;&#x6240;&#x4EE5;&#x672B;&#x5C3E;&#x7684;1&#x5E76;&#x6CA1;&#x6709;&#x8D77;&#x4EFB;&#x4F55;&#x4F5C;&#x7528;&#x3002;&#x5F53; n = 29&#xFF0C;3 + 58 + 3 = 64&#xFF0C;&#x4E8E;&#x662F;&#x672B;&#x5C3E;&#x4E00;&#x5B9A;&#x662F; 100 &#x7EC4;&#x6210;&#x7684;&#x3002;10&#x5BF9;&#x65B9;&#x5411;&#x5E76;&#x4E0D;&#x8D77;&#x4EFB;&#x4F55;&#x4F5C;&#x7528;&#xFF0C;&#x6700;&#x540E;&#x591A;&#x7684;&#x4E00;&#x4E2A;0&#x4E5F;&#x5BF9;&#x65B9;&#x5411;&#x4E0D;&#x8D77;&#x4EFB;&#x4F55;&#x4F5C;&#x7528;&#x3002;&#x5173;&#x952E;&#x5C31;&#x662F;&#x770B;10&#x548C;0&#x4E4B;&#x95F4;&#x6709;&#x591A;&#x5C11;&#x4E2A;00 &#x3002;&#x5F53; n = 28&#xFF0C;3 + 56 + 5 = 64&#xFF0C;&#x672B;&#x5C3E;5&#x4F4D;&#x662F; 10000&#xFF0C;&#x5728;10&#x548C;0&#x4E4B;&#x95F4;&#x6709;&#x4E00;&#x4E2A;&#x201C;00&#x201D;&#x3002;&#x201C;00&#x201D;&#x662F;&#x4F1A;&#x5BF9;&#x65B9;&#x5411;&#x4EA7;&#x751F;&#x5F71;&#x54CD;&#xFF0C;&#x521D;&#x59CB;&#x7684;&#x65B9;&#x5411;&#x5E94;&#x8BE5;&#x518D;&#x5F02;&#x6216; 01 &#x624D;&#x80FD;&#x5F97;&#x5230;&#x3002;</p>
<p>&#x5173;&#x4E8E; &#x201C;00&#x201D; &#x4F1A;&#x5BF9;&#x539F;&#x59CB;&#x7684;&#x65B9;&#x5411;&#x4EA7;&#x751F;&#x5F71;&#x54CD;&#xFF0C;&#x8FD9;&#x70B9;&#x5176;&#x5B9E;&#x6BD4;&#x8F83;&#x597D;&#x7406;&#x89E3;&#x3002;CellID &#x4ECE;&#x6700;&#x5148;&#x5F00;&#x59CB;&#x7684;&#x65B9;&#x5411;&#x8FDB;&#x884C;&#x56DB;&#x5206;&#xFF0C;&#x6BCF;&#x6B21;&#x56DB;&#x5206;&#x90FD;&#x5C06;&#x5E26;&#x6765;&#x4E00;&#x6B21;&#x65B9;&#x5411;&#x7684;&#x53D8;&#x6362;&#x3002;&#x76F4;&#x5230;&#x53D8;&#x6362;&#x5230;&#x6700;&#x540E;&#x4E00;&#x4E2A;4&#x4E2A;&#x5C0F;&#x683C;&#x5B50;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x65B9;&#x5411;&#x5C31;&#x4E0D;&#x4F1A;&#x53D8;&#x5316;&#x4E86;&#xFF0C;&#x56E0;&#x4E3A;&#x5728;4&#x4E2A;&#x5C0F;&#x683C;&#x5B50;&#x4E4B;&#x95F4;&#x5C31;&#x53EF;&#x4EE5;&#x552F;&#x4E00;&#x786E;&#x5B9A;&#x662F;&#x54EA;&#x4E00;&#x4E2A; Cell &#x88AB;&#x9009;&#x4E2D;&#x3002;&#x6240;&#x4EE5;&#x8FD9;&#x4E5F;&#x662F;&#x4E0A;&#x9762;&#x770B;&#x5230;&#x4E86;&#xFF0C; Level - 30 &#x548C; Level - 29 &#x7684;&#x65B9;&#x5411;&#x662F;&#x4E0D;&#x53D8;&#x7684;&#xFF0C;&#x9664;&#x6B64;&#x4EE5;&#x5916;&#x7684; Level &#x662F;&#x9700;&#x8981;&#x518D;&#x5F02;&#x6216;&#x4E00;&#x6B21; 01 &#xFF0C;&#x53D8;&#x6362;&#x4EE5;&#x540E;&#x5F97;&#x5230;&#x539F;&#x59CB;&#x7684; orientation&#x3002;</p>
<p>&#x6700;&#x540E;&#x8FDB;&#x884C;&#x8F6C;&#x6362;&#xFF0C;&#x5177;&#x4F53;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">func cellIDFromFaceIJWrap(f, i, j int) CellID {</span><br><span class="line">    // 1.</span><br><span class="line">    i = clamp(i, -1, maxSize)</span><br><span class="line">    j = clamp(j, -1, maxSize)</span><br><span class="line"></span><br><span class="line">    // 2.</span><br><span class="line">    const scale = 1.0 / maxSize</span><br><span class="line">    limit := math.Nextafter(1, 2)</span><br><span class="line">    u := math.Max(-limit, math.Min(limit, scale*float64((i&lt;&lt;1)+1-maxSize)))</span><br><span class="line">    v := math.Max(-limit, math.Min(limit, scale*float64((j&lt;&lt;1)+1-maxSize)))</span><br><span class="line">    // 3.</span><br><span class="line">    f, u, v = xyzToFaceUV(faceUVToXYZ(f, u, v))</span><br><span class="line">    return cellIDFromFaceIJ(f, stToIJ(0.5*(u+1)), stToIJ(0.5*(v+1)))</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8F6C;&#x6362;&#x8FC7;&#x7A0B;&#x603B;&#x5171;&#x5206;&#x4E3A;&#x4E09;&#x6B65;&#x3002;&#x7B2C;&#x4E00;&#x6B65;&#x5148;&#x5904;&#x7406; i&#xFF0C;j &#x8FB9;&#x754C;&#x7684;&#x95EE;&#x9898;&#x3002;&#x7B2C;&#x4E8C;&#x6B65;&#xFF0C;&#x5C06; i&#xFF0C;j &#x8F6C;&#x6362;&#x6210; u&#xFF0C;v &#x3002;&#x7B2C;&#x4E09;&#x6B65;&#xFF0C;u&#xFF0C;v &#x8F6C; xyz&#xFF0C;&#x518D;&#x8F6C;&#x56DE; u&#xFF0C;v&#xFF0C;&#x6700;&#x540E;&#x8F6C;&#x56DE; CellID &#x3002;</p>
<p>&#x7B2C;&#x4E00;&#x6B65;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">func clamp(x, min, max int) int {</span><br><span class="line">    if x &lt; min {</span><br><span class="line">        return min</span><br><span class="line">    }</span><br><span class="line">    if x &gt; max {</span><br><span class="line">        return max</span><br><span class="line">    }</span><br><span class="line">    return x</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>clamp &#x51FD;&#x6570;&#x5C31;&#x662F;&#x7528;&#x6765;&#x9650;&#x5B9A; i &#xFF0C; j &#x7684;&#x8303;&#x56F4;&#x7684;&#x3002;i&#xFF0C;j &#x7684;&#x8303;&#x56F4;&#x59CB;&#x7EC8;&#x9650;&#x5B9A;&#x5728; [-1&#xFF0C;maxSize] &#x4E4B;&#x95F4;&#x3002;</p>
<p>&#x7B2C;&#x4E8C;&#x6B65;&#xFF1A;</p>
<p>&#x6700;&#x7B80;&#x5355;&#x7684;&#x60F3;&#x6CD5;&#x662F;&#x5C06;&#xFF08;i&#xFF0C;j&#xFF09;&#x5750;&#x6807;&#x8F6C;&#x6362;&#x4E3A;&#xFF08;x&#xFF0C;y&#xFF0C;z&#xFF09;&#xFF08;&#x8FD9;&#x4E2A;&#x70B9;&#x4E0D;&#x5728;&#x8FB9;&#x754C;&#x4E0A;&#xFF09;&#xFF0C;&#x7136;&#x540E;&#x8C03;&#x7528; xyzToFaceUV &#x65B9;&#x6CD5;&#x6295;&#x5F71;&#x5230;&#x5BF9;&#x5E94;&#x7684; face &#x4E0A;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x5728;&#x751F;&#x6210; CellID &#x7684;&#x65F6;&#x5019;&#xFF0C;stToUV &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x7528;&#x7684;&#x662F;&#x4E00;&#x4E2A;&#x4E8C;&#x6B21;&#x53D8;&#x6362;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">func stToUV(s float64) float64 {</span><br><span class="line">    if s &gt;= 0.5 {</span><br><span class="line">        return (1 / 3.) * (4*s*s - 1)</span><br><span class="line">    }</span><br><span class="line">    return (1 / 3.) * (1 - 4*(1-s)*(1-s))</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4F46;&#x662F;&#x6B64;&#x5904;&#xFF0C;&#x6211;&#x4EEC;&#x7528;&#x7684;&#x53D8;&#x6362;&#x5C31;&#x7B80;&#x5355;&#x4E00;&#x70B9;&#xFF0C;&#x7528;&#x7684;&#x662F;&#x7EBF;&#x6027;&#x53D8;&#x6362;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">u = 2 * s - 1</span><br><span class="line">v = 2 * t - 1</span><br></pre></td></tr></table></figure>

<p>u&#xFF0C;v &#x7684;&#x53D6;&#x503C;&#x8303;&#x56F4;&#x90FD;&#x88AB;&#x9650;&#x5B9A;&#x5728; [-1&#xFF0C;1] &#x4E4B;&#x95F4;&#x3002;&#x5177;&#x4F53;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">const scale = 1.0 / maxSize</span><br><span class="line">limit := math.Nextafter(1, 2)</span><br><span class="line">u := math.Max(-limit, math.Min(limit, scale*float64((i&lt;&lt;1)+1-maxSize)))</span><br><span class="line">v := math.Max(-limit, math.Min(limit, scale*float64((j&lt;&lt;1)+1-maxSize)))</span><br></pre></td></tr></table></figure>

<p>&#x7B2C;&#x4E09;&#x6B65;&#xFF1A;&#x627E;&#x5230;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#xFF0C;&#x628A; u&#xFF0C;v &#x8F6C;&#x6210; &#x5BF9;&#x5E94; Level &#x7684; CellID&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">f, u, v = xyzToFaceUV(faceUVToXYZ(f, u, v))</span><br><span class="line">return cellIDFromFaceIJ(f, stToIJ(0.5*(u+1)), stToIJ(0.5*(v+1)))</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x6837;&#x5C31;&#x6C42;&#x5F97;&#x4E86;&#x4E00;&#x4E2A; CellID &#x3002;</p>
<p>&#x7531;&#x4E8E;&#x8FB9;&#x6709;4&#x6761;&#x8FB9;&#xFF0C;&#x6240;&#x4EE5;&#x8FB9;&#x90BB;&#x5C45;&#x6709;4&#x4E2A;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">    return [4]CellID{</span><br><span class="line">        cellIDFromFaceIJWrap(f, i, j-size).Parent(level),</span><br><span class="line">        cellIDFromFaceIJWrap(f, i+size, j).Parent(level),</span><br><span class="line">        cellIDFromFaceIJWrap(f, i, j+size).Parent(level),</span><br><span class="line">        cellIDFromFaceIJWrap(f, i-size, j).Parent(level),</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>&#x4E0A;&#x9762;&#x6570;&#x7EC4;&#x91CC;&#x9762;&#x5206;&#x522B;&#x4F1A;&#x88C5;&#x5165;&#x5F53;&#x524D; CellID &#x7684;&#x4E0B;&#x8FB9;&#x90BB;&#x5C45;&#xFF0C;&#x53F3;&#x8FB9;&#x90BB;&#x5C45;&#xFF0C;&#x4E0A;&#x8FB9;&#x90BB;&#x5C45;&#xFF0C;&#x5DE6;&#x8FB9;&#x90BB;&#x5C45;&#x3002;</p>
<p>&#x5982;&#x679C;&#x5728;&#x5730;&#x56FE;&#x4E0A;&#x663E;&#x793A;&#x51FA;&#x6765;&#x7684;&#x8BDD;&#xFF0C;&#x5C31;&#x662F;&#x4E0B;&#x56FE;&#x7684;&#x8FD9;&#x6837;&#x5B50;&#x3002;</p>
<p>&#x4E2D;&#x95F4;&#x65B9;&#x683C;&#x7684; CellID = 3958610196388904960 , Level 10 &#x3002;&#x6309;&#x7167;&#x4E0A;&#x9762;&#x7684;&#x65B9;&#x6CD5;&#x6C42;&#x51FA;&#x6765;&#x7684;&#x8FB9;&#x90BB;&#x5C45;&#xFF0C;&#x5206;&#x522B;&#x662F;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line"></span><br><span class="line">3958603599319138304 // &#x4E0B;&#x8FB9;&#x90BB;&#x5C45;</span><br><span class="line">3958607997365649408 // &#x53F3;&#x8FB9;&#x90BB;&#x5C45;</span><br><span class="line">3958612395412160512 // &#x4E0A;&#x8FB9;&#x90BB;&#x5C45;</span><br><span class="line">3958599201272627200 // &#x5DE6;&#x8FB9;&#x90BB;&#x5C45;</span><br></pre></td></tr></table></figure>

<p>&#x5728;&#x5730;&#x56FE;&#x4E0A;&#x5C55;&#x793A;&#x51FA;&#x6765;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/23960e71b71828367a77e6adedf2aafc27513e1ca92f84f602fe9eb8e45c4520" alt></p>
<h2 id="&#x4E8C;-&#x5171;&#x9876;&#x70B9;&#x90BB;&#x5C45;"><a href="#&#x4E8C;-&#x5171;&#x9876;&#x70B9;&#x90BB;&#x5C45;" class="headerlink" title="&#x4E8C;. &#x5171;&#x9876;&#x70B9;&#x90BB;&#x5C45;"></a>&#x4E8C;. &#x5171;&#x9876;&#x70B9;&#x90BB;&#x5C45;</h2><p>&#x8FD9;&#x91CC;&#x7684;&#x5171;&#x9876;&#x70B9;&#x90BB;&#x5C45;&#x548C;&#x6587;&#x7AE0;&#x5F00;&#x59CB;&#x8BB2;&#x7684;&#x9876;&#x70B9;&#x90BB;&#x5C45;&#x6709;&#x70B9;&#x533A;&#x522B;&#x3002;&#x5E76;&#x4E14;&#x4E0B;&#x9762;&#x8FD8;&#x4F1A;&#x6709;&#x4E00;&#x4E9B;&#x770B;&#x4F3C;&#x5947;&#x602A;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x4E5F;&#x662F;&#x7B14;&#x8005;&#x5728;&#x5B9E;&#x9645;&#x7F16;&#x7801;&#x4E2D;&#x8E29;&#x8FC7;&#x7684;&#x5751;&#xFF0C;&#x5206;&#x4EAB;&#x4E00;&#x4E0B;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x5148;&#x8BF4;&#x660E;&#x4E00;&#x79CD;&#x7279;&#x6B8A;&#x60C5;&#x51B5;&#xFF0C;&#x5373; Cell &#x6B63;&#x597D;&#x5728;&#x5730;&#x7403;&#x7684;&#x5916;&#x5207;&#x7ACB;&#x65B9;&#x4F53;&#x7684;8&#x4E2A;&#x9876;&#x70B9;&#x4E0A;&#x3002;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x70B9;&#x7684;&#x9876;&#x70B9;&#x90BB;&#x5C45;&#x53EA;&#x6709;3&#x4E2A;&#xFF0C;&#x800C;&#x4E0D;&#x662F;4&#x4E2A;&#x3002;&#x56E0;&#x4E3A;&#x8FD9;8&#x4E2A;&#x9876;&#x70B9;&#x6BCF;&#x4E2A;&#x70B9;&#x53EA;&#x6709;3&#x4E2A;&#x9762;&#x4E0E;&#x5176;&#x8FDE;&#x63A5;&#xFF0C;&#x6240;&#x4EE5;&#x6BCF;&#x4E2A;&#x9762;&#x4E0A;&#x6709;&#x4E14;&#x53EA;&#x6709;&#x4E00;&#x4E2A; Cell &#x662F;&#x5B83;&#x4EEC;&#x7684;&#x9876;&#x70B9;&#x90BB;&#x5C45;&#x3002;&#x9664;&#x53BB;&#x8FD9;8&#x4E2A;&#x70B9;&#x4EE5;&#x5916;&#x7684; Cell &#x7684;&#x9876;&#x70B9;&#x90BB;&#x5C45;&#x90FD;&#x6709;4&#x4E2A;&#xFF01;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">j</span><br><span class="line">|</span><br><span class="line">|  (0,1)  (1,1)</span><br><span class="line">|  (0,0)  (1,0)</span><br><span class="line">|</span><br><span class="line">---------------&gt; i</span><br></pre></td></tr></table></figure>

<p>&#x5728;&#x4E0A;&#x8FF0;&#x7684;&#x5750;&#x6807;&#x8F74;&#x4E2D;&#xFF0C;i &#x8F74;&#x65B9;&#x5411;&#x5982;&#x679C;&#x4E3A;1&#xFF0C;&#x5C31;&#x843D;&#x5728;4&#x4E2A;&#x8C61;&#x9650;&#x7684;&#x53F3;&#x8FB9;&#x4E00;&#x5217;&#x4E0A;&#x3002;&#x5982;&#x679C; j &#x8F74;&#x65B9;&#x5411;&#x5982;&#x679C;&#x4E3A;&#xFF0C;&#x5C31;&#x843D;&#x5728;4&#x4E2A;&#x8C61;&#x9650;&#x7684;&#x4E0A;&#x9762;&#x4E00;&#x884C;&#x4E0A;&#x3002;</p>
<blockquote>
<p><strong>&#x5047;&#x8BBE; Cell Level &#x4E0D;&#x7B49;&#x4E8E; 30&#xFF0C;&#x5373;&#x672B;&#x5C3E;&#x6807;&#x5FD7;&#x4F4D;1&#x540E;&#x9762;&#x8FD8;&#x6709;0&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x79CD; Cell &#x8F6C;&#x6362;&#x6210; i&#xFF0C;j &#x4EE5;&#x540E;&#xFF0C;i&#xFF0C;j &#x7684;&#x672B;&#x5C3E;&#x5C31;&#x90FD;&#x662F;1 &#x3002;</strong></p>
<p>&#x4E0A;&#x9762;&#x7684;&#x7ED3;&#x8BBA;&#x53EF;&#x4EE5;&#x8BC1;&#x660E;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x5728; faceIJOrientation &#x51FD;&#x6570;&#x62C6;&#x5206; Cell &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5982;&#x679C;&#x9047;&#x5230;&#x4E86;&#x90FD;&#x662F;0&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x6BD4;&#x5982; orientation = 11&#xFF0C;Cell &#x672B;&#x5C3E;&#x90FD;&#x662F;0&#xFF0C;&#x90A3;&#x4E48;&#x53D6;&#x51FA;&#x672B;&#x5C3E;8&#x4F4D;&#x52A0;&#x4E0A;orientation&#xFF0C;00000000 11&#xFF0C;&#x7ECF;&#x8FC7; lookupIJ &#x8F6C;&#x6362;&#x4EE5;&#x540E;&#x5F97;&#x5230; 1111111111 &#xFF0C;&#x4E8E;&#x662F; i = 1111&#xFF0C;j = 1111 &#xFF0C;&#x65B9;&#x5411;&#x8FD8;&#x662F; 11&#x3002;Cell &#x672B;&#x5C3E;&#x7684;00&#x8FD8;&#x662F;&#x7EE7;&#x7EED;&#x5FAA;&#x73AF;&#x4E0A;&#x8FF0;&#x7684;&#x8FC7;&#x7A0B;&#xFF0C;&#x4E8E;&#x662F; i&#xFF0C;j &#x672B;&#x5C3E;&#x5168;&#x662F;1111 &#x4E86;&#x3002;</p>
</blockquote>
<p>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x6839;&#x636E; i&#xFF0C;j &#x5224;&#x65AD;&#x5165;&#x53C2;&#x7ED9;&#x7684; Level &#x5728;&#x54EA;&#x4E2A;&#x8C61;&#x9650;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x628A;&#x5171;&#x9876;&#x70B9;&#x7684;&#x90BB;&#x5C45;&#x90FD;&#x627E;&#x5230;&#x3002;</p>
<p>&#x5047;&#x8BBE;&#x5165;&#x53C2;&#x7ED9;&#x5B9A;&#x7684; Level &#x5C0F;&#xFF0C;&#x5373; Cell &#x7684;&#x9762;&#x79EF;&#x5927;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x9700;&#x8981;&#x5224;&#x65AD;&#x5F53;&#x524D; Cell (&#x51FD;&#x6570;&#x8C03;&#x7528;&#x8005;) &#x7684;&#x5171;&#x9876;&#x70B9;&#x662F;&#x4F4D;&#x4E8E;&#x5165;&#x53C2; Cell &#x7684;4&#x4E2A;&#x9876;&#x70B9;&#x7684;&#x54EA;&#x4E2A;&#x9876;&#x70B9;&#x4E0A;&#x3002;Cell &#x662F;&#x4E00;&#x4E2A;&#x77E9;&#x5F62;&#xFF0C;&#x6709;4&#x4E2A;&#x9876;&#x70B9;&#x3002;&#x5F53;&#x524D; Cell (&#x51FD;&#x6570;&#x8C03;&#x7528;&#x8005;) &#x79BB;&#x54EA;&#x4E2A;&#x9876;&#x70B9;&#x8FD1;&#xFF0C;&#x5C31;&#x9009;&#x90A3;&#x4E2A;&#x9876;&#x70B9;&#x4E3A;&#x516C;&#x5171;&#x9876;&#x70B9;&#x3002;&#x518D;&#x4F9D;&#x6B21;&#x6C42;&#x51FA;&#x4EE5;&#x516C;&#x5171;&#x9876;&#x70B9;&#x5468;&#x56F4;&#x7684;4&#x4E2A; Cell &#x5373;&#x53EF;&#x3002;</p>
<p>&#x5047;&#x8BBE;&#x5165;&#x53C2;&#x7ED9;&#x5B9A;&#x7684; Level &#x5927;&#xFF0C;&#x5373; Cell &#x7684;&#x9762;&#x79EF;&#x5C0F;&#xFF0C;&#x90A3;&#x4E48;&#x4E5F;&#x9700;&#x8981;&#x5224;&#x65AD;&#x5165;&#x53C2; Cell &#x7684;&#x5171;&#x9876;&#x70B9;&#x662F;&#x4F4D;&#x4E8E;&#x5F53;&#x524D; Cell (&#x51FD;&#x6570;&#x8C03;&#x7528;&#x8005;)&#x7684;4&#x4E2A;&#x9876;&#x70B9;&#x7684;&#x54EA;&#x4E2A;&#x9876;&#x70B9;&#x4E0A;&#x3002;Cell &#x662F;&#x4E00;&#x4E2A;&#x77E9;&#x5F62;&#xFF0C;&#x6709;4&#x4E2A;&#x9876;&#x70B9;&#x3002;&#x5165;&#x53C2; Cell &#x79BB;&#x54EA;&#x4E2A;&#x9876;&#x70B9;&#x8FD1;&#xFF0C;&#x5C31;&#x9009;&#x90A3;&#x4E2A;&#x9876;&#x70B9;&#x4E3A;&#x516C;&#x5171;&#x9876;&#x70B9;&#x3002;&#x518D;&#x4F9D;&#x6B21;&#x6C42;&#x51FA;&#x4EE5;&#x516C;&#x5171;&#x9876;&#x70B9;&#x5468;&#x56F4;&#x7684;4&#x4E2A; Cell &#x5373;&#x53EF;&#x3002;</p>
<p>&#x7531;&#x4E8E;&#x9700;&#x8981;&#x5224;&#x65AD;&#x4F4D;&#x4E8E;&#x4E00;&#x4E2A; Cell &#x7684;&#x56DB;&#x7B49;&#x5206;&#x7684;&#x54EA;&#x4E00;&#x4E2A;&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x5224;&#x65AD;&#x5B83;&#x7684;4&#x4E2A;&#x5B69;&#x5B50;&#x7684;&#x4F4D;&#x7F6E;&#x60C5;&#x51B5;&#x3002;&#x5373;&#x5224;&#x65AD; Level - 1 &#x7684;&#x5B69;&#x5B50;&#x7684;&#x76F8;&#x5BF9;&#x4F4D;&#x7F6E;&#x60C5;&#x51B5;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">    halfSize := sizeIJ(level + 1)</span><br><span class="line">    size := halfSize &lt;&lt; 1</span><br><span class="line">    f, i, j, _ := ci.faceIJOrientation()</span><br><span class="line"></span><br><span class="line">    var isame, jsame bool</span><br><span class="line">    var ioffset, joffset int</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x62FF;&#x5230; halfSize &#xFF0C;halfSize &#x5176;&#x5B9E;&#x5C31;&#x662F;&#x5165;&#x53C2; Cell &#x7684;&#x5B69;&#x5B50;&#x7684;&#x683C;&#x5B50;&#x7684; size &#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">    if i&amp;halfSize != 0 {</span><br><span class="line">        // &#x4F4D;&#x4E8E;&#x540E;&#x8FB9;&#x4E00;&#x5217;&#xFF0C;&#x6240;&#x4EE5;&#x504F;&#x79FB;&#x91CF;&#x8981;&#x52A0;&#x4E0A;&#x4E00;&#x4E2A;&#x683C;&#x5B50;</span><br><span class="line">        ioffset = size</span><br><span class="line">        isame = (i + size) &lt; maxSize</span><br><span class="line">    } else {</span><br><span class="line">        // &#x4F4D;&#x4E8E;&#x5DE6;&#x8FB9;&#x4E00;&#x5217;&#xFF0C;&#x6240;&#x4EE5;&#x504F;&#x79FB;&#x91CF;&#x8981;&#x51CF;&#x53BB;&#x4E00;&#x4E2A;&#x683C;&#x5B50;</span><br><span class="line">        ioffset = -size</span><br><span class="line">        isame = (i - size) &gt;= 0</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x6839;&#x636E; halfSize &#x90A3;&#x4E00;&#x4F4D;&#x662F;&#x5426;&#x4E3A;1&#x6765;&#x5224;&#x65AD;&#x8DDD;&#x79BB;&#x77E9;&#x5F62;&#x7684;4&#x4E2A;&#x9876;&#x70B9;&#x54EA;&#x4E2A;&#x9876;&#x70B9;&#x8FD1;&#x3002;&#x8FD9;&#x91CC;&#x8FD8;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x5982;&#x679C; i + size &#x4E0D;&#x80FD;&#x8D85;&#x8FC7; maxSize&#xFF0C;&#x5982;&#x679C;&#x8D85;&#x8FC7;&#x4E86;&#xFF0C;&#x5C31;&#x4E0D;&#x5728;&#x540C;&#x4E00;&#x4E2A; face &#x4E0A;&#x4E86;&#x3002;&#x540C;&#x7406;&#xFF0C; i - size &#x4E5F;&#x4E0D;&#x80FD;&#x5C0F;&#x4E8E; 0&#xFF0C;&#x5C0F;&#x4E8E;0&#x9875;&#x4E0D;&#x5728;&#x540C;&#x4E00;&#x4E2A; face &#x4E0A;&#x4E86;&#x3002;</p>
<p>j &#x8F74;&#x5224;&#x65AD;&#x539F;&#x7406;&#x548C; i &#x5B8C;&#x5168;&#x4E00;&#x81F4;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">    if j&amp;halfSize != 0 {</span><br><span class="line">        // &#x4F4D;&#x4E8E;&#x4E0A;&#x8FB9;&#x4E00;&#x884C;&#xFF0C;&#x6240;&#x4EE5;&#x504F;&#x79FB;&#x91CF;&#x8981;&#x52A0;&#x4E0A;&#x4E00;&#x4E2A;&#x683C;&#x5B50;</span><br><span class="line">        joffset = size</span><br><span class="line">        jsame = (j + size) &lt; maxSize</span><br><span class="line">    } else {</span><br><span class="line">        // &#x4F4D;&#x4E8E;&#x4E0B;&#x8FB9;&#x4E00;&#x884C;&#xFF0C;&#x6240;&#x4EE5;&#x504F;&#x79FB;&#x91CF;&#x8981;&#x51CF;&#x53BB;&#x4E00;&#x4E2A;&#x683C;&#x5B50;</span><br><span class="line">        joffset = -size</span><br><span class="line">        jsame = (j - size) &gt;= 0</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>&#x6700;&#x540E;&#x8BA1;&#x7B97;&#x7ED3;&#x679C;&#xFF0C;&#x5148;&#x628A;&#x5165;&#x53C2;&#x7684; Cell &#x5148;&#x8BA1;&#x7B97;&#x51FA;&#x6765;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x628A;&#x5B83;&#x5468;&#x56F4;2&#x4E2A;&#x8F74;&#x4E0A;&#x7684; Cell &#x8BA1;&#x7B97;&#x51FA;&#x6765;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line"></span><br><span class="line">    results := []CellID{</span><br><span class="line">        ci.Parent(level),</span><br><span class="line">        cellIDFromFaceIJSame(f, i+ioffset, j, isame).Parent(level),</span><br><span class="line">        cellIDFromFaceIJSame(f, i, j+joffset, jsame).Parent(level),</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>&#x5982;&#x679C; i&#xFF0C;j &#x90FD;&#x5728;&#x540C;&#x4E00;&#x4E2A; face &#x4E0A;&#xFF0C;&#x90A3;&#x4E48;&#x5171;&#x9876;&#x70B9;&#x5C31;&#x80AF;&#x5B9A;&#x4E0D;&#x662F;&#x4F4D;&#x4E8E;&#x5916;&#x5207;&#x7ACB;&#x65B9;&#x4F53;&#x7684;8&#x4E2A;&#x9876;&#x70B9;&#x4E0A;&#x4E86;&#x3002;&#x90A3;&#x4E48;&#x5C31;&#x53EF;&#x4EE5;&#x518D;&#x628A;&#x7B2C;&#x56DB;&#x4E2A;&#x5171;&#x9876;&#x70B9;&#x7684; Cell &#x8BA1;&#x7B97;&#x51FA;&#x6765;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">    if isame || jsame {</span><br><span class="line">        results = append(results, cellIDFromFaceIJSame(f, i+ioffset, j+joffset, isame &amp;&amp; jsame).Parent(level))</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>&#x7EFC;&#x4E0A;&#xFF0C;&#x5B8C;&#x6574;&#x7684;&#x8BA1;&#x7B97;&#x5171;&#x9876;&#x70B9;&#x90BB;&#x5C45;&#x7684;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">func (ci CellID) VertexNeighbors(level int) []CellID {</span><br><span class="line">    halfSize := sizeIJ(level + 1)</span><br><span class="line">    size := halfSize &lt;&lt; 1</span><br><span class="line">    f, i, j, _ := ci.faceIJOrientation()</span><br><span class="line"></span><br><span class="line">    fmt.Printf(&quot;halfsize &#x539F;&#x59CB;&#x7684;&#x503C; = %v-%b\n&quot;, halfSize, halfSize)</span><br><span class="line">    var isame, jsame bool</span><br><span class="line">    var ioffset, joffset int</span><br><span class="line"></span><br><span class="line">    if i&amp;halfSize != 0 {</span><br><span class="line">        // &#x4F4D;&#x4E8E;&#x540E;&#x8FB9;&#x4E00;&#x5217;&#xFF0C;&#x6240;&#x4EE5;&#x504F;&#x79FB;&#x91CF;&#x8981;&#x52A0;&#x4E0A;&#x4E00;&#x4E2A;&#x683C;&#x5B50;</span><br><span class="line">        ioffset = size</span><br><span class="line">        isame = (i + size) &lt; maxSize</span><br><span class="line">    } else {</span><br><span class="line">        // &#x4F4D;&#x4E8E;&#x5DE6;&#x8FB9;&#x4E00;&#x5217;&#xFF0C;&#x6240;&#x4EE5;&#x504F;&#x79FB;&#x91CF;&#x8981;&#x51CF;&#x53BB;&#x4E00;&#x4E2A;&#x683C;&#x5B50;</span><br><span class="line">        ioffset = -size</span><br><span class="line">        isame = (i - size) &gt;= 0</span><br><span class="line">    }</span><br><span class="line">    if j&amp;halfSize != 0 {</span><br><span class="line">        // &#x4F4D;&#x4E8E;&#x4E0A;&#x8FB9;&#x4E00;&#x884C;&#xFF0C;&#x6240;&#x4EE5;&#x504F;&#x79FB;&#x91CF;&#x8981;&#x52A0;&#x4E0A;&#x4E00;&#x4E2A;&#x683C;&#x5B50;</span><br><span class="line">        joffset = size</span><br><span class="line">        jsame = (j + size) &lt; maxSize</span><br><span class="line">    } else {</span><br><span class="line">        // &#x4F4D;&#x4E8E;&#x4E0B;&#x8FB9;&#x4E00;&#x884C;&#xFF0C;&#x6240;&#x4EE5;&#x504F;&#x79FB;&#x91CF;&#x8981;&#x51CF;&#x53BB;&#x4E00;&#x4E2A;&#x683C;&#x5B50;</span><br><span class="line">        joffset = -size</span><br><span class="line">        jsame = (j - size) &gt;= 0</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    results := []CellID{</span><br><span class="line">        ci.Parent(level),</span><br><span class="line">        cellIDFromFaceIJSame(f, i+ioffset, j, isame).Parent(level),</span><br><span class="line">        cellIDFromFaceIJSame(f, i, j+joffset, jsame).Parent(level),</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    if isame || jsame {</span><br><span class="line">        results = append(results, cellIDFromFaceIJSame(f, i+ioffset, j+joffset, isame &amp;&amp; jsame).Parent(level))</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    return results</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4E0B;&#x9762;&#x6765;&#x4E3E;&#x51E0;&#x4E2A;&#x4F8B;&#x5B50;&#x3002;</p>
<p>&#x7B2C;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#x662F;&#x76F8;&#x540C;&#x5927;&#x5C0F; Cell &#x3002;&#x5165;&#x53C2;&#x548C;&#x8C03;&#x7528;&#x8005; Cell &#x90FD;&#x662F;&#x76F8;&#x540C; Level - 10 &#x7684;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/2b38f8b1aaee37f582c829efa4ee3f1b0dea6efbeb921d43e9874714e6b9a8f0" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">VertexNeighbors := cellID.Parent(10).VertexNeighbors(10)</span><br><span class="line"></span><br><span class="line">// 11011011101111110011110000000000000000000000000000000000000000</span><br><span class="line">3958610196388904960 // &#x53F3;&#x4E0A;&#x89D2; </span><br><span class="line">3958599201272627200 // &#x5DE6;&#x4E0A;&#x89D2;</span><br><span class="line">3958603599319138304 // &#x53F3;&#x4E0B;&#x89D2;</span><br><span class="line">3958601400295882752 // &#x5DE6;&#x4E0B;&#x89D2;</span><br></pre></td></tr></table></figure>

<p>&#x7B2C;&#x4E8C;&#x4E2A;&#x4F8B;&#x5B50;&#x662F;&#x4E0D;&#x662F;&#x5927;&#x5C0F;&#x7684; Cell &#x3002;&#x8C03;&#x7528;&#x8005; Cell &#x662F;&#x9ED8;&#x8BA4; Level - 30 &#x7684;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/a15ba99da090b1e0850d013ea01c5c93fe89f5a59d19a37a779b5541e9c31c6d" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">VertexNeighbors := cellID.VertexNeighbors(10)</span><br><span class="line"></span><br><span class="line">// 11011011101111110011110000000000000000000000000000000000000000</span><br><span class="line">3958610196388904960 // &#x53F3;&#x4E0B;&#x89D2;</span><br><span class="line">3958599201272627200 // &#x5DE6;&#x4E0B;&#x89D2;</span><br><span class="line">3958612395412160512 // &#x53F3;&#x4E0A;&#x89D2;</span><br><span class="line">3958623390528438272 // &#x5DE6;&#x4E0A;&#x89D2;</span><br></pre></td></tr></table></figure>

<p>&#x4E0A;&#x9762;&#x4E24;&#x4E2A;&#x4F8B;&#x5B50;&#x53EF;&#x4EE5;&#x8BF4;&#x660E;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x540C;&#x6837;&#x662F;&#x8C03;&#x7528; VertexNeighbors(10) &#x5F97;&#x5230;&#x7684; Cell &#x90FD;&#x662F; Level - 10 &#x7684;&#xFF0C;&#x4F46;&#x662F;&#x65B9;&#x5411;&#x548C;&#x4F4D;&#x7F6E;&#x662F;&#x4E0D;&#x540C;&#x7684;&#x3002;&#x672C;&#x8D28;&#x5728;&#x5B83;&#x4EEC;&#x5171;&#x7684;&#x9876;&#x70B9;&#x662F;&#x4E0D;&#x540C;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x751F;&#x6210;&#x51FA;&#x6765;&#x7684;4&#x4E2A;Cell&#x751F;&#x6210;&#x65B9;&#x5411;&#x4E5F;&#x5C31;&#x4E0D;&#x540C;&#x3002;</p>
<p>&#x5728; C++ &#x7684;&#x7248;&#x672C;&#x4E2D;&#xFF0C;&#x67E5;&#x627E;&#x9876;&#x70B9;&#x90BB;&#x5C45;&#x6709;&#x4E00;&#x4E2A;&#x9650;&#x5236;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">DCHECK_LT(level, this-&gt;level());</span><br></pre></td></tr></table></figure>

<p>&#x5165;&#x53C2;&#x7684; Level &#x5FC5;&#x987B;&#x4E25;&#x683C;&#x7684;&#x6BD4;&#x8981;&#x627E;&#x7684; Cell &#x7684; Level &#x5C0F;&#x624D;&#x884C;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x5165;&#x53C2;&#x7684; Cell &#x7684;&#x683C;&#x5B50;&#x9762;&#x79EF;&#x5927;&#x5C0F;&#x8981;&#x6BD4; Cell &#x683C;&#x5B50;&#x5927;&#x5C0F;&#x66F4;&#x5C0F;&#x624D;&#x884C;&#x3002;&#x4F46;&#x662F;&#x5728; Go &#x7684;&#x7248;&#x672C;&#x5B9E;&#x73B0;&#x4E2D;&#x5E76;&#x6CA1;&#x6709;&#x8FD9;&#x4E2A;&#x8981;&#x6C42;&#xFF0C;&#x5165;&#x53C2;&#x6216;&#x5927;&#x6216;&#x5C0F;&#x90FD;&#x53EF;&#x4EE5;&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x4E3E;&#x4F8B;&#xFF0C;&#x5165;&#x53C2;&#x6BD4; Cell &#x7684; Level &#x5C0F;&#x3002;&#xFF08;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6210;&#x90FD;&#x5E02;&#x5DF2;&#x7ECF;&#x5C0F;&#x6210;&#x4E00;&#x4E2A;&#x70B9;&#x4E86;&#xFF09;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/9bd49b4aa524d5b947570ee474de850ec125199f64b574ceb57336be2e7d9c52" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">VertexNeighbors := cellID.Parent(10).VertexNeighbors(5)</span><br><span class="line"></span><br><span class="line">3957538172551823360 // &#x53F3;&#x4E0B;&#x89D2;</span><br><span class="line">3955286372738138112 // &#x5DE6;&#x4E0B;&#x89D2;</span><br><span class="line">3959789972365508608 // &#x53F3;&#x4E0A;&#x89D2;</span><br><span class="line">3962041772179193856 // &#x5DE6;&#x4E0A;&#x89D2;</span><br></pre></td></tr></table></figure>

<p>&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x4E3E;&#x4F8B;&#xFF0C;&#x5165;&#x53C2;&#x6BD4; Cell &#x7684; Level &#x5927;&#x3002;&#xFF08;&#x53EF;&#x4EE5;&#x770B;&#x5230; Level 15 &#x7684;&#x9762;&#x79EF;&#x5DF2;&#x7ECF;&#x5F88;&#x5C0F;&#x4E86;&#xFF09;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/d1feb266e4d1ace4500e546ce9e6a714477962643c2d4c3c2dcf6722ed975e6a" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">VertexNeighbors := cellID.Parent(10).VertexNeighbors(15)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3958610197462646784 // &#x5DE6;&#x4E0B;&#x89D2;</span><br><span class="line">3958610195315163136 // &#x53F3;&#x4E0B;&#x89D2;</span><br><span class="line">3958610929754570752 // &#x5DE6;&#x4E0A;&#x89D2;</span><br><span class="line">3958609463023239168 // &#x53F3;&#x4E0A;&#x89D2;</span><br></pre></td></tr></table></figure>

<h2 id="&#x4E09;-&#x5168;&#x90BB;&#x5C45;"><a href="#&#x4E09;-&#x5168;&#x90BB;&#x5C45;" class="headerlink" title="&#x4E09;. &#x5168;&#x90BB;&#x5C45;"></a>&#x4E09;. &#x5168;&#x90BB;&#x5C45;</h2><p>&#x6700;&#x540E;&#x56DE;&#x6765;&#x6587;&#x7AE0;&#x5F00;&#x5934;&#x95EE;&#x7684;&#x90A3;&#x4E2A;&#x95EE;&#x9898;&#x4E2D;&#x3002;&#x5982;&#x4F55;&#x5728;&#x56DB;&#x53C9;&#x6811;&#x4E0A;&#x5982;&#x4F55;&#x6C42;&#x5E0C;&#x5C14;&#x4F2F;&#x7279;&#x66F2;&#x7EBF;&#x7684;&#x90BB;&#x5C45; &#xFF1F;&#x7ECF;&#x8FC7;&#x524D;&#x6587;&#x7684;&#x4E00;&#x4E9B;&#x94FA;&#x57AB;&#xFF0C;&#x518D;&#x6765;&#x770B;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x4E5F;&#x8BB8;&#x8BFB;&#x8005;&#x5FC3;&#x91CC;&#x5DF2;&#x7ECF;&#x660E;&#x767D;&#x8BE5;&#x600E;&#x4E48;&#x505A;&#x4E86;&#x3002;</p>
<p>&#x67E5;&#x627E;&#x5168;&#x90BB;&#x5C45;&#x6709;&#x4E00;&#x4E2A;&#x8981;&#x6C42;&#xFF0C;&#x5C31;&#x662F;&#x5165;&#x53C2;&#x7684; Level &#x7684;&#x9762;&#x79EF;&#x5FC5;&#x987B;&#x8981;&#x6BD4;&#x8C03;&#x7528;&#x8005; Cell &#x7684;&#x5C0F;&#x6216;&#x8005;&#x76F8;&#x7B49;&#x3002;&#x5373;&#x5165;&#x53C2; Level &#x503C;&#x4E0D;&#x80FD;&#x6BD4;&#x8C03;&#x7528;&#x8005;&#x7684; Level &#x5C0F;&#x3002;&#x56E0;&#x4E3A;&#x4E00;&#x65E6;&#x5C0F;&#x4E86;&#x4EE5;&#x540E;&#xFF0C;&#x90BB;&#x5C45;&#x7684; Cell &#x7684;&#x9762;&#x79EF;&#x53D8;&#x5F97;&#x5DE8;&#x5927;&#xFF0C;&#x5F88;&#x53EF;&#x80FD;&#x4E00;&#x4E2A;&#x90BB;&#x5C45;&#x7684; Cell &#x91CC;&#x9762;&#x5C31;&#x88C5;&#x6EE1;&#x4E86;&#x539F;&#x6765; Cell &#x7684;&#x6240;&#x6709;&#x90BB;&#x5C45;&#xFF0C;&#x90A3;&#x8FD9;&#x6837;&#x7684;&#x67E5;&#x627E;&#x5E76;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x610F;&#x4E49;&#x3002;</p>
<p>&#x4E3E;&#x4E2A;&#x4F8B;&#x5B50;&#xFF0C;&#x5982;&#x679C;&#x5165;&#x53C2;&#x7684; Level &#x6BD4;&#x8C03;&#x7528;&#x8005; Cell &#x7684; Level &#x5C0F;&#x3002;&#x90A3;&#x4E48;&#x67E5;&#x627E;&#x5B83;&#x7684;&#x5168;&#x90BB;&#x5C45;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x67E5;&#x51FA;&#x6765;&#x4F1A;&#x51FA;&#x73B0;&#x5982;&#x4E0B;&#x7684;&#x60C5;&#x51B5;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">AllNeighbors := cellID.Parent(10).AllNeighbors(5)</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/5e4928f34591a7f06c6059335681fe2c926a518c11f9b59236356efe61119729" alt></p>
<p>&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x662F;&#x53EF;&#x4EE5;&#x67E5;&#x627E;&#x5230;&#x5168;&#x90BB;&#x5C45;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x53EF;&#x80FD;&#x4F1A;&#x51FA;&#x73B0;&#x91CD;&#x53E0; Cell &#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x4E3A;&#x4F55;&#x4F1A;&#x51FA;&#x73B0;&#x8FD9;&#x6837;&#x7684;&#x73B0;&#x8C61;&#xFF0C;&#x4E0B;&#x9762;&#x518D;&#x5206;&#x6790;&#x3002;</p>
<p>&#x5982;&#x679C;&#x5165;&#x53C2;&#x548C;&#x8C03;&#x7528;&#x8005; Cell &#x7684; Level &#x662F;&#x76F8;&#x540C;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x67E5;&#x627E;&#x5230;&#x7684;&#x5168;&#x90BB;&#x5C45;&#x5C31;&#x662F;&#x6587;&#x7AE0;&#x5F00;&#x5934;&#x8BF4;&#x5230;&#x7684;&#x95EE;&#x9898;&#x4E86;&#x3002;&#x7406;&#x60F3;&#x72B6;&#x6001;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/c4fd9537063a7b3826ad26531e0cdea6f2e6424345cabbcb5b1b8e838b7bd8b5" alt></p>
<p>&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">func (ci CellID) AllNeighbors(level int) []CellID {</span><br><span class="line">    var neighbors []CellID</span><br><span class="line"></span><br><span class="line">    face, i, j, _ := ci.faceIJOrientation()</span><br><span class="line"></span><br><span class="line">    // &#x5BFB;&#x627E;&#x6700;&#x5DE6;&#x4E0B;&#x89D2;&#x7684;&#x53F6;&#x5B50;&#x8282;&#x70B9;&#x7684;&#x5750;&#x6807;&#x3002;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x89C4;&#x8303; i&#xFF0C;j &#x7684;&#x5750;&#x6807;&#x3002;&#x56E0;&#x4E3A;&#x5165;&#x53C2; Level &#x6709;&#x53EF;&#x80FD;&#x6BD4;&#x8C03;&#x7528;&#x8005; Cell &#x7684; Level &#x8981;&#x5927;&#x3002;</span><br><span class="line">    size := sizeIJ(ci.Level())</span><br><span class="line">    i &amp;= -size</span><br><span class="line">    j &amp;= -size</span><br><span class="line"></span><br><span class="line">    nbrSize := sizeIJ(level)</span><br><span class="line"></span><br><span class="line">    for k := -nbrSize; ; k += nbrSize {</span><br><span class="line">        var sameFace bool</span><br><span class="line">        if k &lt; 0 {</span><br><span class="line">            sameFace = (j+k &gt;= 0)</span><br><span class="line">        } else if k &gt;= size {</span><br><span class="line">            sameFace = (j+k &lt; maxSize)</span><br><span class="line">        } else {</span><br><span class="line">            sameFace = true</span><br><span class="line">            // &#x4E0A;&#x8FB9;&#x90BB;&#x5C45; &#x548C; &#x4E0B;&#x8FB9;&#x90BB;&#x5C45;</span><br><span class="line">            neighbors = append(neighbors, cellIDFromFaceIJSame(face, i+k, j-nbrSize,</span><br><span class="line">                j-size &gt;= 0).Parent(level))</span><br><span class="line">            neighbors = append(neighbors, cellIDFromFaceIJSame(face, i+k, j+size,</span><br><span class="line">                j+size &lt; maxSize).Parent(level))</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        // &#x5DE6;&#x8FB9;&#x90BB;&#x5C45;&#xFF0C;&#x53F3;&#x8FB9;&#x90BB;&#x5C45;&#xFF0C;&#x4EE5;&#x53CA;2&#x4E2A;&#x5BF9;&#x89D2;&#x7EBF;&#x4E0A;&#x7684;&#x9876;&#x70B9;&#x90BB;&#x5C45;</span><br><span class="line">        neighbors = append(neighbors, cellIDFromFaceIJSame(face, i-nbrSize, j+k,</span><br><span class="line">            sameFace &amp;&amp; i-size &gt;= 0).Parent(level))</span><br><span class="line">        neighbors = append(neighbors, cellIDFromFaceIJSame(face, i+size, j+k,</span><br><span class="line">            sameFace &amp;&amp; i+size &lt; maxSize).Parent(level))</span><br><span class="line"></span><br><span class="line">        // &#x8FD9;&#x91CC;&#x7684;&#x5224;&#x65AD;&#x6761;&#x4EF6;&#x6709;2&#x4E2A;&#x7528;&#x9014;&#xFF0C;&#x4E00;&#x662F;&#x9632;&#x6B62;32-bit&#x6EA2;&#x51FA;&#xFF0C;&#x4E8C;&#x662F;&#x5FAA;&#x73AF;&#x7684;&#x9000;&#x51FA;&#x6761;&#x4EF6;&#xFF0C;&#x5927;&#x4E8E;size&#x4EE5;&#x540E;&#x4E5F;&#x5C31;&#x4E0D;&#x7528;&#x518D;&#x627E;&#x4E86;</span><br><span class="line">        if k &gt;= size {</span><br><span class="line">            break</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    return neighbors</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4E0A;&#x8FF0;&#x4EE3;&#x7801;&#x7B80;&#x5355;&#x7684;&#x601D;&#x8DEF;&#x7528;&#x6CE8;&#x91CA;&#x5199;&#x4E86;&#x3002;&#x9700;&#x8981;&#x8BB2;&#x89E3;&#x7684;&#x90E8;&#x5206;&#x73B0;&#x5728;&#x6765;&#x8BB2;&#x89E3;&#x3002;</p>
<p>&#x9996;&#x5148;&#x9700;&#x8981;&#x7406;&#x89E3;&#x7684;&#x662F; nbrSize &#x548C; size &#x7684;&#x5173;&#x7CFB;&#x3002;&#x4E3A;&#x4F55;&#x4F1A;&#x6709; nbrSize &#xFF1F; &#x56E0;&#x4E3A;&#x5165;&#x53C2; Level &#x662F;&#x53EF;&#x4EE5;&#x548C;&#x8C03;&#x7528;&#x8005; Cell &#x7684; Level &#x4E0D;&#x4E00;&#x6837;&#x7684;&#x3002;&#x5165;&#x53C2;&#x7684; Level &#x4EE3;&#x8868;&#x7684; Cell &#x53EF;&#x5927;&#x53EF;&#x5C0F;&#x4E5F;&#x53EF;&#x80FD;&#x76F8;&#x7B49;&#x3002;&#x6700;&#x7EC8;&#x7ED3;&#x679C;&#x662F;&#x4EE5; nbrSize &#x683C;&#x5B50;&#x5927;&#x5C0F;&#x6765;&#x8868;&#x793A;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x5FAA;&#x73AF;&#x4E2D;&#x9700;&#x8981;&#x7528; nbrSize &#x6765;&#x63A7;&#x5236;&#x683C;&#x5B50;&#x7684;&#x5927;&#x5C0F;&#x3002;&#x800C; size &#x53EA;&#x662F;&#x539F;&#x6765;&#x8C03;&#x7528;&#x8005; Cell &#x7684;&#x683C;&#x5B50;&#x5927;&#x5C0F;&#x3002;</p>
<p>&#x5FAA;&#x73AF;&#x4E2D; K &#x7684;&#x53D8;&#x5316;&#xFF0C;&#x5F53; K = -nbrSize &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x5FAA;&#x73AF;&#x53EA;&#x4F1A;&#x8BA1;&#x7B97;&#x5DE6;&#x8FB9;&#x548C;&#x53F3;&#x8FB9;&#x7684;&#x90BB;&#x5C45;&#x3002;&#x5BF9;&#x89D2;&#x7EBF;&#x4E0A;&#x7684;&#x9876;&#x70B9;&#x90BB;&#x5C45;&#x5176;&#x5B9E;&#x4E5F;&#x662F;&#x5DE6;&#x8FB9;&#x90BB;&#x5C45;&#x548C;&#x53F3;&#x8FB9;&#x90BB;&#x5C45;&#x7684;&#x4E00;&#x79CD;&#x7279;&#x6B8A;&#x60C5;&#x51B5;&#x3002;&#x63A5;&#x4E0B;&#x6765; K = 0&#xFF0C;&#x5C31;&#x4F1A;&#x5F00;&#x59CB;&#x8BA1;&#x7B97;&#x4E0A;&#x8FB9;&#x90BB;&#x5C45;&#x548C;&#x4E0B;&#x8FB9;&#x90BB;&#x5C45;&#x4E86;&#x3002;K &#x4E0D;&#x65AD;&#x589E;&#x52A0;&#xFF0C;&#x76F4;&#x5230;&#x6700;&#x540E; K &gt;= size &#xFF0C;&#x6700;&#x540E;&#x4E00;&#x6B21;&#x5FAA;&#x73AF;&#x5185;&#xFF0C;&#x4F1A;&#x5148;&#x8BA1;&#x7B97;&#x4E00;&#x6B21;&#x5DE6;&#x8FB9;&#x548C;&#x53F3;&#x8FB9;&#x90BB;&#x5C45;&#xFF0C;&#x518D; break &#x9000;&#x51FA;&#x3002;</p>
<p>&#x8C03;&#x7528;&#x8005;&#x7684; Cell &#x5728;&#x4E2D;&#x95F4;&#x4F4D;&#x7F6E;&#xFF0C;&#x6240;&#x4EE5;&#x60F3;&#x8981;&#x8DF3;&#x8FC7;&#x8FD9;&#x4E2A; Cell &#x5230;&#x8FBE;&#x53E6;&#x5916;&#x4E00;&#x8FB9;(&#x4E0A;&#x4E0B;&#xFF0C;&#x6216;&#x8005;&#x5DE6;&#x53F3;)&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x9700;&#x8981;&#x8DF3;&#x8FC7; size &#x7684;&#x5927;&#x5C0F;&#x3002;&#x5177;&#x4F53;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;&#x662F; i + size &#x548C; j + size &#x3002;</p>
<p>&#x5148;&#x770B;&#x5DE6;&#x53F3;&#x90BB;&#x5C45;&#x7684;&#x5FAA;&#x73AF;&#x626B;&#x63CF;&#x65B9;&#x5F0F;&#x3002;</p>
<p>&#x5DE6;&#x90BB;&#x5C45;&#x662F; i - nbrSize&#xFF0C;j + k&#xFF0C;k &#x5728;&#x5FAA;&#x73AF;&#x3002;&#x8FD9;&#x8868;&#x793A;&#x7684;&#x5C31;&#x662F;&#x5DE6;&#x90BB;&#x5C45;&#x7684;&#x751F;&#x6210;&#x65B9;&#x5F0F;&#x3002;&#x5B83;&#x751F;&#x6210;&#x4E86;&#x5DE6;&#x90BB;&#x5C45;&#x4E00;&#x5217;&#x3002;&#x4ECE;&#x5DE6;&#x4E0B;&#x89D2;&#x5F00;&#x59CB;&#x751F;&#x6210;&#xFF0C;&#x4E00;&#x76F4;&#x5F80;&#x4E0A;&#x751F;&#x6210;&#x5230;&#x5DE6;&#x4E0A;&#x89D2;&#x3002;</p>
<p>&#x53F3;&#x90BB;&#x5C45;&#x662F; i + size&#xFF0C;j + k&#xFF0C;k &#x5728;&#x5FAA;&#x73AF;&#x3002;&#x8FD9;&#x8868;&#x793A;&#x7684;&#x5C31;&#x662F;&#x53F3;&#x90BB;&#x5C45;&#x7684;&#x751F;&#x6210;&#x65B9;&#x5F0F;&#x3002;&#x5B83;&#x751F;&#x6210;&#x4E86;&#x53F3;&#x90BB;&#x5C45;&#x4E00;&#x5217;&#x3002;&#x4ECE;&#x53F3;&#x4E0B;&#x89D2;&#x5F00;&#x59CB;&#x751F;&#x6210;&#xFF0C;&#x4E00;&#x76F4;&#x5F80;&#x4E0A;&#x751F;&#x6210;&#x5230;&#x53F3;&#x4E0A;&#x89D2;&#x3002;</p>
<p>&#x518D;&#x770B;&#x4E0A;&#x4E0B;&#x90BB;&#x5C45;&#x7684;&#x5FAA;&#x73AF;&#x626B;&#x63CF;&#x65B9;&#x5F0F;&#x3002;</p>
<p>&#x4E0B;&#x90BB;&#x5C45;&#x662F; i + k&#xFF0C;j - nbrSize&#xFF0C;k &#x5728;&#x5FAA;&#x73AF;&#x3002;&#x8FD9;&#x8868;&#x793A;&#x7684;&#x5C31;&#x662F;&#x4E0B;&#x90BB;&#x5C45;&#x7684;&#x751F;&#x6210;&#x65B9;&#x5F0F;&#x3002;&#x5B83;&#x751F;&#x6210;&#x4E86;&#x4E0B;&#x90BB;&#x5C45;&#x4E00;&#x884C;&#x3002;&#x4ECE;&#x4E0B;&#x90BB;&#x5C45;&#x6700;&#x5DE6;&#x8FB9;&#x5F00;&#x59CB;&#x751F;&#x6210;&#xFF0C;&#x4E00;&#x76F4;&#x5F80;&#x4E0A;&#x751F;&#x6210;&#x5230;&#x4E0B;&#x90BB;&#x5C45;&#x6700;&#x53F3;&#x8FB9;&#x3002;</p>
<p>&#x4E0A;&#x90BB;&#x5C45;&#x662F; i + k&#xFF0C;j + size&#xFF0C;k &#x5728;&#x5FAA;&#x73AF;&#x3002;&#x8FD9;&#x8868;&#x793A;&#x7684;&#x5C31;&#x662F;&#x4E0A;&#x90BB;&#x5C45;&#x7684;&#x751F;&#x6210;&#x65B9;&#x5F0F;&#x3002;&#x5B83;&#x751F;&#x6210;&#x4E86;&#x4E0A;&#x90BB;&#x5C45;&#x4E00;&#x884C;&#x3002;&#x4ECE;&#x4E0A;&#x90BB;&#x5C45;&#x6700;&#x5DE6;&#x8FB9;&#x5F00;&#x59CB;&#x751F;&#x6210;&#xFF0C;&#x4E00;&#x76F4;&#x5F80;&#x4E0A;&#x751F;&#x6210;&#x5230;&#x4E0A;&#x90BB;&#x5C45;&#x6700;&#x53F3;&#x8FB9;&#x3002;</p>
<p>&#x4E3E;&#x4F8B;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/a2dbdf0eacfa5af9cb8bcf5563adafc150f0229e1ee99740fa2433cf715bcd0a" alt></p>
<p>&#x4E2D;&#x95F4; Cell &#x7684;&#x5468;&#x56F4;&#x7684;&#x5168;&#x90BB;&#x5C45;&#x662F;&#x4E0A;&#x56FE;&#x7684; 8 &#x7684;&#x76F8;&#x540C; Level &#x7684; Cell&#x3002;</p>
<p>&#x751F;&#x6210;&#x987A;&#x5E8F;&#x7528;&#x9700;&#x8981;&#x6807;&#x8BC6;&#x51FA;&#x6765;&#x4E86;&#x3002;1&#xFF0C;2&#xFF0C;5&#xFF0C;6&#xFF0C;7&#xFF0C;8 &#x90FD;&#x662F;&#x5DE6;&#x53F3;&#x90BB;&#x5C45;&#x751F;&#x6210;&#x51FA;&#x6765;&#x7684;&#x3002;3&#xFF0C;4 &#x662F;&#x4E0A;&#x4E0B;&#x90BB;&#x5C45;&#x751F;&#x6210;&#x51FA;&#x6765;&#x7684;&#x3002;</p>
<p>&#x4E0A;&#x9762;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x662F;&#x90FD;&#x662F; Level - 10 &#x7684; Cell &#x751F;&#x6210;&#x51FA;&#x6765;&#x7684;&#x3002;&#x5168;&#x90BB;&#x5C45;&#x6B63;&#x597D;&#x662F;8&#x4E2A;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">AllNeighbors := cellID.Parent(10).AllNeighbors(10)</span><br><span class="line"></span><br><span class="line">3958601400295882752,</span><br><span class="line">3958605798342393856,</span><br><span class="line">3958603599319138304,</span><br><span class="line">3958612395412160512,</span><br><span class="line">3958599201272627200,</span><br><span class="line">3958607997365649408,</span><br><span class="line">3958623390528438272,</span><br><span class="line">3958614594435416064</span><br></pre></td></tr></table></figure>

<p>&#x518D;&#x4E3E;&#x4E00;&#x4E2A; Level &#x6BD4;&#x8C03;&#x7528;&#x8005; Cell &#x7684; Level &#x5927;&#x7684;&#x4F8B;&#x5B50;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">AllNeighbors := cellID.Parent(10).AllNeighbors(11)</span><br><span class="line"></span><br><span class="line">3958600575662161920,</span><br><span class="line">3958606622976114688,</span><br><span class="line">3958603324441231360,</span><br><span class="line">3958611570778439680,</span><br><span class="line">3958600025906348032,</span><br><span class="line">3958607172731928576,</span><br><span class="line">3958603874197045248,</span><br><span class="line">3958613220045881344,</span><br><span class="line">3958599476150534144,</span><br><span class="line">3958608821999370240,</span><br><span class="line">3958623115650531328,</span><br><span class="line">3958613769801695232</span><br></pre></td></tr></table></figure>

<p>&#x5B83;&#x7684;&#x5168;&#x90BB;&#x5C45;&#x751F;&#x6210;&#x987A;&#x5E8F;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/9d191b7a041864da4172b8e5a8e69b5cfb583c302dfef563dcf9104cbee99541" alt></p>
<p>1&#xFF0C;2&#xFF0C;5&#xFF0C;6&#xFF0C;9&#xFF0C;10&#xFF0C;11&#xFF0C;12 &#x90FD;&#x662F;&#x5DE6;&#x53F3;&#x90BB;&#x5C45;&#xFF0C;3&#xFF0C;4&#xFF0C;7&#xFF0C;8 &#x662F;&#x4E0A;&#x4E0B;&#x90BB;&#x5C45;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5DE6;&#x53F3;&#x90BB;&#x5C45;&#x662F;&#x4ECE;&#x4E0B;&#x5F80;&#x4E0A;&#x751F;&#x6210;&#x7684;&#x3002;&#x4E0A;&#x4E0B;&#x90BB;&#x5C45;&#x662F;&#x4ECE;&#x5DE6;&#x5F80;&#x53F3;&#x751F;&#x6210;&#x7684;&#x3002;</p>
<p>&#x5982;&#x679C; Level &#x66F4;&#x5927;&#xFF0C;&#x6BD4;&#x5982; Level - 15 &#xFF0C;&#x5C31;&#x4F1A;&#x751F;&#x6210;&#x66F4;&#x591A;&#x7684;&#x90BB;&#x5C45;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/5a7a4c441c2418a157086162100849070fa8f74a6cbf22bc77e3a972c6eaee65" alt></p>
<p>&#x73B0;&#x5728;&#x5728;&#x89E3;&#x91CA;&#x4E00;&#x4E0B;&#x5982;&#x679C;&#x5165;&#x53C2; Level &#x6BD4;&#x8C03;&#x7528;&#x8005; Cell &#x7684; Level &#x5C0F;&#x7684;&#x60C5;&#x51B5;&#x3002;</p>
<p>&#x4E3E;&#x4F8B;&#xFF0C;&#x5165;&#x53C2; Level = 9 &#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">AllNeighbors := cellID.Parent(10).AllNeighbors(9)</span><br><span class="line"></span><br><span class="line">3958589305667977216,</span><br><span class="line">3958580509574955008,</span><br><span class="line">3958580509574955008,</span><br><span class="line">3958615693947043840,</span><br><span class="line">3958598101760999424,</span><br><span class="line">3958606897854021632,</span><br><span class="line">3958624490040066048,</span><br><span class="line">3958615693947043840</span><br></pre></td></tr></table></figure>

<p>&#x751F;&#x6210;&#x7684;&#x5168;&#x90BB;&#x5C45;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/54137791d00641350ac3c1b28361d8bc592f5ffbcc5d129c3299ea67306c11df" alt></p>
<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x672C;&#x6765;&#x6709;8&#x4E2A;&#x90BB;&#x5C45;&#x7684;&#xFF0C;&#x73B0;&#x5728;&#x53EA;&#x6709;6&#x4E2A;&#x4E86;&#x3002;&#x5176;&#x5B9E;&#x751F;&#x6210;&#x51FA;&#x6765;&#x7684;&#x8FD8;&#x662F;8&#x4E2A;&#xFF0C;&#x53EA;&#x4E0D;&#x8FC7;&#x6709;2&#x4E2A;&#x91CD;&#x590D;&#x4E86;&#x3002;&#x91CD;&#x590D;&#x7684;&#x89C1;&#x56FE;&#x4E2D;&#x6DF1;&#x7EA2;&#x8272;&#x7684;&#x4E24;&#x4E2A; Cell&#x3002;</p>
<p>&#x4E3A;&#x4F55;&#x4F1A;&#x91CD;&#x53E0;&#xFF1F;</p>
<p>&#x4E2D;&#x95F4;&#x8C03;&#x7528;&#x8005;&#x7684; Level - 10 &#x7684; Cell &#x5148;&#x753B;&#x51FA;&#x6765;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/5dcaf15fe13f781a75e7fe62928aea4929c69d6176d2446dfb5c4475c3c8adba" alt></p>
<p>&#x56E0;&#x4E3A;&#x662F; Level - 9 &#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x662F;&#x4E2D;&#x95F4;&#x90A3;&#x4E2A; Cell &#x7684;&#x56DB;&#x5206;&#x4E4B;&#x4E00;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x628A; Level - 10 &#x7684;&#x4E24;&#x4E2A;&#x4E0A;&#x90BB;&#x5C45;&#x4E5F;&#x753B;&#x51FA;&#x6765;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/12b1402d32c12def0bfb393240d09044343fdc81e4322f9412605e944aaed3da" alt></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/e8a8fbc3c8df4e7295ac78dec13b6db80ec0666056c2949c77bc11f29e6bbefe" alt></p>
<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x4E0A;&#x90BB;&#x5C45; Up &#x548C;&#x9876;&#x70B9;&#x90BB;&#x5C45; up-right &#x90FD;&#x4F4D;&#x4E8E;&#x540C;&#x4E00;&#x4E2A; Level - 9 &#x7684; Cell &#x5185;&#x4E86;&#x3002;&#x6240;&#x4EE5;&#x4E0A;&#x90BB;&#x5C45;&#x548C;&#x53F3;&#x4E0A;&#x89D2;&#x7684;&#x9876;&#x70B9;&#x90BB;&#x5C45;&#x5C31;&#x90FD;&#x662F;&#x540C;&#x4E00;&#x4E2A; Level - 9 &#x7684; Cell &#x3002;&#x6240;&#x4EE5;&#x91CD;&#x53E0;&#x4E86;&#x3002;&#x540C;&#x7406;&#xFF0C;&#x4E0B;&#x90BB;&#x5C45;&#x548C;&#x53F3;&#x4E0B;&#x7684;&#x9876;&#x70B9;&#x90BB;&#x5C45;&#x4E5F;&#x91CD;&#x53E0;&#x4E86;&#x3002;&#x6240;&#x4EE5;&#x5C31;&#x4F1A;&#x51FA;&#x73B0;2&#x4E2A; Cell &#x91CD;&#x53E0;&#x7684;&#x60C5;&#x51B5;&#x3002;</p>
<p>&#x800C;&#x4E14;&#x4E2D;&#x95F4;&#x4E5F;&#x6CA1;&#x6709;&#x7A7A;&#x51FA;&#x8C03;&#x7528;&#x8005; Cell &#x7684;&#x4F4D;&#x7F6E;&#x3002;&#x56E0;&#x4E3A; i + size &#x4EE5;&#x540E;&#xFF0C;&#x8303;&#x56F4;&#x8FD8;&#x5728;&#x540C;&#x4E00;&#x4E2A; Level - 9 &#x7684; Cell &#x5185;&#x3002;</p>
<p>&#x5982;&#x679C; Level &#x66F4;&#x5C0F;&#xFF0C;&#x91CD;&#x53E0;&#x60C5;&#x51B5;&#x53C8;&#x4F1A;&#x53D1;&#x751F;&#x53D8;&#x5316;&#x3002;&#x6BD4;&#x5982; Level - 5 &#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">AllNeighbors := cellID.Parent(10).AllNeighbors(5)</span><br><span class="line"></span><br><span class="line">3953034572924452864,</span><br><span class="line">3946279173483397120,</span><br><span class="line">3946279173483397120,</span><br><span class="line">3957538172551823360,</span><br><span class="line">3955286372738138112,</span><br><span class="line">3957538172551823360,</span><br><span class="line">3962041772179193856,</span><br><span class="line">3959789972365508608</span><br></pre></td></tr></table></figure>

<p>&#x753B;&#x5728;&#x5730;&#x56FE;&#x4E0A;&#x5C31;&#x662F;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/099b7de2c3925c1bbe582ca3d15912af449e732feccb0f3a4ffd07b9a6d1418f" alt></p>
<p>&#x91CD;&#x53E0;&#x7684;&#x4F4D;&#x7F6E;&#x4E5F;&#x53D1;&#x751F;&#x4E86;&#x53D8;&#x5316;&#x3002;</p>
<p>&#x81F3;&#x6B64;&#xFF0C;&#x67E5;&#x627E;&#x90BB;&#x5C45;&#x76F8;&#x5173;&#x7684;&#x7B97;&#x6CD5;&#x90FD;&#x4ECB;&#x7ECD;&#x5B8C;&#x4E86;&#x3002;</p>
<hr>
<p>&#x7A7A;&#x95F4;&#x641C;&#x7D22;&#x7CFB;&#x5217;&#x6587;&#x7AE0;&#xFF1A;</p>
<p><a href="/external_links/76d29a85fc0fac06b7c4963f6ff9945f.html" target="blank" rel="noopener">&#x5982;&#x4F55;&#x7406;&#x89E3; n &#x7EF4;&#x7A7A;&#x95F4;&#x548C; n &#x7EF4;&#x65F6;&#x7A7A;</a><br><a href="/external_links/52a19b7b28ab82d1ca88e5f7165a28f6.html" target="blank" rel="noopener">&#x9AD8;&#x6548;&#x7684;&#x591A;&#x7EF4;&#x7A7A;&#x95F4;&#x70B9;&#x7D22;&#x5F15;&#x7B97;&#x6CD5; &#x2014; Geohash &#x548C; Google S2</a><br><a href="/external_links/81ea90798b2b64d6c2984c9ff549785f.html" target="blank" rel="noopener">Google S2 &#x4E2D;&#x7684; CellID &#x662F;&#x5982;&#x4F55;&#x751F;&#x6210;&#x7684; &#xFF1F;</a><br><a href="/external_links/aa451a3f48537d2319b99c0fff057a14.html" target="blank" rel="noopener">Google S2 &#x4E2D;&#x7684;&#x56DB;&#x53C9;&#x6811;&#x6C42; LCA &#x6700;&#x8FD1;&#x516C;&#x5171;&#x7956;&#x5148;</a><br><a href="/external_links/27f5c240298b534c0d464e755868f792.html" target="blank" rel="noopener">&#x795E;&#x5947;&#x7684;&#x5FB7;&#x5E03;&#x9C81;&#x56E0;&#x5E8F;&#x5217;</a><br><a href="/external_links/58ced8034a2f008944282b99a3413737.html" target="blank" rel="noopener">&#x56DB;&#x53C9;&#x6811;&#x4E0A;&#x5982;&#x4F55;&#x6C42;&#x5E0C;&#x5C14;&#x4F2F;&#x7279;&#x66F2;&#x7EBF;&#x7684;&#x90BB;&#x5C45; &#xFF1F;</a></p>
<blockquote>
<p>GitHub Repo&#xFF1A;<a href="/external_links/6d4602bc724d5393d9c8334bc7b35243.html" target="blank" rel="noopener">Halfrost-Field</a></p>
<p>Follow: <a href="/external_links/8d322f90b7471a77ffeac3c940a8742b.html" target="blank" rel="noopener">halfrost &#xB7; GitHub</a></p>
<p>Source: <a href="/external_links/be8243ec876e8ea2ceadaa9ec653d517.html" target="blank" rel="noopener">halfrost.com/go_s2_Hilbe&#x2026;</a></p>
</blockquote>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/2ecb835a025a51e3cb67a21032077db6.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903512338350088.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903512338350088.html" itemprop="url">Spring Cloud 服务第一次请求超时的优化</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-19T17:19:34+08:00">
                2017-11-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ol>
<li>&#x95EE;&#x9898;&#x80CC;&#x666F;</li>
</ol>
<hr>
<p>&#x4F7F;&#x7528;Spring Cloud&#x7EC4;&#x4EF6;&#x6784;&#x5EFA;&#x7684;&#x670D;&#x52A1;&#x96C6;&#x7FA4;&#xFF0C;&#x5728;&#x7B2C;&#x4E00;&#x6B21;&#x8BF7;&#x6C42;&#x65F6;&#x7ECF;&#x5E38;&#x4F1A;&#x51FA;&#x73B0;timeout&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x7136;&#x800C;&#x7B2C;&#x4E8C;&#x6B21;&#x5C31;&#x6B63;&#x5E38;&#x4E86;&#x3002;Spring Cloud&#x7248;&#x672C;&#x4E3A;Dalston.SR4&#x3002;</p>
<p>&#x542F;&#x52A8;&#x6D89;&#x53CA;&#x5230;&#x7684;&#x76F8;&#x5173;&#x670D;&#x52A1;&#xFF1A;</p>
<ul>
<li>gateway(zuul&#x7F51;&#x5173;)</li>
<li>auth-Service&#xFF08;&#x9274;&#x6743;&#x670D;&#x52A1;&#xFF09;</li>
<li>user-Service&#xFF08;&#x7528;&#x6237;&#x670D;&#x52A1;&#xFF09;</li>
</ul>
<p>&#x6D4B;&#x8BD5;&#x7684;&#x7AEF;&#x70B9;&#x63A5;&#x53E3;&#x4E3A;&#xFF1A;http:/login/oauth/token&#x3002;&#x670D;&#x52A1;&#x4E4B;&#x95F4;&#x7684;&#x8C03;&#x7528;&#x987A;&#x5E8F;&#x4E3A;&#xFF1A;gateway-&gt;auth-Service-&gt;user-Service&#x3002;&#x7F51;&#x5173;&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x8F6C;&#x53D1;&#x8BF7;&#x6C42;&#x5230;&#x9274;&#x6743;&#x670D;&#x52A1;&#xFF0C;&#x9274;&#x6743;&#x670D;&#x52A1;&#x5BF9;&#x7528;&#x6237;&#x8EAB;&#x4EFD;&#x7684;&#x6838;&#x9A8C;&#x662F;&#x901A;&#x8FC7;&#x8C03;&#x7528;&#x7528;&#x6237;&#x670D;&#xFF0C;&#x7528;&#x6237;&#x670D;&#x52A1;&#x7ED9;&#x9274;&#x6743;&#x670D;&#x52A1;&#x8FD4;&#x56DE;&#x8EAB;&#x4EFD;&#x6821;&#x9A8C;&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x9274;&#x6743;&#x670D;&#x52A1;&#x5C06;&#x8EAB;&#x4EFD;&#x6388;&#x6743;&#x4FE1;&#x606F;&#x8FD4;&#x56DE;&#x7ED9;gateway&#xFF0C;gateway&#x5C06;&#x6700;&#x7EC8;&#x7684;&#x7ED3;&#x679C;response&#x8FD4;&#x56DE;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;&#x3002;&#x4E09;&#x4E2A;&#x670D;&#x52A1;&#x542F;&#x52A8;&#x540E;&#xFF0C;&#x901A;&#x8FC7;zipkin&#x76D1;&#x63A7;&#x8C03;&#x7528;&#x94FE;&#x8DEF;&#x4FE1;&#x606F;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x7B2C;&#x4E00;&#x6B21;&#x548C;&#x7B2C;&#x4E8C;&#x6B21;&#x8C03;&#x7528;&#x60C5;&#x51B5;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#xFF1A;</p>
<p><a href="/external_links/fd0597a35a5f30a03697242a5faae5f1.html" target="blank" rel="noopener"><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/9bdafa1e86f7d713d67f9aa39587b3aba69be4236ee7993138c8fff8431c838a" alt="not-eager-1st" title="&#x9996;&#x6B21;&#x8C03;&#x7528;&#x7AEF;&#x70B9;"></a></p>
<p><a href="/external_links/fd0597a35a5f30a03697242a5faae5f1.html" target="blank" rel="noopener">&#x9996;&#x6B21;&#x8C03;&#x7528;&#x7AEF;&#x70B9;</a></p>
<p><a href="/external_links/6e800c5ad466cf116adc82a139b34372.html" target="blank" rel="noopener"><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/3227c54a27aecbd63b73360ae0dc10a5457565abb2b5334c0980291b1b529529" alt="second" title="&#x7B2C;&#x4E8C;&#x6B21;&#x8C03;&#x7528;&#x4FE1;&#x606F;"></a></p>
<p><a href="/external_links/6e800c5ad466cf116adc82a139b34372.html" target="blank" rel="noopener">&#x7B2C;&#x4E8C;&#x6B21;&#x8C03;&#x7528;&#x4FE1;&#x606F;</a></p>
<p>&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x4E24;&#x6B21;&#x7684;&#x94FE;&#x8DEF;&#x76D1;&#x63A7;&#x4FE1;&#x606F;&#x622A;&#x56FE;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x7B2C;&#x4E00;&#x6B21;&#x7684;&#x8017;&#x65F6;&#x662F;&#x7B2C;&#x4E8C;&#x6B21;&#x7684;10&#x591A;&#x500D;&#x3002;&#x9047;&#x5230;&#x67D0;&#x4E9B;&#x60C5;&#x51B5;&#xFF0C;&#x5F88;&#x53EF;&#x80FD;&#x4F1A;&#x51FA;&#x73B0;&#x7B2C;&#x4E00;&#x6B21;&#x8BF7;&#x6C42;&#x7684;&#x8D85;&#x65F6;&#x3002;&#x53BB;&#x5B98;&#x7F51;&#x770B;&#x4E86;&#x4E0B;&#xFF0C;&#x4E3B;&#x8981;&#x539F;&#x56E0;&#x662F;zuul&#x7F51;&#x5173;&#x548C;&#x5404;&#x4E2A;&#x8C03;&#x7528;&#x670D;&#x52A1;&#x4E4B;&#x95F4;&#x7684;Ribbon&#x8FDB;&#x884C;&#x5BA2;&#x6237;&#x7AEF;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7684;Client&#x61D2;&#x52A0;&#x8F7D;&#xFF0C;&#x5BFC;&#x81F4;&#x7B2C;&#x4E00;&#x6B21;&#x7684;&#x8BF7;&#x6C42;&#x8C03;&#x7528;&#x5305;&#x62EC;&#x4E86;&#x521B;&#x5EFA;Ribbon Client&#x7684;&#x65F6;&#x95F4;&#x3002;&#x901A;&#x8FC7;&#x542F;&#x52A8;&#x65E5;&#x5FD7;&#x4FE1;&#x606F;&#x5C31;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#xFF1A;</p>
<p><a href="/external_links/333bcf496ea91bd24c5480b3a39c3df4.html" target="blank" rel="noopener"><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/b850edc018f686afb56129fb013e72d256de32e6753bc305f053c07f6e21e783" alt="lazy-load" title="Ribbon &#x5BA2;&#x6237;&#x7AEF;&#x61D2;&#x52A0;&#x8F7D;"></a></p>
<p><a href="/external_links/333bcf496ea91bd24c5480b3a39c3df4.html" target="blank" rel="noopener">Ribbon &#x5BA2;&#x6237;&#x7AEF;&#x61D2;&#x52A0;&#x8F7D;</a></p>
<p>&#x4E0B;&#x9762;&#x5206;&#x4E24;&#x90E8;&#x5206;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x4E00;&#x662F;&#x670D;&#x52A1;&#x4E4B;&#x95F4;&#x8C03;&#x7528;Ribbon&#x7684;&#x9965;&#x997F;&#x52A0;&#x8F7D;&#xFF0C;&#x5BF9;&#x5E94;&#x4E0A;&#x9762;&#x7684;&#x6D4B;&#x8BD5;&#x4E3A;auth-Service&#x8C03;&#x7528;user-Service&#xFF1B;&#x4E8C;&#x662F;zuul&#x7F51;&#x5173;&#x7684;&#x9965;&#x997F;&#x52A0;&#x8F7D;&#x3002;</p>
<ol start="2">
<li>ribbon&#x7684;&#x9965;&#x997F;&#x52A0;&#x8F7D;</li>
</ol>
<hr>
<p>&#x7ECF;&#x8FC7;&#x8C03;&#x67E5;&#x53D1;&#x73B0;&#xFF0C;&#x9020;&#x6210;&#x7B2C;&#x4E00;&#x6B21;auth-Service&#x8C03;&#x7528;user-Service&#x8017;&#x65F6;&#x957F;&#x7684;&#x539F;&#x56E0;&#x4E3B;&#x8981;&#x662F;&#xFF0C;Ribbon&#x8FDB;&#x884C;&#x5BA2;&#x6237;&#x7AEF;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7684;&#x670D;&#x52A1;&#x5B9E;&#x4F8B;&#x5E76;&#x4E0D;&#x662F;&#x5728;&#x670D;&#x52A1;&#x542F;&#x52A8;&#x7684;&#x65F6;&#x5019;&#x5C31;&#x521D;&#x59CB;&#x5316;&#x597D;&#x7684;&#xFF0C;&#x800C;&#x662F;&#x5728;&#x8C03;&#x7528;&#x7684;&#x65F6;&#x5019;&#x624D;&#x4F1A;&#x53BB;&#x521B;&#x5EFA;&#x76F8;&#x5E94;&#x7684;&#x670D;&#x52A1;&#x5B9E;&#x4F8B;&#x3002;&#x6240;&#x4EE5;&#x7B2C;&#x4E00;&#x6B21;&#x8C03;&#x7528;user-Service&#x8017;&#x65F6;&#x4E0D;&#x4EC5;&#x4EC5;&#x5305;&#x542B;&#x53D1;&#x9001;HTTP&#x8BF7;&#x6C42;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x8FD8;&#x5305;&#x542B;&#x4E86;&#x521B;&#x5EFA;Ribbon Client&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x8FD9;&#x6837;&#x4E00;&#x6765;&#x5982;&#x679C;&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#x901F;&#x5EA6;&#x8F83;&#x6162;&#xFF0C;&#x540C;&#x65F6;&#x8BBE;&#x7F6E;&#x7684;&#x8BF7;&#x6C42;&#x8D85;&#x65F6;&#x53C8;&#x6BD4;&#x8F83;&#x77ED;&#x7684;&#x8BDD;&#xFF0C;&#x5F88;&#x5BB9;&#x6613;&#x5C31;&#x4F1A;&#x51FA;&#x73B0;&#x8017;&#x65F6;&#x5F88;&#x957F;&#x751A;&#x81F3;&#x8D85;&#x65F6;&#x7684;&#x60C5;&#x51B5;&#x3002;&#x5728;&#x5B98;&#x7F51;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5982;&#x4E0B;&#x7684;&#x914D;&#x7F6E;&#x8BF4;&#x660E;&#xFF1A;</p>
<blockquote>
<p>Each Ribbon named client has a corresponding child Application Context that Spring Cloud maintains, this application context is lazily loaded up on the first request to the named client. This lazy loading behavior can be changed to instead<br> eagerly load up these child Application contexts at startup by specifying the names of the Ribbon clients.</p>
</blockquote>
<p>&#x610F;&#x4E3A;Spring Cloud&#x4E3A;&#x6BCF;&#x4E2A;Ribbon&#x5BA2;&#x6237;&#x7AEF;&#x7EF4;&#x62A4;&#x4E86;&#x4E00;&#x4E2A;&#x76F8;&#x5BF9;&#x7684;&#x5B50;&#x5E94;&#x7528;&#x73AF;&#x5883;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#xFF0C;&#x5E94;&#x7528;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x5728;&#x7B2C;&#x4E00;&#x6B21;&#x8BF7;&#x6C42;&#x5230;&#x6307;&#x5B9A;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x65F6;&#x5019;&#x61D2;&#x52A0;&#x8F7D;&#x3002;&#x4E0D;&#x8FC7;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5982;&#x4E0B;&#x914D;&#x7F6E;&#x8FDB;&#x884C;&#x4FEE;&#x6539;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yaml&#x590D;&#x5236;&#x4EE3;&#x7801;ribbon:</span><br><span class="line">  eager-load:</span><br><span class="line">    enabled: true</span><br><span class="line">    clients: client1, client2, client3</span><br></pre></td></tr></table></figure>

<p>&#x6309;&#x7167;&#x5982;&#x4E0A;&#x7684;&#x914D;&#x7F6E;&#x4E4B;&#x540E;&#xFF0C;&#x53D1;&#x73B0;&#x9274;&#x6743;&#x670D;&#x52A1;&#x542F;&#x52A8;&#x65F6;&#x5C31;&#x5C06;user&#x670D;&#x52A1;&#x7684;Ribbon&#x5BA2;&#x6237;&#x7AEF;&#x8FDB;&#x884C;&#x4E86;&#x52A0;&#x8F7D;&#x3002;</p>
<p><a href="/external_links/5b8b1a62e37b4b444c8059db21cd3bab.html" target="blank" rel="noopener"><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/f7324c086a4acb590789b842f48abeed2b5c2ad6a03b7abaa1e00336e30e8e71" alt="el" title="user&#x670D;&#x52A1;eager load"></a></p>
<p><a href="/external_links/5b8b1a62e37b4b444c8059db21cd3bab.html" target="blank" rel="noopener">user&#x670D;&#x52A1;eager load</a></p>
<ol start="3">
<li>zuul&#x7F51;&#x5173;&#x7684;&#x9965;&#x997F;&#x52A0;&#x8F7D;</li>
</ol>
<hr>
<p>&#x4E0A;&#x9762;&#x5C0F;&#x8282;&#x89E3;&#x51B3;&#x4E86;auth-Service&#x8C03;&#x7528;user-Service&#x7684;Ribbon&#x5BA2;&#x6237;&#x7AEF;&#x542F;&#x52A8;&#x65F6;&#x9965;&#x997F;&#x52A0;&#x8F7D;&#x3002;&#x7F51;&#x5173;&#x4F5C;&#x4E3A;&#x5BF9;&#x5916;&#x8BF7;&#x6C42;&#x7684;&#x5165;&#x53E3;&#xFF0C;zuul&#x5185;&#x90E8;&#x4F7F;&#x7528;Ribbon&#x8C03;&#x7528;&#x5176;&#x4ED6;&#x670D;&#x52A1;&#xFF0C;Spring Cloud&#x9ED8;&#x8BA4;&#x5728;&#x7B2C;&#x4E00;&#x6B21;&#x8C03;&#x7528;&#x65F6;&#x61D2;&#x52A0;&#x8F7D;Ribbon&#x5BA2;&#x6237;&#x7AEF;&#x3002;zuul&#x540C;&#x6837;&#x9700;&#x8981;&#x7EF4;&#x62A4;&#x4E00;&#x4E2A;&#x76F8;&#x5BF9;&#x7684;&#x5B50;&#x5E94;&#x7528;&#x73AF;&#x5883;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#xFF0C;&#x6240;&#x4EE5;&#x4E5F;&#x9700;&#x8981;&#x542F;&#x52A8;&#x65F6;&#x9965;&#x997F;&#x52A0;&#x8F7D;&#x3002;</p>
<blockquote>
<p>Zuul internally uses Ribbon for calling the remote url&#x2019;s and Ribbon clients are by default lazily loaded up by Spring Cloud on first call. This behavior can be changed for Zuul using the following configuration and will result in the child<br> Ribbon related Application contexts being eagerly loaded up at application startup time.</p>
</blockquote>
<p>&#x5177;&#x4F53;&#x914D;&#x7F6E;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yaml&#x590D;&#x5236;&#x4EE3;&#x7801;zuul:</span><br><span class="line">  ribbon:</span><br><span class="line">    eager-load:</span><br><span class="line">      enabled: true</span><br></pre></td></tr></table></figure>

<p>&#x81F3;&#x6B64;&#xFF0C;&#x4F18;&#x5316;&#x5B8C;&#x6210;&#xFF0C;&#x518D;&#x6B21;&#x91CD;&#x542F;&#x670D;&#x52A1;&#x8FDB;&#x884C;&#x7B2C;&#x4E00;&#x6B21;&#x8BF7;&#x6C42;&#xFF0C;&#x53D1;&#x73B0;&#x60C5;&#x51B5;&#x5DF2;&#x7ECF;&#x597D;&#x591A;&#x4E86;&#xFF0C;&#x5927;&#x5BB6;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x52A8;&#x624B;&#x5C1D;&#x8BD5;&#x6539;&#x8FDB;&#x4E00;&#x4E0B;&#x3002;</p>
<ol start="4">
<li>&#x603B;&#x7ED3;</li>
</ol>
<hr>
<p>&#x672C;&#x6587;&#x4E3B;&#x8981;&#x4ECB;&#x7ECD;&#x4E86;Spring Cloud&#x7684;&#x670D;&#x52A1;&#x7B2C;&#x4E00;&#x6B21;&#x8BF7;&#x6C42;&#x8D85;&#x65F6;&#x7684;&#x4F18;&#x5316;&#x65B9;&#x6CD5;&#x3002;&#x9996;&#x5148;&#x4ECB;&#x7ECD;&#x4E86;&#x95EE;&#x9898;&#x7684;&#x80CC;&#x666F;&#xFF0C;&#x5E76;&#x6392;&#x67E5;&#x4E86;&#x95EE;&#x9898;&#x9020;&#x6210;&#x7684;&#x539F;&#x56E0;&#xFF0C;&#x4E3B;&#x8981;&#x662F;Ribbon&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x61D2;&#x52A0;&#x8F7D;&#xFF1B;&#x7136;&#x540E;&#x5206;&#x522B;&#x9488;&#x5BF9;zuul&#x7F51;&#x5173;&#x548C;&#x670D;&#x52A1;&#x4E4B;&#x95F4;&#x8C03;&#x7528;&#x7684;Ribbon&#x5BA2;&#x6237;&#x7AEF;&#x8FDB;&#x884C;&#x914D;&#x7F6E;&#xFF0C;&#x4F7F;&#x5176;&#x542F;&#x52A8;&#x65F6;&#x4FBF;&#x52A0;&#x8F7D;Ribbon&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x76F8;&#x5173;&#x4E0A;&#x4E0B;&#x6587;&#x4FE1;&#x606F;&#x3002;&#x6700;&#x540E;&#x60F3;&#x8BF4;&#x7684;&#x662F;&#xFF0C;http&#x8C03;&#x7528;&#x6BD5;&#x7ADF;&#x8FD8;&#x662F;&#x6027;&#x80FD;&#x8FDC;&#x4F4E;&#x4E8E;RPC&#x3002;&#x3002;&#x1F642;</p>
<hr>
<h3 id="&#x53C2;&#x8003;"><a href="#&#x53C2;&#x8003;" class="headerlink" title="&#x53C2;&#x8003;"></a>&#x53C2;&#x8003;</h3><ol>
<li><p><a href="/external_links/e67bb7efac9a1b1fd9de382c892e0bdc.html" target="blank" rel="noopener">spring-cloud Dalston.SR4</a></p>
</li>
<li><p><a href="/external_links/de13fa3068c6cf368bc2492bfa160303.html" target="blank" rel="noopener">Spring Cloud&#x5B9E;&#x6218;&#x5C0F;&#x8D34;&#x58EB;&#xFF1A;Ribbon&#x7684;&#x9965;&#x997F;&#x52A0;&#x8F7D;(eager-load)&#x6A21;&#x5F0F;</a></p>
<p><a href="/external_links/4bbcadc3111af6b1aae846b7ea40937f.html" target="blank" rel="noopener"><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/e17c72f5805ac3a8af3c0863256a32d6c739ee2c0c7807ed1659a543d303f8e6" alt="aoho wechat"></a> &#x6B22;&#x8FCE;&#x60A8;&#x626B;&#x4E00;&#x626B;&#x4E0A;&#x9762;&#x7684;&#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x53F7;&#xFF0C;aoho&#x6C42;&#x7D22;&#xFF0C;&#x8BA2;&#x9605;&#x6211;&#x7684;&#x535A;&#x5BA2;! &#x575A;&#x6301;&#x539F;&#x521B;&#x6280;&#x672F;&#x5206;&#x4EAB;&#xFF0C;&#x60A8;&#x7684;&#x652F;&#x6301;&#x5C06;&#x9F13;&#x52B1;&#x6211;&#x7EE7;&#x7EED;&#x521B;&#x4F5C;&#xFF01;</p>
<p>&#x8D4F;<br><a href="/external_links/00eeb6974b56ad3064e321c2f86b6234.html" target="blank" rel="noopener"><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/bb8c13632250559e38f22aa9c1159cb27e6db41dd817a89fda1e8dd9bd476bf7" alt="aoho WeChat Pay"></a><br>&#x5FAE;&#x4FE1;&#x6253;&#x8D4F;</p>
<p><a href="/external_links/b0e560acb3c57efa861fa7f65d86e5a2.html" target="blank" rel="noopener"><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/a43d623b82c9b85e58b86a58426062d4a6ff969eae9607706cf54fe91f554c24" alt="aoho Alipay"></a><br>&#x652F;&#x4ED8;&#x5B9D;&#x6253;&#x8D4F;</p>
</li>
</ol>
<ul>
<li><strong>&#x672C;&#x6587;&#x4F5C;&#x8005;&#xFF1A;</strong> aoho</li>
<li><strong>&#x672C;&#x6587;&#x94FE;&#x63A5;&#xFF1A;</strong> <a href="/external_links/e601ff33f48d816d247efdfa1ff86980.html" target="blank" rel="noopener">blueskykong.com/2017/11/18/&#x2026;</a></li>
<li><strong>&#x7248;&#x6743;&#x58F0;&#x660E;&#xFF1A;</strong>  &#x672C;&#x535A;&#x5BA2;&#x6240;&#x6709;&#x6587;&#x7AE0;&#x9664;&#x7279;&#x522B;&#x58F0;&#x660E;&#x5916;&#xFF0C;&#x5747;&#x91C7;&#x7528; <a href="/external_links/3c00164bbb3990280e665a92cb8959dd.html" target="blank" rel="noopener">CC BY-NC-SA 3.0</a> &#x8BB8;&#x53EF;&#x534F;&#x8BAE;&#x3002;&#x8F6C;&#x8F7D;&#x8BF7;&#x6CE8;&#x660E;&#x51FA;&#x5904;&#xFF01;</li>
</ul>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/4fcc4c16961967d5d8511b76fee2c27b.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="../385/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="../../">1</a><span class="space">&hellip;</span><a class="page-number" href="../385/">385</a><span class="page-number current">386</span><a class="page-number" href="../387/">387</a><span class="space">&hellip;</span><a class="page-number" href="../399/">399</a><a class="extend next" rel="next" href="../387/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">开发者博客</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="https://dev.newban.cn/archives/">
              
                  <span class="site-state-item-count">3990</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">1304</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="../../atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">开发者博客</span>
  <div>
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
  </div>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




  <script type="text/javascript" async src="js/src/mermaid.min.js"></script>
  <script>
  if (window.mermaid) {
        var mermaid_config = {
            startOnLoad: true,
            theme: 'default',
            flowchart:{
                useMaxWidth: false,
                htmlLabels: true
            }                
        }
        mermaid.initialize(mermaid_config);
  }
  </script>
  

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="../../lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="../../lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="../../lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="../../lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="../../lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="../../lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="../../js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="../../js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="../../js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
