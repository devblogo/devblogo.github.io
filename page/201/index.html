<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">
<meta name="referrer" content="never">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="../../lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="../../lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="../../css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="../../images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="../../images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="../../images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="../../images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">





  <link rel="alternate" href="../../atom.xml" title="开发者博客 – IT技术 尽在开发者博客" type="application/atom+xml">






<meta property="og:type" content="website">
<meta property="og:title" content="开发者博客 – IT技术 尽在开发者博客">
<meta property="og:url" content="https://dev.newban.cn/page/201/index.html">
<meta property="og:site_name" content="开发者博客 – IT技术 尽在开发者博客">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="开发者博客 – IT技术 尽在开发者博客">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>
<!--谷歌广告验证代码-->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-2626449904708114",
          enable_page_level_ads: true
     });
</script>
<!--谷歌广告验证代码-->



  <link rel="canonical" href="https://dev.newban.cn/page/201/">





  <title>开发者博客 – IT技术 尽在开发者博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">开发者博客 – IT技术 尽在开发者博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">开发者博客 – 科技是第一生产力</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="http://dev.newban.cn/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="https://dev.newban.cn/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7033040253673799711.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7033040253673799711.html" itemprop="url">Java实现图片转字符输出示例demo</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-11-21T23:09:26+08:00">
                2021-11-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x300C;&#x8FD9;&#x662F;&#x6211;&#x53C2;&#x4E0E;11&#x6708;&#x66F4;&#x6587;&#x6311;&#x6218;&#x7684;&#x7B2C;18&#x5929;&#xFF0C;&#x6D3B;&#x52A8;&#x8BE6;&#x60C5;&#x67E5;&#x770B;&#xFF1A;<a href="https://dev.newban.cn/7023643374569816095">2021&#x6700;&#x540E;&#x4E00;&#x6B21;&#x66F4;&#x6587;&#x6311;&#x6218;</a>&#x300D;&#x3002;</p>
<p>&#x524D;&#x9762;&#x51E0;&#x7BC7;&#x535A;&#x6587;&#x4ECB;&#x7ECD;&#x4E86;&#x4F7F;&#x7528;jdk&#x6765;&#x5BF9;&#x56FE;&#x7247;&#x505A;&#x4E00;&#x4E9B;&#x6709;&#x610F;&#x601D;&#x7684;&#x8F6C;&#x6362;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x518D;&#x4ECB;&#x7ECD;&#x4E00;&#x4E2A;&#x6709;&#x610F;&#x601D;&#x7684;&#x73A9;&#x6CD5;&#xFF0C;&#x76F4;&#x63A5;&#x6839;&#x636E;&#x56FE;&#x7247;&#xFF0C;&#x8F93;&#x51FA;&#x4E00;&#x4E2A;&#x4E8C;&#x7EF4;&#x5B57;&#x7B26;&#x6570;&#x7EC4;&#xFF0C;&#x5B9E;&#x73B0;&#x7528;&#x5B57;&#x7B26;&#x6765;&#x5B9E;&#x73B0;&#x7ED8;&#x753B;&#x7684;&#x573A;&#x666F;</p>
<p>&#x5404;&#x4F4D;&#x5C0F;&#x4F19;&#x4F34;&#x53EF;&#x80FD;&#x90FD;&#x6709;&#x770B;&#x5230;&#x8FC7;&#x4E00;&#x4E9B;&#x6709;&#x8DA3;&#x7684;&#x6CE8;&#x91CA;&#xFF0C;&#x6BD4;&#x5982;&#x5927;&#x4F5B;&#xFF0C;&#x7F8E;&#x5973;&#x4E4B;&#x7C7B;&#x7684;&#xFF0C;&#x901A;&#x5173;&#x672C;&#x6587;&#xFF0C;&#x76F8;&#x4FE1;&#x4F60;&#x4E5F;&#x5F88;&#x53EF;&#x4EE5;&#x5F88;&#x7B80;&#x5355;&#x7684;&#x5B9E;&#x73B0;&#x7C7B;&#x4F3C;&#x7684;&#x573A;&#x666F;</p>
<p>&#x5173;&#x952E;&#x5B9E;&#x73B0;&#xFF0C;&#x5728;&#x524D;&#x9762;&#x7684;&#x6587;&#x7AE0;&#x4E2D;&#x5176;&#x5B9E;&#x4E5F;&#x8BF4;&#x5230;&#x4E86;&#xFF0C;&#x4E0B;&#x9762;&#x662F;&#x8D85;&#x94FE;</p>
<ul>
<li><a href="/external_links/ef5ab769cc492103e758305ebd759f0a.html" target="blank" rel="noopener">Java&#x5B9E;&#x73B0;&#x56FE;&#x7247;&#x7070;&#x5EA6;&#x5316;</a></li>
<li><a href="/external_links/5d49f3449a5c347c2ef265c97b9a90e3.html" target="blank" rel="noopener">Java&#x5B9E;&#x73B0;&#x56FE;&#x7247;&#x8F6C;&#x5B57;&#x7B26;&#x56FE;&#x7247;&#x793A;&#x4F8B;demo</a></li>
<li><a href="/external_links/2527e92936611e3b8b934f8b0f0ca6b7.html" target="blank" rel="noopener">Java&#x5B9E;&#x73B0;Gif&#x56FE;&#x8F6C;&#x5B57;&#x7B26;&#x52A8;&#x56FE;</a></li>
</ul>
<p>&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x505A;&#x7684;&#x5C31;&#x662F;&#x5C06;&#x4E4B;&#x524D;&#x8F6C;&#x6210;&#x5B57;&#x7B26;&#x56FE;&#x7247;&#x8F93;&#x51FA;&#x7684;&#x5730;&#x65B9;&#x7A0D;&#x5FAE;&#x6539;&#x4E00;&#x4E0B;&#xFF0C;&#x6839;&#x636E;&#x5F53;&#x524D;&#x8272;&#x989C;&#x8272;&#xFF0C;&#x6765;&#x9009;&#x62E9;&#x5408;&#x9002;&#x7684;&#x66FF;&#x6362;&#x5B57;&#x7B26;&#x4FDD;&#x5B58;&#x4E0B;&#x6765;</p>
<p>&#x6240;&#x4EE5;&#x5173;&#x952E;&#x7684;&#x5B9E;&#x73B0;&#x5728;&#x4E8E;&#xFF0C;&#x5982;&#x4F55;&#x6839;&#x636E;&#x989C;&#x8272;&#x6765;&#x9009;&#x62E9;&#x5B57;&#x7B26;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;// &#x8FD9;&#x4E2A;&#x5B57;&#x7B26;&#x6765;&#x81EA;&#x4E8E;github&#x641C;&#x7D22;&#x7ED3;&#x679C;&#xFF0C;&#x4E0B;&#x9762;&#x5C06;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x4ECE;&#x539F;&#x6765;&#x7684;&#x70B9;&#x53F7;&#x6539;&#x6210;&#x4E86;&#x7A7A;&#x683C;&#xFF0C;&#x5373;&#x767D;&#x8272;&#x65F6;&#xFF0C;&#x4E0D;&#x8F93;&#x51FA;&#x5B57;&#x7B26;</span><br><span class="line">private static final String DEFAULT_CHAR_SET = &quot;$@B%8&amp;WM#*oahkbdpqwmZO0QLCJUYXzcvunxrjft/\\|()1{}[]?-_+~&lt;&gt;i!lI;:,\\\&quot;^`&apos; &quot;;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * &#x57FA;&#x4E8E;&#x989C;&#x8272;&#x7684;&#x7070;&#x5EA6;&#x503C;&#xFF0C;&#x83B7;&#x53D6;&#x5BF9;&#x5E94;&#x7684;&#x5B57;&#x7B26;</span><br><span class="line"> * @param g</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">public static char toChar(Color g) {</span><br><span class="line">    double gray = 0.299 * g.getRed() + 0.578 * g.getGreen() + 0.114 * g.getBlue();</span><br><span class="line">    return DEFAULT_CHAR_SET.charAt((int) (gray / 255 * DEFAULT_CHAR_SET.length()));</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x9488;&#x5BF9;&#x4E4B;&#x524D;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x7A0D;&#x5FAE;&#x6539;&#x9020;&#x4E00;&#x4E0B;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;Color getAverage(BufferedImage image, int x, int y, int w, int h) {</span><br><span class="line">    int red = 0;</span><br><span class="line">    int green = 0;</span><br><span class="line">    int blue = 0;</span><br><span class="line"></span><br><span class="line">    int size = 0;</span><br><span class="line">    for (int i = y; (i &lt; h + y) &amp;&amp; (i &lt; image.getHeight()); i++) {</span><br><span class="line">        for (int j = x; (j &lt; w + x) &amp;&amp; (j &lt; image.getWidth()); j++) {</span><br><span class="line">            int color = image.getRGB(j, i);</span><br><span class="line">            red += ((color &amp; 0xff0000) &gt;&gt; 16);</span><br><span class="line">            green += ((color &amp; 0xff00) &gt;&gt; 8);</span><br><span class="line">            blue += (color &amp; 0x0000ff);</span><br><span class="line">            ++size;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    red = Math.round(red / (float) size);</span><br><span class="line">    green = Math.round(green / (float) size);</span><br><span class="line">    blue = Math.round(blue / (float) size);</span><br><span class="line">    return new Color(red, green, blue);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">private void parseChars(BufferedImage img) {</span><br><span class="line">    int w = img.getWidth(), h = img.getHeight();</span><br><span class="line">    // &#x8FD9;&#x4E2A;size&#x53EF;&#x7528;&#x6765;&#x63A7;&#x5236;&#x7CBE;&#x5EA6;&#xFF0C;&#x8D8A;&#x5C0F;&#x5219;&#x8D8A;&#x50CF;&#x539F;&#x56FE;</span><br><span class="line">    int size = 4;</span><br><span class="line">    List&lt;List&lt;String&gt;&gt; list = new ArrayList&lt;&gt;();</span><br><span class="line">    for (int y = 0; y &lt; h; y += size) {</span><br><span class="line">        List&lt;String&gt; line = new ArrayList&lt;&gt;();</span><br><span class="line">        for (int x = 0; x &lt; w; x += size) {</span><br><span class="line">            Color avgColor = getAverage(img, x, y, size, size);</span><br><span class="line">            line.add(String.valueOf(toChar(avgColor)));</span><br><span class="line">        }</span><br><span class="line">        list.add(line);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;---------------------- &#x5F00;&#x59CB; ------------------------&quot;);</span><br><span class="line">    for (List&lt;String&gt; line: list) {</span><br><span class="line">        for (String s: line) {</span><br><span class="line">            System.out.print(s + &quot; &quot;);</span><br><span class="line">        }</span><br><span class="line">        System.out.println();</span><br><span class="line">    }</span><br><span class="line">    System.out.println(&quot;---------------------- &#x7ED3;&#x675F; ------------------------&quot;);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x6CE8;&#x610F;&#x4E0A;&#x9762;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x9700;&#x8981;&#x91CD;&#x70B9;&#x6CE8;&#x610F;&#x7684;&#x662F;&#x539F;&#x56FE;&#x7684;&#x904D;&#x5386;&#x65B9;&#x5F0F;&#xFF0C;&#x4E00;&#x5C42;&#x4E00;&#x5C42;&#x7684;&#x904D;&#x5386;&#xFF0C;&#x5373;&#x5916;&#x90E8;&#x662F;y&#x8F74;&#xFF0C;&#x5185;&#x90E8;&#x5FAA;&#x73AF;&#x662F;x&#x8F74;</p>
<p>&#x63A5;&#x4E0B;&#x6765;&#x770B;&#x4E00;&#x4E0B;&#x6D4B;&#x8BD5;case</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;@Test</span><br><span class="line">public void testChars() throws Exception{</span><br><span class="line">    String file = &quot;http://pic.dphydh.com/pic/newspic/2017-12-13/505831-1.png&quot;;</span><br><span class="line">    BufferedImage img = ImageLoadUtil.getImageByPath(file);</span><br><span class="line">    // &#x7F29;&#x653E;&#x4E00;&#x4E0B;&#x56FE;&#x7247;&#x4E3A;300x300&#xFF0C;&#x65B9;&#x4FBF;&#x5BF9;&#x8F93;&#x51FA;&#x5B57;&#x7B26;&#x622A;&#x56FE;</span><br><span class="line">    img = GraphicUtil.scaleImg(300,300, img);</span><br><span class="line">    parseChars(img);</span><br><span class="line">    System.out.println(&quot;---over------&quot;);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5B9E;&#x9645;&#x8F93;&#x51FA;&#x5982;&#x4E0B;(&#x5B9E;&#x9645;&#x8F93;&#x51FA;&#x7ED3;&#x679C;&#x4E0E;&#x76AE;&#x795E;&#x8FD8;&#x662F;&#x5F88;&#x50CF;&#x7684;)</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/512ccbb05be8d4bf4c446d34bea49bb88d49eb8240ffa474491afa72c7869b16" alt="00.jpg"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">text&#x590D;&#x5236;&#x4EE3;&#x7801;---------------------- &#x5F00;&#x59CB; ------------------------</span><br><span class="line">                                                                                          l m                                                         </span><br><span class="line">                                                                                        &apos; b $ I                                                       </span><br><span class="line">                                                                                        f $ $ [                                                       </span><br><span class="line">                                                                                      \ 8 $ $ f                                                       </span><br><span class="line">  i ~ ,                                                                               x $ $ $ u                                                       </span><br><span class="line">  _ $ $ a X } ^                                                                     &apos; W $ $ $ c                                                       </span><br><span class="line">    c $ $ $ $ B L ] &apos;                                                               } q $ $ $ z                                                       </span><br><span class="line">    ` d $ $ $ $ $ 0 r ( &quot;                                                           t &lt; U $ $ c                                                       </span><br><span class="line">      , * $ $ $ $ z &lt; + j | `                                                     \ t &lt; &lt; O $ n                                                       </span><br><span class="line">        l W $ $ $ U &lt; &lt; &lt; ~ t [                                                   { + &lt; &lt; _ W f                                                       </span><br><span class="line">          &gt; &amp; $ $ 0 &lt; &lt; &lt; &lt; &lt; - j ~                                               \ &lt; &lt; &lt; &lt; n (                                                       </span><br><span class="line">            ! # $ k &lt; &lt; &lt; &lt; &lt; &lt; &lt; ( t `                                           j &lt; &lt; &lt; &lt; ] ?                                                       </span><br><span class="line">              : k B 1 + &lt; &lt; &lt; &lt; &lt; &lt; + n !                                       &gt; } &lt; &lt; &lt; &lt; \ i                                                       </span><br><span class="line">                ^ C z ( [ ~ &lt; &lt; &lt; &lt; &lt; &lt; f ]                                     1 &lt; &lt; &lt; &lt; &lt; u `                                                       </span><br><span class="line">                    1 v ( ) ? &lt; &lt; &lt; &lt; &lt; &lt; | {                                   ( &lt; &lt; &lt; &lt; &lt; u                                                         </span><br><span class="line">                      I v / ( 1 + &lt; &lt; &lt; &lt; &lt; 1 }   &apos; l &gt; i &quot;                     \ &lt; &lt; &lt; &lt; ~ x                                                         </span><br><span class="line">                          1 v ( ( [ ~ &lt; &lt; &lt; &lt; z r z t | \ n z f ( + &apos;           t &lt; &lt; &lt; &lt; ? /                                                         </span><br><span class="line">                            &quot; / v | ) ? &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; ] f ) ^     &quot; \ &lt; &lt; &lt; &lt; | ?                                                         </span><br><span class="line">                                &quot; ) n v / ~ &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; ~ j [   l 1 &lt; &lt; &lt; + z ^                                                         </span><br><span class="line">                                      - | &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; ] j ~ { &lt; &lt; &lt; [ u                                                           </span><br><span class="line">                                    &apos; f &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; ~ z | &lt; &lt; ~ ( /                                                           </span><br><span class="line">                                    ] + &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; n - &lt; ? n i                                                           </span><br><span class="line">                                  &apos; | &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; { ~ ) v                                                             </span><br><span class="line">                                  ) + &lt; ] 0 w f &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; ? / 1                                                             </span><br><span class="line">                                  x &lt; ~ * @ &quot; | [ &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; } c &apos;                                                             </span><br><span class="line">                                i ( &lt; } $ $ x w \ &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; / -                                                               </span><br><span class="line">                                / &lt; &lt; + % $ $ 8 _ &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; { &gt;                                                               </span><br><span class="line">                              _ q f &lt; &lt; ( q m } &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; { \ ~ &lt; &lt; &lt; } &lt;                                                               </span><br><span class="line">                            &quot; O U Z &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; n f &lt; &lt; &lt; &lt; &lt; n r [ h + &lt; &lt; \ &quot;                                                               </span><br><span class="line">                            j U U 0 } &lt; &lt; &lt; &lt; _ &lt; &lt; &lt; &lt; ~ ~ &lt; &lt; &lt; &lt; &lt; M u ( $ r &lt; &lt; t                                                                 </span><br><span class="line">                            U U U Q ( &lt; &lt; &lt; &lt; { Y v Y 0 Z } &lt; &lt; &lt; &lt; &lt; * $ $ $ x &lt; &lt; |                                                                 </span><br><span class="line">                            J U U O [ &lt; &lt; &lt; &lt; &lt; # * # # o a t &lt; &lt; &lt; &lt; j $ $ # _ &lt; &lt; )                                                                 </span><br><span class="line">                            Y U U O &lt; &lt; &lt; &lt; &lt; &lt; W b q q k # # O r \ &lt; &lt; [ / + &lt; &lt; } &lt;                                                                 </span><br><span class="line">                            x U L r &lt; &lt; &lt; &lt; &lt; &lt; d U c c C w * o L &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; f &apos;                                                                 </span><br><span class="line">                            } Q n &lt; &lt; &lt; &lt; &lt; &lt; &lt; J x x x x z w W [ &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; f         : + [ { ,                                                 </span><br><span class="line">                            ^ f &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; L x x x x x J Y &lt; &lt; &lt; &lt; &lt; &lt; _ Y O Y   ] \ j \ [ _ } -                                                 </span><br><span class="line">                              / &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; L x x x x x C _ &lt; &lt; &lt; &lt; &lt; - Z U U Z j ? &lt; &lt; &lt; &lt; &lt; \ v &gt;                                               </span><br><span class="line">                              l | &lt; &lt; &lt; &lt; &lt; &lt; &lt; Y x x x x X | &lt; &lt; &lt; &lt; &lt; &lt; J U U U z &lt; &lt; &lt; &lt; &lt; &lt; &lt; + ) (                                               </span><br><span class="line">                        i ) t / L | + &lt; &lt; &lt; &lt; &lt; c x x x c x &lt; &lt; &lt; &lt; &lt; &lt; ) L U U C t &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; f !                                               </span><br><span class="line">                    ? x ( &lt; &lt; &lt; &lt; ? f x j ~ &lt; &lt; 1 J x Y x &lt; &lt; &lt; &lt; &lt; &lt; &lt; u U U U 0 &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; + r                                                 </span><br><span class="line">                  1 { &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; _ x \ &lt; &lt; t v 1 &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; n U U Z [ &lt; &lt; &lt; &lt; &lt; &lt; &lt; v x _                                                 </span><br><span class="line">                &lt; ) &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; { u ] &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; - 0 m { &lt; &lt; &lt; &lt; &lt; &lt; &lt; } n | / n r ( / \ 1 } i &apos;                               </span><br><span class="line">                / &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; ~ U &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; | c _ &lt; &lt; &lt; &lt; &lt; &lt; &lt; - n &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; { f / ( ] ^                       </span><br><span class="line">                | &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; ) n ] _ ~ &lt; &lt; &lt; &lt; &lt; / n 1 &lt; &lt; &lt; &lt; &lt; &lt; &lt; ~ [ L + &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; _ t / 1 l                 </span><br><span class="line">                t &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; v j ( ( ) - &lt; &lt; ~ } + &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; _ 1 Q j &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; ) f ( :           </span><br><span class="line">                ) + &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; c [ ] ? ~ &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; ~ } ( c t [ &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; ~ / t &lt;       </span><br><span class="line">                ^ x { } ] ] - _ ~ &lt; &lt; &lt; ~ _ ~ r c &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; - ) ( u &lt; \ &lt; &lt; 1 - &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; \ )     </span><br><span class="line">                  &lt; c ( ( ( ( ( ( ( ) ) / Y n n &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; ~ { ( ( v i   f &lt; _ ( ( 1 _ &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; + j &apos;     </span><br><span class="line">                    ! v n ( ( ( ( r X c f ~ &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; ~ 1 ( ( c ;     r &lt; ] ( ( ( ( } + &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; + f &apos;       </span><br><span class="line">                        ] X x u u | + &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; { ( t n ^     \ f &lt; { ( ( ( ( ( ( [ ~ &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; + / &apos;         </span><br><span class="line">                        t ~ &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; - ( v {         ? ] &lt; ) ( ( ( ( ( ( ( ) ? &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; + \             </span><br><span class="line">                        u &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; { w :           \ &lt; + ( ( ( | ( ( ( ( ( ( { ~ &lt; &lt; &lt; &lt; &lt; &lt; &lt; ~ (               </span><br><span class="line">                      i \ &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; ~ n             j &lt; - ( ( / x t c n ( ( ( ( ) - &lt; &lt; &lt; &lt; &lt; ~ (                 </span><br><span class="line">                      t &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; n   + ] :     x &lt; [ ( ( v &apos;     ! | n X \ ( ( [ &lt; &lt; &lt; ~ /                   </span><br><span class="line">                      u &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; x   ( 1 | r t ( &lt; { ( x +             &quot; { j z r { ~ ~ f &apos;                   </span><br><span class="line">                    ~ 1 &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; t   ] t 1 + &lt; &lt; &lt; ( ( x                     &apos; ~ / n u ^                     </span><br><span class="line">                    t &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; \   i n ( ( ? &lt; + ( v :                                                     </span><br><span class="line">                  &apos; r &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; /   &quot; z ( ( ( } ] | \                                                       </span><br><span class="line">                  _ [ &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; t     L t \ Y u z z `                                                       </span><br><span class="line">                  / &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; / ;   Z Q Q \   , I                                                         </span><br><span class="line">                &apos; f &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; + # 0 d d d }                                                               </span><br><span class="line">                ] ? &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; Z d d d b ?                                                               </span><br><span class="line">                \ &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; u o b d k ~                                                               </span><br><span class="line">                j &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; ] | ? u d :                                                               </span><br><span class="line">                j &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; j                                                                       </span><br><span class="line">                r &lt; ~ &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; /                                                                       </span><br><span class="line">                / + ( ( { ? + &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; &lt; _ ? ] ] ] ] ] - + &lt; &lt; &lt; &lt; &lt; &lt; f                                                                       </span><br><span class="line">                i f ( ( ( ( ( 1 { } [ [ [ } 1 ( ( ( ( ( ( ( ( ( ( ) } _ &lt; &lt; &lt; /                                                                       </span><br><span class="line">                  ] X ( ( ( ( ( ( ( ( ( ( ( ( ( ( ( ( ( ( ( ( ( ( ( ( ( } &lt; &lt; |                                                                       </span><br><span class="line">              : ( f ) v u ( ( \ j u c c u x J d m C J | ( ( ( ( ( ( ( ( ( [ r \                                                                       </span><br><span class="line">          ` \ J t ] ~ { ( ( n X r , &apos;         ` &lt; ( j c C z r ( ( ( ( ( | n z }                                                                       </span><br><span class="line">          u X z r } / u c f \ 1                           l ] j z J Y Y n ) } } v _                                                                   </span><br><span class="line">          + r ( ) ( - I                                         I n c \ + &lt; &lt; ] L Z u ^                                                               </span><br><span class="line">                                                                    &apos; i ] } | ( - x O w                                                               </span><br><span class="line">                                                                              ; 1 \ z J                                                               </span><br><span class="line">---------------------- &#x7ED3;&#x675F; ------------------------</span><br></pre></td></tr></table></figure>

<p>&#x867D;&#x8BF4;&#x4E0A;&#x9762;&#x8FD9;&#x4E2A;&#x662F;&#x8F93;&#x51FA;&#x4E86;&#x5B57;&#x7B26;&#x56FE;&#xFF0C;&#x4ECE;&#x7ED3;&#x679C;&#x4E0A;&#x770B;&#x4E5F;&#x6BD4;&#x4EF7;&#x50CF;&#xFF0C;&#x4F46;&#x662F;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x82E5;&#x56FE;&#x7247;&#x7684;&#x80CC;&#x666F;&#x975E;&#x767D;&#x8272;&#xFF0C;&#x4E3B;&#x89D2;&#x4E0D;&#x662F;&#x90A3;&#x4E48;&#x7A81;&#x51FA;&#x7684;&#x573A;&#x666F;&#xFF0C;&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x65B9;&#x5F0F;&#x8F93;&#x51FA;&#x7684;&#x7ED3;&#x679C;&#x53EF;&#x80FD;&#x5C31;&#x4E0D;&#x592A;&#x53CB;&#x597D;&#x4E86;&#xFF0C;&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#x5F53;&#x7136;&#x5C31;&#x662F;&#x8BC6;&#x522B;&#x80CC;&#x666F;&#xFF0C;&#x8BC6;&#x522B;&#x4E3B;&#x4F53;&#xFF0C;&#x9488;&#x5BF9;&#x4E3B;&#x4F53;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x8F6C;&#x6362;&#xFF08;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x540E;&#x9762;&#x6709;&#x673A;&#x4F1A;&#x518D;&#x4ECB;&#x7ECD;&#xFF09;</p>
<p>&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x501F;&#x52A9;&#x5F00;&#x6E90;&#x9879;&#x76EE; <a href="/external_links/18e121fc9e2c3ec34ae16017eb0f9c82.html" target="blank" rel="noopener">github.com/liuyueyi/qu&#x2026;</a> &#x6765;&#x8FC5;&#x901F;&#x7684;&#x5B9E;&#x73B0;&#x5B57;&#x7B26;&#x56FE;&#x8F93;&#x51FA;</p>
<p>&#x4EE5;&#x4E00;&#x4E2A;&#x51B0;&#x96EA;&#x5973;&#x738B;&#x7684;&#x8F6C;&#x6362;&#x56FE;&#x6765;&#x9A8C;&#x8BC1;&#x4E0B;&#x6548;&#x679C;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;String file = &quot;http://5b0988e595225.cdn.sohucs.com/images/20200410/76499041d3b144b58d6ed83f307df8a3.jpeg&quot;;</span><br><span class="line">BufferedImage res = ImgPixelWrapper.build().setSourceImg(file).setBlockSize(4).setPixelType(PixelStyleEnum.CHAR_BLACK).build().asBufferedImg();</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/4398b3b2740d88f0c949116a4b194680a22826b3c4a3c2458a29f6f5c50a6dec" alt="01.jpg"></p>
<h2 id="&#x4E00;&#x7070;&#x7070;&#x7684;&#x8054;&#x7CFB;&#x65B9;&#x5F0F;"><a href="#&#x4E00;&#x7070;&#x7070;&#x7684;&#x8054;&#x7CFB;&#x65B9;&#x5F0F;" class="headerlink" title="&#x4E00;&#x7070;&#x7070;&#x7684;&#x8054;&#x7CFB;&#x65B9;&#x5F0F;"></a>&#x4E00;&#x7070;&#x7070;&#x7684;&#x8054;&#x7CFB;&#x65B9;&#x5F0F;</h2><p>&#x5C3D;&#x4FE1;&#x4E66;&#x5219;&#x4E0D;&#x5982;&#x65E0;&#x4E66;&#xFF0C;&#x4EE5;&#x4E0A;&#x5185;&#x5BB9;&#xFF0C;&#x7EAF;&#x5C5E;&#x4E00;&#x5BB6;&#x4E4B;&#x8A00;&#xFF0C;&#x56E0;&#x4E2A;&#x4EBA;&#x80FD;&#x529B;&#x6709;&#x9650;&#xFF0C;&#x96BE;&#x514D;&#x6709;&#x758F;&#x6F0F;&#x548C;&#x9519;&#x8BEF;&#x4E4B;&#x5904;&#xFF0C;&#x5982;&#x53D1;&#x73B0;bug&#x6216;&#x8005;&#x6709;&#x66F4;&#x597D;&#x7684;&#x5EFA;&#x8BAE;&#xFF0C;&#x6B22;&#x8FCE;&#x6279;&#x8BC4;&#x6307;&#x6B63;&#xFF0C;&#x4E0D;&#x541D;&#x611F;&#x6FC0;</p>
<ul>
<li>&#x4E2A;&#x4EBA;&#x7AD9;&#x70B9;&#xFF1A;<a href="/external_links/991b43c3ca1e64fe20f38612cf507566.html" target="blank" rel="noopener">blog.hhui.top</a></li>
<li>&#x5FAE;&#x535A;&#x5730;&#x5740;: <a href="/external_links/a83f8d003f5fa3f85f549cb3f32c015f.html" target="blank" rel="noopener">&#x5C0F;&#x7070;&#x7070;Blog</a></li>
<li>QQ&#xFF1A; &#x4E00;&#x7070;&#x7070;/3302797840</li>
<li>&#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x53F7;&#xFF1A;<strong>&#x4E00;&#x7070;&#x7070;blog</strong></li>
</ul>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/f2b786e3bfd2c2b1ffc3e1c29b361092.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7033035747485712398.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7033035747485712398.html" itemprop="url">Java 多线程及并发知识大集合 并发</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-11-21T22:52:17+08:00">
                2021-11-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x300C;&#x8FD9;&#x662F;&#x6211;&#x53C2;&#x4E0E;11&#x6708;&#x66F4;&#x6587;&#x6311;&#x6218;&#x7684;&#x7B2C;2&#x5929;&#xFF0C;&#x6D3B;&#x52A8;&#x8BE6;&#x60C5;&#x67E5;&#x770B;&#xFF1A;<a href="https://dev.newban.cn/7023643374569816095">2021&#x6700;&#x540E;&#x4E00;&#x6B21;&#x66F4;&#x6587;&#x6311;&#x6218;</a>&#x300D;</p>
<h1 id="&#x5E76;&#x53D1;"><a href="#&#x5E76;&#x53D1;" class="headerlink" title="&#x5E76;&#x53D1;"></a>&#x5E76;&#x53D1;</h1><h2 id="&#x591A;&#x7EBF;&#x7A0B;"><a href="#&#x591A;&#x7EBF;&#x7A0B;" class="headerlink" title="&#x591A;&#x7EBF;&#x7A0B;"></a>&#x591A;&#x7EBF;&#x7A0B;</h2><p>&#x5B9E;&#x73B0;&#x591A;&#x7EBF;&#x7A0B;&#x7684;&#x4E09;&#x79CD;&#x65B9;&#x5F0F;</p>
<h3 id="Runnable"><a href="#Runnable" class="headerlink" title="Runnable"></a>Runnable</h3><ol>
<li><code>class CountDown implements Runnable</code><br>&#x542F;&#x52A8;&#x65B9;&#x5F0F;&#xFF1A;<code>new Thread(new CountDown(),&quot;Runnable&quot;).start();//new Thread(&#xFF09;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#x662F;&#x7EBF;&#x7A0B;&#x540D;&#x5B57;</code><br>&#x65B9;&#x6CD5;&#x5B9A;&#x4E49;&#xFF1A;</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">csharp&#x590D;&#x5236;&#x4EE3;&#x7801;public void run() {</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="Callable"><a href="#Callable" class="headerlink" title="Callable"></a>Callable</h3><ol start="2">
<li><code>class ThreadCall implements Callable&lt;String&gt;</code><strong>String&#x662F;&#x53EF;&#x4EE5;&#x66FF;&#x6362;&#x7684;&#xFF0C;&#x662F;&#x56DE;&#x8C03;&#x7684;&#x503C;</strong><br>&#x542F;&#x52A8;&#x65B9;&#x5F0F;&#xFF1A;<br>&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x63A5;&#x53E3;&#x8981;&#x4F7F;&#x7528;FutrueTask&#x7C7B;&#x4F5C;&#x4E3A;&#x7B80;&#x5355;&#x7684;&#x9002;&#x914D;&#x7C7B;</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arduino&#x590D;&#x5236;&#x4EE3;&#x7801;FutureTask&lt;String&gt; ft = new FutureTask&lt;&gt;(new ThreadCall());</span><br><span class="line">new Thread(ft,&quot;Callable&quot;).start()</span><br></pre></td></tr></table></figure>

<p>&#x65B9;&#x6CD5;&#x5B9A;&#x4E49;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;@Override</span><br><span class="line">public String call() throws Exception {</span><br><span class="line">    return &quot;&quot;;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><strong>&#x7279;&#x522B;&#x6CE8;&#x610F;</strong><br>&#xFF08;1&#xFF09;Callable&#x89C4;&#x5B9A;&#x7684;&#x65B9;&#x6CD5;&#x662F;call()&#xFF0C;&#x800C;Runnable&#x89C4;&#x5B9A;&#x7684;&#x65B9;&#x6CD5;&#x662F;run().<br>&#xFF08;2&#xFF09;Callable&#x7684;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x540E;&#x53EF;&#x8FD4;&#x56DE;&#x503C;&#xFF0C;&#x800C;Runnable&#x7684;&#x4EFB;&#x52A1;&#x662F;&#x4E0D;&#x80FD;&#x8FD4;&#x56DE;&#x503C;&#x7684;&#xFF0C;&#x4E3A;&#x4E86;&#x652F;&#x6301;&#x6B64;&#x529F;&#x80FD;&#xFF0C;Java&#x4E2D;&#x63D0;&#x4F9B;&#x4E86;Callable&#x63A5;&#x53E3;&#x3002;  </p>
<p>&#xFF08;3&#xFF09;call()&#x65B9;&#x6CD5;&#x53EF;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#xFF0C;&#x800C;run()&#x65B9;&#x6CD5;&#x662F;&#x4E0D;&#x80FD;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#x7684;&#x3002;<br>&#xFF08;4&#xFF09;&#x8FD0;&#x884C;Callable&#x4EFB;&#x52A1;&#x53EF;&#x62FF;&#x5230;&#x4E00;&#x4E2A;Future&#x5BF9;&#x8C61;&#xFF0C; Future&#x8868;&#x793A;&#x5F02;&#x6B65;&#x8BA1;&#x7B97;&#x7684;&#x7ED3;&#x679C;&#x3002;<br>&#xFF08;5&#xFF09;FutureTask &#x7684;get()&#x65B9;&#x6CD5;&#x7528;&#x6765;&#x83B7;&#x53D6;&#x6267;&#x884C;&#x7ED3;&#x679C;&#xFF0C;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4F1A;&#x4EA7;&#x751F;&#x963B;&#x585E;&#xFF0C;&#x4F1A;&#x4E00;&#x76F4;&#x7B49;&#x5230;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#x624D;&#x8FD4;&#x56DE;&#xFF1B;</p>
<h3 id="Thread"><a href="#Thread" class="headerlink" title="Thread"></a>Thread</h3><ol start="3">
<li><code>class MyThread extends Thread</code><br>&#x542F;&#x52A8;&#x65B9;&#x5F0F;&#xFF1A;</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scss&#x590D;&#x5236;&#x4EE3;&#x7801;new MyThread().start();</span><br></pre></td></tr></table></figure>

<p>&#x65B9;&#x6CD5;&#x5B9A;&#x4E49;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">csharp&#x590D;&#x5236;&#x4EE3;&#x7801;public void run() {</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;import java.util.concurrent.Callable;</span><br><span class="line">import java.util.concurrent.ExecutionException;</span><br><span class="line">import java.util.concurrent.FutureTask;</span><br><span class="line"></span><br><span class="line">class SynTest {</span><br><span class="line">    public static void main(String[] args) throws ExecutionException, InterruptedException {</span><br><span class="line">        new Thread(new CountDown(),&quot;Runnable&quot;).start();</span><br><span class="line">        new MyThread().start();</span><br><span class="line">        int time = 5;</span><br><span class="line">        FutureTask&lt;String&gt; ft = new FutureTask&lt;&gt;(new ThreadCall());</span><br><span class="line">        new Thread(ft,&quot;Callable&quot;).start();</span><br><span class="line">        String output=ft.get();</span><br><span class="line">        System.out.println(&quot;Callable output is:&quot;+output);</span><br><span class="line">        System.out.println(&quot;&#x4EE5;&#x4E0B;&#x662F;&#x88AB;&#x5835;&#x585E;&#x7684;&#x7EBF;&#x7A0B;&quot;);</span><br><span class="line">        while(time&gt;=0){</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + &quot;:&quot; +time );</span><br><span class="line">            time--;</span><br><span class="line">            try {</span><br><span class="line">                Thread.sleep(1000);                                                    //&#x7761;&#x7720;&#x65F6;&#x95F4;&#x4E3A;1&#x79D2;</span><br><span class="line">            } catch (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line">class ThreadCall implements Callable&lt;String&gt; {</span><br><span class="line">    @Override</span><br><span class="line">    public String call() throws Exception {</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        int time=5;</span><br><span class="line">        while (time&gt;0) {</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + &quot;:&quot; + time--);</span><br><span class="line">            try {</span><br><span class="line">                Thread.sleep(1000);                                                    //&#x7761;&#x7720;&#x65F6;&#x95F4;&#x4E3A;1&#x79D2;</span><br><span class="line">            } catch (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        return time+&quot;&quot;;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class MyThread extends Thread{</span><br><span class="line">    int time=5;</span><br><span class="line">    public void run() {</span><br><span class="line">        Thread.currentThread().setName(&quot;Thread&quot;);</span><br><span class="line">        while (time&gt;=0){</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + &quot;:&quot; + time--);</span><br><span class="line">            try {</span><br><span class="line">                Thread.sleep(1000);                                                    //&#x7761;&#x7720;&#x65F6;&#x95F4;&#x4E3A;1&#x79D2;</span><br><span class="line">            } catch (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">class CountDown implements Runnable{</span><br><span class="line">    int time = 5;</span><br><span class="line">    public void run() {</span><br><span class="line">        while(time&gt;=0){</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + &quot;:&quot; + time--);</span><br><span class="line">            try {</span><br><span class="line">                Thread.sleep(1000);                                                    //&#x7761;&#x7720;&#x65F6;&#x95F4;&#x4E3A;1&#x79D2;</span><br><span class="line">            } catch (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h2 id="&#x7EBF;&#x7A0B;&#x540C;&#x6B65;"><a href="#&#x7EBF;&#x7A0B;&#x540C;&#x6B65;" class="headerlink" title="&#x7EBF;&#x7A0B;&#x540C;&#x6B65;"></a>&#x7EBF;&#x7A0B;&#x540C;&#x6B65;</h2><h3 id="&#x7ADE;&#x4E89;&#x72B6;&#x6001;"><a href="#&#x7ADE;&#x4E89;&#x72B6;&#x6001;" class="headerlink" title="&#x7ADE;&#x4E89;&#x72B6;&#x6001;"></a>&#x7ADE;&#x4E89;&#x72B6;&#x6001;</h3><p>&#x5F53;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x8BBF;&#x95EE;&#x540C;&#x4E00;&#x516C;&#x5171;&#x8D44;&#x6E90;&#x5E76;&#x5F15;&#x53D1;&#x51B2;&#x7A81;&#x9020;&#x6210;&#x7EBF;&#x7A0B;&#x4E0D;&#x540C;&#x6B65;&#xFF0C;&#x6211;&#x4EEC;&#x79F0;&#x8FD9;&#x79CD;&#x72B6;&#x6001;&#x4E3A;&#x7ADE;&#x4E89;&#x72B6;&#x6001;&#x3002;</p>
<h3 id="&#x7EBF;&#x7A0B;&#x5B89;&#x5168;"><a href="#&#x7EBF;&#x7A0B;&#x5B89;&#x5168;" class="headerlink" title="&#x7EBF;&#x7A0B;&#x5B89;&#x5168;"></a>&#x7EBF;&#x7A0B;&#x5B89;&#x5168;</h3><p>&#x662F;&#x9488;&#x5BF9;&#x7C7B;&#x6765;&#x8BF4;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x7C7B;&#x7684;&#x5BF9;&#x8C61;&#x5728;&#x591A;&#x7EBF;&#x7A0B;&#x7A0B;&#x5E8F;&#x4E2D;&#x4E0D;&#x4F1A;&#x5BFC;&#x81F4;&#x7ADE;&#x4E89;&#x72B6;&#x6001;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x79F0;&#x8FD9;&#x7C7B;&#x4E3A;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x7684;&#xFF0C;&#x5982;StringBuffer&#x662F;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x7684;&#xFF0C;&#x800C;StringBuilder&#x5219;&#x662F;&#x7EBF;&#x7A0B;&#x4E0D;&#x5B89;&#x5168;&#x7684;&#x3002;</p>
<h3 id="&#x4E34;&#x754C;&#x533A;"><a href="#&#x4E34;&#x754C;&#x533A;" class="headerlink" title="&#x4E34;&#x754C;&#x533A;"></a>&#x4E34;&#x754C;&#x533A;</h3><p>&#x9020;&#x6210;&#x7ADE;&#x4E89;&#x72B6;&#x6001;&#x7684;&#x539F;&#x56E0;&#x662F;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x540C;&#x65F6;&#x8FDB;&#x5165;&#x4E86;&#x7A0B;&#x5E8F;&#x4E2D;&#x67D0;&#x4E00;&#x7279;&#x5B9A;&#x90E8;&#x5206;&#xFF0C;&#x6211;&#x4EEC;&#x79F0;&#x8FD9;&#x90E8;&#x5206;&#x4E3A;&#x7A0B;&#x5E8F;&#x4E2D;&#x7684;&#x4E34;&#x754C;&#x533A;&#xFF0C;&#x6211;&#x4EEC;&#x8981;&#x89E3;&#x51B3;&#x591A;&#x7EBF;&#x7A0B;&#x4E0D;&#x540C;&#x6B65;&#x95EE;&#x9898;&#xFF0C;&#x5C31;&#x662F;&#x8981;&#x89E3;&#x51B3;&#x5982;&#x4F55;&#x8BA9;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x6709;&#x5E8F;&#x7684;&#x8BBF;&#x95EE;&#x4E34;&#x754C;&#x533A;&#x3002;</p>
<h3 id="java&#x5728;&#x5904;&#x7406;&#x7EBF;&#x7A0B;&#x540C;&#x6B65;&#x65F6;&#x5E38;&#x7528;&#x65B9;&#x6CD5;"><a href="#java&#x5728;&#x5904;&#x7406;&#x7EBF;&#x7A0B;&#x540C;&#x6B65;&#x65F6;&#x5E38;&#x7528;&#x65B9;&#x6CD5;" class="headerlink" title="java&#x5728;&#x5904;&#x7406;&#x7EBF;&#x7A0B;&#x540C;&#x6B65;&#x65F6;&#x5E38;&#x7528;&#x65B9;&#x6CD5;"></a>java&#x5728;&#x5904;&#x7406;&#x7EBF;&#x7A0B;&#x540C;&#x6B65;&#x65F6;&#x5E38;&#x7528;&#x65B9;&#x6CD5;</h3><p>1&#x3001;synchronized&#x5173;&#x952E;&#x5B57;&#x3002;</p>
<p>2&#x3001;Lock&#x663E;&#x793A;&#x52A0;&#x9501;&#x3002;</p>
<p>3&#x3001;&#x4FE1;&#x53F7;&#x91CF;Semaphore&#x3002;</p>
<h2 id="volatile&#x5173;&#x952E;&#x5B57;"><a href="#volatile&#x5173;&#x952E;&#x5B57;" class="headerlink" title="volatile&#x5173;&#x952E;&#x5B57;"></a>volatile&#x5173;&#x952E;&#x5B57;</h2><p>volatile&#x5173;&#x952E;&#x5B57;&#x7ECF;&#x5E38;&#x5728;&#x5E76;&#x53D1;&#x7F16;&#x7A0B;&#x4E2D;&#x4F7F;&#x7528;&#xFF0C;&#x5176;&#x7279;&#x6027;&#x662F;&#x4FDD;&#x8BC1;<strong><em>&#x53EF;&#x89C1;&#x6027;</em></strong>&#x4EE5;&#x53CA;<strong><em>&#x6709;&#x5E8F;&#x6027;</em></strong></p>
<h3 id="Java&#x5185;&#x5B58;&#x6A21;&#x578B;"><a href="#Java&#x5185;&#x5B58;&#x6A21;&#x578B;" class="headerlink" title="Java&#x5185;&#x5B58;&#x6A21;&#x578B;"></a>Java&#x5185;&#x5B58;&#x6A21;&#x578B;</h3><p>&#x6240;&#x6709;&#x7684;&#x53D8;&#x91CF;&#x90FD;&#x5B58;&#x50A8;&#x5728;<em>&#x4E3B;&#x5185;&#x5B58;</em>&#x4E2D;&#x3002;&#x6BCF;&#x6761;&#x7EBF;&#x7A0B;&#x4E2D;&#x8FD8;&#x6709;&#x81EA;&#x5DF1;&#x7684;<em>&#x5DE5;&#x4F5C;&#x5185;&#x5B58;</em>&#xFF0C;&#x7EBF;&#x7A0B;&#x7684;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x4E2D;&#x4FDD;&#x5B58;&#x4E86;&#x88AB;&#x8BE5;&#x7EBF;&#x7A0B;&#x6240;&#x4F7F;&#x7528;&#x5230;&#x7684;&#x53D8;&#x91CF;&#xFF08;&#x8FD9;&#x4E9B;&#x53D8;&#x91CF;&#x662F;&#x4ECE;&#x4E3B;&#x5185;&#x5B58;&#x4E2D;&#x62F7;&#x8D1D;&#x800C;&#x6765;&#xFF09;&#x3002;&#x7EBF;&#x7A0B;&#x5BF9;&#x53D8;&#x91CF;&#x7684;&#x6240;&#x6709;&#x64CD;&#x4F5C;&#xFF08;&#x8BFB;&#x53D6;&#xFF0C;&#x8D4B;&#x503C;&#xFF09;&#x90FD;&#x5FC5;&#x987B;&#x5728;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x4E2D;&#x8FDB;&#x884C;&#x3002;&#x4E0D;&#x540C;&#x7EBF;&#x7A0B;&#x4E4B;&#x95F4;&#x4E5F;&#x65E0;&#x6CD5;&#x76F4;&#x63A5;&#x8BBF;&#x95EE;&#x5BF9;&#x65B9;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x53D8;&#x91CF;&#xFF0C;&#x7EBF;&#x7A0B;&#x95F4;&#x53D8;&#x91CF;&#x503C;&#x7684;&#x4F20;&#x9012;&#x5747;&#x9700;&#x8981;&#x901A;&#x8FC7;&#x4E3B;&#x5185;&#x5B58;&#x6765;&#x5B8C;&#x6210;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/fd5977faff8118edbe478d2e46de1cc0df696565ddc6ed49b7fe2961ed513b0e" alt="image.png"><br>&#x57FA;&#x4E8E;&#x6B64;&#x79CD;&#x5185;&#x5B58;&#x6A21;&#x578B;&#xFF0C;&#x4FBF;&#x4EA7;&#x751F;&#x4E86;&#x591A;&#x7EBF;&#x7A0B;&#x7F16;&#x7A0B;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x201C;&#x810F;&#x8BFB;&#x201D;&#x7B49;&#x95EE;&#x9898;&#x3002;<br>&#x4F8B;&#x5982;&#x4E24;&#x4E2A;&#x7EBF;&#x7A0B;&#x5206;&#x522B;&#x8BFB;&#x53D6;10&#x5B58;&#x5165;&#x5404;&#x81EA;&#x6240;&#x5728;&#x7684;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x5F53;&#x4E2D;&#xFF0C;&#x7136;&#x540E;&#x7EBF;&#x7A0B;1&#x8FDB;&#x884C;&#x52A0;100&#x64CD;&#x4F5C;&#xFF0C;&#x7136;&#x540E;&#x628A;i&#x7684;&#x6700;&#x65B0;&#x503C;101&#x5199;&#x5165;&#x5230;&#x5185;&#x5B58;&#x3002;&#x6B64;&#x65F6;&#x7EBF;&#x7A0B;2&#x7684;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x5F53;&#x4E2D;i&#x7684;&#x503C;&#x8FD8;&#x662F;10&#xFF0C;&#x8FDB;&#x884C;&#x52A0;1&#x64CD;&#x4F5C;&#x4E4B;&#x540E;&#xFF0C;i&#x7684;&#x503C;&#x4E3A;11&#xFF0C;&#x7136;&#x540E;&#x7EBF;&#x7A0B;2&#x628A;i&#x7684;&#x503C;&#x5199;&#x5165;&#x5185;&#x5B58;&#xFF0C;&#x4E3A;11&#xFF0C;&#x4F46;&#x662F;&#x60F3;&#x8981;111&#x3002;</p>
<h3 id="&#x5E76;&#x53D1;&#x7F16;&#x7A0B;&#x7684;&#x4E09;&#x5927;&#x6982;&#x5FF5;&#xFF1A;&#x539F;&#x5B50;&#x6027;&#xFF0C;&#x6709;&#x5E8F;&#x6027;&#xFF0C;&#x53EF;&#x89C1;&#x6027;"><a href="#&#x5E76;&#x53D1;&#x7F16;&#x7A0B;&#x7684;&#x4E09;&#x5927;&#x6982;&#x5FF5;&#xFF1A;&#x539F;&#x5B50;&#x6027;&#xFF0C;&#x6709;&#x5E8F;&#x6027;&#xFF0C;&#x53EF;&#x89C1;&#x6027;" class="headerlink" title="&#x5E76;&#x53D1;&#x7F16;&#x7A0B;&#x7684;&#x4E09;&#x5927;&#x6982;&#x5FF5;&#xFF1A;&#x539F;&#x5B50;&#x6027;&#xFF0C;&#x6709;&#x5E8F;&#x6027;&#xFF0C;&#x53EF;&#x89C1;&#x6027;"></a>&#x5E76;&#x53D1;&#x7F16;&#x7A0B;&#x7684;&#x4E09;&#x5927;&#x6982;&#x5FF5;&#xFF1A;&#x539F;&#x5B50;&#x6027;&#xFF0C;&#x6709;&#x5E8F;&#x6027;&#xFF0C;&#x53EF;&#x89C1;&#x6027;</h3><p><em>&#x8981;&#x60F3;&#x5E76;&#x53D1;&#x7A0B;&#x5E8F;&#x6B63;&#x786E;&#x5730;&#x6267;&#x884C;&#xFF0C;&#x5FC5;&#x987B;&#x8981;&#x4FDD;&#x8BC1;&#x539F;&#x5B50;&#x6027;&#x3001;&#x53EF;&#x89C1;&#x6027;&#x4EE5;&#x53CA;&#x6709;&#x5E8F;&#x6027;&#x3002;&#x53EA;&#x8981;&#x6709;&#x4E00;&#x4E2A;&#x6CA1;&#x6709;&#x88AB;&#x4FDD;&#x8BC1;&#xFF0C;&#x5C31;&#x6709;&#x53EF;&#x80FD;&#x4F1A;&#x5BFC;&#x81F4;&#x7A0B;&#x5E8F;&#x8FD0;&#x884C;&#x4E0D;&#x6B63;&#x786E;&#x3002;</em></p>
<h4 id="&#x539F;&#x5B50;&#x6027;"><a href="#&#x539F;&#x5B50;&#x6027;" class="headerlink" title="&#x539F;&#x5B50;&#x6027;"></a>&#x539F;&#x5B50;&#x6027;</h4><p>&#x539F;&#x5B50;&#x6027;&#xFF1A;&#x5373;&#x4E00;&#x4E2A;&#x64CD;&#x4F5C;&#x6216;&#x8005;&#x591A;&#x4E2A;&#x64CD;&#x4F5C; &#x8981;&#x4E48;&#x5168;&#x90E8;&#x6267;&#x884C;&#x5E76;&#x4E14;&#x6267;&#x884C;&#x7684;&#x8FC7;&#x7A0B;&#x4E0D;&#x4F1A;&#x88AB;&#x4EFB;&#x4F55;&#x56E0;&#x7D20;&#x6253;&#x65AD;&#xFF0C;&#x8981;&#x4E48;&#x5C31;&#x90FD;&#x4E0D;&#x6267;&#x884C;&#x3002;<br>Java&#x5185;&#x5B58;&#x6A21;&#x578B;&#x53EA;&#x4FDD;&#x8BC1;&#x4E86;&#x57FA;&#x672C;&#x8BFB;&#x53D6;&#x548C;&#x8D4B;&#x503C;&#x662F;&#x539F;&#x5B50;&#x6027;&#x64CD;&#x4F5C;&#xFF0C;&#x5982;&#x679C;&#x8981;&#x5B9E;&#x73B0;&#x66F4;&#x5927;&#x8303;&#x56F4;&#x64CD;&#x4F5C;&#x7684;&#x539F;&#x5B50;&#x6027;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;synchronized&#x548C;Lock&#x6765;&#x5B9E;&#x73B0;&#x3002;&#x7531;&#x4E8E;synchronized&#x548C;Lock&#x80FD;&#x591F;&#x4FDD;&#x8BC1;&#x4EFB;&#x4E00;&#x65F6;&#x523B;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x8BE5;&#x4EE3;&#x7801;&#x5757;&#xFF0C;&#x90A3;&#x4E48;&#x81EA;&#x7136;&#x5C31;&#x4E0D;&#x5B58;&#x5728;&#x539F;&#x5B50;&#x6027;&#x95EE;&#x9898;&#x4E86;&#xFF0C;&#x4ECE;&#x800C;&#x4FDD;&#x8BC1;&#x4E86;&#x539F;&#x5B50;&#x6027;</p>
<h4 id="&#x53EF;&#x89C1;&#x6027;"><a href="#&#x53EF;&#x89C1;&#x6027;" class="headerlink" title="&#x53EF;&#x89C1;&#x6027;"></a>&#x53EF;&#x89C1;&#x6027;</h4><p>&#x53EF;&#x89C1;&#x6027;&#x662F;&#x6307;&#x5F53;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x8BBF;&#x95EE;&#x540C;&#x4E00;&#x4E2A;&#x53D8;&#x91CF;&#x65F6;&#xFF0C;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x4FEE;&#x6539;&#x4E86;&#x8FD9;&#x4E2A;&#x53D8;&#x91CF;&#x7684;&#x503C;&#xFF0C;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x80FD;&#x591F;&#x7ACB;&#x5373;&#x770B;&#x5F97;&#x5230;&#x4FEE;&#x6539;&#x7684;&#x503C;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;//&#x7EBF;&#x7A0B;1&#x6267;&#x884C;&#x7684;&#x4EE3;&#x7801;</span><br><span class="line">int i = 0;</span><br><span class="line">i = 10;</span><br><span class="line">//&#x7EBF;&#x7A0B;2&#x6267;&#x884C;&#x7684;&#x4EE3;&#x7801;</span><br><span class="line">j = i;</span><br></pre></td></tr></table></figure>

<p>&#x5F53;&#x7EBF;&#x7A0B;1&#x6267;&#x884C; i =10&#x8FD9;&#x53E5;&#x65F6;&#xFF0C;&#x4F1A;&#x5148;&#x628A;i&#x7684;&#x521D;&#x59CB;&#x503C;&#x52A0;&#x8F7D;&#x5230;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x4E2D;&#xFF0C;&#x7136;&#x540E;&#x8D4B;&#x503C;&#x4E3A;10&#xFF0C;&#x90A3;&#x4E48;&#x5728;&#x7EBF;&#x7A0B;1&#x7684;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x5F53;&#x4E2D;i&#x7684;&#x503C;&#x53D8;&#x4E3A;10&#x4E86;&#xFF0C;&#x5374;&#x6CA1;&#x6709;&#x7ACB;&#x5373;&#x5199;&#x5165;&#x5230;&#x4E3B;&#x5B58;&#x5F53;&#x4E2D;&#x3002;<br>&#x6B64;&#x65F6;&#x7EBF;&#x7A0B;2&#x6267;&#x884C; j = i&#xFF0C;&#x5B83;&#x4F1A;&#x5148;&#x53BB;&#x4E3B;&#x5B58;&#x8BFB;&#x53D6;i&#x7684;&#x503C;&#x5E76;&#x52A0;&#x8F7D;&#x5230;&#x7EBF;&#x7A0B;2&#x7684;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x5F53;&#x4E2D;&#xFF0C;&#x6CE8;&#x610F;&#x6B64;&#x65F6;&#x5185;&#x5B58;&#x5F53;&#x4E2D;i&#x7684;&#x503C;&#x8FD8;&#x662F;0&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x4F1A;&#x4F7F;&#x5F97;j&#x7684;&#x503C;&#x4E3A;0&#xFF0C;&#x800C;&#x4E0D;&#x662F;10.<br>&#x8FD9;&#x5C31;&#x662F;&#x53EF;&#x89C1;&#x6027;&#x95EE;&#x9898;&#xFF0C;&#x7EBF;&#x7A0B;1&#x5BF9;&#x53D8;&#x91CF;i&#x4FEE;&#x6539;&#x4E86;&#x4E4B;&#x540E;&#xFF0C;&#x7EBF;&#x7A0B;2&#x6CA1;&#x6709;&#x7ACB;&#x5373;&#x770B;&#x5230;&#x7EBF;&#x7A0B;1&#x4FEE;&#x6539;&#x7684;&#x503C;&#x3002;<br><strong>Java&#x63D0;&#x4F9B;&#x4E86;volatile&#x5173;&#x952E;&#x5B57;&#x6765;&#x4FDD;&#x8BC1;&#x53EF;&#x89C1;&#x6027;</strong><br>&#x5F53;&#x4E00;&#x4E2A;&#x5171;&#x4EAB;&#x53D8;&#x91CF;&#x88AB;volatile&#x4FEE;&#x9970;&#x65F6;&#xFF0C;&#x5B83;&#x4F1A;&#x4FDD;&#x8BC1;&#x4FEE;&#x6539;&#x7684;&#x503C;&#x4F1A;&#x7ACB;&#x5373;&#x88AB;&#x66F4;&#x65B0;&#x5230;&#x4E3B;&#x5B58;&#xFF0C;&#x5F53;&#x6709;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x9700;&#x8981;&#x8BFB;&#x53D6;&#x65F6;&#xFF0C;&#x5B83;&#x4F1A;&#x53BB;&#x5185;&#x5B58;&#x4E2D;&#x8BFB;&#x53D6;&#x65B0;&#x503C;&#x3002;</p>
<p>&#x800C;&#x666E;&#x901A;&#x7684;&#x5171;&#x4EAB;&#x53D8;&#x91CF;&#x4E0D;&#x80FD;&#x4FDD;&#x8BC1;&#x53EF;&#x89C1;&#x6027;&#xFF0C;&#x56E0;&#x4E3A;&#x666E;&#x901A;&#x5171;&#x4EAB;&#x53D8;&#x91CF;&#x88AB;&#x4FEE;&#x6539;&#x4E4B;&#x540E;&#xFF0C;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x88AB;&#x5199;&#x5165;&#x4E3B;&#x5B58;&#x662F;&#x4E0D;&#x786E;&#x5B9A;&#x7684;&#xFF0C;&#x5F53;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x53BB;&#x8BFB;&#x53D6;&#x65F6;&#xFF0C;&#x6B64;&#x65F6;&#x5185;&#x5B58;&#x4E2D;&#x53EF;&#x80FD;&#x8FD8;&#x662F;&#x539F;&#x6765;&#x7684;&#x65E7;&#x503C;&#xFF0C;&#x56E0;&#x6B64;&#x65E0;&#x6CD5;&#x4FDD;&#x8BC1;&#x53EF;&#x89C1;&#x6027;&#x3002;<br>&#x901A;&#x8FC7;synchronized&#x548C;Lock&#x4E5F;&#x80FD;&#x591F;&#x4FDD;&#x8BC1;&#x53EF;&#x89C1;&#x6027;&#xFF0C;synchronized&#x548C;Lock&#x80FD;&#x4FDD;&#x8BC1;&#x540C;&#x4E00;&#x65F6;&#x523B;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x83B7;&#x53D6;&#x9501;&#x7136;&#x540E;&#x6267;&#x884C;&#x540C;&#x6B65;&#x4EE3;&#x7801;&#xFF0C;&#x5E76;&#x4E14;&#x5728;&#x91CA;&#x653E;&#x9501;&#x4E4B;&#x524D;&#x4F1A;&#x5C06;&#x5BF9;&#x53D8;&#x91CF;&#x7684;&#x4FEE;&#x6539;&#x5237;&#x65B0;&#x5230;&#x4E3B;&#x5B58;&#x5F53;&#x4E2D;&#x3002;&#x56E0;&#x6B64;&#x53EF;&#x4EE5;&#x4FDD;&#x8BC1;&#x53EF;&#x89C1;&#x6027;&#x3002;</p>
<p>&#x6709;&#x5E8F;&#x6027;<br>&#x6709;&#x5E8F;&#x6027;&#xFF1A;&#x5373;&#x7A0B;&#x5E8F;&#x6267;&#x884C;&#x7684;&#x987A;&#x5E8F;&#x6309;&#x7167;&#x4EE3;&#x7801;&#x7684;&#x5148;&#x540E;&#x987A;&#x5E8F;&#x6267;&#x884C;<br><strong>&#x6307;&#x4EE4;&#x91CD;&#x6392;&#x5E8F;</strong>&#xFF0C;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;&#x5904;&#x7406;&#x5668;&#x4E3A;&#x4E86;&#x63D0;&#x9AD8;&#x7A0B;&#x5E8F;&#x8FD0;&#x884C;&#x6548;&#x7387;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x5BF9;&#x8F93;&#x5165;&#x4EE3;&#x7801;&#x8FDB;&#x884C;&#x4F18;&#x5316;&#xFF0C;&#x5B83;&#x4E0D;&#x4FDD;&#x8BC1;&#x7A0B;&#x5E8F;&#x4E2D;&#x5404;&#x4E2A;&#x8BED;&#x53E5;&#x7684;&#x6267;&#x884C;&#x5148;&#x540E;&#x987A;&#x5E8F;&#x540C;&#x4EE3;&#x7801;&#x4E2D;&#x7684;&#x987A;&#x5E8F;&#x4E00;&#x81F4;&#xFF0C;&#x4F46;&#x662F;&#x5B83;&#x4F1A;&#x4FDD;&#x8BC1;&#x7A0B;&#x5E8F;&#x6700;&#x7EC8;&#x6267;&#x884C;&#x7ED3;&#x679C;&#x548C;&#x4EE3;&#x7801;&#x987A;&#x5E8F;&#x6267;&#x884C;&#x7684;&#x7ED3;&#x679C;&#x662F;&#x4E00;&#x81F4;&#x7684;<br>&#x56E0;&#x4E3A;&#x5904;&#x7406;&#x5668;&#x5728;&#x8FDB;&#x884C;&#x91CD;&#x6392;&#x5E8F;&#x65F6;&#x662F;&#x4F1A;&#x8003;&#x8651;&#x6307;&#x4EE4;&#x4E4B;&#x95F4;&#x7684;&#x6570;&#x636E;&#x4F9D;&#x8D56;&#x6027;&#xFF0C;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x6307;&#x4EE4;Instruction 2&#x5FC5;&#x987B;&#x7528;&#x5230;Instruction 1&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x90A3;&#x4E48;&#x5904;&#x7406;&#x5668;&#x4F1A;&#x4FDD;&#x8BC1;Instruction 1&#x4F1A;&#x5728;Instruction 2&#x4E4B;&#x524D;&#x6267;&#x884C;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">scss&#x590D;&#x5236;&#x4EE3;&#x7801;//&#x7EBF;&#x7A0B;1:</span><br><span class="line">context = loadContext();   //&#x8BED;&#x53E5;1&#xFF0C;&#x52A0;&#x8F7D;&#x914D;&#x7F6E;&#x73AF;&#x5883;</span><br><span class="line">inited = true;             //&#x8BED;&#x53E5;2,&#x52A0;&#x8F7D;&#x914D;&#x7F6E;&#x73AF;&#x5883;&#x6210;&#x529F;</span><br><span class="line"></span><br><span class="line"> //&#x7EBF;&#x7A0B;2:</span><br><span class="line">while(!inited ){    //&#x7B49;&#x5F85;&#x52A0;&#x8F7D;&#x914D;&#x7F6E;&#x73AF;&#x5883;</span><br><span class="line">   sleep()</span><br><span class="line">}</span><br><span class="line">doSomethingwithconfig(context); //&#x7528;&#x914D;&#x7F6E;&#x73AF;&#x5883;&#x5DE5;&#x4F5C;</span><br></pre></td></tr></table></figure>

<p>&#x4E8E;&#x8BED;&#x53E5;1&#x548C;&#x8BED;&#x53E5;2&#x6CA1;&#x6709;&#x6570;&#x636E;&#x4F9D;&#x8D56;&#x6027;&#xFF0C;&#x56E0;&#x6B64;&#x53EF;&#x80FD;&#x4F1A;&#x88AB;&#x91CD;&#x6392;&#x5E8F;&#x3002;&#x5047;&#x5982;&#x53D1;&#x751F;&#x4E86;&#x91CD;&#x6392;&#x5E8F;&#xFF0C;&#x5728;&#x7EBF;&#x7A0B;1&#x6267;&#x884C;&#x8FC7;&#x7A0B;&#x4E2D;&#x5148;&#x6267;&#x884C;&#x8BED;&#x53E5;2&#xFF0C;&#x800C;&#x6B64;&#x662F;&#x7EBF;&#x7A0B;2&#x4F1A;&#x4EE5;&#x4E3A;&#x521D;&#x59CB;&#x5316;&#x5DE5;&#x4F5C;&#x5DF2;&#x7ECF;&#x5B8C;&#x6210;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x4F1A;&#x8DF3;&#x51FA;while&#x5FAA;&#x73AF;&#xFF0C;&#x53BB;&#x6267;&#x884C;doSomethingwithconfig(context)&#x65B9;&#x6CD5;&#xFF0C;&#x800C;&#x6B64;&#x65F6;context&#x5E76;&#x6CA1;&#x6709;&#x88AB;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x5C31;&#x4F1A;&#x5BFC;&#x81F4;&#x7A0B;&#x5E8F;&#x51FA;&#x9519;&#x3002;</p>
<p>&#x6307;&#x4EE4;&#x91CD;&#x6392;&#x5E8F;&#x4E0D;&#x4F1A;&#x5F71;&#x54CD;&#x5355;&#x4E2A;&#x7EBF;&#x7A0B;&#x7684;&#x6267;&#x884C;&#xFF0C;&#x4F46;&#x662F;&#x4F1A;&#x5F71;&#x54CD;&#x5230;&#x7EBF;&#x7A0B;&#x5E76;&#x53D1;&#x6267;&#x884C;&#x7684;&#x6B63;&#x786E;&#x6027;&#x3002;</p>
<h3 id="volatile&#x4FDD;&#x8BC1;&#x53EF;&#x89C1;&#x6027;"><a href="#volatile&#x4FDD;&#x8BC1;&#x53EF;&#x89C1;&#x6027;" class="headerlink" title="volatile&#x4FDD;&#x8BC1;&#x53EF;&#x89C1;&#x6027;"></a>volatile&#x4FDD;&#x8BC1;&#x53EF;&#x89C1;&#x6027;</h3><p>&#x4E00;&#x65E6;&#x4E00;&#x4E2A;&#x5171;&#x4EAB;&#x53D8;&#x91CF;&#xFF08;&#x7C7B;&#x7684;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x3001;&#x7C7B;&#x7684;&#x9759;&#x6001;&#x6210;&#x5458;&#x53D8;&#x91CF;&#xFF09;&#x88AB;volatile&#x4FEE;&#x9970;&#x4E4B;&#x540E;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x5177;&#x5907;&#x4E86;&#x4E24;&#x5C42;&#x8BED;&#x4E49;&#xFF1A;<br>1&#xFF09;&#x4FDD;&#x8BC1;&#x4E86;&#x4E0D;&#x540C;&#x7EBF;&#x7A0B;&#x5BF9;&#x8FD9;&#x4E2A;&#x53D8;&#x91CF;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#x65F6;&#x7684;&#x53EF;&#x89C1;&#x6027;&#xFF0C;&#x5373;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x4FEE;&#x6539;&#x4E86;&#x67D0;&#x4E2A;&#x53D8;&#x91CF;&#x7684;&#x503C;&#xFF0C;&#x8FD9;&#x65B0;&#x503C;&#x5BF9;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x6765;&#x8BF4;&#x662F;&#x7ACB;&#x5373;&#x53EF;&#x89C1;&#x7684;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">arduino&#x590D;&#x5236;&#x4EE3;&#x7801;//&#x5982;&#x679C;stop&#x4E0D;&#x7528;volatile&#x4FEE;&#x9970;&#xFF0C;&#x90A3;&#x4E48;&#x53EF;&#x80FD;&#x6027;&#x5F88;&#x5C0F;&#x5F53;&#x7EBF;&#x7A0B;2&#x66F4;&#x6539;&#x4E86;stop&#x53D8;&#x91CF;&#x7684;&#x503C;&#x4E4B;&#x540E;&#xFF0C;&#x4F46;&#x662F;&#x8FD8;&#x6CA1;&#x6765;&#x5F97;&#x53CA;&#x5199;&#x5165;&#x4E3B;&#x5B58;&#x5F53;&#x4E2D;&#xFF0C;&#x7EBF;&#x7A0B;2&#x8F6C;&#x53BB;&#x505A;&#x5176;&#x4ED6;&#x4E8B;&#x60C5;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x7EBF;&#x7A0B;1&#x7531;&#x4E8E;&#x4E0D;&#x77E5;&#x9053;&#x7EBF;&#x7A0B;2&#x5BF9;stop&#x53D8;&#x91CF;&#x7684;&#x66F4;&#x6539;&#xFF0C;&#x56E0;&#x6B64;&#x8FD8;&#x4F1A;&#x4E00;&#x76F4;&#x5FAA;&#x73AF;&#x4E0B;&#x53BB;&#x3002;</span><br><span class="line">//&#x7EBF;&#x7A0B;1</span><br><span class="line">boolean stop = false;</span><br><span class="line">while(!stop){</span><br><span class="line">    doSomething();</span><br><span class="line">}</span><br><span class="line">//&#x7EBF;&#x7A0B;2</span><br><span class="line">stop = true;</span><br></pre></td></tr></table></figure>

<p>&#x7B2C;&#x4E00;&#xFF1A;&#x4F7F;&#x7528;volatile&#x5173;&#x952E;&#x5B57;&#x4F1A;&#x5F3A;&#x5236;&#x5C06;&#x4FEE;&#x6539;&#x7684;&#x503C;&#x7ACB;&#x5373;&#x5199;&#x5165;&#x4E3B;&#x5B58;&#xFF1B;</p>
<p>&#x7B2C;&#x4E8C;&#xFF1A;&#x4F7F;&#x7528;volatile&#x5173;&#x952E;&#x5B57;&#x7684;&#x8BDD;&#xFF0C;&#x5F53;&#x7EBF;&#x7A0B;2&#x8FDB;&#x884C;&#x4FEE;&#x6539;&#x65F6;&#xFF0C;&#x4F1A;&#x5BFC;&#x81F4;&#x7EBF;&#x7A0B;1&#x7684;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x4E2D;&#x7F13;&#x5B58;&#x53D8;&#x91CF;stop&#x7684;&#x7F13;&#x5B58;&#x884C;&#x65E0;&#x6548;&#xFF08;&#x53CD;&#x6620;&#x5230;&#x786C;&#x4EF6;&#x5C42;&#x7684;&#x8BDD;&#xFF0C;&#x5C31;&#x662F;CPU&#x7684;L1&#x6216;&#x8005;L2&#x7F13;&#x5B58;&#x4E2D;&#x5BF9;&#x5E94;&#x7684;&#x7F13;&#x5B58;&#x884C;&#x65E0;&#x6548;&#xFF09;&#xFF1B;</p>
<p>&#x7B2C;&#x4E09;&#xFF1A;&#x7531;&#x4E8E;&#x7EBF;&#x7A0B;1&#x7684;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x4E2D;&#x7F13;&#x5B58;&#x53D8;&#x91CF;stop&#x7684;&#x7F13;&#x5B58;&#x884C;&#x65E0;&#x6548;&#xFF0C;&#x6240;&#x4EE5;&#x7EBF;&#x7A0B;1&#x518D;&#x6B21;&#x8BFB;&#x53D6;&#x53D8;&#x91CF;stop&#x7684;&#x503C;&#x65F6;&#x4F1A;&#x53BB;&#x4E3B;&#x5B58;&#x8BFB;&#x53D6;&#x3002;</p>
<h3 id="volatile&#x4E0D;&#x80FD;&#x786E;&#x4FDD;&#x539F;&#x5B50;&#x6027;"><a href="#volatile&#x4E0D;&#x80FD;&#x786E;&#x4FDD;&#x539F;&#x5B50;&#x6027;" class="headerlink" title="volatile&#x4E0D;&#x80FD;&#x786E;&#x4FDD;&#x539F;&#x5B50;&#x6027;"></a>volatile&#x4E0D;&#x80FD;&#x786E;&#x4FDD;&#x539F;&#x5B50;&#x6027;</h3><p>Note&#xFF1A;&#x81EA;&#x589E;&#x64CD;&#x4F5C;&#x662F;&#x4E0D;&#x5177;&#x5907;&#x539F;&#x5B50;&#x6027;&#x7684;&#xFF0C;&#x5B83;&#x5305;&#x62EC;&#x8BFB;&#x53D6;&#x53D8;&#x91CF;&#x7684;&#x539F;&#x59CB;&#x503C;&#x3001;&#x8FDB;&#x884C;&#x52A0;1&#x64CD;&#x4F5C;&#x3001;&#x5199;&#x5165;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x4E09;&#x4E2A;&#x64CD;&#x4F5C;&#x6B65;&#x9AA4;&#x3002;</p>
<p>&#x7EBF;&#x7A0B;1&#x5BF9;&#x53D8;&#x91CF;&#x8FDB;&#x884C;&#x81EA;&#x589E;&#x64CD;&#x4F5C;&#xFF0C;&#x7EBF;&#x7A0B;1&#x5148;&#x8BFB;&#x53D6;&#x4E86;&#x53D8;&#x91CF;inc&#x7684;&#x539F;&#x59CB;&#x503C;&#xFF0C;&#x7136;&#x540E;&#x7EBF;&#x7A0B;1&#x88AB;&#x963B;&#x585E;&#x4E86;</p>
<p>&#x7EBF;&#x7A0B;2&#x5BF9;&#x53D8;&#x91CF;&#x8FDB;&#x884C;&#x81EA;&#x589E;&#x64CD;&#x4F5C;&#xFF0C;&#x7EBF;&#x7A0B;2&#x4E5F;&#x53BB;&#x8BFB;&#x53D6;&#x53D8;&#x91CF;inc&#x7684;&#x539F;&#x59CB;&#x503C;&#xFF0C;&#x7531;&#x4E8E;&#x7EBF;&#x7A0B;1&#x53EA;&#x662F;&#x5BF9;&#x53D8;&#x91CF;inc&#x8FDB;&#x884C;&#x8BFB;&#x53D6;&#x64CD;&#x4F5C;&#xFF0C;&#x800C;&#x6CA1;&#x6709;&#x5BF9;&#x53D8;&#x91CF;&#x8FDB;&#x884C;&#x4FEE;&#x6539;&#x64CD;&#x4F5C;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x4F1A;&#x5BFC;&#x81F4;&#x7EBF;&#x7A0B;2&#x7684;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x4E2D;&#x7F13;&#x5B58;&#x53D8;&#x91CF;inc&#x7684;&#x7F13;&#x5B58;&#x884C;&#x65E0;&#x6548;&#xFF0C;&#x4E5F;&#x4E0D;&#x4F1A;&#x5BFC;&#x81F4;&#x4E3B;&#x5B58;&#x4E2D;&#x7684;&#x503C;&#x5237;&#x65B0;&#xFF0C;&#x6240;&#x4EE5;&#x7EBF;&#x7A0B;2&#x4F1A;&#x76F4;&#x63A5;&#x53BB;&#x4E3B;&#x5B58;&#x8BFB;&#x53D6;inc&#x7684;&#x503C;&#xFF0C;&#x53D1;&#x73B0;inc&#x7684;&#x503C;&#x65F6;10&#xFF0C;&#x7136;&#x540E;&#x8FDB;&#x884C;&#x52A0;1&#x64CD;&#x4F5C;&#xFF0C;&#x5E76;&#x628A;11&#x5199;&#x5165;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#xFF0C;&#x6700;&#x540E;&#x5199;&#x5165;&#x4E3B;&#x5B58;</p>
<p>&#x7136;&#x540E;&#x7EBF;&#x7A0B;1&#x63A5;&#x7740;&#x8FDB;&#x884C;&#x52A0;1&#x64CD;&#x4F5C;&#xFF0C;&#x7531;&#x4E8E;&#x5DF2;&#x7ECF;&#x8BFB;&#x53D6;&#x4E86;inc&#x7684;&#x503C;&#xFF0C;&#x6CE8;&#x610F;&#x6B64;&#x65F6;&#x5728;&#x7EBF;&#x7A0B;1&#x7684;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x4E2D;inc&#x7684;&#x503C;&#x4ECD;&#x7136;&#x4E3A;10&#xFF08;<strong>&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x8BA4;&#x4E3A;&#xFF0C;&#x628A;inc&#x8D4B;&#x503C;&#x7ED9;&#x53D8;&#x91CF;a&#xFF0C;&#x53D8;&#x91CF;a&#x53C8;&#x8D4B;&#x503C;&#x7ED9;&#x53D8;&#x91CF;b&#xFF0C;&#x90A3;&#x4E48;inc&#x7684;&#x503C;&#x4F1A;&#x91CD;&#x65B0;&#x5237;&#x65B0;&#xFF08;inc==10&#x4E3A;false&#xFF01;&#xFF01;&#xFF01;&#xFF09;&#xFF0C;&#x4F46;&#x662F;b&#x7684;&#x503C;&#x4E0D;&#x4F1A;&#x5237;&#x65B0;&#x4E86;</strong>&#xFF09;&#xFF0C;&#x6240;&#x4EE5;&#x7EBF;&#x7A0B;1&#x5BF9;inc&#x8FDB;&#x884C;&#x52A0;1&#x64CD;&#x4F5C;&#x540E;inc&#x7684;&#x503C;&#x4E3A;11&#xFF0C;&#x7136;&#x540E;&#x5C06;11&#x5199;&#x5165;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#xFF0C;&#x6700;&#x540E;&#x5199;&#x5165;&#x4E3B;&#x5B58;</p>
<p>&#x90A3;&#x4E48;&#x4E24;&#x4E2A;&#x7EBF;&#x7A0B;&#x5206;&#x522B;&#x8FDB;&#x884C;&#x4E86;&#x4E00;&#x6B21;&#x81EA;&#x589E;&#x64CD;&#x4F5C;&#x540E;&#xFF0C;inc&#x53EA;&#x589E;&#x52A0;&#x4E86;1</p>
<h3 id="volatile&#x4FDD;&#x8BC1;&#x6709;&#x5E8F;&#x6027;"><a href="#volatile&#x4FDD;&#x8BC1;&#x6709;&#x5E8F;&#x6027;" class="headerlink" title="volatile&#x4FDD;&#x8BC1;&#x6709;&#x5E8F;&#x6027;"></a>volatile&#x4FDD;&#x8BC1;&#x6709;&#x5E8F;&#x6027;</h3><p>volatile&#x5173;&#x952E;&#x5B57;&#x7981;&#x6B62;&#x6307;&#x4EE4;&#x91CD;&#x6392;&#x5E8F;&#x6709;&#x4E24;&#x5C42;&#x610F;&#x601D;&#xFF1A;<br>volatile&#x5173;&#x952E;&#x5B57;&#x80FD;&#x7981;&#x6B62;&#x6307;&#x4EE4;&#x91CD;&#x6392;&#x5E8F;&#xFF0C;&#x6240;&#x4EE5;volatile&#x80FD;&#x5728;&#x4E00;&#x5B9A;&#x7A0B;&#x5EA6;&#x4E0A;&#x4FDD;&#x8BC1;&#x6709;&#x5E8F;&#x6027;&#x3002;</p>
<p>1&#xFF09;&#x5F53;&#x7A0B;&#x5E8F;&#x6267;&#x884C;&#x5230;volatile&#x53D8;&#x91CF;&#x7684;&#x8BFB;&#x64CD;&#x4F5C;&#x6216;&#x8005;&#x5199;&#x64CD;&#x4F5C;&#x65F6;&#xFF0C;&#x5728;&#x5176;&#x524D;&#x9762;&#x7684;&#x64CD;&#x4F5C;&#x7684;&#x66F4;&#x6539;&#x80AF;&#x5B9A;&#x5168;&#x90E8;&#x5DF2;&#x7ECF;&#x8FDB;&#x884C;&#xFF0C;&#x4E14;&#x7ED3;&#x679C;&#x5DF2;&#x7ECF;&#x5BF9;&#x540E;&#x9762;&#x7684;&#x64CD;&#x4F5C;&#x53EF;&#x89C1;&#xFF1B;&#x5728;&#x5176;&#x540E;&#x9762;&#x7684;&#x64CD;&#x4F5C;&#x80AF;&#x5B9A;&#x8FD8;&#x6CA1;&#x6709;&#x8FDB;&#x884C;&#xFF1B;</p>
<p>2&#xFF09;&#x5728;&#x8FDB;&#x884C;&#x6307;&#x4EE4;&#x4F18;&#x5316;&#x65F6;&#xFF0C;&#x4E0D;&#x80FD;&#x5C06;&#x5728;&#x5BF9;volatile&#x53D8;&#x91CF;&#x7684;&#x8BFB;&#x64CD;&#x4F5C;&#x6216;&#x8005;&#x5199;&#x64CD;&#x4F5C;&#x7684;&#x8BED;&#x53E5;&#x653E;&#x5728;&#x5176;&#x540E;&#x9762;&#x6267;&#x884C;&#xFF0C;&#x4E5F;&#x4E0D;&#x80FD;&#x628A;volatile&#x53D8;&#x91CF;&#x540E;&#x9762;&#x7684;&#x8BED;&#x53E5;&#x653E;&#x5230;&#x5176;&#x524D;&#x9762;&#x6267;&#x884C;&#x3002;</p>
<h2 id="synchronized&#x5173;&#x952E;&#x5B57;"><a href="#synchronized&#x5173;&#x952E;&#x5B57;" class="headerlink" title="synchronized&#x5173;&#x952E;&#x5B57;"></a>synchronized&#x5173;&#x952E;&#x5B57;</h2><p>&#x4E0D;&#x592A;&#x6E05;&#x695A;synchronized&#x4EE5;&#x53CA;notify&#x7684;&#x7528;&#x6CD5;&#xFF0C;&#x4EE5;&#x53CA;&#x9501;&#x65B9;&#x6CD5;&#xFF0C;&#x9501;&#x7C7B;&#x7684;&#x5B9E;&#x73B0;&#x539F;&#x7406;&#xFF0C;&#x8FD8;&#x6709;&#x4FE1;&#x53F7;&#x91CF;&#xFF0C;&#x611F;&#x89C9;&#x90FD;&#x662F;&#x4E0D;&#x540C;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x4F46;&#x662F;&#x5177;&#x4F53;&#x7684;&#x7528;&#x6CD5;&#x5FD8;&#x8BB0;&#x7684;&#x5DEE;&#x4E0D;&#x591A;&#x4E86;&#x3002;<br><strong>&#x5B98;&#x65B9;&#x89E3;&#x91CA;&#xFF1A;</strong><br>Synchronized&#x540C;&#x6B65;&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x652F;&#x6301;&#x4F7F;&#x7528;&#x4E00;&#x79CD;&#x7B80;&#x5355;&#x7684;&#x7B56;&#x7565;&#x6765;&#x9632;&#x6B62;&#x7EBF;&#x7A0B;&#x5E72;&#x6270;&#x548C;&#x5185;&#x5B58;&#x4E00;&#x81F4;&#x6027;&#x9519;&#x8BEF;&#xFF1A;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x5BF9;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x53EF;&#x89C1;&#xFF0C;&#x5219;&#x5BF9;&#x8BE5;&#x5BF9;&#x8C61;&#x53D8;&#x91CF;&#x7684;&#x6240;&#x6709;&#x8BFB;&#x53D6;&#x6216;&#x5199;&#x5165;&#x90FD;&#x662F;&#x901A;&#x8FC7;&#x540C;&#x6B65;&#x65B9;&#x6CD5;&#x5B8C;&#x6210;&#x7684;&#x3002;</p>
<p>&#x7B80;&#x5355;&#x5C31;&#x662F;&#x8BF4;Synchronized&#x7684;&#x4F5C;&#x7528;&#x5C31;&#x662F;Java&#x4E2D;&#x89E3;&#x51B3;&#x5E76;&#x53D1;&#x95EE;&#x9898;&#x7684;&#x4E00;&#x79CD;&#x6700;&#x5E38;&#x7528;&#x6700;&#x7B80;&#x5355;&#x7684;&#x65B9;&#x6CD5; &#xFF0C;&#x4ED6;&#x53EF;&#x4EE5;&#x786E;&#x4FDD;&#x540C;&#x4E00;&#x4E2A;&#x65F6;&#x523B;&#x6700;&#x591A;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x540C;&#x6B65;&#x4EE3;&#x7801;&#xFF0C;&#x4ECE;&#x800C;&#x4FDD;&#x8BC1;&#x591A;&#x7EBF;&#x7A0B;&#x73AF;&#x5883;&#x4E0B;&#x5E76;&#x53D1;&#x5B89;&#x5168;&#x7684;&#x6548;&#x679C;&#x3002; &#x5982;&#x679C;&#x6709;&#x4E00;&#x6BB5;&#x4EE3;&#x7801;&#x88AB;Synchronized&#x6240;&#x4FEE;&#x9970;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x5C31;&#x4F1A;&#x4EE5;&#x539F;&#x5B50;&#x7684;&#x65B9;&#x5F0F;&#x6267;&#x884C;&#xFF0C;&#x5F53;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x5728;&#x6267;&#x884C;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5B83;&#x4EEC;&#x662F;&#x4E92;&#x65A5;&#x7684;&#xFF0C;&#x4E0D;&#x4F1A;&#x76F8;&#x4E92;&#x5E72;&#x6270;&#xFF0C;&#x4E0D;&#x4F1A;&#x540C;&#x65F6;&#x6267;&#x884C;&#x3002;</p>
<p>Synchronized&#x5DE5;&#x4F5C;&#x673A;&#x5236;&#x662F;&#x5728;&#x591A;&#x7EBF;&#x7A0B;&#x73AF;&#x5883;&#x4E2D;&#x4F7F;&#x7528;&#x4E00;&#x628A;&#x9501;&#xFF0C;&#x5728;&#x7B2C;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x53BB;&#x6267;&#x884C;&#x7684;&#x65F6;&#x5019;&#x53BB;&#x83B7;&#x53D6;&#x8FD9;&#x628A;&#x9501;&#x624D;&#x80FD;&#x6267;&#x884C;&#xFF0C;&#x4E00;&#x65E6;&#x83B7;&#x53D6;&#x5C31;&#x72EC;&#x5360;&#x8FD9;&#x628A;&#x9501;&#x76F4;&#x5230;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#x6216;&#x8005;&#x5728;&#x4E00;&#x5B9A;&#x6761;&#x4EF6;&#x4E0B;&#x624D;&#x4F1A;&#x53BB;&#x91CA;&#x653E;&#x8FD9;&#x628A;&#x9501;&#xFF0C;&#x5728;&#x8FD9;&#x628A;&#x9501;&#x91CA;&#x653E;&#x4E4B;&#x524D;<em>&#x5176;&#x4ED6;&#x7684;&#x7EBF;&#x7A0B;&#x53EA;&#x80FD;&#x963B;&#x585E;&#x7B49;&#x5F85;</em>&#x3002;</p>
<p>synchronized&#x662F;Java&#x4E2D;&#x7684;&#x5173;&#x952E;&#x5B57;&#xFF0C;&#x88AB;Java&#x539F;&#x751F;&#x652F;&#x6301;&#xFF0C;&#x662F;&#x4E00;&#x79CD;&#x6700;&#x57FA;&#x672C;&#x7684;&#x540C;&#x6B65;&#x9501;&#x3002;<br>&#x5B83;&#x4FEE;&#x9970;&#x7684;&#x5BF9;&#x8C61;&#x6709;&#x4EE5;&#x4E0B;&#x51E0;&#x79CD;&#xFF1A;<br>&#x3000;&#x3000;1. &#x4FEE;&#x9970;&#x4E00;&#x4E2A;&#x4EE3;&#x7801;&#x5757;&#xFF0C;&#x88AB;&#x4FEE;&#x9970;&#x7684;&#x4EE3;&#x7801;&#x5757;&#x79F0;&#x4E3A;&#x540C;&#x6B65;&#x8BED;&#x53E5;&#x5757;&#xFF0C;&#x5176;&#x4F5C;&#x7528;&#x7684;&#x8303;&#x56F4;&#x662F;&#x5927;&#x62EC;&#x53F7;{}&#x62EC;&#x8D77;&#x6765;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x4F5C;&#x7528;&#x7684;&#x5BF9;&#x8C61;&#x662F;&#x8C03;&#x7528;&#x8FD9;&#x4E2A;&#x4EE3;&#x7801;&#x5757;&#x7684;&#x5BF9;&#x8C61;&#x3002;<br>&#x3000;&#x3000;2. &#x4FEE;&#x9970;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x88AB;&#x4FEE;&#x9970;&#x7684;&#x65B9;&#x6CD5;&#x79F0;&#x4E3A;&#x540C;&#x6B65;&#x65B9;&#x6CD5;&#xFF0C;&#x5176;&#x4F5C;&#x7528;&#x7684;&#x8303;&#x56F4;&#x662F;&#x6574;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x4F5C;&#x7528;&#x7684;&#x5BF9;&#x8C61;&#x662F;&#x8C03;&#x7528;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x7684;&#x5BF9;&#x8C61;&#x3002;<br>&#x3000;&#x3000;3. &#x4FEE;&#x6539;&#x4E00;&#x4E2A;&#x9759;&#x6001;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5176;&#x4F5C;&#x7528;&#x7684;&#x8303;&#x56F4;&#x662F;&#x6574;&#x4E2A;&#x9759;&#x6001;&#x65B9;&#x6CD5;&#xFF0C;&#x4F5C;&#x7528;&#x7684;&#x5BF9;&#x8C61;&#x662F;&#x8FD9;&#x4E2A;&#x7C7B;&#x7684;&#x6240;&#x6709;&#x5BF9;&#x8C61;&#x3002;<br>&#x3000;&#x3000;4. &#x4FEE;&#x6539;&#x4E00;&#x4E2A;&#x7C7B;&#xFF0C;&#x5176;&#x4F5C;&#x7528;&#x7684;&#x8303;&#x56F4;&#x662F;synchronized&#x540E;&#x9762;&#x62EC;&#x53F7;&#x62EC;&#x8D77;&#x6765;&#x7684;&#x90E8;&#x5206;&#xFF0C;&#x4F5C;&#x7528;&#x4E3B;&#x7684;&#x5BF9;&#x8C61;&#x662F;&#x8FD9;&#x4E2A;&#x7C7B;&#x7684;&#x6240;&#x6709;&#x5BF9;&#x8C61;&#x3002;</p>
<h3 id="&#x7EBF;&#x7A0B;&#x4E0D;&#x5B89;&#x5168;&#x7684;&#x4F8B;&#x5B50;"><a href="#&#x7EBF;&#x7A0B;&#x4E0D;&#x5B89;&#x5168;&#x7684;&#x4F8B;&#x5B50;" class="headerlink" title="&#x7EBF;&#x7A0B;&#x4E0D;&#x5B89;&#x5168;&#x7684;&#x4F8B;&#x5B50;"></a>&#x7EBF;&#x7A0B;&#x4E0D;&#x5B89;&#x5168;&#x7684;&#x4F8B;&#x5B50;</h3><p>&#x552E;&#x7968;&#x5458;&#x95EE;&#x9898;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">typescript&#x590D;&#x5236;&#x4EE3;&#x7801;&#x53EF;&#x80FD;&#x4F1A;&#x5356;&#x540C;&#x4E00;&#x5F20;&#x7968;&#xFF0C;&#x6CA1;&#x6709;&#x7968;&#x4E86;&#x53EF;&#x80FD;&#x4E5F;&#x4F1A;&#x7EE7;&#x7EED;&#x5356;</span><br><span class="line">    public static void main(String[] args) {</span><br><span class="line">	// write your code here</span><br><span class="line">        MyThread1 r1=new MyThread1();</span><br><span class="line">        Thread t1=new Thread(r1,&quot;First_Thread1&quot;);</span><br><span class="line">        Thread t2=new Thread(r1,&quot;Second_Thread2&quot;);</span><br><span class="line">        Thread t3=new Thread(r1,&quot;Third_Thread2&quot;);</span><br><span class="line">        Thread t4=new Thread(r1,&quot;Forth_Thread2&quot;);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t3.start();</span><br><span class="line">        t4.start();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    static  class  MyThread1 implements Runnable{</span><br><span class="line">        public  static  Integer num=10;//&#x901A;&#x8FC7;&#x9759;&#x6001;&#x53D8;&#x91CF;&#xFF0C;&#x8BA9;&#x4ED6;&#x4EEC;&#x5356;&#x7684;&#x662F;&#x540C;&#x4E00;&#x5F20;&#x7968;</span><br><span class="line">        @Override</span><br><span class="line">        public  void run() {</span><br><span class="line">            while (num&gt;0){</span><br><span class="line">                try {</span><br><span class="line">                    Thread.sleep(1000);</span><br><span class="line">                } catch (InterruptedException e) {</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                }</span><br><span class="line">                System.out.println( Thread.currentThread().getName()+ &quot;  &#x6B63;&#x5728;&#x5356; &quot;+num--+&quot; &#x5F20;&#x8F66;&#x7968;&quot;);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Forth_Thread2  &#x6B63;&#x5728;&#x5356; 10 &#x5F20;&#x8F66;&#x7968;</span><br><span class="line">First_Thread1  &#x6B63;&#x5728;&#x5356; 9 &#x5F20;&#x8F66;&#x7968;</span><br><span class="line">Third_Thread2  &#x6B63;&#x5728;&#x5356; 8 &#x5F20;&#x8F66;&#x7968;</span><br><span class="line">Second_Thread2  &#x6B63;&#x5728;&#x5356; 7 &#x5F20;&#x8F66;&#x7968;</span><br><span class="line">First_Thread1  &#x6B63;&#x5728;&#x5356; 6 &#x5F20;&#x8F66;&#x7968;</span><br><span class="line">Forth_Thread2  &#x6B63;&#x5728;&#x5356; 5 &#x5F20;&#x8F66;&#x7968;</span><br><span class="line">Second_Thread2  &#x6B63;&#x5728;&#x5356; 6 &#x5F20;&#x8F66;&#x7968;</span><br><span class="line">Third_Thread2  &#x6B63;&#x5728;&#x5356; 4 &#x5F20;&#x8F66;&#x7968;</span><br><span class="line">Second_Thread2  &#x6B63;&#x5728;&#x5356; 3 &#x5F20;&#x8F66;&#x7968;</span><br><span class="line">Forth_Thread2  &#x6B63;&#x5728;&#x5356; 1 &#x5F20;&#x8F66;&#x7968;</span><br><span class="line">First_Thread1  &#x6B63;&#x5728;&#x5356; 2 &#x5F20;&#x8F66;&#x7968;</span><br><span class="line">Third_Thread2  &#x6B63;&#x5728;&#x5356; 0 &#x5F20;&#x8F66;&#x7968;</span><br><span class="line">Second_Thread2  &#x6B63;&#x5728;&#x5356; -1 &#x5F20;&#x8F66;&#x7968;</span><br></pre></td></tr></table></figure>

<h3 id="synchronized-&#x4FEE;&#x9970;&#x65B9;&#x6CD5;"><a href="#synchronized-&#x4FEE;&#x9970;&#x65B9;&#x6CD5;" class="headerlink" title="synchronized &#x4FEE;&#x9970;&#x65B9;&#x6CD5;"></a>synchronized &#x4FEE;&#x9970;&#x65B9;&#x6CD5;</h3><p>//&#x5982;&#x679C;synchronized&#x662F;&#x9501;&#x8D77;&#x6765;&#x6574;&#x4E2A;&#x65B9;&#x6CD5;&#x7684;&#xFF0C;synchronized&#x4FEE;&#x9970;&#x51FD;&#x6570;&#x4E0D;&#x9700;&#x8981;&#x4F20;&#x5165;&#x5B57;&#x7B26;&#x4E32;&#x53C2;&#x6570;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x9ED8;&#x8BA4;&#x662F;this</p>
<p>&#x5BF9;&#x4E8E;&#x6B64;&#x6848;&#x4F8B;&#xFF0C;&#x662F;&#x4E24;&#x4E2A;&#x7EBF;&#x7A0B;&#x4E4B;&#x95F4;&#x7ADE;&#x4E89;&#x552E;&#x7968;&#xFF0C;&#x56E0;&#x6B64;&#x4E0D;&#x9002;&#x5B9C;&#x9501;&#x8D77;&#x6765;&#x6574;&#x4E2A;&#x65B9;&#x6CD5;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;    static  class  MyThread1 implements Runnable{</span><br><span class="line">        public  static  Integer num=10;</span><br><span class="line">        @Override</span><br><span class="line">        public synchronized  void run() {</span><br><span class="line">            while (num&gt;0){</span><br><span class="line">                try {</span><br><span class="line">                    Thread.sleep(100);</span><br><span class="line">                } catch (InterruptedException e) {</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                }</span><br><span class="line">                System.out.println( Thread.currentThread().getName()+ &quot;  &#x6B63;&#x5728;&#x5356; &quot;+num--+&quot; &#x5F20;&#x8F66;&#x7968;&quot;);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">&#x53EA;&#x6709;First_Thread&#x5728;&#x5356;&#x7968;&#x4E86;</span><br><span class="line">First_Thread1  &#x6B63;&#x5728;&#x5356; 10 &#x5F20;&#x8F66;&#x7968;</span><br><span class="line">First_Thread1  &#x6B63;&#x5728;&#x5356; 9 &#x5F20;&#x8F66;&#x7968;</span><br><span class="line">First_Thread1  &#x6B63;&#x5728;&#x5356; 8 &#x5F20;&#x8F66;&#x7968;</span><br><span class="line">First_Thread1  &#x6B63;&#x5728;&#x5356; 7 &#x5F20;&#x8F66;&#x7968;</span><br><span class="line">First_Thread1  &#x6B63;&#x5728;&#x5356; 6 &#x5F20;&#x8F66;&#x7968;</span><br><span class="line">First_Thread1  &#x6B63;&#x5728;&#x5356; 5 &#x5F20;&#x8F66;&#x7968;</span><br><span class="line">First_Thread1  &#x6B63;&#x5728;&#x5356; 4 &#x5F20;&#x8F66;&#x7968;</span><br><span class="line">First_Thread1  &#x6B63;&#x5728;&#x5356; 3 &#x5F20;&#x8F66;&#x7968;</span><br><span class="line">First_Thread1  &#x6B63;&#x5728;&#x5356; 2 &#x5F20;&#x8F66;&#x7968;</span><br><span class="line">First_Thread1  &#x6B63;&#x5728;&#x5356; 1 &#x5F20;&#x8F66;&#x7968;</span><br></pre></td></tr></table></figure>

<p>synchronized()&#x4E2D;&#x9501;&#x7684;&#x662F;Object&#x5BF9;&#x8C61;</p>
<h3 id="synchronized-&#x4FEE;&#x9970;&#x4EE3;&#x7801;&#x5757;"><a href="#synchronized-&#x4FEE;&#x9970;&#x4EE3;&#x7801;&#x5757;" class="headerlink" title="synchronized &#x4FEE;&#x9970;&#x4EE3;&#x7801;&#x5757;"></a>synchronized &#x4FEE;&#x9970;&#x4EE3;&#x7801;&#x5757;</h3><p>&#x53EF;&#x4EE5;&#x5B9A;&#x4E49;&#x516C;&#x5171;&#x7684;str&#x9759;&#x6001;&#x53D8;&#x91CF;&#xFF0C;&#x82E5;&#x4E0D;&#x5B9A;&#x4E49;&#x4E3A;static&#x9759;&#x6001;&#xFF0C;&#x5219;&#x4E24;&#x4E2A;&#x7EBF;&#x7A0B;&#x7684;str&#x662F;&#x7EBF;&#x7A0B;&#x81EA;&#x5DF1;&#x7684;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x516C;&#x5171;&#x7684;</p>
<p>&#x4E5F;&#x53EF;&#x4EE5;&#x7528;synchronized (&#x201C; &#x201C;) {<br>//&#x5728;&#x9700;&#x8981;&#x52A0;&#x9501;&#x4FDD;&#x8BC1;&#x5B8C;&#x6574;&#x8FD0;&#x884C;&#x7684;&#x4EE3;&#x7801;&#x5757;&#x65C1;&#x8FB9;&#x52A0;&#x4E0A;synchronized (&#x201C; &#x201C;){}&#x5305;&#x88F9;&#x4EE3;&#x7801;&#xFF0C;&#x5373;&#x53EF;&#x9501;&#x8D77;&#x6765;&#x8BE5;&#x90E8;&#x5206;&#x4EE3;&#x7801;&#xFF0C;()&#x5185;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x968F;&#x610F;&#x5B9A;&#x4E49;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">typescript&#x590D;&#x5236;&#x4EE3;&#x7801;    static  class  MyThread1 implements Runnable{</span><br><span class="line">        public  static  Integer num=10;</span><br><span class="line">        public  static String str = new String(&quot;weimeig&quot;);</span><br><span class="line">        @Override</span><br><span class="line">        public void run() {</span><br><span class="line">            while (true){</span><br><span class="line">                synchronized (str){</span><br><span class="line">                    if(num&gt;0){</span><br><span class="line">                        System.out.println( Thread.currentThread().getName()+ &quot;  &#x6B63;&#x5728;&#x5356; &quot;+num--+&quot; &#x5F20;&#x8F66;&#x7968;&quot;);</span><br><span class="line">                    }else {</span><br><span class="line">                        break;</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">                try {</span><br><span class="line">                    Thread.sleep(1000);</span><br><span class="line">                } catch (InterruptedException e) {</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Forth_Thread2  &#x6B63;&#x5728;&#x5356; 10 &#x5F20;&#x8F66;&#x7968;</span><br><span class="line">Second_Thread2  &#x6B63;&#x5728;&#x5356; 9 &#x5F20;&#x8F66;&#x7968;</span><br><span class="line">First_Thread1  &#x6B63;&#x5728;&#x5356; 8 &#x5F20;&#x8F66;&#x7968;</span><br><span class="line">Third_Thread2  &#x6B63;&#x5728;&#x5356; 7 &#x5F20;&#x8F66;&#x7968;</span><br><span class="line">Third_Thread2  &#x6B63;&#x5728;&#x5356; 6 &#x5F20;&#x8F66;&#x7968;</span><br><span class="line">Forth_Thread2  &#x6B63;&#x5728;&#x5356; 5 &#x5F20;&#x8F66;&#x7968;</span><br><span class="line">First_Thread1  &#x6B63;&#x5728;&#x5356; 4 &#x5F20;&#x8F66;&#x7968;</span><br><span class="line">Second_Thread2  &#x6B63;&#x5728;&#x5356; 3 &#x5F20;&#x8F66;&#x7968;</span><br><span class="line">Third_Thread2  &#x6B63;&#x5728;&#x5356; 2 &#x5F20;&#x8F66;&#x7968;</span><br><span class="line">First_Thread1  &#x6B63;&#x5728;&#x5356; 1 &#x5F20;&#x8F66;&#x7968;</span><br></pre></td></tr></table></figure>

<h3 id="wait-notify"><a href="#wait-notify" class="headerlink" title="wait notify"></a>wait notify</h3><ol>
<li>wait()&#x4F7F;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x963B;&#x585E;&#xFF0C;&#x524D;&#x63D0;&#x662F; &#x5FC5;&#x987B;&#x5148;&#x83B7;&#x5F97;&#x9501;&#xFF0C;&#x4E00;&#x822C;&#x914D;&#x5408;synchronized &#x5173;&#x952E;&#x5B57;&#x4F7F;&#x7528;&#xFF0C;&#x5373;&#xFF0C;&#x4E00;&#x822C;&#x5728;synchronized &#x540C;&#x6B65;&#x4EE3;&#x7801;&#x5757;&#x91CC;&#x4F7F;&#x7528; wait()&#x3001;notify/notifyAll() &#x65B9;&#x6CD5;&#x3002;</li>
<li>&#x7531;&#x4E8E; wait()&#x3001;notify/notifyAll() &#x5728;synchronized &#x4EE3;&#x7801;&#x5757;&#x6267;&#x884C;&#xFF0C;&#x8BF4;&#x660E;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x4E00;&#x5B9A;&#x662F;&#x83B7;&#x53D6;&#x4E86;&#x9501;&#x7684;&#x3002;<br>&#x5F53;&#x7EBF;&#x7A0B;&#x6267;&#x884C;wait()&#x65B9;&#x6CD5;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x91CA;&#x653E;&#x5F53;&#x524D;&#x7684;&#x9501;&#xFF0C;&#x7136;&#x540E;&#x8BA9;&#x51FA;CPU&#xFF0C;&#x8FDB;&#x5165;&#x7B49;&#x5F85;&#x72B6;&#x6001;&#x3002;<br>&#x53EA;&#x6709;&#x5F53; notify/notifyAll() &#x88AB;&#x6267;&#x884C;&#x65F6;&#x5019;&#xFF0C;&#x624D;&#x4F1A;&#x5524;&#x9192;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x6B63;&#x5904;&#x4E8E;&#x7B49;&#x5F85;&#x72B6;&#x6001;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x7136;&#x540E;&#x7EE7;&#x7EED;&#x5F80;&#x4E0B;&#x6267;&#x884C;&#xFF0C;&#x76F4;&#x5230;&#x6267;&#x884C;&#x5B8C;synchronized &#x4EE3;&#x7801;&#x5757;&#x7684;&#x4EE3;&#x7801;&#x6216;&#x662F;&#x4E2D;&#x9014;&#x9047;&#x5230;wait() &#xFF0C;&#x518D;&#x6B21;&#x91CA;&#x653E;&#x9501;&#x3002;<br>&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;notify/notifyAll() &#x7684;&#x6267;&#x884C;&#x53EA;&#x662F;&#x5524;&#x9192;&#x6C89;&#x7761;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x800C;&#x4E0D;&#x4F1A;&#x7ACB;&#x5373;&#x91CA;&#x653E;&#x9501;&#xFF0C;&#x9501;&#x7684;&#x91CA;&#x653E;&#x8981;&#x770B;&#x4EE3;&#x7801;&#x5757;&#x7684;&#x5177;&#x4F53;&#x6267;&#x884C;&#x60C5;&#x51B5;&#x3002;&#x6240;&#x4EE5;&#x5728;&#x7F16;&#x7A0B;&#x4E2D;&#xFF0C;&#x5C3D;&#x91CF;&#x5728;&#x4F7F;&#x7528;&#x4E86;notify/notifyAll() &#x540E;&#x7ACB;&#x5373;&#x9000;&#x51FA;&#x4E34;&#x754C;&#x533A;&#xFF0C;&#x4EE5;&#x5524;&#x9192;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x8BA9;&#x5176;&#x83B7;&#x5F97;&#x9501;</li>
<li>wait() &#x9700;&#x8981;&#x88AB;try catch&#x5305;&#x56F4;&#xFF0C;&#x4EE5;&#x4FBF;&#x53D1;&#x751F;&#x5F02;&#x5E38;&#x4E2D;&#x65AD;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;wait&#x7B49;&#x5F85;&#x7684;&#x7EBF;&#x7A0B;&#x5524;&#x9192;&#x3002;</li>
<li>notify &#x548C; notifyAll&#x7684;&#x533A;&#x522B;<br>notify&#x65B9;&#x6CD5;&#x53EA;&#x5524;&#x9192;&#x4E00;&#x4E2A;&#x7B49;&#x5F85;&#xFF08;&#x5BF9;&#x8C61;&#x7684;&#xFF09;&#x7EBF;&#x7A0B;&#x5E76;&#x4F7F;&#x8BE5;&#x7EBF;&#x7A0B;&#x5F00;&#x59CB;&#x6267;&#x884C;&#x3002;&#x6240;&#x4EE5;&#x5982;&#x679C;&#x6709;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x7B49;&#x5F85;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#xFF0C;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x53EA;&#x4F1A;&#x5524;&#x9192;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#xFF0C;&#x9009;&#x62E9;&#x54EA;&#x4E2A;&#x7EBF;&#x7A0B;&#x53D6;&#x51B3;&#x4E8E;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5BF9;&#x591A;&#x7EBF;&#x7A0B;&#x7BA1;&#x7406;&#x7684;&#x5B9E;&#x73B0;&#x3002;notifyAll &#x4F1A;&#x5524;&#x9192;&#x6240;&#x6709;&#x7B49;&#x5F85;(&#x5BF9;&#x8C61;&#x7684;)&#x7EBF;&#x7A0B;&#xFF0C;&#x5C3D;&#x7BA1;&#x54EA;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x5C06;&#x4F1A;&#x7B2C;&#x4E00;&#x4E2A;&#x5904;&#x7406;&#x53D6;&#x51B3;&#x4E8E;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;&#x5B9E;&#x73B0;&#x3002;&#x5982;&#x679C;&#x5F53;&#x524D;&#x60C5;&#x51B5;&#x4E0B;&#x6709;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x9700;&#x8981;&#x88AB;&#x5524;&#x9192;&#xFF0C;&#x63A8;&#x8350;&#x4F7F;&#x7528;notifyAll &#x65B9;&#x6CD5;&#x3002;&#x6BD4;&#x5982;&#x5728;&#x751F;&#x4EA7;&#x8005;-&#x6D88;&#x8D39;&#x8005;&#x91CC;&#x9762;&#x7684;&#x4F7F;&#x7528;&#xFF0C;&#x6BCF;&#x6B21;&#x90FD;&#x9700;&#x8981;&#x5524;&#x9192;&#x6240;&#x6709;&#x7684;&#x6D88;&#x8D39;&#x8005;&#x6216;&#x662F;&#x751F;&#x4EA7;&#x8005;&#xFF0C;&#x4EE5;&#x5224;&#x65AD;&#x7A0B;&#x5E8F;&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x5F80;&#x4E0B;&#x6267;&#x884C;&#x3002;</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;import java.util.LinkedList;</span><br><span class="line">import java.util.Queue;</span><br><span class="line"></span><br><span class="line">public class ProducerAndConsumer {</span><br><span class="line">    private final int MAX_LEN = 10;</span><br><span class="line">    private Queue&lt;Integer&gt; queue = new LinkedList&lt;Integer&gt;();</span><br><span class="line">    class Producer extends Thread {</span><br><span class="line">        @Override</span><br><span class="line">        public void run() {</span><br><span class="line">            producer();</span><br><span class="line">        }</span><br><span class="line">        private void producer() {</span><br><span class="line">            while(true) {</span><br><span class="line">                synchronized (queue) {</span><br><span class="line">                    while (queue.size() == MAX_LEN) {</span><br><span class="line">                        queue.notify();</span><br><span class="line">                        System.out.println(&quot;&#x5F53;&#x524D;&#x961F;&#x5217;&#x6EE1;&quot;);</span><br><span class="line">                        try {</span><br><span class="line">                            queue.wait();</span><br><span class="line">                        } catch (InterruptedException e) {</span><br><span class="line">                            e.printStackTrace();</span><br><span class="line">                        }</span><br><span class="line">                    }</span><br><span class="line">                    queue.add(1);</span><br><span class="line">                    queue.notify();</span><br><span class="line">                    System.out.println(&quot;&#x751F;&#x4EA7;&#x8005;&#x751F;&#x4EA7;&#x4E00;&#x6761;&#x4EFB;&#x52A1;&#xFF0C;&#x5F53;&#x524D;&#x961F;&#x5217;&#x957F;&#x5EA6;&#x4E3A;&quot; + queue.size());</span><br><span class="line">                    try {</span><br><span class="line">                        Thread.sleep(500);</span><br><span class="line">                    } catch (InterruptedException e) {</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    class Consumer extends Thread {</span><br><span class="line">        @Override</span><br><span class="line">        public void run() {</span><br><span class="line">            consumer();</span><br><span class="line">        }</span><br><span class="line">        private void consumer() {</span><br><span class="line">            while (true) {</span><br><span class="line">                synchronized (queue) {</span><br><span class="line">                    while (queue.size() == 0) {</span><br><span class="line">                        queue.notify();</span><br><span class="line">                        System.out.println(&quot;&#x5F53;&#x524D;&#x961F;&#x5217;&#x4E3A;&#x7A7A;&quot;);</span><br><span class="line">                        try {</span><br><span class="line">                            queue.wait();</span><br><span class="line">                        } catch (InterruptedException e) {</span><br><span class="line">                            e.printStackTrace();</span><br><span class="line">                        }</span><br><span class="line">                    }</span><br><span class="line">                    queue.poll();</span><br><span class="line">                    queue.notify();</span><br><span class="line">                    System.out.println(&quot;&#x6D88;&#x8D39;&#x8005;&#x6D88;&#x8D39;&#x4E00;&#x6761;&#x4EFB;&#x52A1;&#xFF0C;&#x5F53;&#x524D;&#x961F;&#x5217;&#x957F;&#x5EA6;&#x4E3A;&quot; + queue.size());</span><br><span class="line">                    try {</span><br><span class="line">                        Thread.sleep(500);</span><br><span class="line">                    } catch (InterruptedException e) {</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    public static void main(String[] args) {</span><br><span class="line">        ProducerAndConsumer pc = new ProducerAndConsumer();</span><br><span class="line">        Producer producer = pc.new Producer();</span><br><span class="line">        Consumer consumer = pc.new Consumer();</span><br><span class="line">        producer.start();</span><br><span class="line">        consumer.start();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="Lock&#x4E0B;&#x7684;-Condition-&#x7684;await&#x548C;signal"><a href="#Lock&#x4E0B;&#x7684;-Condition-&#x7684;await&#x548C;signal" class="headerlink" title="Lock&#x4E0B;&#x7684; Condition &#x7684;await&#x548C;signal()"></a>Lock&#x4E0B;&#x7684; Condition &#x7684;await&#x548C;signal()</h3><p>&#x5728;java Lock&#x4F53;&#x7CFB;&#x4E0B;&#x4F9D;&#x7136;&#x4F1A;&#x6709;&#x540C;&#x6837;&#x7684;&#x65B9;&#x6CD5;&#x5B9E;&#x73B0;&#x7B49;&#x5F85;/&#x901A;&#x77E5;&#x673A;&#x5236;&#x3002;&#x4ECE;&#x6574;&#x4F53;&#x4E0A;&#x6765;&#x770B;Object&#x7684;wait&#x548C;notify/notify&#x662F;&#x4E0E;&#x5BF9;&#x8C61;&#x76D1;&#x89C6;&#x5668;&#x914D;&#x5408;&#x5B8C;&#x6210;&#x7EBF;&#x7A0B;&#x95F4;&#x7684;&#x7B49;&#x5F85;/&#x901A;&#x77E5;&#x673A;&#x5236;&#xFF0C;&#x800C;Condition&#x4E0E;Lock&#x914D;&#x5408;&#x5B8C;&#x6210;&#x7B49;&#x5F85;&#x901A;&#x77E5;&#x673A;&#x5236;&#xFF0C;&#x524D;&#x8005;&#x662F;java&#x5E95;&#x5C42;&#x7EA7;&#x522B;&#x7684;&#xFF0C;&#x540E;&#x8005;&#x662F;&#x8BED;&#x8A00;&#x7EA7;&#x522B;&#x7684;&#xFF0C;&#x5177;&#x6709;&#x66F4;&#x9AD8;&#x7684;&#x53EF;&#x63A7;&#x5236;&#x6027;&#x548C;&#x6269;&#x5C55;&#x6027;</p>
<p><strong>&#x9488;&#x5BF9;Object&#x7684;notify/notifyAll&#x65B9;&#x6CD5;</strong><br>void signal()&#xFF1A;&#x5524;&#x9192;&#x4E00;&#x4E2A;&#x7B49;&#x5F85;&#x5728;condition&#x4E0A;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x5C06;&#x8BE5;&#x7EBF;&#x7A0B;&#x4ECE;&#x7B49;&#x5F85;&#x961F;&#x5217;&#x4E2D;&#x8F6C;&#x79FB;&#x5230;&#x540C;&#x6B65;&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x5728;&#x540C;&#x6B65;&#x961F;&#x5217;&#x4E2D;&#x80FD;&#x591F;&#x7ADE;&#x4E89;&#x5230;Lock&#x5219;&#x53EF;&#x4EE5;&#x4ECE;&#x7B49;&#x5F85;&#x65B9;&#x6CD5;&#x4E2D;&#x8FD4;&#x56DE;&#x3002;<br>void signalAll()&#xFF1A;&#x4E0E;1&#x7684;&#x533A;&#x522B;&#x5728;&#x4E8E;&#x80FD;&#x591F;&#x5524;&#x9192;&#x6240;&#x6709;&#x7B49;&#x5F85;&#x5728;condition&#x4E0A;&#x7684;&#x7EBF;&#x7A0B;</p>
<p><strong>&#x9488;&#x5BF9;Object&#x7684;wait&#x65B9;&#x6CD5;</strong><br>void await() throws InterruptedException:&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x8FDB;&#x5165;&#x7B49;&#x5F85;&#x72B6;&#x6001;&#xFF0C;&#x5982;&#x679C;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x8C03;&#x7528;condition&#x7684;signal&#x6216;&#x8005;signalAll&#x65B9;&#x6CD5;&#x5E76;&#x4E14;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x83B7;&#x53D6;Lock&#x4ECE;await&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#xFF0C;&#x5982;&#x679C;&#x5728;&#x7B49;&#x5F85;&#x72B6;&#x6001;&#x4E2D;&#x88AB;&#x4E2D;&#x65AD;&#x4F1A;&#x629B;&#x51FA;&#x88AB;&#x4E2D;&#x65AD;&#x5F02;&#x5E38;&#xFF1B;<br>long awaitNanos(long nanosTimeout)&#xFF1A;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x8FDB;&#x5165;&#x7B49;&#x5F85;&#x72B6;&#x6001;&#x76F4;&#x5230;&#x88AB;&#x901A;&#x77E5;&#xFF0C;&#x4E2D;&#x65AD;&#x6216;&#x8005;&#x8D85;&#x65F6;&#xFF1B;<br>boolean await(long time, TimeUnit unit)throws InterruptedException&#xFF1A;&#x540C;&#x7B2C;&#x4E8C;&#x79CD;&#xFF0C;&#x652F;&#x6301;&#x81EA;&#x5B9A;&#x4E49;&#x65F6;&#x95F4;&#x5355;&#x4F4D;<br>boolean awaitUntil(Date deadline) throws InterruptedException&#xFF1A;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x8FDB;&#x5165;&#x7B49;&#x5F85;&#x72B6;&#x6001;&#x76F4;&#x5230;&#x88AB;&#x901A;&#x77E5;&#xFF0C;&#x4E2D;&#x65AD;&#x6216;&#x8005;&#x5230;&#x4E86;&#x67D0;&#x4E2A;&#x65F6;&#x95F4;</p>
<p><strong>Condition&#x4F18;&#x70B9;</strong></p>
<ol>
<li>Condition&#x80FD;&#x591F;&#x652F;&#x6301;&#x4E0D;&#x54CD;&#x5E94;&#x4E2D;&#x65AD;&#xFF0C;&#x800C;&#x901A;&#x8FC7;&#x4F7F;&#x7528;Object&#x65B9;&#x5F0F;&#x4E0D;&#x652F;&#x6301;&#xFF1B;</li>
<li>Condition&#x80FD;&#x591F;&#x652F;&#x6301;&#x591A;&#x4E2A;&#x7B49;&#x5F85;&#x961F;&#x5217;&#xFF08;new &#x591A;&#x4E2A;Condition&#x5BF9;&#x8C61;&#xFF09;&#xFF0C;&#x800C;Object&#x65B9;&#x5F0F;&#x53EA;&#x80FD;&#x652F;&#x6301;&#x4E00;&#x4E2A;&#xFF1B;</li>
<li>Condition&#x80FD;&#x591F;&#x652F;&#x6301;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#x7684;&#x8BBE;&#x7F6E;&#xFF0C;&#x800C;Object&#x4E0D;&#x652F;&#x6301;</li>
</ol>
<p>&#x3002;</p>
<h2 id="Lock&#x63A5;&#x53E3;"><a href="#Lock&#x63A5;&#x53E3;" class="headerlink" title="Lock&#x63A5;&#x53E3;"></a>Lock&#x63A5;&#x53E3;</h2><h3 id="lock-&#x6982;&#x5FF5;"><a href="#lock-&#x6982;&#x5FF5;" class="headerlink" title="lock &#x6982;&#x5FF5;"></a>lock &#x6982;&#x5FF5;</h3><ol>
<li>Lock&#x662F;&#x4E00;&#x4E2A;&#x63A5;&#x53E3;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E8E;List</li>
<li>Lock&#x548C;ReadWriteLock&#x63A5;&#x53E3;&#x662F;&#x4E24;&#x5927;&#x9501;&#x7684;&#x6839;&#x63A5;&#x53E3;</li>
<li>Lock&#x4EE3;&#x8868;&#x5B9E;&#x73B0;&#x7C7B;&#x662F;ReentrantLock&#xFF08;&#x53EF;&#x91CD;&#x5165;&#x9501;&#xFF09;</li>
<li>ReadWriteLock&#xFF08;&#x8BFB;&#x5199;&#x9501;&#xFF09;&#x7684;&#x4EE3;&#x8868;&#x5B9E;&#x73B0;&#x7C7B;&#x662F;ReentrantReadWriteLock&#x3002;</li>
<li><em>Condition &#x63A5;&#x53E3;</em>&#x63CF;&#x8FF0;&#x4E86;&#x53EF;&#x80FD;&#x4F1A;&#x4E0E;&#x9501;&#x6709;&#x5173;&#x8054;&#x7684;&#x6761;&#x4EF6;&#x53D8;&#x91CF;&#x3002;&#x8FD9;&#x4E9B;&#x53D8;&#x91CF;&#x5728;&#x7528;&#x6CD5;&#x4E0A;&#x4E0E;&#x4F7F;&#x7528; Object.wait &#x8BBF;&#x95EE;&#x7684;&#x9690;&#x5F0F;&#x76D1;&#x89C6;&#x5668;&#x7C7B;&#x4F3C;&#xFF0C;&#x4F46;&#x63D0;&#x4F9B;&#x4E86;&#x66F4;&#x5F3A;&#x5927;&#x7684;&#x529F;&#x80FD;&#x3002;&#x9700;&#x8981;&#x7279;&#x522B;&#x6307;&#x51FA;&#x7684;&#x662F;&#xFF0C;&#x5355;&#x4E2A; Lock &#x53EF;&#x80FD;&#x4E0E;&#x591A;&#x4E2A; Condition &#x5BF9;&#x8C61;&#x5173;&#x8054;&#x3002;&#x4E3A;&#x4E86;&#x907F;&#x514D;&#x517C;&#x5BB9;&#x6027;&#x95EE;&#x9898;&#xFF0C;Condition &#x65B9;&#x6CD5;&#x7684;&#x540D;&#x79F0;&#x4E0E;&#x5BF9;&#x5E94;&#x7684; Object &#x7248;&#x672C;&#x4E2D;&#x7684;&#x4E0D;&#x540C;&#x3002;</li>
</ol>
<h3 id="&#x9501;&#x7684;&#x540D;&#x8BCD;"><a href="#&#x9501;&#x7684;&#x540D;&#x8BCD;" class="headerlink" title="&#x9501;&#x7684;&#x540D;&#x8BCD;"></a>&#x9501;&#x7684;&#x540D;&#x8BCD;</h3><h4 id="1-&#x53EF;&#x91CD;&#x5165;&#x9501;"><a href="#1-&#x53EF;&#x91CD;&#x5165;&#x9501;" class="headerlink" title="1. &#x53EF;&#x91CD;&#x5165;&#x9501;"></a>1. &#x53EF;&#x91CD;&#x5165;&#x9501;</h4><p>&#x53EF;&#x91CD;&#x5165;&#x5C31;&#x662F;&#x8BF4;&#x67D0;&#x4E2A;&#x7EBF;&#x7A0B;&#x5DF2;&#x7ECF;&#x83B7;&#x5F97;&#x67D0;&#x4E2A;&#x9501;&#xFF0C;&#x53EF;&#x4EE5;&#x518D;&#x6B21;&#x83B7;&#x53D6;&#x9501;&#x800C;&#x4E0D;&#x4F1A;&#x51FA;&#x73B0;&#x6B7B;&#x9501;&#x3002;<strong>&#x524D;&#x63D0;&#x5F97;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x6216;&#x8005;class&#xFF09;</strong><br>&#x9501;&#x7684;&#x5206;&#x914D;&#x673A;&#x5236;&#xFF1A;&#x57FA;&#x4E8E;&#x7EBF;&#x7A0B;&#x7684;&#x5206;&#x914D;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x57FA;&#x4E8E;&#x65B9;&#x6CD5;&#x8C03;&#x7528;&#x7684;&#x5206;&#x914D;&#x3002;<br>&#x53EF;&#x91CD;&#x5165;&#xFF0C;&#x5C31;&#x662F;&#x53EF;&#x4EE5;&#x91CD;&#x590D;&#x83B7;&#x53D6;<strong>&#x76F8;&#x540C;&#x7684;&#x9501;</strong>&#xFF0C;synchronized&#x548C;ReentrantLock&#x90FD;&#x662F;&#x53EF;&#x91CD;&#x5165;&#x7684;<br>&#x8BB0;&#x5F55;&#x62E5;&#x6709;&#x9501;&#x7684;&#x7EBF;&#x7A0B;id&#x4EE5;&#x53CA;&#x83B7;&#x5F97;&#x9501;&#x7684;&#x6B21;&#x6570;&#x3002;&#x518D;&#x6B21;&#x83B7;&#x53D6;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5982;&#x679C;&#x8FD9;&#x4E2A;&#x9501;&#x4E0D;&#x662F;&#x5B83;&#x7684;&#x5219;&#x8981;&#x7B49;&#x5F85;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x5B83;&#x7684;&#x8BDD;&#xFF0C;&#x603B;&#x6570;+1&#x3002;&#x5F53;&#x91CA;&#x653E;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x62E5;&#x6709;&#x9501;&#x7684;&#x4E2A;&#x6570;&#x51CF;&#x4E00;&#x3002;<br>&#x5BF9;&#x4E8E;synchronized&#x800C;&#x8A00;&#xFF0C;&#x6709;&#x591A;&#x5C11;&#x4E2A;&#x90FD;&#x884C;&#xFF0C;&#x81EA;&#x52A8;&#x91CA;&#x653E;<br>&#x5BF9;&#x4E8E;lock.lock();ReentrantLock&#x7684;&#x65F6;&#x5019;&#x4E00;&#x5B9A;&#x8981;&#x624B;&#x52A8;&#x91CA;&#x653E;&#x9501;&#xFF0C;&#x5E76;&#x4E14;&#x52A0;&#x9501;&#x6B21;&#x6570;&#x548C;&#x91CA;&#x653E;&#x6B21;&#x6570;&#x8981;&#x4E00;&#x6837;<br>&#x4F8B;&#x5982;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">csharp&#x590D;&#x5236;&#x4EE3;&#x7801;lock.lock();</span><br><span class="line">lock.lock();</span><br><span class="line">lock.lock();</span><br><span class="line">lock.unlock();</span><br><span class="line">lock.unlock();</span><br><span class="line">lock.unlock();</span><br></pre></td></tr></table></figure>

<p><strong>&#x4F5C;&#x7528;</strong>&#xFF1A;&#x53EF;&#x91CD;&#x5165;&#x9501;&#x662F;&#x4E3A;&#x4E86;&#x907F;&#x514D;&#x6B7B;&#x9501;&#x3002;</p>
<h4 id="2-&#x53EF;&#x4E2D;&#x65AD;&#x9501;"><a href="#2-&#x53EF;&#x4E2D;&#x65AD;&#x9501;" class="headerlink" title="2. &#x53EF;&#x4E2D;&#x65AD;&#x9501;"></a>2. &#x53EF;&#x4E2D;&#x65AD;&#x9501;</h4><p>&#x53EF;&#x4E2D;&#x65AD;&#x9501;&#x5C31;&#x662F;&#x53EF;&#x4EE5;&#x54CD;&#x5E94;&#x4E2D;&#x65AD;&#x7684;&#x9501;&#x3002;&#x5728;Java&#x4E2D;&#xFF0C;synchronized&#x5C31;&#x4E0D;&#x662F;&#x53EF;&#x4E2D;&#x65AD;&#x9501;&#xFF0C;&#x800C;Lock&#x662F;&#x53EF;&#x4E2D;&#x65AD;&#x9501;&#x3002;<br>&#x3000;&#x3000;&#x5982;&#x679C;&#x67D0;&#x4E00;&#x7EBF;&#x7A0B;A&#x6B63;&#x5728;&#x6267;&#x884C;&#x9501;&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x53E6;&#x4E00;&#x7EBF;&#x7A0B;B&#x6B63;&#x5728;&#x7B49;&#x5F85;&#x83B7;&#x53D6;&#x8BE5;&#x9501;&#xFF0C;&#x53EF;&#x80FD;&#x7531;&#x4E8E;&#x7B49;&#x5F85;&#x65F6;&#x95F4;&#x8FC7;&#x957F;&#xFF0C;&#x7EBF;&#x7A0B;B&#x4E0D;&#x60F3;&#x7B49;&#x5F85;&#x4E86;&#xFF0C;&#x60F3;&#x5148;&#x5904;&#x7406;&#x5176;&#x4ED6;&#x4E8B;&#x60C5;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8BA9;&#x5B83;&#x4E2D;&#x65AD;&#x81EA;&#x5DF1;&#x6216;&#x8005;&#x5728;&#x522B;&#x7684;&#x7EBF;&#x7A0B;&#x4E2D;&#x4E2D;&#x65AD;&#x5B83;&#xFF0C;&#x8FD9;&#x79CD;&#x5C31;&#x662F;&#x53EF;&#x4E2D;&#x65AD;&#x9501;&#x3002;&#x5728;&#x524D;&#x9762;&#x6F14;&#x793A;tryLock(long time, TimeUnit unit)&#x548C;lockInterruptibly()&#x7684;&#x7528;&#x6CD5;&#x65F6;&#x5DF2;&#x7ECF;&#x4F53;&#x73B0;&#x4E86;Lock&#x7684;&#x53EF;&#x4E2D;&#x65AD;&#x6027;&#x3002;
&#x3000;&#x3000;</p>
<h4 id="3-&#x516C;&#x5E73;&#x9501;"><a href="#3-&#x516C;&#x5E73;&#x9501;" class="headerlink" title="3. &#x516C;&#x5E73;&#x9501;"></a>3. &#x516C;&#x5E73;&#x9501;</h4><p>&#x516C;&#x5E73;&#x9501;&#x5373; &#x5C3D;&#x91CF; &#x4EE5;&#x8BF7;&#x6C42;&#x9501;&#x7684;&#x987A;&#x5E8F;&#x6765;&#x83B7;&#x53D6;&#x9501;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x540C;&#x662F;&#x6709;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x5728;&#x7B49;&#x5F85;&#x4E00;&#x4E2A;&#x9501;&#xFF0C;&#x5F53;&#x8FD9;&#x4E2A;&#x9501;&#x88AB;&#x91CA;&#x653E;&#x65F6;&#xFF0C;&#x7B49;&#x5F85;&#x65F6;&#x95F4;&#x6700;&#x4E45;&#x7684;&#x7EBF;&#x7A0B;&#xFF08;&#x6700;&#x5148;&#x8BF7;&#x6C42;&#x7684;&#x7EBF;&#x7A0B;&#xFF09;&#x4F1A;&#x83B7;&#x5F97;&#x8BE5;&#x6240;&#xFF0C;&#x8FD9;&#x79CD;&#x5C31;&#x662F;&#x516C;&#x5E73;&#x9501;&#x3002;&#x800C;&#x975E;&#x516C;&#x5E73;&#x9501;&#x5219;&#x65E0;&#x6CD5;&#x4FDD;&#x8BC1;&#x9501;&#x7684;&#x83B7;&#x53D6;&#x662F;&#x6309;&#x7167;&#x8BF7;&#x6C42;&#x9501;&#x7684;&#x987A;&#x5E8F;&#x8FDB;&#x884C;&#x7684;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x67D0;&#x4E2A;&#x6216;&#x8005;&#x4E00;&#x4E9B;&#x7EBF;&#x7A0B;&#x6C38;&#x8FDC;&#x83B7;&#x53D6;&#x4E0D;&#x5230;&#x9501;&#x3002;</p>
<p>&#x3000;&#x3000;&#x5728;Java&#x4E2D;&#xFF0C;synchronized&#x5C31;&#x662F;&#x975E;&#x516C;&#x5E73;&#x9501;&#xFF0C;&#x5B83;&#x65E0;&#x6CD5;&#x4FDD;&#x8BC1;&#x7B49;&#x5F85;&#x7684;&#x7EBF;&#x7A0B;&#x83B7;&#x53D6;&#x9501;&#x7684;&#x987A;&#x5E8F;&#x3002;&#x800C;&#x5BF9;&#x4E8E;ReentrantLock &#x548C; ReentrantReadWriteLock&#xFF0C;&#x5B83;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#x662F;&#x975E;&#x516C;&#x5E73;&#x9501;&#xFF0C;&#x4F46;&#x662F;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x4E3A;&#x516C;&#x5E73;&#x9501;
&#x3000;&#x3000;</p>
<h4 id="4-&#x81EA;&#x65CB;&#x9501;"><a href="#4-&#x81EA;&#x65CB;&#x9501;" class="headerlink" title="4.&#x81EA;&#x65CB;&#x9501;"></a>4.&#x81EA;&#x65CB;&#x9501;</h4><p>&#x81EA;&#x65CB;&#x9501;&#xFF08;spinlock&#xFF09;&#xFF1A;&#x662F;&#x6307;&#x5F53;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x5728;&#x83B7;&#x53D6;&#x9501;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5982;&#x679C;&#x9501;&#x5DF2;&#x7ECF;&#x88AB;&#x5176;&#x5B83;&#x7EBF;&#x7A0B;&#x83B7;&#x53D6;&#xFF0C;&#x90A3;&#x4E48;&#x8BE5;&#x7EBF;&#x7A0B;&#x5C06;&#x5FAA;&#x73AF;&#x7B49;&#x5F85;&#xFF0C;&#x7136;&#x540E;&#x4E0D;&#x65AD;&#x7684;&#x5224;&#x65AD;&#x9501;&#x662F;&#x5426;&#x80FD;&#x591F;&#x88AB;&#x6210;&#x529F;&#x83B7;&#x53D6;&#xFF0C;&#x76F4;&#x5230;&#x83B7;&#x53D6;&#x5230;&#x9501;&#x624D;&#x4F1A;&#x9000;&#x51FA;&#x5FAA;&#x73AF;&#x3002;<br><em>&#x4F18;&#x70B9;</em>&#xFF1A;<br>&#x81EA;&#x65CB;&#x9501;&#x4E0D;&#x4F1A;&#x4F7F;&#x7EBF;&#x7A0B;&#x72B6;&#x6001;&#x53D1;&#x751F;&#x5207;&#x6362;&#xFF0C;&#x4E00;&#x76F4;&#x5904;&#x4E8E;&#x7528;&#x6237;&#x6001;&#xFF0C;&#x5373;&#x7EBF;&#x7A0B;&#x4E00;&#x76F4;&#x90FD;&#x662F;active&#x7684;&#xFF1B;&#x4E0D;&#x4F1A;&#x4F7F;&#x7EBF;&#x7A0B;&#x8FDB;&#x5165;&#x963B;&#x585E;&#x72B6;&#x6001;&#xFF0C;&#x51CF;&#x5C11;&#x4E86;&#x4E0D;&#x5FC5;&#x8981;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x5207;&#x6362;&#xFF0C;&#x6267;&#x884C;&#x901F;&#x5EA6;&#x5FEB;<br>&#x975E;&#x81EA;&#x65CB;&#x9501;&#x5728;&#x83B7;&#x53D6;&#x4E0D;&#x5230;&#x9501;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x8FDB;&#x5165;&#x963B;&#x585E;&#x72B6;&#x6001;&#xFF0C;&#x4ECE;&#x800C;&#x8FDB;&#x5165;&#x5185;&#x6838;&#x6001;&#xFF0C;&#x5F53;&#x83B7;&#x53D6;&#x5230;&#x9501;&#x7684;&#x65F6;&#x5019;&#x9700;&#x8981;&#x4ECE;&#x5185;&#x6838;&#x6001;&#x6062;&#x590D;&#xFF0C;&#x9700;&#x8981;&#x7EBF;&#x7A0B;&#x4E0A;&#x4E0B;&#x6587;&#x5207;&#x6362;&#x3002; &#xFF08;&#x7EBF;&#x7A0B;&#x88AB;&#x963B;&#x585E;&#x540E;&#x4FBF;&#x8FDB;&#x5165;&#x5185;&#x6838;&#xFF08;Linux&#xFF09;&#x8C03;&#x5EA6;&#x72B6;&#x6001;&#xFF0C;&#x8FD9;&#x4E2A;&#x4F1A;&#x5BFC;&#x81F4;&#x7CFB;&#x7EDF;&#x5728;&#x7528;&#x6237;&#x6001;&#x4E0E;&#x5185;&#x6838;&#x6001;&#x4E4B;&#x95F4;&#x6765;&#x56DE;&#x5207;&#x6362;&#xFF0C;&#x4E25;&#x91CD;&#x5F71;&#x54CD;&#x9501;&#x7684;&#x6027;&#x80FD;&#xFF09;<br><em>&#x7F3A;&#x70B9;</em>&#xFF1A;</p>
<ol>
<li>&#x5982;&#x679C;&#x67D0;&#x4E2A;&#x7EBF;&#x7A0B;&#x6301;&#x6709;&#x9501;&#x7684;&#x65F6;&#x95F4;&#x8FC7;&#x957F;&#xFF0C;&#x5C31;&#x4F1A;&#x5BFC;&#x81F4;&#x5176;&#x5B83;&#x7B49;&#x5F85;&#x83B7;&#x53D6;&#x9501;&#x7684;&#x7EBF;&#x7A0B;&#x8FDB;&#x5165;&#x5FAA;&#x73AF;&#x7B49;&#x5F85;&#xFF0C;&#x6D88;&#x8017;CPU&#x3002;&#x4F7F;&#x7528;&#x4E0D;&#x5F53;&#x4F1A;&#x9020;&#x6210;CPU&#x4F7F;&#x7528;&#x7387;&#x6781;&#x9AD8;&#x3002;</li>
<li>&#x4E0A;&#x9762;Java&#x5B9E;&#x73B0;&#x7684;&#x81EA;&#x65CB;&#x9501;&#x4E0D;&#x662F;&#x516C;&#x5E73;&#x7684;&#xFF0C;&#x5373;&#x65E0;&#x6CD5;&#x6EE1;&#x8DB3;&#x7B49;&#x5F85;&#x65F6;&#x95F4;&#x6700;&#x957F;&#x7684;&#x7EBF;&#x7A0B;&#x4F18;&#x5148;&#x83B7;&#x53D6;&#x9501;&#x3002;&#x4E0D;&#x516C;&#x5E73;&#x7684;&#x9501;&#x5C31;&#x4F1A;&#x5B58;&#x5728;&#x201C;&#x7EBF;&#x7A0B;&#x9965;&#x997F;&#x201D;&#x95EE;&#x9898;&#x3002;</li>
</ol>
<p>&#x57FA;&#x4E8E;&#x81EA;&#x65CB;&#x9501;&#xFF0C;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x5177;&#x5907;<strong>&#x516C;&#x5E73;&#x6027;&#x548C;&#x53EF;&#x91CD;&#x5165;&#x6027;&#x8D28;&#x7684;&#x9501;</strong>&#x3002;</p>
<p>TicketLock:&#x91C7;&#x7528;&#x7C7B;&#x4F3C;&#x94F6;&#x884C;&#x6392;&#x53F7;&#x53EB;&#x597D;&#x7684;&#x65B9;&#x5F0F;&#x5B9E;&#x73B0;&#x81EA;&#x65CB;&#x9501;&#x7684;&#x516C;&#x5E73;&#x6027;&#xFF0C;&#x4F46;&#x662F;&#x7531;&#x4E8E;&#x4E0D;&#x505C;&#x7684;&#x8BFB;&#x53D6;serviceNum&#xFF0C;&#x6BCF;&#x6B21;&#x8BFB;&#x5199;&#x64CD;&#x4F5C;&#x90FD;&#x5FC5;&#x987B;&#x5728;&#x591A;&#x4E2A;&#x5904;&#x7406;&#x5668;&#x7F13;&#x5B58;&#x4E4B;&#x95F4;&#x8FDB;&#x884C;&#x7F13;&#x5B58;&#x540C;&#x6B65;&#xFF0C;&#x8FD9;&#x4F1A;&#x5BFC;&#x81F4;&#x7E41;&#x91CD;&#x7684;&#x7CFB;&#x7EDF;&#x603B;&#x7EBF;&#x548C;&#x5185;&#x5B58;&#x7684;&#x6D41;&#x91CF;&#xFF0C;&#x5927;&#x5927;&#x964D;&#x4F4E;&#x7CFB;&#x7EDF;&#x6574;&#x4F53;&#x7684;&#x6027;&#x80FD;&#x3002;</p>
<p>CLH&#x4E5F;&#x662F;&#x4E00;&#x79CD;&#x57FA;&#x4E8E;&#x5355;&#x5411;&#x94FE;&#x8868;(&#x9690;&#x5F0F;&#x521B;&#x5EFA;)&#x7684;&#x9AD8;&#x6027;&#x80FD;&#x3001;&#x516C;&#x5E73;&#x7684;&#x81EA;&#x65CB;&#x9501;&#xFF0C;&#x7533;&#x8BF7;&#x52A0;&#x9501;&#x7684;&#x7EBF;&#x7A0B;&#x53EA;&#x9700;&#x8981;&#x5728;<strong>&#x5176;&#x524D;&#x9A71;&#x8282;&#x70B9;&#x7684;&#x672C;&#x5730;&#x53D8;&#x91CF;&#x4E0A;&#x81EA;&#x65CB;</strong>&#xFF0C;&#x4ECE;&#x800C;&#x6781;&#x5927;&#x5730;&#x51CF;&#x5C11;&#x4E86;&#x4E0D;&#x5FC5;&#x8981;&#x7684;&#x5904;&#x7406;&#x5668;&#x7F13;&#x5B58;&#x540C;&#x6B65;&#x7684;&#x6B21;&#x6570;&#xFF0C;&#x964D;&#x4F4E;&#x4E86;&#x603B;&#x7EBF;&#x548C;&#x5185;&#x5B58;&#x7684;&#x5F00;&#x9500;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;public interface Lock {</span><br><span class="line">    void lock();</span><br><span class="line"> </span><br><span class="line">    void unlock();</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">public class QNode {</span><br><span class="line">    volatile boolean locked;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">import java.util.concurrent.atomic.AtomicReference;</span><br><span class="line"> </span><br><span class="line">public class CLHLock implements Lock {</span><br><span class="line">    // &#x5C3E;&#x5DF4;&#xFF0C;&#x662F;&#x6240;&#x6709;&#x7EBF;&#x7A0B;&#x5171;&#x6709;&#x7684;&#x4E00;&#x4E2A;&#x3002;&#x6240;&#x6709;&#x7EBF;&#x7A0B;&#x8FDB;&#x6765;&#x540E;&#xFF0C;&#x628A;&#x81EA;&#x5DF1;&#x8BBE;&#x7F6E;&#x4E3A;tail</span><br><span class="line">    private final AtomicReference&lt;QNode&gt; tail;//&#x88AB;final&#x4FEE;&#x9970;&#x7684;&#x53D8;&#x91CF;&#xFF0C;&#x4E0D;&#x53EF;&#x53D8;&#x7684;&#x662F;&#x53D8;&#x91CF;&#x7684;&#x5F15;&#x7528;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x53D8;&#x91CF;&#x7684;&#x5185;&#x5BB9;</span><br><span class="line">    // &#x524D;&#x9A71;&#x8282;&#x70B9;&#xFF0C;&#x6BCF;&#x4E2A;&#x7EBF;&#x7A0B;&#x72EC;&#x6709;&#x4E00;&#x4E2A;&#x3002;</span><br><span class="line">    private final ThreadLocal&lt;QNode&gt; myPred;</span><br><span class="line">    // &#x5F53;&#x524D;&#x8282;&#x70B9;&#xFF0C;&#x8868;&#x793A;&#x81EA;&#x5DF1;&#xFF0C;&#x6BCF;&#x4E2A;&#x7EBF;&#x7A0B;&#x72EC;&#x6709;&#x4E00;&#x4E2A;&#x3002;</span><br><span class="line">    private final ThreadLocal&lt;QNode&gt; myNode;</span><br><span class="line"> </span><br><span class="line">    public CLHLock() {&#x3002;//&#x4EC5;&#x4EC5;&#x662F;&#x521D;&#x59CB;&#x5316;&#x800C;&#x5DF2;</span><br><span class="line">        this.tail = new AtomicReference&lt;QNode&gt;(new QNode());</span><br><span class="line">        this.myNode = new ThreadLocal&lt;QNode&gt;() {</span><br><span class="line">            protected QNode initialValue() {</span><br><span class="line">                return new QNode();</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line">        this.myPred = new ThreadLocal&lt;QNode&gt;();</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    @Override</span><br><span class="line">    public void lock() {</span><br><span class="line">        // &#x83B7;&#x53D6;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x7684;&#x4EE3;&#x8868;&#x8282;&#x70B9;</span><br><span class="line">        QNode node = myNode.get();</span><br><span class="line">        // &#x5C06;&#x81EA;&#x5DF1;&#x7684;&#x72B6;&#x6001;&#x8BBE;&#x7F6E;&#x4E3A;true&#x8868;&#x793A;&#x83B7;&#x53D6;&#x9501;&#x3002;</span><br><span class="line">        node.locked = true;</span><br><span class="line">        // &#x5C06;&#x81EA;&#x5DF1;&#x653E;&#x5728;&#x961F;&#x5217;&#x7684;&#x5C3E;&#x5DF4;&#xFF0C;&#x5E76;&#x4E14;&#x8FD4;&#x56DE;&#x4EE5;&#x524D;&#x7684;&#x503C;&#x3002;&#x7B2C;&#x4E00;&#x6B21;&#x8FDB;&#x5C06;&#x83B7;&#x53D6;&#x6784;&#x9020;&#x51FD;&#x6570;&#x4E2D;&#x7684;&#x90A3;&#x4E2A;new QNode</span><br><span class="line">        QNode pred = tail.getAndSet(node);//&#x76F8;&#x5F53;&#x4E8E;&#x4E24;&#x6B65;&#x64CD;&#x4F5C;&#xFF0C;QNode pred=tail.get();  tail.set(node);</span><br><span class="line">        // &#x628A;&#x65E7;&#x7684;&#x8282;&#x70B9;&#x653E;&#x5165;&#x524D;&#x9A71;&#x8282;&#x70B9;&#x3002;</span><br><span class="line">        myPred.set(pred);</span><br><span class="line">        // &#x5224;&#x65AD;&#x524D;&#x9A71;&#x8282;&#x70B9;&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x7136;&#x540E;&#x8D70;&#x6389;&#x3002;</span><br><span class="line">        while (pred.locked) {</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    @Override</span><br><span class="line">    public void unlock() {</span><br><span class="line">        // unlock. &#x83B7;&#x53D6;&#x81EA;&#x5DF1;&#x7684;node&#x3002;&#x628A;&#x81EA;&#x5DF1;&#x7684;locked&#x8BBE;&#x7F6E;&#x4E3A;false&#x3002;</span><br><span class="line">        QNode node = myNode.get();</span><br><span class="line">        node.locked = false;</span><br><span class="line">        myNode.set(myPred.get());//&#x53EF;&#x80FD;&#x4E3A;&#x4E86;&#x7A81;&#x7136;&#x4E2D;&#x65AD;&#xFF0C;&#x63D2;&#x961F;&#x4E4B;&#x7C7B;&#x529F;&#x80FD;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>MCSLock&#x5219;&#x662F;&#x5BF9;&#x672C;&#x5730;&#x53D8;&#x91CF;&#x7684;&#x8282;&#x70B9;&#x8FDB;&#x884C;&#x5FAA;&#x73AF;&#x3002;<br>MCS &#x7684;&#x5B9E;&#x73B0;&#x662F;&#x57FA;&#x4E8E;&#x94FE;&#x8868;&#x7684;&#xFF0C;&#x6BCF;&#x4E2A;&#x7533;&#x8BF7;&#x9501;&#x7684;&#x7EBF;&#x7A0B;&#x90FD;&#x662F;&#x94FE;&#x8868;&#x4E0A;&#x7684;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#xFF0C;&#x8FD9;&#x4E9B;&#x7EBF;&#x7A0B;&#x4F1A;&#x4E00;&#x76F4;&#x8F6E;&#x8BE2;&#x81EA;&#x5DF1;&#x7684;&#x672C;&#x5730;&#x53D8;&#x91CF;&#xFF0C;&#x6765;&#x77E5;&#x9053;&#x5B83;&#x81EA;&#x5DF1;&#x662F;&#x5426;&#x83B7;&#x5F97;&#x4E86;&#x9501;&#x3002;&#x5DF2;&#x7ECF;&#x83B7;&#x5F97;&#x4E86;&#x9501;&#x7684;&#x7EBF;&#x7A0B;&#x5728;&#x91CA;&#x653E;&#x9501;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8D1F;&#x8D23;&#x901A;&#x77E5;&#x5176;&#x5B83;&#x7EBF;&#x7A0B;&#xFF0C;&#x8FD9;&#x6837; CPU &#x4E4B;&#x95F4;&#x7F13;&#x5B58;&#x7684;&#x540C;&#x6B65;&#x64CD;&#x4F5C;&#x5C31;&#x51CF;&#x5C11;&#x4E86;&#x5F88;&#x591A;&#xFF0C;<strong>&#x4EC5;&#x5728;&#x7EBF;&#x7A0B;&#x901A;&#x77E5;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x7684;&#x65F6;&#x5019;&#x53D1;&#x751F;</strong>&#xFF0C;&#x964D;&#x4F4E;&#x4E86;&#x7CFB;&#x7EDF;&#x603B;&#x7EBF;&#x548C;&#x5185;&#x5B58;&#x7684;&#x5F00;&#x9500;&#x3002;&#x5B9E;&#x73B0;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<p>AtomicReferenceFieldUpdater<br>&#x4E00;&#x4E2A;&#x57FA;&#x4E8E;&#x53CD;&#x5C04;&#x7684;&#x5DE5;&#x5177;&#x7C7B;&#xFF0C;&#x5B83;&#x80FD;&#x5BF9;&#x6307;&#x5B9A;&#x7C7B;&#x7684;&#x6307;&#x5B9A;&#x7684;volatile&#x5F15;&#x7528;&#x5B57;&#x6BB5;&#x8FDB;&#x884C;&#x539F;&#x5B50;&#x66F4;&#x65B0;&#x3002;(&#x6CE8;&#x610F;&#x8FD9;&#x4E2A;&#x5B57;&#x6BB5;&#x4E0D;&#x80FD;&#x662F;private&#x7684;)</p>
<p><em>&#x8FD9;&#x6B65;&#x5F88;&#x7ECF;&#x5178;</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vbscript&#x590D;&#x5236;&#x4EE3;&#x7801; // &#x8FD9;&#x91CC;&#x4E4B;&#x6240;&#x4EE5;&#x8981;&#x5FD9;&#x7B49;&#x662F;&#x56E0;&#x4E3A;&#xFF1A;step 1&#x6267;&#x884C;&#x5B8C;&#x540E;&#xFF0C;step 2&#x53EF;&#x80FD;&#x8FD8;&#x6CA1;&#x6267;&#x884C;&#x5B8C;</span><br><span class="line">    while (currentThread.next == null) { // step 5</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;import java.util.concurrent.atomic.AtomicReferenceFieldUpdater;</span><br><span class="line">public class MCSLock {</span><br><span class="line">    public static class MCSNode {</span><br><span class="line">        volatile MCSNode next;</span><br><span class="line">        volatile boolean isWaiting = true; // &#x9ED8;&#x8BA4;&#x662F;&#x5728;&#x7B49;&#x5F85;&#x9501;</span><br><span class="line">    }</span><br><span class="line">    volatile MCSNode queue;// &#x6307;&#x5411;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x7533;&#x8BF7;&#x9501;&#x7684;MCSNode</span><br><span class="line">    private static final AtomicReferenceFieldUpdater&lt;MCSLock, MCSNode&gt; UPDATER = AtomicReferenceFieldUpdater</span><br><span class="line">            .newUpdater(MCSLock.class, MCSNode.class, &quot;queue&quot;);</span><br><span class="line">    public void lock(MCSNode currentThread) {</span><br><span class="line">        MCSNode predecessor = UPDATER.getAndSet(this, currentThread);// &#x83B7;&#x53D6;&#x961F;&#x5217;&#x672B;&#x5C3E;&#x7684;&#x503C;&#x4FDD;&#x5B58;&#x5728;predecessor&#xFF0C;&#x5E76;&#x5C06;&#x81EA;&#x5DF1;&#x6DFB;&#x52A0;&#x5230;&#x961F;&#x4F0D;&#x672B;&#x5C3E;</span><br><span class="line">        if (predecessor != null) {//&#x5224;&#x65AD;&#x4E4B;&#x524D;&#x961F;&#x4F0D;&#x662F;&#x4E0D;&#x662F;&#x7A7A;&#x7684;</span><br><span class="line">            predecessor.next = currentThread;// &#x544A;&#x8BC9;&#x524D;&#x9762;&#x54E5;&#x4EEC;&#xFF0C;&#x6211;&#x6392;&#x5728;&#x4F60;&#x540E;&#x9762;&#xFF0C;&#x4F60;&#x641E;&#x5B8C;&#x4E86;&#x8BB0;&#x5F97;&#x544A;&#x8BC9;&#x6211;&#x4E00;&#x4E0B;</span><br><span class="line">            while (currentThread.isWaiting) {// &#x7B49;&#x5F85;&#x524D;&#x9762;&#x54E5;&#x4EEC;&#x7ED9;&#x81EA;&#x5DF1;&#x7684;&#x901A;&#x77E5;</span><br><span class="line">            }</span><br><span class="line">        } else { // &#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x5728;&#x4F7F;&#x7528;&#x9501;&#xFF0C;&#x6CA1;&#x6709;&#x524D;&#x9A71;&#x6765;&#x901A;&#x77E5;&#x5B83;&#xFF0C;&#x6240;&#x4EE5;&#x5F97;&#x81EA;&#x5DF1;&#x6807;&#x8BB0;&#x81EA;&#x5DF1;&#x5DF2;&#x83B7;&#x5F97;&#x9501;</span><br><span class="line">            currentThread.isWaiting = false;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void unlock(MCSNode currentThread) {</span><br><span class="line">        if (currentThread.isWaiting) {// &#x9501;&#x62E5;&#x6709;&#x8005;&#x8FDB;&#x884C;&#x91CA;&#x653E;&#x9501;&#x624D;&#x6709;&#x610F;&#x4E49;</span><br><span class="line">            return;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        if (currentThread.next == null) {// &#x68C0;&#x67E5;&#x662F;&#x5426;&#x6709;&#x4EBA;&#x6392;&#x5728;&#x81EA;&#x5DF1;&#x540E;&#x9762;</span><br><span class="line">            if (UPDATER.compareAndSet(this, currentThread, null)) {// step 4</span><br><span class="line">                // compareAndSet&#x8FD4;&#x56DE;true&#x8868;&#x793A;&#x786E;&#x5B9E;&#x6CA1;&#x6709;&#x4EBA;&#x6392;&#x5728;&#x81EA;&#x5DF1;&#x540E;&#x9762;</span><br><span class="line">                return;</span><br><span class="line">            } else {</span><br><span class="line">                // &#x7A81;&#x7136;&#x6709;&#x4EBA;&#x6392;&#x5728;&#x81EA;&#x5DF1;&#x540E;&#x9762;&#x4E86;&#xFF0C;&#x53EF;&#x80FD;&#x8FD8;&#x4E0D;&#x77E5;&#x9053;&#x662F;&#x8C01;&#xFF0C;&#x4E0B;&#x9762;&#x662F;&#x7B49;&#x5F85;&#x540E;&#x7EED;&#x8005;&#xFF01;&#xFF01;&#xFF01;&#xFF01;&#xFF01;</span><br><span class="line">                // &#x8FD9;&#x91CC;&#x4E4B;&#x6240;&#x4EE5;&#x8981;&#x5FD9;&#x7B49;&#x662F;&#x56E0;&#x4E3A;&#xFF1A;step 1&#x6267;&#x884C;&#x5B8C;&#x540E;&#xFF0C;step 2&#x53EF;&#x80FD;&#x8FD8;&#x6CA1;&#x6267;&#x884C;&#x5B8C;</span><br><span class="line">                while (currentThread.next == null) { // step 5</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        currentThread.next.isWaiting = false;</span><br><span class="line">        currentThread.next = null;// for GC</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>CLHLock&#x548C;MCSLock&#x901A;&#x8FC7;&#x94FE;&#x8868;&#x7684;&#x65B9;&#x5F0F;&#x907F;&#x514D;&#x4E86;&#x51CF;&#x5C11;&#x4E86;&#x5904;&#x7406;&#x5668;&#x7F13;&#x5B58;&#x540C;&#x6B65;&#xFF0C;&#x6781;&#x5927;&#x7684;&#x63D0;&#x9AD8;&#x4E86;&#x6027;&#x80FD;&#xFF0C;&#x533A;&#x522B;&#x5728;&#x4E8E;CLHLock&#x662F;&#x901A;&#x8FC7;&#x8F6E;&#x8BE2;&#x5176;&#x524D;&#x9A71;&#x8282;&#x70B9;&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x800C;MCS&#x5219;&#x662F;&#x67E5;&#x770B;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;&#x9501;&#x72B6;&#x6001;&#x3002;</p>
<p>CLHLock&#x5728;NUMA&#x67B6;&#x6784;&#x4E0B;&#x4F7F;&#x7528;&#x4F1A;&#x5B58;&#x5728;&#x95EE;&#x9898;&#x3002;&#x5728;&#x6CA1;&#x6709;cache&#x7684;NUMA&#x7CFB;&#x7EDF;&#x67B6;&#x6784;&#x4E2D;&#xFF0C;&#x7531;&#x4E8E;CLHLock&#x662F;&#x5728;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;&#x524D;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x4E0A;&#x81EA;&#x65CB;,NUMA&#x67B6;&#x6784;&#x4E2D;&#x5904;&#x7406;&#x5668;&#x8BBF;&#x95EE;&#x672C;&#x5730;&#x5185;&#x5B58;&#x7684;&#x901F;&#x5EA6;&#x9AD8;&#x4E8E;&#x901A;&#x8FC7;&#x7F51;&#x7EDC;&#x8BBF;&#x95EE;&#x5176;&#x4ED6;&#x8282;&#x70B9;&#x7684;&#x5185;&#x5B58;&#xFF0C;&#x6240;&#x4EE5;CLHLock&#x5728;NUMA&#x67B6;&#x6784;&#x4E0A;&#x4E0D;&#x662F;&#x6700;&#x4F18;&#x7684;&#x81EA;&#x65CB;&#x9501;&#x3002;</p>
<p>&#x3000;&#x3000;
&#x3000;&#x3000;</p>
<h3 id="Lock&#x63A5;&#x53E3;&#x6709;6&#x4E2A;&#x65B9;&#x6CD5;"><a href="#Lock&#x63A5;&#x53E3;&#x6709;6&#x4E2A;&#x65B9;&#x6CD5;" class="headerlink" title="Lock&#x63A5;&#x53E3;&#x6709;6&#x4E2A;&#x65B9;&#x6CD5;"></a>Lock&#x63A5;&#x53E3;&#x6709;6&#x4E2A;&#x65B9;&#x6CD5;</h3><p>lock()&#x3001;tryLock()&#x3001;tryLock(long time, TimeUnit unit) &#x548C; lockInterruptibly()&#x90FD;&#x662F;&#x7528;&#x6765;&#x83B7;&#x53D6;&#x9501;&#x7684;<br>unLock()&#x65B9;&#x6CD5;&#x662F;&#x7528;&#x6765;&#x91CA;&#x653E;&#x9501;&#x7684;<br>newCondition() &#x8FD4;&#x56DE; &#x7ED1;&#x5B9A;&#x5230;&#x6B64; Lock &#x7684;&#x65B0;&#x7684; Condition &#x5B9E;&#x4F8B; &#xFF0C;&#x7528;&#x4E8E;&#x7EBF;&#x7A0B;&#x95F4;&#x7684;&#x534F;&#x4F5C;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;// &#x83B7;&#x53D6;&#x9501;  </span><br><span class="line">void lock()   </span><br><span class="line"></span><br><span class="line">// &#x5982;&#x679C;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x672A;&#x88AB;&#x4E2D;&#x65AD;&#xFF0C;&#x5219;&#x83B7;&#x53D6;&#x9501;&#xFF0C;&#x53EF;&#x4EE5;&#x54CD;&#x5E94;&#x4E2D;&#x65AD;  </span><br><span class="line">void lockInterruptibly()   </span><br><span class="line"></span><br><span class="line">// &#x8FD4;&#x56DE;&#x7ED1;&#x5B9A;&#x5230;&#x6B64; Lock &#x5B9E;&#x4F8B;&#x7684;&#x65B0; Condition &#x5B9E;&#x4F8B;  </span><br><span class="line">Condition newCondition()   </span><br><span class="line"></span><br><span class="line">// &#x4EC5;&#x5728;&#x8C03;&#x7528;&#x65F6;&#x9501;&#x4E3A;&#x7A7A;&#x95F2;&#x72B6;&#x6001;&#x624D;&#x83B7;&#x53D6;&#x8BE5;&#x9501;&#xFF0C;&#x53EF;&#x4EE5;&#x54CD;&#x5E94;&#x4E2D;&#x65AD;  </span><br><span class="line">boolean tryLock()   </span><br><span class="line"></span><br><span class="line">// &#x5982;&#x679C;&#x9501;&#x5728;&#x7ED9;&#x5B9A;&#x7684;&#x7B49;&#x5F85;&#x65F6;&#x95F4;&#x5185;&#x7A7A;&#x95F2;&#xFF0C;&#x5E76;&#x4E14;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x672A;&#x88AB;&#x4E2D;&#x65AD;&#xFF0C;&#x5219;&#x83B7;&#x53D6;&#x9501;  </span><br><span class="line">boolean tryLock(long time, TimeUnit unit)   </span><br><span class="line"></span><br><span class="line">// &#x91CA;&#x653E;&#x9501;  </span><br><span class="line">void unlock()</span><br></pre></td></tr></table></figure>

<p>&#x7528;&#x6CD5;<br><em>lock()</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">csharp&#x590D;&#x5236;&#x4EE3;&#x7801;Lock lock = ...;//=new ReentrantLock();</span><br><span class="line">lock.lock();</span><br><span class="line">try{</span><br><span class="line">    //&#x5904;&#x7406;&#x4EFB;&#x52A1;</span><br><span class="line">}catch(Exception ex){</span><br><span class="line"></span><br><span class="line">}finally{</span><br><span class="line">    lock.unlock();   //&#x91CA;&#x653E;&#x9501;&#xFF01;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><em>tryLock()</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">csharp&#x590D;&#x5236;&#x4EE3;&#x7801;Lock lock = ...;</span><br><span class="line">if(lock.tryLock()) {</span><br><span class="line">     try{</span><br><span class="line">         //&#x5904;&#x7406;&#x4EFB;&#x52A1;</span><br><span class="line">     }catch(Exception ex){</span><br><span class="line"></span><br><span class="line">     }finally{</span><br><span class="line">         lock.unlock();   //&#x91CA;&#x653E;&#x9501;</span><br><span class="line">     } </span><br><span class="line">}else {</span><br><span class="line">    //&#x5982;&#x679C;&#x4E0D;&#x80FD;&#x83B7;&#x53D6;&#x9501;&#xFF0C;&#x5219;&#x76F4;&#x63A5;&#x505A;&#x5176;&#x4ED6;&#x4E8B;&#x60C5;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><em>lockInterruptibly();</em><br>&#x901A;&#x8FC7;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x53BB;&#x83B7;&#x53D6;&#x9501;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x7EBF;&#x7A0B; &#x6B63;&#x5728;&#x7B49;&#x5F85;&#x83B7;&#x53D6;&#x9501;&#xFF0C;&#x5219;&#x8FD9;&#x4E2A;&#x7EBF;&#x7A0B;&#x80FD;&#x591F; &#x54CD;&#x5E94;&#x4E2D;&#x65AD;&#xFF0C;&#x5373;&#x4E2D;&#x65AD;&#x7EBF;&#x7A0B;&#x7684;&#x7B49;&#x5F85;&#x72B6;&#x6001;&#x3002;<br>&#x4F8B;&#x5982;&#xFF0C;&#x5F53;&#x4E24;&#x4E2A;&#x7EBF;&#x7A0B;&#x540C;&#x65F6;&#x901A;&#x8FC7;lock.lockInterruptibly()&#x60F3;&#x83B7;&#x53D6;&#x67D0;&#x4E2A;&#x9501;&#x65F6;&#xFF0C;&#x5047;&#x82E5;&#x6B64;&#x65F6;&#x7EBF;&#x7A0B;A&#x83B7;&#x53D6;&#x5230;&#x4E86;&#x9501;&#xFF0C;&#x800C;&#x7EBF;&#x7A0B;B&#x53EA;&#x6709;&#x5728;&#x7B49;&#x5F85;&#xFF0C;&#x90A3;&#x4E48;&#x5BF9;&#x7EBF;&#x7A0B;B&#x8C03;&#x7528;threadB.interrupt()&#x65B9;&#x6CD5;&#x80FD;&#x591F;&#x4E2D;&#x65AD;&#x7EBF;&#x7A0B;B&#x7684;&#x7B49;&#x5F85;&#x8FC7;&#x7A0B;&#x3002;<br>&#x7531;&#x4E8E;lockInterruptibly()&#x7684;&#x58F0;&#x660E;&#x4E2D;&#x629B;&#x51FA;&#x4E86;&#x5F02;&#x5E38;&#xFF0C;&#x6240;&#x4EE5;lock.lockInterruptibly()&#x5FC5;&#x987B;&#x653E;&#x5728;try&#x5757;&#x4E2D;&#x6216;&#x8005;&#x5728;&#x8C03;&#x7528;lockInterruptibly()&#x7684;&#x65B9;&#x6CD5;&#x5916;&#x58F0;&#x660E;&#x629B;&#x51FA; InterruptedException&#xFF0C;&#x4F46;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x540E;&#x8005;<br><strong>synchronized &#x4E2D;&#xFF0C;&#x5F53;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x5904;&#x4E8E;&#x7B49;&#x5F85;&#x67D0;&#x4E2A;&#x9501;&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x662F;&#x65E0;&#x6CD5;&#x88AB;&#x4E2D;&#x65AD;&#x7684;</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">csharp&#x590D;&#x5236;&#x4EE3;&#x7801;public void method() throws InterruptedException {</span><br><span class="line">    lock.lockInterruptibly();</span><br><span class="line">    try {  </span><br><span class="line">     //.....</span><br><span class="line">    }</span><br><span class="line">    finally {</span><br><span class="line">        lock.unlock();</span><br><span class="line">    }  </span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><em>Lock&#x7684;&#x5B9E;&#x73B0;&#x7C7B; ReentrantLock</em><br>Lock lock=new ReentrantLock(false); &#x901A;&#x8FC7;&#x53C2;&#x6570;&#x53EF;&#x4EE5;&#x8BBE;&#x5B9A;&#x662F;&#x5426;&#x4E3A;&#x516C;&#x5E73;&#x7684;&#x9501;</p>
<p>&#x8BFB;&#x5199;&#x9501;<br>ReadWriteLock lock=new ReentrantReadWriteLock();<br>lock.readLock().lock();</p>
<h3 id="lock-&#x4E0E;-synchronized&#x7684;&#x533A;&#x522B;"><a href="#lock-&#x4E0E;-synchronized&#x7684;&#x533A;&#x522B;" class="headerlink" title="lock &#x4E0E; synchronized&#x7684;&#x533A;&#x522B;"></a>lock &#x4E0E; synchronized&#x7684;&#x533A;&#x522B;</h3><ol>
<li>Lock&#x548C;synchronized&#x6709;&#x4E00;&#x70B9;&#x975E;&#x5E38;&#x5927;&#x7684;&#x4E0D;&#x540C;&#xFF0C;&#x91C7;&#x7528;synchronized&#x4E0D;&#x9700;&#x8981;&#x7528;&#x6237;&#x53BB;&#x624B;&#x52A8;&#x91CA;&#x653E;&#x9501;&#xFF0C;&#x5F53;synchronized&#x65B9;&#x6CD5;&#x6216;&#x8005;synchronized&#x4EE3;&#x7801;&#x5757;&#x6267;&#x884C;&#x5B8C;&#x4E4B;&#x540E;&#xFF0C;&#x7CFB;&#x7EDF;&#x4F1A;&#x81EA;&#x52A8;&#x8BA9;&#x7EBF;&#x7A0B;&#x91CA;&#x653E;&#x5BF9;&#x9501;&#x7684;&#x5360;&#x7528;&#xFF1B;&#x800C;Lock&#x5219;&#x5FC5;&#x987B;&#x8981;&#x7528;&#x6237;&#x53BB;&#x624B;&#x52A8;&#x91CA;&#x653E;&#x9501;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x4E3B;&#x52A8;&#x91CA;&#x653E;&#x9501;&#xFF0C;&#x5C31;&#x6709;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x51FA;&#x73B0;&#x6B7B;&#x9501;&#x73B0;&#x8C61;&#x3002;</li>
<li>&#x5728;&#x8D44;&#x6E90;&#x7ADE;&#x4E89;&#x4E0D;&#x662F;&#x5F88;&#x6FC0;&#x70C8;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;Synchronized&#x7684;&#x6027;&#x80FD;&#x8981;&#x4F18;&#x4E8E;ReetrantLock&#xFF0C;&#x4F46;&#x662F;&#x5728;&#x8D44;&#x6E90;&#x7ADE;&#x4E89;&#x5F88;&#x6FC0;&#x70C8;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;Synchronized&#x7684;&#x6027;&#x80FD;&#x4F1A;&#x4E0B;&#x964D;&#x51E0;&#x5341;&#x500D;&#xFF0C;&#x4F46;&#x662F;ReetrantLock&#x7684;&#x6027;&#x80FD;&#x80FD;&#x7EF4;&#x6301;&#x5E38;&#x6001;&#x3002;</li>
<li>&#x5360;&#x6709;&#x9501;&#x7684;&#x7EBF;&#x7A0B;&#x7531;&#x4E8E;&#x8981;&#x7B49;&#x5F85;IO&#x6216;&#x8005;&#x5176;&#x4ED6;&#x539F;&#x56E0;&#xFF08;&#x6BD4;&#x5982;&#x8C03;&#x7528;sleep&#x65B9;&#x6CD5;&#xFF09;&#x88AB;&#x963B;&#x585E;&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x53C8;&#x6CA1;&#x6709;&#x91CA;&#x653E;&#x9501;&#xFF0C;&#x90A3;&#x4E48;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x5C31;&#x53EA;&#x80FD;&#x4E00;&#x76F4;&#x7B49;&#x5F85;&#x3002;Lock &#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#xFF1A;&#x53EA;&#x7B49;&#x5F85;&#x4E00;&#x5B9A;&#x7684;&#x65F6;&#x95F4;&#xFF1A;tryLock(long time, TimeUnit unit)) &#x6216;&#x8005; &#x80FD;&#x591F;&#x54CD;&#x5E94;&#x4E2D;&#x65AD; (&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF1A;lockInterruptibly())&#xFF09;&#x89E3;&#x51B3; &#x3002;</li>
<li>synchronized&#x5F53;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x90FD;&#x53EA;&#x662F;&#x8FDB;&#x884C;&#x8BFB;&#x64CD;&#x4F5C;&#x65F6;&#xFF0C;&#x4E5F;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x5728;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x8BFB;&#x64CD;&#x4F5C;&#xFF0C;lock&#x901A;&#x8FC7;&#x8BFB;&#x5199;&#x9501;&#x89E3;&#x51B3;&#x95EE;&#x9898;</li>
<li>&#x53EF;&#x4EE5;&#x901A;&#x8FC7;Lock&#x5F97;&#x77E5;&#x7EBF;&#x7A0B;&#x6709;&#x6CA1;&#x6709;&#x6210;&#x529F;&#x83B7;&#x53D6;&#x5230;&#x9501; (&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF1A;ReentrantLock) &#xFF0C;&#x4F46;&#x8FD9;&#x4E2A;&#x662F;synchronized&#x65E0;&#x6CD5;&#x529E;&#x5230;&#x7684;&#x3002;</li>
</ol>
<h3 id="lock-demo"><a href="#lock-demo" class="headerlink" title="lock demo"></a>lock demo</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">csharp&#x590D;&#x5236;&#x4EE3;&#x7801;    static  class  MyThread1 implements Runnable{</span><br><span class="line">        public  static  Integer num=10;</span><br><span class="line">        Lock lock=new ReentrantLock();</span><br><span class="line">        @Override</span><br><span class="line">        public void run() {</span><br><span class="line">            while (true){</span><br><span class="line">                try {</span><br><span class="line">                    lock.lock();</span><br><span class="line">                    if(num&gt;0){</span><br><span class="line">                        System.out.println( Thread.currentThread().getName()+ &quot;  &#x6B63;&#x5728;&#x5356; &quot;+num--+&quot; &#x5F20;&#x8F66;&#x7968;&quot;);</span><br><span class="line">                    }else {</span><br><span class="line">                        break;</span><br><span class="line">                    }</span><br><span class="line">                }finally {</span><br><span class="line">                    lock.unlock();</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                try {</span><br><span class="line">                    Thread.sleep(1000);</span><br><span class="line">                } catch (InterruptedException e) {</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<h2 id="Semaphore"><a href="#Semaphore" class="headerlink" title="Semaphore"></a>Semaphore</h2><p>Semaphore&#x5F53;&#x524D;&#x5728;&#x591A;&#x7EBF;&#x7A0B;&#x73AF;&#x5883;&#x4E0B;&#x88AB;&#x6269;&#x653E;&#x4F7F;&#x7528;&#xFF0C;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;&#x4FE1;&#x53F7;&#x91CF;&#x662F;&#x4E2A;&#x5F88;&#x91CD;&#x8981;&#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x5728;&#x8FDB;&#x7A0B;&#x63A7;&#x5236;&#x65B9;&#x9762;&#x90FD;&#x6709;&#x5E94;&#x7528;&#x3002;Java &#x5E76;&#x53D1;&#x5E93; &#x7684;Semaphore &#x53EF;&#x4EE5;&#x5F88;&#x8F7B;&#x677E;&#x5B8C;&#x6210;&#x4FE1;&#x53F7;&#x91CF;&#x63A7;&#x5236;&#xFF0C;Semaphore&#x53EF;&#x4EE5;&#x63A7;&#x5236;&#x67D0;&#x4E2A;&#x8D44;&#x6E90;&#x53EF;&#x88AB;&#x540C;&#x65F6;&#x8BBF;&#x95EE;&#x7684;&#x4E2A;&#x6570;&#xFF0C;&#x901A;&#x8FC7; <strong>acquire()</strong> &#x83B7;&#x53D6;&#x4E00;&#x4E2A;&#x8BB8;&#x53EF;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x5C31;&#x7B49;&#x5F85;&#xFF0C;&#x800C; <strong>release()</strong> &#x91CA;&#x653E;&#x4E00;&#x4E2A;&#x8BB8;&#x53EF;&#x3002;&#x6BD4;&#x5982;&#x5728;Windows&#x4E0B;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x5171;&#x4EAB;&#x6587;&#x4EF6;&#x7684;&#x6700;&#x5927;&#x5BA2;&#x6237;&#x7AEF;&#x8BBF;&#x95EE;&#x4E2A;&#x6570;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;class TestSemaphore {</span><br><span class="line">    public static void main(String[] args) {</span><br><span class="line">        // &#x7EBF;&#x7A0B;&#x6C60;</span><br><span class="line">        ExecutorService exec = Executors.newCachedThreadPool();</span><br><span class="line">        // &#x53EA;&#x80FD;5&#x4E2A;&#x7EBF;&#x7A0B;&#x540C;&#x65F6;&#x8BBF;&#x95EE;</span><br><span class="line">        final Semaphore semp = new Semaphore(3);</span><br><span class="line">        // &#x6A21;&#x62DF;10&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x8BBF;&#x95EE;</span><br><span class="line">        for (int index = 0; index &lt; 10; index++) {</span><br><span class="line">            final int NO = index;</span><br><span class="line">            Runnable run = new Runnable() {</span><br><span class="line">                public void run() {</span><br><span class="line">                    try {</span><br><span class="line">                        // &#x83B7;&#x53D6;&#x8BB8;&#x53EF;</span><br><span class="line">                            synchronized (this){</span><br><span class="line">                                semp.acquire();</span><br><span class="line">                                System.out.println(Thread.currentThread().getName()+ &quot;Accessing: &quot; + NO);</span><br><span class="line">                                Thread.sleep((long) (Math.random() * 1000));</span><br><span class="line">                                // &#x8BBF;&#x95EE;&#x5B8C;&#x540E;&#xFF0C;&#x91CA;&#x653E;</span><br><span class="line">                                System.out.println(&quot;-----------------&quot;+semp.availablePermits());                                </span><br><span class="line">                                semp.release();//&#x4E4B;&#x524D;&#x4E0A;&#x53E5;&#x8BDD;&#x548C;&#x8FD9;&#x53E5;&#x8BDD;&#x4F4D;&#x7F6E;&#x4E92;&#x6362;&#x5C31;&#x4E0D;&#x5BF9;&#x4E86;&#xFF0C;&#x6362;&#x6210;&#x8FD9;&#x6837;&#x7684;&#x5230;&#x4E86;&#x60F3;&#x8981;&#x7684;&#x7ED3;&#x679C;&#x4E86;</span><br><span class="line"></span><br><span class="line">                            }</span><br><span class="line"></span><br><span class="line">                    } catch (InterruptedException e) {</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            };</span><br><span class="line">            exec.execute(run);</span><br><span class="line">        }</span><br><span class="line">        // &#x9000;&#x51FA;&#x7EBF;&#x7A0B;&#x6C60;</span><br><span class="line">        exec.shutdown();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#x57FA;&#x672C;&#x4E3A;&#x8FD9;&#x6837;&#x7684;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">lua&#x590D;&#x5236;&#x4EE3;&#x7801;pool-1-thread-1Accessing: 0</span><br><span class="line">pool-1-thread-2Accessing: 1</span><br><span class="line">pool-1-thread-3Accessing: 2</span><br><span class="line">-----------------0</span><br><span class="line">pool-1-thread-4Accessing: 3</span><br><span class="line">-----------------0</span><br><span class="line">pool-1-thread-5Accessing: 4</span><br><span class="line">-----------------0</span><br><span class="line">pool-1-thread-6Accessing: 5</span><br><span class="line">-----------------0</span><br><span class="line">pool-1-thread-7Accessing: 6</span><br><span class="line">-----------------0</span><br><span class="line">pool-1-thread-8Accessing: 7</span><br><span class="line">-----------------0</span><br><span class="line">pool-1-thread-9Accessing: 8</span><br><span class="line">-----------------0</span><br><span class="line">pool-1-thread-10Accessing: 9</span><br><span class="line">-----------------0</span><br><span class="line">-----------------1</span><br><span class="line">-----------------2</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<h2 id="&#x7EBF;&#x7A0B;&#x6C60;"><a href="#&#x7EBF;&#x7A0B;&#x6C60;" class="headerlink" title="&#x7EBF;&#x7A0B;&#x6C60;"></a>&#x7EBF;&#x7A0B;&#x6C60;</h2><h3 id="&#x7EBF;&#x7A0B;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;"><a href="#&#x7EBF;&#x7A0B;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;" class="headerlink" title="&#x7EBF;&#x7A0B;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;"></a>&#x7EBF;&#x7A0B;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;</h3><p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/59e26af1e1a7889e8fe7fe113982ef75c5f3fe38ca9492c5247944e1be49a763" alt="image.png"><br><strong>&#x7EBF;&#x7A0B;&#x6C60;&#x6982;&#x5FF5;</strong><br>&#x7EBF;&#x7A0B;&#x6C60;&#x5C31;&#x662F;&#x9996;&#x5148;&#x521B;&#x5EFA;&#x4E00;&#x4E9B;&#x7EBF;&#x7A0B;&#xFF0C;&#x5B83;&#x4EEC;&#x7684;&#x96C6;&#x5408;&#x79F0;&#x4E3A;&#x7EBF;&#x7A0B;&#x6C60;&#x3002;&#x4F7F;&#x7528;&#x7EBF;&#x7A0B;&#x6C60;&#x53EF;&#x4EE5;&#x5F88;&#x597D;&#x5730;&#x63D0;&#x9AD8;&#x6027;&#x80FD;&#xFF0C;&#x7EBF;&#x7A0B;&#x6C60;&#x5728;&#x7CFB;&#x7EDF;&#x542F;&#x52A8;&#x65F6;&#x5373;&#x521B;&#x5EFA;&#x5927;&#x91CF;&#x7A7A;&#x95F2;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x7A0B;&#x5E8F;&#x5C06;&#x4E00;&#x4E2A;<strong>&#x4EFB;&#x52A1;&#x4F20;&#x7ED9;&#x7EBF;&#x7A0B;&#x6C60;</strong>&#xFF0C;&#x7EBF;&#x7A0B;&#x6C60;&#x5C31;&#x4F1A;&#x542F;&#x52A8;&#x4E00;&#x6761;&#x7EBF;&#x7A0B;&#x6765;&#x6267;&#x884C;&#x8FD9;&#x4E2A;&#x4EFB;&#x52A1;&#xFF0C;&#x6267;&#x884C;&#x7ED3;&#x675F;&#x4EE5;&#x540E;&#xFF0C;&#x8BE5;&#x7EBF;&#x7A0B;&#x5E76;&#x4E0D;&#x4F1A;&#x6B7B;&#x4EA1;&#xFF0C;&#x800C;&#x662F;&#x518D;&#x6B21;&#x8FD4;&#x56DE;&#x7EBF;&#x7A0B;&#x6C60;&#x4E2D;&#x6210;&#x4E3A;&#x7A7A;&#x95F2;&#x72B6;&#x6001;&#xFF0C;&#x7B49;&#x5F85;&#x6267;&#x884C;&#x4E0B;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#x3002;<br><strong>&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x4F18;&#x70B9;</strong><br>&#x5728;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x591A;&#x6B21;&#x4F7F;&#x7528;&#x7EBF;&#x7A0B;&#xFF0C;&#x4E5F;&#x5C31;&#x610F;&#x5473;&#x7740;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x591A;&#x6B21;&#x521B;&#x5EFA;&#x5E76;&#x9500;&#x6BC1;&#x7EBF;&#x7A0B;&#x3002;&#x800C;&#x521B;&#x5EFA;&#x5E76;&#x9500;&#x6BC1;&#x7EBF;&#x7A0B;&#x7684;&#x8FC7;&#x7A0B;&#x52BF;&#x5FC5;&#x4F1A;&#x6D88;&#x8017;&#x5185;&#x5B58;&#x3002;&#x800C;&#x5728;Java&#x4E2D;&#xFF0C;&#x5185;&#x5B58;&#x8D44;&#x6E90;&#x662F;&#x53CA;&#x5176;&#x5B9D;&#x8D35;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x63D0;&#x51FA;&#x4E86;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x6982;&#x5FF5;&#x3002;<br>&#x591A;&#x7EBF;&#x7A0B;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#xFF0C;&#x7CFB;&#x7EDF;&#x4E0D;&#x65AD;&#x7684;&#x542F;&#x52A8;&#x548C;&#x5173;&#x95ED;&#x65B0;&#x7EBF;&#x7A0B;&#xFF0C;&#x6210;&#x672C;&#x975E;&#x5E38;&#x9AD8;&#xFF0C;&#x4F1A;&#x8FC7;&#x6E21;&#x6D88;&#x8017;&#x7CFB;&#x7EDF;&#x8D44;&#x6E90;&#xFF0C;&#x4EE5;&#x53CA;&#x8FC7;&#x6E21;&#x5207;&#x6362;&#x7EBF;&#x7A0B;&#x7684;&#x5371;&#x9669;&#xFF0C;&#x4ECE;&#x800C;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x7CFB;&#x7EDF;&#x8D44;&#x6E90;&#x7684;&#x5D29;&#x6E83;&#x3002;&#x8FD9;&#x65F6;&#xFF0C;&#x7EBF;&#x7A0B;&#x6C60;&#x5C31;&#x662F;&#x6700;&#x597D;&#x7684;&#x9009;&#x62E9;&#x4E86;</p>
<h3 id="&#x5982;&#x4F55;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x6C60;&#x90A3;"><a href="#&#x5982;&#x4F55;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x6C60;&#x90A3;" class="headerlink" title="&#x5982;&#x4F55;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x6C60;&#x90A3;?"></a>&#x5982;&#x4F55;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x6C60;&#x90A3;?</h3><p>Java&#x4E2D;&#x5DF2;&#x7ECF;&#x63D0;&#x4F9B;&#x4E86;&#x521B;&#x5EFA;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x4E00;&#x4E2A;&#x7C7B;&#xFF1A;Executor<br>&#x800C;&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x65F6;&#xFF0C;&#x4E00;&#x822C;&#x4F7F;&#x7528;&#x5B83;&#x7684;&#x5B50;&#x7C7B;&#xFF1A;ThreadPoolExecutor.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;package com.mianshi.test;</span><br><span class="line"></span><br><span class="line">import java.util.concurrent.ExecutorService;</span><br><span class="line">import java.util.concurrent.Executors;</span><br><span class="line"></span><br><span class="line">public class NewFixedThreadPoolTest {</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) {</span><br><span class="line">        // &#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x53EF;&#x91CD;&#x7528;&#x56FA;&#x5B9A;&#x4E2A;&#x6570;&#x7684;&#x7EBF;&#x7A0B;&#x6C60;</span><br><span class="line">        ExecutorService fixedThreadPool = Executors.newFixedThreadPool(3);//&#x521B;&#x5EFA;&#x7A7A;&#x95F2;&#x7684;&#x7EBF;&#x7A0B;</span><br><span class="line">        for (int i = 0; i &lt; 10; i++) {</span><br><span class="line">            fixedThreadPool.execute(new Runnable() {//&#x7A0B;&#x5E8F;&#x5C06;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#x4F20;&#x7ED9;&#x7EBF;&#x7A0B;&#x6C60;&#xFF0C;&#x7EBF;&#x7A0B;&#x6C60;&#x5C31;&#x4F1A;&#x542F;&#x52A8;&#x4E00;&#x6761;&#x7EBF;&#x7A0B;&#x6765;&#x6267;&#x884C;&#x8FD9;&#x4E2A;&#x4EFB;&#x52A1;&#xFF0C;&#x6267;&#x884C;&#x7ED3;&#x675F;&#x4EE5;&#x540E;&#xFF0C;&#x8BE5;&#x7EBF;&#x7A0B;&#x5E76;&#x4E0D;&#x4F1A;&#x6B7B;&#x4EA1;&#xFF0C;&#x800C;&#x662F;&#x518D;&#x6B21;&#x8FD4;&#x56DE;&#x7EBF;&#x7A0B;&#x6C60;&#x4E2D;&#x6210;&#x4E3A;&#x7A7A;&#x95F2;&#x72B6;&#x6001;&#xFF0C;&#x7B49;&#x5F85;&#x6267;&#x884C;&#x4E0B;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#x3002;</span><br><span class="line">                public void run() {</span><br><span class="line">                    try {</span><br><span class="line">                        // &#x6253;&#x5370;&#x6B63;&#x5728;&#x6267;&#x884C;&#x7684;&#x7F13;&#x5B58;&#x7EBF;&#x7A0B;&#x4FE1;&#x606F;</span><br><span class="line">                        System.out.println(Thread.currentThread().getName()</span><br><span class="line">                                + &quot;&#x6B63;&#x5728;&#x88AB;&#x6267;&#x884C;&quot;);</span><br><span class="line">                        Thread.sleep(2000);</span><br><span class="line">                    } catch (InterruptedException e) {</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            });</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">arduino&#x590D;&#x5236;&#x4EE3;&#x7801;pool-1-thread-1&#x6B63;&#x5728;&#x88AB;&#x6267;&#x884C;</span><br><span class="line">pool-1-thread-2&#x6B63;&#x5728;&#x88AB;&#x6267;&#x884C;</span><br><span class="line">pool-1-thread-3&#x6B63;&#x5728;&#x88AB;&#x6267;&#x884C;</span><br><span class="line">pool-1-thread-1&#x6B63;&#x5728;&#x88AB;&#x6267;&#x884C;</span><br><span class="line">pool-1-thread-2&#x6B63;&#x5728;&#x88AB;&#x6267;&#x884C;</span><br><span class="line">pool-1-thread-3&#x6B63;&#x5728;&#x88AB;&#x6267;&#x884C;</span><br><span class="line">pool-1-thread-1&#x6B63;&#x5728;&#x88AB;&#x6267;&#x884C;</span><br><span class="line">pool-1-thread-2&#x6B63;&#x5728;&#x88AB;&#x6267;&#x884C;</span><br><span class="line">pool-1-thread-3&#x6B63;&#x5728;&#x88AB;&#x6267;&#x884C;</span><br><span class="line">pool-1-thread-1&#x6B63;&#x5728;&#x88AB;&#x6267;&#x884C;</span><br><span class="line"></span><br><span class="line">&#x56E0;&#x4E3A;&#x7EBF;&#x7A0B;&#x6C60;&#x5927;&#x5C0F;&#x4E3A;3&#xFF0C;&#x6BCF;&#x4E2A;&#x4EFB;&#x52A1;&#x8F93;&#x51FA;&#x6253;&#x5370;&#x7ED3;&#x679C;&#x540E;sleep 2&#x79D2;&#xFF0C;&#x6240;&#x4EE5;&#x6BCF;&#x4E24;&#x79D2;&#x6253;&#x5370;3&#x4E2A;&#x7ED3;&#x679C;&#x3002;</span><br><span class="line">&#x5B9A;&#x957F;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x5927;&#x5C0F;&#x6700;&#x597D;&#x6839;&#x636E;&#x7CFB;&#x7EDF;&#x8D44;&#x6E90;&#x8FDB;&#x884C;&#x8BBE;&#x7F6E;&#x3002;&#x5982;Runtime.getRuntime().availableProcessors()</span><br></pre></td></tr></table></figure>

<p><strong>&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x4EFB;&#x52A1;</strong></p>
<ol>
<li>Runnable&#x5BF9;&#x8C61;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x6254;&#x7ED9;Thread&#x521B;&#x5EFA;&#x7EBF;&#x7A0B;&#x5B9E;&#x4F8B;&#xFF0C;&#x5E76;&#x4E14;&#x521B;&#x5EFA;&#x7684;&#x7EBF;&#x7A0B;&#x5B9E;&#x4F8B;&#x4E0E;Runnable&#x7ED1;&#x5B9A;&#xFF0C;&#x7EBF;&#x7A0B;&#x5B9E;&#x4F8B;&#x8C03;&#x7528;start()&#x65B9;&#x6CD5;&#x65F6;&#xFF0C;Runnable&#x4EFB;&#x52A1;&#x5C31;&#x5F00;&#x59CB;&#x771F;&#x6B63;&#x5728;&#x7EBF;&#x7A0B;&#x4E2D;&#x6267;&#x884C;&#x3002;&#x6CE8;&#x610F;&#xFF1A;&#x5982;&#x679C;&#x76F4;&#x63A5;&#x8C03;&#x7528;run()&#x65B9;&#x6CD5;&#x800C;&#x4E0D;&#x8C03;&#x7528;start()&#x65B9;&#x6CD5;&#xFF0C;&#x90A3;&#x4E48;&#x53EA;&#x662F;&#x76F8;&#x5F53;&#x4E8E;&#x666E;&#x901A;&#x7684;&#x65B9;&#x6CD5;&#x8C03;&#x7528;&#xFF0C;&#x5E76;&#x4E0D;&#x4F1A;&#x5F00;&#x542F;&#x65B0;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x7A0B;&#x5E8F;&#x53EA;&#x662F;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E2D;&#x4E32;&#x884C;&#x6267;&#x884C;&#x3002;</li>
<li>Runnable&#x5BF9;&#x8C61;&#x4E5F;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x6254;&#x7ED9;&#x7EBF;&#x7A0B;&#x6C60;&#x5BF9;&#x8C61;&#x7684;execute&#x65B9;&#x6CD5;&#x548C;submit&#x65B9;&#x6CD5;&#xFF0C;&#x8BA9;&#x7EBF;&#x7A0B;&#x6C60;&#x4E3A;&#x5176;&#x7ED1;&#x5B9A;&#x6C60;&#x4E2D;&#x7684;&#x7EBF;&#x7A0B;&#x6765;&#x6267;&#x884C;&#x3002;</li>
<li>Runnable&#x5BF9;&#x8C61;&#x4E5F;&#x53EF;&#x4EE5;&#x8FDB;&#x4E00;&#x6B65;&#x5C01;&#x88C5;&#x6210;FutureTask&#x5BF9;&#x8C61;&#x4E4B;&#x540E;&#x518D;&#x6254;&#x7ED9;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;execute&#x65B9;&#x6CD5;&#x548C;submit&#x65B9;&#x6CD5;&#x3002;</li>
<li>Callable&#xFF1A;&#x529F;&#x80FD;&#x76F8;&#x6BD4;Runnable&#x6765;&#x8BF4;&#x5C11;&#x5F88;&#x591A;&#xFF0C;&#x4E0D;&#x80FD;&#x7528;&#x6765;&#x521B;&#x5EFA;&#x7EBF;&#x7A0B;&#xFF0C;&#x4E5F;&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x6254;&#x7ED9;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;execute&#x65B9;&#x6CD5;&#x3002;&#x4F46;&#x662F;&#x5176;&#x4E2D;&#x7684;call&#x65B9;&#x6CD5;&#x6709;&#x8FD4;&#x56DE;&#x503C;&#x3002;</li>
<li>FutureTask&#xFF1A;&#x662F;&#x5BF9;Runnable&#x548C;Callable&#x7684;&#x8FDB;&#x4E00;&#x6B65;&#x5C01;&#x88C5;&#xFF0C;&#x5E76;&#x4E14;&#x8FD9;&#x79CD;&#x4EFB;&#x52A1;&#x662F;&#x6709;&#x8FD4;&#x56DE;&#x503C;&#x7684;&#xFF0C;&#x5B83;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x5B58;&#x5728;FutureTask&#x7C7B;&#x7684;&#x4E00;&#x4E2A;&#x540D;&#x53EB;outcome&#x7684;&#x6570;&#x636E;&#x6210;&#x5458;&#x4E2D;&#x3002;&#xFF08;&#x7591;&#x60D1;&#xFF09;&#x90A3;&#x4E48;&#x4E3A;&#x4EC0;&#x4E48;&#x53EF;&#x4EE5;&#x628A;&#x6CA1;&#x6709;&#x8FD4;&#x56DE;&#x503C;&#x7684;Runnable&#x4E5F;&#x5C01;&#x88C5;&#x6210;FutureTask&#x5462;&#xFF0C;&#x9A6C;&#x4E0A;&#x6211;&#x4EEC;&#x4F1A;&#x8BA8;&#x8BBA;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;&#x76F8;&#x6BD4;&#x76F4;&#x63A5;&#x628A;Runnable&#x548C;Callable&#x6254;&#x7ED9;&#x7EBF;&#x7A0B;&#x6C60;&#xFF0C;FutureTask&#x7684;&#x529F;&#x80FD;&#x66F4;&#x591A;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x76D1;&#x89C6;&#x4EFB;&#x52A1;&#x5728;&#x6C60;&#x5B50;&#x4E2D;&#x7684;&#x72B6;&#x6001;&#x3002;&#x7528;Runnable&#x548C;Callable&#x521B;&#x5EFA;FutureTask&#x7684;&#x65B9;&#x6CD5;&#x7A0D;&#x6709;&#x4E0D;&#x540C;&#x3002;</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">csharp&#x590D;&#x5236;&#x4EE3;&#x7801;class NewFixedThreadPoolTest {</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws ExecutionException, InterruptedException {</span><br><span class="line">        // &#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x53EF;&#x91CD;&#x7528;&#x56FA;&#x5B9A;&#x4E2A;&#x6570;&#x7684;&#x7EBF;&#x7A0B;&#x6C60;</span><br><span class="line">        ExecutorService fixedThreadPool = Executors.newFixedThreadPool(3);//&#x521B;&#x5EFA;&#x7A7A;&#x95F2;&#x7684;&#x7EBF;&#x7A0B;</span><br><span class="line">        ArrayList&lt;FutureTask&lt;String&gt;&gt; list=new ArrayList&lt;&gt;();</span><br><span class="line">        for (int i = 0; i &lt; 10; i++) {</span><br><span class="line">            FutureTask&lt;String&gt; ft=new FutureTask&lt;String&gt;(new Callable&lt;String&gt;() {</span><br><span class="line">                @Override</span><br><span class="line">                public String call() throws Exception {</span><br><span class="line">                    System.out.println(Thread.currentThread().getName());</span><br><span class="line">                    return &quot;&#x56DE;&#x6389;&#x7ED3;&#x679C;&quot;;</span><br><span class="line">                }</span><br><span class="line">            });</span><br><span class="line">            list.add(ft);</span><br><span class="line">            fixedThreadPool.execute(ft);</span><br><span class="line">        }</span><br><span class="line">        fixedThreadPool.shutdown();//&#x4E0D;&#x5173;&#x95ED;&#x7EBF;&#x7A0B;&#x6C60;&#xFF0C;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E5F;&#x4E0D;&#x4F1A;&#x5173;&#x95ED;</span><br><span class="line">        for (FutureTask&lt;String&gt; ft:list</span><br><span class="line">             ) {</span><br><span class="line">            System.out.println(ft.get());</span><br><span class="line">        }</span><br><span class="line">        if(list.get(0).get().equals(&quot;&#x56DE;&#x6389;&#x7ED3;&#x679C;&quot;)){</span><br><span class="line">            System.out.println(&quot;&#x5F00;&#x59CB;&#x8FDB;&#x653B;&quot;);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8FD0;&#x884C;&#x7ED3;&#x679C;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">arduino&#x590D;&#x5236;&#x4EE3;&#x7801;pool-1-thread-2</span><br><span class="line">pool-1-thread-1</span><br><span class="line">pool-1-thread-3</span><br><span class="line">pool-1-thread-2</span><br><span class="line">pool-1-thread-1</span><br><span class="line">pool-1-thread-1</span><br><span class="line">pool-1-thread-1</span><br><span class="line">pool-1-thread-3</span><br><span class="line">&#x56DE;&#x6389;&#x7ED3;&#x679C;</span><br><span class="line">&#x56DE;&#x6389;&#x7ED3;&#x679C;</span><br><span class="line">pool-1-thread-2</span><br><span class="line">&#x56DE;&#x6389;&#x7ED3;&#x679C;</span><br><span class="line">&#x56DE;&#x6389;&#x7ED3;&#x679C;</span><br><span class="line">&#x56DE;&#x6389;&#x7ED3;&#x679C;</span><br><span class="line">&#x56DE;&#x6389;&#x7ED3;&#x679C;</span><br><span class="line">&#x56DE;&#x6389;&#x7ED3;&#x679C;</span><br><span class="line">&#x56DE;&#x6389;&#x7ED3;&#x679C;</span><br><span class="line">&#x56DE;&#x6389;&#x7ED3;&#x679C;</span><br><span class="line">pool-1-thread-1</span><br><span class="line">&#x56DE;&#x6389;&#x7ED3;&#x679C;</span><br><span class="line">&#x5F00;&#x59CB;&#x8FDB;&#x653B;</span><br></pre></td></tr></table></figure>

<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/f1501208a75e1ff52d58f929511a0f92.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7033030218340270111.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7033030218340270111.html" itemprop="url">随机数实现扑克牌洗牌   Java随笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-11-21T22:30:14+08:00">
                2021-11-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x300C;&#x8FD9;&#x662F;&#x6211;&#x53C2;&#x4E0E;11&#x6708;&#x66F4;&#x6587;&#x6311;&#x6218;&#x7684;&#x7B2C;19&#x5929;&#xFF0C;&#x6D3B;&#x52A8;&#x8BE6;&#x60C5;&#x67E5;&#x770B;&#xFF1A;<a href="https://dev.newban.cn/7023643374569816095/">2021&#x6700;&#x540E;&#x4E00;&#x6B21;&#x66F4;&#x6587;&#x6311;&#x6218;</a>&#x300D;</p>
<hr>
<h2 id="&#x76F8;&#x5173;&#x6587;&#x7AE0;"><a href="#&#x76F8;&#x5173;&#x6587;&#x7AE0;" class="headerlink" title="&#x76F8;&#x5173;&#x6587;&#x7AE0;"></a>&#x76F8;&#x5173;&#x6587;&#x7AE0;</h2><p>Java&#x968F;&#x7B14;&#x8BB0;&#xFF1A;<a href="/external_links/0b76579092aa6e650870f04d54b3bf5a.html" target="blank" rel="noopener">Java&#x968F;&#x7B14;&#x8BB0;</a></p>
<hr>
<ul>
<li>&#x6700;&#x8FD1;&#x5237;leetCood&#x6709;&#x70B9;&#x7740;&#x9B54;&#x4E86;&#xFF0C;&#x7A81;&#x7136;&#x60F3;&#x5199;&#x4E00;&#x4E2A;&#x6251;&#x514B;&#x724C;&#x6D17;&#x724C;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#x3002;</li>
</ul>
<ul>
<li>&#x5927;&#x8111;&#x4E2D;&#x7B2C;&#x4E00;&#x5370;&#x8C61;&#x5C31;&#x662F;&#x7528;<strong>&#x968F;&#x673A;&#x6570;</strong>&#x6765;&#x5B9E;&#x73B0;&#xFF1A;</li>
</ul>
<pre><code>+ &#x968F;&#x673A;&#x6570;&#x8303;&#x56F4;&#x4E3A;&#xFF11;&#xFF0D;&#xFF15;&#xFF14;
+ &#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;&#x96C6;&#x5408;&#x6765;&#x5B58;&#x653E;&#x968F;&#x673A;&#x751F;&#x6210;&#x7684;&#x6570;
+ &#x65B0;&#x968F;&#x673A;&#x51FA;&#x6765;&#x7684;&#x6570;&#x5982;&#x679C;&#x8BE5;&#x96C6;&#x5408;&#x6709;&#xFF0C;&#x5219;&#x4E22;&#x5F03;&#xFF0C;&#x53CD;&#x4E4B;&#x5219;&#x52A0;&#x8FDB;&#x53BB;&#x3002;</code></pre><ul>
<li>&#x5148;&#x770B;&#x4E0B;&#x4EE3;&#x7801;&#xFF1A;</li>
</ul>
<pre><code>+ <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">csharp&#x590D;&#x5236;&#x4EE3;&#x7801;//&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#x4E00;  &#x4F7F;&#x7528;&#x968F;&#x673A;&#x6570; &#x968F;&#x673A;&#x751F;&#x6210;54&#x4E2A;&#x5728;1-54&#x8303;&#x56F4;&#x5185;&#x7684;&#x6570;&#x5B57;&#xFF0C;&#x5F53;&#x8FD9;&#x4E9B;&#x6570;&#x5B57;&#x4E0D;&#x91CD;&#x590D;&#x65F6;&#xFF0C;&#x5B8C;&#x6210;&#x6D17;&#x724C;</span><br><span class="line"> &#xA0; &#xA0;public static void ShuffleTheDeck() {</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0;System.out.println(&quot;&#x5F00;&#x59CB;&#x65F6;&#x95F4;&#xFF1A;&quot; + new Date());</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0;List reslutList = new ArrayList();</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0;//&#x5F00;&#x59CB;&#x968F;&#x673A;&#x6D17;&#x724C;</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0;Random random = new Random();</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0;while (true) {</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;int endRand = random.nextInt(54);</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;reslutList.add(endRand+1);</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;if (ifRepeat(reslutList) == false) {</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;reslutList.remove(reslutList.size() - 1);</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;  }</span><br><span class="line">&#x200B;</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;if (reslutList.size() &gt;= 54) {</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;break;</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;  }</span><br><span class="line"> &#xA0; &#xA0; &#xA0;  }</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0;System.out.println(&quot;&#x7ED3;&#x675F;&#x65F6;&#x95F4;&#xFF1A;&quot; + new Date());</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0;for (int j = 0; j &lt; reslutList.size(); j++) {</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;System.out.println(reslutList.get(j).toString());</span><br><span class="line"> &#xA0; &#xA0; &#xA0;  }</span><br><span class="line"> &#xA0;  }</span><br><span class="line">&#x200B;</span><br><span class="line"> &#xA0; &#xA0;//&#x8BE5;&#x65B9;&#x6CD5;&#x662F;&#x5224;&#x65AD;&#x96C6;&#x5408;&#x4E2D;&#x662F;&#x5426;&#x6709;&#x91CD;&#x590D;&#x5143;&#x7D20;&#x7684;,&#x5982;&#x679C;&#x6709;&#x8FD4;&#x56DE;false,&#x53CD;&#x4E4B;&#x8FD4;&#x56DE;true</span><br><span class="line"> &#xA0; &#xA0;public static boolean ifRepeat(List list) {</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0;HashSet set = new HashSet&lt;&gt;(list);</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0;Boolean bool = set.size() == list.size() ? true : false;</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0;return bool;</span><br><span class="line"> &#xA0;  }</span><br></pre></td></tr></table></figure>

+ &#x6267;&#x884C;&#x7ED3;&#x679C;&#xFF1A;
+ ![image-20211121221302561.png](https://gitee.com/songjianzaina/juejin_p6/raw/master/img/e20b1510f7206dc8ce77b450e03266bc14bf6bdcded70b9659a21dd226b2a18b)
+ &#x52C9;&#x5F3A;&#x7B97;&#x662F;&#x53EF;&#x4EE5;&#x5427;&#xFF1F;</code></pre><ul>
<li>&#x4F46;&#x662F;&#xFF0C;&#x6211;&#x4EEC;&#x5B9E;&#x9645;&#x7684;&#x6251;&#x514B;&#x724C;&#x662F;&#x5565;&#xFF1F;</li>
</ul>
<pre><code>+ 1-10 J Q K &#x5927;&#x738B; &#x5C0F;&#x738B;
+ &#x4E00;&#x5171;15&#x79CD;
+ &#x9664;&#x5927;&#x5C0F;&#x738B;&#x5355;&#x4E2A;&#x4EE5;&#x5916;&#xFF0C;&#x5176;&#x4ED6;&#x7684;&#x90FD;&#x662F;&#x56DB;&#x4E2A;&#xFF0C;&#x5E76;&#x4E14;&#x5206;&#x522B;&#x662F;&#xFF0C;&#x7EA2;&#x6843;&#x3001;&#x9ED1;&#x6843;&#x3001;&#x65B9;&#x5757;&#x3001;&#x6885;&#x82B1;&#x3002;
+ &#x5982;&#x4F55;&#x4F18;&#x5316;&#x5462;&#xFF1F;</code></pre><ul>
<li><p>&#x8FD9;&#x91CC;&#x5148;&#x52A0;&#x4E2A;&#x5B9E;&#x4F53;&#x7C7B;&#x6765;&#x5B58;&#x50A8;&#x6BCF;&#x6B21;&#x751F;&#x6210;&#x7684;&#x6251;&#x514B;&#x724C;&#x5427;&#x3002;</p>
</li>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">typescript&#x590D;&#x5236;&#x4EE3;&#x7801;class poker</span><br><span class="line">{</span><br><span class="line"> &#xA0; &#xA0;public poker(String color, String num)</span><br><span class="line"> &#xA0;  {</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0;super();</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0;this.color = color;</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0;this.num = num;</span><br><span class="line"> &#xA0;  }</span><br><span class="line"> &#xA0; &#xA0;String color;</span><br><span class="line"> &#xA0; &#xA0;String num;</span><br><span class="line">&#x200B;</span><br><span class="line"> &#xA0; &#xA0;public String toString()</span><br><span class="line"> &#xA0;  {</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0;return color+num;</span><br><span class="line"> &#xA0;  }</span><br><span class="line">&#x200B;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
</li>
<li><p>&#x5148;&#x5199;&#x751F;&#x6210;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x6D17;&#x724C;&#x3002;</p>
</li>
<li><p>&#x533A;&#x522B;&#x5C31;&#x662F;&#x5B9A;&#x4E49;&#x597D;&#x82B1;&#x8272;&#x548C;&#x724C;&#x9762;&#x3002;</p>
</li>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;public static void buildPoker(){</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0;//&#x751F;&#x6210;52&#x5F20;&#x6251;&#x514B;&#x724C;</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0;String[] colors = {&quot;&#x9ED1;&#x6843;&quot;,&quot;&#x65B9;&#x5757;&quot;,&quot;&#x6885;&#x82B1;&quot;,&quot;&#x7EA2;&#x6843;&quot;};</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0;String[] nums = {&quot;A&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;,&quot;5&quot;,&quot;6&quot;,&quot;7&quot;,&quot;8&quot;,&quot;9&quot;,&quot;10&quot;,&quot;J&quot;,&quot;Q&quot;,&quot;K&quot;};</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0;LinkedList pokers = new LinkedList();</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0;for(int i=0;i &lt; colors.length;i++)</span><br><span class="line"> &#xA0; &#xA0; &#xA0;  {</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;for(int j=0;j&lt;nums.length;j++)</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;  {</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;pokers.add(new poker(colors[i],nums[j]));</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;  }</span><br><span class="line"> &#xA0; &#xA0; &#xA0;  }</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0;pokers.add(new poker(&quot;&#x5C0F;&#x738B;&quot;,&quot;&#x9ED1;&quot;));</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0;pokers.add(new poker(&quot;&#x5927;&#x738B;&quot;,&quot;&#x7EA2;&quot;));</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
</li>
<li><p><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/bb375339eb7620b910b6fe280e7b211bc85bc7cb74a5528aa3fe45362a5e8446" alt="image-20211121222236466.png"></p>
</li>
<li><p>&#x5230;&#x8FD9;&#x91CC;&#x6574;&#x5E45;&#x6251;&#x514B;&#x724C;&#x5DF2;&#x7ECF;&#x751F;&#x6210;&#x597D;&#x4E86;&#xFF0C;&#x4E0B;&#x9762;&#x5C31;&#x662F;&#x5982;&#x4F55;&#x5C06;&#x5176;&#x968F;&#x673A;&#x6253;&#x4E71;&#x3002;</p>
</li>
<li><p>&#x6D17;&#x724C;&#xFF1A;&#x8FD8;&#x662F;&#x4F7F;&#x7528;&#x968F;&#x673A;&#x6570;&#x6765;&#x63A7;&#x5236;&#xFF01;</p>
</li>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;public static void buildPoker(){</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0;//&#x751F;&#x6210;52&#x5F20;&#x6251;&#x514B;&#x724C;</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0;String[] colors = {&quot;&#x9ED1;&#x6843;&quot;,&quot;&#x65B9;&#x5757;&quot;,&quot;&#x6885;&#x82B1;&quot;,&quot;&#x7EA2;&#x6843;&quot;};</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0;String[] nums = {&quot;A&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;,&quot;5&quot;,&quot;6&quot;,&quot;7&quot;,&quot;8&quot;,&quot;9&quot;,&quot;10&quot;,&quot;J&quot;,&quot;Q&quot;,&quot;K&quot;};</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0;LinkedList pokers = new LinkedList();</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0;for(int i=0;i &lt; colors.length;i++)</span><br><span class="line"> &#xA0; &#xA0; &#xA0;  {</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;for(int j=0;j&lt;nums.length;j++)</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;  {</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;pokers.add(new poker(colors[i],nums[j]));</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;  }</span><br><span class="line"> &#xA0; &#xA0; &#xA0;  }</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0;pokers.add(new poker(&quot;&#x5C0F;&#x738B;&quot;,&quot;&#x9ED1;&quot;));</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0;pokers.add(new poker(&quot;&#x5927;&#x738B;&quot;,&quot;&#x7EA2;&quot;));</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0;//&#x6D17;&#x724C;</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0;LinkedList shuffledpokers = new LinkedList();</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0;while(shuffledpokers.size()&lt;pokers.size())</span><br><span class="line"> &#xA0; &#xA0; &#xA0;  {</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;Random x = new Random();</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;poker poke = (poker) pokers.get(x.nextInt(pokers.size()));</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;if(!shuffledpokers.contains(poke))</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;  {</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;shuffledpokers.add(poke);</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;  }</span><br><span class="line"> &#xA0; &#xA0; &#xA0;  }</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0;System.out.println(&quot;&#x6D17;&#x724C;&#x524D;&#xFF1A;&quot;+pokers);</span><br><span class="line"> &#xA0; &#xA0; &#xA0; &#xA0;System.out.println(&quot;&#x6D17;&#x724C;&#x540E;&#xFF1A;&quot;+shuffledpokers);</span><br><span class="line"> &#xA0;  }</span><br></pre></td></tr></table></figure>
</li>
<li><p>&#x6267;&#x884C;&#x7ED3;&#x679C;&#xFF1A;</p>
</li>
<li><p><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/9611d554a46990c02bd868328994d902160724528b3ed1e12b022aa5a24dd24c" alt="image-20211121222418961.png"></p>
</li>
</ul>
<ul>
<li>&#x53EF;&#x4EE5;&#x505A;&#x5230;&#x6D17;&#x724C;&#x5566;&#xFF01;</li>
<li>&#x4E2A;&#x4EBA;&#x6240;&#x60F3;&#xFF0C;&#x867D;&#x7136;&#x5F88;&#x635E;&#xFF0C;&#x4F46;&#x662F;&#x4E5F;&#x7B97;&#x4E2A;&#x601D;&#x8DEF;&#x5427;&#x3002;</li>
<li>&#x5982;&#x6709;&#x4E0D;&#x5BF9;&#xFF0C;&#x656C;&#x8BF7;&#x6307;&#x51FA;&#x3002;</li>
</ul>
<hr>
<p><strong><em>&#x8DEF;&#x6F2B;&#x6F2B;&#x5176;&#x4FEE;&#x8FDC;&#x516E;&#xFF0C;&#x543E;&#x5FC5;&#x5C06;&#x4E0A;&#x4E0B;&#x6C42;&#x7D22;~</em></strong></p>
<p>&#x5982;&#x679C;&#x4F60;&#x8BA4;&#x4E3A;i&#x535A;&#x4E3B;&#x5199;&#x7684;&#x4E0D;&#x9519;&#xFF01;&#x5199;&#x4F5C;&#x4E0D;&#x6613;&#xFF0C;&#x8BF7;&#x70B9;&#x8D5E;&#x3001;&#x5173;&#x6CE8;&#x3001;&#x8BC4;&#x8BBA;&#x7ED9;&#x535A;&#x4E3B;&#x4E00;&#x4E2A;&#x9F13;&#x52B1;&#x5427;~hahah</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/28ec35916e4702ac00a344fec735d63d.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7033023695950086175.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7033023695950086175.html" itemprop="url">Hystrix 源码解读</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-11-21T22:07:18+08:00">
                2021-11-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="&#x5165;&#x53E3;"><a href="#&#x5165;&#x53E3;" class="headerlink" title="&#x5165;&#x53E3;"></a>&#x5165;&#x53E3;</h2><p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/81e23e1a655028c78b2377df67d6cf8cd73450d898d3da7891983c36666c6060" alt="image.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">css&#x590D;&#x5236;&#x4EE3;&#x7801;@EnableCircuitBreaker &#x8FD9;&#x6CE8;&#x89E3;&#x4E5F;&#x80FD;&#x5F00;&#x542F;Hystrix&#x7684;&#x76F8;&#x5173;&#x529F;&#x80FD;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/a1ba75c1730450c26a25394d66c6e6d78e41ee158aba734ccc495cab0d8cb465" alt="image.png"></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/ad22edc40cc2bc0b12507dda73c1a7193b6a996f1a79f627929559e38cc8acef" alt="image.png"><br>&#x5176;&#x4E2D;&#x8BFB;&#x53D6;spring.factories&#x54EA;&#x4E2A;&#x6587;&#x4EF6;&#x7684;&#x5165;&#x53E3;&#x5728;&#x6B64;<br><code>org.springframework.cloud.commons.util.SpringFactoryImportSelector#selectImports</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">typescript&#x590D;&#x5236;&#x4EE3;&#x7801;public String[] selectImports(AnnotationMetadata metadata) {</span><br><span class="line">   if (!isEnabled()) {</span><br><span class="line">      return new String[0];</span><br><span class="line">   }</span><br><span class="line">   AnnotationAttributes attributes = AnnotationAttributes.fromMap(</span><br><span class="line">         metadata.getAnnotationAttributes(this.annotationClass.getName(), true));</span><br><span class="line"></span><br><span class="line">   Assert.notNull(attributes, &quot;No &quot; + getSimpleName() + &quot; attributes found. Is &quot;</span><br><span class="line">         + metadata.getClassName() + &quot; annotated with @&quot; + getSimpleName() + &quot;?&quot;);</span><br><span class="line"></span><br><span class="line">   // &#x56E0;&#x4E3A;&#x662F;EnableCircuitBreaker&#x8FD9;&#x4E2A;&#x6CE8;&#x89E3;&#x8BFB;&#x53D6;&#x7684;&#x662F;META-INF/spring.factories &#x4E2D;org.springframework.cloud.netflix.hystrix.HystrixCircuitBreakerConfiguration  &#x8FD9;&#x4E2A;&#x914D;&#x7F6E;</span><br><span class="line">   List&lt;String&gt; factories = new ArrayList&lt;&gt;(new LinkedHashSet&lt;&gt;(SpringFactoriesLoader</span><br><span class="line">         .loadFactoryNames(this.annotationClass, this.beanClassLoader)));</span><br><span class="line"></span><br><span class="line">   if (factories.isEmpty() &amp;&amp; !hasDefaultFactory()) {</span><br><span class="line">      throw new IllegalStateException(&quot;Annotation @&quot; + getSimpleName()</span><br><span class="line">            + &quot; found, but there are no implementations. Did you forget to include a starter?&quot;);</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   if (factories.size() &gt; 1) {</span><br><span class="line">      // there should only ever be one DiscoveryClient, but there might be more than</span><br><span class="line">      // one factory</span><br><span class="line">      log.warn(&quot;More than one implementation &quot; + &quot;of @&quot; + getSimpleName()</span><br><span class="line">            + &quot; (now relying on @Conditionals to pick one): &quot; + factories);</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   return factories.toArray(new String[factories.size()]);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/475590dcfab123b4be69df5dfed4fb6c9c9d414f3cc2afe333276427406e4ddf" alt="image.png"><br>&#x73B0;&#x5728;&#x77E5;&#x9053;&#x5BF9;&#x5E94;&#x914D;&#x7F6E;&#x662F;&#x600E;&#x4E48;&#x81EA;&#x52A8;&#x8BFB;&#x53D6;&#x7684;&#x5427;!</p>
<h2 id="&#x76F8;&#x5173;&#x6E90;&#x7801;&#x5206;&#x6790;"><a href="#&#x76F8;&#x5173;&#x6E90;&#x7801;&#x5206;&#x6790;" class="headerlink" title="&#x76F8;&#x5173;&#x6E90;&#x7801;&#x5206;&#x6790;"></a>&#x76F8;&#x5173;&#x6E90;&#x7801;&#x5206;&#x6790;</h2><p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/4d05097d3da4b691cd8b854598aceae480b03306768a17ea37feae4d15506b39" alt="image.png"></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/e203ef51ec135fab40fc3eb21d5c8c61cf193a9f55431e95b552a870d39e27ae" alt="image.png"><br><code>&#x6838;&#x5FC3;&#x903B;&#x8F91;com.netflix.hystrix.contrib.javanica.aop.aspectj.HystrixCommandAspect#methodsAnnotatedWithHystrixCommand</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;@Around(&quot;hystrixCommandAnnotationPointcut() || hystrixCollapserAnnotationPointcut()&quot;)</span><br><span class="line">public Object methodsAnnotatedWithHystrixCommand(final ProceedingJoinPoint joinPoint) throws Throwable {</span><br><span class="line">    Method method = getMethodFromTarget(joinPoint);</span><br><span class="line">    Validate.notNull(method, &quot;failed to get method from joinPoint: %s&quot;, joinPoint);</span><br><span class="line">    if (method.isAnnotationPresent(HystrixCommand.class) &amp;&amp; method.isAnnotationPresent(HystrixCollapser.class)) {</span><br><span class="line">        throw new IllegalStateException(&quot;method cannot be annotated with HystrixCommand and HystrixCollapser &quot; +</span><br><span class="line">                &quot;annotations at the same time&quot;);</span><br><span class="line">    }</span><br><span class="line">    MetaHolderFactory metaHolderFactory = META_HOLDER_FACTORY_MAP.get(HystrixPointcutType.of(method));</span><br><span class="line">    MetaHolder metaHolder = metaHolderFactory.create(joinPoint);</span><br><span class="line">    HystrixInvokable invokable = HystrixCommandFactory.getInstance().create(metaHolder);</span><br><span class="line">    ExecutionType executionType = metaHolder.isCollapserAnnotationPresent() ?</span><br><span class="line">            metaHolder.getCollapserExecutionType() : metaHolder.getExecutionType();</span><br><span class="line"></span><br><span class="line">    Object result;</span><br><span class="line">    try {</span><br><span class="line">        if (!metaHolder.isObservable()) {</span><br><span class="line">            result = CommandExecutor.execute(invokable, executionType, metaHolder);</span><br><span class="line">        } else {</span><br><span class="line">            result = executeObservable(invokable, executionType, metaHolder);</span><br><span class="line">        }</span><br><span class="line">    } catch (HystrixBadRequestException e) {</span><br><span class="line">        throw e.getCause() != null ? e.getCause() : e;</span><br><span class="line">    } catch (HystrixRuntimeException e) {</span><br><span class="line">        throw hystrixRuntimeExceptionToThrowable(metaHolder, e);</span><br><span class="line">    }</span><br><span class="line">    return result;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="&#x5C01;&#x88C5;"><a href="#&#x5C01;&#x88C5;" class="headerlink" title="&#x5C01;&#x88C5;"></a>&#x5C01;&#x88C5;</h3><p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/9a6c5619825d3cff24b6518007627efd95a9090cbff295e433bfa7c1e3133f98" alt="image.png"></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/806c25a2788cd3a600ee707c6154857ec0ea7086ed84b62d66345694757c31ed" alt="image.png"></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/7f80b461fd53cab4ebe47acdc1cbdb445bb19a94da01c9ea51f68c9cbe478d71" alt="image.png"><br>&#x9ED8;&#x8BA4;&#x4E3A;<br>SYNCHRONOUS<br><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/3d451d3ddd98da675104dde2c0c32f94fb3cf7f752bcde999927835a98918ff8" alt="image.png"></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/df5908b1404b70740cc44d4b39afa1fa7821d59bed6426ff2290a1fda08ecc06" alt="image.png"></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/66bd0315a3a4fb27071c8ef60e87776f4672286bfcd20b633047136d8b0de875" alt="image.png"><br>&#x4E0B;&#x9762;&#x662F;Rxjava&#x7684;&#x76F8;&#x5173;&#x7F16;&#x7A0B;,&#x4E2A;&#x4EBA;&#x4E0D;&#x662F;&#x5F88;&#x719F;</p>
<h3 id="&#x6267;&#x884C;&#x6210;&#x529F;&#x7684;&#x903B;&#x8F91;"><a href="#&#x6267;&#x884C;&#x6210;&#x529F;&#x7684;&#x903B;&#x8F91;" class="headerlink" title="&#x6267;&#x884C;&#x6210;&#x529F;&#x7684;&#x903B;&#x8F91;"></a>&#x6267;&#x884C;&#x6210;&#x529F;&#x7684;&#x903B;&#x8F91;</h3><p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/74f120e94e35006588b8231c64de0993182eca0d4dfaf2773e4a4d539f44c121" alt="image.png"></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/c5f3a1063c13503a798c833eb2e08a3800f9641caf48f291ebf10ce3be0f1677" alt="image.png"></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/f2b67bd3d91e785a100046b4311d39ccc0320401eb9d8b6d9f97813427ebc375" alt="image.png"></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/9037291c6702b846fb3d31bef51c088c367c6a96ccbc44ca541b8e4e1318ab76" alt="image.png"></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/7fff748abadc8f851703cd4864fdde6d76049ddd1f860055029f8e69a813357b" alt="image.png"></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/ed3ca2d3186c79f6d1befce3e6c5c67dc3621c5057fc8ee5fa10e3ea423fb693" alt="image.png"></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/323ffcb7f73622012257e9fc22eb725277da7b75fa88910d9a97333344b237ab" alt="image.png"></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/56c5bc9d758dc3040ea912f08079c2eaa6be21d6a5b8f701318e2385f87b62c1" alt="image.png"></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/b0a4b1589151a315e7ba9450fbffb311ef648e7d9347021476fc56b017914a31" alt="image.png"></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/928d522ace4ba911a1a9dd4e08a8eec0cb41ceaa93f06b1e0895e84c1273339e" alt="image.png"><br>&#x8FD9;&#x91CC;&#x5C31;&#x662F;&#x8C03;&#x7528;&#x7684;&#x903B;&#x8F91;,&#x7531;&#x4E8E;&#x662F;&#x4F7F;&#x7528;reactor&#x6A21;&#x5F0F;&#x7684;&#x8C03;&#x7528;,&#x6211;&#x4E5F;&#x505A;&#x4E0D;&#x4E86;&#x8BE6;&#x7EC6;&#x7684;&#x89E3;&#x91CA;,&#x60ED;&#x6127;&#x554A;!</p>
<h2 id="&#x63A8;&#x8350;&#x76F8;&#x5173;&#x7684;&#x6E90;&#x7801;&#x89E3;&#x91CA;-www-iocoder-cn-categories-&#x2026;"><a href="#&#x63A8;&#x8350;&#x76F8;&#x5173;&#x7684;&#x6E90;&#x7801;&#x89E3;&#x91CA;-www-iocoder-cn-categories-&#x2026;" class="headerlink" title="&#x63A8;&#x8350;&#x76F8;&#x5173;&#x7684;&#x6E90;&#x7801;&#x89E3;&#x91CA;:www.iocoder.cn/categories/&#x2026;"></a>&#x63A8;&#x8350;&#x76F8;&#x5173;&#x7684;&#x6E90;&#x7801;&#x89E3;&#x91CA;:<a href="/external_links/c35400900ecab4f134844bf5fc5a2bc0.html" target="blank" rel="noopener">www.iocoder.cn/categories/&#x2026;</a></h2><p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/7e54dbcc9ef19ee124050dca2110d492.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7033016689923096584.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7033016689923096584.html" itemprop="url">Spring之AOP源码分析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-11-21T21:38:42+08:00">
                2021-11-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Spring-AOP"><a href="#Spring-AOP" class="headerlink" title="Spring AOP"></a>Spring AOP</h3><ul>
<li><strong>&#x5B83;&#x57FA;&#x4E8E;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x6765;&#x5B9E;&#x73B0;&#x3002;</strong> &#x5982;&#x679C;&#x4F7F;&#x7528;&#x63A5;&#x53E3;&#xFF0C;&#x7528;JDK&#x63D0;&#x4F9B;&#x7ED9;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x6765;&#x5B9E;&#x73B0;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x63A5;&#x53E3;&#xFF0C;&#x4F7F;&#x7528;CGLIB&#x5B9E;&#x73B0;&#x3002;</li>
<li><strong>Spring 3.2&#x4EE5;&#x540E;&#xFF0C;spring-core&#x76F4;&#x63A5;&#x628A;CGLIB&#x548C;ASM&#x7684;&#x6E90;&#x7801;&#x5305;&#x62EC;&#x8FDB;&#x6765;&#x3002;</strong></li>
<li>Spring AOP&#x9700;&#x8981;&#x4F9D;&#x8D56;&#x4E8E;IOC&#x5BB9;&#x5668;&#x6765;&#x7BA1;&#x7406;&#x3002;</li>
<li><strong>Spring&#x63D0;&#x4F9B;&#x4E86;AspectJ&#x7684;&#x652F;&#x6301;&#xFF0C;&#x4F46;&#x53EA;&#x7528;&#x5230;&#x4E86;&#x5207;&#x70B9;&#x89E3;&#x6790;&#x548C;&#x5339;&#x914D;&#x3002;</strong></li>
</ul>
<h3 id="&#x6E90;&#x7801;"><a href="#&#x6E90;&#x7801;" class="headerlink" title="&#x6E90;&#x7801;"></a>&#x6E90;&#x7801;</h3><h4 id="&#x5F00;&#x542F;aop&#x5207;&#x9762;"><a href="#&#x5F00;&#x542F;aop&#x5207;&#x9762;" class="headerlink" title="&#x5F00;&#x542F;aop&#x5207;&#x9762;"></a>&#x5F00;&#x542F;aop&#x5207;&#x9762;</h4><p>spring&#x901A;&#x8FC7;@EnableAspectJAutoProxy&#x5F00;&#x542F;aop&#x5207;&#x9762;&#xFF0C;&#x5728;&#x6CE8;&#x89E3;&#x7C7B;&#x4E0A;&#x9762;&#x53D1;&#x73B0;@Import(AspectJAutoProxyRegistrar.class)&#xFF0C;AspectJAutoProxyRegistrar&#x5B9E;&#x73B0;&#x4E86;ImportBeanDefinitionRegistrar&#xFF0C;&#x6240;&#x4EE5;&#x4ED6;&#x4F1A;&#x901A;&#x8FC7;registerBeanDefinitions&#x65B9;&#x6CD5;&#x4E3A;&#x6211;&#x4EEC;&#x5BB9;&#x5668;&#x5BFC;&#x5165;beanDefinition&#x3002;<br><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/7e988335309348519ad3923f7414d59e70a71a05f540d87819e251ed5a4ff185" alt="image.png">  </p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/6ebef66e4814fdc6e57384b0e138cf009caec7becf46ac1d03485cb7647377fd" alt="image.png">  </p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/1b93cbc615e23564bc44c79ee376a91b0b2191b29a277546f18e4354224be9cf" alt="image.png"></p>
<h4 id="&#x89E3;&#x6790;&#x5207;&#x9762;"><a href="#&#x89E3;&#x6790;&#x5207;&#x9762;" class="headerlink" title="&#x89E3;&#x6790;&#x5207;&#x9762;"></a>&#x89E3;&#x6790;&#x5207;&#x9762;</h4><p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/25e4338f48208c2e49d93459a1fa71a340d072e50534410fbf9159d1bfe12e6e" alt="image.png"><br><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/748392b86c4feeec189070dd55824a39fd98f85d2bac6321236d3a90af77d673" alt="image.png">  </p>
<p>&#x7B2C;&#x4E00;&#x6B21;&#x8C03;&#x7528;bean&#x7684;&#x540E;&#x7F6E;&#x5904;&#x7406;&#x5668;&#x56DE;&#x53BB;&#x8FDB;&#x884C;&#x5207;&#x9762;&#x7684;&#x89E3;&#x6790;&#x3002;&#x5177;&#x4F53;&#x89E3;&#x6790;&#x7C7B;&#x662F;<code>AbstractAutoProxyCreator</code>&#xFF0C;&#x5B83;&#x5B9E;&#x73B0;&#x4E86;<code>InstantiationAwareBeanPostProcessor</code>&#x3002;&#x8FDB;&#x5165;<code>postProcessBeforeInstantiation</code>&#x65B9;&#x6CD5;&#x3002;<br><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/b6b3a975b8ef0ecfdeb6678b55b620fe3b5bea031e3fa40c890ab9d80a9f3431" alt="image.png">  </p>
<p>&#x5224;&#x65AD;&#x662F;&#x5426;&#x5E94;&#x8BE5;&#x8DF3;&#x8FC7;&#x3002;&#x771F;&#x6B63;&#x7684;&#x89E3;&#x6790;&#x662F;&#x5728;<code>shouldSkip</code>&#x4E2D;&#x3002;<br><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/614ecc9282502c9cdf57b740e597f706daf017f0b5216026e2c920bda5296a78" alt="image.png">  </p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/a117dca75d7b1f4cd2859c3362174c203e4e52f969845720b5a6f4ea6cd293f4" alt="image.png">  </p>
<p>&#x8FDB;&#x5165;<code>findCandidateAdvisors</code>&#x7684;&#x91CD;&#x5199;&#x65B9;&#x6CD5;&#x3002;<br><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/80dbb6cbda1832b1daf2b0a8db3f16f2fb9fcee43438ae072fdab8007b9174a2" alt="image.png">  </p>
<p>&#x8C03;&#x7528;<code>super.findCandidateAdvisors()</code>&#xFF0C;&#x53BB;&#x67E5;&#x627E;&#x5B9E;&#x73B0;&#x4E86;Advisor&#x63A5;&#x53E3;&#x7684;&#x5207;&#x9762;&#x7C7B;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;public List&lt;Advisor&gt; findAdvisorBeans() {</span><br><span class="line"></span><br><span class="line">   /**</span><br><span class="line">    * &#x63A2;&#x6D4B;&#x5668;&#x5B57;&#x6BB5;&#x7F13;&#x5B58;&#x4E2D;cachedAdvisorBeanNames &#x662F;&#x7528;&#x6765;&#x4FDD;&#x5B58;&#x6211;&#x4EEC;&#x7684;Advisor&#x5168;&#x7C7B;&#x540D;</span><br><span class="line">    * &#x4F1A;&#x5728;&#x7B2C;&#x4E00;&#x4E2A;&#x5355;&#x5B9E;&#x4F8B;bean&#x7684;&#x4E2D;&#x4F1A;&#x53BB;&#x628A;&#x8FD9;&#x4E2A;advisor&#x540D;&#x79F0;&#x89E3;&#x6790;&#x51FA;&#x6765;</span><br><span class="line">    */</span><br><span class="line">   String[] advisorNames = this.cachedAdvisorBeanNames;</span><br><span class="line">   if (advisorNames == null) {</span><br><span class="line">      /**</span><br><span class="line">       * &#x53BB;&#x6211;&#x4EEC;&#x7684;&#x5BB9;&#x5668;&#x4E2D;&#x83B7;&#x53D6;&#x5230;&#x5B9E;&#x73B0;&#x4E86;Advisor&#x63A5;&#x53E3;&#x7684;&#x5B9E;&#x73B0;&#x7C7B;</span><br><span class="line">       * &#x800C;&#x6211;&#x4EEC;&#x7684;&#x4E8B;&#x52A1;&#x6CE8;&#x89E3;@EnableTransactionManagement &#x5BFC;&#x5165;&#x4E86;&#x4E00;&#x4E2A;&#x53EB;ProxyTransactionManagementConfiguration&#x914D;&#x7F6E;&#x7C7B;</span><br><span class="line">       * &#x800C;&#x5728;&#x8FD9;&#x4E2A;&#x914D;&#x7F6E;&#x7C7B;&#x4E2D;&#x914D;&#x7F6E;&#x4E86;</span><br><span class="line">       * @Bean(name = TransactionManagementConfigUtils.TRANSACTION_ADVISOR_BEAN_NAME)</span><br><span class="line">         @Role(BeanDefinition.ROLE_INFRASTRUCTURE)</span><br><span class="line">         public BeanFactoryTransactionAttributeSourceAdvisor transactionAdvisor();</span><br><span class="line">         &#x7136;&#x540E;&#x628A;&#x4ED6;&#x7684;&#x540D;&#x5B57;&#x83B7;&#x53D6;&#x51FA;&#x6765;&#x4FDD;&#x5B58;&#x5230; &#x672C;&#x7C7B;&#x7684;&#x5C5E;&#x6027;&#x53D8;&#x91CF;cachedAdvisorBeanNames&#x4E2D;</span><br><span class="line">       */</span><br><span class="line">      advisorNames = BeanFactoryUtils.beanNamesForTypeIncludingAncestors(</span><br><span class="line">            this.beanFactory, Advisor.class, true, false);</span><br><span class="line">      this.cachedAdvisorBeanNames = advisorNames;</span><br><span class="line">   }</span><br><span class="line">   //&#x82E5;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#x6CA1;&#x6709;&#x627E;&#x5230;&#xFF0C;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x7A7A;&#x7684;&#x96C6;&#x5408;</span><br><span class="line">   if (advisorNames.length == 0) {</span><br><span class="line">      return new ArrayList&lt;&gt;();</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   List&lt;Advisor&gt; advisors = new ArrayList&lt;&gt;();</span><br><span class="line">   //ioc&#x5BB9;&#x5668;&#x4E2D;&#x627E;&#x5230;&#x4E86;&#x6211;&#x4EEC;&#x914D;&#x7F6E;&#x7684;BeanFactoryTransactionAttributeSourceAdvisor</span><br><span class="line">   for (String name : advisorNames) {</span><br><span class="line">      //&#x5224;&#x65AD;&#x4ED6;&#x662F;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x5408;&#x9002;&#x7684; &#x662F;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x7684;</span><br><span class="line">      if (isEligibleBean(name)) {</span><br><span class="line">         //BeanFactoryTransactionAttributeSourceAdvisor&#x662F;&#x4E0D;&#x662F;&#x6B63;&#x5728;&#x521B;&#x5EFA;&#x7684;bean</span><br><span class="line">         if (this.beanFactory.isCurrentlyInCreation(name)) {</span><br><span class="line">            if (logger.isDebugEnabled()) {</span><br><span class="line">               logger.debug(&quot;Skipping currently created advisor &apos;&quot; + name + &quot;&apos;&quot;);</span><br><span class="line">            }</span><br><span class="line">         }</span><br><span class="line">         //&#x4E0D;&#x662F;&#x7684;&#x8BDD;</span><br><span class="line">         else {</span><br><span class="line">            try {</span><br><span class="line">               //&#x663E;&#x793A;&#x7684;&#x8C03;&#x7528;getBean&#x65B9;&#x6CD5;&#x65B9;&#x6CD5;&#x521B;&#x5EFA;&#x6211;&#x4EEC;&#x7684;BeanFactoryTransactionAttributeSourceAdvisor&#x8FD4;&#x56DE;&#x53BB;</span><br><span class="line">               advisors.add(this.beanFactory.getBean(name, Advisor.class));</span><br><span class="line">            }</span><br><span class="line">            catch (BeanCreationException ex) {</span><br><span class="line">               Throwable rootCause = ex.getMostSpecificCause();</span><br><span class="line">               if (rootCause instanceof BeanCurrentlyInCreationException) {</span><br><span class="line">                  BeanCreationException bce = (BeanCreationException) rootCause;</span><br><span class="line">                  String bceBeanName = bce.getBeanName();</span><br><span class="line">                  if (bceBeanName != null &amp;&amp; this.beanFactory.isCurrentlyInCreation(bceBeanName)) {</span><br><span class="line">                     if (logger.isDebugEnabled()) {</span><br><span class="line">                        logger.debug(&quot;Skipping advisor &apos;&quot; + name +</span><br><span class="line">                              &quot;&apos; with dependency on currently created bean: &quot; + ex.getMessage());</span><br><span class="line">                     }</span><br><span class="line">                     // Ignore: indicates a reference back to the bean we&apos;re trying to advise.</span><br><span class="line">                     // We want to find advisors other than the currently created bean itself.</span><br><span class="line">                     continue;</span><br><span class="line">                  }</span><br><span class="line">               }</span><br><span class="line">               throw ex;</span><br><span class="line">            }</span><br><span class="line">         }</span><br><span class="line">      }</span><br><span class="line">   }</span><br><span class="line">   return advisors;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="&#x8C03;&#x7528;buildAspectJAdvisors&#x53BB;&#x67E5;&#x627E;&#x6CE8;&#x89E3;&#x65B9;&#x5F0F;&#x7684;&#x5207;&#x9762;&#x7C7B;&#x3002;"><a href="#&#x8C03;&#x7528;buildAspectJAdvisors&#x53BB;&#x67E5;&#x627E;&#x6CE8;&#x89E3;&#x65B9;&#x5F0F;&#x7684;&#x5207;&#x9762;&#x7C7B;&#x3002;" class="headerlink" title="&#x8C03;&#x7528;buildAspectJAdvisors&#x53BB;&#x67E5;&#x627E;&#x6CE8;&#x89E3;&#x65B9;&#x5F0F;&#x7684;&#x5207;&#x9762;&#x7C7B;&#x3002;"></a>&#x8C03;&#x7528;<code>buildAspectJAdvisors</code>&#x53BB;&#x67E5;&#x627E;&#x6CE8;&#x89E3;&#x65B9;&#x5F0F;&#x7684;&#x5207;&#x9762;&#x7C7B;&#x3002;</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;/**</span><br><span class="line"> * &#x53BB;&#x5BB9;&#x5668;&#x4E2D;&#x83B7;&#x53D6;&#x5230;&#x6240;&#x6709;&#x7684;&#x5207;&#x9762;&#x4FE1;&#x606F;&#x4FDD;&#x5B58;&#x5230;&#x7F13;&#x5B58;&#x4E2D;</span><br><span class="line"> * @return the list of {@link org.springframework.aop.Advisor} beans</span><br><span class="line"> * @see #isEligibleBean</span><br><span class="line"> */</span><br><span class="line">public List&lt;Advisor&gt; buildAspectJAdvisors() {</span><br><span class="line">   /**</span><br><span class="line">    * &#x7528;&#x4E8E;&#x4FDD;&#x5B58;&#x5207;&#x9762;&#x7684;&#x540D;&#x79F0;,&#x8BE5;&#x5730;&#x65B9;aspectNames &#x662F;&#x6211;&#x4EEC;&#x7684;&#x7C7B;&#x7EA7;&#x522B;&#x7684;&#x7F13;&#x5B58;&#xFF0C;&#x7528;&#x6237;&#x7F13;&#x5B58;&#x5DF2;&#x7ECF;&#x89E3;&#x6790;&#x51FA;&#x6765;&#x7684;&#x5207;&#x9762;&#x4FE1;&#x606F;</span><br><span class="line">    */</span><br><span class="line">   List&lt;String&gt; aspectNames = this.aspectBeanNames;</span><br><span class="line">   // &#x7F13;&#x5B58;&#x5B57;&#x6BB5;aspectNames&#x6CA1;&#x6709;&#x503C; &#x4F1A;&#x5728;&#x7B2C;&#x4E00;&#x4E2A;&#x5355;&#x4F8B;&#x6267;&#x884C;&#x540E;&#x7F6E;&#x5904;&#x7406;&#x5668;&#xFF08;AnnotationAwareAspectJAutoProxyCreator&#x6CE8;&#x518C;&#x4E4B;&#x540E;&#xFF09;&#x7684;&#x65F6;&#x5019;&#x5C31;&#x4F1A;&#x89E6;&#x53D1;&#x89E3;&#x6790;&#x5207;&#x9762;&#x7684;&#x64CD;&#x4F5C;</span><br><span class="line">   if (aspectNames == null) {</span><br><span class="line">      // &#x52A0;&#x4E0A;&#x540C;&#x6B65;&#x9501;&#xFF0C; &#x9632;&#x6B62;&#x591A;&#x7EBF;&#x7A0B;&#x540C;&#x65F6;&#x52A0;&#x8F7D;Aspect</span><br><span class="line">      synchronized (this) {</span><br><span class="line">         aspectNames = this.aspectBeanNames;</span><br><span class="line">         //&#x505A;&#x4E86;&#x53CC;&#x91CD;&#x68C0;&#x67E5;&#x52A0;&#x9501;</span><br><span class="line">         if (aspectNames == null) {</span><br><span class="line">            // &#x4FDD;&#x5B58;&#x6240;&#x6709;&#x901A;&#x77E5;&#x7684;&#x96C6;&#x5408;</span><br><span class="line">            List&lt;Advisor&gt; advisors = new ArrayList&lt;&gt;();</span><br><span class="line">            // &#x4FDD;&#x5B58;&#x5207;&#x9762;&#x7684;&#x540D;&#x79F0;&#x7684;&#x96C6;&#x5408;</span><br><span class="line">            aspectNames = new ArrayList&lt;&gt;();</span><br><span class="line">            /**</span><br><span class="line">             * aop&#x529F;&#x80FD;&#x4E2D;&#x5728;&#x8FD9;&#x91CC;&#x4F20;&#x5165;&#x7684;&#x662F;Object.class&#xFF0C;&#x4EE3;&#x8868;&#x53BB;&#x5BB9;&#x5668;&#x4E2D;&#x83B7;&#x53D6;&#x5230;&#x6240;&#x6709;&#x7684;&#x7EC4;&#x4EF6;&#x7684;&#x540D;&#x79F0;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x7ECF;&#x8FC7;</span><br><span class="line">             * &#x4E00;&#x4E00;&#x7684;&#x8FDB;&#x884C;&#x904D;&#x5386;&#xFF0C;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x662F;&#x5341;&#x5206;&#x7684;&#x6D88;&#x8017;&#x6027;&#x80FD;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x8BF4;spring&#x4F1A;&#x518D;&#x8FD9;&#x91CC;&#x52A0;&#x5165;&#x4E86;&#x4FDD;&#x5B58;&#x5207;&#x9762;&#x4FE1;&#x606F;&#x7684;&#x7F13;&#x5B58;&#x3002;</span><br><span class="line">             * &#x4F46;&#x662F;&#x4E8B;&#x52A1;&#x529F;&#x80FD;&#x4E0D;&#x4E00;&#x6837;&#xFF0C;&#x4E8B;&#x52A1;&#x6A21;&#x5757;&#x7684;&#x529F;&#x80FD;&#x662F;&#x76F4;&#x63A5;&#x53BB;&#x5BB9;&#x5668;&#x4E2D;&#x83B7;&#x53D6;Advisor&#x7C7B;&#x578B;&#x7684;&#xFF0C;&#x9009;&#x62E9;&#x8303;&#x56F4;&#x5C0F;&#xFF0C;&#x4E14;&#x4E0D;&#x6D88;&#x8017;&#x6027;&#x80FD;&#x3002;&#x6240;&#x4EE5;</span><br><span class="line">             * spring&#x5728;&#x4E8B;&#x52A1;&#x6A21;&#x5757;&#x4E2D;&#x6CA1;&#x6709;&#x52A0;&#x5165;&#x7F13;&#x5B58;&#x6765;&#x4FDD;&#x5B58;&#x6211;&#x4EEC;&#x7684;&#x4E8B;&#x52A1;&#x76F8;&#x5173;&#x7684;advisor</span><br><span class="line">             */</span><br><span class="line">            String[] beanNames = BeanFactoryUtils.beanNamesForTypeIncludingAncestors(</span><br><span class="line">                  this.beanFactory, Object.class, true, false);</span><br><span class="line">            //&#x904D;&#x5386;&#x6211;&#x4EEC;&#x4ECE;IOC&#x5BB9;&#x5668;&#x4E2D;&#x83B7;&#x53D6;&#x5904;&#x7684;&#x6240;&#x6709;bean&#x7684;&#x540D;&#x79F0;</span><br><span class="line">            for (String beanName : beanNames) {</span><br><span class="line">               if (!isEligibleBean(beanName)) {</span><br><span class="line">                  continue;</span><br><span class="line">               }</span><br><span class="line">               //&#x901A;&#x8FC7;beanName&#x53BB;&#x5BB9;&#x5668;&#x4E2D;&#x83B7;&#x53D6;&#x5230;&#x5BF9;&#x5E94;class&#x5BF9;&#x8C61;</span><br><span class="line">               Class&lt;?&gt; beanType = this.beanFactory.getType(beanName);</span><br><span class="line">               if (beanType == null) {</span><br><span class="line">                  continue;</span><br><span class="line">               }</span><br><span class="line">               //&#x6839;&#x636E;class&#x5BF9;&#x8C61;&#x5224;&#x65AD;&#x662F;&#x4E0D;&#x662F;&#x5207;&#x9762; &#x5373;&#x5224;&#x65AD;&#x7C7B;&#x4E0A;&#x9762;&#x662F;&#x5426;&#x6709;Aspect&#x6CE8;&#x89E3;&#x4E14;&#x4E0D;&#x662F;ajc$&#x5F00;&#x5934;&#x7684;&#x6587;&#x4EF6;&#x3002;</span><br><span class="line">               if (this.advisorFactory.isAspect(beanType)) {</span><br><span class="line">                  //&#x662F;&#x5207;&#x9762;&#x7C7B;</span><br><span class="line">                  //&#x52A0;&#x5165;&#x5230;&#x7F13;&#x5B58;&#x4E2D;</span><br><span class="line">                  aspectNames.add(beanName);</span><br><span class="line">                  //&#x628A;beanName&#x548C;class&#x5BF9;&#x8C61;&#x6784;&#x5EFA;&#x6210;&#x4E3A;&#x4E00;&#x4E2A;AspectMetadata</span><br><span class="line">                  AspectMetadata amd = new AspectMetadata(beanType, beanName);</span><br><span class="line">                  if (amd.getAjType().getPerClause().getKind() == PerClauseKind.SINGLETON) {</span><br><span class="line"></span><br><span class="line">                     //&#x6784;&#x5EFA;&#x5207;&#x9762;&#x6CE8;&#x89E3;&#x7684;&#x5B9E;&#x4F8B;&#x5DE5;&#x5382;</span><br><span class="line">                     MetadataAwareAspectInstanceFactory factory =</span><br><span class="line">                           new BeanFactoryAspectInstanceFactory(this.beanFactory, beanName);</span><br><span class="line">                     //&#x771F;&#x6B63;&#x7684;&#x53BB;&#x83B7;&#x53D6;&#x6211;&#x4EEC;&#x7684;&#x901A;&#x77E5;&#x5BF9;&#x8C61;  &#x8BE6;&#x7EC6;&#x770B;&#x4E0B;&#x9762;getAdvisors&#x65B9;&#x6CD5;</span><br><span class="line">                     List&lt;Advisor&gt; classAdvisors = this.advisorFactory.getAdvisors(factory);</span><br><span class="line">                     //&#x52A0;&#x5165;&#x5230;&#x7F13;&#x5B58;&#x4E2D;</span><br><span class="line">                     if (this.beanFactory.isSingleton(beanName)) {</span><br><span class="line">                        this.advisorsCache.put(beanName, classAdvisors);</span><br><span class="line">                     }</span><br><span class="line">                     else {</span><br><span class="line">                        this.aspectFactoryCache.put(beanName, factory);</span><br><span class="line">                     }</span><br><span class="line">                     advisors.addAll(classAdvisors);</span><br><span class="line">                  }</span><br><span class="line">                  else {</span><br><span class="line">                     // Per target or per this.</span><br><span class="line">                     if (this.beanFactory.isSingleton(beanName)) {</span><br><span class="line">                        throw new IllegalArgumentException(&quot;Bean with name &apos;&quot; + beanName +</span><br><span class="line">                              &quot;&apos; is a singleton, but aspect instantiation model is not singleton&quot;);</span><br><span class="line">                     }</span><br><span class="line">                     MetadataAwareAspectInstanceFactory factory =</span><br><span class="line">                           new PrototypeAspectInstanceFactory(this.beanFactory, beanName);</span><br><span class="line">                     this.aspectFactoryCache.put(beanName, factory);</span><br><span class="line">                     advisors.addAll(this.advisorFactory.getAdvisors(factory));</span><br><span class="line">                  }</span><br><span class="line">               }</span><br><span class="line">            }</span><br><span class="line">            this.aspectBeanNames = aspectNames;</span><br><span class="line">            return advisors;</span><br><span class="line">         }</span><br><span class="line">      }</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   if (aspectNames.isEmpty()) {</span><br><span class="line">      return Collections.emptyList();</span><br><span class="line">   }</span><br><span class="line">   /**</span><br><span class="line">    * &#x771F;&#x6B63;&#x7684;&#x521B;&#x5EFA;&#x5207;&#x9762;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x9700;&#x8981;&#x53BB;&#x89E3;&#x6790;&#x4E86;&#x800C;&#x662F;&#x76F4;&#x63A5;&#x53BB;&#x7F13;&#x5B58;&#x4E2D;&#x83B7;&#x53D6;&#x5904;</span><br><span class="line">    */</span><br><span class="line">   List&lt;Advisor&gt; advisors = new ArrayList&lt;&gt;();</span><br><span class="line">   for (String aspectName : aspectNames) {</span><br><span class="line">      List&lt;Advisor&gt; cachedAdvisors = this.advisorsCache.get(aspectName);</span><br><span class="line">      if (cachedAdvisors != null) {</span><br><span class="line">         advisors.addAll(cachedAdvisors);</span><br><span class="line">      }</span><br><span class="line">      else {</span><br><span class="line">         MetadataAwareAspectInstanceFactory factory = this.aspectFactoryCache.get(aspectName);</span><br><span class="line">         advisors.addAll(this.advisorFactory.getAdvisors(factory));</span><br><span class="line">      }</span><br><span class="line">   }</span><br><span class="line">   return advisors;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="getAdvisors&#x65B9;&#x6CD5;"><a href="#getAdvisors&#x65B9;&#x6CD5;" class="headerlink" title="getAdvisors&#x65B9;&#x6CD5;"></a>getAdvisors&#x65B9;&#x6CD5;</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">scss&#x590D;&#x5236;&#x4EE3;&#x7801;@Override</span><br><span class="line">public List&lt;Advisor&gt; getAdvisors(MetadataAwareAspectInstanceFactory aspectInstanceFactory) {</span><br><span class="line">   //&#x83B7;&#x53D6;&#x6211;&#x4EEC;&#x7684;&#x6807;&#x8BB0;&#x4E3A;Aspect&#x7684;&#x7C7B;</span><br><span class="line">   Class&lt;?&gt; aspectClass = aspectInstanceFactory.getAspectMetadata().getAspectClass();</span><br><span class="line">   //&#x83B7;&#x53D6;&#x6211;&#x4EEC;&#x7684;&#x5207;&#x9762;&#x7C7B;&#x7684;&#x540D;&#x79F0;</span><br><span class="line">   String aspectName = aspectInstanceFactory.getAspectMetadata().getAspectName();</span><br><span class="line">   //&#x6821;&#x9A8C;&#x6211;&#x4EEC;&#x7684;&#x5207;&#x9762;&#x7C7B;</span><br><span class="line">   validate(aspectClass);</span><br><span class="line"></span><br><span class="line">   //&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x5305;&#x88C5;&#x6A21;&#x5F0F;&#x6765;&#x5305;&#x88C5;&#x6211;&#x4EEC;&#x7684;MetadataAwareAspectInstanceFactory &#x6784;&#x5EFA;&#x4E3A;MetadataAwareAspectInstanceFactory</span><br><span class="line">   MetadataAwareAspectInstanceFactory lazySingletonAspectInstanceFactory =</span><br><span class="line">         new LazySingletonAspectInstanceFactoryDecorator(aspectInstanceFactory);</span><br><span class="line"></span><br><span class="line">   List&lt;Advisor&gt; advisors = new ArrayList&lt;&gt;();</span><br><span class="line">   //&#x83B7;&#x53D6;&#x5230;&#x5207;&#x9762;&#x7C7B;&#x4E2D;&#x7684;&#x6240;&#x6709;&#x65B9;&#x6CD5;&#xFF0C;&#x4F46;&#x662F;&#x8BE5;&#x65B9;&#x6CD5;&#x4E0D;&#x4F1A;&#x89E3;&#x6790;&#x6807;&#x6CE8;&#x4E86;@PointCut&#x6CE8;&#x89E3;&#x7684;&#x65B9;&#x6CD5;</span><br><span class="line">   for (Method method : getAdvisorMethods(aspectClass)) {</span><br><span class="line">      //&#x6328;&#x4E2A;&#x53BB;&#x89E3;&#x6790;&#x6211;&#x4EEC;&#x5207;&#x9762;&#x4E2D;&#x7684;&#x65B9;&#x6CD5; &#x8BE6;&#x7EC6;&#x770B;&#x4E0B;&#x9762;getAdvisor&#x65B9;&#x6CD5;</span><br><span class="line">      Advisor advisor = getAdvisor(method, lazySingletonAspectInstanceFactory, advisors.size(), aspectName);</span><br><span class="line">      if (advisor != null) {</span><br><span class="line">         advisors.add(advisor);</span><br><span class="line">      }</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   // If it&apos;s a per target aspect, emit the dummy instantiating aspect.</span><br><span class="line">   if (!advisors.isEmpty() &amp;&amp; lazySingletonAspectInstanceFactory.getAspectMetadata().isLazilyInstantiated()) {</span><br><span class="line">      Advisor instantiationAdvisor = new SyntheticInstantiationAdvisor(lazySingletonAspectInstanceFactory);</span><br><span class="line">      advisors.add(0, instantiationAdvisor);</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   // Find introduction fields.</span><br><span class="line">   for (Field field : aspectClass.getDeclaredFields()) {</span><br><span class="line">      Advisor advisor = getDeclareParentsAdvisor(field);</span><br><span class="line">      if (advisor != null) {</span><br><span class="line">         advisors.add(advisor);</span><br><span class="line">      }</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   return advisors;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="getAdvisor&#x65B9;&#x6CD5;"><a href="#getAdvisor&#x65B9;&#x6CD5;" class="headerlink" title="getAdvisor&#x65B9;&#x6CD5;"></a>getAdvisor&#x65B9;&#x6CD5;</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">scss&#x590D;&#x5236;&#x4EE3;&#x7801;public Advisor getAdvisor(Method candidateAdviceMethod, MetadataAwareAspectInstanceFactory aspectInstanceFactory,</span><br><span class="line">      int declarationOrderInAspect, String aspectName) {</span><br><span class="line"></span><br><span class="line">   validate(aspectInstanceFactory.getAspectMetadata().getAspectClass());</span><br><span class="line"></span><br><span class="line">   // &#x83B7;&#x5F97;&#x5F53;&#x524D;&#x901A;&#x77E5;&#x7684; &#x5207;&#x70B9;&#x8868;&#x8FBE;&#x5F0F; &#x8BE6;&#x7EC6;&#x770B;&#x4E0B;&#x9762;getPointcut&#x65B9;&#x6CD5;</span><br><span class="line">   AspectJExpressionPointcut expressionPointcut = getPointcut(</span><br><span class="line">         candidateAdviceMethod, aspectInstanceFactory.getAspectMetadata().getAspectClass());</span><br><span class="line">   if (expressionPointcut == null) {</span><br><span class="line">      return null;</span><br><span class="line">   }</span><br><span class="line">   // &#x5C06;&#x5207;&#x70B9;&#x8868;&#x8FBE;&#x5F0F;&#x3001; &#x548C;&#x901A;&#x77E5;  &#x5C01;&#x88C5;&#x5230;InstantiationModelAwarePointcutAdvisorImpl&#x5BF9;&#x8C61;&#x4E2D; &#x8BE6;&#x7EC6;&#x770B;&#x4E0B;&#x9762;InstantiationModelAwarePointcutAdvisorImpl&#x6E90;&#x7801;</span><br><span class="line">   return new InstantiationModelAwarePointcutAdvisorImpl(expressionPointcut, candidateAdviceMethod,</span><br><span class="line">         this, aspectInstanceFactory, declarationOrderInAspect, aspectName);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="getPointcut&#x65B9;&#x6CD5;"><a href="#getPointcut&#x65B9;&#x6CD5;" class="headerlink" title="getPointcut&#x65B9;&#x6CD5;"></a>getPointcut&#x65B9;&#x6CD5;</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">typescript&#x590D;&#x5236;&#x4EE3;&#x7801;private AspectJExpressionPointcut getPointcut(Method candidateAdviceMethod, Class&lt;?&gt; candidateAspectClass) {</span><br><span class="line">   // &#x627E;&#x5230;aspectJ&#x7684;&#x6CE8;&#x89E3;&#xFF1A;</span><br><span class="line">   // @Pointcut  @Around @Before @After  @AfterReturning  @AfterThrowing</span><br><span class="line">   AspectJAnnotation&lt;?&gt; aspectJAnnotation =</span><br><span class="line">         AbstractAspectJAdvisorFactory.findAspectJAnnotationOnMethod(candidateAdviceMethod);</span><br><span class="line">   // &#x6CA1;&#x6709;&#x6CE8;&#x89E3;&#x90A3;&#x80AF;&#x5B9A;&#x5FFD;&#x7565;</span><br><span class="line">   if (aspectJAnnotation == null) {</span><br><span class="line">      return null;</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   AspectJExpressionPointcut ajexp =</span><br><span class="line">         new AspectJExpressionPointcut(candidateAspectClass, new String[0], new Class&lt;?&gt;[0]);</span><br><span class="line">   ajexp.setExpression(aspectJAnnotation.getPointcutExpression());</span><br><span class="line">   if (this.beanFactory != null) {</span><br><span class="line">      ajexp.setBeanFactory(this.beanFactory);</span><br><span class="line">   }</span><br><span class="line">   return ajexp;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="InstantiationModelAwarePointcutAdvisorImpl&#x51FD;&#x6570;"><a href="#InstantiationModelAwarePointcutAdvisorImpl&#x51FD;&#x6570;" class="headerlink" title="InstantiationModelAwarePointcutAdvisorImpl&#x51FD;&#x6570;"></a>InstantiationModelAwarePointcutAdvisorImpl&#x51FD;&#x6570;</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;public InstantiationModelAwarePointcutAdvisorImpl(AspectJExpressionPointcut declaredPointcut,</span><br><span class="line">      Method aspectJAdviceMethod, AspectJAdvisorFactory aspectJAdvisorFactory,</span><br><span class="line">      MetadataAwareAspectInstanceFactory aspectInstanceFactory, int declarationOrder, String aspectName) {</span><br><span class="line"></span><br><span class="line">   //&#x5F53;&#x524D;&#x7684;&#x5207;&#x70B9;</span><br><span class="line">   this.declaredPointcut = declaredPointcut;</span><br><span class="line">   //&#x5207;&#x9762;&#x7684;class&#x5BF9;&#x8C61;</span><br><span class="line">   this.declaringClass = aspectJAdviceMethod.getDeclaringClass();</span><br><span class="line">   //&#x5207;&#x9762;&#x65B9;&#x6CD5;&#x7684;&#x540D;&#x79F0;</span><br><span class="line">   this.methodName = aspectJAdviceMethod.getName();</span><br><span class="line">   //&#x5207;&#x9762;&#x65B9;&#x6CD5;&#x7684;&#x53C2;&#x6570;&#x7C7B;&#x578B;</span><br><span class="line">   this.parameterTypes = aspectJAdviceMethod.getParameterTypes();</span><br><span class="line">   //&#x5207;&#x9762;&#x65B9;&#x6CD5;&#x5BF9;&#x8C61;</span><br><span class="line">   this.aspectJAdviceMethod = aspectJAdviceMethod;</span><br><span class="line">   //aspectj&#x7684;&#x901A;&#x77E5;&#x5DE5;&#x5382;</span><br><span class="line">   this.aspectJAdvisorFactory = aspectJAdvisorFactory;</span><br><span class="line">   //aspect&#x7684;&#x5B9E;&#x4F8B;&#x5DE5;&#x5382;</span><br><span class="line">   this.aspectInstanceFactory = aspectInstanceFactory;</span><br><span class="line">   //&#x5207;&#x9762;&#x7684;&#x987A;&#x5E8F;</span><br><span class="line">   this.declarationOrder = declarationOrder;</span><br><span class="line">   //&#x5207;&#x9762;&#x7684;&#x540D;&#x79F0;</span><br><span class="line">   this.aspectName = aspectName;</span><br><span class="line"></span><br><span class="line">   /**</span><br><span class="line">    * &#x5224;&#x65AD;&#x5F53;&#x524D;&#x7684;&#x5207;&#x9762;&#x5BF9;&#x8C61;&#x662F;&#x5426;&#x9700;&#x8981;&#x5EF6;&#x65F6;&#x52A0;&#x8F7D;</span><br><span class="line">    */</span><br><span class="line">   if (aspectInstanceFactory.getAspectMetadata().isLazilyInstantiated()) {</span><br><span class="line">      // Static part of the pointcut is a lazy type.</span><br><span class="line">      Pointcut preInstantiationPointcut = Pointcuts.union(</span><br><span class="line">            aspectInstanceFactory.getAspectMetadata().getPerClausePointcut(), this.declaredPointcut);</span><br><span class="line"></span><br><span class="line">      // Make it dynamic: must mutate from pre-instantiation to post-instantiation state.</span><br><span class="line">      // If it&apos;s not a dynamic pointcut, it may be optimized out</span><br><span class="line">      // by the Spring AOP infrastructure after the first evaluation.</span><br><span class="line">      this.pointcut = new PerTargetInstantiationModelPointcut(</span><br><span class="line">            this.declaredPointcut, preInstantiationPointcut, aspectInstanceFactory);</span><br><span class="line">      this.lazy = true;</span><br><span class="line">   }</span><br><span class="line">   else {</span><br><span class="line">      // A singleton aspect.</span><br><span class="line">      this.pointcut = this.declaredPointcut;</span><br><span class="line">      this.lazy = false;</span><br><span class="line">      //&#x628A;&#x5207;&#x9762;&#x4E2D;&#x7684;&#x901A;&#x77E5;&#x6784;&#x9020;&#x4E3A;&#x4E00;&#x4E2A;&#x4E00;&#x4E2A;&#x7684;advice&#x901A;&#x77E5;&#x5BF9;&#x8C61; &#x8BE6;&#x7EC6;&#x770B;&#x4E0B;&#x9762;instantiateAdvice&#x6E90;&#x7801;</span><br><span class="line">      this.instantiatedAdvice = instantiateAdvice(this.declaredPointcut);</span><br><span class="line">   }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="instantiateAdvice&#x65B9;&#x6CD5;"><a href="#instantiateAdvice&#x65B9;&#x6CD5;" class="headerlink" title="instantiateAdvice&#x65B9;&#x6CD5;"></a>instantiateAdvice&#x65B9;&#x6CD5;</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;private Advice instantiateAdvice(AspectJExpressionPointcut pointcut) {</span><br><span class="line">   // &#x8BE6;&#x7EC6;&#x770B;&#x4E0B;&#x9762;getAdvice&#x6E90;&#x7801;</span><br><span class="line">   Advice advice = this.aspectJAdvisorFactory.getAdvice(this.aspectJAdviceMethod, pointcut,</span><br><span class="line">         this.aspectInstanceFactory, this.declarationOrder, this.aspectName);</span><br><span class="line">   return (advice != null ? advice : EMPTY_ADVICE);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="getAdvice&#x6E90;&#x7801;"><a href="#getAdvice&#x6E90;&#x7801;" class="headerlink" title="getAdvice&#x6E90;&#x7801;"></a>getAdvice&#x6E90;&#x7801;</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;public Advice getAdvice(Method candidateAdviceMethod, AspectJExpressionPointcut expressionPointcut,</span><br><span class="line">      MetadataAwareAspectInstanceFactory aspectInstanceFactory, int declarationOrder, String aspectName) {</span><br><span class="line"></span><br><span class="line">   //&#x83B7;&#x53D6;&#x6211;&#x4EEC;&#x7684;&#x5207;&#x9762;&#x7C7B;&#x7684;class&#x5BF9;&#x8C61;</span><br><span class="line">   Class&lt;?&gt; candidateAspectClass = aspectInstanceFactory.getAspectMetadata().getAspectClass();</span><br><span class="line">   validate(candidateAspectClass);</span><br><span class="line"></span><br><span class="line">   //&#x83B7;&#x53D6;&#x5207;&#x9762;&#x65B9;&#x6CD5;&#x4E0A;&#x7684;&#x6CE8;&#x89E3;</span><br><span class="line">   AspectJAnnotation&lt;?&gt; aspectJAnnotation =</span><br><span class="line">         AbstractAspectJAdvisorFactory.findAspectJAnnotationOnMethod(candidateAdviceMethod);</span><br><span class="line">   //&#x89E3;&#x6790;&#x51FA;&#x6765;&#x7684;&#x6CE8;&#x89E3;&#x4FE1;&#x606F;&#x662F;&#x5426;&#x4E3A;null</span><br><span class="line">   if (aspectJAnnotation == null) {</span><br><span class="line">      return null;</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   //&#x5224;&#x65AD;&#x8FD9;&#x91CC;&#x7684;class&#x5BF9;&#x8C61;&#x662F;&#x4E0D;&#x662F;&#x5207;&#x9762;&#x4FE1;&#x606F;&#x5BF9;&#x8C61;</span><br><span class="line">   if (!isAspect(candidateAspectClass)) {</span><br><span class="line">      throw new AopConfigException(&quot;Advice must be declared inside an aspect type: &quot; +</span><br><span class="line">            &quot;Offending method &apos;&quot; + candidateAdviceMethod + &quot;&apos; in class [&quot; +</span><br><span class="line">            candidateAspectClass.getName() + &quot;]&quot;);</span><br><span class="line">   }</span><br><span class="line">   // &#x8BB0;&#x5F55;&#x627E;&#x5230;&#x4E86;advice&#x65B9;&#x6CD5;</span><br><span class="line">   if (logger.isDebugEnabled()) {</span><br><span class="line">      logger.debug(&quot;Found AspectJ method: &quot; + candidateAdviceMethod);</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   AbstractAspectJAdvice springAdvice;</span><br><span class="line"></span><br><span class="line">   //&#x5224;&#x65AD;&#x6807;&#x6CE8;&#x5728;&#x65B9;&#x6CD5;&#x4E0A;&#x7684;&#x6CE8;&#x89E3;&#x7C7B;&#x578B;</span><br><span class="line">   switch (aspectJAnnotation.getAnnotationType()) {</span><br><span class="line">      //&#x662F;PointCut&#x6CE8;&#x89E3; &#x90A3;&#x4E48;&#x5C31;&#x629B;&#x51FA;&#x5F02;&#x5E38; &#x56E0;&#x4E3A;&#x5728;&#x5916;&#x9762;&#x4F20;&#x9012;&#x8FDB;&#x6765;&#x7684;&#x65B9;&#x6CD5;&#x5DF2;&#x7ECF;&#x6392;&#x9664;&#x4E86;pointcut&#x7684;&#x65B9;&#x6CD5;</span><br><span class="line">      case AtPointcut:</span><br><span class="line">         if (logger.isDebugEnabled()) {</span><br><span class="line">            logger.debug(&quot;Processing pointcut &apos;&quot; + candidateAdviceMethod.getName() + &quot;&apos;&quot;);</span><br><span class="line">         }</span><br><span class="line">         return null;</span><br><span class="line"></span><br><span class="line">      case AtAround:   //&#x73AF;&#x7ED5;&#x901A;&#x77E5; &#x6784;&#x5EFA;AspectJAroundAdvice</span><br><span class="line">         springAdvice = new AspectJAroundAdvice(</span><br><span class="line">               candidateAdviceMethod, expressionPointcut, aspectInstanceFactory);</span><br><span class="line">         break;</span><br><span class="line">      case AtBefore:  //&#x524D;&#x7F6E;&#x901A;&#x77E5;  &#x6784;&#x5EFA;AspectJMethodBeforeAdvice</span><br><span class="line">         springAdvice = new AspectJMethodBeforeAdvice(</span><br><span class="line">               candidateAdviceMethod, expressionPointcut, aspectInstanceFactory);</span><br><span class="line">         break;</span><br><span class="line">      case AtAfter:  //&#x540E;&#x7F6E;&#x901A;&#x77E5; AspectJAfterAdvice</span><br><span class="line">         springAdvice = new AspectJAfterAdvice(</span><br><span class="line">               candidateAdviceMethod, expressionPointcut, aspectInstanceFactory);</span><br><span class="line">         break;</span><br><span class="line">      case AtAfterReturning: //&#x8FD4;&#x56DE;&#x901A;&#x77E5; AspectJAfterReturningAdvice</span><br><span class="line">         springAdvice = new AspectJAfterReturningAdvice(</span><br><span class="line">               candidateAdviceMethod, expressionPointcut, aspectInstanceFactory);</span><br><span class="line">         AfterReturning afterReturningAnnotation = (AfterReturning) aspectJAnnotation.getAnnotation();</span><br><span class="line">         if (StringUtils.hasText(afterReturningAnnotation.returning())) {</span><br><span class="line">            springAdvice.setReturningName(afterReturningAnnotation.returning());</span><br><span class="line">         }</span><br><span class="line">         break;</span><br><span class="line">      case AtAfterThrowing:  //&#x5F02;&#x5E38;&#x901A;&#x77E5;   AspectJAfterThrowingAdvice</span><br><span class="line">         springAdvice = new AspectJAfterThrowingAdvice(</span><br><span class="line">               candidateAdviceMethod, expressionPointcut, aspectInstanceFactory);</span><br><span class="line">         AfterThrowing afterThrowingAnnotation = (AfterThrowing) aspectJAnnotation.getAnnotation();</span><br><span class="line">         if (StringUtils.hasText(afterThrowingAnnotation.throwing())) {</span><br><span class="line">            springAdvice.setThrowingName(afterThrowingAnnotation.throwing());</span><br><span class="line">         }</span><br><span class="line">         break;</span><br><span class="line">      default:</span><br><span class="line">         throw new UnsupportedOperationException(</span><br><span class="line">               &quot;Unsupported advice type on method: &quot; + candidateAdviceMethod);</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   //&#x914D;&#x7F6E;&#x6211;&#x4EEC;&#x6784;&#x5EFA;&#x51FA;&#x6765;&#x7684;&#x901A;&#x77E5;&#x5BF9;&#x8C61;</span><br><span class="line">   springAdvice.setAspectName(aspectName);</span><br><span class="line">   springAdvice.setDeclarationOrder(declarationOrder);</span><br><span class="line">   String[] argNames = this.parameterNameDiscoverer.getParameterNames(candidateAdviceMethod);</span><br><span class="line">   if (argNames != null) {</span><br><span class="line">      springAdvice.setArgumentNamesFromStringArray(argNames);</span><br><span class="line">   }</span><br><span class="line">   springAdvice.calculateArgumentBindings();</span><br><span class="line"></span><br><span class="line">   return springAdvice;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><code>applyBeanPostProcessorsBeforeInstantiation</code>&#x5230;&#x8FD9;&#x91CC;&#x7B2C;&#x4E00;&#x6B21;&#x8C03;&#x7528;&#x540E;&#x7F6E;&#x5904;&#x7406;&#x5668;&#x5B8C;&#x6210;&#x4E86;&#x5207;&#x9762;&#x7684;&#x89E3;&#x6790;&#x90A3;&#x4E48;&#x63A5;&#x4E0B;&#x6765;&#x5373;&#x8C03;&#x7528;&#x5207;&#x9762;&#x521B;&#x5EFA;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#xFF0C;&#x521B;&#x5EFA;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x5B9E;&#x5728;&#x521D;&#x59CB;&#x5316;Bean&#x540E;&#x624D;&#x8C03;&#x7528;&#xFF0C;&#x5373;&#x5728;<code>doCreateBean</code>&#x7684;&#x65F6;&#x5019;&#x56DE;&#x53BB;&#x521D;&#x59CB;&#x5316;Bean&#xFF0C;<code>initializeBean</code>&#x65B9;&#x6CD5;&#x4E2D;&#x624D;&#x53BB;&#x8C03;&#x7528;<code>applyBeanPostProcessorsAfterInitialization</code>&#x65B9;&#x6CD5;&#x521B;&#x5EFA;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x3002;</p>
<h4 id="applyBeanPostProcessorsAfterInitialization&#x65B9;&#x6CD5;"><a href="#applyBeanPostProcessorsAfterInitialization&#x65B9;&#x6CD5;" class="headerlink" title="applyBeanPostProcessorsAfterInitialization&#x65B9;&#x6CD5;"></a>applyBeanPostProcessorsAfterInitialization&#x65B9;&#x6CD5;</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">typescript&#x590D;&#x5236;&#x4EE3;&#x7801;public Object applyBeanPostProcessorsAfterInitialization(Object existingBean, String beanName)</span><br><span class="line">      throws BeansException {</span><br><span class="line"></span><br><span class="line">   Object result = existingBean;</span><br><span class="line">   //&#x83B7;&#x53D6;&#x6211;&#x4EEC;&#x5BB9;&#x5668;&#x4E2D;&#x7684;&#x6240;&#x6709;&#x7684;bean&#x7684;&#x540E;&#x7F6E;&#x5904;&#x7406;&#x5668;</span><br><span class="line">   for (BeanPostProcessor processor : getBeanPostProcessors()) {</span><br><span class="line">      /**</span><br><span class="line">       * &#x5728;&#x8FD9;&#x91CC;&#x662F;&#x540E;&#x7F6E;&#x5904;&#x7406;&#x5668;&#x7684;&#x3010;&#x7B2C;&#x4E5D;&#x6B21;&#x8C03;&#x7528;&#x3011; aop&#x548C;&#x4E8B;&#x52A1;&#x90FD;&#x4F1A;&#x5728;&#x8FD9;&#x91CC;&#x751F;&#x5B58;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;</span><br><span class="line">       *</span><br><span class="line">       * &#x3010;&#x5F88;&#x91CD;&#x8981;&#x3011;</span><br><span class="line">       * &#x6211;&#x4EEC;AOP @EnableAspectJAutoProxy &#x4E3A;&#x6211;&#x4EEC;&#x5BB9;&#x5668;&#x4E2D;&#x5BFC;&#x5165;&#x4E86; AnnotationAwareAspectJAutoProxyCreator</span><br><span class="line">       * &#x6211;&#x4EEC;&#x4E8B;&#x52A1;&#x6CE8;&#x89E3;@EnableTransactionManagement &#x4E3A;&#x6211;&#x4EEC;&#x7684;&#x5BB9;&#x5668;&#x5BFC;&#x5165;&#x4E86; InfrastructureAdvisorAutoProxyCreator</span><br><span class="line">       * &#x90FD;&#x662F;&#x5B9E;&#x73B0;&#x4E86;&#x6211;&#x4EEC;&#x7684; BeanPostProcessor&#x63A5;&#x53E3;,InstantiationAwareBeanPostProcessor,</span><br><span class="line">       * &#x5728;&#x8FD9;&#x91CC;&#x5B9E;&#x73B0;&#x7684;&#x662F;BeanPostProcessor&#x63A5;&#x53E3;&#x7684;postProcessAfterInitialization&#x6765;&#x751F;&#x6210;&#x6211;&#x4EEC;&#x7684;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;</span><br><span class="line">       */</span><br><span class="line">       // &#x8BE6;&#x7EC6;&#x5F80;&#x4E0B;&#x770B;AbstractAutoProxyCreator&#x5B9E;&#x73B0;&#x7684;postProcessAfterInitialization &#x65B9;&#x6CD5;</span><br><span class="line">      Object current = processor.postProcessAfterInitialization(result, beanName);</span><br><span class="line">      //&#x82E5;&#x53EA;&#x6709;&#x6709;&#x4E00;&#x4E2A;&#x8FD4;&#x56DE;null &#x90A3;&#x4E48;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x539F;&#x59CB;&#x7684;</span><br><span class="line">      if (current == null) {</span><br><span class="line">         return result;</span><br><span class="line">      }</span><br><span class="line">      result = current;</span><br><span class="line">   }</span><br><span class="line">   return result;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="postProcessAfterInitialization&#x65B9;&#x6CD5;&#xFF08;AbstractAutoProxyCreator&#x7C7B;&#x5B9E;&#x73B0;&#xFF09;"><a href="#postProcessAfterInitialization&#x65B9;&#x6CD5;&#xFF08;AbstractAutoProxyCreator&#x7C7B;&#x5B9E;&#x73B0;&#xFF09;" class="headerlink" title="postProcessAfterInitialization&#x65B9;&#x6CD5;&#xFF08;AbstractAutoProxyCreator&#x7C7B;&#x5B9E;&#x73B0;&#xFF09;"></a>postProcessAfterInitialization&#x65B9;&#x6CD5;&#xFF08;AbstractAutoProxyCreator&#x7C7B;&#x5B9E;&#x73B0;&#xFF09;</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">less&#x590D;&#x5236;&#x4EE3;&#x7801;public Object postProcessAfterInitialization(@Nullable Object bean, String beanName) throws BeansException {</span><br><span class="line">   if (bean != null) {</span><br><span class="line">      //&#x83B7;&#x53D6;&#x7F13;&#x5B58;key</span><br><span class="line">      Object cacheKey = getCacheKey(bean.getClass(), beanName);</span><br><span class="line">      // &#x4E4B;&#x524D;&#x5FAA;&#x73AF;&#x4F9D;&#x8D56;&#x521B;&#x5EFA;&#x7684;&#x52A8;&#x6001;&#x4EE3;&#x7406; &#x5982;&#x679C;&#x662F;&#x73B0;&#x5728;&#x7684;bean &#x5C31;&#x4E0D;&#x518D;&#x521B;&#x5EFA;&#xFF0C;&#xFF0C;&#x5E76;&#x4E14;&#x79FB;&#x9664;</span><br><span class="line">      if (this.earlyProxyReferences.remove(cacheKey) != bean) {</span><br><span class="line">         // &#x8BE5;&#x65B9;&#x6CD5;&#x5C06;&#x4F1A;&#x8FD4;&#x56DE;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x5B9E;&#x4F8B;</span><br><span class="line">         // &#x8BE6;&#x7EC6;&#x770B;wrapIfNecessary&#x6E90;&#x7801;</span><br><span class="line">         return wrapIfNecessary(bean, beanName, cacheKey);</span><br><span class="line">      }</span><br><span class="line">   }</span><br><span class="line">   return bean;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="wrapIfNecessary&#x65B9;&#x6CD5;"><a href="#wrapIfNecessary&#x65B9;&#x6CD5;" class="headerlink" title="wrapIfNecessary&#x65B9;&#x6CD5;"></a>wrapIfNecessary&#x65B9;&#x6CD5;</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;protected Object wrapIfNecessary(Object bean, String beanName, Object cacheKey) {</span><br><span class="line">   //&#x5DF2;&#x7ECF;&#x88AB;&#x5904;&#x7406;&#x8FC7;&#xFF08;&#x89E3;&#x6790;&#x5207;&#x9762;&#x65F6;targetSourcedBeans&#x51FA;&#x73B0;&#x8FC7;&#xFF09; &#x5C31;&#x662F;&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#x521B;&#x5EFA;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x903B;&#x8F91;</span><br><span class="line">   if (StringUtils.hasLength(beanName) &amp;&amp; this.targetSourcedBeans.contains(beanName)) {</span><br><span class="line">      return bean;</span><br><span class="line">   }</span><br><span class="line">   //&#x4E0D;&#x9700;&#x8981;&#x589E;&#x5F3A;&#x7684;</span><br><span class="line">   if (Boolean.FALSE.equals(this.advisedBeans.get(cacheKey))) {</span><br><span class="line">      return bean;</span><br><span class="line">   }</span><br><span class="line">   //&#x662F;&#x4E0D;&#x662F;&#x57FA;&#x7840;&#x7684;bean &#x662F;&#x4E0D;&#x662F;&#x9700;&#x8981;&#x8DF3;&#x8FC7;&#x7684; &#x91CD;&#x590D;&#x5224;&#x65AD; &#xFF08; &#x56E0;&#x4E3A;&#x5FAA;&#x73AF;&#x4F9D;&#x8D56;&#x662F;&#x53EF;&#x4EE5;&#x6539;&#x53D8;bean&#x7684;&#xFF0C;&#x5982;&#x679C;&#x628A;bean&#x6539;&#x6210;&#x4E86;advisor&#x5462;&#xFF09;</span><br><span class="line">   if (isInfrastructureClass(bean.getClass()) || shouldSkip(bean.getClass(), beanName)) {</span><br><span class="line">      this.advisedBeans.put(cacheKey, Boolean.FALSE);</span><br><span class="line">      return bean;</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   // &#x6839;&#x636E;&#x5F53;&#x524D;bean&#x627E;&#x5230;&#x5339;&#x914D;&#x7684;advisor</span><br><span class="line">   Object[] specificInterceptors = getAdvicesAndAdvisorsForBean(bean.getClass(), beanName, null);</span><br><span class="line">   // &#x5F53;&#x524D;bean&#x5339;&#x914D;&#x5230;&#x4E86;advisor</span><br><span class="line">   if (specificInterceptors != DO_NOT_PROXY) {</span><br><span class="line">      // &#x6807;&#x8BB0;&#x4E3A;&#x5DF2;&#x5904;&#x7406;</span><br><span class="line">      this.advisedBeans.put(cacheKey, Boolean.TRUE);</span><br><span class="line">      //&#x521B;&#x5EFA;&#x6211;&#x4EEC;&#x7684;&#x771F;&#x6B63;&#x7684;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;</span><br><span class="line">      //&#x8BE6;&#x7EC6;&#x770B;createProxy&#x65B9;&#x6CD5;</span><br><span class="line">      Object proxy = createProxy(</span><br><span class="line">            bean.getClass(), beanName, specificInterceptors, new SingletonTargetSource(bean));</span><br><span class="line">      //&#x52A0;&#x5165;&#x5230;&#x7F13;&#x5B58;</span><br><span class="line">      this.proxyTypes.put(cacheKey, proxy.getClass());</span><br><span class="line">      return proxy;</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   this.advisedBeans.put(cacheKey, Boolean.FALSE);</span><br><span class="line">   return bean;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="createProxy&#x65B9;&#x6CD5;&#x521B;&#x5EFA;&#x52A8;&#x6001;&#x4EE3;&#x7406;"><a href="#createProxy&#x65B9;&#x6CD5;&#x521B;&#x5EFA;&#x52A8;&#x6001;&#x4EE3;&#x7406;" class="headerlink" title="createProxy&#x65B9;&#x6CD5;&#x521B;&#x5EFA;&#x52A8;&#x6001;&#x4EE3;&#x7406;"></a>createProxy&#x65B9;&#x6CD5;&#x521B;&#x5EFA;&#x52A8;&#x6001;&#x4EE3;&#x7406;</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">less&#x590D;&#x5236;&#x4EE3;&#x7801;protected Object createProxy(Class&lt;?&gt; beanClass, @Nullable String beanName,</span><br><span class="line">      @Nullable Object[] specificInterceptors, TargetSource targetSource) {</span><br><span class="line"></span><br><span class="line">   if (this.beanFactory instanceof ConfigurableListableBeanFactory) {</span><br><span class="line">      AutoProxyUtils.exposeTargetClass((ConfigurableListableBeanFactory) this.beanFactory, beanName, beanClass);</span><br><span class="line">   }</span><br><span class="line">   //&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;&#x5DE5;&#x5382;</span><br><span class="line">   ProxyFactory proxyFactory = new ProxyFactory();</span><br><span class="line">   proxyFactory.copyFrom(this);</span><br><span class="line"></span><br><span class="line">   //&#x4E3A;proxyFactory&#x8BBE;&#x7F6E;&#x521B;&#x5EFA;jdk&#x4EE3;&#x7406;&#x8FD8;&#x662F;cglib&#x4EE3;&#x7406;</span><br><span class="line">   // &#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E86; &lt;aop:aspectj-autoproxy proxy-target-class=&quot;true&quot;/&gt;&#x4E0D;&#x4F1A;&#x8FDB;if&#xFF0C;&#x8BF4;&#x660E;&#x5F3A;&#x5236;&#x4F7F;&#x7528;cglib</span><br><span class="line">   if (!proxyFactory.isProxyTargetClass()) {</span><br><span class="line">      // &#x5185;&#x90E8;&#x8BBE;&#x7F6E;&#x7684; &#xFF0C;   &#x914D;&#x7F6E;&#x7C7B;&#x5C31;&#x4F1A;&#x8BBE;&#x7F6E;&#x8FD9;&#x4E2A;&#x5C5E;&#x6027;</span><br><span class="line">      if (shouldProxyTargetClass(beanClass, beanName)) {</span><br><span class="line">         proxyFactory.setProxyTargetClass(true);</span><br><span class="line">      }</span><br><span class="line">      else {</span><br><span class="line">         // &#x68C0;&#x67E5;&#x6709;&#x6CA1;&#x6709;&#x63A5;&#x53E3;</span><br><span class="line">         evaluateProxyInterfaces(beanClass, proxyFactory);</span><br><span class="line">      }</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   //&#x628A;&#x6211;&#x4EEC;&#x7684;specificInterceptors&#x6570;&#x7EC4;&#x4E2D;&#x7684;Advisor&#x8F6C;&#x5316;&#x4E3A;&#x6570;&#x7EC4;&#x5F62;&#x5F0F;&#x7684;</span><br><span class="line">   Advisor[] advisors = buildAdvisors(beanName, specificInterceptors);</span><br><span class="line">   //&#x4E3A;&#x6211;&#x4EEC;&#x7684;&#x4EE3;&#x7406;&#x5DE5;&#x5382;&#x52A0;&#x5165;&#x901A;&#x77E5;&#x5668;&#xFF0C;</span><br><span class="line">   proxyFactory.addAdvisors(advisors);</span><br><span class="line">   //&#x8BBE;&#x7F6E;targetSource&#x5BF9;&#x8C61;</span><br><span class="line">   proxyFactory.setTargetSource(targetSource);</span><br><span class="line">   customizeProxyFactory(proxyFactory);</span><br><span class="line"></span><br><span class="line">   proxyFactory.setFrozen(this.freezeProxy);</span><br><span class="line">   // &#x4EE3;&#x8868;&#x4E4B;&#x524D;&#x662F;&#x5426;&#x7B5B;&#x9009;advise.</span><br><span class="line">   // &#x56E0;&#x4E3A;&#x7EE7;&#x627F;&#x4E86;AbstractAdvisorAutoProxyCreator &#xFF0C; &#x5E76;&#x4E14;&#x4E4B;&#x524D;&#x8C03;&#x7528;&#x4E86;findEligibleAdvisors&#x8FDB;&#x884C;&#x7B5B;&#x9009;&#xFF0C; &#x6240;&#x4EE5;&#x662F;true</span><br><span class="line">   if (advisorsPreFiltered()) {</span><br><span class="line">      proxyFactory.setPreFiltered(true);</span><br><span class="line">   }</span><br><span class="line">   //&#x771F;&#x6B63;&#x7684;&#x521B;&#x5EFA;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;</span><br><span class="line">   return proxyFactory.getProxy(getProxyClassLoader());</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="getProxy&#x65B9;&#x6CD5;"><a href="#getProxy&#x65B9;&#x6CD5;" class="headerlink" title="getProxy&#x65B9;&#x6CD5;"></a>getProxy&#x65B9;&#x6CD5;</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">less&#x590D;&#x5236;&#x4EE3;&#x7801;public Object getProxy(@Nullable ClassLoader classLoader) {</span><br><span class="line">   //createAopProxy() &#x7528;&#x6765;&#x83B7;&#x53D6;&#x6211;&#x4EEC;&#x7684;&#x4EE3;&#x7406;&#x5DE5;&#x5382;</span><br><span class="line">   return createAopProxy().getProxy(classLoader);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="createAopProxy&#x65B9;&#x6CD5;"><a href="#createAopProxy&#x65B9;&#x6CD5;" class="headerlink" title="createAopProxy&#x65B9;&#x6CD5;"></a>createAopProxy&#x65B9;&#x6CD5;</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">arduino&#x590D;&#x5236;&#x4EE3;&#x7801;/**</span><br><span class="line"> *</span><br><span class="line"> * @param config &#x7528;&#x6765;&#x4E3A;&#x6211;&#x4EEC;&#x6307;&#x5B9A;&#x6211;&#x4EEC;advisor&#x4FE1;&#x606F;</span><br><span class="line"> * &#x8BE5;&#x65B9;&#x6CD5;&#x7528;&#x6765;&#x521B;&#x5EFA;&#x6211;&#x4EEC;&#x7684;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;</span><br><span class="line"> * &#x6240;&#x6211;&#x4EEC;&#x7684;targetClass&#x5BF9;&#x8C61;&#x5B9E;&#x73B0;&#x4E86;&#x63A5;&#x53E3;&#xFF0C;&#x4E14;  ProxyTargetClass &#x6CA1;&#x6709;&#x6307;&#x5B9A;&#x5F3A;&#x5236;&#x7684;&#x8D70;cglib&#x4EE3;&#x7406;,&#x90A3;&#x4E48;&#x5C31;&#x662F;&#x521B;&#x5EFA;jdk&#x4EE3;&#x7406;</span><br><span class="line"> * &#x6211;&#x4EEC;&#x4EE3;&#x7406;&#x7684;&#x7C7B;&#x6CA1;&#x6709;&#x5B9E;&#x73B0;&#x63A5;&#x53E3;&#xFF0C;&#x90A3;&#x4E48;&#x4F1A;&#x76F4;&#x63A5;&#x8D70;cglib&#x4EE3;&#x7406;</span><br><span class="line"> * &#x82E5;&#x6211;&#x4EEC;   ProxyTargetClass &#x6307;&#x5B9A;&#x4E3A;false &#x4E14;&#x4EE3;&#x7406;&#x7C7B;&#x662F;&#x63A5;&#x53E3;&#x624D;&#x4F1A;&#x8D70;jdk&#x4EE3;&#x7406; &#x5426;&#x5728;&#x6211;&#x4EEC;&#x8FD8;&#x662F;cglib&#x4EE3;&#x7406;</span><br><span class="line"> * @return</span><br><span class="line"> * @throws AopConfigException</span><br><span class="line"> */</span><br><span class="line">@Override</span><br><span class="line">public AopProxy createAopProxy(AdvisedSupport config) throws AopConfigException {</span><br><span class="line">   //&#x5224;&#x65AD;&#x6211;&#x4EEC;&#x662F;&#x5426;&#x524D;&#x7F6E;&#x6307;&#x5B9A;&#x4F7F;&#x7528;cglib&#x4EE3;&#x7406;ProxyTargetClass =true   &#x6216;&#x8005;&#x6CA1;&#x6709;&#x63A5;&#x53E3;</span><br><span class="line">   if (config.isOptimize() || config.isProxyTargetClass() || hasNoUserSuppliedProxyInterfaces(config)) {</span><br><span class="line">      Class&lt;?&gt; targetClass = config.getTargetClass();</span><br><span class="line">      if (targetClass == null) {</span><br><span class="line">         throw new AopConfigException(&quot;TargetSource cannot determine target class: &quot; +</span><br><span class="line">               &quot;Either an interface or a target is required for proxy creation.&quot;);</span><br><span class="line">      }</span><br><span class="line">      //&#x6240;targetClass&#x662F;&#x63A5;&#x53E3; &#x4F7F;&#x7528;&#x7684;&#x5C31;&#x662F;jdk&#x4EE3;&#x7406;</span><br><span class="line">      if (targetClass.isInterface() || Proxy.isProxyClass(targetClass)) {</span><br><span class="line">         return new JdkDynamicAopProxy(config);</span><br><span class="line">      }</span><br><span class="line">      //cglib&#x4EE3;&#x7406;</span><br><span class="line">      return new ObjenesisCglibAopProxy(config);</span><br><span class="line">   }</span><br><span class="line">   else {</span><br><span class="line">      //&#x52A8;&#x6001;&#x4EE3;&#x7406;</span><br><span class="line">      return new JdkDynamicAopProxy(config);</span><br><span class="line">   }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>getProxy&#x65B9;&#x6CD5;&#x6709;&#x4E24;&#x79CD;&#x5B9E;&#x73B0;&#xFF0C;CGLIB&#x548C;JDK&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x3002;<br><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/3fb74fe609496df2123d9137171eee468b25f8827564ea62daf49fc24c023130" alt="image.png">  </p>
<p>&#x5230;&#x8FD9;&#x91CC;&#x5C31;&#x5DF2;&#x7ECF;&#x521B;&#x5EFA;&#x4E86;AOP&#x52A8;&#x6001;&#x4EE3;&#x7406;&#xFF0C;&#x90A3;&#x4E48;&#x5728;&#x8C03;&#x7528;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x4F1A;&#x8FDB;&#x5165;&#x5230;<code>JdkDynamicAopProxy</code>&#x7684;<code>invoke</code>&#x65B9;&#x6CD5;&#x3002;</p>
<h4 id="invoke&#x65B9;&#x6CD5;"><a href="#invoke&#x65B9;&#x6CD5;" class="headerlink" title="invoke&#x65B9;&#x6CD5;"></a>invoke&#x65B9;&#x6CD5;</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {</span><br><span class="line">   Object oldProxy = null;</span><br><span class="line">   boolean setProxyContext = false;</span><br><span class="line">   //&#x83B7;&#x53D6;&#x5230;&#x6211;&#x4EEC;&#x7684;&#x76EE;&#x6807;&#x5BF9;&#x8C61;</span><br><span class="line">   TargetSource targetSource = this.advised.targetSource;</span><br><span class="line">   Object target = null;</span><br><span class="line"></span><br><span class="line">   try {</span><br><span class="line">      //&#x82E5;&#x6267;&#x884C;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;&#x7684;equals&#x65B9;&#x6CD5;&#x4E0D;&#x9700;&#x8981;&#x4EE3;&#x7406;</span><br><span class="line">      if (!this.equalsDefined &amp;&amp; AopUtils.isEqualsMethod(method)) {</span><br><span class="line">         // The target does not implement the equals(Object) method itself.</span><br><span class="line">         return equals(args[0]);</span><br><span class="line">      }</span><br><span class="line">      //&#x82E5;&#x6267;&#x884C;&#x7684;&#x662F;hashCode&#x65B9;&#x6CD5; &#x4E0D;&#x9700;&#x8981;&#x4EE3;&#x7406;</span><br><span class="line">      else if (!this.hashCodeDefined &amp;&amp; AopUtils.isHashCodeMethod(method)) {</span><br><span class="line">         // The target does not implement the hashCode() method itself.</span><br><span class="line">         return hashCode();</span><br><span class="line">      }</span><br><span class="line">      //&#x82E5;&#x6267;&#x884C;&#x7684;class&#x5BF9;&#x8C61;&#x662F;DecoratingProxy &#x5219;&#x4E0D;&#x4F1A;&#x5BF9;&#x5176;&#x5E94;&#x7528;&#x5207;&#x9762;&#x8FDB;&#x884C;&#x65B9;&#x6CD5;&#x7684;&#x589E;&#x5F3A;&#x3002;&#x8FD4;&#x56DE;&#x6E90;&#x76EE;&#x6807;&#x7C7B;&#x578B;</span><br><span class="line">      else if (method.getDeclaringClass() == DecoratingProxy.class) {</span><br><span class="line">         // There is only getDecoratedClass() declared -&gt; dispatch to proxy config.</span><br><span class="line">         return AopProxyUtils.ultimateTargetClass(this.advised);</span><br><span class="line">      }</span><br><span class="line">      // &#x5982;&#x679C;&#x76EE;&#x6807;&#x5BF9;&#x8C61;&#x5B9E;&#x73B0;&#x7684;Advised&#x63A5;&#x53E3;&#xFF0C;&#x5219;&#x4E0D;&#x4F1A;&#x5BF9;&#x5176;&#x5E94;&#x7528;&#x5207;&#x9762;&#x8FDB;&#x884C;&#x65B9;&#x6CD5;&#x7684;&#x589E;&#x5F3A;&#x3002; &#x76F4;&#x63A5;&#x6267;&#x884C;&#x65B9;&#x6CD5;</span><br><span class="line">      else if (!this.advised.opaque &amp;&amp; method.getDeclaringClass().isInterface() &amp;&amp;</span><br><span class="line">            method.getDeclaringClass().isAssignableFrom(Advised.class)) {</span><br><span class="line">         // Service invocations on ProxyConfig with the proxy config...</span><br><span class="line">         return AopUtils.invokeJoinpointUsingReflection(this.advised, method, args);</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      Object retVal;</span><br><span class="line"></span><br><span class="line">      /**</span><br><span class="line">       * &#x8FD9;&#x4E2A;&#x914D;&#x7F6E;&#x5F88;&#x91CD;&#x8981;&#x5F88;&#x5B9E;&#x7528;&#x3010;&#x66B4;&#x9732;&#x6211;&#x4EEC;&#x7684;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;&#x5230;&#x7EBF;&#x7A0B;&#x53D8;&#x91CF;&#x4E2D;&#x3011;&#x9700;&#x8981;&#x642D;&#x914D;@EnableAspectJAutoProxy(exposeProxy = true)</span><br><span class="line">       * &#x4E00;&#x8D77;&#x4F7F;&#x7528;.</span><br><span class="line">       * &#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x7684;aop&#x4E2D; multi&#x548C; mode&#x65B9;&#x6CD5;&#x90FD;&#x662F;&#x88AB;&#x5207;&#x5165;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x4F46;&#x662F;&#x5728;&#x5207;&#x5165;&#x7684;&#x65B9;&#x6CD5;&#x4E2D;&#x901A;&#x8FC7;</span><br><span class="line">       * this&#x6765;&#x8C03;&#x7528;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#x7684;&#x65F6;&#x5019;,&#x90A3;&#x4E48;&#x8BE5;&#x65B9;&#x6CD5;&#x5C31;&#x4E0D;&#x4F1A;&#x88AB;&#x4EE3;&#x7406;&#x6267;&#x884C;&#xFF0C;&#x800C;&#x662F;&#x901A;&#x8FC7;&#x65B9;&#x6CD5;&#x5185;&#x90E8;&#x6267;&#x884C;</span><br><span class="line">       public int mod(int numA,int numB){</span><br><span class="line">         System.out.println(&quot;&#x6267;&#x884C;&#x76EE;&#x6807;&#x65B9;&#x6CD5;:mod&quot;);</span><br><span class="line">         int retVal = ((Calculate) AopContext.currentProxy()).add(numA,numB);</span><br><span class="line">       return retVal%numA;</span><br><span class="line">       }</span><br><span class="line">       *&#x8FD8;&#x6709;&#x7684;&#x5C31;&#x662F;&#x4E8B;&#x52A1;&#x65B9;&#x6CD5;&#x8C03;&#x7528;&#x4E8B;&#x52A1;&#x65B9;&#x6CD5;&#x7684;&#x65F6;&#x5019; &#x4E5F;&#x9700;&#x8981;&#x8FD9;&#x6837;&#x6765;&#x793E;&#x4F1A;</span><br><span class="line">       */</span><br><span class="line">      if (this.advised.exposeProxy) {</span><br><span class="line">         //&#x628A;&#x6211;&#x4EEC;&#x7684;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;&#x66B4;&#x9732;&#x5230;&#x7EBF;&#x7A0B;&#x53D8;&#x91CF;&#x4E2D;</span><br><span class="line">         oldProxy = AopContext.setCurrentProxy(proxy);</span><br><span class="line">         setProxyContext = true;</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      //&#x83B7;&#x53D6;&#x6211;&#x4EEC;&#x7684;&#x76EE;&#x6807;&#x5BF9;&#x8C61;</span><br><span class="line">      target = targetSource.getTarget();</span><br><span class="line">      //&#x83B7;&#x53D6;&#x6211;&#x4EEC;&#x76EE;&#x6807;&#x5BF9;&#x8C61;&#x7684;class</span><br><span class="line">      Class&lt;?&gt; targetClass = (target != null ? target.getClass() : null);</span><br><span class="line"></span><br><span class="line">      //&#x628A;&#x6211;&#x4EEC;&#x7684;aop&#x7684;advisor &#x5168;&#x90E8;&#x8F6C;&#x5316;&#x4E3A;&#x62E6;&#x622A;&#x5668;&#xFF0C; &#x901A;&#x8FC7;&#x8D23;&#x4EFB;&#x94FE;&#x6A21;&#x5F0F; &#x4F9D;&#x6B64;&#x8C03;&#x7528;</span><br><span class="line">      List&lt;Object&gt; chain = this.advised.getInterceptorsAndDynamicInterceptionAdvice(method, targetClass);</span><br><span class="line"></span><br><span class="line">      //&#x52A0;&#x5165;&#x6211;&#x4EEC;&#x7684;&#x62E6;&#x622A;&#x5668;&#x94FE;&#x4E3A;&#x7A7A;</span><br><span class="line">      if (chain.isEmpty()) {</span><br><span class="line">         //&#x901A;&#x8FC7;&#x53CD;&#x5C04;&#x76F4;&#x63A5;&#x8C03;&#x7528;&#x6267;&#x884C;</span><br><span class="line">         Object[] argsToUse = AopProxyUtils.adaptArgumentsIfNecessary(method, args);</span><br><span class="line">         retVal = AopUtils.invokeJoinpointUsingReflection(target, method, argsToUse);</span><br><span class="line">      }</span><br><span class="line">      else {</span><br><span class="line">         //&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#x8C03;&#x7528;&#x5BF9;&#x8C61;</span><br><span class="line">         MethodInvocation invocation =</span><br><span class="line">               new ReflectiveMethodInvocation(proxy, target, method, args, targetClass, chain);</span><br><span class="line">         //&#x8C03;&#x7528;&#x6267;&#x884C;</span><br><span class="line">         retVal = invocation.proceed();</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      // Massage return value if necessary.</span><br><span class="line">      Class&lt;?&gt; returnType = method.getReturnType();</span><br><span class="line">      if (retVal != null &amp;&amp; retVal == target &amp;&amp;</span><br><span class="line">            returnType != Object.class &amp;&amp; returnType.isInstance(proxy) &amp;&amp;</span><br><span class="line">            !RawTargetAccess.class.isAssignableFrom(method.getDeclaringClass())) {</span><br><span class="line">         // Special case: it returned &quot;this&quot; and the return type of the method</span><br><span class="line">         // is type-compatible. Note that we can&apos;t help if the target sets</span><br><span class="line">         // a reference to itself in another returned object.</span><br><span class="line">         retVal = proxy;</span><br><span class="line">      }</span><br><span class="line">      else if (retVal == null &amp;&amp; returnType != Void.TYPE &amp;&amp; returnType.isPrimitive()) {</span><br><span class="line">         throw new AopInvocationException(</span><br><span class="line">               &quot;Null return value from advice does not match primitive return type for: &quot; + method);</span><br><span class="line">      }</span><br><span class="line">      return retVal;</span><br><span class="line">   }</span><br><span class="line">   finally {</span><br><span class="line">      if (target != null &amp;&amp; !targetSource.isStatic()) {</span><br><span class="line">         // Must have come from TargetSource.</span><br><span class="line">         targetSource.releaseTarget(target);</span><br><span class="line">      }</span><br><span class="line">      if (setProxyContext) {</span><br><span class="line">         // Restore old proxy.</span><br><span class="line">         AopContext.setCurrentProxy(oldProxy);</span><br><span class="line">      }</span><br><span class="line">   }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x901A;&#x8FC7;&#x8D23;&#x4EFB;&#x94FE;&#x8C03;&#x7528;&#x3002;</p>
<h4 id="ReflectiveMethodInvocation&#x7684;proceed&#x65B9;&#x6CD5;"><a href="#ReflectiveMethodInvocation&#x7684;proceed&#x65B9;&#x6CD5;" class="headerlink" title="ReflectiveMethodInvocation&#x7684;proceed&#x65B9;&#x6CD5;"></a><code>ReflectiveMethodInvocation</code>&#x7684;proceed&#x65B9;&#x6CD5;</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;public Object proceed() throws Throwable {</span><br><span class="line">   //&#x4ECE;-1&#x5F00;&#x59CB;,&#x7ED3;&#x675F;&#x6761;&#x4EF6;&#x6267;&#x884C;&#x76EE;&#x6807;&#x65B9;&#x6CD5;&#x662F;&#x4E0B;&#x6807;=&#x62E6;&#x622A;&#x5668;&#x7684;&#x957F;&#x5EA6;-1(&#x6267;&#x884C;&#x5230;&#x4E86;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x62E6;&#x622A;&#x5668;&#x7684;&#x65F6;&#x5019;)</span><br><span class="line">   if (this.currentInterceptorIndex == this.interceptorsAndDynamicMethodMatchers.size() - 1) {</span><br><span class="line">      return invokeJoinpoint();</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   /**</span><br><span class="line">    * &#x83B7;&#x53D6;&#x7B2C;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#x62E6;&#x622A;&#x5668;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x524D;++</span><br><span class="line">    */</span><br><span class="line">   Object interceptorOrInterceptionAdvice =</span><br><span class="line">         this.interceptorsAndDynamicMethodMatchers.get(++this.currentInterceptorIndex);</span><br><span class="line">   if (interceptorOrInterceptionAdvice instanceof InterceptorAndDynamicMethodMatcher) {</span><br><span class="line">      // Evaluate dynamic method matcher here: static part will already have</span><br><span class="line">      // been evaluated and found to match.</span><br><span class="line">      InterceptorAndDynamicMethodMatcher dm =</span><br><span class="line">            (InterceptorAndDynamicMethodMatcher) interceptorOrInterceptionAdvice;</span><br><span class="line">      if (dm.methodMatcher.matches(this.method, this.targetClass, this.arguments)) {</span><br><span class="line">         return dm.interceptor.invoke(this);</span><br><span class="line">      }</span><br><span class="line">      else {</span><br><span class="line">         // Dynamic matching failed.</span><br><span class="line">         // Skip this interceptor and invoke the next in the chain.</span><br><span class="line">         return proceed();</span><br><span class="line">      }</span><br><span class="line">   }</span><br><span class="line">   else {</span><br><span class="line">      //&#x5728;&#x8FD9;&#x4E2A;&#x5730;&#x65B9;&#x9700;&#x8981;&#x6CE8;&#x610F;&#xFF0C;&#x62B5;&#x7528;&#x7B2C;&#x4E00;&#x4E2A;&#x62E6;&#x622A;&#x5668;&#x7684;invoke&#x65B9;&#x6CD5;&#xFF0C;&#x4F20;&#x5165;&#x7684;&#x662F;this &#x5F53;&#x524D;&#x7684;&#x65B9;&#x6CD5;&#x62E6;&#x622A;&#x5668;&#x5BF9;&#x8C61;</span><br><span class="line">      return ((MethodInterceptor) interceptorOrInterceptionAdvice).invoke(this);</span><br><span class="line">   }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/0853b55e2843088ed9d03b40c79835b0.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7033009195154669576.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7033009195154669576.html" itemprop="url">Go语言学习查缺补漏ing Day3</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-11-21T21:08:56+08:00">
                2021-11-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x300C;&#x8FD9;&#x662F;&#x6211;&#x53C2;&#x4E0E;11&#x6708;&#x66F4;&#x6587;&#x6311;&#x6218;&#x7684;&#x7B2C;21&#x5929;&#xFF0C;&#x6D3B;&#x52A8;&#x8BE6;&#x60C5;&#x67E5;&#x770B;&#xFF1A;<a href="https://dev.newban.cn/7023643374569816095/">2021&#x6700;&#x540E;&#x4E00;&#x6B21;&#x66F4;&#x6587;&#x6311;&#x6218;</a>&#x300D;&#x3002;</p>
<h3 id="Go&#x8BED;&#x8A00;&#x5B66;&#x4E60;&#x67E5;&#x7F3A;&#x8865;&#x6F0F;ing-Day3"><a href="#Go&#x8BED;&#x8A00;&#x5B66;&#x4E60;&#x67E5;&#x7F3A;&#x8865;&#x6F0F;ing-Day3" class="headerlink" title="Go&#x8BED;&#x8A00;&#x5B66;&#x4E60;&#x67E5;&#x7F3A;&#x8865;&#x6F0F;ing Day3"></a>Go&#x8BED;&#x8A00;&#x5B66;&#x4E60;&#x67E5;&#x7F3A;&#x8865;&#x6F0F;ing Day3</h3><p><strong>&#x672C;&#x6587;&#x6536;&#x5F55;&#x4E8E;&#x6211;&#x7684;&#x4E13;&#x680F;&#xFF1A;<a href="/external_links/64e9e960156a1426fbcbb92e6f6f2548.html" target="blank" rel="noopener">&#x300A;&#x8BA9;&#x6211;&#x4EEC;&#x4E00;&#x8D77;Golang&#x300B;</a></strong></p>
<h4 id="&#x4E00;&#x3001;&#x7ED3;&#x6784;&#x4F53;&#x7684;&#x6BD4;&#x8F83;&#x95EE;&#x9898;"><a href="#&#x4E00;&#x3001;&#x7ED3;&#x6784;&#x4F53;&#x7684;&#x6BD4;&#x8F83;&#x95EE;&#x9898;" class="headerlink" title="&#x4E00;&#x3001;&#x7ED3;&#x6784;&#x4F53;&#x7684;&#x6BD4;&#x8F83;&#x95EE;&#x9898;"></a>&#x4E00;&#x3001;&#x7ED3;&#x6784;&#x4F53;&#x7684;&#x6BD4;&#x8F83;&#x95EE;&#x9898;</h4><p>&#x6211;&#x4EEC;&#x5148;&#x6765;&#x770B;&#x4E00;&#x6BB5;&#x5173;&#x4E8E;&#x7ED3;&#x6784;&#x4F53;&#x7684;&#x6BD4;&#x8F83;&#x7684;&#x4EE3;&#x7801;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">go&#x590D;&#x5236;&#x4EE3;&#x7801;package main</span><br><span class="line">&#x200B;</span><br><span class="line">import &quot;fmt&quot;</span><br><span class="line">&#x200B;</span><br><span class="line">func main() {</span><br><span class="line">    struct1 := struct {</span><br><span class="line">        age &#xA0;int</span><br><span class="line">        name string</span><br><span class="line">        sex bool</span><br><span class="line">    }{age: 18, name: &quot;&#x640F;&#x8FBE;&quot;, sex:false}</span><br><span class="line"> &#xA0; &#xA0;</span><br><span class="line">    struct2 := struct {</span><br><span class="line">        age &#xA0;int</span><br><span class="line">        name string</span><br><span class="line">        sex bool</span><br><span class="line">    }{age: 21, name: &quot;Regan Yue&quot;, sex:true}</span><br><span class="line"> &#xA0; &#xA0;</span><br><span class="line">    if struct1 == struct2 {</span><br><span class="line">        fmt.Println(&quot;struct1 == struct2&quot;)</span><br><span class="line">    }</span><br><span class="line">&#x200B;</span><br><span class="line">    struct3 := struct {</span><br><span class="line">        age int</span><br><span class="line">        people map[string]bool</span><br><span class="line">    }{age: 31, people: map[string]bool{&quot;&#x640F;&#x8FBE;&quot;: false}}</span><br><span class="line"> &#xA0; &#xA0;</span><br><span class="line">    struct4 := struct {</span><br><span class="line">        age int</span><br><span class="line">        people map[string]bool</span><br><span class="line">    }{age: 21, people: map[string]bool{&quot;ReganYue&quot;: false}}</span><br><span class="line"> &#xA0; &#xA0;</span><br><span class="line">    if struct3 == struct4{</span><br><span class="line">        fmt.Println(&quot;struct3 == struct4&quot;)</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4F60;&#x89C9;&#x5F97;&#x7F16;&#x8BD1;&#x65F6;&#x4F1A;&#x62A5;&#x9519;&#x5417;&#xFF1F;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/cac5f522a59ceadf31ccf372a807f19af3fb4a48d79bbb58306c3d239e2c8f56" alt="image-20211121193059286"></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/58e7266eea48c156a01fa3f9cfc88028bd631f618d2cfb507f7efd2c002d4f3a" alt="image-20211121193143297"></p>
<p>&#x554A;&#x8FD9;&#xFF0C;&#x51FA;&#x5927;&#x95EE;&#x9898;&#x3002;&#x5B83;&#x8BF4;&#x5305;&#x542B;map&#x7684;&#x7ED3;&#x6784;&#x4F53;&#x4E0D;&#x80FD;&#x88AB;&#x6BD4;&#x8F83;&#x3002;</p>
<p>&#x662F;&#x7684;&#xFF0C;&#x53EA;&#x6709;&#x5305;&#x542B;bool&#x7C7B;&#x578B;&#x3001;&#x6570;&#x503C;&#x578B;&#x3001;&#x5B57;&#x7B26;&#x4E32;&#x3001;&#x6307;&#x9488;&#x3001;&#x6570;&#x7EC4;&#x7B49;&#x7C7B;&#x578B;&#x7684;&#x7ED3;&#x6784;&#x4F53;&#x624D;&#x80FD;&#x6BD4;&#x8F83;&#xFF0C;&#x800C;&#x5305;&#x542B;slice&#x3001;map&#x3001;&#x51FD;&#x6570;&#x5176;&#x4E2D;&#x4EFB;&#x4E00;&#x9879;&#x7684;&#x7ED3;&#x6784;&#x4F53;&#x5747;&#x4E0D;&#x80FD;&#x505A;&#x6BD4;&#x8F83;&#x3002;</p>
<p>&#x8FD8;&#x6709;&#x51E0;&#x70B9;&#x503C;&#x5F97;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF1A;</p>
<ol>
<li>&#x7ED3;&#x6784;&#x4F53;&#x4E4B;&#x95F4;&#x53EA;&#x80FD;&#x6BD4;&#x8F83;&#x5B83;&#x4EEC;&#x662F;&#x5426;&#x76F8;&#x7B49;&#xFF0C;&#x800C;&#x4E0D;&#x80FD;&#x6BD4;&#x8F83;&#x5B83;&#x4EEC;&#x7684;&#x5927;&#x5C0F;&#x3002;</li>
<li>&#x53EA;&#x6709;&#x6240;&#x6709;&#x5C5E;&#x6027;&#x90FD;&#x76F8;&#x7B49;&#x800C;&#x5C5E;&#x6027;&#x987A;&#x5E8F;&#x90FD;&#x4E00;&#x81F4;&#x7684;&#x7ED3;&#x6784;&#x4F53;&#x624D;&#x80FD;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#x3002;</li>
</ol>
<h4 id="&#x4E8C;&#x3001;&#x901A;&#x8FC7;&#x6307;&#x9488;&#x53D8;&#x91CF;&#x8BBF;&#x95EE;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x7684;&#x51E0;&#x79CD;&#x65B9;&#x5F0F;"><a href="#&#x4E8C;&#x3001;&#x901A;&#x8FC7;&#x6307;&#x9488;&#x53D8;&#x91CF;&#x8BBF;&#x95EE;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x7684;&#x51E0;&#x79CD;&#x65B9;&#x5F0F;" class="headerlink" title="&#x4E8C;&#x3001;&#x901A;&#x8FC7;&#x6307;&#x9488;&#x53D8;&#x91CF;&#x8BBF;&#x95EE;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x7684;&#x51E0;&#x79CD;&#x65B9;&#x5F0F;"></a>&#x4E8C;&#x3001;&#x901A;&#x8FC7;&#x6307;&#x9488;&#x53D8;&#x91CF;&#x8BBF;&#x95EE;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x7684;&#x51E0;&#x79CD;&#x65B9;&#x5F0F;</h4><p>&#x5148;&#x770B;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">go&#x590D;&#x5236;&#x4EE3;&#x7801;package main</span><br><span class="line">&#x200B;</span><br><span class="line">import &quot;fmt&quot;</span><br><span class="line">&#x200B;</span><br><span class="line">func main() {</span><br><span class="line">    s1 := struct {</span><br><span class="line">        name string</span><br><span class="line">        age int64</span><br><span class="line">    }{name:&quot;Regan&quot;,age:21}</span><br><span class="line">    s2 := &amp;s1</span><br><span class="line">    fmt.Println(s2.name)</span><br><span class="line">    fmt.Println((*s2).name)</span><br><span class="line">    fmt.Println((&amp;s2).name)</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4F60;&#x89C9;&#x5F97;&#x54EA;&#x91CC;&#x4F1A;&#x62A5;&#x9519;&#xFF1F;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/1e90e4802459db98bd9921ee8f00563e686bfcc756a41db9fd686df009e1383a" alt="image-20211121194638463"></p>
<p>&#x54E6;&#xFF01;&#x662F;(&amp;s2).name&#x6709;&#x70B9;&#x95EE;&#x9898;&#x2026;..</p>
<p>&#x56E0;&#x4E3A;&amp;&#x662F;&#x53D6;&#x5730;&#x5740;&#x7B26;&#xFF0C;*&#x662F;&#x6307;&#x9488;&#x89E3;&#x5F15;&#x7528;&#x7B26;&#x3002;&#x6240;&#x4EE5;&#x5C06;&#x6307;&#x9488;&#x89E3;&#x5F15;&#x7528;&#x624D;&#x80FD;&#x8BBF;&#x95EE;&#x5230;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x3002;</p>
<p>&#x4F60;&#x4F1A;&#x597D;&#x5947;&#x4E3A;&#x4EC0;&#x4E48;&#x6307;&#x9488;&#x4E0D;&#x89E3;&#x5F15;&#x7528;&#x4E5F;&#x80FD;&#x83B7;&#x53D6;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x5417;&#xFF1F;&#x5176;&#x5B9E;&#x662F;&#x8FDB;&#x884C;&#x89E3;&#x5F15;&#x7528;&#x4E86;&#xFF0C;&#x8FD9;&#x5C31;&#x662F;&#x6211;&#x4EEC;GO&#x8BED;&#x8A00;&#x7684;&#x5F3A;&#x5927;&#x4E4B;&#x5904;&#x4E86;&#xFF0C;&#x5B83;&#x80FD;&#x591F;&#x81EA;&#x52A8;&#x8FDB;&#x884C;&#x89E3;&#x5F15;&#x7528;&#xFF0C;&#x4F46;&#x662F;&#x9057;&#x61BE;&#x7684;&#x662F;&#xFF0C;&#x53EA;&#x80FD;&#x89E3;&#x5F15;&#x7528;&#x4E59;&#x7EA7;&#x6307;&#x9488;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x591A;&#x7EA7;&#x6307;&#x9488;&#xFF0C;&#x5C31;&#x5F97;&#x9760;&#x4F60;&#x81EA;&#x5DF1;&#x4E86;&#x3002;</p>
<h4 id="&#x4E09;&#x3001;&#x7C7B;&#x578B;&#x522B;&#x540D;&#x548C;&#x7C7B;&#x578B;&#x5B9A;&#x4E49;&#x7684;&#x533A;&#x522B;"><a href="#&#x4E09;&#x3001;&#x7C7B;&#x578B;&#x522B;&#x540D;&#x548C;&#x7C7B;&#x578B;&#x5B9A;&#x4E49;&#x7684;&#x533A;&#x522B;" class="headerlink" title="&#x4E09;&#x3001;&#x7C7B;&#x578B;&#x522B;&#x540D;&#x548C;&#x7C7B;&#x578B;&#x5B9A;&#x4E49;&#x7684;&#x533A;&#x522B;"></a>&#x4E09;&#x3001;&#x7C7B;&#x578B;&#x522B;&#x540D;&#x548C;&#x7C7B;&#x578B;&#x5B9A;&#x4E49;&#x7684;&#x533A;&#x522B;</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">go&#x590D;&#x5236;&#x4EE3;&#x7801;package main</span><br><span class="line">&#x200B;</span><br><span class="line">import &quot;fmt&quot;</span><br><span class="line">&#x200B;</span><br><span class="line">type Int1 int</span><br><span class="line">type Int2 = int</span><br><span class="line">&#x200B;</span><br><span class="line">func main() {</span><br><span class="line">    var i = 0</span><br><span class="line">    var i1 Int1 = i</span><br><span class="line">    var i2 Int2= i</span><br><span class="line">    fmt.Println(i, i1, i2)</span><br><span class="line">}</span><br><span class="line">&#x200B;</span><br></pre></td></tr></table></figure>

<p>&#x662F;&#x4E0D;&#x662F;&#x4E00;&#x773C;&#x5C31;&#x770B;&#x51FA;&#x6765;&#x95EE;&#x9898;&#x6240;&#x5728;&#x4E86;&#xFF1F;</p>
<p>&#x4E0D;&#x8FC7;&#x4ED6;&#x4EEC;&#x653E;&#x5728;&#x4E00;&#x8D77;&#xFF0C;&#x4F60;&#x80FD;&#x9A6C;&#x4E0A;&#x5206;&#x522B;&#x54EA;&#x4E2A;&#x662F;&#x7C7B;&#x578B;&#x522B;&#x540D;&#xFF0C;&#x54EA;&#x4E2A;&#x662F;&#x7C7B;&#x578B;&#x5B9A;&#x4E49;&#x5417;&#xFF1F;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go&#x590D;&#x5236;&#x4EE3;&#x7801;type Int1 int</span><br></pre></td></tr></table></figure>

<p>&#x662F;&#x5B9A;&#x4E49;&#x4E86;&#x57FA;&#x4E8E;int&#x7C7B;&#x578B;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x65B0;&#x7C7B;&#x578B;&#xFF0C;&#x800C;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go&#x590D;&#x5236;&#x4EE3;&#x7801;type Int2 = int</span><br></pre></td></tr></table></figure>

<p>&#x662F;&#x5C06;Int2&#x4F5C;&#x4E3A;int&#x7C7B;&#x578B;&#x7684;&#x522B;&#x540D;&#x3002;</p>
<p>&#x6240;&#x4EE5;&#x5C06;&#x4F1A;&#x62A5;&#x5982;&#x4E0B;&#x9519;&#x8BEF;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/1c93e6e08ef3d2101eb9e63deac49e4a75b116210ed638f8c10c2a2977d10cb7" alt="image-20211121201235626"></p>
<p>&#x8FD9;&#x662F;&#x56E0;&#x4E3A;Go&#x662F;&#x5F3A;&#x7C7B;&#x578B;&#x8BED;&#x8A00;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5C06;int&#x5F3A;&#x5236;&#x8F6C;&#x6362;Int1&#x7C7B;&#x578B;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x7F16;&#x8BD1;&#x4E86;&#x3002;</p>
<h4 id="&#x56DB;&#x3001;&#x5207;&#x7247;&#x7684;&#x4E00;&#x4E2A;&#x6CE8;&#x610F;&#x4E8B;&#x9879;"><a href="#&#x56DB;&#x3001;&#x5207;&#x7247;&#x7684;&#x4E00;&#x4E2A;&#x6CE8;&#x610F;&#x4E8B;&#x9879;" class="headerlink" title="&#x56DB;&#x3001;&#x5207;&#x7247;&#x7684;&#x4E00;&#x4E2A;&#x6CE8;&#x610F;&#x4E8B;&#x9879;"></a>&#x56DB;&#x3001;&#x5207;&#x7247;&#x7684;&#x4E00;&#x4E2A;&#x6CE8;&#x610F;&#x4E8B;&#x9879;</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">go&#x590D;&#x5236;&#x4EE3;&#x7801;package main</span><br><span class="line">&#x200B;</span><br><span class="line">import &quot;fmt&quot;</span><br><span class="line">&#x200B;</span><br><span class="line">func main() {</span><br><span class="line">    a := []int{7, 8, 9}</span><br><span class="line">    fmt.Printf(&quot;%+v\n&quot;, a)</span><br><span class="line">    fun1(a)</span><br><span class="line">    fmt.Printf(&quot;%+v\n&quot;, a)</span><br><span class="line">    fun2(a)</span><br><span class="line">    fmt.Printf(&quot;%+v\n&quot;, a)</span><br><span class="line">}</span><br><span class="line">func fun1(a []int) {</span><br><span class="line">    a = append(a, 5)</span><br><span class="line">}</span><br><span class="line">func fun2(a []int) {</span><br><span class="line">    a[0] = 8</span><br><span class="line">}</span><br><span class="line">&#x200B;</span><br></pre></td></tr></table></figure>

<p>&#x770B;&#x4E00;&#x770B;&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">csharp&#x590D;&#x5236;&#x4EE3;&#x7801;[7 8 9]</span><br><span class="line">[7 8 9]</span><br><span class="line">[8 8 9]</span><br></pre></td></tr></table></figure>

<p>&#x4EC0;&#x4E48;&#xFF1F;&#xFF01;&#xFF01; &#x6CA1;&#x6709;append&#x8FDB;&#x53BB;&#xFF1F;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;append&#x53EF;&#x80FD;&#x4F1A;&#x5BFC;&#x81F4;&#x5185;&#x5B58;&#x7684;&#x91CD;&#x65B0;&#x5206;&#x914D;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x4E0D;&#x80FD;&#x518D;&#x786E;&#x5B9A;append&#x4E4B;&#x524D;&#x7684;&#x5207;&#x7247;&#x4E0E;&#x4E4B;&#x540E;&#x7684;&#x5207;&#x7247;&#x662F;&#x4E0D;&#x662F;&#x5F15;&#x7528;&#x7684;&#x76F8;&#x540C;&#x7684;&#x5185;&#x5B58;&#x7A7A;&#x95F4;&#x3002;</p>
<p>&#x6240;&#x4EE5;&#x8BF4;&#x8FD9;&#x4E2A;&#x6267;&#x884C;fun1&#x6765;append&#x4E4B;&#x540E;&#x7684;&#x5207;&#x7247;a&#x4E0E;&#x5916;&#x9762;&#x7684;&#x5207;&#x7247;a&#x4E0D;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#xFF0C;&#x6240;&#x4EE5;&#x67E5;&#x770B;&#x5916;&#x9762;&#x7684;a&#xFF0C;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x5916;&#x9762;&#x5207;&#x7247;&#x7684;&#x5185;&#x5BB9;&#x6CA1;&#x6709;&#x6539;&#x53D8;&#x3002;</p>
<h4 id="&#x4E94;&#x3001;Golang&#x5B57;&#x7B26;&#x4E32;&#x8FDE;&#x63A5;&#x7684;&#x51E0;&#x79CD;&#x65B9;&#x5F0F;"><a href="#&#x4E94;&#x3001;Golang&#x5B57;&#x7B26;&#x4E32;&#x8FDE;&#x63A5;&#x7684;&#x51E0;&#x79CD;&#x65B9;&#x5F0F;" class="headerlink" title="&#x4E94;&#x3001;Golang&#x5B57;&#x7B26;&#x4E32;&#x8FDE;&#x63A5;&#x7684;&#x51E0;&#x79CD;&#x65B9;&#x5F0F;"></a>&#x4E94;&#x3001;Golang&#x5B57;&#x7B26;&#x4E32;&#x8FDE;&#x63A5;&#x7684;&#x51E0;&#x79CD;&#x65B9;&#x5F0F;</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">go&#x590D;&#x5236;&#x4EE3;&#x7801;package main</span><br><span class="line">&#x200B;</span><br><span class="line">import (</span><br><span class="line">    &quot;bytes&quot;</span><br><span class="line">    &quot;fmt&quot;</span><br><span class="line">    &quot;strings&quot;</span><br><span class="line">)</span><br><span class="line">&#x200B;</span><br><span class="line">func main() {</span><br><span class="line">    str1 := &quot;abc&quot;</span><br><span class="line">    str2 := &quot;def&quot;</span><br><span class="line">    strs := []string{&quot;Regan&quot;,&quot;Yue&quot;}</span><br><span class="line">    fmt.Println(str1+str2)</span><br><span class="line">    sprintf := fmt.Sprintf(&quot;abc%s&quot;, &quot;accc&quot;)</span><br><span class="line">    fmt.Println(sprintf)</span><br><span class="line">    join := strings.Join(strs, &quot;-&quot;)</span><br><span class="line">    fmt.Println(join)</span><br><span class="line">&#x200B;</span><br><span class="line">    var buffer bytes.Buffer</span><br><span class="line">    buffer.WriteString(&quot;hello&quot;)</span><br><span class="line">    buffer.WriteString(&quot;world&quot;)</span><br><span class="line">    fmt.Println(buffer.String())</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x91CC;&#x63D0;&#x5230;&#x4E86;&#x56DB;&#x79CD;&#x8FDE;&#x63A5;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x7B2C;&#x4E00;&#x79CD;&#x5229;&#x7528;+&#x53F7;&#x76F4;&#x63A5;&#x8FDE;&#x63A5;&#xFF0C;&#x7B2C;&#x4E8C;&#x79CD;&#x5229;&#x7528; fmt.Sprintf()&#xFF0C;&#x7B2C;&#x4E09;&#x79CD;&#x662F;&#x5229;&#x7528;strings.Join()&#xFF0C;&#x7B2C;&#x56DB;&#x79CD;&#x662F;&#x5229;&#x7528;buffer.WriteString()&#x6765;&#x8FDB;&#x884C;&#x5B57;&#x7B26;&#x4E32;&#x8FDE;&#x63A5;&#x3002;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/2cf910d6668bacd656a2a99d5236a60b.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7033008675291824135.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7033008675291824135.html" itemprop="url">Python类中的单例模式和描述符 单例模式： 描述符</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-11-21T21:06:26+08:00">
                2021-11-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x300C;&#x8FD9;&#x662F;&#x6211;&#x53C2;&#x4E0E;11&#x6708;&#x66F4;&#x6587;&#x6311;&#x6218;&#x7684;&#x7B2C;20&#x5929;&#xFF0C;&#x6D3B;&#x52A8;&#x8BE6;&#x60C5;&#x67E5;&#x770B;&#xFF1A;<a href="https://dev.newban.cn/7023643374569816095/">2021&#x6700;&#x540E;&#x4E00;&#x6B21;&#x66F4;&#x6587;&#x6311;&#x6218;</a>&#x300D;</p>
<p>new&#x65B9;&#x6CD5;&#x4F1A;&#x5F00;&#x8F9F;&#x7A7A;&#x95F4;  </p>
<p>&#x6BCF;&#x6B21;&#x5B9E;&#x4F8B;&#x5316;&#xFF0C;&#x8FD9;&#x4E2A;new&#x65B9;&#x6CD5;&#x90FD;&#x4F1A;&#x5F00;&#x8F9F;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x7A7A;&#x95F4;  </p>
<p>&#x53EF;&#x4E0D;&#x53EF;&#x4EE5;&#x8BA9;&#x8FD9;new&#x65B9;&#x6CD5;&#x53EA;&#x5F00;&#x8F9F;&#x4E00;&#x4E2A;&#x7A7A;&#x95F4;&#xFF1A;&#xFF1A;&#xFF1A;&#x5355;&#x4F8B;&#x6A21;&#x5F0F;</p>
<h1 id="&#x5355;&#x4F8B;&#x6A21;&#x5F0F;&#xFF1A;"><a href="#&#x5355;&#x4F8B;&#x6A21;&#x5F0F;&#xFF1A;" class="headerlink" title="&#x5355;&#x4F8B;&#x6A21;&#x5F0F;&#xFF1A;"></a>&#x5355;&#x4F8B;&#x6A21;&#x5F0F;&#xFF1A;</h1><p>&#x63D0;&#x524D;&#x5F15;&#x5165;&#x4E00;&#x4E9B;&#x5C0F;&#x77E5;&#x8BC6;&#x70B9;&#xFF1A;&#xFF1A;&#xFF1A;  </p>
<p>&#x7B2C;&#x4E00;&#x4E2A;&#xFF1A;</p>
<p>hasattr() #has attribute  </p>
<p>hasattr() &#x51FD;&#x6570;&#x7528;&#x4E8E;&#x5224;&#x65AD;&#x5BF9;&#x8C61;&#x662F;&#x5426;&#x5305;&#x542B;&#x5BF9;&#x5E94;&#x7684;&#x5C5E;&#x6027;\  </p>
<p>hasattr(object(&#x5BF9;&#x8C61;),name(&#x201C;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x5C5E;&#x6027;&#x540D;&#x201D;))  </p>
<p>&#x8FD4;&#x56DE;True(&#x6709;&#x7684;&#x65F6;&#x5019;) False&#xFF08;&#x6CA1;&#x6709;&#x7684;&#x65F6;&#x5019;&#xFF09;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">python&#x590D;&#x5236;&#x4EE3;&#x7801;class Person:</span><br><span class="line">    #&#x8303;&#x5F0F;&#xFF1A;&#x56FA;&#x5B9A;&#x7684;&#x516C;&#x5F0F;&#xFF1B;&#x56FA;&#x5B9A;&#x7684;&#x5199;&#x6CD5;</span><br><span class="line">    def __new__(cls,*args,**kwargs):</span><br><span class="line">        #hasattr &#x5224;&#x65AD;&#x7C7B;&#x91CC;&#x9762;&#x6709;&#x6CA1;&#x6709;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;</span><br><span class="line">        #&#x5982;&#x679C;&#x7C7B;&#x6CA1;&#x6709;instance&#x8FD9;&#x4E2A;&#x5C5E;&#x6027;</span><br><span class="line">        if not hasattr(cls,&apos;instance&apos;):    #cls&#x5C31;&#x662F;Person&#x8FD9;&#x4E2A;&#x7C7B;&#x672C;&#x8EAB;</span><br><span class="line">            #&#x6CA1;&#x6709;instance&#x8FD9;&#x4E2A;&#x5C5E;&#x6027;&#x5C31;&#x4F1A;&#x6267;&#x884C;&#x4E0B;&#x9762;&#x8FD9;&#x53E5;</span><br><span class="line">            #&#x521B;&#x5EFA;instance&#x8FD9;&#x4E2A;&#x5C5E;&#x6027;&#xFF0C;&#x7B49;&#x4E8E;&#x7236;&#x7C7B;&#x7684;new&#x65B9;&#x6CD5;</span><br><span class="line">            #new&#x8FD4;&#x56DE;&#x7236;&#x7C7B;&#x7684;new&#x65B9;&#x6CD5;&#xFF0C;&#x548C;&#x8FD4;&#x56DE;instance&#x90FD;&#x53EF;&#x4EE5;</span><br><span class="line">            cls.instance = super().__new__(cls)           #&#x4E0A;&#x9762;&#x8BF4;&#x5982;&#x679C;&#x7C7B;&#x6CA1;&#x6709;instance&#x8FD9;&#x4E2A;&#x5C5E;&#x6027;&#x5C31;&#x6267;&#x884C;&#x8FD9;&#x53E5;&#xFF0C;&#x628A;&#x7236;&#x7C7B;&#x7684;new&#x65B9;&#x6CD5;&#x6DFB;&#x52A0;&#x4E3A;&#x7C7B;&#x672C;&#x8EAB;&#x7684;&#x5C5E;&#x6027;</span><br><span class="line">                                                                                                  #&#x5728;&#x4E0B;&#x4E00;&#x53E5;&#x5728;return&#x8FD9;&#x4E2A;&#x7C7B;&#x672C;&#x8EAB;&#x7684;&#x8FD9;&#x4E2A;instance&#x5C5E;&#x6027;&#xFF0C;&#x8FD9;&#x6837;&#x5728;&#x7B2C;&#x4E8C;&#x6B21;&#x5B9E;&#x4F8B;&#x5316;&#x7684;&#x65F6;&#x5019;&#xFF0C;return</span><br><span class="line">                                                                                                  #&#x7684;&#x4ECD;&#x7136;&#x662F;&#x7B2C;&#x4E00;&#x6B21;&#x5B9E;&#x4F8B;&#x5316;&#x7684;cls.instance&#xFF0C;&#x5C31;&#x6CA1;&#x6709;&#x8FD4;&#x56DE;&#x7236;&#x7C7B;&#x7684;new&#x65B9;&#x6CD5;&#xFF0C;&#x4E5F;&#x5C31;&#x6CA1;&#x6709;&#x521B;&#x5EFA;&#x65B0;&#x7684;&#x5185;&#x5B58;</span><br><span class="line">                                                                                                  #&#x7A7A;&#x95F4;&#xFF0C;&#x800C;&#x662F;&#x4ECD;&#x7136;&#x6307;&#x5411;&#x7B2C;&#x4E00;&#x6B21;&#x521B;&#x5EFA;&#x7684;&#x5185;&#x5B58;&#x7A7A;&#x95F4;</span><br><span class="line">        return cls.instance        #&#x5982;&#x679C;&#x628A;&#x8FD4;&#x56DE;&#x7684;&#x6539;&#x4E3A; super().__new__(cls)&#xFF0C;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x7236;&#x7C7B;&#x7684;new&#x65B9;&#x6CD5;&#xFF0C;&#x8FD9;&#x5C31;&#x4E0D;&#x662F;&#x5355;&#x4F8B;&#x6A21;&#x5F0F;&#xFF0C;&#x56E0;&#x4E3A;&#x6BCF;&#x6B21;&#x5B9E;&#x4F8B;&#x5316;&#x90FD;&#x4F1A;&#x8FD4;&#x56DE;&#x7236;&#x7C7B;</span><br><span class="line">                                                           #&#x7684;new&#x65B9;&#x6CD5;&#xFF0C;&#x5373;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x5185;&#x5B58;&#x7A7A;&#x95F4;&#x3002;</span><br><span class="line">    def __init__(self,name):</span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">a = Person(&apos;&#x5BD2;&#x6C99;&apos;)</span><br><span class="line">b = Person(&apos;&#x6562;&#x6562;&apos;)</span><br><span class="line">print(id(a))</span><br><span class="line">print(id(b))</span><br></pre></td></tr></table></figure>

<p>&#x4F1A;&#x53D1;&#x73B0;&#x4E24;&#x6B21;&#x7684;id&#x90FD;&#x4E00;&#x6837;&#x4E86;&#xFF0C;&#x5373;&#x4E24;&#x6B21;&#x6307;&#x5411;&#x540C;&#x4E00;&#x7247;&#x5185;&#x5B58;&#x7A7A;&#x95F4;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;a&#x88AB;b&#x8986;&#x76D6;&#x4E86;&#x3002;  </p>
<p>&#x610F;&#x5473;&#x7740;&#x8FD9;&#x4E24;&#x4E2A;&#x5176;&#x5B9E;&#x5F15;&#x7528;&#x7684;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;&#xFF0C;&#x662F;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;&#x7684;&#x4E0D;&#x540C;&#x540D;&#x5B57;</p>
<h1 id="&#x63CF;&#x8FF0;&#x7B26;"><a href="#&#x63CF;&#x8FF0;&#x7B26;" class="headerlink" title="&#x63CF;&#x8FF0;&#x7B26;"></a>&#x63CF;&#x8FF0;&#x7B26;</h1><p>&#x63CF;&#x8FF0;&#x7B26;&#x534F;&#x8BAE;&#xFF1A;python&#x63CF;&#x8FF0;&#x7B26;&#x662F;&#x4E00;&#x4E2A;&#x201C;&#x7ED1;&#x5B9A;&#x884C;&#x4E3A;&#x201D;&#x7684;&#x5BF9;&#x8C61;&#x5C5E;&#x6027;&#xFF0C;&#x5728;&#x63CF;&#x8FF0;&#x7B26;&#x534F;&#x8BAE;&#x4E2D;&#xFF0C;  </p>
<p>&#x5B83;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x65B9;&#x6CD5;&#x91CD;&#x5199;&#x5C5E;&#x6027;&#x7684;&#x8BBF;&#x95EE;&#x3002;&#x8FD9;&#x4E9B;&#x65B9;&#x6CD5;&#x6709;__get__(), <strong>set</strong>(), &#x548C;__delete__()&#x3002;  </p>
<p>&#x5982;&#x679C;&#x8FD9;&#x4E9B;&#x65B9;&#x6CD5;&#x4E2D;&#x7684;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x88AB;&#x5B9A;&#x4E49;&#x5728;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x4E2D;&#xFF0C;&#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x63CF;&#x8FF0;&#x7B26;</p>
<p>&#x4E3E;&#x4F8B;&#x8BF4;&#x660E;&#xFF1A;<br>&#x63CF;&#x8FF0;&#x7B26;&#xFF1A;&#x63CF;&#x8FF0;&#x7B26;&#x5C31;&#x662F;&#x7C7B;&#x91CC;&#x9762;&#x7684;&#x5C5E;&#x6027;base  </p>
<p>&#x63A7;&#x5236;&#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;a&#x8BBF;&#x95EE; &#x8FD9;&#x4E2A;&#x5C5E;&#x6027; &#xFF08;base) &#x53EF;&#x4EE5;&#x505A;&#x4E00;&#x4E9B;&#x989D;&#x5916;&#x7684;&#x64CD;&#x4F5C;  </p>
<p>&#x63CF;&#x8FF0;&#x7B26; &#x5B9A;&#x4E49;&#x4E86;__get__ <strong>set</strong> <strong>delete</strong> &#x5F53;&#x4E2D;&#x7684;&#x4E00;&#x79CD;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">python&#x590D;&#x5236;&#x4EE3;&#x7801;class Base:</span><br><span class="line">    def __get__(self,instance,owner):</span><br><span class="line">        print(&apos;&#x606D;&#x559C;&#x73A9;&#x5BB6;&#x83B7;&#x5F97;&#x8352;&#x53E4;&#x5B9D;&#x5178;&apos;)</span><br><span class="line">    def __set__(self, instance,value):</span><br><span class="line">        print(&apos;&#x5F3A;&#x5316;%s&apos;%value)</span><br><span class="line">    def __delete__(self,instance):</span><br><span class="line">        print(&apos;&#x6B66;&#x5668;&#x5DF2;&#x7ECF;&#x635F;&#x574F;&apos;)</span><br><span class="line"></span><br><span class="line">class A:</span><br><span class="line">    base = Base()</span><br><span class="line"></span><br><span class="line">#&#x5B9E;&#x4F8B;&#x5316;</span><br><span class="line">a = A()</span><br><span class="line"></span><br><span class="line">a.base           # __get__        &#x4F1A;&#x76F4;&#x63A5;&#x8F93;&#x51FA;__get__&#x65B9;&#x6CD5;&#x91CC;&#x9762;&#x7684;&#x5185;&#x5BB9;</span><br><span class="line"></span><br><span class="line">a.base = 50      # __set__ 		  &#x4F1A;&#x76F4;&#x63A5;&#x8F93;&#x51FA;__set__&#x65B9;&#x6CD5;&#x91CC;&#x9762;&#x7684;&#x5185;&#x5BB9;</span><br><span class="line"></span><br><span class="line">del a.base       # __delete__	  &#x4F1A;&#x76F4;&#x63A5;&#x8F93;&#x51FA;__delete__&#x65B9;&#x6CD5;&#x91CC;&#x9762;&#x7684;&#x5185;&#x5BB9;</span><br></pre></td></tr></table></figure>

<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/e9cc7aa732b428b946d7ced791123eab.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7033004074517823496.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7033004074517823496.html" itemprop="url">Springboot配置图片虚拟映射</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-11-21T20:49:13+08:00">
                2021-11-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x8FD9;&#x662F;&#x6211;&#x53C2;&#x4E0E;11&#x6708;&#x66F4;&#x6587;&#x6311;&#x6218;&#x7684;&#x7B2C;21&#x5929;&#xFF0C;&#x6D3B;&#x52A8;&#x8BE6;&#x60C5;&#x67E5;&#x770B;&#xFF1A;<a href="https://dev.newban.cn/7023643374569816095/">2021&#x6700;&#x540E;&#x4E00;&#x6B21;&#x66F4;&#x6587;&#x6311;&#x6218;</a>&#x300D;<br>&#x200B;</p>
<blockquote>
<ol>
<li>&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;MyWebAppConfigurer &#x914D;&#x7F6E;&#x9759;&#x6001;&#x8D44;&#x6E90;&#x9700;&#x8981;&#x6620;&#x5C04;&#x7684;&#x4F4D;&#x7F6E;&#x3001;&#x5EFA;&#x8BAE;&#x628A;addResourceLocations&#x7684;&#x8DEF;&#x5F84;&#x5199;&#x5728;application.yml&#x4E2D;&#x3001;&#x65B9;&#x9762;&#x4EE5;&#x540E;&#x90E8;&#x7F72;&#x7684;&#x6253;&#x5305;&#x4FEE;&#x6539;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x65F6;&#x5019;&#x505A;&#x5916;&#x90E8;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x52A0;&#x8F7D;&#x3001;&#x65B9;&#x9762;&#x4FEE;&#x6539;&#x3002;&#x8FD9;&#x8FB9;&#x4E3A;&#x4E86;&#x8282;&#x7EA6;&#x65F6;&#x95F4;&#x5C31;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x5199;&#x4E86;&#x3002;</li>
</ol>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">JAVA&#x590D;&#x5236;&#x4EE3;&#x7801;package io.renren.config;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;</span><br><span class="line">import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line">/**</span><br><span class="line"> * </span><br><span class="line"> * @author lyy</span><br><span class="line"> * 2021.11.21</span><br><span class="line"> */</span><br><span class="line">//springboot 2.x&#x914D;&#x7F6E;</span><br><span class="line">@Configuration</span><br><span class="line">public class MyWebAppConfigurer implements WebMvcConfigurer {</span><br><span class="line">    @Override</span><br><span class="line">    public void addResourceHandlers(ResourceHandlerRegistry registry) {</span><br><span class="line">        registry.addResourceHandler(&quot;/image/**&quot;).addResourceLocations(&quot;file:C:\Users\Administrator\Desktop\11&#x6708;&#x6BD5;&#x8BBE;\&quot;);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><img src="%22%E7%82%B9%E5%87%BB%E5%B9%B6%E6%8B%96%E6%8B%BD%E4%BB%A5%E7%A7%BB%E5%8A%A8%22" alt></p>
<blockquote>
<p>2.&#x6CA1;&#x6709;&#x52A0;&#x6743;&#x9650;&#x63A7;&#x5236;&#x7684;&#x8BDD;&#x76F4;&#x63A5;&#x901A;&#x8FC7;IP+&#x7AEF;&#x53E3;+&#x9879;&#x76EE;&#x540D;&#x4EE5;&#x53CA;addResourceHandler&#x4E2D;&#x7684;&#x8DEF;&#x5F84;&#x5C31;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x4E86;&#x3001;&#x6709;&#x6743;&#x9650;&#x63A7;&#x5236;&#x7684;&#x8BDD;&#x9700;&#x8981;&#x6743;&#x9650;&#x653E;&#x5FC3;&#x6216;&#x653E;&#x5728;static&#x9759;&#x6001;&#x8D44;&#x6E90;&#x6587;&#x4EF6;&#x5939;&#x4E0B;&#x3002;&#x4E2A;&#x4EBA;&#x7528;&#x7684;shiro&#x6743;&#x9650;&#x3001;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x653E;&#x884C;&#x3002;</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">JAVA&#x590D;&#x5236;&#x4EE3;&#x7801; @Bean(&quot;shiroFilter&quot;)</span><br><span class="line">    public ShiroFilterFactoryBean shiroFilter(SecurityManager securityManager) {</span><br><span class="line">        ShiroFilterFactoryBean shiroFilter = new ShiroFilterFactoryBean();</span><br><span class="line">        shiroFilter.setSecurityManager(securityManager);</span><br><span class="line"></span><br><span class="line">        //oauth&#x8FC7;&#x6EE4;</span><br><span class="line">        Map&lt;String, Filter&gt; filters = new HashMap&lt;&gt;();</span><br><span class="line">        filters.put(&quot;oauth2&quot;, new OAuth2Filter());</span><br><span class="line">        shiroFilter.setFilters(filters);</span><br><span class="line"></span><br><span class="line">        Map&lt;String, String&gt; filterMap = new LinkedHashMap&lt;&gt;();</span><br><span class="line">        filterMap.put(&quot;/webjars/**&quot;, &quot;anon&quot;);</span><br><span class="line">        filterMap.put(&quot;/druid/**&quot;, &quot;anon&quot;);</span><br><span class="line">        filterMap.put(&quot;/app/**&quot;, &quot;anon&quot;);</span><br><span class="line">        filterMap.put(&quot;/sys/login&quot;, &quot;anon&quot;);</span><br><span class="line">        filterMap.put(&quot;/swagger/**&quot;, &quot;anon&quot;);</span><br><span class="line">        filterMap.put(&quot;/v2/api-docs&quot;, &quot;anon&quot;);</span><br><span class="line">        filterMap.put(&quot;/swagger-ui.html&quot;, &quot;anon&quot;);</span><br><span class="line">        filterMap.put(&quot;/swagger-resources/**&quot;, &quot;anon&quot;);</span><br><span class="line">        filterMap.put(&quot;/captcha.jpg&quot;, &quot;anon&quot;);</span><br><span class="line">        filterMap.put(&quot;/image/**&quot;, &quot;anon&quot;);</span><br><span class="line"></span><br><span class="line">        filterMap.put(&quot;/**&quot;, &quot;oauth2&quot;);</span><br><span class="line">        shiroFilter.setFilterChainDefinitionMap(filterMap);</span><br><span class="line"></span><br><span class="line">        return shiroFilter;</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<blockquote>
<p>3.&#x6620;&#x5C04;&#x6210;&#x529F;&#x3001;&#x8BBF;&#x95EE;<a href="/external_links/e24325179a926fbe1a52393dbdecb3f1.html" target="blank" rel="noopener">http://localhost:8080/renren-fast/image/v2-4f45411c72eb128a6085fc8173286ffc_1440w.jpg</a></p>
</blockquote>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/7fa17b0027fee6453c5982cc5cf67018f85e4b3db18d8758273b48489f43e393" alt></p>
<blockquote>
<p>&#x5927;&#x5BB6;<strong>&#x70B9;&#x8D5E;&#x3001;&#x6536;&#x85CF;&#x3001;&#x5173;&#x6CE8;&#x3001;&#x8BC4;&#x8BBA;</strong>&#x5566; &#x3001;</p>
<p>&#x6253;&#x5361; &#x6587;&#x7AE0; &#x66F4;&#x65B0; <strong>104/  365&#x5929;</strong></p>
</blockquote>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/b44f1394e3c8d34a7d8572a9dd07ec5b.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7032994181324734472.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7032994181324734472.html" itemprop="url">Githook实践以代码规范检测插件golangci-lin</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-11-21T20:10:48+08:00">
                2021-11-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x300C;&#x8FD9;&#x662F;&#x6211;&#x53C2;&#x4E0E;11&#x6708;&#x66F4;&#x6587;&#x6311;&#x6218;&#x7684;&#x7B2C;8&#x5929;&#xFF0C;&#x6D3B;&#x52A8;&#x8BE6;&#x60C5;&#x67E5;&#x770B;&#xFF1A;<a href="https://dev.newban.cn/7023643374569816095">2021&#x6700;&#x540E;&#x4E00;&#x6B21;&#x66F4;&#x6587;&#x6311;&#x6218;</a>&#x300D;</p>
<h2 id="&#x5F15;&#x5B50;"><a href="#&#x5F15;&#x5B50;" class="headerlink" title="&#x5F15;&#x5B50;"></a>&#x5F15;&#x5B50;</h2><p>&#x201C;kovogo&#x54E5;, &#x6211;&#x600E;&#x4E48;&#x63D0;&#x4EA4;&#x4E0D;&#x4E86;&#x4EE3;&#x7801;&#x4E86;&#x201D;</p>
<p>&#x6CA1;&#x60F3;&#x5230;&#x5DE5;&#x4F5C;&#x4E24;&#x5E74;&#x5C31;&#x5DF2;&#x7ECF;&#x8FDB;&#x5165;&#x54E5;&#x5B57;&#x8F88;&#x4E86;, &#x5F80;&#x65C1;&#x8FB9;&#x4E00;&#x770B;&#x65C1;&#x8FB9;&#x65B0;&#x6765;&#x7684;&#x5C0F;&#x4F19;&#x5B50;&#x6B63;&#x5E38;&#x5BF9;&#x7740;&#x5C4F;&#x5E55;&#x53D1;&#x6101;, &#x4E00;&#x770B;&#x63A7;&#x5236;&#x53F0;&#x7684;&#x62A5;&#x9519;&#xFF0C;&#x54E6;&#x539F;&#x6765;&#x662F;<code>golangci-lint</code>&#x6253;&#x56DE;&#x4E86;&#x63D0;&#x4EA4;, &#x539F;&#x56E0;&#x662F;&#x67D0;&#x4E00;&#x884C;&#x7684;&#x4EE3;&#x7801;&#x592A;&#x957F;&#x4E86;&#x8D85;&#x8FC7;&#x4E86;&#x9650;&#x5236;&#x3002;</p>
<p>&#x90A3;&#x4E48;&#x5728;&#x63D0;&#x4EA4;&#x4EE3;&#x7801;&#x5BF9;&#x4EE3;&#x7801;&#x89C4;&#x8303;&#x8FDB;&#x884C;&#x68C0;&#x67E5;&#x662F;&#x600E;&#x4E48;&#x505A;&#x5230;&#x7684;? &#x8FD9;&#x5C31;&#x9700;&#x8981;&#x6211;&#x4EEC;&#x6765;&#x56DE;&#x987E;&#x4E00;&#x4E0B;<code>githook</code>&#x7684;&#x77E5;&#x8BC6;&#x4E86;&#x3002;</p>
<h2 id="githook"><a href="#githook" class="headerlink" title="githook"></a>githook</h2><p>&#x4EC0;&#x4E48;&#x662F;<code>githook</code>?</p>
<p>&#x4E00;&#x822C;&#x6765;&#x8BF4;&#x53EA;&#x8981;&#x662F;&#x4E0A;&#x4E86;&#x89C4;&#x6A21;&#x7684;&#x8F6F;&#x4EF6;/&#x4E2D;&#x95F4;&#x4EF6;/&#x5F00;&#x6E90;&#x6846;&#x67B6;&#x6216;&#x591A;&#x6216;&#x5C11;&#x7684;&#x4F1A;&#x63D0;&#x4F9B;&#x4E00;&#x4E9B;<code>hook</code>, &#x4F9B;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x4F7F;&#x7528;&#x3002;&#x800C;&#x8FD9;&#x4E9B;<code>hook</code>&#x7684;&#x4F5C;&#x7528;&#x5C31;&#x662F;&#x5728;&#x8FD9;&#x4E9B;&#x6846;&#x67B6;/&#x8F6F;&#x4EF6;&#x4E2D;&#x5F15;&#x5165;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x7F16;&#x5199;&#x4EE3;&#x7801;, &#x4ECE;&#x800C;&#x6539;&#x53D8;&#x8F6F;&#x4EF6;&#x7684;&#x8868;&#x73B0;&#x5F62;&#x5F0F;&#x6216;&#x884C;&#x4E3A;&#x903B;&#x8F91;&#x3002;</p>
<p>&#x800C;<code>githook</code>&#x5C31;&#x662F;<code>git</code>&#x662F;&#x5411;&#x5F00;&#x53D1;&#x8005;&#x63D0;&#x4F9B;&#x7684;&#x5728;<code>git</code>&#x6267;&#x884C;&#x91CD;&#x8981;&#x7684;&#x64CD;&#x4F5C;&#x5F15;&#x5165;&#x5F00;&#x53D1;&#x8005;&#x7684;&#x4EE3;&#x7801;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x6BD4;&#x5982;&#x4E0A;&#x6587;&#x63D0;&#x5230;&#x5728;<code>commit</code>&#x65F6;&#x5F15;&#x5165;&#x4EE3;&#x7801;&#x68C0;&#x67E5;&#x7684;&#x529F;&#x80FD;&#x5C31;&#x662F;&#x901A;&#x8FC7;<code>githook</code>&#x5B9E;&#x73B0;&#x7684;&#x3002;</p>
<p>&#x6BCF;&#x4E2A;git&#x4ED3;&#x5E93;&#x5728;&#x521D;&#x59CB;&#x5316;&#x7684;&#x65F6;&#x5019;, &#x90FD;&#x4F1A;&#x5728;<code>.git</code>&#x76EE;&#x5F55;&#x4E0B;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;<code>hooks</code>&#x76EE;&#x5F55;&#xFF0C;&#x7528;&#x6765;&#x5B58;&#x653E;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x81EA;&#x5B9A;&#x4E49;&#x7684;<code>hook</code>&#x811A;&#x672C;(<code>shell&#x811A;&#x672C;</code>), &#x811A;&#x672C;&#x6587;&#x4EF6;&#x540D;&#x5373;<code>hook</code>&#x540D;&#x3002;</p>
<blockquote>
<p>windows &#x73AF;&#x5883;&#x5B89;&#x88C5;git&#x65F6;&#x4F1A;&#x81EA;&#x5E26;<code>git bash</code>, &#x56E0;&#x6B64;&#x65E0;&#x9700;&#x8981;&#x62C5;&#x5FC3;&#x811A;&#x672C;&#x7684;&#x517C;&#x5BB9;&#x6027;</p>
</blockquote>
<p>&#x5F53;<code>hook</code>&#x811A;&#x672C;&#x8FD4;&#x56DE;<code>0</code>&#x65F6;&#x8868;&#x793A;&#x653E;&#x884C;&#x5BF9;&#x5E94;&#x7684;&#x64CD;&#x4F5C;, &#x8FD4;&#x56DE;<code>&#x975E;0</code>&#x503C;&#x8868;&#x793A;&#x62D2;&#x7EDD;&#x6B64;&#x64CD;&#x4F5C;&#x3002;</p>
<p>&#x6BCF;&#x4E2A;&#x7A0B;&#x5E8F;&#x5728;&#x9000;&#x51FA;&#x7684;&#x65F6;&#x5019;&#x90FD;&#x4F1A;&#x6709;&#x8FD4;&#x56DE;&#x503C;, &#x8BE5;&#x8FD4;&#x56DE;&#x503C;&#x901A;&#x5E38;&#x7528;&#x6765;&#x8868;&#x793A;&#x7A0B;&#x5E8F;&#x662F;&#x5426;&#x6267;&#x884C;&#x6210;&#x529F;.</p>
<p>&#x5728;Linux shell&#x4E2D;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;, <code>$?</code>&#x6765;&#x83B7;&#x53D6;&#x4E0A;&#x4E00;&#x4E2A;&#x7A0B;&#x5E8F;&#x7684;&#x8FD4;&#x56DE;&#x503C;.</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p8/raw/master/img/ba105af55d714ca91ef42aa99ecde6ae5316c9dd8a9a87e827cbf5571846e5e2" alt="image.png"></p>
<p>&#x5982;&#x4E0A;&#x56FE;&#x6240;&#x793A;, &#x6211;&#x4EEC;&#x5C1D;&#x8BD5;&#x8BBF;&#x95EE;&#x4E00;&#x4E2A;&#x4E0D;&#x5B58;&#x5728;&#x7684;&#x8DEF;&#x5F84;, <code>ls</code>&#x547D;&#x4EE4;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x662F;2.</p>
<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;<code>.git/hooks</code>&#x4E2D;&#x770B;&#x5230;&#x5982;&#x4E0B;&#x6587;&#x4EF6;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p8/raw/master/img/39fe6c6ed5163cb59cd082ac76a0ff7abf76ed211ae72d5221277c32f147852a" alt="image.png"></p>
<p>&#x4E0A;&#x56FE;&#x4E2D;.sample&#x6587;&#x4EF6;&#x90FD;&#x662F;git&#x5B98;&#x65B9;&#x63D0;&#x4F9B;&#x7684;&#x53C2;&#x8003;, &#x53BB;&#x6389;.sample&#x540E;&#x7F00;&#x8BE5;&#x94A9;&#x5B50;&#x5C31;&#x4F1A;&#x8D77;&#x6548;, &#x8BB0;&#x4F4F;: &#x6587;&#x4EF6;&#x540D;&#x5373;&#x94A9;&#x5B50;&#x540D;</p>
<p>&#x5982;&#x679C;&#x9700;&#x8981;&#x5728;&#x63D0;&#x4EA4;&#x4EE3;&#x7801;&#x65F6;&#x5BF9;&#x4EE3;&#x7801;&#x8FDB;&#x884C;&#x68C0;&#x6D4B;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x9700;&#x8981;&#x4E3A;<code>pre-commit</code>&#x94A9;&#x5B50;&#x7F16;&#x5199;&#x4EE3;&#x7801;&#x89C4;&#x8303;&#x68C0;&#x6D4B;&#x811A;&#x672C;&#x3002;</p>
<p>&#x66F4;&#x591A;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#x53EF;&#x53C2;&#x89C1;<a href="/external_links/0b68a91af840958a641599629c776417.html" target="blank" rel="noopener">&#x5B98;&#x65B9;&#x6587;&#x6863;</a></p>
<h2 id="golintci-lint"><a href="#golintci-lint" class="headerlink" title="golintci-lint"></a>golintci-lint</h2><p>&#x7531;&#x4E8E;<code>golint</code>&#x5DF2;&#x7ECF;&#x88AB;&#x8C37;&#x6B4C;&#x629B;&#x5F03;&#x4E0D;&#x518D;&#x7EF4;&#x62A4;&#x4E86;, &#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x4E86;<code>golangci-lint</code>&#x5BF9;&#x4EE3;&#x7801;&#x89C4;&#x8303;&#x8FDB;&#x884C;&#x68C0;&#x67E5;&#x3002;</p>
<h3 id="&#x5B89;&#x88C5;"><a href="#&#x5B89;&#x88C5;" class="headerlink" title="&#x5B89;&#x88C5;"></a>&#x5B89;&#x88C5;</h3><p><a href="/external_links/702aa2686421e391fd07e8e920482f84.html" target="blank" rel="noopener">golangci-lint&#x5B98;&#x7F51;</a>&#x7ED9;&#x51FA;&#x7684;&#x5B89;&#x88C5;&#x65B9;&#x5F0F;&#x6709;&#x4E24;&#x79CD;:</p>
<ul>
<li>&#x4E8C;&#x8FDB;&#x5236;&#x5B89;&#x88C5;, &#x76F4;&#x63A5;&#x4E0B;&#x8F7D;&#x5BF9;&#x5E94;&#x5E73;&#x53F0;&#x7684;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;</li>
<li>&#x5982;&#x679C;&#x7248;&#x672C;&#x5C0F;&#x4E8E;<code>1.16</code>&#x4F7F;&#x7528;<code>go get</code>&#x4E0B;&#x8F7D;&#x6E90;&#x6587;&#x4EF6;&#x5E76;&#x7F16;&#x8BD1;&#x5B89;&#x88C5;, &#x5927;&#x4E8E;<code>1.16</code>&#x5219;&#x4F7F;&#x7528;<code>go install</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">shell&#x590D;&#x5236;&#x4EE3;&#x7801;# Go 1.16+</span><br><span class="line">go install github.com/golangci/golangci-lint/cmd/golangci-lint@v1.43.0</span><br><span class="line"></span><br><span class="line"># Go version &lt; 1.16</span><br><span class="line">go get -u github.com/golangci/golangci-lint/cmd/golangci-lint@v1.43.0</span><br></pre></td></tr></table></figure>

<p>&#x4EE5;windows&#x5E73;&#x53F0;&#x4E3A;&#x4F8B;, &#x6211;&#x7684;golang&#x7248;&#x672C;&#x662F;<code>1.16.10</code></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p8/raw/master/img/4174a6764c3edd3045e1fd8c3e04e77673930518dd06c4e2cda65ed3c308fedf" alt="image.png"></p>
<p>&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x4F7F;&#x7528;<code>go install</code>&#x7684;&#x65B9;&#x5F0F;&#x8FDB;&#x884C;&#x5B89;&#x88C5;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p8/raw/master/img/8175b207d20ee604a494c049a5946019ba3b1df59250af7c4f31a3eab3ebe886" alt="image.png"></p>
<h3 id="&#x4F7F;&#x7528;"><a href="#&#x4F7F;&#x7528;" class="headerlink" title="&#x4F7F;&#x7528;"></a>&#x4F7F;&#x7528;</h3><p>&#x4F7F;&#x7528;<code>run</code>&#x547D;&#x4EE4;&#x5373;&#x53EF;&#x5BF9;&#x76EE;&#x6807;&#x76EE;&#x5F55;&#x7684;&#x4EE3;&#x7801;&#x8FDB;&#x884C;&#x68C0;&#x6D4B;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&#x590D;&#x5236;&#x4EE3;&#x7801;golangci-lint run [&#x76EE;&#x5F55;]</span><br></pre></td></tr></table></figure>

<p>&#x4F7F;&#x7528;<code>-h</code>&#x53EF;&#x4EE5;&#x67E5;&#x770B;<code>run</code>&#x547D;&#x4EE4;&#x7684;&#x66F4;&#x591A;&#x5E2E;&#x52A9;&#x4FE1;&#x606F;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&#x590D;&#x5236;&#x4EE3;&#x7801;golangci-lint run -h</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/songjianzaina/juejin_p8/raw/master/img/f3821c4d56783ec7276361e578864f8016221eee6821bb10db9734769be24843" alt="image.png"></p>
<p>&#x503C;&#x5F97;&#x6CE8;&#x610F;&#x7684;&#x9009;&#x9879;&#x6709;:</p>
<ul>
<li><code>--issues-exit-code</code> &#x4EE3;&#x7801;&#x68C0;&#x6D4B;&#x5931;&#x8D25;&#x8FD4;&#x56DE;&#x7684;&#x9519;&#x8BEF;&#x7801;, &#x9ED8;&#x8BA4;&#x662F;<code>1</code></li>
<li><code>-c, --config PATH</code> &#x7528;&#x4E8E;&#x5B9A;&#x5236;&#x4EE3;&#x7801;&#x68C0;&#x6D4B;&#x9879;&#x76EE;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;(<code>yaml</code>&#x683C;&#x5F0F;)</li>
<li><code>--skip-files</code> &#x8981;&#x8DF3;&#x8FC7;&#x7684;&#x6587;&#x4EF6;</li>
<li><code>--skip-dirs</code> &#x8981;&#x8DF3;&#x8FC7;&#x7684;&#x76EE;&#x5F55;</li>
<li><code>--enable</code> &#x8981;&#x542F;&#x7528;&#x7684;&#x4EE3;&#x7801;&#x68C0;&#x6D4B;&#x9879;&#x76EE;</li>
</ul>
<h3 id="&#x5B9A;&#x5236;&#x4EE3;&#x7801;&#x68C0;&#x6D4B;"><a href="#&#x5B9A;&#x5236;&#x4EE3;&#x7801;&#x68C0;&#x6D4B;" class="headerlink" title="&#x5B9A;&#x5236;&#x4EE3;&#x7801;&#x68C0;&#x6D4B;"></a>&#x5B9A;&#x5236;&#x4EE3;&#x7801;&#x68C0;&#x6D4B;</h3><p>&#x4E0A;&#x6587;&#x63D0;&#x5230;, &#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>--config</code>&#x6765;&#x5B9A;&#x5236;&#x4EE3;&#x7801;&#x68C0;&#x6D4B;&#x9879;&#x76EE;&#x7684;&#x914D;&#x7F6E;, &#x5176;&#x683C;&#x5F0F;&#x5982;&#x4E0B;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yaml&#x590D;&#x5236;&#x4EE3;&#x7801;linters-settings:</span><br><span class="line">  cyclop: # &#x4EE3;&#x7801;&#x68C0;&#x6D4B;&#x9879;&#x76EE;&#x540D;&#x901A;&#x5E38;&#x4F1A;&#x5BF9;&#x5E94;&#x5230;&#x67D0;&#x4E2A;&#x63D2;&#x4EF6;</span><br><span class="line">    # &#x6700;&#x5927;&#x7684;&#x590D;&#x6742;&#x5EA6;</span><br><span class="line">    max-complexity: 10</span><br><span class="line">    # &#x6BCF;&#x4E2A;&#x5305;&#x5141;&#x8BB8;&#x7684;&#x6700;&#x5927;&#x590D;&#x6742;&#x5EA6;</span><br><span class="line">    package-average: 0.0</span><br><span class="line">    # &#x662F;&#x5426;&#x8DF3;&#x8FC7;&#x6D4B;&#x8BD5;&#x6587;&#x4EF6;</span><br><span class="line">    skip-tests: false</span><br></pre></td></tr></table></figure>

<p>&#x66F4;&#x591A;&#x4FE1;&#x606F;&#x53C2;&#x8003;<a href="/external_links/5d71180bc1160560ac844e24e54de903.html" target="blank" rel="noopener">&#x5B98;&#x65B9;&#x6587;&#x6863;</a></p>
<h2 id="githook-golangci-lint"><a href="#githook-golangci-lint" class="headerlink" title="githook + golangci-lint"></a>githook + golangci-lint</h2><p>&#x4EE5;windows&#x5E73;&#x53F0;&#x4E3A;&#x4F8B;, &#x6211;&#x4EEC;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x9879;&#x76EE;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p8/raw/master/img/d5d0947738ea6cff34d4a500fe04bc047621509856f84bf3404bc6b1cfbed044" alt="image.png"></p>
<p>&#x7136;&#x540E;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x4EE3;&#x7801;&#x6587;&#x4EF6;, &#x968F;&#x4FBF;&#x5199;&#x70B9;&#x4E71;&#x4E03;&#x516B;&#x7CDF;&#x7684;&#x4EE3;&#x7801;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">go&#x590D;&#x5236;&#x4EE3;&#x7801;func main() {</span><br><span class="line">	for i := 0; i &lt; 1024; i++ {</span><br><span class="line">		for j := 0; j &lt; 1024; j++ {</span><br><span class="line">			for n := 0; n &lt; 1024; n++ {</span><br><span class="line">				fmt.Printf(&quot;%d-%d-%s&quot;, i, j, n)</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><code>golangci-lint</code>&#x68C0;&#x6D4B;&#x5230;&#x4E86;<code>Printf</code>&#x4F20;&#x4E86;&#x9519;&#x8BEF;&#x7684;&#x53C2;&#x6570;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p8/raw/master/img/f9ee0219f48b4bfd94658856004adc5e6d173603e726245729c83cd4fc548904" alt="image.png"></p>
<p>&#x6211;&#x4EEC;&#x518D;&#x5F80;&#x9879;&#x76EE;&#x4E2D;&#x91CC;&#x9762;&#x52A0;&#x70B9;&#x6709;&#x201D;&#x574F;&#x5473;&#x9053;&#x201D;&#x7684;&#x4EE3;&#x7801;, &#x5982;&#x4E0B;&#x6240;&#x793A;:(&#x793A;&#x4F8B;&#x6765;&#x81EA;<code>cyclop</code>&#x9879;&#x76EE;&#x7684;&#x6D4B;&#x8BD5;&#x6587;&#x4EF6;)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">go&#x590D;&#x5236;&#x4EE3;&#x7801;func T() {</span><br><span class="line">	i := 1</span><br><span class="line">	if i &gt; 2 {</span><br><span class="line">		if i &gt; 2 {</span><br><span class="line">		}</span><br><span class="line">		if i &gt; 2 {</span><br><span class="line">		}</span><br><span class="line">		if i &gt; 2 {</span><br><span class="line">		}</span><br><span class="line">		if i &gt; 2 {</span><br><span class="line">		}</span><br><span class="line">	} else {</span><br><span class="line">		if i &gt; 2 {</span><br><span class="line">		}</span><br><span class="line">		if i &gt; 2 {</span><br><span class="line">		}</span><br><span class="line">		if i &gt; 2 {</span><br><span class="line">		}</span><br><span class="line">		if i &gt; 2 {</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	if i &gt; 2 {</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x518D;&#x6B21;&#x8FDB;&#x884C;&#x4EE3;&#x7801;&#x68C0;&#x6D4B;, &#x6CE8;&#x610F;&#x6B64;&#x65F6;&#x9700;&#x8981;&#x542F;&#x7528;&#x5708;&#x590D;&#x6742;&#x5EA6;&#x68C0;&#x6D4B;&#x63D2;&#x4EF6;<code>cyclop</code></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p8/raw/master/img/50b54b7be430821c42a2e5851d9253a61512de7f7539dbd3b0a45e2ab26d2534" alt="image.png"></p>
<p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x8BA9;&#x4EE3;&#x7801;&#x901A;&#x8FC7;&#x68C0;&#x6D4B;&#xFF0C;&#x5C31;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x5230;&#x4E0A;&#x6587;&#x63D0;&#x5230;&#x7684;&#x4F7F;&#x7528;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x81EA;&#x5B9A;&#x4E49;&#x4EE3;&#x7801;&#x68C0;&#x6D4B;&#x9879;&#x76EE;&#x4E86;&#x3002;</p>
<p>&#x5728;&#x9879;&#x76EE;&#x4E2D;&#x521B;&#x5EFA;<code>lint.yaml</code>, &#x5E76;&#x7F16;&#x5199;&#x914D;&#x7F6E;&#x9879;&#x5982;&#x4E0B;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yaml&#x590D;&#x5236;&#x4EE3;&#x7801;linters-settings:</span><br><span class="line">  cyclop:</span><br><span class="line">    # &#x6700;&#x5927;&#x7684;&#x590D;&#x6742;&#x5EA6;</span><br><span class="line">    max-complexity: 15</span><br><span class="line">    # &#x6BCF;&#x4E2A;&#x5305;&#x5141;&#x8BB8;&#x7684;&#x6700;&#x5927;&#x590D;&#x6742;&#x5EA6;</span><br><span class="line">    package-average: 0.0</span><br><span class="line">    # &#x662F;&#x5426;&#x8DF3;&#x8FC7;&#x6D4B;&#x8BD5;&#x6587;&#x4EF6;</span><br><span class="line">    skip-tests: false</span><br></pre></td></tr></table></figure>

<p>&#x518D;&#x6B21;&#x8FD0;&#x884C;&#x5E76;&#x6307;&#x5B9A;&#x914D;&#x7F6E;&#x6587;&#x4EF6;, &#x6B64;&#x65F6;&#x5DF2;&#x4E0D;&#x518D;&#x63D0;&#x793A;&#x5708;&#x590D;&#x6742;&#x5EA6;&#x8FC7;&#x9AD8;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p8/raw/master/img/385b34d54548b4f6df9fd0eca6726d67d4a08c2488b57c3335ffed2cc527af28" alt="image.png"></p>
<h3 id="pre-commit-hook"><a href="#pre-commit-hook" class="headerlink" title="pre-commit hook"></a>pre-commit hook</h3><p>&#x5229;&#x7528;&#x4E0A;&#x6587;&#x7684;&#x77E5;&#x8BC6;&#xFF0C;&#x6211;&#x4EEC;&#x7684;pre-commit hook &#x811A;&#x672C;&#x7684;&#x903B;&#x8F91;&#x5982;&#x4E0B;&#x6240;&#x793A;:</p>
<ul>
<li>&#x68C0;&#x6D4B;&#x662F;&#x5426;&#x5B89;&#x88C5;golangci-lint, &#x5982;&#x679C;&#x6CA1;&#x6709;&#x5219;&#x8FDB;&#x884C;&#x5B89;&#x88C5;</li>
<li>&#x8FD0;&#x884C;golangci-lint&#x5BF9;&#x4EE3;&#x7801;&#x8FDB;&#x884C;&#x68C0;&#x6D4B;&#xFF0C;&#x5982;&#x679C;&#x68C0;&#x6D4B;&#x5931;&#x8D25;&#x8FD4;&#x56DE;1&#x6210;&#x529F;&#x5219;&#x8FD4;&#x56DE;0</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">shell&#x590D;&#x5236;&#x4EE3;&#x7801;#!/bin/sh</span><br><span class="line"></span><br><span class="line">echo &quot;Start lint code&quot;</span><br><span class="line">if !(golangci-lint.exe --version); then</span><br><span class="line">    go install github.com/golangci/golangci-lint/cmd/golangci-lint@v1.43.0</span><br><span class="line">fi</span><br><span class="line"># &#x76EE;&#x5F55;&#x540D;&#x540E;&#x8DDF;&#x4E0A;...&#x8868;&#x793A;&#x5BF9;&#x8BE5;&#x76EE;&#x5F55;&#x8FDB;&#x884C;&#x9012;&#x5F52;&#x67E5;&#x627E;</span><br><span class="line">if !(golangci-lint.exe run --enable cyclop --config ./lint.yaml ./...); then</span><br><span class="line">    echo &quot;Lint fail!&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">echo &quot;Lint success&quot;</span><br><span class="line"></span><br><span class="line">exit 0</span><br></pre></td></tr></table></figure>

<p>&#x5C1D;&#x8BD5;&#x5BF9;&#x4EE3;&#x7801;&#x63D0;&#x4EA4;&#xFF0C;&#x8FD0;&#x884C;&#x6548;&#x679C;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;<br><img src="https://gitee.com/songjianzaina/juejin_p8/raw/master/img/e7f74b82f2b2384994b5ce108e2fcc1dd3781e491807fe1d32a3661ac90ef89e" alt="image.png"></p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/170b6ae12492301307d24ab78d7debc3.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7032993523435569165.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7032993523435569165.html" itemprop="url">MySQL中的MVCC是怎么实现的，你们知道吗？</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-11-21T20:07:49+08:00">
                2021-11-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x300C;&#x8FD9;&#x662F;&#x6211;&#x53C2;&#x4E0E;11&#x6708;&#x66F4;&#x6587;&#x6311;&#x6218;&#x7684;&#x7B2C;21&#x5929;&#xFF0C;&#x6D3B;&#x52A8;&#x8BE6;&#x60C5;&#x67E5;&#x770B;&#xFF1A;<a href="https://dev.newban.cn/7023643374569816095">2021&#x6700;&#x540E;&#x4E00;&#x6B21;&#x66F4;&#x6587;&#x6311;&#x6218;</a>&#x300D;</p>
<blockquote>
<p>&#x4E0D;&#x6653;&#x5F97;&#x5927;&#x5BB6;&#x4E86;&#x89E3;&#x4E0D;&#x4E86;&#x89E3;MySQL&#x7684;MVCC&#x673A;&#x5236;&#xFF0C;&#x8FD9;&#x4E2A;&#x662F;MySQL&#x5E95;&#x5C42;&#x539F;&#x7406;&#x4E2D;&#x6BD4;&#x8F83;&#x91CD;&#x8981;&#x7684;&#x4E00;&#x9879;&#xFF0C;&#x5B83;&#x80FD;&#x6781;&#x5927;&#x7684;&#x63D0;&#x9AD8;MySQL&#x6570;&#x636E;&#x5E93;&#x7684;&#x5E76;&#x53D1;&#x6027;&#x80FD;&#x3002;MVCC&#x5E7F;&#x6CDB;&#x5E94;&#x7528;&#x4E8E;&#x6570;&#x636E;&#x5E93;&#x6280;&#x672F;&#xFF0C;&#x50CF;Oracle,PostgreSQL&#x7B49;&#x90FD;&#x5F15;&#x5165;&#x4E86;&#x8BE5;&#x6280;&#x672F;&#x3002;&#x672C;&#x7BC7;&#x6587;&#x7AE0;&#x6211;&#x4EEC;&#x5C31;&#x5E26;&#x5927;&#x5BB6;&#x4E00;&#x8D77;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;MySQL&#x7684;MVCC&#x673A;&#x5236;&#x5B9E;&#x73B0;&#x539F;&#x7406;&#x3002;</p>
</blockquote>
<h2 id="&#x4EC0;&#x4E48;&#x662F;MVCC&#xFF1F;"><a href="#&#x4EC0;&#x4E48;&#x662F;MVCC&#xFF1F;" class="headerlink" title="&#x4EC0;&#x4E48;&#x662F;MVCC&#xFF1F;"></a>&#x4EC0;&#x4E48;&#x662F;MVCC&#xFF1F;</h2><p>Multi-Version Concurrency Control&#xFF08;MVCC&#xFF09;&#xFF0C;&#x7FFB;&#x8BD1;&#x8FC7;&#x6765;&#x5C31;&#x662F;&#x591A;&#x7248;&#x672C;&#x5E76;&#x53D1;&#x63A7;&#x5236;&#xFF0C;MVCC&#x662F;&#x4E3A;&#x63D0;&#x9AD8;MySQL&#x6570;&#x636E;&#x5E93;&#x5E76;&#x53D1;&#x6027;&#x80FD;&#x7684;&#x4E00;&#x4E2A;&#x91CD;&#x8981;&#x8BBE;&#x8BA1;&#x3002;</p>
<p>&#x540C;&#x4E00;&#x884C;&#x6570;&#x636E;&#x53D1;&#x751F;&#x8BFB;&#x5199;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x4F1A;&#x901A;&#x8FC7;&#x9501;&#x6765;&#x4FDD;&#x8BC1;&#x6570;&#x636E;&#x7684;&#x4E00;&#x81F4;&#x6027;&#x3002;MVCC&#x53EF;&#x4EE5;&#x5728;&#x8BFB;&#x5199;&#x51B2;&#x7A81;&#x65F6;&#xFF0C;&#x8BA9;&#x5176;&#x8BFB;&#x6570;&#x636E;&#x65F6;&#x901A;&#x8FC7;<strong>&#x5FEB;&#x7167;&#x8BFB;</strong>&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5F53;&#x524D;&#x8BFB;&#xFF0C;&#x5FEB;&#x7167;&#x8BFB;&#x4E0D;&#x5FC5;&#x52A0;&#x9501;&#x3002;</p>
<p>&#x5728;&#x524D;&#x8FB9;&#x6587;&#x7AE0;&#x6211;&#x4EEC;&#x4E5F;&#x4ECB;&#x7ECD;&#x4E86;MySQL&#x4E2D;&#x7684;&#x9501;&#x673A;&#x5236;&#xFF0C;&#x4E0D;&#x719F;&#x6089;&#x7684;&#x53EF;&#x4EE5;&#x7FFB;&#x9605;&#x524D;&#x8FB9;&#x7684;&#x6587;&#x7AE0;&#x3002;</p>
<h2 id="InnoDB&#x7684;&#x4E8B;&#x52A1;"><a href="#InnoDB&#x7684;&#x4E8B;&#x52A1;" class="headerlink" title="InnoDB&#x7684;&#x4E8B;&#x52A1;"></a>InnoDB&#x7684;&#x4E8B;&#x52A1;</h2><blockquote>
<p>MySQL&#x4E2D;&#x7684;MVCC&#x662F;&#x5728;InnoDB&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#x4E2D;&#x5F97;&#x5230;&#x652F;&#x6301;&#x7684;&#xFF0C;InnoDB&#x4E2D;&#x6700;&#x91CD;&#x8981;&#xFF0C;&#x4E5F;&#x662F;&#x6700;&#x7279;&#x6B8A;&#x7684;&#x53EF;&#x8C13;&#x5C31;&#x662F;&#x4E8B;&#x52A1;&#xFF0C;&#x6240;&#x4EE5;&#x4E8B;&#x52A1;&#x76F8;&#x5173;&#x7684;&#x4E00;&#x4E9B;&#x8BBE;&#x8BA1;&#x6211;&#x4EEC;&#x5FC5;&#x987B;&#x4E86;&#x89E3;&#x3002;</p>
</blockquote>
<ul>
<li>&#x884C;&#x7EA7;&#x9501; InnoDB&#x63D0;&#x4F9B;&#x4E86;&#x884C;&#x7EA7;&#x9501;&#xFF0C;&#x884C;&#x7EA7;&#x9501;&#x65E0;&#x7591;&#x4F7F;&#x9501;&#x7684;&#x7C92;&#x5EA6;&#x66F4;&#x7EC6;&#xFF0C;&#x4F46;&#x662F;&#x6570;&#x636E;&#x8FC7;&#x591A;&#x65F6;&#xFF0C;&#x5728;&#x9AD8;&#x5E76;&#x53D1;&#x573A;&#x666F;&#x4E0B;&#xFF0C;&#x540C;&#x4E00;&#x65F6;&#x523B;&#x4F1A;&#x4EA7;&#x751F;&#x5927;&#x91CF;&#x7684;&#x9501;&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;InnoDB&#x4E5F;&#x5BF9;&#x9501;&#x8FDB;&#x884C;&#x4E86;&#x7A7A;&#x95F4;&#x7684;&#x6709;&#x6548;&#x4F18;&#x5316;&#xFF0C;&#x4F7F;&#x5F97;&#x5176;&#x5728;&#x5E76;&#x53D1;&#x91CF;&#x9AD8;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4E5F;&#x4E0D;&#x4F1A;&#x56E0;&#x4E3A;&#x540C;&#x4E00;&#x65F6;&#x523B;&#x9501;&#x8FC7;&#x591A;&#xFF0C;&#x800C;&#x5BFC;&#x81F4;&#x5185;&#x5B58;&#x8017;&#x5C3D;&#x3002;</li>
</ul>
<pre><code>+ &#x6392;&#x4ED6;&#x9501;
+ &#x5171;&#x4EAB;&#x9501;&#x3002;</code></pre><ul>
<li>&#x9694;&#x79BB;&#x7EA7;&#x522B;</li>
</ul>
<pre><code>+ READ\_UNCOMMITTED&#xFF1A;&#x810F;&#x8BFB;
+ READ\_COMMITTED&#xFF1A;&#x8BFB;&#x63D0;&#x4EA4;
+ REPEATABLE\_READ&#xFF1A;&#x91CD;&#x590D;&#x8BFB;
+ SERIALIZABLE&#xFF1A;&#x4E32;&#x884C;&#x5316;</code></pre><ul>
<li>redo log</li>
</ul>
<p>redo log &#x5C31;&#x662F;&#x4FDD;&#x5B58;&#x6267;&#x884C;&#x7684;SQL&#x8BED;&#x53E5;&#x5230;&#x4E00;&#x4E2A;&#x6307;&#x5B9A;&#x7684;Log&#x6587;&#x4EF6;&#xFF0C;&#x5F53;Mysql&#x6267;&#x884C;recovery&#x65F6;&#x91CD;&#x65B0;&#x6267;&#x884C;redo log&#x8BB0;&#x5F55;&#x7684;SQL&#x64CD;&#x4F5C;&#x5373;&#x53EF;&#x3002;&#x5F53;&#x5BA2;&#x6237;&#x7AEF;&#x6267;&#x884C;&#x6BCF;&#x6761;SQL&#xFF08;&#x66F4;&#x65B0;&#x8BED;&#x53E5;&#xFF09;&#x65F6;&#xFF0C;redo log&#x4F1A;&#x88AB;&#x9996;&#x5148;&#x5199;&#x5165;log buffer&#xFF1B;&#x5F53;&#x5BA2;&#x6237;&#x7AEF;&#x6267;&#x884C;COMMIT&#x547D;&#x4EE4;&#x65F6;&#xFF0C;log buffer&#x4E2D;&#x7684;&#x5185;&#x5BB9;&#x4F1A;&#x88AB;&#x89C6;&#x60C5;&#x51B5;&#x5237;&#x65B0;&#x5230;&#x78C1;&#x76D8;&#x3002;redo log&#x5728;&#x78C1;&#x76D8;&#x4E0A;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x72EC;&#x7ACB;&#x7684;&#x6587;&#x4EF6;&#x5B58;&#x5728;&#xFF0C;&#x5373;InnoDB&#x7684;log&#x6587;&#x4EF6;&#x3002;</p>
<ul>
<li>undo log</li>
</ul>
<p>&#x4E0E;redo log&#x76F8;&#x53CD;&#xFF0C;undo log&#x662F;&#x4E3A;&#x56DE;&#x6EDA;&#x800C;&#x7528;&#xFF0C;&#x5177;&#x4F53;&#x5185;&#x5BB9;&#x5C31;&#x662F;&#x5C06;&#x4E8B;&#x52A1;&#x5F71;&#x54CD;&#x5230;&#x7684;&#x884C;&#x7684;&#x539F;&#x59CB;&#x6570;&#x636E;&#x884C;&#x5199;&#x5165;&#x5230;&#x5230;undo buffer&#xFF0C;&#x5728;&#x5408;&#x9002;&#x7684;&#x65F6;&#x95F4;&#x628A;undo buffer&#x4E2D;&#x7684;&#x5185;&#x5BB9;&#x5237;&#x65B0;&#x5230;&#x78C1;&#x76D8;&#x3002;undo buffer&#x4E0E;redo buffer&#x4E00;&#x6837;&#xFF0C;&#x4E5F;&#x662F;&#x73AF;&#x5F62;&#x7F13;&#x51B2;&#xFF0C;&#x4F46;&#x5F53;&#x7F13;&#x51B2;&#x6EE1;&#x7684;&#x65F6;&#x5019;&#xFF0C;undo buffer&#x4E2D;&#x7684;&#x5185;&#x5BB9;&#x4F1A;&#x4E5F;&#x4F1A;&#x88AB;&#x5237;&#x65B0;&#x5230;&#x78C1;&#x76D8;&#xFF1B;&#x4E0E;redo log&#x4E0D;&#x540C;&#x7684;&#x662F;&#xFF0C;&#x78C1;&#x76D8;&#x4E0A;&#x4E0D;&#x5B58;&#x5728;&#x5355;&#x72EC;&#x7684;undo log&#x6587;&#x4EF6;&#xFF0C;&#x6240;&#x6709;&#x7684;undo log&#x5747;&#x5B58;&#x653E;&#x5728;&#x4E3B;ibd&#xFF08;&#x8868;&#x7A7A;&#x95F4;&#xFF09;&#x6570;&#x636E;&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x5373;&#x4F7F;&#x5BA2;&#x6237;&#x7AEF;&#x8BBE;&#x7F6E;&#x4E86;&#x6BCF;&#x8868;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x6587;&#x4EF6;&#x4E5F;&#x662F;&#x5982;&#x6B64;&#x3002;</p>
<h2 id="&#x884C;&#x66F4;&#x65B0;&#x7684;&#x8FC7;&#x7A0B;"><a href="#&#x884C;&#x66F4;&#x65B0;&#x7684;&#x8FC7;&#x7A0B;" class="headerlink" title="&#x884C;&#x66F4;&#x65B0;&#x7684;&#x8FC7;&#x7A0B;"></a>&#x884C;&#x66F4;&#x65B0;&#x7684;&#x8FC7;&#x7A0B;</h2><p>InnoDB&#x4E3A;&#x6BCF;&#x884C;&#x8BB0;&#x5F55;&#x90FD;&#x5B9E;&#x73B0;&#x4E86;&#x4E09;&#x4E2A;&#x9690;&#x85CF;&#x5B57;&#x6BB5;&#xFF1A;</p>
<ul>
<li>&#x9690;&#x85CF;&#x7684;ID</li>
<li>6&#x5B57;&#x8282;&#x7684;&#x4E8B;&#x52A1;ID&#xFF08;<strong>DB_TRX_ID</strong>&#xFF09;</li>
<li>7&#x5B57;&#x8282;&#x7684;&#x56DE;&#x6EDA;&#x6307;&#x9488;&#xFF08;<strong>DB_ROLL_PTR</strong>&#xFF09;</li>
</ul>
<p>&#x884C;&#x66F4;&#x65B0;&#x7684;&#x8FC7;&#x7A0B;</p>
<ol>
<li>&#x6570;&#x636E;&#x5E93;&#x65B0;&#x589E;&#x4E00;&#x6761;&#x6570;&#x636E;&#xFF0C;&#x8BE5;&#x6761;&#x6570;&#x636E;&#x4E09;&#x4E2A;&#x9690;&#x85CF;&#x5B57;&#x6BB5;&#xFF0C;&#x53EA;&#x6709;ID&#x6709;&#x503C;</li>
<li>T1&#x4FEE;&#x6539;&#x8BE5;&#x6761;&#x6570;&#x636E;&#xFF0C;&#x5F00;&#x542F;&#x4E8B;&#x52A1;&#xFF0C;&#x8BB0;&#x5F55;read_view</li>
</ol>
<pre><code>* &#x6392;&#x5B83;&#x9501;&#x9501;&#x5B9A;&#x8BE5;&#x884C;&#x6570;&#x636E;
* &#x8BB0;&#x5F55;redo log
* &#x5C06;&#x8BE5;&#x884C;&#x6570;&#x636E;&#x5199;&#x5165;undo log
* &#x5C06;&#x4FEE;&#x6539;&#x503C;&#x5199;&#x5165;&#x8BE5;&#x6761;&#x6570;&#x636E;&#xFF0C;&#x586B;&#x5199;&#x4E8B;&#x52A1;Id&#xFF0C;&#x6839;&#x636E;undo log&#x8BB0;&#x5F55;&#x4F4D;&#x7F6E;&#x586B;&#x5199;&#x56DE;&#x6EDA;&#x6307;&#x9488;</code></pre><ol start="3">
<li>T2&#x4FEE;&#x6539;&#x8BE5;&#x6761;&#x6570;&#x636E;&#xFF0C;&#x5F00;&#x542F;&#x4E8B;&#x52A1;&#xFF0C;&#x8BB0;&#x5F55;read_view</li>
</ol>
<pre><code>* &#x6392;&#x5B83;&#x9501;&#x9501;&#x5B9A;&#x8BE5;&#x884C;&#x6570;&#x636E;
* &#x8BB0;&#x5F55;redo log
* &#x5C06;&#x8BE5;&#x884C;&#x6570;&#x636E;&#x5199;&#x5165;undo log
* &#x5C06;&#x4FEE;&#x6539;&#x503C;&#x5199;&#x5165;&#x8BE5;&#x6761;&#x6570;&#x636E;&#xFF0C;&#x586B;&#x5199;&#x4E8B;&#x52A1;Id&#xFF0C;&#x901A;&#x8FC7;&#x56DE;&#x6EDA;&#x6307;&#x9488;&#x5C06;undo log &#x7684;&#x4E24;&#x6761;&#x8BB0;&#x5F55;&#x8FDE;&#x63A5;&#x8D77;&#x6765;&#xFF08;&#x7248;&#x672C;&#x94FE;&#xFF09;</code></pre><ol start="4">
<li>&#x4E8B;&#x52A1;&#x63D0;&#x4EA4;&#xFF0C;&#x8BB0;&#x5F55;read_view</li>
</ol>
<pre><code>* &#x6B63;&#x5E38;&#x63D0;&#x4EA4;
* &#x5982;&#x679C;&#x89E6;&#x53D1;&#x56DE;&#x6EDA;&#xFF0C;&#x9700;&#x8981;&#x6839;&#x636E;&#x56DE;&#x6EDA;&#x6307;&#x9488;&#x627E;&#x5230;undo log&#x5BF9;&#x5E94;&#x8BB0;&#x5F55;&#x8FDB;&#x884C;&#x56DE;&#x6EDA;</code></pre><p>&#x6CE8;&#x610F;&#xFF1A;</p>
<ul>
<li>InnoDB&#x4E2D;&#x5B58;&#x5728;purge&#x7EBF;&#x7A0B;&#xFF0C;&#x5B83;&#x8D1F;&#x8D23;&#x67E5;&#x8BE2;&#xFF0C;&#x5E76;&#x6E05;&#x7406;&#x90A3;&#x4E9B;&#x65E0;&#x6548;&#x7684;undo log&#x3002;</li>
<li>&#x4E0A;&#x8FF0;&#x8FC7;&#x7A0B;&#x63CF;&#x8FF0;&#x7684;&#x662F;UPDATE&#x4E8B;&#x52A1;&#x7684;&#x8FC7;&#x7A0B;&#xFF0C;&#x5F53;INSERT&#x65F6;&#xFF0C;&#x539F;&#x59CB;&#x7684;&#x6570;&#x636E;&#x5E76;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x56DE;&#x6EDA;&#x65F6;&#x628A;insert&#x4E22;&#x5F03;&#x5373;&#x53EF;</li>
</ul>
<h2 id="MVCC&#x7684;&#x57FA;&#x672C;&#x7279;&#x5F81;"><a href="#MVCC&#x7684;&#x57FA;&#x672C;&#x7279;&#x5F81;" class="headerlink" title="MVCC&#x7684;&#x57FA;&#x672C;&#x7279;&#x5F81;"></a>MVCC&#x7684;&#x57FA;&#x672C;&#x7279;&#x5F81;</h2><ul>
<li>&#x6BCF;&#x884C;&#x6570;&#x636E;&#x90FD;&#x5B58;&#x5728;&#x4E00;&#x4E2A;&#x7248;&#x672C;&#xFF0C;&#x6BCF;&#x6B21;&#x66F4;&#x65B0;&#x6570;&#x636E;&#x65F6;&#x90FD;&#x66F4;&#x65B0;&#x8BE5;&#x7248;&#x672C;&#x3002;</li>
<li>&#x4FEE;&#x6539;&#x65F6;&#x62F7;&#x8D1D;&#x51FA;&#x5F53;&#x524D;&#x7248;&#x672C;&#x968F;&#x610F;&#x4FEE;&#x6539;&#xFF0C;&#x5404;&#x4E2A;&#x4E8B;&#x52A1;&#x4E4B;&#x95F4;&#x65E0;&#x5E72;&#x6270;&#x3002;</li>
<li>&#x4FDD;&#x5B58;&#x65F6;&#x6BD4;&#x8F83;&#x7248;&#x672C;&#x53F7;&#xFF0C;&#x5982;&#x679C;&#x6210;&#x529F;&#x63D0;&#x4EA4;&#x4E8B;&#x52A1;&#xFF0C;&#x5219;&#x8986;&#x76D6;&#x539F;&#x8BB0;&#x5F55;&#xFF1B;&#x5982;&#x679C;&#x5931;&#x8D25;&#x56DE;&#x6EDA;&#x5219;&#x653E;&#x5F03;&#x62F7;&#x8D1D;&#x7684;&#x6570;&#x636E;&#x3002;</li>
</ul>
<h2 id="InnoDB&#x5982;&#x4F55;&#x5B9E;&#x73B0;MVCC&#xFF1F;"><a href="#InnoDB&#x5982;&#x4F55;&#x5B9E;&#x73B0;MVCC&#xFF1F;" class="headerlink" title="InnoDB&#x5982;&#x4F55;&#x5B9E;&#x73B0;MVCC&#xFF1F;"></a>InnoDB&#x5982;&#x4F55;&#x5B9E;&#x73B0;MVCC&#xFF1F;</h2><p>MVCC&#x5219;&#x662F;&#x5EFA;&#x7ACB;&#x5728;undo log &#x4E4B;&#x4E0A;&#x7684;&#x3002;</p>
<p>undo log &#x4E2D;&#x8BB0;&#x5F55;&#x7684;&#x6570;&#x636E;&#x5C31;&#x662F;MVCC&#x4E2D;&#x7684;&#x591A;&#x7248;&#x672C;&#x3002;</p>
<p>&#x901A;&#x8FC7;&#x56DE;&#x6EDA;&#x6307;&#x9488;&#x5F62;&#x6210;&#x7248;&#x672C;&#x94FE;&#x3002;</p>
<p>&#x901A;&#x8FC7;&#x4E8B;&#x52A1;ID&#x53EF;&#x4EE5;&#x67E5;&#x627E;&#x5230;read-view&#x4E0A;&#x7684;&#x8BB0;&#x5F55;</p>
<p>RC&#x9694;&#x79BB;&#x7EA7;&#x522B;&#x548C;RR&#x9694;&#x79BB;&#x7EA7;&#x522B;&#x751F;&#x6210;read-view&#x7684;&#x65F6;&#x673A;&#x4E0D;&#x4E00;&#x6837;&#xFF0C;RR&#x662F;&#x5728;&#x5F00;&#x59CB;&#x4E8B;&#x52A1;&#x65F6;&#xFF0C;RC&#x662F;&#x5728;&#x6BCF;&#x4E00;&#x6B21;&#x67E5;&#x8BE2;&#xFF0C;&#x6240;&#x4EE5;&#x5728;RR&#x9694;&#x79BB;&#x7EA7;&#x522B;&#x4E0B;&#xFF0C;MVCC&#x53EF;&#x4EE5;&#x89E3;&#x51B3;&#x5E7B;&#x8BFB;&#x95EE;&#x9898;&#x3002;</p>
<p><strong>read-view&#x8BB0;&#x5F55;&#xFF1A;</strong></p>
<ul>
<li>m_ids:&#x8868;&#x793A;&#x6D3B;&#x8DC3;&#x4E8B;&#x52A1;id&#x5217;&#x8868;</li>
<li>min_trx_id:&#x6D3B;&#x8DC3;&#x4E8B;&#x52A1;&#x4E2D;&#x7684;&#x6700;&#x5C0F;&#x4E8B;&#x52A1;id</li>
<li>max_trx_id:&#x5DF2;&#x521B;&#x5EFA;&#x7684;&#x6700;&#x5927;&#x4E8B;&#x52A1;id</li>
<li>creator_trx_id:&#x5F53;&#x524D;&#x7684;&#x4E8B;&#x52A1;id</li>
</ul>
<p><strong>&#x7248;&#x672C;&#x94FE;&#x6BD4;&#x5BF9;&#x89C4;&#x5219;&#xFF1A;</strong></p>
<ol>
<li>&#x5982;&#x679C; trx_id &lt; min_trx_id&#xFF0C;&#x8868;&#x793A;&#x8FD9;&#x4E2A;&#x7248;&#x672C;&#x662F;&#x5DF2;&#x63D0;&#x4EA4;&#x7684;&#x4E8B;&#x52A1;&#x751F;&#x6210;&#x7684;,&#x8FD9;&#x4E2A;&#x6570;&#x636E;&#x662F;&#x53EF;&#x89C1;&#x7684;&#xFF1B;</li>
<li>&#x5982;&#x679C; trx_id &gt; max_trx_id&#xFF0C;&#x8868;&#x793A;&#x8FD9;&#x4E2A;&#x7248;&#x672C;&#x662F;&#x7531;&#x5C06;&#x6765;&#x542F;&#x52A8;&#x7684;&#x4E8B;&#x52A1;&#x751F;&#x6210;&#x7684;,&#x662F;&#x80AF;&#x5B9A;&#x4E0D;&#x53EF;&#x89C1;&#x7684;&#x3002;</li>
<li>&#x5982;&#x679C; min_trx_id &lt;= trx_id &lt;= max_trx_id&#xFF0C;&#x90A3;&#x5C31;&#x5305;&#x62EC;&#x4E24;&#x79CD;&#x60C5;&#x51B5;</li>
</ol>
<pre><code>* &#x82E5;row&#x7684;trx\_id&#x5728;m\_ids&#x6570;&#x7EC4;&#x4E2D;&#xFF0C;&#x8868;&#x793A;&#x8FD9;&#x4E2A;&#x7248;&#x672C;&#x662F;&#x7531;&#x8FD8;&#x6CA1;&#x63D0;&#x4EA4;&#x7684;&#x4E8B;&#x52A1;&#x751F;&#x6210;&#x7684;,&#x4E0D;&#x53EF;&#x89C1;,&#x5F53;&#x524D;&#x81EA;&#x5DF1;&#x7684;&#x4E8B;&#x52A1;&#x662F;&#x53EF;&#x89C1;&#x7684;&#x3002;
* &#x82E5;row&#x7684;trx\_id&#x4E0D;&#x5728;m\_ids&#x6570;&#x7EC4;&#x4E2D;&#xFF0C;&#x8868;&#x793A;&#x8FD9;&#x4E2A;&#x7248;&#x672C;&#x662F;&#x5DF2;&#x7ECF;&#x63D0;&#x4EA4;&#x4E86;&#x7684;&#x4E8B;&#x52A1;&#x751F;&#x6210;&#x7684;,&#x53EF;&#x89C1;</code></pre><p>MySQL&#x7684;InnoDB&#x5B9E;&#x73B0;MVCC&#xFF0C;&#x5C31;&#x662F;&#x5728;&#x9694;&#x79BB;&#x7EA7;&#x522B;&#x4E3A;<strong>&#x8BFB;&#x5DF2;&#x63D0;&#x4EA4;</strong>&#x548C;<strong>&#x53EF;&#x91CD;&#x590D;&#x8BFB;</strong>&#xFF0C;&#x57FA;&#x4E8E;<strong>&#x4E50;&#x89C2;&#x9501;&#x7406;&#x8BBA;</strong>&#xFF0C;&#x901A;&#x8FC7;&#x4E8B;&#x52A1;ID&#x548C;read-view&#x7684;&#x8BB0;&#x5F55;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#x5224;&#x65AD;&#x5206;&#x6790;&#x6570;&#x636E;&#x662F;&#x5426;&#x53EF;&#x89C1;&#xFF0C;&#x4ECE;&#x800C;&#x4F7F;&#x5176;&#x5927;&#x90E8;&#x5206;&#x8BFB;&#x64CD;&#x4F5C;&#x53EF;&#x4EE5;&#x65E0;&#x9700;&#x52A0;&#x9501;&#xFF0C;&#x4ECE;&#x800C;&#x63D0;&#x9AD8;&#x5E76;&#x53D1;&#x6027;&#x80FD;&#x3002;</p>
<p>&#x4F46;&#x662F;&#x5728;&#x5199;&#x6570;&#x636E;&#x7684;&#x65F6;&#x5019;&#xFF0C;InnoDB&#x8FD8;&#x662F;&#x9700;&#x8981;&#x52A0;&#x6392;&#x5B83;&#x9501;&#x7684;&#x3002;</p>
<p><strong>&#x603B;&#x7ED3;&#xFF0C;&#x5C31;&#x662F;&#x7528;&#x4E50;&#x89C2;&#x9501;&#x4EE3;&#x66FF;&#x60B2;&#x89C2;&#x9501;&#xFF0C;&#x4ECE;&#x800C;&#x63D0;&#x9AD8;&#x5E76;&#x53D1;&#x6027;&#x80FD;&#xFF0C;&#x8FD9;&#x5C31;&#x662F;MVCC&#x3002;</strong></p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/0043a552e94a6de65d64b4508c2f3c07.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="../200/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="../../">1</a><span class="space">&hellip;</span><a class="page-number" href="../200/">200</a><span class="page-number current">201</span><a class="page-number" href="../202/">202</a><span class="space">&hellip;</span><a class="page-number" href="../399/">399</a><a class="extend next" rel="next" href="../202/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">开发者博客</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="https://dev.newban.cn/archives/">
              
                  <span class="site-state-item-count">3990</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">1304</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="../../atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">开发者博客</span>
  <div>
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
  </div>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




  <script type="text/javascript" async src="js/src/mermaid.min.js"></script>
  <script>
  if (window.mermaid) {
        var mermaid_config = {
            startOnLoad: true,
            theme: 'default',
            flowchart:{
                useMaxWidth: false,
                htmlLabels: true
            }                
        }
        mermaid.initialize(mermaid_config);
  }
  </script>
  

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="../../lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="../../lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="../../lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="../../lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="../../lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="../../lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="../../js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="../../js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="../../js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
