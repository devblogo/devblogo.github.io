<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">
<meta name="referrer" content="never">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="../../lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="../../lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="../../css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="../../images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="../../images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="../../images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="../../images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">





  <link rel="alternate" href="../../atom.xml" title="开发者博客 – IT技术 尽在开发者博客" type="application/atom+xml">






<meta property="og:type" content="website">
<meta property="og:title" content="开发者博客 – IT技术 尽在开发者博客">
<meta property="og:url" content="https://dev.newban.cn/page/184/index.html">
<meta property="og:site_name" content="开发者博客 – IT技术 尽在开发者博客">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="开发者博客 – IT技术 尽在开发者博客">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>
<!--谷歌广告验证代码-->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-2626449904708114",
          enable_page_level_ads: true
     });
</script>
<!--谷歌广告验证代码-->



  <link rel="canonical" href="https://dev.newban.cn/page/184/">





  <title>开发者博客 – IT技术 尽在开发者博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">开发者博客 – IT技术 尽在开发者博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">开发者博客 – 科技是第一生产力</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="http://dev.newban.cn/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="https://dev.newban.cn/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7034715997445554184.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7034715997445554184.html" itemprop="url">代理网关设计与实现（基于NETTY） 一 问题背景 二 技术</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-11-26T11:32:56+08:00">
                2021-11-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x7B80;&#x4ECB;&#xFF1A;&#x672C;&#x6587;&#x91CD;&#x70B9;&#x5728;&#x4EE3;&#x7406;&#x7F51;&#x5173;&#x672C;&#x8EAB;&#x7684;&#x8BBE;&#x8BA1;&#x4E0E;&#x5B9E;&#x73B0;&#xFF0C;&#x800C;&#x975E;&#x4EE3;&#x7406;&#x8D44;&#x6E90;&#x7684;&#x7BA1;&#x7406;&#x4E0E;&#x7EF4;&#x62A4;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/e2688aea85248121c5b01d2f43d6da2744a2073fdaa303ee5d25d85bce9c0e3e" alt></p>
<p>&#x4F5C;&#x8005; | &#x65B0;&#x7136;  </p>
<p>&#x6765;&#x6E90; | &#x963F;&#x91CC;&#x6280;&#x672F;&#x516C;&#x4F17;&#x53F7;</p>
<h1 id="&#x4E00;-&#x95EE;&#x9898;&#x80CC;&#x666F;"><a href="#&#x4E00;-&#x95EE;&#x9898;&#x80CC;&#x666F;" class="headerlink" title="&#x4E00; &#x95EE;&#x9898;&#x80CC;&#x666F;"></a>&#x4E00; &#x95EE;&#x9898;&#x80CC;&#x666F;</h1><ol>
<li>&#x5E73;&#x53F0;&#x7AEF;&#x8D2D;&#x7F6E;&#x4E00;&#x6279;&#x88F8;&#x4EE3;&#x7406;&#xFF0C;&#x6765;&#x505A;&#x5E7F;&#x544A;&#x5F02;&#x5730;&#x5C55;&#x73B0;&#x5BA1;&#x6838;&#x3002;&#x4ECE;&#x5916;&#x90E8;&#x8D2D;&#x7F6E;&#x7684;&#x4EE3;&#x7406;&#xFF0C;&#x4F7F;&#x7528;&#x65B9;&#x5F0F;&#x4E3A;&#xFF1A;</li>
<li>&#x901A;&#x8FC7;&#x7ED9;&#x5B9A;&#x7684;HTTP &#x7684; API &#x63D0;&#x53D6;&#x4EE3;&#x7406; IP:PORT&#xFF0C;&#x8FD4;&#x56DE;&#x7684;&#x7ED3;&#x679C;&#x4F1A;&#x7ED9;&#x51FA;&#x4EE3;&#x7406;&#x7684;&#x6709;&#x6548;&#x65F6;&#x957F; 3~5 &#x5206;&#x949F;&#xFF0C;&#x4EE5;&#x53CA;&#x4EE3;&#x7406;&#x6240;&#x5C5E;&#x5730;&#x57DF;&#xFF1B;</li>
</ol>
<p>&#x4ECE;&#x63D0;&#x53D6;&#x7684;&#x4EE3;&#x7406;&#x4E2D;&#xFF0C;&#x9009;&#x53D6;&#x6307;&#x5B9A;&#x5730;&#x57DF;&#xFF0C;&#x6DFB;&#x52A0;&#x8BA4;&#x8BC1;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x6C42;&#x83B7;&#x53D6;&#x7ED3;&#x679C;&#xFF1B;</p>
<p>&#x672C;&#x6587;&#x8BBE;&#x8BA1;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x901A;&#x8FC7;&#x7684;&#x4EE3;&#x7406;&#x7F51;&#x5173;&#xFF1A;</p>
<ol>
<li>&#x7BA1;&#x7406;&#x7EF4;&#x62A4;&#x4EE3;&#x7406;&#x8D44;&#x6E90;&#xFF0C;&#x5E76;&#x505A;&#x4EE3;&#x7406;&#x7684;&#x8BA4;&#x8BC1;&#x9274;&#x6743;&#xFF1B;</li>
<li>&#x5BF9;&#x5916;&#x66B4;&#x9732;&#x7EDF;&#x4E00;&#x7684;&#x4EE3;&#x7406;&#x5165;&#x53E3;&#xFF0C;&#x800C;&#x975E;&#x52A8;&#x6001;&#x53D8;&#x5316;&#x7684;&#x4EE3;&#x7406;IP:PORT&#xFF1B;</li>
<li>&#x6D41;&#x91CF;&#x8FC7;&#x6EE4;&#x53CA;&#x9650;&#x6D41;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;&#x9759;&#x6001;&#x8D44;&#x6E90;&#x4E0D;&#x8D70;&#x4EE3;&#x7406;&#xFF1B;</li>
</ol>
<p>&#x672C;&#x6587;&#x91CD;&#x70B9;&#x5728;&#x4EE3;&#x7406;&#x7F51;&#x5173;&#x672C;&#x8EAB;&#x7684;&#x8BBE;&#x8BA1;&#x4E0E;&#x5B9E;&#x73B0;&#xFF0C;&#x800C;&#x975E;&#x4EE3;&#x7406;&#x8D44;&#x6E90;&#x7684;&#x7BA1;&#x7406;&#x4E0E;&#x7EF4;&#x62A4;&#x3002;</p>
<blockquote>
<p>&#x6CE8;&#xFF1A;&#x672C;&#x6587;&#x5305;&#x542B;&#x5927;&#x91CF;&#x53EF;&#x6267;&#x884C;&#x7684;JAVA&#x4EE3;&#x7801;&#x4EE5;&#x89E3;&#x91CA;&#x4EE3;&#x7406;&#x76F8;&#x5173;&#x7684;&#x539F;&#x7406;</p>
</blockquote>
<h1 id="&#x4E8C;-&#x6280;&#x672F;&#x8DEF;&#x7EBF;"><a href="#&#x4E8C;-&#x6280;&#x672F;&#x8DEF;&#x7EBF;" class="headerlink" title="&#x4E8C; &#x6280;&#x672F;&#x8DEF;&#x7EBF;"></a>&#x4E8C; &#x6280;&#x672F;&#x8DEF;&#x7EBF;</h1><p>&#x672C;&#x6587;&#x7684;&#x6280;&#x672F;&#x8DEF;&#x7EBF;&#x3002;&#x5728;&#x5B9E;&#x73B0;&#x4EE3;&#x7406;&#x7F51;&#x5173;&#x4E4B;&#x524D;&#xFF0C;&#x9996;&#x5148;&#x4ECB;&#x7ECD;&#x4E0B;&#x4EE3;&#x7406;&#x76F8;&#x5173;&#x7684;&#x539F;&#x7406;&#x53CA;&#x5982;&#x4F55;&#x5B9E;&#x73B0;</p>
<ol>
<li>&#x900F;&#x660E;&#x4EE3;&#x7406;&#xFF1B;</li>
<li>&#x975E;&#x900F;&#x660E;&#x4EE3;&#x7406;&#xFF1B;</li>
<li>&#x900F;&#x660E;&#x7684;&#x4E0A;&#x6E38;&#x4EE3;&#x7406;&#xFF1B;</li>
<li>&#x975E;&#x900F;&#x660E;&#x7684;&#x4E0A;&#x6E38;&#x4EE3;&#x7406;&#xFF1B;</li>
</ol>
<p>&#x6700;&#x540E;&#xFF0C;&#x672C;&#x6587;&#x8981;&#x6784;&#x5EFA;&#x4EE3;&#x7406;&#x7F51;&#x5173;&#xFF0C;&#x672C;&#x8D28;&#x4E0A;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x975E;&#x900F;&#x660E;&#x7684;&#x4E0A;&#x6E38;&#x4EE3;&#x7406;&#xFF0C;&#x5E76;&#x7ED9;&#x51FA;&#x8BE6;&#x7EC6;&#x7684;&#x8BBE;&#x8BA1;&#x4E0E;&#x5B9E;&#x73B0;&#x3002;</p>
<p><strong>1 &#x900F;&#x660E;&#x4EE3;&#x7406;</strong></p>
<p>&#x900F;&#x660E;&#x4EE3;&#x7406;&#x662F;&#x4EE3;&#x7406;&#x7F51;&#x5173;&#x7684;&#x57FA;&#x7840;&#xFF0C;&#x672C;&#x6587;&#x91C7;&#x7528;JAVA&#x539F;&#x751F;&#x7684;NIO&#x8FDB;&#x884C;&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;&#x3002;&#x5728;&#x5B9E;&#x73B0;&#x4EE3;&#x7406;&#x7F51;&#x5173;&#x65F6;&#xFF0C;&#x5B9E;&#x9645;&#x4F7F;&#x7528;&#x7684;&#x4E3A;NETTY&#x6846;&#x67B6;&#x3002;&#x539F;&#x751F;NIO&#x7684;&#x5B9E;&#x73B0;&#x5BF9;&#x7406;&#x89E3;NETTY&#x7684;&#x5B9E;&#x73B0;&#x6709;&#x5E2E;&#x52A9;&#x3002;</p>
<p>&#x900F;&#x660E;&#x4EE3;&#x7406;&#x8BBE;&#x8BA1;&#x4E09;&#x4E2A;&#x4EA4;&#x4E92;&#x65B9;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x3001;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x3001;&#x670D;&#x52A1;&#x7AEF;&#xFF0C;&#x5176;&#x539F;&#x7406;&#x662F;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/fd35aefbc5c6b2f7100a3e7b80c50ba86c3f0309b139d3ce6053fae3303abd66" alt></p>
<ol>
<li>&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5728;&#x6536;&#x5230;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x5224;&#x5B9A;&#xFF1A;&#x5982;&#x679C;&#x662F;CONNECT&#x8BF7;&#x6C42;&#xFF0C;&#x9700;&#x8981;&#x56DE;&#x5E94;&#x4EE3;&#x7406;&#x8FDE;&#x63A5;&#x6210;&#x529F;&#x6D88;&#x606F;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#xFF1B;</li>
<li>CONNECT&#x8BF7;&#x6C42;&#x56DE;&#x5E94;&#x7ED3;&#x675F;&#x540E;&#xFF0C;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x9700;&#x8981;&#x8FDE;&#x63A5;&#x5230;CONNECT&#x6307;&#x5B9A;&#x7684;&#x8FDC;&#x7A0B;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x7136;&#x540E;&#x76F4;&#x63A5;&#x8F6C;&#x53D1;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x8FDC;&#x7A0B;&#x670D;&#x52A1;&#x901A;&#x4FE1;&#xFF1B;</li>
<li>&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5728;&#x6536;&#x5230;&#x975E;CONNECT&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x89E3;&#x6790;&#x51FA;&#x8BF7;&#x6C42;&#x7684;&#x8FDC;&#x7A0B;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x7136;&#x540E;&#x76F4;&#x63A5;&#x8F6C;&#x53D1;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x8FDC;&#x7A0B;&#x670D;&#x52A1;&#x901A;&#x4FE1;&#xFF1B;</li>
</ol>
<p>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x70B9;&#x662F;&#xFF1A;</p>
<ol>
<li>&#x901A;&#x5E38;HTTPS&#x8BF7;&#x6C42;&#xFF0C;&#x5728;&#x901A;&#x8FC7;&#x4EE3;&#x7406;&#x524D;&#xFF0C;&#x4F1A;&#x53D1;&#x9001;CONNECT&#x8BF7;&#x6C42;&#xFF1B;&#x8FDE;&#x63A5;&#x6210;&#x529F;&#x540E;&#xFF0C;&#x4F1A;&#x5728;&#x4FE1;&#x9053;&#x4E0A;&#x8FDB;&#x884C;&#x52A0;&#x5BC6;&#x901A;&#x4FE1;&#x7684;&#x63E1;&#x624B;&#x534F;&#x8BAE;&#xFF1B;&#x56E0;&#x6B64;&#x8FDE;&#x63A5;&#x8FDC;&#x7A0B;&#x7684;&#x65F6;&#x673A;&#x662F;&#x5728;CONNECT&#x8BF7;&#x6C42;&#x6536;&#x5230;&#x65F6;&#xFF0C;&#x56E0;&#x4E3A;&#x6B64;&#x540E;&#x662F;&#x52A0;&#x5BC6;&#x6570;&#x636E;&#xFF1B;</li>
<li>&#x900F;&#x660E;&#x4EE3;&#x7406;&#x5728;&#x6536;&#x5230;CONNECT&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x4F20;&#x9012;&#x5230;&#x8FDC;&#x7A0B;&#x670D;&#x52A1;&#xFF08;&#x8FDC;&#x7A0B;&#x670D;&#x52A1;&#x4E0D;&#x8BC6;&#x522B;&#x6B64;&#x8BF7;&#x6C42;&#xFF09;&#xFF1B;</li>
<li>&#x900F;&#x660E;&#x4EE3;&#x7406;&#x5728;&#x6536;&#x5230;&#x975E;CONNECT&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x8981;&#x65E0;&#x6761;&#x4EF6;&#x8F6C;&#x53D1;&#xFF1B;</li>
</ol>
<p>&#x5B8C;&#x6574;&#x7684;&#x900F;&#x660E;&#x4EE3;&#x7406;&#x7684;&#x5B9E;&#x73B0;&#x4E0D;&#x5230;&#x7EA6;300&#x884C;&#x4EE3;&#x7801;&#xFF0C;&#x5B8C;&#x6574;&#x6458;&#x5F55;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;@Slf4j</span><br><span class="line">public class SimpleTransProxy {</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws IOException {</span><br><span class="line">        int port = 8006;</span><br><span class="line">        ServerSocketChannel localServer = ServerSocketChannel.open();</span><br><span class="line">        localServer.bind(new InetSocketAddress(port));</span><br><span class="line">        Reactor reactor = new Reactor();</span><br><span class="line">        // REACTOR&#x7EBF;&#x7A0B;</span><br><span class="line">        GlobalThreadPool.REACTOR_EXECUTOR.submit(reactor::run);</span><br><span class="line"></span><br><span class="line">        // WORKER&#x5355;&#x7EBF;&#x7A0B;&#x8C03;&#x8BD5;</span><br><span class="line">        while (localServer.isOpen()) {</span><br><span class="line">            // &#x6B64;&#x5904;&#x963B;&#x585E;&#x7B49;&#x5F85;&#x8FDE;&#x63A5;</span><br><span class="line">            SocketChannel remoteClient = localServer.accept();</span><br><span class="line"></span><br><span class="line">            // &#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;</span><br><span class="line">            GlobalThreadPool.WORK_EXECUTOR.submit(new Runnable() {</span><br><span class="line">                @SneakyThrows</span><br><span class="line">                @Override</span><br><span class="line">                public void run() {</span><br><span class="line">                    // &#x4EE3;&#x7406;&#x5230;&#x8FDC;&#x7A0B;</span><br><span class="line">                    SocketChannel remoteServer = new ProxyHandler().proxy(remoteClient);</span><br><span class="line"></span><br><span class="line">                    // &#x900F;&#x660E;&#x4F20;&#x8F93;</span><br><span class="line">                    reactor.pipe(remoteClient, remoteServer)</span><br><span class="line">                            .pipe(remoteServer, remoteClient);</span><br><span class="line">                }</span><br><span class="line">            });</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">@Data</span><br><span class="line">class ProxyHandler {</span><br><span class="line">    private String method;</span><br><span class="line">    private String host;</span><br><span class="line">    private int port;</span><br><span class="line">    private SocketChannel remoteServer;</span><br><span class="line">    private SocketChannel remoteClient;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x539F;&#x59CB;&#x4FE1;&#x606F;</span><br><span class="line">     */</span><br><span class="line">    private List&lt;ByteBuffer&gt; buffers = new ArrayList&lt;&gt;();</span><br><span class="line">    private StringBuilder stringBuilder = new StringBuilder();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x8FDE;&#x63A5;&#x5230;&#x8FDC;&#x7A0B;</span><br><span class="line">     * @param remoteClient</span><br><span class="line">     * @return</span><br><span class="line">     * @throws IOException</span><br><span class="line">     */</span><br><span class="line">    public SocketChannel proxy(SocketChannel remoteClient) throws IOException {</span><br><span class="line">        this.remoteClient = remoteClient;</span><br><span class="line">        connect();</span><br><span class="line">        return this.remoteServer;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void connect() throws IOException {</span><br><span class="line">        // &#x89E3;&#x6790;METHOD, HOST&#x548C;PORT</span><br><span class="line">        beforeConnected();</span><br><span class="line"></span><br><span class="line">        // &#x94FE;&#x63A5;REMOTE SERVER</span><br><span class="line">        createRemoteServer();</span><br><span class="line"></span><br><span class="line">        // CONNECT&#x8BF7;&#x6C42;&#x56DE;&#x5E94;&#xFF0C;&#x5176;&#x4ED6;&#x8BF7;&#x6C42;WRITE THROUGH</span><br><span class="line">        afterConnected();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    protected void beforeConnected() throws IOException {</span><br><span class="line">        // &#x8BFB;&#x53D6;HEADER</span><br><span class="line">        readAllHeader();</span><br><span class="line"></span><br><span class="line">        // &#x89E3;&#x6790;HOST&#x548C;PORT</span><br><span class="line">        parseRemoteHostAndPort();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x521B;&#x5EFA;&#x8FDC;&#x7A0B;&#x8FDE;&#x63A5;</span><br><span class="line">     * @throws IOException</span><br><span class="line">     */</span><br><span class="line">    protected void createRemoteServer() throws IOException {</span><br><span class="line">        remoteServer = SocketChannel.open(new InetSocketAddress(host, port));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x8FDE;&#x63A5;&#x5EFA;&#x7ACB;&#x540E;&#x9884;&#x5904;&#x7406;</span><br><span class="line">     * @throws IOException</span><br><span class="line">     */</span><br><span class="line">    protected void afterConnected() throws IOException {</span><br><span class="line">        // &#x5F53;CONNECT&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x9ED8;&#x8BA4;&#x5199;&#x5165;200&#x5230;CLIENT</span><br><span class="line">        if (&quot;CONNECT&quot;.equalsIgnoreCase(method)) {</span><br><span class="line">            // CONNECT&#x9ED8;&#x8BA4;&#x4E3A;443&#x7AEF;&#x53E3;&#xFF0C;&#x6839;&#x636E;HOST&#x518D;&#x89E3;&#x6790;</span><br><span class="line">            remoteClient.write(ByteBuffer.wrap(&quot;HTTP/1.0 200 Connection Established\r\nProxy-agent: nginx\r\n\r\n&quot;.getBytes()));</span><br><span class="line">        } else {</span><br><span class="line">            writeThrouth();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    protected void writeThrouth() {</span><br><span class="line">        buffers.forEach(byteBuffer -&gt; {</span><br><span class="line">            try {</span><br><span class="line">                remoteServer.write(byteBuffer);</span><br><span class="line">            } catch (IOException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x8BFB;&#x53D6;&#x8BF7;&#x6C42;&#x5185;&#x5BB9;</span><br><span class="line">     * @throws IOException</span><br><span class="line">     */</span><br><span class="line">    protected void readAllHeader() throws IOException {</span><br><span class="line">        while (true) {</span><br><span class="line">            ByteBuffer clientBuffer = newByteBuffer();</span><br><span class="line">            int read = remoteClient.read(clientBuffer);</span><br><span class="line">            clientBuffer.flip();</span><br><span class="line">            appendClientBuffer(clientBuffer);</span><br><span class="line">            if (read &lt; clientBuffer.capacity()) {</span><br><span class="line">                break;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x89E3;&#x6790;&#x51FA;HOST&#x548C;PROT</span><br><span class="line">     * @throws IOException</span><br><span class="line">     */</span><br><span class="line">    protected void parseRemoteHostAndPort() throws IOException {</span><br><span class="line">        // &#x8BFB;&#x53D6;&#x7B2C;&#x4E00;&#x6279;&#xFF0C;&#x83B7;&#x53D6;&#x5230;METHOD</span><br><span class="line">        method = parseRequestMethod(stringBuilder.toString());</span><br><span class="line"></span><br><span class="line">        // &#x9ED8;&#x8BA4;&#x4E3A;80&#x7AEF;&#x53E3;&#xFF0C;&#x6839;&#x636E;HOST&#x518D;&#x89E3;&#x6790;</span><br><span class="line">        port = 80;</span><br><span class="line">        if (&quot;CONNECT&quot;.equalsIgnoreCase(method)) {</span><br><span class="line">            port = 443;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        this.host = parseHost(stringBuilder.toString());</span><br><span class="line"></span><br><span class="line">        URI remoteServerURI = URI.create(host);</span><br><span class="line">        host = remoteServerURI.getHost();</span><br><span class="line"></span><br><span class="line">        if (remoteServerURI.getPort() &gt; 0) {</span><br><span class="line">            port = remoteServerURI.getPort();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    protected void appendClientBuffer(ByteBuffer clientBuffer) {</span><br><span class="line">        buffers.add(clientBuffer);</span><br><span class="line">        stringBuilder.append(new String(clientBuffer.array(), clientBuffer.position(), clientBuffer.limit()));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    protected static ByteBuffer newByteBuffer() {</span><br><span class="line">        // buffer&#x5FC5;&#x987B;&#x5927;&#x4E8E;7&#xFF0C;&#x4FDD;&#x8BC1;&#x80FD;&#x8BFB;&#x5230;method</span><br><span class="line">        return ByteBuffer.allocate(128);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private static String parseRequestMethod(String rawContent) {</span><br><span class="line">        // create uri</span><br><span class="line">        return rawContent.split(&quot;\r\n&quot;)[0].split(&quot; &quot;)[0];</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private static String parseHost(String rawContent) {</span><br><span class="line">        String[] headers = rawContent.split(&quot;\r\n&quot;);</span><br><span class="line">        String host = &quot;host:&quot;;</span><br><span class="line">        for (String header : headers) {</span><br><span class="line">            if (header.length() &gt; host.length()) {</span><br><span class="line">                String key = header.substring(0, host.length());</span><br><span class="line">                String value = header.substring(host.length()).trim();</span><br><span class="line">                if (host.equalsIgnoreCase(key)) {</span><br><span class="line">                    if (!value.startsWith(&quot;http://&quot;) &amp;&amp; !value.startsWith(&quot;https://&quot;)) {</span><br><span class="line">                        value = &quot;http://&quot; + value;</span><br><span class="line">                    }</span><br><span class="line">                    return value;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        return &quot;&quot;;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">@Slf4j</span><br><span class="line">@Data</span><br><span class="line">class Reactor {</span><br><span class="line"></span><br><span class="line">    private Selector selector;</span><br><span class="line"></span><br><span class="line">    private volatile boolean finish = false;</span><br><span class="line"></span><br><span class="line">    @SneakyThrows</span><br><span class="line">    public Reactor() {</span><br><span class="line">        selector = Selector.open();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @SneakyThrows</span><br><span class="line">    public Reactor pipe(SocketChannel from, SocketChannel to) {</span><br><span class="line">        from.configureBlocking(false);</span><br><span class="line">        from.register(selector, SelectionKey.OP_READ, new SocketPipe(this, from, to));</span><br><span class="line">        return this;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @SneakyThrows</span><br><span class="line">    public void run() {</span><br><span class="line">        try {</span><br><span class="line">            while (!finish) {</span><br><span class="line">                if (selector.selectNow() &gt; 0) {</span><br><span class="line">                    Iterator&lt;SelectionKey&gt; it = selector.selectedKeys().iterator();</span><br><span class="line">                    while (it.hasNext()) {</span><br><span class="line">                        SelectionKey selectionKey = it.next();</span><br><span class="line">                        if (selectionKey.isValid() &amp;&amp; selectionKey.isReadable()) {</span><br><span class="line">                            ((SocketPipe) selectionKey.attachment()).pipe();</span><br><span class="line">                        }</span><br><span class="line">                        it.remove();</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        } finally {</span><br><span class="line">            close();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @SneakyThrows</span><br><span class="line">    public synchronized void close() {</span><br><span class="line">        if (finish) {</span><br><span class="line">            return;</span><br><span class="line">        }</span><br><span class="line">        finish = true;</span><br><span class="line">        if (!selector.isOpen()) {</span><br><span class="line">            return;</span><br><span class="line">        }</span><br><span class="line">        for (SelectionKey key : selector.keys()) {</span><br><span class="line">            closeChannel(key.channel());</span><br><span class="line">            key.cancel();</span><br><span class="line">        }</span><br><span class="line">        if (selector != null) {</span><br><span class="line">            selector.close();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void cancel(SelectableChannel channel) {</span><br><span class="line">        SelectionKey key = channel.keyFor(selector);</span><br><span class="line">        if (Objects.isNull(key)) {</span><br><span class="line">            return;</span><br><span class="line">        }</span><br><span class="line">        key.cancel();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @SneakyThrows</span><br><span class="line">    public void closeChannel(Channel channel) {</span><br><span class="line">        SocketChannel socketChannel = (SocketChannel)channel;</span><br><span class="line">        if (socketChannel.isConnected() &amp;&amp; socketChannel.isOpen()) {</span><br><span class="line">            socketChannel.shutdownOutput();</span><br><span class="line">            socketChannel.shutdownInput();</span><br><span class="line">        }</span><br><span class="line">        socketChannel.close();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">@Data</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">class SocketPipe {</span><br><span class="line"></span><br><span class="line">    private Reactor reactor;</span><br><span class="line"></span><br><span class="line">    private SocketChannel from;</span><br><span class="line"></span><br><span class="line">    private SocketChannel to;</span><br><span class="line"></span><br><span class="line">    @SneakyThrows</span><br><span class="line">    public void pipe() {</span><br><span class="line">        // &#x53D6;&#x6D88;&#x76D1;&#x542C;</span><br><span class="line">        clearInterestOps();</span><br><span class="line"></span><br><span class="line">        GlobalThreadPool.PIPE_EXECUTOR.submit(new Runnable() {</span><br><span class="line">            @SneakyThrows</span><br><span class="line">            @Override</span><br><span class="line">            public void run() {</span><br><span class="line">                int totalBytesRead = 0;</span><br><span class="line">                ByteBuffer byteBuffer = ByteBuffer.allocate(1024);</span><br><span class="line">                while (valid(from) &amp;&amp; valid(to)) {</span><br><span class="line">                    byteBuffer.clear();</span><br><span class="line">                    int bytesRead = from.read(byteBuffer);</span><br><span class="line">                    totalBytesRead = totalBytesRead + bytesRead;</span><br><span class="line">                    byteBuffer.flip();</span><br><span class="line">                    to.write(byteBuffer);</span><br><span class="line">                    if (bytesRead &lt; byteBuffer.capacity()) {</span><br><span class="line">                        break;</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">                if (totalBytesRead &lt; 0) {</span><br><span class="line">                    reactor.closeChannel(from);</span><br><span class="line">                    reactor.cancel(from);</span><br><span class="line">                } else {</span><br><span class="line">                    // &#x91CD;&#x7F6E;&#x76D1;&#x542C;</span><br><span class="line">                    resetInterestOps();</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    protected void clearInterestOps() {</span><br><span class="line">        from.keyFor(reactor.getSelector()).interestOps(0);</span><br><span class="line">        to.keyFor(reactor.getSelector()).interestOps(0);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    protected void resetInterestOps() {</span><br><span class="line">        from.keyFor(reactor.getSelector()).interestOps(SelectionKey.OP_READ);</span><br><span class="line">        to.keyFor(reactor.getSelector()).interestOps(SelectionKey.OP_READ);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private boolean valid(SocketChannel channel) {</span><br><span class="line">        return channel.isConnected() &amp;&amp; channel.isRegistered() &amp;&amp; channel.isOpen();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4EE5;&#x4E0A;&#xFF0C;&#x501F;&#x9274;NETTY&#xFF1A;</p>
<ol>
<li>&#x9996;&#x5148;&#x521D;&#x59CB;&#x5316;REACTOR&#x7EBF;&#x7A0B;&#xFF0C;&#x7136;&#x540E;&#x5F00;&#x542F;&#x4EE3;&#x7406;&#x76D1;&#x542C;&#xFF0C;&#x5F53;&#x6536;&#x5230;&#x4EE3;&#x7406;&#x8BF7;&#x6C42;&#x65F6;&#x5904;&#x7406;&#x3002;</li>
<li>&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5728;&#x6536;&#x5230;&#x4EE3;&#x7406;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x9996;&#x5148;&#x505A;&#x4EE3;&#x7406;&#x7684;&#x9884;&#x5904;&#x7406;&#xFF0C;&#x7136;&#x540E;&#x53C8;SocketPipe&#x505A;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x8FDC;&#x7A0B;&#x670D;&#x52A1;&#x7AEF;&#x53CC;&#x5411;&#x8F6C;&#x53D1;&#x3002;</li>
<li>&#x4EE3;&#x7406;&#x9884;&#x5904;&#x7406;&#xFF0C;&#x9996;&#x5148;&#x8BFB;&#x53D6;&#x7B2C;&#x4E00;&#x4E2A;HTTP&#x8BF7;&#x6C42;&#xFF0C;&#x89E3;&#x6790;&#x51FA;METHOD, HOST, PORT&#x3002;</li>
<li>&#x5982;&#x679C;&#x662F;CONNECT&#x8BF7;&#x6C42;&#xFF0C;&#x53D1;&#x9001;&#x56DE;&#x5E94;Connection Established&#xFF0C;&#x7136;&#x540E;&#x8FDE;&#x63A5;&#x8FDC;&#x7A0B;&#x670D;&#x52A1;&#x7AEF;&#xFF0C;&#x5E76;&#x8FD4;&#x56DE;SocketChannel</li>
<li>&#x5982;&#x679C;&#x662F;&#x975E;CONNECT&#x8BF7;&#x6C42;&#xFF0C;&#x8FDE;&#x63A5;&#x8FDC;&#x7A0B;&#x670D;&#x52A1;&#x7AEF;&#xFF0C;&#x5199;&#x5165;&#x539F;&#x59CB;&#x8BF7;&#x6C42;&#xFF0C;&#x5E76;&#x8FD4;&#x56DE;SocketChannel</li>
<li>SocketPipe&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x8FDC;&#x7A0B;&#x670D;&#x52A1;&#x7AEF;&#xFF0C;&#x505A;&#x53CC;&#x5411;&#x7684;&#x8F6C;&#x53D1;&#xFF1B;&#x5176;&#x672C;&#x8EAB;&#x662F;&#x5C06;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x7AEF;&#x7684;SocketChannel&#x6CE8;&#x518C;&#x5230;REACTOR</li>
<li>REACTOR&#x5728;&#x76D1;&#x6D4B;&#x5230;READABLE&#x7684;CHANNEL&#xFF0C;&#x6D3E;&#x53D1;&#x7ED9;SocketPipe&#x505A;&#x53CC;&#x5411;&#x8F6C;&#x53D1;&#x3002;</li>
</ol>
<p>&#x6D4B;&#x8BD5;</p>
<p>&#x4EE3;&#x7406;&#x7684;&#x6D4B;&#x8BD5;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#xFF0C;&#x6307;&#x5411;&#x4EE3;&#x7801;&#x540E;&#xFF0C;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x76D1;&#x542C;8006&#x7AEF;&#x53E3;&#xFF0C;&#x6B64;&#x65F6;&#xFF1A;</p>
<p>curl -x &#x2018;localhost:8006&#x2019; <a href="/external_links/60d2b3d297e5a27b0b711e9ec74a92b4.html" target="blank" rel="noopener">httpbin.org/get&#x6D4B;&#x8BD5;HTTP&#x8BF7;&#x6C42;</a></p>
<p>curl -x &#x2018;localhost:8006&#x2019; <a href="/external_links/8cb584ffb6ec5b28fcefd3cc8354f965.html" target="blank" rel="noopener">httpbin.org/get&#x6D4B;&#x8BD5;HTTPS&#x8BF7;&#x2026;</a></p>
<p>&#x6CE8;&#x610F;&#xFF0C;&#x6B64;&#x65F6;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x4EE3;&#x7406;&#x4E86;HTTPS&#x8BF7;&#x6C42;&#xFF0C;&#x4F46;&#x662F;&#x5E76;&#x4E0D;&#x9700;&#x8981;-k&#x9009;&#x9879;&#xFF0C;&#x6307;&#x793A;&#x975E;&#x5B89;&#x5168;&#x7684;&#x4EE3;&#x7406;&#x3002;&#x56E0;&#x4E3A;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x672C;&#x8EAB;&#x5E76;&#x6CA1;&#x6709;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x4E2D;&#x95F4;&#x4EBA;&#xFF0C;&#x5E76;&#x6CA1;&#x6709;&#x89E3;&#x6790;&#x51FA;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x8FDC;&#x7A0B;&#x670D;&#x52A1;&#x7AEF;&#x901A;&#x4FE1;&#x7684;&#x5185;&#x5BB9;&#x3002;&#x5728;&#x975E;&#x900F;&#x660E;&#x4EE3;&#x7406;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;</p>
<p><strong>2 &#x975E;&#x900F;&#x660E;&#x4EE3;&#x7406;</strong></p>
<p>&#x975E;&#x900F;&#x660E;&#x4EE3;&#x7406;&#xFF0C;&#x9700;&#x8981;&#x89E3;&#x6790;&#x51FA;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x8FDC;&#x7A0B;&#x670D;&#x52A1;&#x7AEF;&#x4F20;&#x8F93;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x5E76;&#x505A;&#x76F8;&#x5E94;&#x7684;&#x5904;&#x7406;&#x3002;</p>
<p>&#x5F53;&#x4F20;&#x8F93;&#x4E3A;HTTP&#x534F;&#x8BAE;&#x65F6;&#xFF0C;SocketPipe&#x4F20;&#x8F93;&#x7684;&#x6570;&#x636E;&#x5373;&#x4E3A;&#x660E;&#x6587;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x53EF;&#x4EE5;&#x62E6;&#x622A;&#x540E;&#x76F4;&#x63A5;&#x505A;&#x5904;&#x7406;&#x3002;</p>
<p>&#x5F53;&#x4F20;&#x8F93;&#x4E3A;HTTPS&#x534F;&#x8BAE;&#x65F6;&#xFF0C;SocketPipe&#x4F20;&#x8F93;&#x7684;&#x6709;&#x6548;&#x6570;&#x636E;&#x4E3A;&#x52A0;&#x5BC6;&#x6570;&#x636E;&#xFF0C;&#x5E76;&#x4E0D;&#x80FD;&#x900F;&#x660E;&#x5904;&#x7406;&#x3002;  </p>
<p>&#x53E6;&#x5916;&#xFF0C;&#x65E0;&#x8BBA;&#x662F;&#x4F20;&#x8F93;&#x7684;HTTP&#x534F;&#x8BAE;&#x8FD8;&#x662F;HTTPS&#x534F;&#x8BAE;&#xFF0C;SocketPipe&#x8BFB;&#x5230;&#x7684;&#x90FD;&#x4E3A;&#x975E;&#x5B8C;&#x6574;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x9700;&#x8981;&#x505A;&#x805A;&#x6279;&#x7684;&#x5904;&#x7406;&#x3002;</p>
<ol>
<li>SocketPipe&#x805A;&#x6279;&#x95EE;&#x9898;&#xFF0C;&#x53EF;&#x4EE5;&#x91C7;&#x7528;&#x7C7B;&#x4F3C;BufferedInputStream&#x5BF9;InputStream&#x505A;Decorate&#x7684;&#x6A21;&#x5F0F;&#x6765;&#x5B9E;&#x73B0;&#xFF0C;&#x76F8;&#x5BF9;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#xFF1B;&#x8BE6;&#x7EC6;&#x53EF;&#x4EE5;&#x53C2;&#x8003;NETTY&#x7684;HttpObjectAggregator&#xFF1B;</li>
<li>HTTPS&#x539F;&#x59CB;&#x8BF7;&#x6C42;&#x548C;&#x7ED3;&#x679C;&#x6570;&#x636E;&#x7684;&#x52A0;&#x5BC6;&#x548C;&#x89E3;&#x5BC6;&#x7684;&#x5904;&#x7406;&#xFF0C;&#x9700;&#x8981;&#x5B9E;&#x73B0;&#x7684;NIO&#x7684;SOCKET CHANNEL&#xFF1B;</li>
</ol>
<p><strong>SslSocketChannel&#x5C01;&#x88C5;&#x539F;&#x7406;</strong></p>
<p>&#x8003;&#x8651;&#x5230;&#x76EE;&#x524D;JDK&#x81EA;&#x5E26;&#x7684;NIO&#x7684;SocketChannel&#x5E76;&#x4E0D;&#x652F;&#x6301;SSL&#xFF1B;&#x5DF2;&#x6709;&#x7684;SSLSocket&#x662F;&#x963B;&#x585E;&#x7684;OIO&#x3002;&#x5982;&#x56FE;&#xFF1A;</p>
<p>&#x53EF;&#x4EE5;&#x770B;&#x51FA;</p>
<ol>
<li>&#x6BCF;&#x6B21;&#x5165;&#x7AD9;&#x6570;&#x636E;&#x548C;&#x51FA;&#x7AD9;&#x6570;&#x636E;&#x90FD;&#x9700;&#x8981; SSL SESSION &#x505A;&#x63E1;&#x624B;&#xFF1B;</li>
<li>&#x5165;&#x7AD9;&#x6570;&#x636E;&#x505A;&#x89E3;&#x5BC6;&#xFF0C;&#x51FA;&#x7AD9;&#x6570;&#x636E;&#x505A;&#x52A0;&#x5BC6;&#xFF1B;</li>
<li>&#x63E1;&#x624B;&#xFF0C;&#x6570;&#x636E;&#x52A0;&#x5BC6;&#x548C;&#x6570;&#x636E;&#x89E3;&#x5BC6;&#x662F;&#x7EDF;&#x4E00;&#x7684;&#x4E00;&#x5957;&#x72B6;&#x6001;&#x673A;&#xFF1B;</li>
</ol>
<p>&#x4EE5;&#x4E0B;&#xFF0C;&#x4EE3;&#x7801;&#x5B9E;&#x73B0; SslSocketChannel</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;public class SslSocketChannel {</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x63E1;&#x624B;&#x52A0;&#x89E3;&#x5BC6;&#x9700;&#x8981;&#x7684;&#x56DB;&#x4E2A;&#x5B58;&#x50A8;</span><br><span class="line">     */</span><br><span class="line">    protected ByteBuffer myAppData; // &#x660E;&#x6587;</span><br><span class="line">    protected ByteBuffer myNetData; // &#x5BC6;&#x6587;</span><br><span class="line">    protected ByteBuffer peerAppData; // &#x660E;&#x6587;</span><br><span class="line">    protected ByteBuffer peerNetData; // &#x5BC6;&#x6587;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x63E1;&#x624B;&#x52A0;&#x89E3;&#x5BC6;&#x8FC7;&#x7A0B;&#x4E2D;&#x7528;&#x5230;&#x7684;&#x5F02;&#x6B65;&#x6267;&#x884C;&#x5668;</span><br><span class="line">     */</span><br><span class="line">    protected ExecutorService executor = Executors.newSingleThreadExecutor();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x539F;NIO &#x7684; CHANNEL</span><br><span class="line">     */</span><br><span class="line">    protected SocketChannel socketChannel;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * SSL &#x5F15;&#x64CE;</span><br><span class="line">     */</span><br><span class="line">    protected SSLEngine engine;</span><br><span class="line"></span><br><span class="line">    public SslSocketChannel(SSLContext context, SocketChannel socketChannel, boolean clientMode) throws Exception {</span><br><span class="line">        // &#x539F;&#x59CB;&#x7684;NIO SOCKET</span><br><span class="line">        this.socketChannel = socketChannel;</span><br><span class="line"></span><br><span class="line">        // &#x521D;&#x59CB;&#x5316;BUFFER</span><br><span class="line">        SSLSession dummySession = context.createSSLEngine().getSession();</span><br><span class="line">        myAppData = ByteBuffer.allocate(dummySession.getApplicationBufferSize());</span><br><span class="line">        myNetData = ByteBuffer.allocate(dummySession.getPacketBufferSize());</span><br><span class="line">        peerAppData = ByteBuffer.allocate(dummySession.getApplicationBufferSize());</span><br><span class="line">        peerNetData = ByteBuffer.allocate(dummySession.getPacketBufferSize());</span><br><span class="line">        dummySession.invalidate();</span><br><span class="line"></span><br><span class="line">        engine = context.createSSLEngine();</span><br><span class="line">        engine.setUseClientMode(clientMode);</span><br><span class="line">        engine.beginHandshake();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x53C2;&#x8003; https://docs.oracle.com/javase/8/docs/technotes/guides/security/jsse/JSSERefGuide.html</span><br><span class="line">     * &#x5B9E;&#x73B0;&#x7684; SSL &#x7684;&#x63E1;&#x624B;&#x534F;&#x8BAE;</span><br><span class="line">     * @return</span><br><span class="line">     * @throws IOException</span><br><span class="line">     */</span><br><span class="line">    protected boolean doHandshake() throws IOException {</span><br><span class="line">        SSLEngineResult result;</span><br><span class="line">        HandshakeStatus handshakeStatus;</span><br><span class="line"></span><br><span class="line">        int appBufferSize = engine.getSession().getApplicationBufferSize();</span><br><span class="line">        ByteBuffer myAppData = ByteBuffer.allocate(appBufferSize);</span><br><span class="line">        ByteBuffer peerAppData = ByteBuffer.allocate(appBufferSize);</span><br><span class="line">        myNetData.clear();</span><br><span class="line">        peerNetData.clear();</span><br><span class="line"></span><br><span class="line">        handshakeStatus = engine.getHandshakeStatus();</span><br><span class="line">        while (handshakeStatus != HandshakeStatus.FINISHED &amp;&amp; handshakeStatus != HandshakeStatus.NOT_HANDSHAKING) {</span><br><span class="line">            switch (handshakeStatus) {</span><br><span class="line">                case NEED_UNWRAP:</span><br><span class="line">                    if (socketChannel.read(peerNetData) &lt; 0) {</span><br><span class="line">                        if (engine.isInboundDone() &amp;&amp; engine.isOutboundDone()) {</span><br><span class="line">                            return false;</span><br><span class="line">                        }</span><br><span class="line">                        try {</span><br><span class="line">                            engine.closeInbound();</span><br><span class="line">                        } catch (SSLException e) {</span><br><span class="line">                            log.debug(&quot;&#x6536;&#x5230;END OF STREAM&#xFF0C;&#x5173;&#x95ED;&#x8FDE;&#x63A5;.&quot;, e);</span><br><span class="line">                        }</span><br><span class="line">                        engine.closeOutbound();</span><br><span class="line">                        handshakeStatus = engine.getHandshakeStatus();</span><br><span class="line">                        break;</span><br><span class="line">                    }</span><br><span class="line">                    peerNetData.flip();</span><br><span class="line">                    try {</span><br><span class="line">                        result = engine.unwrap(peerNetData, peerAppData);</span><br><span class="line">                        peerNetData.compact();</span><br><span class="line">                        handshakeStatus = result.getHandshakeStatus();</span><br><span class="line">                    } catch (SSLException sslException) {</span><br><span class="line">                        engine.closeOutbound();</span><br><span class="line">                        handshakeStatus = engine.getHandshakeStatus();</span><br><span class="line">                        break;</span><br><span class="line">                    }</span><br><span class="line">                    switch (result.getStatus()) {</span><br><span class="line">                        case OK:</span><br><span class="line">                            break;</span><br><span class="line">                        case BUFFER_OVERFLOW:</span><br><span class="line">                            peerAppData = enlargeApplicationBuffer(engine, peerAppData);</span><br><span class="line">                            break;</span><br><span class="line">                        case BUFFER_UNDERFLOW:</span><br><span class="line">                            peerNetData = handleBufferUnderflow(engine, peerNetData);</span><br><span class="line">                            break;</span><br><span class="line">                        case CLOSED:</span><br><span class="line">                            if (engine.isOutboundDone()) {</span><br><span class="line">                                return false;</span><br><span class="line">                            } else {</span><br><span class="line">                                engine.closeOutbound();</span><br><span class="line">                                handshakeStatus = engine.getHandshakeStatus();</span><br><span class="line">                                break;</span><br><span class="line">                            }</span><br><span class="line">                        default:</span><br><span class="line">                            throw new IllegalStateException(&quot;&#x65E0;&#x6548;&#x7684;&#x63E1;&#x624B;&#x72B6;&#x6001;: &quot; + result.getStatus());</span><br><span class="line">                    }</span><br><span class="line">                    break;</span><br><span class="line">                case NEED_WRAP:</span><br><span class="line">                    myNetData.clear();</span><br><span class="line">                    try {</span><br><span class="line">                        result = engine.wrap(myAppData, myNetData);</span><br><span class="line">                        handshakeStatus = result.getHandshakeStatus();</span><br><span class="line">                    } catch (SSLException sslException) {</span><br><span class="line">                        engine.closeOutbound();</span><br><span class="line">                        handshakeStatus = engine.getHandshakeStatus();</span><br><span class="line">                        break;</span><br><span class="line">                    }</span><br><span class="line">                    switch (result.getStatus()) {</span><br><span class="line">                        case OK :</span><br><span class="line">                            myNetData.flip();</span><br><span class="line">                            while (myNetData.hasRemaining()) {</span><br><span class="line">                                socketChannel.write(myNetData);</span><br><span class="line">                            }</span><br><span class="line">                            break;</span><br><span class="line">                        case BUFFER_OVERFLOW:</span><br><span class="line">                            myNetData = enlargePacketBuffer(engine, myNetData);</span><br><span class="line">                            break;</span><br><span class="line">                        case BUFFER_UNDERFLOW:</span><br><span class="line">                            throw new SSLException(&quot;&#x52A0;&#x5BC6;&#x540E;&#x6D88;&#x606F;&#x5185;&#x5BB9;&#x4E3A;&#x7A7A;&#xFF0C;&#x62A5;&#x9519;&quot;);</span><br><span class="line">                        case CLOSED:</span><br><span class="line">                            try {</span><br><span class="line">                                myNetData.flip();</span><br><span class="line">                                while (myNetData.hasRemaining()) {</span><br><span class="line">                                    socketChannel.write(myNetData);</span><br><span class="line">                                }</span><br><span class="line">                                peerNetData.clear();</span><br><span class="line">                            } catch (Exception e) {</span><br><span class="line">                                handshakeStatus = engine.getHandshakeStatus();</span><br><span class="line">                            }</span><br><span class="line">                            break;</span><br><span class="line">                        default:</span><br><span class="line">                            throw new IllegalStateException(&quot;&#x65E0;&#x6548;&#x7684;&#x63E1;&#x624B;&#x72B6;&#x6001;: &quot; + result.getStatus());</span><br><span class="line">                    }</span><br><span class="line">                    break;</span><br><span class="line">                case NEED_TASK:</span><br><span class="line">                    Runnable task;</span><br><span class="line">                    while ((task = engine.getDelegatedTask()) != null) {</span><br><span class="line">                        executor.execute(task);</span><br><span class="line">                    }</span><br><span class="line">                    handshakeStatus = engine.getHandshakeStatus();</span><br><span class="line">                    break;</span><br><span class="line">                case FINISHED:</span><br><span class="line">                    break;</span><br><span class="line">                case NOT_HANDSHAKING:</span><br><span class="line">                    break;</span><br><span class="line">                default:</span><br><span class="line">                    throw new IllegalStateException(&quot;&#x65E0;&#x6548;&#x7684;&#x63E1;&#x624B;&#x72B6;&#x6001;: &quot; + handshakeStatus);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        return true;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x53C2;&#x8003; https://docs.oracle.com/javase/8/docs/technotes/guides/security/jsse/JSSERefGuide.html</span><br><span class="line">     * &#x5B9E;&#x73B0;&#x7684; SSL &#x7684;&#x4F20;&#x8F93;&#x8BFB;&#x53D6;&#x534F;&#x8BAE;</span><br><span class="line">     * @param consumer</span><br><span class="line">     * @throws IOException</span><br><span class="line">     */</span><br><span class="line">    public void read(Consumer&lt;ByteBuffer&gt; consumer) throws IOException {</span><br><span class="line">        // BUFFER&#x521D;&#x59CB;&#x5316;</span><br><span class="line">        peerNetData.clear();</span><br><span class="line">        int bytesRead = socketChannel.read(peerNetData);</span><br><span class="line">        if (bytesRead &gt; 0) {</span><br><span class="line">            peerNetData.flip();</span><br><span class="line">            while (peerNetData.hasRemaining()) {</span><br><span class="line">                peerAppData.clear();</span><br><span class="line">                SSLEngineResult result = engine.unwrap(peerNetData, peerAppData);</span><br><span class="line">                switch (result.getStatus()) {</span><br><span class="line">                    case OK:</span><br><span class="line">                        log.debug(&quot;&#x6536;&#x5230;&#x8FDC;&#x7A0B;&#x7684;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x6D88;&#x606F;&#x4E3A;&#xFF1A;&quot; + new String(peerAppData.array(), 0, peerAppData.position()));</span><br><span class="line">                        consumer.accept(peerAppData);</span><br><span class="line">                        peerAppData.flip();</span><br><span class="line">                        break;</span><br><span class="line">                    case BUFFER_OVERFLOW:</span><br><span class="line">                        peerAppData = enlargeApplicationBuffer(engine, peerAppData);</span><br><span class="line">                        break;</span><br><span class="line">                    case BUFFER_UNDERFLOW:</span><br><span class="line">                        peerNetData = handleBufferUnderflow(engine, peerNetData);</span><br><span class="line">                        break;</span><br><span class="line">                    case CLOSED:</span><br><span class="line">                        log.debug(&quot;&#x6536;&#x5230;&#x8FDC;&#x7A0B;&#x8FDE;&#x63A5;&#x5173;&#x95ED;&#x6D88;&#x606F;.&quot;);</span><br><span class="line">                        closeConnection();</span><br><span class="line">                        return;</span><br><span class="line">                    default:</span><br><span class="line">                        throw new IllegalStateException(&quot;&#x65E0;&#x6548;&#x7684;&#x63E1;&#x624B;&#x72B6;&#x6001;: &quot; + result.getStatus());</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        } else if (bytesRead &lt; 0) {</span><br><span class="line">            log.debug(&quot;&#x6536;&#x5230;END OF STREAM&#xFF0C;&#x5173;&#x95ED;&#x8FDE;&#x63A5;.&quot;);</span><br><span class="line">            handleEndOfStream();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void write(String message) throws IOException {</span><br><span class="line">        write(ByteBuffer.wrap(message.getBytes()));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x53C2;&#x8003; https://docs.oracle.com/javase/8/docs/technotes/guides/security/jsse/JSSERefGuide.html</span><br><span class="line">     * &#x5B9E;&#x73B0;&#x7684; SSL &#x7684;&#x4F20;&#x8F93;&#x5199;&#x5165;&#x534F;&#x8BAE;</span><br><span class="line">     * @param message</span><br><span class="line">     * @throws IOException</span><br><span class="line">     */</span><br><span class="line">    public void write(ByteBuffer message) throws IOException {</span><br><span class="line">        myAppData.clear();</span><br><span class="line">        myAppData.put(message);</span><br><span class="line">        myAppData.flip();</span><br><span class="line">        while (myAppData.hasRemaining()) {</span><br><span class="line">            myNetData.clear();</span><br><span class="line">            SSLEngineResult result = engine.wrap(myAppData, myNetData);</span><br><span class="line">            switch (result.getStatus()) {</span><br><span class="line">                case OK:</span><br><span class="line">                    myNetData.flip();</span><br><span class="line">                    while (myNetData.hasRemaining()) {</span><br><span class="line">                        socketChannel.write(myNetData);</span><br><span class="line">                    }</span><br><span class="line">                    log.debug(&quot;&#x5199;&#x5165;&#x8FDC;&#x7A0B;&#x7684;&#x6D88;&#x606F;&#x4E3A;: {}&quot;, message);</span><br><span class="line">                    break;</span><br><span class="line">                case BUFFER_OVERFLOW:</span><br><span class="line">                    myNetData = enlargePacketBuffer(engine, myNetData);</span><br><span class="line">                    break;</span><br><span class="line">                case BUFFER_UNDERFLOW:</span><br><span class="line">                    throw new SSLException(&quot;&#x52A0;&#x5BC6;&#x540E;&#x6D88;&#x606F;&#x5185;&#x5BB9;&#x4E3A;&#x7A7A;.&quot;);</span><br><span class="line">                case CLOSED:</span><br><span class="line">                    closeConnection();</span><br><span class="line">                    return;</span><br><span class="line">                default:</span><br><span class="line">                    throw new IllegalStateException(&quot;&#x65E0;&#x6548;&#x7684;&#x63E1;&#x624B;&#x72B6;&#x6001;: &quot; + result.getStatus());</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x5173;&#x95ED;&#x8FDE;&#x63A5;</span><br><span class="line">     * @throws IOException</span><br><span class="line">     */</span><br><span class="line">    public void closeConnection() throws IOException  {</span><br><span class="line">        engine.closeOutbound();</span><br><span class="line">        doHandshake();</span><br><span class="line">        socketChannel.close();</span><br><span class="line">        executor.shutdown();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * END OF STREAM(-1)&#x9ED8;&#x8BA4;&#x662F;&#x5173;&#x95ED;&#x8FDE;&#x63A5;</span><br><span class="line">     * @throws IOException</span><br><span class="line">     */</span><br><span class="line">    protected void handleEndOfStream() throws IOException  {</span><br><span class="line">        try {</span><br><span class="line">            engine.closeInbound();</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            log.error(&quot;END OF STREAM &#x5173;&#x95ED;&#x5931;&#x8D25;.&quot;, e);</span><br><span class="line">        }</span><br><span class="line">        closeConnection();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4EE5;&#x4E0A;&#xFF1A;</p>
<ol>
<li>&#x57FA;&#x4E8E; SSL &#x534F;&#x8BAE;&#xFF0C;&#x5B9E;&#x73B0;&#x7EDF;&#x4E00;&#x7684;&#x63E1;&#x624B;&#x52A8;&#x4F5C;&#xFF1B;</li>
<li>&#x5206;&#x522B;&#x5B9E;&#x73B0;&#x8BFB;&#x53D6;&#x7684;&#x89E3;&#x5BC6;&#xFF0C;&#x548C;&#x5199;&#x5165;&#x7684;&#x52A0;&#x5BC6;&#x65B9;&#x6CD5;&#xFF1B;</li>
<li>&#x5C06; SslSocketChannel &#x5B9E;&#x73B0;&#x4E3A; SocketChannel&#x7684;Decorator&#xFF1B;</li>
</ol>
<p><strong>SslSocketChannel&#x6D4B;&#x8BD5;&#x670D;&#x52A1;&#x7AEF;</strong></p>
<p>&#x57FA;&#x4E8E;&#x4EE5;&#x4E0A;&#x5C01;&#x88C5;&#xFF0C;&#x7B80;&#x5355;&#x6D4B;&#x8BD5;&#x670D;&#x52A1;&#x7AEF;&#x5982;&#x4E0B;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">scss&#x590D;&#x5236;&#x4EE3;&#x7801;@Slf4j</span><br><span class="line">public class NioSslServer {</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws Exception {</span><br><span class="line">        NioSslServer sslServer = new NioSslServer(&quot;127.0.0.1&quot;, 8006);</span><br><span class="line">        sslServer.start();</span><br><span class="line">        // &#x4F7F;&#x7528; curl -vv -k &apos;https://localhost:8006&apos; &#x8FDE;&#x63A5;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private SSLContext context;</span><br><span class="line"></span><br><span class="line">    private Selector selector;</span><br><span class="line"></span><br><span class="line">    public NioSslServer(String hostAddress, int port) throws Exception {</span><br><span class="line">        // &#x521D;&#x59CB;&#x5316;SSL Context</span><br><span class="line">        context = serverSSLContext();</span><br><span class="line"></span><br><span class="line">        // &#x6CE8;&#x518C;&#x76D1;&#x542C;&#x5668;</span><br><span class="line">        selector = SelectorProvider.provider().openSelector();</span><br><span class="line">        ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();</span><br><span class="line">        serverSocketChannel.configureBlocking(false);</span><br><span class="line">        serverSocketChannel.socket().bind(new InetSocketAddress(hostAddress, port));</span><br><span class="line">        serverSocketChannel.register(selector, SelectionKey.OP_ACCEPT);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void start() throws Exception {</span><br><span class="line"></span><br><span class="line">        log.debug(&quot;&#x7B49;&#x5F85;&#x8FDE;&#x63A5;&#x4E2D;.&quot;);</span><br><span class="line"></span><br><span class="line">        while (true) {</span><br><span class="line">            selector.select();</span><br><span class="line">            Iterator&lt;SelectionKey&gt; selectedKeys = selector.selectedKeys().iterator();</span><br><span class="line">            while (selectedKeys.hasNext()) {</span><br><span class="line">                SelectionKey key = selectedKeys.next();</span><br><span class="line">                selectedKeys.remove();</span><br><span class="line">                if (!key.isValid()) {</span><br><span class="line">                    continue;</span><br><span class="line">                }</span><br><span class="line">                if (key.isAcceptable()) {</span><br><span class="line">                    accept(key);</span><br><span class="line">                } else if (key.isReadable()) {</span><br><span class="line">                    ((SslSocketChannel)key.attachment()).read(buf-&gt;{});</span><br><span class="line">                    // &#x76F4;&#x63A5;&#x56DE;&#x5E94;&#x4E00;&#x4E2A;OK</span><br><span class="line">                    ((SslSocketChannel)key.attachment()).write(&quot;HTTP/1.1 200 OK\r\nContent-Type: text/plain\r\n\r\nOK\r\n\r\n&quot;);</span><br><span class="line">                    ((SslSocketChannel)key.attachment()).closeConnection();</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private void accept(SelectionKey key) throws Exception {</span><br><span class="line">        log.debug(&quot;&#x63A5;&#x6536;&#x65B0;&#x7684;&#x8BF7;&#x6C42;.&quot;);</span><br><span class="line"></span><br><span class="line">        SocketChannel socketChannel = ((ServerSocketChannel)key.channel()).accept();</span><br><span class="line">        socketChannel.configureBlocking(false);</span><br><span class="line"></span><br><span class="line">        SslSocketChannel sslSocketChannel = new SslSocketChannel(context, socketChannel, false);</span><br><span class="line">        if (sslSocketChannel.doHandshake()) {</span><br><span class="line">            socketChannel.register(selector, SelectionKey.OP_READ, sslSocketChannel);</span><br><span class="line">        } else {</span><br><span class="line">            socketChannel.close();</span><br><span class="line">            log.debug(&quot;&#x63E1;&#x624B;&#x5931;&#x8D25;&#xFF0C;&#x5173;&#x95ED;&#x8FDE;&#x63A5;.&quot;);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4EE5;&#x4E0A;&#xFF1A;</p>
<ol>
<li>&#x7531;&#x4E8E;&#x662F;NIO&#xFF0C;&#x7B80;&#x5355;&#x7684;&#x6D4B;&#x8BD5;&#x9700;&#x8981;&#x7528;&#x5230;NIO&#x7684;&#x57FA;&#x7840;&#x7EC4;&#x4EF6;Selector&#x8FDB;&#x884C;&#x6D4B;&#x8BD5;&#xFF1B;</li>
<li>&#x9996;&#x5148;&#x521D;&#x59CB;&#x5316;ServerSocketChannel&#xFF0C;&#x76D1;&#x542C;8006&#x7AEF;&#x53E3;&#xFF1B;</li>
<li>&#x63A5;&#x6536;&#x5230;&#x8BF7;&#x6C42;&#x540E;&#xFF0C;&#x5C06;SocketChannel&#x5C01;&#x88C5;&#x4E3A;SslSocketChannel&#xFF0C;&#x6CE8;&#x518C;&#x5230;Selector</li>
<li>&#x63A5;&#x6536;&#x5230;&#x6570;&#x636E;&#x540E;&#xFF0C;&#x901A;&#x8FC7;SslSocketChannel&#x505A;read&#x548C;write&#xFF1B;</li>
</ol>
<p><strong>SslSocketChannel&#x6D4B;&#x8BD5;&#x5BA2;&#x6237;&#x7AEF;</strong></p>
<p>&#x57FA;&#x4E8E;&#x4EE5;&#x4E0A;&#x670D;&#x52A1;&#x7AEF;&#x5C01;&#x88C5;&#xFF0C;&#x7B80;&#x5355;&#x6D4B;&#x8BD5;&#x5BA2;&#x6237;&#x7AEF;&#x5982;&#x4E0B;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;@Slf4j</span><br><span class="line">public class NioSslClient {</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws Exception {</span><br><span class="line">        NioSslClient sslClient = new NioSslClient(&quot;httpbin.org&quot;, 443);</span><br><span class="line">        sslClient.connect();</span><br><span class="line">        // &#x8BF7;&#x6C42; &apos;https://httpbin.org/get&apos;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private String remoteAddress;</span><br><span class="line"></span><br><span class="line">    private int port;</span><br><span class="line"></span><br><span class="line">    private SSLEngine engine;</span><br><span class="line"></span><br><span class="line">    private SocketChannel socketChannel;</span><br><span class="line"></span><br><span class="line">    private SSLContext context;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x9700;&#x8981;&#x8FDC;&#x7A0B;&#x7684;HOST&#x548C;PORT</span><br><span class="line">     * @param remoteAddress</span><br><span class="line">     * @param port</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    public NioSslClient(String remoteAddress, int port) throws Exception {</span><br><span class="line">        this.remoteAddress = remoteAddress;</span><br><span class="line">        this.port = port;</span><br><span class="line"></span><br><span class="line">        context = clientSSLContext();</span><br><span class="line">        engine = context.createSSLEngine(remoteAddress, port);</span><br><span class="line">        engine.setUseClientMode(true);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public boolean connect() throws Exception {</span><br><span class="line">        socketChannel = SocketChannel.open();</span><br><span class="line">        socketChannel.configureBlocking(false);</span><br><span class="line">        socketChannel.connect(new InetSocketAddress(remoteAddress, port));</span><br><span class="line">        while (!socketChannel.finishConnect()) {</span><br><span class="line">            // &#x901A;&#x8FC7;REACTOR&#xFF0C;&#x4E0D;&#x4F1A;&#x51FA;&#x73B0;&#x7B49;&#x5F85;&#x60C5;&#x51B5;</span><br><span class="line">            //log.debug(&quot;&#x8FDE;&#x63A5;&#x4E2D;..&quot;);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        SslSocketChannel sslSocketChannel = new SslSocketChannel(context, socketChannel, true);</span><br><span class="line">        sslSocketChannel.doHandshake();</span><br><span class="line"></span><br><span class="line">        // &#x63E1;&#x624B;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x5F00;&#x542F;SELECTOR</span><br><span class="line">        Selector selector = SelectorProvider.provider().openSelector();</span><br><span class="line">        socketChannel.register(selector, SelectionKey.OP_READ, sslSocketChannel);</span><br><span class="line"></span><br><span class="line">        // &#x5199;&#x5165;&#x8BF7;&#x6C42;</span><br><span class="line">        sslSocketChannel.write(&quot;GET /get HTTP/1.1\r\n&quot;</span><br><span class="line">            + &quot;Host: httpbin.org:443\r\n&quot;</span><br><span class="line">            + &quot;User-Agent: curl/7.62.0\r\n&quot;</span><br><span class="line">            + &quot;Accept: */*\r\n&quot;</span><br><span class="line">            + &quot;\r\n&quot;);</span><br><span class="line"></span><br><span class="line">        // &#x8BFB;&#x53D6;&#x7ED3;&#x679C;</span><br><span class="line">        while (true) {</span><br><span class="line">            selector.select();</span><br><span class="line">            Iterator&lt;SelectionKey&gt; selectedKeys = selector.selectedKeys().iterator();</span><br><span class="line">            while (selectedKeys.hasNext()) {</span><br><span class="line">                SelectionKey key = selectedKeys.next();</span><br><span class="line">                selectedKeys.remove();</span><br><span class="line">                if (key.isValid() &amp;&amp; key.isReadable()) {</span><br><span class="line">                    ((SslSocketChannel)key.attachment()).read(buf-&gt;{</span><br><span class="line">                        log.info(&quot;{}&quot;, new String(buf.array(), 0, buf.position()));</span><br><span class="line">                    });</span><br><span class="line">                    ((SslSocketChannel)key.attachment()).closeConnection();</span><br><span class="line">                    return true;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4EE5;&#x4E0A;&#xFF1A;</p>
<ol>
<li>&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x5C01;&#x88C5;&#x6D4B;&#x8BD5;&#xFF0C;&#x662F;&#x4E3A;&#x4E86;&#x9A8C;&#x8BC1;&#x5C01;&#x88C5; SSL &#x534F;&#x8BAE;&#x53CC;&#x5411;&#x90FD;&#x662F;OK&#x7684;&#xFF0C;</li>
<li>&#x5728;&#x540E;&#x6587;&#x7684;&#x975E;&#x900F;&#x660E;&#x4E0A;&#x6E38;&#x4EE3;&#x7406;&#x4E2D;&#xFF0C;&#x4F1A;&#x540C;&#x65F6;&#x4F7F;&#x7528; SslSocketChannel&#x505A;&#x670D;&#x52A1;&#x7AEF;&#x548C;&#x5BA2;&#x6237;&#x7AEF;</li>
<li>&#x4EE5;&#x4E0A;&#x5C01;&#x88C5;&#x4E0E;&#x670D;&#x52A1;&#x7AEF;&#x5C01;&#x88C5;&#x7C7B;&#x4F3C;&#xFF0C;&#x4E0D;&#x540C;&#x7684;&#x662F;&#x521D;&#x59CB;&#x5316; SocketChannel&#xFF0C;&#x505A;connect&#x800C;&#x975E;bind</li>
</ol>
<p><strong>&#x603B;&#x7ED3;</strong></p>
<p>&#x4EE5;&#x4E0A;&#xFF1A;</p>
<ol>
<li>&#x975E;&#x900F;&#x660E;&#x4EE3;&#x7406;&#x9700;&#x8981;&#x62FF;&#x5230;&#x5B8C;&#x6574;&#x7684;&#x8BF7;&#x6C42;&#x6570;&#x636E;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; Decorator&#x6A21;&#x5F0F;&#xFF0C;&#x805A;&#x6279;&#x5B9E;&#x73B0;&#xFF1B;</li>
<li>&#x975E;&#x900F;&#x660E;&#x4EE3;&#x7406;&#x9700;&#x8981;&#x62FF;&#x5230;&#x89E3;&#x5BC6;&#x540E;&#x7684;HTTPS&#x8BF7;&#x6C42;&#x6570;&#x636E;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;SslSocketChannel&#x5BF9;&#x539F;&#x59CB;&#x7684;SocketChannel&#x505A;&#x5C01;&#x88C5;&#x5B9E;&#x73B0;&#xFF1B;</li>
<li>&#x6700;&#x540E;&#xFF0C;&#x62FF;&#x5230;&#x8BF7;&#x6C42;&#x540E;&#xFF0C;&#x505A;&#x76F8;&#x5E94;&#x7684;&#x5904;&#x7406;&#xFF0C;&#x6700;&#x7EC8;&#x5B9E;&#x73B0;&#x975E;&#x900F;&#x660E;&#x7684;&#x4EE3;&#x7406;&#x3002;</li>
</ol>
<p><strong>3 &#x900F;&#x660E;&#x4E0A;&#x6E38;&#x4EE3;&#x7406;</strong></p>
<p>&#x900F;&#x660E;&#x4E0A;&#x6E38;&#x4EE3;&#x7406;&#x76F8;&#x6BD4;&#x900F;&#x660E;&#x4EE3;&#x7406;&#x8981;&#x7B80;&#x5355;&#xFF0C;&#x533A;&#x522B;&#x662F;</p>
<ol>
<li>&#x900F;&#x660E;&#x4EE3;&#x7406;&#x9700;&#x8981;&#x54CD;&#x5E94; CONNECT&#x8BF7;&#x6C42;&#xFF0C;&#x900F;&#x660E;&#x4E0A;&#x6E38;&#x4EE3;&#x7406;&#x4E0D;&#x9700;&#x8981;&#xFF0C;&#x76F4;&#x63A5;&#x8F6C;&#x53D1;&#x5373;&#x53EF;&#xFF1B;</li>
<li>&#x900F;&#x660E;&#x4EE3;&#x7406;&#x9700;&#x8981;&#x89E3;&#x6790;CONNECT&#x8BF7;&#x6C42;&#x4E2D;&#x7684;HOST&#x548C;PORT&#xFF0C;&#x5E76;&#x8FDE;&#x63A5;&#x670D;&#x52A1;&#x7AEF;&#xFF1B;&#x900F;&#x660E;&#x4E0A;&#x6E38;&#x4EE3;&#x7406;&#x53EA;&#x9700;&#x8981;&#x8FDE;&#x63A5;&#x4E0B;&#x6E38;&#x4EE3;&#x7406;&#x7684;IP:PORT&#xFF0C;&#x76F4;&#x63A5;&#x8F6C;&#x53D1;&#x8BF7;&#x6C42;&#x5373;&#x53EF;&#xFF1B;</li>
<li>&#x900F;&#x660E;&#x7684;&#x4E0A;&#x6E38;&#x4EE3;&#x7406;&#xFF0C;&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;SocketChannel&#x7BA1;&#x9053;&#xFF1B;&#x786E;&#x5B9A;&#x4E0B;&#x6E38;&#x7684;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x7AEF;&#xFF0C;&#x8FDE;&#x63A5;&#x8F6C;&#x53D1;&#x8BF7;&#x6C42;&#xFF1B;</li>
</ol>
<p>&#x53EA;&#x9700;&#x8981;&#x5BF9;&#x900F;&#x660E;&#x4EE3;&#x7406;&#x505A;&#x4EE5;&#x4E0A;&#x7B80;&#x5355;&#x7684;&#x4FEE;&#x6539;&#xFF0C;&#x5373;&#x53EF;&#x5B9E;&#x73B0;&#x900F;&#x660E;&#x7684;&#x4E0A;&#x6E38;&#x4EE3;&#x7406;&#x3002;</p>
<p><strong>4 &#x975E;&#x900F;&#x660E;&#x4E0A;&#x6E38;&#x4EE3;&#x7406;</strong></p>
<p>&#x975E;&#x900F;&#x660E;&#x7684;&#x4E0A;&#x6E38;&#x4EE3;&#x7406;&#xFF0C;&#x76F8;&#x6BD4;&#x975E;&#x900F;&#x660E;&#x7684;&#x4EE3;&#x7406;&#x8981;&#x590D;&#x6742;&#x4E00;&#x4E9B;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/2b5e1ab9b7c5948dc3cc2b482d03f3c22beb15ef625c720863ff7eb888e3a97a" alt></p>
<p>&#x4EE5;&#x4E0A;&#xFF0C;&#x5206;&#x4E3A;&#x56DB;&#x4E2A;&#x7EC4;&#x4EF6;&#xFF1A;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#xFF08;ServerHandler&#xFF09;&#xFF0C;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#xFF08;ClientHandler&#xFF09;&#xFF0C;&#x670D;&#x52A1;&#x7AEF;</p>
<ol>
<li>&#x5982;&#x679C;&#x662F;HTTP&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x6570;&#x636E;&#x76F4;&#x63A5;&#x901A;&#x8FC7; &#x5BA2;&#x6237;&#x7AEF;&lt;-&gt;ServerHandler&lt;-&gt;ClientHandler&lt;-&gt;&#x670D;&#x52A1;&#x7AEF;&#xFF0C;&#x4EE3;&#x7406;&#x7F51;&#x5173;&#x53EA;&#x9700;&#x8981;&#x505A;&#x7B80;&#x5355;&#x7684;&#x8BF7;&#x6C42;&#x805A;&#x6279;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5E94;&#x7528;&#x76F8;&#x5E94;&#x7684;&#x7BA1;&#x7406;&#x7B56;&#x7565;&#xFF1B;</li>
<li>&#x5982;&#x679C;&#x662F;HTTPS&#x8BF7;&#x6C42;&#xFF0C;&#x4EE3;&#x7406;&#x4F5C;&#x4E3A;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x7AEF;&#x7684;&#x4E2D;&#x95F4;&#x4EBA;&#xFF0C;&#x53EA;&#x80FD;&#x62FF;&#x5230;&#x52A0;&#x5BC6;&#x7684;&#x6570;&#x636E;&#xFF1B;&#x56E0;&#x6B64;&#xFF0C;&#x4EE3;&#x7406;&#x7F51;&#x5173;&#x9700;&#x8981;&#x4F5C;&#x4E3A;HTTPS&#x7684;&#x670D;&#x52A1;&#x65B9;&#x4E0E;&#x5BA2;&#x6237;&#x7AEF;&#x901A;&#x4FE1;&#xFF1B;&#x7136;&#x540E;&#x4F5C;&#x4E3A;HTTPS&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x4E0E;&#x670D;&#x52A1;&#x7AEF;&#x901A;&#x4FE1;&#xFF1B;</li>
<li>&#x4EE3;&#x7406;&#x4F5C;&#x4E3A;HTTPS&#x670D;&#x52A1;&#x65B9;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x8003;&#x8651;&#x5230;&#x5176;&#x672C;&#x8EAB;&#x662F;&#x4E2A;&#x975E;&#x900F;&#x660E;&#x7684;&#x4EE3;&#x7406;&#xFF0C;&#x9700;&#x8981;&#x5B9E;&#x73B0;&#x975E;&#x900F;&#x660E;&#x4EE3;&#x7406;&#x76F8;&#x5173;&#x7684;&#x534F;&#x8BAE;&#xFF1B;</li>
<li>&#x4EE3;&#x7406;&#x4F5C;&#x4E3A;HTTPS&#x5BA2;&#x6237;&#x7AEF;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x8003;&#x8651;&#x5230;&#x5176;&#x4E0B;&#x6E38;&#x662F;&#x4E2A;&#x900F;&#x660E;&#x7684;&#x4EE3;&#x7406;&#xFF0C;&#x771F;&#x6B63;&#x7684;&#x670D;&#x52A1;&#x65B9;&#x662F;&#x5BA2;&#x6237;&#x7AEF;&#x8BF7;&#x6C42;&#x7684;&#x670D;&#x52A1;&#x65B9;&#xFF1B;</li>
</ol>
<h1 id="&#x4E09;-&#x8BBE;&#x8BA1;&#x4E0E;&#x5B9E;&#x73B0;"><a href="#&#x4E09;-&#x8BBE;&#x8BA1;&#x4E0E;&#x5B9E;&#x73B0;" class="headerlink" title="&#x4E09; &#x8BBE;&#x8BA1;&#x4E0E;&#x5B9E;&#x73B0;"></a>&#x4E09; &#x8BBE;&#x8BA1;&#x4E0E;&#x5B9E;&#x73B0;</h1><p>&#x672C;&#x6587;&#x9700;&#x8981;&#x6784;&#x5EFA;&#x7684;&#x662F;&#x975E;&#x900F;&#x660E;&#x4E0A;&#x6E38;&#x4EE3;&#x7406;&#xFF0C;&#x4EE5;&#x4E0B;&#x91C7;&#x7528;NETTY&#x6846;&#x67B6;&#x7ED9;&#x51FA;&#x8BE6;&#x7EC6;&#x7684;&#x8BBE;&#x8BA1;&#x5B9E;&#x73B0;&#x3002;&#x4E0A;&#x6587;&#x5C06;&#x7EDF;&#x4E00;&#x4EE3;&#x7406;&#x7F51;&#x5173;&#x5206;&#x4E3A;&#x4E24;&#x5927;&#x90E8;&#x5206;&#xFF0C;ServerHandler&#x548C;ClientHandler&#xFF0C;&#x4EE5;&#x4E0B;</p>
<ol>
<li>&#x4ECB;&#x7ECD;&#x4EE3;&#x7406;&#x7F51;&#x5173;&#x670D;&#x52A1;&#x7AEF;&#x76F8;&#x5173;&#x5B9E;&#x73B0;&#xFF1B;</li>
<li>&#x4ECB;&#x7ECD;&#x4EE3;&#x7406;&#x7F51;&#x5173;&#x5BA2;&#x6237;&#x7AEF;&#x76F8;&#x5173;&#x5B9E;&#x73B0;&#xFF1B;</li>
</ol>
<p><strong>1 &#x4EE3;&#x7406;&#x7F51;&#x5173;&#x670D;&#x52A1;&#x7AEF;</strong></p>
<p>&#x4E3B;&#x8981;&#x5305;&#x62EC;</p>
<ol>
<li>&#x521D;&#x59CB;&#x5316;&#x4EE3;&#x7406;&#x7F51;&#x5173;&#x670D;&#x52A1;&#x7AEF;</li>
<li>&#x521D;&#x59CB;&#x5316;&#x670D;&#x52A1;&#x7AEF;&#x5904;&#x7406;&#x5668;</li>
<li>&#x670D;&#x52A1;&#x7AEF;&#x534F;&#x8BAE;&#x5347;&#x7EA7;&#x4E0E;&#x5904;&#x7406;</li>
</ol>
<p>&#x521D;&#x59CB;&#x5316;&#x4EE3;&#x7406;&#x7F51;&#x5173;&#x670D;&#x52A1;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">scss&#x590D;&#x5236;&#x4EE3;&#x7801;    public void start() {</span><br><span class="line">        HookedExecutors.newSingleThreadExecutor().submit(() -&gt;{</span><br><span class="line">            log.info(&quot;&#x5F00;&#x59CB;&#x542F;&#x52A8;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x76D1;&#x542C;&#x7AEF;&#x53E3;&#xFF1A;{}&quot;, auditProxyConfig.getProxyServerPort());</span><br><span class="line">            EventLoopGroup bossGroup = new NioEventLoopGroup(auditProxyConfig.getBossThreadCount());</span><br><span class="line">            EventLoopGroup workerGroup = new NioEventLoopGroup(auditProxyConfig.getWorkThreadCount());</span><br><span class="line">            try {</span><br><span class="line">                ServerBootstrap b = new ServerBootstrap();</span><br><span class="line">                b.group(bossGroup, workerGroup)</span><br><span class="line">                    .channel(NioServerSocketChannel.class)</span><br><span class="line">                    .handler(new LoggingHandler(LogLevel.DEBUG))</span><br><span class="line">                    .childHandler(new ServerChannelInitializer(auditProxyConfig))</span><br><span class="line">                    .bind(auditProxyConfig.getProxyServerPort()).sync().channel().closeFuture().sync();</span><br><span class="line">            } catch (InterruptedException e) {</span><br><span class="line">                log.error(&quot;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#x88AB;&#x4E2D;&#x65AD;.&quot;, e);</span><br><span class="line">                Thread.currentThread().interrupt();</span><br><span class="line">            } finally {</span><br><span class="line">                bossGroup.shutdownGracefully();</span><br><span class="line">                workerGroup.shutdownGracefully();</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>&#x4EE3;&#x7406;&#x7F51;&#x5173;&#x521D;&#x59CB;&#x5316;&#x76F8;&#x5BF9;&#x7B80;&#x5355;&#xFF0C;</p>
<ol>
<li>bossGroup&#x7EBF;&#x7A0B;&#x7EC4;&#xFF0C;&#x8D1F;&#x8D23;&#x63A5;&#x6536;&#x8BF7;&#x6C42;</li>
<li>workerGroup&#x7EBF;&#x7A0B;&#x7EC4;&#xFF0C;&#x8D1F;&#x8D23;&#x5904;&#x7406;&#x63A5;&#x6536;&#x7684;&#x8BF7;&#x6C42;&#x6570;&#x636E;&#xFF0C;&#x5177;&#x4F53;&#x5904;&#x7406;&#x903B;&#x8F91;&#x5C01;&#x88C5;&#x5728;ServerChannelInitializer&#x4E2D;&#x3002;</li>
</ol>
<p>&#x4EE3;&#x7406;&#x7F51;&#x5173;&#x670D;&#x52A1;&#x7684;&#x8BF7;&#x6C42;&#x5904;&#x7406;&#x5668;&#x5728; ServerChannelInitializer&#x4E2D;&#x5B9A;&#x4E49;&#x4E3A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;    @Override</span><br><span class="line">    protected void initChannel(SocketChannel ch) throws Exception {</span><br><span class="line">        ch.pipeline()</span><br><span class="line">            .addLast(new HttpRequestDecoder())</span><br><span class="line">            .addLast(new HttpObjectAggregator(auditProxyConfig.getMaxRequestSize()))</span><br><span class="line">            .addLast(new ServerChannelHandler(auditProxyConfig));</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>&#x9996;&#x5148;&#x89E3;&#x6790;HTTP&#x8BF7;&#x6C42;&#xFF0C;&#x7136;&#x540E;&#x505A;&#x805A;&#x6279;&#x7684;&#x5904;&#x7406;&#xFF0C;&#x6700;&#x540E;ServerChannelHandler&#x5B9E;&#x73B0;&#x4EE3;&#x7406;&#x7F51;&#x5173;&#x534F;&#x8BAE;&#xFF1B;</p>
<p>&#x4EE3;&#x7406;&#x7F51;&#x5173;&#x534F;&#x8BAE;&#xFF1A;</p>
<ol>
<li>&#x5224;&#x5B9A;&#x662F;&#x5426;&#x662F;CONNECT&#x8BF7;&#x6C42;&#xFF0C;&#x5982;&#x679C;&#x662F;&#xFF0C;&#x4F1A;&#x5B58;&#x50A8;CONNECT&#x8BF7;&#x6C42;&#xFF1B;&#x6682;&#x505C;&#x8BFB;&#x53D6;&#xFF0C;&#x53D1;&#x9001;&#x4EE3;&#x7406;&#x6210;&#x529F;&#x7684;&#x54CD;&#x5E94;&#xFF0C;&#x5E76;&#x5728;&#x56DE;&#x5E94;&#x6210;&#x529F;&#x540E;&#xFF0C;&#x5347;&#x7EA7;&#x534F;&#x8BAE;&#xFF1B;</li>
<li>&#x5347;&#x7EA7;&#x5F15;&#x64CE;&#xFF0C;&#x672C;&#x8D28;&#x4E0A;&#x662F;&#x91C7;&#x7528;SslSocketChannel&#x5BF9;&#x539F;SocketChannel&#x505A;&#x900F;&#x660E;&#x7684;&#x5C01;&#x88C5;&#xFF1B;</li>
<li>&#x6700;&#x540E;&#x6839;&#x636E;CONNECT&#x8BF7;&#x6C42;&#x8FDE;&#x63A5;&#x8FDC;&#x7A0B;&#x670D;&#x52A1;&#x7AEF;&#xFF1B;</li>
</ol>
<p>&#x8BE6;&#x7EC6;&#x5B9E;&#x73B0;&#x4E3A;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">scss&#x590D;&#x5236;&#x4EE3;&#x7801;    @Override</span><br><span class="line">    public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception {</span><br><span class="line">        FullHttpRequest request = (FullHttpRequest)msg;</span><br><span class="line"></span><br><span class="line">        try {</span><br><span class="line">            if (isConnectRequest(request)) {</span><br><span class="line">                // CONNECT &#x8BF7;&#x6C42;&#xFF0C;&#x5B58;&#x50A8;&#x5F85;&#x5904;&#x7406;</span><br><span class="line">                saveConnectRequest(ctx, request);</span><br><span class="line"></span><br><span class="line">                // &#x7981;&#x6B62;&#x8BFB;&#x53D6;</span><br><span class="line">                ctx.channel().config().setAutoRead(false);</span><br><span class="line"></span><br><span class="line">                // &#x53D1;&#x9001;&#x56DE;&#x5E94;</span><br><span class="line">                connectionEstablished(ctx, ctx.newPromise().addListener(future -&gt; {</span><br><span class="line">                    if (future.isSuccess()) {</span><br><span class="line">                        // &#x5347;&#x7EA7;</span><br><span class="line">                        if (isSslRequest(request) &amp;&amp; !isUpgraded(ctx)) {</span><br><span class="line">                            upgrade(ctx);</span><br><span class="line">                        }</span><br><span class="line"></span><br><span class="line">                        // &#x5F00;&#x653E;&#x6D88;&#x606F;&#x8BFB;&#x53D6;</span><br><span class="line">                        ctx.channel().config().setAutoRead(true);</span><br><span class="line">                        ctx.read();</span><br><span class="line">                    }</span><br><span class="line">                }));</span><br><span class="line"></span><br><span class="line">            } else {</span><br><span class="line">                // &#x5176;&#x4ED6;&#x8BF7;&#x6C42;&#xFF0C;&#x5224;&#x5B9A;&#x662F;&#x5426;&#x5DF2;&#x5347;&#x7EA7;</span><br><span class="line">                if (!isUpgraded(ctx)) {</span><br><span class="line"></span><br><span class="line">                    // &#x5347;&#x7EA7;&#x5F15;&#x64CE;</span><br><span class="line">                    upgrade(ctx);</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                // &#x8FDE;&#x63A5;&#x8FDC;&#x7A0B;</span><br><span class="line">                connectRemote(ctx, request);</span><br><span class="line">            }</span><br><span class="line">        } finally {</span><br><span class="line">            ctx.fireChannelRead(msg);</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p><strong>2 &#x4EE3;&#x7406;&#x7F51;&#x5173;&#x5BA2;&#x6237;&#x7AEF;</strong></p>
<p>&#x4EE3;&#x7406;&#x7F51;&#x5173;&#x670D;&#x52A1;&#x7AEF;&#x9700;&#x8981;&#x8FDE;&#x63A5;&#x8FDC;&#x7A0B;&#x670D;&#x52A1;&#xFF0C;&#x8FDB;&#x5165;&#x4EE3;&#x7406;&#x7F51;&#x5173;&#x5BA2;&#x6237;&#x7AEF;&#x90E8;&#x5206;&#x3002;</p>
<p>&#x4EE3;&#x7406;&#x7F51;&#x5173;&#x5BA2;&#x6237;&#x7AEF;&#x521D;&#x59CB;&#x5316;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">scss&#x590D;&#x5236;&#x4EE3;&#x7801;    /**</span><br><span class="line">     * &#x521D;&#x59CB;&#x5316;&#x8FDC;&#x7A0B;&#x8FDE;&#x63A5;</span><br><span class="line">     * @param ctx</span><br><span class="line">     * @param httpRequest</span><br><span class="line">     */</span><br><span class="line">    protected void connectRemote(ChannelHandlerContext ctx, FullHttpRequest httpRequest) {</span><br><span class="line">        Bootstrap b = new Bootstrap();</span><br><span class="line">        b.group(ctx.channel().eventLoop()) // use the same EventLoop</span><br><span class="line">            .channel(ctx.channel().getClass())</span><br><span class="line">            .handler(new ClientChannelInitializer(auditProxyConfig, ctx, safeCopy(httpRequest)));</span><br><span class="line"></span><br><span class="line">        // &#x52A8;&#x6001;&#x8FDE;&#x63A5;&#x4EE3;&#x7406;</span><br><span class="line">        FullHttpRequest originRequest = ctx.channel().attr(CONNECT_REQUEST).get();</span><br><span class="line">        if (originRequest == null) {</span><br><span class="line">            originRequest = httpRequest;</span><br><span class="line">        }</span><br><span class="line">        ChannelFuture cf = b.connect(new InetSocketAddress(calculateHost(originRequest), calculatePort(originRequest)));</span><br><span class="line">        Channel cch = cf.channel();</span><br><span class="line">        ctx.channel().attr(CLIENT_CHANNEL).set(cch);    </span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>&#x4EE5;&#x4E0A;&#xFF1A;</p>
<ol>
<li>&#x590D;&#x7528;&#x4EE3;&#x7406;&#x7F51;&#x5173;&#x670D;&#x52A1;&#x7AEF;&#x7684;workerGroup&#x7EBF;&#x7A0B;&#x7EC4;&#xFF1B;</li>
<li>&#x8BF7;&#x6C42;&#x548C;&#x7ED3;&#x679C;&#x7684;&#x5904;&#x7406;&#x5C01;&#x88C5;&#x5728;ClientChannelInitializer&#xFF1B;</li>
<li>&#x8FDE;&#x63A5;&#x7684;&#x8FDC;&#x7A0B;&#x670D;&#x52A1;&#x7AEF;&#x7684;HOST&#x548C;PORT&#x5728;&#x670D;&#x52A1;&#x7AEF;&#x6536;&#x5230;&#x7684;&#x8BF7;&#x6C42;&#x4E2D;&#x53EF;&#x4EE5;&#x89E3;&#x6790;&#x5230;&#x3002;</li>
</ol>
<p>&#x4EE3;&#x7406;&#x7F51;&#x5173;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x5904;&#x7406;&#x5668;&#x7684;&#x521D;&#x59CB;&#x5316;&#x903B;&#x8F91;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">scss&#x590D;&#x5236;&#x4EE3;&#x7801;    @Override</span><br><span class="line">    protected void initChannel(SocketChannel ch) throws Exception {</span><br><span class="line">        SocketAddress socketAddress = calculateProxy();</span><br><span class="line">        if (!Objects.isNull(socketAddress)) {</span><br><span class="line">            ch.pipeline().addLast(new HttpProxyHandler(calculateProxy(), auditProxyConfig.getUserName(), auditProxyConfig</span><br><span class="line">                .getPassword()));</span><br><span class="line">        }</span><br><span class="line">        if (isSslRequest()) {</span><br><span class="line">            String host = host();</span><br><span class="line">            int port = port();</span><br><span class="line">            if (StringUtils.isNoneBlank(host) &amp;&amp; port &gt; 0) {</span><br><span class="line">                ch.pipeline().addLast(new SslHandler(sslEngine(host, port)));</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        ch.pipeline().addLast(new ClientChannelHandler(clientContext, httpRequest));</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>&#x4EE5;&#x4E0A;&#xFF1A;</p>
<ol>
<li>&#x5982;&#x679C;&#x4E0B;&#x6E38;&#x662F;&#x4EE3;&#x7406;&#xFF0C;&#x90A3;&#x4E48;&#x4F1A;&#x91C7;&#x7528;HttpProxyHandler&#xFF0C;&#x7ECF;&#x7531;&#x4E0B;&#x6E38;&#x4EE3;&#x7406;&#x4E0E;&#x8FDC;&#x7A0B;&#x670D;&#x52A1;&#x7AEF;&#x901A;&#x4FE1;&#xFF1B;</li>
<li>&#x5982;&#x679C;&#x5F53;&#x524D;&#x9700;&#x8981;&#x5347;&#x7EA7;&#x4E3A;SSL&#x534F;&#x8BAE;&#xFF0C;&#x4F1A;&#x5BF9;SocketChannel&#x505A;&#x900F;&#x660E;&#x7684;&#x5C01;&#x88C5;&#xFF0C;&#x5B9E;&#x73B0;SSL&#x901A;&#x4FE1;&#x3002;</li>
<li>&#x6700;&#x540E;&#xFF0C;ClientChannelHandler&#x53EA;&#x662F;&#x7B80;&#x5355;&#x6D88;&#x606F;&#x7684;&#x8F6C;&#x53D1;&#xFF1B;&#x552F;&#x4E00;&#x7684;&#x4E0D;&#x540C;&#x662F;&#xFF0C;&#x7531;&#x4E8E;&#x4EE3;&#x7406;&#x7F51;&#x5173;&#x62E6;&#x622A;&#x4E86;&#x7B2C;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#xFF0C;&#x6B64;&#x65F6;&#x9700;&#x8981;&#x5C06;&#x62E6;&#x622A;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x8F6C;&#x53D1;&#x5230;&#x670D;&#x52A1;&#x7AEF;&#x3002;</li>
</ol>
<h1 id="&#x56DB;-&#x5176;&#x4ED6;&#x95EE;&#x9898;"><a href="#&#x56DB;-&#x5176;&#x4ED6;&#x95EE;&#x9898;" class="headerlink" title="&#x56DB; &#x5176;&#x4ED6;&#x95EE;&#x9898;"></a>&#x56DB; &#x5176;&#x4ED6;&#x95EE;&#x9898;</h1><p>&#x4EE3;&#x7406;&#x7F51;&#x5173;&#x5B9E;&#x73B0;&#x53EF;&#x80FD;&#x9762;&#x4E34;&#x7684;&#x95EE;&#x9898;&#xFF1A;</p>
<p><strong>1 &#x5185;&#x5B58;&#x95EE;&#x9898;</strong></p>
<p>&#x4EE3;&#x7406;&#x901A;&#x5E38;&#x9762;&#x4E34;&#x7684;&#x95EE;&#x9898;&#x662F;OOM&#x3002;&#x672C;&#x6587;&#x5728;&#x5B9E;&#x73B0;&#x4EE3;&#x7406;&#x7F51;&#x5173;&#x65F6;&#x4FDD;&#x8BC1;&#x5185;&#x5B58;&#x4E2D;&#x7F13;&#x5B58;&#x65F6;&#x5F53;&#x524D;&#x6B63;&#x5728;&#x5904;&#x7406;&#x7684;HTTP/HTTPS&#x8BF7;&#x6C42;&#x4F53;&#x3002;&#x5185;&#x5B58;&#x4F7F;&#x7528;&#x7684;&#x4E0A;&#x9650;&#x7406;&#x8BBA;&#x4E0A;&#x4E3A;&#x5B9E;&#x65F6;&#x5904;&#x7406;&#x7684;&#x8BF7;&#x6C42;&#x6570;&#x91CF;*&#x8BF7;&#x6C42;&#x4F53;&#x7684;&#x5E73;&#x5747;&#x5927;&#x5C0F;&#xFF0C;HTTP/HTTPS&#x7684;&#x8BF7;&#x6C42;&#x7ED3;&#x679C;&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x5806;&#x5916;&#x5185;&#x5B58;&#xFF0C;&#x96F6;&#x62F7;&#x8D1D;&#x8F6C;&#x53D1;&#x3002;</p>
<p><strong>2 &#x6027;&#x80FD;&#x95EE;&#x9898;</strong></p>
<p>&#x6027;&#x80FD;&#x95EE;&#x9898;&#x4E0D;&#x5E94;&#x63D0;&#x65E9;&#x8003;&#x8651;&#x3002;&#x672C;&#x6587;&#x4F7F;&#x7528;NETTY&#x6846;&#x67B6;&#x5B9E;&#x73B0;&#x7684;&#x4EE3;&#x7406;&#x7F51;&#x5173;&#xFF0C;&#x5185;&#x90E8;&#x5927;&#x91CF;&#x4F7F;&#x7528;&#x5806;&#x5916;&#x5185;&#x5B58;&#xFF0C;&#x96F6;&#x62F7;&#x8D1D;&#x8F6C;&#x53D1;&#xFF0C;&#x907F;&#x514D;&#x4E86;&#x6027;&#x80FD;&#x95EE;&#x9898;&#x3002;</p>
<p>&#x4EE3;&#x7406;&#x7F51;&#x5173;&#x4E00;&#x671F;&#x4E0A;&#x7EBF;&#x540E;&#x66FE;&#x9762;&#x4E34;&#x4E00;&#x4E2A;&#x957F;&#x8FDE;&#x63A5;&#x5BFC;&#x81F4;&#x7684;&#x6027;&#x80FD;&#x95EE;&#x9898;&#xFF0C;</p>
<ol>
<li>CLIENT&#x548C;SERVER&#x5EFA;&#x7ACB;TCP&#x957F;&#x8FDE;&#x63A5;&#x540E;&#xFF08;&#x6BD4;&#x5982;&#xFF0C;TCP&#x5FC3;&#x8DF3;&#x68C0;&#x6D4B;&#xFF09;&#xFF0C;&#x901A;&#x5E38;&#x8981;&#x4E48;&#x662F;CLIENT&#x5173;&#x95ED;TCP&#x8FDE;&#x63A5;&#xFF0C;&#x6216;&#x8005;&#x662F;SERVER&#x5173;&#x95ED;&#xFF1B;</li>
<li>&#x5982;&#x679C;&#x53CC;&#x65B9;&#x957F;&#x65F6;&#x95F4;&#x5360;&#x7528;TCP&#x8FDE;&#x63A5;&#x8D44;&#x6E90;&#x800C;&#x4E0D;&#x5173;&#x95ED;&#xFF0C;&#x5C31;&#x4F1A;&#x5BFC;&#x81F4;SOCKET&#x8D44;&#x6E90;&#x6CC4;&#x6F0F;&#xFF1B;&#x73B0;&#x8C61;&#x662F;&#xFF1A;CPU&#x8D44;&#x6E90;&#x7206;&#x6EE1;&#xFF0C;&#x5904;&#x7406;&#x7A7A;&#x95F2;&#x8FDE;&#x63A5;&#xFF1B;&#x65B0;&#x8FDE;&#x63A5;&#x65E0;&#x6CD5;&#x5EFA;&#x7ACB;&#xFF1B;</li>
</ol>
<p>&#x4F7F;&#x7528;IdleStateHandler&#x5B9A;&#x65F6;&#x76D1;&#x63A7;&#x7A7A;&#x95F2;&#x7684;TCP&#x8FDE;&#x63A5;&#xFF0C;&#x5F3A;&#x5236;&#x5173;&#x95ED;&#xFF1B;&#x89E3;&#x51B3;&#x4E86;&#x8BE5;&#x95EE;&#x9898;&#x3002;</p>
<h1 id="&#x4E94;-&#x603B;&#x7ED3;"><a href="#&#x4E94;-&#x603B;&#x7ED3;" class="headerlink" title="&#x4E94; &#x603B;&#x7ED3;"></a>&#x4E94; &#x603B;&#x7ED3;</h1><p>&#x672C;&#x6587;&#x805A;&#x7126;&#x4E8E;&#x7EDF;&#x4E00;&#x4EE3;&#x7406;&#x7F51;&#x5173;&#x7684;&#x6838;&#x5FC3;&#xFF0C;&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;&#x4E86;&#x4EE3;&#x7406;&#x76F8;&#x5173;&#x7684;&#x6280;&#x672F;&#x539F;&#x7406;&#x3002;</p>
<p>&#x4EE3;&#x7406;&#x7F51;&#x5173;&#x7684;&#x7BA1;&#x7406;&#x90E8;&#x5206;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;ServerHandler&#x90E8;&#x5206;&#x7EF4;&#x62A4;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x5728;ClientHandler&#x90E8;&#x5206;&#x7EF4;&#x62A4;&#xFF1B;</p>
<ol>
<li>ServerHandler&#x53EF;&#x4EE5;&#x62E6;&#x622A;&#x8F6C;&#x6362;&#x8BF7;&#x6C42;</li>
<li>ClientHanlder&#x53EF;&#x63A7;&#x5236;&#x8BF7;&#x6C42;&#x7684;&#x51FA;&#x53E3;</li>
</ol>
<p>&#x6CE8;&#xFF1A;&#x672C;&#x6587;&#x4F7F;&#x7528;Netty&#x7684;&#x96F6;&#x62F7;&#x8D1D;&#xFF1B;&#x5B58;&#x50A8;&#x8BF7;&#x6C42;&#x4EE5;&#x89E3;&#x6790;&#x5904;&#x7406;&#xFF1B;&#x4F46;&#x5E76;&#x672A;&#x5B9E;&#x73B0;&#x5BF9;RESPONSE&#x7684;&#x5904;&#x7406;&#xFF1B;&#x4E5F;&#x5C31;&#x662F;RESPONSE&#x662F;&#x76F4;&#x63A5;&#x901A;&#x8FC7;&#x7F51;&#x5173;&#xFF0C;&#x6B64;&#x65B9;&#x9762;&#x907F;&#x514D;&#x4E86;&#x5E38;&#x89C1;&#x7684;&#x4EE3;&#x7406;&#x5B9E;&#x73B0;&#xFF0C;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;OOM&#x76F8;&#x5173;&#x95EE;&#x9898;&#xFF1B;</p>
<p>&#x6700;&#x540E;&#xFF0C;&#x672C;&#x6587;&#x5B9E;&#x73B0;&#x4EE3;&#x7406;&#x7F51;&#x5173;&#x540E;&#xFF0C;&#x9488;&#x5BF9;&#x4EE3;&#x7406;&#x7684;&#x8D44;&#x6E90;&#x548C;&#x6D41;&#x7ECF;&#x4EE3;&#x7406;&#x7F51;&#x5173;&#x7684;&#x8BF7;&#x6C42;&#x505A;&#x4E86;&#x76F8;&#x5E94;&#x7684;&#x63A7;&#x5236;&#xFF0C;&#x4E3B;&#x8981;&#x5305;&#x62EC;&#xFF1A;</p>
<ol>
<li>&#x5F53;&#x9047;&#x5230;&#x9759;&#x6001;&#x8D44;&#x6E90;&#x7684;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x4EE3;&#x7406;&#x7F51;&#x5173;&#x4F1A;&#x76F4;&#x63A5;&#x8BF7;&#x6C42;&#x8FDC;&#x7A0B;&#x670D;&#x52A1;&#x7AEF;&#xFF0C;&#x4E0D;&#x4F1A;&#x901A;&#x8FC7;&#x4E0B;&#x6E38;&#x4EE3;&#x7406;</li>
<li>&#x5F53;&#x8BF7;&#x6C42;HEADER&#x4E2D;&#x5305;&#x542B;&#x5730;&#x57DF;&#x6807;&#x8BC6;&#x65F6;&#xFF0C;&#x4EE3;&#x7406;&#x7F51;&#x5173;&#x4F1A;&#x5C3D;&#x529B;&#x4FDD;&#x8BC1;&#x8BF7;&#x6C42;&#x6253;&#x5165;&#x6307;&#x5B9A;&#x7684;&#x5730;&#x57DF;&#x4EE3;&#x7406;&#xFF0C;&#x7ECF;&#x7531;&#x5730;&#x57DF;&#x4EE3;&#x7406;&#x8BBF;&#x95EE;&#x8FDC;&#x7A0B;&#x670D;&#x52A1;&#x7AEF;</li>
</ol>
<p><a href="/external_links/3259e15ec2e83a4a451a2620ac29ecb7.html" target="blank" rel="noopener">&#x539F;&#x6587;&#x94FE;&#x63A5;</a></p>
<p>&#x672C;&#x6587;&#x4E3A;&#x963F;&#x91CC;&#x4E91;&#x539F;&#x521B;&#x5185;&#x5BB9;&#xFF0C;&#x672A;&#x7ECF;&#x5141;&#x8BB8;&#x4E0D;&#x5F97;&#x8F6C;&#x8F7D;&#x3002;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/469e6faca2efefe2fac69d0f4bb6a7a8.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7034713368988975140.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7034713368988975140.html" itemprop="url">Springboot异步任务执行及监控 1 开启异步支持 2</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-11-26T11:25:03+08:00">
                2021-11-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>&#x8FD9;&#x662F;&#x6211;&#x53C2;&#x4E0E;11&#x6708;&#x66F4;&#x6587;&#x6311;&#x6218;&#x7684;&#x7B2C;19&#x5929;&#xFF0C;&#x6D3B;&#x52A8;&#x8BE6;&#x60C5;&#x67E5;&#x770B;&#xFF1A;<a href="https://dev.newban.cn/7023643374569816095">2021&#x6700;&#x540E;&#x4E00;&#x6B21;&#x66F4;&#x6587;&#x6311;&#x6218;</a></p>
</blockquote>
<p>&#x9664;&#x4E86;&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#x7EBF;&#x7A0B;&#x5916;&#xFF0C;springboot&#x672C;&#x8EAB;&#x5C31;&#x63D0;&#x4F9B;&#x4E86;&#x901A;&#x8FC7;&#x6CE8;&#x89E3;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x8FDB;&#x884C;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x7684;&#x6267;&#x884C;&#x3002;&#x4E0B;&#x9762;&#x4E3B;&#x8981;&#x8BB0;&#x5F55;&#x4E00;&#x4E0B;&#xFF0C;&#x5728;Springboot&#x9879;&#x76EE;&#x4E2D;&#x5B9E;&#x73B0;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#xFF0C;&#x4EE5;&#x53CA;&#x5BF9;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x8FDB;&#x884C;&#x5C01;&#x88C5;&#x76D1;&#x63A7;&#x3002;</p>
<h1 id="1-&#x5F00;&#x542F;&#x5F02;&#x6B65;&#x652F;&#x6301;"><a href="#1-&#x5F00;&#x542F;&#x5F02;&#x6B65;&#x652F;&#x6301;" class="headerlink" title="1 &#x5F00;&#x542F;&#x5F02;&#x6B65;&#x652F;&#x6301;"></a>1 &#x5F00;&#x542F;&#x5F02;&#x6B65;&#x652F;&#x6301;</h1><p>&#x60F3;&#x8981;&#x4F7F;&#x7528;springboot&#x7684;&#x6CE8;&#x89E3;&#x8FDB;&#x884C;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#xFF0C;&#x9996;&#x5148;&#x8981;&#x5F00;&#x542F;springboot&#x7684;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x652F;&#x6301;&#x3002;&#x901A;&#x8FC7;&#x96C6;&#x6210;AsyncConfigurer&#x63A5;&#x53E3;&#xFF0C;&#x5E76;&#x5B9E;&#x73B0;getAsyncExcutor()&#x65B9;&#x6CD5;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;package com.springboot.demo.asyncTask.conf;</span><br><span class="line"></span><br><span class="line">import org.springframework.aop.interceptor.AsyncUncaughtExceptionHandler;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.scheduling.annotation.AsyncConfigurer;</span><br><span class="line">import org.springframework.scheduling.annotation.EnableAsync;</span><br><span class="line">import org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;</span><br><span class="line"></span><br><span class="line">import java.util.concurrent.Executor;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * &#x914D;&#x7F6E;spring boot &#x591A;&#x7EBF;&#x7A0B;&#x652F;&#x6301;</span><br><span class="line"> */</span><br><span class="line">@Configuration</span><br><span class="line">@EnableAsync   //&#x5F00;&#x542F;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x652F;&#x6301;</span><br><span class="line">public class SpringTaskExecutor implements AsyncConfigurer {</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Executor getAsyncExecutor() {</span><br><span class="line">        ThreadPoolTaskExecutor taskExecutor = new ThreadPoolTaskExecutor();</span><br><span class="line">        taskExecutor.setCorePoolSize(5);</span><br><span class="line">        taskExecutor.setMaxPoolSize(10);</span><br><span class="line">        taskExecutor.setQueueCapacity(20);</span><br><span class="line">        taskExecutor.initialize();</span><br><span class="line">        return taskExecutor;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public AsyncUncaughtExceptionHandler getAsyncUncaughtExceptionHandler() {</span><br><span class="line">        return null;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x65B9;&#x6CD5;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;Spring boot&#x7684;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x652F;&#x6301;&#x3002;&#x7136;&#x540E;&#x53EA;&#x9700;&#x8981;&#x5728;&#x60F3;&#x8981;&#x8FDB;&#x884C;&#x5F02;&#x6B65;&#x7684;&#x65B9;&#x6CD5;&#x524D;&#x6DFB;&#x52A0;@Async&#x6CE8;&#x89E3;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;package com.springboot.demo.asyncTask.service;</span><br><span class="line"></span><br><span class="line">import org.slf4j.Logger;</span><br><span class="line">import org.slf4j.LoggerFactory;</span><br><span class="line">import org.springframework.scheduling.annotation.Async;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * &#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x5668;</span><br><span class="line"> */</span><br><span class="line">@Component</span><br><span class="line">public class AsyncTaskExecutor {</span><br><span class="line">    private static Logger LOG = LoggerFactory.getLogger(AsyncTaskExecutor.class);</span><br><span class="line">    @Async</span><br><span class="line">    public void executor(AsyncTaskConstructor asyncTaskGenerator, String taskInfo) {</span><br><span class="line">        LOG.info(&quot;AsyncTaskExecutor is executing async task:{}&quot;, taskInfo);</span><br><span class="line">        asyncTaskGenerator.async();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h1 id="2-&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x5C01;&#x88C5;&#x76D1;&#x63A7;"><a href="#2-&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x5C01;&#x88C5;&#x76D1;&#x63A7;" class="headerlink" title="2 &#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x5C01;&#x88C5;&#x76D1;&#x63A7;"></a>2 &#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x5C01;&#x88C5;&#x76D1;&#x63A7;</h1><h2 id="2-1-&#x5C01;&#x88C5;&#x601D;&#x8DEF;"><a href="#2-1-&#x5C01;&#x88C5;&#x601D;&#x8DEF;" class="headerlink" title="2.1 &#x5C01;&#x88C5;&#x601D;&#x8DEF;"></a>2.1 &#x5C01;&#x88C5;&#x601D;&#x8DEF;</h2><p>&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x7684;&#x7BA1;&#x7406;&#x5668;&#xFF0C;&#x7BA1;&#x7406;&#x5668;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x7684;&#x63D0;&#x4EA4;&#x3001;&#x4FDD;&#x5B58;&#x4EFB;&#x52A1;&#x4FE1;&#x606F;&#x3001;&#x83B7;&#x53D6;&#x4EFB;&#x52A1;&#x4FE1;&#x606F;&#x7B49;&#x529F;&#x80FD;&#x3002;</p>
<p>&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x7684;&#x76D1;&#x63A7;&#x5668;&#xFF0C;&#x7528;&#x4E8E;&#x76D1;&#x63A7;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x72B6;&#x51B5;&#xFF0C;&#x5E76;&#x628A;&#x6267;&#x884C;&#x4FE1;&#x606F;&#x4FDD;&#x5B58;&#x5230;&#x7F13;&#x5B58;&#x4E2D;&#xFF0C;&#x5E76;&#x8BB0;&#x5F55;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x65F6;&#x95F4;&#x3002;</p>
<p>&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x7684;&#x6784;&#x9020;&#x5668;&#xFF0C;&#x7528;&#x4E8E;&#x6784;&#x9020;&#x5F02;&#x6B65;&#x65B9;&#x6CD5;&#x3002;</p>
<p>&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x7684;&#x6267;&#x884C;&#x5668;&#xFF0C;&#x7528;&#x4E8E;&#x6267;&#x884C;&#x7BA1;&#x7406;&#x5668;&#x63D0;&#x4EA4;&#x7684;&#x4F7F;&#x7528;&#x6784;&#x9020;&#x5668;&#x6784;&#x9020;&#x7684;&#x5F02;&#x6B65;&#x65B9;&#x6CD5;&#x3002;</p>
<h2 id="2-2-&#x6548;&#x679C;&#x5C55;&#x793A;"><a href="#2-2-&#x6548;&#x679C;&#x5C55;&#x793A;" class="headerlink" title="2.2 &#x6548;&#x679C;&#x5C55;&#x793A;"></a>2.2 &#x6548;&#x679C;&#x5C55;&#x793A;</h2><h3 id="2-2-1-&#x542F;&#x52A8;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;"><a href="#2-2-1-&#x542F;&#x52A8;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;" class="headerlink" title="2.2.1 &#x542F;&#x52A8;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;"></a>2.2.1 &#x542F;&#x52A8;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;</h3><h3 id="2-2-2-&#x67E5;&#x770B;&#x4EFB;&#x52A1;&#x72B6;&#x6001;"><a href="#2-2-2-&#x67E5;&#x770B;&#x4EFB;&#x52A1;&#x72B6;&#x6001;" class="headerlink" title="2.2.2 &#x67E5;&#x770B;&#x4EFB;&#x52A1;&#x72B6;&#x6001;"></a>2.2.2 &#x67E5;&#x770B;&#x4EFB;&#x52A1;&#x72B6;&#x6001;</h3><h2 id="2-3-&#x7F16;&#x7801;&#x5B9E;&#x73B0;"><a href="#2-3-&#x7F16;&#x7801;&#x5B9E;&#x73B0;" class="headerlink" title="2.3 &#x7F16;&#x7801;&#x5B9E;&#x73B0;"></a>2.3 &#x7F16;&#x7801;&#x5B9E;&#x73B0;</h2><h3 id="2-3-1-conf&#x5305;"><a href="#2-3-1-conf&#x5305;" class="headerlink" title="2.3.1 conf&#x5305;"></a>2.3.1 conf&#x5305;</h3><p>&#x4E3B;&#x8981;&#x662F;&#x914D;&#x7F6E;springboot&#x7684;&#x7EBF;&#x7A0B;&#x6C60;&#xFF0C;&#x5F00;&#x542F;spring boot&#x652F;&#x6301;&#x5F02;&#x6B65;&#x652F;&#x6301;</p>
<h4 id="2-3-1-1-SpringTaskExcutor-java"><a href="#2-3-1-1-SpringTaskExcutor-java" class="headerlink" title="2.3.1.1 SpringTaskExcutor.java"></a>2.3.1.1 SpringTaskExcutor.java</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;package com.emcc.hiacloud.analytics.asynctask.conf;</span><br><span class="line"></span><br><span class="line">import org.springframework.aop.interceptor.AsyncUncaughtExceptionHandler;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.scheduling.annotation.AsyncConfigurer;</span><br><span class="line">import org.springframework.scheduling.annotation.EnableAsync;</span><br><span class="line">import org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;</span><br><span class="line"></span><br><span class="line">import java.util.concurrent.Executor;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * &#x914D;&#x7F6E;spring boot &#x591A;&#x7EBF;&#x7A0B;&#x652F;&#x6301;</span><br><span class="line"> */</span><br><span class="line">@Configuration</span><br><span class="line">@EnableAsync   //&#x5F00;&#x542F;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x652F;&#x6301;</span><br><span class="line">public class SpringTaskExecutor implements AsyncConfigurer {</span><br><span class="line">    @Override</span><br><span class="line">    public Executor getAsyncExecutor() {</span><br><span class="line">        ThreadPoolTaskExecutor taskExecutor = new ThreadPoolTaskExecutor();</span><br><span class="line">        taskExecutor.setCorePoolSize(5);</span><br><span class="line">        taskExecutor.setMaxPoolSize(10);</span><br><span class="line">        taskExecutor.setQueueCapacity(20);</span><br><span class="line">        taskExecutor.initialize();</span><br><span class="line">        return taskExecutor;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public AsyncUncaughtExceptionHandler getAsyncUncaughtExceptionHandler() {</span><br><span class="line">        return null;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="2-3-2-entity&#x5305;"><a href="#2-3-2-entity&#x5305;" class="headerlink" title="2.3.2 entity&#x5305;"></a>2.3.2 entity&#x5305;</h3><p>&#x4E3B;&#x8981;&#x5B58;&#x653E;TaskInfo&#x5B9E;&#x4F8B;&#x7C7B;&#x7528;&#x4E8E;&#x4FDD;&#x5B58;&#x4EFB;&#x52A1;&#x4FE1;&#x606F;&#xFF0C;TaskStatusEnmu&#x679A;&#x4E3E;&#x7C7B;&#x7528;&#x6765;&#x5B58;&#x653E;&#x4EFB;&#x52A1;&#x72B6;&#x6001;&#x3002;</p>
<h4 id="2-3-2-1-TaskInfo-java"><a href="#2-3-2-1-TaskInfo-java" class="headerlink" title="2.3.2.1 TaskInfo.java"></a>2.3.2.1 TaskInfo.java</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">typescript&#x590D;&#x5236;&#x4EE3;&#x7801;package com.emcc.hiacloud.analytics.asynctask.entity;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import java.util.Date;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * &#x4EFB;&#x52A1;&#x4FE1;&#x606F;</span><br><span class="line"> */</span><br><span class="line">public class TaskInfo {</span><br><span class="line">    private String taskId;</span><br><span class="line">    private TaskStatusEnum status;</span><br><span class="line">    private Date startTime;</span><br><span class="line">    private Date endTime;</span><br><span class="line">    private String totalTime;</span><br><span class="line"></span><br><span class="line">    public TaskStatusEnum getStatus() {</span><br><span class="line">        return status;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void setStatus(TaskStatusEnum status) {</span><br><span class="line">        this.status = status;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void setTotalTime(String totalTime) {</span><br><span class="line">        this.totalTime = totalTime;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public String getTaskId() {</span><br><span class="line">        return taskId;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void setTaskId(String taskId) {</span><br><span class="line">        this.taskId = taskId;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public Date getStartTime() {</span><br><span class="line">        return startTime;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void setStartTime(Date startTime) {</span><br><span class="line">        this.startTime = startTime;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public Date getEndTime() {</span><br><span class="line">        return endTime;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void setEndTime(Date endTime) {</span><br><span class="line">        this.endTime = endTime;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public String getTotalTime() {</span><br><span class="line">        return totalTime;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void setTotalTime() {</span><br><span class="line">        this.totalTime = (this.endTime.getTime() - this.startTime.getTime()) + &quot;ms&quot;;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="2-3-2-2-TaskStatusEnum-java"><a href="#2-3-2-2-TaskStatusEnum-java" class="headerlink" title="2.3.2.2 TaskStatusEnum.java"></a>2.3.2.2 TaskStatusEnum.java</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">arduino&#x590D;&#x5236;&#x4EE3;&#x7801;package com.emcc.hiacloud.analytics.asynctask.entity;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * &#x4EFB;&#x52A1;&#x72B6;&#x6001;&#x679A;&#x4E3E;</span><br><span class="line"> */</span><br><span class="line">public enum TaskStatusEnum {</span><br><span class="line"></span><br><span class="line">    STARTED(1, &quot;&#x4EFB;&#x52A1;&#x5DF2;&#x7ECF;&#x542F;&#x52A8;&quot;),</span><br><span class="line">    RUNNING(0, &quot;&#x4EFB;&#x52A1;&#x6B63;&#x5728;&#x8FD0;&#x884C;&quot;),</span><br><span class="line">    SUCCESS(2, &quot;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x6210;&#x529F;&quot;),</span><br><span class="line">    FAILED(-2, &quot;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x5931;&#x8D25;&quot;);</span><br><span class="line">    private int state;</span><br><span class="line">    private String stateInfo;</span><br><span class="line"></span><br><span class="line">    TaskStatusEnum(int state, String stateInfo) {</span><br><span class="line">        this.state = state;</span><br><span class="line">        this.stateInfo = stateInfo;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public int getState() {</span><br><span class="line">        return state;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public String getStateInfo() {</span><br><span class="line">        return stateInfo;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="2-3-3-manager&#x5305;"><a href="#2-3-3-manager&#x5305;" class="headerlink" title="2.3.3 manager&#x5305;"></a>2.3.3 manager&#x5305;</h3><p>&#x5B58;&#x653E;&#x4EFB;&#x52A1;&#x7684;&#x7BA1;&#x7406;&#x7C7B;&#x548C;&#x76D1;&#x63A7;&#x7C7B;</p>
<h4 id="2-3-3-1-AsyncTaskManager-java"><a href="#2-3-3-1-AsyncTaskManager-java" class="headerlink" title="2.3.3.1 AsyncTaskManager.java"></a>2.3.3.1 AsyncTaskManager.java</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">typescript&#x590D;&#x5236;&#x4EE3;&#x7801;package com.emcc.hiacloud.analytics.asynctask.manager;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import com.emcc.hiacloud.analytics.asynctask.entity.TaskInfo;</span><br><span class="line">import com.emcc.hiacloud.analytics.asynctask.entity.TaskStatusEnum;</span><br><span class="line">import com.emcc.hiacloud.analytics.asynctask.service.AsyncTaskConstructor;</span><br><span class="line">import com.emcc.hiacloud.analytics.asynctask.service.AsyncTaskExecutor;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">import java.util.Date;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line">import java.util.UUID;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * &#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x7BA1;&#x7406;&#x5668;</span><br><span class="line"> */</span><br><span class="line">@Component</span><br><span class="line">public class AsyncTaskManager {</span><br><span class="line">    private Map&lt;String, TaskInfo&gt; taskContainer = new HashMap&lt;&gt;(16);</span><br><span class="line">    @Autowired</span><br><span class="line">    AsyncTaskExecutor asyncTaskExecutor;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x521D;&#x59CB;&#x5316;&#x4EFB;&#x52A1;</span><br><span class="line">     *</span><br><span class="line">     * @return taskInfo</span><br><span class="line">     */</span><br><span class="line">    public TaskInfo initTask() {</span><br><span class="line">        TaskInfo taskInfo = new TaskInfo();</span><br><span class="line">        taskInfo.setTaskId(getTaskId());</span><br><span class="line">        taskInfo.setStatus(TaskStatusEnum.STARTED);</span><br><span class="line">        taskInfo.setStartTime(new Date());</span><br><span class="line">        setTaskInfo(taskInfo);</span><br><span class="line">        return taskInfo;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x521D;&#x59CB;&#x5316;&#x4EFB;&#x52A1;</span><br><span class="line">     * @param asyncTaskConstructor &#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x6784;&#x9020;&#x5668;</span><br><span class="line">     * @return taskInfo</span><br><span class="line">     */</span><br><span class="line">    public TaskInfo submit(AsyncTaskConstructor asyncTaskConstructor) {</span><br><span class="line">        TaskInfo info = initTask();</span><br><span class="line">        String taskId = info.getTaskId();</span><br><span class="line">        asyncTaskExecutor.executor(asyncTaskConstructor,taskId);</span><br><span class="line">        return info;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x4FDD;&#x5B58;&#x4EFB;&#x52A1;&#x4FE1;&#x606F;</span><br><span class="line">     *</span><br><span class="line">     * @param taskInfo &#x4EFB;&#x52A1;&#x4FE1;&#x606F;</span><br><span class="line">     */</span><br><span class="line">    public void setTaskInfo(TaskInfo taskInfo) {</span><br><span class="line">        taskContainer.put(taskInfo.getTaskId(), taskInfo);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x83B7;&#x53D6;&#x4EFB;&#x52A1;&#x4FE1;&#x606F;</span><br><span class="line">     *</span><br><span class="line">     * @param taskId &#x4EFB;&#x52A1;ID</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public TaskInfo getTaskInfo(String taskId) {</span><br><span class="line">        return taskContainer.get(taskId);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x83B7;&#x53D6;&#x4EFB;&#x52A1;&#x72B6;&#x6001;</span><br><span class="line">     *</span><br><span class="line">     * @param taskId &#x4EFB;&#x52A1;ID</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public TaskStatusEnum getTaskStatus(String taskId) {</span><br><span class="line">        return getTaskInfo(taskId).getStatus();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x751F;&#x6210;&#x4EFB;&#x52A1;ID</span><br><span class="line">     *</span><br><span class="line">     * @return taskId</span><br><span class="line">     */</span><br><span class="line">    public String getTaskId() {</span><br><span class="line">        return UUID.randomUUID().toString();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="2-3-3-2-AsyncTaskMonitor-java"><a href="#2-3-3-2-AsyncTaskMonitor-java" class="headerlink" title="2.3.3.2 AsyncTaskMonitor.java"></a>2.3.3.2 AsyncTaskMonitor.java</h4><p>&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x7684;&#x76D1;&#x63A7;&#x4E3B;&#x8981;&#x662F;&#x5229;&#x7528;&#x4E86;spring&#x7684;AOP&#x9762;&#x5411;&#x5207;&#x9762;&#xFF0C;&#x5728;&#x5F02;&#x6B65;&#x65B9;&#x6CD5;&#x7684;&#x6267;&#x884C;&#x524D;&#x548C;&#x6267;&#x884C;&#x540E;&#x8FDB;&#x884C;&#x76D1;&#x63A7;&#xFF0C;&#x5224;&#x65AD;&#x4EFB;&#x52A1;&#x72B6;&#x6001;&#xFF0C;&#x5E76;&#x8BB0;&#x5F55;&#x4EFB;&#x52A1;&#x4FE1;&#x606F;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;package com.emcc.hiacloud.analytics.asynctask.manager;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import com.emcc.hiacloud.analytics.asynctask.entity.TaskInfo;</span><br><span class="line">import com.emcc.hiacloud.analytics.asynctask.entity.TaskStatusEnum;</span><br><span class="line">import org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line">import org.aspectj.lang.annotation.Around;</span><br><span class="line">import org.aspectj.lang.annotation.Aspect;</span><br><span class="line">import org.slf4j.Logger;</span><br><span class="line">import org.slf4j.LoggerFactory;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">import java.util.Date;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * &#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x76D1;&#x63A7;</span><br><span class="line"> */</span><br><span class="line">@Component</span><br><span class="line">@Aspect</span><br><span class="line">public class AsyncTaskMonitor {</span><br><span class="line">    @Autowired</span><br><span class="line">    AsyncTaskManager manager;</span><br><span class="line">    private static Logger LOG = LoggerFactory.getLogger(AsyncTaskMonitor.class);</span><br><span class="line"></span><br><span class="line">    @Around(&quot;execution(* com.emcc.hiacloud.analytics.asynctask.service.AsyncTaskExecutor.*(..))&quot;)</span><br><span class="line">    public void taskHandle(ProceedingJoinPoint pjp) {</span><br><span class="line">        //&#x83B7;&#x53D6;taskId</span><br><span class="line">        String taskId = pjp.getArgs()[1].toString();</span><br><span class="line">        //&#x83B7;&#x53D6;&#x4EFB;&#x52A1;&#x4FE1;&#x606F;</span><br><span class="line">        TaskInfo taskInfo = manager.getTaskInfo(taskId);</span><br><span class="line">        LOG.info(&quot;AsyncTaskMonitor is monitoring async task:{}&quot;, taskId);</span><br><span class="line">        taskInfo.setStatus(TaskStatusEnum.RUNNING);</span><br><span class="line">        manager.setTaskInfo(taskInfo);</span><br><span class="line">        TaskStatusEnum status = null;</span><br><span class="line">        try {</span><br><span class="line">            pjp.proceed();</span><br><span class="line">            status = TaskStatusEnum.SUCCESS;</span><br><span class="line">        } catch (Throwable throwable) {</span><br><span class="line">            status = TaskStatusEnum.FAILED;</span><br><span class="line">            LOG.error(&quot;AsyncTaskMonitor:async task {} is failed.Error info:{}&quot;, taskId, throwable.getMessage());</span><br><span class="line">        }</span><br><span class="line">        taskInfo.setEndTime(new Date());</span><br><span class="line">        taskInfo.setStatus(status);</span><br><span class="line">        taskInfo.setTotalTime();</span><br><span class="line">        manager.setTaskInfo(taskInfo);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="2-3-4-service&#x5305;"><a href="#2-3-4-service&#x5305;" class="headerlink" title="2.3.4 service&#x5305;"></a>2.3.4 service&#x5305;</h3><p>&#x4E3B;&#x8981;&#x5B58;&#x653E;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x7684;&#x65B9;&#x6CD5;&#x6784;&#x9020;&#x5668;&#x548C;&#x6267;&#x884C;&#x5668;&#x3002;</p>
<h4 id="2-3-4-1-AsyncTaskConstructor"><a href="#2-3-4-1-AsyncTaskConstructor" class="headerlink" title="2.3.4.1 AsyncTaskConstructor"></a>2.3.4.1 AsyncTaskConstructor</h4><p>&#x901A;&#x8FC7;&#x8BE5;&#x63A5;&#x53E3;&#x53EF;&#x4EE5;&#x6784;&#x5EFA;&#x60F3;&#x8981;&#x5B9E;&#x73B0;&#x7684;&#x5F02;&#x6B65;&#x65B9;&#x6CD5;&#x3002;&#x53EA;&#x8981;new &#x4E00;&#x4E0B;&#x63A5;&#x53E3;&#x5B9E;&#x4F8B;&#xFF0C;&#x7136;&#x540E;&#x91CD;&#x5199;async()&#x65B9;&#x6CD5;&#x5373;&#x53EF;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">csharp&#x590D;&#x5236;&#x4EE3;&#x7801;package com.emcc.hiacloud.analytics.asynctask.service;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * &#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x6784;&#x9020;&#x5668;</span><br><span class="line"> */</span><br><span class="line">public interface AsyncTaskConstructor {</span><br><span class="line">    public void async();</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>2.3.4.2 AsyncTaskExecutor.java &#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x5668;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;package com.emcc.hiacloud.analytics.asynctask.service;</span><br><span class="line"></span><br><span class="line">import org.slf4j.Logger;</span><br><span class="line">import org.slf4j.LoggerFactory;</span><br><span class="line">import org.springframework.scheduling.annotation.Async;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * &#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x5668;</span><br><span class="line"> */</span><br><span class="line">@Component</span><br><span class="line">public class AsyncTaskExecutor {</span><br><span class="line">    private static Logger LOG = LoggerFactory.getLogger(AsyncTaskExecutor.class);</span><br><span class="line">    @Async</span><br><span class="line">    public void executor(AsyncTaskConstructor asyncTaskGenerator, String taskInfo) {</span><br><span class="line">        LOG.info(&quot;AsyncTaskExecutor is executing async task:{}&quot;, taskInfo);</span><br><span class="line">        asyncTaskGenerator.async();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h1 id="3-&#x5E94;&#x7528;"><a href="#3-&#x5E94;&#x7528;" class="headerlink" title="3 &#x5E94;&#x7528;"></a>3 &#x5E94;&#x7528;</h1><p>&#x5B9E;&#x73B0;&#x4E24;&#x4E2A;&#x63A5;&#x53E3;&#xFF0C;&#x4E00;&#x4E2A;&#x662F;&#x5F00;&#x542F;&#x4E00;&#x4E2A;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#xFF0C;&#x53E6;&#x4E00;&#x4E2A;&#x662F;&#x67E5;&#x770B;&#x4EFB;&#x52A1;&#x72B6;&#x6001;&#x3002;</p>
<p>&#x60F3;&#x8981;&#x4F7F;&#x7528;&#x6211;&#x4EEC;&#x521A;&#x624D;&#x5206;&#x88C5;&#x597D;&#x7684;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x5C06;AsyncTaskManager&#x6CE8;&#x5165;&#x5230;&#x7A0B;&#x5E8F;&#x4E2D;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;package com.emcc.hiacloud.analytics.orchestrations.controller;</span><br><span class="line"></span><br><span class="line">import com.emcc.hiacloud.analytics.asynctask.entity.TaskInfo;</span><br><span class="line">import com.emcc.hiacloud.analytics.asynctask.manager.AsyncTaskManager;</span><br><span class="line">import com.emcc.hiacloud.analytics.common.rest.RestMessage;</span><br><span class="line">import com.emcc.hiacloud.analytics.common.util.RestMessageUtil;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@RestController</span><br><span class="line">@RequestMapping(value = &quot;/api/v1/asynctask&quot;)</span><br><span class="line">public class AsyncTaskController {</span><br><span class="line">    //&#x6CE8;&#x5165;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;&#x7BA1;&#x7406;&#x5668;</span><br><span class="line">    @Autowired</span><br><span class="line">    AsyncTaskManager asyncTaskManager;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(value = &quot;/startTask&quot;, method = RequestMethod.GET)</span><br><span class="line">    public RestMessage startAsyncTask() {</span><br><span class="line">        //&#x8C03;&#x7528;&#x4EFB;&#x52A1;&#x7BA1;&#x7406;&#x5668;&#x4E2D;&#x7684;submit&#x53BB;&#x63D0;&#x4EA4;&#x4E00;&#x4E2A;&#x5F02;&#x6B65;&#x4EFB;&#x52A1;</span><br><span class="line">        TaskInfo taskInfo = asyncTaskManager.submit(() -&gt; {</span><br><span class="line">            System.out.println(&quot;__________&quot;);</span><br><span class="line">            try {</span><br><span class="line">                //&#x6A21;&#x62DF;&#x5F02;&#x6B65;&#xFF0C;&#x7761;&#x7720;6&#x79D2;</span><br><span class="line">                Thread.sleep(30000);</span><br><span class="line">            } catch (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">            System.out.println(&quot;__________&quot;);</span><br><span class="line">        });</span><br><span class="line">        return RestMessageUtil.objectToRestMessage(taskInfo);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @RequestMapping(value = &quot;/getTaskStatus&quot;, method = RequestMethod.GET)</span><br><span class="line">    public RestMessage getTaskStatus(</span><br><span class="line">            @RequestParam(&quot;taskId&quot;) String taskId) {</span><br><span class="line">        return RestMessageUtil.objectToRestMessage(asyncTaskManager.getTaskInfo(taskId));</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/29f25825ee2942d50a759c831dbda1e5.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7034701930286809095.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7034701930286809095.html" itemprop="url">HTTP客户端工具该选哪个？进来看</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-11-26T10:37:53+08:00">
                2021-11-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x8FD9;&#x662F;&#x6211;&#x53C2;&#x4E0E;11&#x6708;&#x66F4;&#x6587;&#x6311;&#x6218;&#x7684;&#x7B2C;26&#x5929;&#xFF0C;&#x6D3B;&#x52A8;&#x8BE6;&#x60C5;&#x67E5;&#x770B;&#xFF1A;<a href="https://dev.newban.cn/7023643374569816095">2021&#x6700;&#x540E;&#x4E00;&#x6B21;&#x66F4;&#x6587;&#x6311;&#x6218;</a></p>
<h2 id="&#x524D;&#x8A00;"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00;</h2><p>HTTP&#xFF08;&#x8D85;&#x6587;&#x672C;&#x4F20;&#x8F93;&#x534F;&#x8BAE;&#xFF09;&#x662F;&#x4E00;&#x79CD;&#x5E94;&#x7528;&#x5C42;&#x534F;&#x8BAE;&#xFF0C;&#x7528;&#x4E8E;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x7AEF;&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#xFF0C;&#x6309;&#x7167;&#x6807;&#x51C6;&#x683C;&#x5F0F;&#x5982;JSON&#x3001;XML&#x7B49;&#x8FDB;&#x884C;&#x7F51;&#x7EDC;&#x6570;&#x636E;&#x7684;&#x4F20;&#x8F93;&#xFF0C;&#x901A;&#x5E38;&#x4E5F;&#x4F5C;&#x4E3A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E4B;&#x95F4;&#x4EE5;RESTAPI&#x5F62;&#x5F0F;&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#x7684;&#x5E38;&#x7528;&#x534F;&#x8BAE;&#x3002;</p>
<p>&#x5728;Java&#x5E94;&#x7528;&#x4E2D;&#x9700;&#x8981;&#x8C03;&#x7528;&#x5176;&#x4ED6;&#x5E94;&#x7528;&#x63D0;&#x4F9B;&#x7684;HTTP&#x670D;&#x52A1;API&#x65F6;&#xFF0C;&#x901A;&#x5E38;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x4E00;&#x4E9B;HTTP&#x5BA2;&#x6237;&#x7AEF;&#x7EC4;&#x4EF6;&#x3002;</p>
<p>&#x800C;&#x53EF;&#x9009;&#x62E9;&#x7684;HTTP&#x5BA2;&#x6237;&#x7AEF;&#x6709;&#x5F88;&#x591A;&#xFF0C;&#x672C;&#x671F;&#x5185;&#x5BB9;&#x4E3B;&#x8981;&#x4ECB;&#x7ECD;&#x5728;Java&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x7684;HTTP&#x5BA2;&#x6237;&#x7AEF;&#x5DE5;&#x5177;&#x3002;</p>
<h2 id="&#x6982;&#x8FF0;"><a href="#&#x6982;&#x8FF0;" class="headerlink" title="&#x6982;&#x8FF0;"></a>&#x6982;&#x8FF0;</h2><p>&#x672C;&#x6587;&#x4E3B;&#x8981;&#x4ECB;&#x7ECD;&#x7684;HTTP&#x5BA2;&#x6237;&#x7AEF;&#x5305;&#x62EC;&#xFF1A;</p>
<ul>
<li>Java 11+&#x7248;&#x672C;&#x4E2D;&#x63D0;&#x4F9B;&#x7684;HttpClient</li>
<li>Apache HttpComponents&#x9879;&#x76EE;&#x4E2D;&#x7684;HttpClient</li>
<li>OkHttpClient</li>
<li>Spring Boot&#x4E2D;&#x7684;WebClient</li>
</ul>
<p>&#x4E3A;&#x4E86;&#x66F4;&#x597D;&#x7684;&#x8FDB;&#x884C;&#x5BF9;&#x6BD4;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x793A;&#x4F8B;&#x4E2D;&#x5C06;&#x5206;&#x522B;&#x4F7F;&#x7528;&#x4E0D;&#x540C;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x5B8C;&#x6210;&#x5F02;&#x6B65;GET&#x8BF7;&#x6C42;&#x548C;&#x540C;&#x6B65;POST&#x8BF7;&#x6C42;&#x3002;</p>
<p><strong>GET&#x8BF7;&#x6C42;</strong></p>
<p>&#x5BF9;&#x4E8E;Get&#x8BF7;&#x6C42;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x8BF7;&#x6C42;&#x4EE5;&#x4E0B;&#x63A5;&#x53E3;&#x67E5;&#x8BE2;&#x5317;&#x4EAC;&#x672A;&#x6765;3&#x5929;&#x7684;&#x5929;&#x6C14;&#x9884;&#x62A5;&#x3002;</p>
<p>&#x8BF7;&#x6C42;&#x5730;&#x5740;&#x4E3A;<code>http://api.weatherdt.com/common/?area=101010100&amp;type=forecast&amp;key=645cc4f76d011bbd8717b1607d6cb9d7</code>&#x3002;</p>
<p><strong>POST&#x8BF7;&#x6C42;</strong></p>
<p>&#x5BF9;&#x4E8E;POST&#x8BF7;&#x6C42;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x8BBF;&#x95EE;<code>https://getman.cn/echo</code>API&#x6D4B;&#x8BD5;&#x63A5;&#x53E3;&#xFF0C;&#x8BE5;&#x63A5;&#x53E3;&#x63A5;&#x6536;&#x4E00;&#x4E2A;JSON&#x53C2;&#x6570;&#x3002;</p>
<p>&#x5BF9;&#x4E8E;&#x6240;&#x6709;&#x7684;HTTP&#x5BA2;&#x6237;&#x7AEF;&#x5DE5;&#x5177;&#xFF0C;&#x53D1;&#x9001;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x7684;&#x8FC7;&#x7A0B;&#x57FA;&#x672C;&#x4E00;&#x81F4;&#xFF0C;&#x5305;&#x542B;&#x5982;&#x4E0B;&#x6B65;&#x9AA4;&#xFF1A;</p>
<ul>
<li>&#x521B;&#x5EFA;&#x4E00;&#x4E2A;HTTP Client&#x5B9E;&#x4F8B;</li>
<li>&#x521B;&#x5EFA;&#x7528;&#x4E8E;&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x7684;Request&#x5BF9;&#x8C61;</li>
<li>&#x8BBE;&#x7F6E;&#x4F7F;&#x7528;&#x540C;&#x6B65;&#x6216;&#x5F02;&#x6B65;&#x65B9;&#x5F0F;&#x5E76;&#x8C03;&#x7528;</li>
<li>&#x5904;&#x7406;HTTP&#x54CD;&#x5E94;&#x6570;&#x636E;</li>
</ul>
<p>&#x63A5;&#x4E0B;&#x6765;&#x4F7F;&#x7528;&#x4E0D;&#x540C;&#x7684;HTTP&#x5BA2;&#x6237;&#x7AEF;&#x6765;&#x5B8C;&#x6210;&#x529F;&#x80FD;&#x3002;</p>
<h2 id="JDK&#x539F;&#x751F;HttpClient"><a href="#JDK&#x539F;&#x751F;HttpClient" class="headerlink" title="JDK&#x539F;&#x751F;HttpClient"></a>JDK&#x539F;&#x751F;HttpClient</h2><p>&#x539F;&#x751F;<code>HttpClient</code>&#x662F;&#x5728;Java 9&#x4E2D;&#x4F5C;&#x4E3A;&#x5B75;&#x5316;&#x6A21;&#x5757;&#x5F15;&#x5165;&#x7684;&#xFF0C;&#x7136;&#x540E;&#x5728;Java11&#x4E2D;&#x4F5C;&#x4E3A;JEP 321&#x7684;&#x4E00;&#x90E8;&#x5206;&#x6B63;&#x5F0F;&#x53EF;&#x7528;&#xFF0C;<code>HTTPClient</code>&#x53D6;&#x4EE3;&#x4E86;JDK&#x66F4;&#x65E9;&#x671F;&#x7684;<code>HttpUrlConnection</code>&#x7C7B;&#x3002;</p>
<p><code>HttpClient</code>&#x652F;&#x6301;&#x4EE5;&#x4E0B;&#x529F;&#x80FD;&#xFF1A;</p>
<ul>
<li>&#x652F;&#x6301;HTTP1.1&#x3001;HTTP2.0&#x534F;&#x8BAE;</li>
<li>&#x652F;&#x6301;&#x540C;&#x6B65;&#x548C;&#x5F02;&#x6B65;&#x7F16;&#x7A0B;&#x6A21;&#x578B;</li>
<li>&#x652F;&#x6301;&#x8BF7;&#x6C42;&#x548C;&#x54CD;&#x5E94;&#x7684;&#x6D41;&#x5F0F;&#x5904;&#x7406;</li>
<li>&#x652F;&#x6301;Cookie</li>
</ul>
<h3 id="&#x5F02;&#x6B65;GET&#x8BF7;&#x6C42;"><a href="#&#x5F02;&#x6B65;GET&#x8BF7;&#x6C42;" class="headerlink" title="&#x5F02;&#x6B65;GET&#x8BF7;&#x6C42;"></a>&#x5F02;&#x6B65;GET&#x8BF7;&#x6C42;</h3><p>&#x4F7F;&#x7528;<code>HttpClient</code>&#x8FDB;&#x884C;&#x5F02;&#x6B65;GET&#x8BF7;&#x6C42;&#x7684;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/20dac3674379eb91b988d95c6f5f9b38f5b234c3aa5e121fa3f1c51e905e825e" alt></p>
<p>&#x5728;&#x4E0A;&#x9762;&#x4EE3;&#x7801;&#x4E2D;&#x4F7F;&#x7528;&#x6784;&#x5EFA;&#x5668;&#x6A21;&#x5F0F;&#x521B;&#x5EFA;&#x4E86;<code>HttpClient</code>&#x548C;<code>HttpRequest</code>&#x7684;&#x5B9E;&#x4F8B;&#xFF0C;&#x7136;&#x540E;&#x5BF9;REST API&#x8FDB;&#x884C;&#x5F02;&#x6B65;&#x8C03;&#x7528;&#x3002;</p>
<p>&#x5728;&#x521B;&#x5EFA;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x8C03;&#x7528;<code>get()</code>&#x65B9;&#x6CD5;&#x5C06;HTTP&#x65B9;&#x6CD5;&#x8BBE;&#x7F6E;&#x4E3A;<code>GET</code>&#xFF0C;&#x5E76;&#x5728;&#x8BBE;&#x7F6E;10&#x79D2;&#x7684;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#x3002;</p>
<h3 id="&#x540C;&#x6B65;POST&#x8BF7;&#x6C42;"><a href="#&#x540C;&#x6B65;POST&#x8BF7;&#x6C42;" class="headerlink" title="&#x540C;&#x6B65;POST&#x8BF7;&#x6C42;"></a>&#x540C;&#x6B65;POST&#x8BF7;&#x6C42;</h3><p>&#x5BF9;&#x4E8E;POST&#x8BF7;&#x6C42;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x6784;&#x5EFA;&#x5668;&#x4E0A;&#x8C03;&#x7528;<code>POST(BodyPublisher Body)</code>&#x65B9;&#x6CD5;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>HttpRequest.BodyPublishers.ofString(String requestBody)</code>&#x5C06;JSON&#x5B57;&#x7B26;&#x4E32;&#x8F6C;&#x6362;&#x4E3A;<code>BodyPublisher</code>&#x4F5C;&#x4E3A;&#x9700;&#x8981;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;&#x53C2;&#x6570;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/af1cbc10c790aad5ccedeb4447d8c90b5fe8311230213a6cb51c5f7a3b15b7e2" alt></p>
<p>&#x5728;&#x4EE5;&#x4E0A;&#x4EE3;&#x7801;&#x4E2D;&#xFF0C;&#x901A;&#x8FC7;<code>prepareRequest()</code>&#x65B9;&#x6CD5;&#x6A21;&#x62DF;&#x51FA;&#x4F5C;&#x4E3A;&#x8BF7;&#x6C42;&#x6570;&#x636E;&#x7684;JSON&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x540C;&#x6837;&#x4F7F;&#x7528;&#x6784;&#x5EFA;&#x5668;&#x6A21;&#x5F0F;&#xFF0C;&#x901A;&#x8FC7;<code>POST()</code>&#x5C06;&#x8BF7;&#x6C42;&#x65B9;&#x5F0F;&#x8BBE;&#x7F6E;&#x4E3A;POST&#xFF0C;&#x5BF9;&#x4E8E;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>HttpResponse.BodyHandlers.ofString()</code>&#x8F6C;&#x6362;&#x4E3A;&#x5B57;&#x7B26;&#x4E32;&#x3002;</p>
<p>&#x5982;&#x679C;&#x4F60;&#x7684;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x7684;JDK&#x7248;&#x672C;11+&#xFF0C;&#x5219;&#x539F;&#x751F;&#x7684;HTTP Client&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;&#x9996;&#x9009;&#x3002;</p>
<h2 id="Apache-HttpComponents"><a href="#Apache-HttpComponents" class="headerlink" title="Apache HttpComponents"></a>Apache HttpComponents</h2><p><code>HttpComponents</code>&#x662F;Apache&#x8F6F;&#x4EF6;&#x57FA;&#x91D1;&#x4F1A;&#x7684;&#x4E00;&#x4E2A;&#x5F00;&#x6E90;&#x9879;&#x76EE;&#xFF0C;&#x8BE5;&#x9879;&#x76EE;&#x4E2D;&#x5305;&#x542B;&#x4E86;&#x53EF;&#x7528;&#x4E8E;HTTP&#x534F;&#x8BAE;&#x7684;Java&#x5DE5;&#x5177;&#x96C6;&#x3002;</p>
<p>&#x8BE5;&#x9879;&#x76EE;&#x4E0B;&#x7684;&#x7EC4;&#x4EF6;&#x5206;&#x4E3A;&#x4EE5;&#x4E0B;&#x4E24;&#x90E8;&#x5206;&#xFF1A;</p>
<p><code>HttpCore</code>&#xFF1A;&#x4E00;&#x7EC4;&#x4F4E;&#x7EA7;HTTP&#x4F20;&#x8F93;&#x7EC4;&#x4EF6;&#xFF0C;&#x53EF;&#x7528;&#x4E8E;&#x6784;&#x5EFA;&#x81EA;&#x5B9A;&#x4E49;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x5668;&#x7AEF;HTTP&#x670D;&#x52A1;&#xFF1B;</p>
<p><code>HttpClient</code>&#xFF1A;&#x57FA;&#x4E8E;HttpCore&#x7684;&#x7B26;&#x5408;HTTP&#x534F;&#x8BAE;&#x7684;HTTP&#x4EE3;&#x7406;&#x5B9E;&#x73B0;&#x3002;</p>
<p>&#x540C;&#x65F6;&#xFF0C;&#x5B83;&#x8FD8;&#x4E3A;&#x63D0;&#x4F9B;&#x4E86;&#x5BA2;&#x6237;&#x7AEF;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x3001;HTTP&#x72B6;&#x6001;&#x7BA1;&#x7406;&#x548C;HTTP&#x8FDE;&#x63A5;&#x7BA1;&#x7406;&#x7B49;&#x7EC4;&#x4EF6;&#x3002;</p>
<p>&#x9996;&#x5148;&#xFF0C;&#x4F7F;&#x7528;&#x8BE5;&#x7EC4;&#x4EF6;&#x9700;&#x8981;&#x6DFB;&#x52A0;Maven&#x4F9D;&#x8D56;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xml&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.httpcomponents.client5&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;httpclient5&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;5.1.1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h3 id="&#x5F02;&#x6B65;GET&#x8BF7;&#x6C42;-1"><a href="#&#x5F02;&#x6B65;GET&#x8BF7;&#x6C42;-1" class="headerlink" title="&#x5F02;&#x6B65;GET&#x8BF7;&#x6C42;"></a>&#x5F02;&#x6B65;GET&#x8BF7;&#x6C42;</h3><p>&#x4F7F;&#x7528;<code>Apache HttpClient</code>&#x8FDB;&#x884C;&#x5F02;&#x6B65;REST API&#x8C03;&#x7528;&#x7684;&#x5E38;&#x89C1;&#x65B9;&#x6CD5;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/e0f486ba1e80e68d756f783567a9fb0091edde00afbb50229f33c921969ca2c4" alt></p>
<p>&#x4E3B;&#x8981;&#x6B65;&#x9AA4;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li>&#x9996;&#x5148;&#x521B;&#x5EFA;<code>CloseableHttpAsyncClient</code>&#x4F5C;&#x4E3A;HTTP&#x5BA2;&#x6237;&#x7AEF;&#xFF1B;</li>
<li>&#x7136;&#x540E;&#x8C03;&#x7528;<code>start()</code>&#x65B9;&#x6CD5;&#x542F;&#x52A8;&#x5BA2;&#x6237;&#x7AEF;&#xFF1B;</li>
<li>&#x4F7F;&#x7528;<code>SimpleHttpRequest</code>&#x521B;&#x5EFA;&#x8BF7;&#x6C42;&#xFF1B;</li>
<li>&#x5E76;&#x901A;&#x8FC7;&#x8C03;&#x7528;<code>Execute()</code>&#x65B9;&#x6CD5;&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#xFF0C;&#x5E76;&#x8BBE;&#x7F6E;<code>FutureCallback</code>&#x5BF9;&#x8C61;&#x6765;&#x5F02;&#x6B65;&#x5904;&#x7406;&#x4E0D;&#x540C;&#x54CD;&#x5E94;&#x7ED3;&#x679C;&#x3002;</li>
</ul>
<h3 id="&#x540C;&#x6B65;POST&#x8BF7;&#x6C42;-1"><a href="#&#x540C;&#x6B65;POST&#x8BF7;&#x6C42;-1" class="headerlink" title="&#x540C;&#x6B65;POST&#x8BF7;&#x6C42;"></a>&#x540C;&#x6B65;POST&#x8BF7;&#x6C42;</h3><p>&#x4F7F;&#x7528;<code>Apache HttpClient</code>&#x53D1;&#x9001;&#x540C;&#x6B65;POST&#x8BF7;&#x6C42;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/132a77410e11c987915c8c21ca8b05ac22762d6206ef7574a78835bf8b67b0bc" alt></p>
<p>&#x53D1;&#x9001;&#x540C;&#x6B65;POST&#x8BF7;&#x6C42;&#x7684;&#x6B65;&#x9AA4;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li>&#x9996;&#x5148;&#x901A;&#x8FC7;<code>prepareRequest()</code>&#x65B9;&#x6CD5;&#x521B;&#x5EFA;&#x51FA;&#x4E00;&#x4E2A;JSON&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x4F5C;&#x4E3A;&#x8BF7;&#x6C42;&#x6570;&#x636E;&#xFF1B;</li>
<li>&#x521B;&#x5EFA;<code>HttpPost</code>&#x5BF9;&#x8C61;&#x4F5C;&#x4E3A;POST&#x8BF7;&#x6C42;&#x5B9E;&#x4F8B;&#xFF0C;&#x5E76;&#x5C06;&#x8BF7;&#x6C42;&#x6570;&#x636E;&#x548C;&#x8BF7;&#x6C42;&#x5934;&#x6570;&#x636E;&#x8BBE;&#x7F6E;&#x5230;<code>HttpPost</code>&#x5BF9;&#x8C61;&#x4E2D;&#xFF1B;</li>
<li>&#x901A;&#x8FC7;<code>HttpClients.createDefault()</code>&#x521B;&#x5EFA;HTTP&#x5BA2;&#x6237;&#x7AEF;&#x5B9E;&#x4F8B;&#xFF1B;</li>
<li>&#x8C03;&#x7528;<code>execute()</code>&#x65B9;&#x6CD5;&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#xFF1B;</li>
<li>&#x4ECE;&#x8FD4;&#x56DE;&#x503C;<code>CloseableHttpResponse</code>&#x4E2D;&#x83B7;&#x5F97;&#x54CD;&#x5E94;&#x6570;&#x636E;&#x3002;</li>
</ul>
<p>&#x5F53;&#x4F7F;&#x7528;&#x7684;JDK&#x7248;&#x672C;&#x4E3A;11&#x4EE5;&#x4E0B;&#x7684;&#x7248;&#x672C;&#xFF0C;&#x6216;&#x8005;&#x9700;&#x8981;&#x5C06;&#x529F;&#x80FD;&#x4F5C;&#x4E3A;&#x63D2;&#x4EF6;&#x63D0;&#x4F9B;&#x7ED9;&#x522B;&#x7684;&#x7CFB;&#x7EDF;&#x4F7F;&#x7528;&#x65F6;&#xFF0C;<code>Apache HttpClient</code>&#x662F;&#x4E00;&#x4E2A;&#x6BD4;&#x8F83;&#x597D;&#x7684;&#x9009;&#x62E9;&#x3002;</p>
<h2 id="OkHttpClient"><a href="#OkHttpClient" class="headerlink" title="OkHttpClient"></a>OkHttpClient</h2><p><code>OkHttpClient</code>&#x4E5F;&#x662F;&#x4E00;&#x4E2A;&#x5F00;&#x6E90;&#x5E93;&#xFF0C;&#x7531;&#x7F8E;&#x56FD;&#x7684;Square&#x516C;&#x53F8;&#x63D0;&#x4F9B;&#x3002;</p>
<p>&#x540C;&#x6837;&#x9700;&#x8981;&#x6DFB;&#x52A0;&#x5BF9;&#x5E94;&#x7684;Maven&#x4F9D;&#x8D56;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xml&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.squareup.okhttp3&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;okhttp&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;4.9.2&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h3 id="&#x5F02;&#x6B65;GET&#x8BF7;&#x6C42;-2"><a href="#&#x5F02;&#x6B65;GET&#x8BF7;&#x6C42;-2" class="headerlink" title="&#x5F02;&#x6B65;GET&#x8BF7;&#x6C42;"></a>&#x5F02;&#x6B65;GET&#x8BF7;&#x6C42;</h3><p>&#x4F7F;&#x7528;<code>OkHttpClient</code>&#x53D1;&#x9001;&#x5F02;&#x6B65;GET&#x8BF7;&#x6C42;&#x7684;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/6a301cd65d403f13f8fb6cbc4e75c2470b8d743804a4be3f34f95c49994d9150" alt></p>
<p>&#x4F7F;&#x7528;<code>OKHttpClient</code>&#x521B;&#x5EFA;GET&#x8BF7;&#x6C42;&#x6B65;&#x9AA4;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li>&#x901A;&#x8FC7;&#x6784;&#x5EFA;&#x5668;&#x6A21;&#x5F0F;&#x8BBE;&#x7F6E;&#x8BFB;&#x5199;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#xFF0C;&#x521B;&#x5EFA;&#x51FA;HTTP&#x5BA2;&#x6237;&#x7AEF;&#x5B9E;&#x4F8B;&#xFF1B;</li>
<li>&#x4F7F;&#x7528;<code>Request.Builder()</code>&#x521B;&#x5EFA;&#x8BF7;&#x6C42;&#x5B9E;&#x4F8B;&#xFF1B;</li>
<li>&#x4F7F;&#x7528;<code>OkHttpClient.newCall()</code>&#x65B9;&#x6CD5;&#x53D1;&#x9001;&#x5F02;&#x6B65;get&#x8BF7;&#x6C42;&#xFF1B;</li>
<li>&#x901A;&#x8FC7;<code>enqueue()</code>&#x65B9;&#x6CD5;&#x8BBE;&#x7F6E;&#x5BF9;&#x5F02;&#x6B65;&#x8BF7;&#x6C42;&#x54CD;&#x5E94;&#x7684;&#x5904;&#x7406;&#x3002;</li>
</ul>
<h3 id="&#x540C;&#x6B65;POST&#x8BF7;&#x6C42;-2"><a href="#&#x540C;&#x6B65;POST&#x8BF7;&#x6C42;-2" class="headerlink" title="&#x540C;&#x6B65;POST&#x8BF7;&#x6C42;"></a>&#x540C;&#x6B65;POST&#x8BF7;&#x6C42;</h3><p><code>OKHttpClient</code>&#x53D1;&#x9001;&#x540C;&#x6B65;POST&#x8BF7;&#x6C42;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/63449225315532edec96560d63f00a3921d6ff3e55ee2153b068c8f5c0f714c7" alt></p>
<p>&#x901A;&#x8FC7;<code>OKHttpClient</code>&#x521B;&#x5EFA;POST&#x8BF7;&#x6C42;&#x6B65;&#x9AA4;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li>&#x8C03;&#x7528;<code>prepaareRequest()</code>&#x65B9;&#x6CD5;&#x751F;&#x6210;&#x8BF7;&#x6C42;JSON&#x6570;&#x636E;&#xFF1B;</li>
<li>&#x901A;&#x8FC7;&#x6784;&#x5EFA;&#x5668;&#x6A21;&#x5F0F;&#x521B;&#x5EFA;&#x51FA;<code>OkHttpClient</code>&#x5BA2;&#x6237;&#x7AEF;&#x5B9E;&#x4F8B;&#xFF1B;</li>
<li>&#x8C03;&#x7528;<code>RequestBody.create()</code>&#x521B;&#x5EFA;&#x51FA;&#x8BF7;&#x6C42;&#x6570;&#x636E;&#x4F53;&#xFF1B;</li>
<li>&#x8C03;&#x7528;<code>Request.Builder()</code>&#x6784;&#x5EFA;&#x51FA;POST&#x8BF7;&#x6C42;&#x793A;&#x4F8B;&#xFF1B;</li>
<li>&#x8C03;&#x7528;<code>execute()</code>&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#xFF0C;&#x5E76;&#x540C;&#x6B65;&#x5F97;&#x5230;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;<code>Response</code>&#x3002;</li>
</ul>
<p><code>OKHttpClient</code>&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x8BF7;&#x6C42;&#x793A;&#x4F8B;&#x90FD;&#x4E0D;&#x9700;&#x8981;&#x624B;&#x52A8;&#x5173;&#x95ED;&#xFF0C;&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x5355;&#x4E2A;<code>OkHttpClient</code>&#x5B9E;&#x4F8B;&#x53EF;&#x4EE5;&#x5C06;&#x8FDB;&#x884C;<strong>&#x91CD;&#x590D;&#x4F7F;&#x7528;</strong>&#xFF0C;&#x5E76;&#x4E14;OkHttp&#x7684;<strong>&#x6027;&#x80FD;&#x6700;&#x4F73;</strong>&#x3002;</p>
<h2 id="Spring-WebClient"><a href="#Spring-WebClient" class="headerlink" title="Spring WebClient"></a>Spring WebClient</h2><p><code>Spring WebClient</code>&#x662F;&#x5728;Spring 5&#x4E2D;&#x5F15;&#x5165;&#x7684;&#x5F02;&#x6B65;&#x3001;&#x53CD;&#x5E94;&#x5F0F;HTTP&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7528;&#x4E8E;&#x53D6;&#x4EE3;&#x8F83;&#x65E7;&#x7684;<code>RestTemplate</code>&#xFF0C;&#x4EE5;&#x4FBF;&#x5728;&#x4F7F;&#x7528;<code>Spring Boot</code>&#x6846;&#x67B6;&#x6784;&#x5EFA;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#x8FDB;&#x884C;REST API&#x8C03;&#x7528;&#xFF0C;&#x5B83;&#x652F;&#x6301;&#x540C;&#x6B65;&#x3001;&#x5F02;&#x6B65;&#x548C;&#x6D41;&#x5F0F;&#x5904;&#x7406;&#x3002;</p>
<p>&#x540C;&#x6837;&#x4F7F;&#x7528;<code>Spring WebClient</code>&#x9700;&#x8981;&#x6DFB;&#x52A0;Maven&#x4F9D;&#x8D56;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xml&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-webflux&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.3.5.RELEASE&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p><code>Spring WebClient</code>&#x5728;<code>Spring-boot-starter-webFlux</code>&#x5305;&#x4E2D;&#xFF0C;Spring WebFlux&#x662F;Spring5&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x7528;&#x4E8E;&#x4E3A;Web&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#x7684;&#x53CD;&#x5E94;&#x5F0F;&#x7F16;&#x7A0B;&#x63D0;&#x4F9B;&#x652F;&#x6301;&#x3002;</p>
<h3 id="&#x5F02;&#x6B65;GET&#x8BF7;&#x6C42;-3"><a href="#&#x5F02;&#x6B65;GET&#x8BF7;&#x6C42;-3" class="headerlink" title="&#x5F02;&#x6B65;GET&#x8BF7;&#x6C42;"></a>&#x5F02;&#x6B65;GET&#x8BF7;&#x6C42;</h3><p>&#x4F7F;&#x7528;<code>Spring WebClient</code>&#x53D1;&#x9001;&#x5F02;&#x6B65;GET&#x8BF7;&#x6C42;&#x4EE3;&#x7801;&#x793A;&#x4F8B;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/de78c04e8c84c94264e643bfc81c62194a34fe667594877f730634f0d2a05b06" alt></p>
<ul>
<li>&#x5728;&#x6B64;&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x9996;&#x5148;&#x4F7F;&#x7528;&#x9ED8;&#x8BA4;&#x8BBE;&#x7F6E;&#x521B;&#x5EFA;&#x5BA2;&#x6237;&#x7AEF;&#xFF1B;</li>
<li>&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x8C03;&#x7528;client&#x7684;<code>get()</code>&#x65B9;&#x6CD5;&#xFF0C;&#x5E76;&#x8C03;&#x7528;<code>uri()</code>&#x65B9;&#x6CD5;&#x8BBE;&#x7F6E;&#x8BF7;&#x6C42;API&#x5730;&#x5740;&#xFF1B;</li>
<li>&#x8C03;&#x7528;&#x94FE;&#x4E2D;&#x7684;<code>retrieve()</code>&#x65B9;&#x6CD5;&#x7528;&#x4E8E;&#x8FDB;&#x884C;API&#x8C03;&#x7528;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#xFF1B;</li>
<li>&#x7136;&#x540E;&#x5E76;&#x901A;&#x8FC7;<code>bodyToMono()</code>&#x65B9;&#x6CD5;&#x83B7;&#x53D6;&#x54CD;&#x5E94;&#x4F53;&#xFF0C;&#x8BE5;&#x54CD;&#x5E94;&#x4F53;&#x901A;&#x8FC7;<code>bodyToMono()</code>&#x65B9;&#x6CD5;&#x8F6C;&#x6362;&#x4E3A;<code>Mono</code>&#x5BF9;&#x8C61;&#xFF1B;</li>
<li>&#x6700;&#x540E;&#xFF0C;&#x4F7F;&#x7528;<code>subscribe()</code>&#x65B9;&#x6CD5;&#x4EE5;&#x975E;&#x963B;&#x585E;&#x65B9;&#x5F0F;&#x8BA2;&#x9605;<code>bodyToMono()</code>&#x65B9;&#x6CD5;&#x8F6C;&#x6362;&#x8FD4;&#x56DE;&#x7684;<code>Mono</code>&#x5BF9;&#x8C61;&#x3002;</li>
</ul>
<h3 id="&#x540C;&#x6B65;POST&#x8BF7;&#x6C42;-3"><a href="#&#x540C;&#x6B65;POST&#x8BF7;&#x6C42;-3" class="headerlink" title="&#x540C;&#x6B65;POST&#x8BF7;&#x6C42;"></a>&#x540C;&#x6B65;POST&#x8BF7;&#x6C42;</h3><p>&#x867D;&#x7136;<code>Spring WebClient</code>&#x662F;&#x5F02;&#x6B65;&#x7684;&#xFF0C;&#x4F46;&#x6211;&#x4EEC;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8C03;&#x7528;block()&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x540C;&#x6B65;&#x8C03;&#x7528;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x4F1A;&#x963B;&#x585E;&#x7EBF;&#x7A0B;&#xFF0C;&#x76F4;&#x5230;&#x6267;&#x884C;&#x7ED3;&#x675F;&#xFF1B;&#x5728;&#x65B9;&#x6CD5;&#x6267;&#x884C;&#x540E;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x3002;</p>
<p>&#x4F7F;&#x7528;<code>WebClient</code>&#x53D1;&#x51FA;&#x7684;&#x540C;&#x6B65;POST&#x8BF7;&#x6C42;&#x793A;&#x4F8B;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/d640e52e5338c81bc74862286229edfc934dde06b3c13c2aff06f18e6fd6066f" alt></p>
<ul>
<li>&#x9996;&#x5148;&#x901A;&#x8FC7;<code>WebClient.create()</code>&#x521B;&#x5EFA;HTTP&#x5BA2;&#x6237;&#x7AEF;&#xFF1B;</li>
<li>&#x901A;&#x8FC7;<code>client.post()</code>&#x8BBE;&#x7F6E;&#x8BF7;&#x6C42;&#x65B9;&#x5F0F;&#x4E3A;POST&#xFF1B;</li>
<li>&#x901A;&#x8FC7;<code>body()</code>&#x65B9;&#x6CD5;&#x5C06;<code>prepaareRequest()</code>&#x65B9;&#x6CD5;&#x4E2D;&#x8FD4;&#x56DE;JSON&#x5B57;&#x7B26;&#x4E32;&#x4F5C;&#x4E3A;&#x8BF7;&#x6C42;&#x6570;&#x636E;&#xFF1B;</li>
<li>&#x8C03;&#x7528;<code>exchange()</code>&#x65B9;&#x6CD5;&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#xFF0C;&#x5E76;&#x4E14;&#x4F1A;&#x5C06;&#x54CD;&#x5E94;&#x6570;&#x636E;&#x5C01;&#x88C5;&#x5230;<code>Mono</code>&#x5BF9;&#x8C61;&#x4E2D;&#xFF0C;&#x6BD4;<code>retrieve()</code>&#x65B9;&#x6CD5;&#x63D0;&#x4F9B;&#x66F4;&#x591A;&#x7684;&#x64CD;&#x4F5C;&#x65B9;&#x6CD5;&#xFF1B;</li>
<li>&#x8C03;&#x7528;<code>block()</code>&#x8BBE;&#x7F6E;&#x8BF7;&#x6C42;&#x4E3A;&#x540C;&#x6B65;&#x963B;&#x585E;&#x7684;&#x3002;</li>
</ul>
<h2 id="&#x5982;&#x4F55;&#x9009;&#x62E9;"><a href="#&#x5982;&#x4F55;&#x9009;&#x62E9;" class="headerlink" title="&#x5982;&#x4F55;&#x9009;&#x62E9;"></a>&#x5982;&#x4F55;&#x9009;&#x62E9;</h2><p>&#x5728;&#x672C;&#x6587;&#x4E0A;&#x8FF0;&#x5185;&#x5BB9;&#x4E2D;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x4E0D;&#x540C;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x5DE5;&#x5177;&#x5B9E;&#x73B0;&#x4E86;&#x53D1;&#x9001;&#x540C;&#x6B65;&#x7684;GET&#x8BF7;&#x6C42;&#x548C;&#x5F02;&#x6B65;&#x7684;POST&#x8BF7;&#x6C42;&#x3002;</p>
<p>&#x5404;&#x4E2A;&#x5DE5;&#x5177;&#x7684;&#x7279;&#x70B9;&#x53EF;&#x4EE5;&#x603B;&#x7ED3;&#x4E3A;&#x4EE5;&#x4E0B;&#x51E0;&#x70B9;&#xFF1A;</p>
<ul>
<li>&#x5982;&#x679C;&#x4E0D;&#x60F3;&#x6DFB;&#x52A0;&#x4EFB;&#x4F55;&#x5916;&#x90E8;&#x5E93;&#x5E76;&#x4E14;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;JDK&#x7248;&#x672C;&#x662F;11+&#xFF0C;&#x90A3;&#x4E48;&#x539F;&#x751F;<code>HTTPClient</code>&#x662F;&#x9996;&#x9009;&#xFF1B;</li>
<li>&#x5982;&#x679C;&#x662F;<code>Spring Boot</code>&#x5E94;&#x7528;&#x5E76;&#x4E14;&#x662F;&#x53CD;&#x5E94;&#x5F0F;API&#xFF0C;&#x5219;&#x4F7F;&#x7528;<code>Spring WebClient</code>&#xFF1B;</li>
<li><code>Apache HttpClient</code>&#x7684;&#x7075;&#x6D3B;&#x6027;&#x66F4;&#x9AD8;&#xFF0C;&#x76F8;&#x6BD4;&#x5176;&#x4ED6;&#x5E93;&#x6709;&#x66F4;&#x591A;&#x7684;&#x53C2;&#x8003;&#x6587;&#x6863;&#xFF1B;</li>
<li><code>OkHttpClient</code>&#x7684;&#x6027;&#x80FD;&#x6700;&#x4F73;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x5BF9;&#x8C61;&#x53EF;&#x91CD;&#x590D;&#x4F7F;&#x7528;&#xFF0C;&#x529F;&#x80FD;&#x4E30;&#x5BCC;&#xFF0C;&#x9AD8;&#x5EA6;&#x53EF;&#x914D;&#x7F6E;&#x3002;</li>
</ul>
<p>&#x6240;&#x4EE5;&#x5728;&#x5B9E;&#x9645;&#x5F00;&#x53D1;&#x4E2D;&#xFF0C;&#x6309;&#x81EA;&#x5DF1;&#x7684;&#x5B9E;&#x9645;&#x9700;&#x6C42;&#x548C;&#x573A;&#x666F;&#x8FDB;&#x884C;&#x9009;&#x62E9;&#xFF0C;&#x4FD7;&#x8BDD;&#x8BF4;<strong>&#x6CA1;&#x6709;&#x6700;&#x597D;&#x7684;&#xFF0C;&#x53EA;&#x6709;&#x6700;&#x9002;&#x5408;&#x7684;</strong>&#x3002;</p>
<hr>
<blockquote>
<p>&#x6211;&#x662F;&#x5C0F;&#x9ED1;&#xFF0C;&#x4E00;&#x4E2A;&#x5728;&#x4E92;&#x8054;&#x7F51;&#x201C;&#x82DF;&#x4E14;&#x201D;&#x7684;&#x7A0B;&#x5E8F;&#x5458;&#x3002;</p>
<p><strong>&#x6D41;&#x6C34;&#x4E0D;&#x4E89;&#x5148;&#xFF0C;&#x8D35;&#x5728;&#x6ED4;&#x6ED4;&#x4E0D;&#x7EDD;</strong></p>
</blockquote>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/ab1910efb586c36afe8644a681a3b6b0.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7034701907662897159.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7034701907662897159.html" itemprop="url">prometheus+grafana替代Zabbix监控sp</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-11-26T10:37:36+08:00">
                2021-11-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x8FD9;&#x662F;&#x6211;&#x53C2;&#x4E0E;11&#x6708;&#x66F4;&#x6587;&#x6311;&#x6218;&#x7684;&#x7B2C;26&#x5929;&#xFF0C;&#x6D3B;&#x52A8;&#x8BE6;&#x60C5;&#x67E5;&#x770B;&#xFF1A;<a href="https://dev.newban.cn/7023643374569816095/">2021&#x6700;&#x540E;&#x4E00;&#x6B21;&#x66F4;&#x6587;&#x6311;&#x6218;</a></p>
<h3 id="1-&#x4E0B;&#x8F7D;&#x53EF;&#x89C6;&#x5316;&#x6A21;&#x677F;"><a href="#1-&#x4E0B;&#x8F7D;&#x53EF;&#x89C6;&#x5316;&#x6A21;&#x677F;" class="headerlink" title="1.&#x4E0B;&#x8F7D;&#x53EF;&#x89C6;&#x5316;&#x6A21;&#x677F;"></a>1.&#x4E0B;&#x8F7D;&#x53EF;&#x89C6;&#x5316;&#x6A21;&#x677F;</h3><p>&#x901A;&#x8FC7;&#x4E0A;&#x6587;&#x53EF;&#x77E5;grafana&#x4E3A;&#x663E;&#x793A;&#x9875;&#x9762;&#xFF0C;&#x6240;&#x4EE5;&#x672C;&#x6587;&#x63D0;&#x4F9B;&#x4E00;&#x4EFD;&#x76D1;&#x63A7;springboot&#x7684;json&#x9875;&#x9762;&#x4F9B;&#x5927;&#x5BB6;&#x4E0B;&#x8F7D;&#x3002;</p>
<p>&#x94FE;&#x63A5;&#xFF1A;<a href="/external_links/b3312f06b7d0eeea3d3f0a2ed5ebc689.html" target="blank" rel="noopener">pan.baidu.com/s/1h5yrTsqU&#x2026;</a><br>&#x63D0;&#x53D6;&#x7801;&#xFF1A;ehbv</p>
<h3 id="2-&#x914D;&#x7F6E;SpringBoot"><a href="#2-&#x914D;&#x7F6E;SpringBoot" class="headerlink" title="2.&#x914D;&#x7F6E;SpringBoot"></a>2.&#x914D;&#x7F6E;SpringBoot</h3><h4 id="1-&#x4FEE;&#x6539;pom"><a href="#1-&#x4FEE;&#x6539;pom" class="headerlink" title="1.&#x4FEE;&#x6539;pom"></a>1.&#x4FEE;&#x6539;pom</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">js&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">	xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line">	&lt;parent&gt;</span><br><span class="line">		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">		&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line">		&lt;version&gt;2.1.3.RELEASE&lt;/version&gt;</span><br><span class="line">		&lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;</span><br><span class="line">	&lt;/parent&gt;</span><br><span class="line">	&lt;groupId&gt;com.dalaoyang&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;springboot2_prometheus&lt;/artifactId&gt;</span><br><span class="line">	&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span><br><span class="line">	&lt;name&gt;springboot2_prometheus&lt;/name&gt;</span><br><span class="line">	&lt;description&gt;springboot2_prometheus&lt;/description&gt;</span><br><span class="line"></span><br><span class="line">	&lt;properties&gt;</span><br><span class="line">		&lt;java.version&gt;1.8&lt;/java.version&gt;</span><br><span class="line">	&lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">	&lt;dependencies&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">			&lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;io.micrometer&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;micrometer-registry-prometheus&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;1.1.3&lt;/version&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">	&lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&lt;build&gt;</span><br><span class="line">		&lt;plugins&gt;</span><br><span class="line">			&lt;plugin&gt;</span><br><span class="line">				&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">				&lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">			&lt;/plugin&gt;</span><br><span class="line">		&lt;/plugins&gt;</span><br><span class="line">	&lt;/build&gt;</span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>

<h4 id="2-&#x4FEE;&#x6539;application-yml"><a href="#2-&#x4FEE;&#x6539;application-yml" class="headerlink" title="2.&#x4FEE;&#x6539;application.yml"></a>2.&#x4FEE;&#x6539;application.yml</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">js&#x590D;&#x5236;&#x4EE3;&#x7801;management:</span><br><span class="line">  endpoints:</span><br><span class="line">    web:</span><br><span class="line">      exposure:</span><br><span class="line">        include: &apos;*&apos;</span><br><span class="line">  metrics:</span><br><span class="line">    tags:</span><br><span class="line">      application: ${spring.application.name}</span><br><span class="line">  health:</span><br><span class="line">    redis:</span><br><span class="line">      enabled: false</span><br></pre></td></tr></table></figure>

<h4 id="3-&#x8BBE;&#x7F6E;application"><a href="#3-&#x8BBE;&#x7F6E;application" class="headerlink" title="3.&#x8BBE;&#x7F6E;application"></a>3.&#x8BBE;&#x7F6E;application</h4><p>&#x5728;&#x542F;&#x52A8;&#x95EE;&#x4EF7;&#x4E2D;&#x52A0;&#x5165;&#x4EE5;&#x4E0B;&#x4EE3;&#x7801;&#x3002;<br><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/8c73887cf45f1cd8d7cada27a859cfd92c9683d6acd76fc0b1afbfc95cfcaae9" alt="&#x5728;&#x8FD9;&#x91CC;&#x63D2;&#x5165;&#x56FE;&#x7247;&#x63CF;&#x8FF0;"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">js&#x590D;&#x5236;&#x4EE3;&#x7801;    @Bean</span><br><span class="line">    MeterRegistryCustomizer&lt;MeterRegistry&gt; configurer(@Value(&quot;${spring.application.name}&quot;) String applicationName) {</span><br><span class="line">        return (registry) -&gt; registry.config().commonTags(&quot;application&quot;, applicationName);</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>SpringBoot&#x9879;&#x76EE;&#x5230;&#x8FD9;&#x91CC;&#x5C31;&#x914D;&#x7F6E;&#x5B8C;&#x6210;&#x4E86;&#xFF0C;&#x542F;&#x52A8;&#x9879;&#x76EE;&#xFF0C;&#x8BBF;&#x95EE;<a href="/external_links/306a2d1d94631202b4b4cb16edfa7926.html" target="blank" rel="noopener">http://ip:8080/actuator/prometheus&#x5373;&#x53EF;&#x770B;&#x5230;&#x8FD4;&#x56DE;&#x503C;&#xFF0C;&#x8FD9;&#x4E9B;&#x503C;&#x5C31;&#x662F;spring</a> boot&#x8FD4;&#x56DE;&#x5728;&#x524D;&#x53F0;&#x9875;&#x9762;&#x7684;&#x4FE1;&#x606F;&#x3002;<br><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/1e4340c40082f3426b18b3d6280d9578a2a1f6d6be29855c361b475f02b11fcf" alt="&#x5728;&#x8FD9;&#x91CC;&#x63D2;&#x5165;&#x56FE;&#x7247;&#x63CF;&#x8FF0;"></p>
<h3 id="3-Prometheus&#x914D;&#x7F6E;"><a href="#3-Prometheus&#x914D;&#x7F6E;" class="headerlink" title="3.Prometheus&#x914D;&#x7F6E;"></a>3.Prometheus&#x914D;&#x7F6E;</h3><p>&#x5728;prometheus&#x914D;&#x7F6E;&#x76D1;&#x63A7;&#x6211;&#x4EEC;&#x7684;SpringBoot&#x5E94;&#x7528;&#xFF0C;&#x5B8C;&#x6574;&#x914D;&#x7F6E;&#x5982;&#x4E0B;&#x6240;&#x793A;&#x3002;&#x627E;&#x5230;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x66FF;&#x6362;&#x5373;&#x53EF;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">js&#x590D;&#x5236;&#x4EE3;&#x7801;# my global config</span><br><span class="line">global:</span><br><span class="line">  scrape_interval:     15s # Set the scrape interval to every 15 seconds. Default is every 1 minute.</span><br><span class="line">  evaluation_interval: 15s # Evaluate rules every 15 seconds. The default is every 1 minute.</span><br><span class="line">  # scrape_timeout is set to the global default (10s).</span><br><span class="line"></span><br><span class="line"># Alertmanager configuration</span><br><span class="line">alerting:</span><br><span class="line">  alertmanagers:</span><br><span class="line">  - static_configs:</span><br><span class="line">    - targets:</span><br><span class="line">      # - alertmanager:9093</span><br><span class="line"></span><br><span class="line"># Load rules once and periodically evaluate them according to the global &apos;evaluation_interval&apos;.</span><br><span class="line">rule_files:</span><br><span class="line">  # - &quot;first_rules.yml&quot;</span><br><span class="line">  # - &quot;second_rules.yml&quot;</span><br><span class="line"></span><br><span class="line"># A scrape configuration containing exactly one endpoint to scrape:</span><br><span class="line"># Here it&apos;s Prometheus itself.</span><br><span class="line">scrape_configs:</span><br><span class="line">  # The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config.</span><br><span class="line">  - job_name: &apos;prometheus&apos;</span><br><span class="line">    static_configs:</span><br><span class="line">    - targets: [&apos;localhost:9090&apos;]</span><br><span class="line">  - job_name: &apos;springboot_system&apos; #&#x76D1;&#x63A7;&#x4EFB;&#x52A1;&#x540D;&#x79F0;</span><br><span class="line">    scrape_interval: 5s</span><br><span class="line">    metrics_path: &apos;/actuator/prometheus&apos;</span><br><span class="line">    static_configs:</span><br><span class="line">      - targets: [&apos;localhost:8088&apos;]    #springboot&#x7AEF;&#x53E3;&#x53F7;</span><br></pre></td></tr></table></figure>

<p>&#x542F;&#x52A8;Prometheus &#xFF0C;&#x8BBF;&#x95EE; ip:9090&#xFF0C;&#x7136;&#x540E;&#x6309;&#x7167;&#x4E0B;&#x56FE;&#x64CD;&#x4F5C;&#xFF0C;&#x5373;&#x53EF;&#x770B;&#x5230;&#x5DF2;&#x7ECF;&#x6CE8;&#x518C;&#x5230;Prometheus &#x7684;&#x76D1;&#x63A7;&#x4EFB;&#x52A1;&#x3002;<br><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/127e052b974c868e1a82f0ca56194f6a11b37dc1f4ea41810c8bd25875f8d129" alt="&#x5728;&#x8FD9;&#x91CC;&#x63D2;&#x5165;&#x56FE;&#x7247;&#x63CF;&#x8FF0;"></p>
<h3 id="4-Grafana&#x914D;&#x7F6E;"><a href="#4-Grafana&#x914D;&#x7F6E;" class="headerlink" title="4.Grafana&#x914D;&#x7F6E;"></a>4.Grafana&#x914D;&#x7F6E;</h3><p>&#x8F93;&#x5165;ip:3000&#xFF0C;&#x53EF;&#x4EE5;&#x8FDB;&#x5165;grafana&#x7684;&#x53EF;&#x89C6;&#x5316;&#x754C;&#x9762;&#x3002;</p>
<h4 id="1-&#x914D;&#x7F6E;prometheus&#x6570;&#x636E;&#x6E90;-&#xFF08;ip-9090&#xFF09;"><a href="#1-&#x914D;&#x7F6E;prometheus&#x6570;&#x636E;&#x6E90;-&#xFF08;ip-9090&#xFF09;" class="headerlink" title="1.&#x914D;&#x7F6E;prometheus&#x6570;&#x636E;&#x6E90; &#xFF08;ip:9090&#xFF09;"></a>1.&#x914D;&#x7F6E;prometheus&#x6570;&#x636E;&#x6E90; &#xFF08;ip:9090&#xFF09;</h4><p><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/7c60d45601d43d4a2f49bd3f40b3eb4bf8986fb67a366ee7f5f6a06c9f955dce" alt="&#x5728;&#x8FD9;&#x91CC;&#x63D2;&#x5165;&#x56FE;&#x7247;&#x63CF;&#x8FF0;"><br><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/24390bd818e88298dd5202d11f1786859dc490292c06ba2836fd23fc9c4023dd" alt="&#x5728;&#x8FD9;&#x91CC;&#x63D2;&#x5165;&#x56FE;&#x7247;&#x63CF;&#x8FF0;"></p>
<p>&#x4E0A;&#x56FE;&#x586B;&#x5199;&#x4F60;prometheus&#x5730;&#x5740;&#xFF0C;&#x7AEF;&#x53E3;&#x5207;&#x8BB0;&#x586B;&#x5199;9090&#xFF0C;&#x70B9;&#x51FB;save&#x540E;&#xFF0C;&#x5982;&#x679C;&#x5931;&#x8D25;&#x4F1A;&#x6709;&#x63D0;&#x793A; &#x3002;</p>
<h4 id="2-&#x5BFC;&#x5165;&#x53EF;&#x89C6;&#x5316;&#x6A21;&#x677F;"><a href="#2-&#x5BFC;&#x5165;&#x53EF;&#x89C6;&#x5316;&#x6A21;&#x677F;" class="headerlink" title="2.&#x5BFC;&#x5165;&#x53EF;&#x89C6;&#x5316;&#x6A21;&#x677F;"></a>2.&#x5BFC;&#x5165;&#x53EF;&#x89C6;&#x5316;&#x6A21;&#x677F;</h4><p>&#x7136;&#x540E;&#x5BFC;&#x5165;&#x4E0A;&#x6587;&#x4E0B;&#x8F7D;&#x597D;&#x7684;&#x53EF;&#x89C6;&#x5316;&#x754C;&#x9762;&#x6A21;&#x677F;&#x3002;<br><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/8c89525a0c906d88a3eaf402d3b76fb8c9621164a30fffbc70b201855d3cc40b" alt="&#x5728;&#x8FD9;&#x91CC;&#x63D2;&#x5165;&#x56FE;&#x7247;&#x63CF;&#x8FF0;"></p>
<p>&#x9009;&#x62E9;&#x4E0A;&#x6587;&#x914D;&#x7F6E;&#x597D;&#x7684;&#x6570;&#x636E;&#x6E90;&#xFF0C;prometheus&#x9009;&#x9879;&#x5C31;&#x662F;&#x4E0A;&#x6587;&#x914D;&#x7F6E;&#x7684;&#x6570;&#x636E;&#x6E90;&#x3002;<br><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/f1217e65bb17acf31c797dc4aa07885469bc6deea72ea872b382cf23f832e17e" alt="&#x5728;&#x8FD9;&#x91CC;&#x63D2;&#x5165;&#x56FE;&#x7247;&#x63CF;&#x8FF0;"></p>
<h4 id="3-&#x9A8C;&#x8BC1;"><a href="#3-&#x9A8C;&#x8BC1;" class="headerlink" title="3.&#x9A8C;&#x8BC1;"></a>3.&#x9A8C;&#x8BC1;</h4><p><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/8d84d5f446b25bf272107061e6a7785de022586e6ae63417f93de119c97a031b" alt="&#x5728;&#x8FD9;&#x91CC;&#x63D2;&#x5165;&#x56FE;&#x7247;&#x63CF;&#x8FF0;"></p>
<p>&#x51FA;&#x73B0;&#x4EE5;&#x4E0A;&#x753B;&#x9762; &#x914D;&#x7F6E;&#x5B8C;&#x6210;&#xFF01;</p>
<p>&#x200B;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/5f28f60db1853d501969a2cf05c5c059.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7034697994318381063.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7034697994318381063.html" itemprop="url">微信ClickHouse实时数仓的最佳实践 一、微信遇到的挑</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-11-26T10:21:36+08:00">
                2021-11-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x4F5C;&#x8005;&#xFF1A;&#x5FAE;&#x4FE1;WeOLAP&#x56E2;&#x961F;&amp;&#x817E;&#x8BAF;&#x4E91;&#x6570;&#x636E;&#x4ED3;&#x5E93;Clickhouse&#x56E2;&#x961F;</p>
<blockquote>
<p>&#x5FAE;&#x4FE1;&#x4F5C;&#x4E3A;&#x4E00;&#x6B3E;&#x56FD;&#x6C11;&#x7EA7;&#x5E94;&#x7528;&#xFF0C;&#x5DF2;&#x7ECF;&#x8986;&#x76D6;&#x4E86;&#x793E;&#x4EA4;&#x3001;&#x652F;&#x4ED8;&#x3001;&#x51FA;&#x884C;&#x7B49;&#x4EBA;&#x4EEC;&#x751F;&#x6D3B;&#x7684;&#x65B9;&#x65B9;&#x9762;&#x9762;&#x3002;&#x6D77;&#x91CF;&#x591A;&#x6837;&#x5316;&#x7684;&#x4E1A;&#x52A1;&#x5F62;&#x6001;&#xFF0C;&#x5BF9;&#x6570;&#x636E;&#x5206;&#x6790;&#x63D0;&#x51FA;&#x4E86;&#x65B0;&#x7684;&#x6311;&#x6218;&#x3002;&#x4E3A;&#x4E86;&#x6EE1;&#x8DB3;&#x4E1A;&#x52A1;&#x6570;&#x636E;&#x5206;&#x6790;&#x7684;&#x9700;&#x6C42;&#xFF0C;&#x5FAE;&#x4FE1;WeOLAP&#x56E2;&#x961F;&#x8054;&#x624B;&#x817E;&#x8BAF;&#x4E91;&#xFF0C;&#x5171;&#x5EFA;&#x5343;&#x53F0;&#x89C4;&#x6A21;&#x3001;&#x6570;&#x636E;PB&#x7EA7;&#x3001;&#x6279;&#x6D41;&#x4E00;&#x4F53;&#x7684;ClickHouse&#x6570;&#x636E;&#x4ED3;&#x5E93;&#xFF0C;&#x5B9E;&#x73B0;&#x4E86;10&#x500D;&#x4EE5;&#x4E0A;&#x7684;&#x6027;&#x80FD;&#x63D0;&#x5347;&#x3002;&#x4E0B;&#x6587;&#x5C06;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x4E3A;&#x5927;&#x5BB6;&#x63ED;&#x6653;&#x5FAE;&#x4FE1;&#x5728;ClickHouse&#x5B9E;&#x65F6;&#x6570;&#x4ED3;&#x5B9E;&#x8DF5;&#x4E2D;&#x79EF;&#x7D2F;&#x7684;&#x7ECF;&#x9A8C;&#x53CA;&#x65B9;&#x6CD5;&#x3002;</p>
</blockquote>
<h1 id="&#x4E00;&#x3001;&#x5FAE;&#x4FE1;&#x9047;&#x5230;&#x7684;&#x6311;&#x6218;"><a href="#&#x4E00;&#x3001;&#x5FAE;&#x4FE1;&#x9047;&#x5230;&#x7684;&#x6311;&#x6218;" class="headerlink" title="&#x4E00;&#x3001;&#x5FAE;&#x4FE1;&#x9047;&#x5230;&#x7684;&#x6311;&#x6218;"></a>&#x4E00;&#x3001;&#x5FAE;&#x4FE1;&#x9047;&#x5230;&#x7684;&#x6311;&#x6218;</h1><p>&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;&#x5FAE;&#x4FE1;&#x4E3B;&#x8981;&#x7684;&#x6570;&#x636E;&#x5206;&#x6790;&#x573A;&#x666F;&#x5305;&#x542B;&#x4EE5;&#x4E0B;&#x51E0;&#x4E2A;&#x65B9;&#x9762;&#xFF1A;</p>
<p><strong>1.&#x79D1;&#x5B66;&#x63A2;&#x7D22;</strong>&#xFF1A;&#x670D;&#x52A1;&#x4E8E;&#x6570;&#x636E;&#x79D1;&#x5B66;&#x5BB6;&#xFF0C;&#x901A;&#x8FC7;&#x5373;&#x5E2D;&#x67E5;&#x8BE2;&#x505A;&#x4E1A;&#x52A1;&#x4E0A;&#x7684;&#x5F52;&#x56E0;&#x63A8;&#x65AD;&#xFF1B;</p>
<p><strong>2.&#x770B;&#x677F;</strong>&#xFF1A;&#x670D;&#x52A1;&#x4E8E;&#x8FD0;&#x8425;&#x548C;&#x7BA1;&#x7406;&#x5C42;&#xFF0C;&#x5C55;&#x793A;&#x6240;&#x5173;&#x6CE8;&#x7684;&#x6838;&#x5FC3;&#x6307;&#x6807;&#xFF1B;</p>
<p><strong>3.A/B &#x5B9E;&#x9A8C;&#x5E73;&#x53F0;</strong>&#xFF1A;&#x670D;&#x52A1;&#x4E8E;&#x7B97;&#x6CD5;&#x5DE5;&#x7A0B;&#x5E08;&#xFF0C;&#x628A;&#x65B0;&#x7684;&#x6A21;&#x578B;&#xFF0C;&#x653E;&#x5728;A/B&#x5B9E;&#x9A8C;&#x5E73;&#x53F0;&#x4E0A;&#x505A;&#x5047;&#x8BBE;&#x68C0;&#x9A8C;&#xFF0C;&#x770B;&#x6A21;&#x578B;&#x662F;&#x5426;&#x7B26;&#x5408;&#x9884;&#x671F;&#x3002;</p>
<p>&#x9664;&#x6B64;&#x4EE5;&#x5916;&#xFF0C;&#x8FD8;&#x6709;&#x5B9E;&#x65F6;&#x76D1;&#x63A7;&#x3001;&#x65E5;&#x5FD7;&#x7CFB;&#x7EDF;&#x660E;&#x7EC6;&#x67E5;&#x8BE2;&#x7B49;&#x573A;&#x666F;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/3a1dce87fce90f26a0e80f11a7738e822382dca608bfc63b30fccda6dbec8bac" alt="&#x56FE;&#x7247;"></p>
<p>&#x5728;&#x6240;&#x6709;&#x7684;&#x573A;&#x666F;&#x5F53;&#x4E2D;&#xFF0C;&#x4F7F;&#x7528;&#x8005;&#x90FD;&#x6709;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#x8BC9;&#x6C42;&#x2014;&#x2014;&#x5FEB;&#xFF1A;&#x5E0C;&#x671B;&#x67E5;&#x8BE2;&#x54CD;&#x5E94;&#x66F4;&#x5FEB;&#xFF0C;&#x6307;&#x6807;&#x5F00;&#x53D1;&#x66F4;&#x5FEB;&#x5B8C;&#x6210;&#xFF0C;&#x770B;&#x677F;&#x66F4;&#x65B0;&#x66F4;&#x53CA;&#x65F6;&#x3002;&#x4E0E;&#x6B64;&#x540C;&#x65F6;&#xFF0C;&#x5FAE;&#x4FE1;&#x9762;&#x4E34;&#x7684;&#x662F;&#x6D77;&#x91CF;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x4E1A;&#x52A1;&#x573A;&#x666F;&#x4E2D;&#x201C;&#x5355;&#x8868;&#x65E5;&#x589E;&#x4E07;&#x4EBF;&#x201D;&#x5F88;&#x5E38;&#x89C1;&#xFF0C;&#x8FD9;&#x5C31;&#x5BF9;&#x4E0B;&#x4E00;&#x4EE3;&#x201C;&#x6570;&#x636E;&#x5206;&#x6790;&#x7CFB;&#x7EDF;&#x201D;&#x63D0;&#x51FA;&#x65B0;&#x7684;&#x6311;&#x6218;&#x3002;</p>
<p>&#x5728;&#x4F7F;&#x7528;ClickHouse&#x4E4B;&#x524D;&#xFF0C;&#x5FAE;&#x4FE1;&#x4F7F;&#x7528;&#x7684;&#x662F;Hadoop&#x751F;&#x6001;&#x4E3A;&#x4E3B;&#x7684;&#x6570;&#x4ED3;&#xFF0C;&#x5B58;&#x5728;&#x4EE5;&#x4E0B;&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#xFF1A;</p>
<p><strong>1.&#x54CD;&#x5E94;&#x6162;</strong>&#xFF0C;&#x57FA;&#x672C;&#x4E0A;&#x662F;&#x5206;&#x949F;&#x7EA7;&#xFF0C;&#x53EF;&#x80FD;&#x5230;&#x5C0F;&#x65F6;&#xFF0C;&#x5BFC;&#x81F4;&#x51B3;&#x7B56;&#x8FC7;&#x7A0B;&#x957F;&#xFF1B;</p>
<p><strong>2.&#x5F00;&#x53D1;&#x6162;</strong>&#xFF0C;&#x7531;&#x4E8E;&#x4F20;&#x7EDF;&#x7684;&#x6570;&#x4ED3;&#x7406;&#x5FF5;&#x7684;&#x591A;&#x5C42;&#x67B6;&#x6784;&#xFF0C;&#x4F7F;&#x5F97;&#x66F4;&#x65B0;&#x4E00;&#x4E2A;&#x6307;&#x6807;&#x7684;&#x6210;&#x672C;&#x5F88;&#x9AD8;&#xFF1B;</p>
<p><strong>3.&#x67B6;&#x6784;&#x81C3;&#x80BF;</strong>&#xFF0C;&#x5728;&#x5FAE;&#x4FE1;&#x4E1A;&#x52A1;&#x4F53;&#x91CF;&#x89C4;&#x6A21;&#x7684;&#x6570;&#x636E;&#x4E0B;&#xFF0C;&#x4F20;&#x7EDF;&#x67B6;&#x6784;&#x5F88;&#x96BE;&#x505A;&#x5230;&#x6D41;&#x6279;&#x4E00;&#x4F53;&#x3002;&#x8FDB;&#x800C;&#x5BFC;&#x81F4;&#xFF0C;&#x4EE3;&#x7801;&#x9700;&#x8981;&#x5199;&#x591A;&#x5957;&#x3001;&#x6570;&#x636E;&#x7ED3;&#x679C;&#x96BE;&#x4EE5;&#x5BF9;&#x9F50;&#x3001;&#x5B58;&#x50A8;&#x5197;&#x4F59;&#x3002;&#x7ECF;&#x8FC7;&#x5341;&#x51E0;&#x5E74;&#x7684;&#x53D1;&#x5C55;&#x4E4B;&#x540E;&#xFF0C;&#x4F20;&#x7EDF;&#x7684;Hadoop&#x751F;&#x6001;&#x7684;&#x67B6;&#x6784;&#x53D8;&#x5F97;&#x975E;&#x5E38;&#x81C3;&#x80BF;&#xFF0C;&#x7EF4;&#x62A4;&#x96BE;&#x5EA6;&#x548C;&#x6210;&#x672C;&#x90FD;&#x5F88;&#x5927;&#x3002;</p>
<p>&#x6240;&#x4EE5;&#xFF0C;&#x5FAE;&#x4FE1;&#x4E00;&#x76F4;&#x5728;&#x5BFB;&#x6C42;&#x66F4;&#x8F7B;&#x91CF;&#x3001;&#x7B80;&#x5355;&#x654F;&#x6377;&#x7684;&#x65B9;&#x6848;&#x6765;&#x89E3;&#x51B3;&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#x3002;&#x7ECF;&#x8FC7;&#x4E00;&#x756A;&#x8C03;&#x7814;&#xFF0C;&#x5728;&#x767E;&#x82B1;&#x9F50;&#x653E;&#x7684;OLAP&#x4EA7;&#x54C1;&#x4E2D;&#xFF0C;&#x6700;&#x7EC8;&#x9009;&#x5B9A;&#x4E86;ClickHouse&#x4F5C;&#x4E3A;&#x5FAE;&#x4FE1;OLAP&#x7684;&#x4E3B;&#x8981;&#x6838;&#x5FC3;&#x5F15;&#x64CE;&#x3002;&#x4E3B;&#x8981;&#x6709;&#x4E24;&#x4E2A;&#x539F;&#x56E0;&#xFF1A;</p>
<p><strong>1.&#x6548;&#x7387;</strong>&#xFF1A;&#x5728;&#x771F;&#x5B9E;&#x6570;&#x636E;&#x7684;&#x5B9E;&#x9A8C;&#x573A;&#x666F;&#x4E0B;&#xFF0C;ClickHouse&#x8981;&#x6BD4;Hadoop&#x751F;&#x6001;&#x5FEB;10&#x500D;&#x4EE5;&#x4E0A;(2020&#x5E74;&#x5E95;&#x6D4B;&#x8BD5;)&#xFF1B;</p>
<p><strong>2.&#x5F00;&#x6E90;</strong>&#xFF1A;&#x5FAE;&#x4FE1;&#x7684;A/B&#x5B9E;&#x9A8C;&#x3001;&#x7EBF;&#x4E0A;&#x7279;&#x5F81;&#x7B49;&#x573A;&#x666F;&#x4F1A;&#x6709;&#x4E9B;&#x4E2A;&#x6027;&#x5316;&#x9700;&#x6C42;&#xFF0C;&#x9700;&#x8981;&#x5BF9;&#x5F15;&#x64CE;&#x5185;&#x6838;&#x505A;&#x8F83;&#x591A;&#x6539;&#x52A8;&#xFF1B;</p>
<p>&#x56E0;&#x6B64;&#xFF0C;&#x5FAE;&#x4FE1;&#x5C1D;&#x8BD5;&#x5728;OLAP&#x573A;&#x666F;&#x4E0B;&#xFF0C;&#x6784;&#x5EFA;&#x57FA;&#x4E8E;ClickHouse&#x8BA1;&#x7B97;&#x5B58;&#x50A8;&#x4E3A;&#x6838;&#x5FC3;&#x7684;&#x201C;&#x6279;&#x6D41;&#x4E00;&#x4F53;&#x201D;&#x6570;&#x4ED3;&#x3002;</p>
<p>&#x4F46;&#x662F;&#xFF0C;&#x4F7F;&#x7528;&#x539F;&#x751F;&#x7684;ClickHouse&#xFF0C;&#x5728;&#x771F;&#x6B63;&#x653E;&#x91CF;&#x9636;&#x6BB5;&#x51FA;&#x73B0;&#x4E86;&#x5F88;&#x591A;&#x95EE;&#x9898;&#xFF1A;</p>
<p><strong>1.&#x7A33;&#x5B9A;&#x6027;</strong>&#xFF1A;ClickHouse&#x7684;&#x539F;&#x59CB;&#x7A33;&#x5B9A;&#x6027;&#x5E76;&#x4E0D;&#x597D;&#xFF0C;&#x6BD4;&#x5982;&#x8BF4;&#xFF1A;&#x5728;&#x9AD8;&#x9891;&#x5199;&#x5165;&#x7684;&#x573A;&#x666F;&#x4E0B;&#x7ECF;&#x5E38;&#x4F1A;&#x51FA;&#x73B0;too many part&#x7B49;&#x95EE;&#x9898;&#xFF0C;&#x6574;&#x4E2A;&#x96C6;&#x7FA4;&#x88AB;&#x4E00;&#x4E2A;&#x6162;&#x67E5;&#x8BE2;&#x62D6;&#x6B7B;&#xFF0C;&#x8282;&#x70B9;OOM&#x3001;DDL&#x8BF7;&#x6C42;&#x5361;&#x6B7B;&#x90FD;&#x6BD4;&#x8F83;&#x5E38;&#x89C1;&#x3002;&#x53E6;&#x5916;&#xFF0C;&#x7531;&#x4E8E;ClickHouse&#x539F;&#x59CB;&#x8BBE;&#x8BA1;&#x7F3A;&#x9677;&#xFF0C;&#x968F;&#x6570;&#x636E;&#x589E;&#x957F;&#x7684;&#x4F9D;&#x8D56;&#x7684;zookeeper&#x74F6;&#x9888;&#x4E00;&#x76F4;&#x5B58;&#x5728;&#xFF0C;&#x65E0;&#x6CD5;&#x5F88;&#x597D;&#x89E3;&#x51B3;&#xFF1B;&#x5FAE;&#x4FE1;&#x540E;&#x671F;&#x8FDB;&#x884C;&#x591A;&#x6B21;&#x5185;&#x6838;&#x6539;&#x52A8;&#xFF0C;&#x624D;&#x4F7F;&#x5F97;&#x5B83;&#x5728;&#x6D77;&#x91CF;&#x6570;&#x636E;&#x4E0B;&#x9010;&#x6B65;&#x7A33;&#x5B9A;&#x4E0B;&#x6765;&#xFF0C;&#x90E8;&#x5206;issue&#x4E5F;&#x8D21;&#x732E;&#x7ED9;&#x4E86;&#x793E;&#x533A;&#x3002;</p>
<p><strong>2.&#x4F7F;&#x7528;&#x95E8;&#x69DB;&#x8F83;&#x9AD8;</strong>&#xFF1A;&#x4F1A;&#x7528;ClickHouse&#x7684;&#xFF0C;&#x8DDF;&#x4E0D;&#x4F1A;&#x7528;ClickHouse&#x7684;&#xFF0C;&#x5176;&#x642D;&#x5EFA;&#x7684;&#x7CFB;&#x7EDF;&#x4E1A;&#x52A1;&#x6027;&#x80FD;&#x53EF;&#x80FD;&#x8981;&#x5DEE;3&#x500D;&#x751A;&#x81F3;10&#x500D;&#xFF0C;&#x6709;&#x4E9B;&#x573A;&#x666F;&#x66F4;&#x9700;&#x8981;&#x9488;&#x5BF9;&#x6027;&#x5BF9;&#x5185;&#x6838;&#x4F18;&#x5316;&#x3002;</p>
<h1 id="&#x4E8C;&#x3001;&#x5FAE;&#x4FE1;&#x548C;&#x817E;&#x8BAF;&#x4E91;&#x6570;&#x636E;&#x4ED3;&#x5E93;&#x5171;&#x5EFA;"><a href="#&#x4E8C;&#x3001;&#x5FAE;&#x4FE1;&#x548C;&#x817E;&#x8BAF;&#x4E91;&#x6570;&#x636E;&#x4ED3;&#x5E93;&#x5171;&#x5EFA;" class="headerlink" title="&#x4E8C;&#x3001;&#x5FAE;&#x4FE1;&#x548C;&#x817E;&#x8BAF;&#x4E91;&#x6570;&#x636E;&#x4ED3;&#x5E93;&#x5171;&#x5EFA;"></a>&#x4E8C;&#x3001;&#x5FAE;&#x4FE1;&#x548C;&#x817E;&#x8BAF;&#x4E91;&#x6570;&#x636E;&#x4ED3;&#x5E93;&#x5171;&#x5EFA;</h1><p>&#x6B64;&#x65F6;&#xFF0C;&#x817E;&#x8BAF;&#x4E91;&#x6570;&#x636E;&#x4ED3;&#x5E93;Clickhouse&#x56E2;&#x961F;&#x79EF;&#x6781;&#x6DF1;&#x5165;&#x4E1A;&#x52A1;&#xFF0C;&#x4E3B;&#x52A8;&#x4E0E;&#x5FAE;&#x4FE1;&#x56E2;&#x961F;&#x5408;&#x4F5C;&#xFF0C;&#x53CC;&#x65B9;&#x5F00;&#x59CB;&#x5171;&#x540C;&#x89E3;&#x51B3;&#x4E0A;&#x8FF0;&#x95EE;&#x9898;&#x3002;&#x817E;&#x8BAF;&#x4E91;&#x6570;&#x636E;&#x4ED3;&#x5E93;Clickhouse&#x63D0;&#x4F9B;&#x5168;&#x6258;&#x7BA1;&#x4E00;&#x7AD9;&#x5F0F;&#x7684;&#x5168;&#x9762;&#x670D;&#x52A1;&#xFF0C;&#x4F7F;&#x5F97;&#x5FAE;&#x4FE1;&#x56E2;&#x961F;&#x4E0D;&#x9700;&#x8981;&#x8FC7;&#x591A;&#x5173;&#x6CE8;&#x7A33;&#x5B9A;&#x6027;&#x95EE;&#x9898;&#x3002;&#x53E6;&#x5916;&#xFF0C;&#x53CC;&#x65B9;&#x56E2;&#x961F;&#x79EF;&#x7D2F;&#x4E86;&#x4E30;&#x5BCC;&#x67E5;&#x8BE2;&#x4F18;&#x5316;&#x7ECF;&#x9A8C;&#xFF0C;&#x5171;&#x4EAB;&#x7ECF;&#x9A8C;&#x66F4;&#x6709;&#x5229;&#x4E8E;Clickhouse&#x6027;&#x80FD;&#x6781;&#x81F4;&#x63D0;&#x5347;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/a15b594db35b54fbbcfe999822e0411ad2f1d4c70a4c121e205d0e909ccdc5be" alt="&#x56FE;&#x7247;"></p>
<p>&#x5FAE;&#x4FE1;&#x8DDF;&#x817E;&#x8BAF;&#x4E91;&#x6570;&#x636E;&#x4ED3;&#x5E93;Clickhouse&#x7684;&#x5408;&#x4F5C;&#xFF0C;&#x4ECE;&#x4ECA;&#x5E74;3&#x6708;&#x4EFD;&#x5F00;&#x59CB;&#xFF0C;&#x5728;&#x9A8C;&#x8BC1;&#x671F;&#x5C0F;&#x89C4;&#x6A21;&#x8BD5;&#x7528;ClickHouse&#x540E;&#xFF0C;&#x4E1A;&#x52A1;&#x4E00;&#x76F4;&#x5728;&#x5FEB;&#x901F;&#x589E;&#x957F;&#xFF0C;&#x53CC;&#x65B9;&#x5F00;&#x59CB;&#x5171;&#x5EFA;&#x8FDB;&#x884C;&#x7A33;&#x5B9A;&#x6027;&#x548C;&#x6027;&#x80FD;&#x4E0A;&#x7684;&#x4F18;&#x5316;&#x3002;&#x4E3B;&#x8981;&#x505A;&#x4E86;&#x4E24;&#x4EF6;&#x4E8B;&#xFF1A;&#x4E00;&#x4E2A;&#x662F;&#x5EFA;&#x7ACB;&#x4E86;&#x6574;&#x4E2A;ClickHouse OLAP&#x7684;&#x751F;&#x6001;&#xFF0C;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x662F;&#x505A;&#x4E86;&#x7684;&#x63A2;&#x7D22;&#x51FA;&#x8D34;&#x8FD1;&#x4E1A;&#x52A1;&#x7684;&#x67E5;&#x8BE2;&#x4F18;&#x5316;&#x65B9;&#x6CD5;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/cd639302751ae52bf01732991221e9d852feecae7e73ca88b18159a91b4c2410" alt="&#x56FE;&#x7247;"></p>
<h1 id="&#x4E09;&#x3001;&#x5171;&#x5EFA;-ClickHouse-OLAP-&#x7684;&#x751F;&#x6001;"><a href="#&#x4E09;&#x3001;&#x5171;&#x5EFA;-ClickHouse-OLAP-&#x7684;&#x751F;&#x6001;" class="headerlink" title="&#x4E09;&#x3001;&#x5171;&#x5EFA; ClickHouse OLAP &#x7684;&#x751F;&#x6001;"></a>&#x4E09;&#x3001;&#x5171;&#x5EFA; ClickHouse OLAP &#x7684;&#x751F;&#x6001;</h1><p>&#x8981;&#x60F3;&#x6BD4;&#x8F83;&#x597D;&#x5730;&#x89E3;&#x51B3;ClickHouse&#x6613;&#x7528;&#x6027;&#x548C;&#x7A33;&#x5B9A;&#x6027;&#xFF0C;&#x9700;&#x8981;&#x751F;&#x6001;&#x652F;&#x6491;&#xFF0C;&#x6574;&#x4F53;&#x7684;&#x751F;&#x6001;&#x65B9;&#x6848;&#x6709;&#x4EE5;&#x4E0B;&#x51E0;&#x4E2A;&#x91CD;&#x8981;&#x7684;&#x90E8;&#x5206;&#xFF1A;</p>
<p><strong>1.QueryServer</strong>&#xFF1A;&#x6570;&#x636E;&#x7F51;&#x5173;&#xFF0C;&#x8D1F;&#x8D23;&#x667A;&#x80FD;&#x7F13;&#x5B58;&#xFF0C;&#x5927;&#x67E5;&#x8BE2;&#x62E6;&#x622A;&#xFF0C;&#x9650;&#x6D41;&#xFF1B;</p>
<p><strong>2.Sinker</strong>&#xFF1A;&#x79BB;&#x7EBF;/&#x5728;&#x7EBF;&#x9AD8;&#x6027;&#x80FD;&#x63A5;&#x5165;&#x5C42;&#xFF0C;&#x8D1F;&#x8D23;&#x524A;&#x5CF0;&#x3001;hash&#x8DEF;&#x7531;&#xFF0C;&#x6D41;&#x91CF;&#x4F18;&#x5148;&#x7EA7;&#xFF0C;&#x5199;&#x5165;&#x63A7;&#x9891;&#xFF1B;</p>
<p><strong>3.OP-Manager</strong>&#xFF1A;&#x8D1F;&#x8D23;&#x96C6;&#x7FA4;&#x7BA1;&#x7406;&#x3001;&#x6570;&#x636E;&#x5747;&#x8861;&#xFF0C;&#x5BB9;&#x707E;&#x5207;&#x6362;&#x3001;&#x6570;&#x636E;&#x8FC1;&#x79FB;&#xFF1B;</p>
<p><strong>4.Monitor</strong>&#xFF1A;&#x8D1F;&#x8D23;&#x76D1;&#x63A7;&#x62A5;&#x8B66;&#xFF0C;&#x4E9A;&#x5065;&#x5EB7;&#x68C0;&#x6D4B;&#xFF0C;&#x67E5;&#x8BE2;&#x5065;&#x5EB7;&#x5EA6;&#x5206;&#x6790;&#xFF0C;&#x53EF;&#x4E0E;Manager&#x8054;&#x52A8;&#xFF1B;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/2a88f2092d11c6d5b5f868729831f5c44f4da0266a1164330435b4806b7e2ed0" alt="&#x56FE;&#x7247;"></p>
<p>&#x5FAE;&#x4FE1;WeOLAPt&#x56E2;&#x961F;&#x548C;&#x817E;&#x8BAF;&#x4E91;&#x91CD;&#x70B9;&#x5728;&#x4EE5;&#x4E0B;&#x65B9;&#x9762;&#x8FDB;&#x884C;&#x4E86;&#x5408;&#x4F5C;&#x653B;&#x575A;&#xFF1A;</p>
<p><strong>1.&#x9AD8;&#x6027;&#x80FD;&#x63A5;&#x5165;</strong>&#xFF1A;&#x5FAE;&#x4FE1;&#x7684;&#x541E;&#x5410;&#x8FBE;&#x5230;&#x4E86;&#x5341;&#x4EBF;&#x7EA7;&#x522B;&#xFF0C;&#x5B9E;&#x65F6;&#x63A5;&#x5165;&#x65B9;&#x9762;&#xFF0C;&#x901A;&#x8FC7;&#x4EE4;&#x724C;&#x3001;&#x53CD;&#x538B;&#x7684;&#x65B9;&#x6848;&#xFF0C;&#x6BD4;&#x8F83;&#x597D;&#x5730;&#x89E3;&#x51B3;&#x4E86;&#x6D41;&#x91CF;&#x6D2A;&#x5CF0;&#x7684;&#x95EE;&#x9898;&#x3002;&#x53E6;&#x5916;&#x901A;&#x8FC7;Hash&#x8DEF;&#x7531;&#x63A5;&#x5165;&#xFF0C;&#x4F7F;&#x6570;&#x636E;&#x843D;&#x5730;&#x4E86;&#x4E4B;&#x540E;&#x53EF;&#x76F4;&#x63A5;&#x505A;Join&#xFF0C;&#x65E0;&#x9700;shuffle&#x5B9E;&#x73B0;&#x7684;&#x66F4;&#x5FEB;Join&#x67E5;&#x8BE2;&#xFF0C;&#x5728;&#x63A5;&#x5165;&#x4E0A;&#x4E5F;&#x5B9E;&#x73B0;&#x4E86;&#x7CBE;&#x786E;&#x4E00;&#x6B21;&#x3002;&#x79BB;&#x7EBF;&#x540C;&#x6B65;&#x65B9;&#x6848;&#x4E0A;&#xFF0C;&#x5FAE;&#x4FE1;&#x8DDF;&#x5927;&#x591A;&#x6570;&#x4E1A;&#x754C;&#x7684;&#x505A;&#x6CD5;&#x57FA;&#x672C;&#x4E0A;&#x4E00;&#x81F4;&#xFF0C;&#x5728;&#x901A;&#x8FC7;&#x9884;&#x6784;Merge&#x6210;&#x5EFA;&#x6210;Part&#xFF0C;&#x518D;&#x9001;&#x5230;&#x7EBF;&#x4E0A;&#x7684;&#x670D;&#x52A1;&#x8282;&#x70B9;&#xFF0C;&#x8FD9;&#x5176;&#x5B9E;&#x662F;&#x79CD;&#x8BFB;&#x5199;&#x5206;&#x79BB;&#x7684;&#x601D;&#x60F3;&#xFF0C;&#x66F4;&#x4FBF;&#x4E8E;&#x6EE1;&#x8DB3;&#x9AD8;&#x4E00;&#x81F4;&#x6027;&#x3001;&#x9AD8;&#x541E;&#x5410;&#x7684;&#x573A;&#x666F;&#x8981;&#x6C42;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/71193c44d7ed0a71c153718c5585d282a3f4e9b9668722a7f12c471281161421" alt="&#x56FE;&#x7247;"></p>
<p><strong>2.&#x6781;&#x81F4;&#x7684;&#x67E5;&#x8BE2;&#x4F18;&#x5316;</strong>&#xFF1A;ClickHouse&#x6574;&#x4E2A;&#x7684;&#x8BBE;&#x8BA1;&#x54F2;&#x5B66;&#xFF0C;&#x8981;&#x6C42;&#x5728;&#x7279;&#x5B9A;&#x7684;&#x573A;&#x666F;&#x4E0B;&#xFF0C;&#x91C7;&#x7528;&#x7279;&#x5B9A;&#x7684;&#x8BED;&#x6CD5;&#xFF0C;&#x624D;&#x80FD;&#x5F97;&#x5230;&#x6700;&#x6781;&#x81F4;&#x7684;&#x6027;&#x80FD;&#x3002;&#x4E3A;&#x89E3;&#x51B3;ClickHouse &#x4F7F;&#x7528;&#x95E8;&#x69DB;&#x9AD8;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x5FAE;&#x4FE1;&#x628A;&#x76F8;&#x5E94;&#x7684;&#x4F18;&#x5316;&#x7ECF;&#x9A8C;&#x843D;&#x5730;&#x5230;&#x5185;&#x90E8;BI&#x5E73;&#x53F0;&#x4E0A;&#xFF0C;&#x6C89;&#x6DC0;&#x5230;&#x5E73;&#x53F0;&#x540E;&#xFF0C;&#x4F7F;&#x5F97;&#x5C0F;&#x767D;&#x7528;&#x6237;&#x90FD;&#x53EF;&#x4EE5;&#x65B9;&#x4FBF;&#x4F7F;&#x7528;ClickHouse&#x3002;&#x901A;&#x8FC7;&#x4E00;&#x7CFB;&#x5217;&#x4F18;&#x5316;&#x624B;&#x6BB5;&#xFF0C;&#x5728;&#x76F4;&#x64AD;&#x3001;&#x89C6;&#x9891;&#x53F7;&#x7B49;&#x591A;&#x4E2A;Case&#x5B9E;&#x73B0;10&#x500D;&#x4EE5;&#x4E0A;&#x6027;&#x80FD;&#x63D0;&#x5347;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/c3b41199101695eb5c1dfcc399a60d8de2c69d5987dc0d79f654d87b1fd9c364" alt="&#x56FE;&#x7247;"></p>
<p>&#x57FA;&#x4E8E;&#x5171;&#x5EFA;&#x7684;ClickHouse&#x751F;&#x6001;&#xFF0C;&#x5728;&#x5FAE;&#x4FE1;&#x6709;&#x4EE5;&#x4E0B;&#x7684;&#x5178;&#x578B;&#x5E94;&#x7528;&#x573A;&#x666F;&#xFF1A;</p>
<p><strong>1.BI &#x5206;&#x6790;/&#x770B;&#x677F;</strong>&#xFF1A;&#x7531;&#x4E8E;&#x79D1;&#x5B66;&#x63A2;&#x7D22;&#x662F;&#x968F;&#x673A;&#x7684;&#xFF0C;&#x5F88;&#x96BE;&#x901A;&#x8FC7;&#x9884;&#x6784;&#x5EFA;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x89E3;&#x51B3;&#xFF0C;&#x4E4B;&#x524D;&#x7528;Hadoop&#x7684;&#x751F;&#x6001;&#x53EA;&#x80FD;&#x5B9E;&#x73B0;&#x5C0F;&#x65F6;&#x5230;&#x5206;&#x949F;&#x7684;&#x7EA7;&#x522B;&#x3002;&#x76EE;&#x524D;ClickHouse&#x4F18;&#x5316;&#x5B8C;&#x4E4B;&#x540E;&#xFF0C;&#x5728;&#x5355;&#x8868;&#x4E07;&#x4EBF;&#x7684;&#x6570;&#x636E;&#x91CF;&#x4E0B;&#xFF0C;&#x5927;&#x591A;&#x6570;&#x7684;&#x67E5;&#x8BE2;&#xFF0C;P95&#x5728;5&#x79D2;&#x4EE5;&#x5185;&#x3002;&#x6570;&#x636E;&#x79D1;&#x5B66;&#x5BB6;&#x73B0;&#x5728;&#x60F3;&#x505A;&#x4E00;&#x4E2A;&#x9A8C;&#x8BC1;&#xFF0C;&#x975E;&#x5E38;&#x5FEB;&#x5C31;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/d795d632d2367cd98e6aa3b419245ae954655248ab3139c41b8d95438f77052f" alt="&#x56FE;&#x7247;"></p>
<p><strong>2.A/B &#x5B9E;&#x9A8C;&#x5E73;&#x53F0;</strong>&#xFF1A;&#x65E9;&#x671F;&#x505A;A/B&#x5B9E;&#x9A8C;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x524D;&#x4E00;&#x5929;&#x665A;&#x4E0A;&#x8981;&#x628A;&#x6240;&#x6709;&#x7684;&#x5B9E;&#x9A8C;&#x7EDF;&#x8BA1;&#x7ED3;&#x679C;&#xFF0C;&#x9884;&#x5148;&#x805A;&#x5408;&#x597D;&#xFF0C;&#x7B2C;&#x4E8C;&#x5929;&#x624D;&#x80FD;&#x67E5;&#x8BE2;&#x5B9E;&#x9A8C;&#x7ED3;&#x679C;&#x3002;&#x5728;&#x5355;&#x8868;&#x6570;&#x636E;&#x91CF;&#x7EA7;&#x5343;&#x4EBF;/&#x5929;&#x3001;&#x5927;&#x8868;&#x5B9E;&#x65F6;Join&#x7684;&#x573A;&#x666F;&#x4E0B;&#xFF0C;&#x5FAE;&#x4FE1;&#x524D;&#x540E;&#x7ECF;&#x5386;&#x4E86;&#x51E0;&#x4E2A;&#x65B9;&#x6848;&#xFF0C;&#x5B9E;&#x73B0;&#x4E86;&#x8FD1;50&#x500D;&#x7684;&#x6027;&#x80FD;&#x63D0;&#x5347;&#x3002;&#x4ECE;&#x79BB;&#x7EBF;&#x5230;&#x5B9E;&#x65F6;&#x5206;&#x6790;&#x7684;&#x98DE;&#x8DC3;&#xFF0C;&#x4F7F;&#x5F97;P95&#x54CD;&#x5E94;&lt;3S&#xFF0C;A/B&#x5B9E;&#x9A8C;&#x7ED3;&#x8BBA;&#x66F4;&#x52A0;&#x51C6;&#x786E;&#xFF0C;&#x5B9E;&#x9A8C;&#x5468;&#x671F;&#x66F4;&#x77ED;&#xFF0C;&#x6A21;&#x578B;&#x9A8C;&#x8BC1;&#x66F4;&#x5FEB;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/3645008dff8b8acc1a14de357d5c3cd8cdf34fefd7625e2673c6c65f6ae73951" alt="&#x56FE;&#x7247;"></p>
<p><strong>3.&#x5B9E;&#x65F6;&#x7279;&#x5F81;&#x8BA1;&#x7B97;</strong>&#xFF1A;&#x867D;&#x7136;&#x5927;&#x5BB6;&#x666E;&#x904D;&#x8BA4;&#x4E3A;ClickHouse&#x4E0D;&#x592A;&#x64C5;&#x957F;&#x89E3;&#x51B3;&#x5B9E;&#x65F6;&#x76F8;&#x5173;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x4F46;&#x6700;&#x7EC8;&#x901A;&#x8FC7;&#x4F18;&#x5316;&#xFF0C;&#x53EF;&#x4EE5;&#x505A;&#x5230;&#x626B;&#x63CF;&#x91CF;&#x6570;&#x5341;&#x4EBF;&#xFF0C;&#x5168;&#x94FE;&#x8DEF;&#x65F6;&#x5EF6;&lt;3&#x79D2;&#xFF0C;P95&#x54CD;&#x5E94;&#x8FD1;1&#x79D2;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/5272bc314784a693e1142ae108b127433f2bce02cb8e52b8f2ffc85765d7b8a4" alt="&#x56FE;&#x7247;"></p>
<h1 id="&#x56DB;&#x3001;&#x6027;&#x80FD;&#x7684;&#x663E;&#x8457;&#x63D0;&#x5347;"><a href="#&#x56DB;&#x3001;&#x6027;&#x80FD;&#x7684;&#x663E;&#x8457;&#x63D0;&#x5347;" class="headerlink" title="&#x56DB;&#x3001;&#x6027;&#x80FD;&#x7684;&#x663E;&#x8457;&#x63D0;&#x5347;"></a>&#x56DB;&#x3001;&#x6027;&#x80FD;&#x7684;&#x663E;&#x8457;&#x63D0;&#x5347;</h1><p>&#x76EE;&#x524D;&#xFF0C;&#x5FAE;&#x4FE1;&#x5F53;&#x524D;&#x89C4;&#x6A21;&#x5343;&#x53F0;&#xFF0C;&#x6570;&#x636E;&#x91CF;PB&#x7EA7;&#xFF0C;&#x6BCF;&#x5929;&#x7684;&#x67E5;&#x8BE2;&#x91CF;&#x4E0A;&#x767E;&#x4E07;&#xFF0C;&#x5355;&#x96C6;&#x7FA4;TPS&#x8FBE;&#x5230;&#x4E86;&#x4EBF;&#x7EA7;&#xFF0C;&#x800C;&#x67E5;&#x8BE2;&#x8017;&#x65F6;&#x5747;&#x503C;&#x4EC5;&#x9700;&#x79D2;&#x7EA7;&#x8FD4;&#x56DE;&#x3002;ClickHouse OLAP&#x7684;&#x751F;&#x6001;&#x76F8;&#x5BF9;&#x4E8E;&#x4E4B;&#x524D;&#x7684;Hadoop&#x751F;&#x6001;&#xFF0C;&#x6027;&#x80FD;&#x63D0;&#x5347;&#x4E86;10&#x500D;&#x4EE5;&#x4E0A;&#xFF0C;&#x901A;&#x8FC7;&#x6D41;&#x6279;&#x4E00;&#x4F53;&#x63D0;&#x4F9B;&#x66F4;&#x7A33;&#x5B9A;&#x53EF;&#x9760;&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x4F7F;&#x5F97;&#x4E1A;&#x52A1;&#x51B3;&#x7B56;&#x66F4;&#x8FC5;&#x901F;&#xFF0C;&#x5B9E;&#x9A8C;&#x7ED3;&#x8BBA;&#x66F4;&#x51C6;&#x786E;&#x3002;</p>
<h1 id="&#x4E94;&#x3001;&#x5171;&#x5EFA;&#x5B58;&#x7B97;&#x5206;&#x79BB;&#x7684;&#x4E91;&#x539F;&#x751F;&#x6570;&#x4ED3;"><a href="#&#x4E94;&#x3001;&#x5171;&#x5EFA;&#x5B58;&#x7B97;&#x5206;&#x79BB;&#x7684;&#x4E91;&#x539F;&#x751F;&#x6570;&#x4ED3;" class="headerlink" title="&#x4E94;&#x3001;&#x5171;&#x5EFA;&#x5B58;&#x7B97;&#x5206;&#x79BB;&#x7684;&#x4E91;&#x539F;&#x751F;&#x6570;&#x4ED3;"></a>&#x4E94;&#x3001;&#x5171;&#x5EFA;&#x5B58;&#x7B97;&#x5206;&#x79BB;&#x7684;&#x4E91;&#x539F;&#x751F;&#x6570;&#x4ED3;</h1><p>ClickHouse&#x539F;&#x59CB;&#x7684;&#x8BBE;&#x8BA1;&#x548C;Shard-Nothing&#x7684;&#x67B6;&#x6784;&#xFF0C;&#x65E0;&#x6CD5;&#x5F88;&#x597D;&#x5730;&#x5B9E;&#x73B0;&#x79D2;&#x7EA7;&#x4F38;&#x7F29;&#x4E0E;Join&#x7684;&#x573A;&#x666F;&#xFF1B;&#x56E0;&#x6B64;&#x4E0B;&#x4E00;&#x4E2A;&#x5FAE;&#x4FE1;&#x548C;&#x817E;&#x8BAF;&#x4E91;&#x6570;&#x636E;&#x4ED3;&#x5E93;ClickHouse&#x7684;&#x5171;&#x5EFA;&#x76EE;&#x6807;&#xFF0C;&#x662F;&#x5B9E;&#x73B0;&#x5B58;&#x7B97;&#x5206;&#x79BB;&#x7684;&#x4E91;&#x539F;&#x751F;&#x6570;&#x4ED3;&#xFF1A;</p>
<p><strong>1.&#x5F39;&#x6027;&#x6269;&#x5BB9;</strong>&#xFF1A;&#x79D2;&#x7EA7;&#x5F39;&#x6027;&#x80FD;&#x529B;&#xFF0C;&#x7528;&#x6237;&#x53EA;&#x4E3A;&#x4F7F;&#x7528;&#x4ED8;&#x8D39;&#xFF0C;&#x5B9E;&#x73B0;&#x9AD8;&#x5CF0;&#x67E5;&#x8BE2;&#x66F4;&#x5FEB;&#xFF0C;&#x4F4E;&#x5CF0;&#x6210;&#x672C;&#x66F4;&#x7701;&#xFF1B;</p>
<p><strong>2.&#x7A33;&#x5B9A;&#x6027;</strong>&#xFF1A;&#x65E0; ZK &#x74F6;&#x9888;&#xFF0C;&#x8BFB;&#x5199;&#x6613;&#x5206;&#x79BB;&#xFF0C;&#x5F02;&#x5730;&#x5BB9;&#x707E;&#xFF1B;</p>
<p><strong>3.&#x6613;&#x8FD0;&#x7EF4;</strong>&#xFF1A;&#x6570;&#x636E;&#x5BB9;&#x6613;&#x5747;&#x8861;&#xFF0C;&#x5B58;&#x50A8;&#x65E0;&#x72B6;&#x6001;&#xFF1B;</p>
<p><strong>4.&#x529F;&#x80FD;&#x5168;</strong>&#xFF1A;&#x4E13;&#x6CE8;&#x4E8E;&#x67E5;&#x8BE2;&#x4F18;&#x5316;&#x4E0E;Cache&#x7B56;&#x7565;&#x3001;&#x652F;&#x6301;&#x9AD8;&#x6548;&#x591A;&#x8868;Join&#xFF1B;</p>
<p>&#x5B58;&#x7B97;&#x5206;&#x79BB;&#x7684;&#x4E91;&#x539F;&#x751F;&#x6570;&#x4ED3;&#x80FD;&#x529B;&#xFF0C;&#x660E;&#x5E74;&#x5C06;&#x4F1A;&#x5728;&#x817E;&#x8BAF;&#x4E91;&#x5B98;&#x7F51;&#x4E0A;&#x7EBF;&#xFF0C;&#x656C;&#x8BF7;&#x671F;&#x5F85;&#xFF01;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/31cbf5ec5e05a59630e5fae91b29cddaa09c36ec2933840613f5f745375b8445" alt="&#x56FE;&#x7247;"></p>
<p>&#x672C;&#x6587;&#x7AE0;&#x7531;&#x5FAE;&#x4FE1;&#x6280;&#x672F;&#x67B6;&#x6784;&#x90E8;-WeOLAP&#x56E2;&#x961F;&#x51FA;&#x54C1;&#xFF0C;&#x300C;WeOLAP&#x300D;&#x4E13;&#x6CE8;&#x4E8E;&#x7528;&#x524D;&#x6CBF;&#x5927;&#x6570;&#x636E;&#x6280;&#x672F;&#x89E3;&#x51B3;&#x5FAE;&#x4FE1;&#x6D77;&#x91CF;&#x6570;&#x636E;&#x9AD8;&#x6027;&#x80FD;&#x67E5;&#x8BE2;&#x95EE;&#x9898;&#x3002;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/9709f80570422374a3a19b56c62bff64.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7034696294375358477.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7034696294375358477.html" itemprop="url">块存储监控与服务压测调优利器-EBS Lens发布 EBS监</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-11-26T10:15:12+08:00">
                2021-11-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x7B80;&#x4ECB;&#xFF1A;SLS&#x56E2;&#x961F;&#x8054;&#x5408;EBS&#x56E2;&#x961F;&#x53D1;&#x5E03;&#x4E86;EBS Lens&#xFF0C;&#x9488;&#x5BF9;&#x5757;&#x5B58;&#x50A8;&#x63D0;&#x4F9B;&#x6570;&#x636E;&#x5206;&#x6790;&#x3001;&#x8D44;&#x6E90;&#x76D1;&#x63A7;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x7528;&#x6237;&#x83B7;&#x53D6;&#x4E91;&#x4E0A;&#x5757;&#x5B58;&#x50A8;&#x8D44;&#x6E90;&#x4FE1;&#x606F;&#x4E0E;&#x6027;&#x80FD;&#x76D1;&#x63A7;&#x6570;&#x636E;&#x3001;&#x63D0;&#x5347;&#x4E91;&#x4E0A;&#x5757;&#x5B58;&#x50A8;&#x8D44;&#x6E90;&#x7684;&#x7BA1;&#x7406;&#x6548;&#x7387;&#x3001;&#x9AD8;&#x6548;&#x5206;&#x6790;&#x4E1A;&#x52A1;&#x6CE2;&#x52A8;&#x4E0E;&#x8D44;&#x6E90;&#x6027;&#x80FD;&#x6D88;&#x8017;&#x60C5;&#x51B5;&#x3002;</p>
<h1 id="EBS&#x76D1;&#x63A7;&#x73B0;&#x72B6;"><a href="#EBS&#x76D1;&#x63A7;&#x73B0;&#x72B6;" class="headerlink" title="EBS&#x76D1;&#x63A7;&#x73B0;&#x72B6;"></a>EBS&#x76D1;&#x63A7;&#x73B0;&#x72B6;</h1><p>&#x5757;&#x5B58;&#x50A8;&#x662F;&#x963F;&#x91CC;&#x4E91;&#x4E3A;&#x4E91;&#x670D;&#x52A1;&#x5668;ECS&#x63D0;&#x4F9B;&#x7684;&#x5757;&#x8BBE;&#x5907;&#x4EA7;&#x54C1;&#xFF0C;&#x5177;&#x6709;&#x9AD8;&#x6027;&#x80FD;&#x548C;&#x4F4E;&#x65F6;&#x5EF6;&#x7684;&#x7279;&#x70B9;&#x3002;&#x4E34;&#x8FD1;&#x53CC;&#x5341;&#x4E00;&#xFF0C;&#x5728;&#x5927;&#x4FC3;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x78C1;&#x76D8;IO&#x5F80;&#x5F80;&#x662F;&#x8FD0;&#x7EF4;&#x7684;&#x91CD;&#x70B9;&#xFF0C;&#x5982;&#x679C;&#x78C1;&#x76D8;&#x88AB;&#x6253;&#x7206;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x5173;&#x952E;&#x7684;&#x4E1A;&#x52A1;&#x53EF;&#x80FD;&#x4F1A;&#x505C;&#x6EDE;&#x751A;&#x81F3;&#x5D29;&#x6E83;&#x3002;EBS&#x76D1;&#x63A7;&#x76EE;&#x524D;&#x5B58;&#x5728;&#x51E0;&#x4E2A;&#x95EE;&#x9898;</p>
<ol>
<li>&#x5757;&#x5B58;&#x50A8;&#x63D0;&#x4F9B;&#x7684;&#x539F;&#x751F;&#x76D1;&#x63A7;&#x4EC5;&#x9650;&#x5236;&#x5728;&#x5355;&#x5B9E;&#x4F8B;&#x7EA7;&#x522B;&#xFF0C;&#x53EA;&#x80FD;&#x67E5;&#x770B;&#x5355;&#x4E2A;&#x4E91;&#x76D8;&#x7684;&#x6027;&#x80FD;&#x76D1;&#x63A7;&#xFF0C;&#x7F3A;&#x5C11;&#x5BF9;&#x5168;&#x5C40;&#x4E91;&#x76D8;&#x72B6;&#x6001;&#x7684;&#x76D1;&#x63A7;&#xFF0C;&#x5982;&#x679C;&#x4E91;&#x76D8;&#x6570;&#x91CF;&#x5F88;&#x591A;&#xFF0C;&#x90A3;&#x4E48;&#x4E91;&#x76D8;&#x72B6;&#x6001;&#x7684;&#x76D1;&#x63A7;&#x5C31;&#x975E;&#x5E38;&#x9EBB;&#x70E6;</li>
</ol>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/b1299034c90f8788e4196a1c0be29f7a07dc4763d9ac49be8eaf3c1990d4164f" alt></p>
<ol>
<li>&#x901A;&#x8FC7;SLS Logtail, Telegraf&#x6216;&#x8005;&#x4E91;&#x76D1;&#x63A7;agent&#x7B49;&#xFF0C;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x5BF9;&#x5355;&#x4E2A;ECS&#x5B9E;&#x4F8B;&#x6240;&#x6709;&#x4E91;&#x76D8;&#x7684;&#x72B6;&#x6001;&#x7684;&#x76D1;&#x63A7;&#x3002;&#x4F46;&#x662F;&#x8FD9;&#x4E9B;&#x76D1;&#x63A7;&#x65B9;&#x5F0F;&#x90FD;&#x662F;&#x4FB5;&#x5165;&#x5F0F;&#x7684;&#xFF0C;agent&#x7684;&#x5B89;&#x88C5;&#x3001;&#x76D1;&#x63A7;&#x5927;&#x76D8;&#x7684;&#x7EF4;&#x62A4;&#x3001;&#x4E91;&#x76D8;&#x5B9E;&#x4F8B;&#x76D1;&#x63A7;&#x7CBE;&#x7EC6;&#x5316;&#x63A7;&#x5236;&#x3001;&#x4EE5;&#x53CA;&#x8DE8;ECS&#x5B9E;&#x4F8B;&#x7684;&#x76D1;&#x63A7;&#xFF0C;&#x5BF9;&#x4E8E;&#x7528;&#x6237;&#x6765;&#x8BF4;&#xFF0C;&#x90FD;&#x6709;&#x5F88;&#x5927;&#x7684;&#x5B66;&#x4E60;&#x6210;&#x672C;&#x548C;&#x4EE3;&#x4EF7;</li>
<li>&#x5206;&#x6790;&#x7EF4;&#x5EA6;&#x5355;&#x4E00;&#xFF0C;&#x4EE5;&#x4E0A;&#x573A;&#x666F;&#x4E0B;&#xFF0C;&#x5BF9;&#x4E91;&#x76D8;&#x7684;&#x76D1;&#x63A7;&#x548C;&#x5206;&#x6790;&#x8FD8;&#x662F;&#x57FA;&#x4E8E;&#x4E91;&#x76D8;id&#x7684;&#xFF0C;&#x800C;&#x4E91;&#x76D8;&#x8D44;&#x4EA7;&#x672C;&#x8EAB;&#x7684;&#x5C5E;&#x6027;&#x4E5F;&#x5305;&#x542B;&#x5F88;&#x591A;&#x4FE1;&#x606F;&#x3002;&#x6BD4;&#x5982;&#x7528;&#x6237;&#x60F3;&#x770B;&#x5230;&#x4E00;&#x4E2A;&#x81EA;&#x5DF1;&#x6240;&#x6709;&#x4E91;&#x76D8;&#x8D44;&#x4EA7;&#x7684;&#x5927;&#x56FE;&#x3001;&#x5404;&#x4E2A;&#x5730;&#x57DF;&#x7684;&#x4E91;&#x76D8;&#x5206;&#x5E03;&#x3001;&#x5404;&#x4E2A;&#x4E91;&#x76D8;&#x7C7B;&#x578B;&#x7684;&#x6BD4;&#x4F8B;&#x7B49;&#x4FE1;&#x606F;&#xFF0C;&#x90FD;&#x662F;&#x5F88;&#x96BE;&#x505A;&#x5230;&#x7684;&#x3002;</li>
</ol>
<p>&#x6B63;&#x662F;&#x8003;&#x8651;&#x5230;&#x7528;&#x6237;&#x5BF9;EBS&#x76D1;&#x63A7;&#x7684;&#x4F7F;&#x7528;&#x6709;&#x5982;&#x4E0A;&#x7684;&#x75DB;&#x70B9;&#xFF0C;SLS&#x56E2;&#x961F;&#x8054;&#x5408;EBS&#x56E2;&#x961F;&#x53D1;&#x5E03;&#x4E86;EBS Lens(Lens, &#x900F;&#x955C;&#x7684;&#x610F;&#x601D;&#xFF0C;&#x53D6;&#x540D;&#x4E3A;Lens&#x610F;&#x5473;&#x7740;&#x6D1E;&#x5BDF;&#x4E91;&#x4EA7;&#x54C1;&#x7EC6;&#x5FAE;&#x7684;&#x53D8;&#x5316;)&#xFF0C;&#x9488;&#x5BF9;&#x5757;&#x5B58;&#x50A8;&#x63D0;&#x4F9B;&#x6570;&#x636E;&#x5206;&#x6790;&#x3001;&#x8D44;&#x6E90;&#x76D1;&#x63A7;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x7528;&#x6237;&#x83B7;&#x53D6;&#x4E91;&#x4E0A;&#x5757;&#x5B58;&#x50A8;&#x8D44;&#x6E90;&#x4FE1;&#x606F;&#x4E0E;&#x6027;&#x80FD;&#x76D1;&#x63A7;&#x6570;&#x636E;&#x3001;&#x63D0;&#x5347;&#x4E91;&#x4E0A;&#x5757;&#x5B58;&#x50A8;&#x8D44;&#x6E90;&#x7684;&#x7BA1;&#x7406;&#x6548;&#x7387;&#x3001;&#x9AD8;&#x6548;&#x5206;&#x6790;&#x4E1A;&#x52A1;&#x6CE2;&#x52A8;&#x4E0E;&#x8D44;&#x6E90;&#x6027;&#x80FD;&#x6D88;&#x8017;&#x60C5;&#x51B5;&#x3002;</p>
<h1 id="EBS-Lens&#x4EA7;&#x54C1;&#x7279;&#x70B9;"><a href="#EBS-Lens&#x4EA7;&#x54C1;&#x7279;&#x70B9;" class="headerlink" title="EBS Lens&#x4EA7;&#x54C1;&#x7279;&#x70B9;"></a>EBS Lens&#x4EA7;&#x54C1;&#x7279;&#x70B9;</h1><p><strong>&#x81EA;&#x52A8;&#x5316;&#x6570;&#x636E;&#x91C7;&#x96C6;</strong></p>
<p>EBS Lens&#x5F00;&#x542F;&#x540E;&#xFF0C;SLS&#x4F1A;&#x81EA;&#x52A8;&#x4ECE;&#x7528;&#x6237;&#x7684;EBS&#x8D44;&#x4EA7;&#x4E2D;&#x62C9;&#x53D6;&#x4E91;&#x76D8;&#x5217;&#x8868;&#x3002;&#x8FDB;&#x5165;APP&#x540E;&#x9996;&#x5148;&#x5C55;&#x793A;&#x7684;&#x5C31;&#x662F;&#x63A5;&#x5165;&#x7BA1;&#x7406;&#x9875;&#x9762;&#xFF0C;&#x5728;&#x8FD9;&#x4E2A;&#x9875;&#x9762;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;EBS&#x4E91;&#x76D8;&#x5168;&#x5C40;&#x7684;&#x4E00;&#x4E2A;&#x7BA1;&#x7406;&#x89C6;&#x56FE;&#xFF0C;&#x5305;&#x542B;&#x4EE5;&#x4E0B;&#x4FE1;&#x606F;&#xFF1A;</p>
<ul>
<li>&#x5C55;&#x793A;&#x5F53;&#x524D;&#x63A5;&#x5165;&#x7684;&#x4E91;&#x76D8;&#x603B;&#x91CF;&#x3001;&#x6570;&#x636E;&#x91C7;&#x96C6;&#x7684;&#x4E91;&#x76D8;&#x6570;&#x91CF;&#x3001;&#x4E91;&#x76D8;&#x7684;&#x5730;&#x57DF;&#x548C;&#x76EE;&#x6807;&#x5B58;&#x50A8;&#x5E93;&#x7684;&#x6570;&#x91CF;&#x3002;</li>
<li>&#x5C55;&#x793A;EBS&#x5B9E;&#x4F8B;&#x4FE1;&#x606F;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5B9E;&#x4F8B;ID&#x3001;&#x6807;&#x7B7E;&#x3001;&#x4E91;&#x76D8;&#x79CD;&#x7C7B;&#x3001;&#x4E91;&#x76D8;&#x7C7B;&#x578B;&#x3001;&#x53EF;&#x7528;&#x533A;&#x4FE1;&#x606F;&#x3001;&#x91C7;&#x96C6;&#x72B6;&#x6001;&#x3001;&#x91C7;&#x96C6;&#x64CD;&#x4F5C;&#x7B49;&#x4FE1;&#x606F;&#x3002;&#x5982;&#x679C;&#x7528;&#x6237;&#x5728;&#x5F00;&#x542F;EBS Lens&#x4E4B;&#x540E;&#xFF0C;&#x5BF9;EBS&#x4E91;&#x76D8;&#x6709;&#x65B0;&#x5EFA;&#x3001;&#x66F4;&#x65B0;&#x548C;&#x5220;&#x9664;&#x64CD;&#x4F5C;&#x7684;&#x8BDD;&#xFF0C;SLS&#x4F1A;&#x81EA;&#x52A8;&#x66F4;&#x65B0;&#x8FD9;&#x91CC;&#x7684;&#x4E91;&#x76D8;&#x5217;&#x8868;</li>
</ul>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/9be2d8763393b8d57e4360ec06f94b5a77ca679af5e817eac220dd4b0475859c" alt></p>
<p><strong>&#x91C7;&#x96C6;&#x914D;&#x7F6E;</strong></p>
<p>EBS&#x4E91;&#x76D8;&#x8D44;&#x4EA7;&#x540C;&#x6B65;&#x8FC7;&#x6765;&#x4E4B;&#x540E;&#xFF0C;&#x9700;&#x8981;&#x7528;&#x6237;&#x5F00;&#x542F;&#x4E91;&#x76D8;&#x8D44;&#x4EA7;&#x7684;&#x76D1;&#x63A7;&#x6570;&#x636E;&#x91C7;&#x96C6;&#x3002;&#x5728;&#x8FD9;&#x91CC;&#xFF0C;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;&#x4E24;&#x79CD;&#x91C7;&#x96C6;&#x65B9;&#x5F0F;&#xFF0C;&#x4E00;&#x79CD;&#x662F;&#x4F9B;&#x7528;&#x6237;&#x8FDB;&#x884C;&#x7CBE;&#x7EC6;&#x5316;&#x7BA1;&#x7406;&#x7684;&#x624B;&#x52A8;&#x91C7;&#x96C6;&#xFF0C;&#x8FD8;&#x6709;&#x4E00;&#x79CD;&#x662F;&#x5728;EBS&#x4E91;&#x76D8;&#x6570;&#x91CF;&#x8FC7;&#x591A;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x65B9;&#x4FBF;&#x7528;&#x6237;&#x5168;&#x5C40;&#x7BA1;&#x7406;&#x7684;&#x81EA;&#x52A8;&#x5316;&#x91C7;&#x96C6;&#x3002;</p>
<p><strong>&#x624B;&#x52A8;&#x91C7;&#x96C6;</strong></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/d7a664243443cf8bb5299bcbf301a83806c095aff3ef3d62f8723e35a42ec923" alt></p>
<ul>
<li>&#x652F;&#x6301;&#x5BF9;&#x5355;&#x4E2A;&#x5B9E;&#x4F8B;&#x7684;&#x91C7;&#x96C6;&#x72B6;&#x6001;&#x8FDB;&#x884C;&#x7BA1;&#x7406;</li>
<li>&#x8003;&#x8651;&#x5230;EBS&#x5B9E;&#x4F8B;&#x6570;&#x91CF;&#x4F1A;&#x6BD4;&#x8F83;&#x591A;&#xFF0C;&#x8FD9;&#x91CC;&#x652F;&#x6301;&#x5728;&#x5355;&#x4E2A;&#x5206;&#x9875;&#x4E0B;&#x9762;&#x8FDB;&#x884C;&#x6279;&#x91CF;&#x5F00;&#x542F;/&#x6279;&#x91CF;&#x5173;&#x95ED;&#x64CD;&#x4F5C;</li>
</ul>
<p><strong>&#x81EA;&#x52A8;&#x5316;&#x91C7;&#x96C6;</strong></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/60e1981fe45132bca0451d16c61d155101102a6c1cade902696bb02d1b95cf9f" alt></p>
<p>&#x5F53;&#x7528;&#x6237;&#x4E91;&#x76D8;&#x6709;&#x51E0;&#x767E;&#x751A;&#x81F3;&#x4E0A;&#x5343;&#x4E2A;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x624B;&#x52A8;&#x91C7;&#x96C6;&#x7684;&#x7BA1;&#x7406;&#x65B9;&#x5F0F;&#x663E;&#x7136;&#x4E0D;&#x80FD;&#x6EE1;&#x8DB3;&#x9700;&#x6C42;&#xFF0C;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x8FD8;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x81EA;&#x52A8;&#x5316;&#x91C7;&#x96C6;&#x7684;&#x529F;&#x80FD;&#x3002;&#x81EA;&#x52A8;&#x5316;&#x91C7;&#x96C6;&#x63D0;&#x4F9B;&#x4E86;&#x56FE;&#x5F62;&#x5316;&#x7684;&#x914D;&#x7F6E;&#x754C;&#x9762;:</p>
<ul>
<li>&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5730;&#x57DF;&#x3001;&#x5B9E;&#x4F8B;ID&#x3001;&#x4ED8;&#x8D39;&#x7C7B;&#x578B;&#x3001;&#x78C1;&#x76D8;&#x7C7B;&#x578B;&#x3001;&#x6807;&#x7B7E;&#x7B49;&#x5C5E;&#x6027;&#x8BBE;&#x7F6E;&#x91C7;&#x96C6;&#x6761;&#x4EF6;&#x3002;</li>
<li>&#x6807;&#x51C6;&#x6A21;&#x5F0F;&#x4E0B;&#x5404;&#x4E2A;&#x6761;&#x4EF6;&#x4E4B;&#x95F4;&#x4E3A;&#x4E14;&#x5173;&#x7CFB;&#x3002;&#x9AD8;&#x7EA7;&#x6A21;&#x5F0F;&#x4E0B;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x7075;&#x6D3B;&#x7EC4;&#x5408;&#x4E0E;&#x5D4C;&#x5957;&#x6761;&#x4EF6;&#x3002;</li>
</ul>
<p>&#x914D;&#x7F6E;&#x4FDD;&#x5B58;&#x4E4B;&#x540E;&#xFF0C;&#x81EA;&#x52A8;&#x5316;&#x91C7;&#x96C6;&#x7ACB;&#x523B;&#x5F00;&#x542F;&#x3002;&#x6240;&#x6709;&#x6EE1;&#x8DB3;&#x6761;&#x4EF6;&#x7684;&#x4E91;&#x76D8;&#xFF0C;&#x90FD;&#x4F1A;&#x81EA;&#x52A8;&#x6253;&#x5F00;&#x65E5;&#x5FD7;&#x91C7;&#x96C6;&#xFF0C;&#x4ECE;&#x800C;&#x7701;&#x53BB;&#x4E86;&#x624B;&#x52A8;&#x64CD;&#x4F5C;&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x53E6;&#x5916;&#x5F53;&#x5B9E;&#x4F8B;&#x6709;&#x6240;&#x589E;&#x51CF;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x81EA;&#x52A8;&#x5316;&#x91C7;&#x96C6;&#x4E5F;&#x80FD;&#x591F;&#x611F;&#x77E5;&#x5B9E;&#x4F8B;&#x7684;&#x53D8;&#x5316;&#xFF0C;&#x8FDB;&#x884C;&#x76F8;&#x5E94;&#x7684;&#x8C03;&#x6574;&#x3002;</p>
<h1 id="&#x5B58;&#x50A8;&#x5E93;&#x4FE1;&#x606F;&#x5C55;&#x793A;"><a href="#&#x5B58;&#x50A8;&#x5E93;&#x4FE1;&#x606F;&#x5C55;&#x793A;" class="headerlink" title="&#x5B58;&#x50A8;&#x5E93;&#x4FE1;&#x606F;&#x5C55;&#x793A;"></a>&#x5B58;&#x50A8;&#x5E93;&#x4FE1;&#x606F;&#x5C55;&#x793A;</h1><p>&#x5F00;&#x542F;&#x4E91;&#x76D8;&#x76D1;&#x63A7;&#x6570;&#x636E;&#x91C7;&#x96C6;&#x4E4B;&#x540E;&#xFF0C;SLS&#x4F1A;&#x4ECE;EBS&#x4E91;&#x76D8;&#x4E0A;&#x62C9;&#x53D6;&#x76D1;&#x63A7;&#x6570;&#x636E;&#xFF0C;&#x7136;&#x540E;&#x6295;&#x9012;&#x5230;&#x7528;&#x6237;&#x914D;&#x7F6E;&#x7684;&#x76EE;&#x6807;&#x5B58;&#x50A8;&#x5E93;&#x91CC;&#xFF0C;&#x4EE5;&#x65F6;&#x5E8F;&#x6570;&#x636E;&#x7684;&#x5F62;&#x5F0F;&#x8FDB;&#x884C;&#x5B58;&#x50A8;&#xFF0C;&#x5728;&#x76EE;&#x6807;&#x5B58;&#x50A8;&#x5E93;&#x8FD9;&#x4E2A;tab&#x91CC;&#xFF0C;&#x652F;&#x6301;&#x7684;&#x529F;&#x80FD;&#x6709;:</p>
<ul>
<li>&#x652F;&#x6301;&#x67E5;&#x770B;&#x5B58;&#x50A8;&#x76EE;&#x6807;&#x5E93;&#x7684;&#x5730;&#x57DF;&#x3001;&#x6570;&#x636E;&#x4FDD;&#x5B58;&#x65F6;&#x95F4;</li>
<li>&#x652F;&#x6301;&#x6570;&#x636E;&#x4FDD;&#x5B58;&#x65F6;&#x95F4;&#x7684;&#x8C03;&#x6574;</li>
</ul>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/a78d6adbd3a6f44143cbd2f76d0b47fd9f41f7cf304568463ea01728e40f578f" alt></p>
<ul>
<li>&#x70B9;&#x51FB;&#x76EE;&#x6807;&#x5E93;&#xFF0C;&#x53EF;&#x4EE5;&#x8FDB;&#x5165;SLS&#x7684;project&#x9875;&#x9762;&#xFF0C;&#x67E5;&#x770B;&#x539F;&#x59CB;&#x76D1;&#x63A7;&#x6570;&#x636E;</li>
</ul>
<p>EBS&#x4E91;&#x76D8;&#x8D44;&#x4EA7;&#x540C;&#x6B65;&#x3001;&#x65E5;&#x5FD7;&#x91C7;&#x96C6;&#x5F00;&#x542F;&#x4E4B;&#x540E;&#xFF0C;EBS Lens&#x5C31;&#x6709;&#x4E86;EBS&#x4E91;&#x76D8;&#x8D44;&#x4EA7;&#x548C;&#x4E91;&#x76D8;&#x7684;&#x76D1;&#x63A7;&#x6570;&#x636E;&#x4E86;&#xFF0C;&#x57FA;&#x4E8E;&#x8FD9;&#x4E24;&#x4E2A;&#x6570;&#x636E;&#xFF0C;EBS Lens&#x505A;&#x4E86;&#x4E24;&#x4E2A;&#x76D1;&#x63A7;&#x5927;&#x76D8;&#xFF0C;&#x8D44;&#x6E90;&#x6982;&#x89C8;&#x548C;&#x6027;&#x80FD;&#x5206;&#x6790;&#x9875;&#x9762;&#x3002;</p>
<h1 id="&#x591A;&#x7EF4;&#x5EA6;&#x6570;&#x636E;&#x805A;&#x5408;&#x4E0E;&#x4E30;&#x5BCC;&#x7684;&#x6570;&#x636E;&#x6307;&#x6807;&#x7C7B;&#x578B;"><a href="#&#x591A;&#x7EF4;&#x5EA6;&#x6570;&#x636E;&#x805A;&#x5408;&#x4E0E;&#x4E30;&#x5BCC;&#x7684;&#x6570;&#x636E;&#x6307;&#x6807;&#x7C7B;&#x578B;" class="headerlink" title="&#x591A;&#x7EF4;&#x5EA6;&#x6570;&#x636E;&#x805A;&#x5408;&#x4E0E;&#x4E30;&#x5BCC;&#x7684;&#x6570;&#x636E;&#x6307;&#x6807;&#x7C7B;&#x578B;"></a>&#x591A;&#x7EF4;&#x5EA6;&#x6570;&#x636E;&#x805A;&#x5408;&#x4E0E;&#x4E30;&#x5BCC;&#x7684;&#x6570;&#x636E;&#x6307;&#x6807;&#x7C7B;&#x578B;</h1><ul>
<li>&#x8D44;&#x6E90;&#x6982;&#x89C8;&#x9875;&#x9762;&#xFF0C;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x5168;&#x5C40;&#x7684;&#x8D44;&#x4EA7;&#x5927;&#x76D8;&#xFF0C;&#x9ED8;&#x8BA4;&#x6309;&#x7167;&#x7528;&#x6237;&#x7EF4;&#x5EA6;&#xFF0C;&#x63D0;&#x4F9B;&#x7528;&#x6237;&#x8D26;&#x53F7;&#x4E0B;&#x6240;&#x6709;&#x4E91;&#x76D8;&#x7684;&#x7EDF;&#x8BA1;&#x4FE1;&#x606F;&#xFF0C;&#x5305;&#x62EC;&#xFF1A;</li>
<li>&#x4E91;&#x76D8;&#x603B;&#x6570;&#x91CF;</li>
<li>&#x4E91;&#x76D8;&#x603B;&#x5BB9;&#x91CF;</li>
<li>&#x4E91;&#x76D8;&#x5B9E;&#x4F8B;&#x6240;&#x5C5E;&#x5730;&#x57DF;&#x4E2A;&#x6570;</li>
<li>&#x4E91;&#x76D8;&#x5B9E;&#x4F8B;&#x6240;&#x5C5E;&#x53EF;&#x7528;&#x533A;&#x4E2A;&#x6570;</li>
<li>&#x542F;&#x7528;&#x5FEB;&#x7167;&#x4E91;&#x76D8;&#x5360;&#x6BD4;</li>
<li>&#x52A0;&#x5BC6;&#x4E91;&#x76D8;&#x5360;&#x6BD4;</li>
<li>Top10&#x5BB9;&#x91CF;&#x7684;&#x533A;&#x57DF;</li>
<li>Top10&#x5BB9;&#x91CF;&#x7684;&#x53EF;&#x7528;&#x533A;</li>
<li>&#x4E91;&#x76D8;&#x7C7B;&#x578B;&#x5BB9;&#x91CF;&#x5206;&#x5E03;</li>
<li>&#x4ED8;&#x8D39;&#x7C7B;&#x578B;&#x5BB9;&#x91CF;&#x5206;&#x5E03;</li>
</ul>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/db112f256a1f92baec259bc882c9c45f37d7a15c3d88eabaa76b49ca6ddd0e57" alt></p>
<ul>
<li>&#x9664;&#x4E86;&#x8D26;&#x53F7;&#x7684;&#x7EF4;&#x5EA6;&#x5916;&#xFF0C;&#x8FD8;&#x652F;&#x6301;&#x5BF9;&#x5730;&#x57DF;&#x3001;&#x4ED8;&#x8D39;&#x7C7B;&#x578B;&#x3001;&#x78C1;&#x76D8;&#x7C7B;&#x578B;&#x8FDB;&#x884C;&#x7B5B;&#x9009;&#xFF0C;&#x5145;&#x5206;&#x6EE1;&#x8DB3;&#x7528;&#x6237;&#x7684;&#x5404;&#x79CD;&#x7EDF;&#x8BA1;&#x9700;&#x6C42;</li>
</ul>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/d4e88a7fd836e3c4a58fa1425f572c5427d4adc1a61de28258f7e77dd55e5c71" alt></p>
<h1 id="&#x9AD8;&#x7CBE;&#x5EA6;&#x7684;&#x6570;&#x636E;&#x76D1;&#x63A7;&#x7C92;&#x5EA6;"><a href="#&#x9AD8;&#x7CBE;&#x5EA6;&#x7684;&#x6570;&#x636E;&#x76D1;&#x63A7;&#x7C92;&#x5EA6;" class="headerlink" title="&#x9AD8;&#x7CBE;&#x5EA6;&#x7684;&#x6570;&#x636E;&#x76D1;&#x63A7;&#x7C92;&#x5EA6;"></a>&#x9AD8;&#x7CBE;&#x5EA6;&#x7684;&#x6570;&#x636E;&#x76D1;&#x63A7;&#x7C92;&#x5EA6;</h1><ul>
<li>&#x6027;&#x80FD;&#x5206;&#x6790;&#x9875;&#x9762;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x5168;&#x5C40;&#x7684;&#x4E91;&#x76D8;&#x76D1;&#x63A7;&#x5927;&#x76D8;&#xFF0C;&#x9ED8;&#x8BA4;&#x4F1A;&#x7EDF;&#x8BA1;&#x7528;&#x6237;&#x8D26;&#x53F7;&#x4E0B;&#x6240;&#x6709;&#x78C1;&#x76D8;&#x5173;&#x952E;&#x6307;&#x6807;&#x7684;&#x76D1;&#x63A7;&#xFF0C;&#x5305;&#x62EC;</li>
<li>&#x541E;&#x5410;&#x91CF;</li>
<li>&#x603B;&#x7684;&#x541E;&#x5410;&#x91CF;&#x53D8;&#x5316;&#x66F2;&#x7EBF;</li>
<li>&#x8BFB;/&#x5199;&#x541E;&#x5410;&#x5B58;&#x50A8;Top100&#x7684;&#x5B9E;&#x4F8B;&#xFF0C;&#x4EE5;&#x53CA;&#x541E;&#x5410;&#x53D8;&#x5316;&#x66F2;&#x7EBF;</li>
<li>IOPS</li>
<li>&#x603B;&#x7684;IOPS&#x53D8;&#x5316;&#x66F2;&#x7EBF;</li>
<li>&#x8BFB;&#x5199;IOPS Top100&#x7684;&#x5B9E;&#x4F8B;&#xFF0C;&#x4EE5;&#x53CA;IOPS&#x53D8;&#x5316;&#x66F2;&#x7EBF;</li>
<li>&#x6027;&#x80FD;&#x5206;&#x6790;&#x9875;&#x9762;&#x8FD8;&#x652F;&#x6301;&#x5BF9;&#x5730;&#x57DF;&#x3001;&#x4ED8;&#x8D39;&#x7C7B;&#x578B;&#x3001;&#x4E91;&#x76D8;&#x7C7B;&#x578B;&#x3001;&#x4E91;&#x76D8;id&#x8FDB;&#x884C;&#x7B5B;&#x9009;&#xFF0C;&#x6EE1;&#x8DB3;&#x7528;&#x6237;&#x7CBE;&#x7EC6;&#x5316;&#x76D1;&#x63A7;&#x7684;&#x9700;&#x6C42;</li>
<li>&#x4E91;&#x76D8;&#x76D1;&#x63A7;&#x7C92;&#x5EA6;&#x4E3A;10s&#xFF0C;&#x76D1;&#x63A7;&#x5EF6;&#x8FDF;&#x4E3A;10s&#x5185;&#xFF0C;&#x5BF9;&#x4E8E;&#x6296;&#x52A8;&#x7C7B;&#x573A;&#x666F;&#x53EF;&#x4EE5;&#x6709;&#x6548;&#x8FDB;&#x884C;&#x76D1;&#x63A7;</li>
</ul>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/a62ecddb92d661febd2bb8f1a2782ae0c81c2c1d007b26924aa4ebcce7ad239d" alt></p>
<h1 id="&#x4F7F;&#x7528;&#x573A;&#x666F;"><a href="#&#x4F7F;&#x7528;&#x573A;&#x666F;" class="headerlink" title="&#x4F7F;&#x7528;&#x573A;&#x666F;"></a>&#x4F7F;&#x7528;&#x573A;&#x666F;</h1><p>EBS Lens&#x6709;&#x8FD9;&#x4E48;&#x4FBF;&#x6377;&#x7684;&#x7BA1;&#x7406;&#x65B9;&#x5F0F;&#x4EE5;&#x53CA;&#x4E30;&#x5BCC;&#x3001;&#x591A;&#x7EF4;&#x5EA6;&#x7684;&#x76D1;&#x63A7;&#x6307;&#x6807;&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x5217;&#x4E3E;&#x4E86;&#x51E0;&#x4E2A;&#x5E38;&#x7528;&#x7684;&#x573A;&#x666F;&#xFF0C;&#x6765;&#x8BE6;&#x7EC6;&#x8BF4;&#x660E;&#x4E0B;EBS Lens&#x7684;&#x529F;&#x80FD;&#xFF1A;</p>
<p><strong>&#x76D1;&#x63A7;&#x573A;&#x666F;</strong></p>
<p>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x6A21;&#x62DF;&#x65E5;&#x5E38;&#x5E38;&#x89C1;&#x7684;&#x78C1;&#x76D8;IO&#x5F02;&#x5E38;&#x7684;&#x573A;&#x666F;&#xFF0C;&#x5C55;&#x793A;&#x4E0B;EBS Lens&#x7684;&#x5728;&#x76D1;&#x63A7;&#x573A;&#x666F;&#x4E0B;&#x7684;&#x5E94;&#x7528;&#x3002;</p>
<p><strong>&#x73AF;&#x5883;&#x51C6;&#x5907;</strong></p>
<ol>
<li>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x4E91;&#x76D8;&#xFF0C;&#x6216;&#x8005;&#x4F7F;&#x7528;&#x5DF2;&#x6709;&#x7684;&#x4E91;&#x76D8;&#xFF0C;&#x6302;&#x8F7D;&#x5230;ECS&#x5B9E;&#x4F8B;&#x4E0A;&#x3002;&#x6302;&#x8F7D;&#x4E91;&#x76D8;&#x7684;&#x64CD;&#x4F5C;&#x53C2;&#x89C1;&#xFF1A;<a href="/external_links/190796e985830a45dab76718fdd36bac.html" target="blank" rel="noopener">help.aliyun.com/document\_d&#x2026;</a></li>
<li>&#x5C06;&#x8D26;&#x53F7;&#x4E0B;&#x6240;&#x6709;&#x4E91;&#x76D8;&#x901A;&#x8FC7;&#x81EA;&#x52A8;&#x5316;&#x91C7;&#x96C6;&#x914D;&#x7F6E;&#xFF0C;&#x6253;&#x5F00;&#x76D1;&#x63A7;&#x6570;&#x636E;&#x91C7;&#x96C6;</li>
</ol>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/dec5b84ce82b9b00471cde92430c01a6766726dc063fc9f27db5d620ad5021d0" alt></p>
<ol>
<li>&#x6253;&#x5F00;&#x6027;&#x80FD;&#x5206;&#x6790;&#x9875;&#x9762;&#xFF0C;&#x786E;&#x8BA4;&#x4E91;&#x76D8;&#x76D1;&#x63A7;&#x6570;&#x636E;&#x5DF2;&#x63A5;&#x5165;&#x8FDB;&#x6765;</li>
</ol>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/0e2ee9ab0119ca271c93337d49b44bc2e0666ff13515021c88a9efbb479e1be5" alt></p>
<p><strong>&#x5F02;&#x5E38;&#x6A21;&#x62DF;</strong></p>
<p>&#x6211;&#x4EEC;&#x8FDB;&#x5165;ECS&#x5B9E;&#x4F8B;&#x4E2D;&#xFF0C;&#x4F7F;&#x7528;dd&#x6765;&#x6A21;&#x62DF;&#x4E00;&#x4E2A;&#x5BF9;&#x78C1;&#x76D8;&#x7684;&#x5F02;&#x5E38;&#x5199;&#x5165;&#x7684;&#x64CD;&#x4F5C;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/3ff4238a06fb4529535ccce90d3d8a45f806bf608db9378046806a44a17399ff" alt></p>
<p><strong>EBS Lens&#x76D1;&#x63A7;&#x7ED3;&#x679C;</strong></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/ccbee83002d4bdc0998795b5bad19806755623ae4a8ae15668e304a081bf948f" alt></p>
<p>&#x5728;EBS Lens&#x6027;&#x80FD;&#x5206;&#x6790;&#x9875;&#x9762;&#xFF0C;&#x4ECE;&#x5927;&#x76D8;&#x91CC;&#xFF0C;&#x6211;&#x4EEC;&#x53D1;&#x73B0;&#x6709;&#x4E00;&#x5757;&#x78C1;&#x76D8;&#x7684;&#x541E;&#x5410;&#x91CF;&#x548C;IOPS&#x8FC5;&#x901F;&#x63D0;&#x5347;&#x5230;TOP1&#x3002;&#x4E3A;&#x4E86;&#x67E5;&#x770B;&#x78C1;&#x76D8;&#x7684;&#x8BE6;&#x7EC6;&#x6307;&#x6807;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x8FC7;&#x6EE4;&#x6846;&#x5185;&#x8F93;&#x5165;&#x78C1;&#x76D8;id&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8FD9;&#x4E2A;&#x78C1;&#x76D8;&#x5728;&#x9009;&#x5B9A;&#x65F6;&#x95F4;&#x8303;&#x56F4;&#x5185;&#x541E;&#x5410;&#x91CF;&#x548C;IOPS&#x7684;&#x53D8;&#x5316;&#x3002;&#x800C;&#x8BE5;&#x5B9E;&#x4F8B;id&#xFF0C;&#x6B63;&#x662F;&#x6211;&#x4EEC;&#x6A21;&#x62DF;&#x7684;&#x5199;&#x5165;&#x5F02;&#x5E38;&#x7684;&#x78C1;&#x76D8;&#x3002;&#x5728;&#x7EBF;&#x4E0A;&#xFF0C;&#x5982;&#x679C;&#x51FA;&#x73B0;&#x7C7B;&#x4F3C;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x90A3;&#x4E48;&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x5C31;&#x8BE5;&#x53BB;&#x8FDB;&#x884C;&#x8BE6;&#x7EC6;&#x7684;&#x95EE;&#x9898;&#x5B9A;&#x4F4D;&#xFF0C;&#x6BD4;&#x5982;&#x5F02;&#x5E38;&#x7684;&#x670D;&#x52A1;&#x65E5;&#x5FD7;&#x6253;&#x5370;&#x3001;&#x4E0D;&#x5408;&#x7406;&#x7684;&#x6570;&#x636E;&#x843D;&#x76D8;&#x7B49;&#x3002;&#x901A;&#x8FC7;&#x8C03;&#x6574;&#x65F6;&#x95F4;&#x8303;&#x56F4;&#xFF0C;&#x5BF9;&#x4E8E;&#x8BBE;&#x7F6E;ttl&#x8303;&#x56F4;&#x5185;&#x7684;&#x6570;&#x636E;&#xFF0C;EBS Lens&#x90FD;&#x652F;&#x6301;&#x5728;&#x8BE5;&#x9875;&#x9762;&#x8FDB;&#x884C;&#x5C55;&#x793A;&#xFF0C;&#x5BF9;&#x4E8E;&#x6545;&#x969C;&#x7684;&#x590D;&#x76D8;&#x548C;&#x5206;&#x6790;&#x4E5F;&#x662F;&#x6709;&#x975E;&#x5E38;&#x5927;&#x7684;&#x5E2E;&#x52A9;&#x7684;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/a02e8302d47ee6cf72730a3cccc83e310eef208ad2498294d2055679ca490207" alt></p>
<p>&#x914D;&#x5408;SLS&#x7684;&#x544A;&#x8B66;&#x529F;&#x80FD;<a href="/external_links/190796e985830a45dab76718fdd36bac.html" target="blank" rel="noopener">help.aliyun.com/document\_d&#x2026;</a></p>
<h1 id="&#x670D;&#x52A1;&#x538B;&#x6D4B;&#x548C;&#x6027;&#x80FD;&#x8C03;&#x4F18;"><a href="#&#x670D;&#x52A1;&#x538B;&#x6D4B;&#x548C;&#x6027;&#x80FD;&#x8C03;&#x4F18;" class="headerlink" title="&#x670D;&#x52A1;&#x538B;&#x6D4B;&#x548C;&#x6027;&#x80FD;&#x8C03;&#x4F18;"></a>&#x670D;&#x52A1;&#x538B;&#x6D4B;&#x548C;&#x6027;&#x80FD;&#x8C03;&#x4F18;</h1><p>&#x9664;&#x4E86;&#x76D1;&#x63A7;&#x573A;&#x666F;&#xFF0C;EBS Lens&#x5728;&#x670D;&#x52A1;&#x538B;&#x6D4B;&#x548C;&#x6027;&#x80FD;&#x8C03;&#x4F18;&#x7684;&#x573A;&#x666F;&#xFF0C;&#x540C;&#x6837;&#x6709;&#x975E;&#x5E38;&#x5927;&#x7684;&#x4F5C;&#x7528;&#x3002;&#x6240;&#x6709;&#x5173;&#x4E8E;&#x6027;&#x80FD;&#x65B9;&#x9762;&#x7684;&#x6D4B;&#x8BD5;&#xFF0C;&#x6700;&#x5173;&#x952E;&#x7684;&#x57FA;&#x7840;&#x8BBE;&#x65BD;&#x5C31;&#x662F;&#x76D1;&#x63A7;&#x6307;&#x6807;&#x3002;EBS Lens&#x6027;&#x80FD;&#x5206;&#x6790;&#x5927;&#x76D8;&#x5C31;&#x53EF;&#x4EE5;&#x63D0;&#x4F9B;&#x4E91;&#x76D8;&#x5B9E;&#x65F6;&#x7684;&#x6027;&#x80FD;&#x6307;&#x6807;&#xFF0C;&#x8FD9;&#x53EF;&#x4EE5;&#x6709;&#x6548;&#x7684;&#x5E2E;&#x52A9;&#x7528;&#x6237;&#x5FEB;&#x901F;&#x5B9A;&#x4F4D;&#x4E91;&#x76D8;&#x662F;&#x5426;&#x5B58;&#x5728;&#x6027;&#x80FD;&#x74F6;&#x9888;&#x3002;&#x6211;&#x4EEC;&#x6A21;&#x62DF;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x5199;&#x5165;&#x573A;&#x666F;&#xFF1A;&#x5927;&#x91CF;&#x7EA7;&#x7684;&#x6570;&#x636E;&#x8981;&#x4EE5;&#x6700;&#x5FEB;&#x7684;&#x901F;&#x5EA6;&#x5199;&#x5230;&#x78C1;&#x76D8;&#x4E0A;&#x3002;</p>
<p><strong>&#x73AF;&#x5883;&#x51C6;&#x5907;</strong></p>
<ol>
<li>&#x6211;&#x4EEC;&#x91C7;&#x7528;&#x8DDF;&#x4E0A;&#x9762;&#x73AF;&#x5883;&#x4E00;&#x6837;&#x7684;ECS&#x73AF;&#x5883;&#xFF0C;&#x5728;&#x8FD9;&#x4E2A;&#x573A;&#x666F;&#x4E0B;&#x6211;&#x4EEC;&#x6307;&#x5B9A;&#x4E00;&#x4E2A;&#x56FA;&#x5B9A;&#x7684;&#x4E91;&#x76D8;&#x505A;&#x6D4B;&#x8BD5;</li>
</ol>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/f21de4ef263bd9181a5755617e62332ab39865825abddbacb76476998d5b2953" alt></p>
<p>2.&#x5728;EBS Lens&#x7684;&#x9875;&#x9762;&#x6253;&#x5F00;&#x8BE5;&#x4E91;&#x76D8;&#x7684;&#x76D1;&#x63A7;&#x6570;&#x636E;&#x91C7;&#x96C6;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/d02279da3b85d37455dda4b6bf5e106babbddb4737ec0b57589ae5486e5d1118" alt></p>
<p><strong>&#x573A;&#x666F;&#x6A21;&#x62DF;</strong></p>
<p>&#x7B2C;&#x4E00;&#x7248;&#x672C;&#xFF0C;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;FIO&#x6A21;&#x62DF;&#x6027;&#x80FD;&#x6BD4;&#x8F83;&#x5DEE;&#x7684;&#x4E00;&#x4E2A;&#x968F;&#x673A;&#x5199;&#x7684;&#x5B9E;&#x73B0;&#x573A;&#x666F;&#xFF1A;</p>
<p>fio -filename=/mnt/test1 -direct=1 -iodepth 1 -thread -rw=randwrite -ioengine=psync -bs=16k -size=2G -numjobs=10 -runtime=60 -group_reporting -name=mytest</p>
<p>&#x901A;&#x8FC7;EBS Lens&#x7684;&#x76D1;&#x63A7;&#xFF0C;&#x6211;&#x4EEC;&#x53D1;&#x73B0;&#x4E91;&#x76D8;&#x7684;&#x541E;&#x5410;&#x548C;IO&#x6BD4;&#x8F83;&#x4F4E;&#xFF0C;&#x8FDC;&#x8FDC;&#x6CA1;&#x6709;&#x8FBE;&#x5230;&#x4E91;&#x76D8;&#x7684;&#x6027;&#x80FD;&#x4E0A;&#x9650;&#xFF0C;&#x5206;&#x522B;&#x4E3A;15MB/s&#xFF0C;900&#x3002;&#x53C2;&#x8003;&#x5757;&#x5B58;&#x50A8;&#x6027;&#x80FD;&#x6307;&#x6807;&#x6587;&#x6863;&#xFF1A;&#x53C2;&#x8003;<a href="/external_links/190796e985830a45dab76718fdd36bac.html" target="blank" rel="noopener">help.aliyun.com/document\_d&#x2026;</a></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/be860335f93b0fc9cb02760a204a686ce35f292f065466744c2fdd5ea4887c76" alt></p>
<p>&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x518D;&#x5BF9;&#x5199;&#x5165;&#x811A;&#x672C;&#x8FDB;&#x884C;&#x4F18;&#x5316;&#xFF0C;&#x628A;&#x968F;&#x673A;&#x5199;&#x7684;&#x5B9E;&#x73B0;&#x6539;&#x6210;&#x4E86;&#x6BD4;&#x8F83;&#x597D;&#x7684;&#x987A;&#x5E8F;&#x5199;&#x7684;&#x5B9E;&#x73B0;&#xFF1A;</p>
<p>fio -filename=/mnt/test2 -direct=1 -iodepth 1 -thread -rw=write -ioengine=psync -bs=16k -size=2G -numjobs=10 -runtime=60 -group_reporting -name=mytest</p>
<p>&#x901A;&#x8FC7;EBS Lens&#x7684;&#x76D1;&#x63A7;&#xFF0C;&#x541E;&#x5410;&#x8FBE;&#x5230;&#x4E86;47MB/s&#xFF0C;&#x800C;IOPS&#x8FBE;&#x5230;&#x4E86;3000&#x5DE6;&#x53F3;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/7e29ec3392e87b9c674206c96b1828b1fe0a000febc4dabfeb44ea7649ffd15e" alt></p>
<p>&#x901A;&#x8FC7;&#x5757;&#x5B58;&#x50A8;&#x6027;&#x80FD;&#x6307;&#x6807;&#x6587;&#x6863;&#x6211;&#x4EEC;&#x5F97;&#x77E5;&#xFF0C;SSD&#x4E91;&#x76D8;&#x7684;&#x6027;&#x80FD;&#x56E0;&#x6570;&#x636E;&#x5757;&#x5927;&#x5C0F;&#x800C;&#x5F02;&#xFF0C;&#x6570;&#x636E;&#x5757;&#x8D8A;&#x5C0F;&#xFF0C;&#x541E;&#x5410;&#x91CF;&#x8D8A;&#x5C0F;&#xFF0C;IOPS&#x8D8A;&#x9AD8;&#x3002;&#x56E0;&#x6B64;&#x4E3A;&#x4E86;&#x63D0;&#x9AD8;&#x541E;&#x5410;&#x91CF;&#xFF0C;&#x6211;&#x4EEC;&#x8003;&#x8651;&#x63D0;&#x9AD8;&#x5355;&#x6B21;&#x5199;&#x5165;&#x7684;&#x6570;&#x636E;&#x5757;&#x5927;&#x5C0F;&#xFF1A;</p>
<p>fio -filename=/mnt/test2 -direct=1 -iodepth 1 -thread -rw=write -ioengine=psync -bs=64k -size=2G -numjobs=10 -runtime=60 -group_reporting -name=mytest</p>
<p>&#x901A;&#x8FC7;EBS Lens&#x7684;&#x76D1;&#x63A7;&#xFF0C;&#x541E;&#x5410;&#x8FBE;&#x5230;&#x4E86;143MB/s&#xFF0C;&#x800C;IOPS&#x4E0B;&#x964D;&#x5230;&#x4E86;2300&#x5DE6;&#x53F3;&#x3002;&#x7531;&#x6B64;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6709;&#x4E86;EBS Lens&#x4E4B;&#x540E;&#xFF0C;&#x5BF9;&#x4E8E;&#x78C1;&#x76D8;IO&#x7684;&#x6027;&#x80FD;&#x6D4B;&#x8BD5;&#x548C;&#x8C03;&#x4F18;&#xFF0C;&#x662F;&#x591A;&#x4E48;&#x7684;&#x65B9;&#x4FBF;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/7f997846a5706242394fc668ea5aaa2fcea3a5696d564b44ba5450700f96b7a9" alt></p>
<h1 id="&#x9644;&#x5F55;"><a href="#&#x9644;&#x5F55;" class="headerlink" title="&#x9644;&#x5F55;"></a>&#x9644;&#x5F55;</h1><p><strong>&#x8BF4;&#x660E;</strong></p>
<ol>
<li>EBS Lens&#x76EE;&#x524D;&#x5904;&#x4E8E;&#x516C;&#x6D4B;&#x671F;&#x7070;&#x5EA6;&#x5F00;&#x653E;&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x5174;&#x8DA3;&#x8981;&#x8BD5;&#x7528;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5DE5;&#x5355;&#x8054;&#x7CFB;&#x6211;&#x4EEC;<a href="/external_links/80adc6629b8296295fc87af73012954d.html" target="blank" rel="noopener">selfservice.console.aliyun.com/ticket/cate&#x2026;</a></li>
<li>EBS Lens&#x516C;&#x6D4B;&#x671F;&#x76F8;&#x5173;&#x529F;&#x80FD;&#x5168;&#x90E8;&#x514D;&#x8D39;&#xFF0C;&#x516C;&#x6D4B;&#x671F;&#x7ED3;&#x675F;&#x524D;&#x4F1A;&#x63D0;&#x524D;&#x8FDB;&#x884C;&#x516C;&#x793A;&#xFF0C;&#x516C;&#x6D4B;&#x7ED3;&#x675F;&#x540E;&#xFF0C;&#x8D39;&#x7528;&#x8BA1;&#x7B97;&#x53EF;&#x4EE5;&#x53C2;&#x8003;<a href="/external_links/190796e985830a45dab76718fdd36bac.html" target="blank" rel="noopener">help.aliyun.com/document\_d&#x2026;</a></li>
</ol>
<p><strong>&#x53C2;&#x8003;&#x6587;&#x6863;</strong></p>
<ul>
<li>EBS Lens&#x5E2E;&#x52A9;&#x6587;&#x6863;&#xFF1A;<a href="/external_links/190796e985830a45dab76718fdd36bac.html" target="blank" rel="noopener">help.aliyun.com/document\_d&#x2026;</a></li>
<li>EBS Lens&#x524D;&#x7AEF;&#x5165;&#x53E3;&#xFF1A;<a href="/external_links/1cc6073e07a7869951ffc3f3ff9555f7.html" target="blank" rel="noopener">sls.console.aliyun.com/lognext/pro&#x2026;</a></li>
</ul>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/370a53acc754fa218449a829157ac7a2907fe5e7bd951b2be253e69a234e92e3" alt></p>
<ul>
<li>SLS&#x5404;&#x4E2A;&#x4E91;&#x4EA7;&#x54C1;&#x65E5;&#x5FD7;&#x5E94;&#x7528;&#x6587;&#x6863;&#x5217;&#x8868;&#xFF1A;<a href="/external_links/190796e985830a45dab76718fdd36bac.html" target="blank" rel="noopener">help.aliyun.com/document\_d&#x2026;</a></li>
</ul>
<p><a href="/external_links/50e5b38e0f50e257e94231189df8beab.html" target="blank" rel="noopener">&#x539F;&#x6587;&#x94FE;&#x63A5;</a></p>
<p>&#x672C;&#x6587;&#x4E3A;&#x963F;&#x91CC;&#x4E91;&#x539F;&#x521B;&#x5185;&#x5BB9;&#xFF0C;&#x672A;&#x7ECF;&#x5141;&#x8BB8;&#x4E0D;&#x5F97;&#x8F6C;&#x8F7D;&#x3002;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/76f1553470130e4700fe04f58f90cb53.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7034687560383365156.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7034687560383365156.html" itemprop="url">ElasticSearch——京东商城搜索项目实战</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-11-26T09:42:42+08:00">
                2021-11-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x300C;&#x8FD9;&#x662F;&#x6211;&#x53C2;&#x4E0E;11&#x6708;&#x66F4;&#x6587;&#x6311;&#x6218;&#x7684;&#x7B2C;25&#x5929;&#xFF0C;&#x6D3B;&#x52A8;&#x8BE6;&#x60C5;&#x67E5;&#x770B;&#xFF1A;<a href="https://dev.newban.cn/7023643374569816095">2021&#x6700;&#x540E;&#x4E00;&#x6B21;&#x66F4;&#x6587;&#x6311;&#x6218;</a>&#x300D;</p>
<p>&#x6280;&#x672F;&#x6808;&#xFF1A;</p>
<p>SpringBoot 2.5.6</p>
<p>ElasticSearch 7.8.0</p>
<p>Vue</p>
<h2 id="1&#x3001;&#x9879;&#x76EE;&#x642D;&#x5EFA;"><a href="#1&#x3001;&#x9879;&#x76EE;&#x642D;&#x5EFA;" class="headerlink" title="1&#x3001;&#x9879;&#x76EE;&#x642D;&#x5EFA;"></a>1&#x3001;&#x9879;&#x76EE;&#x642D;&#x5EFA;</h2><p>1&#x3001;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;Spring Boot &#x9879;&#x76EE;</p>
<p>2&#x3001;&#x5BFC;&#x5165;&#x4F9D;&#x8D56;</p>
<p>&#x200B; 2.1&#x3001; &#x4FEE;&#x6539;Springboot&#x4E2D;&#x7684;ElasticSearch&#x7248;&#x672C;&#x548C;&#x672C;&#x5730;&#x7684;&#x7248;&#x672C;&#x4E00;&#x81F4;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;properties&gt;</span><br><span class="line">    &lt;java.version&gt;1.8&lt;/java.version&gt;</span><br><span class="line">    &lt;elasticsearch.version&gt;7.8.0&lt;/elasticsearch.version&gt;</span><br><span class="line">&lt;/properties&gt;</span><br></pre></td></tr></table></figure>

<p>&#x200B; 2.2&#x3001;&#x5BFC;&#x5165;&#x4F9D;&#x8D56;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">xml&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;dependencies&gt;</span><br><span class="line">    &lt;!-- jsoup&#x89E3;&#x6790;&#x7F51;&#x9875;--&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.jsoup&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;jsoup&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.10.2&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!-- fastjson --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.2.70&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!-- ElasticSearch --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-data-elasticsearch&lt;/artifactId&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!-- thymeleaf --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!-- web --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!-- devtools&#x70ED;&#x90E8;&#x7F72; --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</span><br><span class="line">        &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">        &lt;optional&gt;true&lt;/optional&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!--  --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;</span><br><span class="line">        &lt;optional&gt;true&lt;/optional&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!-- lombok &#x9700;&#x8981;&#x5B89;&#x88C5;&#x63D2;&#x4EF6; --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">        &lt;optional&gt;true&lt;/optional&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!-- test --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">        &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>

<p>3&#x3001;&#x7F16;&#x5199;&#x914D;&#x7F6E;&#x6587;&#x4EF6;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">properties&#x590D;&#x5236;&#x4EE3;&#x7801;# &#x66F4;&#x6539;&#x7AEF;&#x53E3;&#xFF0C;&#x9632;&#x6B62;&#x51B2;&#x7A81;</span><br><span class="line">server.port=9090</span><br><span class="line"># &#x5173;&#x95ED;thymeleaf&#x7F13;&#x5B58;</span><br><span class="line">spring.thymeleaf.cache=false</span><br></pre></td></tr></table></figure>

<p>4&#x3001;&#x5BFC;&#x5165;&#x9759;&#x6001;&#x8D44;&#x6E90;</p>
<p>&#x94FE;&#x63A5;&#xFF1A;<a href="/external_links/648d8a742bbf5fc6f84d67c46091b91e.html" target="blank" rel="noopener">pan.baidu.com/s/10EF40UUK&#x2026;</a><br>&#x63D0;&#x53D6;&#x7801;&#xFF1A;ot8j</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/9e0cbfd79960b4c779f83c3e243b7e9e18c62cb13ee7022e82e4b1e84f92e87e" alt="&#x5728;&#x8FD9;&#x91CC;&#x63D2;&#x5165;&#x56FE;&#x7247;&#x63CF;&#x8FF0;"></p>
<p>5&#x3001;&#x6D4B;&#x8BD5;&#x8BBF;&#x95EE;&#x9759;&#x6001;&#x9875;&#x9762;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;@GetMapping({&quot;/&quot;,&quot;/index&quot;})</span><br><span class="line">public String test(){</span><br><span class="line">    return &quot;index&quot;;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8BBF;&#x95EE;&#x8BF7;&#x6C42;&#xFF1A;<a href="/external_links/20f00dfe35bb0f8047a669f895e5cb42.html" target="blank" rel="noopener">http://localhost:9090/</a></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/eed83d1cbd259e1b9f36e743a23a39038a5c2ca797e6c6a5b09d0646370f3e2e" alt="&#x5728;&#x8FD9;&#x91CC;&#x63D2;&#x5165;&#x56FE;&#x7247;&#x63CF;&#x8FF0;"></p>
<p>&#x9879;&#x76EE;&#x642D;&#x5EFA;&#x5B8C;&#x6210;&#xFF01;</p>
<h2 id="2&#x3001;&#x722C;&#x53D6;&#x6570;&#x636E;"><a href="#2&#x3001;&#x722C;&#x53D6;&#x6570;&#x636E;" class="headerlink" title="2&#x3001;&#x722C;&#x53D6;&#x6570;&#x636E;"></a>2&#x3001;&#x722C;&#x53D6;&#x6570;&#x636E;</h2><blockquote>
<p>1&#x3001;&#x901A;&#x8FC7;&#x8BF7;&#x6C42; <a href="/external_links/6408f9307e08a16b7563b3d0b9aa2714.html" target="blank" rel="noopener">search.jd.com/Search?keyw&#x2026;</a> &#x67E5;&#x8BE2;&#x5230;&#x9875;&#x9762;</p>
</blockquote>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/f7a34ebe4173ac8d779c9525dd61022f0788cdd38084f5269385874880b1ef66" alt="&#x5728;&#x8FD9;&#x91CC;&#x63D2;&#x5165;&#x56FE;&#x7247;&#x63CF;&#x8FF0;"></p>
<p>&#x68C0;&#x67E5;&#x7F51;&#x9875;&#xFF1A;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5143;&#x7D20;&#x5217;&#x8868;id&#x4E3A; J_goodsList&#xFF0C;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/f380810a2780bb4166674e563faa34fddb654615a87474c65feb706d1eb32300" alt="&#x5728;&#x8FD9;&#x91CC;&#x63D2;&#x5165;&#x56FE;&#x7247;&#x63CF;&#x8FF0;"></p>
<p>&#x6BCF;&#x4E2A;li&#x6807;&#x7B7E;&#x91CC;&#x9762;&#x5B58;&#x653E;&#x4E86;&#x6BCF;&#x4E2A;&#x5546;&#x54C1;&#x7684;&#x5177;&#x4F53;&#x6570;&#x636E;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/3793e0e78ab2851725d509a72592ad62708057e6bf028e2fe4ad9db178417c78" alt="&#x5728;&#x8FD9;&#x91CC;&#x63D2;&#x5165;&#x56FE;&#x7247;&#x63CF;&#x8FF0;"></p>
<blockquote>
<p>2&#x3001;&#x89E3;&#x6790;&#x9875;&#x9762;&#xFF0C;&#x83B7;&#x53D6;&#x6570;&#x636E;</p>
</blockquote>
<p>&#x7F16;&#x5199;&#x89E3;&#x6790;&#x9875;&#x9762;&#x5DE5;&#x5177;&#x7C7B;&#xFF0C;&#x83B7;&#x53D6;&#x5546;&#x54C1;&#x4FE1;&#x606F;&#xFF1A;&#x7B80;&#x6613;&#x7248;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;package com.cheng.utils;</span><br><span class="line"></span><br><span class="line">import org.jsoup.Jsoup;</span><br><span class="line">import org.jsoup.nodes.Document;</span><br><span class="line">import org.jsoup.nodes.Element;</span><br><span class="line">import org.jsoup.select.Elements;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.net.MalformedURLException;</span><br><span class="line">import java.net.URL;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @Author wpcheng</span><br><span class="line"> * @Create 2021-11-10-9:46</span><br><span class="line"> */</span><br><span class="line">public class HTMLParseUtil {</span><br><span class="line">    public static void main(String[] args) throws IOException {</span><br><span class="line">        //1.&#x83B7;&#x53D6;&#x8BF7;&#x6C42;</span><br><span class="line">        String url = &quot;https://search.jd.com/Search?keyword=java&quot;;</span><br><span class="line">        //2&#x3001;&#x89E3;&#x6790;&#x7F51;&#x9875; &#x8FD9;&#x91CC;Jsoup&#x8FD4;&#x56DE;&#x7684;&#x5C31;&#x662F;&#x6D4F;&#x89C8;&#x5668;&#x7684;Document&#x5BF9;&#x8C61;&#xFF0C;&#x5728;&#x8FD9;&#x91CC;&#x53EF;&#x4EE5;&#x7528;js&#x91CC;&#x7684;&#x65B9;&#x6CD5;</span><br><span class="line">        Document document = Jsoup.parse(new URL(url), 30000);</span><br><span class="line">        //&#x83B7;&#x53D6;&quot;J_goodsList&quot;&#x5217;&#x8868;</span><br><span class="line">        Element element = document.getElementById(&quot;J_goodsList&quot;);</span><br><span class="line">        //&#x83B7;&#x53D6;&quot;J_goodsList&quot;&#x5217;&#x8868;&#x4E2D;&#x7684;li&#x6807;&#x7B7E;&#x96C6;&#x5408;</span><br><span class="line">        Elements elements = element.getElementsByTag(&quot;li&quot;);</span><br><span class="line">        //&#x5C06;li&#x6807;&#x7B7E;&#x96C6;&#x5408;&#x4E2D;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;li&#x6807;&#x7B7E;&#x904D;&#x5386;&#x51FA;&#x6765;&#xFF0C;&#x4E00;&#x4E2A;el&#x91CC;&#x6709;&#x4E00;&#x4E2A;&#x5546;&#x54C1;&#x7684;&#x4FE1;&#x606F;</span><br><span class="line">        for (Element el : elements) {</span><br><span class="line"></span><br><span class="line">            //&#x4E00;&#x822C;&#x56FE;&#x7247;&#x7279;&#x522B;&#x591A;&#x7684;&#x7F51;&#x7AD9;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x56FE;&#x7247;&#x90FD;&#x662F;&#x901A;&#x8FC7;&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x7684;&#xFF0C;&#x56FE;&#x7247;&#x5730;&#x5740;&#x653E;&#x5728;&quot;data-lazy-img&quot;&#x91CC;&#x9762;</span><br><span class="line">            String img = el.getElementsByTag(&quot;img&quot;).eq(0).attr(&quot;data-lazy-img&quot;);//&#x83B7;&#x53D6;&#x5546;&#x54C1;&#x56FE;&#x7247;&#x7684;&#x5730;&#x5740;</span><br><span class="line">            String price = el.getElementsByClass(&quot;p-price&quot;).eq(0).text();//&#x83B7;&#x53D6;&#x5546;&#x54C1;&#x7684;&#x4EF7;&#x683C;</span><br><span class="line">            String title = el.getElementsByClass(&quot;p-name&quot;).eq(0).text();//&#x83B7;&#x53D6;&#x5546;&#x54C1;&#x7684;&#x6807;&#x9898;</span><br><span class="line"></span><br><span class="line">            System.out.println(&quot;=====================================&quot;);</span><br><span class="line">            System.out.println(img);</span><br><span class="line">            System.out.println(price);</span><br><span class="line">            System.out.println(title);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8FD0;&#x884C;&#xFF1A;&#x6570;&#x636E;&#x83B7;&#x53D6;&#x6210;&#x529F;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/e40b0310683a044fd41bf1e32cabaf6497002e4087043359aeb844c991179e30" alt="&#x5728;&#x8FD9;&#x91CC;&#x63D2;&#x5165;&#x56FE;&#x7247;&#x63CF;&#x8FF0;"></p>
<p>&#x7F16;&#x5199;&#x5546;&#x54C1;&#x4FE1;&#x606F;&#x7684;&#x5B9E;&#x4F53;&#x7C7B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;@Data</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">public class Content implements Serializable {</span><br><span class="line">    private static final long serialVersionUID = -8049497962627482693L;</span><br><span class="line">    private String name;</span><br><span class="line">    private String img;</span><br><span class="line">    private String price;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5C06;&#x89E3;&#x6790;&#x9875;&#x9762;&#x5DE5;&#x5177;&#x7C7B; HTMLParseUtil &#x5C01;&#x88C5;&#x6210;&#x65B9;&#x6CD5;&#xFF1A;&#x5B8C;&#x6574;&#x7248;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;package com.cheng.utils;</span><br><span class="line"></span><br><span class="line">import com.cheng.pojo.Content;</span><br><span class="line">import org.jsoup.Jsoup;</span><br><span class="line">import org.jsoup.nodes.Document;</span><br><span class="line">import org.jsoup.nodes.Element;</span><br><span class="line">import org.jsoup.select.Elements;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.net.MalformedURLException;</span><br><span class="line">import java.net.URL;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">public class HTMLParseUtil {</span><br><span class="line">    public static void main(String[] args) throws Exception {</span><br><span class="line">        //&#x6D4B;&#x8BD5;</span><br><span class="line">        new HTMLParseUtil().parseJD(&quot;&#x5218;&#x540C;&quot;).forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public  List&lt;Content&gt; parseJD(String keyword) throws Exception {</span><br><span class="line"></span><br><span class="line">        String url = &quot;https://search.jd.com/Search?keyword=&quot;+keyword;</span><br><span class="line">        //2&#x3001;&#x89E3;&#x6790;&#x7F51;&#x9875; &#x8FD9;&#x91CC;Jsoup&#x8FD4;&#x56DE;&#x7684;&#x5C31;&#x662F;&#x6D4F;&#x89C8;&#x5668;&#x7684;Document&#x5BF9;&#x8C61;&#xFF0C;&#x5728;&#x8FD9;&#x91CC;&#x53EF;&#x4EE5;&#x7528;js&#x91CC;&#x7684;&#x65B9;&#x6CD5;</span><br><span class="line">        Document document = Jsoup.parse(new URL(url), 30000);</span><br><span class="line">        //&#x83B7;&#x53D6;&quot;J_goodsList&quot;&#x5217;&#x8868;</span><br><span class="line">        Element element = document.getElementById(&quot;J_goodsList&quot;);</span><br><span class="line">        //&#x83B7;&#x53D6;&quot;J_goodsList&quot;&#x5217;&#x8868;&#x4E2D;&#x7684;li&#x6807;&#x7B7E;&#x96C6;&#x5408;</span><br><span class="line">        Elements elements = element.getElementsByTag(&quot;li&quot;);</span><br><span class="line">        //&#x5C06;li&#x6807;&#x7B7E;&#x96C6;&#x5408;&#x4E2D;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;li&#x6807;&#x7B7E;&#x904D;&#x5386;&#x51FA;&#x6765;&#xFF0C;&#x4E00;&#x4E2A;el&#x91CC;&#x6709;&#x4E00;&#x4E2A;&#x5546;&#x54C1;&#x7684;&#x4FE1;&#x606F;</span><br><span class="line">        // list&#x5B58;&#x50A8;&#x6240;&#x6709;li&#x4E0B;&#x7684;&#x5185;&#x5BB9;</span><br><span class="line">        List&lt;Content&gt; contents = new ArrayList&lt;&gt;();</span><br><span class="line">        for (Element el : elements) {</span><br><span class="line">            //&#x4E00;&#x822C;&#x56FE;&#x7247;&#x7279;&#x522B;&#x591A;&#x7684;&#x7F51;&#x7AD9;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x56FE;&#x7247;&#x90FD;&#x662F;&#x901A;&#x8FC7;&#x5EF6;&#x8FDF;&#x52A0;&#x8F7D;&#x7684;&#xFF0C;&#x56FE;&#x7247;&#x5730;&#x5740;&#x653E;&#x5728;&quot;data-lazy-img&quot;&#x91CC;&#x9762;</span><br><span class="line">            String img = el.getElementsByTag(&quot;img&quot;).eq(0).attr(&quot;data-lazy-img&quot;);//&#x83B7;&#x53D6;&#x5546;&#x54C1;&#x56FE;&#x7247;&#x7684;&#x5730;&#x5740;</span><br><span class="line">            String price = el.getElementsByClass(&quot;p-price&quot;).eq(0).text();//&#x83B7;&#x53D6;&#x5546;&#x54C1;&#x7684;&#x4EF7;&#x683C;</span><br><span class="line">            String title = el.getElementsByClass(&quot;p-name&quot;).eq(0).text();//&#x83B7;&#x53D6;&#x5546;&#x54C1;&#x7684;&#x6807;&#x9898;</span><br><span class="line"></span><br><span class="line">            Content content = new Content(img, price, title);</span><br><span class="line">            contents.add(content);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        return contents;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8FD0;&#x884C;&#x6D4B;&#x8BD5;&#x5DE5;&#x5177;&#x7C7B;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/71a8ca92810b3d49880acff17d7b4ddde495b302711c5801e623d7e4c88e4bdc" alt="&#x5728;&#x8FD9;&#x91CC;&#x63D2;&#x5165;&#x56FE;&#x7247;&#x63CF;&#x8FF0;"></p>
<p><strong>&#x722C;&#x53D6;&#x6570;&#x636E;&#x6D4B;&#x8BD5;&#x6210;&#x529F;&#xFF01;</strong></p>
<h2 id="3&#x3001;&#x7F16;&#x5199;&#x4E1A;&#x52A1;"><a href="#3&#x3001;&#x7F16;&#x5199;&#x4E1A;&#x52A1;" class="headerlink" title="3&#x3001;&#x7F16;&#x5199;&#x4E1A;&#x52A1;"></a>3&#x3001;&#x7F16;&#x5199;&#x4E1A;&#x52A1;</h2><p>1&#x3001;&#x7F16;&#x5199;&#x914D;&#x7F6E;&#x6587;&#x4EF6;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;@Configuration</span><br><span class="line">public class ESHighClientConfig {</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public RestHighLevelClient restHighLevelClient(){</span><br><span class="line">        RestHighLevelClient client = new RestHighLevelClient(</span><br><span class="line">                RestClient.builder(new HttpHost(&quot;127.0.0.1&quot;, 9200, &quot;http&quot;)));</span><br><span class="line">        return client;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>2&#x3001;&#x7F16;&#x5199;service&#x5C42;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;package com.cheng.service;</span><br><span class="line"></span><br><span class="line">import com.alibaba.fastjson.JSON;</span><br><span class="line">import com.cheng.pojo.Content;</span><br><span class="line">import com.cheng.utils.HTMLParseUtil;</span><br><span class="line">import org.elasticsearch.action.bulk.BulkRequest;</span><br><span class="line">import org.elasticsearch.action.bulk.BulkResponse;</span><br><span class="line">import org.elasticsearch.action.index.IndexRequest;</span><br><span class="line">import org.elasticsearch.action.search.SearchRequest;</span><br><span class="line">import org.elasticsearch.action.search.SearchResponse;</span><br><span class="line">import org.elasticsearch.client.RequestOptions;</span><br><span class="line">import org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line">import org.elasticsearch.common.unit.TimeValue;</span><br><span class="line">import org.elasticsearch.common.xcontent.XContentType;</span><br><span class="line">import org.elasticsearch.index.query.QueryBuilders;</span><br><span class="line">import org.elasticsearch.index.query.TermQueryBuilder;</span><br><span class="line">import org.elasticsearch.search.SearchHit;</span><br><span class="line">import org.elasticsearch.search.builder.SearchSourceBuilder;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line">import java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">public class ContentService {</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    RestHighLevelClient restHighLevelClient;</span><br><span class="line"></span><br><span class="line">    //&#x722C;&#x53D6;&#x6570;&#x636E;&#x653E;&#x5165;&#x7D22;&#x5F15;</span><br><span class="line">    public boolean parseContent(String keyword) throws Exception {</span><br><span class="line">        //&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x89E3;&#x6790;&#x5DE5;&#x5177;&#x7C7B;&#x89E3;&#x6790;&#x7F51;&#x9875;&#xFF0C;&#x83B7;&#x53D6;&#x6570;&#x636E;</span><br><span class="line">        List&lt;Content&gt; contents = HTMLParseUtil.parseJD(keyword);</span><br><span class="line"></span><br><span class="line">        //&#x5C06;&#x89E3;&#x6790;&#x5F97;&#x5230;&#x7684;&#x6570;&#x636E;&#x6279;&#x91CF;&#x52A0;&#x5165;ES&#x4E2D;</span><br><span class="line">        BulkRequest bulkRequest = new BulkRequest();</span><br><span class="line">        bulkRequest.timeout(&quot;2m&quot;);</span><br><span class="line">        for (int i = 0; i &lt; contents.size(); i++) {</span><br><span class="line">            bulkRequest.add(</span><br><span class="line">                    new IndexRequest(&quot;jd_goods&quot;)</span><br><span class="line">                    .source(JSON.toJSONString(contents.get(i)), XContentType.JSON));</span><br><span class="line"></span><br><span class="line">        }</span><br><span class="line">        BulkResponse bulkResponse = restHighLevelClient.bulk(bulkRequest, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        return !bulkResponse.hasFailures();//&#x8FD4;&#x56DE;true&#x6267;&#x884C;&#x6210;&#x529F;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    //&#x641C;&#x7D22;&#x6587;&#x6863;&#x4FE1;&#x606F;</span><br><span class="line">    public  List&lt;Map&lt;String,Object&gt;&gt; search(String keyword,int pageIndex,int pageSize) throws IOException {</span><br><span class="line"></span><br><span class="line">        if (pageIndex &lt; 0){</span><br><span class="line">            pageIndex = 0;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        //&#x9488;&#x5BF9;&#x7D22;&#x5F15;&#x6784;&#x5EFA;&#x67E5;&#x8BE2;&#x8BF7;&#x6C42;</span><br><span class="line">        SearchRequest request = new SearchRequest(&quot;jd_goods&quot;);</span><br><span class="line"></span><br><span class="line">        //&#x6784;&#x5EFA;&#x641C;&#x7D22;&#x6761;&#x4EF6;</span><br><span class="line">        SearchSourceBuilder sourceBuilder = SearchSourceBuilder.searchSource();</span><br><span class="line">        //&#x7CBE;&#x786E;&#x67E5;&#x8BE2;&#x5173;&#x952E;&#x8BCD;</span><br><span class="line">        TermQueryBuilder termQuery = QueryBuilders.termQuery(&quot;name&quot;, keyword);</span><br><span class="line">        //&#x628A;&#x7CBE;&#x786E;&#x67E5;&#x8BE2;&#x653E;&#x5165;&#x641C;&#x7D22;&#x6761;&#x4EF6;</span><br><span class="line">        sourceBuilder.query(termQuery).timeout(new TimeValue(60, TimeUnit.SECONDS));</span><br><span class="line"></span><br><span class="line">        //&#x5206;&#x9875;</span><br><span class="line">        sourceBuilder.from(pageIndex);</span><br><span class="line">        sourceBuilder.size(pageSize);</span><br><span class="line"></span><br><span class="line">        //&#x628A;&#x641C;&#x7D22;&#x6761;&#x4EF6;&#x653E;&#x5165;&#x8BF7;&#x6C42;</span><br><span class="line">        request.source(sourceBuilder);</span><br><span class="line"></span><br><span class="line">        //&#x6267;&#x884C;&#x67E5;&#x8BE2;&#x8BF7;&#x6C42;</span><br><span class="line">        SearchResponse response = restHighLevelClient.search(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        List&lt;Map&lt;String,Object&gt;&gt; list = new ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        for (SearchHit documentFields : response.getHits().getHits()) {</span><br><span class="line">            //&#x628A;&#x6BCF;&#x4E2A;&#x5546;&#x54C1;&#x4FE1;&#x606F;&#x5F53;&#x505A;map&#x53D6;&#x51FA;</span><br><span class="line">            Map&lt;String, Object&gt; sourceAsMap = documentFields.getSourceAsMap();</span><br><span class="line">            //&#x653E;&#x5165;list&#x96C6;&#x5408;</span><br><span class="line">            list.add(sourceAsMap);</span><br><span class="line">        }</span><br><span class="line">        return list;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>3&#x3001;&#x7F16;&#x5199;controller&#x5C42;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;package com.cheng.controller;</span><br><span class="line"></span><br><span class="line">import com.cheng.service.ContentService;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line">import org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line">import org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">@RestController</span><br><span class="line">public class TextController {</span><br><span class="line"></span><br><span class="line">   @Autowired</span><br><span class="line">   private ContentService contentService;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @GetMapping({&quot;/&quot;,&quot;/index&quot;})</span><br><span class="line">    public String test(){</span><br><span class="line">        return &quot;index&quot;;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;/parse/{keyword}&quot;)</span><br><span class="line">    public Boolean parse(@PathVariable(&quot;keyword&quot;) String keyword) throws Exception {</span><br><span class="line">        return contentService.parseContent(keyword);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;/search/{keyword}/{pageIndex}/{pageSize}&quot;)</span><br><span class="line">    public List&lt;Map&lt;String, Object&gt;&gt; parse(@PathVariable(&quot;keyword&quot;) String keyword,</span><br><span class="line">                                           @PathVariable(&quot;pageIndex&quot;) Integer pageIndex,</span><br><span class="line">                                           @PathVariable(&quot;pageSize&quot;) Integer pageSize) throws IOException {</span><br><span class="line">        return contentService.search(keyword,pageIndex,pageSize);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>4&#x3001;&#x8FDB;&#x884C;&#x6D4B;&#x8BD5;</p>
<p>&#x8BBF;&#x95EE;&#x8BF7;&#x6C42;&#xFF1A;<a href="/external_links/90be1a90d63ab06833c05f7e8dd1240a.html" target="blank" rel="noopener">http://localhost:9090/parse/java</a> &#x6DFB;&#x52A0;&#x6587;&#x6863;&#xFF1A;&#x6587;&#x6863;&#x6570;&#x636E;&#x5DF2;&#x6DFB;&#x52A0;&#x8FDB;ES&#x4E2D;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/9d14e68e65cc073cce74d4f016a7850aa551375c434e6117c3cf8cba117a16bc" alt="&#x5728;&#x8FD9;&#x91CC;&#x63D2;&#x5165;&#x56FE;&#x7247;&#x63CF;&#x8FF0;"></p>
<p>&#x8BBF;&#x95EE;&#x8BF7;&#x6C42;&#xFF1A;<a href="/external_links/668ff287926cf199d99ba6a816411dbe.html" target="blank" rel="noopener">http://localhost:9090/search/java/1/20</a> &#x67E5;&#x8BE2;&#x5E26;&#x6709;&#x5173;&#x952E;&#x5B57;&#x201C;java&#x201D;&#x7684;&#x5546;&#x54C1;&#x4FE1;&#x606F;&#xFF0C;&#x5E76;&#x8FDB;&#x884C;&#x5206;&#x9875;&#xFF1A;&#x67E5;&#x8BE2;&#x6210;&#x529F;&#xFF01;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/9bce2b37f3566b9d16e78977ec44cc7a73fd4770b9a4620a0c514a6d6d8b9e67" alt="&#x5728;&#x8FD9;&#x91CC;&#x63D2;&#x5165;&#x56FE;&#x7247;&#x63CF;&#x8FF0;"></p>
<h2 id="4&#x3001;&#x524D;&#x540E;&#x7AEF;&#x4EA4;&#x4E92;"><a href="#4&#x3001;&#x524D;&#x540E;&#x7AEF;&#x4EA4;&#x4E92;" class="headerlink" title="4&#x3001;&#x524D;&#x540E;&#x7AEF;&#x4EA4;&#x4E92;"></a>4&#x3001;&#x524D;&#x540E;&#x7AEF;&#x4EA4;&#x4E92;</h2><p>1&#x3001;&#x5BFC;&#x5165;vue&#x548C;axios&#x4F9D;&#x8D56;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/c8eaeced49023fcc000fc640f6512fec8259f06cfc22c1838181b35caabd6e61" alt="&#x5728;&#x8FD9;&#x91CC;&#x63D2;&#x5165;&#x56FE;&#x7247;&#x63CF;&#x8FF0;"></p>
<p>2&#x3001;&#x5F15;&#x5165;js&#x5230;html&#x6587;&#x4EF6;&#x4E2D;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">html&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;script th:src=&quot;@{/js/vue.min.js}&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script th:src=&quot;@{/js/axios.min.js}&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>3&#x3001;&#x6E32;&#x67D3;&#x540E;&#x7684; index.html</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line">html&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html xmlns:th=&quot;http://www.thymeleaf.org&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;utf-8&quot;/&gt;</span><br><span class="line">    &lt;title&gt;&#x72C2;&#x795E;&#x8BF4;Java-ES&#x4EFF;&#x4EAC;&#x4E1C;&#x5B9E;&#x6218;&lt;/title&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; th:href=&quot;@{/css/style.css}&quot;/&gt;</span><br><span class="line">    &lt;script th:src=&quot;@{/js/jquery.min.js}&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body class=&quot;pg&quot;&gt;</span><br><span class="line">&lt;div class=&quot;page&quot;&gt;</span><br><span class="line">    &lt;div id=&quot;app&quot; class=&quot; mallist tmall- page-not-market &quot;&gt;</span><br><span class="line">        &lt;!-- &#x5934;&#x90E8;&#x641C;&#x7D22; --&gt;</span><br><span class="line">        &lt;div id=&quot;header&quot; class=&quot; header-list-app&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;headerLayout&quot;&gt;</span><br><span class="line">                &lt;div class=&quot;headerCon &quot;&gt;</span><br><span class="line">                    &lt;!-- Logo--&gt;</span><br><span class="line">                    &lt;h1 id=&quot;mallLogo&quot;&gt;</span><br><span class="line">                        &lt;img th:src=&quot;@{/images/jdlogo.png}&quot; alt=&quot;&quot;&gt;</span><br><span class="line">                    &lt;/h1&gt;</span><br><span class="line">                    &lt;div class=&quot;header-extra&quot;&gt;</span><br><span class="line">                        &lt;!--&#x641C;&#x7D22;--&gt;</span><br><span class="line">                        &lt;div id=&quot;mallSearch&quot; class=&quot;mall-search&quot;&gt;</span><br><span class="line">                            &lt;form name=&quot;searchTop&quot; class=&quot;mallSearch-form clearfix&quot;&gt;</span><br><span class="line">                                &lt;fieldset&gt;</span><br><span class="line">                                    &lt;legend&gt;&#x5929;&#x732B;&#x641C;&#x7D22;&lt;/legend&gt;</span><br><span class="line">                                    &lt;div class=&quot;mallSearch-input clearfix&quot;&gt;</span><br><span class="line">                                        &lt;div class=&quot;s-combobox&quot; id=&quot;s-combobox-685&quot;&gt;</span><br><span class="line">                                            &lt;div class=&quot;s-combobox-input-wrap&quot;&gt;</span><br><span class="line">                                                &lt;input v-model=&quot;keyword&quot;  type=&quot;text&quot; autocomplete=&quot;off&quot; id=&quot;mq&quot;</span><br><span class="line">                                                       class=&quot;s-combobox-input&quot;  aria-haspopup=&quot;true&quot;&gt;</span><br><span class="line">                                            &lt;/div&gt;</span><br><span class="line">                                        &lt;/div&gt;</span><br><span class="line">                                        &lt;button type=&quot;submit&quot; @click.prevent=&quot;searchKey&quot; id=&quot;searchbtn&quot;&gt;&#x641C;&#x7D22;&lt;/button&gt;</span><br><span class="line">                                    &lt;/div&gt;</span><br><span class="line">                                &lt;/fieldset&gt;</span><br><span class="line">                            &lt;/form&gt;</span><br><span class="line">                            &lt;ul class=&quot;relKeyTop&quot;&gt;</span><br><span class="line">                                &lt;li&gt;&lt;a&gt;&#x72C2;&#x795E;&#x8BF4;Java&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">                                &lt;li&gt;&lt;a&gt;&#x72C2;&#x795E;&#x8BF4;&#x524D;&#x7AEF;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">                                &lt;li&gt;&lt;a&gt;&#x72C2;&#x795E;&#x8BF4;Linux&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">                                &lt;li&gt;&lt;a&gt;&#x72C2;&#x795E;&#x8BF4;&#x5927;&#x6570;&#x636E;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">                                &lt;li&gt;&lt;a&gt;&#x72C2;&#x795E;&#x804A;&#x7406;&#x8D22;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">                            &lt;/ul&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;!-- &#x5546;&#x54C1;&#x8BE6;&#x60C5;&#x9875;&#x9762; --&gt;</span><br><span class="line">        &lt;div id=&quot;content&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;main&quot;&gt;</span><br><span class="line">                &lt;!-- &#x54C1;&#x724C;&#x5206;&#x7C7B; --&gt;</span><br><span class="line">                &lt;form class=&quot;navAttrsForm&quot;&gt;</span><br><span class="line">                    &lt;div class=&quot;attrs j_NavAttrs&quot; style=&quot;display:block&quot;&gt;</span><br><span class="line">                        &lt;div class=&quot;brandAttr j_nav_brand&quot;&gt;</span><br><span class="line">                            &lt;div class=&quot;j_Brand attr&quot;&gt;</span><br><span class="line">                                &lt;div class=&quot;attrKey&quot;&gt;</span><br><span class="line">                                    &#x54C1;&#x724C;</span><br><span class="line">                                &lt;/div&gt;</span><br><span class="line">                                &lt;div class=&quot;attrValues&quot;&gt;</span><br><span class="line">                                    &lt;ul class=&quot;av-collapse row-2&quot;&gt;</span><br><span class="line">                                        &lt;li&gt;&lt;a href=&quot;#&quot;&gt; &#x72C2;&#x795E;&#x8BF4; &lt;/a&gt;&lt;/li&gt;</span><br><span class="line">                                        &lt;li&gt;&lt;a href=&quot;#&quot;&gt; Java &lt;/a&gt;&lt;/li&gt;</span><br><span class="line">                                    &lt;/ul&gt;</span><br><span class="line">                                &lt;/div&gt;</span><br><span class="line">                            &lt;/div&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/form&gt;</span><br><span class="line">                &lt;!-- &#x6392;&#x5E8F;&#x89C4;&#x5219; --&gt;</span><br><span class="line">                &lt;div class=&quot;filter clearfix&quot;&gt;</span><br><span class="line">                    &lt;a class=&quot;fSort fSort-cur&quot;&gt;&#x7EFC;&#x5408;&lt;i class=&quot;f-ico-arrow-d&quot;&gt;&lt;/i&gt;&lt;/a&gt;</span><br><span class="line">                    &lt;a class=&quot;fSort&quot;&gt;&#x4EBA;&#x6C14;&lt;i class=&quot;f-ico-arrow-d&quot;&gt;&lt;/i&gt;&lt;/a&gt;</span><br><span class="line">                    &lt;a class=&quot;fSort&quot;&gt;&#x65B0;&#x54C1;&lt;i class=&quot;f-ico-arrow-d&quot;&gt;&lt;/i&gt;&lt;/a&gt;</span><br><span class="line">                    &lt;a class=&quot;fSort&quot;&gt;&#x9500;&#x91CF;&lt;i class=&quot;f-ico-arrow-d&quot;&gt;&lt;/i&gt;&lt;/a&gt;</span><br><span class="line">                    &lt;a class=&quot;fSort&quot;&gt;&#x4EF7;&#x683C;&lt;i class=&quot;f-ico-triangle-mt&quot;&gt;&lt;/i&gt;&lt;i class=&quot;f-ico-triangle-mb&quot;&gt;&lt;/i&gt;&lt;/a&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;!-- &#x5546;&#x54C1;&#x8BE6;&#x60C5; --&gt;</span><br><span class="line">                &lt;div class=&quot;view grid-nosku&quot; &gt;</span><br><span class="line">                    &lt;div class=&quot;product&quot; v-for=&quot;result in results&quot;&gt;</span><br><span class="line">                        &lt;div class=&quot;product-iWrap&quot;&gt;</span><br><span class="line">                            &lt;!--&#x5546;&#x54C1;&#x5C01;&#x9762;--&gt;</span><br><span class="line">                            &lt;div class=&quot;productImg-wrap&quot;&gt;</span><br><span class="line">                                &lt;a class=&quot;productImg&quot;&gt;</span><br><span class="line">                                    &lt;img :src=&quot;result.img&quot;&gt;</span><br><span class="line">                                &lt;/a&gt;</span><br><span class="line">                            &lt;/div&gt;</span><br><span class="line">                            &lt;!--&#x4EF7;&#x683C;--&gt;</span><br><span class="line">                            &lt;p class=&quot;productPrice&quot;&gt;</span><br><span class="line">                                &lt;em v-text=&quot;result.price&quot;&gt;&lt;/em&gt;</span><br><span class="line">                            &lt;/p&gt;</span><br><span class="line">                            &lt;!--&#x6807;&#x9898;--&gt;</span><br><span class="line">                            &lt;p class=&quot;productTitle&quot;&gt;</span><br><span class="line">                                &lt;a v-html=&quot;result.name&quot;&gt;&lt;/a&gt;</span><br><span class="line">                            &lt;/p&gt;</span><br><span class="line">                            &lt;!-- &#x5E97;&#x94FA;&#x540D; --&gt;</span><br><span class="line">                            &lt;div class=&quot;productShop&quot;&gt;</span><br><span class="line">                                &lt;span&gt;&#x5E97;&#x94FA;&#xFF1A; &#x72C2;&#x795E;&#x8BF4;Java &lt;/span&gt;</span><br><span class="line">                            &lt;/div&gt;</span><br><span class="line">                            &lt;!-- &#x6210;&#x4EA4;&#x4FE1;&#x606F; --&gt;</span><br><span class="line">                            &lt;p class=&quot;productStatus&quot;&gt;</span><br><span class="line">                                &lt;span&gt;&#x6708;&#x6210;&#x4EA4;&lt;em&gt;999&#x7B14;&lt;/em&gt;&lt;/span&gt;</span><br><span class="line">                                &lt;span&gt;&#x8BC4;&#x4EF7; &lt;a&gt;3&lt;/a&gt;&lt;/span&gt;</span><br><span class="line">                            &lt;/p&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;script src=&quot;https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script th:src=&quot;@{/js/axios.min.js}&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    new Vue({</span><br><span class="line">        el:&quot;#app&quot;,</span><br><span class="line">        data:{</span><br><span class="line">            keyword: &apos;&apos;, // &#x641C;&#x7D22;&#x7684;&#x5173;&#x952E;&#x5B57;</span><br><span class="line">            results:[] // &#x540E;&#x7AEF;&#x8FD4;&#x56DE;&#x7684;&#x7ED3;&#x679C;</span><br><span class="line">        },</span><br><span class="line">        methods:{</span><br><span class="line">            searchKey(){</span><br><span class="line">                var keyword = this.keyword;</span><br><span class="line">                console.log(keyword);</span><br><span class="line">                axios.get(&apos;h_search/&apos;+keyword+&apos;/0/20&apos;).then(response=&gt;{</span><br><span class="line">                    console.log(response.data);</span><br><span class="line">                    this.results=response.data;</span><br><span class="line">                })</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    });</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="5&#x3001;&#x5173;&#x952E;&#x5B57;&#x9AD8;&#x4EAE;"><a href="#5&#x3001;&#x5173;&#x952E;&#x5B57;&#x9AD8;&#x4EAE;" class="headerlink" title="5&#x3001;&#x5173;&#x952E;&#x5B57;&#x9AD8;&#x4EAE;"></a>5&#x3001;&#x5173;&#x952E;&#x5B57;&#x9AD8;&#x4EAE;</h2><p>&#x5728;ContentService&#x91CC;&#x9762;&#x52A0;&#x4E0A;&#x5173;&#x952E;&#x5B57;&#x9AD8;&#x4EAE;&#x7684;&#x65B9;&#x6CD5;&#xFF1A;</p>
<p>&#x539F;&#x7406;&#xFF1A;&#x7528;&#x65B0;&#x7684;&#x9AD8;&#x4EAE;&#x5B57;&#x6BB5;&#x503C;&#x8986;&#x76D6;&#x65E7;&#x7684;&#x5B57;&#x6BB5;&#x503C;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;public List&lt;Map&lt;String, Object&gt;&gt; highlightSearch(String keyword, Integer pageIndex, Integer pageSize) throws IOException {</span><br><span class="line">    //&#x9488;&#x5BF9;&#x6784;&#x5EFA;&#x67E5;&#x8BE2;&#x8BF7;&#x6C42;</span><br><span class="line">    SearchRequest searchRequest = new SearchRequest(&quot;jd_goods&quot;);</span><br><span class="line">    SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder();</span><br><span class="line">    // &#x7CBE;&#x786E;&#x67E5;&#x8BE2;</span><br><span class="line">    TermQueryBuilder termQueryBuilder = QueryBuilders.termQuery(&quot;name&quot;, keyword);</span><br><span class="line">    searchSourceBuilder.timeout(new TimeValue(60, TimeUnit.SECONDS));</span><br><span class="line">    //&#x6DFB;&#x52A0;&#x67E5;&#x8BE2;</span><br><span class="line">    searchSourceBuilder.query(termQueryBuilder);</span><br><span class="line">    // &#x5206;&#x9875;</span><br><span class="line">    searchSourceBuilder.from(pageIndex);</span><br><span class="line">    searchSourceBuilder.size(pageSize);</span><br><span class="line">    // &#x5173;&#x952E;&#x5B57;&#x9AD8;&#x4EAE; </span><br><span class="line">    HighlightBuilder highlightBuilder = new HighlightBuilder();</span><br><span class="line">    highlightBuilder.field(&quot;name&quot;);</span><br><span class="line">    highlightBuilder.preTags(&quot;&lt;span style=&apos;color:red&apos;&gt;&quot;);</span><br><span class="line">    highlightBuilder.postTags(&quot;&lt;/span&gt;&quot;);</span><br><span class="line">    searchSourceBuilder.highlighter(highlightBuilder);</span><br><span class="line">    //&#x6DFB;&#x52A0;&#x67E5;&#x8BE2;&#x6761;&#x4EF6;&#x5230;&#x67E5;&#x8BE2;&#x8BF7;&#x6C42;</span><br><span class="line">    searchRequest.source(searchSourceBuilder);</span><br><span class="line">    // &#x6267;&#x884C;&#x67E5;&#x8BE2;&#x8BF7;&#x6C42;</span><br><span class="line">    SearchResponse searchResponse = restHighLevelClient.search(searchRequest, RequestOptions.DEFAULT);</span><br><span class="line">    // &#x89E3;&#x6790;&#x7ED3;&#x679C;</span><br><span class="line">    SearchHits hits = searchResponse.getHits();</span><br><span class="line">    List&lt;Map&lt;String, Object&gt;&gt; results = new ArrayList&lt;&gt;();</span><br><span class="line">    for (SearchHit documentFields : hits.getHits()) {</span><br><span class="line">        // &#x4F7F;&#x7528;&#x65B0;&#x7684;&#x9AD8;&#x4EAE;&#x5B57;&#x6BB5;&#x503C;&#x8986;&#x76D6;&#x65E7;&#x7684;&#x5B57;&#x6BB5;&#x503C;</span><br><span class="line">        Map&lt;String, Object&gt; sourceAsMap = documentFields.getSourceAsMap();</span><br><span class="line">        // &#x9AD8;&#x4EAE;&#x5B57;&#x6BB5;</span><br><span class="line">        Map&lt;String, HighlightField&gt; highlightFields = documentFields.getHighlightFields();</span><br><span class="line">        HighlightField name = highlightFields.get(&quot;name&quot;);</span><br><span class="line">        // &#x5F00;&#x59CB;&#x66FF;&#x6362;</span><br><span class="line">        if (name != null){</span><br><span class="line">            Text[] fragments = name.fragments();</span><br><span class="line">            //&#x7528;StringBuilder&#x6548;&#x7387;&#x66F4;&#x9AD8;</span><br><span class="line">            StringBuilder new_name = new StringBuilder();</span><br><span class="line">            for (Text text : fragments) {</span><br><span class="line">                new_name.append(text);</span><br><span class="line">            }</span><br><span class="line">            sourceAsMap.put(&quot;name&quot;,new_name.toString());</span><br><span class="line">        }</span><br><span class="line">        results.add(sourceAsMap);</span><br><span class="line">    }</span><br><span class="line">    return results;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5728;index.html&#x4E2D;&#x914D;&#x7F6E;&#x9AD8;&#x4EAE;&#x6548;&#x679C;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">html&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;!--&#x6807;&#x9898;--&gt;</span><br><span class="line">&lt;p class=&quot;productTitle&quot;&gt;</span><br><span class="line">    &lt;a v-html=&quot;result.name&quot;&gt;&lt;/a&gt;</span><br><span class="line">&lt;/p&gt;</span><br></pre></td></tr></table></figure>

<h2 id="6&#x3001;&#x6700;&#x7EC8;&#x6548;&#x679C;"><a href="#6&#x3001;&#x6700;&#x7EC8;&#x6548;&#x679C;" class="headerlink" title="6&#x3001;&#x6700;&#x7EC8;&#x6548;&#x679C;"></a>6&#x3001;&#x6700;&#x7EC8;&#x6548;&#x679C;</h2><p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/c0928ff854bbe2d6d5c42601d1c631c3255a80e6446f5dc4cc4cc0668fca82c7" alt="&#x5728;&#x8FD9;&#x91CC;&#x63D2;&#x5165;&#x56FE;&#x7247;&#x63CF;&#x8FF0;"></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/fbeda16203566c18c1fafe01264e1091c1a79226a866777de7168f8b345fd830" alt="&#x5728;&#x8FD9;&#x91CC;&#x63D2;&#x5165;&#x56FE;&#x7247;&#x63CF;&#x8FF0;"></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p5/raw/master/img/faa9e3c6bd12f68a5eac2067b9cfb1276facef6982c7ddace6411a086d6b9882" alt="&#x5728;&#x8FD9;&#x91CC;&#x63D2;&#x5165;&#x56FE;&#x7247;&#x63CF;&#x8FF0;"></p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/f03420b7231de0dd9af87d0e411911c7.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7034683692706431012.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7034683692706431012.html" itemprop="url">Vue+Django 旅游网项目 首页后端实现 Vue+Dj</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-11-26T09:26:24+08:00">
                2021-11-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x8FD9;&#x662F;&#x6211;&#x53C2;&#x4E0E;11&#x6708;&#x66F4;&#x6587;&#x6311;&#x6218;&#x7684;&#x7B2C;26&#x5929;&#xFF0C;&#x6D3B;&#x52A8;&#x8BE6;&#x60C5;&#x67E5;&#x770B;&#xFF1A;<a href="https://dev.newban.cn/7023643374569816095">2021&#x6700;&#x540E;&#x4E00;&#x6B21;&#x66F4;&#x6587;&#x6311;&#x6218;</a></p>
<h1 id="Vue-Django-&#x65C5;&#x6E38;&#x7F51;&#x9879;&#x76EE;-&#x9996;&#x9875;&#x540E;&#x7AEF;&#x5B9E;&#x73B0;"><a href="#Vue-Django-&#x65C5;&#x6E38;&#x7F51;&#x9879;&#x76EE;-&#x9996;&#x9875;&#x540E;&#x7AEF;&#x5B9E;&#x73B0;" class="headerlink" title="Vue+Django &#x65C5;&#x6E38;&#x7F51;&#x9879;&#x76EE; &#x9996;&#x9875;&#x540E;&#x7AEF;&#x5B9E;&#x73B0;"></a>Vue+Django &#x65C5;&#x6E38;&#x7F51;&#x9879;&#x76EE; &#x9996;&#x9875;&#x540E;&#x7AEF;&#x5B9E;&#x73B0;</h1><h2 id="&#x8F6E;&#x64AD;&#x56FE;"><a href="#&#x8F6E;&#x64AD;&#x56FE;" class="headerlink" title="&#x8F6E;&#x64AD;&#x56FE;"></a>&#x8F6E;&#x64AD;&#x56FE;</h2><p>&#x914D;&#x7F6E;&#x6570;&#x636E;&#x5E93;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">python&#x590D;&#x5236;&#x4EE3;&#x7801;DATABASES = {</span><br><span class="line">    &apos;default&apos;: {</span><br><span class="line">        &apos;ENGINE&apos;: &apos;django.db.backends.mysql&apos;,</span><br><span class="line">        &apos;NAME&apos;: &apos;trip&apos;,</span><br><span class="line">        &apos;USER&apos;: &apos;root&apos;,</span><br><span class="line">        &apos;PASSWORD&apos;: &apos;123456&apos;,</span><br><span class="line">        &apos;HOST&apos;: &apos;127.0.0.1&apos;,</span><br><span class="line">        &apos;PORT&apos;: 3306,</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/9c1bb5e76dc620cb428fc9f3437509a805b5e7cc42c5a042b7674f8950512d76" alt="image-20211125094633589"></p>
<p>&#x521B;&#x5EFA;&#x5E94;&#x7528;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python&#x590D;&#x5236;&#x4EE3;&#x7801;startapp system</span><br></pre></td></tr></table></figure>

<p>&#x521B;&#x5EFA;&#x6570;&#x636E;&#x5E93;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/f63e6153a8293d89290cf3473adb00e781b076e07a0764ef367e3dff768294c6" alt="image-20211125095802797"></p>
<p>&#x7F16;&#x5199;&#x6A21;&#x578B;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">python&#x590D;&#x5236;&#x4EE3;&#x7801;class Slider(models.Model):</span><br><span class="line">    name=models.CharField(&apos;&#x540D;&#x79F0;&apos;,max_length=32)</span><br><span class="line">    desc=models.CharField(&apos;&#x63CF;&#x8FF0;&apos;,max_length=100,null=True,blank=True)</span><br><span class="line">    types=models.SmallIntegerField(&apos;&#x5C55;&#x73B0;&#x7684;&#x4F4D;&#x7F6E;&apos;,default=10)</span><br><span class="line">    img=models.ImageField(&apos;&#x56FE;&#x7247;&#x5730;&#x5740;&apos;,max_length=255,upload_to=&apos;%Y%m/slider&apos;)</span><br><span class="line">    reorder=models.SmallIntegerField(&apos;&#x6392;&#x5E8F;&#x5B57;&#x6BB5;&apos;,default=0,help_text=&quot;&#x6570;&#x5B57;&#x8D8A;&#x5927;&#x8D8A;&#x9760;&#x524D;&quot;)</span><br><span class="line">    start_time=models.DateTimeField(&apos;&#x751F;&#x6548;&#x5F00;&#x59CB;&#x65F6;&#x95F4;&apos;,null=True,blank=True)</span><br><span class="line">    end_time=models.DateTimeField(&apos;&#x751F;&#x6548;&#x7ED3;&#x675F;&#x65F6;&#x95F4;&apos;,null=True,blank=True)</span><br><span class="line">    target_url=models.CharField(&apos;&#x8DF3;&#x8F6C;&#x7684;&#x5730;&#x5740;&apos;,max_length=255,null=True,blank=True)</span><br><span class="line">    is_valid=models.BooleanField(&apos;&#x662F;&#x5426;&#x6709;&#x6548;&apos;,default=True)</span><br><span class="line">    created_at=models.DateTimeField(&apos;&#x521B;&#x5EFA;&#x65F6;&#x95F4;&apos;,auto_now_add=True)</span><br><span class="line">    updated_at=models.DateTimeField(&apos;&#x4FEE;&#x6539;&#x65F6;&#x95F4;&apos;,auto_now=True)</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        db_table=&apos;system_slider&apos;</span><br><span class="line">        ordering=[&apos;-reorder&apos;]</span><br></pre></td></tr></table></figure>

<p>&#x6CE8;&#x518C;&#x5E94;&#x7528;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/91f459f4d515b87ca71434cbddfa4c7ff5cb43a48f73ba647c4e392039a853ba" alt="image-20211125095934479"></p>
<p>&#x540C;&#x6B65;&#x6570;&#x636E;&#x5E93;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python&#x590D;&#x5236;&#x4EE3;&#x7801;makemigrations</span><br><span class="line">migrate</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/e9597b908a07702d36ef10a72bfe0b8045a8ce2bd89698fde6054bdca0037421" alt="image-20211125100030673"></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/b61758b61b2338611c72a870504e49e3277c962fc8b18085f2ba71d023370214" alt="image-20211125100107211"></p>
<h3 id="&#x63A5;&#x53E3;&#x7F16;&#x5199;"><a href="#&#x63A5;&#x53E3;&#x7F16;&#x5199;" class="headerlink" title="&#x63A5;&#x53E3;&#x7F16;&#x5199;"></a>&#x63A5;&#x53E3;&#x7F16;&#x5199;</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">python&#x590D;&#x5236;&#x4EE3;&#x7801;from django.http import HttpResponse, JsonResponse</span><br><span class="line">from django.shortcuts import render</span><br><span class="line"></span><br><span class="line"># Create your views here.</span><br><span class="line">from system.models import Slider</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def slider_list(request):</span><br><span class="line">    &quot;&quot;&quot; &#x8F6E;&#x64AD;&#x56FE;&#x63A5;&#x53E3;</span><br><span class="line">    &#xFF5B;</span><br><span class="line">        &quot;meta&quot;:[]</span><br><span class="line">        &quot;objects&quot;:[]</span><br><span class="line">    &#xFF5D;</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    data ={</span><br><span class="line">        &apos;meta&apos;:{},</span><br><span class="line">        &apos;objects&apos;:[]</span><br><span class="line">    }</span><br><span class="line">    querset=Slider.objects.filter(is_valid=True)</span><br><span class="line">    for item in querset:</span><br><span class="line">        data[&apos;objects&apos;].append({</span><br><span class="line">            &apos;id&apos;:item.id,</span><br><span class="line">            &apos;img_url&apos;: item.img.url,</span><br><span class="line">            &apos;target_url&apos;:item.target_url,</span><br><span class="line">            &apos;name&apos;: item.name</span><br><span class="line">        })</span><br><span class="line">    return JsonResponse(data)</span><br></pre></td></tr></table></figure>

<p>utl&#x8BBE;&#x7F6E;</p>
<p>system/urls.py</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">python&#x590D;&#x5236;&#x4EE3;&#x7801;from django.urls import path</span><br><span class="line"></span><br><span class="line">from system import views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(&apos;slider/list&apos;, views.slider_list),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>&#x6839;urls.py</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">python&#x590D;&#x5236;&#x4EE3;&#x7801;from django.contrib import admin</span><br><span class="line">from django.urls import path, include</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(&apos;admin/&apos;, admin.site.urls),</span><br><span class="line">    # &#x7CFB;&#x7EDF;&#x6A21;&#x5757;</span><br><span class="line">    path(&apos;system/&apos;,include(&apos;system.urls&apos;))</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>&#x6D4B;&#x8BD5;</p>
<p>&#x6D4B;&#x8BD5;&#x524D;&#x9700;&#x8981;&#x5728;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x6DFB;&#x52A0;&#x6570;&#x636E;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/aa0f322d46154dfc8b056035f7e26a10b3d3d390ca8fc526f3fdac8c4efc595c" alt="image-20211125103826854"></p>
<h2 id="&#x666F;&#x70B9;"><a href="#&#x666F;&#x70B9;" class="headerlink" title="&#x666F;&#x70B9;"></a>&#x666F;&#x70B9;</h2><p>&#x65B0;&#x5EFA;&#x5E94;&#x7528;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;startapp sight</span><br></pre></td></tr></table></figure>

<p>&#x6CE8;&#x518C;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">python&#x590D;&#x5236;&#x4EE3;&#x7801;INSTALLED_APPS = [</span><br><span class="line">    &apos;django.contrib.admin&apos;,</span><br><span class="line">    &apos;django.contrib.auth&apos;,</span><br><span class="line">    &apos;django.contrib.contenttypes&apos;,</span><br><span class="line">    &apos;django.contrib.sessions&apos;,</span><br><span class="line">    &apos;django.contrib.messages&apos;,</span><br><span class="line">    &apos;django.contrib.staticfiles&apos;,</span><br><span class="line">    &apos;system&apos;,</span><br><span class="line">    &apos;sight&apos;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>&#x7F16;&#x5199;&#x6A21;&#x578B;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">python&#x590D;&#x5236;&#x4EE3;&#x7801;class Sight(models.Model):</span><br><span class="line">    name = models.CharField(&apos;&#x540D;&#x79F0;&apos;,max_length=64)</span><br><span class="line">    desc=models.CharField(&apos;&#x63CF;&#x8FF0;&apos;,max_length=255)</span><br><span class="line">    main_img=models.ImageField(&apos;&#x4E3B;&#x56FE;&apos;,upload_to=&apos;%Y%m/sight/&apos;,max_length=255)</span><br><span class="line">    banner_img=models.ImageField(&apos;&#x8BE6;&#x60C5;&#x4E3B;&#x56FE;&apos;,upload_to=&apos;%Y%m/sight/&apos;,max_length=255)</span><br><span class="line">    content=models.TextField(&apos;&#x8BE6;&#x60C5;&apos;)</span><br><span class="line">    score=models.FloatField(&apos;&#x8BC4;&#x5206;&apos;,default=5)</span><br><span class="line">    min_price=models.FloatField(&apos;&#x6700;&#x4F4E;&#x4EF7;&#x683C;&apos;,default=0)</span><br><span class="line">    province=models.CharField(&apos;&#x7701;&#x4EFD;&apos;,max_length=32)</span><br><span class="line">    city=models.CharField(&apos;&#x5E02;&#x533A;&apos;,max_length=32)</span><br><span class="line">    area=models.CharField(&apos;&#x533A;/&#x53BF;&apos;,max_length=32,null=True)</span><br><span class="line">    town=models.CharField(&apos;&#x4E61;&#x9547;&apos;,max_length=32,null=True)</span><br><span class="line">    is_top=models.BooleanField(&apos;&#x662F;&#x5426;&#x4E3A;&#x7CBE;&#x9009;&#x666F;&#x70B9;&apos;,default=False)</span><br><span class="line">    is_hot=models.BooleanField(&apos;&#x662F;&#x5426;&#x4E3A;&#x70ED;&#x95E8;&#x666F;&#x70B9;&apos;,default=False)</span><br><span class="line">    is_valid=models.BooleanField(&apos;&#x662F;&#x5426;&#x6709;&#x6548;&apos;,default=True)</span><br><span class="line">    created_at=models.DateTimeField(&apos;&#x521B;&#x5EFA;&#x65F6;&#x95F4;&apos;,auto_now_add=True)</span><br><span class="line">    updated_at=models.DateTimeField(&apos;&#x4FEE;&#x6539;&#x65F6;&#x95F4;&apos;,auto_now=True)</span><br><span class="line">    class Meta:</span><br><span class="line">        db_table:&apos;sight&apos;</span><br><span class="line">        ordering=[&apos;-updated_at&apos;]</span><br></pre></td></tr></table></figure>

<p>&#x6570;&#x636E;&#x5E93;&#x540C;&#x6B65;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;makemigrations</span><br><span class="line">migrate</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/87bd598989af05262d1591842be8a34ef84f91f3aca81784a59d06e4c078add3" alt="image-20211125120526773"></p>
<h3 id="&#x63A5;&#x53E3;&#x7F16;&#x5199;-1"><a href="#&#x63A5;&#x53E3;&#x7F16;&#x5199;-1" class="headerlink" title="&#x63A5;&#x53E3;&#x7F16;&#x5199;"></a>&#x63A5;&#x53E3;&#x7F16;&#x5199;</h3><p>&#x6839;utls.py</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">python&#x590D;&#x5236;&#x4EE3;&#x7801;urlpatterns = [</span><br><span class="line">    path(&apos;admin/&apos;, admin.site.urls),</span><br><span class="line">    # &#x7CFB;&#x7EDF;&#x6A21;&#x5757;</span><br><span class="line">    path(&apos;system/&apos;,include(&apos;system.urls&apos;)),</span><br><span class="line">    # &#x666F;&#x70B9;</span><br><span class="line">    path(&apos;sight/&apos;,include(&apos;sight.urls&apos;))</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>sight urls.py</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">python&#x590D;&#x5236;&#x4EE3;&#x7801;from django.urls import path</span><br><span class="line"></span><br><span class="line">from sight import views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    # &#x666F;&#x70B9;&#x5217;&#x8868;&#x63A5;&#x53E3;</span><br><span class="line">    path(&apos;sight/list/&apos;, views.SightListView.as_view()),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>views.py</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">python&#x590D;&#x5236;&#x4EE3;&#x7801;from django.db.models import Q</span><br><span class="line">from django.http import JsonResponse</span><br><span class="line">from django.shortcuts import render</span><br><span class="line"></span><br><span class="line"># Create your views here.</span><br><span class="line">from django.views.generic import ListView</span><br><span class="line"></span><br><span class="line">from sight.models import Sight</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class SightListView(ListView):</span><br><span class="line">    &quot;&quot;&quot; &#x666F;&#x70B9;&#x5217;&#x8868; &quot;&quot;&quot;</span><br><span class="line">    # &#x6BCF;&#x9875;5&#x6761;&#x6570;&#x636E;</span><br><span class="line">    paginate_by = 5</span><br><span class="line"></span><br><span class="line">    def get_queryset(self):</span><br><span class="line">        # &#x91CD;&#x5199;&#x67E5;&#x8BE2;&#x65B9;&#x6CD5;</span><br><span class="line">        query=Q(is_valid=True)</span><br><span class="line">        # &#x70ED;&#x95E8;&#x666F;&#x70B9;</span><br><span class="line">        is_hot = self.request.GET.get(&apos;is_hot&apos;,None)</span><br><span class="line">        if is_hot:</span><br><span class="line">            query=query &amp; Q(is_hot=True)</span><br><span class="line">        # &#x7CBE;&#x9009;&#x666F;&#x70B9;</span><br><span class="line">        is_top = self.request.GET.get(&apos;is_top&apos;, None)</span><br><span class="line">        if is_top:</span><br><span class="line">            query = query &amp; Q(is_top=True)</span><br><span class="line">        queryset=Sight.objects.filter(query)</span><br><span class="line">        return queryset</span><br><span class="line"></span><br><span class="line">    def render_to_response(self, context, **response_kwargs):</span><br><span class="line">        page_obj=context[&apos;page_obj&apos;]</span><br><span class="line">        data = {</span><br><span class="line">            &apos;meta&apos;: {</span><br><span class="line">                &apos;total_count&apos;:page_obj.paginator.count,</span><br><span class="line">                &apos;page_count&apos;:page_obj.paginator.num_pages,</span><br><span class="line">                &apos;current_page&apos;:page_obj.number,</span><br><span class="line">            },</span><br><span class="line">            &apos;objects&apos;: []</span><br><span class="line">        }</span><br><span class="line">        for item in page_obj.object_list:</span><br><span class="line">            data[&apos;objects&apos;].append({</span><br><span class="line">                &apos;id&apos;:item.id,</span><br><span class="line">                &apos;name&apos;:item.name,</span><br><span class="line">                &apos;main_img&apos;:item.main_img.url,</span><br><span class="line">                &apos;score&apos;:item.score,</span><br><span class="line">                &apos;province&apos;:item.province,</span><br><span class="line">                &apos;min_price&apos;:item.min_price,</span><br><span class="line">                &apos;city&apos;:item.city,</span><br><span class="line">                &apos;comment_count&apos;:0</span><br><span class="line">            })</span><br><span class="line">        return JsonResponse(data)</span><br></pre></td></tr></table></figure>

<p>&#x6D4B;&#x8BD5;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/9993e2c1f994326643b2da7f05eff556a7be2c6b5dbfb446e714fc034bc68528" alt="image-20211125141816024"></p>
<h2 id="&#x8F6E;&#x64AD;&#x56FE;&#x63A5;&#x53E3;&#x5BF9;&#x63A5;"><a href="#&#x8F6E;&#x64AD;&#x56FE;&#x63A5;&#x53E3;&#x5BF9;&#x63A5;" class="headerlink" title="&#x8F6E;&#x64AD;&#x56FE;&#x63A5;&#x53E3;&#x5BF9;&#x63A5;"></a>&#x8F6E;&#x64AD;&#x56FE;&#x63A5;&#x53E3;&#x5BF9;&#x63A5;</h2><p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/54f993b50d9fa05d034ca16b09471a4154764a76e085b5d16fd7f43bc0fedcb3" alt="image-20211125153442001"></p>
<p>ajax.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">javascript&#x590D;&#x5236;&#x4EE3;&#x7801;import axios from &apos;axios&apos;</span><br><span class="line"></span><br><span class="line">export const ajax = axios.create({</span><br><span class="line">  headers: {</span><br><span class="line">    source: &apos;h5&apos;,</span><br><span class="line">    icode: &apos;acbd&apos;,</span><br><span class="line">    &apos;Content-Type&apos;: &apos;application/x-www-form-urlencoded&apos;</span><br><span class="line">  },</span><br><span class="line">  withCredentials: true</span><br><span class="line">})</span><br><span class="line">ajax.interceptors.request.use(function (config) {</span><br><span class="line">  // &#x5728;&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x4E4B;&#x524D;&#x505A;&#x4E9B;&#x4EC0;&#x4E48;</span><br><span class="line">  console.log(&apos;&#x8BF7;&#x6C42;&#x62E6;&#x622A;&#x5230;&#x4E86;&apos;)</span><br><span class="line">  return config</span><br><span class="line">}, function (error) {</span><br><span class="line">  // &#x5BF9;&#x8BF7;&#x6C42;&#x9519;&#x8BEF;&#x505A;&#x4E9B;&#x4EC0;&#x4E48;</span><br><span class="line">  return Promise.reject(error)</span><br><span class="line">})</span><br><span class="line"></span><br><span class="line">ajax.interceptors.response.use(function (response) {</span><br><span class="line">  // &#x5BF9;&#x54CD;&#x5E94;&#x6570;&#x636E;&#x505A;&#x70B9;&#x4EC0;&#x4E48;</span><br><span class="line">  console.log(&apos;&#x54CD;&#x5E94;&#x62E6;&#x622A;&#x5230;&#x4E86;&apos;)</span><br><span class="line">  return response</span><br><span class="line">}, function (error) {</span><br><span class="line">  // &#x5BF9;&#x54CD;&#x5E94;&#x9519;&#x8BEF;&#x505A;&#x70B9;&#x4EC0;&#x4E48;</span><br><span class="line">  if (error.response) {</span><br><span class="line">    if (error.response.status === 401) {</span><br><span class="line">      window.alert(&apos;&#x672A;&#x767B;&#x5F55;&#xFF0C;&#x5373;&#x5C06;&#x8DF3;&#x8F6C;&#x5230;&#x767B;&#x5F55;&#x9875;&#x9762;&apos;)</span><br><span class="line">    } else if (error.response.status === 500) {</span><br><span class="line">      window.alert(&apos;&#x670D;&#x52A1;&#x5668;&#x6B63;&#x5FD9;&#xFF0C;&#x8BF7;&#x7A0D;&#x540E;&#x91CD;&#x8BD5;&apos;)</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  return Promise.reject(error)</span><br><span class="line">})</span><br></pre></td></tr></table></figure>

<p>apis.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">javascript&#x590D;&#x5236;&#x4EE3;&#x7801;// &#x5B58;&#x653E;&#x9879;&#x76EE;&#x4E2D;&#x6240;&#x6709;&#x7684;&#x63A5;&#x53E3;&#x5730;&#x5740;</span><br><span class="line"></span><br><span class="line">const apiHost = &apos;http://localhost:8080/api&apos;</span><br><span class="line">const AccountsApis = {</span><br><span class="line">  loginUrl: &apos;/&apos;,</span><br><span class="line">  logoutUrl: &apos;&apos;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * &#x7CFB;&#x7EDF;&#x6A21;&#x5757;&#x63A5;&#x53E3;</span><br><span class="line"> */</span><br><span class="line">const SystemApis = {</span><br><span class="line">  sliderListUrl: apiHost + &apos;/system/slider/list/&apos;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">export {</span><br><span class="line">  AccountsApis,</span><br><span class="line">  SystemApis</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/bc1088cc8cc708ca2eb65891ca5b57c2b60bcd7225fa952161f6d194ebd983cc" alt="image-20211125153555373"></p>
<p>vue.config.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">javascript&#x590D;&#x5236;&#x4EE3;&#x7801;module.exports = {</span><br><span class="line">  devServer:{</span><br><span class="line">    proxy: {</span><br><span class="line">      &apos;/api&apos;: {</span><br><span class="line">        target:&apos;http://127.0.0.1:8000/&apos;,</span><br><span class="line">        changeOrigin: true,</span><br><span class="line">        pathRewrite: {</span><br><span class="line">          &apos;^/api&apos;: &apos;&apos;   //&#x9700;&#x8981;rewrite&#x91CD;&#x5199;&#x7684;URL</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>banner&#x7EC4;&#x4EF6;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">javascript&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;template&gt;</span><br><span class="line">&lt;!-- &#x8F6E;&#x64AD;&#x56FE; --&gt;</span><br><span class="line">  &lt;div class=&quot;home-banner-box&quot;&gt;</span><br><span class="line">    &lt;van-swipe class=&quot;my-swipe&quot; :autoplay=&quot;3000&quot; indicator-color=&quot;white&quot;&gt;</span><br><span class="line">      &lt;van-swipe-item v-for=&quot;item in bannerList&quot;</span><br><span class="line">        :key=&quot;item.id&quot;&gt;</span><br><span class="line">        &lt;img :src=&quot;item.img_url&quot; alt=&quot;&quot;&gt;</span><br><span class="line">      &lt;/van-swipe-item&gt;</span><br><span class="line">    &lt;/van-swipe&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import { ajax } from &apos;@/utils/ajax&apos;</span><br><span class="line">import { SystemApis } from &apos;@/utils/apis&apos;</span><br><span class="line">export default {</span><br><span class="line">  data () {</span><br><span class="line">    return {</span><br><span class="line">      bannerList: []</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    /**</span><br><span class="line">     * &#x83B7;&#x53D6;&#x8F6E;&#x64AD;&#x56FE;&#x6570;&#x636E;</span><br><span class="line">     */</span><br><span class="line">    getDataList () {</span><br><span class="line">      ajax.get(SystemApis.sliderListUrl).then(res =&gt; {</span><br><span class="line">        console.log(&apos;res&apos;, res)</span><br><span class="line">        this.bannerList = res.data.objects</span><br><span class="line">      })</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  created () {</span><br><span class="line">    this.getDataList()</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style lang=&quot;less&quot;&gt;</span><br><span class="line">.home-banner-box {</span><br><span class="line">  img {</span><br><span class="line">    width: 100%;</span><br><span class="line">    height: auto;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>&#x6548;&#x679C;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/a9c329c705ef997769dc44f0633f055d9d37f99e52f98e7ee99176c0b43aba3c" alt="image-20211125153925697"></p>
<h2 id="&#x666F;&#x70B9;&#x5217;&#x8868;&#x63A5;&#x53E3;&#x5BF9;&#x63A5;"><a href="#&#x666F;&#x70B9;&#x5217;&#x8868;&#x63A5;&#x53E3;&#x5BF9;&#x63A5;" class="headerlink" title="&#x666F;&#x70B9;&#x5217;&#x8868;&#x63A5;&#x53E3;&#x5BF9;&#x63A5;"></a>&#x666F;&#x70B9;&#x5217;&#x8868;&#x63A5;&#x53E3;&#x5BF9;&#x63A5;</h2><p>apis.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">javascript&#x590D;&#x5236;&#x4EE3;&#x7801;// &#x5B58;&#x653E;&#x9879;&#x76EE;&#x4E2D;&#x6240;&#x6709;&#x7684;&#x63A5;&#x53E3;&#x5730;&#x5740;</span><br><span class="line"></span><br><span class="line">const apiHost = &apos;http://localhost:8080/api&apos;</span><br><span class="line">const AccountsApis = {</span><br><span class="line">  loginUrl: &apos;/&apos;,</span><br><span class="line">  logoutUrl: &apos;&apos;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * &#x7CFB;&#x7EDF;&#x6A21;&#x5757;&#x63A5;&#x53E3;</span><br><span class="line"> */</span><br><span class="line">const SystemApis = {</span><br><span class="line">  // &#x8F6E;&#x64AD;&#x56FE;&#x5217;&#x8868;</span><br><span class="line">  sliderListUrl: apiHost + &apos;/system/slider/list/&apos;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * &#x666F;&#x70B9;&#x6A21;&#x5757;</span><br><span class="line"> */</span><br><span class="line">const SightApis = {</span><br><span class="line">  // &#x666F;&#x70B9;&#x5217;&#x8868;</span><br><span class="line">  sightListUrl: apiHost + &apos;/sight/sight/list/&apos;</span><br><span class="line">}</span><br><span class="line">export {</span><br><span class="line">  AccountsApis,</span><br><span class="line">  SystemApis,</span><br><span class="line">  SightApis</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x7EC4;&#x4EF6;Fine.vue</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">javascript&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;template&gt;</span><br><span class="line">    &lt;!-- &#x7CBE;&#x9009;&#x666F;&#x70B9; --&gt;</span><br><span class="line">    &lt;div class=&quot;home-fine-box&quot;&gt;</span><br><span class="line">      &lt;!-- &#x5BFC;&#x822A; --&gt;</span><br><span class="line">        &lt;van-cell</span><br><span class="line">          icon=&quot;location-o&quot;</span><br><span class="line">          title=&quot;&#x70ED;&#x95E8;&#x63A8;&#x8350;&quot;</span><br><span class="line">          title-style=&quot;text-align:left&quot;</span><br><span class="line">          value=&quot;&#x5168;&#x90E8;&#x699C;&#x5355;&quot;</span><br><span class="line">          is-link /&gt;</span><br><span class="line">        &lt;!-- &#x5217;&#x8868; --&gt;</span><br><span class="line">        &lt;div class=&quot;box-main&quot;&gt;</span><br><span class="line">          &lt;SightItem v-for=&quot;item in dataList&quot;</span><br><span class="line">          :key=&quot;item.id&quot;</span><br><span class="line">          :item=&quot;item&quot;/&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import { ajax } from &apos;@/utils/ajax&apos;</span><br><span class="line">import { SightApis } from &apos;@/utils/apis&apos;</span><br><span class="line">import SightItem from &apos;@/components/common/ListSight&apos;</span><br><span class="line">export default {</span><br><span class="line">  components: {</span><br><span class="line">    SightItem</span><br><span class="line">  },</span><br><span class="line">  data () {</span><br><span class="line">    return {</span><br><span class="line">      dataList: []</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    getDataList () {</span><br><span class="line">      ajax.get(SightApis.sightListUrl, {</span><br><span class="line">        params: {</span><br><span class="line">          is_top: 1</span><br><span class="line">        }</span><br><span class="line">      }).then(({ data }) =&gt; {</span><br><span class="line">        this.dataList = data.objects</span><br><span class="line">      })</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  created () {</span><br><span class="line">    this.getDataList()</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style lang=&quot;less&quot;&gt;</span><br><span class="line">.home-fine-box {</span><br><span class="line">  padding: 0 10px;</span><br><span class="line">  .van-cell {</span><br><span class="line">    padding: 10px 0;</span><br><span class="line">  }</span><br><span class="line">  .box-main {</span><br><span class="line">    padding-bottom: 50px;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>Hot.vue</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">javascript&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;home-hot-box&quot;&gt;</span><br><span class="line">        &lt;!-- &#x5BFC;&#x822A; --&gt;</span><br><span class="line">        &lt;van-cell</span><br><span class="line">          icon=&quot;/static/home/hot/fire.png&quot;</span><br><span class="line">          title=&quot;&#x70ED;&#x95E8;&#x63A8;&#x8350;&quot;</span><br><span class="line">          title-style=&quot;text-align:left&quot;</span><br><span class="line">          value=&quot;&#x5168;&#x90E8;&#x699C;&#x5355;&quot;</span><br><span class="line">          is-link /&gt;</span><br><span class="line">        &lt;!-- &#x5217;&#x8868; --&gt;</span><br><span class="line">        &lt;div class=&quot;box-main&quot;&gt;</span><br><span class="line">            &lt;a href=&quot;#&quot; class=&quot;hot-item&quot;</span><br><span class="line">              v-for=&quot;item in dataList&quot;</span><br><span class="line">              :key=&quot;item.id&quot;&gt;</span><br><span class="line">                &lt;div class=&quot;img&quot;&gt;</span><br><span class="line">                    &lt;span&gt;&lt;/span&gt;</span><br><span class="line">                    &lt;img :src=&quot;item.main_img&quot; alt=&quot;&quot;&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;h5 class=&quot;van-ellipsis&quot;&gt;{{ item.name }}&lt;/h5&gt;</span><br><span class="line">                &lt;div class=&quot;line-price&quot;&gt;</span><br><span class="line">                    &lt;span class=&quot;price&quot;&gt;&#xFFE5;{{ item.min_price }}&lt;/span&gt;&#x8D77;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/a&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import { ajax } from &apos;@/utils/ajax&apos;</span><br><span class="line">import { SightApis } from &apos;@/utils/apis&apos;</span><br><span class="line">export default {</span><br><span class="line">  data () {</span><br><span class="line">    return {</span><br><span class="line">      dataList: []</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    getDataList () {</span><br><span class="line">      ajax.get(SightApis.sightListUrl, {</span><br><span class="line">        params: {</span><br><span class="line">          is_hot: 1</span><br><span class="line">        }</span><br><span class="line">      }).then(({ data }) =&gt; {</span><br><span class="line">        this.dataList = data.objects</span><br><span class="line">      })</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  created () {</span><br><span class="line">    // &#x67E5;&#x8BE2;&#x63A5;&#x53E3;&#x6570;&#x636E;</span><br><span class="line">    this.getDataList()</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style lang=&quot;less&quot;&gt;</span><br><span class="line">.home-hot-box {</span><br><span class="line">  padding: 0 10px;</span><br><span class="line">  .van-cell {</span><br><span class="line">    padding: 10px 0;</span><br><span class="line">  }</span><br><span class="line">  .box-main {</span><br><span class="line">    width: 100%;</span><br><span class="line">    display: flex;</span><br><span class="line">    padding-top: 10px;</span><br><span class="line">    overflow-x: scroll;</span><br><span class="line">  }</span><br><span class="line">  .hot-item {</span><br><span class="line">    display: flex;</span><br><span class="line">    flex-direction: column;</span><br><span class="line">    width: 100px;</span><br><span class="line">    margin-right: 10px;</span><br><span class="line">    padding-bottom: 10px;</span><br><span class="line"></span><br><span class="line">    .img {</span><br><span class="line">      position: relative;</span><br><span class="line"></span><br><span class="line">      span {</span><br><span class="line">        position: absolute;</span><br><span class="line">        left: 0;</span><br><span class="line">        top: 0;</span><br><span class="line">        display: inline-block;</span><br><span class="line">        width: 42px;</span><br><span class="line">        height: 20px;</span><br><span class="line">        z-index: 10;</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      img {</span><br><span class="line">        width: 100px;</span><br><span class="line">        height: 100px;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    h5 {</span><br><span class="line">      color: #212121;</span><br><span class="line">      padding: 2px 0;</span><br><span class="line">      font-size: 12px;</span><br><span class="line">      margin: 0;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    .line-price {</span><br><span class="line">      color: #212121;</span><br><span class="line">      font-size: 12px;</span><br><span class="line">      .price {</span><br><span class="line">        color: #f50;</span><br><span class="line">        font-size: 13px;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">    &amp;:nth-child(1) .img span {</span><br><span class="line">      background: url(/static/home/hot/top1.png) no-repeat;</span><br><span class="line">      background-size: 100% auto;</span><br><span class="line">    }</span><br><span class="line">    &amp;:nth-child(2) .img span {</span><br><span class="line">      background: url(/static/home/hot/top2.png) no-repeat;</span><br><span class="line">      background-size: 100% auto;</span><br><span class="line">    }</span><br><span class="line">    &amp;:nth-child(3) .img span {</span><br><span class="line">      background: url(/static/home/hot/top3.png) no-repeat;</span><br><span class="line">      background-size: 100% auto;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>&#x6548;&#x679C;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p7/raw/master/img/ffe8c4634d01325eb388875eb3989abeeccd75c87908aac98cc8543bcf969a71" alt="image-20211125194438312"></p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/86dc0de5b1ee40f315739d94c26571a2.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7034683672154341384.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7034683672154341384.html" itemprop="url">头脑风暴之最近的请求次数</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-11-26T09:25:52+08:00">
                2021-11-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x300C;&#x8FD9;&#x662F;&#x6211;&#x53C2;&#x4E0E;11&#x6708;&#x66F4;&#x6587;&#x6311;&#x6218;&#x7684;&#x7B2C;26&#x5929;&#xFF0C;&#x6D3B;&#x52A8;&#x8BE6;&#x60C5;&#x67E5;&#x770B;&#xFF1A;<a href="https://dev.newban.cn/7023643374569816095/">2021&#x6700;&#x540E;&#x4E00;&#x6B21;&#x66F4;&#x6587;&#x6311;&#x6218;</a>&#x300D;</p>
<h2 id="&#x9898;&#x76EE;&#xFF1A;"><a href="#&#x9898;&#x76EE;&#xFF1A;" class="headerlink" title="&#x9898;&#x76EE;&#xFF1A;"></a>&#x9898;&#x76EE;&#xFF1A;</h2><p>&#x5199;&#x4E00;&#x4E2A; RecentCounter &#x7C7B;&#x6765;&#x8BA1;&#x7B97;&#x7279;&#x5B9A;&#x65F6;&#x95F4;&#x8303;&#x56F4;&#x5185;&#x6700;&#x8FD1;&#x7684;&#x8BF7;&#x6C42;&#x3002;</p>
<p>&#x8BF7;&#x4F60;&#x5B9E;&#x73B0; RecentCounter &#x7C7B;&#xFF1A;</p>
<p>RecentCounter() &#x521D;&#x59CB;&#x5316;&#x8BA1;&#x6570;&#x5668;&#xFF0C;&#x8BF7;&#x6C42;&#x6570;&#x4E3A; 0 &#x3002;<br>int ping(int t) &#x5728;&#x65F6;&#x95F4; t &#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x65B0;&#x8BF7;&#x6C42;&#xFF0C;&#x5176;&#x4E2D; t &#x8868;&#x793A;&#x4EE5;&#x6BEB;&#x79D2;&#x4E3A;&#x5355;&#x4F4D;&#x7684;&#x67D0;&#x4E2A;&#x65F6;&#x95F4;&#xFF0C;&#x5E76;&#x8FD4;&#x56DE;&#x8FC7;&#x53BB; 3000 &#x6BEB;&#x79D2;&#x5185;&#x53D1;&#x751F;&#x7684;&#x6240;&#x6709;&#x8BF7;&#x6C42;&#x6570;&#xFF08;&#x5305;&#x62EC;&#x65B0;&#x8BF7;&#x6C42;&#xFF09;&#x3002;&#x786E;&#x5207;&#x5730;&#x8BF4;&#xFF0C;&#x8FD4;&#x56DE;&#x5728; [t-3000, t] &#x5185;&#x53D1;&#x751F;&#x7684;&#x8BF7;&#x6C42;&#x6570;&#x3002;<br>&#x4FDD;&#x8BC1; &#x6BCF;&#x6B21;&#x5BF9; ping &#x7684;&#x8C03;&#x7528;&#x90FD;&#x4F7F;&#x7528;&#x6BD4;&#x4E4B;&#x524D;&#x66F4;&#x5927;&#x7684; t &#x503C;&#x3002;</p>
<p>&#x793A;&#x4F8B;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">scss&#x590D;&#x5236;&#x4EE3;&#x7801;&#x8F93;&#x5165;&#xFF1A;</span><br><span class="line">[&quot;RecentCounter&quot;, &quot;ping&quot;, &quot;ping&quot;, &quot;ping&quot;, &quot;ping&quot;]</span><br><span class="line">[[], [1], [100], [3001], [3002]]</span><br><span class="line">&#x8F93;&#x51FA;&#xFF1A;</span><br><span class="line">[null, 1, 2, 3, 3]</span><br><span class="line"></span><br><span class="line">&#x89E3;&#x91CA;&#xFF1A;</span><br><span class="line">RecentCounter recentCounter = new RecentCounter();</span><br><span class="line">recentCounter.ping(1);     // requests = [1]&#xFF0C;&#x8303;&#x56F4;&#x662F; [-2999,1]&#xFF0C;&#x8FD4;&#x56DE; 1</span><br><span class="line">recentCounter.ping(100);   // requests = [1, 100]&#xFF0C;&#x8303;&#x56F4;&#x662F; [-2900,100]&#xFF0C;&#x8FD4;&#x56DE; 2</span><br><span class="line">recentCounter.ping(3001);  // requests = [1, 100, 3001]&#xFF0C;&#x8303;&#x56F4;&#x662F; [1,3001]&#xFF0C;&#x8FD4;&#x56DE; 3</span><br><span class="line">recentCounter.ping(3002);  // requests = [1, 100, 3001, 3002]&#xFF0C;&#x8303;&#x56F4;&#x662F; [2,3002]&#xFF0C;&#x8FD4;&#x56DE; 3</span><br></pre></td></tr></table></figure>

<h2 id="&#x89E3;&#x51B3;&#x601D;&#x8DEF;"><a href="#&#x89E3;&#x51B3;&#x601D;&#x8DEF;" class="headerlink" title="&#x89E3;&#x51B3;&#x601D;&#x8DEF;"></a>&#x89E3;&#x51B3;&#x601D;&#x8DEF;</h2><p>&#x9898;&#x76EE;&#x610F;&#x601D;&#x5C31;&#x662F;&#x5F80;&#x961F;&#x5217;&#x91CC;&#x5B58;&#x653E;&#x5143;&#x7D20;&#x554A;&#xFF0C;&#x6BCF;&#x6B21;ping&#x5C31;&#x5B58;&#x4E00;&#x4E2A;&#x6570;&#xFF0C;&#x7136;&#x540E;&#x5B58;&#x7684;&#x65F6;&#x5019;&#x770B;&#x4E00;&#x4E0B;&#x4E4B;&#x524D;&#x7684;&#x6570;&#x662F;&#x5426;&#x5728;t-3000&#x4E4B;&#x5916;&#x4E86;&#xFF0C;&#x662F;&#x5C31;&#x5220;&#x9664;&#xFF1B;</p>
<p>&#x6BD4;&#x5982;&#x9898;&#x76EE;&#x7ED9;&#x7684;&#x4F8B;&#x5B50;&#xFF1A;</p>
<p>&#x8F93;&#x5165;&#xFF1A;<br>[&#x201C;RecentCounter&#x201D;, &#x201C;ping&#x201D;, &#x201C;ping&#x201D;, &#x201C;ping&#x201D;, &#x201C;ping&#x201D;]<br>[[], [1], [100], [3001], [3002]]<br>&#x8F93;&#x51FA;&#xFF1A;<br>[null, 1, 2, 3, 3]<br>&#x5C31;&#x662F;&#x7B2C;&#x4E00;&#x6B21;&#x5B58;&#x4E2A;1&#xFF0C;&#x7B2C;&#x4E8C;&#x6B21;&#x5B58;&#x4E2A;100&#x2026;&#x2026;</p>
<p>&#x7136;&#x540E;&#x6BCF;&#x6B21;&#x5B58;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x770B;&#x770B;&#x4E4B;&#x524D;&#x5B58;&#x7684;&#x5143;&#x7D20;&#xFF0C;&#x6709;&#x591A;&#x5C11;&#x4E2A;&#x5728;&#x8FD9;&#x6B21;&#x5B58;&#x7684; t &#x5230;t-3000&#x4E4B;&#x95F4;&#xFF1B;</p>
<p>&#x5B58;1&#x7684;&#x65F6;&#x5019;&#xFF0C;1&#x5728;[-2999,1]&#x4E4B;&#x95F4;&#xFF0C;&#x5C31;&#x8FD9;&#x4E00;&#x4E2A;&#x6570;&#xFF0C;&#x6240;&#x4EE5;&#x8BF4;&#x8FD4;&#x56DE;&#x6570;&#x76EE;1&#xFF1B;<br>&#x2026;&#x2026;</p>
<p>&#x5B58;3002&#x7684;&#x65F6;&#x5019;&#x5C31;&#x5220;&#x9664;1&#xFF0C;&#x56E0;&#x4E3A;1&#x4E0D;&#x5728;[2,3002]&#x4E4B;&#x95F4;&#xFF0C;&#x800C;100&#xFF0C;3001&#xFF0C;3002&#x90FD;&#x662F;&#x5728;[2,3002]&#x4E4B;&#x95F4;&#xFF0C;&#x5C31;&#x8FD4;&#x56DE;&#x6570;&#x76EE;3&#xFF1B;</p>
<h2 id="&#x4EE3;&#x7801;&#x5B9E;&#x73B0;"><a href="#&#x4EE3;&#x7801;&#x5B9E;&#x73B0;" class="headerlink" title="&#x4EE3;&#x7801;&#x5B9E;&#x73B0;"></a>&#x4EE3;&#x7801;&#x5B9E;&#x73B0;</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;class RecentCounter {</span><br><span class="line">    Queue&lt;Integer&gt; q;</span><br><span class="line">    public RecentCounter() {</span><br><span class="line">        q = new LinkedList();</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    public int ping(int t) {</span><br><span class="line">        q.add(t);</span><br><span class="line">        while (q.peek() &lt; t - 3000) {</span><br><span class="line">            q.poll();</span><br><span class="line">        }</span><br><span class="line">        return q.size();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h2 id="&#x6700;&#x540E;"><a href="#&#x6700;&#x540E;" class="headerlink" title="&#x6700;&#x540E;"></a>&#x6700;&#x540E;</h2><ul>
<li>&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF1A;O(Q)&#xFF0C;&#x5176;&#x4E2D; QQ &#x662F; ping &#x7684;&#x6B21;&#x6570;&#x3002;</li>
<li>&#x7A7A;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF1A;O(W)&#xFF0C;&#x5176;&#x4E2D; W = 3000 &#x662F;&#x961F;&#x5217;&#x4E2D;&#x6700;&#x591A;&#x5B58;&#x50A8;&#x7684; ping &#x7684;&#x8BB0;&#x5F55;&#x6570;&#x76EE;&#x3002;</li>
</ul>
<p>**<strong>&#x5F80;&#x671F;&#x6587;&#x7AE0;&#xFF1A;</strong></p>
<ul>
<li><a href="https://dev.newban.cn/7033199647501844494">&#x597D;&#x770B;&#x7684;&#x56FE;&#x8868;&#x600E;&#x4E48;&#x753B;&#xFF0C;&#x770B;&#x5B8C;&#x8FD9;&#x51E0;&#x4E2A; API &#x4F60;&#x5C31;&#x4F1A;&#x4E86;</a></li>
<li><a href="https://dev.newban.cn/7030031399780352036">&#x4E8C;&#x53C9;&#x6811;&#x5237;&#x9898;&#x603B;&#x7ED3;&#xFF1A;&#x4E8C;&#x53C9;&#x641C;&#x7D22;&#x6811;&#x7684;&#x5C5E;&#x6027;</a></li>
<li><a href="https://dev.newban.cn/7027610133165572103">&#x4E8C;&#x53C9;&#x6811;&#x603B;&#x7ED3;&#xFF1A;&#x4E8C;&#x53C9;&#x6811;&#x7684;&#x5C5E;&#x6027;</a></li>
<li><a href="https://dev.newban.cn/7027970630309904421">&#x4E8C;&#x53C9;&#x6811;&#x603B;&#x7ED3;&#xFF1A;&#x4E8C;&#x53C9;&#x6811;&#x7684;&#x4FEE;&#x6539;&#x4E0E;&#x6784;&#x9020;</a></li>
<li><a href="https://dev.newban.cn/7023974581446639630">StoreKit2 &#x6709;&#x8FD9;&#x4E48;&#x9999;&#xFF1F;&#x55EF;&#xFF0C;&#x6211;&#x8BD5;&#x8FC7;&#x4E86;&#xFF0C;&#x771F;&#x9999;</a></li>
<li><a href="https://dev.newban.cn/7023060069038161934">&#x770B;&#x5B8C;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#xFF0C;&#x518D;&#x4E5F;&#x4E0D;&#x6015;&#x9762;&#x8BD5;&#x5B98;&#x95EE;&#x6211;&#x5982;&#x4F55;&#x6784;&#x9020;&#x4E8C;&#x53C9;&#x6811;&#x5566;&#xFF01;</a></li>
<li><a href="https://dev.newban.cn/7006540242777800741">&#x90A3;&#x5E2E;&#x505A;&#x6E38;&#x620F;&#x7684;&#x53C8;&#x60F3;&#x8BA9;&#x5927;&#x5BB6;&#x6C2A;&#x91D1;&#xFF0C;&#x592A;&#x574F;&#x4E86;&#xFF01;</a></li>
<li><a href="https://dev.newban.cn/6984062100062601247">&#x624B;&#x628A;&#x624B;&#x5E26;&#x4F60;&#x64B8;&#x4E00;&#x4E2A;&#x7F51;&#x6613;&#x4E91;&#x97F3;&#x4E50;&#x9996;&#x9875; | &#x9002;&#x914D;&#x7BC7;</a></li>
<li><a href="https://dev.newban.cn/6981438462318608391">&#x624B;&#x628A;&#x624B;&#x5E26;&#x4F60;&#x64B8;&#x4E00;&#x4E2A;&#x7F51;&#x6613;&#x4E91;&#x97F3;&#x4E50;&#x9996;&#x9875;&#xFF08;&#x4E09;&#xFF09;</a></li>
<li><a href="https://dev.newban.cn/6979971385191825445">&#x624B;&#x628A;&#x624B;&#x5E26;&#x4F60;&#x64B8;&#x4E00;&#x4E2A;&#x7F51;&#x6613;&#x4E91;&#x97F3;&#x4E50;&#x9996;&#x9875;&#xFF08;&#x4E8C;&#xFF09;</a></li>
<li><a href="https://dev.newban.cn/6978374782664310792">&#x624B;&#x628A;&#x624B;&#x5E26;&#x4F60;&#x64B8;&#x4E00;&#x4E2A;&#x7F51;&#x6613;&#x4E91;&#x97F3;&#x4E50;&#x9996;&#x9875;&#xFF08;&#x4E00;&#xFF09;</a></li>
<li><a href="https://dev.newban.cn/6965856152315756551">&#x4EE3;&#x7801;&#x8981;&#x5199;&#x6CE8;&#x91CA;&#x5417;&#xFF1F;&#x5199;&#x4F60;&#x5C31;&#x8F93;&#x4E86;</a></li>
<li><a href="https://dev.newban.cn/6960840387216801799">Codable&#x53D1;&#x5E03;&#x8FD9;&#x4E48;&#x4E45;&#x6211;&#x5C31;&#x4E0D;&#x5B66;&#xFF0C;&#x6478;&#x9C7C;&#x723D;&#x6B6A;&#x6B6A;&#xFF0C;&#x54CE;~&#x5C31;&#x662F;&#x73A9;&#x513F;</a></li>
<li><a href="https://dev.newban.cn/6952682593372340237">iOS &#x4F18;&#x96C5;&#x7684;&#x5904;&#x7406;&#x7F51;&#x7EDC;&#x6570;&#x636E;&#xFF0C;&#x4F60;&#x771F;&#x7684;&#x4F1A;&#x5417;&#xFF1F;&#x4E0D;&#x5982;&#x770B;&#x770B;&#x8FD9;&#x7BC7;</a></li>
<li><a href="https://dev.newban.cn/6944994974614323213">UICollectionView &#x81EA;&#x5B9A;&#x4E49;&#x5E03;&#x5C40;&#xFF01;&#x770B;&#x8FD9;&#x7BC7;&#x5C31;&#x591F;&#x4E86;</a></li>
</ul>
<p><strong>&#x8BF7;&#x4F60;&#x559D;&#x676F; &#x2615;&#xFE0F; &#x70B9;&#x8D5E; + &#x5173;&#x6CE8;&#x54E6;&#xFF5E;</strong></p>
<ol>
<li>&#x9605;&#x8BFB;&#x5B8C;&#x8BB0;&#x5F97;&#x7ED9;&#x6211;&#x70B9;&#x4E2A;&#x8D5E;&#x54E6;&#xFF0C;&#x6709;&#x1F44D; &#x6709;&#x52A8;&#x529B;</li>
<li>&#x5173;&#x6CE8;&#x516C;&#x4F17;&#x53F7;&#x2014; <a href="/external_links/12e94b0eb6e065b6200852afcc62d01b.html" target="blank" rel="noopener">HelloWorld&#x6770;&#x5C11;</a>&#xFF0C;&#x7B2C;&#x4E00;&#x65F6;&#x95F4;&#x63A8;&#x9001;&#x65B0;&#x59FF;&#x52BF;</li>
</ol>
<blockquote>
<p>&#x6700;&#x540E;&#xFF0C;&#x521B;&#x4F5C;&#x4E0D;&#x6613;&#xFF0C;&#x5982;&#x679C;&#x5BF9;&#x5927;&#x5BB6;&#x6709;&#x6240;&#x5E2E;&#x52A9;&#xFF0C;&#x5E0C;&#x671B;&#x5927;&#x5BB6;&#x70B9;&#x8D5E;&#x652F;&#x6301;&#xFF0C;&#x6709;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#x4E5F;&#x53EF;&#x4EE5;&#x5728;&#x8BC4;&#x8BBA;&#x533A;&#x91CC;&#x8BA8;&#x8BBA;&#x1F604;&#xFF5E;**</p>
</blockquote>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/ffb9f41c7f8361a49745a06aacecfbfa.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../7034682215833272334.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../7034682215833272334.html" itemprop="url">OpenCV、NumPy和Matplotlib直方图比较</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-11-26T09:20:02+08:00">
                2021-11-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x300C;&#x8FD9;&#x662F;&#x6211;&#x53C2;&#x4E0E;11&#x6708;&#x66F4;&#x6587;&#x6311;&#x6218;&#x7684;&#x7B2C;26&#x5929;&#xFF0C;&#x6D3B;&#x52A8;&#x8BE6;&#x60C5;&#x67E5;&#x770B;&#xFF1A;<a href="https://dev.newban.cn/7023643374569816095">2021&#x6700;&#x540E;&#x4E00;&#x6B21;&#x66F4;&#x6587;&#x6311;&#x6218;</a>&#x300D;</p>
<h2 id="&#x524D;&#x8A00;"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00;</h2><p>&#x4F7F;&#x7528; <code>OpenCV</code> &#x63D0;&#x4F9B;&#x7684; <code>cv2.calcHist()</code> &#x51FD;&#x6570;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x8BA1;&#x7B97;&#x76F4;&#x65B9;&#x56FE;&#x3002;&#x6B64;&#x5916;&#xFF0C;<code>NumPy</code> &#x548C; <code>Matplotlib</code> &#x540C;&#x6837;&#x4E5F;&#x4E3A;&#x521B;&#x5EFA;&#x76F4;&#x65B9;&#x56FE;&#x63D0;&#x4F9B;&#x4E86;&#x7C7B;&#x4F3C;&#x7684;&#x51FD;&#x6570;&#x3002;&#x51FA;&#x4E8E;&#x63D0;&#x9AD8;&#x6027;&#x80FD;&#x76EE;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x6765;&#x6BD4;&#x8F83;&#x8FD9;&#x4E9B;&#x51FD;&#x6570;&#xFF0C;&#x4F7F;&#x7528; <code>OpenCV</code>&#x3001;<code>NumPy</code> &#x548C; <code>Matplotlib</code> &#x521B;&#x5EFA;&#x76F4;&#x65B9;&#x56FE;&#xFF0C;&#x7136;&#x540E;&#x6D4B;&#x91CF;&#x6BCF;&#x4E2A;&#x76F4;&#x65B9;&#x56FE;&#x8BA1;&#x7B97;&#x7684;&#x6267;&#x884C;&#x65F6;&#x95F4;&#x5E76;&#x5C06;&#x7ED3;&#x679C;&#x7ED8;&#x5236;&#x5728;&#x56FE;&#x5F62;&#x4E2D;&#xFF0C;&#x6BD4;&#x8F83;&#x4E0D;&#x540C;&#x5E93;&#x4E2D;&#x8BA1;&#x7B97;&#x76F4;&#x65B9;&#x56FE;&#x7684;&#x4E0D;&#x540C;&#x6548;&#x7387;&#x3002;</p>
<h2 id="OpenCV&#x3001;NumPy&#x548C;Matplotlib&#x7070;&#x5EA6;&#x76F4;&#x65B9;&#x56FE;&#x6BD4;&#x8F83;"><a href="#OpenCV&#x3001;NumPy&#x548C;Matplotlib&#x7070;&#x5EA6;&#x76F4;&#x65B9;&#x56FE;&#x6BD4;&#x8F83;" class="headerlink" title="OpenCV&#x3001;NumPy&#x548C;Matplotlib&#x7070;&#x5EA6;&#x76F4;&#x65B9;&#x56FE;&#x6BD4;&#x8F83;"></a>OpenCV&#x3001;NumPy&#x548C;Matplotlib&#x7070;&#x5EA6;&#x76F4;&#x65B9;&#x56FE;&#x6BD4;&#x8F83;</h2><p>&#x4F7F;&#x7528; <code>timeit.default_timer</code> &#x6D4B;&#x91CF;&#x6267;&#x884C;&#x65F6;&#x95F4;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4F1A;&#x81EA;&#x52A8;&#x63D0;&#x4F9B;&#x7CFB;&#x7EDF;&#x5E73;&#x53F0;&#x548C; <code>Python</code> &#x7248;&#x672C;&#x4E0A;&#x53EF;&#x7528;&#x7684;&#x6700;&#x4F73;&#x65F6;&#x949F;&#xFF0C;&#x4E3A;&#x4E86;&#x4F7F;&#x7528; <code>timeit.default_timer</code> &#x6D4B;&#x91CF;&#x6267;&#x884C;&#x65F6;&#x95F4;&#xFF0C;&#x9996;&#x5148;&#x9700;&#x8981;&#x5C06;&#x5176;&#x5BFC;&#x5165;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python&#x590D;&#x5236;&#x4EE3;&#x7801;from timeit import default_timer as timer</span><br></pre></td></tr></table></figure>

<p>&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x65B9;&#x6CD5;&#x8BA1;&#x7B97;&#x7A0B;&#x5E8F;&#x7684;&#x6267;&#x884C;&#x65F6;&#x95F4;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">python&#x590D;&#x5236;&#x4EE3;&#x7801;start = timer()</span><br><span class="line"># &#x7A0B;&#x5E8F;&#x6267;&#x884C;</span><br><span class="line">end = timer()</span><br><span class="line">execution_time = start - end</span><br></pre></td></tr></table></figure>

<p>&#x8003;&#x8651;&#x5230; <code>default_timer()</code> &#x6D4B;&#x91CF;&#x503C;&#x53EF;&#x80FD;&#x4F1A;&#x53D7;&#x5230;&#x540C;&#x65F6;&#x8FD0;&#x884C;&#x7684;&#x5176;&#x4ED6;&#x7A0B;&#x5E8F;&#x7684;&#x5F71;&#x54CD;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x83B7;&#x53D6;&#x51C6;&#x786E;&#x8BA1;&#x65F6;&#x7684;&#x6700;&#x4F73;&#x65B9;&#x6CD5;&#x662F;&#x91CD;&#x590D;&#x6570;&#x6B21;&#x5E76;&#x4F7F;&#x7528;&#x6700;&#x4F73;&#x65F6;&#x95F4;&#x3002;&#x5F53;&#x8BA9;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x91C7;&#x7528;&#x5176;&#x4ED6;&#x65B9;&#x6CD5;&#x6765;&#x6D4B;&#x91CF;&#x66F4;&#x52A0;&#x7CBE;&#x786E;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x4F8B;&#x5982;&#x591A;&#x6B21;&#x91CD;&#x590D;&#x8FD0;&#x884C;&#x53D6;&#x5E73;&#x5747;&#x503C;&#xFF0C;&#x6216;&#x8005;&#x5176;&#x4ED6;&#x66F4;&#x52A0;&#x6709;&#x6548;&#x907F;&#x514D;&#x5F02;&#x5E38;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5728;&#x8FD9;&#x91CC;&#x4E3A;&#x4E86;&#x7B80;&#x5355;&#x8D77;&#x89C1;&#xFF0C;&#x6211;&#x4EEC;&#x91CD;&#x590D;&#x6570;&#x6B21;&#x5E76;&#x4F7F;&#x7528;&#x6700;&#x4F73;&#x65F6;&#x95F4;&#x3002;</p>
<p>&#x800C;&#x4E3A;&#x4E86;&#x8BA1;&#x7B97;&#x548C;&#x6BD4;&#x8F83;&#x76F4;&#x65B9;&#x56FE;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x51FD;&#x6570;&#xFF1A;</p>
<ol>
<li><code>OpenCV</code> &#x63D0;&#x4F9B; <code>cv2.calcHist()</code> &#x51FD;&#x6570;</li>
<li><code>NumPy</code> &#x63D0;&#x4F9B;&#x7684; <code>np.histogram()</code> &#x51FD;&#x6570;</li>
<li><code>Matplotlib</code> &#x63D0;&#x4F9B;&#x7684; <code>plt.hist()</code> &#x51FD;&#x6570;</li>
</ol>
<p>&#x7528;&#x4E8E;&#x8BA1;&#x7B97;&#x4E0A;&#x8FF0;&#x6BCF;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x6267;&#x884C;&#x65F6;&#x95F4;&#x7684;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#x6240;&#x793A;&#x3002;&#x9996;&#x5148;&#xFF0C;&#x5BFC;&#x5165;&#x6240;&#x9700;&#x5E93;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">python&#x590D;&#x5236;&#x4EE3;&#x7801;import numpy as np</span><br><span class="line">import cv2</span><br><span class="line">from matplotlib import pyplot as plt</span><br><span class="line">from timeit import default_timer as timer</span><br></pre></td></tr></table></figure>

<p>&#x7136;&#x540E;&#x7F16;&#x5199;&#x53EF;&#x89C6;&#x5316;&#x51FD;&#x6570;&#xFF0C;&#x5728;&#x540C;&#x4E00;&#x56FE;&#x4E2D;&#x663E;&#x793A;&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#xFF0C;&#x8FDB;&#x884C;&#x66F4;&#x597D;&#x7684;&#x5BF9;&#x6BD4;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">python&#x590D;&#x5236;&#x4EE3;&#x7801;def show_img_with_matplotlib(color_img, title, pos):</span><br><span class="line">    img_RGB = color_img[:, :, ::-1]</span><br><span class="line"></span><br><span class="line">    ax = plt.subplot(1, 4, pos)</span><br><span class="line">    plt.imshow(img_RGB)</span><br><span class="line">    plt.title(title)</span><br><span class="line">    plt.axis(&apos;off&apos;)</span><br><span class="line"></span><br><span class="line">def show_hist_with_matplotlib_gray(hist, title, pos, color):</span><br><span class="line">    ax = plt.subplot(1, 4, pos)</span><br><span class="line">    plt.title(title)</span><br><span class="line">    plt.xlabel(&quot;bins&quot;)</span><br><span class="line">    plt.ylabel(&quot;number of pixels&quot;)</span><br><span class="line">    plt.xlim([0, 256])</span><br><span class="line">    plt.plot(hist, color=color)</span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(18, 6))</span><br><span class="line">plt.suptitle(&quot;Comparing histogram (OpenCV, numpy, matplotlib)&quot;, fontsize=14, fontweight=&apos;bold&apos;)</span><br></pre></td></tr></table></figure>

<p>&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x5C31;&#x662F;&#x7A0B;&#x5E8F;&#x7684;&#x6700;&#x5173;&#x952E;&#x90E8;&#x5206;&#x4E86;&#xFF0C;&#x4F7F;&#x7528;&#x4E0D;&#x540C;&#x5E93;&#x4E2D;&#x8BA1;&#x7B97;&#x76F4;&#x65B9;&#x56FE;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5E76;&#x83B7;&#x53D6;&#x7A0B;&#x5E8F;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;image = cv2.imread(&apos;example.png&apos;)</span><br><span class="line">gray_image = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)</span><br><span class="line"></span><br><span class="line"># &#x8BA1;&#x7B97; cv2.calcHist() &#x6267;&#x884C;&#x65F6;&#x95F4;</span><br><span class="line">start = timer()</span><br><span class="line">hist = cv2.calcHist([gray_image], [0], None, [256], [0, 256])</span><br><span class="line">end = timer()</span><br><span class="line"># &#x4E58;&#x4EE5;1000&#x5C06;&#x5355;&#x4F4D;&#x8F6C;&#x6362;&#x4E3A;&#x6BEB;&#x79D2;</span><br><span class="line">exec_time_calc_hist = (end - start) * 1000</span><br><span class="line"></span><br><span class="line"># &#x8BA1;&#x7B97; np.histogram() &#x6267;&#x884C;&#x65F6;&#x95F4;</span><br><span class="line">start = timer()</span><br><span class="line">hist_np, bin_np = np.histogram(gray_image.ravel(), 256, [0, 256])</span><br><span class="line">end = timer()</span><br><span class="line">exec_time_np_hist = (end - start) * 1000</span><br><span class="line"></span><br><span class="line"># &#x8BA1;&#x7B97; plt.hist() &#x6267;&#x884C;&#x65F6;&#x95F4;</span><br><span class="line">start = timer()</span><br><span class="line"># &#x8C03;&#x7528; plt.hist() &#x8BA1;&#x7B97;&#x76F4;&#x65B9;&#x56FE;</span><br><span class="line">(n, bins, patches) = plt.hist(gray_image.ravel(), 256, [0, 256])</span><br><span class="line">end = timer()</span><br><span class="line">exec_time_plt_hist = (end - start) * 1000</span><br></pre></td></tr></table></figure>

<p>&#x6700;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x7ED8;&#x5236;&#x7070;&#x5EA6;&#x56FE;&#x53CA;&#x5176;&#x76F4;&#x65B9;&#x56FE;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">python&#x590D;&#x5236;&#x4EE3;&#x7801;how_img_with_matplotlib(cv2.cvtColor(gray_image, cv2.COLOR_GRAY2BGR), &quot;gray&quot;, 1)</span><br><span class="line">show_hist_with_matplotlib_gray(hist, &quot;grayscale histogram (OpenCV)-&quot; + str(&apos;% 6.2f ms&apos; % exec_time_calc_hist), 2, &apos;m&apos;)</span><br><span class="line">show_hist_with_matplotlib_gray(hist_np, &quot;grayscale histogram (Numpy)-&quot; + str(&apos;% 6.2f ms&apos; % exec_time_np_hist), 3, &apos;m&apos;)</span><br><span class="line">show_hist_with_matplotlib_gray(n, &quot;grayscale histogram (Matplotlib)-&quot; + str(&apos;% 6.2f ms&apos; % exec_time_plt_hist), 4, &apos;m&apos;)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/d2bff736f4a0aa45b8ac474461073d87186142915647d1dc8bff5263d12b829d" alt="OpenCV&#x3001;NumPy&#x548C;Matplotlib&#x7070;&#x5EA6;&#x76F4;&#x65B9;&#x56FE;&#x6BD4;&#x8F83;"></p>
<p>&#x7531;&#x4E0A;&#x9762;&#x5B9E;&#x4F8B;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;<code>cv2.calcHist()</code> &#x7684;&#x6267;&#x884C;&#x901F;&#x5EA6;&#x6BD4; <code>np.histogram()</code> &#x548C; <code>plt.hist()</code> &#x90FD;&#x5FEB;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x51FA;&#x4E8E;&#x6027;&#x80FD;&#x8003;&#x8651;&#xFF0C;&#x5728;&#x8BA1;&#x7B97;&#x56FE;&#x50CF;&#x76F4;&#x65B9;&#x56FE;&#x65F6;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>OpenCV</code> &#x51FD;&#x6570;&#x3002;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/cbfc1218fccf74eabe6ce185ac969360.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="../183/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="../../">1</a><span class="space">&hellip;</span><a class="page-number" href="../183/">183</a><span class="page-number current">184</span><a class="page-number" href="../185/">185</a><span class="space">&hellip;</span><a class="page-number" href="../399/">399</a><a class="extend next" rel="next" href="../185/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">开发者博客</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="https://dev.newban.cn/archives/">
              
                  <span class="site-state-item-count">3990</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">1304</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="../../atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">开发者博客</span>
  <div>
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
  </div>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




  <script type="text/javascript" async src="js/src/mermaid.min.js"></script>
  <script>
  if (window.mermaid) {
        var mermaid_config = {
            startOnLoad: true,
            theme: 'default',
            flowchart:{
                useMaxWidth: false,
                htmlLabels: true
            }                
        }
        mermaid.initialize(mermaid_config);
  }
  </script>
  

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="../../lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="../../lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="../../lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="../../lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="../../lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="../../lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="../../js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="../../js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="../../js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
