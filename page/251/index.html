<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">
<meta name="referrer" content="never">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="../../lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="../../lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="../../css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="../../images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="../../images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="../../images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="../../images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">





  <link rel="alternate" href="../../atom.xml" title="开发者博客 – IT技术 尽在开发者博客" type="application/atom+xml">






<meta property="og:type" content="website">
<meta property="og:title" content="开发者博客 – IT技术 尽在开发者博客">
<meta property="og:url" content="https://dev.newban.cn/page/251/index.html">
<meta property="og:site_name" content="开发者博客 – IT技术 尽在开发者博客">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="开发者博客 – IT技术 尽在开发者博客">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>
<!--谷歌广告验证代码-->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-2626449904708114",
          enable_page_level_ads: true
     });
</script>
<!--谷歌广告验证代码-->



  <link rel="canonical" href="https://dev.newban.cn/page/251/">





  <title>开发者博客 – IT技术 尽在开发者博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">开发者博客 – IT技术 尽在开发者博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">开发者博客 – 科技是第一生产力</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="http://dev.newban.cn/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="https://dev.newban.cn/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903567715729415.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903567715729415.html" itemprop="url">Python 系列教程（入门系列已写完） FQ Python</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-02-27T20:29:54+08:00">
                2018-02-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>IT &#x884C;&#x4E1A;&#x76F8;&#x5BF9;&#x4E8E;&#x4E00;&#x822C;&#x4F20;&#x7EDF;&#x884C;&#x4E1A;&#xFF0C;&#x53D1;&#x5C55;&#x66F4;&#x65B0;&#x901F;&#x5EA6;&#x66F4;&#x5FEB;&#xFF0C;&#x4E00;&#x65E6;&#x505C;&#x6B62;&#x4E86;&#x5B66;&#x4E60;&#xFF0C;&#x5F88;&#x5FEB;&#x5C31;&#x4F1A;&#x88AB;&#x884C;&#x4E1A;&#x6240;&#x6DD8;&#x6C70;&#xFF0C;&#x4F46;&#x662F;&#xFF0C;&#x6211;&#x4EEC;&#x8981;&#x6E05;&#x695A;&#xFF1A;&#x6DD8;&#x6C70;&#x7684;&#x6C38;&#x8FDC;&#x53EA;&#x662F;&#x90A3;&#x4E9B;&#x521D;&#x7EA7;&#x6C34;&#x5E73;&#x7684;&#x4ECE;&#x4E1A;&#x8005;&#xFF0C;&#x8FC7;&#x786C;&#x6280;&#x672F;&#x7684;&#x4ECE;&#x4E1A;&#x8005;&#x6C38;&#x8FDC;&#x90FD;&#x662F;&#x7A00;&#x7F3A;&#x7684;&#x3002;&#x56E0;&#x6B64;&#x5BF9;&#x4E8E;&#x5B66;&#x4E60;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x662F;&#x8981;&#x8E0F;&#x8E0F;&#x5B9E;&#x5B9E;&#x7684;&#x3002;</p>
<p>&#x81EA;&#x5B66; Python &#xFF0C;&#x4E5F;&#x662F;&#x4E00;&#x6837;&#xFF0C;&#x4E0D;&#x8981;&#x4E00;&#x5F00;&#x59CB;&#x56E0;&#x4E3A;&#x5934;&#x8111;&#x53D1;&#x70ED;&#x5C31;&#x4E0D;&#x505C;&#x5730;&#x6536;&#x85CF;&#x5404;&#x79CD;&#x8D44;&#x6599;&#x7F51;&#x7AD9;&#xFF0C;&#x8D2D;&#x4E70;&#x5404;&#x79CD;&#x4E66;&#x7C4D;&#xFF0C;&#x4E0B;&#x8F7D;&#x4E86;&#x5927;&#x91CF;&#x7684;&#x6559;&#x5B66;&#x89C6;&#x9891;&#xFF0C;&#x8FC7;&#x4E86;&#x51E0;&#x5929;&#xFF0C;&#x5B66;&#x4E60;&#x7684;&#x70ED;&#x60C5;&#x5F00;&#x59CB;&#x892A;&#x53BB;&#xFF0C;&#x518D;&#x8FC7;&#x51E0;&#x4E2A;&#x661F;&#x671F;&#xFF0C;&#x7EC8;&#x4E8E;&#x5B8C;&#x6210;&#x4E86;&#x5B66;&#x4E60;&#x8BFE;&#x7A0B; &#x2014;&#x2014; &#x300A;&#x4ECE;&#x5165;&#x95E8;&#x5230;&#x653E;&#x5F03;&#x300B;&#x3002;&#x6240;&#x4EE5;&#xFF0C;&#x5B66;&#x4E60; Python &#x9700;&#x8981;&#x4E00;&#x6B65;&#x4E00;&#x4E2A;&#x811A;&#x5370;&#xFF0C;&#x8E0F;&#x8E0F;&#x5B9E;&#x5B9E;&#x5730;&#x5B66;&#x3002;</p>
<h1 id="FQ"><a href="#FQ" class="headerlink" title="FQ"></a>FQ</h1><p>&#x5728;&#x8BB2; Python &#x5982;&#x4F55;&#x5165;&#x95E8;&#x4E4B;&#x524D;&#xFF0C;&#x4E2A;&#x4EBA;&#x5EFA;&#x8BAE;&#x6700;&#x597D;&#x6BCF;&#x4E2A;&#x4EBA;&#x90FD;&#x6709;&#x81EA;&#x5DF1;&#x7684; FQ &#x5DE5;&#x5177;&#xFF0C;&#x591A;&#x4F7F;&#x7528; Google &#x641C;&#x7D22;&#xFF0C;&#x591A;&#x53BB;&#x770B;&#x4E00;&#x4E0B;&#x5899;&#x5916;&#x7684;&#x4E16;&#x754C;&#xFF0C;&#x591A;&#x770B; Github &#x4E0A;&#x7684;&#x5F00;&#x6E90;&#x9879;&#x76EE;&#x3002;</p>
<p>&#x81F3;&#x4E8E;&#x5982;&#x4F55; FQ &#xFF0C;&#x8FD9;&#x91CC;&#x63D0;&#x4F9B;&#x4E00;&#x4E0B;&#x6211;&#x7528;&#x8FC7;&#x7684;&#x5DE5;&#x5177;&#xFF1A;<a href="/external_links/48eb42e09b73b219b068330658ad35d1.html" target="blank" rel="noopener">FQ&#x5DE5;&#x5177;&#x96C6;</a></p>
<h1 id="Python-&#x5B66;&#x4E60;&#x8D44;&#x6E90;&#x96C6;"><a href="#Python-&#x5B66;&#x4E60;&#x8D44;&#x6E90;&#x96C6;" class="headerlink" title="Python &#x5B66;&#x4E60;&#x8D44;&#x6E90;&#x96C6;"></a>Python &#x5B66;&#x4E60;&#x8D44;&#x6E90;&#x96C6;</h1><p>&#x76F8;&#x4FE1;&#x5F88;&#x591A;&#x4EBA;&#x5B66;&#x4E60;&#x67D0;&#x95E8;&#x7F16;&#x7A0B;&#x8BED;&#x8A00;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x90FD;&#x4F1A;&#x627E;&#x5404;&#x79CD;&#x5B66;&#x4E60;&#x8D44;&#x6599;&#x3002;&#x8BF4;&#x53E5;&#x5B9E;&#x8BDD;&#xFF0C;&#x8D44;&#x6599;&#x592A;&#x591A;&#xFF0C;&#x53CD;&#x800C;&#x6CA1;&#x7528;&#xFF0C;&#x6839;&#x636E;&#x81EA;&#x5DF1;&#x7684;&#x5B66;&#x4E60;&#x4E60;&#x60EF;&#xFF0C;&#x4E2A;&#x4EBA;&#x80FD;&#x529B;&#x9009;&#x62E9;&#x4E00;&#x95E8;&#x8D44;&#x6E90;&#x575A;&#x6301;&#x5B66;&#x5C31;&#x597D;&#x4E86;&#x3002;</p>
<p>&#x56E0;&#x4E3A;&#x6BCF;&#x4E2A;&#x4EBA;&#x7684;&#x9700;&#x6C42;&#x4E0D;&#x540C;&#xFF0C;&#x8FD9;&#x91CC;&#x6574;&#x7406;&#x4E86;&#x4E00;&#x6279; Python &#x6BD4;&#x8F83;&#x597D;&#x7684;&#x5B66;&#x4E60;&#x8D44;&#x6599;&#xFF1A;</p>
<ul>
<li><a href="/external_links/4199c2dc0a57553ad3ae5f92ca65b936.html" target="blank" rel="noopener">Python &#x535A;&#x5BA2;&#x7F51;&#x7AD9;&#x8D44;&#x6E90;</a></li>
<li><a href="/external_links/4199c2dc0a57553ad3ae5f92ca65b936.html" target="blank" rel="noopener">Python &#x89C6;&#x9891;&#x6559;&#x7A0B;&#x8D44;&#x6E90;</a></li>
</ul>
<h1 id="Python-&#x5165;&#x95E8;"><a href="#Python-&#x5165;&#x95E8;" class="headerlink" title="Python &#x5165;&#x95E8;"></a>Python &#x5165;&#x95E8;</h1><p>&#x5BF9;&#x4E8E;&#x5165;&#x95E8;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x638C;&#x63E1;&#x57FA;&#x672C;&#x7684;&#x8BED;&#x6CD5;&#x548C;&#x719F;&#x6089;&#x7F16;&#x7A0B;&#x89C4;&#x8303;&#xFF0C;&#x56E0;&#x6B64;&#x5927;&#x90E8;&#x5206;&#x7684;&#x6559;&#x7A0B;&#x57FA;&#x672C;&#x4E00;&#x81F4;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x8FD8;&#x662F;&#x5EFA;&#x8BAE;&#x9009;&#x597D;&#x9002;&#x5408;&#x81EA;&#x5DF1;&#x7684;&#x4E00;&#x4E2A;&#x6559;&#x7A0B;&#xFF0C;&#x575A;&#x6301;&#x5B66;&#x4E0B;&#x53BB;&#x3002;</p>
<p>&#x5728; Python &#x5165;&#x95E8;&#x4E2D;&#xFF0C;&#x672C;&#x4EBA;&#x81EA;&#x5DF1;&#x7F16;&#x5199;&#x4E86;&#x4E00;&#x7CFB;&#x5217;&#x7684; &#x300A; &#x8349;&#x6839;&#x5B66; Python &#x300B; &#x535A;&#x5BA2;&#xFF0C; &#x662F;&#x57FA;&#x4E8E; Python 3.6 &#x5199;&#x7684; Python &#x5165;&#x95E8;&#x7CFB;&#x5217;&#x6559;&#x7A0B;&#xFF0C;&#x4E3A;&#x4E86;&#x66F4;&#x597D;&#x7684;&#x9605;&#x8BFB;&#xFF0C;&#x628A;&#x5B83;&#x6574;&#x7406;&#x5728; <a href="/external_links/654a0f86cbb587884c66e066197b5285.html" target="blank" rel="noopener">GitBook</a> &#x4E0A;&#xFF1B;&#x5982;&#x679C; <a href="/external_links/654a0f86cbb587884c66e066197b5285.html" target="blank" rel="noopener">GitBook</a> &#x8BBF;&#x95EE;&#x6162;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x5230;&#x4E2A;&#x4EBA;&#x535A;&#x5BA2;&#x67E5;&#x9605;&#xFF1A;<a href="/external_links/a20bfdd84783aecd83d30b2e9f72e4c6.html" target="blank" rel="noopener">&#x8349;&#x6839;&#x5B66; Python</a>&#xFF0C;&#x5E0C;&#x671B;&#x5BF9;&#x5404;&#x4F4D;&#x5165;&#x95E8; Python &#x6709;&#x6240;&#x5E2E;&#x52A9;&#x3002;</p>
<p><strong>&#x4E3B;&#x8981;&#x76EE;&#x5F55;&#x5982;&#x4E0B;&#xFF1A;</strong></p>
<ul>
<li><a href="/external_links/343fe7fb73b13fed35b97578c1d13b42.html" target="blank" rel="noopener">Python&#x4EE3;&#x7801;&#x89C4;&#x8303;</a><ul>
<li><a href="/external_links/de95adbc8a1270f9912d5e0e964211bb.html" target="blank" rel="noopener">&#x7B80;&#x660E;&#x6982;&#x8FF0;</a></li>
<li><a href="/external_links/45a86f379a52bdfb9ca5b994f49ace9e.html" target="blank" rel="noopener">&#x6CE8;&#x91CA;</a></li>
<li><a href="/external_links/dc4f48b70517b73c226cfa36536041c9.html" target="blank" rel="noopener">&#x547D;&#x540D;&#x89C4;&#x8303;</a></li>
</ul>
</li>
<li><a href="/external_links/9fbca65c9b16fd89571a4ee6763b042f.html" target="blank" rel="noopener">&#x7B2C;&#x4E00;&#x4E2A;Python&#x7A0B;&#x5E8F;</a><ul>
<li><a href="/external_links/92b3af8ff0c07fcc11f10ced86e0f359.html" target="blank" rel="noopener">Python &#x7B80;&#x4ECB;</a></li>
<li><a href="/external_links/824a577da42c10cda78944042390a78e.html" target="blank" rel="noopener">Python &#x7684;&#x5B89;&#x88C5;</a></li>
<li><a href="/external_links/d13d932468c7e8bdd84ddf6c5271e7b7.html" target="blank" rel="noopener">&#x7B2C;&#x4E00;&#x4E2A; Python &#x7A0B;&#x5E8F;</a></li>
<li><a href="/external_links/7052341ebe19f06daf723def4642e04c.html" target="blank" rel="noopener">&#x96C6;&#x6210;&#x5F00;&#x53D1;&#x73AF;&#x5883;&#xFF08;IDE&#xFF09;: PyCharm</a></li>
</ul>
</li>
<li><a href="/external_links/f774f547922930d1d582011f2b4d897a.html" target="blank" rel="noopener">&#x57FA;&#x672C;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x548C;&#x53D8;&#x91CF;</a><ul>
<li><a href="/external_links/c14b47323706013888bf2a6a0e24c094.html" target="blank" rel="noopener">Python &#x8BED;&#x6CD5;&#x7684;&#x7B80;&#x8981;&#x8BF4;&#x660E;</a></li>
<li><a href="/external_links/7b443fc64327471e30d5086da2c5e321.html" target="blank" rel="noopener">Python &#x7684;&#x57FA;&#x672C;&#x6570;&#x636E;&#x7C7B;&#x578B;</a></li>
<li><a href="/external_links/c5b8ed1d17c8a25e76789b2df4349370.html" target="blank" rel="noopener">&#x57FA;&#x672C;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x8F6C;&#x6362;</a></li>
<li><a href="/external_links/baa63a83998a8757e87415a8861cb9b1.html" target="blank" rel="noopener">Python &#x4E2D;&#x7684;&#x53D8;&#x91CF;</a></li>
</ul>
</li>
<li><a href="/external_links/eabbca57248ffaf92657635e009284a6.html" target="blank" rel="noopener">List &#x548C; Tuple</a><ul>
<li><a href="/external_links/d1879ecb98855724d8e83498b6e34031.html" target="blank" rel="noopener">List&#xFF08;&#x5217;&#x8868;&#xFF09;</a></li>
<li><a href="/external_links/8cf593141d35782b7c9100e74a0d484a.html" target="blank" rel="noopener">tuple&#xFF08;&#x5143;&#x7EC4;&#xFF09;</a></li>
</ul>
</li>
<li><a href="/external_links/68271c7248a5d4dab1eb22a2f6447482.html" target="blank" rel="noopener">Dict &#x548C; Set</a><ul>
<li><a href="/external_links/72ef08cfa4c0d9de1871864e7310c71e.html" target="blank" rel="noopener">&#x5B57;&#x5178;(Dictionary)</a></li>
<li><a href="/external_links/3001d14d421b6d33c9d82ca71fa4ddca.html" target="blank" rel="noopener">set</a></li>
</ul>
</li>
<li><a href="/external_links/29b52c680506beb6774339e01dca0b16.html" target="blank" rel="noopener">&#x6761;&#x4EF6;&#x8BED;&#x53E5;&#x548C;&#x5FAA;&#x73AF;&#x8BED;&#x53E5;</a><ul>
<li><a href="/external_links/48678aadaa62f9c6c60f52f1784e6ed5.html" target="blank" rel="noopener">&#x6761;&#x4EF6;&#x8BED;&#x53E5;</a></li>
<li><a href="/external_links/29a1f66cdef0ee0b890d58ebcb18b0dd.html" target="blank" rel="noopener">&#x5FAA;&#x73AF;&#x8BED;&#x53E5;</a></li>
<li><a href="/external_links/c283b954dfe16ea08a5848be8972296c.html" target="blank" rel="noopener">&#x6761;&#x4EF6;&#x8BED;&#x53E5;&#x548C;&#x5FAA;&#x73AF;&#x8BED;&#x53E5;&#x7EFC;&#x5408;&#x5B9E;&#x4F8B;</a></li>
</ul>
</li>
<li><a href="/external_links/3806f8351ee93c08e5fe4e875616bb92.html" target="blank" rel="noopener">&#x51FD;&#x6570;</a><ul>
<li><a href="/external_links/686cd7cfa326459084540f28443671dd.html" target="blank" rel="noopener">Python &#x81EA;&#x5B9A;&#x4E49;&#x51FD;&#x6570;&#x7684;&#x57FA;&#x672C;&#x6B65;&#x9AA4;</a></li>
<li><a href="/external_links/1ee3ab492927c5f0b24d740f1a0ad305.html" target="blank" rel="noopener">&#x51FD;&#x6570;&#x4F20;&#x503C;&#x95EE;&#x9898;</a></li>
<li><a href="/external_links/e440a73f0948a6e3df4522da9a562e3c.html" target="blank" rel="noopener">&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x503C;</a></li>
<li><a href="/external_links/e0de2e88c73de6c12c24909a6513563b.html" target="blank" rel="noopener">&#x51FD;&#x6570;&#x7684;&#x53C2;&#x6570;</a></li>
<li><a href="/external_links/cf7efaba4d71ae377faf6e978211174c.html" target="blank" rel="noopener">&#x533F;&#x540D;&#x51FD;&#x6570;</a></li>
</ul>
</li>
<li><a href="/external_links/6b3790dad6cd94480da1bac984ad3586.html" target="blank" rel="noopener">&#x8FED;&#x4EE3;&#x5668;&#x548C;&#x751F;&#x6210;&#x5668;</a><ul>
<li><a href="/external_links/910dac71d07dc4c44ea8e7b9634127bf.html" target="blank" rel="noopener">&#x8FED;&#x4EE3;</a></li>
<li><a href="/external_links/a605759f9fb57089698947120550689f.html" target="blank" rel="noopener">Python &#x8FED;&#x4EE3;&#x5668;</a></li>
<li><a href="/external_links/148837e78eb65691054869ffbca11e7f.html" target="blank" rel="noopener">lsit &#x751F;&#x6210;&#x5F0F;&#xFF08;&#x5217;&#x8868;&#x751F;&#x6210;&#x5F0F;&#xFF09;</a></li>
<li><a href="/external_links/ded76d2186adafa25b96898b94601310.html" target="blank" rel="noopener">&#x751F;&#x6210;&#x5668;</a></li>
<li><a href="/external_links/cc68cde847f91cbd0171bffd1c492780.html" target="blank" rel="noopener">&#x8FED;&#x4EE3;&#x5668;&#x548C;&#x751F;&#x6210;&#x5668;&#x7EFC;&#x5408;&#x4F8B;&#x5B50;</a></li>
</ul>
</li>
<li><a href="/external_links/e24742348e6cd8e41b457e379a4f30f0.html" target="blank" rel="noopener">&#x6A21;&#x5757;&#x4E0E;&#x5305;</a><ul>
<li><a href="/external_links/cf7ef84c514951fbd44002330fa1624a.html" target="blank" rel="noopener">Python &#x6A21;&#x5757;&#x7B80;&#x4ECB;</a></li>
<li><a href="/external_links/cb7b69d37b561e04128f9dc800a49894.html" target="blank" rel="noopener">&#x6A21;&#x5757;&#x7684;&#x4F7F;&#x7528;</a></li>
<li><a href="/external_links/93b2331de20f02360b0a2151e4244057.html" target="blank" rel="noopener">&#x4E3B;&#x6A21;&#x5757;&#x548C;&#x975E;&#x4E3B;&#x6A21;&#x5757;</a></li>
<li><a href="/external_links/7cb2a001fa9a9999776ffe5693e3e035.html" target="blank" rel="noopener">&#x5305;</a></li>
<li><a href="/external_links/dba57a3133ba902ee195b7360d5ab5db.html" target="blank" rel="noopener">&#x4F5C;&#x7528;&#x57DF;</a></li>
</ul>
</li>
<li><a href="/external_links/6dea32e18bf72ab792a9dab3d3acb364.html" target="blank" rel="noopener">&#x9762;&#x5411;&#x5BF9;&#x8C61;</a><ul>
<li><a href="/external_links/7717f82fc2f3fcaabf1649c145b5eadd.html" target="blank" rel="noopener">&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x7684;&#x6982;&#x5FF5;</a></li>
<li><a href="/external_links/07bb31385aed13c74140884ae5a25bef.html" target="blank" rel="noopener">&#x7C7B;</a></li>
<li><a href="/external_links/501e34859e0d8c4826bc67842899177f.html" target="blank" rel="noopener">&#x7C7B;&#x7684;&#x5C5E;&#x6027;</a></li>
<li><a href="/external_links/fd68d0e2c08bfc446c086d995d0b3b1f.html" target="blank" rel="noopener">&#x7C7B;&#x7684;&#x65B9;&#x6CD5;</a></li>
<li><a href="/external_links/2c9d198708b47472461783e53e6adba6.html" target="blank" rel="noopener">&#x7C7B;&#x7684;&#x7EE7;&#x627F;</a></li>
<li><a href="/external_links/a7a3597d12f3cfb594c93224ca5a965a.html" target="blank" rel="noopener">&#x7C7B;&#x7684;&#x591A;&#x6001;</a></li>
</ul>
</li>
<li><a href="/external_links/d231a85d53ac75718239a68b2ec85886.html" target="blank" rel="noopener">Python &#x7684; Magic Method</a><ul>
<li><a href="/external_links/788d800cca996d396689f8ee28007d82.html" target="blank" rel="noopener">Python &#x7684; Magic Method</a></li>
<li><a href="/external_links/18142ba905a8de4647c4e6b9f6371215.html" target="blank" rel="noopener">&#x6784;&#x9020;(<code>__new__</code>)&#x548C;&#x521D;&#x59CB;&#x5316;(<code>__init__</code>)</a></li>
<li><a href="/external_links/c10c191ba1f89eaedee3d6c11560d42f.html" target="blank" rel="noopener">&#x5C5E;&#x6027;&#x7684;&#x8BBF;&#x95EE;&#x63A7;&#x5236;</a></li>
<li><a href="/external_links/8c590e9ab8eeb9115b031b0d4e50cd3d.html" target="blank" rel="noopener">&#x5BF9;&#x8C61;&#x7684;&#x63CF;&#x8FF0;&#x5668;</a></li>
<li><a href="/external_links/d09f2c904f88dbbb36939bab9dff3bc1.html" target="blank" rel="noopener">&#x81EA;&#x5B9A;&#x4E49;&#x5BB9;&#x5668;&#xFF08;Container&#xFF09;</a></li>
<li><a href="/external_links/e2aea9e750f676800ab0fb65371fc9bb.html" target="blank" rel="noopener">&#x8FD0;&#x7B97;&#x7B26;&#x76F8;&#x5173;&#x7684;&#x9B54;&#x672F;&#x65B9;&#x6CD5;</a></li>
</ul>
</li>
<li><a href="/external_links/a495ac775ee410841e210d4564a0b027.html" target="blank" rel="noopener">&#x679A;&#x4E3E;&#x7C7B;</a><ul>
<li><a href="/external_links/15760cbd61390d9a774e0a2de884d077.html" target="blank" rel="noopener">&#x679A;&#x4E3E;&#x7C7B;&#x7684;&#x4F7F;&#x7528;</a></li>
<li><a href="/external_links/f4d11c9542cdb24692db24dde857320a.html" target="blank" rel="noopener">Enum &#x7684;&#x6E90;&#x7801;</a></li>
<li><a href="/external_links/9dc902ad57bf799df9f531202526ba66.html" target="blank" rel="noopener">&#x81EA;&#x5B9A;&#x4E49;&#x7C7B;&#x578B;&#x7684;&#x679A;&#x4E3E;</a></li>
<li><a href="/external_links/6b08990a1f497d367985a931cd9828be.html" target="blank" rel="noopener">&#x679A;&#x4E3E;&#x7684;&#x6BD4;&#x8F83;</a></li>
</ul>
</li>
<li><a href="/external_links/d1da5e9aca37c35af14f662266f8d939.html" target="blank" rel="noopener">&#x5143;&#x7C7B;</a><ul>
<li><a href="/external_links/4830d324935fb9ec037bf9c9dc03587c.html" target="blank" rel="noopener">Python &#x4E2D;&#x7C7B;&#x4E5F;&#x662F;&#x5BF9;&#x8C61;</a></li>
<li><a href="/external_links/9359b0547eda1ab2cc6325db45fce691.html" target="blank" rel="noopener">&#x4F7F;&#x7528; <code>type()</code> &#x52A8;&#x6001;&#x521B;&#x5EFA;&#x7C7B;</a></li>
<li><a href="/external_links/bfb2fafa55a8de0b509dd97b8c2380fa.html" target="blank" rel="noopener">&#x4EC0;&#x4E48;&#x662F;&#x5143;&#x7C7B;</a></li>
<li><a href="/external_links/07fb4d2408ad264e582598a4e2fecd0e.html" target="blank" rel="noopener">&#x81EA;&#x5B9A;&#x4E49;&#x5143;&#x7C7B;</a></li>
<li><a href="/external_links/64a697f8c2be3071d57797772cb910e0.html" target="blank" rel="noopener">&#x4F7F;&#x7528;&#x5143;&#x7C7B;</a></li>
</ul>
</li>
<li><a href="/external_links/3fbf420558efbe14303350cf59bef2d9.html" target="blank" rel="noopener">&#x7EBF;&#x7A0B;&#x4E0E;&#x8FDB;&#x7A0B;</a><ul>
<li><a href="/external_links/48cd58e714757e4f67b4d8dde9bdd8c2.html" target="blank" rel="noopener">&#x7EBF;&#x7A0B;&#x4E0E;&#x8FDB;&#x7A0B;</a></li>
<li><a href="/external_links/e1a4812e3f4e87bb95a08283bc8d44de.html" target="blank" rel="noopener">&#x591A;&#x7EBF;&#x7A0B;&#x7F16;&#x7A0B;</a></li>
<li><a href="/external_links/eb14caa24ec8b73dfb67f3ae1d388d0d.html" target="blank" rel="noopener">&#x8FDB;&#x7A0B;</a></li>
</ul>
</li>
<li><a href="/external_links/1dd873443c013e9422a522ebd85c1caa.html" target="blank" rel="noopener">&#x4E00;&#x6B65;&#x4E00;&#x6B65;&#x4E86;&#x89E3;&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;</a><ul>
<li><a href="/external_links/650d9ce1ba10a08a9f8b1a01f748f0ef.html" target="blank" rel="noopener">&#x521D;&#x8BC6; Python &#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;</a></li>
<li><a href="/external_links/b273696624c361990d16990ba5da2f78.html" target="blank" rel="noopener">&#x5B57;&#x7B26;&#x96C6;</a></li>
<li><a href="/external_links/2f0c5990bf9c388d3b1303b19793f096.html" target="blank" rel="noopener">&#x6570;&#x91CF;&#x8BCD;</a></li>
<li><a href="/external_links/3fb3d71d43cb6a87b53c2b03887be963.html" target="blank" rel="noopener">&#x8FB9;&#x754C;&#x5339;&#x914D;&#x7B26;&#x548C;&#x7EC4;</a></li>
<li><a href="/external_links/0659964abcb13bf6d31009231d50f592.html" target="blank" rel="noopener">re.sub</a></li>
<li><a href="/external_links/bd7063b8b256599f5eada7775eab59a4.html" target="blank" rel="noopener">re.match &#x548C; re.search</a></li>
</ul>
</li>
<li><a href="/external_links/afa1405e33b12f9df95a26c06215c5b5.html" target="blank" rel="noopener">&#x95ED;&#x5305;</a></li>
<li><a href="/external_links/d26c755aa411d2983dee3659835d0f64.html" target="blank" rel="noopener">&#x88C5;&#x9970;&#x5668;</a></li>
</ul>
<h1 id="&#x77E5;&#x8BC6;&#x70B9;&#x8865;&#x6F0F;"><a href="#&#x77E5;&#x8BC6;&#x70B9;&#x8865;&#x6F0F;" class="headerlink" title="&#x77E5;&#x8BC6;&#x70B9;&#x8865;&#x6F0F;"></a>&#x77E5;&#x8BC6;&#x70B9;&#x8865;&#x6F0F;</h1><ul>
<li><a href="/external_links/5e1aa0c5b727abb1df77440688084616.html" target="blank" rel="noopener">Python &#x5173;&#x952E;&#x5B57; yield</a></li>
</ul>
<h1 id="Python-&#x8FDB;&#x9636;"><a href="#Python-&#x8FDB;&#x9636;" class="headerlink" title="Python &#x8FDB;&#x9636;"></a>Python &#x8FDB;&#x9636;</h1><p>&#x6301;&#x7EED;&#x66F4;&#x65B0;&#x2026;.</p>
<p>&#x5173;&#x6CE8;&#x7684;&#x6211;&#x7684; <a href="/external_links/31503a82ec07f292f530b60fd295d488.html" target="blank" rel="noopener">github</a> &#xFF0C;&#x5B9E;&#x65F6;&#x66F4;&#x65B0;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/5a3a9c1150f026a7b619ea9aed9cdc11.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903556705681421.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903556705681421.html" itemprop="url">Android开源框架源码鉴赏：LruCache与DiskL</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-28T18:35:02+08:00">
                2018-01-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>&#x5173;&#x4E8E;&#x4F5C;&#x8005;</strong></p>
<blockquote>
<p>&#x90ED;&#x5B5D;&#x661F;&#xFF0C;&#x7A0B;&#x5E8F;&#x5458;&#xFF0C;&#x5409;&#x4ED6;&#x624B;&#xFF0C;&#x4E3B;&#x8981;&#x4ECE;&#x4E8B;Android&#x5E73;&#x53F0;&#x57FA;&#x7840;&#x67B6;&#x6784;&#x65B9;&#x9762;&#x7684;&#x5DE5;&#x4F5C;&#xFF0C;&#x6B22;&#x8FCE;&#x4EA4;&#x6D41;&#x6280;&#x672F;&#x65B9;&#x9762;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x53EF;&#x4EE5;&#x53BB;&#x6211;&#x7684;<a href="/external_links/6395fe7b4ea61f4f04fc23a9ba7990bf.html" target="blank" rel="noopener">Github</a>&#x63D0;issue&#x6216;&#x8005;&#x53D1;&#x90AE;&#x4EF6;&#x81F3;<a href="mailto:guoxiaoxingse@163.com" target="_blank" rel="noopener">guoxiaoxingse@163.com</a>&#x4E0E;&#x6211;&#x4EA4;&#x6D41;&#x3002;</p>
</blockquote>
<p><strong>&#x6587;&#x7AE0;&#x76EE;&#x5F55;</strong></p>
<ul>
<li>&#x4E00; Lru&#x7B97;&#x6CD5;</li>
<li>&#x4E8C; LruCache&#x539F;&#x7406;&#x5206;&#x6790;<ul>
<li>2.1 &#x5199;&#x5165;&#x7F13;&#x5B58;</li>
<li>2.2 &#x8BFB;&#x53D6;&#x7F13;&#x5B58;</li>
<li>2.3 &#x5220;&#x9664;&#x7F13;&#x5B58;</li>
</ul>
</li>
<li>&#x4E09; DiskLruCache&#x539F;&#x7406;&#x5206;&#x6790;<ul>
<li>3.1 &#x5199;&#x5165;&#x7F13;&#x5B58;</li>
<li>3.2 &#x8BFB;&#x53D6;&#x7F13;&#x5B58;</li>
<li>3.3 &#x5220;&#x9664;&#x7F13;&#x5B58;</li>
</ul>
</li>
</ul>
<p>&#x66F4;&#x591A;Android&#x5F00;&#x6E90;&#x6846;&#x67B6;&#x6E90;&#x7801;&#x5206;&#x6790;&#x6587;&#x7AE0;&#x8BF7;&#x53C2;&#x89C1;<a href="/external_links/fdc40743988f9a60104e63f3166485ab.html" target="blank" rel="noopener">Android open framework analysis</a>&#x3002;</p>
<h2 id="&#x4E00;-Lru&#x7B97;&#x6CD5;"><a href="#&#x4E00;-Lru&#x7B97;&#x6CD5;" class="headerlink" title="&#x4E00; Lru&#x7B97;&#x6CD5;"></a>&#x4E00; Lru&#x7B97;&#x6CD5;</h2><p>&#x5728;&#x5206;&#x6790;LruCache&#x4E0E;DiskLruCache&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x5148;&#x6765;&#x7B80;&#x5355;&#x7684;&#x4E86;&#x89E3;&#x4E0B;LRU&#x7B97;&#x6CD5;&#x7684;&#x6838;&#x5FC3;&#x539F;&#x7406;&#x3002;</p>
<p>LRU&#x7B97;&#x6CD5;&#x53EF;&#x4EE5;&#x7528;&#x4E00;&#x53E5;&#x8BDD;&#x6765;&#x63CF;&#x8FF0;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<blockquote>
<p>LRU&#x662F;Least Recently Used&#x7684;&#x7F29;&#x5199;&#xFF0C;&#x6700;&#x8FD1;&#x6700;&#x4E45;&#x672A;&#x4F7F;&#x7528;&#x7B97;&#x6CD5;&#xFF0C;&#x4ECE;&#x5B83;&#x7684;&#x540D;&#x5B57;&#x5C31;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x5B83;&#x7684;&#x6838;&#x5FC3;&#x539F;&#x5219;&#x662F;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5728;&#x6700;&#x8FD1;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x6CA1;&#x6709;&#x4F7F;&#x7528;&#x5230;&#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x5728;&#x5C06;&#x6765;&#x88AB;<br>&#x8BBF;&#x95EE;&#x5230;&#x7684;&#x53EF;&#x80FD;&#x6027;&#x4E5F;&#x5F88;&#x5C0F;&#xFF0C;&#x5219;&#x8FD9;&#x7C7B;&#x6570;&#x636E;&#x9879;&#x4F1A;&#x88AB;&#x4F18;&#x5148;&#x6DD8;&#x6C70;&#x6389;&#x3002;</p>
</blockquote>
<p>LRU&#x7B97;&#x6CD5;&#x6D41;&#x7A0B;&#x56FE;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/cb4c8232a28b7e8283f73356af447f33f3f3b28d29d18c1f0990dad6c3e4f115" alt><br>&#x4E86;&#x89E3;&#x4E86;&#x7B97;&#x6CD5;&#x539F;&#x7406;&#xFF0C;&#x6211;&#x4EEC;&#x6765;&#x601D;&#x8003;&#x4E00;&#x4E0B;&#x5982;&#x679C;&#x662F;&#x6211;&#x4EEC;&#x6765;&#x505A;&#xFF0C;&#x5E94;&#x8BE5;&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x8FD9;&#x4E2A;&#x7B97;&#x6CD5;&#x3002;&#x4ECE;&#x4E0A;&#x56FE;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x53CC;&#x5411;&#x94FE;&#x8868;&#x662F;&#x4E00;&#x4E2A;&#x597D;&#x4E3B;&#x610F;&#x3002;</p>
<blockquote>
<p>&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x4ECE;&#x8868;&#x5C3E;&#x8BBF;&#x95EE;&#x6570;&#x636E;&#xFF0C;&#x5728;&#x8868;&#x5934;&#x5220;&#x9664;&#x6570;&#x636E;&#xFF0C;&#x5F53;&#x8BBF;&#x95EE;&#x7684;&#x6570;&#x636E;&#x9879;&#x5728;&#x94FE;&#x8868;&#x4E2D;&#x5B58;&#x5728;&#x65F6;&#xFF0C;&#x5219;&#x5C06;&#x8BE5;&#x6570;&#x636E;&#x9879;&#x79FB;&#x52A8;&#x5230;&#x8868;&#x5C3E;&#xFF0C;&#x5426;&#x5219;&#x5728;&#x8868;&#x5C3E;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x9879;&#x3002;&#x5F53;&#x94FE;&#x8868;&#x5BB9;&#x91CF;&#x8D85;&#x8FC7;&#x4E00;&#x5B9A;&#x9608;&#x503C;&#xFF0C;&#x5219;&#x79FB;&#x9664;&#x8868;&#x5934;&#x7684;&#x6570;&#x636E;&#x3002;</p>
</blockquote>
<p>&#x597D;&#xFF0C;&#x4EE5;&#x4E0A;&#x4FBF;&#x662F;&#x6574;&#x4E2A;Lru&#x7B97;&#x6CD5;&#x7684;&#x539F;&#x7406;&#xFF0C;&#x6211;&#x4EEC;&#x63A5;&#x7740;&#x6765;&#x5206;&#x6790;LruCache&#x4E0E;DiskLruCache&#x7684;&#x5B9E;&#x73B0;&#x3002;</p>
<h2 id="&#x4E8C;-LruCache&#x539F;&#x7406;&#x5206;&#x6790;"><a href="#&#x4E8C;-LruCache&#x539F;&#x7406;&#x5206;&#x6790;" class="headerlink" title="&#x4E8C; LruCache&#x539F;&#x7406;&#x5206;&#x6790;"></a>&#x4E8C; LruCache&#x539F;&#x7406;&#x5206;&#x6790;</h2><p>&#x7406;&#x89E3;&#x4E86;Lru&#x7B97;&#x6CD5;&#x7684;&#x539F;&#x7406;&#xFF0C;&#x6211;&#x4EEC;&#x63A5;&#x7740;&#x4ECE;LruCache&#x7684;&#x4F7F;&#x7528;&#x5165;&#x624B;&#xFF0C;&#x9010;&#x6B65;&#x5206;&#x6790;LruCache&#x7684;&#x6E90;&#x7801;&#x5B9E;&#x73B0;&#x3002;</p>
<p>&#x1F449; <a href="/external_links/c1c646c46fd75fb744f1596c2c421d2a.html" target="blank" rel="noopener">LruCache.java</a></p>
<p>&#x5728;&#x5206;&#x6790;LruCache&#x7684;&#x6E90;&#x7801;&#x5B9E;&#x73B0;&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x5148;&#x6765;&#x770B;&#x770B;LruCache&#x7684;&#x7B80;&#x5355;&#x4F7F;&#x7528;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;int maxMemorySize = (int) (Runtime.getRuntime().totalMemory() / 1024);</span><br><span class="line">int cacheMemorySize = maxMemorySize / 8;</span><br><span class="line">LruCache&lt;String, Bitmap&gt; lrucache = new LruCache&lt;String, Bitmap&gt;(cacheMemorySize) {</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected int sizeOf(String key, Bitmap value) {</span><br><span class="line">        return getBitmapSize(value);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void entryRemoved(boolean evicted, String key, Bitmap oldValue, Bitmap newValue) {</span><br><span class="line">        super.entryRemoved(evicted, key, oldValue, newValue);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected Bitmap create(String key) {</span><br><span class="line">        return super.create(key);</span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></table></figure>

<p>&#x6CE8;&#xFF1A;getBitmapSize()&#x7528;&#x6765;&#x8BA1;&#x7B97;&#x56FE;&#x7247;&#x5360;&#x5185;&#x5B58;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x5177;&#x4F53;&#x65B9;&#x6CD5;&#x53C2;&#x89C1;&#x9644;&#x5F55;&#x3002;</p>
<p>&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#xFF0C;&#x5728;&#x4F7F;&#x7528;LruCache&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x9700;&#x8981;&#x6211;&#x4EEC;&#x5173;&#x6CE8;&#x7684;&#x4E3B;&#x8981;&#x6709;&#x4E09;&#x4E2A;&#x65B9;&#x6CD5;&#xFF1A;</p>
<ul>
<li>sizeOf()&#xFF1A;&#x8986;&#x5199;&#x6B64;&#x65B9;&#x6CD5;&#x5B9E;&#x73B0;&#x81EA;&#x5DF1;&#x7684;&#x4E00;&#x5957;&#x5B9A;&#x4E49;&#x8BA1;&#x7B97;entry&#x5927;&#x5C0F;&#x7684;&#x89C4;&#x5219;&#x3002;</li>
<li>V create(K key)&#xFF1A;&#x5982;&#x679C;key&#x5BF9;&#x8C61;&#x7F13;&#x5B58;&#x88AB;&#x79FB;&#x9664;&#x4E86;&#xFF0C;&#x5219;&#x8C03;&#x7528;&#x6B21;&#x65B9;&#x6CD5;&#x91CD;&#x5EFA;&#x7F13;&#x5B58;&#x3002;</li>
<li>entryRemoved(boolean evicted, K key, V oldValue, V newValue) &#xFF1A;&#x5F53;key&#x5BF9;&#x5E94;&#x7684;&#x7F13;&#x5B58;&#x88AB;&#x5220;&#x9664;&#x65F6;&#x56DE;&#x8C03;&#x8BE5;&#x65B9;&#x6CD5;&#x3002;</li>
</ul>
<p>&#x6211;&#x4EEC;&#x6765;&#x770B;&#x770B;&#x8FD9;&#x4E09;&#x4E2A;&#x65B9;&#x6CD5;&#x7684;&#x9ED8;&#x8BA4;&#x5B9E;&#x73B0;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public class LruCache&lt;K, V&gt; {</span><br><span class="line">    </span><br><span class="line">    //&#x8BE5;&#x65B9;&#x6CD5;&#x9ED8;&#x8BA4;&#x8FD4;&#x56DE;1&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x4EE5;entry&#x7684;&#x6570;&#x91CF;&#x6765;&#x8BA1;&#x7B97;entry&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x8FD9;&#x901A;&#x5E38;&#x4E0D;&#x7B26;&#x5408;&#x6211;&#x4EEC;&#x7684;&#x9700;&#x6C42;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x4E00;&#x822C;&#x4F1A;&#x8986;&#x5199;&#x6B64;&#x65B9;&#x6CD5;&#x3002;</span><br><span class="line">    protected int sizeOf(K key, V value) {</span><br><span class="line">        return 1;</span><br><span class="line">    }</span><br><span class="line">    protected void entryRemoved(boolean evicted, K key, V oldValue, V newValue) {}</span><br><span class="line">    protected V create(K key) {</span><br><span class="line">        return null;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x53EF;&#x4EE5;&#x53D1;&#x73B0;entryRemoved()&#x65B9;&#x6CD5;&#x4E3A;&#x7A7A;&#x5B9E;&#x73B0;&#xFF0C;create()&#x65B9;&#x6CD5;&#x4E5F;&#x9ED8;&#x8BA4;&#x8FD4;&#x56DE;null&#x3002;sizeOf()&#x65B9;&#x6CD5;&#x9ED8;&#x8BA4;&#x8FD4;&#x56DE;1&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x4EE5;entry&#x7684;&#x6570;&#x91CF;&#x6765;&#x8BA1;&#x7B97;entry&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x8FD9;&#x901A;&#x5E38;&#x4E0D;&#x7B26;&#x5408;&#x6211;&#x4EEC;&#x7684;&#x9700;&#x6C42;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x4E00;&#x822C;&#x4F1A;&#x8986;&#x5199;&#x6B64;&#x65B9;&#x6CD5;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x524D;&#x9762;&#x63D0;&#x5230;&#xFF0C;&#x8981;&#x5B9E;&#x73B0;Lru&#x7B97;&#x6CD5;&#xFF0C;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x53CC;&#x5411;&#x94FE;&#x8868;&#x3002;</p>
<blockquote>
<p>&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x4ECE;&#x8868;&#x5C3E;&#x8BBF;&#x95EE;&#x6570;&#x636E;&#xFF0C;&#x5728;&#x8868;&#x5934;&#x5220;&#x9664;&#x6570;&#x636E;&#xFF0C;&#x5F53;&#x8BBF;&#x95EE;&#x7684;&#x6570;&#x636E;&#x9879;&#x5728;&#x94FE;&#x8868;&#x4E2D;&#x5B58;&#x5728;&#x65F6;&#xFF0C;&#x5219;&#x5C06;&#x8BE5;&#x6570;&#x636E;&#x9879;&#x79FB;&#x52A8;&#x5230;&#x8868;&#x5C3E;&#xFF0C;&#x5426;&#x5219;&#x5728;&#x8868;&#x5C3E;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x9879;&#x3002;&#x5F53;&#x94FE;&#x8868;&#x5BB9;&#x91CF;&#x8D85;&#x8FC7;&#x4E00;&#x5B9A;&#x9608;&#x503C;&#xFF0C;&#x5219;&#x79FB;&#x9664;&#x8868;&#x5934;&#x7684;&#x6570;&#x636E;&#x3002;</p>
</blockquote>
<p>LruCache&#x4F7F;&#x7528;&#x7684;&#x662F;LinkedHashMap&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x9009;&#x62E9;LinkedHashMap&#x5462;&#xFF1F;&#x1F914;</p>
<p>&#x8FD9;&#x8DDF;LinkedHashMap&#x7684;&#x7279;&#x6027;&#x6709;&#x5173;&#xFF0C;LinkedHashMap&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#x91CC;&#x6709;&#x4E2A;&#x5E03;&#x5C14;&#x53C2;&#x6570;accessOrder&#xFF0C;&#x5F53;&#x5B83;&#x4E3A;true&#x65F6;&#xFF0C;LinkedHashMap&#x4F1A;&#x4EE5;&#x8BBF;&#x95EE;&#x987A;&#x5E8F;&#x4E3A;&#x5E8F;&#x6392;&#x5217;&#x5143;&#x7D20;&#xFF0C;&#x5426;&#x5219;&#x4EE5;&#x63D2;&#x5165;&#x987A;&#x5E8F;&#x4E3A;&#x5E8F;&#x6392;&#x5E8F;&#x5143;&#x7D20;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public class LruCache&lt;K, V&gt; {</span><br><span class="line">   public LinkedHashMap(int initialCapacity,</span><br><span class="line">                        float loadFactor,</span><br><span class="line">                        boolean accessOrder) {</span><br><span class="line">       super(initialCapacity, loadFactor);</span><br><span class="line">       this.accessOrder = accessOrder;</span><br><span class="line">   } </span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x6211;&#x4EEC;&#x6765;&#x5199;&#x4E2A;&#x5C0F;&#x4F8B;&#x5B50;&#x9A8C;&#x8BC1;&#x4E00;&#x4E0B;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;Map&lt;Integer, Integer&gt; map = new LinkedHashMap&lt;&gt;(5, 0.75F, true);</span><br><span class="line">map.put(1, 1);</span><br><span class="line">map.put(2, 2);</span><br><span class="line">map.put(3, 3);</span><br><span class="line">map.put(4, 4);</span><br><span class="line">map.put(5, 5);</span><br><span class="line"></span><br><span class="line">Log.d(TAG, &quot;before visit&quot;);</span><br><span class="line"></span><br><span class="line">for (Map.Entry&lt;Integer, Integer&gt; entry : map.entrySet()) {</span><br><span class="line">    Log.d(TAG, String.valueOf(entry.getValue()));</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">//&#x8BBF;&#x95EE;3&#xFF0C;4&#x4E24;&#x4E2A;&#x5143;&#x7D20;</span><br><span class="line">map.get(3);</span><br><span class="line">map.get(4);</span><br><span class="line"></span><br><span class="line">Log.d(TAG, &quot;after visit&quot;);</span><br><span class="line"></span><br><span class="line">for (Map.Entry&lt;Integer, Integer&gt; entry : map.entrySet()) {</span><br><span class="line">    Log.d(TAG, String.valueOf(entry.getValue()));</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x7A0B;&#x5E8F;&#x8F93;&#x5165;Log&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/22627c3005937159df45b95fecd5cab1ef26f8ae69b7068c6c3d5cbdc70fed9a" alt><br>&#x6CE8;&#xFF1A;&#x5728;LinkedHashMap&#x4E2D;&#x6700;&#x8FD1;&#x88AB;&#x65B9;&#x4F4D;&#x7684;&#x5143;&#x7D20;&#x4F1A;&#x88AB;&#x79FB;&#x52A8;&#x5230;&#x8868;&#x5C3E;&#xFF0C;LruCache&#x4E5F;&#x662F;&#x4ECE;&#x4ECE;&#x8868;&#x5C3E;&#x8BBF;&#x95EE;&#x6570;&#x636E;&#xFF0C;&#x5728;&#x8868;&#x5934;&#x5220;&#x9664;&#x6570;&#x636E;&#xFF0C;</p>
<p>&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#xFF0C;&#x6700;&#x540E;&#x8BBF;&#x95EE;&#x7684;&#x6570;&#x636E;&#x5C31;&#x4F1A;&#x88AB;&#x79FB;&#x52A8;&#x6700;&#x5C3E;&#x7AEF;&#xFF0C;&#x8FD9;&#x662F;&#x7B26;&#x5408;&#x6211;&#x4EEC;&#x7684;&#x9884;&#x671F;&#x7684;&#x3002;&#x6240;&#x6709;&#x5728;LruCache&#x7684;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x4E2D;&#x6784;&#x9020;&#x4E86;&#x4E00;&#x4E2A;&#x8FD9;&#x6837;&#x7684;LinkedHashMap&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public LruCache(int maxSize) {</span><br><span class="line">    if (maxSize &lt;= 0) {</span><br><span class="line">        throw new IllegalArgumentException(&quot;maxSize &lt;= 0&quot;);</span><br><span class="line">    }</span><br><span class="line">    this.maxSize = maxSize;</span><br><span class="line">    this.map = new LinkedHashMap&lt;K, V&gt;(0, 0.75f, true);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;&#x770B;LruCache&#x662F;&#x5982;&#x4F55;&#x8FDB;&#x884C;&#x7F13;&#x5B58;&#x7684;&#x5199;&#x5165;&#x3001;&#x83B7;&#x53D6;&#x548C;&#x5220;&#x9664;&#x7684;&#x3002;</p>
<h3 id="2-1-&#x5199;&#x5165;&#x7F13;&#x5B58;"><a href="#2-1-&#x5199;&#x5165;&#x7F13;&#x5B58;" class="headerlink" title="2.1 &#x5199;&#x5165;&#x7F13;&#x5B58;"></a>2.1 &#x5199;&#x5165;&#x7F13;&#x5B58;</h3><p>&#x5199;&#x5165;&#x7F13;&#x5B58;&#x662F;&#x901A;&#x8FC7;LruCache&#x7684;put()&#x65B9;&#x6CD5;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public class LruCache&lt;K, V&gt; {</span><br><span class="line">    </span><br><span class="line">    public final V put(K key, V value) {</span><br><span class="line">        if (key == null || value == null) {</span><br><span class="line">            throw new NullPointerException(&quot;key == null || value == null&quot;);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        V previous;</span><br><span class="line">        //&#x52A0;&#x9501;&#xFF0C;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;</span><br><span class="line">        synchronized (this) {</span><br><span class="line">            //&#x63D2;&#x5165;&#x7684;&#x6570;&#x91CF;&#x81EA;&#x589E;</span><br><span class="line">            putCount++;</span><br><span class="line">            //&#x5229;&#x7528;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;&#x7684;sizeOf()&#x65B9;&#x6CD5;&#x8BA1;&#x7B97;&#x5F53;&#x524D;&#x9879;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x5E76;&#x589E;&#x52A0;&#x5DF2;&#x6709;&#x7F13;&#x5B58;size&#x7684;&#x5927;&#x5C0F;</span><br><span class="line">            size += safeSizeOf(key, value);</span><br><span class="line">            //&#x63D2;&#x5165;&#x5F53;&#x524D;&#x9879;&#x3001;</span><br><span class="line">            previous = map.put(key, value);</span><br><span class="line">            //previous&#x5982;&#x679C;&#x4E0D;&#x4E3A;&#x7A7A;&#xFF0C;&#x5219;&#x8BF4;&#x660E;&#x8BE5;&#x9879;&#x5728;&#x539F;&#x6765;&#x7684;&#x94FE;&#x8868;&#x4E2D;&#x4EE5;&#x53CA;&#x5B58;&#x5728;&#xFF0C;&#x5DF2;&#x6709;&#x7F13;&#x5B58;&#x5927;&#x5C0F;size&#x6062;&#x590D;&#x5230;</span><br><span class="line">            //&#x4EE5;&#x524D;&#x7684;&#x5927;&#x5C0F;</span><br><span class="line">            if (previous != null) {</span><br><span class="line">                size -= safeSizeOf(key, previous);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        //&#x56DE;&#x8C03;entryRemoved()&#x65B9;&#x6CD5;</span><br><span class="line">        if (previous != null) {</span><br><span class="line">            entryRemoved(false, key, previous, value);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        //&#x8C03;&#x6574;&#x7F13;&#x5B58;&#x5927;&#x5C0F;&#xFF0C;&#x5982;&#x679C;&#x7F13;&#x5B58;&#x6EE1;&#x4E86;&#xFF0C;&#x5219;&#x6309;&#x7167;Lru&#x7B97;&#x6CD5;&#x5220;&#x9664;&#x5BF9;&#x5E94;&#x7684;&#x9879;&#x3002;</span><br><span class="line">        trimToSize(maxSize);</span><br><span class="line">        return previous;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    public void trimToSize(int maxSize) {</span><br><span class="line">        //&#x5F00;&#x542F;&#x6B7B;&#x5FAA;&#x73AF;&#xFF0C;&#x77E5;&#x9053;&#x7F13;&#x5B58;&#x4E0D;&#x6EE1;&#x4E3A;&#x6B62;</span><br><span class="line">        while (true) {</span><br><span class="line">            K key;</span><br><span class="line">            V value;</span><br><span class="line">            synchronized (this) {</span><br><span class="line">                //&#x53C2;&#x6570;&#x68C0;&#x67E5;</span><br><span class="line">                if (size &lt; 0 || (map.isEmpty() &amp;&amp; size != 0)) {</span><br><span class="line">                    throw new IllegalStateException(getClass().getName()</span><br><span class="line">                            + &quot;.sizeOf() is reporting inconsistent results!&quot;);</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                //&#x5982;&#x679C;&#x7F13;&#x5B58;&#x4E3A;&#x6EE1;&#xFF0C;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;                </span><br><span class="line">                if (size &lt;= maxSize) {</span><br><span class="line">                    break;</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                //&#x8FD4;&#x56DE;&#x6700;&#x8FD1;&#x6700;&#x4E45;&#x672A;&#x4F7F;&#x7528;&#x7684;&#x5143;&#x7D20;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x94FE;&#x8868;&#x7684;&#x8868;&#x5934;&#x5143;&#x7D20;</span><br><span class="line">                Map.Entry&lt;K, V&gt; toEvict = map.eldest();</span><br><span class="line">                if (toEvict == null) {</span><br><span class="line">                    break;</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                key = toEvict.getKey();</span><br><span class="line">                value = toEvict.getValue();</span><br><span class="line">                //&#x5220;&#x9664;&#x8BE5;&#x8868;&#x5934;&#x5143;&#x7D20;</span><br><span class="line">                map.remove(key);</span><br><span class="line">                //&#x51CF;&#x5C11;&#x603B;&#x7F13;&#x5B58;&#x5927;&#x5C0F;</span><br><span class="line">                size -= safeSizeOf(key, value);</span><br><span class="line">                //&#x88AB;&#x5220;&#x9664;&#x7684;&#x9879;&#x7684;&#x6570;&#x91CF;&#x81EA;&#x589E;</span><br><span class="line">                evictionCount++;</span><br><span class="line">            }</span><br><span class="line">            //&#x56DE;&#x5230;entryRemoved()&#x65B9;&#x6CD5;</span><br><span class="line">            entryRemoved(true, key, value, null);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x6574;&#x4E2A;&#x63D2;&#x5165;&#x5143;&#x7D20;&#x7684;&#x65B9;&#x6CD5;put()&#x5B9E;&#x73B0;&#x903B;&#x8F91;&#x662F;&#x5F88;&#x7B80;&#x5355;&#x7684;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<ol>
<li>&#x63D2;&#x5165;&#x5143;&#x7D20;&#xFF0C;&#x5E76;&#x76F8;&#x5E94;&#x589E;&#x52A0;&#x5F53;&#x524D;&#x7F13;&#x5B58;&#x7684;&#x5BB9;&#x91CF;&#x3002;</li>
<li>&#x8C03;&#x7528;trimToSize()&#x5F00;&#x542F;&#x4E00;&#x4E2A;&#x6B7B;&#x5FAA;&#x73AF;&#xFF0C;&#x4E0D;&#x65AD;&#x7684;&#x4ECE;&#x8868;&#x5934;&#x5220;&#x9664;&#x5143;&#x7D20;&#xFF0C;&#x76F4;&#x5230;&#x5F53;&#x524D;&#x7F13;&#x5B58;&#x7684;&#x5BB9;&#x91CF;&#x5C0F;&#x4E8E;&#x6700;&#x5927;&#x5BB9;&#x91CF;&#x4E3A;&#x6B62;&#x3002;</li>
</ol>
<h3 id="2-2-&#x8BFB;&#x53D6;&#x7F13;&#x5B58;"><a href="#2-2-&#x8BFB;&#x53D6;&#x7F13;&#x5B58;" class="headerlink" title="2.2 &#x8BFB;&#x53D6;&#x7F13;&#x5B58;"></a>2.2 &#x8BFB;&#x53D6;&#x7F13;&#x5B58;</h3><p>&#x8BFB;&#x53D6;&#x7F13;&#x5B58;&#x662F;&#x901A;&#x8FC7;LruCache&#x7684;get()&#x65B9;&#x6CD5;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public class LruCache&lt;K, V&gt; {</span><br><span class="line">    </span><br><span class="line">    public final V get(K key) {</span><br><span class="line">          if (key == null) {</span><br><span class="line">              throw new NullPointerException(&quot;key == null&quot;);</span><br><span class="line">          }</span><br><span class="line">  </span><br><span class="line">          V mapValue;</span><br><span class="line">          synchronized (this) {</span><br><span class="line">              //&#x8C03;&#x7528;LinkedHashMap&#x7684;get()&#x65B9;&#x6CD5;&#xFF0C;&#x6CE8;&#x610F;&#x5982;&#x679C;&#x8BE5;&#x5143;&#x7D20;&#x5B58;&#x5728;&#xFF0C;&#x4E14;accessOrder&#x4E3A;true&#xFF0C;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4F1A;</span><br><span class="line">              //&#x5C06;&#x8BE5;&#x5143;&#x7D20;&#x79FB;&#x52A8;&#x5230;&#x8868;&#x5C3E;</span><br><span class="line">              mapValue = map.get(key);</span><br><span class="line">              if (mapValue != null) {</span><br><span class="line">                  hitCount++;</span><br><span class="line">                  return mapValue;</span><br><span class="line">              }</span><br><span class="line">              //</span><br><span class="line">              missCount++;</span><br><span class="line">          }</span><br><span class="line">            </span><br><span class="line">          //&#x524D;&#x9762;&#x6211;&#x4EEC;&#x5C31;&#x63D0;&#x5230;&#x8FC7;&#xFF0C;&#x53EF;&#x4EE5;&#x8986;&#x5199;create()&#x65B9;&#x6CD5;&#xFF0C;&#x5F53;&#x83B7;&#x53D6;&#x4E0D;&#x5230;&#x548C;key&#x5BF9;&#x5E94;&#x7684;&#x5143;&#x7D20;&#x65F6;&#xFF0C;&#x5C1D;&#x8BD5;&#x8C03;&#x7528;create()&#x65B9;&#x6CD5;</span><br><span class="line">          //&#x521B;&#x5EFA;&#x5EFA;&#x5143;&#x7D20;&#xFF0C;&#x4EE5;&#x4E0B;&#x5C31;&#x662F;&#x521B;&#x5EFA;&#x7684;&#x8FC7;&#x7A0B;&#xFF0C;&#x548C;put()&#x65B9;&#x6CD5;&#x6D41;&#x7A0B;&#x76F8;&#x540C;&#x3002;</span><br><span class="line">          V createdValue = create(key);</span><br><span class="line">          if (createdValue == null) {</span><br><span class="line">              return null;</span><br><span class="line">          }</span><br><span class="line">  </span><br><span class="line">          synchronized (this) {</span><br><span class="line">              createCount++;</span><br><span class="line">              mapValue = map.put(key, createdValue);</span><br><span class="line">  </span><br><span class="line">              if (mapValue != null) {</span><br><span class="line">                  // There was a conflict so undo that last put</span><br><span class="line">                  map.put(key, mapValue);</span><br><span class="line">              } else {</span><br><span class="line">                  size += safeSizeOf(key, createdValue);</span><br><span class="line">              }</span><br><span class="line">          }</span><br><span class="line">  </span><br><span class="line">          if (mapValue != null) {</span><br><span class="line">              entryRemoved(false, key, createdValue, mapValue);</span><br><span class="line">              return mapValue;</span><br><span class="line">          } else {</span><br><span class="line">              trimToSize(maxSize);</span><br><span class="line">              return createdValue;</span><br><span class="line">          }</span><br><span class="line">      }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x83B7;&#x53D6;&#x5143;&#x7D20;&#x7684;&#x903B;&#x8F91;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<ol>
<li>&#x8C03;&#x7528;LinkedHashMap&#x7684;get()&#x65B9;&#x6CD5;&#xFF0C;&#x6CE8;&#x610F;&#x5982;&#x679C;&#x8BE5;&#x5143;&#x7D20;&#x5B58;&#x5728;&#xFF0C;&#x4E14;accessOrder&#x4E3A;true&#xFF0C;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4F1A;&#x5C06;&#x8BE5;&#x5143;&#x7D20;&#x79FB;&#x52A8;&#x5230;&#x8868;&#x5C3E;.</li>
<li>&#x5F53;&#x83B7;&#x53D6;&#x4E0D;&#x5230;&#x548C;key&#x5BF9;&#x5E94;&#x7684;&#x5143;&#x7D20;&#x65F6;&#xFF0C;&#x5C1D;&#x8BD5;&#x8C03;&#x7528;create()&#x65B9;&#x6CD5;&#x521B;&#x5EFA;&#x5EFA;&#x5143;&#x7D20;&#xFF0C;&#x4EE5;&#x4E0B;&#x5C31;&#x662F;&#x521B;&#x5EFA;&#x7684;&#x8FC7;&#x7A0B;&#xFF0C;&#x548C;put()&#x65B9;&#x6CD5;&#x6D41;&#x7A0B;&#x76F8;&#x540C;&#x3002;</li>
</ol>
<h3 id="2-3-&#x5220;&#x9664;&#x7F13;&#x5B58;"><a href="#2-3-&#x5220;&#x9664;&#x7F13;&#x5B58;" class="headerlink" title="2.3 &#x5220;&#x9664;&#x7F13;&#x5B58;"></a>2.3 &#x5220;&#x9664;&#x7F13;&#x5B58;</h3><p>&#x5220;&#x9664;&#x7F13;&#x5B58;&#x662F;&#x901A;&#x8FC7;LruCache&#x7684;remove()&#x65B9;&#x6CD5;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public class LruCache&lt;K, V&gt; {</span><br><span class="line">    </span><br><span class="line">    public final V remove(K key) {</span><br><span class="line">        if (key == null) {</span><br><span class="line">            throw new NullPointerException(&quot;key == null&quot;);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        V previous;</span><br><span class="line">        synchronized (this) {</span><br><span class="line">            //&#x8C03;&#x7528;&#x5BF9;&#x5E94;LinkedHashMap&#x7684;remove()&#x65B9;&#x6CD5;&#x5220;&#x9664;&#x5BF9;&#x5E94;&#x5143;&#x7D20;</span><br><span class="line">            previous = map.remove(key);</span><br><span class="line">            if (previous != null) {</span><br><span class="line">                size -= safeSizeOf(key, previous);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        if (previous != null) {</span><br><span class="line">            entryRemoved(false, key, previous, null);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        return previous;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5220;&#x9664;&#x5143;&#x7D20;&#x7684;&#x903B;&#x8F91;&#x5C31;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#x4E86;&#xFF0C;&#x8C03;&#x7528;&#x5BF9;&#x5E94;LinkedHashMap&#x7684;remove()&#x65B9;&#x6CD5;&#x5220;&#x9664;&#x5BF9;&#x5E94;&#x5143;&#x7D20;&#x3002;</p>
<h2 id="&#x4E09;-DiskLruCache&#x539F;&#x7406;&#x5206;&#x6790;"><a href="#&#x4E09;-DiskLruCache&#x539F;&#x7406;&#x5206;&#x6790;" class="headerlink" title="&#x4E09; DiskLruCache&#x539F;&#x7406;&#x5206;&#x6790;"></a>&#x4E09; DiskLruCache&#x539F;&#x7406;&#x5206;&#x6790;</h2><p>&#x1F449; <a href="/external_links/397edd886778d62b40bb3e50fe0917cb.html" target="blank" rel="noopener">DiskLruCache.java</a></p>
<p>&#x5728;&#x5206;&#x6790;DiskLruCache&#x7684;&#x5B9E;&#x73B0;&#x539F;&#x7406;&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x5148;&#x6765;&#x5199;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x5C0F;&#x4F8B;&#x5B50;&#xFF0C;&#x4ECE;&#x4F8B;&#x5B50;&#x51FA;&#x53D1;&#x53BB;&#x5206;&#x6790;DiskLruCache&#x7684;&#x5B9E;&#x73B0;&#x539F;&#x7406;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;File directory = getCacheDir();</span><br><span class="line">int appVersion = 1;</span><br><span class="line">int valueCount = 1;</span><br><span class="line">long maxSize = 10 * 1024;</span><br><span class="line">DiskLruCache diskLruCache = DiskLruCache.open(directory, appVersion, valueCount, maxSize);</span><br><span class="line"></span><br><span class="line">DiskLruCache.Editor editor = diskLruCache.edit(String.valueOf(System.currentTimeMillis()));</span><br><span class="line">BufferedOutputStream bufferedOutputStream = new BufferedOutputStream(editor.newOutputStream(0));</span><br><span class="line">Bitmap bitmap = BitmapFactory.decodeResource(getResources(), R.drawable.scenery);</span><br><span class="line">bitmap.compress(Bitmap.CompressFormat.JPEG, 100, bufferedOutputStream);</span><br><span class="line"></span><br><span class="line">editor.commit();</span><br><span class="line">diskLruCache.flush();</span><br><span class="line">diskLruCache.close();</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x4E2A;&#x5C31;&#x662F;DiskLruCache&#x7684;&#x5927;&#x81F4;&#x4F7F;&#x7528;&#x6D41;&#x7A0B;&#xFF0C;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x770B;&#x8FD9;&#x4E2A;&#x5165;&#x53E3;&#x65B9;&#x6CD5;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public final class DiskLruCache implements Closeable {</span><br><span class="line">    </span><br><span class="line">     public static DiskLruCache open(File directory, int appVersion, int valueCount, long maxSize)</span><br><span class="line">          throws IOException {</span><br><span class="line">        if (maxSize &lt;= 0) {</span><br><span class="line">          throw new IllegalArgumentException(&quot;maxSize &lt;= 0&quot;);</span><br><span class="line">        }</span><br><span class="line">        if (valueCount &lt;= 0) {</span><br><span class="line">          throw new IllegalArgumentException(&quot;valueCount &lt;= 0&quot;);</span><br><span class="line">        }</span><br><span class="line">    </span><br><span class="line">        File backupFile = new File(directory, JOURNAL_FILE_BACKUP);</span><br><span class="line">        //&#x5982;&#x679C;&#x5907;&#x4EFD;&#x6587;&#x4EF6;&#x5B58;&#x5728;</span><br><span class="line">        if (backupFile.exists()) {</span><br><span class="line">          File journalFile = new File(directory, JOURNAL_FILE);</span><br><span class="line">          // &#x5982;&#x679C;journal&#x6587;&#x4EF6;&#x5B58;&#x5728;&#xFF0C;&#x5219;&#x628A;&#x5907;&#x4EFD;&#x6587;&#x4EF6;journal.bkp&#x662F;&#x5220;&#x4E86;</span><br><span class="line">          if (journalFile.exists()) {</span><br><span class="line">            backupFile.delete();</span><br><span class="line">          } else {</span><br><span class="line">            //&#x5982;&#x679C;journal&#x6587;&#x4EF6;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x5219;&#x5C06;&#x5907;&#x4EFD;&#x6587;&#x4EF6;&#x547D;&#x540D;&#x4E3A;journal</span><br><span class="line">            renameTo(backupFile, journalFile, false);</span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">    </span><br><span class="line">        DiskLruCache cache = new DiskLruCache(directory, appVersion, valueCount, maxSize);</span><br><span class="line">        </span><br><span class="line">        //&#x5224;&#x65AD;journal&#x6587;&#x4EF6;&#x662F;&#x5426;&#x5B58;&#x5728;</span><br><span class="line">        if (cache.journalFile.exists()) {</span><br><span class="line">          //&#x5982;&#x679C;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x4EE5;&#x53CA;&#x5B58;&#x5728;</span><br><span class="line">          try {</span><br><span class="line">            //&#x8BFB;&#x53D6;journal&#x6587;&#x4EF6;&#xFF0C;&#x6839;&#x636E;&#x8BB0;&#x5F55;&#x4E2D;&#x4E0D;&#x540C;&#x7684;&#x64CD;&#x4F5C;&#x7C7B;&#x578B;&#x8FDB;&#x884C;&#x76F8;&#x5E94;&#x7684;&#x5904;&#x7406;&#x3002;</span><br><span class="line">            cache.readJournal();</span><br><span class="line">            //&#x8BA1;&#x7B97;&#x5F53;&#x524D;&#x7F13;&#x5B58;&#x5BB9;&#x91CF;&#x7684;&#x5927;&#x5C0F;</span><br><span class="line">            cache.processJournal();</span><br><span class="line">            cache.journalWriter = new BufferedWriter(</span><br><span class="line">                new OutputStreamWriter(new FileOutputStream(cache.journalFile, true), Util.US_ASCII));</span><br><span class="line">            return cache;</span><br><span class="line">          } catch (IOException journalIsCorrupt) {</span><br><span class="line">            System.out</span><br><span class="line">                .println(&quot;DiskLruCache &quot;</span><br><span class="line">                    + directory</span><br><span class="line">                    + &quot; is corrupt: &quot;</span><br><span class="line">                    + journalIsCorrupt.getMessage()</span><br><span class="line">                    + &quot;, removing&quot;);</span><br><span class="line">            cache.delete();</span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">    </span><br><span class="line">        // Create a new empty cache.</span><br><span class="line">        //&#x521B;&#x5EFA;&#x65B0;&#x7684;&#x7F13;&#x5B58;&#x76EE;&#x5F55;</span><br><span class="line">        directory.mkdirs();</span><br><span class="line">        cache = new DiskLruCache(directory, appVersion, valueCount, maxSize);</span><br><span class="line">        //&#x8C03;&#x7528;&#x65B0;&#x7684;&#x65B9;&#x6CD5;&#x5EFA;&#x7ACB;&#x65B0;&#x7684;journal&#x6587;&#x4EF6;</span><br><span class="line">        cache.rebuildJournal();</span><br><span class="line">        return cache;</span><br><span class="line">      }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5148;&#x6765;&#x8BF4;&#x4E00;&#x4E0B;&#x8FD9;&#x4E2A;&#x5165;&#x53E3;&#x65B9;&#x6CD5;&#x7684;&#x56DB;&#x4E2A;&#x53C2;&#x6570;&#x7684;&#x542B;&#x4E49;&#xFF1A;</p>
<ul>
<li>File directory&#xFF1A;&#x7F13;&#x5B58;&#x76EE;&#x5F55;&#x3002;</li>
<li>int appVersion&#xFF1A;&#x5E94;&#x7528;&#x7248;&#x672C;&#x53F7;&#x3002;</li>
<li>int valueCount&#xFF1A;&#x4E00;&#x4E2A;key&#x5BF9;&#x5E94;&#x7684;&#x7F13;&#x5B58;&#x6587;&#x4EF6;&#x7684;&#x6570;&#x76EE;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x4F20;&#x5165;&#x7684;&#x53C2;&#x6570;&#x5927;&#x4E8E;1&#xFF0C;&#x90A3;&#x4E48;&#x7F13;&#x5B58;&#x6587;&#x4EF6;&#x540E;&#x7F00;&#x5C31;&#x662F;.0&#xFF0C;.1&#x7B49;&#x3002;</li>
<li>long maxSize&#xFF1A;&#x7F13;&#x5B58;&#x5BB9;&#x91CF;&#x4E0A;&#x9650;&#x3002;</li>
</ul>
<p>DiskLruCache&#x7684;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x5E76;&#x6CA1;&#x6709;&#x505A;&#x522B;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x53EA;&#x662F;&#x7B80;&#x5355;&#x7684;&#x5C06;&#x5BF9;&#x5E94;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x8FDB;&#x884C;&#x521D;&#x59CB;&#x5316;&#xFF0C;open()&#x65B9;&#x6CD5;&#x4E3B;&#x8981;&#x56F4;&#x7ED5;&#x7740;journal&#x6587;&#x4EF6;&#x7684;&#x521B;&#x5EFA;&#x4E0E;&#x8BFB;&#x5199;&#x800C;&#x5C55;&#x5F00;&#x7684;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<ul>
<li>readJournal()&#xFF1A;&#x8BFB;&#x53D6;journal&#x6587;&#x4EF6;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x8BFB;&#x53D6;&#x6587;&#x4EF6;&#x5934;&#x91CC;&#x7684;&#x4FE1;&#x606F;&#x8FDB;&#x884C;&#x68C0;&#x9A8C;&#xFF0C;&#x7136;&#x540E;&#x8C03;&#x7528;readJournalLine()&#x9010;&#x884C;&#x53BB;&#x8BFB;&#x53D6;&#xFF0C;&#x6839;&#x636E;&#x8BFB;&#x53D6;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x6267;&#x884C;&#x76F8;&#x5E94;&#x7684;&#x7F13;&#x5B58;<br>&#x6DFB;&#x52A0;&#x3001;&#x79FB;&#x9664;&#x7B49;&#x64CD;&#x4F5C;&#x3002;</li>
<li>rebuildJournal()&#xFF1A;&#x91CD;&#x5EFA;journal&#x6587;&#x4EF6;&#xFF0C;&#x91CD;&#x5EFA;journal&#x6587;&#x4EF6;&#x4E3B;&#x8981;&#x662F;&#x5199;&#x5165;&#x6587;&#x4EF6;&#x5934;&#xFF08;&#x4E0A;&#x9762;&#x63D0;&#x5230;&#x7684;journal&#x6587;&#x4EF6;&#x90FD;&#x6709;&#x7684;&#x524D;&#x9762;&#x4E94;&#x884C;&#x7684;&#x5185;&#x5BB9;&#xFF09;&#x3002;</li>
<li>rocessJournal()&#xFF1A;&#x8BA1;&#x7B97;&#x5F53;&#x524D;&#x7F13;&#x5B58;&#x5BB9;&#x91CF;&#x7684;&#x5927;&#x5C0F;&#x3002;</li>
</ul>
<p>&#x6211;&#x4EEC;&#x63A5;&#x7740;&#x6765;&#x5206;&#x6790;&#x4EC0;&#x4E48;&#x662F;journal&#x6587;&#x4EF6;&#xFF0C;&#x4EE5;&#x53CA;&#x5B83;&#x7684;&#x521B;&#x5EFA;&#x4E0E;&#x8BFB;&#x5199;&#x6D41;&#x7A0B;&#x3002;</p>
<h3 id="3-1-journal&#x6587;&#x4EF6;&#x7684;&#x521B;&#x5EFA;"><a href="#3-1-journal&#x6587;&#x4EF6;&#x7684;&#x521B;&#x5EFA;" class="headerlink" title="3.1 journal&#x6587;&#x4EF6;&#x7684;&#x521B;&#x5EFA;"></a>3.1 journal&#x6587;&#x4EF6;&#x7684;&#x521B;&#x5EFA;</h3><p>&#x5728;&#x524D;&#x9762;&#x5206;&#x6790;&#x7684;open()&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x4E3B;&#x8981;&#x56F4;&#x7ED5;&#x7740;journal&#x6587;&#x4EF6;&#x7684;&#x521B;&#x5EFA;&#x548C;&#x8BFB;&#x5199;&#x6765;&#x5C55;&#x5F00;&#x7684;&#xFF0C;&#x90A3;&#x4E48;journal&#x6587;&#x4EF6;&#x662F;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;&#x1F914;</p>
<p>&#x6211;&#x4EEC;&#x5982;&#x679C;&#x53BB;&#x6253;&#x5F00;&#x7F13;&#x5B58;&#x76EE;&#x5F55;&#xFF0C;&#x5C31;&#x4F1A;&#x53D1;&#x73B0;&#x9664;&#x4E86;&#x7F13;&#x5B58;&#x6587;&#x4EF6;&#xFF0C;&#x8FD8;&#x4F1A;&#x53D1;&#x73B0;&#x4E00;&#x4E2A;journal&#x6587;&#x4EF6;&#xFF0C;journal&#x6587;&#x4EF6;&#x7528;&#x6765;&#x8BB0;&#x5F55;&#x7F13;&#x5B58;&#x7684;&#x64CD;&#x4F5C;&#x8BB0;&#x5F55;&#x7684;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;libcore.io.DiskLruCache</span><br><span class="line">1</span><br><span class="line">1</span><br><span class="line">1</span><br><span class="line"></span><br><span class="line">DIRTY 1517126350519</span><br><span class="line">CLEAN 1517126350519 5325928</span><br><span class="line">REMOVE 1517126350519</span><br></pre></td></tr></table></figure>

<p>&#x6CE8;&#xFF1A;&#x8FD9;&#x91CC;&#x7684;&#x7F13;&#x5B58;&#x76EE;&#x5F55;&#x662F;&#x5E94;&#x7528;&#x7684;&#x7F13;&#x5B58;&#x76EE;&#x5F55;/data/data/pckagename/cache&#xFF0C;&#x672A;root&#x7684;&#x624B;&#x673A;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#x8FDB;&#x5165;&#x5230;&#x8BE5;&#x76EE;&#x5F55;&#x4E2D;&#x6216;&#x8005;&#x5C06;&#x8BE5;&#x76EE;&#x5F55;&#x6574;&#x4F53;&#x62F7;&#x8D1D;&#x51FA;&#x6765;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">//&#x8FDB;&#x5165;/data/data/pckagename/cache&#x76EE;&#x5F55;</span><br><span class="line">adb shell</span><br><span class="line">run-as com.your.packagename </span><br><span class="line">cp /data/data/com.your.packagename/</span><br><span class="line"></span><br><span class="line">//&#x5C06;/data/data/pckagename&#x76EE;&#x5F55;&#x62F7;&#x8D1D;&#x51FA;&#x6765;</span><br><span class="line">adb backup -noapk com.your.packagename</span><br></pre></td></tr></table></figure>

<p>&#x6211;&#x4EEC;&#x6765;&#x5206;&#x6790;&#x4E0B;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x7684;&#x5185;&#x5BB9;&#xFF1A;</p>
<ul>
<li>&#x7B2C;&#x4E00;&#x884C;&#xFF1A;libcore.io.DiskLruCache&#xFF0C;&#x56FA;&#x5B9A;&#x5B57;&#x7B26;&#x4E32;&#x3002;</li>
<li>&#x7B2C;&#x4E8C;&#x884C;&#xFF1A;1&#xFF0C;DiskLruCache&#x6E90;&#x7801;&#x7248;&#x672C;&#x53F7;&#x3002;</li>
<li>&#x7B2C;&#x4E09;&#x884C;&#xFF1A;1&#xFF0C;App&#x7684;&#x7248;&#x672C;&#x53F7;&#xFF0C;&#x901A;&#x8FC7;open()&#x65B9;&#x6CD5;&#x4F20;&#x5165;&#x8FDB;&#x53BB;&#x7684;&#x3002;</li>
<li>&#x7B2C;&#x56DB;&#x884C;&#xFF1A;1&#xFF0C;&#x6BCF;&#x4E2A;key&#x5BF9;&#x5E94;&#x51E0;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x4E00;&#x822C;&#x4E3A;1.</li>
<li>&#x7B2C;&#x4E94;&#x884C;&#xFF1A;&#x7A7A;&#x884C;</li>
<li>&#x7B2C;&#x516D;&#x884C;&#x53CA;&#x540E;&#x7EED;&#x884C;&#xFF1A;&#x7F13;&#x5B58;&#x64CD;&#x4F5C;&#x8BB0;&#x5F55;&#x3002;</li>
</ul>
<p>&#x7B2C;&#x516D;&#x884C;&#x53CA;&#x540E;&#x7EED;&#x884C;&#x8868;&#x793A;&#x7F13;&#x5B58;&#x64CD;&#x4F5C;&#x8BB0;&#x5F55;&#xFF0C;&#x5173;&#x4E8E;&#x64CD;&#x4F5C;&#x8BB0;&#x5F55;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4E86;&#x89E3;&#x4EE5;&#x4E0B;&#x4E09;&#x70B9;&#xFF1A;</p>
<ol>
<li>DIRTY &#x8868;&#x793A;&#x4E00;&#x4E2A;entry&#x6B63;&#x5728;&#x88AB;&#x5199;&#x5165;&#x3002;&#x5199;&#x5165;&#x5206;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x5982;&#x679C;&#x6210;&#x529F;&#x4F1A;&#x7D27;&#x63A5;&#x7740;&#x5199;&#x5165;&#x4E00;&#x884C;CLEAN&#x7684;&#x8BB0;&#x5F55;&#xFF1B;&#x5982;&#x679C;&#x5931;&#x8D25;&#xFF0C;&#x4F1A;&#x589E;&#x52A0;&#x4E00;&#x884C;REMOVE&#x8BB0;&#x5F55;&#x3002;&#x6CE8;&#x610F;&#x5355;&#x72EC;&#x53EA;&#x6709;DIRTY&#x72B6;&#x6001;&#x7684;&#x8BB0;&#x5F55;&#x662F;&#x975E;&#x6CD5;&#x7684;&#x3002;</li>
<li>&#x5F53;&#x624B;&#x52A8;&#x8C03;&#x7528;remove(key)&#x65B9;&#x6CD5;&#x7684;&#x65F6;&#x5019;&#x4E5F;&#x4F1A;&#x5199;&#x5165;&#x4E00;&#x6761;REMOVE&#x8BB0;&#x5F55;&#x3002;</li>
<li>READ&#x5C31;&#x662F;&#x8BF4;&#x660E;&#x6709;&#x4E00;&#x6B21;&#x8BFB;&#x53D6;&#x7684;&#x8BB0;&#x5F55;&#x3002;</li>
<li>CLEAN&#x7684;&#x540E;&#x9762;&#x8FD8;&#x8BB0;&#x5F55;&#x4E86;&#x6587;&#x4EF6;&#x7684;&#x957F;&#x5EA6;&#xFF0C;&#x6CE8;&#x610F;&#x53EF;&#x80FD;&#x4F1A;&#x4E00;&#x4E2A;key&#x5BF9;&#x5E94;&#x591A;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x4F1A;&#x6709;&#x591A;&#x4E2A;&#x6570;&#x5B57;&#x3002;</li>
</ol>
<p>&#x8FD9;&#x51E0;&#x79CD;&#x64CD;&#x4F5C;&#x5BF9;&#x5E94;&#x5230;DiskLruCache&#x6E90;&#x7801;&#x4E2D;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;private static final String CLEAN = &quot;CLEAN&quot;;</span><br><span class="line">private static final String DIRTY = &quot;DIRTY&quot;;</span><br><span class="line">private static final String REMOVE = &quot;REMOVE&quot;;</span><br><span class="line">private static final String READ = &quot;READ&quot;;</span><br></pre></td></tr></table></figure>

<p>&#x90A3;&#x4E48;&#x6784;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;journal&#x6587;&#x4EF6;&#x5462;&#xFF1F;&#x4E0A;&#x9762;&#x6211;&#x4EEC;&#x4E5F;&#x8BF4;&#x8FC7;&#x8FD9;&#x662F;&#x8C03;&#x7528;rebuildJournal()&#x65B9;&#x6CD5;&#x6765;&#x5B8C;&#x6210;&#x7684;&#x3002;</p>
<h4 id="rebuildJournal"><a href="#rebuildJournal" class="headerlink" title="rebuildJournal()"></a>rebuildJournal()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public final class DiskLruCache implements Closeable {</span><br><span class="line">    </span><br><span class="line">     static final String MAGIC = &quot;libcore.io.DiskLruCache&quot;;</span><br><span class="line">    </span><br><span class="line">     private synchronized void rebuildJournal() throws IOException {</span><br><span class="line">        if (journalWriter != null) {</span><br><span class="line">          journalWriter.close();</span><br><span class="line">        }</span><br><span class="line">    </span><br><span class="line">        Writer writer = new BufferedWriter(</span><br><span class="line">            new OutputStreamWriter(new FileOutputStream(journalFileTmp), Util.US_ASCII));</span><br><span class="line">        try {</span><br><span class="line">          //&#x5199;&#x5165;&#x6587;&#x4EF6;&#x5934;</span><br><span class="line">          writer.write(MAGIC);</span><br><span class="line">          writer.write(&quot;\n&quot;);</span><br><span class="line">          writer.write(VERSION_1);</span><br><span class="line">          writer.write(&quot;\n&quot;);</span><br><span class="line">          writer.write(Integer.toString(appVersion));</span><br><span class="line">          writer.write(&quot;\n&quot;);</span><br><span class="line">          writer.write(Integer.toString(valueCount));</span><br><span class="line">          writer.write(&quot;\n&quot;);</span><br><span class="line">          writer.write(&quot;\n&quot;);</span><br><span class="line">    </span><br><span class="line">          for (Entry entry : lruEntries.values()) {</span><br><span class="line">            if (entry.currentEditor != null) {</span><br><span class="line">              writer.write(DIRTY + &apos; &apos; + entry.key + &apos;\n&apos;);</span><br><span class="line">            } else {</span><br><span class="line">              writer.write(CLEAN + &apos; &apos; + entry.key + entry.getLengths() + &apos;\n&apos;);</span><br><span class="line">            }</span><br><span class="line">          }</span><br><span class="line">        } finally {</span><br><span class="line">          writer.close();</span><br><span class="line">        }</span><br><span class="line">    </span><br><span class="line">        if (journalFile.exists()) {</span><br><span class="line">          renameTo(journalFile, journalFileBackup, true);</span><br><span class="line">        }</span><br><span class="line">        renameTo(journalFileTmp, journalFile, false);</span><br><span class="line">        journalFileBackup.delete();</span><br><span class="line">    </span><br><span class="line">        journalWriter = new BufferedWriter(</span><br><span class="line">            new OutputStreamWriter(new FileOutputStream(journalFile, true), Util.US_ASCII));</span><br><span class="line">      }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4F60;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#xFF0C;&#x6784;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;journal&#x6587;&#x4EF6;&#x8FC7;&#x7A0B;&#x5C31;&#x662F;&#x5199;&#x5165;&#x6587;&#x4EF6;&#x5934;&#x7684;&#x8FC7;&#x7A0B;&#xFF0C;&#x6587;&#x4EF6;&#x5934;&#x5185;&#x5BB9;&#x5305;&#x542B;&#x524D;&#x9762;&#x6211;&#x4EEC;&#x8BF4;&#x7684;appVersion&#x3001;valueCount&#x3001;&#x7A7A;&#x884C;&#x7B49;&#x4E94;&#x884C;&#x5185;&#x5BB9;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;&#x770B;&#x5982;&#x4F55;&#x8BFB;&#x53D6;journal&#x6587;&#x4EF6;&#x91CC;&#x7684;&#x5185;&#x5BB9;&#x3002;</p>
<h4 id="readJournal"><a href="#readJournal" class="headerlink" title="readJournal()"></a>readJournal()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public final class DiskLruCache implements Closeable {</span><br><span class="line">   private void readJournal() throws IOException {</span><br><span class="line">        StrictLineReader reader = new StrictLineReader(new FileInputStream(journalFile), Util.US_ASCII);</span><br><span class="line">        try {</span><br><span class="line">          //&#x8BFB;&#x53D6;&#x6587;&#x4EF6;&#x5934;&#xFF0C;&#x5E76;&#x8FDB;&#x884C;&#x6821;&#x9A8C;&#x3002;</span><br><span class="line">          String magic = reader.readLine();</span><br><span class="line">          String version = reader.readLine();</span><br><span class="line">          String appVersionString = reader.readLine();</span><br><span class="line">          String valueCountString = reader.readLine();</span><br><span class="line">          String blank = reader.readLine();</span><br><span class="line">          //&#x68C0;&#x67E5;&#x524D;&#x4E94;&#x884C;&#x7684;&#x5185;&#x5BB9;&#x662F;&#x5426;&#x5408;&#x6CD5;</span><br><span class="line">          if (!MAGIC.equals(magic)</span><br><span class="line">              || !VERSION_1.equals(version)</span><br><span class="line">              || !Integer.toString(appVersion).equals(appVersionString)</span><br><span class="line">              || !Integer.toString(valueCount).equals(valueCountString)</span><br><span class="line">              || !&quot;&quot;.equals(blank)) {</span><br><span class="line">            throw new IOException(&quot;unexpected journal header: [&quot; + magic + &quot;, &quot; + version + &quot;, &quot;</span><br><span class="line">                + valueCountString + &quot;, &quot; + blank + &quot;]&quot;);</span><br><span class="line">          }</span><br><span class="line">    </span><br><span class="line">         int lineCount = 0;</span><br><span class="line">         while (true) {</span><br><span class="line">           try {</span><br><span class="line">             //&#x5F00;&#x542F;&#x6B7B;&#x5FAA;&#x73AF;&#xFF0C;&#x9010;&#x884C;&#x8BFB;&#x53D6;journal&#x5185;&#x5BB9;</span><br><span class="line">             readJournalLine(reader.readLine());</span><br><span class="line">             //&#x6587;&#x4EF6;&#x4EE5;&#x53CA;&#x8BFB;&#x53D6;&#x7684;&#x884C;&#x6570;</span><br><span class="line">             lineCount++;</span><br><span class="line">           } catch (EOFException endOfJournal) {</span><br><span class="line">             break;</span><br><span class="line">           }</span><br><span class="line">         }</span><br><span class="line">         //lineCount&#x8868;&#x793A;&#x6587;&#x4EF6;&#x603B;&#x884C;&#x6570;&#xFF0C;lruEntries.size()&#x8868;&#x793A;&#x6700;&#x7EC8;&#x7F13;&#x5B58;&#x7684;&#x4E2A;&#x6570;&#xFF0C;redundantOpCount</span><br><span class="line">         //&#x5C31;&#x8868;&#x793A;&#x975E;&#x6CD5;&#x7F13;&#x5B58;&#x8BB0;&#x5F55;&#x7684;&#x4E2A;&#x6570;&#xFF0C;&#x8FD9;&#x4E9B;&#x975E;&#x6CD5;&#x7F13;&#x5B58;&#x8BB0;&#x5F55;&#x4F1A;&#x88AB;&#x79FB;&#x9664;&#x6389;&#x3002;</span><br><span class="line">         redundantOpCount = lineCount - lruEntries.size();</span><br><span class="line">       } finally {</span><br><span class="line">         Util.closeQuietly(reader);</span><br><span class="line">       }</span><br><span class="line">     }</span><br><span class="line">   </span><br><span class="line">     private void readJournalLine(String line) throws IOException {</span><br><span class="line">       //&#x6BCF;&#x884C;&#x8BB0;&#x5F55;&#x90FD;&#x662F;&#x7528;&#x7A7A;&#x683C;&#x5F00;&#x5206;&#x9694;&#x7684;&#xFF0C;&#x8FD9;&#x91CC;&#x53D6;&#x7B2C;&#x4E00;&#x4E2A;&#x7A7A;&#x683C;&#x51FA;&#x73B0;&#x7684;&#x4F4D;&#x7F6E;</span><br><span class="line">       int firstSpace = line.indexOf(&apos; &apos;);</span><br><span class="line">       //&#x5982;&#x679C;&#x6CA1;&#x6709;&#x7A7A;&#x683C;&#xFF0C;&#x5219;&#x8BF4;&#x660E;&#x662F;&#x975E;&#x6CD5;&#x7684;&#x8BB0;&#x5F55;</span><br><span class="line">       if (firstSpace == -1) {</span><br><span class="line">         throw new IOException(&quot;unexpected journal line: &quot; + line);</span><br><span class="line">       }</span><br><span class="line">   </span><br><span class="line">       //&#x7B2C;&#x4E00;&#x4E2A;&#x7A7A;&#x683C;&#x524D;&#x9762;&#x5C31;&#x662F;CLEAN&#x3001;READ&#x8FD9;&#x4E9B;&#x64CD;&#x4F5C;&#x7C7B;&#x578B;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x9488;&#x5BF9;&#x4E0D;&#x540C;&#x7684;&#x64CD;&#x4F5C;&#x7C7B;&#x578B;&#x8FDB;&#x884C;</span><br><span class="line">       //&#x76F8;&#x5E94;&#x7684;&#x5904;&#x7406;</span><br><span class="line">       int keyBegin = firstSpace + 1;</span><br><span class="line">       int secondSpace = line.indexOf(&apos; &apos;, keyBegin);</span><br><span class="line">       final String key;</span><br><span class="line">       if (secondSpace == -1) {</span><br><span class="line">         key = line.substring(keyBegin);</span><br><span class="line">         //1. &#x5982;&#x679C;&#x8BE5;&#x6761;&#x8BB0;&#x5F55;&#x4EE5;REMOVE&#x4E3A;&#x5F00;&#x5934;&#xFF0C;&#x5219;&#x6267;&#x884C;&#x5220;&#x9664;&#x64CD;&#x4F5C;&#x3002;</span><br><span class="line">         if (firstSpace == REMOVE.length() &amp;&amp; line.startsWith(REMOVE)) {</span><br><span class="line">           lruEntries.remove(key);</span><br><span class="line">           return;</span><br><span class="line">         }</span><br><span class="line">       } else {</span><br><span class="line">         key = line.substring(keyBegin, secondSpace);</span><br><span class="line">       }</span><br><span class="line">   </span><br><span class="line">       //2. &#x5982;&#x679C;&#x8BE5;key&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x5219;&#x65B0;&#x5EFA;Entry&#x5E76;&#x52A0;&#x5165;lruEntries&#x3002;</span><br><span class="line">       Entry entry = lruEntries.get(key);</span><br><span class="line">       if (entry == null) {</span><br><span class="line">         entry = new Entry(key);</span><br><span class="line">         lruEntries.put(key, entry);</span><br><span class="line">       }</span><br><span class="line">   </span><br><span class="line">       //3. &#x5982;&#x679C;&#x8BE5;&#x6761;&#x8BB0;&#x5F55;&#x4EE5;CLEAN&#x4E3A;&#x5F00;&#x5934;&#xFF0C;&#x5219;&#x521D;&#x59CB;&#x5316;entry&#xFF0C;&#x5E76;&#x8BBE;&#x7F6E;entry.readable&#x4E3A;true&#x3001;&#x8BBE;&#x7F6E;entry.currentEditor&#x4E3A;</span><br><span class="line">       //null&#xFF0C;&#x521D;&#x59CB;&#x5316;entry&#x957F;&#x5EA6;&#x3002;</span><br><span class="line">       //CLEAN 3400330d1dfc7f3f7f4b8d4d803dfcf6 832 21054</span><br><span class="line">       if (secondSpace != -1 &amp;&amp; firstSpace == CLEAN.length() &amp;&amp; line.startsWith(CLEAN)) {</span><br><span class="line">         //&#x6570;&#x7EC4;&#x4E2D;&#x5176;&#x5B9E;&#x662F;&#x6570;&#x5B57;&#xFF0C;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x6587;&#x4EF6;&#x7684;&#x5927;&#x5C0F;&#x3002;&#x56E0;&#x4E3A;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;valueCount&#x6765;&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;key&#x5BF9;&#x5E94;&#x7684;value&#x7684;&#x4E2A;&#x6570;&#xFF0C;</span><br><span class="line">         //&#x6240;&#x4EE5;&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#x4E5F;&#x662F;&#x6709;valueCount&#x4E2A;</span><br><span class="line">         String[] parts = line.substring(secondSpace + 1).split(&quot; &quot;);</span><br><span class="line">         entry.readable = true;</span><br><span class="line">         entry.currentEditor = null;</span><br><span class="line">         entry.setLengths(parts);</span><br><span class="line">       }</span><br><span class="line">       //4. &#x5982;&#x679C;&#x8BE5;&#x6761;&#x8BB0;&#x5F55;&#x4EE5;DIRTY&#x4E3A;&#x5F00;&#x5934;&#x3002;&#x5219;&#x8BBE;&#x7F6E;currentEditor&#x5BF9;&#x8C61;&#x3002;</span><br><span class="line">       //DIRTY 335c4c6028171cfddfbaae1a9c313c52</span><br><span class="line">       else if (secondSpace == -1 &amp;&amp; firstSpace == DIRTY.length() &amp;&amp; line.startsWith(DIRTY)) {</span><br><span class="line">         entry.currentEditor = new Editor(entry);</span><br><span class="line">       } </span><br><span class="line">       //5. &#x5982;&#x679C;&#x8BE5;&#x6761;&#x8BB0;&#x5F55;&#x4EE5;READ&#x4E3A;&#x5F00;&#x5934;&#xFF0C;&#x5219;&#x4EC0;&#x4E48;&#x4E5F;&#x4E0D;&#x505A;&#x3002;</span><br><span class="line">       else if (secondSpace == -1 &amp;&amp; firstSpace == READ.length() &amp;&amp; line.startsWith(READ)) {</span><br><span class="line">         // This work was already done by calling lruEntries.get().</span><br><span class="line">       } else {</span><br><span class="line">         throw new IOException(&quot;unexpected journal line: &quot; + line);</span><br><span class="line">       }</span><br><span class="line">     } </span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x65B0;&#x6765;&#x8BF4;&#x4E00;&#x4E0B;&#x8FD9;&#x4E2A;lruEntries&#x662F;&#x4EC0;&#x4E48;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;private final LinkedHashMap&lt;String, Entry&gt; lruEntries =</span><br><span class="line">  new LinkedHashMap&lt;String, Entry&gt;(0, 0.75f, true);</span><br></pre></td></tr></table></figure>

<p>&#x5C31;&#x8DDF;&#x4E0A;&#x9762;&#x7684;LruCache&#x4E00;&#x6837;&#xFF0C;&#x5B83;&#x4E5F;&#x662F;&#x4E00;&#x4E2A;&#x4EE5;&#x8BBF;&#x95EE;&#x987A;&#x5E8F;&#x4E3A;&#x5E8F;&#x7684;LinkedHashMap&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x5B83;&#x6765;&#x5B9E;&#x73B0;Lru&#x7B97;&#x6CD5;&#x3002;</p>
<p>&#x8BE5;&#x65B9;&#x6CD5;&#x7684;&#x903B;&#x8F91;&#x5C31;&#x662F;&#x6839;&#x636E;&#x8BB0;&#x5F55;&#x4E2D;&#x4E0D;&#x540C;&#x7684;&#x64CD;&#x4F5C;&#x7C7B;&#x578B;&#x8FDB;&#x884C;&#x76F8;&#x5E94;&#x7684;&#x5904;&#x7406;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<ol>
<li>&#x5982;&#x679C;&#x8BE5;&#x6761;&#x8BB0;&#x5F55;&#x4EE5;REMOVE&#x4E3A;&#x5F00;&#x5934;&#xFF0C;&#x5219;&#x6267;&#x884C;&#x5220;&#x9664;&#x64CD;&#x4F5C;&#x3002;</li>
<li>&#x5982;&#x679C;&#x8BE5;key&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x5219;&#x65B0;&#x5EFA;Entry&#x5E76;&#x52A0;&#x5165;lruEntries&#x3002;</li>
<li>&#x5982;&#x679C;&#x8BE5;&#x6761;&#x8BB0;&#x5F55;&#x4EE5;CLEAN&#x4E3A;&#x5F00;&#x5934;&#xFF0C;&#x5219;&#x521D;&#x59CB;&#x5316;entry&#xFF0C;&#x5E76;&#x8BBE;&#x7F6E;entry.readable&#x4E3A;true&#x3001;&#x8BBE;&#x7F6E;entry.currentEditor&#x4E3A;null&#xFF0C;&#x521D;&#x59CB;&#x5316;entry&#x957F;&#x5EA6;&#x3002;</li>
<li>&#x5982;&#x679C;&#x8BE5;&#x6761;&#x8BB0;&#x5F55;&#x4EE5;DIRTY&#x4E3A;&#x5F00;&#x5934;&#x3002;&#x5219;&#x8BBE;&#x7F6E;currentEditor&#x5BF9;&#x8C61;&#x3002;</li>
<li>&#x5982;&#x679C;&#x8BE5;&#x6761;&#x8BB0;&#x5F55;&#x4EE5;READ&#x4E3A;&#x5F00;&#x5934;&#xFF0C;&#x5219;&#x4EC0;&#x4E48;&#x4E5F;&#x4E0D;&#x505A;&#x3002;</li>
</ol>
<p>&#x8BF4;&#x4E86;&#x8FD9;&#x4E48;&#x591A;&#xFF0C;readJournalLine()&#x65B9;&#x6CD5;&#x4E3B;&#x8981;&#x662F;&#x901A;&#x8FC7;&#x8BFB;&#x53D6;journal&#x6587;&#x4EF6;&#x7684;&#x6BCF;&#x4E00;&#x884C;&#xFF0C;&#x7136;&#x540E;&#x5C01;&#x88C5;&#x6210;entry&#x5BF9;&#x8C61;&#xFF0C;&#x653E;&#x5230;&#x4E86;LinkedHashMap&#x96C6;&#x5408;&#x4E2D;&#x3002;&#x5E76;&#x4E14;&#x6839;&#x636E;&#x6BCF;&#x4E00;&#x884C;&#x4E0D;&#x540C;&#x7684;&#x5F00;&#x5934;&#xFF0C;&#x8BBE;&#x7F6E;entry&#x7684;&#x503C;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x901A;&#x8FC7;&#x8BFB;&#x53D6;&#x8FD9;<br>&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x6211;&#x4EEC;&#x628A;&#x6240;&#x6709;&#x7684;&#x5728;&#x672C;&#x5730;&#x7F13;&#x5B58;&#x7684;&#x6587;&#x4EF6;&#x7684;key&#x90FD;&#x4FDD;&#x5B58;&#x5230;&#x4E86;&#x96C6;&#x5408;&#x4E2D;&#xFF0C;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x7528;&#x7684;&#x65F6;&#x5019;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x96C6;&#x5408;&#x6765;&#x64CD;&#x4F5C;&#x4E86;&#x3002;</p>
<h3 id="processJournal"><a href="#processJournal" class="headerlink" title="processJournal()"></a>processJournal()</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public final class DiskLruCache implements Closeable {</span><br><span class="line">    </span><br><span class="line">      private void processJournal() throws IOException {</span><br><span class="line">        //&#x5220;&#x9664;journal.tmp&#x4E34;&#x65F6;&#x6587;&#x4EF6;</span><br><span class="line">        deleteIfExists(journalFileTmp);</span><br><span class="line">        //&#x53D8;&#x91CF;&#x7F13;&#x5B58;&#x96C6;&#x5408;&#x91CC;&#x7684;&#x6240;&#x6709;&#x5143;&#x7D20;</span><br><span class="line">        for (Iterator&lt;Entry&gt; i = lruEntries.values().iterator(); i.hasNext(); ) {</span><br><span class="line">          Entry entry = i.next();</span><br><span class="line">          //&#x5982;&#x679C;&#x5F53;&#x524D;&#x5143;&#x7D20;entry&#x7684;currentEditor&#x4E0D;&#x4E3A;&#x7A7A;&#xFF0C;&#x5219;&#x8BA1;&#x7B97;&#x8BE5;&#x5143;&#x7D20;&#x7684;&#x603B;&#x5927;&#x5C0F;&#xFF0C;&#x5E76;&#x6DFB;&#x52A0;&#x5230;&#x603B;&#x7F13;&#x5B58;&#x5BB9;&#x91CF;size&#x4E2D;&#x53BB;</span><br><span class="line">          if (entry.currentEditor == null) {</span><br><span class="line">            for (int t = 0; t &lt; valueCount; t++) {</span><br><span class="line">              size += entry.lengths[t];</span><br><span class="line">            }</span><br><span class="line">          } </span><br><span class="line">          //&#x5982;&#x679C;&#x5F53;&#x524D;&#x5143;&#x7D20;entry&#x7684;currentEditor&#x4E0D;&#x4E3A;&#x7A7A;&#xFF0C;&#x4EE3;&#x8868;&#x8BE5;&#x5143;&#x7D20;&#x65F6;&#x975E;&#x6CD5;&#x7F13;&#x5B58;&#x8BB0;&#x5F55;&#xFF0C;&#x8BE5;&#x8BB0;&#x5F55;&#x4EE5;&#x53CA;&#x5BF9;&#x5E94;&#x7684;&#x7F13;&#x5B58;&#x6587;&#x4EF6;</span><br><span class="line">          //&#x90FD;&#x4F1A;&#x88AB;&#x5220;&#x9664;&#x6389;&#x3002;</span><br><span class="line">          else {</span><br><span class="line">            entry.currentEditor = null;</span><br><span class="line">            for (int t = 0; t &lt; valueCount; t++) {</span><br><span class="line">              deleteIfExists(entry.getCleanFile(t));</span><br><span class="line">              deleteIfExists(entry.getDirtyFile(t));</span><br><span class="line">            }</span><br><span class="line">            i.remove();</span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x91CC;&#x63D0;&#x5230;&#x4E86;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x7F13;&#x5B58;&#x8BB0;&#x5F55;&#xFF0C;&#x90A3;&#x4E48;&#x4EC0;&#x4E48;&#x662F;&#x975E;&#x6CD5;&#x7F13;&#x5B58;&#x8BB0;&#x5F55;&#x5462;&#xFF1F;&#x1F914;</p>
<blockquote>
<p>DIRTY &#x8868;&#x793A;&#x4E00;&#x4E2A;entry&#x6B63;&#x5728;&#x88AB;&#x5199;&#x5165;&#x3002;&#x5199;&#x5165;&#x5206;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x5982;&#x679C;&#x6210;&#x529F;&#x4F1A;&#x7D27;&#x63A5;&#x7740;&#x5199;&#x5165;&#x4E00;&#x884C;CLEAN&#x7684;&#x8BB0;&#x5F55;&#xFF1B;&#x5982;&#x679C;&#x5931;&#x8D25;&#xFF0C;&#x4F1A;&#x589E;&#x52A0;&#x4E00;&#x884C;REMOVE&#x8BB0;&#x5F55;&#x3002;&#x6CE8;&#x610F;&#x5355;&#x72EC;&#x53EA;&#x6709;DIRTY&#x72B6;&#x6001;&#x7684;&#x8BB0;&#x5F55;&#x662F;&#x975E;&#x6CD5;&#x7684;&#x3002;</p>
</blockquote>
<p>&#x8BE5;&#x65B9;&#x6CD5;&#x4E3B;&#x8981;&#x7528;&#x6765;&#x8BA1;&#x7B97;&#x5F53;&#x524D;&#x7684;&#x7F13;&#x5B58;&#x603B;&#x5BB9;&#x91CF;&#xFF0C;&#x5E76;&#x5220;&#x9664;&#x975E;&#x6CD5;&#x7F13;&#x5B58;&#x8BB0;&#x5F55;&#x4EE5;&#x53CA;&#x8BE5;&#x8BB0;&#x5F55;&#x5BF9;&#x5E94;&#x7684;&#x6587;&#x4EF6;&#x3002;</p>
<p>&#x7406;&#x89E3;&#x4E86;journal&#x6587;&#x4EF6;&#x7684;&#x521B;&#x5EFA;&#x4EE5;&#x53CA;&#x8BFB;&#x5199;&#x6D41;&#x7A0B;&#xFF0C;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x770B;&#x786C;&#x76D8;&#x7F13;&#x5B58;&#x7684;&#x5199;&#x5165;&#x3001;&#x8BFB;&#x53D6;&#x548C;&#x5220;&#x9664;&#x7684;&#x8FC7;&#x7A0B;&#x3002;</p>
<h3 id="3-2-&#x5199;&#x5165;&#x7F13;&#x5B58;"><a href="#3-2-&#x5199;&#x5165;&#x7F13;&#x5B58;" class="headerlink" title="3.2 &#x5199;&#x5165;&#x7F13;&#x5B58;"></a>3.2 &#x5199;&#x5165;&#x7F13;&#x5B58;</h3><p>DiskLruCache&#x7F13;&#x5B58;&#x7684;&#x5199;&#x5165;&#x662F;&#x901A;&#x8FC7;edit()&#x65B9;&#x6CD5;&#x6765;&#x5B8C;&#x6210;&#x7684;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public final class DiskLruCache implements Closeable {</span><br><span class="line">    </span><br><span class="line">    private synchronized Editor edit(String key, long expectedSequenceNumber) throws IOException {</span><br><span class="line">        checkNotClosed();</span><br><span class="line">        validateKey(key);</span><br><span class="line">        //&#x4ECE;&#x4E4B;&#x524D;&#x7684;&#x7F13;&#x5B58;&#x4E2D;&#x8BFB;&#x53D6;&#x5BF9;&#x5E94;&#x7684;entry</span><br><span class="line">        Entry entry = lruEntries.get(key);</span><br><span class="line">        //&#x5F53;&#x524D;&#x65E0;&#x6CD5;&#x5199;&#x5165;&#x78C1;&#x76D8;&#x7F13;&#x5B58;</span><br><span class="line">        if (expectedSequenceNumber != ANY_SEQUENCE_NUMBER &amp;&amp; (entry == null</span><br><span class="line">            || entry.sequenceNumber != expectedSequenceNumber)) {</span><br><span class="line">          return null; // Snapshot is stale.</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        //&#x5982;&#x679C;entry&#x4E3A;&#x7A7A;&#xFF0C;&#x5219;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;entry&#x5BF9;&#x8C61;&#x52A0;&#x5165;&#x5230;&#x7F13;&#x5B58;&#x96C6;&#x5408;&#x4E2D;</span><br><span class="line">        if (entry == null) {</span><br><span class="line">          entry = new Entry(key);</span><br><span class="line">          lruEntries.put(key, entry);</span><br><span class="line">        } </span><br><span class="line">        //currentEditor&#x4E0D;&#x4E3A;&#x7A7A;&#xFF0C;&#x8868;&#x793A;&#x5F53;&#x524D;&#x6709;&#x522B;&#x7684;&#x63D2;&#x5165;&#x64CD;&#x4F5C;&#x5728;&#x6267;&#x884C;</span><br><span class="line">        else if (entry.currentEditor != null) {</span><br><span class="line">          return null; // Another edit is in progress.</span><br><span class="line">        }</span><br><span class="line">    </span><br><span class="line">        //&#x4E3A;&#x5F53;&#x524D;&#x521B;&#x5EFA;&#x7684;entry&#x77E5;&#x9053;&#x65B0;&#x521B;&#x5EFA;&#x7684;editor</span><br><span class="line">        Editor editor = new Editor(entry);</span><br><span class="line">        entry.currentEditor = editor;</span><br><span class="line">    </span><br><span class="line">        //&#x5411;journal&#x5199;&#x5165;&#x4E00;&#x884C;DIRTY + &#x7A7A;&#x683C; + key&#x7684;&#x8BB0;&#x5F55;&#xFF0C;&#x8868;&#x793A;&#x8FD9;&#x4E2A;key&#x5BF9;&#x5E94;&#x7684;&#x7F13;&#x5B58;&#x6B63;&#x5728;&#x5904;&#x4E8E;&#x88AB;&#x7F16;&#x8F91;&#x7684;&#x72B6;&#x6001;&#x3002;</span><br><span class="line">        journalWriter.write(DIRTY + &apos; &apos; + key + &apos;\n&apos;);</span><br><span class="line">        //&#x5237;&#x65B0;&#x6587;&#x4EF6;&#x91CC;&#x7684;&#x8BB0;&#x5F55;</span><br><span class="line">        journalWriter.flush();</span><br><span class="line">        return editor;</span><br><span class="line">      }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x6784;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;Editor&#x5BF9;&#x8C61;&#xFF0C;&#x5B83;&#x4E3B;&#x8981;&#x505A;&#x4E86;&#x4E24;&#x4EF6;&#x4E8B;&#x60C5;&#xFF1A;</p>
<ol>
<li>&#x4ECE;&#x96C6;&#x5408;&#x4E2D;&#x627E;&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x5B9E;&#x4F8B;&#xFF08;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x653E;&#x5230;&#x96C6;&#x5408;&#x4E2D;&#xFF09;&#xFF0C;&#x7136;&#x540E;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;editor&#xFF0C;&#x5C06;editor&#x548C;entry&#x5173;&#x8054;&#x8D77;&#x6765;&#x3002;</li>
<li>&#x5411;journal&#x4E2D;&#x5199;&#x5165;&#x4E00;&#x884C;&#x64CD;&#x4F5C;&#x6570;&#x636E;&#xFF08;DITTY &#x7A7A;&#x683C; &#x548C;key&#x62FC;&#x63A5;&#x7684;&#x6587;&#x5B57;&#xFF09;&#xFF0C;&#x8868;&#x793A;&#x8FD9;&#x4E2A;key&#x5F53;&#x524D;&#x6B63;&#x5904;&#x4E8E;&#x7F16;&#x8F91;&#x72B6;&#x6001;&#x3002;</li>
</ol>
<p>&#x6211;&#x4EEC;&#x5728;&#x524D;&#x9762;&#x7684;DiskLruCache&#x7684;&#x4F7F;&#x7528;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x8C03;&#x7528;&#x4E86;Editor&#x7684;newOutputStream()&#x65B9;&#x6CD5;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;OutputStream&#x6765;&#x5199;&#x5165;&#x7F13;&#x5B58;&#x6587;&#x4EF6;&#x3002;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public final class DiskLruCache implements Closeable {</span><br><span class="line">    </span><br><span class="line">    public InputStream newInputStream(int index) throws IOException {</span><br><span class="line">      synchronized (DiskLruCache.this) {</span><br><span class="line">        if (entry.currentEditor != this) {</span><br><span class="line">          throw new IllegalStateException();</span><br><span class="line">        }</span><br><span class="line">        if (!entry.readable) {</span><br><span class="line">          return null;</span><br><span class="line">        }</span><br><span class="line">        try {</span><br><span class="line">          return new FileInputStream(entry.getCleanFile(index));</span><br><span class="line">        } catch (FileNotFoundException e) {</span><br><span class="line">          return null;</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x7684;&#x5F62;&#x53C2;index&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x5F00;&#x59CB;&#x5728;open()&#x65B9;&#x6CD5;&#x91CC;&#x4F20;&#x5165;&#x7684;valueCount&#xFF0C;&#x8FD9;&#x4E2A;valueCount&#x8868;&#x793A;&#x4E86;&#x4E00;&#x4E2A;key&#x5BF9;&#x5E94;&#x51E0;&#x4E2A;value,&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x4E00;&#x4E2A;key&#x5BF9;&#x5E94;&#x51E0;&#x4E2A;&#x7F13;&#x5B58;&#x6587;&#x4EF6;&#x3002;&#x90A3;&#x4E48;&#x73B0;&#x5728;&#x4F20;&#x5165;&#x7684;&#x8FD9;&#x4E2A;index&#x5C31;&#x8868;&#x793A;<br>&#x8981;&#x7F13;&#x5B58;&#x7684;&#x6587;&#x4EF6;&#x65F6;&#x5BF9;&#x5E94;&#x7684;&#x7B2C;&#x51E0;&#x4E2A;value&#x3002;</p>
<p>&#x6709;&#x4E86;&#x8F93;&#x51FA;&#x6D41;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x63A5;&#x7740;&#x8C03;&#x7528;Editor&#x7684;commit()&#x65B9;&#x6CD5;&#x5C31;&#x53EF;&#x4EE5;&#x5B8C;&#x6210;&#x7F13;&#x5B58;&#x6587;&#x4EF6;&#x7684;&#x5199;&#x5165;&#x4E86;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public final class DiskLruCache implements Closeable {</span><br><span class="line">     public void commit() throws IOException {</span><br><span class="line">         //&#x5982;&#x679C;&#x901A;&#x8FC7;&#x8F93;&#x51FA;&#x6D41;&#x5199;&#x5165;&#x7F13;&#x5B58;&#x6587;&#x4EF6;&#x51FA;&#x9519;&#x4E86;&#x5C31;&#x628A;&#x96C6;&#x5408;&#x4E2D;&#x7684;&#x7F13;&#x5B58;&#x79FB;&#x9664;&#x6389;</span><br><span class="line">          if (hasErrors) {</span><br><span class="line">            completeEdit(this, false);</span><br><span class="line">            remove(entry.key); // The previous entry is stale.</span><br><span class="line">          } else {</span><br><span class="line">            //&#x8C03;&#x7528;completeEdit()&#x65B9;&#x6CD5;&#x5B8C;&#x6210;&#x7F13;&#x5B58;&#x5199;&#x5165;&#x3002;</span><br><span class="line">            completeEdit(this, true);</span><br><span class="line">          }</span><br><span class="line">          committed = true;</span><br><span class="line">        }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8BE5;&#x65B9;&#x6CD5;&#x8C03;&#x7528;DiskLruCache&#x7684;completeEdit()&#x65B9;&#x6CD5;&#x6765;&#x5B8C;&#x6210;&#x7F13;&#x5B58;&#x5199;&#x5165;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public final class DiskLruCache implements Closeable {</span><br><span class="line">    </span><br><span class="line">    private synchronized void completeEdit(Editor editor, boolean success) throws IOException {</span><br><span class="line">        Entry entry = editor.entry;</span><br><span class="line">        if (entry.currentEditor != editor) {</span><br><span class="line">          throw new IllegalStateException();</span><br><span class="line">        }</span><br><span class="line">    </span><br><span class="line">        // If this edit is creating the entry for the first time, every index must have a value.</span><br><span class="line">        if (success &amp;&amp; !entry.readable) {</span><br><span class="line">          for (int i = 0; i &lt; valueCount; i++) {</span><br><span class="line">            if (!editor.written[i]) {</span><br><span class="line">              editor.abort();</span><br><span class="line">              throw new IllegalStateException(&quot;Newly created entry didn&apos;t create value for index &quot; + i);</span><br><span class="line">            }</span><br><span class="line">            if (!entry.getDirtyFile(i).exists()) {</span><br><span class="line">              editor.abort();</span><br><span class="line">              return;</span><br><span class="line">            }</span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">    </span><br><span class="line">        for (int i = 0; i &lt; valueCount; i++) {</span><br><span class="line">          //&#x83B7;&#x53D6;&#x5BF9;&#x8C61;&#x7F13;&#x5B58;&#x7684;&#x4E34;&#x65F6;&#x6587;&#x4EF6;</span><br><span class="line">          File dirty = entry.getDirtyFile(i);</span><br><span class="line">          if (success) {</span><br><span class="line">            //&#x5982;&#x679C;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#x5B58;&#x5728;&#xFF0C;&#x5219;&#x5C06;&#x5176;&#x91CD;&#x540D;&#x4E3A;&#x6B63;&#x5F0F;&#x7684;&#x7F13;&#x5B58;&#x6587;&#x4EF6;</span><br><span class="line">            if (dirty.exists()) {</span><br><span class="line">              File clean = entry.getCleanFile(i);</span><br><span class="line">              dirty.renameTo(clean);</span><br><span class="line">              long oldLength = entry.lengths[i];</span><br><span class="line">              long newLength = clean.length();</span><br><span class="line">              entry.lengths[i] = newLength;</span><br><span class="line">              //&#x91CD;&#x65B0;&#x8BA1;&#x7B97;&#x7F13;&#x5B58;&#x7684;&#x5927;&#x5C0F;</span><br><span class="line">              size = size - oldLength + newLength;</span><br><span class="line">            }</span><br><span class="line">          } else {</span><br><span class="line">            //&#x5982;&#x679C;&#x5199;&#x5165;&#x4E0D;&#x6210;&#x529F;&#xFF0C;&#x5219;&#x5220;&#x9664;&#x6389;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#x3002;</span><br><span class="line">            deleteIfExists(dirty);</span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">    </span><br><span class="line">        //&#x64CD;&#x4F5C;&#x6B21;&#x6570;&#x81EA;&#x589E;</span><br><span class="line">        redundantOpCount++;</span><br><span class="line">        //&#x5C06;&#x5F53;&#x524D;&#x7F13;&#x5B58;&#x7684;&#x7F16;&#x8F91;&#x5668;&#x7F6E;&#x4E3A;&#x7A7A;</span><br><span class="line">        entry.currentEditor = null;</span><br><span class="line">        if (entry.readable | success) {</span><br><span class="line">          //&#x7F13;&#x5B58;&#x5DF2;&#x7ECF;&#x5199;&#x5165;&#xFF0C;&#x8BBE;&#x7F6E;&#x4E3A;&#x53EF;&#x8BFB;&#x3002;</span><br><span class="line">          entry.readable = true;</span><br><span class="line">          //&#x5411;journal&#x5199;&#x5165;&#x4E00;&#x884C;CLEAN&#x5F00;&#x5934;&#x7684;&#x8BB0;&#x5F55;&#xFF0C;&#x8868;&#x793A;&#x7F13;&#x5B58;&#x6210;&#x529F;&#x5199;&#x5165;&#x5230;&#x78C1;&#x76D8;&#x3002;</span><br><span class="line">          journalWriter.write(CLEAN + &apos; &apos; + entry.key + entry.getLengths() + &apos;\n&apos;);</span><br><span class="line">          if (success) {</span><br><span class="line">            entry.sequenceNumber = nextSequenceNumber++;</span><br><span class="line">          }</span><br><span class="line">        } else {</span><br><span class="line">          //&#x5982;&#x679C;&#x4E0D;&#x6210;&#x529F;&#xFF0C;&#x5219;&#x4ECE;&#x96C6;&#x5408;&#x4E2D;&#x5220;&#x9664;&#x6389;&#x8FD9;&#x4E2A;&#x7F13;&#x5B58;</span><br><span class="line">          lruEntries.remove(entry.key);</span><br><span class="line">          //&#x5411;journal&#x6587;&#x4EF6;&#x5199;&#x5165;&#x4E00;&#x884C;REMOVE&#x5F00;&#x5934;&#x7684;&#x8BB0;&#x5F55;&#xFF0C;&#x8868;&#x793A;&#x5220;&#x9664;&#x4E86;&#x7F13;&#x5B58;</span><br><span class="line">          journalWriter.write(REMOVE + &apos; &apos; + entry.key + &apos;\n&apos;);</span><br><span class="line">        }</span><br><span class="line">        journalWriter.flush();</span><br><span class="line">    </span><br><span class="line">        //&#x5982;&#x679C;&#x7F13;&#x5B58;&#x603B;&#x5927;&#x5C0F;&#x5DF2;&#x7ECF;&#x8D85;&#x8FC7;&#x4E86;&#x8BBE;&#x5B9A;&#x7684;&#x6700;&#x5927;&#x7F13;&#x5B58;&#x5927;&#x5C0F;&#x6216;&#x8005;&#x64CD;&#x4F5C;&#x6B21;&#x6570;&#x8D85;&#x8FC7;&#x4E86;2000&#x6B21;&#xFF0C;</span><br><span class="line">        // &#x5C31;&#x5F00;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x5C06;&#x96C6;&#x5408;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x5220;&#x9664;&#x5230;&#x5C0F;&#x4E8E;&#x6700;&#x5927;&#x7F13;&#x5B58;&#x5927;&#x5C0F;&#x4E3A;&#x6B62;&#x5E76;&#x91CD;&#x65B0;&#x5199;journal&#x6587;&#x4EF6;</span><br><span class="line">        if (size &gt; maxSize || journalRebuildRequired()) {</span><br><span class="line">          executorService.submit(cleanupCallable);</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4E00;&#x5171;&#x505A;&#x4E86;&#x4EE5;&#x4E0B;&#x51E0;&#x4EF6;&#x4E8B;&#x60C5;&#xFF1A;</p>
<ol>
<li>&#x5982;&#x679C;&#x8F93;&#x51FA;&#x6D41;&#x5199;&#x5165;&#x6570;&#x636E;&#x6210;&#x529F;&#xFF0C;&#x5C31;&#x628A;&#x5199;&#x5165;&#x7684;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#x91CD;&#x547D;&#x540D;&#x4E3A;&#x6B63;&#x5F0F;&#x7684;&#x7F13;&#x5B58;&#x6587;&#x4EF6;</li>
<li>&#x91CD;&#x65B0;&#x8BBE;&#x7F6E;&#x5F53;&#x524D;&#x603B;&#x7F13;&#x5B58;&#x7684;&#x5927;&#x5C0F;</li>
<li>&#x5411;journal&#x6587;&#x4EF6;&#x5199;&#x5165;&#x4E00;&#x884C;CLEAN&#x5F00;&#x5934;&#x7684;&#x5B57;&#x7B26;&#xFF08;&#x5305;&#x62EC;key&#x548C;&#x6587;&#x4EF6;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#x53EF;&#x80FD;&#x5B58;&#x5728;&#x591A;&#x4E2A; &#x4F7F;&#x7528;&#x7A7A;&#x683C;&#x5206;&#x5F00;&#x7684;&#xFF09;</li>
<li>&#x5982;&#x679C;&#x8F93;&#x51FA;&#x6D41;&#x5199;&#x5165;&#x5931;&#x8D25;&#xFF0C;&#x5C31;&#x5220;&#x9664;&#x6389;&#x5199;&#x5165;&#x7684;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x4E14;&#x628A;&#x96C6;&#x5408;&#x4E2D;&#x7684;&#x7F13;&#x5B58;&#x4E5F;&#x5220;&#x9664;</li>
<li>&#x5411;journal&#x6587;&#x4EF6;&#x5199;&#x5165;&#x4E00;&#x884C;REMOVE&#x5F00;&#x5934;&#x7684;&#x5B57;&#x7B26;</li>
<li>&#x91CD;&#x65B0;&#x6BD4;&#x8F83;&#x5F53;&#x524D;&#x7F13;&#x5B58;&#x548C;&#x6700;&#x5927;&#x7F13;&#x5B58;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x5982;&#x679C;&#x8D85;&#x8FC7;&#x6700;&#x5927;&#x7F13;&#x5B58;&#x6216;&#x8005;journal&#x6587;&#x4EF6;&#x7684;&#x64CD;&#x4F5C;&#x5927;&#x4E8E;2000&#x6761;&#xFF0C;&#x5C31;&#x628A;&#x96C6;&#x5408;&#x4E2D;&#x7684;&#x7F13;&#x5B58;&#x5220;&#x9664;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x76F4;&#x5230;&#x5C0F;&#x4E8E;&#x6700;&#x5927;&#x7F13;&#x5B58;&#xFF0C;&#x91CD;&#x65B0;&#x5EFA;&#x7ACB;&#x65B0;&#x7684;journal&#x6587;&#x4EF6;</li>
</ol>
<p>&#x5230;&#x8FD9;&#x91CC;&#xFF0C;&#x7F13;&#x5B58;&#x7684;&#x63D2;&#x5165;&#x6D41;&#x7A0B;&#x5C31;&#x5B8C;&#x6210;&#x4E86;&#x3002;</p>
<h3 id="3-3-&#x8BFB;&#x53D6;&#x7F13;&#x5B58;"><a href="#3-3-&#x8BFB;&#x53D6;&#x7F13;&#x5B58;" class="headerlink" title="3.3 &#x8BFB;&#x53D6;&#x7F13;&#x5B58;"></a>3.3 &#x8BFB;&#x53D6;&#x7F13;&#x5B58;</h3><p>&#x8BFB;&#x53D6;&#x7F13;&#x5B58;&#x662F;&#x7531;DiskLruCache&#x7684;get()&#x65B9;&#x6CD5;&#x6765;&#x5B8C;&#x6210;&#x7684;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public final class DiskLruCache implements Closeable {</span><br><span class="line">    </span><br><span class="line">      public synchronized Snapshot get(String key) throws IOException {</span><br><span class="line">        checkNotClosed();</span><br><span class="line">        validateKey(key);</span><br><span class="line">        //&#x83B7;&#x53D6;&#x5BF9;&#x5E94;&#x7684;entry</span><br><span class="line">        Entry entry = lruEntries.get(key);</span><br><span class="line">        if (entry == null) {</span><br><span class="line">          return null;</span><br><span class="line">        }</span><br><span class="line">    </span><br><span class="line">        //&#x5982;&#x679C;entry&#x4E0D;&#x53EF;&#x8BFB;&#xFF0C;&#x8BF4;&#x660E;&#x53EF;&#x80FD;&#x5728;&#x7F16;&#x8F91;&#xFF0C;&#x5219;&#x8FD4;&#x56DE;&#x7A7A;&#x3002;</span><br><span class="line">        if (!entry.readable) {</span><br><span class="line">          return null;</span><br><span class="line">        }</span><br><span class="line">    </span><br><span class="line">        //&#x6253;&#x5F00;&#x6240;&#x6709;&#x7F13;&#x5B58;&#x6587;&#x4EF6;&#x7684;&#x8F93;&#x5165;&#x6D41;&#xFF0C;&#x7B49;&#x5F85;&#x88AB;&#x8BFB;&#x53D6;&#x3002;</span><br><span class="line">        InputStream[] ins = new InputStream[valueCount];</span><br><span class="line">        try {</span><br><span class="line">          for (int i = 0; i &lt; valueCount; i++) {</span><br><span class="line">            ins[i] = new FileInputStream(entry.getCleanFile(i));</span><br><span class="line">          }</span><br><span class="line">        } catch (FileNotFoundException e) {</span><br><span class="line">          // A file must have been deleted manually!</span><br><span class="line">          for (int i = 0; i &lt; valueCount; i++) {</span><br><span class="line">            if (ins[i] != null) {</span><br><span class="line">              Util.closeQuietly(ins[i]);</span><br><span class="line">            } else {</span><br><span class="line">              break;</span><br><span class="line">            }</span><br><span class="line">          }</span><br><span class="line">          return null;</span><br><span class="line">        }</span><br><span class="line">    </span><br><span class="line">        redundantOpCount++;</span><br><span class="line">        //&#x5411;journal&#x5199;&#x5165;&#x4E00;&#x884C;READ&#x5F00;&#x5934;&#x7684;&#x8BB0;&#x5F55;&#xFF0C;&#x8868;&#x793A;&#x6267;&#x884C;&#x4E86;&#x4E00;&#x6B21;&#x8BFB;&#x53D6;&#x64CD;&#x4F5C;</span><br><span class="line">        journalWriter.append(READ + &apos; &apos; + key + &apos;\n&apos;);</span><br><span class="line">        </span><br><span class="line">         </span><br><span class="line">        //&#x5982;&#x679C;&#x7F13;&#x5B58;&#x603B;&#x5927;&#x5C0F;&#x5DF2;&#x7ECF;&#x8D85;&#x8FC7;&#x4E86;&#x8BBE;&#x5B9A;&#x7684;&#x6700;&#x5927;&#x7F13;&#x5B58;&#x5927;&#x5C0F;&#x6216;&#x8005;&#x64CD;&#x4F5C;&#x6B21;&#x6570;&#x8D85;&#x8FC7;&#x4E86;2000&#x6B21;&#xFF0C;</span><br><span class="line">        // &#x5C31;&#x5F00;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x5C06;&#x96C6;&#x5408;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x5220;&#x9664;&#x5230;&#x5C0F;&#x4E8E;&#x6700;&#x5927;&#x7F13;&#x5B58;&#x5927;&#x5C0F;&#x4E3A;&#x6B62;&#x5E76;&#x91CD;&#x65B0;&#x5199;journal&#x6587;&#x4EF6;</span><br><span class="line">        if (journalRebuildRequired()) {</span><br><span class="line">          executorService.submit(cleanupCallable);</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        //&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x7F13;&#x5B58;&#x6587;&#x4EF6;&#x5FEB;&#x7167;&#xFF0C;&#x5305;&#x542B;&#x7F13;&#x5B58;&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#xFF0C;&#x8F93;&#x5165;&#x6D41;&#x7B49;&#x4FE1;&#x606F;&#x3002;</span><br><span class="line">        return new Snapshot(key, entry.sequenceNumber, ins, entry.lengths);</span><br><span class="line">      }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8BFB;&#x53D6;&#x64CD;&#x4F5C;&#x4E3B;&#x8981;&#x5B8C;&#x6210;&#x4E86;&#x4EE5;&#x4E0B;&#x51E0;&#x4EF6;&#x4E8B;&#x60C5;&#xFF1A;</p>
<ol>
<li>&#x83B7;&#x53D6;&#x5BF9;&#x5E94;&#x7684;entry&#x3002;</li>
<li>&#x6253;&#x5F00;&#x6240;&#x6709;&#x7F13;&#x5B58;&#x6587;&#x4EF6;&#x7684;&#x8F93;&#x5165;&#x6D41;&#xFF0C;&#x7B49;&#x5F85;&#x88AB;&#x8BFB;&#x53D6;&#x3002;</li>
<li>&#x5411;journal&#x5199;&#x5165;&#x4E00;&#x884C;READ&#x5F00;&#x5934;&#x7684;&#x8BB0;&#x5F55;&#xFF0C;&#x8868;&#x793A;&#x6267;&#x884C;&#x4E86;&#x4E00;&#x6B21;&#x8BFB;&#x53D6;&#x64CD;&#x4F5C;&#x3002;</li>
<li>&#x5982;&#x679C;&#x7F13;&#x5B58;&#x603B;&#x5927;&#x5C0F;&#x5DF2;&#x7ECF;&#x8D85;&#x8FC7;&#x4E86;&#x8BBE;&#x5B9A;&#x7684;&#x6700;&#x5927;&#x7F13;&#x5B58;&#x5927;&#x5C0F;&#x6216;&#x8005;&#x64CD;&#x4F5C;&#x6B21;&#x6570;&#x8D85;&#x8FC7;&#x4E86;2000&#x6B21;&#xFF0C;&#x5C31;&#x5F00;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x5C06;&#x96C6;&#x5408;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x5220;&#x9664;&#x5230;&#x5C0F;&#x4E8E;&#x6700;&#x5927;&#x7F13;&#x5B58;&#x5927;&#x5C0F;&#x4E3A;&#x6B62;&#x5E76;&#x91CD;&#x65B0;&#x5199;journal&#x6587;&#x4EF6;&#x3002;</li>
<li>&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x7F13;&#x5B58;&#x6587;&#x4EF6;&#x5FEB;&#x7167;&#xFF0C;&#x5305;&#x542B;&#x7F13;&#x5B58;&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#xFF0C;&#x8F93;&#x5165;&#x6D41;&#x7B49;&#x4FE1;&#x606F;&#x3002;</li>
</ol>
<p>&#x8BE5;&#x65B9;&#x6CD5;&#x6700;&#x7EC8;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x7F13;&#x5B58;&#x6587;&#x4EF6;&#x5FEB;&#x7167;&#xFF0C;&#x5305;&#x542B;&#x7F13;&#x5B58;&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#xFF0C;&#x8F93;&#x5165;&#x6D41;&#x7B49;&#x4FE1;&#x606F;&#x3002;&#x5229;&#x7528;&#x8FD9;&#x4E2A;&#x5FEB;&#x7167;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x8BFB;&#x53D6;&#x7F13;&#x5B58;&#x6587;&#x4EF6;&#x4E86;&#x3002;</p>
<h3 id="3-4-&#x5220;&#x9664;&#x7F13;&#x5B58;"><a href="#3-4-&#x5220;&#x9664;&#x7F13;&#x5B58;" class="headerlink" title="3.4 &#x5220;&#x9664;&#x7F13;&#x5B58;"></a>3.4 &#x5220;&#x9664;&#x7F13;&#x5B58;</h3><p>&#x5220;&#x9664;&#x7F13;&#x5B58;&#x662F;&#x7531;DiskLruCache&#x7684;remove()&#x65B9;&#x6CD5;&#x6765;&#x5B8C;&#x6210;&#x7684;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public final class DiskLruCache implements Closeable {</span><br><span class="line">    </span><br><span class="line">      public synchronized boolean remove(String key) throws IOException {</span><br><span class="line">        checkNotClosed();</span><br><span class="line">        validateKey(key);</span><br><span class="line">        //&#x83B7;&#x53D6;&#x5BF9;&#x5E94;&#x7684;entry</span><br><span class="line">        Entry entry = lruEntries.get(key);</span><br><span class="line">        if (entry == null || entry.currentEditor != null) {</span><br><span class="line">          return false;</span><br><span class="line">        }</span><br><span class="line">    </span><br><span class="line">        //&#x5220;&#x9664;&#x5BF9;&#x5E94;&#x7684;&#x7F13;&#x5B58;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x5C06;&#x7F13;&#x5B58;&#x5927;&#x5C0F;&#x7F6E;&#x4E3A;0.</span><br><span class="line">        for (int i = 0; i &lt; valueCount; i++) {</span><br><span class="line">          File file = entry.getCleanFile(i);</span><br><span class="line">          if (file.exists() &amp;&amp; !file.delete()) {</span><br><span class="line">            throw new IOException(&quot;failed to delete &quot; + file);</span><br><span class="line">          }</span><br><span class="line">          size -= entry.lengths[i];</span><br><span class="line">          entry.lengths[i] = 0;</span><br><span class="line">        }</span><br><span class="line">    </span><br><span class="line">        redundantOpCount++;</span><br><span class="line">        //&#x5411;journal&#x6587;&#x4EF6;&#x6DFB;&#x52A0;&#x4E00;&#x884C;REMOVE&#x5F00;&#x5934;&#x7684;&#x8BB0;&#x5F55;&#xFF0C;&#x8868;&#x793A;&#x6267;&#x884C;&#x4E86;&#x4E00;&#x6B21;&#x5220;&#x9664;&#x64CD;&#x4F5C;&#x3002;</span><br><span class="line">        journalWriter.append(REMOVE + &apos; &apos; + key + &apos;\n&apos;);</span><br><span class="line">        lruEntries.remove(key);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        //&#x5982;&#x679C;&#x7F13;&#x5B58;&#x603B;&#x5927;&#x5C0F;&#x5DF2;&#x7ECF;&#x8D85;&#x8FC7;&#x4E86;&#x8BBE;&#x5B9A;&#x7684;&#x6700;&#x5927;&#x7F13;&#x5B58;&#x5927;&#x5C0F;&#x6216;&#x8005;&#x64CD;&#x4F5C;&#x6B21;&#x6570;&#x8D85;&#x8FC7;&#x4E86;2000&#x6B21;&#xFF0C;</span><br><span class="line">        // &#x5C31;&#x5F00;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x5C06;&#x96C6;&#x5408;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x5220;&#x9664;&#x5230;&#x5C0F;&#x4E8E;&#x6700;&#x5927;&#x7F13;&#x5B58;&#x5927;&#x5C0F;&#x4E3A;&#x6B62;&#x5E76;&#x91CD;&#x65B0;&#x5199;journal&#x6587;&#x4EF6;</span><br><span class="line">        if (journalRebuildRequired()) {</span><br><span class="line">          executorService.submit(cleanupCallable);</span><br><span class="line">        }</span><br><span class="line">    </span><br><span class="line">        return true;</span><br><span class="line">      }   </span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5220;&#x9664;&#x64CD;&#x4F5C;&#x4E3B;&#x8981;&#x505A;&#x4E86;&#x4EE5;&#x4E0B;&#x51E0;&#x4EF6;&#x4E8B;&#x60C5;&#xFF1A;</p>
<ol>
<li>&#x83B7;&#x53D6;&#x5BF9;&#x5E94;&#x7684;entry&#x3002;</li>
<li>&#x5220;&#x9664;&#x5BF9;&#x5E94;&#x7684;&#x7F13;&#x5B58;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x5C06;&#x7F13;&#x5B58;&#x5927;&#x5C0F;&#x7F6E;&#x4E3A;0.</li>
<li>&#x5411;journal&#x6587;&#x4EF6;&#x6DFB;&#x52A0;&#x4E00;&#x884C;REMOVE&#x5F00;&#x5934;&#x7684;&#x8BB0;&#x5F55;&#xFF0C;&#x8868;&#x793A;&#x6267;&#x884C;&#x4E86;&#x4E00;&#x6B21;&#x5220;&#x9664;&#x64CD;&#x4F5C;&#x3002;</li>
<li>&#x5982;&#x679C;&#x7F13;&#x5B58;&#x603B;&#x5927;&#x5C0F;&#x5DF2;&#x7ECF;&#x8D85;&#x8FC7;&#x4E86;&#x8BBE;&#x5B9A;&#x7684;&#x6700;&#x5927;&#x7F13;&#x5B58;&#x5927;&#x5C0F;&#x6216;&#x8005;&#x64CD;&#x4F5C;&#x6B21;&#x6570;&#x8D85;&#x8FC7;&#x4E86;2000&#x6B21;&#xFF0C;&#x5C31;&#x5F00;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x5C06;&#x96C6;&#x5408;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x5220;&#x9664;&#x5230;&#x5C0F;&#x4E8E;&#x6700;&#x5927;&#x7F13;&#x5B58;&#x5927;&#x5C0F;&#x4E3A;&#x6B62;&#x5E76;&#x91CD;&#x65B0;&#x5199;journal&#x6587;&#x4EF6;&#x3002;</li>
</ol>
<p>&#x597D;&#xFF0C;&#x5230;&#x8FD9;&#x91CC;LrcCache&#x548C;DiskLruCache&#x7684;&#x5B9E;&#x73B0;&#x539F;&#x7406;&#x90FD;&#x8BB2;&#x5B8C;&#x4E86;&#xFF0C;&#x8FD9;&#x4E24;&#x4E2A;&#x7C7B;&#x5728;&#x4E3B;&#x6D41;&#x7684;&#x56FE;&#x7247;&#x6846;&#x67B6;Fresco&#x3001;Glide&#x548C;&#x7F51;&#x7EDC;&#x6846;&#x67B6;Okhttp&#x7B49;&#x90FD;&#x6709;&#x7740;&#x5E7F;&#x6CDB;&#x7684;&#x5E94;&#x7528;&#xFF0C;&#x540E;&#x7EED;&#x7684;&#x6587;&#x7AE0;&#x540E;&#x7EE7;&#x7EED;&#x5206;&#x6790;LrcCache&#x548C;DiskLruCache<br>&#x5728;&#x8FD9;&#x4E9B;&#x6846;&#x67B6;&#x91CC;&#x7684;&#x5E94;&#x7528;&#x3002;</p>
<h2 id="&#x9644;&#x5F55;"><a href="#&#x9644;&#x5F55;" class="headerlink" title="&#x9644;&#x5F55;"></a>&#x9644;&#x5F55;</h2><h3 id="&#x56FE;&#x7247;&#x5360;&#x7528;&#x5185;&#x5B58;&#x5927;&#x5C0F;&#x7684;&#x8BA1;&#x7B97;"><a href="#&#x56FE;&#x7247;&#x5360;&#x7528;&#x5185;&#x5B58;&#x5927;&#x5C0F;&#x7684;&#x8BA1;&#x7B97;" class="headerlink" title="&#x56FE;&#x7247;&#x5360;&#x7528;&#x5185;&#x5B58;&#x5927;&#x5C0F;&#x7684;&#x8BA1;&#x7B97;"></a>&#x56FE;&#x7247;&#x5360;&#x7528;&#x5185;&#x5B58;&#x5927;&#x5C0F;&#x7684;&#x8BA1;&#x7B97;</h3><p>Android&#x91CC;&#x9762;&#x7F13;&#x5B58;&#x5E94;&#x7528;&#x6700;&#x591A;&#x7684;&#x573A;&#x666F;&#x5C31;&#x662F;&#x56FE;&#x7247;&#x7F13;&#x5B58;&#x4E86;&#xFF0C;&#x8C01;&#x8BA9;&#x56FE;&#x7247;&#x5728;&#x5185;&#x5B58;&#x91CC;&#x662F;&#x4E2A;&#x5927;&#x80D6;&#x5B50;&#x5462;&#xFF0C;&#x5728;&#x505A;&#x7F13;&#x5B58;&#x7684;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x7ECF;&#x5E38;&#x4F1A;&#x53BB;&#x8BA1;&#x7B97;&#x56FE;&#x7247;&#x5C55;&#x5185;&#x5B58;&#x7684;&#x5927;&#x5C0F;&#x3002;</p>
<p>&#x90A3;&#x4E48;&#x5982;&#x4F55;&#x53BB;&#x83B7;&#x53D6;&#x4E00;&#x5F20;&#x56FE;&#x7247;&#x5360;&#x7528;&#x5185;&#x5B58;&#x7684;&#x5927;&#x5C0F;&#x5462;&#xFF1F;&#x1F914;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;private int getBitmapSize(Bitmap bitmap) {</span><br><span class="line">    //API 19</span><br><span class="line">    if (Build.VERSION.SDK_INT == Build.VERSION_CODES.KITKAT) {</span><br><span class="line">        return bitmap.getAllocationByteCount();</span><br><span class="line">    }</span><br><span class="line">    //API 12</span><br><span class="line">    if (Build.VERSION.SDK_INT == Build.VERSION_CODES.HONEYCOMB_MR1) {</span><br><span class="line">        return bitmap.getByteCount();</span><br><span class="line">    }</span><br><span class="line">    // Earlier Version</span><br><span class="line">    return bitmap.getRowBytes() * bitmap.getHeight();</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x90A3;&#x4E48;&#x8FD9;&#x4E09;&#x4E2A;&#x65B9;&#x6CD5;&#x5904;&#x4E86;&#x7248;&#x672C;&#x4E0A;&#x7684;&#x5DEE;&#x5F02;&#xFF0C;&#x5177;&#x4F53;&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;&#x5462;&#xFF1F;</p>
<blockquote>
<p>getRowBytes()&#x8FD4;&#x56DE;&#x7684;&#x662F;&#x6BCF;&#x884C;&#x7684;&#x50CF;&#x7D20;&#x503C;&#xFF0C;&#x4E58;&#x4EE5;&#x9AD8;&#x5EA6;&#x5C31;&#x662F;&#x603B;&#x7684;&#x50CF;&#x7D20;&#x6570;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5360;&#x7528;&#x5185;&#x5B58;&#x7684;&#x5927;&#x5C0F;&#x3002; getAllocationByteCount()&#x4E0E;getByteCount()&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x4E00;&#x822C;&#x60C5;&#x51B5;&#x4E0B;&#x90FD;&#x662F;&#x76F8;&#x7B49;&#x7684;&#x3002;&#x53EA;&#x662F;&#x5728;&#x56FE;&#x7247;<br>&#x590D;&#x7528;&#x7684;&#x65F6;&#x5019;&#xFF0C;getAllocationByteCount()&#x8FD4;&#x56DE;&#x7684;&#x662F;&#x590D;&#x7528;&#x56FE;&#x50CF;&#x6240;&#x5360;&#x5185;&#x5B58;&#x7684;&#x5927;&#x5C0F;&#xFF0C;getByteCount()&#x8FD4;&#x56DE;&#x7684;&#x662F;&#x65B0;&#x89E3;&#x7801;&#x56FE;&#x7247;&#x5360;&#x7528;&#x5185;&#x5B58;&#x7684;&#x5927;&#x5C0F;&#x3002;</p>
</blockquote>
<p>&#x6211;&#x4EEC;&#x6765;&#x5199;&#x4E00;&#x4E2A;&#x5C0F;&#x4F8B;&#x5B50;&#x9A8C;&#x8BC1;&#x4E00;&#x4E0B;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;BitmapFactory.Options options = new BitmapFactory.Options();</span><br><span class="line">options.inDensity = 320;</span><br><span class="line">options.inTargetDensity = 320;</span><br><span class="line">//&#x8981;&#x5B9E;&#x73B0;&#x590D;&#x7528;&#xFF0C;&#x56FE;&#x50CF;&#x5FC5;&#x987B;&#x662F;&#x53EF;&#x53D8;&#x7684;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;inMutable&#x4E3A;true&#x3002;</span><br><span class="line">options.inMutable = true;</span><br><span class="line">Bitmap bitmap = BitmapFactory.decodeResource(getResources(), R.drawable.scenery, options);</span><br><span class="line">Log.d(TAG, &quot;bitmap.getAllocationByteCount(): &quot; + String.valueOf(bitmap.getAllocationByteCount()));</span><br><span class="line">Log.d(TAG, &quot;bitmap.getByteCount(): &quot; + String.valueOf(bitmap.getByteCount()));</span><br><span class="line">Log.d(TAG, &quot;bitmap.getRowBytes() * bitmap.getHeight(): &quot; + String.valueOf(bitmap.getRowBytes() * bitmap.getHeight()));</span><br><span class="line"></span><br><span class="line">BitmapFactory.Options reuseOptions = new BitmapFactory.Options();</span><br><span class="line">reuseOptions.inDensity = 320;</span><br><span class="line">reuseOptions.inTargetDensity = 320;</span><br><span class="line">//&#x8981;&#x590D;&#x7528;&#x7684;Bitmap</span><br><span class="line">reuseOptions.inBitmap = bitmap;</span><br><span class="line">//&#x8981;&#x5B9E;&#x73B0;&#x590D;&#x7528;&#xFF0C;&#x56FE;&#x50CF;&#x5FC5;&#x987B;&#x662F;&#x53EF;&#x53D8;&#x7684;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;inMutable&#x4E3A;true&#x3002;</span><br><span class="line">reuseOptions.inMutable = true;</span><br><span class="line">Bitmap reuseBitmap = BitmapFactory.decodeResource(getResources(), R.drawable.scenery_reuse, reuseOptions);</span><br><span class="line">Log.d(TAG, &quot;reuseBitmap.getAllocationByteCount(): &quot; + String.valueOf(reuseBitmap.getAllocationByteCount()));</span><br><span class="line">Log.d(TAG, &quot;reuseBitmap.getByteCount(): &quot; + String.valueOf(reuseBitmap.getByteCount()));</span><br><span class="line">Log.d(TAG, &quot;reuseBitmap.getRowBytes() * reuseBitmap.getHeight(): &quot; + String.valueOf(reuseBitmap.getRowBytes() * reuseBitmap.getHeight()));</span><br></pre></td></tr></table></figure>

<p>&#x8FD0;&#x884C;&#x7684;log&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/d0124e4615bdebf7ed4b8b7637ec19f432deb9124b00326615d1ef1cf69e8dbf" alt><br>&#x53EF;&#x4EE5;&#x53D1;&#x73B0;reuseBitmap&#x7684;getAllocationByteCount()&#x548C;getByteCount()&#x8FD4;&#x56DE;&#x4E0D;&#x4E00;&#x6837;&#xFF0C;getAllocationByteCount()&#x8FD4;&#x56DE;&#x7684;&#x662F;&#x590D;&#x7528;bitmap&#x5360;&#x7528;&#x5185;&#x5B58;&#x7684;&#x5927;&#x5C0F;&#xFF0C;<br>getByteCount()&#x8FD4;&#x56DE;&#x7684;&#x662F;&#x65B0;&#x7684;reuseOptions&#x5B9E;&#x9645;&#x89E3;&#x7801;&#x5360;&#x7528;&#x7684;&#x5185;&#x5B58;&#x5927;&#x5C0F;&#x3002;</p>
<p>&#x6CE8;&#x610F;&#x5728;&#x590D;&#x7528;&#x56FE;&#x7247;&#x7684;&#x65F6;&#x5019;&#xFF0C;options.inMutable&#x5FC5;&#x987B;&#x8BBE;&#x7F6E;&#x4E3A;true&#xFF0C;&#x5426;&#x5219;&#x65E0;&#x6CD5;&#x8FDB;&#x884C;&#x590D;&#x7528;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/5911bb5275b98bc81c3dd67d63f805f4a2929aefef2a921eec74b4bb1d6e15fc" alt></p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/032181a48973b0954f9120af14a2d0ad.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903553845166087.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903553845166087.html" itemprop="url">聊聊Dubbo（二）：简单入门 0 准备 1 服务端 2</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-22T13:29:23+08:00">
                2018-01-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="0-&#x51C6;&#x5907;"><a href="#0-&#x51C6;&#x5907;" class="headerlink" title="0 &#x51C6;&#x5907;"></a>0 &#x51C6;&#x5907;</h1><blockquote>
<ol>
<li><strong>&#x5B89;&#x88C5;&#x6CE8;&#x518C;&#x4E2D;&#x5FC3;</strong>&#xFF1A;Zookeeper&#x3001;Dubbox&#x81EA;&#x5E26;&#x7684;dubbo-registry-simple&#xFF1B;</li>
<li><strong>&#x5B89;&#x88C5;DubboKeeper&#x76D1;&#x63A7;</strong>&#xFF1A;<a href="/external_links/5b2363a41448a9d25dc2cf86990764a8.html" target="blank" rel="noopener">https://github.com/dubboclub/dubbokeeper&#xFF1B;</a></li>
</ol>
</blockquote>
<p>&#x4EE5;&#x4E0A;&#x4E24;&#x70B9;&#x51C6;&#x5907;&#xFF0C;&#x4E0D;&#x662F;&#x672C;&#x6587;&#x91CD;&#x70B9;&#xFF0C;&#x4E0D;&#x505A;&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;&#xFF0C;&#x5B89;&#x88C5;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#xFF0C;&#x81EA;&#x884C;&#x67E5;&#x9605;&#x76F8;&#x5173;&#x8D44;&#x6599;&#x5B89;&#x88C5;&#x5B66;&#x4E60;&#x3002;</p>
<h1 id="1-&#x670D;&#x52A1;&#x7AEF;"><a href="#1-&#x670D;&#x52A1;&#x7AEF;" class="headerlink" title="1 &#x670D;&#x52A1;&#x7AEF;"></a>1 &#x670D;&#x52A1;&#x7AEF;</h1><h2 id="1-2-&#x63A5;&#x53E3;&#x5B9A;&#x4E49;"><a href="#1-2-&#x63A5;&#x53E3;&#x5B9A;&#x4E49;" class="headerlink" title="1.2 &#x63A5;&#x53E3;&#x5B9A;&#x4E49;"></a>1.2 &#x63A5;&#x53E3;&#x5B9A;&#x4E49;</h2><ol>
<li><strong>&#x521B;&#x5EFA;Maven&#x6A21;&#x5757;&#xFF1A;msa-demo-api</strong></li>
</ol>
<p><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/70324fc3ff762aec219d4d59a613b22fe6428febea6302559a4e5d1731ddaecc" alt="msa-demo-api"><br>2. <strong>msa-demo-api&#xFF1A;&#x914D;&#x7F6E;pom.xml</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;!-- Dubbox&#x4F9D;&#x8D56; --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;dubbo&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.8.4&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- END --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- &#x5982;&#x679C;&#x8981;&#x4F7F;&#x7528;lombok --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">     &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">     &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- END --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- &#x5982;&#x679C;&#x8981;&#x4F7F;&#x7528;REST&#x98CE;&#x683C;&#x8FDC;&#x7A0B;&#x8C03;&#x7528; --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.jboss.resteasy&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;resteasy-jaxrs&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.0.7.Final&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.jboss.resteasy&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;resteasy-client&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.0.7.Final&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;javax.validation&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;validation-api&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0.0.GA&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- END --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- &#x5982;&#x679C;&#x8981;&#x4F7F;&#x7528;json&#x5E8F;&#x5217;&#x5316; --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.jboss.resteasy&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;resteasy-jackson-provider&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.0.7.Final&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- END --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- &#x5982;&#x679C;&#x8981;&#x4F7F;&#x7528;xml&#x5E8F;&#x5217;&#x5316; --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.jboss.resteasy&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;resteasy-jaxb-provider&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.0.7.Final&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- END --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- &#x5982;&#x679C;&#x8981;&#x4F7F;&#x7528;netty server --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.jboss.resteasy&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;resteasy-netty&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.0.7.Final&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- END --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- &#x5982;&#x679C;&#x8981;&#x4F7F;&#x7528;Sun HTTP server --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.jboss.resteasy&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;resteasy-jdk-http&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.0.7.Final&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- END --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- &#x5982;&#x679C;&#x8981;&#x4F7F;&#x7528;tomcat server --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.tomcat.embed&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;tomcat-embed-core&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;8.0.11&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.tomcat.embed&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;tomcat-embed-logging-juli&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;8.0.11&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- END --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- &#x5982;&#x679C;&#x8981;&#x4F7F;&#x7528;Kyro&#x5E8F;&#x5217;&#x5316; --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.esotericsoftware.kryo&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;kryo&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.24.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;de.javakaffee&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;kryo-serializers&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;0.26&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- END --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- &#x5982;&#x679C;&#x8981;&#x4F7F;&#x7528;FST&#x5E8F;&#x5217;&#x5316; --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;de.ruedigermoeller&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;fst&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.55&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- END --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- &#x5982;&#x679C;&#x8981;&#x4F7F;&#x7528;Jackson&#x5E8F;&#x5217;&#x5316; --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jackson-core&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.3.3&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.3.3&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- END --&gt;</span><br></pre></td></tr></table></figure>

<p>&#x4EE5;&#x4E0A;POM&#x914D;&#x7F6E;&#xFF0C;&#x4ECE;dubbox-2.8.4&#x5F00;&#x59CB;&#xFF0C;&#x6240;&#x6709;&#x4F9D;&#x8D56;&#x5E93;&#x7684;&#x4F7F;&#x7528;&#x65B9;&#x5F0F;&#x5C06;&#x548C;dubbo&#x539F;&#x6765;&#x7684;&#x4E00;&#x6837;&#xFF1A;&#x5373;&#x5982;&#x679C;&#x8981;&#x4F7F;&#x7528;REST&#x3001;Kyro&#x3001;FST&#x3001;Jackson&#x7B49;&#x529F;&#x80FD;&#xFF0C;&#x9700;&#x8981;&#x7528;&#x6237;&#x81EA;&#x884C;&#x624B;&#x5DE5;&#x6DFB;&#x52A0;&#x76F8;&#x5173;&#x7684;&#x4F9D;&#x8D56;&#x3002;<br>3. <strong>&#x5B9A;&#x4E49;&#x63A5;&#x53E3;&#xFF1A;UserService.java</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;/**</span><br><span class="line"> * @author TaoBangren</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @since 2017/5/17 &#x4E0A;&#x5348;9:26</span><br><span class="line"> */</span><br><span class="line">public interface UserService {</span><br><span class="line">    User getUser(Long id);</span><br><span class="line">    Long registerUser(User user);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><strong>&#x5B9A;&#x4E49;REST&#x63A5;&#x53E3;&#xFF1A;AnotherUserRestService.java</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;package com.alibaba.dubbo.demo.user.facade;</span><br><span class="line">import com.alibaba.dubbo.demo.user.User;</span><br><span class="line">import com.alibaba.dubbo.rpc.protocol.rest.support.ContentType;</span><br><span class="line">import javax.validation.constraints.Min;</span><br><span class="line">import javax.ws.rs.*;</span><br><span class="line">import javax.ws.rs.core.MediaType;</span><br><span class="line">/**</span><br><span class="line"> * @author TaoBangren</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @since 2017/5/17 &#x4E0A;&#x5348;9:26</span><br><span class="line"> */</span><br><span class="line">// &#x5728;Dubbo&#x4E2D;&#x5F00;&#x53D1;REST&#x670D;&#x52A1;&#x4E3B;&#x8981;&#x90FD;&#x662F;&#x901A;&#x8FC7;JAX-RS&#x7684;annotation&#x6765;&#x5B8C;&#x6210;&#x914D;&#x7F6E;&#x7684;&#xFF0C;</span><br><span class="line">// &#x5728;&#x4E0A;&#x9762;&#x7684;&#x793A;&#x4F8B;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x90FD;&#x662F;&#x5C06;annotation&#x653E;&#x5728;&#x670D;&#x52A1;&#x7684;&#x5B9E;&#x73B0;&#x7C7B;&#x4E2D;&#x3002;&#x4F46;&#x5176;&#x5B9E;&#xFF0C;&#x6211;</span><br><span class="line">// &#x4EEC;&#x5B8C;&#x5168;&#x4E5F;&#x53EF;&#x4EE5;&#x5C06;annotation&#x653E;&#x5230;&#x670D;&#x52A1;&#x7684;&#x63A5;&#x53E3;&#x4E0A;&#xFF0C;&#x8FD9;&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#x662F;&#x5B8C;&#x5168;&#x7B49;&#x4EF7;&#x7684;.</span><br><span class="line">//</span><br><span class="line">// &#x5728;&#x4E00;&#x822C;&#x5E94;&#x7528;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5EFA;&#x8BAE;&#x5C06;annotation&#x653E;&#x5230;&#x670D;&#x52A1;&#x5B9E;&#x73B0;&#x7C7B;&#xFF0C;&#x8FD9;&#x6837;annotation&#x548C;</span><br><span class="line">// java&#x5B9E;&#x73B0;&#x4EE3;&#x7801;&#x4F4D;&#x7F6E;&#x66F4;&#x63A5;&#x8FD1;&#xFF0C;&#x66F4;&#x4FBF;&#x4E8E;&#x5F00;&#x53D1;&#x548C;&#x7EF4;&#x62A4;&#x3002;&#x53E6;&#x5916;&#x66F4;&#x91CD;&#x8981;&#x7684;&#x662F;&#xFF0C;&#x6211;&#x4EEC;&#x4E00;&#x822C;&#x503E;&#x5411;</span><br><span class="line">// &#x4E8E;&#x907F;&#x514D;&#x5BF9;&#x63A5;&#x53E3;&#x7684;&#x6C61;&#x67D3;&#xFF0C;&#x4FDD;&#x6301;&#x63A5;&#x53E3;&#x7684;&#x7EAF;&#x51C0;&#x6027;&#x548C;&#x5E7F;&#x6CDB;&#x9002;&#x7528;&#x6027;&#x3002;</span><br><span class="line">// &#x4F46;&#x662F;&#xFF0C;&#x5982;&#x540E;&#x6587;&#x6240;&#x8FF0;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x8981;&#x7528;dubbo&#x76F4;&#x63A5;&#x5F00;&#x53D1;&#x7684;&#x6D88;&#x8D39;&#x7AEF;&#x6765;&#x8BBF;&#x95EE;&#x6B64;&#x670D;&#x52A1;&#xFF0C;&#x5219;annotation&#x5FC5;&#x987B;&#x653E;&#x5230;&#x63A5;&#x53E3;&#x4E0A;&#x3002;</span><br><span class="line">// &#x5982;&#x679C;&#x63A5;&#x53E3;&#x548C;&#x5B9E;&#x73B0;&#x7C7B;&#x90FD;&#x540C;&#x65F6;&#x6DFB;&#x52A0;&#x4E86;annotation&#xFF0C;&#x5219;&#x5B9E;&#x73B0;&#x7C7B;&#x7684;annotation&#x914D;&#x7F6E;&#x4F1A;&#x751F;&#x6548;&#xFF0C;&#x63A5;&#x53E3;&#x4E0A;&#x7684;annotation&#x88AB;&#x76F4;&#x63A5;&#x5FFD;&#x7565;&#x3002;</span><br><span class="line">@Path(&quot;u&quot;)</span><br><span class="line">@Consumes({MediaType.APPLICATION_JSON, MediaType.TEXT_XML})</span><br><span class="line">@Produces({ContentType.APPLICATION_JSON_UTF_8, ContentType.TEXT_XML_UTF_8})</span><br><span class="line">public interface AnotherUserRestService {</span><br><span class="line"></span><br><span class="line">      @GET</span><br><span class="line">      @Path(&quot;{id : \\d+}&quot;)</span><br><span class="line">      // &#x5728;&#x4E00;&#x4E2A;REST&#x670D;&#x52A1;&#x540C;&#x65F6;&#x5BF9;&#x591A;&#x79CD;&#x6570;&#x636E;&#x683C;&#x5F0F;&#x652F;&#x6301;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6839;&#x636E;JAX-RS&#x6807;&#x51C6;&#xFF0C;</span><br><span class="line">      // &#x4E00;&#x822C;&#x662F;&#x901A;&#x8FC7;HTTP&#x4E2D;&#x7684;MIME header&#xFF08;content-type&#x548C;accept&#xFF09;&#x6765;&#x6307;&#x5B9A;&#x5F53;&#x524D;&#x60F3;&#x7528;&#x7684;&#x662F;&#x54EA;&#x79CD;&#x683C;&#x5F0F;&#x7684;&#x6570;&#x636E;&#x3002;</span><br><span class="line">      // @Produces({ContentType.APPLICATION_JSON_UTF_8, ContentType.TEXT_XML_UTF_8})</span><br><span class="line">      // &#x4F46;&#x662F;&#x5728;dubbo&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x81EA;&#x52A8;&#x652F;&#x6301;&#x76EE;&#x524D;&#x4E1A;&#x754C;&#x666E;&#x904D;&#x4F7F;&#x7528;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x5373;&#x7528;&#x4E00;&#x4E2A;URL&#x540E;&#x7F00;&#xFF08;.json&#x548C;.xml&#xFF09;&#x6765;&#x6307;&#x5B9A;</span><br><span class="line">      // &#x60F3;&#x7528;&#x7684;&#x6570;&#x636E;&#x683C;&#x5F0F;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5728;&#x6DFB;&#x52A0;&#x4E0A;&#x8FF0;annotation&#x540E;&#xFF0C;&#x76F4;&#x63A5;&#x8BBF;&#x95EE;http://localhost:8888/users/1001.json</span><br><span class="line">      // &#x5219;&#x8868;&#x793A;&#x7528;json&#x683C;&#x5F0F;&#xFF0C;&#x76F4;&#x63A5;&#x8BBF;&#x95EE;http://localhost:8888/users/1002.xml&#x5219;&#x8868;&#x793A;&#x7528;xml&#x683C;&#x5F0F;&#xFF0C;</span><br><span class="line">      // &#x6BD4;&#x7528;HTTP Header&#x66F4;&#x7B80;&#x5355;&#x76F4;&#x89C2;&#x3002;Twitter&#x3001;&#x5FAE;&#x535A;&#x7B49;&#x7684;REST API&#x90FD;&#x662F;&#x91C7;&#x7528;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x3002;</span><br><span class="line">      // &#x5982;&#x679C;&#x4F60;&#x65E2;&#x4E0D;&#x52A0;HTTP header&#xFF0C;&#x4E5F;&#x4E0D;&#x52A0;&#x540E;&#x7F00;&#xFF0C;&#x5219;dubbo&#x7684;REST&#x4F1A;&#x4F18;&#x5148;&#x542F;&#x7528;&#x5728;&#x4EE5;&#x4E0A;annotation&#x5B9A;&#x4E49;&#x4E2D;&#x6392;&#x4F4D;&#x6700;&#x9760;&#x524D;&#x7684;&#x90A3;&#x79CD;&#x6570;&#x636E;&#x683C;&#x5F0F;&#x3002;</span><br><span class="line">      // &#x6CE8;&#x610F;&#xFF1A;&#x8FD9;&#x91CC;&#x8981;&#x652F;&#x6301;XML&#x683C;&#x5F0F;&#x6570;&#x636E;&#xFF0C;&#x5728;annotation&#x4E2D;&#x65E2;&#x53EF;&#x4EE5;&#x7528;MediaType.TEXT_XML&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x7528;MediaType.APPLICATION_XML&#xFF0C;</span><br><span class="line">      // &#x4F46;&#x662F;TEXT_XML&#x662F;&#x66F4;&#x5E38;&#x7528;&#x7684;&#xFF0C;&#x5E76;&#x4E14;&#x5982;&#x679C;&#x8981;&#x5229;&#x7528;&#x4E0A;&#x8FF0;&#x7684;URL&#x540E;&#x7F00;&#x65B9;&#x5F0F;&#x6765;&#x6307;&#x5B9A;&#x6570;&#x636E;&#x683C;&#x5F0F;&#xFF0C;&#x53EA;&#x80FD;&#x914D;&#x7F6E;&#x4E3A;TEXT_XML&#x624D;&#x80FD;&#x751F;&#x6548;&#x3002;</span><br><span class="line">      User getUser(@PathParam(&quot;id&quot;) @Min(1L) Long id);</span><br><span class="line"></span><br><span class="line">      @POST</span><br><span class="line">      @Path(&quot;register&quot;)</span><br><span class="line">      RegistrationResult registerUser(User user);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<ol start="5">
<li><strong>&#x5B9A;&#x4E49;&#x5B9E;&#x4F53;&#xFF1A;User.java</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;package com.alibaba.dubbo.demo.user;</span><br><span class="line">import lombok.Data;</span><br><span class="line">import org.codehaus.jackson.annotate.JsonProperty;</span><br><span class="line">import javax.validation.constraints.Min;</span><br><span class="line">import javax.validation.constraints.NotNull;</span><br><span class="line">import javax.validation.constraints.Size;</span><br><span class="line">import javax.xml.bind.annotation.XmlAccessType;</span><br><span class="line">import javax.xml.bind.annotation.XmlAccessorType;</span><br><span class="line">import javax.xml.bind.annotation.XmlElement;</span><br><span class="line">import javax.xml.bind.annotation.XmlRootElement;</span><br><span class="line">import java.io.Serializable;</span><br><span class="line">/**</span><br><span class="line"> * @author TaoBangren</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @since 2017/5/17 &#x4E0A;&#x5348;9:26</span><br><span class="line"> */</span><br><span class="line">// &#x7531;&#x4E8E;JAX-RS&#x7684;&#x5B9E;&#x73B0;&#x4E00;&#x822C;&#x90FD;&#x7528;&#x6807;&#x51C6;&#x7684;JAXB&#xFF08;Java API for XML Binding&#xFF09;&#x6765;&#x5E8F;&#x5217;&#x5316;&#x548C;&#x53CD;&#x5E8F;&#x5217;&#x5316;XML&#x683C;&#x5F0F;&#x6570;&#x636E;&#xFF0C;</span><br><span class="line">// &#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4E3A;&#x6BCF;&#x4E00;&#x4E2A;&#x8981;&#x7528;XML&#x4F20;&#x8F93;&#x7684;&#x5BF9;&#x8C61;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x7C7B;&#x7EA7;&#x522B;&#x7684;JAXB annotation(@XmlRootElement) &#xFF0C;&#x5426;&#x5219;&#x5E8F;&#x5217;&#x5316;&#x5C06;&#x62A5;&#x9519;&#x3002;</span><br><span class="line">@Data</span><br><span class="line">@XmlRootElement</span><br><span class="line">@XmlAccessorType(XmlAccessType.FIELD)</span><br><span class="line">public class User implements Serializable {</span><br><span class="line"></span><br><span class="line">      @NotNull</span><br><span class="line">      @Min(1L)</span><br><span class="line">      private Long id;</span><br><span class="line"></span><br><span class="line">      // REST&#x7684;&#x5E95;&#x5C42;&#x5B9E;&#x73B0;&#x4F1A;&#x5728;service&#x7684;&#x5BF9;&#x8C61;&#x548C;JSON/XML&#x6570;&#x636E;&#x683C;&#x5F0F;&#x4E4B;&#x95F4;&#x81EA;&#x52A8;&#x505A;&#x5E8F;&#x5217;&#x5316;/&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x3002;</span><br><span class="line">      // &#x4F46;&#x6709;&#x4E9B;&#x573A;&#x666F;&#x4E0B;&#xFF0C;&#x5982;&#x679C;&#x89C9;&#x5F97;&#x8FD9;&#x79CD;&#x81EA;&#x52A8;&#x8F6C;&#x6362;&#x4E0D;&#x6EE1;&#x8DB3;&#x8981;&#x6C42;&#xFF0C;&#x53EF;&#x4EE5;&#x5BF9;&#x5176;&#x505A;&#x5B9A;&#x5236;&#x3002;</span><br><span class="line">      // Dubbo&#x4E2D;&#x7684;REST&#x5B9E;&#x73B0;&#x662F;&#x7528;JAXB&#x505A;XML&#x5E8F;&#x5217;&#x5316;&#xFF0C;&#x7528;Jackson&#x505A;JSON&#x5E8F;&#x5217;&#x5316;&#xFF0C;</span><br><span class="line">      // &#x6240;&#x4EE5;&#x5728;&#x5BF9;&#x8C61;&#x4E0A;&#x6DFB;&#x52A0;JAXB&#x6216;Jackson&#x7684;annotation&#x5373;&#x53EF;&#x4EE5;&#x5B9A;&#x5236;&#x6620;&#x5C04;&#x3002;</span><br><span class="line">      @JsonProperty(&quot;username&quot;)</span><br><span class="line">      @XmlElement(name = &quot;username&quot;)</span><br><span class="line">      @NotNull</span><br><span class="line">      @Size(min = 6, max = 50)</span><br><span class="line">      private String name;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<ol start="6">
<li><strong>&#x5B9A;&#x4E49;REST&#x54CD;&#x5E94;&#x7ED3;&#x679C;&#x5B9E;&#x4F53;&#xFF1A;RegistrationResult.java</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;package com.alibaba.dubbo.demo.user.facade;</span><br><span class="line">import lombok.Data;</span><br><span class="line">import javax.xml.bind.annotation.XmlRootElement;</span><br><span class="line">import java.io.Serializable;</span><br><span class="line">/**</span><br><span class="line"> * @author TaoBangren</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @since 2017/5/17 &#x4E0A;&#x5348;9:26</span><br><span class="line"> */</span><br><span class="line">// &#x6B64;&#x5916;&#xFF0C;&#x5982;&#x679C;service&#x65B9;&#x6CD5;&#x4E2D;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x662F;Java&#x7684; primitive&#x7C7B;&#x578B;&#xFF08;&#x5982;int&#xFF0C;long&#xFF0C;float&#xFF0C;double&#x7B49;&#xFF09;&#xFF0C;</span><br><span class="line">// &#x6700;&#x597D;&#x4E3A;&#x5B83;&#x4EEC;&#x6DFB;&#x52A0;&#x4E00;&#x5C42;wrapper&#x5BF9;&#x8C61;&#xFF0C;&#x56E0;&#x4E3A;JAXB&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x5E8F;&#x5217;&#x5316;primitive&#x7C7B;&#x578B;&#x3002;&#x8FD9;&#x6837;&#x4E0D;&#x4F46;&#x80FD;&#x591F;&#x89E3;&#x51B3;XML&#x5E8F;&#x5217;&#x5316;&#x7684;&#x95EE;&#x9898;&#xFF0C;</span><br><span class="line">// &#x800C;&#x4E14;&#x4F7F;&#x5F97;&#x8FD4;&#x56DE;&#x7684;&#x6570;&#x636E;&#x90FD;&#x7B26;&#x5408;XML&#x548C;JSON&#x7684;&#x89C4;&#x8303;&#x3002;</span><br><span class="line">// &#x8FD9;&#x79CD;wrapper&#x5BF9;&#x8C61;&#x5176;&#x5B9E;&#x5229;&#x7528;&#x6240;&#x8C13;Data Transfer Object&#xFF08;DTO&#xFF09;&#x6A21;&#x5F0F;&#xFF0C;&#x91C7;&#x7528;DTO&#x8FD8;&#x80FD;&#x5BF9;&#x4F20;&#x8F93;&#x6570;&#x636E;&#x505A;&#x66F4;&#x591A;&#x6709;&#x7528;&#x7684;&#x5B9A;&#x5236;&#x3002;</span><br><span class="line">@Data</span><br><span class="line">@XmlRootElement</span><br><span class="line">public class RegistrationResult implements Serializable {</span><br><span class="line">      private Long id;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h2 id="1-3-&#x670D;&#x52A1;&#x5B9E;&#x73B0;"><a href="#1-3-&#x670D;&#x52A1;&#x5B9E;&#x73B0;" class="headerlink" title="1.3 &#x670D;&#x52A1;&#x5B9E;&#x73B0;"></a>1.3 &#x670D;&#x52A1;&#x5B9E;&#x73B0;</h2><ol>
<li><strong>&#x521B;&#x5EFA;Maven&#x6A21;&#x5757;&#xFF1A;msa-demo-provider</strong></li>
</ol>
<p><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/6f6c428a1fddc50aa640303f662dd04c8cf7757402ed50c930b7c1194c1d3fd1" alt="msa-demo-provider"><br>2. <strong>msa-demo-provider&#xFF1A;&#x914D;&#x7F6E;pom.xml</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;!-- Module&#x4F9D;&#x8D56; START --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">     &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">     &lt;artifactId&gt;msa-demo-api&lt;/artifactId&gt;</span><br><span class="line">     &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- Module&#x4F9D;&#x8D56; END --&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>&#x5B9E;&#x73B0;UserService&#x63A5;&#x53E3;&#xFF1A;UserServiceImpl.java</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;package com.alibaba.dubbo.demo.user;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import java.util.concurrent.atomic.AtomicLong;</span><br><span class="line">/**</span><br><span class="line"> * @author TaoBangren</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @since 2017/5/17 &#x4E0A;&#x5348;9:26</span><br><span class="line"> */</span><br><span class="line">@Slf4j</span><br><span class="line">public class UserServiceImpl implements UserService {</span><br><span class="line">      private final AtomicLong idGen = new AtomicLong();</span><br><span class="line">      public User getUser(Long id) {</span><br><span class="line">          User user = new User();</span><br><span class="line">          user.setId(id);</span><br><span class="line">          user.setName(&quot;username&quot; + id);</span><br><span class="line">          return user;</span><br><span class="line">      }</span><br><span class="line">  </span><br><span class="line">      public Long registerUser(User user) {</span><br><span class="line">          // System.out.println(&quot;Username is &quot; + user.getName());</span><br><span class="line">          return idGen.incrementAndGet();</span><br><span class="line">      }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><strong>&#x5B9E;&#x73B0;REST&#x63A5;&#x53E3;AnotherUserRestService&#xFF1A;AnotherUserRestServiceImpl.java</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;package com.alibaba.dubbo.demo.user.facade;</span><br><span class="line">import com.alibaba.dubbo.demo.user.User;</span><br><span class="line">import com.alibaba.dubbo.demo.user.UserService;</span><br><span class="line">import com.alibaba.dubbo.rpc.RpcContext;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">/**</span><br><span class="line"> * @author TaoBangren</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @since 2017/5/17 &#x4E0A;&#x5348;9:26</span><br><span class="line"> */</span><br><span class="line">@Slf4j</span><br><span class="line">public class AnotherUserRestServiceImpl implements AnotherUserRestService {</span><br><span class="line"></span><br><span class="line">      private UserService userService;</span><br><span class="line"></span><br><span class="line">      public void setUserService(UserService userService) {</span><br><span class="line">          this.userService = userService;</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      public User getUser(Long id) {</span><br><span class="line">          System.out.println(&quot;Client name is &quot; + RpcContext.getContext().getAttachment(&quot;clientName&quot;));</span><br><span class="line">          System.out.println(&quot;Client impl is &quot; + RpcContext.getContext().getAttachment(&quot;clientImpl&quot;));</span><br><span class="line">          return userService.getUser(id);</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      public RegistrationResult registerUser(User user) {</span><br><span class="line">          Long id = userService.registerUser(user);</span><br><span class="line">          RegistrationResult registrationResult = new RegistrationResult();</span><br><span class="line">          registrationResult.setId(id);</span><br><span class="line">          return registrationResult;</span><br><span class="line">      }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<ol start="5">
<li><strong>Dubbox&#x4E0E;Spring&#x96C6;&#x6210;&#x914D;&#x7F6E;&#xFF1A;msa-demo-provider.xml</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801; &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line"> &lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">     xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">     xmlns:dubbo=&quot;http://code.alibabatech.com/schema/dubbo&quot;</span><br><span class="line">     xsi:schemaLocation=&quot;</span><br><span class="line">     http://www.springframework.org/schema/beans</span><br><span class="line">     http://www.springframework.org/schema/beans/spring-beans-2.5.xsd</span><br><span class="line">     http://code.alibabatech.com/schema/dubbo</span><br><span class="line">     http://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line">     &lt;!-- &#x5F53;&#x524D;&#x5E94;&#x7528;&#x4FE1;&#x606F;&#x914D;&#x7F6E; --&gt;</span><br><span class="line">     &lt;dubbo:application name=&quot;msa-demo-provider&quot; owner=&quot;tbr&quot; organization=&quot;tbr&quot;/&gt;</span><br><span class="line">     &lt;dubbo:monitor address=&quot;x.x.x.x:20884&quot;/&gt;</span><br><span class="line"></span><br><span class="line">     &lt;!-- &#x591A;&#x6CE8;&#x518C;&#x4E2D;&#x5FC3;&#x914D;&#x7F6E;&#xFF0C;&#x7AD6;&#x53F7;&#x5206;&#x9694;&#x8868;&#x793A;&#x540C;&#x65F6;&#x8FDE;&#x63A5;&#x591A;&#x4E2A;&#x4E0D;&#x540C;&#x6CE8;&#x518C;&#x4E2D;&#x5FC3;&#xFF0C;&#x540C;&#x4E00;&#x6CE8;&#x518C;&#x4E2D;&#x5FC3;&#x7684;&#x591A;&#x4E2A;&#x96C6;&#x7FA4;&#x5730;&#x5740;&#x7528;&#x9017;&#x53F7;&#x5206;&#x9694; --&gt;</span><br><span class="line">     &lt;dubbo:registry protocol=&quot;zookeeper&quot; address=&quot;x.x.x.x:2181,x.x.x.x:2181,x.x.x.x:2181&quot;/&gt;</span><br><span class="line">     &lt;dubbo:protocol name=&quot;dubbo&quot; port=&quot;20880&quot; serialization=&quot;kryo&quot;/&gt;</span><br><span class="line"></span><br><span class="line">     &lt;!--</span><br><span class="line">        1. &#x9009;&#x7528;&#x4E86;&#x5D4C;&#x5165;&#x5F0F;&#x7684;jetty&#x6765;&#x505A;rest server&#xFF0C;&#x540C;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x914D;&#x7F6E;server&#x5C5E;&#x6027;&#xFF0C;rest&#x534F;&#x8BAE;&#x9ED8;&#x8BA4;&#x4E5F;&#x662F;&#x9009;&#x7528;jetty&#x3002;</span><br><span class="line">        jetty&#x662F;&#x975E;&#x5E38;&#x6210;&#x719F;&#x7684;java servlet&#x5BB9;&#x5668;&#xFF0C;&#x5E76;&#x548C;dubbo&#x5DF2;&#x7ECF;&#x6709;&#x8F83;&#x597D;&#x7684;&#x96C6;&#x6210;&#xFF08;&#x76EE;&#x524D;5&#x79CD;&#x5D4C;&#x5165;&#x5F0F;server&#x4E2D;&#x53EA;&#x6709;jetty</span><br><span class="line">        &#x548C;&#x540E;&#x9762;&#x6240;&#x8FF0;&#x7684;tomcat&#x3001;tjws&#xFF0C;&#x4E0E;dubbo&#x76D1;&#x63A7;&#x7CFB;&#x7EDF;&#x7B49;&#x5B8C;&#x6210;&#x4E86;&#x65E0;&#x7F1D;&#x7684;&#x96C6;&#x6210;&#xFF09;&#xFF0C;&#x6240;&#x4EE5;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x7684;dubbo&#x7CFB;&#x7EDF;&#x662F;&#x5355;&#x72EC;&#x542F;&#x52A8;&#x7684;&#x8FDB;&#x7A0B;&#xFF0C;</span><br><span class="line">        &#x4F60;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x9ED8;&#x8BA4;&#x91C7;&#x7528;jetty&#x5373;&#x53EF;&#x3002;dubbo&#x4E2D;&#x7684;rest&#x534F;&#x8BAE;&#x9ED8;&#x8BA4;&#x5C06;&#x91C7;&#x7528;80&#x7AEF;&#x53E3;.</span><br><span class="line">        &lt;dubbo:protocol name=&quot;rest&quot; server=&quot;jetty&quot;/&gt;</span><br><span class="line"> </span><br><span class="line">        2. &#x914D;&#x7F6E;&#x9009;&#x7528;&#x4E86;&#x5D4C;&#x5165;&#x5F0F;&#x7684;tomcat&#x6765;&#x505A;rest server&#x3002;&#x5728;&#x5D4C;&#x5165;&#x5F0F;tomcat&#x4E0A;&#xFF0C;REST&#x7684;&#x6027;&#x80FD;&#x6BD4;jetty&#x4E0A;&#x8981;&#x597D;&#x5F97;&#x591A;&#xFF08;&#x53C2;&#x89C1;&#x540E;&#x9762;&#x7684;&#x57FA;&#x51C6;&#x6D4B;&#x8BD5;&#xFF09;&#xFF0C;</span><br><span class="line">        &#x5EFA;&#x8BAE;&#x5728;&#x9700;&#x8981;&#x9AD8;&#x6027;&#x80FD;&#x7684;&#x573A;&#x666F;&#x4E0B;&#x91C7;&#x7528;tomcat&#x3002;</span><br><span class="line">        &lt;dubbo:protocol name=&quot;rest&quot; server=&quot;tomcat&quot;/&gt;</span><br><span class="line"> </span><br><span class="line">        3. &#x914D;&#x7F6E;&#x9009;&#x7528;&#x5D4C;&#x5165;&#x5F0F;&#x7684;netty&#x6765;&#x505A;rest server&#x3002;</span><br><span class="line">        &lt;dubbo:protocol name=&quot;rest&quot; server=&quot;netty&quot;/&gt;</span><br><span class="line"> </span><br><span class="line">        4. &#x914D;&#x7F6E;&#x9009;&#x7528;&#x5D4C;&#x5165;&#x5F0F;&#x7684;tjws&#x6216;Sun HTTP server&#x6765;&#x505A;rest server&#x3002;&#x8FD9;&#x4E24;&#x4E2A;server&#x5B9E;&#x73B0;&#x975E;&#x5E38;&#x8F7B;&#x91CF;&#x7EA7;&#xFF0C;</span><br><span class="line">        &#x975E;&#x5E38;&#x65B9;&#x4FBF;&#x5728;&#x96C6;&#x6210;&#x6D4B;&#x8BD5;&#x4E2D;&#x5FEB;&#x901F;&#x542F;&#x52A8;&#x4F7F;&#x7528;&#xFF0C;&#x5F53;&#x7136;&#x4E5F;&#x53EF;&#x4EE5;&#x5728;&#x8D1F;&#x8377;&#x4E0D;&#x9AD8;&#x7684;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x4E2D;&#x4F7F;&#x7528;&#x3002; &#x6CE8;&#xFF1A;tjws&#x76EE;&#x524D;&#x5DF2;&#x7ECF;</span><br><span class="line">        &#x88AB;deprecated&#x6389;&#x4E86;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4E0D;&#x80FD;&#x5F88;&#x597D;&#x7684;&#x548C;servlet 3.1 API&#x5DE5;&#x4F5C;&#x3002;</span><br><span class="line">        &lt;dubbo:protocol name=&quot;rest&quot; server=&quot;tjws&quot;/&gt;</span><br><span class="line">        &lt;dubbo:protocol name=&quot;rest&quot; server=&quot;sunhttp&quot;/&gt;</span><br><span class="line"></span><br><span class="line">        5. &#x5982;&#x679C;&#x4F60;&#x7684;dubbo&#x7CFB;&#x7EDF;&#x4E0D;&#x662F;&#x5355;&#x72EC;&#x542F;&#x52A8;&#x7684;&#x8FDB;&#x7A0B;&#xFF0C;&#x800C;&#x662F;&#x90E8;&#x7F72;&#x5230;&#x4E86;Java&#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;&#x4E2D;&#xFF0C;&#x5219;&#x5EFA;&#x8BAE;&#x4F60;&#x91C7;&#x7528;&#x4EE5;&#x4E0B;&#x914D;&#x7F6E;&#xFF1A;</span><br><span class="line">        &lt;dubbo:protocol name=&quot;rest&quot; server=&quot;servlet&quot;/&gt;</span><br><span class="line"></span><br><span class="line">        6. &#x901A;&#x8FC7;&#x5C06;server&#x8BBE;&#x7F6E;&#x4E3A;servlet&#xFF0C;dubbo&#x5C06;&#x91C7;&#x7528;&#x5916;&#x90E8;&#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;&#x7684;servlet&#x5BB9;&#x5668;&#x6765;&#x505A;rest server&#x3002;&#x540C;&#x65F6;&#xFF0C;&#x8FD8;&#x8981;&#x5728;dubbo&#x7CFB;&#x7EDF;&#x7684;web.xml&#x4E2D;&#x6DFB;&#x52A0;&#x5982;&#x4E0B;&#x914D;&#x7F6E;&#xFF1A;</span><br><span class="line">        &lt;web-app&gt;</span><br><span class="line">            &lt;context-param&gt;</span><br><span class="line">                &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</span><br><span class="line">                &lt;param-value&gt;/WEB-INF/classes/META-INF/spring/dubbo-demo-provider.xml&lt;/param-value&gt;</span><br><span class="line">            &lt;/context-param&gt;</span><br><span class="line"> </span><br><span class="line">            &lt;listener&gt;</span><br><span class="line">                &lt;listener-class&gt;com.alibaba.dubbo.remoting.http.servlet.BootstrapListener&lt;/listener-class&gt;</span><br><span class="line">            &lt;/listener&gt;</span><br><span class="line"> </span><br><span class="line">            &lt;listener&gt;</span><br><span class="line">                &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;</span><br><span class="line">            &lt;/listener&gt;</span><br><span class="line"> </span><br><span class="line">            &lt;servlet&gt;</span><br><span class="line">                &lt;servlet-name&gt;dispatcher&lt;/servlet-name&gt;</span><br><span class="line">                &lt;servlet-class&gt;com.alibaba.dubbo.remoting.http.servlet.DispatcherServlet&lt;/servlet-class&gt;</span><br><span class="line">                &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;</span><br><span class="line">            &lt;/servlet&gt;</span><br><span class="line"> </span><br><span class="line">            &lt;servlet-mapping&gt;</span><br><span class="line">                &lt;servlet-name&gt;dispatcher&lt;/servlet-name&gt;</span><br><span class="line">                &lt;url-pattern&gt;/*&lt;/url-pattern&gt;</span><br><span class="line">            &lt;/servlet-mapping&gt;</span><br><span class="line">        &lt;/web-app&gt;</span><br><span class="line">        &#x5373;&#x5FC5;&#x987B;&#x5C06;dubbo&#x7684;BootstrapListener&#x548C;DispatherServlet&#x6DFB;&#x52A0;&#x5230;web.xml&#xFF0C;&#x4EE5;&#x5B8C;&#x6210;dubbo&#x7684;REST&#x529F;&#x80FD;&#x4E0E;&#x5916;&#x90E8;servlet&#x5BB9;&#x5668;&#x7684;&#x96C6;&#x6210;&#x3002;</span><br><span class="line"> </span><br><span class="line">        &#x5176;&#x5B9E;&#xFF0C;&#x8FD9;&#x79CD;&#x573A;&#x666F;&#x4E0B;&#x4F60;&#x4F9D;&#x7136;&#x53EF;&#x4EE5;&#x575A;&#x6301;&#x7528;&#x5D4C;&#x5165;&#x5F0F;server&#xFF0C;&#x4F46;&#x5916;&#x90E8;&#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;&#x7684;servlet&#x5BB9;&#x5668;&#x5F80;&#x5F80;&#x6BD4;&#x5D4C;&#x5165;&#x5F0F;server&#x66F4;&#x52A0;&#x5F3A;&#x5927;</span><br><span class="line">        &#xFF08;&#x7279;&#x522B;&#x662F;&#x5982;&#x679C;&#x4F60;&#x662F;&#x90E8;&#x7F72;&#x5230;&#x66F4;&#x5065;&#x58EE;&#x66F4;&#x53EF;&#x4F38;&#x7F29;&#x7684;WebLogic&#xFF0C;WebSphere&#x7B49;&#xFF09;&#xFF0C;&#x53E6;&#x5916;&#x6709;&#x65F6;&#x4E5F;&#x4FBF;&#x4E8E;&#x5728;&#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;&#x505A;&#x7EDF;&#x4E00;&#x7BA1;&#x7406;&#x3001;&#x76D1;&#x63A7;&#x7B49;&#x7B49;&#x3002;</span><br><span class="line"> </span><br><span class="line">        &#x5982;&#x679C;&#x5C06;dubbo REST&#x90E8;&#x7F72;&#x5230;&#x5916;&#x90E8;Tomcat&#x4E0A;&#xFF0C;&#x5E76;&#x914D;&#x7F6E;server=&quot;servlet&quot;&#xFF0C;&#x5373;&#x542F;&#x7528;&#x5916;&#x90E8;&#x7684;tomcat&#x6765;&#x505A;&#x4E3A;rest server&#x7684;&#x5E95;&#x5C42;&#x5B9E;&#x73B0;&#xFF0C;</span><br><span class="line">        &#x5219;&#x6700;&#x597D;&#x5728;tomcat&#x4E0A;&#x6DFB;&#x52A0;&#x5982;&#x4E0B;&#x914D;&#x7F6E;&#xFF1A;</span><br><span class="line">        &lt;Connector port=&quot;8080&quot; protocol=&quot;org.apache.coyote.http11.Http11NioProtocol&quot;</span><br><span class="line">            connectionTimeout=&quot;20000&quot;</span><br><span class="line">            redirectPort=&quot;8443&quot;</span><br><span class="line">            minSpareThreads=&quot;20&quot;</span><br><span class="line">            enableLookups=&quot;false&quot;</span><br><span class="line">            maxThreads=&quot;100&quot;</span><br><span class="line">            maxKeepAliveRequests=&quot;-1&quot;</span><br><span class="line">            keepAliveTimeout=&quot;60000&quot;/&gt;</span><br><span class="line">        &#x7279;&#x522B;&#x662F;maxKeepAliveRequests=&quot;-1&quot;&#xFF0C;&#x8FD9;&#x4E2A;&#x914D;&#x7F6E;&#x4E3B;&#x8981;&#x662F;&#x4FDD;&#x8BC1;tomcat&#x4E00;&#x76F4;&#x542F;&#x7528;http&#x957F;&#x8FDE;&#x63A5;&#xFF0C;&#x4EE5;&#x63D0;&#x9AD8;REST&#x8C03;&#x7528;&#x6027;&#x80FD;&#x3002;</span><br><span class="line">        &#x4F46;&#x662F;&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x5982;&#x679C;REST&#x6D88;&#x8D39;&#x7AEF;&#x4E0D;&#x662F;&#x6301;&#x7EED;&#x7684;&#x8C03;&#x7528;REST&#x670D;&#x52A1;&#xFF0C;&#x5219;&#x4E00;&#x76F4;&#x542F;&#x7528;&#x957F;&#x8FDE;&#x63A5;&#x672A;&#x5FC5;&#x662F;&#x6700;&#x597D;&#x7684;&#x505A;&#x6CD5;&#x3002;&#x53E6;&#x5916;&#xFF0C;&#x4E00;&#x76F4;&#x542F;&#x7528;&#x957F;&#x8FDE;</span><br><span class="line">        &#x63A5;&#x7684;&#x65B9;&#x5F0F;&#x4E00;&#x822C;&#x4E0D;&#x9002;&#x5408;&#x9488;&#x5BF9;&#x666E;&#x901A;webapp&#xFF0C;&#x66F4;&#x9002;&#x5408;&#x8FD9;&#x79CD;&#x7C7B;&#x4F3C;rpc&#x7684;&#x573A;&#x666F;&#x3002;&#x6240;&#x4EE5;&#x4E3A;&#x4E86;&#x9AD8;&#x6027;&#x80FD;&#xFF0C;&#x5728;tomcat&#x4E2D;&#xFF0C;dubbo REST&#x5E94;</span><br><span class="line">        &#x7528;&#x548C;&#x666E;&#x901A;web&#x5E94;&#x7528;&#x6700;&#x597D;&#x4E0D;&#x8981;&#x6DF7;&#x5408;&#x90E8;&#x7F72;&#xFF0C;&#x800C;&#x5E94;&#x8BE5;&#x7528;&#x5355;&#x72EC;&#x7684;&#x5B9E;&#x4F8B;&#x3002;</span><br><span class="line"> </span><br><span class="line">        7. &#x6CE8;&#x610F;&#xFF1A;&#x5982;&#x679C;&#x4F60;&#x662F;&#x7528;spring&#x7684;ContextLoaderListener&#x6765;&#x52A0;&#x8F7D;spring&#xFF0C;</span><br><span class="line">        &#x5219;&#x5FC5;&#x987B;&#x4FDD;&#x8BC1;BootstrapListener&#x914D;&#x7F6E;&#x5728;ContextLoaderListener&#x4E4B;&#x524D;&#xFF0C;&#x5426;&#x5219;dubbo&#x521D;&#x59CB;&#x5316;&#x4F1A;&#x51FA;&#x9519;&#x3002;</span><br><span class="line">     --&gt;</span><br><span class="line"> </span><br><span class="line">     &lt;!--</span><br><span class="line">        1. &#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;&#x6240;&#x6709;rest&#x670D;&#x52A1;&#x90FD;&#x9002;&#x7528;&#x7684;&#x57FA;&#x7840;&#x76F8;&#x5BF9;&#x8DEF;&#x5F84;&#xFF0C;&#x5373;java web&#x5E94;&#x7528;&#x4E2D;&#x5E38;&#x8BF4;&#x7684;context path&#x3002;&#x53EA;&#x9700;&#x8981;&#x6DFB;&#x52A0;&#x5982;&#x4E0B;contextpath&#x5C5E;&#x6027;&#x5373;&#x53EF;.</span><br><span class="line">        &lt;dubbo:protocol name=&quot;rest&quot; port=&quot;8888&quot; keepalive=&quot;true&quot; server=&quot;netty&quot; iothreads=&quot;5&quot; threads=&quot;100&quot; contextpath=&quot;services&quot;/&gt;</span><br><span class="line"> </span><br><span class="line">        2. &#x53EF;&#x4EE5;&#x4E3A;rest&#x670D;&#x52A1;&#x914D;&#x7F6E;&#x7EBF;&#x7A0B;&#x6C60;&#x5927;&#x5C0F;&#xFF1A;</span><br><span class="line">        &lt;dubbo:protocol name=&quot;rest&quot; threads=&quot;500&quot;/&gt;</span><br><span class="line">        &#x6CE8;&#x610F;&#xFF1A;&#x76EE;&#x524D;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x8BBE;&#x7F6E;&#x53EA;&#x6709;&#x5F53;server=&quot;netty&quot;&#x6216;&#x8005;server=&quot;jetty&quot;&#x6216;&#x8005;server=&quot;tomcat&quot;&#x7684;&#x65F6;&#x5019;&#x624D;&#x80FD;&#x751F;&#x6548;&#x3002;&#x53E6;&#x5916;&#xFF0C;&#x5982;&#x679C;server=&quot;servlet&quot;&#xFF0C;&#x7531;&#x4E8E;&#x8FD9;&#x65F6;&#x5019;&#x542F;&#x7528;</span><br><span class="line">        &#x7684;&#x662F;&#x5916;&#x90E8;&#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;&#x505A;rest server&#xFF0C;&#x4E0D;&#x53D7;dubbo&#x63A7;&#x5236;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x7684;&#x7EBF;&#x7A0B;&#x6C60;&#x8BBE;&#x7F6E;&#x4E5F;&#x65E0;&#x6548;&#x3002;</span><br><span class="line"> </span><br><span class="line">        &#x5982;&#x679C;&#x662F;&#x9009;&#x7528;netty server&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x914D;&#x7F6E;Netty&#x7684;IO worker&#x7EBF;&#x7A0B;&#x6570;&#xFF1A;</span><br><span class="line">        &lt;dubbo:protocol name=&quot;rest&quot; iothreads=&quot;5&quot; threads=&quot;100&quot;/&gt;</span><br><span class="line"> </span><br><span class="line">        3. &#x6CE8;&#x610F;&#xFF1A;&#x5982;&#x679C;&#x4F60;&#x662F;&#x9009;&#x7528;&#x5916;&#x90E8;&#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;&#x505A;rest server, &#x5373;&#x914D;&#x7F6E;:</span><br><span class="line">        &lt;dubbo:protocol name=&quot;rest&quot; port=&quot;8888&quot; contextpath=&quot;services&quot; server=&quot;servlet&quot;/&gt;</span><br><span class="line">        &#x5219;&#x5FC5;&#x987B;&#x4FDD;&#x8BC1;&#x8FD9;&#x91CC;&#x8BBE;&#x7F6E;&#x7684;port&#x3001;contextpath&#xFF0C;&#x4E0E;&#x5916;&#x90E8;&#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;&#x7684;&#x7AEF;&#x53E3;&#x3001;DispatcherServlet&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x8DEF;&#x5F84;&#xFF08;&#x5373;webapp path&#x52A0;&#x4E0A;servlet url pattern&#xFF09;&#x4FDD;&#x6301;&#x4E00;&#x81F4;&#x3002;</span><br><span class="line"> </span><br><span class="line">        4. Dubbo&#x4E2D;&#x7684;rest&#x670D;&#x52A1;&#x9ED8;&#x8BA4;&#x90FD;&#x662F;&#x91C7;&#x7528;http&#x957F;&#x8FDE;&#x63A5;&#x6765;&#x8BBF;&#x95EE;&#xFF0C;&#x5982;&#x679C;&#x60F3;&#x5207;&#x6362;&#x4E3A;&#x77ED;&#x8FDE;&#x63A5;&#xFF0C;&#x76F4;&#x63A5;&#x914D;&#x7F6E;&#xFF1A;</span><br><span class="line">        &lt;dubbo:protocol name=&quot;rest&quot; keepalive=&quot;false&quot;/&gt;</span><br><span class="line">        &#x6CE8;&#x610F;&#xFF1A;&#x8FD9;&#x4E2A;&#x914D;&#x7F6E;&#x76EE;&#x524D;&#x53EA;&#x5BF9;server=&quot;netty&quot;&#x548C;server=&quot;tomcat&quot;&#x624D;&#x80FD;&#x751F;&#x6548;&#x3002;</span><br><span class="line"> </span><br><span class="line">        5. &#x914D;&#x7F6E;&#x670D;&#x52A1;&#x5668;&#x63D0;&#x4F9B;&#x7AEF;&#x6240;&#x80FD;&#x540C;&#x65F6;&#x63A5;&#x6536;&#x7684;&#x6700;&#x5927;HTTP&#x8FDE;&#x63A5;&#x6570;&#xFF0C;&#x9632;&#x6B62;REST server&#x88AB;&#x8FC7;&#x591A;&#x8FDE;&#x63A5;&#x6491;&#x7206;&#xFF0C;&#x4EE5;&#x4F5C;&#x4E3A;&#x4E00;&#x79CD;&#x6700;&#x57FA;&#x672C;&#x7684;&#x81EA;&#x6211;&#x4FDD;&#x62A4;&#x673A;&#x5236;&#xFF1A;</span><br><span class="line">        &lt;dubbo:protocol name=&quot;rest&quot; accepts=&quot;500&quot; server=&quot;tomcat/&gt;</span><br><span class="line">        &#x6CE8;&#x610F;&#xFF1A;&#x8FD9;&#x4E2A;&#x914D;&#x7F6E;&#x76EE;&#x524D;&#x53EA;&#x5BF9;server=&quot;tomcat&quot;&#x624D;&#x80FD;&#x751F;&#x6548;&#x3002;</span><br><span class="line"> </span><br><span class="line">        6. &#x5982;&#x679C;rest&#x670D;&#x52A1;&#x7684;&#x6D88;&#x8D39;&#x7AEF;&#x4E5F;&#x662F;dubbo&#x7CFB;&#x7EDF;&#xFF0C;&#x53EF;&#x4EE5;&#x50CF;&#x5176;&#x4ED6;dubbo RPC&#x673A;&#x5236;&#x4E00;&#x6837;&#xFF0C;&#x914D;&#x7F6E;&#x6D88;&#x8D39;&#x7AEF;&#x8C03;&#x7528;&#x6B64;rest&#x670D;&#x52A1;&#x7684;&#x6700;&#x5927;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#x4EE5;&#x53CA;&#x6BCF;&#x4E2A;&#x6D88;&#x8D39;&#x7AEF;&#x6240;&#x80FD;&#x542F;&#x52A8;&#x7684;&#x6700;&#x5927;HTTP&#x8FDE;&#x63A5;&#x6570;&#x3002;</span><br><span class="line">        &lt;dubbo:service interface=&quot;xxx&quot; ref=&quot;xxx&quot; protocol=&quot;rest&quot; timeout=&quot;2000&quot; connections=&quot;10&quot;/&gt;</span><br><span class="line">        &#x5F53;&#x7136;&#xFF0C;&#x7531;&#x4E8E;&#x8FD9;&#x4E2A;&#x914D;&#x7F6E;&#x9488;&#x5BF9;&#x6D88;&#x8D39;&#x7AEF;&#x751F;&#x6548;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x4E5F;&#x53EF;&#x4EE5;&#x5728;&#x6D88;&#x8D39;&#x7AEF;&#x914D;&#x7F6E;&#xFF1A;</span><br><span class="line">        &lt;dubbo:reference id=&quot;xxx&quot; interface=&quot;xxx&quot; timeout=&quot;2000&quot; connections=&quot;10&quot;/&gt;</span><br><span class="line">        &#x4F46;&#x662F;&#xFF0C;&#x901A;&#x5E38;&#x6211;&#x4EEC;&#x5EFA;&#x8BAE;&#x914D;&#x7F6E;&#x5728;&#x670D;&#x52A1;&#x63D0;&#x4F9B;&#x7AEF;&#x63D0;&#x4F9B;&#x6B64;&#x7C7B;&#x914D;&#x7F6E;&#x3002;&#x6309;&#x7167;dubbo&#x5B98;&#x65B9;&#x6587;&#x6863;&#x7684;&#x8BF4;&#x6CD5;&#xFF1A;&#x201C;Provider&#x4E0A;&#x5C3D;&#x91CF;&#x591A;&#x914D;&#x7F6E;Consumer&#x7AEF;&#x7684;&#x5C5E;&#x6027;&#xFF0C;&#x8BA9;Provider&#x5B9E;&#x73B0;&#x8005;&#x4E00;&#x5F00;&#x59CB;&#x5C31;&#x601D;&#x8003;Provider&#x670D;&#x52A1;&#x7279;&#x70B9;&#x3001;&#x670D;&#x52A1;&#x8D28;&#x91CF;&#x7684;&#x95EE;&#x9898;&#x3002;&#x201D;</span><br><span class="line">        &#x6CE8;&#x610F;&#xFF1A;&#x5982;&#x679C;dubbo&#x7684;REST&#x670D;&#x52A1;&#x662F;&#x53D1;&#x5E03;&#x7ED9;&#x975E;dubbo&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x4F7F;&#x7528;&#xFF0C;&#x5219;&#x8FD9;&#x91CC;&lt;dubbo:service/&gt;&#x4E0A;&#x7684;&#x914D;&#x7F6E;&#x5B8C;&#x5168;&#x65E0;&#x6548;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x79CD;&#x5BA2;&#x6237;&#x7AEF;&#x4E0D;&#x53D7;dubbo&#x63A7;&#x5236;&#x3002;</span><br><span class="line"></span><br><span class="line">        7. Dubbo&#x7684;REST&#x652F;&#x6301;&#x7528;GZIP&#x538B;&#x7F29;&#x8BF7;&#x6C42;&#x548C;&#x54CD;&#x5E94;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x4EE5;&#x51CF;&#x5C11;&#x7F51;&#x7EDC;&#x4F20;&#x8F93;&#x65F6;&#x95F4;&#x548C;&#x5E26;&#x5BBD;&#x5360;&#x7528;&#xFF0C;&#x4F46;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x4F1A;&#x4E5F;&#x589E;&#x52A0;CPU&#x5F00;&#x9500;&#x3002;</span><br><span class="line">     --&gt;</span><br><span class="line"></span><br><span class="line">     &lt;!--</span><br><span class="line">        1. use tomcat server</span><br><span class="line">        2. &#x7528;rest&#x534F;&#x8BAE;&#x5728;8888&#x7AEF;&#x53E3;&#x66B4;&#x9732;&#x670D;&#x52A1;</span><br><span class="line">        3. Dubbo&#x7684;REST&#x4E5F;&#x652F;&#x6301;JAX-RS&#x6807;&#x51C6;&#x7684;Filter&#x548C;Interceptor&#xFF0C;&#x4EE5;&#x65B9;&#x4FBF;&#x5BF9;REST&#x7684;&#x8BF7;&#x6C42;&#x4E0E;&#x54CD;&#x5E94;&#x8FC7;&#x7A0B;&#x505A;&#x5B9A;&#x5236;&#x5316;&#x7684;&#x62E6;&#x622A;&#x5904;&#x7406;&#x3002;</span><br><span class="line">           &#x5176;&#x4E2D;&#xFF0C;Filter&#x4E3B;&#x8981;&#x7528;&#x4E8E;&#x8BBF;&#x95EE;&#x548C;&#x8BBE;&#x7F6E;HTTP&#x8BF7;&#x6C42;&#x548C;&#x54CD;&#x5E94;&#x7684;&#x53C2;&#x6570;&#x3001;URI&#x7B49;&#x7B49;&#x3002;&#x5982;:CacheControlFilter.java</span><br><span class="line">           Interceptor&#x4E3B;&#x8981;&#x7528;&#x4E8E;&#x8BBF;&#x95EE;&#x548C;&#x4FEE;&#x6539;&#x8F93;&#x5165;&#x4E0E;&#x8F93;&#x51FA;&#x5B57;&#x8282;&#x6D41;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;&#x624B;&#x52A8;&#x6DFB;&#x52A0;GZIP&#x538B;&#x7F29;.&#x5982;:GZIPWriterInterceptor.java</span><br><span class="line">        4. &#x5728;&#x6807;&#x51C6;JAX-RS&#x5E94;&#x7528;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4E00;&#x822C;&#x662F;&#x4E3A;Filter&#x548C;Interceptor&#x6DFB;&#x52A0;@Provider annotation&#xFF0C;&#x7136;&#x540E;JAX-RS runtime&#x4F1A;</span><br><span class="line">           &#x81EA;&#x52A8;&#x53D1;&#x73B0;&#x5E76;&#x542F;&#x7528;&#x5B83;&#x4EEC;&#x3002;&#x800C;&#x5728;dubbo&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x662F;&#x901A;&#x8FC7;&#x6DFB;&#x52A0;XML&#x914D;&#x7F6E;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x6CE8;&#x518C;Filter&#x548C;Interceptor.</span><br><span class="line">        5. &#x5728;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5C06;Filter&#x3001;Interceptor&#x548C;DynamicFuture&#x8FD9;&#x4E09;&#x79CD;&#x7C7B;&#x578B;&#x7684;&#x5BF9;&#x8C61;&#x90FD;&#x6DFB;&#x52A0;&#x5230;extension&#x5C5E;&#x6027;&#x4E0A;&#xFF0C;&#x591A;&#x4E2A;&#x4E4B;&#x95F4;&#x7528;&#x9017;&#x53F7;&#x5206;&#x9694;&#x3002;&#xFF08;DynamicFuture&#x662F;&#x53E6;&#x4E00;&#x4E2A;&#x63A5;&#x53E3;&#xFF0C;&#x53EF;&#x4EE5;&#x65B9;&#x4FBF;&#x6211;&#x4EEC;&#x66F4;&#x52A8;&#x6001;&#x7684;&#x542F;&#x7528;Filter&#x548C;Interceptor&#xFF0C;&#x611F;&#x5174;&#x8DA3;&#x8BF7;&#x81EA;&#x884C;google&#x3002;&#xFF09;</span><br><span class="line">        6. &#x5F53;&#x7136;&#xFF0C;dubbo&#x81EA;&#x8EAB;&#x4E5F;&#x652F;&#x6301;Filter&#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x4F46;&#x6211;&#x4EEC;&#x8FD9;&#x91CC;&#x8BA8;&#x8BBA;&#x7684;Filter&#x548C;Interceptor&#x66F4;&#x52A0;&#x63A5;&#x8FD1;&#x534F;&#x8BAE;&#x5B9E;&#x73B0;&#x7684;&#x5E95;&#x5C42;&#xFF0C;</span><br><span class="line">        &#x76F8;&#x6BD4;dubbo&#x7684;filter&#xFF0C;&#x53EF;&#x4EE5;&#x505A;&#x66F4;&#x5E95;&#x5C42;&#x7684;&#x5B9A;&#x5236;&#x5316;&#x3002;</span><br><span class="line">        &#x6CE8;&#xFF1A;&#x8FD9;&#x91CC;&#x7684;XML&#x5C5E;&#x6027;&#x53EB;extension&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x53EB;interceptor&#x6216;&#x8005;filter&#xFF0C;&#x662F;&#x56E0;&#x4E3A;&#x9664;&#x4E86;Interceptor&#x548C;Filter&#xFF0C;&#x672A;&#x6765;&#x6211;&#x4EEC;</span><br><span class="line">        &#x8FD8;&#x4F1A;&#x6DFB;&#x52A0;&#x66F4;&#x591A;&#x7684;&#x6269;&#x5C55;&#x7C7B;&#x578B;&#x3002;</span><br><span class="line">        7. &#x5982;&#x679C;REST&#x7684;&#x6D88;&#x8D39;&#x7AEF;&#x4E5F;&#x662F;dubbo&#x7CFB;&#x7EDF;&#xFF08;&#x53C2;&#x89C1;&#x4E0B;&#x6587;&#x7684;&#x8BA8;&#x8BBA;&#xFF09;&#xFF0C;&#x5219;&#x4E5F;&#x53EF;&#x4EE5;&#x7528;&#x7C7B;&#x4F3C;&#x65B9;&#x5F0F;&#x4E3A;&#x6D88;&#x8D39;&#x7AEF;&#x914D;&#x7F6E;Interceptor&#x548C;Filter&#x3002;&#x4F46;&#x6CE8;</span><br><span class="line">        &#x610F;&#xFF0C;JAX-RS&#x4E2D;&#x6D88;&#x8D39;&#x7AEF;&#x7684;Filter&#x548C;&#x63D0;&#x4F9B;&#x7AEF;&#x7684;Filter&#x662F;&#x4E24;&#x79CD;&#x4E0D;&#x540C;&#x7684;&#x63A5;&#x53E3;&#x3002;&#x4F8B;&#x5982;&#x524D;&#x9762;&#x4F8B;&#x5B50;&#x4E2D;&#x670D;&#x52A1;&#x7AEF;&#x662F;ContainerResponseFilter&#x63A5;&#x53E3;&#xFF0C;</span><br><span class="line">        &#x800C;&#x6D88;&#x8D39;&#x7AEF;&#x5BF9;&#x5E94;&#x7684;&#x662F;ClientResponseFilter.</span><br><span class="line">        8. Dubbo&#x7684;REST&#x4E5F;&#x652F;&#x6301;JAX-RS&#x6807;&#x51C6;&#x7684;ExceptionMapper&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x6765;&#x5B9A;&#x5236;&#x7279;&#x5B9A;exception&#x53D1;&#x751F;&#x540E;&#x5E94;&#x8BE5;&#x8FD4;&#x56DE;&#x7684;HTTP&#x54CD;&#x5E94;&#x3002;</span><br><span class="line">        9. Dubbo rest&#x652F;&#x6301;&#x8F93;&#x51FA;&#x6240;&#x6709;HTTP&#x8BF7;&#x6C42;/&#x54CD;&#x5E94;&#x4E2D;&#x7684;header&#x5B57;&#x6BB5;&#x548C;body&#x6D88;&#x606F;&#x4F53;&#x3002;LoggingFilter</span><br><span class="line">     --&gt;</span><br><span class="line">     &lt;dubbo:protocol name=&quot;rest&quot; port=&quot;8888&quot; threads=&quot;500&quot; contextpath=&quot;services&quot; server=&quot;tomcat&quot; accepts=&quot;500&quot;</span><br><span class="line">                 extension=&quot;com.alibaba.dubbo.demo.extension.TraceInterceptor,</span><br><span class="line">                 com.alibaba.dubbo.demo.extension.TraceFilter,</span><br><span class="line">                 com.alibaba.dubbo.demo.extension.ClientTraceFilter,</span><br><span class="line">                 com.alibaba.dubbo.demo.extension.DynamicTraceBinding,</span><br><span class="line">                 com.alibaba.dubbo.demo.extension.CustomExceptionMapper,</span><br><span class="line">                 com.alibaba.dubbo.rpc.protocol.rest.support.LoggingFilter&quot;/&gt;</span><br><span class="line"></span><br><span class="line">     &lt;!--</span><br><span class="line">        use the external tomcat or other server with the servlet approach; the port and contextpath must be exactly the same as those in external server</span><br><span class="line">        &lt;dubbo:protocol name=&quot;rest&quot; port=&quot;8888&quot; contextpath=&quot;services&quot; server=&quot;servlet&quot;/&gt;</span><br><span class="line">     --&gt;</span><br><span class="line"> </span><br><span class="line">     &lt;dubbo:protocol name=&quot;http&quot; port=&quot;8889&quot;/&gt;</span><br><span class="line">     &lt;dubbo:protocol name=&quot;hessian&quot; port=&quot;8890&quot;/&gt;</span><br><span class="line">     &lt;dubbo:protocol name=&quot;webservice&quot; port=&quot;8892&quot;/&gt;</span><br><span class="line">  </span><br><span class="line">     &lt;!-- &#x58F0;&#x660E;&#x9700;&#x8981;&#x66B4;&#x9732;&#x7684;&#x670D;&#x52A1;&#x63A5;&#x53E3; --&gt;</span><br><span class="line">     &lt;dubbo:service interface=&quot;com.alibaba.dubbo.demo.user.UserService&quot; ref=&quot;userService&quot; protocol=&quot;dubbo&quot; group=&quot;xmlConfig&quot;/&gt;</span><br><span class="line"> </span><br><span class="line">     &lt;!--</span><br><span class="line">        1. &#x4E3A;&#x4E86;&#x548C;&#x5176;&#x4ED6;dubbo&#x8FDC;&#x7A0B;&#x8C03;&#x7528;&#x534F;&#x8BAE;&#x4FDD;&#x6301;&#x4E00;&#x81F4;&#xFF0C;&#x5728;rest&#x4E2D;&#x4F5C;&#x6821;&#x9A8C;&#x7684;annotation&#x5FC5;&#x987B;&#x653E;&#x5728;&#x670D;&#x52A1;&#x7684;&#x63A5;&#x53E3;&#x4E0A;,</span><br><span class="line">        &#x628A;annotation&#x653E;&#x5728;&#x63A5;&#x53E3;&#x4E0A;&#x81F3;&#x5C11;&#x6709;&#x4E00;&#x4E2A;&#x597D;&#x5904;&#x662F;&#xFF0C;dubbo&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x53EF;&#x4EE5;&#x5171;&#x4EAB;&#x8FD9;&#x4E2A;&#x63A5;&#x53E3;&#x7684;&#x4FE1;&#x606F;&#xFF0C;dubbo&#x751A;</span><br><span class="line">        &#x81F3;&#x4E0D;&#x9700;&#x8981;&#x505A;&#x8FDC;&#x7A0B;&#x8C03;&#x7528;&#xFF0C;&#x5728;&#x672C;&#x5730;&#x5C31;&#x53EF;&#x4EE5;&#x5B8C;&#x6210;&#x8F93;&#x5165;&#x6821;&#x9A8C;&#x3002;</span><br><span class="line"></span><br><span class="line">        &#x7136;&#x540E;&#x6309;&#x7167;dubbo&#x7684;&#x6807;&#x51C6;&#x65B9;&#x5F0F;&#x5728;XML&#x914D;&#x7F6E;&#x4E2D;&#x6253;&#x5F00;&#x9A8C;&#x8BC1;&#xFF1A;</span><br><span class="line">        &lt;dubbo:service interface=xxx.UserService&quot; ref=&quot;userService&quot; protocol=&quot;rest&quot; validation=&quot;true&quot;/&gt;</span><br><span class="line"></span><br><span class="line">        2. &#x5728;dubbo&#x7684;&#x5176;&#x4ED6;&#x5F88;&#x591A;&#x8FDC;&#x7A0B;&#x8C03;&#x7528;&#x534F;&#x8BAE;&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x8F93;&#x5165;&#x9A8C;&#x8BC1;&#x51FA;&#x9519;&#xFF0C;&#x662F;&#x76F4;&#x63A5;&#x5C06;RpcException&#x629B;&#x5411;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x800C;&#x5728;rest&#x4E2D;&#x7531;&#x4E8E;&#x5BA2;&#x6237;&#x7AEF;&#x7ECF;&#x5E38;&#x662F;&#x975E;dubbo&#xFF0C;&#x751A;&#x81F3;&#x975E;java&#x7684;&#x7CFB;&#x7EDF;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x4FBF;&#x76F4;&#x63A5;&#x629B;&#x51FA;Java&#x5F02;&#x5E38;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x76EE;&#x524D;&#x6211;&#x4EEC;&#x5C06;&#x6821;&#x9A8C;&#x9519;&#x8BEF;&#x4EE5;XML&#x7684;&#x683C;&#x5F0F;&#x8FD4;&#x56DE;&#xFF1A;</span><br><span class="line">        &lt;violationReport&gt;</span><br><span class="line">            &lt;constraintViolations&gt;</span><br><span class="line">                &lt;path&gt;getUserArgument0&lt;/path&gt;</span><br><span class="line">                &lt;message&gt;User ID must be greater than 1&lt;/message&gt;</span><br><span class="line">                &lt;value&gt;0&lt;/value&gt;</span><br><span class="line">            &lt;/constraintViolations&gt;</span><br><span class="line">        &lt;/violationReport&gt;</span><br><span class="line"> </span><br><span class="line">        &#x5982;&#x679C;&#x4F60;&#x8BA4;&#x4E3A;&#x9ED8;&#x8BA4;&#x7684;&#x6821;&#x9A8C;&#x9519;&#x8BEF;&#x8FD4;&#x56DE;&#x683C;&#x5F0F;&#x4E0D;&#x7B26;&#x5408;&#x4F60;&#x7684;&#x8981;&#x6C42;&#xFF0C;&#x53EF;&#x4EE5;&#x5982;&#x4E0A;&#x9762;&#x7AE0;&#x8282;&#x6240;&#x8FF0;&#xFF0C;&#x6DFB;&#x52A0;&#x81EA;&#x5B9A;&#x4E49;&#x7684;ExceptionMapper&#x6765;&#x81EA;&#x7531;&#x7684;&#x5B9A;&#x5236;&#x9519;&#x8BEF;&#x8FD4;&#x56DE;&#x683C;&#x5F0F;&#x3002;</span><br><span class="line">        &#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x8FD9;&#x4E2A;ExceptionMapper&#x5FC5;&#x987B;&#x7528;&#x6CDB;&#x578B;&#x58F0;&#x660E;&#x6765;&#x6355;&#x83B7;dubbo&#x7684;RpcException&#xFF0C;&#x624D;&#x80FD;&#x6210;&#x529F;&#x8986;&#x76D6;dubbo rest&#x9ED8;&#x8BA4;&#x7684;&#x5F02;&#x5E38;&#x5904;&#x7406;&#x7B56;&#x7565;&#x3002;</span><br><span class="line">        &#x4E3A;&#x4E86;&#x7B80;&#x5316;&#x64CD;&#x4F5C;&#xFF0C;&#x5176;&#x5B9E;&#x8FD9;&#x91CC;&#x6700;&#x7B80;&#x5355;&#x7684;&#x65B9;&#x5F0F;&#x662F;&#x76F4;&#x63A5;&#x7EE7;&#x627F;dubbo rest&#x7684;RpcExceptionMapper&#xFF0C;&#x5E76;&#x8986;&#x76D6;&#x5176;&#x4E2D;&#x5904;&#x7406;&#x6821;&#x9A8C;&#x5F02;&#x5E38;&#x7684;&#x65B9;&#x6CD5;&#x5373;&#x53EF;.</span><br><span class="line">     --&gt;</span><br><span class="line">     &lt;dubbo:service interface=&quot;com.alibaba.dubbo.demo.user.facade.AnotherUserRestService&quot; ref=&quot;anotherUserRestService&quot; protocol=&quot;rest&quot; timeout=&quot;2000&quot; connections=&quot;100&quot; validation=&quot;true&quot;/&gt;</span><br><span class="line">  </span><br><span class="line">     &lt;bean id=&quot;userService&quot; class=&quot;com.alibaba.dubbo.demo.user.UserServiceImpl&quot;/&gt;</span><br><span class="line"> </span><br><span class="line">     &lt;bean id=&quot;anotherUserRestService&quot; class=&quot;com.alibaba.dubbo.demo.user.facade.AnotherUserRestServiceImpl&quot;&gt;</span><br><span class="line">         &lt;property name=&quot;userService&quot; ref=&quot;userService&quot;/&gt;</span><br><span class="line">     &lt;/bean&gt;</span><br><span class="line"> </span><br><span class="line">     &lt;!--</span><br><span class="line">        &#x5BF9;&#x4E8E;jax-rs&#x548C;spring mvc&#xFF0C;&#x5176;&#x5B9E;&#x6211;&#x5BF9;spring mvc&#x7684;rest&#x652F;&#x6301;&#x8FD8;&#x6CA1;&#x6709;&#x592A;&#x6DF1;&#x5165;&#x7684;&#x770B;&#x8FC7;&#xFF0C;&#x8BF4;&#x70B9;&#x521D;&#x6B65;&#x60F3;&#x6CD5;&#xFF0C;&#x8BF7;&#x5927;&#x5BB6;&#x6307;&#x6B63;&#xFF1A;</span><br><span class="line"> </span><br><span class="line">        spring mvc&#x4E5F;&#x652F;&#x6301;annotation&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x5176;&#x5B9E;&#x548C;jax-rs&#x770B;&#x8D77;&#x6765;&#x662F;&#x975E;&#x5E38;&#x975E;&#x5E38;&#x7C7B;&#x4F3C;&#x7684;&#x3002;</span><br><span class="line"> </span><br><span class="line">        &#x6211;&#x4E2A;&#x4EBA;&#x8BA4;&#x4E3A;spring mvc&#x76F8;&#x5BF9;&#x66F4;&#x9002;&#x5408;&#x4E8E;&#x9762;&#x5411;web&#x5E94;&#x7528;&#x7684;restful&#x670D;&#x52A1;&#xFF0C;&#x6BD4;&#x5982;&#x88AB;AJAX&#x8C03;&#x7528;&#xFF0C;&#x4E5F;&#x53EF;&#x80FD;&#x8F93;&#x51FA;HTML&#x4E4B;&#x7C7B;&#x7684;&#xFF0C;&#x5E94;&#x7528;&#x4E2D;&#x8FD8;</span><br><span class="line">        &#x6709;&#x9875;&#x9762;&#x8DF3;&#x8F6C;&#x6D41;&#x7A0B;&#x4E4B;&#x7C7B;&#xFF0C;spring mvc&#x65E2;&#x53EF;&#x4EE5;&#x505A;&#x597D;&#x6B63;&#x5E38;&#x7684;web&#x9875;&#x9762;&#x8BF7;&#x6C42;&#x4E5F;&#x53EF;&#x4EE5;&#x540C;&#x65F6;&#x5904;&#x7406;rest&#x8BF7;&#x6C42;&#x3002;&#x4F46;&#x603B;&#x7684;&#x6765;&#x8BF4;&#x8FD9;&#x4E2A;restful&#x670D;&#x52A1;</span><br><span class="line">        &#x662F;&#x5728;&#x5C55;&#x73B0;&#x5C42;&#x6216;&#x8005;&#x53EB;web&#x5C42;&#x4E4B;&#x7C7B;&#x5B9E;&#x73B0;&#x7684;</span><br><span class="line"></span><br><span class="line">        &#x800C;jax-rs&#x76F8;&#x5BF9;&#x66F4;&#x9002;&#x5408;&#x7EAF;&#x7CB9;&#x7684;&#x670D;&#x52A1;&#x5316;&#x5E94;&#x7528;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x4F20;&#x7EDF;Java EE&#x4E2D;&#x6240;&#x8BF4;&#x7684;&#x4E2D;&#x95F4;&#x5C42;&#x670D;&#x52A1;&#xFF0C;&#x6BD4;&#x5982;&#x5B83;&#x53EF;&#x4EE5;&#x628A;&#x4F20;&#x7EDF;&#x7684;EJB&#x53D1;&#x5E03;&#x6210;restful</span><br><span class="line">        &#x670D;&#x52A1;&#x3002;&#x5728;spring&#x5E94;&#x7528;&#x4E2D;&#xFF0C;&#x4E5F;&#x5C31;&#x628A;spring&#x4E2D;&#x5145;&#x5F53;service&#x4E4B;&#x7C7B;&#x7684;bean&#x76F4;&#x63A5;&#x53D1;&#x5E03;&#x6210;restful&#x670D;&#x52A1;&#x3002;&#x603B;&#x7684;&#x6765;&#x8BF4;&#x8FD9;&#x4E2A;restful&#x670D;&#x52A1;&#x662F;</span><br><span class="line">        &#x5728;&#x4E1A;&#x52A1;&#x3001;&#x5E94;&#x7528;&#x5C42;&#x6216;&#x8005;facade&#x5C42;&#x3002;&#x800C;MVC&#x5C42;&#x6B21;&#x548C;&#x6982;&#x5FF5;&#x5728;&#x8FD9;&#x79CD;&#x505A;&#x6BD4;&#x5982;&#xFF08;&#x540E;&#x53F0;&#xFF09;&#x670D;&#x52A1;&#x5316;&#x7684;&#x5E94;&#x7528;&#x4E2D;&#x901A;&#x5E38;&#x662F;&#x6CA1;&#x6709;&#x591A;&#x5927;&#x4EF7;&#x503C;&#x7684;&#x3002;</span><br><span class="line"></span><br><span class="line">        &#x5F53;&#x7136;jax-rs&#x7684;&#x6709;&#x4E9B;&#x5B9E;&#x73B0;&#x6BD4;&#x5982;jersey&#xFF0C;&#x4E5F;&#x8BD5;&#x56FE;&#x63D0;&#x4F9B;mvc&#x652F;&#x6301;&#xFF0C;&#x4EE5;&#x66F4;&#x597D;&#x7684;&#x9002;&#x5E94;&#x4E0A;&#x9762;&#x6240;&#x8BF4;&#x7684;web&#x5E94;&#x7528;&#xFF0C;&#x4F46;&#x5E94;&#x8BE5;&#x662F;&#x4E0D;&#x5982;spring mvc&#x3002;</span><br><span class="line"></span><br><span class="line">        &#x5728;dubbo&#x5E94;&#x7528;&#x4E2D;&#xFF0C;&#x6211;&#x60F3;&#x5F88;&#x591A;&#x4EBA;&#x90FD;&#x6BD4;&#x8F83;&#x559C;&#x6B22;&#x76F4;&#x63A5;&#x5C06;&#x4E00;&#x4E2A;&#x672C;&#x5730;&#x7684;spring service bean&#xFF08;&#x6216;&#x8005;&#x53EB;manager&#x4E4B;&#x7C7B;&#x7684;&#xFF09;&#x5B8C;&#x5168;&#x900F;&#x660E;&#x7684;&#x53D1;&#x5E03;</span><br><span class="line">        &#x6210;&#x8FDC;&#x7A0B;&#x670D;&#x52A1;&#xFF0C;&#x5219;&#x8FD9;&#x91CC;&#x7528;JAX-RS&#x662F;&#x66F4;&#x81EA;&#x7136;&#x66F4;&#x76F4;&#x63A5;&#x7684;&#xFF0C;&#x4E0D;&#x5FC5;&#x989D;&#x5916;&#x7684;&#x5F15;&#x5165;MVC&#x6982;&#x5FF5;&#x3002;&#x5F53;&#x7136;&#xFF0C;&#x5148;&#x4E0D;&#x8BA8;&#x8BBA;&#x900F;&#x660E;&#x53D1;&#x5E03;&#x8FDC;&#x7A0B;&#x670D;&#x52A1;&#x662F;&#x4E0D;&#x662F;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;&#xFF0C;</span><br><span class="line">        &#x8981;&#x4E0D;&#x8981;&#x6DFB;&#x52A0;facade&#x4E4B;&#x7C7B;&#x3002;</span><br><span class="line"></span><br><span class="line">        &#x5F53;&#x7136;&#xFF0C;&#x6211;&#x77E5;&#x9053;&#x5728;dubbo&#x4E0D;&#x652F;&#x6301;rest&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5F88;&#x591A;&#x670B;&#x53CB;&#x91C7;&#x7528;&#x7684;&#x67B6;&#x6784;&#x662F;spring mvc restful&#x8C03;&#x7528;dubbo (spring) service</span><br><span class="line">        &#x6765;&#x53D1;&#x5E03;restful&#x670D;&#x52A1;&#x7684;&#x3002;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x6211;&#x89C9;&#x5F97;&#x4E5F;&#x975E;&#x5E38;&#x597D;&#xFF0C;&#x53EA;&#x662F;&#x5982;&#x679C;&#x4E0D;&#x4FEE;&#x6539;spring mvc&#x5E76;&#x5C06;&#x5176;&#x4E0E;dubbo&#x6DF1;&#x5EA6;&#x96C6;&#x6210;&#xFF0C;restful&#x670D;&#x52A1;&#x4E0D;&#x80FD;</span><br><span class="line">        &#x50CF;dubbo&#x4E2D;&#x7684;&#x5176;&#x4ED6;&#x8FDC;&#x7A0B;&#x8C03;&#x7528;&#x534F;&#x8BAE;&#x6BD4;&#x5982;webservices&#x3001;dubbo rpc&#x3001;hessian&#x7B49;&#x7B49;&#x90A3;&#x6837;&#xFF0C;&#x4EAB;&#x53D7;&#x8BF8;&#x591A;&#x9AD8;&#x7EA7;&#x7684;&#x670D;&#x52A1;&#x6CBB;&#x7406;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;</span><br><span class="line">        &#x6CE8;&#x518C;&#x5230;dubbo&#x7684;&#x670D;&#x52A1;&#x6CE8;&#x518C;&#x4E2D;&#x5FC3;&#xFF0C;&#x901A;&#x8FC7;dubbo&#x76D1;&#x63A7;&#x4E2D;&#x5FC3;&#x76D1;&#x63A7;&#x5176;&#x8C03;&#x7528;&#x6B21;&#x6570;&#x3001;TPS&#x3001;&#x54CD;&#x5E94;&#x65F6;&#x95F4;&#x4E4B;&#x7C7B;&#xFF0C;&#x901A;&#x8FC7;dubbo&#x7684;&#x7EDF;&#x4E00;&#x7684;&#x914D;&#x7F6E;&#x65B9;&#x5F0F;&#x63A7;&#x5236;&#x5176;</span><br><span class="line">        &#x6BD4;&#x5982;&#x7EBF;&#x7A0B;&#x6C60;&#x5927;&#x5C0F;&#x3001;&#x6700;&#x5927;&#x8FDE;&#x63A5;&#x6570;&#x7B49;&#x7B49;&#xFF0C;&#x901A;&#x8FC7;dubbo&#x7EDF;&#x4E00;&#x65B9;&#x5F0F;&#x505A;&#x670D;&#x52A1;&#x6D41;&#x91CF;&#x63A7;&#x5236;&#x3001;&#x6743;&#x9650;&#x63A7;&#x5236;&#x3001;&#x9891;&#x6B21;&#x63A7;&#x5236;&#x3002;&#x53E6;&#x5916;spring mvc&#x4EC5;&#x4EC5;&#x8D1F;&#x8D23;&#x670D;&#x52A1;</span><br><span class="line">        &#x7AEF;&#xFF0C;&#x800C;&#x5728;&#x6D88;&#x8D39;&#x7AEF;&#xFF0C;&#x901A;&#x5E38;&#x662F;&#x7528;spring restTemplate&#xFF0C;&#x5982;&#x679C;restTemplate&#x4E0D;&#x548C;dubbo&#x96C6;&#x6210;&#xFF0C;&#x6709;&#x53EF;&#x80FD;&#x50CF;dubbo&#x670D;&#x52A1;&#x5BA2;&#x6237;&#x7AEF;&#x90A3;&#x6837;&#x81EA;&#x52A8;</span><br><span class="line">        &#x6216;&#x8005;&#x4EBA;&#x5DE5;&#x5E72;&#x9884;&#x505A;&#x670D;&#x52A1;&#x964D;&#x7EA7;&#x3002;&#x5982;&#x679C;&#x670D;&#x52A1;&#x7AEF;&#x6D88;&#x8D39;&#x7AEF;&#x90FD;&#x662F;dubbo&#x7CFB;&#x7EDF;&#xFF0C;&#x901A;&#x8FC7;spring&#x7684;rest&#x4EA4;&#x4E92;&#xFF0C;&#x5982;&#x679C;spring rest&#x4E0D;&#x6DF1;&#x5EA6;&#x6574;&#x5408;dubbo&#xFF0C;</span><br><span class="line">        &#x5219;&#x4E0D;&#x80FD;&#x7528;dubbo&#x7EDF;&#x4E00;&#x7684;&#x8DEF;&#x7531;&#x5206;&#x6D41;&#x7B49;&#x529F;&#x80FD;&#x3002;</span><br><span class="line"></span><br><span class="line">        &#x5F53;&#x7136;&#xFF0C;&#x5176;&#x5B9E;&#x6211;&#x4E2A;&#x4EBA;&#x8BA4;&#x4E3A;&#x8FD9;&#x4E9B;&#x4E1C;&#x897F;&#x4E0D;&#x5FC5;&#x8981;&#x975E;&#x6B64;&#x5373;&#x5F7C;&#x7684;&#x3002;&#x6211;&#x542C;&#x8BF4;spring&#x521B;&#x59CB;&#x4EBA;rod johnson&#x603B;&#x662F;&#x7231;&#x8BF4;&#x4E00;&#x53E5;&#x8BDD;&#xFF0C;</span><br><span class="line">        the customer is always right&#xFF0C;&#x5176;&#x5B9E;&#x4E0E;&#x5176;&#x975E;&#x8981;&#x63A2;&#x8BA8;&#x54EA;&#x79CD;&#x65B9;&#x5F0F;&#x66F4;&#x597D;&#xFF0C;&#x4E0D;&#x5982;&#x540C;&#x65F6;&#x652F;&#x6301;&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#x5C31;&#x662F;&#x4E86;&#xFF0C;</span><br><span class="line">        &#x6240;&#x4EE5;&#x539F;&#x6765;&#x5728;&#x6587;&#x6863;&#x4E2D;&#x4E5F;&#x5199;&#x8FC7;&#x8BA1;&#x5212;&#x652F;&#x6301;spring rest annoation&#xFF0C;&#x53EA;&#x662F;&#x4E0D;&#x77E5;&#x9053;&#x5177;&#x4F53;&#x53EF;&#x884C;&#x6027;&#x6709;&#x591A;&#x9AD8;&#x3002;</span><br><span class="line"> </span><br><span class="line">        1. JAX-RS&#x4E2D;&#x91CD;&#x8F7D;&#x7684;&#x65B9;&#x6CD5;&#x80FD;&#x591F;&#x6620;&#x5C04;&#x5230;&#x540C;&#x4E00;URL&#x5730;&#x5740;&#x5417;&#xFF1F;</span><br><span class="line">        http://stackoverflow.com/questions/17196766/can-resteasy-choose-method-based-on-query-params</span><br><span class="line"> </span><br><span class="line">        2. JAX-RS&#x4E2D;&#x4F5C;POST&#x7684;&#x65B9;&#x6CD5;&#x80FD;&#x591F;&#x63A5;&#x6536;&#x591A;&#x4E2A;&#x53C2;&#x6570;&#x5417;&#xFF1F;</span><br><span class="line">        http://stackoverflow.com/questions/5553218/jax-rs-post-multiple-objects</span><br><span class="line"> </span><br><span class="line">        &#x6CE8;:&#x4EE5;&#x4E0A;&#x5907;&#x6CE8;,&#x5747;&#x6765;&#x81EA;:https://dangdangdotcom.github.io/dubbox/rest.html</span><br><span class="line">     --&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li><strong>&#x914D;&#x7F6E;dubbo.properties</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;#dubbo.container=log4j,spring</span><br><span class="line">#dubbo.application.name=demo-provider</span><br><span class="line">#dubbo.application.owner=</span><br><span class="line">#dubbo.registry.address=multicast://224.5.6.7:1234</span><br><span class="line">#dubbo.registry.address=zookeeper://127.0.0.1:2181</span><br><span class="line">#dubbo.registry.address=redis://127.0.0.1:6379</span><br><span class="line">#dubbo.registry.address=dubbo://127.0.0.1:9090</span><br><span class="line">#dubbo.monitor.protocol=registry</span><br><span class="line">#dubbo.protocol.name=dubbo</span><br><span class="line">#dubbo.protocol.port=20880</span><br><span class="line">#dubbo.service.loadbalance=roundrobin</span><br><span class="line">#dubbo.log4j.file=logs/msa-demo-provider.log</span><br><span class="line">#dubbo.log4j.level=INFO</span><br><span class="line">#dubbo.log4j.subdirectory=20880</span><br><span class="line">dubbo.application.logger=slf4j</span><br><span class="line">dubbo.spring.config=classpath*:msa-*.xml</span><br></pre></td></tr></table></figure>

<h2 id="1-4-&#x670D;&#x52A1;&#x542F;&#x52A8;"><a href="#1-4-&#x670D;&#x52A1;&#x542F;&#x52A8;" class="headerlink" title="1.4 &#x670D;&#x52A1;&#x542F;&#x52A8;"></a>1.4 &#x670D;&#x52A1;&#x542F;&#x52A8;</h2><p><strong>&#x5B9A;&#x4E49;&#x670D;&#x52A1;&#x542F;&#x52A8;&#x7C7B;</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;package com.alibaba.dubbo.demo.provider;</span><br><span class="line">/**</span><br><span class="line">  * @author TaoBangren</span><br><span class="line">  * @version 1.0</span><br><span class="line">  * @since 2017/5/17 &#x4E0A;&#x5348;9:26</span><br><span class="line">  */</span><br><span class="line">public class DemoProvider {</span><br><span class="line">      public static void main(String[] args) {</span><br><span class="line">          com.alibaba.dubbo.container.Main.main(args);</span><br><span class="line">      }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><strong>&#x6267;&#x884C;main&#x65B9;&#x6CD5;&#x542F;&#x52A8;&#xFF0C;&#x770B;&#x5230;&#x4EE5;&#x4E0B;&#x65E5;&#x5FD7;&#x8F93;&#x51FA;&#x65F6;&#xFF0C;msa-demo-provider&#x542F;&#x52A8;&#x6210;&#x529F;&#xFF1A;</strong></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/8effc44047b444739288eb92b80daa00c37691725842621a33ec2e952cefe735" alt="msa-demo-provider&#x542F;&#x52A8;&#x6210;&#x529F;"></p>
<p><strong>&#x67E5;&#x770B;<a href="/external_links/5b2363a41448a9d25dc2cf86990764a8.html" target="blank" rel="noopener">DubboKeeper</a>&#x76D1;&#x63A7;&#x5927;&#x76D8;&#xFF0C;msa-demo-provider&#x53D1;&#x5E03;&#x670D;&#x52A1;&#x6210;&#x529F;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6211;&#x4EEC;&#x53D1;&#x5E03;&#x7684;&#x4E24;&#x4E2A;&#x63A5;&#x53E3;&#xFF1A;</strong></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/08a32aa85d5d148d4f64150a48bd41131541eb37e7beb97c5aa1a77d60a61670" alt="msa-demo-provider&#x53D1;&#x5E03;&#x670D;&#x52A1;&#x6210;&#x529F;"></p>
<ol start="2">
<li><h1 id="&#x5BA2;&#x6237;&#x7AEF;"><a href="#&#x5BA2;&#x6237;&#x7AEF;" class="headerlink" title="&#x5BA2;&#x6237;&#x7AEF;"></a>&#x5BA2;&#x6237;&#x7AEF;</h1></li>
</ol>
<ol>
<li><strong>&#x521B;&#x5EFA;Maven&#x6A21;&#x5757;&#xFF1A;msa-demo-client</strong></li>
</ol>
<p><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/2d8015965f51960934bfba767d82f5e256410748a173a14cda8ed0741c3542f0" alt="msa-demo-client"><br>2. <strong>msa-demo-client&#xFF1A;&#x914D;&#x7F6E;pom.xml</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;!-- Module&#x4F9D;&#x8D56; START --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">     &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">     &lt;artifactId&gt;msa-demo-api&lt;/artifactId&gt;</span><br><span class="line">     &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- Module&#x4F9D;&#x8D56; END --&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>Dubbox&#x4E0E;Spring&#x96C6;&#x6210;&#x914D;&#x7F6E;&#xFF1A;msa-demo-client.xml</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">    xmlns:dubbo=&quot;http://code.alibabatech.com/schema/dubbo&quot;</span><br><span class="line">    xsi:schemaLocation=&quot;</span><br><span class="line">    http://www.springframework.org/schema/beans</span><br><span class="line">    http://www.springframework.org/schema/beans/spring-beans-2.5.xsd</span><br><span class="line">    http://code.alibabatech.com/schema/dubbo</span><br><span class="line">    http://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line">   &lt;!-- &#x5F53;&#x524D;&#x5E94;&#x7528;&#x4FE1;&#x606F;&#x914D;&#x7F6E; --&gt;</span><br><span class="line">   &lt;!--&lt;dubbo:application name=&quot;msa-demo-client&quot; owner=&quot;shark&quot; organization=&quot;shark&quot;/&gt;--&gt;</span><br><span class="line"></span><br><span class="line">   &lt;!-- &#x591A;&#x6CE8;&#x518C;&#x4E2D;&#x5FC3;&#x914D;&#x7F6E;&#xFF0C;&#x7AD6;&#x53F7;&#x5206;&#x9694;&#x8868;&#x793A;&#x540C;&#x65F6;&#x8FDE;&#x63A5;&#x591A;&#x4E2A;&#x4E0D;&#x540C;&#x6CE8;&#x518C;&#x4E2D;&#x5FC3;&#xFF0C;&#x540C;&#x4E00;&#x6CE8;&#x518C;&#x4E2D;&#x5FC3;&#x7684;&#x591A;&#x4E2A;&#x96C6;&#x7FA4;&#x5730;&#x5740;&#x7528;&#x9017;&#x53F7;&#x5206;&#x9694; --&gt;</span><br><span class="line">   &lt;!--&lt;dubbo:registry protocol=&quot;zookeeper&quot; address=&quot;x.x.x.x:2181,x.x.x.x:2181,x.x.x.x:2181&quot;/&gt;--&gt;</span><br><span class="line">   &lt;!--&lt;dubbo:monitor address=&quot;x.x.x.x:20884&quot;/&gt;--&gt;</span><br><span class="line"> </span><br><span class="line">   &lt;dubbo:reference id=&quot;userService&quot; interface=&quot;com.alibaba.dubbo.demo.user.UserService&quot; group=&quot;xmlConfig&quot;/&gt;</span><br><span class="line">   &lt;dubbo:reference id=&quot;anotherUserRestService&quot; interface=&quot;com.alibaba.dubbo.demo.user.facade.AnotherUserRestService&quot;/&gt;</span><br><span class="line"></span><br><span class="line">   &lt;!--</span><br><span class="line">       directly connect to provider to simulate the access to non-dubbo rest services</span><br><span class="line">       &lt;dubbo:reference id=&quot;anotherUserRestService&quot; interface=&quot;com.alibaba.dubbo.demo.user.facade.AnotherUserRestService&quot; url=&quot;rest://localhost:8888/services/&quot;/&gt;</span><br><span class="line">   --&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><h1 id="&#x6D88;&#x8D39;&#x7AEF;"><a href="#&#x6D88;&#x8D39;&#x7AEF;" class="headerlink" title="&#x6D88;&#x8D39;&#x7AEF;"></a>&#x6D88;&#x8D39;&#x7AEF;</h1></li>
</ol>
<h2 id="3-1-&#x6D88;&#x8D39;&#x7AEF;&#x5B9E;&#x73B0;"><a href="#3-1-&#x6D88;&#x8D39;&#x7AEF;&#x5B9E;&#x73B0;" class="headerlink" title="3.1 &#x6D88;&#x8D39;&#x7AEF;&#x5B9E;&#x73B0;"></a>3.1 &#x6D88;&#x8D39;&#x7AEF;&#x5B9E;&#x73B0;</h2><ol>
<li><strong>&#x521B;&#x5EFA;Maven&#x6A21;&#x5757;&#xFF1A;msa-demo-consumer</strong></li>
</ol>
<p><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/e2f824ccdc2eea754ed9d908884cd5fc142115ca6dff9c144adbffbf4aebcfb9" alt="msa-demo-consumer"><br>2. <strong>msa-demo-consumer&#xFF1A;&#x914D;&#x7F6E;pom.xml</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;!-- Module&#x4F9D;&#x8D56; START --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;com.jeasy&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;msa-demo-client&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- Module&#x4F9D;&#x8D56; END --&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>&#x521B;&#x5EFA;&#x6D88;&#x8D39;&#x7AEF;&#x6D4B;&#x8BD5;&#x7C7B;&#xFF1A;DemoAction.java</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;package com.alibaba.dubbo.demo;</span><br><span class="line">import com.alibaba.dubbo.rpc.RpcContext;</span><br><span class="line">import com.alibaba.dubbo.demo.user.User;</span><br><span class="line">import com.alibaba.dubbo.demo.user.UserService;</span><br><span class="line">import com.alibaba.dubbo.demo.user.facade.AnotherUserRestService;</span><br><span class="line">/**</span><br><span class="line"> * @author TaoBangren</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @since 2017/5/17 &#x4E0A;&#x5348;9:26</span><br><span class="line"> */</span><br><span class="line">public class DemoAction {</span><br><span class="line"></span><br><span class="line">      private UserService userService;</span><br><span class="line"></span><br><span class="line">      private AnotherUserRestService anotherUserRestService;</span><br><span class="line"></span><br><span class="line">      public void setUserService(final UserService userService) {</span><br><span class="line">          this.userService = userService;</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      public void setAnotherUserRestService(final AnotherUserRestService anotherUserRestService) {</span><br><span class="line">          this.anotherUserRestService = anotherUserRestService;</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      public void start() throws Exception {</span><br><span class="line">          User user = new User();</span><br><span class="line">          user.setId(1L);</span><br><span class="line">          user.setName(&quot;larrypage&quot;);</span><br><span class="line"></span><br><span class="line">          System.out.println(&quot;SUCCESS: registered user with id by rest&quot; + anotherUserRestService.registerUser(user).getId());</span><br><span class="line">          System.out.println(&quot;SUCCESS: registered user with id &quot; + userService.registerUser(user));</span><br><span class="line"> </span><br><span class="line">          RpcContext.getContext().setAttachment(&quot;clientName&quot;, &quot;demo&quot;);</span><br><span class="line">          RpcContext.getContext().setAttachment(&quot;clientImpl&quot;, &quot;dubbox rest&quot;);</span><br><span class="line">          System.out.println(&quot;SUCCESS: got user by rest&quot; + anotherUserRestService.getUser(1L));</span><br><span class="line">          System.out.println(&quot;SUCCESS: got user &quot; + userService.getUser(1L));</span><br><span class="line">      }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><strong>Dubbox&#x4E0E;Spring&#x96C6;&#x6210;&#x914D;&#x7F6E;&#xFF1A;msa-demo-consumer.xml</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">    xmlns:dubbo=&quot;http://code.alibabatech.com/schema/dubbo&quot;</span><br><span class="line">    xsi:schemaLocation=&quot;</span><br><span class="line">    http://www.springframework.org/schema/beans</span><br><span class="line">    http://www.springframework.org/schema/beans/spring-beans-2.5.xsd</span><br><span class="line">    http://code.alibabatech.com/schema/dubbo</span><br><span class="line">    http://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line">   &lt;!-- &#x5F53;&#x524D;&#x5E94;&#x7528;&#x4FE1;&#x606F;&#x914D;&#x7F6E; --&gt;</span><br><span class="line">   &lt;dubbo:application name=&quot;msa-demo-consumer&quot; owner=&quot;tbr&quot; organization=&quot;tbr&quot;/&gt;</span><br><span class="line"></span><br><span class="line">   &lt;!-- &#x591A;&#x6CE8;&#x518C;&#x4E2D;&#x5FC3;&#x914D;&#x7F6E;&#xFF0C;&#x7AD6;&#x53F7;&#x5206;&#x9694;&#x8868;&#x793A;&#x540C;&#x65F6;&#x8FDE;&#x63A5;&#x591A;&#x4E2A;&#x4E0D;&#x540C;&#x6CE8;&#x518C;&#x4E2D;&#x5FC3;&#xFF0C;&#x540C;&#x4E00;&#x6CE8;&#x518C;&#x4E2D;&#x5FC3;&#x7684;&#x591A;&#x4E2A;&#x96C6;&#x7FA4;&#x5730;&#x5740;&#x7528;&#x9017;&#x53F7;&#x5206;&#x9694; --&gt;</span><br><span class="line">   &lt;dubbo:registry protocol=&quot;zookeeper&quot; address=&quot;x.x.x.x:2181,x.x.x.x:2181,x.x.x.x:2181&quot;/&gt;</span><br><span class="line">   &lt;dubbo:monitor address=&quot;x.x.x.x:20884&quot;/&gt;</span><br><span class="line"></span><br><span class="line">   &lt;bean class=&quot;com.alibaba.dubbo.demo.DemoAction&quot; init-method=&quot;start&quot;&gt;</span><br><span class="line">       &lt;property name=&quot;userService&quot; ref=&quot;userService&quot;/&gt;</span><br><span class="line">       &lt;property name=&quot;anotherUserRestService&quot; ref=&quot;anotherUserRestService&quot;/&gt;</span><br><span class="line">   &lt;/bean&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li><strong>&#x914D;&#x7F6E;dubbo.properties</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;#dubbo.container=log4j,spring</span><br><span class="line">#dubbo.application.name=demo-consumer</span><br><span class="line">#dubbo.application.owner=</span><br><span class="line">#dubbo.registry.address=multicast://224.5.6.7:1234</span><br><span class="line">#dubbo.registry.address=zookeeper://127.0.0.1:2181</span><br><span class="line">#dubbo.registry.address=redis://127.0.0.1:6379</span><br><span class="line">#dubbo.registry.address=dubbo://127.0.0.1:9090</span><br><span class="line">#dubbo.monitor.protocol=registry</span><br><span class="line">#dubbo.log4j.file=logs/msa-demo-consumer.log</span><br><span class="line">#dubbo.log4j.level=INFO</span><br><span class="line">dubbo.application.logger=slf4j</span><br><span class="line">dubbo.spring.config=classpath*:msa-*.xml</span><br></pre></td></tr></table></figure>

<h2 id="3-2-&#x6D88;&#x8D39;&#x7AEF;&#x6D4B;&#x8BD5;"><a href="#3-2-&#x6D88;&#x8D39;&#x7AEF;&#x6D4B;&#x8BD5;" class="headerlink" title="3.2 &#x6D88;&#x8D39;&#x7AEF;&#x6D4B;&#x8BD5;"></a>3.2 &#x6D88;&#x8D39;&#x7AEF;&#x6D4B;&#x8BD5;</h2><p><strong>&#x5B9A;&#x4E49;&#x6D88;&#x8D39;&#x542F;&#x52A8;&#x7C7B;&#xFF1A;</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;package com.jeasy;</span><br><span class="line">/**</span><br><span class="line"> * @author TaoBangren</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @since 2017/5/17 &#x4E0A;&#x5348;9:26</span><br><span class="line"> */</span><br><span class="line">public class DemoConsumer {</span><br><span class="line">      public static void main(String[] args) {</span><br><span class="line">          com.alibaba.dubbo.container.Main.main(args);</span><br><span class="line">      }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><strong>&#x6267;&#x884C;main&#x65B9;&#x6CD5;&#x542F;&#x52A8;&#xFF0C;&#x770B;&#x5230;&#x4EE5;&#x4E0B;&#x65E5;&#x5FD7;&#x8F93;&#x51FA;&#x65F6;&#xFF0C;msa-demo-consumer&#x542F;&#x52A8;&#x6210;&#x529F;&#xFF1A;</strong></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/981f816367a53fea9c97f192f97dc220bfa014fd1120964052bac825f1527280" alt="msa-demo-consumer&#x542F;&#x52A8;&#x6210;&#x529F;"></p>
<p><strong>&#x540C;&#x65F6;&#x670D;&#x52A1;&#x7AEF;&#x4F1A;&#x8F93;&#x51FA;&#x670D;&#x52A1;&#x8C03;&#x7528;&#x65E5;&#x5FD7;&#x4FE1;&#x606F;&#xFF0C;&#x5E76;&#x8C03;&#x7528;&#x6210;&#x529F;&#xFF0C;&#x5982;&#x4E0B;&#xFF1A;</strong></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/374be4b8671e52df3ba581404fae4a2a121f76ac8240966fa340f0cbb574e9a2" alt="&#x670D;&#x52A1;&#x7AEF;&#x8C03;&#x7528;&#x65E5;&#x5FD7;"></p>
<ol start="4">
<li><h1 id="&#x89C4;&#x8303;&#x4F7F;&#x7528;"><a href="#&#x89C4;&#x8303;&#x4F7F;&#x7528;" class="headerlink" title="&#x89C4;&#x8303;&#x4F7F;&#x7528;"></a>&#x89C4;&#x8303;&#x4F7F;&#x7528;</h1></li>
</ol>
<table>
<thead>
<tr>
<th>&#x6A21;&#x5757;</th>
<th>&#x63CF;&#x8FF0;</th>
<th>&#x662F;&#x5426;&#x5FC5;&#x987B;</th>
</tr>
</thead>
<tbody><tr>
<td>msa-xxx-api</td>
<td>&#x5B9A;&#x4E49;&#x63A5;&#x53E3;&amp;&#x5B9E;&#x4F53;</td>
<td>&#x5FC5;&#x987B;</td>
</tr>
<tr>
<td>msa-xxx-provider</td>
<td>&#x4F9D;&#x8D56;api&#x6A21;&#x5757;&#xFF0C;&#x5B9E;&#x73B0;&#x670D;&#x52A1;&#x63A5;&#x53E3;&#xFF0C;&#x63D0;&#x4F9B;&#x670D;&#x52A1;</td>
<td>&#x5FC5;&#x987B;</td>
</tr>
<tr>
<td>msa-xxx-client</td>
<td>&#x4F9D;&#x8D56;api&#x6A21;&#x5757;&#xFF0C;Spring&#x914D;&#x7F6E;&#x6587;&#x4EF6;&amp;&#x6D4B;&#x8BD5;&#x7528;&#x4F8B;&#xFF0C;&#x63D0;&#x4F9B;&#x7ED9;&#x7B2C;&#x4E09;&#x65B9;&#x8C03;&#x7528;&#x670D;&#x52A1;&#x4F7F;&#x7528;</td>
<td>&#x5FC5;&#x987B;</td>
</tr>
<tr>
<td>msa-xxx-consumer</td>
<td>&#x4F9D;&#x8D56;client&#x6A21;&#x5757;&#xFF0C;&#x5EFA;&#x8BAE;&#x4FDD;&#x7559;&#x8BE5;&#x6A21;&#x5757;&#xFF0C;&#x907F;&#x514D;client&#x6A21;&#x5757;&#x76F4;&#x63A5;&#x4E0E;&#x5E94;&#x7528;&#x65B9;&#x7D27;&#x8026;&#x5408;</td>
<td>&#x53EF;&#x9009;</td>
</tr>
</tbody></table>
<ol start="5">
<li><h1 id="&#x63A8;&#x8350;&#x9605;&#x8BFB;"><a href="#&#x63A8;&#x8350;&#x9605;&#x8BFB;" class="headerlink" title="&#x63A8;&#x8350;&#x9605;&#x8BFB;"></a>&#x63A8;&#x8350;&#x9605;&#x8BFB;</h1></li>
</ol>
<h2 id="5-1-Dubbox&#x76F8;&#x5173;&#x8D44;&#x6E90;"><a href="#5-1-Dubbox&#x76F8;&#x5173;&#x8D44;&#x6E90;" class="headerlink" title="5.1 Dubbox&#x76F8;&#x5173;&#x8D44;&#x6E90;"></a>5.1 Dubbox&#x76F8;&#x5173;&#x8D44;&#x6E90;</h2><ol>
<li>&#x6E90;&#x7801;&#x5730;&#x5740; : <a href="/external_links/ec30c3d7afbf77378c8f62ac918f39e0.html" target="blank" rel="noopener">github.com/dangdangdot&#x2026;</a></li>
<li>&#x5728;Dubbo&#x4E2D;&#x5F00;&#x53D1;REST&#x98CE;&#x683C;&#x7684;&#x8FDC;&#x7A0B;&#x8C03;&#x7528; : <a href="/external_links/a554dffad1d28544c81af972b4268776.html" target="blank" rel="noopener">dangdangdotcom.github.io/dubbox/rest&#x2026;</a></li>
<li>&#x5728;Dubbo&#x4E2D;&#x4F7F;&#x7528;&#x9AD8;&#x6548;&#x7684;Java&#x5E8F;&#x5217;&#x5316; : <a href="/external_links/5fa1fa4feca801f6180fdf800f3e56fa.html" target="blank" rel="noopener">dangdangdotcom.github.io/dubbox/seri&#x2026;</a></li>
<li>&#x4F7F;&#x7528;JavaConfig&#x65B9;&#x5F0F;&#x914D;&#x7F6E;dubbox : <a href="/external_links/bdbd4c1e96ee2c480f6c1572777e07eb.html" target="blank" rel="noopener">dangdangdotcom.github.io/dubbox/java&#x2026;</a></li>
<li>Dubbo Jackson&#x5E8F;&#x5217;&#x5316;&#x4F7F;&#x7528;&#x8BF4;&#x660E; : <a href="/external_links/ae7c88f87c8006aed60004d8ee8336df.html" target="blank" rel="noopener">dangdangdotcom.github.io/dubbox/jack&#x2026;</a></li>
<li>Demo : <a href="/external_links/57503f0ea6ff6f5acab2bd9a5833fc4f.html" target="blank" rel="noopener">dangdangdotcom.github.io/dubbox/demo&#x2026;</a></li>
<li>&#x5F53;&#x5F53;&#x7F51;&#x5F00;&#x6E90;Dubbox&#xFF0C;&#x6269;&#x5C55;Dubbo&#x670D;&#x52A1;&#x6846;&#x67B6;&#x652F;&#x6301;REST&#x98CE;&#x683C;&#x8FDC;&#x7A0B;&#x8C03;&#x7528; : <a href="/external_links/90038019d1e9f14fbb93ec1dd28cc8dd.html" target="blank" rel="noopener">www.infoq.com/cn/news/201&#x2026;</a></li>
<li>Dubbox Wiki : <a href="/external_links/9908b639140854ae4c553066c80b55b1.html" target="blank" rel="noopener">github.com/dangdangdot&#x2026;</a></li>
</ol>
<h2 id="5-2-Dubbo&#x76F8;&#x5173;&#x8D44;&#x6E90;"><a href="#5-2-Dubbo&#x76F8;&#x5173;&#x8D44;&#x6E90;" class="headerlink" title="5.2 Dubbo&#x76F8;&#x5173;&#x8D44;&#x6E90;"></a>5.2 Dubbo&#x76F8;&#x5173;&#x8D44;&#x6E90;</h2><ol>
<li>&#x6E90;&#x7801;&#x5730;&#x5740; : <a href="/external_links/a064f6f1f796bbf93bff36d8c16c4782.html" target="blank" rel="noopener">github.com/alibaba/dub&#x2026;</a></li>
<li>Dubbo Wiki : <a href="/external_links/eb66138c61e9d7b1e74054f75db06332.html" target="blank" rel="noopener">github.com/alibaba/dub&#x2026;</a></li>
<li><a href="/external_links/ff6eab5a1aa31d5488b9a4b0efcf294d.html" target="blank" rel="noopener">http://dubbo.io/</a></li>
</ol>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/04062baddda711e02605c7187165e226.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903553283145735.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903553283145735.html" itemprop="url">Android进程框架：进程的创建、启动与调度流程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-21T17:49:22+08:00">
                2018-01-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>&#x5173;&#x4E8E;&#x4F5C;&#x8005;</strong></p>
<blockquote>
<p>&#x90ED;&#x5B5D;&#x661F;&#xFF0C;&#x7A0B;&#x5E8F;&#x5458;&#xFF0C;&#x5409;&#x4ED6;&#x624B;&#xFF0C;&#x4E3B;&#x8981;&#x4ECE;&#x4E8B;Android&#x5E73;&#x53F0;&#x57FA;&#x7840;&#x67B6;&#x6784;&#x65B9;&#x9762;&#x7684;&#x5DE5;&#x4F5C;&#xFF0C;&#x6B22;&#x8FCE;&#x4EA4;&#x6D41;&#x6280;&#x672F;&#x65B9;&#x9762;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x53EF;&#x4EE5;&#x53BB;&#x6211;&#x7684;<a href="/external_links/6395fe7b4ea61f4f04fc23a9ba7990bf.html" target="blank" rel="noopener">Github</a>&#x63D0;issue&#x6216;&#x8005;&#x53D1;&#x90AE;&#x4EF6;&#x81F3;<a href="mailto:guoxiaoxingse@163.com" target="_blank" rel="noopener">guoxiaoxingse@163.com</a>&#x4E0E;&#x6211;&#x4EA4;&#x6D41;&#x3002;</p>
</blockquote>
<p><strong>&#x6587;&#x7AE0;&#x76EE;&#x5F55;</strong></p>
<ul>
<li>&#x4E00; &#x8FDB;&#x7A0B;&#x7684;&#x521B;&#x5EFA;&#x4E0E;&#x542F;&#x52A8;&#x6D41;&#x7A0B;</li>
<li>&#x4E8C; &#x8FDB;&#x7A0B;&#x7684;&#x4F18;&#x5148;&#x7EA7;</li>
<li>&#x4E09; &#x8FDB;&#x7A0B;&#x7684;&#x8C03;&#x5EA6;&#x6D41;&#x7A0B;</li>
</ul>
<p>Android&#x7CFB;&#x7EDF;&#x7684;&#x542F;&#x52A8;&#x6D41;&#x7A0B;&#x5982;&#x4E0B;&#x56FE;&#xFF08;&#x70B9;&#x51FB;&#x67E5;&#x770B;&#x5927;&#x56FE;&#xFF09;&#x6240;&#x793A;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/a7a71ac3a6fbf538e38305b6a3de0d1e13a772b583a1161b4be8aa82b328afd3" alt><br>Loader&#x5C42;</p>
<ol>
<li>&#x5F53;&#x624B;&#x673A;&#x5904;&#x4E8E;&#x5173;&#x673A;&#x72B6;&#x6001;&#x65F6;&#xFF0C;&#x957F;&#x6309;&#x7535;&#x6E90;&#x952E;&#x5F00;&#x673A;&#xFF0C;&#x5F15;&#x5BFC;&#x82AF;&#x7247;&#x5F00;&#x59CB;&#x4ECE;&#x56FA;&#x5316;&#x5728;Boot ROM&#x91CC;&#x7684;&#x9884;&#x8BBE;&#x4EE3;&#x7801;&#x5F00;&#x59CB;&#x6267;&#x884C;&#xFF0C;&#x7136;&#x540E;&#x52A0;&#x8F7D;&#x5F15;&#x5BFC;&#x7A0B;&#x5E8F;Boot Loader&#x5230;RAM&#x3002;</li>
<li>Boot Loader&#x88AB;&#x52A0;&#x8F7D;&#x5230;RAM&#x4E4B;&#x540E;&#x5F00;&#x59CB;&#x6267;&#x884C;&#xFF0C;&#x8BE5;&#x7A0B;&#x5E8F;&#x4E3B;&#x8981;&#x5B8C;&#x6210;&#x68C0;&#x67E5;RAM&#xFF0C;&#x521D;&#x59CB;&#x5316;&#x786C;&#x4EF6;&#x53C2;&#x6570;&#x7B49;&#x529F;&#x80FD;&#x3002;</li>
</ol>
<p>Kernel&#x5C42;</p>
<ol start="3">
<li>&#x5F15;&#x5BFC;&#x7A0B;&#x5E8F;&#x4E4B;&#x540E;&#x8FDB;&#x5165;Android&#x5185;&#x6838;&#x5C42;&#xFF0C;&#x5148;&#x542F;&#x52A8;swapper&#x8FDB;&#x7A0B;&#xFF08;idle&#x8FDB;&#x7A0B;&#xFF09;&#xFF0C;&#x8BE5;&#x8FDB;&#x7A0B;&#x7528;&#x6765;&#x521D;&#x59CB;&#x5316;&#x8FDB;&#x7A0B;&#x7BA1;&#x7406;&#x3001;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x3001;&#x52A0;&#x8F7D;Display&#x3001;Camera Driver&#x3001;Binder Driver&#x7B49;&#x76F8;&#x5173;&#x5DE5;&#x4F5C;&#x3002;</li>
<li>swapper&#x8FDB;&#x7A0B;&#x8FDB;&#x7A0B;&#x4E4B;&#x540E;&#x518D;&#x542F;&#x52A8;kthreadd&#x8FDB;&#x7A0B;&#xFF0C;&#x8BE5;&#x8FDB;&#x7A0B;&#x4F1A;&#x521B;&#x5EFA;&#x5185;&#x6838;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;kworkder&#x3001;&#x8F6F;&#x4E2D;&#x65AD;&#x7EBF;&#x7A0B;ksoftirqd&#x3001;thernal&#x7B49;&#x5185;&#x6838;&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#xFF0C;kthreadd&#x8FDB;&#x7A0B;&#x662F;&#x6240;&#x6709;&#x5185;&#x6838;&#x8FDB;&#x7A0B;&#x7684;&#x9F3B;&#x7956;&#x3002;</li>
</ol>
<p>Native&#x5C42;</p>
<ol start="5">
<li>&#x63A5;&#x7740;&#x4F1A;&#x542F;&#x52A8;init&#x8FDB;&#x7A0B;&#xFF0C;init&#x8FDB;&#x7A0B;&#x662F;&#x6240;&#x6709;&#x7528;&#x6237;&#x8FDB;&#x7A0B;&#x7684;&#x9F3B;&#x7956;&#xFF0C;&#x5B83;&#x4F1A;&#x63A5;&#x7740;&#x5B75;&#x5316;&#x51FA;ueventd&#x3001;logd&#x3001;healthd&#x3001;installd&#x3001;adbd&#x3001;lmkd&#x7B49;&#x7528;&#x6237;&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#xFF0C;&#x542F;&#x52A8;ServiceManager&#x6765;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;<br>&#x670D;&#x52A1;&#xFF0C;&#x542F;&#x52A8;Bootnaim&#x5F00;&#x673A;&#x52A8;&#x753B;&#x3002;</li>
<li>init&#x8FDB;&#x7A0B;&#x901A;&#x8FC7;&#x89E3;&#x6790;init.rc&#x6587;&#x4EF6;fork&#x751F;&#x6210;Zygote&#x8FDB;&#x7A0B;&#xFF0C;&#x8BE5;&#x8FDB;&#x7A0B;&#x662F;Android&#x7CFB;&#x7EDF;&#x7B2C;&#x4E00;&#x4E2A;Java&#x8FDB;&#x7A0B;&#xFF0C;&#x5B83;&#x662F;&#x6240;&#x6709;Java&#x8FDB;&#x7A0B;&#x7236;&#x8FDB;&#x7A0B;&#xFF0C;&#x8BE5;&#x8FDB;&#x7A0B;&#x4E3B;&#x8981;&#x5B8C;&#x6210;&#x4E86;&#x52A0;&#x8F7D;ZygoteInit&#x7C7B;&#xFF0C;&#x6CE8;&#x518C;Zygote Socket<br>&#x670D;&#x52A1;&#x5957;&#x63A5;&#x5B57;&#xFF1B;&#x52A0;&#x8F7D;&#x865A;&#x62DF;&#x673A;&#xFF1B;&#x9884;&#x52A0;&#x8F7D;Class&#xFF1B;&#x9884;&#x52A0;&#x8F7D;Resources&#x3002;</li>
</ol>
<p>Framework&#x5C42;</p>
<ol start="7">
<li>init&#x8FDB;&#x7A0B;&#x63A5;&#x7740;fork&#x751F;&#x6210;Media Server&#x8FDB;&#x7A0B;&#xFF0C;&#x8BE5;&#x8FDB;&#x7A0B;&#x8D1F;&#x8D23;&#x542F;&#x52A8;&#x548C;&#x7BA1;&#x7406;&#x6574;&#x4E2A;C++ Framwork&#xFF08;&#x5305;&#x542B;AudioFlinger&#x3001;Camera Service&#x7B49;&#x670D;&#x52A1;&#xFF09;&#x3002;</li>
<li>Zygote&#x8FDB;&#x7A0B;&#x63A5;&#x7740;&#x4F1A;fork&#x751F;&#x6210;System Server&#x8FDB;&#x7A0B;&#xFF0C;&#x8BE5;&#x8FDB;&#x7A0B;&#x8D1F;&#x8D23;&#x542F;&#x52A8;&#x548C;&#x7BA1;&#x7406;&#x6574;&#x4E2A;Java Framwork&#xFF08;&#x5305;&#x542B;ActivityManagerService&#x3001;WindowManagerService&#x7B49;&#x670D;&#x52A1;&#xFF09;&#x3002;</li>
</ol>
<p>App&#x5C42;</p>
<p>Zygote&#x8FDB;&#x7A0B;&#x5B75;&#x5316;&#x51FA;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#x8FDB;&#x7A0B;&#x662F;Launcher&#x8FDB;&#x7A0B;&#xFF08;&#x684C;&#x9762;&#xFF09;&#xFF0C;&#x5B83;&#x8FD8;&#x4F1A;&#x5B75;&#x5316;&#x51FA;Browser&#x8FDB;&#x7A0B;&#xFF08;&#x6D4F;&#x89C8;&#x5668;&#xFF09;&#x3001;Phone&#x8FDB;&#x7A0B;&#xFF08;&#x7535;&#x8BDD;&#xFF09;&#x7B49;&#x3002;&#x6211;&#x4EEC;&#x6BCF;&#x4E2A;&#x521B;&#x5EFA;&#x7684;&#x5E94;&#x7528;&#x90FD;&#x662F;&#x4E00;&#x4E2A;&#x5355;&#x72EC;&#x7684;&#x8FDB;&#x7A0B;&#x3002;</p>
<p>&#x901A;&#x8FC7;&#x4E0A;&#x8FF0;&#x6D41;&#x7A0B;&#x7684;&#x5206;&#x6790;&#xFF0C;&#x60F3;&#x5FC5;&#x8BFB;&#x8005;&#x5DF2;&#x7ECF;&#x5BF9;Android&#x7684;&#x6574;&#x4E2A;&#x8FDB;&#x7A0B;&#x6A21;&#x578B;&#x6709;&#x4E86;&#x5927;&#x81F4;&#x7684;&#x7406;&#x89E3;&#x3002;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#x5F00;&#x53D1;&#x8005;&#x6211;&#x4EEC;&#x5F80;&#x5F80;&#x66F4;&#x4E3A;&#x5173;&#x6CE8;Framework&#x5C42;&#x548C;App&#x5C42;&#x91CC;&#x8FDB;&#x7A0B;&#x7684;&#x521B;&#x5EFA;&#x4E0E;&#x7BA1;&#x7406;&#x76F8;&#x5173;&#x539F;&#x7406;&#xFF0C;&#x6211;&#x4EEC;&#x6765;<br>&#x4E00;&#x4E00;&#x5206;&#x6790;&#x3002;</p>
<h2 id="&#x4E00;-&#x8FDB;&#x7A0B;&#x7684;&#x521B;&#x5EFA;&#x4E0E;&#x542F;&#x52A8;&#x6D41;&#x7A0B;"><a href="#&#x4E00;-&#x8FDB;&#x7A0B;&#x7684;&#x521B;&#x5EFA;&#x4E0E;&#x542F;&#x52A8;&#x6D41;&#x7A0B;" class="headerlink" title="&#x4E00; &#x8FDB;&#x7A0B;&#x7684;&#x521B;&#x5EFA;&#x4E0E;&#x542F;&#x52A8;&#x6D41;&#x7A0B;"></a>&#x4E00; &#x8FDB;&#x7A0B;&#x7684;&#x521B;&#x5EFA;&#x4E0E;&#x542F;&#x52A8;&#x6D41;&#x7A0B;</h2><p>&#x5728;&#x6B63;&#x5F0F;&#x4ECB;&#x7ECD;&#x8FDB;&#x7A0B;&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x6765;&#x601D;&#x8003;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x4F55;&#x4E3A;&#x8FDB;&#x7A0B;&#xFF0C;&#x8FDB;&#x7A0B;&#x7684;&#x672C;&#x8D28;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;&#x1F914;</p>
<blockquote>
<p>&#x6211;&#x4EEC;&#x77E5;&#x9053;&#xFF0C;&#x4EE3;&#x7801;&#x662F;&#x9759;&#x6001;&#x7684;&#xFF0C;&#x6709;&#x4EE3;&#x7801;&#x548C;&#x8D44;&#x6E90;&#x7EC4;&#x6210;&#x7684;&#x7CFB;&#x7EDF;&#x8981;&#x60F3;&#x8FD0;&#x884C;&#x8D77;&#x6765;&#x5C31;&#x9700;&#x8981;&#x4E00;&#x79CD;&#x52A8;&#x6001;&#x7684;&#x5B58;&#x5728;&#xFF0C;&#x8FDB;&#x7A0B;&#x5C31;&#x662F;&#x7A0B;&#x5E8F;&#x7684;&#x52A8;&#x6001;&#x6267;&#x884C;&#x8FC7;&#x7A0B;&#x3002;&#x4F55;&#x4E3A;&#x8FDB;&#x7A0B;&#xFF1F;<br>&#x8FDB;&#x7A0B;&#x5C31;&#x662F;&#x5904;&#x7406;&#x6267;&#x884C;&#x72B6;&#x6001;&#x7684;&#x4EE3;&#x7801;&#x4EE5;&#x53CA;&#x76F8;&#x5173;&#x8D44;&#x6E90;&#x7684;&#x96C6;&#x5408;&#xFF0C;&#x5305;&#x62EC;&#x4EE3;&#x7801;&#x7AEF;&#x6BB5;&#x3001;&#x6587;&#x4EF6;&#x3001;&#x4FE1;&#x53F7;&#x3001;CPU&#x72B6;&#x6001;&#x3001;&#x5185;&#x5B58;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#x7B49;&#x3002;</p>
</blockquote>
<p>&#x8FDB;&#x7A0B;&#x4F7F;&#x7528;task_struct&#x7ED3;&#x6784;&#x4F53;&#x6765;&#x63CF;&#x8FF0;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<ul>
<li>&#x4EE3;&#x7801;&#x6BB5;&#xFF1A;&#x7F16;&#x8BD1;&#x540E;&#x5F62;&#x6210;&#x7684;&#x4E00;&#x4E9B;&#x6307;&#x4EE4;</li>
<li>&#x6570;&#x636E;&#x6BB5;&#xFF1A;&#x7A0B;&#x5E8F;&#x8FD0;&#x884C;&#x65F6;&#x9700;&#x8981;&#x7684;&#x6570;&#x636E;<ul>
<li>&#x53EA;&#x8BFB;&#x6570;&#x636E;&#x6BB5;&#xFF1A;&#x5E38;&#x91CF;</li>
<li>&#x5DF2;&#x521D;&#x59CB;&#x5316;&#x6570;&#x636E;&#x6BB5;&#xFF1A;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#xFF0C;&#x9759;&#x6001;&#x53D8;&#x91CF;</li>
<li>&#x672A;&#x521D;&#x59CB;&#x5316;&#x6570;&#x636E;&#x6BB5;&#xFF08;bss)&#xFF1A;&#x672A;&#x521D;&#x59CB;&#x5316;&#x7684;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#x548C;&#x9759;&#x6001;&#x53D8;&#x91CF;</li>
</ul>
</li>
<li>&#x5806;&#x6808;&#x6BB5;&#xFF1A;&#x7A0B;&#x5E8F;&#x8FD0;&#x884C;&#x65F6;&#x52A8;&#x6001;&#x5206;&#x914D;&#x7684;&#x4E00;&#x4E9B;&#x5185;&#x5B58;</li>
<li>PCB&#xFF1A;&#x8FDB;&#x7A0B;&#x4FE1;&#x606F;&#xFF0C;&#x72B6;&#x6001;&#x6807;&#x8BC6;&#x7B49;</li>
</ul>
<p>&#x5173;&#x4E8E;&#x8FDB;&#x7A0B;&#x7684;&#x66F4;&#x591A;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#xFF0C;&#x8BFB;&#x8005;&#x53EF;&#x4EE5;&#x53BB;&#x7FFB;&#x9605;Linux&#x76F8;&#x5173;&#x4E66;&#x7C4D;&#xFF0C;&#x8FD9;&#x91CC;&#x53EA;&#x662F;&#x7ED9;&#x8BFB;&#x8005;&#x5E26;&#x6765;&#x4E00;&#x79CD;&#x6574;&#x4F53;&#x4E0A;&#x7684;&#x7406;&#x89E3;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x91CD;&#x5FC3;&#x8FD8;&#x662F;&#x653E;&#x5728;&#x8FDB;&#x7A0B;&#x518D;Android&#x5E73;&#x53F0;&#x4E0A;&#x7684;&#x5E94;&#x7528;&#x3002;</p>
<p>&#x5728;&#x6587;&#x7AE0;&#x5F00;&#x7BC7;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x63D0;&#x5230;&#x4E86;&#x7CFB;&#x7EDF;&#x4E2D;&#x8FD0;&#x884C;&#x7684;&#x5404;&#x79CD;&#x8FDB;&#x7A0B;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x4E9B;&#x8FDB;&#x7A0B;&#x5982;&#x4F55;&#x88AB;&#x521B;&#x5EFA;&#x5462;&#xFF1F;&#x1F914;</p>
<p>&#x6211;&#x4EEC;&#x5148;&#x6765;&#x770B;&#x770B;&#x6211;&#x4EEC;&#x6700;&#x719F;&#x6089;&#x7684;&#x5E94;&#x7528;&#x8FDB;&#x7A0B;&#x662F;&#x5982;&#x4F55;&#x88AB;&#x521B;&#x5EFA;&#x7684;&#xFF0C;&#x524D;&#x9762;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x8BF4;&#x6765;&#x6BCF;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#x90FD;&#x8FD0;&#x884C;&#x5728;&#x4E00;&#x4E2A;&#x5355;&#x72EC;&#x7684;&#x8FDB;&#x7A0B;&#x91CC;&#xFF0C;&#x5F53;ActivityManagerService&#x53BB;&#x542F;&#x52A8;&#x56DB;&#x5927;&#x7EC4;&#x4EF6;&#x65F6;&#xFF0C;<br>&#x5982;&#x679C;&#x53D1;&#x73B0;&#x8FD9;&#x4E2A;&#x7EC4;&#x4EF6;&#x6240;&#x5728;&#x7684;&#x8FDB;&#x7A0B;&#x6CA1;&#x6709;&#x542F;&#x52A8;&#xFF0C;&#x5C31;&#x4F1A;&#x53BB;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x8FDB;&#x7A0B;&#xFF0C;&#x542F;&#x52A8;&#x8FDB;&#x7A0B;&#x7684;&#x65F6;&#x673A;&#x6211;&#x4EEC;&#x5728;&#x5206;&#x6790;&#x56DB;&#x5927;&#x7EC4;&#x4EF6;&#x7684;&#x542F;&#x52A8;&#x6D41;&#x7A0B;&#x7684;&#x65F6;&#x5019;&#x4E5F;&#x6709;&#x8BB2;&#x8FC7;&#xFF0C;&#x8FD9;&#x91CC;&#x518D;&#x603B;&#x7ED3;&#x4E00;&#x4E0B;&#xFF1A;</p>
<ul>
<li>Activity ActivityStackSupervisor.startSpecificActivityLocked()</li>
<li>Service ActiveServices.bringUpServiceLocked()</li>
<li>ContentProvider ActivityManagerService.getContentProviderImpl()<br>= Broadcast BroadcastQueue.processNextBroadcast()</li>
</ul>
<p>&#x8FD9;&#x4E2A;&#x65B0;&#x8FDB;&#x7A0B;&#x5C31;&#x662F;zygote&#x8FDB;&#x7A0B;&#x901A;&#x8FC7;&#x590D;&#x5236;&#x81EA;&#x8EAB;&#x6765;&#x521B;&#x5EFA;&#x7684;&#xFF0C;&#x65B0;&#x8FDB;&#x7A0B;&#x5728;&#x542F;&#x52A8;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x8FD8;&#x4F1A;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;Binder&#x7EBF;&#x7A0B;&#x6C60;&#xFF08;&#x7528;&#x6765;&#x505A;&#x8FDB;&#x7A0B;&#x901A;&#x4FE1;&#xFF09;&#x548C;&#x4E00;&#x4E2A;&#x6D88;&#x606F;&#x5FAA;&#x73AF;&#xFF08;&#x7528;&#x6765;&#x505A;&#x7EBF;&#x7A0B;&#x901A;&#x4FE1;&#xFF09;<br>&#x6574;&#x4E2A;&#x6D41;&#x7A0B;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/b0d06f0ce615e9adc7cd378ad855709f923486b96b870a678e520c3d60ba4b91" alt></p>
<ol>
<li>&#x5F53;&#x6211;&#x4EEC;&#x70B9;&#x51FB;&#x5E94;&#x7528;&#x56FE;&#x6807;&#x542F;&#x52A8;&#x5E94;&#x7528;&#x65F6;&#x6216;&#x8005;&#x5728;&#x5E94;&#x7528;&#x5185;&#x542F;&#x52A8;&#x4E00;&#x4E2A;&#x5E26;&#x6709;process&#x6807;&#x7B7E;&#x7684;Activity&#x65F6;&#xFF0C;&#x90FD;&#x4F1A;&#x89E6;&#x53D1;&#x521B;&#x5EFA;&#x65B0;&#x8FDB;&#x7A0B;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x8FD9;&#x79CD;&#x8BF7;&#x6C42;&#x4F1A;&#x5148;&#x901A;&#x8FC7;Binder<br>&#x53D1;&#x9001;&#x7ED9;system_server&#x8FDB;&#x7A0B;&#xFF0C;&#x4E5F;&#x5373;&#x662F;&#x53D1;&#x9001;&#x7ED9;ActivityManagerService&#x8FDB;&#x884C;&#x5904;&#x7406;&#x3002;</li>
<li>system_server&#x8FDB;&#x7A0B;&#x4F1A;&#x8C03;&#x7528;Process.start()&#x65B9;&#x6CD5;&#xFF0C;&#x4F1A;&#x5148;&#x6536;&#x96C6;uid&#x3001;gid&#x7B49;&#x53C2;&#x6570;&#xFF0C;&#x7136;&#x540E;&#x901A;&#x8FC7;Socket&#x65B9;&#x5F0F;&#x53D1;&#x9001;&#x7ED9;Zygote&#x8FDB;&#x7A0B;&#xFF0C;&#x8BF7;&#x6C42;&#x521B;&#x5EFA;&#x65B0;&#x8FDB;&#x7A0B;&#x3002;</li>
<li>Zygote&#x8FDB;&#x7A0B;&#x63A5;&#x6536;&#x5230;&#x521B;&#x5EFA;&#x65B0;&#x8FDB;&#x7A0B;&#x7684;&#x8BF7;&#x6C42;&#x540E;&#xFF0C;&#x8C03;&#x7528;ZygoteInit.main()&#x65B9;&#x6CD5;&#x8FDB;&#x884C;runSelectLoop()&#x5FAA;&#x73AF;&#x4F53;&#x5185;&#xFF0C;&#x5F53;&#x6709;&#x5BA2;&#x6237;&#x7AEF;&#x8FDE;&#x63A5;&#x65F6;&#x6267;&#x884C;ZygoteConnection.runOnce()<br>&#x65B9;&#x6CD5;&#xFF0C;&#x6700;&#x540E;fork&#x751F;&#x6210;&#x65B0;&#x7684;&#x5E94;&#x7528;&#x8FDB;&#x7A0B;&#x3002;</li>
<li>&#x65B0;&#x521B;&#x5EFA;&#x7684;&#x8FDB;&#x7A0B;&#x4F1A;&#x8C03;&#x7528;handleChildProc()&#x65B9;&#x6CD5;&#xFF0C;&#x6700;&#x540E;&#x8C03;&#x7528;&#x6211;&#x4EEC;&#x975E;&#x5E38;&#x719F;&#x6089;&#x7684;ActivityThread.main()&#x65B9;&#x6CD5;&#x3002;</li>
</ol>
<p>&#x6CE8;&#xFF1A;&#x6574;&#x4E2A;&#x6D41;&#x7A0B;&#x4F1A;&#x6D89;&#x53CA;Binder&#x548C;Socket&#x4E24;&#x79CD;&#x8FDB;&#x7A0B;&#x901A;&#x4FE1;&#x65B9;&#x5F0F;&#xFF0C;&#x8FD9;&#x4E2A;&#x6211;&#x4EEC;&#x540E;&#x7EED;&#x4F1A;&#x6709;&#x4E13;&#x95E8;&#x7684;&#x6587;&#x7AE0;&#x5355;&#x72EC;&#x5206;&#x6790;&#xFF0C;&#x8FD9;&#x4E2A;&#x5C31;&#x4E0D;&#x518D;&#x5C55;&#x5F00;&#x3002;</p>
<p>&#x6574;&#x4E2A;&#x6D41;&#x7A0B;&#x5927;&#x81F4;&#x5C31;&#x662F;&#x8FD9;&#x6837;&#xFF0C;&#x6211;&#x4EEC;&#x63A5;&#x7740;&#x6765;&#x770B;&#x770B;&#x5177;&#x4F53;&#x7684;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;&#xFF0C;&#x5148;&#x6765;&#x770B;&#x4E00;&#x5F20;&#x8FDB;&#x7A0B;&#x542F;&#x52A8;&#x5E8F;&#x5217;&#x56FE;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/9cdd89cba16801af24009422f45be39bdea78a4304c228e195d706f47d271a03" alt><br>&#x4ECE;&#x7B2C;&#x4E00;&#x6B65;&#x5230;&#x7B2C;&#x4E09;&#x6B65;&#x4E3B;&#x8981;&#x662F;&#x6536;&#x96C6;&#x6574;&#x7406;uid&#x3001;gid&#x3001;groups&#x3001;target-sdk&#x3001;nice-name&#x7B49;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x53C2;&#x6570;&#xFF0C;&#x4E3A;&#x540E;&#x7EED;&#x542F;&#x52A8;&#x65B0;&#x8FDB;&#x7A0B;&#x505A;&#x51C6;&#x5907;&#x3002;&#x7136;&#x540E;&#x8C03;&#x7528;openZygoteSocketIfNeeded()&#x65B9;&#x6CD5;<br>&#x6253;&#x5F00;Socket&#x901A;&#x4FE1;&#xFF0C;&#x5411;zygote&#x8FDB;&#x7A0B;&#x53D1;&#x51FA;&#x521B;&#x5EFA;&#x65B0;&#x8FDB;&#x7A0B;&#x7684;&#x8BF7;&#x6C42;&#x3002;</p>
<p>&#x6CE8;&#xFF1A;&#x7B2C;&#x4E8C;&#x6B65;&#x4E2D;&#x7684;Process.start()&#x65B9;&#x6CD5;&#x662F;&#x4E2A;&#x963B;&#x585E;&#x64CD;&#x4F5C;&#xFF0C;&#x5B83;&#x4F1A;&#x4E00;&#x76F4;&#x7B49;&#x5F85;&#x8FDB;&#x7A0B;&#x521B;&#x5EFA;&#x5B8C;&#x6BD5;&#xFF0C;&#x5E76;&#x8FD4;&#x56DE;pid&#x624D;&#x4F1A;&#x5B8C;&#x6210;&#x8BE5;&#x65B9;&#x6CD5;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x6765;&#x91CD;&#x70B9;&#x5173;&#x6CE8;&#x51E0;&#x4E2A;&#x5173;&#x952E;&#x7684;&#x51FD;&#x6570;&#x3002;</p>
<h3 id="1-1-Process-openZygoteSocketIfNeeded-String-abi"><a href="#1-1-Process-openZygoteSocketIfNeeded-String-abi" class="headerlink" title="1.1 Process.openZygoteSocketIfNeeded(String abi)"></a>1.1 Process.openZygoteSocketIfNeeded(String abi)</h3><p>&#x5173;&#x4E8E;Process&#x7C7B;&#x4E0E;Zygote&#x8FDB;&#x7A0B;&#x7684;&#x901A;&#x4FE1;&#x662F;&#x5982;&#x4F55;&#x8FDB;&#x884C;&#x7684;&#x5462;&#xFF1F;&#x1F914;</p>
<p>Process&#x7684;&#x9759;&#x6001;&#x5185;&#x90E8;&#x7C7B;ZygoteState&#x6709;&#x4E2A;&#x6210;&#x5458;&#x53D8;&#x91CF;LocalSocket&#x5BF9;&#x8C61;&#xFF0C;&#x5B83;&#x4F1A;&#x4E0E;ZygoteInit&#x7C7B;&#x7684;&#x6210;&#x5458;&#x53D8;&#x91CF;LocalServerSocket&#x5BF9;&#x8C61;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<p>&#x5BA2;&#x6237;&#x7AEF;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public static class ZygoteState {</span><br><span class="line">    final LocalSocket socket;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x670D;&#x52A1;&#x7AEF;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public class ZygoteInit {</span><br><span class="line">    //&#x8BE5;Socket&#x4E0E;/dev/socket/zygote&#x6587;&#x4EF6;&#x7ED1;&#x5B9A;&#x5728;&#x4E00;&#x8D77;</span><br><span class="line">    private static LocalServerSocket sServerSocket;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x6211;&#x4EEC;&#x6765;&#x5177;&#x4F53;&#x770B;&#x770B;&#x4EE3;&#x7801;&#x91CC;&#x7684;&#x5B9E;&#x73B0;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801; public static class ZygoteState {</span><br><span class="line">    </span><br><span class="line">    public static ZygoteState connect(String socketAddress) throws IOException {</span><br><span class="line">        DataInputStream zygoteInputStream = null;</span><br><span class="line">        BufferedWriter zygoteWriter = null;</span><br><span class="line">        //&#x521B;&#x5EFA;LocalSocket&#x5BF9;&#x8C61;</span><br><span class="line">        final LocalSocket zygoteSocket = new LocalSocket();</span><br><span class="line"></span><br><span class="line">        try {</span><br><span class="line">            //&#x5C06;LocalSocket&#x4E0E;LocalServerSocket&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#xFF0C;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x7684;&#x8FC7;&#x7A0B;&#x5C31;&#x662F;</span><br><span class="line">            //LocalSocket&#x5BF9;&#x8C61;&#x5728;/dev/socket&#x76EE;&#x5F55;&#x4E0B;&#x67E5;&#x627E;&#x4E00;&#x4E2A;&#x540D;&#x79F0;&#x4E3A;&quot;zygote&quot;&#x7684;&#x6587;&#x4EF6;</span><br><span class="line">            //&#x7136;&#x540E;&#x5C06;&#x81EA;&#x5DF1;&#x4E0E;&#x5176;&#x7ED1;&#x5B9A;&#x8D77;&#x6765;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x5EFA;&#x7ACB;&#x4E86;&#x8FDE;&#x63A5;&#x3002;</span><br><span class="line">            zygoteSocket.connect(new LocalSocketAddress(socketAddress,</span><br><span class="line">                    LocalSocketAddress.Namespace.RESERVED));</span><br><span class="line"></span><br><span class="line">            //&#x521B;&#x5EFA;LocalSocket&#x7684;&#x8F93;&#x5165;&#x6D41;&#xFF0C;&#x4EE5;&#x4FBF;&#x53EF;&#x4EE5;&#x63A5;&#x6536;Zygote&#x8FDB;&#x7A0B;&#x53D1;&#x9001;&#x8FC7;&#x6765;&#x7684;&#x6570;&#x636E;</span><br><span class="line">            zygoteInputStream = new DataInputStream(zygoteSocket.getInputStream());</span><br><span class="line"></span><br><span class="line">            //&#x521B;&#x5EFA;LocalSocket&#x7684;&#x8F93;&#x51FA;&#x6D41;&#xFF0C;&#x4EE5;&#x4FBF;&#x53EF;&#x4EE5;&#x5411;Zygote&#x8FDB;&#x7A0B;&#x53D1;&#x9001;&#x6570;&#x636E;&#x3002;</span><br><span class="line">            zygoteWriter = new BufferedWriter(new OutputStreamWriter(</span><br><span class="line">                    zygoteSocket.getOutputStream()), 256);</span><br><span class="line">        } catch (IOException ex) {</span><br><span class="line">            try {</span><br><span class="line">                zygoteSocket.close();</span><br><span class="line">            } catch (IOException ignore) {</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            throw ex;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        String abiListString = getAbiList(zygoteWriter, zygoteInputStream);</span><br><span class="line">        Log.i(&quot;Zygote&quot;, &quot;Process: zygote socket opened, supported ABIS: &quot; + abiListString);</span><br><span class="line"></span><br><span class="line">        return new ZygoteState(zygoteSocket, zygoteInputStream, zygoteWriter,</span><br><span class="line">                Arrays.asList(abiListString.split(&quot;,&quot;)));</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5EFA;&#x7ACB;Socket&#x8FDE;&#x63A5;&#x7684;&#x6D41;&#x7A0B;&#x5F88;&#x660E;&#x6717;&#x4E86;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<ol>
<li>&#x521B;&#x5EFA;LocalSocket&#x5BF9;&#x8C61;&#x3002;</li>
<li>&#x5C06;LocalSocket&#x4E0E;LocalServerSocket&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#xFF0C;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x7684;&#x8FC7;&#x7A0B;&#x5C31;&#x662F;LocalSocket&#x5BF9;&#x8C61;&#x5728;/dev/socket&#x76EE;&#x5F55;&#x4E0B;&#x67E5;&#x627E;&#x4E00;&#x4E2A;&#x540D;&#x79F0;&#x4E3A;&#x201D;zygote&#x201D;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x81EA;&#x5DF1;&#x4E0E;&#x5176;&#x7ED1;&#x5B9A;&#x8D77;&#x6765;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x5EFA;&#x7ACB;&#x4E86;&#x8FDE;&#x63A5;&#x3002;</li>
<li>&#x521B;&#x5EFA;LocalSocket&#x7684;&#x8F93;&#x5165;&#x6D41;&#xFF0C;&#x4EE5;&#x4FBF;&#x53EF;&#x4EE5;&#x63A5;&#x6536;Zygote&#x8FDB;&#x7A0B;&#x53D1;&#x9001;&#x8FC7;&#x6765;&#x7684;&#x6570;&#x636E;&#x3002;</li>
<li>&#x521B;&#x5EFA;LocalSocket&#x7684;&#x8F93;&#x51FA;&#x6D41;&#xFF0C;&#x4EE5;&#x4FBF;&#x53EF;&#x4EE5;&#x5411;Zygote&#x8FDB;&#x7A0B;&#x53D1;&#x9001;&#x6570;&#x636E;&#x3002;</li>
</ol>
<h3 id="1-2-ZygoteInit-main-String-argv"><a href="#1-2-ZygoteInit-main-String-argv" class="headerlink" title="1.2 ZygoteInit.main(String argv[])"></a>1.2 ZygoteInit.main(String argv[])</h3><blockquote>
<p>ZygoteInit&#x662F;Zygote&#x8FDB;&#x7A0B;&#x7684;&#x542F;&#x52A8;&#x7C7B;&#xFF0C;&#x8BE5;&#x7C7B;&#x4F1A;&#x9884;&#x52A0;&#x8F7D;&#x4E00;&#x4E9B;&#x7C7B;&#xFF0C;&#x7136;&#x540E;&#x4FBF;&#x5F00;&#x542F;&#x4E00;&#x4E2A;&#x5FAA;&#x73AF;&#xFF0C;&#x7B49;&#x5F85;&#x901A;&#x8FC7;Socket&#x53D1;&#x8FC7;&#x6765;&#x7684;&#x521B;&#x5EFA;&#x65B0;&#x8FDB;&#x7A0B;&#x7684;&#x547D;&#x4EE4;&#xFF0C;fork&#x51FA;&#x65B0;&#x7684;<br>&#x5B50;&#x8FDB;&#x7A0B;&#x3002;</p>
</blockquote>
<p>ZygoteInit&#x7684;&#x5165;&#x53E3;&#x51FD;&#x6570;&#x5C31;&#x662F;main()&#x65B9;&#x6CD5;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public class ZygoteInit {</span><br><span class="line">    </span><br><span class="line">    public static void main(String argv[]) {</span><br><span class="line">            // Mark zygote start. This ensures that thread creation will throw</span><br><span class="line">            // an error.</span><br><span class="line">            ZygoteHooks.startZygoteNoThreadCreation();</span><br><span class="line">    </span><br><span class="line">            try {</span><br><span class="line">                //...</span><br><span class="line">                registerZygoteSocket(socketName);</span><br><span class="line">                //...</span><br><span class="line">                //&#x5F00;&#x542F;&#x5FAA;&#x73AF;                </span><br><span class="line">                runSelectLoop(abiList);</span><br><span class="line">    </span><br><span class="line">                closeServerSocket();</span><br><span class="line">            } catch (MethodAndArgsCaller caller) {</span><br><span class="line">                caller.run();</span><br><span class="line">            } catch (Throwable ex) {</span><br><span class="line">                Log.e(TAG, &quot;Zygote died with exception&quot;, ex);</span><br><span class="line">                closeServerSocket();</span><br><span class="line">                throw ex;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    </span><br><span class="line">    // &#x5F00;&#x542F;&#x4E00;&#x4E2A;&#x9009;&#x62E9;&#x5FAA;&#x73AF;&#xFF0C;&#x63A5;&#x6536;&#x901A;&#x8FC7;Socket&#x53D1;&#x8FC7;&#x6765;&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x521B;&#x5EFA;&#x65B0;&#x7EBF;&#x7A0B;</span><br><span class="line">    private static void runSelectLoop(String abiList) throws MethodAndArgsCaller {</span><br><span class="line">        </span><br><span class="line">        ArrayList&lt;FileDescriptor&gt; fds = new ArrayList&lt;FileDescriptor&gt;();</span><br><span class="line">        ArrayList&lt;ZygoteConnection&gt; peers = new ArrayList&lt;ZygoteConnection&gt;();</span><br><span class="line"></span><br><span class="line">        //sServerSocket&#x6307;&#x7684;&#x662F;Socket&#x901A;&#x4FE1;&#x7684;&#x670D;&#x52A1;&#x7AEF;&#xFF0C;&#x5728;fds&#x4E2D;&#x7684;&#x7D22;&#x5F15;&#x4E3A;0</span><br><span class="line">        fds.add(sServerSocket.getFileDescriptor());</span><br><span class="line">        peers.add(null);</span><br><span class="line"></span><br><span class="line">        //&#x5F00;&#x542F;&#x5FAA;&#x73AF;</span><br><span class="line">        while (true) {</span><br><span class="line">            StructPollfd[] pollFds = new StructPollfd[fds.size()];</span><br><span class="line">            for (int i = 0; i &lt; pollFds.length; ++i) {</span><br><span class="line">                pollFds[i] = new StructPollfd();</span><br><span class="line">                pollFds[i].fd = fds.get(i);</span><br><span class="line">                pollFds[i].events = (short) POLLIN;</span><br><span class="line">            }</span><br><span class="line">            try {</span><br><span class="line">                //&#x5904;&#x7406;&#x8F6E;&#x8BE2;&#x72B6;&#x6001;&#xFF0C;&#x5F53;pollFds&#x6709;&#x65F6;&#x95F4;&#x5230;&#x6765;&#x65F6;&#x5219;&#x5F80;&#x4E0B;&#x6267;&#x884C;&#xFF0C;&#x5426;&#x5219;&#x963B;&#x585E;&#x5728;&#x8FD9;&#x91CC;&#x3002;</span><br><span class="line">                Os.poll(pollFds, -1);</span><br><span class="line">            } catch (ErrnoException ex) {</span><br><span class="line">                throw new RuntimeException(&quot;poll failed&quot;, ex);</span><br><span class="line">            }</span><br><span class="line">            for (int i = pollFds.length - 1; i &gt;= 0; --i) {</span><br><span class="line">                </span><br><span class="line">                //&#x91C7;&#x7528;IO&#x591A;&#x8DEF;&#x590D;&#x7528;&#x673A;&#x5236;&#xFF0C;&#x5F53;&#x63A5;&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x51FA;&#x7684;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#x65F6;&#x6216;&#x8005;&#x6570;&#x636E;&#x5904;&#x7406;&#x8BF7;&#x6C42;&#x5230;&#x6765;&#x65F6;&#x5219;</span><br><span class="line">                //&#x5F80;&#x4E0B;&#x6267;&#x884C;&#xFF0C;&#x5426;&#x5219;&#x8FDB;&#x5165;continue&#x8DF3;&#x51FA;&#x672C;&#x6B21;&#x5FAA;&#x73AF;&#x3002;</span><br><span class="line">                if ((pollFds[i].revents &amp; POLLIN) == 0) {</span><br><span class="line">                    continue;</span><br><span class="line">                }</span><br><span class="line">                //&#x7D22;&#x5F15;&#x4E3A;0&#xFF0C;&#x5373;&#x4E3A;sServerSocket&#xFF0C;&#x8868;&#x793A;&#x63A5;&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x6765;&#x7684;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#x3002;</span><br><span class="line">                if (i == 0) {</span><br><span class="line">                    ZygoteConnection newPeer = acceptCommandPeer(abiList);</span><br><span class="line">                    peers.add(newPeer);</span><br><span class="line">                    fds.add(newPeer.getFileDesciptor());</span><br><span class="line">                } </span><br><span class="line">                //&#x7D22;&#x5F15;&#x4E0D;&#x4E3A;0&#xFF0C;&#x8868;&#x793A;&#x901A;&#x8FC7;Socket&#x63A5;&#x6536;&#x6765;&#x81EA;&#x5BF9;&#x7AEF;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x5E76;&#x6267;&#x884C;&#x76F8;&#x5E94;&#x7684;&#x64CD;&#x4F5C;&#x3002;</span><br><span class="line">                else {</span><br><span class="line">                    boolean done = peers.get(i).runOnce();</span><br><span class="line">                    //&#x5904;&#x7406;&#x5B8C;&#x6210;&#x540E;&#x79FB;&#x9664;&#x76F8;&#x5E94;&#x7684;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x3002;</span><br><span class="line">                    if (done) {</span><br><span class="line">                        peers.remove(i);</span><br><span class="line">                        fds.remove(i);</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x53EF;&#x4EE5;&#x53D1;&#x73B0;ZygoteInit&#x5728;&#x5176;&#x5165;&#x53E3;&#x51FD;&#x6570;main()&#x65B9;&#x6CD5;&#x91CC;&#x8C03;&#x7528;runSelectLoop()&#x5F00;&#x542F;&#x4E86;&#x5FAA;&#x73AF;&#xFF0C;&#x63A5;&#x6536;Socket&#x53D1;&#x6765;&#x7684;&#x8BF7;&#x6C42;&#x3002;&#x8BF7;&#x6C42;&#x5206;&#x4E3A;&#x4E24;&#x79CD;&#xFF1A;</p>
<ol>
<li>&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;</li>
<li>&#x6570;&#x636E;&#x8BF7;&#x6C42;</li>
</ol>
<p>&#x6CA1;&#x6709;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#x65F6;Zygote&#x8FDB;&#x7A0B;&#x4F1A;&#x8FDB;&#x5165;&#x4F11;&#x7720;&#x72B6;&#x6001;&#xFF0C;&#x5F53;&#x6709;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#x5230;&#x6765;&#x65F6;&#xFF0C;Zygote&#x8FDB;&#x7A0B;&#x4F1A;&#x88AB;&#x5524;&#x9192;&#xFF0C;&#x8C03;&#x7528;acceptCommadPeer()&#x65B9;&#x6CD5;&#x521B;&#x5EFA;Socket&#x901A;&#x9053;ZygoteConnection</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;private static ZygoteConnection acceptCommandPeer(String abiList) {</span><br><span class="line">    try {</span><br><span class="line">        return new ZygoteConnection(sServerSocket.accept(), abiList);</span><br><span class="line">    } catch (IOException ex) {</span><br><span class="line">        throw new RuntimeException(</span><br><span class="line">                &quot;IOException during accept()&quot;, ex);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x7136;&#x540E;&#x8C03;&#x7528;runOnce()&#x65B9;&#x6CD5;&#x8BFB;&#x53D6;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#x91CC;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x7136;&#x540E;&#x521B;&#x5EFA;&#x65B0;&#x8FDB;&#x7A0B;&#x3002;</p>
<p>&#x6B64;&#x5916;&#xFF0C;&#x8FDE;&#x63A5;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x670D;&#x52A1;&#x7AEF;&#x63A5;&#x53D7;&#x7684;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x7684;connect()&#x64CD;&#x4F5C;&#x4F1A;&#x6267;&#x884C;accpet()&#x64CD;&#x4F5C;&#xFF0C;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x624B;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x901A;&#x8FC7;write()&#x5199;&#x6570;&#x636E;&#xFF0C;&#x670D;&#x52A1;&#x7AEF;&#x901A;&#x8FC7;read()&#x8BFB;&#x6570;&#x636E;&#x3002;</p>
<h3 id="1-3-ZygoteConnection-runOnce"><a href="#1-3-ZygoteConnection-runOnce" class="headerlink" title="1.3 ZygoteConnection.runOnce()"></a>1.3 ZygoteConnection.runOnce()</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;class ZygoteConnection {</span><br><span class="line">    </span><br><span class="line">    boolean runOnce() throws ZygoteInit.MethodAndArgsCaller {</span><br><span class="line">    </span><br><span class="line">            String args[];</span><br><span class="line">            Arguments parsedArgs = null;</span><br><span class="line">            FileDescriptor[] descriptors;</span><br><span class="line">    </span><br><span class="line">            try {</span><br><span class="line">                //&#x8BFB;&#x53D6;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x8FC7;&#x6765;&#x7684;&#x53C2;&#x6570;&#x5217;&#x8868;</span><br><span class="line">                args = readArgumentList();</span><br><span class="line">                descriptors = mSocket.getAncillaryFileDescriptors();</span><br><span class="line">            } catch (IOException ex) {</span><br><span class="line">                Log.w(TAG, &quot;IOException on command socket &quot; + ex.getMessage());</span><br><span class="line">                closeSocket();</span><br><span class="line">                return true;</span><br><span class="line">            }</span><br><span class="line">    </span><br><span class="line">            //... &#x53C2;&#x6570;&#x5904;&#x7406;</span><br><span class="line">    </span><br><span class="line">            try {</span><br><span class="line">                </span><br><span class="line">                //... &#x53C2;&#x6570;&#x5904;&#x7406;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">                //&#x8C03;&#x7528;Zygote.forkAndSpecialize&#xFF08;&#x6765;fork&#x51FA;&#x65B0;&#x8FDB;&#x7A0B;</span><br><span class="line">                pid = Zygote.forkAndSpecialize(parsedArgs.uid, parsedArgs.gid, parsedArgs.gids,</span><br><span class="line">                        parsedArgs.debugFlags, rlimits, parsedArgs.mountExternal, parsedArgs.seInfo,</span><br><span class="line">                        parsedArgs.niceName, fdsToClose, parsedArgs.instructionSet,</span><br><span class="line">                        parsedArgs.appDataDir);</span><br><span class="line">            } catch (ErrnoException ex) {</span><br><span class="line">                logAndPrintError(newStderr, &quot;Exception creating pipe&quot;, ex);</span><br><span class="line">            } catch (IllegalArgumentException ex) {</span><br><span class="line">                logAndPrintError(newStderr, &quot;Invalid zygote arguments&quot;, ex);</span><br><span class="line">            } catch (ZygoteSecurityException ex) {</span><br><span class="line">                logAndPrintError(newStderr,</span><br><span class="line">                        &quot;Zygote security policy prevents request: &quot;, ex);</span><br><span class="line">            }</span><br><span class="line">    </span><br><span class="line">            try {</span><br><span class="line">                //pid == 0&#x65F6;&#x8868;&#x793A;&#x5F53;&#x524D;&#x662F;&#x5728;&#x65B0;&#x521B;&#x5EFA;&#x7684;&#x5B50;&#x8FDB;&#x7A0B;&#x91CD;&#x78C5;&#x6267;&#x884C;</span><br><span class="line">                if (pid == 0) {</span><br><span class="line">                    // in child</span><br><span class="line">                    IoUtils.closeQuietly(serverPipeFd);</span><br><span class="line">                    serverPipeFd = null;</span><br><span class="line">                    handleChildProc(parsedArgs, descriptors, childPipeFd, newStderr);</span><br><span class="line">    </span><br><span class="line">                    // should never get here, the child is expected to either</span><br><span class="line">                    // throw ZygoteInit.MethodAndArgsCaller or exec().</span><br><span class="line">                    return true;</span><br><span class="line">                } </span><br><span class="line">                // pid &lt; 0&#x8868;&#x793A;&#x521B;&#x5EFA;&#x65B0;&#x8FDB;&#x7A0B;&#x5931;&#x8D25;&#xFF0C;pid &gt; 0 &#x8868;&#x793A;&#x5F53;&#x524D;&#x662F;&#x5728;&#x7236;&#x8FDB;&#x7A0B;&#x4E2D;&#x6267;&#x884C;</span><br><span class="line">                else {</span><br><span class="line">                    // in parent...pid of &lt; 0 means failure</span><br><span class="line">                    IoUtils.closeQuietly(childPipeFd);</span><br><span class="line">                    childPipeFd = null;</span><br><span class="line">                    return handleParentProc(pid, descriptors, serverPipeFd, parsedArgs);</span><br><span class="line">                }</span><br><span class="line">            } finally {</span><br><span class="line">                IoUtils.closeQuietly(childPipeFd);</span><br><span class="line">                IoUtils.closeQuietly(serverPipeFd);</span><br><span class="line">            }</span><br><span class="line">     }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8BE5;&#x65B9;&#x6CD5;&#x4E3B;&#x8981;&#x7528;&#x6765;&#x8BFB;&#x53D6;&#x8FDB;&#x7A0B;&#x542F;&#x52A8;&#x53C2;&#x6570;&#xFF0C;&#x7136;&#x540E;&#x8C03;&#x7528;Zygote.forkAndSpecialize()&#x65B9;&#x6CD5;fork&#x51FA;&#x65B0;&#x8FDB;&#x7A0B;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x662F;&#x521B;&#x5EFA;&#x65B0;&#x8FDB;&#x7A0B;&#x7684;&#x6838;&#x5FC3;&#x65B9;&#x6CD5;&#xFF0C;&#x5B83;&#x4E3B;&#x8981;&#x4F1A;&#x9646;&#x7EED;&#x8C03;&#x7528;&#x4E09;&#x4E2A;<br>&#x65B9;&#x6CD5;&#x6765;&#x5B8C;&#x6210;&#x5DE5;&#x4F5C;&#xFF1A;</p>
<ol>
<li>preFork()&#xFF1A;&#x5148;&#x505C;&#x6B62;Zygote&#x8FDB;&#x7A0B;&#x7684;&#x56DB;&#x4E2A;Daemon&#x5B50;&#x7EBF;&#x7A0B;&#x7684;&#x8FD0;&#x884C;&#x4EE5;&#x53CA;&#x521D;&#x59CB;&#x5316;GC&#x5806;&#x3002;&#x8FD9;&#x56DB;&#x4E2A;Daemon&#x5B50;&#x7EBF;&#x7A0B;&#x5206;&#x522B;&#x4E3A;&#xFF1A;Java&#x5806;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x73B0;&#x573A;&#x3001;&#x5806;&#x7EBF;&#x4E0B;&#x5F15;&#x7528;&#x961F;&#x5217;&#x7EBF;&#x7A0B;&#x3001;&#x6790;&#x6784;&#x7EBF;&#x7A0B;&#x4E0E;&#x76D1;&#x63A7;&#x7EBF;&#x7A0B;&#x3002;</li>
<li>nativeForkAndSpecialize()&#xFF1A;&#x8C03;&#x7528;Linux&#x7CFB;&#x7EDF;&#x51FD;&#x6570;fork()&#x521B;&#x5EFA;&#x65B0;&#x8FDB;&#x7A0B;&#xFF0C;&#x521B;&#x5EFA;Java&#x5806;&#x5904;&#x7406;&#x7684;&#x7EBF;&#x7A0B;&#x6C60;&#xFF0C;&#x91CD;&#x7F6E;GC&#x6027;&#x80FD;&#x6570;&#x636E;&#xFF0C;&#x8BBE;&#x7F6E;&#x8FDB;&#x7A0B;&#x7684;&#x4FE1;&#x53F7;&#x5904;&#x7406;&#x51FD;&#x6570;&#xFF0C;&#x542F;&#x52A8;JDWP&#x7EBF;&#x7A0B;&#x3002;</li>
<li>postForkCommon()&#xFF1A;&#x542F;&#x52A8;&#x4E4B;&#x524D;&#x505C;&#x6B62;&#x7684;Zygote&#x8FDB;&#x7A0B;&#x7684;&#x56DB;&#x4E2A;Daemon&#x5B50;&#x7EBF;&#x7A0B;&#x3002;</li>
</ol>
<p>&#x4E0A;&#x9762;&#x7684;&#x65B9;&#x6CD5;&#x90FD;&#x5B8C;&#x6210;&#x4F1A;&#x540E;&#xFF0C;&#x65B0;&#x8FDB;&#x7A0B;&#x4F1A;&#x521B;&#x5EFA;&#x5B8C;&#x6210;&#xFF0C;&#x5E76;&#x8FD4;&#x56DE;pid&#xFF0C;&#x63A5;&#x7740;&#x5C31;&#x8C03;&#x7528;handleChildProc()&#x6765;&#x542F;&#x52A8;&#x65B0;&#x8FDB;&#x7A0B;&#x3002;handleChildProc()&#x65B9;&#x6CD5;&#x4F1A;&#x63A5;&#x7740;&#x8C03;&#x7528;RuntimeInit.zygoteInit()&#x6765;<br>&#x5B8C;&#x6210;&#x65B0;&#x8FDB;&#x7A0B;&#x7684;&#x542F;&#x52A8;&#x3002;</p>
<h3 id="1-4-RuntimeInit-zygoteInit-int-targetSdkVersion-String-argv-ClassLoader-classLoader"><a href="#1-4-RuntimeInit-zygoteInit-int-targetSdkVersion-String-argv-ClassLoader-classLoader" class="headerlink" title="1.4 RuntimeInit.zygoteInit(int targetSdkVersion, String[] argv, ClassLoader classLoader)"></a>1.4 RuntimeInit.zygoteInit(int targetSdkVersion, String[] argv, ClassLoader classLoader)</h3><p>&#x8FD9;&#x4E2A;&#x5C31;&#x662F;&#x4E2A;&#x5173;&#x952E;&#x7684;&#x65B9;&#x6CD5;&#x4E86;&#xFF0C;&#x5B83;&#x4E3B;&#x8981;&#x7528;&#x6765;&#x521B;&#x5EFA;&#x4E00;&#x4E9B;&#x8FD0;&#x884C;&#x65F6;&#x73AF;&#x5883;&#xFF0C;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E00;&#x770B;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public class RuntimeInit {</span><br><span class="line">    </span><br><span class="line">    public static final void zygoteInit(int targetSdkVersion, String[] argv, ClassLoader classLoader)</span><br><span class="line">            throws ZygoteInit.MethodAndArgsCaller {</span><br><span class="line">        if (DEBUG) Slog.d(TAG, &quot;RuntimeInit: Starting application from zygote&quot;);</span><br><span class="line"></span><br><span class="line">        Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, &quot;RuntimeInit&quot;);</span><br><span class="line">        redirectLogStreams();</span><br><span class="line">        //&#x521B;&#x5EFA;&#x5E94;&#x7528;&#x8FDB;&#x7A0B;&#x7684;&#x65F6;&#x533A;&#x548C;&#x952E;&#x76D8;&#x7B49;&#x901A;&#x7528;&#x4FE1;&#x606F;</span><br><span class="line">        commonInit();</span><br><span class="line">        //&#x5728;&#x5E94;&#x7528;&#x8FDB;&#x7A0B;&#x4E2D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;Binder&#x7EBF;&#x7A0B;&#x6C60;</span><br><span class="line">        nativeZygoteInit();</span><br><span class="line">        //&#x521B;&#x5EFA;&#x5E94;&#x7528;&#x4FE1;&#x606F;</span><br><span class="line">        applicationInit(targetSdkVersion, argv, classLoader);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8BE5;&#x65B9;&#x6CD5;&#x4E3B;&#x8981;&#x5B8C;&#x6210;&#x4E09;&#x4EF6;&#x4E8B;&#xFF1A;</p>
<ol>
<li>&#x8C03;&#x7528;commonInit()&#x65B9;&#x6CD5;&#x521B;&#x5EFA;&#x5E94;&#x7528;&#x8FDB;&#x7A0B;&#x7684;&#x65F6;&#x533A;&#x548C;&#x952E;&#x76D8;&#x7B49;&#x901A;&#x7528;&#x4FE1;&#x606F;&#x3002;</li>
<li>&#x8C03;&#x7528;nativeZygoteInit()&#x65B9;&#x6CD5;&#x5728;&#x5E94;&#x7528;&#x8FDB;&#x7A0B;&#x4E2D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;Binder&#x7EBF;&#x7A0B;&#x6C60;&#x3002;</li>
<li>&#x8C03;&#x7528;applicationInit(targetSdkVersion, argv, classLoader)&#x65B9;&#x6CD5;&#x521B;&#x5EFA;&#x5E94;&#x7528;&#x4FE1;&#x606F;&#x3002;</li>
</ol>
<p>Binder&#x7EBF;&#x7A0B;&#x6C60;&#x6211;&#x4EEC;&#x540E;&#x7EED;&#x7684;&#x6587;&#x7AE0;&#x4F1A;&#x5206;&#x6790;&#xFF0C;&#x6211;&#x4EEC;&#x91CD;&#x70B9;&#x6765;&#x770B;&#x770B;applicationInit(targetSdkVersion, argv, classLoader)&#x65B9;&#x6CD5;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x5B83;&#x4E3B;&#x8981;&#x7528;&#x6765;&#x5B8C;&#x6210;&#x5E94;&#x7528;&#x7684;&#x521B;&#x5EFA;&#x3002;</p>
<p>&#x8BE5;&#x65B9;&#x6CD5;&#x91CC;&#x7684;argv&#x53C2;&#x6570;&#x6307;&#x7684;&#x5C31;&#x662F;ActivityThread&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x4F1A;&#x8C03;&#x7528;invokeStaticMain()&#x901A;&#x8FC7;&#x53CD;&#x5C04;&#x7684;&#x65B9;&#x5F0F;&#x8C03;&#x7528;ActivityThread&#x7C7B;&#x7684;main()&#x65B9;&#x6CD5;&#x3002;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public class RuntimeInit {</span><br><span class="line">    </span><br><span class="line">      private static void applicationInit(int targetSdkVersion, String[] argv, ClassLoader classLoader)</span><br><span class="line">              throws ZygoteInit.MethodAndArgsCaller { </span><br><span class="line">          //...</span><br><span class="line">  </span><br><span class="line">          // Remaining arguments are passed to the start class&apos;s static main</span><br><span class="line">          invokeStaticMain(args.startClass, args.startArgs, classLoader);</span><br><span class="line">      }</span><br><span class="line">      </span><br><span class="line">      private static void invokeStaticMain(String className, String[] argv, ClassLoader classLoader)</span><br><span class="line">              throws ZygoteInit.MethodAndArgsCaller {</span><br><span class="line">          Class&lt;?&gt; cl;</span><br><span class="line">          </span><br><span class="line">          //&#x901A;&#x8FC7;&#x53CD;&#x5C04;&#x8C03;&#x7528;ActivityThread&#x7C7B;&#x7684;main()&#x65B9;&#x6CD5;</span><br><span class="line">          try {</span><br><span class="line">              cl = Class.forName(className, true, classLoader);</span><br><span class="line">          } catch (ClassNotFoundException ex) {</span><br><span class="line">              throw new RuntimeException(</span><br><span class="line">                      &quot;Missing class when invoking static main &quot; + className,</span><br><span class="line">                      ex);</span><br><span class="line">          }</span><br><span class="line">  </span><br><span class="line">          Method m;</span><br><span class="line">          try {</span><br><span class="line">              m = cl.getMethod(&quot;main&quot;, new Class[] { String[].class });</span><br><span class="line">          } catch (NoSuchMethodException ex) {</span><br><span class="line">              throw new RuntimeException(</span><br><span class="line">                      &quot;Missing static main on &quot; + className, ex);</span><br><span class="line">          } catch (SecurityException ex) {</span><br><span class="line">              throw new RuntimeException(</span><br><span class="line">                      &quot;Problem getting static main on &quot; + className, ex);</span><br><span class="line">          }</span><br><span class="line">          //...</span><br><span class="line">      }  </span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8D70;&#x5230;ActivityThread&#x7C7B;&#x7684;main()&#x65B9;&#x6CD5;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x5F88;&#x719F;&#x6089;&#x4E86;&#xFF0C;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x5728;main()&#x65B9;&#x6CD5;&#x91CC;&#xFF0C;&#x4F1A;&#x521B;&#x5EFA;&#x4E3B;&#x7EBF;&#x7A0B;Looper&#xFF0C;&#x5E76;&#x5F00;&#x542F;&#x6D88;&#x606F;&#x5FAA;&#x73AF;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public final class ActivityThread {</span><br><span class="line">    </span><br><span class="line">   public static void main(String[] args) {</span><br><span class="line">       //...</span><br><span class="line">       Environment.initForCurrentUser();</span><br><span class="line">       //...</span><br><span class="line">       Process.setArgV0(&quot;&lt;pre-initialized&gt;&quot;);</span><br><span class="line">       //&#x521B;&#x5EFA;&#x4E3B;&#x7EBF;&#x7A0B;looper</span><br><span class="line">       Looper.prepareMainLooper();</span><br><span class="line">   </span><br><span class="line">       ActivityThread thread = new ActivityThread();</span><br><span class="line">       //attach&#x5230;&#x7CFB;&#x7EDF;&#x8FDB;&#x7A0B;</span><br><span class="line">       thread.attach(false);</span><br><span class="line">   </span><br><span class="line">       if (sMainThreadHandler == null) {</span><br><span class="line">           sMainThreadHandler = thread.getHandler();</span><br><span class="line">       }</span><br><span class="line">   </span><br><span class="line">       //&#x4E3B;&#x7EBF;&#x7A0B;&#x8FDB;&#x5165;&#x5FAA;&#x73AF;&#x72B6;&#x6001;</span><br><span class="line">       Looper.loop();</span><br><span class="line">   </span><br><span class="line">       throw new RuntimeException(&quot;Main thread loop unexpectedly exited&quot;);</span><br><span class="line">   } </span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x524D;&#x9762;&#x6211;&#x4EEC;&#x4ECE;Process.start()&#x5F00;&#x59CB;&#x8BB2;&#x8D77;&#xFF0C;&#x5206;&#x6790;&#x4E86;&#x5E94;&#x7528;&#x8FDB;&#x7A0B;&#x7684;&#x521B;&#x5EFA;&#x53CA;&#x542F;&#x52A8;&#x6D41;&#x7A0B;&#xFF0C;&#x65E2;&#x7136;&#x6709;&#x542F;&#x52A8;&#x5C31;&#x4F1A;&#x6709;&#x7ED3;&#x675F;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x4ECE;<br>Process.killProcess()&#x5F00;&#x59CB;&#x8BB2;&#x8D77;&#xFF0C;&#x7EE7;&#x7EED;&#x5206;&#x6790;&#x8FDB;&#x7A0B;&#x7684;&#x7ED3;&#x675F;&#x6D41;&#x7A0B;&#x3002;</p>
<h2 id="&#x4E8C;-&#x8FDB;&#x7A0B;&#x7684;&#x4F18;&#x5148;&#x7EA7;"><a href="#&#x4E8C;-&#x8FDB;&#x7A0B;&#x7684;&#x4F18;&#x5148;&#x7EA7;" class="headerlink" title="&#x4E8C; &#x8FDB;&#x7A0B;&#x7684;&#x4F18;&#x5148;&#x7EA7;"></a>&#x4E8C; &#x8FDB;&#x7A0B;&#x7684;&#x4F18;&#x5148;&#x7EA7;</h2><p>&#x8FDB;&#x7A0B;&#x6309;&#x7167;&#x4F18;&#x5148;&#x7EA7;&#x5927;&#x5C0F;&#x4E0D;&#x540C;&#x53C8;&#x53EF;&#x4EE5;&#x5206;&#x4E3A;&#x5B9E;&#x65F6;&#x8FDB;&#x7A0B;&#x4E0E;&#x666E;&#x901A;&#x8FDB;&#x7A0B;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/acd656fc0acd595fdd9edba5abf0fce0e1d85c03b7a195dd4438b31b8816b7b5" alt><br>prio&#x503C;&#x8D8A;&#x5C0F;&#x8868;&#x793A;&#x8FDB;&#x7A0B;&#x4F18;&#x5148;&#x7EA7;&#x8D8A;&#x9AD8;&#xFF0C;</p>
<ul>
<li>&#x9759;&#x6001;&#x4F18;&#x5148;&#x7EA7;&#xFF1A;&#x4F18;&#x5148;&#x7EA7;&#x4E0D;&#x4F1A;&#x968F;&#x65F6;&#x95F4;&#x6539;&#x53D8;&#xFF0C;&#x5185;&#x6838;&#x4E5F;&#x4E0D;&#x4F1A;&#x4FEE;&#x6539;&#xFF0C;&#x53EA;&#x80FD;&#x901A;&#x8FC7;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x6539;&#x53D8;nice&#x503C;&#xFF0C;&#x4F18;&#x5148;&#x7EA7;&#x6620;&#x5C04;&#x516C;&#x5F0F;&#x4E3A;&#xFF1A;static_prio = MAX_RT_PRIO + nice + 20&#xFF0C;&#x5176;&#x4E2D;MAX_RT_PRIO = 100&#xFF0C;&#x90A3;&#x4E48;&#x53D6;&#x503C;&#x533A;&#x95F4;&#x4E3A;[100, 139]&#xFF1B;&#x5BF9;&#x5E94;&#x666E;&#x901A;&#x8FDB;&#x7A0B;&#xFF1B;</li>
<li>&#x5B9E;&#x65F6;&#x4F18;&#x5148;&#x7EA7;&#xFF1A;&#x53D6;&#x503C;&#x533A;&#x95F4;&#x4E3A;[0, MAX_RT_PRIO -1]&#xFF0C;&#x5176;&#x4E2D;MAX_RT_PRIO = 100&#xFF0C;&#x90A3;&#x4E48;&#x53D6;&#x503C;&#x533A;&#x95F4;&#x4E3A;[0, 99]&#xFF1B;&#x5BF9;&#x5E94;&#x5B9E;&#x65F6;&#x8FDB;&#x7A0B;&#xFF1B;</li>
<li>&#x61C2;&#x7231;&#x4F18;&#x5148;&#x7EA7;&#xFF1A;&#x8C03;&#x5EA6;&#x7A0B;&#x5E8F;&#x901A;&#x8FC7;&#x589E;&#x52A0;&#x6216;&#x8005;&#x51CF;&#x5C11;&#x8FDB;&#x7A0B;&#x4F18;&#x5148;&#x7EA7;&#xFF0C;&#x6765;&#x8FBE;&#x5230;&#x5956;&#x52B1;IO&#x6D88;&#x8017;&#x578B;&#x6216;&#x6309;&#x7167;&#x60E9;&#x7F5A;CPU&#x6D88;&#x8017;&#x578B;&#x7684;&#x8FDB;&#x7A0B;&#x7684;&#x6548;&#x679C;&#x3002;&#x533A;&#x95F4;&#x8303;&#x56F4;[0, MX_PRIO-1]&#xFF0C;&#x5176;&#x4E2D;MX_PRIO = 140&#xFF0C;&#x90A3;&#x4E48;&#x53D6;&#x503C;&#x533A;&#x95F4;&#x4E3A;[0,139]&#xFF1B;</li>
</ul>
<h2 id="&#x4E09;-&#x8FDB;&#x7A0B;&#x8C03;&#x5EA6;&#x6D41;&#x7A0B;"><a href="#&#x4E09;-&#x8FDB;&#x7A0B;&#x8C03;&#x5EA6;&#x6D41;&#x7A0B;" class="headerlink" title="&#x4E09; &#x8FDB;&#x7A0B;&#x8C03;&#x5EA6;&#x6D41;&#x7A0B;"></a>&#x4E09; &#x8FDB;&#x7A0B;&#x8C03;&#x5EA6;&#x6D41;&#x7A0B;</h2><p>&#x8FDB;&#x7A0B;&#x7684;&#x8C03;&#x5EA6;&#x5728;Process&#x7C7B;&#x91CC;&#x5B8C;&#x6210;&#x3002;</p>
<h3 id="3-1-&#x4F18;&#x5148;&#x7EA7;&#x8C03;&#x5EA6;"><a href="#3-1-&#x4F18;&#x5148;&#x7EA7;&#x8C03;&#x5EA6;" class="headerlink" title="3.1 &#x4F18;&#x5148;&#x7EA7;&#x8C03;&#x5EA6;"></a>3.1 &#x4F18;&#x5148;&#x7EA7;&#x8C03;&#x5EA6;</h3><p>&#x4F18;&#x5148;&#x7EA7;&#x8C03;&#x5EA6;&#x65B9;&#x6CD5;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;setThreadPriority(int tid, int priority)</span><br></pre></td></tr></table></figure>

<p>&#x8FDB;&#x7A0B;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x4EE5;&#x53CA;&#x5BF9;&#x5E94;&#x7684;nice&#x503C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<ul>
<li>THREAD_PRIORITY_LOWEST 19 &#x6700;&#x4F4E;&#x4F18;&#x5148;&#x7EA7;</li>
<li>THREAD_PRIORITY_BACKGROUND 10 &#x540E;&#x53F0;</li>
<li>THREAD_PRIORITY_LESS_FAVORABLE 1 &#x6BD4;&#x9ED8;&#x8BA4;&#x7565;&#x4F4E;</li>
<li>THREAD_PRIORITY_DEFAULT 0 &#x9ED8;&#x8BA4;</li>
<li>THREAD_PRIORITY_MORE_FAVORABLE -1 &#x6BD4;&#x9ED8;&#x8BA4;&#x7565;&#x9AD8;</li>
<li>THREAD_PRIORITY_FOREGROUND -2 &#x524D;&#x53F0;</li>
<li>THREAD_PRIORITY_DISPLAY -4 &#x663E;&#x793A;&#x76F8;&#x5173;</li>
<li>THREAD_PRIORITY_URGENT_DISPLAY -8 &#x663E;&#x793A;(&#x66F4;&#x4E3A;&#x91CD;&#x8981;)&#xFF0C;input&#x4E8B;&#x4EF6;</li>
<li>THREAD_PRIORITY_AUDIO -16 &#x97F3;&#x9891;&#x76F8;&#x5173;</li>
<li>THREAD_PRIORITY_URGENT_AUDIO -19 &#x97F3;&#x9891;(&#x66F4;&#x4E3A;&#x91CD;&#x8981;)</li>
</ul>
<h3 id="3-2-&#x7EC4;&#x4F18;&#x5148;&#x7EA7;&#x8C03;&#x5EA6;"><a href="#3-2-&#x7EC4;&#x4F18;&#x5148;&#x7EA7;&#x8C03;&#x5EA6;" class="headerlink" title="3.2 &#x7EC4;&#x4F18;&#x5148;&#x7EA7;&#x8C03;&#x5EA6;"></a>3.2 &#x7EC4;&#x4F18;&#x5148;&#x7EA7;&#x8C03;&#x5EA6;</h3><p>&#x8FDB;&#x7A0B;&#x7EC4;&#x4F18;&#x5148;&#x7EA7;&#x8C03;&#x5EA6;&#x65B9;&#x6CD5;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;setProcessGroup(int pid, int group)</span><br><span class="line">setThreadGroup(int tid, int group)</span><br></pre></td></tr></table></figure>

<p>&#x7EC4;&#x4F18;&#x5148;&#x7EA7;&#x53CA;&#x5BF9;&#x5E94;&#x53D6;&#x503C;</p>
<ul>
<li>THREAD_GROUP_DEFAULT -1 &#x4EC5;&#x7528;&#x4E8E;setProcessGroup&#xFF0C;&#x5C06;&#x4F18;&#x5148;&#x7EA7;&lt;=10&#x7684;&#x8FDB;&#x7A0B;&#x63D0;&#x5347;&#x5230;-2</li>
<li>THREAD_GROUP_BG_NONINTERACTIVE 0 CPU&#x5206;&#x65F6;&#x7684;&#x65F6;&#x957F;&#x7F29;&#x77ED;</li>
<li>THREAD_GROUP_FOREGROUND 1 CPU&#x5206;&#x65F6;&#x7684;&#x65F6;&#x957F;&#x6B63;&#x5E38;</li>
<li>THREAD_GROUP_SYSTEM 2 &#x7CFB;&#x7EDF;&#x7EBF;&#x7A0B;&#x7EC4;</li>
<li>THREAD_GROUP_AUDIO_APP 3 &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x97F3;&#x9891;</li>
<li>THREAD_GROUP_AUDIO_SYS 4 &#x7CFB;&#x7EDF;&#x7A0B;&#x5E8F;&#x97F3;&#x9891;</li>
</ul>
<h3 id="3-3-&#x8C03;&#x5EA6;&#x7B56;&#x7565;"><a href="#3-3-&#x8C03;&#x5EA6;&#x7B56;&#x7565;" class="headerlink" title="3.3 &#x8C03;&#x5EA6;&#x7B56;&#x7565;"></a>3.3 &#x8C03;&#x5EA6;&#x7B56;&#x7565;</h3><p>&#x8C03;&#x5EA6;&#x7B56;&#x7565;&#x8BBE;&#x7F6E;&#x65B9;&#x6CD5;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;setThreadScheduler(int tid, int policy, int priority)</span><br></pre></td></tr></table></figure>

<ul>
<li>SCHED_OTHER &#x9ED8;&#x8BA4; &#x6807;&#x51C6;round-robin&#x5206;&#x65F6;&#x5171;&#x4EAB;&#x7B56;&#x7565;</li>
<li>SCHED_BATCH &#x6279;&#x5904;&#x7406;&#x8C03;&#x5EA6; &#x9488;&#x5BF9;&#x5177;&#x6709;batch&#x98CE;&#x683C;&#xFF08;&#x6279;&#x5904;&#x7406;&#xFF09;&#x8FDB;&#x7A0B;&#x7684;&#x8C03;&#x5EA6;&#x7B56;&#x7565;</li>
<li>SCHED_IDLE &#x7A7A;&#x95F2;&#x8C03;&#x5EA6; &#x9488;&#x5BF9;&#x4F18;&#x5148;&#x7EA7;&#x975E;&#x5E38;&#x4F4E;&#x7684;&#x9002;&#x5408;&#x5728;&#x540E;&#x53F0;&#x8FD0;&#x884C;&#x7684;&#x8FDB;&#x7A0B;</li>
<li>SCHED_FIFO &#x5148;&#x8FDB;&#x5148;&#x51FA; &#x5B9E;&#x65F6;&#x8C03;&#x5EA6;&#x7B56;&#x7565;&#xFF0C;android&#x6682;&#x672A;&#x5B9E;&#x73B0;</li>
<li>SCHED_RR &#x5FAA;&#x73AF;&#x8C03;&#x5EA6; &#x5B9E;&#x65F6;&#x8C03;&#x5EA6;&#x7B56;&#x7565;&#xFF0C;android&#x6682;&#x672A;&#x5B9E;&#x73B0;</li>
</ul>
<h3 id="3-4-&#x8FDB;&#x7A0B;adj&#x8C03;&#x5EA6;"><a href="#3-4-&#x8FDB;&#x7A0B;adj&#x8C03;&#x5EA6;" class="headerlink" title="3.4 &#x8FDB;&#x7A0B;adj&#x8C03;&#x5EA6;"></a>3.4 &#x8FDB;&#x7A0B;adj&#x8C03;&#x5EA6;</h3><p>&#x53E6;&#x5916;&#x9664;&#x4E86;&#x8FD9;&#x4E9B;&#x57FA;&#x672C;&#x7684;&#x8C03;&#x5EA6;&#x7B56;&#x7565;&#xFF0C;Android&#x7CFB;&#x7EDF;&#x8FD8;&#x5B9A;&#x4E49;&#x4E86;&#x4E24;&#x4E2A;&#x548C;&#x8FDB;&#x7A0B;&#x76F8;&#x5173;&#x7684;&#x72B6;&#x6001;&#x503C;&#xFF0C;&#x4E00;&#x4E2A;&#x5C31;&#x662F;&#x5B9A;&#x4E49;&#x5728;ProcessList.java&#x91CC;&#x7684;adj&#x503C;&#xFF0C;&#x53E6;&#x4E00;&#x4E2A;<br>&#x662F;&#x5B9A;&#x4E49;&#x5728;ActivityManager.java&#x91CC;&#x7684;procState&#x503C;&#x3002;</p>
<blockquote>
<p>&#x5B9A;&#x4E49;&#x5728;ProcessList.java&#x6587;&#x4EF6;&#xFF0C;oom_adj&#x5212;&#x5206;&#x4E3A;16&#x7EA7;&#xFF0C;&#x4ECE;-17&#x5230;16&#x4E4B;&#x95F4;&#x53D6;&#x503C;&#x3002;</p>
</blockquote>
<ul>
<li>UNKNOWN_ADJ 16 &#x4E00;&#x822C;&#x6307;&#x5C06;&#x8981;&#x4F1A;&#x7F13;&#x5B58;&#x8FDB;&#x7A0B;&#xFF0C;&#x65E0;&#x6CD5;&#x83B7;&#x53D6;&#x786E;&#x5B9A;&#x503C;</li>
<li><strong>CACHED_APP_MAX_ADJ 15 &#x4E0D;&#x53EF;&#x89C1;&#x8FDB;&#x7A0B;&#x7684;adj&#x6700;&#x5927;&#x503C; 1</strong></li>
<li><strong>CACHED_APP_MIN_ADJ 9 &#x4E0D;&#x53EF;&#x89C1;&#x8FDB;&#x7A0B;&#x7684;adj&#x6700;&#x5C0F;&#x503C; 2</strong></li>
<li>SERVICE_B_AD 8 B List&#x4E2D;&#x7684;Service&#xFF08;&#x8F83;&#x8001;&#x7684;&#x3001;&#x4F7F;&#x7528;&#x53EF;&#x80FD;&#x6027;&#x66F4;&#x5C0F;&#xFF09;</li>
<li>PREVIOUS_APP_ADJ 7 &#x4E0A;&#x4E00;&#x4E2A;App&#x7684;&#x8FDB;&#x7A0B;(&#x5F80;&#x5F80;&#x901A;&#x8FC7;&#x6309;&#x8FD4;&#x56DE;&#x952E;)</li>
<li>HOME_APP_ADJ 6 Home&#x8FDB;&#x7A0B;</li>
<li>SERVICE_ADJ 5 &#x670D;&#x52A1;&#x8FDB;&#x7A0B;(Service process)</li>
<li>HEAVY_WEIGHT_APP_ADJ 4 &#x540E;&#x53F0;&#x7684;&#x91CD;&#x91CF;&#x7EA7;&#x8FDB;&#x7A0B;&#xFF0C;system/rootdir/init.rc&#x6587;&#x4EF6;&#x4E2D;&#x8BBE;&#x7F6E;</li>
<li><strong>BACKUP_APP_ADJ 3 &#x5907;&#x4EFD;&#x8FDB;&#x7A0B; 3</strong></li>
<li><strong>PERCEPTIBLE_APP_ADJ 2 &#x53EF;&#x611F;&#x77E5;&#x8FDB;&#x7A0B;&#xFF0C;&#x6BD4;&#x5982;&#x540E;&#x53F0;&#x97F3;&#x4E50;&#x64AD;&#x653E; 4</strong></li>
<li><strong>VISIBLE_APP_ADJ 1 &#x53EF;&#x89C1;&#x8FDB;&#x7A0B;(Visible process) 5</strong></li>
<li><strong>FOREGROUND_APP_ADJ 0 &#x524D;&#x53F0;&#x8FDB;&#x7A0B;&#xFF08;Foreground process&#xFF09; 6</strong></li>
<li>PERSISTENT_SERVICE_ADJ -11 &#x5173;&#x8054;&#x7740;&#x7CFB;&#x7EDF;&#x6216;persistent&#x8FDB;&#x7A0B;</li>
<li>PERSISTENT_PROC_ADJ -12 &#x7CFB;&#x7EDF;persistent&#x8FDB;&#x7A0B;&#xFF0C;&#x6BD4;&#x5982;telephony</li>
<li>SYSTEM_ADJ -16 &#x7CFB;&#x7EDF;&#x8FDB;&#x7A0B;</li>
<li>NATIVE_ADJ -17 native&#x8FDB;&#x7A0B;&#xFF08;&#x4E0D;&#x88AB;&#x7CFB;&#x7EDF;&#x7BA1;&#x7406;&#xFF09;</li>
</ul>
<p>&#x66F4;&#x65B0;&#x8FDB;&#x7A0B;adj&#x503C;&#x7684;&#x65B9;&#x6CD5;&#x5B9A;&#x4E49;&#x5728;ActivityManagerService&#x4E2D;&#xFF0C;&#x5206;&#x522B;&#x4E3A;&#xFF1A;</p>
<ul>
<li>updateOomAdjLocked&#xFF1A;&#x66F4;&#x65B0;adj&#xFF0C;&#x5F53;&#x76EE;&#x6807;&#x8FDB;&#x7A0B;&#x4E3A;&#x7A7A;&#xFF0C;&#x6216;&#x8005;&#x88AB;&#x6740;&#x5219;&#x8FD4;&#x56DE;false&#xFF1B;&#x5426;&#x5219;&#x8FD4;&#x56DE;true;</li>
<li>computeOomAdjLocked&#xFF1A;&#x8BA1;&#x7B97;adj&#xFF0C;&#x8FD4;&#x56DE;&#x8BA1;&#x7B97;&#x540E;RawAdj&#x503C;;</li>
<li>applyOomAdjLocked&#xFF1A;&#x5E94;&#x7528;adj&#xFF0C;&#x5F53;&#x9700;&#x8981;&#x6740;&#x6389;&#x76EE;&#x6807;&#x8FDB;&#x7A0B;&#x5219;&#x8FD4;&#x56DE;false&#xFF1B;&#x5426;&#x5219;&#x8FD4;&#x56DE;true&#x3002;</li>
</ul>
<p>&#x90A3;&#x4E48;&#x8FDB;&#x7A0B;&#x7684;adj&#x503C;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x4F1A;&#x88AB;&#x66F4;&#x65B0;&#x5462;&#xFF1F;&#x1F914;</p>
<p><strong>Activity</strong></p>
<ul>
<li>ActivityManagerService.realStartActivityLocked: &#x542F;&#x52A8;Activity</li>
<li>ActivityStack.resumeTopActivityInnerLocked: &#x6062;&#x590D;&#x6808;&#x9876;Activity</li>
<li>ActivityStack.finishCurrentActivityLocked: &#x7ED3;&#x675F;&#x5F53;&#x524D;Activity</li>
<li>ActivityStack.destroyActivityLocked: &#x6467;&#x6BC1;&#x5F53;&#x524D;Activity</li>
</ul>
<p><strong>Service</strong></p>
<ul>
<li>ActiveServices.realStartServiceLocked: &#x542F;&#x52A8;&#x670D;&#x52A1;</li>
<li>ActiveServices.bindServiceLocked: &#x7ED1;&#x5B9A;&#x670D;&#x52A1;(&#x53EA;&#x66F4;&#x65B0;&#x5F53;&#x524D;app)</li>
<li>ActiveServices.unbindServiceLocked: &#x89E3;&#x7ED1;&#x670D;&#x52A1; (&#x53EA;&#x66F4;&#x65B0;&#x5F53;&#x524D;app)</li>
<li>ActiveServices.bringDownServiceLocked: &#x7ED3;&#x675F;&#x670D;&#x52A1; (&#x53EA;&#x66F4;&#x65B0;&#x5F53;&#x524D;app)</li>
<li>ActiveServices.sendServiceArgsLocked: &#x5728;bringup&#x6216;&#x5219;cleanup&#x670D;&#x52A1;&#x8FC7;&#x7A0B;&#x8C03;&#x7528; (&#x53EA;&#x66F4;&#x65B0;&#x5F53;&#x524D;app)</li>
</ul>
<p><strong>BroadcastReceiver</strong></p>
<ul>
<li>BroadcastQueue.processNextBroadcast: &#x5904;&#x7406;&#x4E0B;&#x4E00;&#x4E2A;&#x5E7F;&#x64AD;</li>
<li>BroadcastQueue.processCurBroadcastLocked: &#x5904;&#x7406;&#x5F53;&#x524D;&#x5E7F;&#x64AD;</li>
<li>BroadcastQueue.deliverToRegisteredReceiverLocked: &#x5206;&#x53D1;&#x5DF2;&#x6CE8;&#x518C;&#x7684;&#x5E7F;&#x64AD; (&#x53EA;&#x66F4;&#x65B0;&#x5F53;&#x524D;app)</li>
</ul>
<p><strong>ContentProvider</strong></p>
<ul>
<li>ActivityManagerService.removeContentProvider: &#x79FB;&#x9664;provider</li>
<li>ActivityManagerService.publishContentProviders: &#x53D1;&#x5E03;provider (&#x53EA;&#x66F4;&#x65B0;&#x5F53;&#x524D;app)</li>
<li>ActivityManagerService.getContentProviderImpl: &#x83B7;&#x53D6;provider (&#x53EA;&#x66F4;&#x65B0;&#x5F53;&#x524D;app)</li>
</ul>
<p>&#x53E6;&#x5916;&#xFF0C;Lowmemorykiller&#x4E5F;&#x4F1A;&#x6839;&#x636E;&#x5F53;&#x524D;&#x7684;&#x5185;&#x5B58;&#x60C5;&#x51B5;&#x9010;&#x7EA7;&#x8FDB;&#x884C;&#x8FDB;&#x7A0B;&#x91CA;&#x653E;&#xFF0C;&#x4E00;&#x5171;&#x6709;&#x516D;&#x4E2A;&#x7EA7;&#x522B;&#xFF08;&#x4E0A;&#x9762;&#x52A0;&#x7C97;&#x7684;&#x90E8;&#x5206;&#xFF09;&#xFF1A;</p>
<ul>
<li>CACHED_APP_MAX_ADJ</li>
<li>CACHED_APP_MIN_ADJ</li>
<li>BACKUP_APP_ADJ</li>
<li>PERCEPTIBLE_APP_ADJ</li>
<li>VISIBLE_APP_ADJ</li>
<li>FOREGROUND_APP_ADJ</li>
</ul>
<blockquote>
<p>&#x5B9A;&#x4E49;&#x5728;ActivityManager.java&#x6587;&#x4EF6;&#xFF0C;process_state&#x5212;&#x5206;18&#x7C7B;&#xFF0C;&#x4ECE;-1&#x5230;16&#x4E4B;&#x95F4;&#x53D6;&#x503C;</p>
</blockquote>
<ul>
<li>PROCESS_STATE_CACHED_EMPTY 16 &#x8FDB;&#x7A0B;&#x5904;&#x4E8E;cached&#x72B6;&#x6001;&#xFF0C;&#x4E14;&#x4E3A;&#x7A7A;&#x8FDB;&#x7A0B;</li>
<li>PROCESS_STATE_CACHED_ACTIVITY_CLIENT 15 &#x8FDB;&#x7A0B;&#x5904;&#x4E8E;cached&#x72B6;&#x6001;&#xFF0C;&#x4E14;&#x4E3A;&#x53E6;&#x4E00;&#x4E2A;cached&#x8FDB;&#x7A0B;(&#x5185;&#x542B;Activity)&#x7684;client&#x8FDB;&#x7A0B;</li>
<li>PROCESS_STATE_CACHED_ACTIVITY 14 &#x8FDB;&#x7A0B;&#x5904;&#x4E8E;cached&#x72B6;&#x6001;&#xFF0C;&#x4E14;&#x5185;&#x542B;Activity</li>
<li>PROCESS_STATE_LAST_ACTIVITY 13 &#x540E;&#x53F0;&#x8FDB;&#x7A0B;&#xFF0C;&#x4E14;&#x62E5;&#x6709;&#x4E0A;&#x4E00;&#x6B21;&#x663E;&#x793A;&#x7684;Activity</li>
<li>PROCESS_STATE_HOME 12 &#x540E;&#x53F0;&#x8FDB;&#x7A0B;&#xFF0C;&#x4E14;&#x62E5;&#x6709;home Activity</li>
<li>PROCESS_STATE_RECEIVER 11 &#x540E;&#x53F0;&#x8FDB;&#x7A0B;&#xFF0C;&#x4E14;&#x6B63;&#x5728;&#x8FD0;&#x884C;receiver</li>
<li>PROCESS_STATE_SERVICE 10 &#x540E;&#x53F0;&#x8FDB;&#x7A0B;&#xFF0C;&#x4E14;&#x6B63;&#x5728;&#x8FD0;&#x884C;service</li>
<li>PROCESS_STATE_HEAVY_WEIGHT 9 &#x540E;&#x53F0;&#x8FDB;&#x7A0B;&#xFF0C;&#x4F46;&#x65E0;&#x6CD5;&#x6267;&#x884C;restore&#xFF0C;&#x56E0;&#x6B64;&#x5C3D;&#x91CF;&#x907F;&#x514D;kill&#x8BE5;&#x8FDB;&#x7A0B;</li>
<li>PROCESS_STATE_BACKUP 8 &#x540E;&#x53F0;&#x8FDB;&#x7A0B;&#xFF0C;&#x6B63;&#x5728;&#x8FD0;&#x884C;backup/restore&#x64CD;&#x4F5C;</li>
<li>PROCESS_STATE_IMPORTANT_BACKGROUND 7 &#x5BF9;&#x7528;&#x6237;&#x5F88;&#x91CD;&#x8981;&#x7684;&#x8FDB;&#x7A0B;&#xFF0C;&#x7528;&#x6237;&#x4E0D;&#x53EF;&#x611F;&#x77E5;&#x5176;&#x5B58;&#x5728;</li>
<li>PROCESS_STATE_IMPORTANT_FOREGROUND 6 &#x5BF9;&#x7528;&#x6237;&#x5F88;&#x91CD;&#x8981;&#x7684;&#x8FDB;&#x7A0B;&#xFF0C;&#x7528;&#x6237;&#x53EF;&#x611F;&#x77E5;&#x5176;&#x5B58;&#x5728;</li>
<li>PROCESS_STATE_TOP_SLEEPING 5 &#x4E0E;PROCESS_STATE_TOP&#x4E00;&#x6837;&#xFF0C;&#x4F46;&#x6B64;&#x65F6;&#x8BBE;&#x5907;&#x6B63;&#x5904;&#x4E8E;&#x4F11;&#x7720;&#x72B6;&#x6001;</li>
<li>PROCESS_STATE_FOREGROUND_SERVICE 4 &#x62E5;&#x6709;&#x7ED9;&#x4E00;&#x4E2A;&#x524D;&#x53F0;Service</li>
<li>PROCESS_STATE_BOUND_FOREGROUND_SERVICE 3 &#x62E5;&#x6709;&#x7ED9;&#x4E00;&#x4E2A;&#x524D;&#x53F0;Service&#xFF0C;&#x4E14;&#x7531;&#x7CFB;&#x7EDF;&#x7ED1;&#x5B9A;</li>
<li>PROCESS_STATE_TOP 2 &#x62E5;&#x6709;&#x5F53;&#x524D;&#x7528;&#x6237;&#x53EF;&#x89C1;&#x7684;top Activity</li>
<li>PROCESS_STATE_PERSISTENT_UI 1 persistent&#x7CFB;&#x7EDF;&#x8FDB;&#x7A0B;&#xFF0C;&#x5E76;&#x6B63;&#x5728;&#x6267;&#x884C;UI&#x64CD;&#x4F5C;</li>
<li>PROCESS_STATE_PERSISTENT 0 persistent&#x7CFB;&#x7EDF;&#x8FDB;&#x7A0B;</li>
<li>PROCESS_STATE_NONEXISTENT -1 &#x4E0D;&#x5B58;&#x5728;&#x7684;&#x8FDB;&#x7A0B;</li>
</ul>
<p>&#x6839;&#x636E;&#x4E0A;&#x9762;&#x8BF4;&#x63CF;&#x8FF0;&#x7684;adj&#x503C;&#x548C;state&#x503C;&#xFF0C;&#x6211;&#x4EEC;&#x53C8;&#x53EF;&#x4EE5;&#x6309;&#x7167;&#x91CD;&#x8981;&#x6027;&#x7A0B;&#x5EA6;&#x7684;&#x4E0D;&#x540C;&#xFF0C;&#x5C06;&#x8FDB;&#x7A0B;&#x5212;&#x5206;&#x4E3A;&#x4E94;&#x7EA7;&#xFF1A;</p>
<p><strong>&#x524D;&#x53F0;&#x8FDB;&#x7A0B;</strong></p>
<p>&#x7528;&#x6237;&#x5F53;&#x524D;&#x64CD;&#x4F5C;&#x6240;&#x5FC5;&#x9700;&#x7684;&#x8FDB;&#x7A0B;&#x3002;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x6EE1;&#x8DB3;&#x4EE5;&#x4E0B;&#x4EFB;&#x4E00;&#x6761;&#x4EF6;&#xFF0C;&#x5373;&#x89C6;&#x4E3A;&#x524D;&#x53F0;&#x8FDB;&#x7A0B;&#xFF1A;</p>
<ul>
<li>&#x6258;&#x7BA1;&#x7528;&#x6237;&#x6B63;&#x5728;&#x4EA4;&#x4E92;&#x7684; Activity&#xFF08;&#x5DF2;&#x8C03;&#x7528; Activity &#x7684; onResume() &#x65B9;&#x6CD5;&#xFF09;</li>
<li>&#x6258;&#x7BA1;&#x67D0;&#x4E2A; Service&#xFF0C;&#x540E;&#x8005;&#x7ED1;&#x5B9A;&#x5230;&#x7528;&#x6237;&#x6B63;&#x5728;&#x4EA4;&#x4E92;&#x7684; Activity</li>
<li>&#x6258;&#x7BA1;&#x6B63;&#x5728;&#x201C;&#x524D;&#x53F0;&#x201D;&#x8FD0;&#x884C;&#x7684; Service&#xFF08;&#x670D;&#x52A1;&#x5DF2;&#x8C03;&#x7528; startForeground()&#xFF09;</li>
<li>&#x6258;&#x7BA1;&#x6B63;&#x6267;&#x884C;&#x4E00;&#x4E2A;&#x751F;&#x547D;&#x5468;&#x671F;&#x56DE;&#x8C03;&#x7684; Service&#xFF08;onCreate()&#x3001;onStart() &#x6216; onDestroy()&#xFF09;</li>
<li>&#x6258;&#x7BA1;&#x6B63;&#x6267;&#x884C;&#x5176; onReceive() &#x65B9;&#x6CD5;&#x7684; BroadcastReceiver</li>
</ul>
<p>&#x901A;&#x5E38;&#xFF0C;&#x5728;&#x4EFB;&#x610F;&#x7ED9;&#x5B9A;&#x65F6;&#x95F4;&#x524D;&#x53F0;&#x8FDB;&#x7A0B;&#x90FD;&#x4E3A;&#x6570;&#x4E0D;&#x591A;&#x3002;&#x53EA;&#x6709;&#x5728;&#x5185;&#x5B58;&#x4E0D;&#x8DB3;&#x4EE5;&#x652F;&#x6301;&#x5B83;&#x4EEC;&#x540C;&#x65F6;&#x7EE7;&#x7EED;&#x8FD0;&#x884C;&#x8FD9;&#x4E00;&#x4E07;&#x4E0D;&#x5F97;&#x5DF2;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x7CFB;&#x7EDF;&#x624D;&#x4F1A;&#x7EC8;&#x6B62;&#x5B83;&#x4EEC;&#x3002; &#x6B64;&#x65F6;&#xFF0C;&#x8BBE;&#x5907;&#x5F80;&#x5F80;&#x5DF2;&#x8FBE;&#x5230;&#x5185;&#x5B58;&#x5206;&#x9875;&#x72B6;&#x6001;&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x7EC8;&#x6B62;&#x4E00;&#x4E9B;&#x524D;&#x53F0;&#x8FDB;&#x7A0B;&#x6765;&#x786E;&#x4FDD;&#x7528;&#x6237;&#x754C;&#x9762;&#x6B63;&#x5E38;&#x54CD;&#x5E94;&#x3002;</p>
<p><strong>&#x53EF;&#x89C1;&#x8FDB;&#x7A0B;</strong></p>
<p>&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x524D;&#x53F0;&#x7EC4;&#x4EF6;&#x3001;&#x4F46;&#x4ECD;&#x4F1A;&#x5F71;&#x54CD;&#x7528;&#x6237;&#x5728;&#x5C4F;&#x5E55;&#x4E0A;&#x6240;&#x89C1;&#x5185;&#x5BB9;&#x7684;&#x8FDB;&#x7A0B;&#x3002; &#x5982;&#x679C;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x6EE1;&#x8DB3;&#x4EE5;&#x4E0B;&#x4EFB;&#x4E00;&#x6761;&#x4EF6;&#xFF0C;&#x5373;&#x89C6;&#x4E3A;&#x53EF;&#x89C1;&#x8FDB;&#x7A0B;&#xFF1A;</p>
<ul>
<li>&#x6258;&#x7BA1;&#x4E0D;&#x5728;&#x524D;&#x53F0;&#x3001;&#x4F46;&#x4ECD;&#x5BF9;&#x7528;&#x6237;&#x53EF;&#x89C1;&#x7684; Activity&#xFF08;&#x5DF2;&#x8C03;&#x7528;&#x5176; onPause() &#x65B9;&#x6CD5;&#xFF09;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x524D;&#x53F0; Activity &#x542F;&#x52A8;&#x4E86;&#x4E00;&#x4E2A;&#x5BF9;&#x8BDD;&#x6846;&#xFF0C;&#x5141;&#x8BB8;&#x5728;&#x5176;&#x540E;&#x663E;&#x793A;&#x4E0A;&#x4E00; Activity&#xFF0C;&#x5219;&#x6709;&#x53EF;&#x80FD;&#x4F1A;&#x53D1;&#x751F;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x3002;</li>
<li>&#x6258;&#x7BA1;&#x7ED1;&#x5B9A;&#x5230;&#x53EF;&#x89C1;&#xFF08;&#x6216;&#x524D;&#x53F0;&#xFF09;Activity &#x7684; Service&#x3002;</li>
</ul>
<p>&#x53EF;&#x89C1;&#x8FDB;&#x7A0B;&#x88AB;&#x89C6;&#x4E3A;&#x662F;&#x6781;&#x5176;&#x91CD;&#x8981;&#x7684;&#x8FDB;&#x7A0B;&#xFF0C;&#x9664;&#x975E;&#x4E3A;&#x4E86;&#x7EF4;&#x6301;&#x6240;&#x6709;&#x524D;&#x53F0;&#x8FDB;&#x7A0B;&#x540C;&#x65F6;&#x8FD0;&#x884C;&#x800C;&#x5FC5;&#x987B;&#x7EC8;&#x6B62;&#xFF0C;&#x5426;&#x5219;&#x7CFB;&#x7EDF;&#x4E0D;&#x4F1A;&#x7EC8;&#x6B62;&#x8FD9;&#x4E9B;&#x8FDB;&#x7A0B;&#x3002;</p>
<p><strong>&#x670D;&#x52A1;&#x8FDB;&#x7A0B;</strong></p>
<p>&#x6B63;&#x5728;&#x8FD0;&#x884C;&#x5DF2;&#x4F7F;&#x7528; startService() &#x65B9;&#x6CD5;&#x542F;&#x52A8;&#x7684;&#x670D;&#x52A1;&#x4E14;&#x4E0D;&#x5C5E;&#x4E8E;&#x4E0A;&#x8FF0;&#x4E24;&#x4E2A;&#x66F4;&#x9AD8;&#x7C7B;&#x522B;&#x8FDB;&#x7A0B;&#x7684;&#x8FDB;&#x7A0B;&#x3002;&#x5C3D;&#x7BA1;&#x670D;&#x52A1;&#x8FDB;&#x7A0B;&#x4E0E;&#x7528;&#x6237;&#x6240;&#x89C1;&#x5185;&#x5BB9;&#x6CA1;&#x6709;&#x76F4;&#x63A5;&#x5173;&#x8054;&#xFF0C;&#x4F46;&#x662F;&#x5B83;&#x4EEC;&#x901A;&#x5E38;&#x5728;&#x6267;&#x884C;&#x4E00;&#x4E9B;&#x7528;&#x6237;&#x5173;<br>&#x5FC3;&#x7684;&#x64CD;&#x4F5C;&#xFF08;&#x4F8B;&#x5982;&#xFF0C;&#x5728;&#x540E;&#x53F0;&#x64AD;&#x653E;&#x97F3;&#x4E50;&#x6216;&#x4ECE;&#x7F51;&#x7EDC;&#x4E0B;&#x8F7D;&#x6570;&#x636E;&#xFF09;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x9664;&#x975E;&#x5185;&#x5B58;&#x4E0D;&#x8DB3;&#x4EE5;&#x7EF4;&#x6301;&#x6240;&#x6709;&#x524D;&#x53F0;&#x8FDB;&#x7A0B;&#x548C;&#x53EF;&#x89C1;&#x8FDB;&#x7A0B;&#x540C;&#x65F6;&#x8FD0;&#x884C;&#xFF0C;&#x5426;&#x5219;&#x7CFB;&#x7EDF;&#x4F1A;&#x8BA9;&#x670D;&#x52A1;&#x8FDB;&#x7A0B;&#x4FDD;&#x6301;&#x8FD0;&#x884C;&#x72B6;&#x6001;&#x3002;</p>
<p><strong>&#x540E;&#x53F0;&#x8FDB;&#x7A0B;</strong></p>
<p>&#x5305;&#x542B;&#x76EE;&#x524D;&#x5BF9;&#x7528;&#x6237;&#x4E0D;&#x53EF;&#x89C1;&#x7684; Activity &#x7684;&#x8FDB;&#x7A0B;&#xFF08;&#x5DF2;&#x8C03;&#x7528; Activity &#x7684; onStop() &#x65B9;&#x6CD5;&#xFF09;&#x3002;&#x8FD9;&#x4E9B;&#x8FDB;&#x7A0B;&#x5BF9;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#x6CA1;&#x6709;&#x76F4;&#x63A5;&#x5F71;&#x54CD;&#xFF0C;&#x7CFB;&#x7EDF;&#x53EF;&#x80FD;&#x968F;&#x65F6;&#x7EC8;&#x6B62;&#x5B83;&#x4EEC;&#xFF0C;&#x4EE5;&#x56DE;&#x6536;&#x5185;&#x5B58;&#x4F9B;&#x524D;&#x53F0;&#x8FDB;&#x7A0B;&#x3001;&#x53EF;&#x89C1;&#x8FDB;&#x7A0B;&#x6216;&#x670D;&#x52A1;&#x8FDB;&#x7A0B;&#x4F7F;&#x7528;&#x3002; &#x901A;&#x5E38;&#x4F1A;&#x6709;&#x5F88;&#x591A;&#x540E;&#x53F0;&#x8FDB;&#x7A0B;&#x5728;&#x8FD0;&#x884C;&#xFF0C;&#x56E0;&#x6B64;&#x5B83;&#x4EEC;&#x4F1A;&#x4FDD;&#x5B58;&#x5728; LRU &#xFF08;&#x6700;&#x8FD1;&#x6700;&#x5C11;&#x4F7F;&#x7528;&#xFF09;&#x5217;&#x8868;&#x4E2D;&#xFF0C;&#x4EE5;&#x786E;&#x4FDD;&#x5305;&#x542B;&#x7528;&#x6237;&#x6700;&#x8FD1;&#x67E5;&#x770B;&#x7684; Activity &#x7684;&#x8FDB;&#x7A0B;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x88AB;&#x7EC8;&#x6B62;&#x3002;&#x5982;&#x679C;&#x67D0;&#x4E2A; Activity &#x6B63;&#x786E;&#x5B9E;&#x73B0;&#x4E86;&#x751F;&#x547D;&#x5468;&#x671F;&#x65B9;&#x6CD5;&#xFF0C;&#x5E76;&#x4FDD;&#x5B58;&#x4E86;&#x5176;&#x5F53;&#x524D;&#x72B6;&#x6001;&#xFF0C;&#x5219;&#x7EC8;&#x6B62;&#x5176;&#x8FDB;&#x7A0B;&#x4E0D;&#x4F1A;&#x5BF9;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#x4EA7;&#x751F;&#x660E;&#x663E;&#x5F71;&#x54CD;&#xFF0C;&#x56E0;&#x4E3A;&#x5F53;&#x7528;&#x6237;&#x5BFC;&#x822A;&#x56DE;&#x8BE5; Activity &#x65F6;&#xFF0C;Activity &#x4F1A;&#x6062;&#x590D;&#x5176;&#x6240;&#x6709;&#x53EF;&#x89C1;&#x72B6;&#x6001;&#x3002;</p>
<p><strong>&#x7A7A;&#x8FDB;&#x7A0B;</strong></p>
<p>&#x4E0D;&#x542B;&#x4EFB;&#x4F55;&#x6D3B;&#x52A8;&#x5E94;&#x7528;&#x7EC4;&#x4EF6;&#x7684;&#x8FDB;&#x7A0B;&#x3002;&#x4FDD;&#x7559;&#x8FD9;&#x79CD;&#x8FDB;&#x7A0B;&#x7684;&#x7684;&#x552F;&#x4E00;&#x76EE;&#x7684;&#x662F;&#x7528;&#x4F5C;&#x7F13;&#x5B58;&#xFF0C;&#x4EE5;&#x7F29;&#x77ED;&#x4E0B;&#x6B21;&#x5728;&#x5176;&#x4E2D;&#x8FD0;&#x884C;&#x7EC4;&#x4EF6;&#x6240;&#x9700;&#x7684;&#x542F;&#x52A8;&#x65F6;&#x95F4;&#x3002; &#x4E3A;&#x4F7F;&#x603B;&#x4F53;&#x7CFB;&#x7EDF;&#x8D44;&#x6E90;&#x5728;&#x8FDB;&#x7A0B;&#x7F13;&#x5B58;&#x548C;&#x5E95;&#x5C42;&#x5185;&#x6838;&#x7F13;&#x5B58;&#x4E4B;&#x95F4;&#x4FDD;&#x6301;&#x5E73;&#x8861;&#xFF0C;&#x7CFB;&#x7EDF;&#x5F80;&#x5F80;&#x4F1A;&#x7EC8;&#x6B62;&#x8FD9;&#x4E9B;&#x8FDB;&#x7A0B;&#x3002;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/4b421aca2f1dae75a6c6dd1c246a100a.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903524485038088.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903524485038088.html" itemprop="url">Python web 开发框架 Pyramid</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-19T11:21:38+08:00">
                2018-01-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>&#x535A;&#x5BA2;&#x5730;&#x5740;&#xFF1A;<a href="/external_links/f0be001315fdee3fad881fa8e0c396ba.html" target="blank" rel="noopener">https://ask.hellobi.com/blog/zhiji</a></strong> &#x6B22;&#x8FCE;&#x5927;&#x5BB6;&#x6765;&#x4EA4;&#x6D41;&#x5B66;&#x4E60;&#x3002;</p>
<p>&#x5728;Python web &#x5F00;&#x53D1;&#x6846;&#x67B6;&#x91CC;&#x6709;&#x591A;&#x79CD;&#x9009;&#x62E9;&#xFF0C;&#x6709;**<a href="/external_links/be7091e1f7f37c4c3aa2fde5bee33a47.html" target="blank" rel="noopener">Django</a><strong>&#x3001;</strong><a href="/external_links/ae2257841dc0ebd318065b657a14bd82.html" target="blank" rel="noopener">Tornado</a><strong>&#x3001;Flask&#x3001;web2py&#x3001;Pylons&#x3001;Pyramid&#x7B49;&#x7B49;&#xFF0C;&#x4E4B;&#x524D;&#x5199;&#x8FC7;Django&#x3001;Tornado&#xFF0C;&#x4ECA;&#x5929;&#x6211;&#x4EEC;&#x4E3B;&#x8981;&#x5B66;&#x4E60;</strong>Pyramid**&#xFF0C;&#x8FD8;&#x662F;&#x4ECE;&#x5B98;&#x65B9;&#x6587;&#x6863;&#x5B66;&#x8D77;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/1c00e16c0db1f129d7b8b87fad27646fdfc393600d20182fa7eb94682601b913" alt="&#x5B98;&#x65B9;&#x6587;&#x6863; = &#x65B0;&#x534E;&#x5B57;&#x5178;"></p>
<ul>
<li><strong><a href="/external_links/7464c03a5f6edd7fad7a4fb91a64931b.html" target="blank" rel="noopener">&#x5B98;&#x65B9;&#x6587;&#x6863;</a></strong></li>
<li><strong>&#x82F1;&#x6587;&#x6559;&#x7A0B;&#xFF1A;<a href="/external_links/0d4e1bdcc3af7e60f19c899e25ac4a87.html" target="blank" rel="noopener">docs.pylonsproject.org/projects/py&#x2026;</a></strong></li>
<li><strong><a href="/external_links/7aee3df021e2bbc8eedf4b648aa2ed83.html" target="blank" rel="noopener">Creating Your First Pyramid Application</a></strong></li>
</ul>
<p>#1.Pyramid<br>Pyramid &#x662F; Pylons &#x9879;&#x76EE;&#x4E0B;&#x9762;&#x4E00;&#x7CFB;&#x5217;&#x5DF2;&#x7ECF;&#x53D1;&#x884C;&#x7684;&#x8F6F;&#x4EF6;&#x4E2D;&#x7684;&#x4E00;&#x5458;&#x3002;**<a href="/external_links/cc6a074925a545347fc251667f71ee82.html" target="blank" rel="noopener">Pylons &#x5B98;&#x7F51;</a>**&#x63CF;&#x8FF0;&#x4E86; Pyramid &#x548C; Pylons Project &#x7684;&#x5173;&#x7CFB;&#x3002;</p>
<p>Pyramid&#x4EE5;&#x5176;&#x9AD8;&#x6548;&#x7387;&#x548C;&#x5FEB;&#x8282;&#x594F;&#x7684;&#x5F00;&#x53D1;&#x80FD;&#x529B;&#x800C;&#x51FA;&#x540D;&#x3002;&#x5B98;&#x65B9;&#x6587;&#x6863;&#x662F;&#x8FD9;&#x6837;&#x63CF;&#x8FF0;&#x7684;&#xFF1A;<strong>Pyramid is a small, fast, down-to-earth Python web framework. It is developed as part of the <a href="/external_links/3b1bef5939825c0705baca26b93b26ea.html" target="blank" rel="noopener">Pylons Project</a>. It is licensed under a <a href="/external_links/f31a3fba9908d3cdc8eb9c0ab79fced5.html" target="blank" rel="noopener">BSD-like license</a>.</strong> &#x6B64;&#x5F00;&#x6E90;Web&#x6846;&#x67B6;&#x6709;&#x4E00;&#x4E2A;&#x72EC;&#x7ACB;&#x4E8E;&#x5E73;&#x53F0;&#x7684;MVC&#x7ED3;&#x6784;&#xFF0C;&#x63D0;&#x4F9B;&#x4E86;&#x5F00;&#x53D1;&#x7684;&#x6700;&#x7B80;&#x9014;&#x5F84;&#x3002;&#x6B64;&#x5916;&#xFF0C;&#x5B83;&#x8FD8;&#x662F;&#x9AD8;&#x6548;&#x5F00;&#x53D1;&#x91CD;&#x7528;&#x4EE3;&#x7801;&#x7684;&#x9996;&#x9009;&#x5E73;&#x53F0;&#x4E4B;&#x4E00;&#x3002;</p>
<p>##Pyramid &#x548C;&#x5176;&#x4ED6; web &#x6846;&#x67B6;&#xFF08;&#x7531;Pyramid&#x82F1;&#x6587;&#x6587;&#x6863;&#x7FFB;&#x8BD1;&#xFF09;<br>&#x7B2C;&#x4E00;&#x4E2A; Pyramid &#x7248;&#x672C;&#x7684;&#x524D;&#x751F;&#xFF08;&#x53EB;&#x505A; repoze.bfg &#xFF09;&#x521B;&#x5EFA;&#x4E8E; 2008 &#x5E74;&#x3002;2010 &#x5E74;&#x672B;&#xFF0C;&#x6211;&#x4EEC;&#x628A; repoze.bfg &#x6539;&#x540D;&#x4E3A; Pyramid &#x5E76;&#x4E8E;&#x540C;&#x5E74;11&#x6708;&#x4EFD;&#x5408;&#x5E76;&#x5230; Pylons &#x9879;&#x76EE;&#x4E2D;&#x3002;</p>
<p>Pyramid &#x7684;&#x7075;&#x611F;&#x6765;&#x6E90;&#x4E8E; Zope&#x3001;Pylons 1.0 &#x548C; Django &#xFF0C;&#x6700;&#x7EC8;&#xFF0C;Pyramid &#x5411;&#x5B83;&#x4EEC;&#x5404;&#x81EA;&#x501F;&#x9274;&#x4E00;&#x4E9B;&#x6982;&#x5FF5;&#x548C;&#x7279;&#x6027;&#x5E76;&#x7EC4;&#x6210;&#x4E00;&#x4E2A;&#x72EC;&#x7279;&#x7684;&#x6846;&#x67B6;&#x3002;</p>
<p>Pyramid &#x7684;&#x8BB8;&#x591A;&#x7279;&#x6027;&#x90FD;&#x8981;&#x8FFD;&#x6EAF;&#x5230; Zope &#x3002;&#x50CF; Zope &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E00;&#x6837;&#xFF0C;Pyramid &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x662F;&#x6613;&#x4E8E;&#x6269;&#x5C55;&#x7684;&#xFF1A;&#x5982;&#x679C;&#x4F60;&#x9075;&#x5B88;&#x4E00;&#x5B9A;&#x7684;&#x89C4;&#x5219;&#xFF0C;&#x90A3;&#x4E48;&#x4F60;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5C06;&#x4F1A;&#x88AB;&#x91CD;&#x7528;&#x3001;&#x6539;&#x8FDB;&#x3001;&#x91CD;&#x6784;&#xFF0C;&#x751A;&#x81F3;&#x88AB;&#x7B2C;&#x4E09;&#x65B9;&#x5F00;&#x53D1;&#x8005;&#x6269;&#x5C55;&#x800C;&#x4E0D;&#x7528; fork &#x539F;&#x59CB;&#x7A0B;&#x5E8F;&#x3002; Traversal &#x548C; declarative security &#x7B49;&#x6982;&#x5FF5;&#x90FD;&#x662F;&#x5728; Zope &#x4E2D;&#x9996;&#x5148;&#x88AB;&#x63D0;&#x51FA;&#x6765;&#x7684;&#x3002;</p>
<p>Pyramid &#x7684; URL dispatch &#x6982;&#x5FF5;&#x53D7; Pylons 1.0 &#x7248;&#x672C;&#x7684; Routes &#x7CFB;&#x7EDF;&#x542F;&#x53D1;&#x7684;&#xFF0C;Pyramid &#x50CF; Pylons 1.0 &#x7248;&#x672C;&#x4E00;&#x6837;&#x91C7;&#x7528;&#x81EA;&#x7531;&#x653F;&#x7B56;&#x3002;&#x5B83;&#x6CA1;&#x6709;&#x6307;&#x5B9A;&#x4F60;&#x5E94;&#x8BE5;&#x4F7F;&#x7528;&#x54EA;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x5B83;&#x7684;&#x5185;&#x7F6E;&#x6A21;&#x677F;&#x53EA;&#x662F;&#x4E3A;&#x4E86;&#x65B9;&#x4FBF;&#x3002;&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;&#x5B83;&#x4EC5;&#x4EC5;&#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x5C06; URL &#x6620;&#x5C04;&#x5230; view &#x4EE3;&#x7801;&#x4E0A;&#x7684;&#x673A;&#x5236;&#xFF0C;&#x4EE5;&#x53CA;&#x8C03;&#x7528;&#x90A3;&#x4E9B; views &#x7684;&#x89C4;&#x5219;&#x3002;&#x4F60;&#x53EF;&#x4EE5;&#x514D;&#x8D39;&#x4F7F;&#x7528;&#x7B2C;&#x4E09;&#x65B9;&#x7EC4;&#x4EF6;&#x6765;&#x6EE1;&#x8DB3;&#x4F60;&#x9879;&#x76EE;&#x7684;&#x9700;&#x6C42;&#x3002;</p>
<p>Pyramid &#x7ECF;&#x5E38;&#x4F7F;&#x7528;&#x7684; view &#x8FD9;&#x4E00;&#x6982;&#x5FF5;&#x6765;&#x81EA; Django &#x3002;Pyramid &#x7684;&#x6587;&#x6863;&#x98CE;&#x683C;&#x6BD4;&#x8D77; Zope &#x66F4;&#x50CF; Django &#x3002;</p>
<p>&#x7C7B;&#x4F3C; Pylons 1.0 &#x7248;&#x672C;&#xFF0C;&#x5374;&#x4E0D;&#x50CF; Zope &#xFF0C;&#x4E00;&#x4E2A; Pyramid &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5F00;&#x53D1;&#x8005;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x5B8C;&#x6574;&#x7684;&#x8BED;&#x53E5;&#x547D;&#x4EE4;&#x53BB;&#x6267;&#x884C;&#x4E00;&#x4E2A;&#x6846;&#x67B6;&#x5E38;&#x7528;&#x7684;&#x914D;&#x7F6E;&#x4EFB;&#x52A1;&#x6BD4;&#x5982;&#x589E;&#x52A0;&#x4E00;&#x4E2A; view &#x6216;&#x8005;&#x4E00;&#x4E2A; route &#x3002;&#x5728; Zope &#x91CC;&#x9762; ZCML &#x4E5F;&#x6709;&#x7C7B;&#x4F3C;&#x529F;&#x80FD;&#x3002;Pyramid &#x652F;&#x6301;&#x968F;&#x65F6;&#x53EF;&#x7528;&#x7684;&#x547D;&#x4EE4;&#x8BED;&#x53E5;&#x914D;&#x7F6E;&#x548C;&#x57FA;&#x4E8E;&#x4FEE;&#x9970;&#x7B26;&#x7684;&#x914D;&#x7F6E;&#xFF1B;ZCML &#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x6269;&#x5C55;&#x5305; pyramd_zcml &#x4F7F;&#x7528;&#x3002;</p>
<p>&#x65E2;&#x4E0D;&#x50CF; Zope &#xFF0C;&#x4E5F;&#x4E0D;&#x50CF; &#x201C;full-stack&#x201D; &#x8FD9;&#x6837;&#x7684;&#x6846;&#x67B6;&#x6BD4;&#x5982; Django &#xFF0C;Pyramid &#x5BF9;&#x4E8E;&#x4F60;&#x4F7F;&#x7528;&#x54EA;&#x4E00;&#x79CD;&#x6301;&#x7EED;&#x5316;&#x7684;&#x673A;&#x5236;&#x6784;&#x5EFA;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E0D;&#x505A;&#x4EFB;&#x4F55;&#x5047;&#x8BBE;&#x3002;Zope &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4F9D;&#x8D56;&#x4E8E; ZODB&#xFF1B;Pyramid &#x4E5F;&#x5141;&#x8BB8;&#x4F60;&#x521B;&#x5EFA; ZODB &#x7A0B;&#x5E8F;&#x4F46;&#x5374;&#x4E0D;&#x4F9D;&#x8D56; ZODB &#x672C;&#x8EAB;&#x3002;&#x540C;&#x6837;&#xFF0C;Django &#x503E;&#x5411;&#x4E8E;&#x5047;&#x5B9A;&#x4F60;&#x60F3;&#x8981;&#x628A;&#x4F60;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x5728;&#x4E00;&#x4E2A;&#x5173;&#x7CFB;&#x578B;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x3002;Pyramid &#x4ECE;&#x4E0D;&#x505A;&#x8FD9;&#x4E9B;&#x5047;&#x8BBE;&#xFF0C;&#x5B83;&#x5141;&#x8BB8;&#x4F60;&#x4F7F;&#x7528;&#x5173;&#x7CFB;&#x578B;&#x6570;&#x636E;&#x5E93;&#x4F46;&#x662F;&#x4E0D;&#x9F13;&#x52B1;&#x4E5F;&#x4E0D;&#x963B;&#x6B62;&#x7684;&#x51B3;&#x5B9A;&#x3002;</p>
<p>&#x5176;&#x4ED6;&#x7684; Python web framework &#x90FD;&#x5BA3;&#x79F0;&#x4ED6;&#x4EEC;&#x81EA;&#x5DF1;&#x662F;&#x4E00;&#x4E2A;&#x7C7B;&#x6210;&#x5458; web framework &#x53EB;&#x505A;<a href="/external_links/23b99fb2468df39a9863c21868636be5.html" target="blank" rel="noopener">model-view-controller</a> &#x6846;&#x67B6;&#xFF0C;Pyramid &#x4E5F;&#x5C5E;&#x4E8E;&#x8FD9;&#x4E00;&#x7C7B;&#x3002;</p>
<p>##&#x6846;&#x67B6; VS &#x5E93; &#xFF08;&#x7531;Pyramid&#x82F1;&#x6587;&#x6587;&#x6863;&#x7FFB;&#x8BD1;&#xFF09;</p>
<p>&#x4E00;&#x4E2A; &#x6846;&#x67B6; &#x548C;&#x4E00;&#x4E2A; &#x5E93; &#x6700;&#x5927;&#x7684;&#x533A;&#x522B;&#x5728;&#x4E8E;&#xFF1A;&#x5E93;&#x91CC;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x88AB;&#x4F60;&#x5199;&#x7684;&#x4EE3;&#x7801; &#x8C03;&#x7528; &#xFF0C;&#x800C;&#x6846;&#x67B6;&#x5219;&#x662F; &#x8C03;&#x7528; &#x4F60;&#x5199;&#x7684;&#x4EE3;&#x7801;&#x3002;&#x4F7F;&#x7528;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x5E93;&#x6765;&#x521B;&#x5EFA;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x901A;&#x5E38;&#x5728;&#x521A;&#x5F00;&#x59CB;&#x7684;&#x65F6;&#x5019;&#x8981;&#x6BD4;&#x4F7F;&#x7528;&#x6846;&#x67B6;&#x7B80;&#x5355;&#xFF0C;&#x56E0;&#x4E3A;&#x4F60;&#x53EF;&#x4EE5;&#x6709;&#x9009;&#x62E9;&#x6027;&#x5730;&#x653E;&#x5F03;&#x4E00;&#x4E9B;&#x63A7;&#x5236;&#x6743;&#x7ED9;&#x4E0D;&#x662F;&#x4F60;&#x5199;&#x7684;&#x5E93;&#x4EE3;&#x7801;&#x3002;&#x4F46;&#x662F;&#x5F53;&#x4F60;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x6846;&#x67B6;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F60;&#x5FC5;&#x987B;&#x653E;&#x5F03;&#x7EDD;&#x5927;&#x90E8;&#x5206;&#x7684;&#x63A7;&#x5236;&#x6743;&#x4EA4;&#x7ED9;&#x90A3;&#x4E9B;&#x4E0D;&#x662F;&#x4F60;&#x5199;&#x7684;&#x4EE3;&#x7801;&#xFF1A;&#x6574;&#x4E2A;&#x6846;&#x67B6;&#x3002;&#x4F60;&#x4E0D;&#x662F;&#x5FC5;&#x987B;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x6846;&#x67B6;&#x6765;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; WEB &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5728;&#x4F7F;&#x7528; Python &#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x3002;&#x4E00;&#x5927;&#x6279;&#x4E30;&#x5BCC;&#x7684;&#x5E93;&#x90FD;&#x88AB;&#x5DF2;&#x7ECF;&#x88AB;&#x5F00;&#x53D1;&#x51FA;&#x6765;&#x3002;&#x7136;&#x800C;&#x5728;&#x5B9E;&#x9645;&#x5E94;&#x7528;&#x4E2D;&#xFF0C;&#x4F7F;&#x7528;&#x6846;&#x67B6;&#x53BB;&#x521B;&#x5EFA;&#x5E94;&#x7528;&#x8981;&#x6BD4;&#x4F7F;&#x7528;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x5E93;&#x66F4;&#x52A0;&#x5B9E;&#x7528;&#xFF0C;&#x5982;&#x679C;&#x8FD9;&#x4E2A;&#x6846;&#x67B6;&#x63D0;&#x4F9B;&#x7684;&#x4E00;&#x4E9B;&#x5217;&#x529F;&#x80FD;&#x90FD;&#x7B26;&#x5408;&#x4F60;&#x7684;&#x9879;&#x76EE;&#x8981;&#x6C42;&#x3002;</p>
<p>#2.Pyramid&#x7684;&#x5B89;&#x88C5;<br><a href="/external_links/d302914b1c0eeec59090342ea2614338.html" target="blank" rel="noopener">&#x5B98;&#x7F51;</a>&#x8BB2;&#x7684;&#x8FD8;&#x662F;&#x86EE;&#x6E05;&#x695A;&#x7684;&#xFF0C;&#x7167;&#x7740;&#x6765;&#x5C31;&#x884C;&#x3002;</p>
<ul>
<li><strong>&#x5B89;&#x88C5;setuptools</strong><br>&#x4E0B;&#x8F7D;**<a href="/external_links/5a7523a3a3239da99370016a081c7841.html" target="blank" rel="noopener">ez_setup.py</a>**(&#x8FDB;&#x5165;&#x8BE5;&#x9875;&#x9762;&#x540E;&#x7F51;&#x9875;&#x53E6;&#x5B58;&#x4E3A;ez_setup.py&#x5373;&#x53EF;&#xFF0C;&#x8BB0;&#x4F4F;&#x5B58;&#x5728;D;\python&#x76EE;&#x5F55;&#x4E0B;)&#x3002;cmd&#x8FDB;&#x5165;D:\python&#x76EE;&#x5F55;&#xFF0C;&#x6267;&#x884C;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;python ez_setup.py</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/1c00e16c0db1f129d7b8b87fad27646fdfc393600d20182fa7eb94682601b913" alt></p>
<ul>
<li><strong>&#x5B89;&#x88C5;virtualenv</strong><br>&#x7528;python&#x76EE;&#x5F55;&#x4E0B;&#x7684;Script/easy_install&#x7A0B;&#x5E8F;&#x5B89;&#x88C5;virtualenv&#xFF1A;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;easy_install virtualenv</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>&#x7528;virtualenv&#x521B;&#x5EFA;&#x5DE5;&#x4F5C;&#x533A;</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;virtualenv --no-site-packages env</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>&#x5B89;&#x88C5;pyramid</strong><br>&#x6267;&#x884C;&#x5B8C;&#x4E0A;&#x9762;&#x7684;&#x6B65;&#x9AA4;&#x540E;&#x5E94;&#x8BE5;&#x591A;&#x4E86;&#x4E00;&#x4E2A;env&#x6587;&#x4EF6;&#xFF0C;cd env&#x6587;&#x4EF6;&#x5939;&#xFF0C;&#x7136;&#x540E;&#x6267;&#x884C;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;easy_install pyramid</span><br></pre></td></tr></table></figure>

<p>#3.Pyramid&#x4F7F;&#x7528;</p>
<p>###1.&#x521B;&#x5EFA;&#x7B2C;&#x4E00;&#x4E2A;pyramid&#x5E94;&#x7528;&#x7A0B;&#x5E8F;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;from wsgiref.simple_server import make_server</span><br><span class="line">from pyramid.config import Configurator</span><br><span class="line">from pyramid.response import Response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def hello_world(request):</span><br><span class="line">    return Response(&apos;Hello %(name)s!&apos;%request.matchdict)</span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    #&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;Configuration&#x7C7B;&#x7684;&#x5B9E;&#x4F8B;config</span><br><span class="line">    config = Configurator()</span><br><span class="line">    #&#x6CE8;&#x518C;&#x4E86;&#x4E00;&#x4E2A;&#x4EE5;/hello/&#x5F00;&#x5934;&#x7684;URL&#x8DEF;&#x7531;,&#x8DEF;&#x7531;&#x7684;&#x540D;&#x5B57;&#x5C31;&#x53EB;&apos;hello&apos;</span><br><span class="line">    config.add_route(&apos;hello&apos;,&apos;/hello/{name}&apos;)</span><br><span class="line">    #&#x6CE8;&#x518C;&#x4E86;&#x4E00;&#x4E2A;view callable&#x51FD;&#x6570;  URL Path&#xFF08;&#x6BD4;&#x5982;/hello/world&#xFF09;-&gt;route(&#x6BD4;&#x5982;&apos;hello&apos;)-&gt;view callable(&#x6BD4;&#x5982;hello_world&#x51FD;&#x6570;)</span><br><span class="line">    config.add_view(hello_world,route_name=&apos;hello&apos;)</span><br><span class="line">    #pyramid.config.Configurator.make_wsgi_app()&#x65B9;&#x6CD5;&#x6765;&#x521B;&#x5EFA;WSGI&#x5E94;&#x7528;&#x7A0B;&#x5E8F;</span><br><span class="line">    app = config.make_wsgi_app()</span><br><span class="line">    #&#x542F;&#x52A8;&#x4E86;&#x4E00;&#x4E2A;WSGI&#x670D;&#x52A1;</span><br><span class="line">    server = make_server(&apos;0.0.0.0&apos;,8080,app)</span><br><span class="line">    #serve_forever()&#x65B9;&#x6CD5;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x5FAA;&#x73AF;&#x6765;&#x63A5;&#x53D7;&#x5916;&#x754C;&#x7684;request&#x8BF7;&#x6C42;</span><br><span class="line">    server.serve_forever()</span><br></pre></td></tr></table></figure>

<p>&#x6253;&#x5F00;&#x4F60;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#xFF0C;&#x8F93;&#x8FD0;&#x884C;&#x8FD0;&#x884C;&#x5165;http&#xFF1A;//localhost:8080/hello/world&#xFF0C;&#x5C06;&#x4F1A;&#x663E;&#x793A;&#x201C;Hello world&#xFF01;&#x201D;&#x3002;<br>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5BF9;&#x8FD9;&#x4E2A;&#x793A;&#x4F8B;&#x7A0B;&#x5E8F;&#x6709;&#x4E86;&#x4E00;&#x4E2A;&#x57FA;&#x672C;&#x7684;&#x8BA4;&#x8BC6;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x4E00;&#x6B65;&#x4E00;&#x6B65;&#x5206;&#x6790;&#x5B83;&#x662F;&#x5982;&#x4F55;&#x5DE5;&#x4F5C;&#x7684;&#x3002;</p>
<ul>
<li><strong>Imports &#x5305;</strong><br>&#x7B2C;2&#x884C;&#x5F15;&#x5165;&#x4E86;pyramid.config&#x6A21;&#x5757;&#x7684;Configurator&#x7C7B;&#xFF0C;&#x7B2C;10&#x884C;&#x521B;&#x5EFA;&#x4E86;&#x5B83;&#x7684;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;&#xFF0C;&#x7136;&#x540E;&#x901A;&#x8FC7;&#x8FD9;&#x4E2A;&#x5B9E;&#x4F8B;&#x6765;&#x914D;&#x7F6E;&#x6211;&#x4EEC;&#x7684;&#x5E94;&#x7528;&#x3002;<br>&#x8DDF;&#x5176;&#x4ED6;Python web&#x6846;&#x67B6;&#x4E00;&#x6837;&#xFF0C;Pyramid &#x7528; <a href="/external_links/ad4d6479e349764108f405aa34ff8217.html" target="blank" rel="noopener">WSGI</a>&#x534F;&#x8BAE;&#x6765;&#x5C06;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x548C;web&#x670D;&#x52A1;&#x5668;&#x8054;&#x7CFB;&#x5230;&#x4E00;&#x8D77;&#x3002;&#x800C;&#x7B2C;&#x4E00;&#x884C;&#x7528;&#x5230;&#x7684;wsgiref&#x6A21;&#x5757;&#x5C31;&#x662F;WSGI&#x670D;&#x52A1;&#x7684;&#x4E00;&#x79CD;&#x5C01;&#x88C5;&#xFF0C;&#x73B0;&#x5728;wsgiref&#x5DF2;&#x7ECF;&#x88AB;&#x5F15;&#x5165;Python &#x6807;&#x51C6;&#x5E93;&#x4E86;&#x3002;<br>&#x7B2C;&#x4E09;&#x884C;&#x5F15;&#x5165;&#x4E86;pyramid.response.Response,&#x7528;&#x6765;&#x8FD4;&#x56DE;response&#x4FE1;&#x606F;&#x3002;</li>
<li><strong>View Callable &#x58F0;&#x660E;</strong><br>&#x7B2C;&#x516D;&#x884C;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E2A;hello_world&#x51FD;&#x6570;&#xFF0C;&#x4F20;&#x5165;request&#x53C2;&#x6570;&#xFF0C;&#x8FD4;&#x56DE;pyramid.response.Response&#x7C7B;&#x7684;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;&#x3002;&#x901A;&#x8FC7;&#x8C03;&#x7528;request&#x5BF9;&#x8C61;&#x7684;matchdict&#x65B9;&#x6CD5;&#x6765;&#x8F93;&#x5165;&#x5339;&#x914D;&#x5230;&#x7684;name&#x8DEF;&#x5F84;&#x3002;&#x7531;&#x4E8E;&#x6211;&#x4EEC;&#x8BBF;&#x95EE;&#x7684;&#x662F;http&#xFF1A;//localhost:8080/hello/world,&#x6240;&#x4EE5;&#x5339;&#x914D;&#x5230;&#x7684;&#x662F;world&#x5E76;&#x4EE5;&#x201C;hello world&#x201D;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x8FD4;&#x56DE;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x8BBF;&#x95EE;&#x7684;&#x662F;http&#xFF1A;//localhost:8080/hello/pyramid&#xFF0C;&#x90A3;&#x4E48;&#x8FD4;&#x56DE;&#x7684;&#x5C06;&#x662F;&#x201C;hello pyramid&#xFF01;&#x201D;&#x3002;<br>&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x88AB;&#x79F0;&#x4E3A; view callable&#xFF08;&#x4F60;&#x53EF;&#x4EE5;&#x53EB;&#x5B83;&#x89C6;&#x56FE;&#x8C03;&#x7528;&#xFF0C;&#x4F46;&#x6211;&#x8FD8;&#x662F;&#x89C9;&#x5F97;&#x7528;&#x82F1;&#x6587;&#x7684;&#x6BD4;&#x8F83;&#x597D;&#xFF09;&#x3002; &#x4E00;&#x4E2A;&#x89C6;&#x56FE;&#x8C03;&#x7528; &#x63A5;&#x53D7;&#x4E00;&#x4E2A;&#x53C2;&#x6570;:request &#x3002; &#x5B83;&#x5C06;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;response&#x5BF9;&#x8C61;&#x3002; &#x4E00;&#x4E2A;view callable&#x4E0D;&#x4E00;&#x5B9A;&#x662F;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x662F;&#x4E00;&#x4E2A;&#x7C7B;&#x6216;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;, &#x4F46;&#x662F;&#x8FD9;&#x91CC;&#x4E3A;&#x4E86;&#x7B80;&#x5355;&#x8D77;&#x89C1;&#xFF0C;&#x6211;&#x4EEC;&#x7528;&#x4E86;&#x51FD;&#x6570;&#x3002;<br>&#x4E00;&#x4E2A;view callable&#x603B;&#x662F;&#x4F34;&#x968F;&#x7740;&#x8C03;&#x7528; request&#x5BF9;&#x8C61;&#x3002; &#x4E00;&#x4E2A;request&#x5BF9;&#x8C61;&#x5C31;&#x4EE3;&#x8868;&#x7740;&#x4E00;&#x4E2A;&#x901A;&#x8FC7;&#x88AB;&#x6FC0;&#x6D3B;&#x7684;WSGI&#x670D;&#x52A1;&#x5668;&#x4F20;&#x9001;&#x5230;pyramid&#x7684;HTTP&#x8BF7;&#x6C42;&#x3002;<br>&#x4E00;&#x4E2A;view callable&#x8FD8;&#x9700;&#x8981;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;response&#x5BF9;&#x8C61;&#x3002;&#x56E0;&#x4E3A;&#x4E00;&#x4E2A;response&#x5BF9;&#x8C61;&#x62E5;&#x6709;&#x6240;&#x6709;&#x6765;&#x5236;&#x5B9A;&#x4E00;&#x4E2A;&#x5B9E;&#x9645;&#x7684;HTTP &#x54CD;&#x5E94;&#x6240;&#x5FC5;&#x8981;&#x7684;&#x4FE1;&#x606F;&#x3002;&#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;&#x901A;&#x8FC7; <a href="/external_links/ad4d6479e349764108f405aa34ff8217.html" target="blank" rel="noopener">wsgi</a>&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;Pyramid&#xFF0C;&#x8F6C;&#x5316;&#x4E3A;&#x6587;&#x672C;&#x4FE1;&#x606F;&#x53D1;&#x9001;&#x56DE;&#x8BF7;&#x6C42;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#x3002;&#x4E3A;&#x4E86;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;response,&#x6BCF;&#x4E2A;view callable&#x521B;&#x5EFA;&#x7684;&#x4E00;&#x4E2A;response&#x5B9E;&#x4F8B;&#x3002;&#x5728; hello_world&#x51FD;&#x6570;&#x4E2D;, &#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x4F5C;&#x4E3A;response&#x7684;body&#x6765;&#x8FD4;&#x56DE;&#x3002;</li>
<li><strong>Application Configuration &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x914D;&#x7F6E;</strong><br>&#x7B2C;10-15&#x884C;&#x662F;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#x3002;<br>&#x7B2C;10&#x884C;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;Configuration&#x7C7B;&#x7684;&#x5B9E;&#x4F8B;config&#xFF0C;&#x901A;&#x8FC7;&#x8FD9;&#x4E2A;&#x5B9E;&#x4F8B;&#x6765;&#x5BF9;&#x6211;&#x4EEC;&#x7684;Pyramid&#x5E94;&#x7528;&#x8FDB;&#x884C;&#x914D;&#x7F6E;&#xFF0C;&#x5305;&#x62EC;&#x8DEF;&#x7531;&#xFF0C;ip&#xFF0C;&#x7AEF;&#x53E3;&#x7B49;&#x4FE1;&#x606F;&#x3002;&#x8C03;&#x7528;config&#x7684;&#x5404;&#x79CD;&#x65B9;&#x6CD5;&#x8BBE;&#x7F6E;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6CE8;&#x518C;&#x8868;&#xFF08;application registry&#xFF09;&#xFF0C;&#x5BF9;&#x6211;&#x4EEC;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x8FDB;&#x884C;&#x6CE8;&#x518C;&#x3002;&#x4EC0;&#x4E48;&#x662F;application registry&#xFF1F;&#x4E0B;&#x9762;&#x662F;&#x5B98;&#x65B9;&#x89E3;&#x91CA;&#xFF1A;</li>
</ul>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/1c00e16c0db1f129d7b8b87fad27646fdfc393600d20182fa7eb94682601b913" alt></p>
<p>&#x7B2C;11&#x884C;&#x8C03;&#x7528;pyramid.config.Configurator.add_route()&#x65B9;&#x6CD5;&#xFF0C;&#x6CE8;&#x518C;&#x4E86;&#x4E00;&#x4E2A;&#x4EE5;/hello/&#x5F00;&#x5934;&#x7684;URL&#x8DEF;&#x7531;&#xFF0C;&#x8DEF;&#x7531;&#x7684;&#x540D;&#x5B57;&#x5C31;&#x53EB;&#x2019;hello&#x2019;&#x3002;<br>&#x7B2C;12&#x884C;config.add_v&#x8FD0;&#x884C;iew(hello_world, route_name=&#x2019;hello&#x2019;),&#x6CE8;&#x518C;&#x4E86;&#x4E00;&#x4E2A;view callable&#x51FD;&#x6570;&#xFF08;&#x4E5F;&#x5C31;&#x662F;hello_world&#x51FD;&#x6570;&#xFF09;&#xFF0C;&#x5F53;&#x540D;&#x4E3A;&#x2019;hello&#x2019;&#x7684;&#x8DEF;&#x7531;&#x88AB;&#x5339;&#x914D;&#x65F6;&#x5E94;&#x8BE5;&#x8C03;&#x7528;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x3002; &#x8FD9;&#x4E09;&#x8005;&#x7684;&#x5BF9;&#x5E94;&#x5173;&#x7CFB;&#x4E5F;&#x5C31;&#x662F;URL Path&#xFF08;&#x6BD4;&#x5982;/hello/world&#xFF09;-&gt;route(&#x6BD4;&#x5982;&#x2019;hello&#x2019;)-&gt;view callable(&#x6BD4;&#x5982;hello_world&#x51FD;&#x6570;)&#x3002;&#x8FD9;&#x6837;&#xFF0C;&#x4E00;&#x4E2A;&#x524D;&#x53F0;&#x9875;&#x9762;&#x5C31;&#x548C;&#x4E00;&#x4E2A;&#x540E;&#x53F0;&#x5904;&#x7406;&#x65B9;&#x6CD5;&#x5BF9;&#x5E94;&#x8D77;&#x6765;&#x4E86;&#x3002;<br><strong>WSGI Application Creation &#x521B;&#x5EFA;WSGI&#x5E94;&#x7528;&#x7A0B;&#x5E8F;</strong><br>&#x5F53;&#x6240;&#x6709;&#x7684;&#x914D;&#x7F6E;&#x5DE5;&#x4F5C;&#x5B8C;&#x6210;&#x540E;&#xFF0C;python&#x811A;&#x672C;&#x901A;&#x8FC7;pyramid.config.Configurator.make_wsgi_app()&#x65B9;&#x6CD5;&#x6765;&#x521B;&#x5EFA;WSGI&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;WSGI&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5BF9;&#x8C61;&#x5E76;&#x4F20;&#x9012;&#x7ED9;app&#x5F15;&#x7528;&#xFF0C;&#x8BA9;WSGI&#x670D;&#x52A1;&#x5668;&#x6765;&#x4F7F;&#x7528;&#x3002;WSGI&#x662F;&#x4E00;&#x4E2A;&#x8BA9;&#x670D;&#x52A1;&#x5668;&#x80FD;&#x548C;python&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4EA4;&#x6D41;&#x7684;&#x534F;&#x8BAE;&#x3002;&#x8FD9;&#x91CC;&#x4E0D;&#x6253;&#x7B97;&#x6DF1;&#x5165;&#x63A2;&#x8BA8;WSGI&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x6709;&#x5174;&#x8DA3;&#xFF0C;&#x53EF;&#x4EE5;&#x53BB;&#x5B98;&#x7F51;<a href="/external_links/1f6c87294f015419f2da51ea3e0cee5c.html" target="blank" rel="noopener">wsgi.org</a>&#x4E86;&#x89E3;&#x66F4;&#x591A;&#x3002;<br><strong>WSGI Application Serving</strong><br>&#x6700;&#x540E;&#x4E24;&#x884C;&#xFF0C;&#x6211;&#x4EEC;&#x542F;&#x52A8;&#x4E86;&#x4E00;&#x4E2A;WSGI&#x670D;&#x52A1;&#x3002;make_server(&#x2018;0.0.0.0&#x2019;,8080,app)&#x65B9;&#x6CD5;&#x7ED1;&#x5B9A;&#x4E86;ip&#x548C;&#x7AEF;&#x53E3;&#xFF0C;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x4F20;&#x9012;&#x6211;&#x4EEC;&#x7684;app&#x5BF9;&#x8C61;&#xFF08;&#x4E00;&#x4E2A;router&#xFF09;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x60F3;&#x670D;&#x52A1;&#x7684;&#x90A3;&#x4E2A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;serve_forever()&#x65B9;&#x6CD5;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x5FAA;&#x73AF;&#x6765;&#x63A5;&#x53D7;&#x5916;&#x754C;&#x7684;request&#x8BF7;&#x6C42;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/1c00e16c0db1f129d7b8b87fad27646fdfc393600d20182fa7eb94682601b913" alt="&#x8FD0;&#x884C;&#x6D4B;&#x8BD5;"></p>
<p>#4.Pyramid&#x90E8;&#x5206;&#x8BED;&#x6CD5;</p>
<ul>
<li>locals()&#x7528;&#x6CD5;&#xFF1A;locals()&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5C06;&#x51FD;&#x6570;&#x4E2D;&#x6240;&#x6709;&#x7684;&#x53D8;&#x91CF;&#x5168;&#x90E8;&#x4F20;&#x7ED9;&#x6A21;&#x677F;&#x3002;&#x5F53;&#x7136;&#x8FD9;&#x53EF;&#x80FD;&#x4F1A;&#x4F20;&#x9012;&#x4E00;&#x4E9B;&#x591A;&#x4F59;&#x7684;&#x53C2;&#x6570;&#xFF0C;&#x6709;&#x70B9;&#x6D6A;&#x8D39;&#x5185;&#x5B58;&#x7684;&#x5ACC;&#x7591;&#x3002;</li>
<li>render()&#x65B9;&#x6CD5;&#x662F;render_to_response&#x7684;&#x4E00;&#x4E2A;&#x5D2D;&#x65B0;&#x7684;&#x5FEB;&#x6377;&#x65B9;&#x5F0F;&#xFF0C;&#x524D;&#x8005;&#x4F1A;&#x81EA;&#x52A8;&#x4F7F;&#x7528;RequestContext&#x3002;&#x800C;&#x540E;&#x8005;&#x5FC5;&#x987B;coding&#x51FA;&#x6765;&#xFF0C;&#x8FD9;&#x662F;&#x6700;&#x660E;&#x663E;&#x7684;&#x533A;&#x522B;&#xFF0C;&#x5F53;&#x7136;&#x524D;&#x8005;&#x66F4;&#x7B80;&#x6D01;&#x3002;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;return render_to_response(&apos;blog_add.html&apos;,{&apos;blog&apos;: blog, </span><br><span class="line">&apos;form&apos;: form, &apos;id&apos;: id, &apos;tag&apos;: tag},</span><br><span class="line">context_instance=RequestContext(request))</span><br><span class="line"></span><br><span class="line">return render(request, &apos;blog_add.html&apos;, </span><br><span class="line">{&apos;blog&apos;: blog, &apos;form&apos;: form, &apos;id&apos;: id, &apos;tag&apos;: tag})</span><br></pre></td></tr></table></figure>

<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/249516f4984ce878aa946826a950b352.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903524522786829.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903524522786829.html" itemprop="url">Python进程VS线程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-17T16:54:20+08:00">
                2018-01-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#1.&#x8FDB;&#x7A0B;&#x548C;&#x7EBF;&#x7A0B;<br>&#x961F;&#x5217;&#xFF1A;<br>1&#x3001;&#x8FDB;&#x7A0B;&#x4E4B;&#x95F4;&#x7684;&#x901A;&#x4FE1;&#xFF1A; q = multiprocessing.Queue()<br>2&#x3001;&#x8FDB;&#x7A0B;&#x6C60;&#x4E4B;&#x95F4;&#x7684;&#x901A;&#x4FE1;&#xFF1A; q = multiprocessing.Manager().Queue()<br>3&#x3001;&#x7EBF;&#x7A0B;&#x4E4B;&#x95F4;&#x7684;&#x901A;&#x4FE1;&#xFF1A; q = queue.Queue()<br>##1.&#x529F;&#x80FD;</p>
<ul>
<li>&#x8FDB;&#x7A0B;&#xFF0C;&#x80FD;&#x591F;&#x5B8C;&#x6210;&#x591A;&#x4EFB;&#x52A1;&#xFF0C;&#x6BD4;&#x5982; &#x5728;&#x4E00;&#x53F0;&#x7535;&#x8111;&#x4E0A;&#x80FD;&#x591F;&#x540C;&#x65F6;&#x8FD0;&#x884C;&#x591A;&#x4E2A;QQ</li>
<li>&#x7EBF;&#x7A0B;&#xFF0C;&#x80FD;&#x591F;&#x5B8C;&#x6210;&#x591A;&#x4EFB;&#x52A1;&#xFF0C;&#x6BD4;&#x5982; &#x4E00;&#x4E2A;QQ&#x4E2D;&#x7684;&#x591A;&#x4E2A;&#x804A;&#x5929;&#x7A97;&#x53E3;</li>
</ul>
<p>##2.&#x5B9A;&#x4E49;&#x7684;&#x4E0D;&#x540C;</p>
<ul>
<li>&#x8FDB;&#x7A0B;&#x662F;&#x7CFB;&#x7EDF;&#x8FDB;&#x884C;&#x8D44;&#x6E90;&#x5206;&#x914D;&#x548C;&#x8C03;&#x5EA6;&#x7684;&#x4E00;&#x4E2A;&#x72EC;&#x7ACB;&#x5355;&#x4F4D;.</li>
<li>&#x7EBF;&#x7A0B;&#x662F;&#x8FDB;&#x7A0B;&#x7684;&#x4E00;&#x4E2A;&#x5B9E;&#x4F53;,&#x662F;CPU&#x8C03;&#x5EA6;&#x548C;&#x5206;&#x6D3E;&#x7684;&#x57FA;&#x672C;&#x5355;&#x4F4D;,&#x5B83;&#x662F;&#x6BD4;&#x8FDB;&#x7A0B;&#x66F4;&#x5C0F;&#x7684;&#x80FD;&#x72EC;&#x7ACB;&#x8FD0;&#x884C;&#x7684;&#x57FA;&#x672C;&#x5355;&#x4F4D;.&#x7EBF;&#x7A0B;&#x81EA;&#x5DF1;&#x57FA;&#x672C;&#x4E0A;&#x4E0D;&#x62E5;&#x6709;&#x7CFB;&#x7EDF;&#x8D44;&#x6E90;,&#x53EA;&#x62E5;&#x6709;&#x4E00;&#x70B9;&#x5728;&#x8FD0;&#x884C;&#x4E2D;&#x5FC5;&#x4E0D;&#x53EF;&#x5C11;&#x7684;&#x8D44;&#x6E90;(&#x5982;&#x7A0B;&#x5E8F;&#x8BA1;&#x6570;&#x5668;,&#x4E00;&#x7EC4;&#x5BC4;&#x5B58;&#x5668;&#x548C;&#x6808;),&#x4F46;&#x662F;&#x5B83;&#x53EF;&#x4E0E;&#x540C;&#x5C5E;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x7684;&#x5176;&#x4ED6;&#x7684;&#x7EBF;&#x7A0B;&#x5171;&#x4EAB;&#x8FDB;&#x7A0B;&#x6240;&#x62E5;&#x6709;&#x7684;&#x5168;&#x90E8;&#x8D44;&#x6E90;.</li>
</ul>
<p>##3.&#x533A;&#x522B;</p>
<ul>
<li>&#x4E00;&#x4E2A;&#x7A0B;&#x5E8F;&#x81F3;&#x5C11;&#x6709;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;,&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x81F3;&#x5C11;&#x6709;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;.</li>
<li>&#x7EBF;&#x7A0B;&#x7684;&#x5212;&#x5206;&#x5C3A;&#x5EA6;&#x5C0F;&#x4E8E;&#x8FDB;&#x7A0B;(&#x8D44;&#x6E90;&#x6BD4;&#x8FDB;&#x7A0B;&#x5C11;)&#xFF0C;&#x4F7F;&#x5F97;&#x591A;&#x7EBF;&#x7A0B;&#x7A0B;&#x5E8F;&#x7684;&#x5E76;&#x53D1;&#x6027;&#x9AD8;&#x3002;</li>
<li>&#x8FDB;&#x7A0B;&#x5728;&#x6267;&#x884C;&#x8FC7;&#x7A0B;&#x4E2D;&#x62E5;&#x6709;&#x72EC;&#x7ACB;&#x7684;&#x5185;&#x5B58;&#x5355;&#x5143;&#xFF0C;&#x800C;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#xFF0C;&#x4ECE;&#x800C;&#x6781;&#x5927;&#x5730;&#x63D0;&#x9AD8;&#x4E86;&#x7A0B;&#x5E8F;&#x7684;&#x8FD0;&#x884C;&#x6548;&#x7387;</li>
<li>&#x7EBF;&#x7A0B;&#x4E0D;&#x80FD;&#x591F;&#x72EC;&#x7ACB;&#x6267;&#x884C;&#xFF0C;&#x5FC5;&#x987B;&#x4F9D;&#x5B58;&#x5728;&#x8FDB;&#x7A0B;&#x4E2D;</li>
</ul>
<p>##4.&#x4F18;&#x7F3A;&#x70B9;<br>&#x7EBF;&#x7A0B;&#x548C;&#x8FDB;&#x7A0B;&#x5728;&#x4F7F;&#x7528;&#x4E0A;&#x5404;&#x6709;&#x4F18;&#x7F3A;&#x70B9;&#xFF1A;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x5F00;&#x9500;&#x5C0F;&#xFF0C;&#x4F46;&#x4E0D;&#x5229;&#x4E8E;&#x8D44;&#x6E90;&#x7684;&#x7BA1;&#x7406;&#x548C;&#x4FDD;&#x62A4;&#xFF1B;&#x800C;&#x8FDB;&#x7A0B;&#x6B63;&#x76F8;&#x53CD;&#x3002;<br>#2.&#x540C;&#x6B65;&#x7684;&#x6982;&#x5FF5;<br>##1.&#x591A;&#x7EBF;&#x7A0B;&#x5F00;&#x53D1;&#x53EF;&#x80FD;&#x9047;&#x5230;&#x7684;&#x95EE;&#x9898;<br>&#x5047;&#x8BBE;&#x4E24;&#x4E2A;&#x7EBF;&#x7A0B;t1&#x548C;t2&#x90FD;&#x8981;&#x5BF9;num=0&#x8FDB;&#x884C;&#x589E;1&#x8FD0;&#x7B97;&#xFF0C;t1&#x548C;t2&#x90FD;&#x5404;&#x5BF9;num&#x4FEE;&#x6539;10&#x6B21;&#xFF0C;num&#x7684;&#x6700;&#x7EC8;&#x7684;&#x7ED3;&#x679C;&#x5E94;&#x8BE5;&#x4E3A;20&#x3002;<br>&#x4F46;&#x662F;&#x7531;&#x4E8E;&#x662F;&#x591A;&#x7EBF;&#x7A0B;&#x8BBF;&#x95EE;&#xFF0C;&#x6709;&#x53EF;&#x80FD;&#x51FA;&#x73B0;&#x4E0B;&#x9762;&#x60C5;&#x51B5;&#xFF1A;<br>&#x5728;num=0&#x65F6;&#xFF0C;t1&#x53D6;&#x5F97;num=0&#x3002;&#x6B64;&#x65F6;&#x7CFB;&#x7EDF;&#x628A;t1&#x8C03;&#x5EA6;&#x4E3A;&#x201D;sleeping&#x201D;&#x72B6;&#x6001;&#xFF0C;&#x628A;t2&#x8F6C;&#x6362;&#x4E3A;&#x201D;running&#x201D;&#x72B6;&#x6001;&#xFF0C;t2&#x4E5F;&#x83B7;&#x5F97;num=0&#x3002;&#x7136;&#x540E;t2&#x5BF9;&#x5F97;&#x5230;&#x7684;&#x503C;&#x8FDB;&#x884C;&#x52A0;1&#x5E76;&#x8D4B;&#x7ED9;num&#xFF0C;&#x4F7F;&#x5F97;num=1&#x3002;&#x7136;&#x540E;&#x7CFB;&#x7EDF;&#x53C8;&#x628A;t2&#x8C03;&#x5EA6;&#x4E3A;&#x201D;sleeping&#x201D;&#xFF0C;&#x628A;t1&#x8F6C;&#x4E3A;&#x201D;running&#x201D;&#x3002;&#x7EBF;&#x7A0B;t1&#x53C8;&#x628A;&#x5B83;&#x4E4B;&#x524D;&#x5F97;&#x5230;&#x7684;0&#x52A0;1&#x540E;&#x8D4B;&#x503C;&#x7ED9;num&#x3002;&#x8FD9;&#x6837;&#xFF0C;&#x660E;&#x660E;t1&#x548C;t2&#x90FD;&#x5B8C;&#x6210;&#x4E86;1&#x6B21;&#x52A0;1&#x5DE5;&#x4F5C;&#xFF0C;&#x4F46;&#x7ED3;&#x679C;&#x4ECD;&#x7136;&#x662F;num=1&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;from threading import Thread</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">g_num = 0</span><br><span class="line"></span><br><span class="line">def test1():</span><br><span class="line">    global g_num</span><br><span class="line">    for i in range(1000000):</span><br><span class="line">        g_num += 1</span><br><span class="line"></span><br><span class="line">    print(&quot;---test1---g_num=%d&quot;%g_num)</span><br><span class="line"></span><br><span class="line">def test2():</span><br><span class="line">    global g_num</span><br><span class="line">    for i in range(1000000):</span><br><span class="line">        g_num += 1</span><br><span class="line"></span><br><span class="line">    print(&quot;---test2---g_num=%d&quot;%g_num)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p1 = Thread(target=test1)</span><br><span class="line">p1.start()</span><br><span class="line"></span><br><span class="line"># time.sleep(3) #&#x53D6;&#x6D88;&#x5C4F;&#x853D;&#x4E4B;&#x540E; &#x518D;&#x6B21;&#x8FD0;&#x884C;&#x7A0B;&#x5E8F;&#xFF0C;&#x7ED3;&#x679C;&#x7684;&#x4E0D;&#x540C;</span><br><span class="line"></span><br><span class="line">p2 = Thread(target=test2)</span><br><span class="line">p2.start()</span><br><span class="line"></span><br><span class="line">print(&quot;---g_num=%d---&quot;%g_num)</span><br></pre></td></tr></table></figure>

<p>&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#x5374;&#x4E0D;&#x662F;2000000&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;---g_num=129699---</span><br><span class="line">---test2---g_num=1126024</span><br><span class="line">---test1---g_num=1135562</span><br></pre></td></tr></table></figure>

<p>&#x53D6;&#x6D88;&#x5C4F;&#x853D;&#x4E4B;&#x540E;&#xFF0C;&#x518D;&#x6B21;&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;---test1---g_num=1000000</span><br><span class="line">---g_num=1025553---</span><br><span class="line">---test2---g_num=2000000</span><br></pre></td></tr></table></figure>

<p>&#x95EE;&#x9898;&#x4EA7;&#x751F;&#x7684;&#x539F;&#x56E0;&#x5C31;&#x662F;&#x6CA1;&#x6709;&#x63A7;&#x5236;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x5BF9;&#x540C;&#x4E00;&#x8D44;&#x6E90;&#x7684;&#x8BBF;&#x95EE;&#xFF0C;&#x5BF9;&#x6570;&#x636E;&#x9020;&#x6210;&#x7834;&#x574F;&#xFF0C;&#x4F7F;&#x5F97;&#x7EBF;&#x7A0B;&#x8FD0;&#x884C;&#x7684;&#x7ED3;&#x679C;&#x4E0D;&#x53EF;&#x9884;&#x671F;&#x3002;&#x8FD9;&#x79CD;&#x73B0;&#x8C61;&#x79F0;&#x4E3A;&#x201C;&#x7EBF;&#x7A0B;&#x4E0D;&#x5B89;&#x5168;&#x201D;&#x3002;<br>##2.&#x540C;&#x6B65;</p>
<ul>
<li>&#x540C;&#x6B65;&#x5C31;&#x662F;&#x534F;&#x540C;&#x6B65;&#x8C03;&#xFF0C;&#x6309;&#x9884;&#x5B9A;&#x7684;&#x5148;&#x540E;&#x6B21;&#x5E8F;&#x8FDB;&#x884C;&#x8FD0;&#x884C;&#x3002;</li>
<li>&#x5982;&#x8FDB;&#x7A0B;&#x3001;&#x7EBF;&#x7A0B;&#x540C;&#x6B65;&#xFF0C;&#x53EF;&#x7406;&#x89E3;&#x4E3A;&#x8FDB;&#x7A0B;&#x6216;&#x7EBF;&#x7A0B;A&#x548C;B&#x4E00;&#x5757;&#x914D;&#x5408;&#xFF0C;A&#x6267;&#x884C;&#x5230;&#x4E00;&#x5B9A;&#x7A0B;&#x5EA6;&#x65F6;&#x8981;&#x4F9D;&#x9760;B&#x7684;&#x67D0;&#x4E2A;&#x7ED3;&#x679C;&#xFF0C;&#x4E8E;&#x662F;&#x505C;&#x4E0B;&#x6765;&#xFF0C;&#x793A;&#x610F;B&#x8FD0;&#x884C;;B&#x4F9D;&#x8A00;&#x6267;&#x884C;&#xFF0C;&#x518D;&#x5C06;&#x7ED3;&#x679C;&#x7ED9;A;A&#x518D;&#x7EE7;&#x7EED;&#x64CD;&#x4F5C;&#x3002;</li>
</ul>
<p>##3.&#x89E3;&#x51B3;&#x7EBF;&#x7A0B;&#x4E0D;&#x5B89;&#x5168;&#x7684;&#x65B9;&#x6CD5;<br>&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x7EBF;&#x7A0B;&#x540C;&#x6B65;&#x6765;&#x89E3;&#x51B3;</p>
<ol>
<li>&#x7CFB;&#x7EDF;&#x8C03;&#x7528;t1&#xFF0C;&#x7136;&#x540E;&#x83B7;&#x53D6;&#x5230;num&#x7684;&#x503C;&#x4E3A;0&#xFF0C;&#x6B64;&#x65F6;&#x4E0A;&#x4E00;&#x628A;&#x9501;&#xFF0C;&#x5373;&#x4E0D;&#x5141;&#x8BB8;&#x5176;&#x4ED6;&#x73B0;&#x5728;&#x64CD;&#x4F5C;num</li>
<li>&#x5BF9;num&#x7684;&#x503C;&#x8FDB;&#x884C;+1</li>
<li>&#x89E3;&#x9501;&#xFF0C;&#x6B64;&#x65F6;num&#x7684;&#x503C;&#x4E3A;1&#xFF0C;&#x5176;&#x4ED6;&#x7684;&#x7EBF;&#x7A0B;&#x5C31;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;num&#x4E86;&#xFF0C;&#x800C;&#x4E14;&#x662F;num&#x7684;&#x503C;&#x4E0D;&#x662F;0&#x800C;&#x662F;1</li>
<li>&#x540C;&#x7406;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x5728;&#x5BF9;num&#x8FDB;&#x884C;&#x4FEE;&#x6539;&#x65F6;&#xFF0C;&#x90FD;&#x8981;&#x5148;&#x4E0A;&#x9501;&#xFF0C;&#x5904;&#x7406;&#x5B8C;&#x540E;&#x518D;&#x89E3;&#x9501;&#xFF0C;&#x5728;&#x4E0A;&#x9501;&#x7684;&#x6574;&#x4E2A;&#x8FC7;&#x7A0B;&#x4E2D;&#x4E0D;&#x5141;&#x8BB8;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x8BBF;&#x95EE;&#xFF0C;&#x5C31;&#x4FDD;&#x8BC1;&#x4E86;&#x6570;&#x636E;&#x7684;&#x6B63;&#x786E;&#x6027;</li>
</ol>
<p>#3.&#x4E92;&#x65A5;&#x9501;</p>
<ul>
<li>&#x5F53;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x51E0;&#x4E4E;&#x540C;&#x65F6;&#x4FEE;&#x6539;&#x67D0;&#x4E00;&#x4E2A;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x540C;&#x6B65;&#x63A7;&#x5236;<br>&#x7EBF;&#x7A0B;&#x540C;&#x6B65;&#x80FD;&#x591F;&#x4FDD;&#x8BC1;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x8BBF;&#x95EE;&#x7ADE;&#x4E89;&#x8D44;&#x6E90;&#xFF0C;&#x6700;&#x7B80;&#x5355;&#x7684;&#x540C;&#x6B65;&#x673A;&#x5236;&#x662F;&#x5F15;&#x5165;&#x4E92;&#x65A5;&#x9501;&#x3002;</li>
<li>&#x4E92;&#x65A5;&#x9501;&#x4E3A;&#x8D44;&#x6E90;&#x5F15;&#x5165;&#x4E00;&#x4E2A;&#x72B6;&#x6001;&#xFF1A;&#x9501;&#x5B9A;/&#x975E;&#x9501;&#x5B9A;&#x3002;</li>
<li>&#x67D0;&#x4E2A;&#x7EBF;&#x7A0B;&#x8981;&#x66F4;&#x6539;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x65F6;&#xFF0C;&#x5148;&#x5C06;&#x5176;&#x9501;&#x5B9A;&#xFF0C;&#x6B64;&#x65F6;&#x8D44;&#x6E90;&#x7684;&#x72B6;&#x6001;&#x4E3A;&#x201C;&#x9501;&#x5B9A;&#x201D;&#xFF0C;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x4E0D;&#x80FD;&#x66F4;&#x6539;&#xFF1B;&#x76F4;&#x5230;&#x8BE5;&#x7EBF;&#x7A0B;&#x91CA;&#x653E;&#x8D44;&#x6E90;&#xFF0C;&#x5C06;&#x8D44;&#x6E90;&#x7684;&#x72B6;&#x6001;&#x53D8;&#x6210;&#x201C;&#x975E;&#x9501;&#x5B9A;&#x201D;&#xFF0C;&#x5176;&#x4ED6;&#x7684;&#x7EBF;&#x7A0B;&#x624D;&#x80FD;&#x518D;&#x6B21;&#x9501;&#x5B9A;&#x8BE5;&#x8D44;&#x6E90;&#x3002;&#x4E92;&#x65A5;&#x9501;&#x4FDD;&#x8BC1;&#x4E86;&#x6BCF;&#x6B21;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x8FDB;&#x884C;&#x5199;&#x5165;&#x64CD;&#x4F5C;&#xFF0C;&#x4ECE;&#x800C;&#x4FDD;&#x8BC1;&#x4E86;&#x591A;&#x7EBF;&#x7A0B;&#x60C5;&#x51B5;&#x4E0B;&#x6570;&#x636E;&#x7684;&#x6B63;&#x786E;&#x6027;&#x3002;</li>
<li><em>threading&#x6A21;&#x5757;&#x4E2D;&#x5B9A;&#x4E49;&#x4E86;Lock&#x7C7B;&#xFF0C;&#x53EF;&#x4EE5;&#x65B9;&#x4FBF;&#x7684;&#x5904;&#x7406;&#x9501;&#x5B9A;&#xFF1A;*</em></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;#&#x521B;&#x5EFA;&#x9501;</span><br><span class="line">mutex = threading.Lock()</span><br><span class="line">#&#x9501;&#x5B9A;</span><br><span class="line">mutex.acquire([blocking])</span><br><span class="line">#&#x91CA;&#x653E;</span><br><span class="line">mutex.release()</span><br></pre></td></tr></table></figure>

<p>&#x5176;&#x4E2D;&#xFF0C;&#x9501;&#x5B9A;&#x65B9;&#x6CD5;acquire&#x53EF;&#x4EE5;&#x6709;&#x4E00;&#x4E2A;blocking&#x53C2;&#x6570;&#x3002;</p>
<ul>
<li>&#x5982;&#x679C;&#x8BBE;&#x5B9A;blocking&#x4E3A;True&#xFF0C;&#x5219;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x4F1A;&#x5835;&#x585E;&#xFF0C;&#x76F4;&#x5230;&#x83B7;&#x53D6;&#x5230;&#x8FD9;&#x4E2A;&#x9501;&#x4E3A;&#x6B62;&#xFF08;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x6307;&#x5B9A;&#xFF0C;&#x90A3;&#x4E48;&#x9ED8;&#x8BA4;&#x4E3A;True&#xFF09;</li>
<li>&#x5982;&#x679C;&#x8BBE;&#x5B9A;blocking&#x4E3A;False&#xFF0C;&#x5219;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x4E0D;&#x4F1A;&#x5835;&#x585E;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;from threading import Thread, Lock</span><br><span class="line">import time</span><br><span class="line">g_num = 0</span><br><span class="line">def test1():</span><br><span class="line">    global g_num</span><br><span class="line">    for i in range(1000000):</span><br><span class="line">        #True&#x8868;&#x793A;&#x5835;&#x585E; &#x5373;&#x5982;&#x679C;&#x8FD9;&#x4E2A;&#x9501;&#x5728;&#x4E0A;&#x9501;&#x4E4B;&#x524D;&#x5DF2;&#x7ECF;&#x88AB;&#x4E0A;&#x9501;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x7EBF;&#x7A0B;&#x4F1A;&#x5728;&#x8FD9;&#x91CC;&#x4E00;&#x76F4;&#x7B49;&#x5F85;&#x5230;&#x89E3;&#x9501;&#x4E3A;&#x6B62; </span><br><span class="line">        #False&#x8868;&#x793A;&#x975E;&#x5835;&#x585E;&#xFF0C;&#x5373;&#x4E0D;&#x7BA1;&#x672C;&#x6B21;&#x8C03;&#x7528;&#x80FD;&#x591F;&#x6210;&#x529F;&#x4E0A;&#x9501;&#xFF0C;&#x90FD;&#x4E0D;&#x4F1A;&#x5361;&#x5728;&#x8FD9;,&#x800C;&#x662F;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#x4E0B;&#x9762;&#x7684;&#x4EE3;&#x7801;</span><br><span class="line">        mutexFlag = mutex.acquire(True) </span><br><span class="line">        if mutexFlag:</span><br><span class="line">            g_num += 1</span><br><span class="line">            mutex.release()</span><br><span class="line"></span><br><span class="line">    print(&quot;---test1---g_num=%d&quot;%g_num)</span><br><span class="line">def test2():</span><br><span class="line">    global g_num</span><br><span class="line">    for i in range(1000000):</span><br><span class="line">        mutexFlag = mutex.acquire(True) #True&#x8868;&#x793A;&#x5835;&#x585E;</span><br><span class="line">        if mutexFlag:</span><br><span class="line">            g_num += 1</span><br><span class="line">            mutex.release()</span><br><span class="line"></span><br><span class="line">    print(&quot;---test2---g_num=%d&quot;%g_num)</span><br><span class="line">#&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x4E92;&#x65A5;&#x9501;</span><br><span class="line">#&#x8FD9;&#x4E2A;&#x9501;&#x9ED8;&#x8BA4;&#x662F;&#x672A;&#x4E0A;&#x9501;&#x7684;&#x72B6;&#x6001;</span><br><span class="line">mutex = Lock()</span><br><span class="line">p1 = Thread(target=test1)</span><br><span class="line">p1.start()</span><br><span class="line">p2 = Thread(target=test2)</span><br><span class="line">p2.start()</span><br><span class="line">print(&quot;---g_num=%d---&quot;%g_num)</span><br></pre></td></tr></table></figure>

<p>&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;---g_num=19446---</span><br><span class="line">---test1---g_num=1699950</span><br><span class="line">---test2---g_num=2000000</span><br></pre></td></tr></table></figure>

<p>&#x52A0;&#x5165;&#x4E92;&#x65A5;&#x9501;&#x540E;&#xFF0C;&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#x4E0E;&#x9884;&#x671F;&#x76F8;&#x7B26;&#x3002;<br>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6A21;&#x62DF;&#x4E00;&#x4E0B;&#x5356;&#x7968;&#x7684;&#x7A0B;&#x5E8F;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;# Python&#x4E3B;&#x8981;&#x901A;&#x8FC7;&#x6807;&#x51C6;&#x5E93;&#x4E2D;&#x7684;threading&#x5305;&#x6765;&#x5B9E;&#x73B0;&#x591A;&#x7EBF;&#x7A0B;</span><br><span class="line">import threading  </span><br><span class="line">import time</span><br><span class="line">import os</span><br><span class="line">def doChore():  # &#x4F5C;&#x4E3A;&#x95F4;&#x9694;  &#x6BCF;&#x6B21;&#x8C03;&#x7528;&#x95F4;&#x9694;0.5s</span><br><span class="line">    time.sleep(0.5)</span><br><span class="line">def booth(tid):</span><br><span class="line">    global i</span><br><span class="line">    global lock</span><br><span class="line">    while True:</span><br><span class="line">        lock.acquire()                      # &#x5F97;&#x5230;&#x4E00;&#x4E2A;&#x9501;&#xFF0C;&#x9501;&#x5B9A;</span><br><span class="line">        if i != 0:</span><br><span class="line">            i = i - 1                       # &#x552E;&#x7968; &#x552E;&#x51FA;&#x4E00;&#x5F20;&#x51CF;&#x5C11;&#x4E00;&#x5F20;</span><br><span class="line">            print(tid, &apos;:now left:&apos;, i)    # &#x5269;&#x4E0B;&#x7684;&#x7968;&#x6570;</span><br><span class="line">            doChore()</span><br><span class="line">        else:</span><br><span class="line">            print(&quot;Thread_id&quot;, tid, &quot; No more tickets&quot;)</span><br><span class="line">            os._exit(0)                     # &#x7968;&#x552E;&#x5B8C;   &#x9000;&#x51FA;&#x7A0B;&#x5E8F;</span><br><span class="line">        lock.release()                      # &#x91CA;&#x653E;&#x9501;</span><br><span class="line">        doChore()</span><br><span class="line">#&#x5168;&#x5C40;&#x53D8;&#x91CF;</span><br><span class="line">i = 15                      # &#x521D;&#x59CB;&#x5316;&#x7968;&#x6570;</span><br><span class="line">lock = threading.Lock()     # &#x521B;&#x5EFA;&#x9501;</span><br><span class="line">def main():</span><br><span class="line">    # &#x603B;&#x5171;&#x8BBE;&#x7F6E;&#x4E86;3&#x4E2A;&#x7EBF;&#x7A0B;</span><br><span class="line">    for k in range(3):</span><br><span class="line">        # &#x521B;&#x5EFA;&#x7EBF;&#x7A0B;; Python&#x4F7F;&#x7528;threading.Thread&#x5BF9;&#x8C61;&#x6765;&#x4EE3;&#x8868;&#x7EBF;&#x7A0B;</span><br><span class="line">        new_thread = threading.Thread(target=booth, args=(k,))</span><br><span class="line">        # &#x8C03;&#x7528;start()&#x65B9;&#x6CD5;&#x542F;&#x52A8;&#x7EBF;&#x7A0B;</span><br><span class="line">        new_thread.start()</span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;0 :now left: 14</span><br><span class="line">1 :now left: 13</span><br><span class="line">0 :now left: 12</span><br><span class="line">2 :now left: 11</span><br><span class="line">1 :now left: 10</span><br><span class="line">0 :now left: 9</span><br><span class="line">1 :now left: 8</span><br><span class="line">2 :now left: 7</span><br><span class="line">0 :now left: 6</span><br><span class="line">1 :now left: 5</span><br><span class="line">2 :now left: 4</span><br><span class="line">0 :now left: 3</span><br><span class="line">2 :now left: 2</span><br><span class="line">0 :now left: 1</span><br><span class="line">1 :now left: 0</span><br><span class="line">Thread_id 2  No more tickets</span><br></pre></td></tr></table></figure>

<ul>
<li>&#x4E0A;&#x9501;&#x89E3;&#x9501;&#x8FC7;&#x7A0B;<br>&#x5F53;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x8C03;&#x7528;&#x9501;&#x7684;acquire()&#x65B9;&#x6CD5;&#x83B7;&#x5F97;&#x9501;&#x65F6;&#xFF0C;&#x9501;&#x5C31;&#x8FDB;&#x5165;&#x201C;locked&#x201D;&#x72B6;&#x6001;&#x3002;<br>&#x6BCF;&#x6B21;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x53EF;&#x4EE5;&#x83B7;&#x5F97;&#x9501;&#x3002;&#x5982;&#x679C;&#x6B64;&#x65F6;&#x53E6;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x8BD5;&#x56FE;&#x83B7;&#x5F97;&#x8FD9;&#x4E2A;&#x9501;&#xFF0C;&#x8BE5;&#x7EBF;&#x7A0B;&#x5C31;&#x4F1A;&#x53D8;&#x4E3A;&#x201C;blocked&#x201D;&#x72B6;&#x6001;&#xFF0C;&#x79F0;&#x4E3A;&#x201C;&#x963B;&#x585E;&#x201D;&#xFF0C;&#x76F4;&#x5230;&#x62E5;&#x6709;&#x9501;&#x7684;&#x7EBF;&#x7A0B;&#x8C03;&#x7528;&#x9501;&#x7684;release()&#x65B9;&#x6CD5;&#x91CA;&#x653E;&#x9501;&#x4E4B;&#x540E;&#xFF0C;&#x9501;&#x8FDB;&#x5165;&#x201C;unlocked&#x201D;&#x72B6;&#x6001;&#x3002;<br>&#x7EBF;&#x7A0B;&#x8C03;&#x5EA6;&#x7A0B;&#x5E8F;&#x4ECE;&#x5904;&#x4E8E;&#x540C;&#x6B65;&#x963B;&#x585E;&#x72B6;&#x6001;&#x7684;&#x7EBF;&#x7A0B;&#x4E2D;&#x9009;&#x62E9;&#x4E00;&#x4E2A;&#x6765;&#x83B7;&#x5F97;&#x9501;&#xFF0C;&#x5E76;&#x4F7F;&#x5F97;&#x8BE5;&#x7EBF;&#x7A0B;&#x8FDB;&#x5165;&#x8FD0;&#x884C;&#xFF08;running&#xFF09;&#x72B6;&#x6001;&#x3002;</li>
<li><em>&#x9501;&#x7684;&#x597D;&#x5904;&#xFF1A;*</em></li>
<li>&#x786E;&#x4FDD;&#x4E86;&#x67D0;&#x6BB5;&#x5173;&#x952E;&#x4EE3;&#x7801;&#x53EA;&#x80FD;&#x7531;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x4ECE;&#x5934;&#x5230;&#x5C3E;&#x5B8C;&#x6574;&#x5730;&#x6267;&#x884C;<br>&#x9501;&#x7684;&#x574F;&#x5904;&#xFF1A;</li>
<li>&#x963B;&#x6B62;&#x4E86;&#x591A;&#x7EBF;&#x7A0B;&#x5E76;&#x53D1;&#x6267;&#x884C;&#xFF0C;&#x5305;&#x542B;&#x9501;&#x7684;&#x67D0;&#x6BB5;&#x4EE3;&#x7801;&#x5B9E;&#x9645;&#x4E0A;&#x53EA;&#x80FD;&#x4EE5;&#x5355;&#x7EBF;&#x7A0B;&#x6A21;&#x5F0F;&#x6267;&#x884C;&#xFF0C;&#x6548;&#x7387;&#x5C31;&#x5927;&#x5927;&#x5730;&#x4E0B;&#x964D;&#x4E86;</li>
<li>&#x7531;&#x4E8E;&#x53EF;&#x4EE5;&#x5B58;&#x5728;&#x591A;&#x4E2A;&#x9501;&#xFF0C;&#x4E0D;&#x540C;&#x7684;&#x7EBF;&#x7A0B;&#x6301;&#x6709;&#x4E0D;&#x540C;&#x7684;&#x9501;&#xFF0C;&#x5E76;&#x8BD5;&#x56FE;&#x83B7;&#x53D6;&#x5BF9;&#x65B9;&#x6301;&#x6709;&#x7684;&#x9501;&#x65F6;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x9020;&#x6210;&#x6B7B;&#x9501;</li>
</ul>
<p>#4.&#x591A;&#x7EBF;&#x7A0B;-&#x975E;&#x5171;&#x4EAB;&#x6570;&#x636E;<br>&#x5BF9;&#x4E8E;&#x591A;&#x7EBF;&#x7A0B;&#x4E2D;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#x548C;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x662F;&#x5426;&#x5171;&#x4EAB;</p>
<ul>
<li>&#x591A;&#x7EBF;&#x7A0B;&#x5C40;&#x90E8;&#x53D8;&#x91CF;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;#coding=utf-8</span><br><span class="line">    import threading</span><br><span class="line">    import time</span><br><span class="line"></span><br><span class="line">    class MyThread(threading.Thread):</span><br><span class="line">        # &#x91CD;&#x5199; &#x6784;&#x9020;&#x65B9;&#x6CD5;</span><br><span class="line">        def __init__(self,num,sleepTime):</span><br><span class="line">            threading.Thread.__init__(self)</span><br><span class="line">            self.num = num</span><br><span class="line">            self.sleepTime = sleepTime</span><br><span class="line"></span><br><span class="line">        def run(self):</span><br><span class="line">            self.num += 1</span><br><span class="line">            time.sleep(self.sleepTime)</span><br><span class="line">            print(&apos;&#x7EBF;&#x7A0B;(%s),num=%d&apos;%(self.name, self.num))</span><br><span class="line"></span><br><span class="line">    if __name__ == &apos;__main__&apos;:</span><br><span class="line">        mutex = threading.Lock()</span><br><span class="line">        t1 = MyThread(100,5)</span><br><span class="line">        t1.start()</span><br><span class="line">        t2 = MyThread(200,1)</span><br><span class="line">        t2.start()</span><br></pre></td></tr></table></figure>

<p>&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&#x7EBF;&#x7A0B;(Thread-2),num=201</span><br><span class="line">&#x7EBF;&#x7A0B;(Thread-1),num=101</span><br></pre></td></tr></table></figure>

<ul>
<li>&#x591A;&#x7EBF;&#x7A0B;&#x5168;&#x5C40;&#x53D8;&#x91CF;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;import threading</span><br><span class="line">from time import sleep</span><br><span class="line">def test(sleepTime):</span><br><span class="line">    num = 1</span><br><span class="line">    sleep(sleepTime)</span><br><span class="line">    num+=1</span><br><span class="line">    print(&apos;---(%s)--num=%d&apos;%(threading.current_thread(), num))</span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    t1 = threading.Thread(target = test,args=(5,))</span><br><span class="line">    t2 = threading.Thread(target = test,args=(1,))</span><br><span class="line"></span><br><span class="line">    t1.start()</span><br><span class="line">    t2.start()</span><br></pre></td></tr></table></figure>

<p>&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;---(&lt;Thread(Thread-2, started 10876)&gt;)--num=2</span><br><span class="line">---(&lt;Thread(Thread-1, started 7484)&gt;)--num=2</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>&#x5728;&#x591A;&#x7EBF;&#x7A0B;&#x5F00;&#x53D1;&#x4E2D;&#xFF0C;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#x662F;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x90FD;&#x5171;&#x4EAB;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x800C;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x7B49;&#x662F;&#x5404;&#x81EA;&#x7EBF;&#x7A0B;&#x7684;&#xFF0C;&#x662F;&#x975E;&#x5171;&#x4EAB;&#x7684;</strong></li>
</ul>
<p>#5.&#x540C;&#x6B65;&#x5E94;&#x7528;</p>
<ul>
<li><strong>&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x6709;&#x5E8F;&#x6267;&#x884C;</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;from threading import Thread,Lock</span><br><span class="line">from time import sleep</span><br><span class="line">class Task1(Thread):</span><br><span class="line">    def run(self):</span><br><span class="line">        while True:</span><br><span class="line">            if lock1.acquire():</span><br><span class="line">                print(&quot;------Task 1 -----&quot;)</span><br><span class="line">                sleep(0.5)</span><br><span class="line">                lock2.release()</span><br><span class="line">class Task2(Thread):</span><br><span class="line">    def run(self):</span><br><span class="line">        while True:</span><br><span class="line">            if lock2.acquire():</span><br><span class="line">                print(&quot;------Task 2 -----&quot;)</span><br><span class="line">                sleep(0.5)</span><br><span class="line">                lock3.release()</span><br><span class="line">class Task3(Thread):</span><br><span class="line">    def run(self):</span><br><span class="line">        while True:</span><br><span class="line">            if lock3.acquire():</span><br><span class="line">                print(&quot;------Task 3 -----&quot;)</span><br><span class="line">                sleep(0.5)</span><br><span class="line">                lock1.release()</span><br><span class="line">#&#x4F7F;&#x7528;Lock&#x521B;&#x5EFA;&#x51FA;&#x7684;&#x9501;&#x9ED8;&#x8BA4;&#x6CA1;&#x6709;&#x201C;&#x9501;&#x4E0A;&#x201D;</span><br><span class="line">lock1 = Lock()</span><br><span class="line">#&#x521B;&#x5EFA;&#x53E6;&#x5916;&#x4E00;&#x628A;&#x9501;&#xFF0C;&#x5E76;&#x4E14;&#x201C;&#x9501;&#x4E0A;&#x201D;</span><br><span class="line">lock2 = Lock()</span><br><span class="line">lock2.acquire()</span><br><span class="line">#&#x521B;&#x5EFA;&#x53E6;&#x5916;&#x4E00;&#x628A;&#x9501;&#xFF0C;&#x5E76;&#x4E14;&#x201C;&#x9501;&#x4E0A;&#x201D;</span><br><span class="line">lock3 = Lock()</span><br><span class="line">lock3.acquire()</span><br><span class="line">t1 = Task1()</span><br><span class="line">t2 = Task2()</span><br><span class="line">t3 = Task3()</span><br><span class="line">t1.start()</span><br><span class="line">t2.start()</span><br><span class="line">t3.start()</span><br></pre></td></tr></table></figure>

<p>&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;------Task 1 -----</span><br><span class="line">------Task 2 -----</span><br><span class="line">------Task 3 -----</span><br><span class="line">------Task 1 -----</span><br><span class="line">------Task 2 -----</span><br><span class="line">------Task 3 -----</span><br><span class="line">------Task 1 -----</span><br><span class="line">------Task 2 -----</span><br><span class="line">------Task 3 -----</span><br><span class="line">------Task 1 -----</span><br><span class="line">------Task 2 -----</span><br><span class="line">------Task 3 -----</span><br><span class="line">------Task 1 -----</span><br><span class="line">------Task 2 -----</span><br><span class="line">------Task 3 -----</span><br><span class="line">------Task 1 -----</span><br><span class="line">------Task 2 -----</span><br><span class="line">------Task 3 -----</span><br><span class="line">------Task 1 -----</span><br><span class="line">------Task 2 -----</span><br><span class="line">------Task 3 -----</span><br><span class="line">...........`</span><br></pre></td></tr></table></figure>

<ul>
<li>&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4E92;&#x65A5;&#x9501;&#x5B8C;&#x6210;&#x591A;&#x4E2A;&#x4EFB;&#x52A1;&#xFF0C;&#x6709;&#x5E8F;&#x7684;&#x8FDB;&#x7A0B;&#x5DE5;&#x4F5C;&#xFF0C;&#x8FD9;&#x5C31;&#x662F;&#x7EBF;&#x7A0B;&#x7684;&#x540C;&#x6B65;</li>
</ul>
<p>#6.&#x751F;&#x4EA7;&#x8005;&#x4E0E;&#x6D88;&#x8D39;&#x8005;&#x6A21;&#x5F0F;</p>
<ul>
<li>Python&#x7684;Queue&#x6A21;&#x5757;&#x4E2D;&#x63D0;&#x4F9B;&#x4E86;&#x540C;&#x6B65;&#x7684;&#x3001;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x7684;&#x961F;&#x5217;&#x7C7B;&#xFF0C;&#x5305;&#x62EC;FIFO&#xFF08;&#x5148;&#x5165;&#x5148;&#x51FA;)&#x961F;&#x5217;Queue&#xFF0C;LIFO&#xFF08;&#x540E;&#x5165;&#x5148;&#x51FA;&#xFF09;&#x961F;&#x5217;LifoQueue&#xFF0C;&#x548C;&#x4F18;&#x5148;&#x7EA7;&#x961F;&#x5217;PriorityQueue&#x3002;&#x8FD9;&#x4E9B;&#x961F;&#x5217;&#x90FD;&#x5B9E;&#x73B0;&#x4E86;&#x9501;&#x539F;&#x8BED;&#xFF08;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;&#x539F;&#x5B50;&#x64CD;&#x4F5C;&#xFF0C;&#x5373;&#x8981;&#x4E48;&#x4E0D;&#x505A;&#xFF0C;&#x8981;&#x4E48;&#x5C31;&#x505A;&#x5B8C;&#xFF09;&#xFF0C;&#x80FD;&#x591F;&#x5728;&#x591A;&#x7EBF;&#x7A0B;&#x4E2D;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x3002;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x961F;&#x5217;&#x6765;&#x5B9E;&#x73B0;&#x7EBF;&#x7A0B;&#x95F4;&#x7684;&#x540C;&#x6B65;&#x3002;</li>
<li>&#x7528;FIFO&#x961F;&#x5217;&#x5B9E;&#x73B0;&#x4E0A;&#x8FF0;&#x751F;&#x4EA7;&#x8005;&#x4E0E;&#x6D88;&#x8D39;&#x8005;&#x95EE;&#x9898;&#x7684;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;import threading,time</span><br><span class="line">from queue import Queue</span><br><span class="line">class Producer(threading.Thread):</span><br><span class="line">    def run(self):</span><br><span class="line">        global queue</span><br><span class="line">        count = 0</span><br><span class="line">        while True:</span><br><span class="line">            if queue.qsize() &lt; 1000:</span><br><span class="line">                for i in range(100):</span><br><span class="line">                    count = count +1</span><br><span class="line">                    msg = &apos;&#x751F;&#x6210;&#x4EA7;&#x54C1;&apos;+str(count)</span><br><span class="line">                    queue.put(msg)</span><br><span class="line">                    print(msg)</span><br><span class="line">            time.sleep(0.5)</span><br><span class="line">class Consumer(threading.Thread):</span><br><span class="line">    def run(self):</span><br><span class="line">        global queue</span><br><span class="line">        while True:</span><br><span class="line">            if queue.qsize() &gt; 100:</span><br><span class="line">                for i in range(3):</span><br><span class="line">                    msg = self.name + &apos;&#x6D88;&#x8D39;&#x4E86; &apos;+queue.get()</span><br><span class="line">                    print(msg)</span><br><span class="line">            time.sleep(1)</span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    queue = Queue()</span><br><span class="line">    for i in range(500):</span><br><span class="line">        queue.put(&apos;&#x521D;&#x59CB;&#x4EA7;&#x54C1;&apos;+str(i))</span><br><span class="line">    for i in range(2):</span><br><span class="line">        p = Producer()</span><br><span class="line">        p.start()</span><br><span class="line">    for i in range(5):</span><br><span class="line">        c = Consumer()</span><br><span class="line">        c.start()</span><br></pre></td></tr></table></figure>

<p>&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&#x751F;&#x6210;&#x4EA7;&#x54C1;1</span><br><span class="line">&#x751F;&#x6210;&#x4EA7;&#x54C1;2</span><br><span class="line">&#x751F;&#x6210;&#x4EA7;&#x54C1;1</span><br><span class="line">&#x751F;&#x6210;&#x4EA7;&#x54C1;3</span><br><span class="line">&#x751F;&#x6210;&#x4EA7;&#x54C1;2</span><br><span class="line">&#x751F;&#x6210;&#x4EA7;&#x54C1;4</span><br><span class="line">Thread-3&#x6D88;&#x8D39;&#x4E86; &#x521D;&#x59CB;&#x4EA7;&#x54C1;0</span><br><span class="line">&#x751F;&#x6210;&#x4EA7;&#x54C1;3</span><br><span class="line">&#x751F;&#x6210;&#x4EA7;&#x54C1;5</span><br><span class="line">Thread-3&#x6D88;&#x8D39;&#x4E86; &#x521D;&#x59CB;&#x4EA7;&#x54C1;1</span><br><span class="line">&#x751F;&#x6210;&#x4EA7;&#x54C1;4</span><br><span class="line">&#x751F;&#x6210;&#x4EA7;&#x54C1;6</span><br><span class="line">Thread-4&#x6D88;&#x8D39;&#x4E86; &#x521D;&#x59CB;&#x4EA7;&#x54C1;2</span><br><span class="line">Thread-3&#x6D88;&#x8D39;&#x4E86; &#x521D;&#x59CB;&#x4EA7;&#x54C1;3</span><br><span class="line">&#x751F;&#x6210;&#x4EA7;&#x54C1;5</span><br><span class="line">&#x751F;&#x6210;&#x4EA7;&#x54C1;7</span><br><span class="line">Thread-4&#x6D88;&#x8D39;&#x4E86; &#x521D;&#x59CB;&#x4EA7;&#x54C1;4</span><br><span class="line">&#x751F;&#x6210;&#x4EA7;&#x54C1;6</span><br><span class="line">&#x751F;&#x6210;&#x4EA7;&#x54C1;8</span><br><span class="line">Thread-5&#x6D88;&#x8D39;&#x4E86; &#x521D;&#x59CB;&#x4EA7;&#x54C1;5</span><br><span class="line">Thread-4&#x6D88;&#x8D39;&#x4E86; &#x521D;&#x59CB;&#x4EA7;&#x54C1;6</span><br><span class="line">............</span><br></pre></td></tr></table></figure>

<p>&#x6B64;&#x65F6;&#x5C31;&#x51FA;&#x73B0;&#x751F;&#x4EA7;&#x8005;&#x4E0E;&#x6D88;&#x8D39;&#x8005;&#x7684;&#x95EE;&#x9898;<br>##1.Queue&#x7684;&#x8BF4;&#x660E;<br><strong>1.&#x5BF9;&#x4E8E;Queue&#xFF0C;&#x5728;&#x591A;&#x7EBF;&#x7A0B;&#x901A;&#x4FE1;&#x4E4B;&#x95F4;&#x626E;&#x6F14;&#x91CD;&#x8981;&#x7684;&#x89D2;&#x8272;<br>2.&#x6DFB;&#x52A0;&#x6570;&#x636E;&#x5230;&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x4F7F;&#x7528;put()&#x65B9;&#x6CD5;<br>3.&#x4ECE;&#x961F;&#x5217;&#x4E2D;&#x53D6;&#x6570;&#x636E;&#xFF0C;&#x4F7F;&#x7528;get()&#x65B9;&#x6CD5;<br>4.&#x5224;&#x65AD;&#x961F;&#x5217;&#x4E2D;&#x662F;&#x5426;&#x8FD8;&#x6709;&#x6570;&#x636E;&#xFF0C;&#x4F7F;&#x7528;qsize()&#x65B9;&#x6CD5;</strong><br>##2.&#x751F;&#x4EA7;&#x8005;&#x6D88;&#x8D39;&#x8005;&#x6A21;&#x5F0F;&#x7684;&#x8BF4;&#x660E;</p>
<ul>
<li><strong>&#x4F7F;&#x7528;&#x751F;&#x4EA7;&#x8005;&#x548C;&#x6D88;&#x8D39;&#x8005;&#x6A21;&#x5F0F;&#x7684;&#x539F;&#x56E0;</strong><br>&#x5728;&#x7EBF;&#x7A0B;&#x4E16;&#x754C;&#x91CC;&#xFF0C;&#x751F;&#x4EA7;&#x8005;&#x5C31;&#x662F;&#x751F;&#x4EA7;&#x6570;&#x636E;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x6D88;&#x8D39;&#x8005;&#x5C31;&#x662F;&#x6D88;&#x8D39;&#x6570;&#x636E;&#x7684;&#x7EBF;&#x7A0B;&#x3002;&#x5728;&#x591A;&#x7EBF;&#x7A0B;&#x5F00;&#x53D1;&#x5F53;&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x751F;&#x4EA7;&#x8005;&#x5904;&#x7406;&#x901F;&#x5EA6;&#x5F88;&#x5FEB;&#xFF0C;&#x800C;&#x6D88;&#x8D39;&#x8005;&#x5904;&#x7406;&#x901F;&#x5EA6;&#x5F88;&#x6162;&#xFF0C;&#x90A3;&#x4E48;&#x751F;&#x4EA7;&#x8005;&#x5C31;&#x5FC5;&#x987B;&#x7B49;&#x5F85;&#x6D88;&#x8D39;&#x8005;&#x5904;&#x7406;&#x5B8C;&#xFF0C;&#x624D;&#x80FD;&#x7EE7;&#x7EED;&#x751F;&#x4EA7;&#x6570;&#x636E;&#x3002;&#x540C;&#x6837;&#x7684;&#x9053;&#x7406;&#xFF0C;&#x5982;&#x679C;&#x6D88;&#x8D39;&#x8005;&#x7684;&#x5904;&#x7406;&#x80FD;&#x529B;&#x5927;&#x4E8E;&#x751F;&#x4EA7;&#x8005;&#xFF0C;&#x90A3;&#x4E48;&#x6D88;&#x8D39;&#x8005;&#x5C31;&#x5FC5;&#x987B;&#x7B49;&#x5F85;&#x751F;&#x4EA7;&#x8005;&#x3002;&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x4E8E;&#x662F;&#x5F15;&#x5165;&#x4E86;&#x751F;&#x4EA7;&#x8005;&#x548C;&#x6D88;&#x8D39;&#x8005;&#x6A21;&#x5F0F;&#x3002;</li>
<li><strong>&#x751F;&#x4EA7;&#x8005;&#x6D88;&#x8D39;&#x8005;&#x6A21;&#x5F0F;</strong><br>&#x751F;&#x4EA7;&#x8005;&#x6D88;&#x8D39;&#x8005;&#x6A21;&#x5F0F;&#x662F;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x6765;&#x89E3;&#x51B3;&#x751F;&#x4EA7;&#x8005;&#x548C;&#x6D88;&#x8D39;&#x8005;&#x7684;&#x5F3A;&#x8026;&#x5408;&#x95EE;&#x9898;&#x3002;&#x751F;&#x4EA7;&#x8005;&#x548C;&#x6D88;&#x8D39;&#x8005;&#x5F7C;&#x6B64;&#x4E4B;&#x95F4;&#x4E0D;&#x76F4;&#x63A5;&#x901A;&#x8BAF;&#xFF0C;&#x800C;&#x901A;&#x8FC7;&#x963B;&#x585E;&#x961F;&#x5217;&#x6765;&#x8FDB;&#x884C;&#x901A;&#x8BAF;&#xFF0C;&#x6240;&#x4EE5;&#x751F;&#x4EA7;&#x8005;&#x751F;&#x4EA7;&#x5B8C;&#x6570;&#x636E;&#x4E4B;&#x540E;&#x4E0D;&#x7528;&#x7B49;&#x5F85;&#x6D88;&#x8D39;&#x8005;&#x5904;&#x7406;&#xFF0C;&#x76F4;&#x63A5;&#x6254;&#x7ED9;&#x963B;&#x585E;&#x961F;&#x5217;&#xFF0C;&#x6D88;&#x8D39;&#x8005;&#x4E0D;&#x627E;&#x751F;&#x4EA7;&#x8005;&#x8981;&#x6570;&#x636E;&#xFF0C;&#x800C;&#x662F;&#x76F4;&#x63A5;&#x4ECE;&#x963B;&#x585E;&#x961F;&#x5217;&#x91CC;&#x53D6;&#xFF0C;&#x963B;&#x585E;&#x961F;&#x5217;&#x5C31;&#x76F8;&#x5F53;&#x4E8E;&#x4E00;&#x4E2A;&#x7F13;&#x51B2;&#x533A;&#xFF0C;&#x5E73;&#x8861;&#x4E86;&#x751F;&#x4EA7;&#x8005;&#x548C;&#x6D88;&#x8D39;&#x8005;&#x7684;&#x5904;&#x7406;&#x80FD;&#x529B;&#x3002;&#x8FD9;&#x4E2A;&#x963B;&#x585E;&#x961F;&#x5217;&#x5C31;&#x662F;&#x7528;&#x6765;&#x7ED9;&#x751F;&#x4EA7;&#x8005;&#x548C;&#x6D88;&#x8D39;&#x8005;&#x89E3;&#x8026;&#x7684;&#x3002;<br>##3.ThreadLocal<br>&#x5728;&#x591A;&#x7EBF;&#x7A0B;&#x73AF;&#x5883;&#x4E0B;&#xFF0C;&#x6BCF;&#x4E2A;&#x7EBF;&#x7A0B;&#x90FD;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x6570;&#x636E;&#x3002;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x4F7F;&#x7528;&#x81EA;&#x5DF1;&#x7684;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x6BD4;&#x4F7F;&#x7528;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#x597D;&#xFF0C;&#x56E0;&#x4E3A;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x53EA;&#x6709;&#x7EBF;&#x7A0B;&#x81EA;&#x5DF1;&#x80FD;&#x770B;&#x89C1;&#xFF0C;&#x4E0D;&#x4F1A;&#x5F71;&#x54CD;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#xFF0C;&#x800C;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#x7684;&#x4FEE;&#x6539;&#x5FC5;&#x987B;&#x52A0;&#x9501;&#x3002;<br>###1.&#x4F7F;&#x7528;&#x51FD;&#x6570;&#x4F20;&#x53C2;&#x7684;&#x65B9;&#x6CD5;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;def process_student(name):</span><br><span class="line">    std = Student(name)</span><br><span class="line">    # std&#x662F;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#xFF0C;&#x4F46;&#x662F;&#x6BCF;&#x4E2A;&#x51FD;&#x6570;&#x90FD;&#x8981;&#x7528;&#x5B83;&#xFF0C;&#x56E0;&#x6B64;&#x5FC5;&#x987B;&#x4F20;&#x8FDB;&#x53BB;&#xFF1A;</span><br><span class="line">    do_task_1(std)</span><br><span class="line">    do_task_2(std)</span><br><span class="line">def do_task_1(std):</span><br><span class="line">    do_subtask_1(std)</span><br><span class="line">    do_subtask_2(std)</span><br><span class="line">def do_task_2(std):</span><br><span class="line">    do_subtask_2(std)</span><br><span class="line">    do_subtask_2(std)</span><br></pre></td></tr></table></figure>

<p>&#x8BF4;&#x660E;&#xFF1A;&#x7528;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x4E5F;&#x6709;&#x95EE;&#x9898;&#xFF0C;&#x56E0;&#x4E3A;&#x6BCF;&#x4E2A;&#x7EBF;&#x7A0B;&#x5904;&#x7406;&#x4E0D;&#x540C;&#x7684;Student&#x5BF9;&#x8C61;&#xFF0C;&#x4E0D;&#x80FD;&#x5171;&#x4EAB;&#x3002;<br>###2.&#x4F7F;&#x7528;&#x5168;&#x5C40;&#x5B57;&#x5178;&#x7684;&#x65B9;&#x6CD5;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;import threading</span><br><span class="line"># &#x521B;&#x5EFA;&#x5B57;&#x5178;&#x5BF9;&#x8C61;:</span><br><span class="line">myDict={}</span><br><span class="line">def process_student():</span><br><span class="line">    # &#x83B7;&#x53D6;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x5173;&#x8054;&#x7684;student:</span><br><span class="line">    std = myDict[threading.current_thread()]</span><br><span class="line">    print(&apos;Hello, %s (in %s)&apos; % (std, threading.current_thread().name))</span><br><span class="line">def process_thread(name):</span><br><span class="line">    # &#x7ED1;&#x5B9A;ThreadLocal&#x7684;student:</span><br><span class="line">    myDict[threading.current_thread()] = name</span><br><span class="line">    process_student()</span><br><span class="line">t1 = threading.Thread(target=process_thread, args=(&apos;yongGe&apos;,), name=&apos;Thread-A&apos;)</span><br><span class="line">t2 = threading.Thread(target=process_thread, args=(&apos;&#x8001;&#x738B;&apos;,), name=&apos;Thread-B&apos;)</span><br><span class="line">t1.start()</span><br><span class="line">t2.start()</span><br></pre></td></tr></table></figure>

<p>&#x8FD0;&#x884C;&#x7ED3;&#x679C;;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;Hello, yongGe (in Thread-A)</span><br><span class="line">Hello, &#x8001;&#x738B; (in Thread-B)</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x7406;&#x8BBA;&#x4E0A;&#x662F;&#x53EF;&#x884C;&#x7684;&#xFF0C;&#x5B83;&#x6700;&#x5927;&#x7684;&#x4F18;&#x70B9;&#x662F;&#x6D88;&#x9664;&#x4E86;std&#x5BF9;&#x8C61;&#x5728;&#x6BCF;&#x5C42;&#x51FD;&#x6570;&#x4E2D;&#x7684;&#x4F20;&#x9012;&#x95EE;&#x9898;&#xFF0C;&#x4F46;&#x662F;&#xFF0C;&#x6BCF;&#x4E2A;&#x51FD;&#x6570;&#x83B7;&#x53D6;std&#x7684;&#x4EE3;&#x7801;&#x6709;&#x70B9;low&#x3002;<br>###3.&#x4F7F;&#x7528;ThreadLocal&#x7684;&#x65B9;&#x6CD5;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;import threading</span><br><span class="line"># &#x521B;&#x5EFA;&#x5168;&#x5C40;ThreadLocal&#x5BF9;&#x8C61;:</span><br><span class="line">local_school = threading.local()</span><br><span class="line">def process_student():</span><br><span class="line">    # &#x83B7;&#x53D6;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x5173;&#x8054;&#x7684;student:</span><br><span class="line">    std = local_school.student</span><br><span class="line">    print(&apos;Hello, %s (in %s)&apos; % (std, threading.current_thread().name))</span><br><span class="line">def process_thread(name):</span><br><span class="line">    # &#x7ED1;&#x5B9A;ThreadLocal&#x7684;student:</span><br><span class="line">    local_school.student = name</span><br><span class="line">    process_student()</span><br><span class="line">t1 = threading.Thread(target=process_thread, args=(&apos;erererbai&apos;,), name=&apos;Thread-A&apos;)</span><br><span class="line">t2 = threading.Thread(target=process_thread, args=(&apos;&#x8001;&#x738B;&apos;,), name=&apos;Thread-B&apos;)</span><br><span class="line">t1.start()</span><br><span class="line">t2.start()</span><br></pre></td></tr></table></figure>

<p>&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;Hello, erererbai (in Thread-A)</span><br><span class="line">Hello, &#x8001;&#x738B; (in Thread-B)</span><br></pre></td></tr></table></figure>

<p><strong>&#x8BF4;&#x660E;&#xFF1A;</strong><br>&#x5168;&#x5C40;&#x53D8;&#x91CF;local_school&#x5C31;&#x662F;&#x4E00;&#x4E2A;ThreadLocal&#x5BF9;&#x8C61;&#xFF0C;&#x6BCF;&#x4E2A;Thread&#x5BF9;&#x5B83;&#x90FD;&#x53EF;&#x4EE5;&#x8BFB;&#x5199;student&#x5C5E;&#x6027;&#xFF0C;&#x4F46;&#x4E92;&#x4E0D;&#x5F71;&#x54CD;&#x3002;&#x4F60;&#x53EF;&#x4EE5;&#x628A;local_school&#x770B;&#x6210;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#xFF0C;&#x4F46;&#x6BCF;&#x4E2A;&#x5C5E;&#x6027;&#x5982;local_school.student&#x90FD;&#x662F;&#x7EBF;&#x7A0B;&#x7684;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#xFF0C;&#x53EF;&#x4EE5;&#x4EFB;&#x610F;&#x8BFB;&#x5199;&#x800C;&#x4E92;&#x4E0D;&#x5E72;&#x6270;&#xFF0C;&#x4E5F;&#x4E0D;&#x7528;&#x7BA1;&#x7406;&#x9501;&#x7684;&#x95EE;&#x9898;&#xFF0C;ThreadLocal&#x5185;&#x90E8;&#x4F1A;&#x5904;&#x7406;&#x3002;<br>&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;&#x5168;&#x5C40;&#x53D8;&#x91CF;local_school&#x662F;&#x4E00;&#x4E2A;dict&#xFF0C;&#x4E0D;&#x4F46;&#x53EF;&#x4EE5;&#x7528;local_school.student&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x7ED1;&#x5B9A;&#x5176;&#x4ED6;&#x53D8;&#x91CF;&#xFF0C;&#x5982;local_school.teacher&#x7B49;&#x7B49;&#x3002;<br>ThreadLocal&#x6700;&#x5E38;&#x7528;&#x7684;&#x5730;&#x65B9;&#x5C31;&#x662F;&#x4E3A;&#x6BCF;&#x4E2A;&#x7EBF;&#x7A0B;&#x7ED1;&#x5B9A;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#xFF0C;HTTP&#x8BF7;&#x6C42;&#xFF0C;&#x7528;&#x6237;&#x8EAB;&#x4EFD;&#x4FE1;&#x606F;&#x7B49;&#xFF0C;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x7684;&#x6240;&#x6709;&#x8C03;&#x7528;&#x5230;&#x7684;&#x5904;&#x7406;&#x51FD;&#x6570;&#x90FD;&#x53EF;&#x4EE5;&#x975E;&#x5E38;&#x65B9;&#x4FBF;&#x5730;&#x8BBF;&#x95EE;&#x8FD9;&#x4E9B;&#x8D44;&#x6E90;&#x3002;</p>
<ul>
<li><strong>&#x4E00;&#x4E2A;ThreadLocal&#x53D8;&#x91CF;&#x867D;&#x7136;&#x662F;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#xFF0C;&#x4F46;&#x6BCF;&#x4E2A;&#x7EBF;&#x7A0B;&#x90FD;&#x53EA;&#x80FD;&#x8BFB;&#x5199;&#x81EA;&#x5DF1;&#x7EBF;&#x7A0B;&#x7684;&#x72EC;&#x7ACB;&#x526F;&#x672C;&#xFF0C;&#x4E92;&#x4E0D;&#x5E72;&#x6270;&#x3002;ThreadLocal&#x89E3;&#x51B3;&#x4E86;&#x53C2;&#x6570;&#x5728;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x4E2D;&#x5404;&#x4E2A;&#x51FD;&#x6570;&#x4E4B;&#x95F4;&#x4E92;&#x76F8;&#x4F20;&#x9012;&#x7684;&#x95EE;&#x9898;</strong></li>
</ul>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/ba75df80d3276163dfa3d188430dc1db.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903524514398221.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903524514398221.html" itemprop="url">Redis的安装及基本使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-12T11:30:18+08:00">
                2018-01-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/1c00e16c0db1f129d7b8b87fad27646fdfc393600d20182fa7eb94682601b913" alt></p>
<p>#1.Redis<br>Redis &#x662F;&#x4E00;&#x4E2A;&#x5F00;&#x6E90;&#xFF08;BSD&#x8BB8;&#x53EF;&#xFF09;&#x7684;&#xFF0C;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x5B58;&#x50A8;&#x7CFB;&#x7EDF;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x7528;&#x4F5C;&#x6570;&#x636E;&#x5E93;&#x3001;&#x7F13;&#x5B58;&#x548C;&#x6D88;&#x606F;&#x4E2D;&#x95F4;&#x4EF6;&#x3002;&#x5B83;&#x652F;&#x6301;&#x591A;&#x79CD;&#x7C7B;&#x578B;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF0C;&#x5982; &#x5B57;&#x7B26;&#x4E32;&#xFF08;strings&#xFF09;&#xFF0C; &#x6563;&#x5217;&#xFF08;hashes&#xFF09;&#xFF0C; &#x5217;&#x8868;&#xFF08;lists&#xFF09;&#xFF0C; &#x96C6;&#x5408;&#xFF08;sets&#xFF09;&#xFF0C; &#x6709;&#x5E8F;&#x96C6;&#x5408;&#xFF08;sorted sets&#xFF09; &#x4E0E;&#x8303;&#x56F4;&#x67E5;&#x8BE2;&#xFF0C; bitmaps&#xFF0C; hyperloglogs &#x548C; &#x5730;&#x7406;&#x7A7A;&#x95F4;&#xFF08;geospatial&#xFF09; &#x7D22;&#x5F15;&#x534A;&#x5F84;&#x67E5;&#x8BE2;&#x3002; Redis &#x5185;&#x7F6E;&#x4E86; &#x590D;&#x5236;&#xFF08;replication&#xFF09;&#xFF0C;LUA&#x811A;&#x672C;&#xFF08;Lua scripting&#xFF09;&#xFF0C; LRU&#x9A71;&#x52A8;&#x4E8B;&#x4EF6;&#xFF08;LRU eviction&#xFF09;&#xFF0C;&#x4E8B;&#x52A1;&#xFF08;transactions&#xFF09; &#x548C;&#x4E0D;&#x540C;&#x7EA7;&#x522B;&#x7684; &#x78C1;&#x76D8;&#x6301;&#x4E45;&#x5316;&#xFF08;persistence&#xFF09;&#xFF0C; &#x5E76;&#x901A;&#x8FC7; Redis&#x54E8;&#x5175;&#xFF08;Sentinel&#xFF09;&#x548C;&#x81EA;&#x52A8; &#x5206;&#x533A;&#xFF08;Cluster&#xFF09;&#x63D0;&#x4F9B;&#x9AD8;&#x53EF;&#x7528;&#x6027;&#xFF08;high availability&#xFF09;&#x3002;Redis &#x662F;&#x5B8C;&#x5168;&#x5F00;&#x6E90;&#x514D;&#x8D39;&#x7684;&#xFF0C;&#x9075;&#x5B88;BSD&#x534F;&#x8BAE;&#xFF0C;&#x662F;&#x4E00;&#x4E2A;&#x9AD8;&#x6027;&#x80FD;&#x7684;key-value&#x6570;&#x636E;&#x5E93;&#x3002;<br><strong>Redis &#x4E0E;&#x5176;&#x4ED6; key - value &#x7F13;&#x5B58;&#x4EA7;&#x54C1;&#x6709;&#x4EE5;&#x4E0B;&#x4E09;&#x4E2A;&#x7279;&#x70B9;&#xFF1A;</strong></p>
<blockquote>
<ul>
<li>Redis&#x652F;&#x6301;&#x6570;&#x636E;&#x7684;&#x6301;&#x4E45;&#x5316;&#xFF0C;&#x53EF;&#x4EE5;&#x5C06;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x4FDD;&#x5B58;&#x5728;&#x78C1;&#x76D8;&#x4E2D;&#xFF0C;&#x91CD;&#x542F;&#x7684;&#x65F6;&#x5019;&#x53EF;&#x4EE5;&#x518D;&#x6B21;&#x52A0;&#x8F7D;&#x8FDB;&#x884C;&#x4F7F;&#x7528;&#x3002;</li>
<li>Redis&#x4E0D;&#x4EC5;&#x4EC5;&#x652F;&#x6301;&#x7B80;&#x5355;&#x7684;key-value&#x7C7B;&#x578B;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x540C;&#x65F6;&#x8FD8;&#x63D0;&#x4F9B;list&#xFF0C;set&#xFF0C;zset&#xFF0C;hash&#x7B49;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x7684;&#x5B58;&#x50A8;&#x3002;</li>
<li>Redis&#x652F;&#x6301;&#x6570;&#x636E;&#x7684;&#x5907;&#x4EFD;&#xFF0C;&#x5373;master-slave&#x6A21;&#x5F0F;&#x7684;&#x6570;&#x636E;&#x5907;&#x4EFD;&#x3002;</li>
</ul>
</blockquote>
<ul>
<li><a href="/external_links/522195171ed14f78e1f33f84a98f0de6.html" target="blank" rel="noopener">&#x5B98;&#x65B9;&#x6587;&#x6863;</a></li>
<li><a href="/external_links/1878a4d02ca1bf943df03eb68d3b42b9.html" target="blank" rel="noopener">&#x4E2D;&#x6587;&#x6587;&#x6863;</a><br>#2.Redis&#x5B89;&#x88C5;<br>##1.windows&#x5B89;&#x88C5;<br>&#x4E0B;&#x8F7D;&#x5B98;&#x65B9;&#x6587;&#x4EF6;&#x4E4B;&#x540E;&#xFF0C;&#x5B89;&#x88C5;&#x5373;&#x53EF;&#x3002;<br>&#x5728;&#x547D;&#x4EE4;&#x7A97;&#x53E3;&#x8F93;&#x5165;&#x547D;&#x4EE4;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;redis-cli</span><br></pre></td></tr></table></figure>

<blockquote>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/1c00e16c0db1f129d7b8b87fad27646fdfc393600d20182fa7eb94682601b913" alt="&#x542F;&#x52A8;&#x6210;&#x529F;"></p>
<ul>
<li><strong>&#x8BBE;&#x7F6E;&#x8FDC;&#x7A0B;&#x8BBF;&#x95EE;</strong><br><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/1c00e16c0db1f129d7b8b87fad27646fdfc393600d20182fa7eb94682601b913" alt="&#x627E;&#x5230;redis&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;"></li>
</ul>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/1c00e16c0db1f129d7b8b87fad27646fdfc393600d20182fa7eb94682601b913" alt="&#x6CE8;&#x91CA;bind 127.0.0.1&#x5373;&#x53EF;&#x5B9E;&#x73B0;&#x8FDC;&#x7A0B;&#x8FDE;&#x63A5;&#x8BBF;&#x95EE;"></p>
</blockquote>
<p>##2.linux&#x5B89;&#x88C5;</p>
<ul>
<li><strong>&#x4E0B;&#x8F7D;&#x5B89;&#x88C5;&#x5305;&#x89E3;&#x538B;&#xFF0C;&#x89E3;&#x538B;&#x5B8C;&#x6BD5;&#x5728;&#x6587;&#x4EF6;&#x5939;&#x5185;&#x6253;&#x5F00;&#x547D;&#x4EE4;&#x7A97;&#x53E3;</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;#&#x8F93;&#x5165;&#x547D;&#x4EE4;</span><br><span class="line">make</span><br><span class="line"></span><br><span class="line">#&#x5B8C;&#x6BD5;&#x4E4B;&#x540E;&#x5728;&#x5F53;&#x524D;&#x7A97;&#x53E3;&#x8F93;&#x5165;&#x65B0;&#x7684;&#x547D;&#x4EE4;</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>&#x8BBE;&#x7F6E;redis&#x5728;&#x540E;&#x53F0;&#x8FD0;&#x884C;</strong></li>
</ul>
<blockquote>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/1c00e16c0db1f129d7b8b87fad27646fdfc393600d20182fa7eb94682601b913" alt="&#x628A;daemonize &#x6539;&#x4E3A;yes&#x5373;&#x53EF;&#x5B9E;&#x73B0;&#x5728;&#x540E;&#x53F0;&#x8FD0;&#x884C;"></p>
</blockquote>
<ul>
<li><strong>&#x542F;&#x52A8;&#x548C;&#x5173;&#x95ED;redis&#x670D;&#x52A1;</strong><br><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/1c00e16c0db1f129d7b8b87fad27646fdfc393600d20182fa7eb94682601b913" alt></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;#&#x542F;&#x52A8;redis&#x670D;&#x52A1;</span><br><span class="line">./redis-server redis.conf </span><br><span class="line"></span><br><span class="line">#&#x67E5;&#x770B;redis&#x670D;&#x52A1;&#x8FDB;&#x7A0B; &#x662F;&#x5426;&#x542F;&#x52A8;&#x6210;&#x529F;</span><br><span class="line">ps -ef | grep redis</span><br><span class="line">ps -A | grep redis</span><br><span class="line"></span><br><span class="line">#redis&#x5BA2;&#x6237;&#x7AEF;&#x542F;&#x52A8;</span><br><span class="line">redis-cli</span><br><span class="line"></span><br><span class="line">#&#x5173;&#x95ED;redis&#x670D;&#x52A1;</span><br><span class="line">ps -A | grep redis</span><br></pre></td></tr></table></figure>

<p>#3.redis&#x5E38;&#x89C1;&#x914D;&#x7F6E;</p>
<ul>
<li><strong>&#x914D;&#x7F6E;&#x6587;&#x4EF6;redis.conf</strong></li>
</ul>
<blockquote>
<ul>
<li><strong>&#x5E38;&#x89C1;&#x914D;&#x7F6E;&#x9879;</strong><ul>
<li><strong>bind 127.0.0.1</strong> [&#x7ED1;&#x5B9A;ip&#x5730;&#x5740;&#xFF0C;&#x8FDC;&#x7A0B;&#x8BBF;&#x95EE;&#x8BF7;&#x6CE8;&#x91CA;]</li>
<li><strong>port 6379</strong> [&#x9ED8;&#x8BA4;&#x8BBF;&#x95EE;&#x5730;&#x5740; 6379]</li>
<li><strong>daemonize yes</strong> [&#x662F;&#x5426;&#x4EE5;&#x540E;&#x53F0;&#x8FDB;&#x7A0B;&lt;&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&gt;&#x8FD0;&#x884C;]</li>
<li><strong>dbfilename dump.rdb</strong> [&#x5B58;&#x50A8;&#x6570;&#x636E;&#x7684;&#x6587;&#x4EF6;]</li>
<li><strong>dir ./.</strong> [&#x5B58;&#x50A8;&#x6570;&#x636E;&#x7684;&#x6587;&#x4EF6;&#x6240;&#x5728;&#x8DEF;&#x5F84;]</li>
</ul>
</li>
</ul>
</blockquote>
<ul>
<li><strong>redis&#x4E2D;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;</strong></li>
</ul>
<blockquote>
<ul>
<li>**redis&#x7684;&#x6570;&#x636E;&#x5B58;&#x50A8;&#xFF1A;**key=value &#x952E;&#x503C;&#x5BF9;</li>
<li>**key&lt;&#x952E;&gt;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#xFF1A;**&#x5B57;&#x7B26;&#x4E32;</li>
<li><strong>value&lt;&#x503C;&#x7684;&#x7C7B;&#x578B;&gt;&#xFF1A;</strong><ul>
<li>string&#x5B57;&#x7B26;&#x4E32;</li>
<li>hash&#x54C8;&#x5E0C;</li>
<li>list&#x5217;&#x8868;</li>
<li>set&#x96C6;&#x5408;</li>
<li>zset&#x6709;&#x5E8F;&#x96C6;&#x5408;</li>
</ul>
</li>
</ul>
</blockquote>
<p>#4.redis&#x6570;&#x636E;&#x64CD;&#x4F5C;</p>
<ul>
<li><strong>string:&#x5B57;&#x7B26;&#x4E32;&#x64CD;&#x4F5C;</strong></li>
</ul>
<blockquote>
<p>**set key value &#xFF1A;**&#x7ED9;&#x4E00;&#x4E2A;key&#x8D4B;&#x503C;value<br>**setex key seconds value&#xFF1A;**&#x7ED9;&#x4E00;&#x4E2A;key&#x8BBE;&#x7F6E;&#x503C;value&#xFF0C;&#x8FC7;&#x671F;&#x65F6;&#x95F4;seconds<br>**mset key value [key value]&#xFF1A;**&#x8BBE;&#x7F6E;&#x591A;&#x4E2A;&#x952E;&#x503C;&#x5BF9;</p>
<p>**get key&#xFF1A;**&#x6839;&#x636E;key&#x83B7;&#x53D6;&#x4E00;&#x4E2A;&#x503C;<br>**mget key [key]&#xFF1A;**&#x6839;&#x636E;&#x591A;&#x4E2A;key&#x83B7;&#x53D6;&#x591A;&#x4E2A;&#x503C;</p>
<p>**incr key &#xFF1A;**&#x5C06;key&#x5BF9;&#x5E94;&#x7684;&#x503C;+1<br>**incrby key increment&#xFF1A;**&#x5C06;key&#x5BF9;&#x5E94;&#x7684;&#x503C;+increment<br>**decr key&#xFF1A;**&#x5C06;key&#x5BF9;&#x5E94;&#x7684;&#x503C;-1<br>**decrby key increment&#xFF1A;**&#x5C06;key&#x5BF9;&#x5E94;&#x7684;&#x503C;-increment</p>
<p>**append key value&#xFF1A;**&#x5C06;value&#x7684;&#x503C;&#x62FC;&#x63A5;&#x5230;x&#x540E;&#x9762;<br>**strlen key&#xFF1A;**&#x83B7;&#x53D6;key&#x5BF9;&#x5E94;&#x7684;&#x503C;&#x7684;&#x957F;&#x5EA6;</p>
</blockquote>
<ul>
<li><strong>key&#x64CD;&#x4F5C;</strong></li>
</ul>
<blockquote>
<p>**keys pattern&#xFF1A;**&#x67E5;&#x627E;&#x952E;&#xFF0C;&#x652F;&#x6301;&#x6B63;&#x5219;<br>**exists key&#xFF1A;**&#x67E5;&#x627E;&#x952E;&#x662F;&#x5426;&#x5B58;&#x5728;&#xFF0C;&#x5B58;&#x5728;&#x8FD4;&#x56DE;1&#xFF0C;&#x5426;&#x5219;&#x8FD4;&#x56DE;0<br>**type key&#xFF1A;**&#x67E5;&#x770B;&#x952E;&#x5BF9;&#x5E94;&#x7684;&#x503C;&#x7684;&#x7C7B;&#x578B;<br>**del key&#xFF1A;**&#x6839;&#x636E;key&#x5220;&#x9664;&#x952E;&#x503C;&#x5BF9;<br>**expire key seconds&#xFF1A;**&#x7ED9;key&#x8BBE;&#x7F6E;&#x8FC7;&#x671F;&#x65F6;&#x95F4;<br>**ttl key&#xFF1A;**&#x67E5;&#x770B;&#x952E;&#x7684;&#x6709;&#x6548;&#x65F6;&#x95F4;(&#x663E;&#x793A;&#x7ED3;&#x679C;&#x4E3A;-2 &#x7684;&#x8BDD;&#x8868;&#x793A;&#x8FC7;&#x671F;&#xFF0C;-1&#x8868;&#x793A;&#x6C38;&#x4E0D;&#x8FC7;&#x671F;)</p>
</blockquote>
<ul>
<li><strong>hash&#xFF1A;&#x7528;&#x4E8E;&#x5B58;&#x50A8;&#x5BF9;&#x8C61;&#xFF0C;&#x5BF9;&#x8C61;&#x7684;&#x683C;&#x5F0F;&#x4E3A;&#x952E;&#x503C;&#x5BF9;</strong></li>
</ul>
<blockquote>
<p>**hset key field value&#xFF1A;**&#x8BBE;&#x7F6E;&#x5355;&#x4E2A;&#x5C5E;&#x6027;<br>**hmset key field value [field value]&#xFF1A;**&#x8BBE;&#x7F6E;&#x591A;&#x4E2A;&#x5C5E;&#x6027;</p>
<p>**hget key field &#xFF1A;**&#x83B7;&#x53D6;key&#x5BF9;&#x5E94;&#x7684;&#x503C;<br>**hmget key field [field]&#xFF1A;**&#x83B7;&#x53D6;&#x591A;&#x4E2A;key&#x5BF9;&#x5E94;&#x7684;value&#x503C;<br>**hgetall key&#xFF1A;**&#x83B7;&#x53D6;&#x6240;&#x6709;&#x5C5E;&#x6027;&#x548C;&#x503C;<br>**hkeys key&#xFF1A;**&#x83B7;&#x53D6;&#x6240;&#x6709;&#x7684;&#x5C5E;&#x6027;<br>**hlen key&#xFF1A;**&#x83B7;&#x53D6;&#x5305;&#x542B;&#x5C5E;&#x6027;&#x7684;&#x4E2A;&#x6570;<br>**hvals key&#xFF1A;**&#x83B7;&#x53D6;&#x6240;&#x6709;&#x7684;&#x503C;<br>**hexists key field&#xFF1A;**&#x5224;&#x65AD;&#x5C5E;&#x6027;&#x662F;&#x5426;&#x5B58;&#x5728;<br>**hdel key field [field]&#xFF1A;**&#x6839;&#x636E;&#x5C5E;&#x6027;&#x540D;&#x79F0;&#x5220;&#x9664;&#x5C5E;&#x6027;&#x53CA;&#x503C;<br>**hstrlen key field&#xFF1A;**&#x8FD4;&#x56DE;&#x503C;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x957F;&#x5EA6;</p>
</blockquote>
<ul>
<li><strong>list&#x5217;&#x8868;&#xFF1A;&#x6709;&#x5E8F;&#x5B58;&#x50A8;&#x591A;&#x4E2A;&#x6570;&#x636E;</strong></li>
</ul>
<blockquote>
<p>**lpush key value [value]&#xFF1A;**&#x5217;&#x8868;&#x5934;&#x90E8;&#x589E;&#x52A0;&#x591A;&#x4E2A;&#x6570;&#x636E;<br>**rpush key value [value]&#xFF1A;**&#x5217;&#x8868;&#x5C3E;&#x90E8;&#x589E;&#x52A0;&#x591A;&#x4E2A;&#x6570;&#x636E;<br>**linsert key before | after privot value&#xFF1A;**&#x5728;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x94B1;/&#x540E;&#x63D2;&#x5165;&#x6570;&#x636E;<br>**lset key index value&#xFF1A;**&#x8BBE;&#x7F6E;&#x6307;&#x5B9A;&#x7D22;&#x5F15;&#x7684;&#x5143;&#x7D20;&#x7684;&#x503C;</p>
<p>**lpop key&#xFF1A;**&#x5220;&#x9664;&#x5E76;&#x4E14;&#x83B7;&#x53D6;key&#x5BF9;&#x5E94;&#x7684;list&#x7B2C;&#x4E00;&#x4E2A;&#x5143;&#x7D20;<br>**rpop key&#xFF1A;**&#x5220;&#x9664;&#x5E76;&#x4E14;&#x83B7;&#x53D6;key&#x5BF9;&#x5E94;&#x7684;list&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x5143;&#x7D20;<br>**lrange key start stop&#xFF1A;**&#x8FD4;&#x56DE;&#x5B58;&#x5728;&#x5728;key&#x7684;list&#x4E2D;&#x6307;&#x5B9A;&#x8303;&#x56F4;&#x7684;&#x6570;&#x636E;</p>
<p>**llen key&#xFF1A;**&#x83B7;&#x53D6;&#x5217;&#x8868;&#x7684;&#x957F;&#x5EA6;<br>**lindex key index&#xFF1A;**&#x83B7;&#x53D6;&#x5217;&#x8868;&#x4E2D;&#x7D22;&#x5F15;&#x5BF9;&#x5E94;&#x7684;&#x5143;&#x7D20;<br>**ltrim key start stop&#xFF1A;**&#x83B7;&#x53D6;&#x5217;&#x8868;&#x4E2D;start~stop&#x7EC4;&#x6210;&#x7684;&#x65B0;&#x7684;&#x5217;&#x8868;</p>
</blockquote>
<ul>
<li><strong>set&#x96C6;&#x5408;&#xFF1A;&#x65E0;&#x5E8F;&#x5B58;&#x50A8;&#x591A;&#x4E2A;&#x6570;&#x636E;</strong></li>
</ul>
<blockquote>
<p>**sadd key value [value]&#xFF1A;**&#x6DFB;&#x52A0;&#x591A;&#x4E2A;&#x6570;&#x636E;&#x5230;key&#x96C6;&#x5408;&#x4E2D;<br>**smembers key&#xFF1A;**&#x83B7;&#x53D6;key&#x96C6;&#x5408;&#x4E2D;&#x6240;&#x6709;&#x7684;&#x6570;&#x636E;<br>**sismember key value&#xFF1A;**&#x5224;&#x65AD;value&#x662F;&#x5426;&#x5728;key&#x96C6;&#x5408;&#x4E2D;&#x5B58;&#x5728;<br>**scard key&#xFF1A;**&#x83B7;&#x53D6;key&#x96C6;&#x5408;&#x4E2D;&#x5143;&#x7D20;&#x7684;&#x4E2A;&#x6570;</p>
<p>**sinter key [key]&#xFF1A;**&#x83B7;&#x53D6;&#x591A;&#x4E2A;&#x96C6;&#x5408; &#x4EA4;&#x96C6;<br>**sdiff key [key]&#xFF1A;**&#x83B7;&#x53D6;&#x591A;&#x4E2A;&#x96C6;&#x5408;&#x7684;&#x5DEE;&#x96C6;<br>**sunion key [key]&#xFF1A;**&#x83B7;&#x53D6;&#x591A;&#x4E2A;&#x96C6;&#x5408;&#x7684;&#x5E76;&#x96C6;</p>
</blockquote>
<ul>
<li><strong>zset&#x96C6;&#x5408;&#xFF1A;&#x6709;&#x5E8F;&#x5B58;&#x50A8;&#x591A;&#x4E2A;&#x6570;&#x636E;</strong></li>
</ul>
<blockquote>
<ul>
<li>sorted set&#xFF0C;&#x6709;&#x5E8F;&#x96C6;&#x5408;</li>
<li>&#x5143;&#x7D20;&#x4E3A;string&#x7C7B;&#x578B;</li>
<li>&#x5143;&#x7D20;&#x5177;&#x6709;&#x552F;&#x4E00;&#x6027;&#xFF0C;&#x4E0D;&#x91CD;&#x590D;</li>
<li>&#x6BCF;&#x4E2A;&#x5143;&#x7D20;&#x90FD;&#x4F1A;&#x5173;&#x8054;&#x4E00;&#x4E2A;double&#x7C7B;&#x578B;&#x7684;score&#xFF0C;&#x8868;&#x793A;&#x6743;&#x91CD;&#xFF0C;&#x901A;&#x8FC7;&#x6743;&#x91CD;&#x5C06;&#x5143;&#x7D20;&#x4ECE;&#x5C0F;&#x5230;&#x5927;&#x6392;&#x5E8F;</li>
<li>&#x5143;&#x7D20;&#x7684;score&#x53EF;&#x4EE5;&#x76F8;&#x540C;</li>
</ul>
<p>**zadd key score value [ score value]&#xFF1A;**&#x6DFB;&#x52A0;&#x591A;&#x4E2A;&#x5E26;&#x6743;&#x91CD;&#x7684;&#x6570;&#x636E;&#x5230;key&#x96C6;&#x5408;&#x4E2D;<br>**zrange key start stop&#xFF1A;**&#x83B7;&#x53D6;&#x6307;&#x5B9A;&#x8303;&#x56F4;&#x4E2D;&#x6240;&#x6709;&#x7684;&#x5143;&#x7D20;<br>**zcard key&#xFF1A;**&#x8FD4;&#x56DE;&#x5143;&#x7D20;&#x7684;&#x4E2A;&#x6570;<br>**zcount key min max &#xFF1A;**&#x8FD4;&#x56DE;score&#x503C;&#x5728;min&#x548C;max&#x4E4B;&#x95F4;&#x7684;&#x6570;&#x636E;<br>**zscore key member&#xFF1A;**&#x8FD4;&#x56DE;&#x96C6;&#x5408;&#x4E2D;member&#x5143;&#x7D20;&#x7684;score&#x503C;</p>
</blockquote>
<p>#5.redis&#x53D1;&#x5E03;&#x8BA2;&#x9605;</p>
<blockquote>
<ul>
<li>&#x53D1;&#x5E03;&#x8005;&#x4E0D;&#x662F;&#x8BA1;&#x5212;&#x53D1;&#x9001;&#x6D88;&#x606F;&#x7ED9;&#x7279;&#x5B9A;&#x7684;&#x63A5;&#x6536;&#x8005;&#xFF08;&#x8BA2;&#x9605;&#x8005;&#xFF09;&#xFF0C;&#x800C;&#x662F;&#x53D1;&#x5E03;&#x7684;&#x6D88;&#x606F;&#x5206;&#x5230;&#x4E0D;&#x540C;&#x7684;&#x9891;&#x9053;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x77E5;&#x9053;&#x4EC0;&#x4E48;&#x6837;&#x7684;&#x8BA2;&#x9605;&#x8005;&#x8BA2;&#x9605;</li>
<li>&#x8BA2;&#x9605;&#x8005;&#x5BF9;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x9891;&#x9053;&#x611F;&#x5174;&#x8DA3;&#xFF0C;&#x53EA;&#x9700;&#x63A5;&#x6536;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x6D88;&#x606F;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x77E5;&#x9053;&#x4EC0;&#x4E48;&#x6837;&#x7684;&#x53D1;&#x5E03;&#x8005;&#x53D1;&#x5E03;&#x7684;</li>
<li>&#x53D1;&#x5E03;&#x8005;&#x548C;&#x8BA2;&#x9605;&#x8005;&#x7684;&#x89E3;&#x8026;&#x5408;&#x53EF;&#x4EE5;&#x5E26;&#x6765;&#x66F4;&#x5927;&#x7684;&#x6269;&#x5C55;&#x6027;&#x548C;&#x66F4;&#x52A0;&#x52A8;&#x6001;&#x7684;&#x7F51;&#x7EDC;&#x62D3;&#x6251;</li>
<li>&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x5230;&#x9891;&#x9053;&#x7684;&#x6D88;&#x606F;&#xFF0C;&#x5C06;&#x4F1A;&#x88AB;&#x63A8;&#x9001;&#x5230;&#x6240;&#x6709;&#x8BA2;&#x9605;&#x6B64;&#x9891;&#x9053;&#x7684;&#x5BA2;&#x6237;&#x7AEF;</li>
<li>&#x5BA2;&#x6237;&#x7AEF;&#x4E0D;&#x9700;&#x8981;&#x4E3B;&#x52A8;&#x53BB;&#x83B7;&#x53D6;&#x6D88;&#x606F;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x8BA2;&#x9605;&#x9891;&#x9053;&#xFF0C;&#x8FD9;&#x4E2A;&#x9891;&#x9053;&#x7684;&#x5185;&#x5BB9;&#x5C31;&#x4F1A;&#x88AB;&#x63A8;&#x9001;&#x8FC7;&#x6765;</li>
</ul>
</blockquote>
<ul>
<li><strong>&#x6D88;&#x606F;&#x7684;&#x683C;&#x5F0F;</strong></li>
</ul>
<blockquote>
<p>&#x63A8;&#x9001;&#x6D88;&#x606F;&#x7684;&#x683C;&#x5F0F;&#x5305;&#x542B;&#x4E09;&#x90E8;&#x5206;</p>
<ul>
<li>part1:&#x6D88;&#x606F;&#x7C7B;&#x578B;&#xFF0C;&#x5305;&#x542B;&#x4E09;&#x79CD;&#x7C7B;&#x578B;</li>
</ul>
<pre><code>+ **subscribe**&#xFF0C;&#x8868;&#x793A;&#x8BA2;&#x9605;&#x6210;&#x529F;
+ **unsubscribe**&#xFF0C;&#x8868;&#x793A;&#x53D6;&#x6D88;&#x8BA2;&#x9605;&#x6210;&#x529F;
+ **message**&#xFF0C;&#x8868;&#x793A;&#x5176;&#x5B83;&#x7EC8;&#x7AEF;&#x53D1;&#x5E03;&#x6D88;&#x606F;</code></pre><ul>
<li>&#x5982;&#x679C;&#x7B2C;&#x4E00;&#x90E8;&#x5206;&#x7684;&#x503C;&#x4E3A;<strong>subscribe</strong>&#xFF0C;&#x5219;&#x7B2C;&#x4E8C;&#x90E8;&#x5206;&#x662F;&#x9891;&#x9053;&#xFF0C;&#x7B2C;&#x4E09;&#x90E8;&#x5206;&#x662F;&#x73B0;&#x5728;&#x8BA2;&#x9605;&#x7684;&#x9891;&#x9053;&#x7684;&#x6570;&#x91CF;</li>
<li>&#x5982;&#x679C;&#x7B2C;&#x4E00;&#x90E8;&#x5206;&#x7684;&#x503C;&#x4E3A;<strong>unsubscribe</strong>&#xFF0C;&#x5219;&#x7B2C;&#x4E8C;&#x90E8;&#x5206;&#x662F;&#x9891;&#x9053;&#xFF0C;&#x7B2C;&#x4E09;&#x90E8;&#x5206;&#x662F;&#x73B0;&#x5728;&#x8BA2;&#x9605;&#x7684;&#x9891;&#x9053;&#x7684;&#x6570;&#x91CF;&#xFF0C;&#x5982;&#x679C;&#x4E3A;0&#x5219;&#x8868;&#x793A;&#x5F53;&#x524D;&#x6CA1;&#x6709;&#x8BA2;&#x9605;&#x4EFB;&#x4F55;&#x9891;&#x9053;&#xFF0C;&#x5F53;&#x5728;Pub/Sub&#x4EE5;&#x5916;&#x72B6;&#x6001;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x53EF;&#x4EE5;&#x53D1;&#x51FA;&#x4EFB;&#x4F55;redis&#x547D;&#x4EE4;</li>
<li>&#x5982;&#x679C;&#x7B2C;&#x4E00;&#x90E8;&#x5206;&#x7684;&#x503C;&#x4E3A;<strong>message</strong>&#xFF0C;&#x5219;&#x7B2C;&#x4E8C;&#x90E8;&#x5206;&#x662F;&#x6765;&#x6E90;&#x9891;&#x9053;&#x7684;&#x540D;&#x79F0;&#xFF0C;&#x7B2C;&#x4E09;&#x90E8;&#x5206;&#x662F;&#x6D88;&#x606F;&#x7684;&#x5185;&#x5BB9;</li>
</ul>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801; subscribe &#x9891;&#x9053;&#x540D;&#x79F0; [&#x9891;&#x9053;&#x540D;&#x79F0;]&#xFF1A;&#x8BA2;&#x9605;&#x591A;&#x4E2A;&#x9891;&#x9053;</span><br><span class="line"></span><br><span class="line"> unsubscribe  &#x9891;&#x9053;&#x540D;&#x79F0; [&#x9891;&#x9053;&#x540D;&#x79F0;]&#xFF1A;&#x53D6;&#x6D88;&#x591A;&#x4E2A;&#x9891;&#x9053;&#x7684;&#x8BA2;&#x9605;</span><br><span class="line"></span><br><span class="line"> publish &#x9891;&#x9053; &#x6D88;&#x606F;&#xFF1A;&#x5411;&#x6307;&#x5B9A;&#x7684;&#x9891;&#x9053;&#x63A8;&#x9001;&#x6D88;&#x606F;</span><br></pre></td></tr></table></figure>

<p>###&#x6253;&#x5F00;&#x591A;&#x4E2A;&#x547D;&#x4EE4;&#x7A97;&#x53E3;&#xFF1A;</p>
<ul>
<li><strong>&#x7B2C;&#x4E00;&#x4E2A;&#x7A97;&#x53E3;&#x5F53;&#x505A;&#x8BA2;&#x9605;&#x8005;</strong></li>
</ul>
<blockquote>
<p><strong>&#x8F93;&#x5165;&#x547D;&#x4EE4;&#xFF1A;</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; &#x590D;&#x5236;&#x4EE3;&#x7801;#&#x542F;&#x52A8;redis</span><br><span class="line">&gt; redis-cli</span><br><span class="line">&gt; </span><br><span class="line">&gt; #&#x9009;&#x62E9;&#x6570;&#x636E;&#x5E93;</span><br><span class="line">&gt; select 0</span><br><span class="line">&gt; </span><br><span class="line">&gt; #&#x8BA2;&#x9605;&#x9891;&#x9053;</span><br><span class="line">&gt; subscribe  zhiji</span><br><span class="line">&gt; </span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li><strong>&#x7B2C;&#x4E8C;&#x4E2A;&#x7A97;&#x53E3;&#x5F53;&#x505A;&#x5BA2;&#x6237;&#x7AEF;</strong></li>
</ul>
<blockquote>
<p><strong>&#x8F93;&#x5165;&#x547D;&#x4EE4;</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; &#x590D;&#x5236;&#x4EE3;&#x7801;#&#x542F;&#x52A8;redis</span><br><span class="line">&gt; redis-cli</span><br><span class="line">&gt; </span><br><span class="line">&gt; #&#x9009;&#x62E9;&#x6570;&#x636E;&#x5E93;</span><br><span class="line">&gt; select 1</span><br><span class="line">&gt; </span><br><span class="line">&gt; #&#x53D1;&#x5E03;&#x6D88;&#x606F;</span><br><span class="line">&gt; publish  zhiji  &apos;hellow&apos;</span><br><span class="line">&gt; </span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/d60384034b77c13c28402a35b432fb2a93a138a839a8f8f4d39d0262fb44651f" alt="&#x6548;&#x679C;&#x5982;&#x56FE;&#x6240;&#x793A;"></p>
<p>#6.&#x4E3B;&#x4ECE;&#x53CC;&#x5907;</p>
<ul>
<li>&#x4E3B;&#x4ECE;&#x914D;&#x7F6E;<br>&#x4E00;&#x4E2A;master&#x53EF;&#x4EE5;&#x62E5;&#x6709;&#x591A;&#x4E2A;slave&#xFF0C;&#x4E00;&#x4E2A;slave&#x53C8;&#x53EF;&#x4EE5;&#x62E5;&#x6709;&#x591A;&#x4E2A;slave&#xFF0C;&#x5982;&#x6B64;&#x4E0B;&#x53BB;&#xFF0C;&#x5F62;&#x6210;&#x4E86;&#x5F3A;&#x5927;&#x7684;&#x591A;&#x7EA7;&#x670D;&#x52A1;&#x5668;&#x96C6;&#x7FA4;&#x67B6;&#x6784;<br>&#x6BD4;&#x5982;&#xFF0C;&#x5C06;ip&#x4E3A;192.168.1.10&#x7684;&#x673A;&#x5668;&#x4F5C;&#x4E3A;&#x4E3B;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x5C06;ip&#x4E3A;192.168.1.11&#x7684;&#x673A;&#x5668;&#x4F5C;&#x4E3A;&#x4ECE;&#x670D;&#x52A1;&#x5668;</li>
<li>&#x8BBE;&#x7F6E;&#x4E3B;&#x670D;&#x52A1;&#x5668;&#x7684;&#x914D;&#x7F6E;<br>bind 192.168.1.10 &#x8BBE;&#x7F6E;&#x4ECE;&#x670D;&#x52A1;&#x5668;&#x7684;&#x914D;&#x7F6E;<br>&#x6CE8;&#x610F;&#xFF1A;&#x5728;slaveof&#x540E;&#x9762;&#x5199;&#x4E3B;&#x673A;ip&#xFF0C;&#x518D;&#x5199;&#x7AEF;&#x53E3;&#xFF0C;&#x800C;&#x4E14;&#x7AEF;&#x53E3;&#x5FC5;&#x987B;&#x5199;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&#x901A;&#x8FC7;redis.**.conf&#x914D;&#x7F6E;&#x5B8C;&#x6210;&#x4E3B;&#x4ECE;&#x53CC;&#x5907;</span><br><span class="line"></span><br><span class="line">bind&#x914D;&#x7F6E;&#x4E3B;&#x6570;&#x636E;&#x5E93;&#x670D;&#x52A1;&#x5668;</span><br><span class="line"></span><br><span class="line">slaveof&#x914D;&#x7F6E;&#x4ECE;&#x6570;&#x636E;&#x5E93;&#x670D;&#x52A1;&#x5668;</span><br><span class="line"></span><br><span class="line">bind 192.168.1.11 slaveof 192.168.1.10 6379 &#x5728;master&#x548C;slave&#x5206;&#x522B;&#x6267;&#x884C;info&#x547D;&#x4EE4;&#xFF0C;&#x67E5;&#x770B;&#x8F93;&#x51FA;&#x4FE1;&#x606F;</span><br><span class="line">&#x5728;master&#x4E0A;&#x5199;&#x6570;&#x636E;</span><br><span class="line">set hello world &#x5728;slave&#x4E0A;&#x8BFB;&#x6570;&#x636E;</span><br><span class="line">get hello</span><br></pre></td></tr></table></figure>

<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/30d746d52edd1d2689d1f17f0a3a4d22.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903524409540622.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903524409540622.html" itemprop="url">Django教程（一） Django视图与网址</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-12T10:45:51+08:00">
                2018-01-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>###&#x76EE;&#x5F55;&#xFF1A;</p>
<blockquote>
<ul>
<li><strong><a href="/external_links/be7091e1f7f37c4c3aa2fde5bee33a47.html" target="blank" rel="noopener">Django&#x6559;&#x7A0B;&#xFF08;&#x4E00;&#xFF09;- Django&#x89C6;&#x56FE;&#x4E0E;&#x7F51;&#x5740;</a></strong></li>
<li><strong><a href="/external_links/9fee0f1de038de7e8f91b63d1f162c47.html" target="blank" rel="noopener">Django&#x6559;&#x7A0B;&#xFF08;&#x4E8C;&#xFF09;- Django&#x89C6;&#x56FE;&#x4E0E;&#x7F51;&#x5740;&#x8FDB;&#x9636;</a></strong></li>
<li><strong><a href="/external_links/9c5d14ae1dc05329e8f387854040b125.html" target="blank" rel="noopener">Django&#x6559;&#x7A0B;&#xFF08;&#x4E09;&#xFF09;- Django&#x8868;&#x5355;Form</a></strong></li>
<li><strong><a href="/external_links/e257d4003ef97975c89259c1dc9b8cf8.html" target="blank" rel="noopener">Django&#x6559;&#x7A0B;&#xFF08;&#x56DB;&#xFF09;- Django&#x6A21;&#x677F;&#x53CA;&#x8FDB;&#x9636;</a></strong></li>
<li><strong><a href="/external_links/ce36a099c137c617a716c0f3f27a70d6.html" target="blank" rel="noopener">Django&#x6A21;&#x578B;(&#x6570;&#x636E;&#x5E93;)&#x53CA;Django Query&#x5E38;&#x7528;&#x65B9;&#x6CD5;</a></strong></li>
<li><strong><a href="/external_links/29fbe072c921080c360f3c3199421613.html" target="blank" rel="noopener">Django&#x6559;&#x7A0B;&#xFF08;&#x4E94;&#xFF09;- &#x4E0A;&#x4F20;&#x53CA;&#x663E;&#x793A;</a></strong></li>
<li><strong><a href="/external_links/1434db716ab0daee11c79bdaa9335368.html" target="blank" rel="noopener">Django&#x5B9E;&#x6218;&#xFF08;&#x4E00;&#xFF09;- &#x642D;&#x5EFA;&#x7B80;&#x5355;&#x7684;&#x535A;&#x5BA2;&#x7CFB;&#x7EDF;</a></strong></li>
<li><strong><a href="/external_links/89be792cf56fb866150207e505ade040.html" target="blank" rel="noopener">Django&#x5B9E;&#x6218;&#xFF08;&#x4E8C;&#xFF09;- &#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x8BFE;&#x7A0B;&#x9009;&#x62E9;&#x7CFB;&#x7EDF;</a></strong></li>
</ul>
</blockquote>
<p>#1.&#x7B80;&#x4ECB;<br>###MVC</p>
<ul>
<li>&#x5927;&#x90E8;&#x5206;&#x5F00;&#x53D1;&#x8BED;&#x8A00;&#x4E2D;&#x90FD;&#x6709;MVC&#x6846;&#x67B6;</li>
<li>MVC&#x6846;&#x67B6;&#x7684;&#x6838;&#x5FC3;&#x601D;&#x60F3;&#x662F;&#xFF1A;&#x89E3;&#x8026;</li>
<li>&#x964D;&#x4F4E;&#x5404;&#x529F;&#x80FD;&#x6A21;&#x5757;&#x4E4B;&#x95F4;&#x7684;&#x8026;&#x5408;&#x6027;&#xFF0C;&#x65B9;&#x4FBF;&#x53D8;&#x66F4;&#xFF0C;&#x66F4;&#x5BB9;&#x6613;&#x91CD;&#x6784;&#x4EE3;&#x7801;&#xFF0C;&#x6700;&#x5927;&#x7A0B;&#x5EA6;&#x4E0A;&#x5B9E;&#x73B0;&#x4EE3;&#x7801;&#x7684;&#x91CD;&#x7528;</li>
<li>m&#x8868;&#x793A;model&#xFF0C;&#x4E3B;&#x8981;&#x7528;&#x4E8E;&#x5BF9;&#x6570;&#x636E;&#x5E93;&#x5C42;&#x7684;&#x5C01;&#x88C5;</li>
<li>v&#x8868;&#x793A;view&#xFF0C;&#x7528;&#x4E8E;&#x5411;&#x7528;&#x6237;&#x5C55;&#x793A;&#x7ED3;&#x679C;</li>
<li>c&#x8868;&#x793A;controller&#xFF0C;&#x662F;&#x6838;&#x5FC3;&#xFF0C;&#x7528;&#x4E8E;&#x5904;&#x7406;&#x8BF7;&#x6C42;&#x3001;&#x83B7;&#x53D6;&#x6570;&#x636E;&#x3001;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;</li>
</ul>
<p>###MVT</p>
<ul>
<li>Django&#x662F;&#x4E00;&#x6B3E;python&#x7684;web&#x5F00;&#x53D1;&#x6846;&#x67B6;</li>
<li>&#x4E0E;MVC&#x6709;&#x6240;&#x4E0D;&#x540C;&#xFF0C;&#x5C5E;&#x4E8E;MVT&#x6846;&#x67B6;</li>
<li>m&#x8868;&#x793A;model&#xFF0C;&#x8D1F;&#x8D23;&#x4E0E;&#x6570;&#x636E;&#x5E93;&#x4EA4;&#x4E92;</li>
<li>v&#x8868;&#x793A;view&#xFF0C;&#x662F;&#x6838;&#x5FC3;&#xFF0C;&#x8D1F;&#x8D23;&#x63A5;&#x6536;&#x8BF7;&#x6C42;&#x3001;&#x83B7;&#x53D6;&#x6570;&#x636E;&#x3001;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;</li>
<li>t&#x8868;&#x793A;template&#xFF0C;&#x8D1F;&#x8D23;&#x5448;&#x73B0;&#x5185;&#x5BB9;&#x5230;&#x6D4F;&#x89C8;&#x5668;</li>
</ul>
<p><a href="/external_links/b12b14cd0c381532260099cc3d608c7a.html" target="blank" rel="noopener">Django</a> &#x662F;&#x7528;Python&#x5F00;&#x53D1;&#x7684;&#x4E00;&#x4E2A;&#x514D;&#x8D39;&#x5F00;&#x6E90;&#x7684;Web&#x6846;&#x67B6;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x5FEB;&#x901F;&#x642D;&#x5EFA;&#x9AD8;&#x6027;&#x80FD;&#xFF0C;&#x4F18;&#x96C5;&#x7684;&#x7F51;&#x7AD9;&#xFF01;</p>
<p><a href="/external_links/b12b14cd0c381532260099cc3d608c7a.html" target="blank" rel="noopener">Django&#x5B98;&#x65B9;&#x7F51;&#x7AD9;</a><br><a href="/external_links/fbd2d16a64efb861a871734320264b2f.html" target="blank" rel="noopener">Django&#x5B98;&#x65B9;&#x6587;&#x6863;</a><br><a href="/external_links/f0b23065131460666382d69cd218f545.html" target="blank" rel="noopener">&#x5B89;&#x88C5;Django&#x5B98;&#x65B9;&#x6587;&#x6863;&#x4ECB;&#x7ECD;</a></p>
<p>Django&#x662F;&#x4E00;&#x4E2A;&#x57FA;&#x4E8E;<a href="/external_links/67a127a716a7c0926f60596656c7ad27.html" target="blank" rel="noopener">MVC</a>&#x6784;&#x9020;&#x7684;&#x6846;&#x67B6;&#x3002;&#x4F46;&#x662F;&#x5728;Django&#x4E2D;&#xFF0C;&#x63A7;&#x5236;&#x5668;&#x63A5;&#x53D7;&#x7528;&#x6237;&#x8F93;&#x5165;&#x7684;&#x90E8;&#x5206;&#x7531;&#x6846;&#x67B6;&#x81EA;&#x884C;&#x5904;&#x7406;&#xFF0C;&#x6240;&#x4EE5; Django &#x91CC;&#x66F4;&#x5173;&#x6CE8;&#x7684;&#x662F;&#x6A21;&#x578B;&#xFF08;Model&#xFF09;&#x3001;&#x6A21;&#x677F;(Template)&#x548C;&#x89C6;&#x56FE;&#xFF08;Views&#xFF09;&#xFF0C;&#x79F0;&#x4E3A; MTV&#x6A21;&#x5F0F;&#x3002;</p>
<p>BSD:BSD&#x8BB8;&#x53EF;&#x8BC1;&#x662F;&#x968F;&#x7740;&#x52A0;&#x5DDE;&#x5927;&#x5B66;&#x4F2F;&#x514B;&#x5229;&#x5206;&#x6821;&#x53D1;&#x5E03;BSD UNIX&#x53D1;&#x5C55;&#x8D77;&#x6765;&#x7684;&#xFF0C;&#x4FEE;&#x6539;&#x7248;&#x672C;&#x88AB;Apple&#x3001;Apache&#x6240;&#x91C7;&#x7528;&#x3002;BSD&#x534F;&#x8BAE;&#x662F;&#x201C;&#x5BBD;&#x5BB9;&#x81EA;&#x7531;&#x8F6F;&#x4EF6;&#x8BB8;&#x53EF;&#x8BC1;&#x201D;&#x4E2D;&#x7684;&#x4E00;&#x5458;&#xFF0C;&#x5728;&#x8F6F;&#x4EF6;&#x590D;&#x7528;&#x4E0A;&#x7ED9;&#x4E88;&#x4E86;&#x6700;&#x5C0F;&#x9650;&#x5EA6;&#x7684;&#x9650;&#x5236;&#x3002;</p>
<p>BSD&#x534F;&#x8BAE;&#x5141;&#x8BB8;&#x4F5C;&#x8005;&#x4F7F;&#x7528;&#x8BE5;&#x534F;&#x8BAE;&#x4E0B;&#x7684;&#x8D44;&#x6E90;&#xFF0C;&#x5C06;&#x5176;&#x5E76;&#x5165;&#x79C1;&#x4EBA;&#x7248;&#x672C;&#x7684;&#x8F6F;&#x4EF6;&#xFF0C;&#x8BE5;&#x8F6F;&#x4EF6;&#x53EF;&#x4F7F;&#x7528;&#x95ED;&#x6E90;&#x8F6F;&#x4EF6;&#x534F;&#x8BAE;&#x53D1;&#x5E03;&#x3002;</p>
<p>#2.&#x73AF;&#x5883;&#x642D;&#x5EFA;</p>
<ol>
<li>&#x4E0B;&#x8F7D;Ubuntu &#x955C;&#x50CF;&#x6587;&#x4EF6;<br><a href="/external_links/222163700a5969db8f58a9fb5f57be95.html" target="blank" rel="noopener">&#x5730;&#x5740;&#x4E00;</a><br><a href="/external_links/72bcddcd0a6b534d58734576856e5370.html" target="blank" rel="noopener">&#x5730;&#x5740;&#x4E8C;</a><br><a href="/external_links/a1f2ac61b411852a57460d38e011202b.html" target="blank" rel="noopener">&#x5730;&#x5740;&#x4E09;</a></li>
<li>&#x5B89;&#x88C5;<a href="/external_links/2652ddf95640d90650eb91a1709560dc.html" target="blank" rel="noopener">ubuntu</a></li>
<li>&#x5B89;&#x88C5;pip,&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x5408;&#x9002;&#x7684;&#x4EE3;&#x7801;&#x5B89;&#x88C5;</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;sudo apt-get update</span><br><span class="line">sudo apt-get upgrade</span><br><span class="line">sudo&#xA0;apt-get&#xA0;install&#xA0;python-pip</span><br></pre></td></tr></table></figure>

<p>&#x5BF9;&#x4E8E;Python&#x5F00;&#x53D1;&#x7528;&#x6237;&#x6765;&#x8BB2;&#xFF0C;PIP&#x5B89;&#x88C5;&#x8F6F;&#x4EF6;&#x5305;&#x662F;&#x5BB6;&#x5E38;&#x4FBF;&#x996D;&#x3002;&#x4F46;&#x56FD;&#x5916;&#x7684;&#x6E90;&#x4E0B;&#x8F7D;&#x901F;&#x5EA6;&#x5B9E;&#x5728;&#x592A;&#x6162;&#xFF0C;&#x6D6A;&#x8D39;&#x65F6;&#x95F4;&#xFF0C;&#x800C;&#x4E14;&#x597D;&#x591A;&#x8F6F;&#x4EF6;&#x603B;&#x662F;&#x88AB;&#x5899;&#xFF0C;&#x6240;&#x4EE5;&#x628A;PIP&#x5B89;&#x88C5;&#x6E90;&#x66FF;&#x6362;&#x6210;&#x56FD;&#x5185;&#x955C;&#x50CF;&#xFF0C;&#x53EF;&#x4EE5;&#x5927;&#x5E45;&#x63D0;&#x5347;&#x4E0B;&#x8F7D;&#x901F;&#x5EA6;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x89E3;&#x51B3;&#x88AB;&#x5899;&#x5BFC;&#x81F4;&#x7684;&#x88C5;&#x4E0D;&#x4E0A;&#x5E93;&#x7684;&#x70E6;&#x607C;&#xFF0C;&#x63D0;&#x9AD8;&#x5B89;&#x88C5;&#x6210;&#x529F;&#x7387;&#x3002;&#x7F51;&#x4E0A;&#x6709;&#x5F88;&#x591A;&#x53EF;&#x7528;&#x7684;&#x6E90;&#xFF0C;&#x8FD9;&#x91CC;&#x63A8;&#x8350;&#x7684;&#x662F;<a href="/external_links/ae4ff06f3cc95a9e1e009a5cd7bf8951.html" target="blank" rel="noopener">&#x6E05;&#x534E;&#x5927;&#x5B66;&#x7684;pip&#x6E90;</a>&#xFF0C;&#x5B83;&#x662F;&#x5B98;&#x7F51;pypi&#x7684;&#x955C;&#x50CF;&#xFF0C;&#x6BCF;&#x9694;5&#x5206;&#x949F;&#x540C;&#x6B65;&#x4E00;&#x6B21;&#x3002;</p>
<p><a href="/external_links/9b2295834899302837ea9fcdb407b874.html" target="blank" rel="noopener">Linux</a>&#x4E0B;&#xFF0C;&#x4FEE;&#x6539; ~/.pip/pip.conf (&#x6CA1;&#x6709;&#x5C31;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;)&#xFF0C;&#x6309;&#x4E0B;Ctrl + H &#x53EF;&#x4EE5;&#x770B;&#x5230;&#x9690;&#x85CF;&#x6587;&#x4EF6;,&#x4FEE;&#x6539; index-url&#x81F3;tuna&#xFF0C;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;[global]</span><br><span class="line">index-url = https://pypi.tuna.tsinghua.edu.cn/simple</span><br></pre></td></tr></table></figure>

<p>4.&#x5229;&#x7528;pip&#x5B89;&#x88C5; Django(&#x63A8;&#x8350;&#x4F7F;&#x7528;1.11&#x7248;&#x672C;)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;(sudo)pip install Django</span><br><span class="line">&#x6216;&#x8005; (sudo) pip install Django==1.8.16 </span><br><span class="line">&#x6216;&#x8005; pip install Django==1.11</span><br></pre></td></tr></table></figure>

<p>&#x68C0;&#x67E5;&#x662F;&#x5426;&#x5B89;&#x88C5;&#x6210;&#x529F;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&gt;&gt;&gt; import django</span><br><span class="line">&gt;&gt;&gt; django.VERSION</span><br><span class="line">(1, 11, &apos;final&apos;, 0)</span><br><span class="line">&gt;&gt;&gt; </span><br><span class="line">&gt;&gt;&gt; django.get_version()</span><br><span class="line">&apos;1.11&apos;</span><br></pre></td></tr></table></figure>

<p>#3.&#x5B89;&#x88C5;pycharm</p>
<ol>
<li>&#x4E0B;&#x8F7D;<a href="/external_links/9140553c53ed172afe90d5c3caac1867.html" target="blank" rel="noopener">JDK</a></li>
</ol>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/1c00e16c0db1f129d7b8b87fad27646fdfc393600d20182fa7eb94682601b913" alt><br>2. &#x89E3;&#x538B;<br>&#x8F93;&#x5165;&#x547D;&#x4EE4;&#xFF1A;<code>tar zvxf jdk-8u131-linux-x64.tar.gz</code><br>3. &#x521B;&#x5EFA;jvm&#x6587;&#x4EF6;<br>&#x8F93;&#x5165;&#x547D;&#x4EE4;&#xFF1A;<code>sudo mkdir /usr/lib/jvm</code><br>4. &#x79FB;&#x52A8;&#x5230;/usr/lib/jvm&#x4E0B;<br>&#x8F93;&#x5165;&#x547D;&#x4EE4;&#xFF1A;<code>sudo mv jdk1.8.0_131/ /usr/lib/jvm/</code><br>**&#x6CE8;&#x610F;&#xFF1A;**&#x5982;&#x679C;&#x6CA1;&#x6709;jvm&#x6587;&#x4EF6;&#xFF0C;&#x6267;&#x884C;&#x8BE5;&#x8BED;&#x53E5;&#x867D;&#x7136;&#x4F1A;&#x81EA;&#x52A8;&#x521B;&#x5EFA;jvm&#x6587;&#x4EF6;&#xFF0C;&#x4F46;&#x53EA;&#x4F1A;&#x628A;jdk1.8.0_25&#x91CC;&#x9762;&#x7684;&#x6587;&#x4EF6;&#x90FD;&#x653E;&#x5230;jvm&#x4E2D;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x628A;jdk1.8.0_25&#x53CA;&#x5176;&#x91CC;&#x9762;&#x7684;&#x6587;&#x4EF6;&#x653E;&#x5230;jvm&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x4E24;&#x8005;&#x662F;&#x6709;&#x533A;&#x522B;&#x7684;<br>5. &#x8BBE;&#x7F6E;JDK&#x73AF;&#x5883;&#x53D8;&#x91CF;<br>&#xFF08;&#x4E5F;&#x6709;&#x5728;<del>/.bashrc&#x4FEE;&#x6539;&#x7684;&#xFF0C;&#x533A;&#x522B;&#x662F;&#xFF1A;/etc/profile&#x7684;&#x8BBE;&#x7F6E;&#x65B9;&#x6CD5;&#x5BF9;&#x6240;&#x6709;&#x767B;&#x9646;&#x7528;&#x6237;&#x90FD;&#x6709;&#x6548;</del>/.bashrc&#x53EA;&#x5BF9;&#x5F53;&#x524D;&#x7528;&#x6237;&#x6709;&#x6548;&#xFF09;<br>&#x8F93;&#x5165;&#x547D;&#x4EE4;&#xFF1A;<code>sudo vim ~/.profile</code><br>&#x7F16;&#x8F91;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;export JAVA_HOME=/usr/lib/jvm/jdk1.8.0_131</span><br><span class="line">export JRE_HOME=${JAVA_HOME}/jre</span><br><span class="line">export CLASSPATH=.:${JAVA_HOME}/lib:${JRE_HOME}/lib</span><br><span class="line">export PATH=${JAVA_HOME}/bin:$PATH</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>&#x4F7F;&#x4FEE;&#x6539;&#x7ACB;&#x523B;&#x751F;&#x6548;<code>source ~/.profile</code></li>
<li>&#x9A8C;&#x8BC1;JDK<br>&#x8F93;&#x5165;&#x547D;&#x4EE4;&#xFF1A;<code>java -version</code><br><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/1c00e16c0db1f129d7b8b87fad27646fdfc393600d20182fa7eb94682601b913" alt></li>
</ol>
<p>#4.Ubuntu&#x4E0B; &#x6B63;&#x786E;&#x5B89;&#x88C5;VMware Tools<br>&#x4E3A;&#x4E86;&#x5B9E;&#x73B0;&#x53EF;&#x4EE5;&#x4ECE;windows&#x62D6;&#x62FD;&#x6587;&#x4EF6;&#x5230;ubuntu&#xFF0C;&#x53EF;&#x4EE5;<a href="/external_links/4e6d5536446f14008a46efbcc0d718aa.html" target="blank" rel="noopener">&#x5B89;&#x88C5;VMware Tools</a>&#x3002;</p>
<p>#5.Django&#x4E3B;&#x8981;&#x6A21;&#x5757;</p>
<ul>
<li><strong>urls.py</strong><br>&#x7F51;&#x5740;&#x5165;&#x53E3;&#xFF0C;&#x5173;&#x8054;&#x5230;&#x5BF9;&#x5E94;&#x7684;views.py&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#xFF08;&#x6216;&#x8005;generic&#x7C7B;&#xFF09;&#xFF0C;&#x8BBF;&#x95EE;&#x7F51;&#x5740;&#x5C31;&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x3002;</li>
<li><strong>views.py</strong><br>&#x5904;&#x7406;&#x7528;&#x6237;&#x53D1;&#x51FA;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x4ECE;urls.py&#x4E2D;&#x5BF9;&#x5E94;&#x8FC7;&#x6765;, &#x901A;&#x8FC7;&#x6E32;&#x67D3;templates&#x4E2D;&#x7684;&#x7F51;&#x9875;&#x53EF;&#x4EE5;&#x5C06;&#x663E;&#x793A;&#x5185;&#x5BB9;&#xFF0C;&#x6BD4;&#x5982;&#x767B;&#x9646;&#x540E;&#x7684;&#x7528;&#x6237;&#x540D;&#xFF0C;&#x7528;&#x6237;&#x8BF7;&#x6C42;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x8F93;&#x51FA;&#x5230;&#x7F51;&#x9875;&#x3002;</li>
<li><strong>models.py</strong><br>&#x4E0E;&#x6570;&#x636E;&#x5E93;&#x64CD;&#x4F5C;&#x76F8;&#x5173;&#xFF0C;&#x5B58;&#x5165;&#x6216;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x65F6;&#x7528;&#x5230;&#x8FD9;&#x4E2A;&#xFF0C;&#x5F53;&#x7136;&#x7528;&#x4E0D;&#x5230;&#x6570;&#x636E;&#x5E93;&#x7684;&#x65F6;&#x5019; &#x4F60;&#x53EF;&#x4EE5;&#x4E0D;&#x4F7F;&#x7528;&#x3002;</li>
<li><strong>forms.py</strong><br>&#x8868;&#x5355;&#xFF0C;&#x7528;&#x6237;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x4E0A;&#x8F93;&#x5165;&#x6570;&#x636E;&#x63D0;&#x4EA4;&#xFF0C;&#x5BF9;&#x6570;&#x636E;&#x7684;&#x9A8C;&#x8BC1;&#x5DE5;&#x4F5C;&#x4EE5;&#x53CA;&#x8F93;&#x5165;&#x6846;&#x7684;&#x751F;&#x6210;&#x7B49;&#x5DE5;&#x4F5C;&#xFF0C;&#x5F53;&#x7136;&#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x4E0D;&#x4F7F;&#x7528;&#x3002;</li>
<li><strong>templates &#x6587;&#x4EF6;&#x5939;</strong><br>views.py &#x4E2D;&#x7684;&#x51FD;&#x6570;&#x6E32;&#x67D3;templates&#x4E2D;&#x7684;Html&#x6A21;&#x677F;&#xFF0C;&#x5F97;&#x5230;&#x52A8;&#x6001;&#x5185;&#x5BB9;&#x7684;&#x7F51;&#x9875;&#xFF0C;&#x5F53;&#x7136;&#x53EF;&#x4EE5;&#x7528;&#x7F13;&#x5B58;&#x6765;&#x63D0;&#x9AD8;&#x901F;&#x5EA6;&#x3002;</li>
<li><strong>admin.py</strong><br>&#x540E;&#x53F0;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x5F88;&#x5C11;&#x91CF;&#x7684;&#x4EE3;&#x7801;&#x5C31;&#x62E5;&#x6709;&#x4E00;&#x4E2A;&#x5F3A;&#x5927;&#x7684;&#x540E;&#x53F0;&#x3002;</li>
<li><strong>settings.py</strong><br>Django &#x7684;&#x8BBE;&#x7F6E;&#xFF0C;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x6BD4;&#x5982; DEBUG &#x7684;&#x5F00;&#x5173;&#xFF0C;&#x9759;&#x6001;&#x6587;&#x4EF6;&#x7684;&#x4F4D;&#x7F6E;&#x7B49;&#x3002;</li>
</ul>
<p>#6.Django&#x57FA;&#x672C;&#x547D;&#x4EE4;</p>
<ul>
<li>&#x65B0;&#x5EFA;&#x4E00;&#x4E2A; django project</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;django-admin.py startproject project_name</span><br><span class="line">&#x7279;&#x522B;&#x662F;&#x5728; windows &#x4E0A;&#xFF0C;&#x5982;&#x679C;&#x62A5;&#x9519;&#xFF0C;&#x5C1D;&#x8BD5;&#x7528; django-admin &#x4EE3;&#x66FF; django-admin.py &#x8BD5;&#x8BD5;</span><br></pre></td></tr></table></figure>

<p>&#x6CE8;&#x610F; project_name &#x662F;&#x81EA;&#x5DF1;&#x7684;&#x9879;&#x76EE;&#x540D;&#x79F0;&#xFF0C;&#x9700;&#x8981;&#x4E3A;&#x5408;&#x6CD5;&#x7684; Python &#x5305;&#x540D;&#xFF0C;&#x5982;&#x4E0D;&#x80FD;&#x4E3A; 1a &#x6216; a-b&#x3002;</p>
<ul>
<li>&#x65B0;&#x5EFA; app<br>&#x8981;&#x5148;&#x8FDB;&#x5165;&#x9879;&#x76EE;&#x76EE;&#x5F55;&#x4E0B;&#xFF0C;cd project_name &#x7136;&#x540E;&#x6267;&#x884C;&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;&#xFF08;&#x4E0B;&#x540C;&#xFF0C;&#x5DF2;&#x7ECF;&#x5728;&#x9879;&#x76EE;&#x76EE;&#x5F55;&#x4E0B;&#x5219;&#x4E0D;&#x9700;&#x8981; cd project_name&#xFF09;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;python manage.py startapp app_name</span><br><span class="line">&#x6216; django-admin.py startapp app_name</span><br></pre></td></tr></table></figure>

<p>&#x4E00;&#x822C;&#x4E00;&#x4E2A;&#x9879;&#x76EE;&#x6709;&#x591A;&#x4E2A;app, &#x5F53;&#x7136;&#x901A;&#x7528;&#x7684;app&#x4E5F;&#x53EF;&#x4EE5;&#x5728;&#x591A;&#x4E2A;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x3002;<br>&#x4E0E;&#x9879;&#x76EE;&#x540D;&#x7C7B;&#x4F3C; app name &#x4E5F;&#x9700;&#x8981;&#x4E3A;&#x5408;&#x6CD5;&#x7684; Python &#x5305;&#x540D;&#xFF0C;&#x5982; blog&#xFF0C;news, aboutus &#x7B49;&#x90FD;&#x662F;&#x5408;&#x6CD5;&#x7684; app &#x540D;&#x79F0;&#x3002;</p>
<ul>
<li>&#x521B;&#x5EFA;&#x6570;&#x636E;&#x5E93;&#x8868; &#x6216; &#x66F4;&#x6539;&#x6570;&#x636E;&#x5E93;&#x8868;&#x6216;&#x5B57;&#x6BB5;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;Django 1.7.1&#x53CA;&#x4EE5;&#x4E0A; &#x7528;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;</span><br><span class="line"># 1. &#x521B;&#x5EFA;&#x66F4;&#x6539;&#x7684;&#x6587;&#x4EF6;</span><br><span class="line">python manage.py makemigrations</span><br><span class="line"># 2. &#x5C06;&#x751F;&#x6210;&#x7684;py&#x6587;&#x4EF6;&#x5E94;&#x7528;&#x5230;&#x6570;&#x636E;&#x5E93;</span><br><span class="line">python manage.py migrate</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">&#x65E7;&#x7248;&#x672C;&#x7684;Django 1.6&#x53CA;&#x4EE5;&#x4E0B;&#x7528;</span><br><span class="line">python manage.py syncdb</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x5728;SQL&#x7B49;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x521B;&#x5EFA;&#x4E0E;models.py&#x4EE3;&#x7801;&#x5BF9;&#x5E94;&#x7684;&#x8868;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x81EA;&#x5DF1;&#x624B;&#x52A8;&#x6267;&#x884C;SQL&#x3002;<br>&#x5907;&#x6CE8;&#xFF1A;&#x5BF9;&#x5DF2;&#x6709;&#x7684; models &#x8FDB;&#x884C;&#x4FEE;&#x6539;&#xFF0C;Django 1.7&#x4E4B;&#x524D;&#x7684;&#x7248;&#x672C;&#x7684;Django&#x90FD;&#x662F;&#x65E0;&#x6CD5;&#x81EA;&#x52A8;&#x66F4;&#x6539;&#x8868;&#x7ED3;&#x6784;&#x7684;&#xFF0C;&#x4E0D;&#x8FC7;&#x6709;&#x7B2C;&#x4E09;&#x65B9;&#x5DE5;&#x5177; south</p>
<ul>
<li>&#x4F7F;&#x7528;&#x5F00;&#x53D1;&#x670D;&#x52A1;&#x5668;<br>&#x5F00;&#x53D1;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x5373;&#x5F00;&#x53D1;&#x65F6;&#x4F7F;&#x7528;&#xFF0C;&#x4E00;&#x822C;&#x4FEE;&#x6539;&#x4EE3;&#x7801;&#x540E;&#x4F1A;&#x81EA;&#x52A8;&#x91CD;&#x542F;&#xFF0C;&#x65B9;&#x4FBF;&#x8C03;&#x8BD5;&#x548C;&#x5F00;&#x53D1;&#xFF0C;&#x4F46;&#x662F;&#x7531;&#x4E8E;&#x6027;&#x80FD;&#x95EE;&#x9898;&#xFF0C;&#x5EFA;&#x8BAE;&#x53EA;&#x7528;&#x6765;&#x6D4B;&#x8BD5;&#xFF0C;&#x4E0D;&#x8981;&#x7528;&#x5728;&#x751F;&#x4EA7;&#x73AF;&#x5883;&#x3002;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;python manage.py runserver</span><br><span class="line"> </span><br><span class="line"># &#x5F53;&#x63D0;&#x793A;&#x7AEF;&#x53E3;&#x88AB;&#x5360;&#x7528;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x5176;&#x5B83;&#x7AEF;&#x53E3;&#xFF1A;</span><br><span class="line">python manage.py runserver 8001</span><br><span class="line">python manage.py runserver 9999</span><br><span class="line">&#xFF08;&#x5F53;&#x7136;&#x4E5F;&#x53EF;&#x4EE5;kill&#x6389;&#x5360;&#x7528;&#x7AEF;&#x53E3;&#x7684;&#x8FDB;&#x7A0B;&#xFF09;</span><br><span class="line"> </span><br><span class="line"># &#x76D1;&#x542C;&#x673A;&#x5668;&#x6240;&#x6709;&#x53EF;&#x7528; ip &#xFF08;&#x7535;&#x8111;&#x53EF;&#x80FD;&#x6709;&#x591A;&#x4E2A;&#x5185;&#x7F51;ip&#x6216;&#x591A;&#x4E2A;&#x5916;&#x7F51;ip&#xFF09;</span><br><span class="line">python manage.py runserver 0.0.0.0:8000</span><br><span class="line"># &#x5982;&#x679C;&#x662F;&#x5916;&#x7F51;&#x6216;&#x8005;&#x5C40;&#x57DF;&#x7F51;&#x7535;&#x8111;&#x4E0A;&#x53EF;&#x4EE5;&#x7528;&#x5176;&#x5B83;&#x7535;&#x8111;&#x67E5;&#x770B;&#x5F00;&#x53D1;&#x670D;&#x52A1;&#x5668;</span><br><span class="line"># &#x8BBF;&#x95EE;&#x5BF9;&#x5E94;&#x7684; ip&#x52A0;&#x7AEF;&#x53E3;&#xFF0C;&#x6BD4;&#x5982; http://172.16.20.2:8000</span><br></pre></td></tr></table></figure>

<ul>
<li>&#x6E05;&#x7A7A;&#x6570;&#x636E;&#x5E93;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;python manage.py flush</span><br></pre></td></tr></table></figure>

<p>&#x6B64;&#x547D;&#x4EE4;&#x4F1A;&#x8BE2;&#x95EE;&#x662F; yes &#x8FD8;&#x662F; no, &#x9009;&#x62E9; yes &#x4F1A;&#x628A;&#x6570;&#x636E;&#x5168;&#x90E8;&#x6E05;&#x7A7A;&#x6389;&#xFF0C;&#x53EA;&#x7559;&#x4E0B;&#x7A7A;&#x8868;&#x3002;</p>
<ul>
<li>&#x521B;&#x5EFA;&#x8D85;&#x7EA7;&#x7BA1;&#x7406;&#x5458;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;python manage.py createsuperuser</span><br><span class="line"> </span><br><span class="line"># &#x6309;&#x7167;&#x63D0;&#x793A;&#x8F93;&#x5165;&#x7528;&#x6237;&#x540D;&#x548C;&#x5BF9;&#x5E94;&#x7684;&#x5BC6;&#x7801;&#x5C31;&#x597D;&#x4E86;&#x90AE;&#x7BB1;&#x53EF;&#x4EE5;&#x7559;&#x7A7A;&#xFF0C;&#x7528;&#x6237;&#x540D;&#x548C;&#x5BC6;&#x7801;&#x5FC5;&#x586B;</span><br><span class="line"> </span><br><span class="line"># &#x4FEE;&#x6539; &#x7528;&#x6237;&#x5BC6;&#x7801;&#x53EF;&#x4EE5;&#x7528;&#xFF1A;</span><br><span class="line">python manage.py changepassword username</span><br></pre></td></tr></table></figure>

<ul>
<li>Django &#x9879;&#x76EE;&#x73AF;&#x5883;&#x7EC8;&#x7AEF;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;python manage.py shell</span><br></pre></td></tr></table></figure>

<p>#7. Django&#x89C6;&#x56FE;&#x4E0E;&#x7F51;&#x5740;<br>###1.Django&#x4E2D;&#x7F51;&#x5740;&#x662F;&#x5199;&#x5728; urls.py &#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x7528;&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;&#x5BF9;&#x5E94; views.py &#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x51FD;&#x6570;(&#x6216;&#x8005;generic&#x7C7B;)&#x3002;</p>
<ol>
<li>&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x9879;&#x76EE;(project), &#x540D;&#x79F0;&#x4E3A; zebk</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;django-admin startproject zebk</span><br></pre></td></tr></table></figure>

<p>&#x5907;&#x6CE8;&#xFF1A; &#x5982;&#x679C; django-admin &#x4E0D;&#x884C;&#xFF0C;&#x8BF7;&#x7528; django-admin.py<br>2. &#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x5E94;&#x7528;(app), &#x540D;&#x79F0;&#x53EB; zhong</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;python manage.py startapp zhong  # zhong &#x662F;&#x4E00;&#x4E2A;app&#x7684;&#x540D;&#x79F0;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>&#x6CE8;&#xFF1A;Django 1.8.x &#x4EE5;&#x4E0A;&#x7684;&#xFF0C;&#x8FD8;&#x6709;&#x4E00;&#x4E2A; migrations &#x6587;&#x4EF6;&#x5939;&#x3002;Django 1.9.x &#x8FD8;&#x4F1A;&#x5728; Django 1.8 &#x7684;&#x57FA;&#x7840;&#x4E0A;&#x591A;&#x51FA;&#x4E00;&#x4E2A; apps.py &#x6587;&#x4EF6;&#x3002;</li>
</ol>
<p>&#x628A;&#x6211;&#x4EEC;&#x65B0;&#x5B9A;&#x4E49;&#x7684;app&#x52A0;&#x5230;settings.py&#x4E2D;&#x7684;INSTALL_APPS&#x4E2D;<br>&#x4FEE;&#x6539; mysite/mysite/settings.py</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;INSTALLED_APPS = (</span><br><span class="line">    &apos;django.contrib.admin&apos;,</span><br><span class="line">    &apos;django.contrib.auth&apos;,</span><br><span class="line">    &apos;django.contrib.contenttypes&apos;,</span><br><span class="line">    &apos;django.contrib.sessions&apos;,</span><br><span class="line">    &apos;django.contrib.messages&apos;,</span><br><span class="line">    &apos;django.contrib.staticfiles&apos;,</span><br><span class="line"> </span><br><span class="line">    &apos;zhong&apos;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>&#x4F5C;&#x7528;&#xFF1A;&#x65B0;&#x5EFA;&#x7684; app &#x5982;&#x679C;&#x4E0D;&#x52A0;&#x5230; INSTALL_APPS &#x4E2D;&#x7684;&#x8BDD;, django &#x5C31;&#x4E0D;&#x80FD;&#x81EA;&#x52A8;&#x627E;&#x5230;app&#x4E2D;&#x7684;&#x6A21;&#x677F;&#x6587;&#x4EF6;(app-name/templates/&#x4E0B;&#x7684;&#x6587;&#x4EF6;)&#x548C;&#x9759;&#x6001;&#x6587;&#x4EF6;(app-name/static/&#x4E2D;&#x7684;&#x6587;&#x4EF6;)</p>
<p>###2.&#x5B9A;&#x4E49;&#x89C6;&#x56FE;&#x51FD;&#x6570;(&#x5373;&#x8BBF;&#x95EE;&#x9875;&#x9762;&#x65F6;&#x663E;&#x793A;&#x7684;&#x5185;&#x5BB9;)<br>&#x6253;&#x5F00;/zebk&#x4E0B;&#x7684;views.py&#x6587;&#x4EF6; &#x589E;&#x52A0;&#x4EE5;&#x4E0B;&#x5185;&#x5BB9;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;# -*- coding: utf-8 -*- </span><br><span class="line">from django.http import HttpResponse</span><br><span class="line"> </span><br><span class="line">def index(request):</span><br><span class="line">    return HttpResponse(u&quot;hellow &#x4E2D;&#x4E8C;&#x75C5;&#x63A7;&#x4E36;!&quot;)</span><br></pre></td></tr></table></figure>

<ol>
<li>&#x7B2C;&#x4E00;&#x884C;&#x662F;&#x58F0;&#x660E;&#x7F16;&#x7801;&#x4E3A;<code>utf-8</code>, &#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x7528;&#x5230;&#x4E86;&#x4E2D;&#x6587;,&#x5982;&#x679C;&#x4E0D;&#x58F0;&#x660E;&#x5C31;&#x62A5;&#x9519;.</li>
<li>&#x7B2C;&#x4E8C;&#x884C;&#x5F15;&#x5165;HttpResponse&#xFF0C;&#x5B83;&#x662F;&#x7528;&#x6765;&#x5411;&#x7F51;&#x9875;&#x8FD4;&#x56DE;&#x5185;&#x5BB9;&#x7684;&#xFF0C;&#x5C31;&#x50CF;Python&#x4E2D;&#x7684; <code>print</code> &#x4E00;&#x6837;&#xFF0C;&#x53EA;&#x4E0D;&#x8FC7; <code>HttpResponse</code> &#x662F;&#x628A;&#x5185;&#x5BB9;&#x663E;&#x793A;&#x5230;&#x7F51;&#x9875;&#x4E0A;&#x3002;</li>
<li>&#x6211;&#x4EEC;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E2A;<code>index()</code>&#x51FD;&#x6570;&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x5FC5;&#x987B;&#x662F; request&#xFF0C;&#x4E0E;&#x7F51;&#x9875;&#x53D1;&#x6765;&#x7684;&#x8BF7;&#x6C42;&#x6709;&#x5173;&#xFF0C;request &#x53D8;&#x91CF;&#x91CC;&#x9762;&#x5305;&#x542B;get&#x6216;post&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x7528;&#x6237;&#x6D4F;&#x89C8;&#x5668;&#xFF0C;&#x7CFB;&#x7EDF;&#x7B49;&#x4FE1;&#x606F;&#x5728;&#x91CC;&#x9762;&#xFF08;&#x540E;&#x9762;&#x4F1A;&#x8BB2;&#xFF0C;&#x5148;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;&#x5C31;&#x53EF;&#x4EE5;&#xFF09;&#x3002;</li>
<li>&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x4E86;&#x4E00;&#x4E2A; <code>HttpResponse</code> &#x5BF9;&#x8C61;&#xFF0C;&#x53EF;&#x4EE5;&#x7ECF;&#x8FC7;&#x4E00;&#x4E9B;&#x5904;&#x7406;&#xFF0C;&#x6700;&#x7EC8;&#x663E;&#x793A;&#x51E0;&#x4E2A;&#x5B57;&#x5230;&#x7F51;&#x9875;&#x4E0A;&#x3002;</li>
</ol>
<p>###3. &#x5B9A;&#x4E49;&#x89C6;&#x56FE;&#x51FD;&#x6570;&#x51FD;&#x6570;&#x76F8;&#x5173;&#x7684;URL</p>
<ol>
<li>&#x5B9A;&#x4E49;&#x89C6;&#x56FE;&#x51FD;&#x6570;&#x76F8;&#x5173;&#x7684;URL(&#x7F51;&#x5740;)  &#xFF08;&#x5373;&#x89C4;&#x5B9A; &#x8BBF;&#x95EE;&#x4EC0;&#x4E48;&#x7F51;&#x5740;&#x5BF9;&#x5E94;&#x4EC0;&#x4E48;&#x5185;&#x5BB9;&#xFF09;<br>&#x6253;&#x5F00; mysite/mysite/urls.py &#x8FD9;&#x4E2A;&#x6587;&#x4EF6;, &#x4FEE;&#x6539;&#x5176;&#x4E2D;&#x7684;&#x4EE3;&#x7801;:<br>&#x5728;mysite/urls.py&#xFF0C;&#x5BFC;&#x5165;django.conf.urls.include&#x6A21;&#x5757;&#xFF0C;&#x5E76;&#x4E14;&#x6DFB;&#x52A0;&#x5230;urlpatterns&#x5217;&#x8868;&#xFF0C;&#x6240;&#x4EE5;mysite/urls.py&#x5982;&#x4E0B;&#xFF1A;</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;# mysite/urls.py</span><br><span class="line">from django.conf.urls import include, url</span><br><span class="line">from django.contrib import admin</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(r&apos;^zhong/&apos;, include(&apos;zhong.urls&apos;)),</span><br><span class="line">    url(r&apos;^admin/&apos;, admin.site.urls),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>2.&#x5728;zhong&#x4E2D;&#x521B;&#x5EFA;urls.py,&#x7F16;&#x5199;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;from django.conf.urls import url</span><br><span class="line"></span><br><span class="line">from . import views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(r&apos;^$&apos;, views.index, name=&apos;index&apos;),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>&#x7136;&#x540E;&#x5728;&#x7EC8;&#x7AEF;&#x4E0A;&#x8FD0;&#x884C; python manage.py runserver &#x6211;&#x4EEC;&#x4F1A;&#x770B;&#x5230;&#x7C7B;&#x4F3C;&#x4E0B;&#x9762;&#x7684;&#x4FE1;&#x606F;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801; python manage.py runserver</span><br><span class="line"> </span><br><span class="line">Performing system checks...</span><br><span class="line"> </span><br><span class="line">System check identified no issues (0 silenced).</span><br><span class="line"> </span><br><span class="line">You have unapplied migrations; your app may not work properly until they are applied.</span><br><span class="line">Run &apos;python manage.py migrate&apos; to apply them.</span><br><span class="line"> </span><br><span class="line">December 22, 2015 - 11:57:33</span><br><span class="line">Django version 1.9, using settings &apos;mysite.settings&apos;</span><br><span class="line">Starting development server at http://127.0.0.1:8000/</span><br><span class="line">Quit the server with CONTROL-C.</span><br></pre></td></tr></table></figure>

<p><strong>&#x6253;&#x5F00;&#x7F51;&#x9875;&#xFF0C;&#x8F93;&#x5165;<code>127.0.0.1:8000/zhong/</code></strong></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/1c00e16c0db1f129d7b8b87fad27646fdfc393600d20182fa7eb94682601b913" alt></p>
<p>#8.&#x7BA1;&#x7406;&#x64CD;&#x4F5C;</p>
<ul>
<li>&#x7AD9;&#x70B9;&#x5206;&#x4E3A;&#x201C;&#x5185;&#x5BB9;&#x53D1;&#x5E03;&#x201D;&#x548C;&#x201C;&#x516C;&#x5171;&#x8BBF;&#x95EE;&#x201D;&#x4E24;&#x90E8;&#x5206;</li>
<li>&#x201C;&#x5185;&#x5BB9;&#x53D1;&#x5E03;&#x201D;&#x7684;&#x90E8;&#x5206;&#x8D1F;&#x8D23;&#x6DFB;&#x52A0;&#x3001;&#x4FEE;&#x6539;&#x3001;&#x5220;&#x9664;&#x5185;&#x5BB9;&#xFF0C;&#x5F00;&#x53D1;&#x8FD9;&#x4E9B;&#x91CD;&#x590D;&#x7684;&#x529F;&#x80FD;&#x662F;&#x4E00;&#x4EF6;&#x5355;&#x8C03;&#x4E4F;&#x5473;&#x3001;&#x7F3A;&#x4E4F;&#x521B;&#x9020;&#x529B;&#x7684;&#x5DE5;&#x4F5C;&#x3002;&#x4E3A;&#x6B64;&#xFF0C;Django&#x4F1A;&#x6839;&#x636E;&#x5B9A;&#x4E49;&#x7684;&#x6A21;&#x578B;&#x7C7B;&#x5B8C;&#x5168;&#x81EA;&#x52A8;&#x5730;&#x751F;&#x6210;&#x7BA1;&#x7406;&#x6A21;&#x5757;<br>###&#x4F7F;&#x7528;django&#x7684;&#x7BA1;&#x7406;<br>&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x7BA1;&#x7406;&#x5458;&#x7528;&#x6237;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;python manage.py createsuperuser&#xFF0C;&#x6309;&#x63D0;&#x793A;&#x8F93;&#x5165;&#x7528;&#x6237;&#x540D;&#x3001;&#x90AE;&#x7BB1;&#x3001;&#x5BC6;&#x7801;</span><br></pre></td></tr></table></figure>

<ul>
<li>&#x542F;&#x52A8;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x901A;&#x8FC7;&#x201C;127.0.0.1:8000/admin&#x201D;&#x8BBF;&#x95EE;&#xFF0C;&#x8F93;&#x5165;&#x4E0A;&#x9762;&#x521B;&#x5EFA;&#x7684;&#x7528;&#x6237;&#x540D;&#x3001;&#x5BC6;&#x7801;&#x5B8C;&#x6210;&#x767B;&#x5F55;</li>
<li>&#x8FDB;&#x5165;&#x7BA1;&#x7406;&#x7AD9;&#x70B9;&#xFF0C;&#x9ED8;&#x8BA4;&#x53EF;&#x4EE5;&#x5BF9;groups&#x3001;users&#x8FDB;&#x884C;&#x7BA1;&#x7406;</li>
</ul>
<p>###&#x7BA1;&#x7406;&#x754C;&#x9762;&#x672C;&#x5730;&#x5316;</p>
<ul>
<li>&#x7F16;&#x8F91;settings.py&#x6587;&#x4EF6;&#xFF0C;&#x8BBE;&#x7F6E;&#x7F16;&#x7801;&#x3001;&#x65F6;&#x533A;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;LANGUAGE_CODE = &apos;zh-Hans&apos;</span><br><span class="line">TIME_ZONE = &apos;Asia/Shanghai&apos;</span><br></pre></td></tr></table></figure>

<p>###&#x5411;admin&#x6CE8;&#x518C;booktest&#x7684;&#x6A21;&#x578B;</p>
<ul>
<li>&#x6253;&#x5F00;booktest/admin.py&#x6587;&#x4EF6;&#xFF0C;&#x6CE8;&#x518C;&#x6A21;&#x578B;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;from django.contrib import admin</span><br><span class="line">from models import BookInfo</span><br><span class="line">admin.site.register(BookInfo)</span><br></pre></td></tr></table></figure>

<ul>
<li>&#x5237;&#x65B0;&#x7BA1;&#x7406;&#x9875;&#x9762;&#xFF0C;&#x53EF;&#x4EE5;&#x5BF9;BookInfo&#x7684;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x589E;&#x5220;&#x6539;&#x67E5;&#x64CD;&#x4F5C;</li>
<li>&#x95EE;&#x9898;&#xFF1A;&#x5982;&#x679C;&#x5728;str&#x65B9;&#x6CD5;&#x4E2D;&#x8FD4;&#x56DE;&#x4E2D;&#x6587;&#xFF0C;&#x5728;&#x4FEE;&#x6539;&#x548C;&#x6DFB;&#x52A0;&#x65F6;&#x4F1A;&#x62A5;ascii&#x7684;&#x9519;&#x8BEF;</li>
<li>&#x89E3;&#x51B3;&#xFF1A;&#x5728;str()&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x5C06;&#x5B57;&#x7B26;&#x4E32;&#x672B;&#x5C3E;&#x6DFB;&#x52A0;&#x201C;.encode(&#x2018;utf-8&#x2019;)&#x201D;<br>###&#x81EA;&#x5B9A;&#x4E49;&#x7BA1;&#x7406;&#x9875;&#x9762;</li>
<li>Django&#x63D0;&#x4F9B;&#x4E86;admin.ModelAdmin&#x7C7B;</li>
<li>&#x901A;&#x8FC7;&#x5B9A;&#x4E49;ModelAdmin&#x7684;&#x5B50;&#x7C7B;&#xFF0C;&#x6765;&#x5B9A;&#x4E49;&#x6A21;&#x578B;&#x5728;Admin&#x754C;&#x9762;&#x7684;&#x663E;&#x793A;&#x65B9;&#x5F0F;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;class QuestionAdmin(admin.ModelAdmin):</span><br><span class="line">    ...</span><br><span class="line">admin.site.register(Question, QuestionAdmin)</span><br></pre></td></tr></table></figure>

<p>#####&#x5217;&#x8868;&#x9875;&#x5C5E;&#x6027;</p>
<ul>
<li>list_display&#xFF1A;&#x663E;&#x793A;&#x5B57;&#x6BB5;&#xFF0C;&#x53EF;&#x4EE5;&#x70B9;&#x51FB;&#x5217;&#x5934;&#x8FDB;&#x884C;&#x6392;&#x5E8F;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;list_display = [&apos;pk&apos;, &apos;btitle&apos;, &apos;bpub_date&apos;]</span><br></pre></td></tr></table></figure>

<ul>
<li>list_filter&#xFF1A;&#x8FC7;&#x6EE4;&#x5B57;&#x6BB5;&#xFF0C;&#x8FC7;&#x6EE4;&#x6846;&#x4F1A;&#x51FA;&#x73B0;&#x5728;&#x53F3;&#x4FA7;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;list_filter = [&apos;btitle&apos;]</span><br></pre></td></tr></table></figure>

<ul>
<li>search_fields&#xFF1A;&#x641C;&#x7D22;&#x5B57;&#x6BB5;&#xFF0C;&#x641C;&#x7D22;&#x6846;&#x4F1A;&#x51FA;&#x73B0;&#x5728;&#x4E0A;&#x4FA7;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;search_fields = [&apos;btitle&apos;]</span><br></pre></td></tr></table></figure>

<ul>
<li>list_per_page&#xFF1A;&#x5206;&#x9875;&#xFF0C;&#x5206;&#x9875;&#x6846;&#x4F1A;&#x51FA;&#x73B0;&#x5728;&#x4E0B;&#x4FA7;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;list_per_page = 10</span><br></pre></td></tr></table></figure>

<p>#####&#x6DFB;&#x52A0;&#x3001;&#x4FEE;&#x6539;&#x9875;&#x5C5E;&#x6027;</p>
<ul>
<li>fields&#xFF1A;&#x5C5E;&#x6027;&#x7684;&#x5148;&#x540E;&#x987A;&#x5E8F;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;fields = [&apos;bpub_date&apos;, &apos;btitle&apos;]</span><br></pre></td></tr></table></figure>

<ul>
<li>fieldsets&#xFF1A;&#x5C5E;&#x6027;&#x5206;&#x7EC4;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;fieldsets = [</span><br><span class="line">    (&apos;basic&apos;,{&apos;fields&apos;: [&apos;btitle&apos;]}),</span><br><span class="line">    (&apos;more&apos;, {&apos;fields&apos;: [&apos;bpub_date&apos;]}),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>#####&#x5173;&#x8054;&#x5BF9;&#x8C61;</p>
<ul>
<li>&#x5BF9;&#x4E8E;HeroInfo&#x6A21;&#x578B;&#x7C7B;&#xFF0C;&#x6709;&#x4E24;&#x79CD;&#x6CE8;&#x518C;&#x65B9;&#x5F0F;</li>
</ul>
<pre><code>+ &#x65B9;&#x5F0F;&#x4E00;&#xFF1A;&#x4E0E;BookInfo&#x6A21;&#x578B;&#x7C7B;&#x76F8;&#x540C;
+ &#x65B9;&#x5F0F;&#x4E8C;&#xFF1A;&#x5173;&#x8054;&#x6CE8;&#x518C;</code></pre><ul>
<li>&#x6309;&#x7167;BookInfor&#x7684;&#x6CE8;&#x518C;&#x65B9;&#x5F0F;&#x5B8C;&#x6210;HeroInfo&#x7684;&#x6CE8;&#x518C;</li>
<li>&#x63A5;&#x4E0B;&#x6765;&#x5B9E;&#x73B0;&#x5173;&#x8054;&#x6CE8;&#x518C;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;from django.contrib import admin</span><br><span class="line">from models import BookInfo,HeroInfo</span><br><span class="line"></span><br><span class="line">class HeroInfoInline(admin.StackedInline):</span><br><span class="line">    model = HeroInfo</span><br><span class="line">    extra = 2</span><br><span class="line"></span><br><span class="line">class BookInfoAdmin(admin.ModelAdmin):</span><br><span class="line">    inlines = [HeroInfoInline]</span><br><span class="line"></span><br><span class="line">admin.site.register(BookInfo, BookInfoAdmin)</span><br></pre></td></tr></table></figure>

<ul>
<li>&#x53EF;&#x4EE5;&#x5C06;&#x5185;&#x5D4C;&#x7684;&#x65B9;&#x5F0F;&#x6539;&#x4E3A;&#x8868;&#x683C;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;class HeroInfoInline(admin.TabularInline)</span><br></pre></td></tr></table></figure>

<p>#####&#x5E03;&#x5C14;&#x503C;&#x7684;&#x663E;&#x793A;</p>
<ul>
<li>&#x53D1;&#x5E03;&#x6027;&#x522B;&#x7684;&#x663E;&#x793A;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x76F4;&#x89C2;&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x5C01;&#x88C5;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;def gender(self):</span><br><span class="line">    if self.hgender:</span><br><span class="line">        return &apos;&#x7537;&apos;</span><br><span class="line">    else:</span><br><span class="line">        return &apos;&#x5973;&apos;</span><br><span class="line">gender.short_description = &apos;&#x6027;&#x522B;&apos;</span><br><span class="line">&#x5728;admin&#x6CE8;&#x518C;&#x4E2D;&#x4F7F;&#x7528;gender&#x4EE3;&#x66FF;hgender</span><br><span class="line">class HeroInfoAdmin(admin.ModelAdmin):</span><br><span class="line">    list_display = [&apos;id&apos;, &apos;hname&apos;, &apos;gender&apos;, &apos;hcontent&apos;]</span><br></pre></td></tr></table></figure>

<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/03e4fdfdf1729703bc6484684068d28f.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903524405346318.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903524405346318.html" itemprop="url">数据结构与算法 排序与搜索</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-10T18:32:59+08:00">
                2018-01-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>&#x6587;&#x7AE0;&#x6765;&#x6E90;&#xFF1A;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x4E0E;&#x7B97;&#x6CD5;&#xFF08;Python&#xFF09;</strong></p>
<blockquote>
<p>#&#x6392;&#x5E8F;&#x4E0E;&#x641C;&#x7D22;</p>
<p>&#x6392;&#x5E8F;&#x7B97;&#x6CD5;&#xFF08;&#x82F1;&#x8BED;&#xFF1A;Sorting algorithm&#xFF09;&#x662F;&#x4E00;&#x79CD;&#x80FD;&#x5C06;&#x4E00;&#x4E32;&#x6570;&#x636E;&#x4F9D;&#x7167;&#x7279;&#x5B9A;&#x987A;&#x5E8F;&#x8FDB;&#x884C;&#x6392;&#x5217;&#x7684;&#x4E00;&#x79CD;&#x7B97;&#x6CD5;&#x3002;</p>
</blockquote>
<p>#1.&#x5192;&#x6CE1;&#x6392;&#x5E8F;</p>
<p>**&#x5192;&#x6CE1;&#x6392;&#x5E8F;&#xFF08;&#x82F1;&#x8BED;&#xFF1A;Bubble Sort&#xFF09;**&#x662F;&#x4E00;&#x79CD;&#x7B80;&#x5355;&#x7684;&#x6392;&#x5E8F;&#x7B97;&#x6CD5;&#x3002;&#x5B83;&#x91CD;&#x590D;&#x5730;&#x904D;&#x5386;&#x8981;&#x6392;&#x5E8F;&#x7684;&#x6570;&#x5217;&#xFF0C;&#x4E00;&#x6B21;&#x6BD4;&#x8F83;&#x4E24;&#x4E2A;&#x5143;&#x7D20;&#xFF0C;&#x5982;&#x679C;&#x4ED6;&#x4EEC;&#x7684;&#x987A;&#x5E8F;&#x9519;&#x8BEF;&#x5C31;&#x628A;&#x4ED6;&#x4EEC;&#x4EA4;&#x6362;&#x8FC7;&#x6765;&#x3002;&#x904D;&#x5386;&#x6570;&#x5217;&#x7684;&#x5DE5;&#x4F5C;&#x662F;&#x91CD;&#x590D;&#x5730;&#x8FDB;&#x884C;&#x76F4;&#x5230;&#x6CA1;&#x6709;&#x518D;&#x9700;&#x8981;&#x4EA4;&#x6362;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x8BE5;&#x6570;&#x5217;&#x5DF2;&#x7ECF;&#x6392;&#x5E8F;&#x5B8C;&#x6210;&#x3002;&#x8FD9;&#x4E2A;&#x7B97;&#x6CD5;&#x7684;&#x540D;&#x5B57;&#x7531;&#x6765;&#x662F;&#x56E0;&#x4E3A;&#x8D8A;&#x5C0F;&#x7684;&#x5143;&#x7D20;&#x4F1A;&#x7ECF;&#x7531;&#x4EA4;&#x6362;&#x6162;&#x6162;&#x201C;&#x6D6E;&#x201D;&#x5230;&#x6570;&#x5217;&#x7684;&#x9876;&#x7AEF;&#x3002;</p>
<p>&#x5192;&#x6CE1;&#x6392;&#x5E8F;&#x7B97;&#x6CD5;&#x7684;&#x8FD0;&#x4F5C;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li>&#x6BD4;&#x8F83;&#x76F8;&#x90BB;&#x7684;&#x5143;&#x7D20;&#x3002;&#x5982;&#x679C;&#x7B2C;&#x4E00;&#x4E2A;&#x6BD4;&#x7B2C;&#x4E8C;&#x4E2A;&#x5927;&#xFF08;&#x5347;&#x5E8F;&#xFF09;&#xFF0C;&#x5C31;&#x4EA4;&#x6362;&#x4ED6;&#x4EEC;&#x4E24;&#x4E2A;&#x3002;</li>
<li>&#x5BF9;&#x6BCF;&#x4E00;&#x5BF9;&#x76F8;&#x90BB;&#x5143;&#x7D20;&#x4F5C;&#x540C;&#x6837;&#x7684;&#x5DE5;&#x4F5C;&#xFF0C;&#x4ECE;&#x5F00;&#x59CB;&#x7B2C;&#x4E00;&#x5BF9;&#x5230;&#x7ED3;&#x5C3E;&#x7684;&#x6700;&#x540E;&#x4E00;&#x5BF9;&#x3002;&#x8FD9;&#x6B65;&#x505A;&#x5B8C;&#x540E;&#xFF0C;&#x6700;&#x540E;&#x7684;&#x5143;&#x7D20;&#x4F1A;&#x662F;&#x6700;&#x5927;&#x7684;&#x6570;&#x3002;</li>
<li>&#x9488;&#x5BF9;&#x6240;&#x6709;&#x7684;&#x5143;&#x7D20;&#x91CD;&#x590D;&#x4EE5;&#x4E0A;&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x9664;&#x4E86;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x3002;</li>
<li>&#x6301;&#x7EED;&#x6BCF;&#x6B21;&#x5BF9;&#x8D8A;&#x6765;&#x8D8A;&#x5C11;&#x7684;&#x5143;&#x7D20;&#x91CD;&#x590D;&#x4E0A;&#x9762;&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x76F4;&#x5230;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x4E00;&#x5BF9;&#x6570;&#x5B57;&#x9700;&#x8981;&#x6BD4;&#x8F83;&#x3002;<br>##&#x5192;&#x6CE1;&#x6392;&#x5E8F;&#x7684;&#x5206;&#x6790;</li>
</ul>
<p>&#x4EA4;&#x6362;&#x8FC7;&#x7A0B;&#x56FE;&#x793A;(&#x7B2C;&#x4E00;&#x6B21;)&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/9e6b2b766d9482d6e476cf0e531c11d698f2cd62f348a9fa5f051bf2176a7b12" alt></p>
<p>&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x8FDB;&#x884C;n-1&#x6B21;&#x5192;&#x6CE1;&#x8FC7;&#x7A0B;&#xFF0C;&#x6BCF;&#x6B21;&#x5BF9;&#x5E94;&#x7684;&#x6BD4;&#x8F83;&#x6B21;&#x6570;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/1b88c05962619e71f1a4d4bc692e7e15f8cdde2867f4292857e5f5685e1fd870" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;def bubble_sort(alist):</span><br><span class="line">    for j in range(len(alist)-1,0,-1):</span><br><span class="line">        # j&#x8868;&#x793A;&#x6BCF;&#x6B21;&#x904D;&#x5386;&#x9700;&#x8981;&#x6BD4;&#x8F83;&#x7684;&#x6B21;&#x6570;&#xFF0C;&#x662F;&#x9010;&#x6E10;&#x51CF;&#x5C0F;&#x7684;</span><br><span class="line">        for i in range(j):</span><br><span class="line">            if alist[i] &gt; alist[i+1]:</span><br><span class="line">                alist[i], alist[i+1] = alist[i+1], alist[i]</span><br><span class="line"></span><br><span class="line">li = [54,26,93,17,77,31,44,55,20]</span><br><span class="line">bubble_sort(li)</span><br><span class="line">print(li)</span><br></pre></td></tr></table></figure>

<p>##&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;</p>
<ul>
<li>&#x6700;&#x4F18;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF1A;O(n) &#xFF08;&#x8868;&#x793A;&#x904D;&#x5386;&#x4E00;&#x6B21;&#x53D1;&#x73B0;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x53EF;&#x4EE5;&#x4EA4;&#x6362;&#x7684;&#x5143;&#x7D20;&#xFF0C;&#x6392;&#x5E8F;&#x7ED3;&#x675F;&#x3002;&#xFF09;</li>
<li>&#x6700;&#x574F;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF1A;O(n2)</li>
<li>&#x7A33;&#x5B9A;&#x6027;&#xFF1A;&#x7A33;&#x5B9A;</li>
</ul>
<p>##&#x5192;&#x6CE1;&#x6392;&#x5E8F;&#x7684;&#x6F14;&#x793A;<br>&#x6548;&#x679C;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/78d98f05cc98a33398abe5cea9678bdad0755c04c05f59fe1c381b4776cae20b" alt></p>
<p>#2.&#x9009;&#x62E9;&#x6392;&#x5E8F;<br>&#x9009;&#x62E9;&#x6392;&#x5E8F;&#xFF08;Selection sort&#xFF09;&#x662F;&#x4E00;&#x79CD;&#x7B80;&#x5355;&#x76F4;&#x89C2;&#x7684;&#x6392;&#x5E8F;&#x7B97;&#x6CD5;&#x3002;&#x5B83;&#x7684;&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x5982;&#x4E0B;&#x3002;&#x9996;&#x5148;&#x5728;&#x672A;&#x6392;&#x5E8F;&#x5E8F;&#x5217;&#x4E2D;&#x627E;&#x5230;&#x6700;&#x5C0F;&#xFF08;&#x5927;&#xFF09;&#x5143;&#x7D20;&#xFF0C;&#x5B58;&#x653E;&#x5230;&#x6392;&#x5E8F;&#x5E8F;&#x5217;&#x7684;&#x8D77;&#x59CB;&#x4F4D;&#x7F6E;&#xFF0C;&#x7136;&#x540E;&#xFF0C;&#x518D;&#x4ECE;&#x5269;&#x4F59;&#x672A;&#x6392;&#x5E8F;&#x5143;&#x7D20;&#x4E2D;&#x7EE7;&#x7EED;&#x5BFB;&#x627E;&#x6700;&#x5C0F;&#xFF08;&#x5927;&#xFF09;&#x5143;&#x7D20;&#xFF0C;&#x7136;&#x540E;&#x653E;&#x5230;&#x5DF2;&#x6392;&#x5E8F;&#x5E8F;&#x5217;&#x7684;&#x672B;&#x5C3E;&#x3002;&#x4EE5;&#x6B64;&#x7C7B;&#x63A8;&#xFF0C;&#x76F4;&#x5230;&#x6240;&#x6709;&#x5143;&#x7D20;&#x5747;&#x6392;&#x5E8F;&#x5B8C;&#x6BD5;&#x3002;</p>
<p>&#x9009;&#x62E9;&#x6392;&#x5E8F;&#x7684;&#x4E3B;&#x8981;&#x4F18;&#x70B9;&#x4E0E;&#x6570;&#x636E;&#x79FB;&#x52A8;&#x6709;&#x5173;&#x3002;&#x5982;&#x679C;&#x67D0;&#x4E2A;&#x5143;&#x7D20;&#x4F4D;&#x4E8E;&#x6B63;&#x786E;&#x7684;&#x6700;&#x7EC8;&#x4F4D;&#x7F6E;&#x4E0A;&#xFF0C;&#x5219;&#x5B83;&#x4E0D;&#x4F1A;&#x88AB;&#x79FB;&#x52A8;&#x3002;&#x9009;&#x62E9;&#x6392;&#x5E8F;&#x6BCF;&#x6B21;&#x4EA4;&#x6362;&#x4E00;&#x5BF9;&#x5143;&#x7D20;&#xFF0C;&#x5B83;&#x4EEC;&#x5F53;&#x4E2D;&#x81F3;&#x5C11;&#x6709;&#x4E00;&#x4E2A;&#x5C06;&#x88AB;&#x79FB;&#x5230;&#x5176;&#x6700;&#x7EC8;&#x4F4D;&#x7F6E;&#x4E0A;&#xFF0C;&#x56E0;&#x6B64;&#x5BF9;n&#x4E2A;&#x5143;&#x7D20;&#x7684;&#x8868;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#x603B;&#x5171;&#x8FDB;&#x884C;&#x81F3;&#x591A;n-1&#x6B21;&#x4EA4;&#x6362;&#x3002;&#x5728;&#x6240;&#x6709;&#x7684;&#x5B8C;&#x5168;&#x4F9D;&#x9760;&#x4EA4;&#x6362;&#x53BB;&#x79FB;&#x52A8;&#x5143;&#x7D20;&#x7684;&#x6392;&#x5E8F;&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x9009;&#x62E9;&#x6392;&#x5E8F;&#x5C5E;&#x4E8E;&#x975E;&#x5E38;&#x597D;&#x7684;&#x4E00;&#x79CD;&#x3002;</p>
<p>##&#x9009;&#x62E9;&#x6392;&#x5E8F;&#x5206;&#x6790;<br>&#x6392;&#x5E8F;&#x8FC7;&#x7A0B;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/dd3605c2eea43f65a2509f82ee5b64c2013d81f4d54c236422c875caa2443b9d" alt></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/066965a4cd4949bcb2726a13e7e050a64d4a2dc8c9bf4b030d7523f203b82cfe" alt="&#x7EA2;&#x8272;&#x8868;&#x793A;&#x5F53;&#x524D;&#x6700;&#x5C0F;&#x503C;&#xFF0C;&#x9EC4;&#x8272;&#x8868;&#x793A;&#x5DF2;&#x6392;&#x5E8F;&#x5E8F;&#x5217;&#xFF0C;&#x84DD;&#x8272;&#x8868;&#x793A;&#x5F53;&#x524D;&#x4F4D;&#x7F6E;&#x3002;"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;def selection_sort(alist):</span><br><span class="line">    n = len(alist)</span><br><span class="line">    # &#x9700;&#x8981;&#x8FDB;&#x884C;n-1&#x6B21;&#x9009;&#x62E9;&#x64CD;&#x4F5C;</span><br><span class="line">    for i in range(n-1):</span><br><span class="line">        # &#x8BB0;&#x5F55;&#x6700;&#x5C0F;&#x4F4D;&#x7F6E;</span><br><span class="line">        min_index = i</span><br><span class="line">        # &#x4ECE;i+1&#x4F4D;&#x7F6E;&#x5230;&#x672B;&#x5C3E;&#x9009;&#x62E9;&#x51FA;&#x6700;&#x5C0F;&#x6570;&#x636E;</span><br><span class="line">        for j in range(i+1, n):</span><br><span class="line">            if alist[j] &lt; alist[min_index]:</span><br><span class="line">                min_index = j</span><br><span class="line">        # &#x5982;&#x679C;&#x9009;&#x62E9;&#x51FA;&#x7684;&#x6570;&#x636E;&#x4E0D;&#x5728;&#x6B63;&#x786E;&#x4F4D;&#x7F6E;&#xFF0C;&#x8FDB;&#x884C;&#x4EA4;&#x6362;</span><br><span class="line">        if min_index != i:</span><br><span class="line">            alist[i], alist[min_index] = alist[min_index], alist[i]</span><br><span class="line"></span><br><span class="line">alist = [54,226,93,17,77,31,44,55,20]</span><br><span class="line">selection_sort(alist)</span><br><span class="line">print(alist)</span><br></pre></td></tr></table></figure>

<p>##&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;</p>
<ul>
<li>&#x6700;&#x4F18;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF1A;O(n2)</li>
<li>&#x6700;&#x574F;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF1A;O(n2)</li>
<li>&#x7A33;&#x5B9A;&#x6027;&#xFF1A;&#x4E0D;&#x7A33;&#x5B9A;&#xFF08;&#x8003;&#x8651;&#x5347;&#x5E8F;&#x6BCF;&#x6B21;&#x9009;&#x62E9;&#x6700;&#x5927;&#x7684;&#x60C5;&#x51B5;&#xFF09;<br>##&#x9009;&#x62E9;&#x6392;&#x5E8F;&#x6F14;&#x793A;</li>
</ul>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/afb4b18eda8bc45e602548d858c0e72b9ee5019a2259f79a3e5fc54b03120833" alt></p>
<p>#3.&#x63D2;&#x5165;&#x6392;&#x5E8F;</p>
<p>&#x63D2;&#x5165;&#x6392;&#x5E8F;&#xFF08;&#x82F1;&#x8BED;&#xFF1A;Insertion Sort&#xFF09;&#x662F;&#x4E00;&#x79CD;&#x7B80;&#x5355;&#x76F4;&#x89C2;&#x7684;&#x6392;&#x5E8F;&#x7B97;&#x6CD5;&#x3002;&#x5B83;&#x7684;&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x662F;&#x901A;&#x8FC7;&#x6784;&#x5EFA;&#x6709;&#x5E8F;&#x5E8F;&#x5217;&#xFF0C;&#x5BF9;&#x4E8E;&#x672A;&#x6392;&#x5E8F;&#x6570;&#x636E;&#xFF0C;&#x5728;&#x5DF2;&#x6392;&#x5E8F;&#x5E8F;&#x5217;&#x4E2D;&#x4ECE;&#x540E;&#x5411;&#x524D;&#x626B;&#x63CF;&#xFF0C;&#x627E;&#x5230;&#x76F8;&#x5E94;&#x4F4D;&#x7F6E;&#x5E76;&#x63D2;&#x5165;&#x3002;&#x63D2;&#x5165;&#x6392;&#x5E8F;&#x5728;&#x5B9E;&#x73B0;&#x4E0A;&#xFF0C;&#x5728;&#x4ECE;&#x540E;&#x5411;&#x524D;&#x626B;&#x63CF;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x9700;&#x8981;&#x53CD;&#x590D;&#x628A;&#x5DF2;&#x6392;&#x5E8F;&#x5143;&#x7D20;&#x9010;&#x6B65;&#x5411;&#x540E;&#x632A;&#x4F4D;&#xFF0C;&#x4E3A;&#x6700;&#x65B0;&#x5143;&#x7D20;&#x63D0;&#x4F9B;&#x63D2;&#x5165;&#x7A7A;&#x95F4;&#x3002;</p>
<p>##&#x63D2;&#x5165;&#x6392;&#x5E8F;&#x5206;&#x6790;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/3e74458f99c7f57067ac2c0f7d68ae7ad5a78596d9b8121b2d643be8cc0fa879" alt></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/8085615d18f5e5617b5dd1e374d8398bc1ca1dce51f80f02c0736b7ec0315272" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;def insert_sort(alist):</span><br><span class="line">    # &#x4ECE;&#x7B2C;&#x4E8C;&#x4E2A;&#x4F4D;&#x7F6E;&#xFF0C;&#x5373;&#x4E0B;&#x6807;&#x4E3A;1&#x7684;&#x5143;&#x7D20;&#x5F00;&#x59CB;&#x5411;&#x524D;&#x63D2;&#x5165;</span><br><span class="line">    for i in range(1, len(alist)):</span><br><span class="line">        # &#x4ECE;&#x7B2C;i&#x4E2A;&#x5143;&#x7D20;&#x5F00;&#x59CB;&#x5411;&#x524D;&#x6BD4;&#x8F83;&#xFF0C;&#x5982;&#x679C;&#x5C0F;&#x4E8E;&#x524D;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#xFF0C;&#x4EA4;&#x6362;&#x4F4D;&#x7F6E;</span><br><span class="line">        for j in range(i, 0, -1):</span><br><span class="line">            if alist[j] &lt; alist[j-1]:</span><br><span class="line">                alist[j], alist[j-1] = alist[j-1], alist[j]</span><br><span class="line"></span><br><span class="line">alist = [54,26,93,17,77,31,44,55,20]</span><br><span class="line">insert_sort(alist)</span><br><span class="line">print(alist)</span><br></pre></td></tr></table></figure>

<p>##&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;</p>
<ul>
<li>&#x6700;&#x4F18;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF1A;O(n) &#xFF08;&#x5347;&#x5E8F;&#x6392;&#x5217;&#xFF0C;&#x5E8F;&#x5217;&#x5DF2;&#x7ECF;&#x5904;&#x4E8E;&#x5347;&#x5E8F;&#x72B6;&#x6001;&#xFF09;</li>
<li>&#x6700;&#x574F;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF1A;O(n2)</li>
<li>&#x7A33;&#x5B9A;&#x6027;&#xFF1A;&#x7A33;&#x5B9A;<br>##&#x63D2;&#x5165;&#x6392;&#x5E8F;&#x6F14;&#x793A;</li>
</ul>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/0c5b0b5525325934a7b7cc8ca22e3f1594f2b82d91ab0fffe7f37c4f9004bb5b" alt></p>
<p>#4.&#x5FEB;&#x901F;&#x6392;&#x5E8F;</p>
<p>&#x5FEB;&#x901F;&#x6392;&#x5E8F;&#xFF08;&#x82F1;&#x8BED;&#xFF1A;Quicksort&#xFF09;&#xFF0C;&#x53C8;&#x79F0;&#x5212;&#x5206;&#x4EA4;&#x6362;&#x6392;&#x5E8F;&#xFF08;partition-exchange sort&#xFF09;&#xFF0C;&#x901A;&#x8FC7;&#x4E00;&#x8D9F;&#x6392;&#x5E8F;&#x5C06;&#x8981;&#x6392;&#x5E8F;&#x7684;&#x6570;&#x636E;&#x5206;&#x5272;&#x6210;&#x72EC;&#x7ACB;&#x7684;&#x4E24;&#x90E8;&#x5206;&#xFF0C;&#x5176;&#x4E2D;&#x4E00;&#x90E8;&#x5206;&#x7684;&#x6240;&#x6709;&#x6570;&#x636E;&#x90FD;&#x6BD4;&#x53E6;&#x5916;&#x4E00;&#x90E8;&#x5206;&#x7684;&#x6240;&#x6709;&#x6570;&#x636E;&#x90FD;&#x8981;&#x5C0F;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x6309;&#x6B64;&#x65B9;&#x6CD5;&#x5BF9;&#x8FD9;&#x4E24;&#x90E8;&#x5206;&#x6570;&#x636E;&#x5206;&#x522B;&#x8FDB;&#x884C;&#x5FEB;&#x901F;&#x6392;&#x5E8F;&#xFF0C;&#x6574;&#x4E2A;&#x6392;&#x5E8F;&#x8FC7;&#x7A0B;&#x53EF;&#x4EE5;&#x9012;&#x5F52;&#x8FDB;&#x884C;&#xFF0C;&#x4EE5;&#x6B64;&#x8FBE;&#x5230;&#x6574;&#x4E2A;&#x6570;&#x636E;&#x53D8;&#x6210;&#x6709;&#x5E8F;&#x5E8F;&#x5217;&#x3002;</p>
<p>&#x6B65;&#x9AA4;&#x4E3A;&#xFF1A;</p>
<p>1.&#x4ECE;&#x6570;&#x5217;&#x4E2D;&#x6311;&#x51FA;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#xFF0C;&#x79F0;&#x4E3A;&#x201D;&#x57FA;&#x51C6;&#x201D;&#xFF08;pivot&#xFF09;&#xFF0C;<br>2.&#x91CD;&#x65B0;&#x6392;&#x5E8F;&#x6570;&#x5217;&#xFF0C;&#x6240;&#x6709;&#x5143;&#x7D20;&#x6BD4;&#x57FA;&#x51C6;&#x503C;&#x5C0F;&#x7684;&#x6446;&#x653E;&#x5728;&#x57FA;&#x51C6;&#x524D;&#x9762;&#xFF0C;&#x6240;&#x6709;&#x5143;&#x7D20;&#x6BD4;&#x57FA;&#x51C6;&#x503C;&#x5927;&#x7684;&#x6446;&#x5728;&#x57FA;&#x51C6;&#x7684;&#x540E;&#x9762;&#xFF08;&#x76F8;&#x540C;&#x7684;&#x6570;&#x53EF;&#x4EE5;&#x5230;&#x4EFB;&#x4E00;&#x8FB9;&#xFF09;&#x3002;&#x5728;&#x8FD9;&#x4E2A;&#x5206;&#x533A;&#x7ED3;&#x675F;&#x4E4B;&#x540E;&#xFF0C;&#x8BE5;&#x57FA;&#x51C6;&#x5C31;&#x5904;&#x4E8E;&#x6570;&#x5217;&#x7684;&#x4E2D;&#x95F4;&#x4F4D;&#x7F6E;&#x3002;&#x8FD9;&#x4E2A;&#x79F0;&#x4E3A;&#x5206;&#x533A;&#xFF08;partition&#xFF09;&#x64CD;&#x4F5C;&#x3002;<br>&#x9012;&#x5F52;&#x5730;&#xFF08;recursive&#xFF09;&#x628A;&#x5C0F;&#x4E8E;&#x57FA;&#x51C6;&#x503C;&#x5143;&#x7D20;&#x7684;&#x5B50;&#x6570;&#x5217;&#x548C;&#x5927;&#x4E8E;&#x57FA;&#x51C6;&#x503C;&#x5143;&#x7D20;&#x7684;&#x5B50;&#x6570;&#x5217;&#x6392;&#x5E8F;&#x3002;<br>3.&#x9012;&#x5F52;&#x7684;&#x6700;&#x5E95;&#x90E8;&#x60C5;&#x5F62;&#xFF0C;&#x662F;&#x6570;&#x5217;&#x7684;&#x5927;&#x5C0F;&#x662F;&#x96F6;&#x6216;&#x4E00;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6C38;&#x8FDC;&#x90FD;&#x5DF2;&#x7ECF;&#x88AB;&#x6392;&#x5E8F;&#x597D;&#x4E86;&#x3002;&#x867D;&#x7136;&#x4E00;&#x76F4;&#x9012;&#x5F52;&#x4E0B;&#x53BB;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x4E2A;&#x7B97;&#x6CD5;&#x603B;&#x4F1A;&#x7ED3;&#x675F;&#xFF0C;&#x56E0;&#x4E3A;&#x5728;&#x6BCF;&#x6B21;&#x7684;&#x8FED;&#x4EE3;&#xFF08;iteration&#xFF09;&#x4E2D;&#xFF0C;&#x5B83;&#x81F3;&#x5C11;&#x4F1A;&#x628A;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x6446;&#x5230;&#x5B83;&#x6700;&#x540E;&#x7684;&#x4F4D;&#x7F6E;&#x53BB;&#x3002;</p>
<p>##&#x5FEB;&#x901F;&#x6392;&#x5E8F;&#x7684;&#x5206;&#x6790;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/c1fe1dee453ad8dec90d45a80e243973f5d80ae3b2245d12670b8d15732ff729" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;def quick_sort(alist, start, end):</span><br><span class="line">    &quot;&quot;&quot;&#x5FEB;&#x901F;&#x6392;&#x5E8F;&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    # &#x9012;&#x5F52;&#x7684;&#x9000;&#x51FA;&#x6761;&#x4EF6;</span><br><span class="line">    if start &gt;= end:</span><br><span class="line">        return</span><br><span class="line"></span><br><span class="line">    # &#x8BBE;&#x5B9A;&#x8D77;&#x59CB;&#x5143;&#x7D20;&#x4E3A;&#x8981;&#x5BFB;&#x627E;&#x4F4D;&#x7F6E;&#x7684;&#x57FA;&#x51C6;&#x5143;&#x7D20;</span><br><span class="line">    mid = alist[start]</span><br><span class="line"></span><br><span class="line">    # low&#x4E3A;&#x5E8F;&#x5217;&#x5DE6;&#x8FB9;&#x7684;&#x7531;&#x5DE6;&#x5411;&#x53F3;&#x79FB;&#x52A8;&#x7684;&#x6E38;&#x6807;</span><br><span class="line">    low = start</span><br><span class="line"></span><br><span class="line">    # high&#x4E3A;&#x5E8F;&#x5217;&#x53F3;&#x8FB9;&#x7684;&#x7531;&#x53F3;&#x5411;&#x5DE6;&#x79FB;&#x52A8;&#x7684;&#x6E38;&#x6807;</span><br><span class="line">    high = end</span><br><span class="line"></span><br><span class="line">    while low &lt; high:</span><br><span class="line">        # &#x5982;&#x679C;low&#x4E0E;high&#x672A;&#x91CD;&#x5408;&#xFF0C;high&#x6307;&#x5411;&#x7684;&#x5143;&#x7D20;&#x4E0D;&#x6BD4;&#x57FA;&#x51C6;&#x5143;&#x7D20;&#x5C0F;&#xFF0C;&#x5219;high&#x5411;&#x5DE6;&#x79FB;&#x52A8;</span><br><span class="line">        while low &lt; high and alist[high] &gt;= mid:</span><br><span class="line">            high -= 1</span><br><span class="line">        # &#x5C06;high&#x6307;&#x5411;&#x7684;&#x5143;&#x7D20;&#x653E;&#x5230;low&#x7684;&#x4F4D;&#x7F6E;&#x4E0A;</span><br><span class="line">        alist[low] = alist[high]</span><br><span class="line"></span><br><span class="line">        # &#x5982;&#x679C;low&#x4E0E;high&#x672A;&#x91CD;&#x5408;&#xFF0C;low&#x6307;&#x5411;&#x7684;&#x5143;&#x7D20;&#x6BD4;&#x57FA;&#x51C6;&#x5143;&#x7D20;&#x5C0F;&#xFF0C;&#x5219;low&#x5411;&#x53F3;&#x79FB;&#x52A8;</span><br><span class="line">        while low &lt; high and alist[low] &lt; mid:</span><br><span class="line">            low += 1</span><br><span class="line">        # &#x5C06;low&#x6307;&#x5411;&#x7684;&#x5143;&#x7D20;&#x653E;&#x5230;high&#x7684;&#x4F4D;&#x7F6E;&#x4E0A;</span><br><span class="line">        alist[high] = alist[low]</span><br><span class="line"></span><br><span class="line">    # &#x9000;&#x51FA;&#x5FAA;&#x73AF;&#x540E;&#xFF0C;low&#x4E0E;high&#x91CD;&#x5408;&#xFF0C;&#x6B64;&#x65F6;&#x6240;&#x6307;&#x4F4D;&#x7F6E;&#x4E3A;&#x57FA;&#x51C6;&#x5143;&#x7D20;&#x7684;&#x6B63;&#x786E;&#x4F4D;&#x7F6E;</span><br><span class="line">    # &#x5C06;&#x57FA;&#x51C6;&#x5143;&#x7D20;&#x653E;&#x5230;&#x8BE5;&#x4F4D;&#x7F6E;</span><br><span class="line">    alist[low] = mid</span><br><span class="line"></span><br><span class="line">    # &#x5BF9;&#x57FA;&#x51C6;&#x5143;&#x7D20;&#x5DE6;&#x8FB9;&#x7684;&#x5B50;&#x5E8F;&#x5217;&#x8FDB;&#x884C;&#x5FEB;&#x901F;&#x6392;&#x5E8F;</span><br><span class="line">    quick_sort(alist, start, low-1)</span><br><span class="line"></span><br><span class="line">    # &#x5BF9;&#x57FA;&#x51C6;&#x5143;&#x7D20;&#x53F3;&#x8FB9;&#x7684;&#x5B50;&#x5E8F;&#x5217;&#x8FDB;&#x884C;&#x5FEB;&#x901F;&#x6392;&#x5E8F;</span><br><span class="line">    quick_sort(alist, low+1, end)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">alist = [54,26,93,17,77,31,44,55,20]</span><br><span class="line">quick_sort(alist,0,len(alist)-1)</span><br><span class="line">print(alist)</span><br></pre></td></tr></table></figure>

<p>##&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;</p>
<ul>
<li>&#x6700;&#x4F18;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF1A;O(nlogn)</li>
<li>&#x6700;&#x574F;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF1A;O(n2)</li>
<li>&#x7A33;&#x5B9A;&#x6027;&#xFF1A;&#x4E0D;&#x7A33;&#x5B9A;<br>&#x4ECE;&#x4E00;&#x5F00;&#x59CB;&#x5FEB;&#x901F;&#x6392;&#x5E8F;&#x5E73;&#x5747;&#x9700;&#x8981;&#x82B1;&#x8D39;O(n log n)&#x65F6;&#x95F4;&#x7684;&#x63CF;&#x8FF0;&#x5E76;&#x4E0D;&#x660E;&#x663E;&#x3002;&#x4F46;&#x662F;&#x4E0D;&#x96BE;&#x89C2;&#x5BDF;&#x5230;&#x7684;&#x662F;&#x5206;&#x533A;&#x8FD0;&#x7B97;&#xFF0C;&#x6570;&#x7EC4;&#x7684;&#x5143;&#x7D20;&#x90FD;&#x4F1A;&#x5728;&#x6BCF;&#x6B21;&#x5FAA;&#x73AF;&#x4E2D;&#x8D70;&#x8BBF;&#x8FC7;&#x4E00;&#x6B21;&#xFF0C;&#x4F7F;&#x7528;O(n)&#x7684;&#x65F6;&#x95F4;&#x3002;&#x5728;&#x4F7F;&#x7528;&#x7ED3;&#x5408;&#xFF08;concatenation&#xFF09;&#x7684;&#x7248;&#x672C;&#x4E2D;&#xFF0C;&#x8FD9;&#x9879;&#x8FD0;&#x7B97;&#x4E5F;&#x662F;O(n)&#x3002;</li>
</ul>
<p>&#x5728;&#x6700;&#x597D;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x6BCF;&#x6B21;&#x6211;&#x4EEC;&#x8FD0;&#x884C;&#x4E00;&#x6B21;&#x5206;&#x533A;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x628A;&#x4E00;&#x4E2A;&#x6570;&#x5217;&#x5206;&#x4E3A;&#x4E24;&#x4E2A;&#x51E0;&#x8FD1;&#x76F8;&#x7B49;&#x7684;&#x7247;&#x6BB5;&#x3002;&#x8FD9;&#x4E2A;&#x610F;&#x601D;&#x5C31;&#x662F;&#x6BCF;&#x6B21;&#x9012;&#x5F52;&#x8C03;&#x7528;&#x5904;&#x7406;&#x4E00;&#x534A;&#x5927;&#x5C0F;&#x7684;&#x6570;&#x5217;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5728;&#x5230;&#x8FBE;&#x5927;&#x5C0F;&#x4E3A;&#x4E00;&#x7684;&#x6570;&#x5217;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x8981;&#x4F5C;log n&#x6B21;&#x5D4C;&#x5957;&#x7684;&#x8C03;&#x7528;&#x3002;&#x8FD9;&#x4E2A;&#x610F;&#x601D;&#x5C31;&#x662F;&#x8C03;&#x7528;&#x6811;&#x7684;&#x6DF1;&#x5EA6;&#x662F;O(log n)&#x3002;&#x4F46;&#x662F;&#x5728;&#x540C;&#x4E00;&#x5C42;&#x6B21;&#x7ED3;&#x6784;&#x7684;&#x4E24;&#x4E2A;&#x7A0B;&#x5E8F;&#x8C03;&#x7528;&#x4E2D;&#xFF0C;&#x4E0D;&#x4F1A;&#x5904;&#x7406;&#x5230;&#x539F;&#x6765;&#x6570;&#x5217;&#x7684;&#x76F8;&#x540C;&#x90E8;&#x5206;&#xFF1B;&#x56E0;&#x6B64;&#xFF0C;&#x7A0B;&#x5E8F;&#x8C03;&#x7528;&#x7684;&#x6BCF;&#x4E00;&#x5C42;&#x6B21;&#x7ED3;&#x6784;&#x603B;&#x5171;&#x5168;&#x90E8;&#x4EC5;&#x9700;&#x8981;O(n)&#x7684;&#x65F6;&#x95F4;&#xFF08;&#x6BCF;&#x4E2A;&#x8C03;&#x7528;&#x6709;&#x67D0;&#x4E9B;&#x5171;&#x540C;&#x7684;&#x989D;&#x5916;&#x8017;&#x8D39;&#xFF0C;&#x4F46;&#x662F;&#x56E0;&#x4E3A;&#x5728;&#x6BCF;&#x4E00;&#x5C42;&#x6B21;&#x7ED3;&#x6784;&#x4EC5;&#x4EC5;&#x53EA;&#x6709;O(n)&#x4E2A;&#x8C03;&#x7528;&#xFF0C;&#x8FD9;&#x4E9B;&#x88AB;&#x5F52;&#x7EB3;&#x5728;O(n)&#x7CFB;&#x6570;&#x4E2D;&#xFF09;&#x3002;&#x7ED3;&#x679C;&#x662F;&#x8FD9;&#x4E2A;&#x7B97;&#x6CD5;&#x4EC5;&#x9700;&#x4F7F;&#x7528;O(n log n)&#x65F6;&#x95F4;&#x3002;</p>
<p>##&#x5FEB;&#x901F;&#x6392;&#x5E8F;&#x6F14;&#x793A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/1f3ce044b1114f125cfc58a13ce280430a968bc9f30c0507e46f8e0767057e03" alt></p>
<p>#5.&#x5E0C;&#x5C14;&#x6392;&#x5E8F;<br>&#x5E0C;&#x5C14;&#x6392;&#x5E8F;(Shell Sort)&#x662F;&#x63D2;&#x5165;&#x6392;&#x5E8F;&#x7684;&#x4E00;&#x79CD;&#x3002;&#x4E5F;&#x79F0;&#x7F29;&#x5C0F;&#x589E;&#x91CF;&#x6392;&#x5E8F;&#xFF0C;&#x662F;&#x76F4;&#x63A5;&#x63D2;&#x5165;&#x6392;&#x5E8F;&#x7B97;&#x6CD5;&#x7684;&#x4E00;&#x79CD;&#x66F4;&#x9AD8;&#x6548;&#x7684;&#x6539;&#x8FDB;&#x7248;&#x672C;&#x3002;&#x5E0C;&#x5C14;&#x6392;&#x5E8F;&#x662F;&#x975E;&#x7A33;&#x5B9A;&#x6392;&#x5E8F;&#x7B97;&#x6CD5;&#x3002;&#x8BE5;&#x65B9;&#x6CD5;&#x56E0;DL&#xFF0E;Shell&#x4E8E;1959&#x5E74;&#x63D0;&#x51FA;&#x800C;&#x5F97;&#x540D;&#x3002; &#x5E0C;&#x5C14;&#x6392;&#x5E8F;&#x662F;&#x628A;&#x8BB0;&#x5F55;&#x6309;&#x4E0B;&#x6807;&#x7684;&#x4E00;&#x5B9A;&#x589E;&#x91CF;&#x5206;&#x7EC4;&#xFF0C;&#x5BF9;&#x6BCF;&#x7EC4;&#x4F7F;&#x7528;&#x76F4;&#x63A5;&#x63D2;&#x5165;&#x6392;&#x5E8F;&#x7B97;&#x6CD5;&#x6392;&#x5E8F;&#xFF1B;&#x968F;&#x7740;&#x589E;&#x91CF;&#x9010;&#x6E10;&#x51CF;&#x5C11;&#xFF0C;&#x6BCF;&#x7EC4;&#x5305;&#x542B;&#x7684;&#x5173;&#x952E;&#x8BCD;&#x8D8A;&#x6765;&#x8D8A;&#x591A;&#xFF0C;&#x5F53;&#x589E;&#x91CF;&#x51CF;&#x81F3;1&#x65F6;&#xFF0C;&#x6574;&#x4E2A;&#x6587;&#x4EF6;&#x6070;&#x88AB;&#x5206;&#x6210;&#x4E00;&#x7EC4;&#xFF0C;&#x7B97;&#x6CD5;&#x4FBF;&#x7EC8;&#x6B62;&#x3002;</p>
<p>##&#x5E0C;&#x5C14;&#x6392;&#x5E8F;&#x8FC7;&#x7A0B;</p>
<p>&#x5E0C;&#x5C14;&#x6392;&#x5E8F;&#x7684;&#x57FA;&#x672C;&#x601D;&#x60F3;&#x662F;&#xFF1A;&#x5C06;&#x6570;&#x7EC4;&#x5217;&#x5728;&#x4E00;&#x4E2A;&#x8868;&#x4E2D;&#x5E76;&#x5BF9;&#x5217;&#x5206;&#x522B;&#x8FDB;&#x884C;&#x63D2;&#x5165;&#x6392;&#x5E8F;&#xFF0C;&#x91CD;&#x590D;&#x8FD9;&#x8FC7;&#x7A0B;&#xFF0C;&#x4E0D;&#x8FC7;&#x6BCF;&#x6B21;&#x7528;&#x66F4;&#x957F;&#x7684;&#x5217;&#xFF08;&#x6B65;&#x957F;&#x66F4;&#x957F;&#x4E86;&#xFF0C;&#x5217;&#x6570;&#x66F4;&#x5C11;&#x4E86;&#xFF09;&#x6765;&#x8FDB;&#x884C;&#x3002;&#x6700;&#x540E;&#x6574;&#x4E2A;&#x8868;&#x5C31;&#x53EA;&#x6709;&#x4E00;&#x5217;&#x4E86;&#x3002;&#x5C06;&#x6570;&#x7EC4;&#x8F6C;&#x6362;&#x81F3;&#x8868;&#x662F;&#x4E3A;&#x4E86;&#x66F4;&#x597D;&#x5730;&#x7406;&#x89E3;&#x8FD9;&#x7B97;&#x6CD5;&#xFF0C;&#x7B97;&#x6CD5;&#x672C;&#x8EAB;&#x8FD8;&#x662F;&#x4F7F;&#x7528;&#x6570;&#x7EC4;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#x3002;</p>
<p>&#x4F8B;&#x5982;&#xFF0C;&#x5047;&#x8BBE;&#x6709;&#x8FD9;&#x6837;&#x4E00;&#x7EC4;&#x6570;[ 13 14 94 33 82 25 59 94 65 23 45 27 73 25 39 10 ]&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x4EE5;&#x6B65;&#x957F;&#x4E3A;5&#x5F00;&#x59CB;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x5C06;&#x8FD9;&#x5217;&#x8868;&#x653E;&#x5728;&#x6709;5&#x5217;&#x7684;&#x8868;&#x4E2D;&#x6765;&#x66F4;&#x597D;&#x5730;&#x63CF;&#x8FF0;&#x7B97;&#x6CD5;&#xFF0C;&#x8FD9;&#x6837;&#x4ED6;&#x4EEC;&#x5C31;&#x5E94;&#x8BE5;&#x770B;&#x8D77;&#x6765;&#x662F;&#x8FD9;&#x6837;(&#x7AD6;&#x7740;&#x7684;&#x5143;&#x7D20;&#x662F;&#x6B65;&#x957F;&#x7EC4;&#x6210;)&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;13 14 94 33 82</span><br><span class="line">25 59 94 65 23</span><br><span class="line">45 27 73 25 39</span><br><span class="line">10</span><br></pre></td></tr></table></figure>

<p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x5BF9;&#x6BCF;&#x5217;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;10 14 73 25 23</span><br><span class="line">13 27 94 33 39</span><br><span class="line">25 59 94 65 82</span><br><span class="line">45</span><br></pre></td></tr></table></figure>

<p>&#x5C06;&#x4E0A;&#x8FF0;&#x56DB;&#x884C;&#x6570;&#x5B57;&#xFF0C;&#x4F9D;&#x5E8F;&#x63A5;&#x5728;&#x4E00;&#x8D77;&#x65F6;&#x6211;&#x4EEC;&#x5F97;&#x5230;&#xFF1A;<code>[ 10 14 73 25 23 13 27 94 33 39 25 59 94 65 82 45 ]</code>&#x3002;&#x8FD9;&#x65F6;10&#x5DF2;&#x7ECF;&#x79FB;&#x81F3;&#x6B63;&#x786E;&#x4F4D;&#x7F6E;&#x4E86;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x4EE5;3&#x4E3A;&#x6B65;&#x957F;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;10 14 73</span><br><span class="line">25 23 13</span><br><span class="line">27 94 33</span><br><span class="line">39 25 59</span><br><span class="line">94 65 82</span><br><span class="line">45</span><br></pre></td></tr></table></figure>

<p>&#x6392;&#x5E8F;&#x4E4B;&#x540E;&#x53D8;&#x4E3A;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;10 14 13</span><br><span class="line">25 23 33</span><br><span class="line">27 25 59</span><br><span class="line">39 65 73</span><br><span class="line">45 94 82</span><br><span class="line">94</span><br></pre></td></tr></table></figure>

<p>&#x6700;&#x540E;&#x4EE5;1&#x6B65;&#x957F;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#xFF08;&#x6B64;&#x65F6;&#x5C31;&#x662F;&#x7B80;&#x5355;&#x7684;&#x63D2;&#x5165;&#x6392;&#x5E8F;&#x4E86;&#xFF09;</p>
<p>##&#x5E0C;&#x5C14;&#x6392;&#x5E8F;&#x7684;&#x5206;&#x6790;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/ca565c3b7eafa3f2105879e908477d240c806ccb9053bde747941ad3377adc08" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;def shell_sort(alist):</span><br><span class="line">    n = len(alist)</span><br><span class="line">    # &#x521D;&#x59CB;&#x6B65;&#x957F;</span><br><span class="line">    gap = n / 2</span><br><span class="line">    while gap &gt; 0:</span><br><span class="line">        # &#x6309;&#x6B65;&#x957F;&#x8FDB;&#x884C;&#x63D2;&#x5165;&#x6392;&#x5E8F;</span><br><span class="line">        for i in range(gap, n):</span><br><span class="line">            j = i</span><br><span class="line">            # &#x63D2;&#x5165;&#x6392;&#x5E8F;</span><br><span class="line">            while j&gt;=gap and alist[j-gap] &gt; alist[j]:</span><br><span class="line">                alist[j-gap], alist[j] = alist[j], alist[j-gap]</span><br><span class="line">                j -= gap</span><br><span class="line">        # &#x5F97;&#x5230;&#x65B0;&#x7684;&#x6B65;&#x957F;</span><br><span class="line">        gap = gap / 2</span><br><span class="line"></span><br><span class="line">alist = [54,26,93,17,77,31,44,55,20]</span><br><span class="line">shell_sort(alist)</span><br><span class="line">print(alist)</span><br></pre></td></tr></table></figure>

<p>##&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;</p>
<p>&#x6700;&#x4F18;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF1A;&#x6839;&#x636E;&#x6B65;&#x957F;&#x5E8F;&#x5217;&#x7684;&#x4E0D;&#x540C;&#x800C;&#x4E0D;&#x540C;<br>&#x6700;&#x574F;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF1A;O(n2)<br>&#x7A33;&#x5B9A;&#x60F3;&#xFF1A;&#x4E0D;&#x7A33;&#x5B9A;<br>##&#x5E0C;&#x5C14;&#x6392;&#x5E8F;&#x6F14;&#x793A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/d557f7218f3d2c679af65374e19d1d508d57e3a2fa5de84fd9dc7241a06458b2" alt></p>
<p>#6.&#x5F52;&#x5E76;&#x6392;&#x5E8F;<br>&#x5F52;&#x5E76;&#x6392;&#x5E8F;&#x662F;&#x91C7;&#x7528;&#x5206;&#x6CBB;&#x6CD5;&#x7684;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x5178;&#x578B;&#x7684;&#x5E94;&#x7528;&#x3002;&#x5F52;&#x5E76;&#x6392;&#x5E8F;&#x7684;&#x601D;&#x60F3;&#x5C31;&#x662F;&#x5148;&#x9012;&#x5F52;&#x5206;&#x89E3;&#x6570;&#x7EC4;&#xFF0C;&#x518D;&#x5408;&#x5E76;&#x6570;&#x7EC4;&#x3002;</p>
<p>&#x5C06;&#x6570;&#x7EC4;&#x5206;&#x89E3;&#x6700;&#x5C0F;&#x4E4B;&#x540E;&#xFF0C;&#x7136;&#x540E;&#x5408;&#x5E76;&#x4E24;&#x4E2A;&#x6709;&#x5E8F;&#x6570;&#x7EC4;&#xFF0C;&#x57FA;&#x672C;&#x601D;&#x8DEF;&#x662F;&#x6BD4;&#x8F83;&#x4E24;&#x4E2A;&#x6570;&#x7EC4;&#x7684;&#x6700;&#x524D;&#x9762;&#x7684;&#x6570;&#xFF0C;&#x8C01;&#x5C0F;&#x5C31;&#x5148;&#x53D6;&#x8C01;&#xFF0C;&#x53D6;&#x4E86;&#x540E;&#x76F8;&#x5E94;&#x7684;&#x6307;&#x9488;&#x5C31;&#x5F80;&#x540E;&#x79FB;&#x4E00;&#x4F4D;&#x3002;&#x7136;&#x540E;&#x518D;&#x6BD4;&#x8F83;&#xFF0C;&#x76F4;&#x81F3;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;&#x4E3A;&#x7A7A;&#xFF0C;&#x6700;&#x540E;&#x628A;&#x53E6;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;&#x7684;&#x5269;&#x4F59;&#x90E8;&#x5206;&#x590D;&#x5236;&#x8FC7;&#x6765;&#x5373;&#x53EF;&#x3002;</p>
<p>##&#x5F52;&#x5E76;&#x6392;&#x5E8F;&#x7684;&#x5206;&#x6790;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/d2de8765d77152ed94a1d4f3b471199c91b16460344cb1bb8ead184d704f979e" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;def merge_sort(alist):</span><br><span class="line">    if len(alist) &lt;= 1:</span><br><span class="line">        return alist</span><br><span class="line">    # &#x4E8C;&#x5206;&#x5206;&#x89E3;</span><br><span class="line">    num = len(alist)/2</span><br><span class="line">    left = merge_sort(alist[:num])</span><br><span class="line">    right = merge_sort(alist[num:])</span><br><span class="line">    # &#x5408;&#x5E76;</span><br><span class="line">    return merge(left,right)</span><br><span class="line"></span><br><span class="line">def merge(left, right):</span><br><span class="line">    &apos;&apos;&apos;&#x5408;&#x5E76;&#x64CD;&#x4F5C;&#xFF0C;&#x5C06;&#x4E24;&#x4E2A;&#x6709;&#x5E8F;&#x6570;&#x7EC4;left[]&#x548C;right[]&#x5408;&#x5E76;&#x6210;&#x4E00;&#x4E2A;&#x5927;&#x7684;&#x6709;&#x5E8F;&#x6570;&#x7EC4;&apos;&apos;&apos;</span><br><span class="line">    #left&#x4E0E;right&#x7684;&#x4E0B;&#x6807;&#x6307;&#x9488;</span><br><span class="line">    l, r = 0, 0</span><br><span class="line">    result = []</span><br><span class="line">    while l&lt;len(left) and r&lt;len(right):</span><br><span class="line">        if left[l] &lt; right[r]:</span><br><span class="line">            result.append(left[l])</span><br><span class="line">            l += 1</span><br><span class="line">        else:</span><br><span class="line">            result.append(right[r])</span><br><span class="line">            r += 1</span><br><span class="line">    result += left[l:]</span><br><span class="line">    result += right[r:]</span><br><span class="line">    return result</span><br><span class="line"></span><br><span class="line">alist = [54,26,93,17,77,31,44,55,20]</span><br><span class="line">sorted_alist = mergeSort(alist)</span><br><span class="line">print(sorted_alist)</span><br></pre></td></tr></table></figure>

<p>##&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;</p>
<ul>
<li>&#x6700;&#x4F18;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF1A;O(nlogn)</li>
<li>&#x6700;&#x574F;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF1A;O(nlogn)</li>
<li>&#x7A33;&#x5B9A;&#x6027;&#xFF1A;&#x7A33;&#x5B9A;</li>
</ul>
<p>#7.&#x5E38;&#x89C1;&#x6392;&#x5E8F;&#x7B97;&#x6CD5;&#x6548;&#x7387;&#x6BD4;&#x8F83;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/47062278af5c603828719c1fd84dff39b7283c28df6a13fe384a6c2c7f1981cb" alt></p>
<p>#8.&#x641C;&#x7D22;</p>
<p>&#x641C;&#x7D22;&#x662F;&#x5728;&#x4E00;&#x4E2A;&#x9879;&#x76EE;&#x96C6;&#x5408;&#x4E2D;&#x627E;&#x5230;&#x4E00;&#x4E2A;&#x7279;&#x5B9A;&#x9879;&#x76EE;&#x7684;&#x7B97;&#x6CD5;&#x8FC7;&#x7A0B;&#x3002;&#x641C;&#x7D22;&#x901A;&#x5E38;&#x7684;&#x7B54;&#x6848;&#x662F;&#x771F;&#x7684;&#x6216;&#x5047;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x8BE5;&#x9879;&#x76EE;&#x662F;&#x5426;&#x5B58;&#x5728;&#x3002; &#x641C;&#x7D22;&#x7684;&#x51E0;&#x79CD;&#x5E38;&#x89C1;&#x65B9;&#x6CD5;&#xFF1A;&#x987A;&#x5E8F;&#x67E5;&#x627E;&#x3001;&#x4E8C;&#x5206;&#x6CD5;&#x67E5;&#x627E;&#x3001;&#x4E8C;&#x53C9;&#x6811;&#x67E5;&#x627E;&#x3001;&#x54C8;&#x5E0C;&#x67E5;&#x627E;</p>
<p>&#x4E8C;&#x5206;&#x6CD5;&#x67E5;&#x627E;</p>
<p>&#x4E8C;&#x5206;&#x67E5;&#x627E;&#x53C8;&#x79F0;&#x6298;&#x534A;&#x67E5;&#x627E;&#xFF0C;&#x4F18;&#x70B9;&#x662F;&#x6BD4;&#x8F83;&#x6B21;&#x6570;&#x5C11;&#xFF0C;&#x67E5;&#x627E;&#x901F;&#x5EA6;&#x5FEB;&#xFF0C;&#x5E73;&#x5747;&#x6027;&#x80FD;&#x597D;&#xFF1B;&#x5176;&#x7F3A;&#x70B9;&#x662F;&#x8981;&#x6C42;&#x5F85;&#x67E5;&#x8868;&#x4E3A;&#x6709;&#x5E8F;&#x8868;&#xFF0C;&#x4E14;&#x63D2;&#x5165;&#x5220;&#x9664;&#x56F0;&#x96BE;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x6298;&#x534A;&#x67E5;&#x627E;&#x65B9;&#x6CD5;&#x9002;&#x7528;&#x4E8E;&#x4E0D;&#x7ECF;&#x5E38;&#x53D8;&#x52A8;&#x800C;&#x67E5;&#x627E;&#x9891;&#x7E41;&#x7684;&#x6709;&#x5E8F;&#x5217;&#x8868;&#x3002;&#x9996;&#x5148;&#xFF0C;&#x5047;&#x8BBE;&#x8868;&#x4E2D;&#x5143;&#x7D20;&#x662F;&#x6309;&#x5347;&#x5E8F;&#x6392;&#x5217;&#xFF0C;&#x5C06;&#x8868;&#x4E2D;&#x95F4;&#x4F4D;&#x7F6E;&#x8BB0;&#x5F55;&#x7684;&#x5173;&#x952E;&#x5B57;&#x4E0E;&#x67E5;&#x627E;&#x5173;&#x952E;&#x5B57;&#x6BD4;&#x8F83;&#xFF0C;&#x5982;&#x679C;&#x4E24;&#x8005;&#x76F8;&#x7B49;&#xFF0C;&#x5219;&#x67E5;&#x627E;&#x6210;&#x529F;&#xFF1B;&#x5426;&#x5219;&#x5229;&#x7528;&#x4E2D;&#x95F4;&#x4F4D;&#x7F6E;&#x8BB0;&#x5F55;&#x5C06;&#x8868;&#x5206;&#x6210;&#x524D;&#x3001;&#x540E;&#x4E24;&#x4E2A;&#x5B50;&#x8868;&#xFF0C;&#x5982;&#x679C;&#x4E2D;&#x95F4;&#x4F4D;&#x7F6E;&#x8BB0;&#x5F55;&#x7684;&#x5173;&#x952E;&#x5B57;&#x5927;&#x4E8E;&#x67E5;&#x627E;&#x5173;&#x952E;&#x5B57;&#xFF0C;&#x5219;&#x8FDB;&#x4E00;&#x6B65;&#x67E5;&#x627E;&#x524D;&#x4E00;&#x5B50;&#x8868;&#xFF0C;&#x5426;&#x5219;&#x8FDB;&#x4E00;&#x6B65;&#x67E5;&#x627E;&#x540E;&#x4E00;&#x5B50;&#x8868;&#x3002;&#x91CD;&#x590D;&#x4EE5;&#x4E0A;&#x8FC7;&#x7A0B;&#xFF0C;&#x76F4;&#x5230;&#x627E;&#x5230;&#x6EE1;&#x8DB3;&#x6761;&#x4EF6;&#x7684;&#x8BB0;&#x5F55;&#xFF0C;&#x4F7F;&#x67E5;&#x627E;&#x6210;&#x529F;&#xFF0C;&#x6216;&#x76F4;&#x5230;&#x5B50;&#x8868;&#x4E0D;&#x5B58;&#x5728;&#x4E3A;&#x6B62;&#xFF0C;&#x6B64;&#x65F6;&#x67E5;&#x627E;&#x4E0D;&#x6210;&#x529F;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/7139861eee281ea240657d31684eae38dfea8d4da1c0a79617e609ae03b9aaf2" alt></p>
<p>##&#x4E8C;&#x5206;&#x6CD5;&#x67E5;&#x627E;&#x5B9E;&#x73B0;</p>
<p>##&#xFF08;&#x975E;&#x9012;&#x5F52;&#x5B9E;&#x73B0;&#xFF09;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;def binary_search(alist, item):</span><br><span class="line">      first = 0</span><br><span class="line">      last = len(alist)-1</span><br><span class="line">      while first&lt;=last:</span><br><span class="line">          midpoint = (first + last)/2</span><br><span class="line">          if alist[midpoint] == item:</span><br><span class="line">              return True</span><br><span class="line">          elif item &lt; alist[midpoint]:</span><br><span class="line">              last = midpoint-1</span><br><span class="line">          else:</span><br><span class="line">              first = midpoint+1</span><br><span class="line">    return False</span><br><span class="line">testlist = [0, 1, 2, 8, 13, 17, 19, 32, 42,]</span><br><span class="line">print(binary_search(testlist, 3))</span><br><span class="line">print(binary_search(testlist, 13))</span><br></pre></td></tr></table></figure>

<p>##&#xFF08;&#x9012;&#x5F52;&#x5B9E;&#x73B0;&#xFF09;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;def binary_search(alist, item):</span><br><span class="line">    if len(alist) == 0:</span><br><span class="line">        return False</span><br><span class="line">    else:</span><br><span class="line">        midpoint = len(alist)//2</span><br><span class="line">        if alist[midpoint]==item:</span><br><span class="line">          return True</span><br><span class="line">        else:</span><br><span class="line">          if item&lt;alist[midpoint]:</span><br><span class="line">            return binary_search(alist[:midpoint],item)</span><br><span class="line">          else:</span><br><span class="line">            return binary_search(alist[midpoint+1:],item)</span><br><span class="line"></span><br><span class="line">testlist = [0, 1, 2, 8, 13, 17, 19, 32, 42,]</span><br><span class="line">print(binary_search(testlist, 3))</span><br><span class="line">print(binary_search(testlist, 13))</span><br></pre></td></tr></table></figure>

<p>##&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;</p>
<ul>
<li>&#x6700;&#x4F18;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF1A;O(1)</li>
<li>&#x6700;&#x574F;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF1A;O(logn)</li>
</ul>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/bc0bcbd1851e3737c29b2f58b1bf8ba3.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903544978407431.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903544978407431.html" itemprop="url">WebSocket：5分钟从入门到精通</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-05T01:58:19+08:00">
                2018-01-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>&#x963F;&#x91CC;&#x524D;&#x7AEF;&#x5B9E;&#x4E60;&#x6625;&#x62DB;# &#x963F;&#x91CC;CBU&#x6280;&#x672F;&#x90E8;&#x62DB;&#x524D;&#x7AEF;&#x5B9E;&#x4E60;&#x751F;&#x5566;&#xFF01;2023&#x5C4A;&#x7684;&#x540C;&#x5B66;&#x770B;&#x8FC7;&#x6765;&#xFF0C;&#x4E13;&#x4E1A;&#x8FC7;&#x5173;&#x3001;&#x524D;&#x7AEF;&#x57FA;&#x7840;&#x624E;&#x5B9E;&#x5373;&#x53EF;&#xFF0C;&#x4F4E;&#x4EE3;&#x7801;/&#x8DE8;&#x7AEF;/&#x76F4;&#x64AD;/VR/electron/nodejs &#xFF0C;&#x603B;&#x6709;&#x4E00;&#x6B3E;&#x9002;&#x5408;&#x4F60;! <a href="/external_links/5e086047e9fa9d8558605dd48a8a604e.html" target="blank" rel="noopener">&#x70B9;&#x51FB;&#x6295;&#x9012;&#x7B80;&#x5386;</a>)</p>
</blockquote>
<h2 id="&#x4E00;&#x3001;&#x5185;&#x5BB9;&#x6982;&#x89C8;"><a href="#&#x4E00;&#x3001;&#x5185;&#x5BB9;&#x6982;&#x89C8;" class="headerlink" title="&#x4E00;&#x3001;&#x5185;&#x5BB9;&#x6982;&#x89C8;"></a>&#x4E00;&#x3001;&#x5185;&#x5BB9;&#x6982;&#x89C8;</h2><p>WebSocket&#x7684;&#x51FA;&#x73B0;&#xFF0C;&#x4F7F;&#x5F97;&#x6D4F;&#x89C8;&#x5668;&#x5177;&#x5907;&#x4E86;&#x5B9E;&#x65F6;&#x53CC;&#x5411;&#x901A;&#x4FE1;&#x7684;&#x80FD;&#x529B;&#x3002;&#x672C;&#x6587;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x4ECB;&#x7ECD;&#x4E86;WebSocket&#x5982;&#x4F55;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x3001;&#x4EA4;&#x6362;&#x6570;&#x636E;&#x7684;&#x7EC6;&#x8282;&#xFF0C;&#x4EE5;&#x53CA;&#x6570;&#x636E;&#x5E27;&#x7684;&#x683C;&#x5F0F;&#x3002;&#x6B64;&#x5916;&#xFF0C;&#x8FD8;&#x7B80;&#x8981;&#x4ECB;&#x7ECD;&#x4E86;&#x9488;&#x5BF9;WebSocket&#x7684;&#x5B89;&#x5168;&#x653B;&#x51FB;&#xFF0C;&#x4EE5;&#x53CA;&#x534F;&#x8BAE;&#x662F;&#x5982;&#x4F55;&#x62B5;&#x5FA1;&#x7C7B;&#x4F3C;&#x653B;&#x51FB;&#x7684;&#x3002;</p>
<h2 id="&#x4E8C;&#x3001;&#x4EC0;&#x4E48;&#x662F;WebSocket"><a href="#&#x4E8C;&#x3001;&#x4EC0;&#x4E48;&#x662F;WebSocket" class="headerlink" title="&#x4E8C;&#x3001;&#x4EC0;&#x4E48;&#x662F;WebSocket"></a>&#x4E8C;&#x3001;&#x4EC0;&#x4E48;&#x662F;WebSocket</h2><p>HTML5&#x5F00;&#x59CB;&#x63D0;&#x4F9B;&#x7684;&#x4E00;&#x79CD;&#x6D4F;&#x89C8;&#x5668;&#x4E0E;&#x670D;&#x52A1;&#x5668;&#x8FDB;&#x884C;&#x5168;&#x53CC;&#x5DE5;&#x901A;&#x8BAF;&#x7684;&#x7F51;&#x7EDC;&#x6280;&#x672F;&#xFF0C;&#x5C5E;&#x4E8E;&#x5E94;&#x7528;&#x5C42;&#x534F;&#x8BAE;&#x3002;&#x5B83;&#x57FA;&#x4E8E;TCP&#x4F20;&#x8F93;&#x534F;&#x8BAE;&#xFF0C;&#x5E76;&#x590D;&#x7528;HTTP&#x7684;&#x63E1;&#x624B;&#x901A;&#x9053;&#x3002;</p>
<p>&#x5BF9;&#x5927;&#x90E8;&#x5206;web&#x5F00;&#x53D1;&#x8005;&#x6765;&#x8BF4;&#xFF0C;&#x4E0A;&#x9762;&#x8FD9;&#x6BB5;&#x63CF;&#x8FF0;&#x6709;&#x70B9;&#x67AF;&#x71E5;&#xFF0C;&#x5176;&#x5B9E;&#x53EA;&#x8981;&#x8BB0;&#x4F4F;&#x51E0;&#x70B9;&#xFF1A;</p>
<ol>
<li>WebSocket&#x53EF;&#x4EE5;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x91CC;&#x4F7F;&#x7528;</li>
<li>&#x652F;&#x6301;&#x53CC;&#x5411;&#x901A;&#x4FE1;</li>
<li>&#x4F7F;&#x7528;&#x5F88;&#x7B80;&#x5355;</li>
</ol>
<h3 id="1&#x3001;&#x6709;&#x54EA;&#x4E9B;&#x4F18;&#x70B9;"><a href="#1&#x3001;&#x6709;&#x54EA;&#x4E9B;&#x4F18;&#x70B9;" class="headerlink" title="1&#x3001;&#x6709;&#x54EA;&#x4E9B;&#x4F18;&#x70B9;"></a>1&#x3001;&#x6709;&#x54EA;&#x4E9B;&#x4F18;&#x70B9;</h3><p>&#x8BF4;&#x5230;&#x4F18;&#x70B9;&#xFF0C;&#x8FD9;&#x91CC;&#x7684;&#x5BF9;&#x6BD4;&#x53C2;&#x7167;&#x7269;&#x662F;HTTP&#x534F;&#x8BAE;&#xFF0C;&#x6982;&#x62EC;&#x5730;&#x8BF4;&#x5C31;&#x662F;&#xFF1A;&#x652F;&#x6301;&#x53CC;&#x5411;&#x901A;&#x4FE1;&#xFF0C;&#x66F4;&#x7075;&#x6D3B;&#xFF0C;&#x66F4;&#x9AD8;&#x6548;&#xFF0C;&#x53EF;&#x6269;&#x5C55;&#x6027;&#x66F4;&#x597D;&#x3002;</p>
<ol>
<li>&#x652F;&#x6301;&#x53CC;&#x5411;&#x901A;&#x4FE1;&#xFF0C;&#x5B9E;&#x65F6;&#x6027;&#x66F4;&#x5F3A;&#x3002;</li>
<li>&#x66F4;&#x597D;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x652F;&#x6301;&#x3002;</li>
<li>&#x8F83;&#x5C11;&#x7684;&#x63A7;&#x5236;&#x5F00;&#x9500;&#x3002;&#x8FDE;&#x63A5;&#x521B;&#x5EFA;&#x540E;&#xFF0C;ws&#x5BA2;&#x6237;&#x7AEF;&#x3001;&#x670D;&#x52A1;&#x7AEF;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x4EA4;&#x6362;&#x65F6;&#xFF0C;&#x534F;&#x8BAE;&#x63A7;&#x5236;&#x7684;&#x6570;&#x636E;&#x5305;&#x5934;&#x90E8;&#x8F83;&#x5C0F;&#x3002;&#x5728;&#x4E0D;&#x5305;&#x542B;&#x5934;&#x90E8;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x670D;&#x52A1;&#x7AEF;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x5305;&#x5934;&#x53EA;&#x6709;2~10&#x5B57;&#x8282;&#xFF08;&#x53D6;&#x51B3;&#x4E8E;&#x6570;&#x636E;&#x5305;&#x957F;&#x5EA6;&#xFF09;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x5230;&#x670D;&#x52A1;&#x7AEF;&#x7684;&#x7684;&#x8BDD;&#xFF0C;&#x9700;&#x8981;&#x52A0;&#x4E0A;&#x989D;&#x5916;&#x7684;4&#x5B57;&#x8282;&#x7684;&#x63A9;&#x7801;&#x3002;&#x800C;HTTP&#x534F;&#x8BAE;&#x6BCF;&#x6B21;&#x901A;&#x4FE1;&#x90FD;&#x9700;&#x8981;&#x643A;&#x5E26;&#x5B8C;&#x6574;&#x7684;&#x5934;&#x90E8;&#x3002;</li>
<li>&#x652F;&#x6301;&#x6269;&#x5C55;&#x3002;ws&#x534F;&#x8BAE;&#x5B9A;&#x4E49;&#x4E86;&#x6269;&#x5C55;&#xFF0C;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x6269;&#x5C55;&#x534F;&#x8BAE;&#xFF0C;&#x6216;&#x8005;&#x5B9E;&#x73B0;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x5B50;&#x534F;&#x8BAE;&#x3002;&#xFF08;&#x6BD4;&#x5982;&#x652F;&#x6301;&#x81EA;&#x5B9A;&#x4E49;&#x538B;&#x7F29;&#x7B97;&#x6CD5;&#x7B49;&#xFF09;</li>
</ol>
<p>&#x5BF9;&#x4E8E;&#x540E;&#x9762;&#x4E24;&#x70B9;&#xFF0C;&#x6CA1;&#x6709;&#x7814;&#x7A76;&#x8FC7;WebSocket&#x534F;&#x8BAE;&#x89C4;&#x8303;&#x7684;&#x540C;&#x5B66;&#x53EF;&#x80FD;&#x7406;&#x89E3;&#x8D77;&#x6765;&#x4E0D;&#x591F;&#x76F4;&#x89C2;&#xFF0C;&#x4F46;&#x4E0D;&#x5F71;&#x54CD;&#x5BF9;WebSocket&#x7684;&#x5B66;&#x4E60;&#x548C;&#x4F7F;&#x7528;&#x3002;</p>
<h3 id="2&#x3001;&#x9700;&#x8981;&#x5B66;&#x4E60;&#x54EA;&#x4E9B;&#x4E1C;&#x897F;"><a href="#2&#x3001;&#x9700;&#x8981;&#x5B66;&#x4E60;&#x54EA;&#x4E9B;&#x4E1C;&#x897F;" class="headerlink" title="2&#x3001;&#x9700;&#x8981;&#x5B66;&#x4E60;&#x54EA;&#x4E9B;&#x4E1C;&#x897F;"></a>2&#x3001;&#x9700;&#x8981;&#x5B66;&#x4E60;&#x54EA;&#x4E9B;&#x4E1C;&#x897F;</h3><p>&#x5BF9;&#x7F51;&#x7EDC;&#x5E94;&#x7528;&#x5C42;&#x534F;&#x8BAE;&#x7684;&#x5B66;&#x4E60;&#x6765;&#x8BF4;&#xFF0C;&#x6700;&#x91CD;&#x8981;&#x7684;&#x5F80;&#x5F80;&#x5C31;&#x662F;<strong>&#x8FDE;&#x63A5;&#x5EFA;&#x7ACB;&#x8FC7;&#x7A0B;</strong>&#x3001;<strong>&#x6570;&#x636E;&#x4EA4;&#x6362;&#x6559;&#x7A0B;</strong>&#x3002;&#x5F53;&#x7136;&#xFF0C;&#x6570;&#x636E;&#x7684;&#x683C;&#x5F0F;&#x662F;&#x9003;&#x4E0D;&#x6389;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x76F4;&#x63A5;&#x51B3;&#x5B9A;&#x4E86;&#x534F;&#x8BAE;&#x672C;&#x8EAB;&#x7684;&#x80FD;&#x529B;&#x3002;&#x597D;&#x7684;&#x6570;&#x636E;&#x683C;&#x5F0F;&#x80FD;&#x8BA9;&#x534F;&#x8BAE;&#x66F4;&#x9AD8;&#x6548;&#x3001;&#x6269;&#x5C55;&#x6027;&#x66F4;&#x597D;&#x3002;</p>
<p>&#x4E0B;&#x6587;&#x4E3B;&#x8981;&#x56F4;&#x7ED5;&#x4E0B;&#x9762;&#x51E0;&#x70B9;&#x5C55;&#x5F00;&#xFF1A;</p>
<ol>
<li>&#x5982;&#x4F55;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;</li>
<li>&#x5982;&#x4F55;&#x4EA4;&#x6362;&#x6570;&#x636E;</li>
<li>&#x6570;&#x636E;&#x5E27;&#x683C;&#x5F0F;</li>
<li>&#x5982;&#x4F55;&#x7EF4;&#x6301;&#x8FDE;&#x63A5;</li>
</ol>
<h2 id="&#x4E09;&#x3001;&#x5165;&#x95E8;&#x4F8B;&#x5B50;"><a href="#&#x4E09;&#x3001;&#x5165;&#x95E8;&#x4F8B;&#x5B50;" class="headerlink" title="&#x4E09;&#x3001;&#x5165;&#x95E8;&#x4F8B;&#x5B50;"></a>&#x4E09;&#x3001;&#x5165;&#x95E8;&#x4F8B;&#x5B50;</h2><p>&#x5728;&#x6B63;&#x5F0F;&#x4ECB;&#x7ECD;&#x534F;&#x8BAE;&#x7EC6;&#x8282;&#x524D;&#xFF0C;&#x5148;&#x6765;&#x770B;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x6709;&#x4E2A;&#x76F4;&#x89C2;&#x611F;&#x53D7;&#x3002;&#x4F8B;&#x5B50;&#x5305;&#x62EC;&#x4E86;WebSocket&#x670D;&#x52A1;&#x7AEF;&#x3001;WebSocket&#x5BA2;&#x6237;&#x7AEF;&#xFF08;&#x7F51;&#x9875;&#x7AEF;&#xFF09;&#x3002;&#x5B8C;&#x6574;&#x4EE3;&#x7801;&#x53EF;&#x4EE5;&#x5728; <a href="/external_links/a8a0399bf45ad0f886a48faa26767f3c.html" target="blank" rel="noopener">&#x8FD9;&#x91CC;</a> &#x627E;&#x5230;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x670D;&#x52A1;&#x7AEF;&#x7528;&#x4E86;<code>ws</code>&#x8FD9;&#x4E2A;&#x5E93;&#x3002;&#x76F8;&#x6BD4;&#x5927;&#x5BB6;&#x719F;&#x6089;&#x7684;<code>socket.io</code>&#xFF0C;<code>ws</code>&#x5B9E;&#x73B0;&#x66F4;&#x8F7B;&#x91CF;&#xFF0C;&#x66F4;&#x9002;&#x5408;&#x5B66;&#x4E60;&#x7684;&#x76EE;&#x7684;&#x3002;</p>
<h3 id="1&#x3001;&#x670D;&#x52A1;&#x7AEF;"><a href="#1&#x3001;&#x670D;&#x52A1;&#x7AEF;" class="headerlink" title="1&#x3001;&#x670D;&#x52A1;&#x7AEF;"></a>1&#x3001;&#x670D;&#x52A1;&#x7AEF;</h3><p>&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF0C;&#x76D1;&#x542C;8080&#x7AEF;&#x53E3;&#x3002;&#x5F53;&#x6709;&#x65B0;&#x7684;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#x5230;&#x8FBE;&#x65F6;&#xFF0C;&#x6253;&#x5370;&#x65E5;&#x5FD7;&#xFF0C;&#x540C;&#x65F6;&#x5411;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x6D88;&#x606F;&#x3002;&#x5F53;&#x6536;&#x5230;&#x5230;&#x6765;&#x81EA;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x6D88;&#x606F;&#x65F6;&#xFF0C;&#x540C;&#x6837;&#x6253;&#x5370;&#x65E5;&#x5FD7;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">javascript&#x590D;&#x5236;&#x4EE3;&#x7801;var app = require(&apos;express&apos;)();</span><br><span class="line">var server = require(&apos;http&apos;).Server(app);</span><br><span class="line">var WebSocket = require(&apos;ws&apos;);</span><br><span class="line"></span><br><span class="line">var wss = new WebSocket.Server({ port: 8080 });</span><br><span class="line"></span><br><span class="line">wss.on(&apos;connection&apos;, function connection(ws) {</span><br><span class="line">    console.log(&apos;server: receive connection.&apos;);</span><br><span class="line">    </span><br><span class="line">    ws.on(&apos;message&apos;, function incoming(message) {</span><br><span class="line">        console.log(&apos;server: received: %s&apos;, message);</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    ws.send(&apos;world&apos;);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">app.get(&apos;/&apos;, function (req, res) {</span><br><span class="line">  res.sendfile(__dirname + &apos;/index.html&apos;);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">app.listen(3000);</span><br></pre></td></tr></table></figure>

<h3 id="2&#x3001;&#x5BA2;&#x6237;&#x7AEF;"><a href="#2&#x3001;&#x5BA2;&#x6237;&#x7AEF;" class="headerlink" title="2&#x3001;&#x5BA2;&#x6237;&#x7AEF;"></a>2&#x3001;&#x5BA2;&#x6237;&#x7AEF;</h3><p>&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF0C;&#x5411;8080&#x7AEF;&#x53E3;&#x53D1;&#x8D77;WebSocket&#x8FDE;&#x63A5;&#x3002;&#x8FDE;&#x63A5;&#x5EFA;&#x7ACB;&#x540E;&#xFF0C;&#x6253;&#x5370;&#x65E5;&#x5FD7;&#xFF0C;&#x540C;&#x65F6;&#x5411;&#x670D;&#x52A1;&#x7AEF;&#x53D1;&#x9001;&#x6D88;&#x606F;&#x3002;&#x63A5;&#x6536;&#x5230;&#x6765;&#x81EA;&#x670D;&#x52A1;&#x7AEF;&#x7684;&#x6D88;&#x606F;&#x540E;&#xFF0C;&#x540C;&#x6837;&#x6253;&#x5370;&#x65E5;&#x5FD7;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">htmlbars&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;script&gt;</span><br><span class="line">  var ws = new WebSocket(&apos;ws://localhost:8080&apos;);</span><br><span class="line">  ws.onopen = function () {</span><br><span class="line">    console.log(&apos;ws onopen&apos;);</span><br><span class="line">    ws.send(&apos;from client: hello&apos;);</span><br><span class="line">  };</span><br><span class="line">  ws.onmessage = function (e) {</span><br><span class="line">    console.log(&apos;ws onmessage&apos;);</span><br><span class="line">    console.log(&apos;from server: &apos; + e.data);</span><br><span class="line">  };</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="3&#x3001;&#x8FD0;&#x884C;&#x7ED3;&#x679C;"><a href="#3&#x3001;&#x8FD0;&#x884C;&#x7ED3;&#x679C;" class="headerlink" title="3&#x3001;&#x8FD0;&#x884C;&#x7ED3;&#x679C;"></a>3&#x3001;&#x8FD0;&#x884C;&#x7ED3;&#x679C;</h3><p>&#x53EF;&#x5206;&#x522B;&#x67E5;&#x770B;&#x670D;&#x52A1;&#x7AEF;&#x3001;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x65E5;&#x5FD7;&#xFF0C;&#x8FD9;&#x91CC;&#x4E0D;&#x5C55;&#x5F00;&#x3002;</p>
<p>&#x670D;&#x52A1;&#x7AEF;&#x8F93;&#x51FA;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bash&#x590D;&#x5236;&#x4EE3;&#x7801;server: receive connection.</span><br><span class="line">server: received hello</span><br></pre></td></tr></table></figure>

<p>&#x5BA2;&#x6237;&#x7AEF;&#x8F93;&#x51FA;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bash&#x590D;&#x5236;&#x4EE3;&#x7801;client: ws connection is open</span><br><span class="line">client: received world</span><br></pre></td></tr></table></figure>

<h2 id="&#x56DB;&#x3001;&#x5982;&#x4F55;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;"><a href="#&#x56DB;&#x3001;&#x5982;&#x4F55;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;" class="headerlink" title="&#x56DB;&#x3001;&#x5982;&#x4F55;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;"></a>&#x56DB;&#x3001;&#x5982;&#x4F55;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;</h2><p>&#x524D;&#x9762;&#x63D0;&#x5230;&#xFF0C;WebSocket&#x590D;&#x7528;&#x4E86;HTTP&#x7684;&#x63E1;&#x624B;&#x901A;&#x9053;&#x3002;&#x5177;&#x4F53;&#x6307;&#x7684;&#x662F;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x901A;&#x8FC7;HTTP&#x8BF7;&#x6C42;&#x4E0E;WebSocket&#x670D;&#x52A1;&#x7AEF;&#x534F;&#x5546;&#x5347;&#x7EA7;&#x534F;&#x8BAE;&#x3002;&#x534F;&#x8BAE;&#x5347;&#x7EA7;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x540E;&#x7EED;&#x7684;&#x6570;&#x636E;&#x4EA4;&#x6362;&#x5219;&#x9075;&#x7167;WebSocket&#x7684;&#x534F;&#x8BAE;&#x3002;</p>
<h3 id="1&#x3001;&#x5BA2;&#x6237;&#x7AEF;&#xFF1A;&#x7533;&#x8BF7;&#x534F;&#x8BAE;&#x5347;&#x7EA7;"><a href="#1&#x3001;&#x5BA2;&#x6237;&#x7AEF;&#xFF1A;&#x7533;&#x8BF7;&#x534F;&#x8BAE;&#x5347;&#x7EA7;" class="headerlink" title="1&#x3001;&#x5BA2;&#x6237;&#x7AEF;&#xFF1A;&#x7533;&#x8BF7;&#x534F;&#x8BAE;&#x5347;&#x7EA7;"></a>1&#x3001;&#x5BA2;&#x6237;&#x7AEF;&#xFF1A;&#x7533;&#x8BF7;&#x534F;&#x8BAE;&#x5347;&#x7EA7;</h3><p>&#x9996;&#x5148;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x8D77;&#x534F;&#x8BAE;&#x5347;&#x7EA7;&#x8BF7;&#x6C42;&#x3002;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x91C7;&#x7528;&#x7684;&#x662F;&#x6807;&#x51C6;&#x7684;HTTP&#x62A5;&#x6587;&#x683C;&#x5F0F;&#xFF0C;&#x4E14;&#x53EA;&#x652F;&#x6301;<code>GET</code>&#x65B9;&#x6CD5;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">http&#x590D;&#x5236;&#x4EE3;&#x7801;GET / HTTP/1.1</span><br><span class="line">Host: localhost:8080</span><br><span class="line">Origin: http://127.0.0.1:3000</span><br><span class="line">Connection: Upgrade</span><br><span class="line">Upgrade: websocket</span><br><span class="line">Sec-WebSocket-Version: 13</span><br><span class="line">Sec-WebSocket-Key: w4v7O6xFTi36lq3RNcgctw==</span><br></pre></td></tr></table></figure>

<p>&#x91CD;&#x70B9;&#x8BF7;&#x6C42;&#x9996;&#x90E8;&#x610F;&#x4E49;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li><code>Connection: Upgrade</code>&#xFF1A;&#x8868;&#x793A;&#x8981;&#x5347;&#x7EA7;&#x534F;&#x8BAE;</li>
<li><code>Upgrade: websocket</code>&#xFF1A;&#x8868;&#x793A;&#x8981;&#x5347;&#x7EA7;&#x5230;websocket&#x534F;&#x8BAE;&#x3002;</li>
<li><code>Sec-WebSocket-Version: 13</code>&#xFF1A;&#x8868;&#x793A;websocket&#x7684;&#x7248;&#x672C;&#x3002;&#x5982;&#x679C;&#x670D;&#x52A1;&#x7AEF;&#x4E0D;&#x652F;&#x6301;&#x8BE5;&#x7248;&#x672C;&#xFF0C;&#x9700;&#x8981;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;<code>Sec-WebSocket-Version</code>header&#xFF0C;&#x91CC;&#x9762;&#x5305;&#x542B;&#x670D;&#x52A1;&#x7AEF;&#x652F;&#x6301;&#x7684;&#x7248;&#x672C;&#x53F7;&#x3002;</li>
<li><code>Sec-WebSocket-Key</code>&#xFF1A;&#x4E0E;&#x540E;&#x9762;&#x670D;&#x52A1;&#x7AEF;&#x54CD;&#x5E94;&#x9996;&#x90E8;&#x7684;<code>Sec-WebSocket-Accept</code>&#x662F;&#x914D;&#x5957;&#x7684;&#xFF0C;&#x63D0;&#x4F9B;&#x57FA;&#x672C;&#x7684;&#x9632;&#x62A4;&#xFF0C;&#x6BD4;&#x5982;&#x6076;&#x610F;&#x7684;&#x8FDE;&#x63A5;&#xFF0C;&#x6216;&#x8005;&#x65E0;&#x610F;&#x7684;&#x8FDE;&#x63A5;&#x3002;</li>
</ul>
<blockquote>
<p>&#x6CE8;&#x610F;&#xFF0C;&#x4E0A;&#x9762;&#x8BF7;&#x6C42;&#x7701;&#x7565;&#x4E86;&#x90E8;&#x5206;&#x975E;&#x91CD;&#x70B9;&#x8BF7;&#x6C42;&#x9996;&#x90E8;&#x3002;&#x7531;&#x4E8E;&#x662F;&#x6807;&#x51C6;&#x7684;HTTP&#x8BF7;&#x6C42;&#xFF0C;&#x7C7B;&#x4F3C;Host&#x3001;Origin&#x3001;Cookie&#x7B49;&#x8BF7;&#x6C42;&#x9996;&#x90E8;&#x4F1A;&#x7167;&#x5E38;&#x53D1;&#x9001;&#x3002;&#x5728;&#x63E1;&#x624B;&#x9636;&#x6BB5;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x76F8;&#x5173;&#x8BF7;&#x6C42;&#x9996;&#x90E8;&#x8FDB;&#x884C; &#x5B89;&#x5168;&#x9650;&#x5236;&#x3001;&#x6743;&#x9650;&#x6821;&#x9A8C;&#x7B49;&#x3002;</p>
</blockquote>
<h3 id="2&#x3001;&#x670D;&#x52A1;&#x7AEF;&#xFF1A;&#x54CD;&#x5E94;&#x534F;&#x8BAE;&#x5347;&#x7EA7;"><a href="#2&#x3001;&#x670D;&#x52A1;&#x7AEF;&#xFF1A;&#x54CD;&#x5E94;&#x534F;&#x8BAE;&#x5347;&#x7EA7;" class="headerlink" title="2&#x3001;&#x670D;&#x52A1;&#x7AEF;&#xFF1A;&#x54CD;&#x5E94;&#x534F;&#x8BAE;&#x5347;&#x7EA7;"></a>2&#x3001;&#x670D;&#x52A1;&#x7AEF;&#xFF1A;&#x54CD;&#x5E94;&#x534F;&#x8BAE;&#x5347;&#x7EA7;</h3><p>&#x670D;&#x52A1;&#x7AEF;&#x8FD4;&#x56DE;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF0C;&#x72B6;&#x6001;&#x4EE3;&#x7801;<code>101</code>&#x8868;&#x793A;&#x534F;&#x8BAE;&#x5207;&#x6362;&#x3002;&#x5230;&#x6B64;&#x5B8C;&#x6210;&#x534F;&#x8BAE;&#x5347;&#x7EA7;&#xFF0C;&#x540E;&#x7EED;&#x7684;&#x6570;&#x636E;&#x4EA4;&#x4E92;&#x90FD;&#x6309;&#x7167;&#x65B0;&#x7684;&#x534F;&#x8BAE;&#x6765;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http&#x590D;&#x5236;&#x4EE3;&#x7801;HTTP/1.1 101 Switching Protocols</span><br><span class="line">Connection:Upgrade</span><br><span class="line">Upgrade: websocket</span><br><span class="line">Sec-WebSocket-Accept: Oy4NRAQ13jhfONC7bP8dTKb4PTU=</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&#x5907;&#x6CE8;&#xFF1A;&#x6BCF;&#x4E2A;header&#x90FD;&#x4EE5;<code>\r\n</code>&#x7ED3;&#x5C3E;&#xFF0C;&#x5E76;&#x4E14;&#x6700;&#x540E;&#x4E00;&#x884C;&#x52A0;&#x4E0A;&#x4E00;&#x4E2A;&#x989D;&#x5916;&#x7684;&#x7A7A;&#x884C;<code>\r\n</code>&#x3002;&#x6B64;&#x5916;&#xFF0C;&#x670D;&#x52A1;&#x7AEF;&#x56DE;&#x5E94;&#x7684;HTTP&#x72B6;&#x6001;&#x7801;&#x53EA;&#x80FD;&#x5728;&#x63E1;&#x624B;&#x9636;&#x6BB5;&#x4F7F;&#x7528;&#x3002;&#x8FC7;&#x4E86;&#x63E1;&#x624B;&#x9636;&#x6BB5;&#x540E;&#xFF0C;&#x5C31;&#x53EA;&#x80FD;&#x91C7;&#x7528;&#x7279;&#x5B9A;&#x7684;&#x9519;&#x8BEF;&#x7801;&#x3002;</p>
</blockquote>
<h3 id="3&#x3001;Sec-WebSocket-Accept&#x7684;&#x8BA1;&#x7B97;"><a href="#3&#x3001;Sec-WebSocket-Accept&#x7684;&#x8BA1;&#x7B97;" class="headerlink" title="3&#x3001;Sec-WebSocket-Accept&#x7684;&#x8BA1;&#x7B97;"></a>3&#x3001;Sec-WebSocket-Accept&#x7684;&#x8BA1;&#x7B97;</h3><p><code>Sec-WebSocket-Accept</code>&#x6839;&#x636E;&#x5BA2;&#x6237;&#x7AEF;&#x8BF7;&#x6C42;&#x9996;&#x90E8;&#x7684;<code>Sec-WebSocket-Key</code>&#x8BA1;&#x7B97;&#x51FA;&#x6765;&#x3002;</p>
<p>&#x8BA1;&#x7B97;&#x516C;&#x5F0F;&#x4E3A;&#xFF1A;</p>
<ol>
<li>&#x5C06;<code>Sec-WebSocket-Key</code>&#x8DDF;<code>258EAFA5-E914-47DA-95CA-C5AB0DC85B11</code>&#x62FC;&#x63A5;&#x3002;</li>
<li>&#x901A;&#x8FC7;SHA1&#x8BA1;&#x7B97;&#x51FA;&#x6458;&#x8981;&#xFF0C;&#x5E76;&#x8F6C;&#x6210;base64&#x5B57;&#x7B26;&#x4E32;&#x3002;</li>
</ol>
<p>&#x4F2A;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javascript&#x590D;&#x5236;&#x4EE3;&#x7801;&gt;toBase64( sha1( Sec-WebSocket-Key + 258EAFA5-E914-47DA-95CA-C5AB0DC85B11 )  )</span><br></pre></td></tr></table></figure>

<p>&#x9A8C;&#x8BC1;&#x4E0B;&#x524D;&#x9762;&#x7684;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">javascript&#x590D;&#x5236;&#x4EE3;&#x7801;const crypto = require(&apos;crypto&apos;);</span><br><span class="line">const magic = &apos;258EAFA5-E914-47DA-95CA-C5AB0DC85B11&apos;;</span><br><span class="line">const secWebSocketKey = &apos;w4v7O6xFTi36lq3RNcgctw==&apos;;</span><br><span class="line"></span><br><span class="line">let secWebSocketAccept = crypto.createHash(&apos;sha1&apos;)</span><br><span class="line">	.update(secWebSocketKey + magic)</span><br><span class="line">	.digest(&apos;base64&apos;);</span><br><span class="line"></span><br><span class="line">console.log(secWebSocketAccept);</span><br><span class="line">// Oy4NRAQ13jhfONC7bP8dTKb4PTU=</span><br></pre></td></tr></table></figure>

<h2 id="&#x4E94;&#x3001;&#x6570;&#x636E;&#x5E27;&#x683C;&#x5F0F;"><a href="#&#x4E94;&#x3001;&#x6570;&#x636E;&#x5E27;&#x683C;&#x5F0F;" class="headerlink" title="&#x4E94;&#x3001;&#x6570;&#x636E;&#x5E27;&#x683C;&#x5F0F;"></a>&#x4E94;&#x3001;&#x6570;&#x636E;&#x5E27;&#x683C;&#x5F0F;</h2><p>&#x5BA2;&#x6237;&#x7AEF;&#x3001;&#x670D;&#x52A1;&#x7AEF;&#x6570;&#x636E;&#x7684;&#x4EA4;&#x6362;&#xFF0C;&#x79BB;&#x4E0D;&#x5F00;&#x6570;&#x636E;&#x5E27;&#x683C;&#x5F0F;&#x7684;&#x5B9A;&#x4E49;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5728;&#x5B9E;&#x9645;&#x8BB2;&#x89E3;&#x6570;&#x636E;&#x4EA4;&#x6362;&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x5148;&#x6765;&#x770B;&#x4E0B;WebSocket&#x7684;&#x6570;&#x636E;&#x5E27;&#x683C;&#x5F0F;&#x3002;</p>
<p>WebSocket&#x5BA2;&#x6237;&#x7AEF;&#x3001;&#x670D;&#x52A1;&#x7AEF;&#x901A;&#x4FE1;&#x7684;&#x6700;&#x5C0F;&#x5355;&#x4F4D;&#x662F;&#x5E27;&#xFF08;frame&#xFF09;&#xFF0C;&#x7531;1&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x5E27;&#x7EC4;&#x6210;&#x4E00;&#x6761;&#x5B8C;&#x6574;&#x7684;&#x6D88;&#x606F;&#xFF08;message&#xFF09;&#x3002;</p>
<ol>
<li>&#x53D1;&#x9001;&#x7AEF;&#xFF1A;&#x5C06;&#x6D88;&#x606F;&#x5207;&#x5272;&#x6210;&#x591A;&#x4E2A;&#x5E27;&#xFF0C;&#x5E76;&#x53D1;&#x9001;&#x7ED9;&#x670D;&#x52A1;&#x7AEF;&#xFF1B;</li>
<li>&#x63A5;&#x6536;&#x7AEF;&#xFF1A;&#x63A5;&#x6536;&#x6D88;&#x606F;&#x5E27;&#xFF0C;&#x5E76;&#x5C06;&#x5173;&#x8054;&#x7684;&#x5E27;&#x91CD;&#x65B0;&#x7EC4;&#x88C5;&#x6210;&#x5B8C;&#x6574;&#x7684;&#x6D88;&#x606F;&#xFF1B;</li>
</ol>
<p>&#x672C;&#x8282;&#x7684;&#x91CD;&#x70B9;&#xFF0C;&#x5C31;&#x662F;&#x8BB2;&#x89E3;<strong>&#x6570;&#x636E;&#x5E27;</strong>&#x7684;&#x683C;&#x5F0F;&#x3002;&#x8BE6;&#x7EC6;&#x5B9A;&#x4E49;&#x53EF;&#x53C2;&#x8003; <a href="/external_links/8f23ec0857e45dc91c34807ab55e8659.html" target="blank" rel="noopener">RFC6455 5.2&#x8282;</a> &#x3002;</p>
<h3 id="1&#x3001;&#x6570;&#x636E;&#x5E27;&#x683C;&#x5F0F;&#x6982;&#x89C8;"><a href="#1&#x3001;&#x6570;&#x636E;&#x5E27;&#x683C;&#x5F0F;&#x6982;&#x89C8;" class="headerlink" title="1&#x3001;&#x6570;&#x636E;&#x5E27;&#x683C;&#x5F0F;&#x6982;&#x89C8;"></a>1&#x3001;&#x6570;&#x636E;&#x5E27;&#x683C;&#x5F0F;&#x6982;&#x89C8;</h3><p>&#x4E0B;&#x9762;&#x7ED9;&#x51FA;&#x4E86;WebSocket&#x6570;&#x636E;&#x5E27;&#x7684;&#x7EDF;&#x4E00;&#x683C;&#x5F0F;&#x3002;&#x719F;&#x6089;TCP/IP&#x534F;&#x8BAE;&#x7684;&#x540C;&#x5B66;&#x5BF9;&#x8FD9;&#x6837;&#x7684;&#x56FE;&#x5E94;&#x8BE5;&#x4E0D;&#x964C;&#x751F;&#x3002;</p>
<ol>
<li>&#x4ECE;&#x5DE6;&#x5230;&#x53F3;&#xFF0C;&#x5355;&#x4F4D;&#x662F;&#x6BD4;&#x7279;&#x3002;&#x6BD4;&#x5982;<code>FIN</code>&#x3001;<code>RSV1</code>&#x5404;&#x5360;&#x636E;1&#x6BD4;&#x7279;&#xFF0C;<code>opcode</code>&#x5360;&#x636E;4&#x6BD4;&#x7279;&#x3002;</li>
<li>&#x5185;&#x5BB9;&#x5305;&#x62EC;&#x4E86;&#x6807;&#x8BC6;&#x3001;&#x64CD;&#x4F5C;&#x4EE3;&#x7801;&#x3001;&#x63A9;&#x7801;&#x3001;&#x6570;&#x636E;&#x3001;&#x6570;&#x636E;&#x957F;&#x5EA6;&#x7B49;&#x3002;&#xFF08;&#x4E0B;&#x4E00;&#x5C0F;&#x8282;&#x4F1A;&#x5C55;&#x5F00;&#xFF09;</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">lua&#x590D;&#x5236;&#x4EE3;&#x7801;  0                   1                   2                   3</span><br><span class="line">  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span><br><span class="line"> +-+-+-+-+-------+-+-------------+-------------------------------+</span><br><span class="line"> |F|R|R|R| opcode|M| Payload len |    Extended payload length    |</span><br><span class="line"> |I|S|S|S|  (4)  |A|     (7)     |             (16/64)           |</span><br><span class="line"> |N|V|V|V|       |S|             |   (if payload len==126/127)   |</span><br><span class="line"> | |1|2|3|       |K|             |                               |</span><br><span class="line"> +-+-+-+-+-------+-+-------------+ - - - - - - - - - - - - - - - +</span><br><span class="line"> |     Extended payload length continued, if payload len == 127  |</span><br><span class="line"> + - - - - - - - - - - - - - - - +-------------------------------+</span><br><span class="line"> |                               |Masking-key, if MASK set to 1  |</span><br><span class="line"> +-------------------------------+-------------------------------+</span><br><span class="line"> | Masking-key (continued)       |          Payload Data         |</span><br><span class="line"> +-------------------------------- - - - - - - - - - - - - - - - +</span><br><span class="line"> :                     Payload Data continued ...                :</span><br><span class="line"> + - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +</span><br><span class="line"> |                     Payload Data continued ...                |</span><br><span class="line"> +---------------------------------------------------------------+</span><br></pre></td></tr></table></figure>

<h3 id="2&#x3001;&#x6570;&#x636E;&#x5E27;&#x683C;&#x5F0F;&#x8BE6;&#x89E3;"><a href="#2&#x3001;&#x6570;&#x636E;&#x5E27;&#x683C;&#x5F0F;&#x8BE6;&#x89E3;" class="headerlink" title="2&#x3001;&#x6570;&#x636E;&#x5E27;&#x683C;&#x5F0F;&#x8BE6;&#x89E3;"></a>2&#x3001;&#x6570;&#x636E;&#x5E27;&#x683C;&#x5F0F;&#x8BE6;&#x89E3;</h3><p>&#x9488;&#x5BF9;&#x524D;&#x9762;&#x7684;&#x683C;&#x5F0F;&#x6982;&#x89C8;&#x56FE;&#xFF0C;&#x8FD9;&#x91CC;&#x9010;&#x4E2A;&#x5B57;&#x6BB5;&#x8FDB;&#x884C;&#x8BB2;&#x89E3;&#xFF0C;&#x5982;&#x6709;&#x4E0D;&#x6E05;&#x695A;&#x4E4B;&#x5904;&#xFF0C;&#x53EF;&#x53C2;&#x8003;&#x534F;&#x8BAE;&#x89C4;&#x8303;&#xFF0C;&#x6216;&#x7559;&#x8A00;&#x4EA4;&#x6D41;&#x3002;</p>
<p><strong>FIN</strong>&#xFF1A;1&#x4E2A;&#x6BD4;&#x7279;&#x3002;</p>
<p>&#x5982;&#x679C;&#x662F;1&#xFF0C;&#x8868;&#x793A;&#x8FD9;&#x662F;&#x6D88;&#x606F;&#xFF08;message&#xFF09;&#x7684;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x5206;&#x7247;&#xFF08;fragment&#xFF09;&#xFF0C;&#x5982;&#x679C;&#x662F;0&#xFF0C;&#x8868;&#x793A;&#x4E0D;&#x662F;&#x662F;&#x6D88;&#x606F;&#xFF08;message&#xFF09;&#x7684;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x5206;&#x7247;&#xFF08;fragment&#xFF09;&#x3002;</p>
<p><strong>RSV1, RSV2, RSV3</strong>&#xFF1A;&#x5404;&#x5360;1&#x4E2A;&#x6BD4;&#x7279;&#x3002;</p>
<p>&#x4E00;&#x822C;&#x60C5;&#x51B5;&#x4E0B;&#x5168;&#x4E3A;0&#x3002;&#x5F53;&#x5BA2;&#x6237;&#x7AEF;&#x3001;&#x670D;&#x52A1;&#x7AEF;&#x534F;&#x5546;&#x91C7;&#x7528;WebSocket&#x6269;&#x5C55;&#x65F6;&#xFF0C;&#x8FD9;&#x4E09;&#x4E2A;&#x6807;&#x5FD7;&#x4F4D;&#x53EF;&#x4EE5;&#x975E;0&#xFF0C;&#x4E14;&#x503C;&#x7684;&#x542B;&#x4E49;&#x7531;&#x6269;&#x5C55;&#x8FDB;&#x884C;&#x5B9A;&#x4E49;&#x3002;&#x5982;&#x679C;&#x51FA;&#x73B0;&#x975E;&#x96F6;&#x7684;&#x503C;&#xFF0C;&#x4E14;&#x5E76;&#x6CA1;&#x6709;&#x91C7;&#x7528;WebSocket&#x6269;&#x5C55;&#xFF0C;&#x8FDE;&#x63A5;&#x51FA;&#x9519;&#x3002;</p>
<p><strong>Opcode</strong>: 4&#x4E2A;&#x6BD4;&#x7279;&#x3002;</p>
<p>&#x64CD;&#x4F5C;&#x4EE3;&#x7801;&#xFF0C;Opcode&#x7684;&#x503C;&#x51B3;&#x5B9A;&#x4E86;&#x5E94;&#x8BE5;&#x5982;&#x4F55;&#x89E3;&#x6790;&#x540E;&#x7EED;&#x7684;&#x6570;&#x636E;&#x8F7D;&#x8377;&#xFF08;data payload&#xFF09;&#x3002;&#x5982;&#x679C;&#x64CD;&#x4F5C;&#x4EE3;&#x7801;&#x662F;&#x4E0D;&#x8BA4;&#x8BC6;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x63A5;&#x6536;&#x7AEF;&#x5E94;&#x8BE5;&#x65AD;&#x5F00;&#x8FDE;&#x63A5;&#xFF08;fail the connection&#xFF09;&#x3002;&#x53EF;&#x9009;&#x7684;&#x64CD;&#x4F5C;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li>%x0&#xFF1A;&#x8868;&#x793A;&#x4E00;&#x4E2A;&#x5EF6;&#x7EED;&#x5E27;&#x3002;&#x5F53;Opcode&#x4E3A;0&#x65F6;&#xFF0C;&#x8868;&#x793A;&#x672C;&#x6B21;&#x6570;&#x636E;&#x4F20;&#x8F93;&#x91C7;&#x7528;&#x4E86;&#x6570;&#x636E;&#x5206;&#x7247;&#xFF0C;&#x5F53;&#x524D;&#x6536;&#x5230;&#x7684;&#x6570;&#x636E;&#x5E27;&#x4E3A;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5206;&#x7247;&#x3002;</li>
<li>%x1&#xFF1A;&#x8868;&#x793A;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x6587;&#x672C;&#x5E27;&#xFF08;frame&#xFF09;</li>
<li>%x2&#xFF1A;&#x8868;&#x793A;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x4E8C;&#x8FDB;&#x5236;&#x5E27;&#xFF08;frame&#xFF09;</li>
<li>%x3-7&#xFF1A;&#x4FDD;&#x7559;&#x7684;&#x64CD;&#x4F5C;&#x4EE3;&#x7801;&#xFF0C;&#x7528;&#x4E8E;&#x540E;&#x7EED;&#x5B9A;&#x4E49;&#x7684;&#x975E;&#x63A7;&#x5236;&#x5E27;&#x3002;</li>
<li>%x8&#xFF1A;&#x8868;&#x793A;&#x8FDE;&#x63A5;&#x65AD;&#x5F00;&#x3002;</li>
<li>%x9&#xFF1A;&#x8868;&#x793A;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;ping&#x64CD;&#x4F5C;&#x3002;</li>
<li>%xA&#xFF1A;&#x8868;&#x793A;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;pong&#x64CD;&#x4F5C;&#x3002;</li>
<li>%xB-F&#xFF1A;&#x4FDD;&#x7559;&#x7684;&#x64CD;&#x4F5C;&#x4EE3;&#x7801;&#xFF0C;&#x7528;&#x4E8E;&#x540E;&#x7EED;&#x5B9A;&#x4E49;&#x7684;&#x63A7;&#x5236;&#x5E27;&#x3002;</li>
</ul>
<p><strong>Mask</strong>: 1&#x4E2A;&#x6BD4;&#x7279;&#x3002;</p>
<p>&#x8868;&#x793A;&#x662F;&#x5426;&#x8981;&#x5BF9;&#x6570;&#x636E;&#x8F7D;&#x8377;&#x8FDB;&#x884C;&#x63A9;&#x7801;&#x64CD;&#x4F5C;&#x3002;&#x4ECE;&#x5BA2;&#x6237;&#x7AEF;&#x5411;&#x670D;&#x52A1;&#x7AEF;&#x53D1;&#x9001;&#x6570;&#x636E;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x5BF9;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x63A9;&#x7801;&#x64CD;&#x4F5C;&#xFF1B;&#x4ECE;&#x670D;&#x52A1;&#x7AEF;&#x5411;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x6570;&#x636E;&#x65F6;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x5BF9;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x63A9;&#x7801;&#x64CD;&#x4F5C;&#x3002;</p>
<p>&#x5982;&#x679C;&#x670D;&#x52A1;&#x7AEF;&#x63A5;&#x6536;&#x5230;&#x7684;&#x6570;&#x636E;&#x6CA1;&#x6709;&#x8FDB;&#x884C;&#x8FC7;&#x63A9;&#x7801;&#x64CD;&#x4F5C;&#xFF0C;&#x670D;&#x52A1;&#x7AEF;&#x9700;&#x8981;&#x65AD;&#x5F00;&#x8FDE;&#x63A5;&#x3002;</p>
<p>&#x5982;&#x679C;Mask&#x662F;1&#xFF0C;&#x90A3;&#x4E48;&#x5728;Masking-key&#x4E2D;&#x4F1A;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x63A9;&#x7801;&#x952E;&#xFF08;masking key&#xFF09;&#xFF0C;&#x5E76;&#x7528;&#x8FD9;&#x4E2A;&#x63A9;&#x7801;&#x952E;&#x6765;&#x5BF9;&#x6570;&#x636E;&#x8F7D;&#x8377;&#x8FDB;&#x884C;&#x53CD;&#x63A9;&#x7801;&#x3002;&#x6240;&#x6709;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x5230;&#x670D;&#x52A1;&#x7AEF;&#x7684;&#x6570;&#x636E;&#x5E27;&#xFF0C;Mask&#x90FD;&#x662F;1&#x3002;</p>
<p>&#x63A9;&#x7801;&#x7684;&#x7B97;&#x6CD5;&#x3001;&#x7528;&#x9014;&#x5728;&#x4E0B;&#x4E00;&#x5C0F;&#x8282;&#x8BB2;&#x89E3;&#x3002;</p>
<p><strong>Payload length</strong>&#xFF1A;&#x6570;&#x636E;&#x8F7D;&#x8377;&#x7684;&#x957F;&#x5EA6;&#xFF0C;&#x5355;&#x4F4D;&#x662F;&#x5B57;&#x8282;&#x3002;&#x4E3A;7&#x4F4D;&#xFF0C;&#x6216;7+16&#x4F4D;&#xFF0C;&#x6216;1+64&#x4F4D;&#x3002;</p>
<p>&#x5047;&#x8BBE;&#x6570;Payload length === x&#xFF0C;&#x5982;&#x679C;</p>
<ul>
<li>x&#x4E3A;0~126&#xFF1A;&#x6570;&#x636E;&#x7684;&#x957F;&#x5EA6;&#x4E3A;x&#x5B57;&#x8282;&#x3002;</li>
<li>x&#x4E3A;126&#xFF1A;&#x540E;&#x7EED;2&#x4E2A;&#x5B57;&#x8282;&#x4EE3;&#x8868;&#x4E00;&#x4E2A;16&#x4F4D;&#x7684;&#x65E0;&#x7B26;&#x53F7;&#x6574;&#x6570;&#xFF0C;&#x8BE5;&#x65E0;&#x7B26;&#x53F7;&#x6574;&#x6570;&#x7684;&#x503C;&#x4E3A;&#x6570;&#x636E;&#x7684;&#x957F;&#x5EA6;&#x3002;</li>
<li>x&#x4E3A;127&#xFF1A;&#x540E;&#x7EED;8&#x4E2A;&#x5B57;&#x8282;&#x4EE3;&#x8868;&#x4E00;&#x4E2A;64&#x4F4D;&#x7684;&#x65E0;&#x7B26;&#x53F7;&#x6574;&#x6570;&#xFF08;&#x6700;&#x9AD8;&#x4F4D;&#x4E3A;0&#xFF09;&#xFF0C;&#x8BE5;&#x65E0;&#x7B26;&#x53F7;&#x6574;&#x6570;&#x7684;&#x503C;&#x4E3A;&#x6570;&#x636E;&#x7684;&#x957F;&#x5EA6;&#x3002;</li>
</ul>
<p>&#x6B64;&#x5916;&#xFF0C;&#x5982;&#x679C;payload length&#x5360;&#x7528;&#x4E86;&#x591A;&#x4E2A;&#x5B57;&#x8282;&#x7684;&#x8BDD;&#xFF0C;payload length&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x8868;&#x8FBE;&#x91C7;&#x7528;&#x7F51;&#x7EDC;&#x5E8F;&#xFF08;big endian&#xFF0C;&#x91CD;&#x8981;&#x7684;&#x4F4D;&#x5728;&#x524D;&#xFF09;&#x3002;</p>
<p><strong>Masking-key</strong>&#xFF1A;0&#x6216;4&#x5B57;&#x8282;&#xFF08;32&#x4F4D;&#xFF09;</p>
<p>&#x6240;&#x6709;&#x4ECE;&#x5BA2;&#x6237;&#x7AEF;&#x4F20;&#x9001;&#x5230;&#x670D;&#x52A1;&#x7AEF;&#x7684;&#x6570;&#x636E;&#x5E27;&#xFF0C;&#x6570;&#x636E;&#x8F7D;&#x8377;&#x90FD;&#x8FDB;&#x884C;&#x4E86;&#x63A9;&#x7801;&#x64CD;&#x4F5C;&#xFF0C;Mask&#x4E3A;1&#xFF0C;&#x4E14;&#x643A;&#x5E26;&#x4E86;4&#x5B57;&#x8282;&#x7684;Masking-key&#x3002;&#x5982;&#x679C;Mask&#x4E3A;0&#xFF0C;&#x5219;&#x6CA1;&#x6709;Masking-key&#x3002;</p>
<p>&#x5907;&#x6CE8;&#xFF1A;&#x8F7D;&#x8377;&#x6570;&#x636E;&#x7684;&#x957F;&#x5EA6;&#xFF0C;&#x4E0D;&#x5305;&#x62EC;mask key&#x7684;&#x957F;&#x5EA6;&#x3002;</p>
<p><strong>Payload data</strong>&#xFF1A;(x+y) &#x5B57;&#x8282;</p>
<p>&#x8F7D;&#x8377;&#x6570;&#x636E;&#xFF1A;&#x5305;&#x62EC;&#x4E86;&#x6269;&#x5C55;&#x6570;&#x636E;&#x3001;&#x5E94;&#x7528;&#x6570;&#x636E;&#x3002;&#x5176;&#x4E2D;&#xFF0C;&#x6269;&#x5C55;&#x6570;&#x636E;x&#x5B57;&#x8282;&#xFF0C;&#x5E94;&#x7528;&#x6570;&#x636E;y&#x5B57;&#x8282;&#x3002;</p>
<p>&#x6269;&#x5C55;&#x6570;&#x636E;&#xFF1A;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x534F;&#x5546;&#x4F7F;&#x7528;&#x6269;&#x5C55;&#x7684;&#x8BDD;&#xFF0C;&#x6269;&#x5C55;&#x6570;&#x636E;&#x6570;&#x636E;&#x4E3A;0&#x5B57;&#x8282;&#x3002;&#x6240;&#x6709;&#x7684;&#x6269;&#x5C55;&#x90FD;&#x5FC5;&#x987B;&#x58F0;&#x660E;&#x6269;&#x5C55;&#x6570;&#x636E;&#x7684;&#x957F;&#x5EA6;&#xFF0C;&#x6216;&#x8005;&#x53EF;&#x4EE5;&#x5982;&#x4F55;&#x8BA1;&#x7B97;&#x51FA;&#x6269;&#x5C55;&#x6570;&#x636E;&#x7684;&#x957F;&#x5EA6;&#x3002;&#x6B64;&#x5916;&#xFF0C;&#x6269;&#x5C55;&#x5982;&#x4F55;&#x4F7F;&#x7528;&#x5FC5;&#x987B;&#x5728;&#x63E1;&#x624B;&#x9636;&#x6BB5;&#x5C31;&#x534F;&#x5546;&#x597D;&#x3002;&#x5982;&#x679C;&#x6269;&#x5C55;&#x6570;&#x636E;&#x5B58;&#x5728;&#xFF0C;&#x90A3;&#x4E48;&#x8F7D;&#x8377;&#x6570;&#x636E;&#x957F;&#x5EA6;&#x5FC5;&#x987B;&#x5C06;&#x6269;&#x5C55;&#x6570;&#x636E;&#x7684;&#x957F;&#x5EA6;&#x5305;&#x542B;&#x5728;&#x5185;&#x3002;</p>
<p>&#x5E94;&#x7528;&#x6570;&#x636E;&#xFF1A;&#x4EFB;&#x610F;&#x7684;&#x5E94;&#x7528;&#x6570;&#x636E;&#xFF0C;&#x5728;&#x6269;&#x5C55;&#x6570;&#x636E;&#x4E4B;&#x540E;&#xFF08;&#x5982;&#x679C;&#x5B58;&#x5728;&#x6269;&#x5C55;&#x6570;&#x636E;&#xFF09;&#xFF0C;&#x5360;&#x636E;&#x4E86;&#x6570;&#x636E;&#x5E27;&#x5269;&#x4F59;&#x7684;&#x4F4D;&#x7F6E;&#x3002;&#x8F7D;&#x8377;&#x6570;&#x636E;&#x957F;&#x5EA6; &#x51CF;&#x53BB; &#x6269;&#x5C55;&#x6570;&#x636E;&#x957F;&#x5EA6;&#xFF0C;&#x5C31;&#x5F97;&#x5230;&#x5E94;&#x7528;&#x6570;&#x636E;&#x7684;&#x957F;&#x5EA6;&#x3002;</p>
<h3 id="3&#x3001;&#x63A9;&#x7801;&#x7B97;&#x6CD5;"><a href="#3&#x3001;&#x63A9;&#x7801;&#x7B97;&#x6CD5;" class="headerlink" title="3&#x3001;&#x63A9;&#x7801;&#x7B97;&#x6CD5;"></a>3&#x3001;&#x63A9;&#x7801;&#x7B97;&#x6CD5;</h3><p>&#x63A9;&#x7801;&#x952E;&#xFF08;Masking-key&#xFF09;&#x662F;&#x7531;&#x5BA2;&#x6237;&#x7AEF;&#x6311;&#x9009;&#x51FA;&#x6765;&#x7684;32&#x4F4D;&#x7684;&#x968F;&#x673A;&#x6570;&#x3002;&#x63A9;&#x7801;&#x64CD;&#x4F5C;&#x4E0D;&#x4F1A;&#x5F71;&#x54CD;&#x6570;&#x636E;&#x8F7D;&#x8377;&#x7684;&#x957F;&#x5EA6;&#x3002;&#x63A9;&#x7801;&#x3001;&#x53CD;&#x63A9;&#x7801;&#x64CD;&#x4F5C;&#x90FD;&#x91C7;&#x7528;&#x5982;&#x4E0B;&#x7B97;&#x6CD5;&#xFF1A;</p>
<p>&#x9996;&#x5148;&#xFF0C;&#x5047;&#x8BBE;&#xFF1A;</p>
<ul>
<li>original-octet-i&#xFF1A;&#x4E3A;&#x539F;&#x59CB;&#x6570;&#x636E;&#x7684;&#x7B2C;i&#x5B57;&#x8282;&#x3002;</li>
<li>transformed-octet-i&#xFF1A;&#x4E3A;&#x8F6C;&#x6362;&#x540E;&#x7684;&#x6570;&#x636E;&#x7684;&#x7B2C;i&#x5B57;&#x8282;&#x3002;</li>
<li>j&#xFF1A;&#x4E3A;<code>i mod 4</code>&#x7684;&#x7ED3;&#x679C;&#x3002;</li>
<li>masking-key-octet-j&#xFF1A;&#x4E3A;mask key&#x7B2C;j&#x5B57;&#x8282;&#x3002;</li>
</ul>
<p>&#x7B97;&#x6CD5;&#x63CF;&#x8FF0;&#x4E3A;&#xFF1A; original-octet-i &#x4E0E; masking-key-octet-j &#x5F02;&#x6216;&#x540E;&#xFF0C;&#x5F97;&#x5230; transformed-octet-i&#x3002;</p>
<blockquote>
<p>j = i MOD 4<br>transformed-octet-i = original-octet-i XOR masking-key-octet-j</p>
</blockquote>
<h2 id="&#x516D;&#x3001;&#x6570;&#x636E;&#x4F20;&#x9012;"><a href="#&#x516D;&#x3001;&#x6570;&#x636E;&#x4F20;&#x9012;" class="headerlink" title="&#x516D;&#x3001;&#x6570;&#x636E;&#x4F20;&#x9012;"></a>&#x516D;&#x3001;&#x6570;&#x636E;&#x4F20;&#x9012;</h2><p>&#x4E00;&#x65E6;WebSocket&#x5BA2;&#x6237;&#x7AEF;&#x3001;&#x670D;&#x52A1;&#x7AEF;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x540E;&#xFF0C;&#x540E;&#x7EED;&#x7684;&#x64CD;&#x4F5C;&#x90FD;&#x662F;&#x57FA;&#x4E8E;&#x6570;&#x636E;&#x5E27;&#x7684;&#x4F20;&#x9012;&#x3002;</p>
<p>WebSocket&#x6839;&#x636E;<code>opcode</code>&#x6765;&#x533A;&#x5206;&#x64CD;&#x4F5C;&#x7684;&#x7C7B;&#x578B;&#x3002;&#x6BD4;&#x5982;<code>0x8</code>&#x8868;&#x793A;&#x65AD;&#x5F00;&#x8FDE;&#x63A5;&#xFF0C;<code>0x0</code>-<code>0x2</code>&#x8868;&#x793A;&#x6570;&#x636E;&#x4EA4;&#x4E92;&#x3002;</p>
<h3 id="1&#x3001;&#x6570;&#x636E;&#x5206;&#x7247;"><a href="#1&#x3001;&#x6570;&#x636E;&#x5206;&#x7247;" class="headerlink" title="1&#x3001;&#x6570;&#x636E;&#x5206;&#x7247;"></a>1&#x3001;&#x6570;&#x636E;&#x5206;&#x7247;</h3><p>WebSocket&#x7684;&#x6BCF;&#x6761;&#x6D88;&#x606F;&#x53EF;&#x80FD;&#x88AB;&#x5207;&#x5206;&#x6210;&#x591A;&#x4E2A;&#x6570;&#x636E;&#x5E27;&#x3002;&#x5F53;WebSocket&#x7684;&#x63A5;&#x6536;&#x65B9;&#x6536;&#x5230;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5E27;&#x65F6;&#xFF0C;&#x4F1A;&#x6839;&#x636E;<code>FIN</code>&#x7684;&#x503C;&#x6765;&#x5224;&#x65AD;&#xFF0C;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x6536;&#x5230;&#x6D88;&#x606F;&#x7684;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5E27;&#x3002;</p>
<p>FIN=1&#x8868;&#x793A;&#x5F53;&#x524D;&#x6570;&#x636E;&#x5E27;&#x4E3A;&#x6D88;&#x606F;&#x7684;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5E27;&#xFF0C;&#x6B64;&#x65F6;&#x63A5;&#x6536;&#x65B9;&#x5DF2;&#x7ECF;&#x6536;&#x5230;&#x5B8C;&#x6574;&#x7684;&#x6D88;&#x606F;&#xFF0C;&#x53EF;&#x4EE5;&#x5BF9;&#x6D88;&#x606F;&#x8FDB;&#x884C;&#x5904;&#x7406;&#x3002;FIN=0&#xFF0C;&#x5219;&#x63A5;&#x6536;&#x65B9;&#x8FD8;&#x9700;&#x8981;&#x7EE7;&#x7EED;&#x76D1;&#x542C;&#x63A5;&#x6536;&#x5176;&#x4F59;&#x7684;&#x6570;&#x636E;&#x5E27;&#x3002;</p>
<p>&#x6B64;&#x5916;&#xFF0C;<code>opcode</code>&#x5728;&#x6570;&#x636E;&#x4EA4;&#x6362;&#x7684;&#x573A;&#x666F;&#x4E0B;&#xFF0C;&#x8868;&#x793A;&#x7684;&#x662F;&#x6570;&#x636E;&#x7684;&#x7C7B;&#x578B;&#x3002;<code>0x01</code>&#x8868;&#x793A;&#x6587;&#x672C;&#xFF0C;<code>0x02</code>&#x8868;&#x793A;&#x4E8C;&#x8FDB;&#x5236;&#x3002;&#x800C;<code>0x00</code>&#x6BD4;&#x8F83;&#x7279;&#x6B8A;&#xFF0C;&#x8868;&#x793A;&#x5EF6;&#x7EED;&#x5E27;&#xFF08;continuation frame&#xFF09;&#xFF0C;&#x987E;&#x540D;&#x601D;&#x4E49;&#xFF0C;&#x5C31;&#x662F;&#x5B8C;&#x6574;&#x6D88;&#x606F;&#x5BF9;&#x5E94;&#x7684;&#x6570;&#x636E;&#x5E27;&#x8FD8;&#x6CA1;&#x63A5;&#x6536;&#x5B8C;&#x3002;</p>
<h3 id="2&#x3001;&#x6570;&#x636E;&#x5206;&#x7247;&#x4F8B;&#x5B50;"><a href="#2&#x3001;&#x6570;&#x636E;&#x5206;&#x7247;&#x4F8B;&#x5B50;" class="headerlink" title="2&#x3001;&#x6570;&#x636E;&#x5206;&#x7247;&#x4F8B;&#x5B50;"></a>2&#x3001;&#x6570;&#x636E;&#x5206;&#x7247;&#x4F8B;&#x5B50;</h3><p>&#x76F4;&#x63A5;&#x770B;&#x4F8B;&#x5B50;&#x66F4;&#x5F62;&#x8C61;&#x4E9B;&#x3002;&#x4E0B;&#x9762;&#x4F8B;&#x5B50;&#x6765;&#x81EA;<a href="/external_links/2bc9d59d048535cc186ef53462cf471e.html" target="blank" rel="noopener">MDN</a>&#xFF0C;&#x53EF;&#x4EE5;&#x5F88;&#x597D;&#x5730;&#x6F14;&#x793A;&#x6570;&#x636E;&#x7684;&#x5206;&#x7247;&#x3002;&#x5BA2;&#x6237;&#x7AEF;&#x5411;&#x670D;&#x52A1;&#x7AEF;&#x4E24;&#x6B21;&#x53D1;&#x9001;&#x6D88;&#x606F;&#xFF0C;&#x670D;&#x52A1;&#x7AEF;&#x6536;&#x5230;&#x6D88;&#x606F;&#x540E;&#x56DE;&#x5E94;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x8FD9;&#x91CC;&#x4E3B;&#x8981;&#x770B;&#x5BA2;&#x6237;&#x7AEF;&#x5F80;&#x670D;&#x52A1;&#x7AEF;&#x53D1;&#x9001;&#x7684;&#x6D88;&#x606F;&#x3002;</p>
<p><strong>&#x7B2C;&#x4E00;&#x6761;&#x6D88;&#x606F;</strong></p>
<p>FIN=1, &#x8868;&#x793A;&#x662F;&#x5F53;&#x524D;&#x6D88;&#x606F;&#x7684;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5E27;&#x3002;&#x670D;&#x52A1;&#x7AEF;&#x6536;&#x5230;&#x5F53;&#x524D;&#x6570;&#x636E;&#x5E27;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x5904;&#x7406;&#x6D88;&#x606F;&#x3002;opcode=0x1&#xFF0C;&#x8868;&#x793A;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x7684;&#x662F;&#x6587;&#x672C;&#x7C7B;&#x578B;&#x3002;</p>
<p><strong>&#x7B2C;&#x4E8C;&#x6761;&#x6D88;&#x606F;</strong></p>
<ol>
<li>FIN=0&#xFF0C;opcode=0x1&#xFF0C;&#x8868;&#x793A;&#x53D1;&#x9001;&#x7684;&#x662F;&#x6587;&#x672C;&#x7C7B;&#x578B;&#xFF0C;&#x4E14;&#x6D88;&#x606F;&#x8FD8;&#x6CA1;&#x53D1;&#x9001;&#x5B8C;&#x6210;&#xFF0C;&#x8FD8;&#x6709;&#x540E;&#x7EED;&#x7684;&#x6570;&#x636E;&#x5E27;&#x3002;</li>
<li>FIN=0&#xFF0C;opcode=0x0&#xFF0C;&#x8868;&#x793A;&#x6D88;&#x606F;&#x8FD8;&#x6CA1;&#x53D1;&#x9001;&#x5B8C;&#x6210;&#xFF0C;&#x8FD8;&#x6709;&#x540E;&#x7EED;&#x7684;&#x6570;&#x636E;&#x5E27;&#xFF0C;&#x5F53;&#x524D;&#x7684;&#x6570;&#x636E;&#x5E27;&#x9700;&#x8981;&#x63A5;&#x5728;&#x4E0A;&#x4E00;&#x6761;&#x6570;&#x636E;&#x5E27;&#x4E4B;&#x540E;&#x3002;</li>
<li>FIN=1&#xFF0C;opcode=0x0&#xFF0C;&#x8868;&#x793A;&#x6D88;&#x606F;&#x5DF2;&#x7ECF;&#x53D1;&#x9001;&#x5B8C;&#x6210;&#xFF0C;&#x6CA1;&#x6709;&#x540E;&#x7EED;&#x7684;&#x6570;&#x636E;&#x5E27;&#xFF0C;&#x5F53;&#x524D;&#x7684;&#x6570;&#x636E;&#x5E27;&#x9700;&#x8981;&#x63A5;&#x5728;&#x4E0A;&#x4E00;&#x6761;&#x6570;&#x636E;&#x5E27;&#x4E4B;&#x540E;&#x3002;&#x670D;&#x52A1;&#x7AEF;&#x53EF;&#x4EE5;&#x5C06;&#x5173;&#x8054;&#x7684;&#x6570;&#x636E;&#x5E27;&#x7EC4;&#x88C5;&#x6210;&#x5B8C;&#x6574;&#x7684;&#x6D88;&#x606F;&#x3002;</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">arduino&#x590D;&#x5236;&#x4EE3;&#x7801;Client: FIN=1, opcode=0x1, msg=&quot;hello&quot;</span><br><span class="line">Server: (process complete message immediately) Hi.</span><br><span class="line">Client: FIN=0, opcode=0x1, msg=&quot;and a&quot;</span><br><span class="line">Server: (listening, new message containing text started)</span><br><span class="line">Client: FIN=0, opcode=0x0, msg=&quot;happy new&quot;</span><br><span class="line">Server: (listening, payload concatenated to previous message)</span><br><span class="line">Client: FIN=1, opcode=0x0, msg=&quot;year!&quot;</span><br><span class="line">Server: (process complete message) Happy new year to you too!</span><br></pre></td></tr></table></figure>

<h2 id="&#x4E03;&#x3001;&#x8FDE;&#x63A5;&#x4FDD;&#x6301;-&#x5FC3;&#x8DF3;"><a href="#&#x4E03;&#x3001;&#x8FDE;&#x63A5;&#x4FDD;&#x6301;-&#x5FC3;&#x8DF3;" class="headerlink" title="&#x4E03;&#x3001;&#x8FDE;&#x63A5;&#x4FDD;&#x6301;+&#x5FC3;&#x8DF3;"></a>&#x4E03;&#x3001;&#x8FDE;&#x63A5;&#x4FDD;&#x6301;+&#x5FC3;&#x8DF3;</h2><p>WebSocket&#x4E3A;&#x4E86;&#x4FDD;&#x6301;&#x5BA2;&#x6237;&#x7AEF;&#x3001;&#x670D;&#x52A1;&#x7AEF;&#x7684;&#x5B9E;&#x65F6;&#x53CC;&#x5411;&#x901A;&#x4FE1;&#xFF0C;&#x9700;&#x8981;&#x786E;&#x4FDD;&#x5BA2;&#x6237;&#x7AEF;&#x3001;&#x670D;&#x52A1;&#x7AEF;&#x4E4B;&#x95F4;&#x7684;TCP&#x901A;&#x9053;&#x4FDD;&#x6301;&#x8FDE;&#x63A5;&#x6CA1;&#x6709;&#x65AD;&#x5F00;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x5BF9;&#x4E8E;&#x957F;&#x65F6;&#x95F4;&#x6CA1;&#x6709;&#x6570;&#x636E;&#x5F80;&#x6765;&#x7684;&#x8FDE;&#x63A5;&#xFF0C;&#x5982;&#x679C;&#x4F9D;&#x65E7;&#x957F;&#x65F6;&#x95F4;&#x4FDD;&#x6301;&#x7740;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x6D6A;&#x8D39;&#x5305;&#x62EC;&#x7684;&#x8FDE;&#x63A5;&#x8D44;&#x6E90;&#x3002;</p>
<p>&#x4F46;&#x4E0D;&#x6392;&#x9664;&#x6709;&#x4E9B;&#x573A;&#x666F;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x3001;&#x670D;&#x52A1;&#x7AEF;&#x867D;&#x7136;&#x957F;&#x65F6;&#x95F4;&#x6CA1;&#x6709;&#x6570;&#x636E;&#x5F80;&#x6765;&#xFF0C;&#x4F46;&#x4ECD;&#x9700;&#x8981;&#x4FDD;&#x6301;&#x8FDE;&#x63A5;&#x3002;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#xFF0C;&#x53EF;&#x4EE5;&#x91C7;&#x7528;&#x5FC3;&#x8DF3;&#x6765;&#x5B9E;&#x73B0;&#x3002;</p>
<ul>
<li>&#x53D1;&#x9001;&#x65B9;-&gt;&#x63A5;&#x6536;&#x65B9;&#xFF1A;ping</li>
<li>&#x63A5;&#x6536;&#x65B9;-&gt;&#x53D1;&#x9001;&#x65B9;&#xFF1A;pong</li>
</ul>
<p>ping&#x3001;pong&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x5BF9;&#x5E94;&#x7684;&#x662F;WebSocket&#x7684;&#x4E24;&#x4E2A;&#x63A7;&#x5236;&#x5E27;&#xFF0C;<code>opcode</code>&#x5206;&#x522B;&#x662F;<code>0x9</code>&#x3001;<code>0xA</code>&#x3002;</p>
<p>&#x4E3E;&#x4F8B;&#xFF0C;WebSocket&#x670D;&#x52A1;&#x7AEF;&#x5411;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;ping&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x5982;&#x4E0B;&#x4EE3;&#x7801;&#xFF08;&#x91C7;&#x7528;<code>ws</code>&#x6A21;&#x5757;&#xFF09;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javascript&#x590D;&#x5236;&#x4EE3;&#x7801;ws.ping(&apos;&apos;, false, true);</span><br></pre></td></tr></table></figure>

<h2 id="&#x516B;&#x3001;Sec-WebSocket-Key-Accept&#x7684;&#x4F5C;&#x7528;"><a href="#&#x516B;&#x3001;Sec-WebSocket-Key-Accept&#x7684;&#x4F5C;&#x7528;" class="headerlink" title="&#x516B;&#x3001;Sec-WebSocket-Key/Accept&#x7684;&#x4F5C;&#x7528;"></a>&#x516B;&#x3001;Sec-WebSocket-Key/Accept&#x7684;&#x4F5C;&#x7528;</h2><p>&#x524D;&#x9762;&#x63D0;&#x5230;&#x4E86;&#xFF0C;<code>Sec-WebSocket-Key/Sec-WebSocket-Accept</code>&#x5728;&#x4E3B;&#x8981;&#x4F5C;&#x7528;&#x5728;&#x4E8E;&#x63D0;&#x4F9B;&#x57FA;&#x7840;&#x7684;&#x9632;&#x62A4;&#xFF0C;&#x51CF;&#x5C11;&#x6076;&#x610F;&#x8FDE;&#x63A5;&#x3001;&#x610F;&#x5916;&#x8FDE;&#x63A5;&#x3002;</p>
<p>&#x4F5C;&#x7528;&#x5927;&#x81F4;&#x5F52;&#x7EB3;&#x5982;&#x4E0B;&#xFF1A;</p>
<ol>
<li>&#x907F;&#x514D;&#x670D;&#x52A1;&#x7AEF;&#x6536;&#x5230;&#x975E;&#x6CD5;&#x7684;websocket&#x8FDE;&#x63A5;&#xFF08;&#x6BD4;&#x5982;http&#x5BA2;&#x6237;&#x7AEF;&#x4E0D;&#x5C0F;&#x5FC3;&#x8BF7;&#x6C42;&#x8FDE;&#x63A5;websocket&#x670D;&#x52A1;&#xFF0C;&#x6B64;&#x65F6;&#x670D;&#x52A1;&#x7AEF;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x62D2;&#x7EDD;&#x8FDE;&#x63A5;&#xFF09;</li>
<li>&#x786E;&#x4FDD;&#x670D;&#x52A1;&#x7AEF;&#x7406;&#x89E3;websocket&#x8FDE;&#x63A5;&#x3002;&#x56E0;&#x4E3A;ws&#x63E1;&#x624B;&#x9636;&#x6BB5;&#x91C7;&#x7528;&#x7684;&#x662F;http&#x534F;&#x8BAE;&#xFF0C;&#x56E0;&#x6B64;&#x53EF;&#x80FD;ws&#x8FDE;&#x63A5;&#x662F;&#x88AB;&#x4E00;&#x4E2A;http&#x670D;&#x52A1;&#x5668;&#x5904;&#x7406;&#x5E76;&#x8FD4;&#x56DE;&#x7684;&#xFF0C;&#x6B64;&#x65F6;&#x5BA2;&#x6237;&#x7AEF;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;Sec-WebSocket-Key&#x6765;&#x786E;&#x4FDD;&#x670D;&#x52A1;&#x7AEF;&#x8BA4;&#x8BC6;ws&#x534F;&#x8BAE;&#x3002;&#xFF08;&#x5E76;&#x975E;&#x767E;&#x5206;&#x767E;&#x4FDD;&#x9669;&#xFF0C;&#x6BD4;&#x5982;&#x603B;&#x662F;&#x5B58;&#x5728;&#x90A3;&#x4E48;&#x4E9B;&#x65E0;&#x804A;&#x7684;http&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x5149;&#x5904;&#x7406;Sec-WebSocket-Key&#xFF0C;&#x4F46;&#x5E76;&#x6CA1;&#x6709;&#x5B9E;&#x73B0;ws&#x534F;&#x8BAE;&#x3002;&#x3002;&#x3002;&#xFF09;</li>
<li>&#x7528;&#x6D4F;&#x89C8;&#x5668;&#x91CC;&#x53D1;&#x8D77;ajax&#x8BF7;&#x6C42;&#xFF0C;&#x8BBE;&#x7F6E;header&#x65F6;&#xFF0C;Sec-WebSocket-Key&#x4EE5;&#x53CA;&#x5176;&#x4ED6;&#x76F8;&#x5173;&#x7684;header&#x662F;&#x88AB;&#x7981;&#x6B62;&#x7684;&#x3002;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x907F;&#x514D;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;ajax&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x610F;&#x5916;&#x8BF7;&#x6C42;&#x534F;&#x8BAE;&#x5347;&#x7EA7;&#xFF08;websocket upgrade&#xFF09;</li>
<li>&#x53EF;&#x4EE5;&#x9632;&#x6B62;&#x53CD;&#x5411;&#x4EE3;&#x7406;&#xFF08;&#x4E0D;&#x7406;&#x89E3;ws&#x534F;&#x8BAE;&#xFF09;&#x8FD4;&#x56DE;&#x9519;&#x8BEF;&#x7684;&#x6570;&#x636E;&#x3002;&#x6BD4;&#x5982;&#x53CD;&#x5411;&#x4EE3;&#x7406;&#x524D;&#x540E;&#x6536;&#x5230;&#x4E24;&#x6B21;ws&#x8FDE;&#x63A5;&#x7684;&#x5347;&#x7EA7;&#x8BF7;&#x6C42;&#xFF0C;&#x53CD;&#x5411;&#x4EE3;&#x7406;&#x628A;&#x7B2C;&#x4E00;&#x6B21;&#x8BF7;&#x6C42;&#x7684;&#x8FD4;&#x56DE;&#x7ED9;cache&#x4F4F;&#xFF0C;&#x7136;&#x540E;&#x7B2C;&#x4E8C;&#x6B21;&#x8BF7;&#x6C42;&#x5230;&#x6765;&#x65F6;&#x76F4;&#x63A5;&#x628A;cache&#x4F4F;&#x7684;&#x8BF7;&#x6C42;&#x7ED9;&#x8FD4;&#x56DE;&#xFF08;&#x65E0;&#x610F;&#x4E49;&#x7684;&#x8FD4;&#x56DE;&#xFF09;&#x3002;</li>
<li>Sec-WebSocket-Key&#x4E3B;&#x8981;&#x76EE;&#x7684;&#x5E76;&#x4E0D;&#x662F;&#x786E;&#x4FDD;&#x6570;&#x636E;&#x7684;&#x5B89;&#x5168;&#x6027;&#xFF0C;&#x56E0;&#x4E3A;Sec-WebSocket-Key&#x3001;Sec-WebSocket-Accept&#x7684;&#x8F6C;&#x6362;&#x8BA1;&#x7B97;&#x516C;&#x5F0F;&#x662F;&#x516C;&#x5F00;&#x7684;&#xFF0C;&#x800C;&#x4E14;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x6700;&#x4E3B;&#x8981;&#x7684;&#x4F5C;&#x7528;&#x662F;&#x9884;&#x9632;&#x4E00;&#x4E9B;&#x5E38;&#x89C1;&#x7684;&#x610F;&#x5916;&#x60C5;&#x51B5;&#xFF08;&#x975E;&#x6545;&#x610F;&#x7684;&#xFF09;&#x3002;</li>
</ol>
<blockquote>
<p>&#x5F3A;&#x8C03;&#xFF1A;Sec-WebSocket-Key/Sec-WebSocket-Accept &#x7684;&#x6362;&#x7B97;&#xFF0C;&#x53EA;&#x80FD;&#x5E26;&#x6765;&#x57FA;&#x672C;&#x7684;&#x4FDD;&#x969C;&#xFF0C;&#x4F46;&#x8FDE;&#x63A5;&#x662F;&#x5426;&#x5B89;&#x5168;&#x3001;&#x6570;&#x636E;&#x662F;&#x5426;&#x5B89;&#x5168;&#x3001;&#x5BA2;&#x6237;&#x7AEF;/&#x670D;&#x52A1;&#x7AEF;&#x662F;&#x5426;&#x5408;&#x6CD5;&#x7684; ws&#x5BA2;&#x6237;&#x7AEF;&#x3001;ws&#x670D;&#x52A1;&#x7AEF;&#xFF0C;&#x5176;&#x5B9E;&#x5E76;&#x6CA1;&#x6709;&#x5B9E;&#x9645;&#x6027;&#x7684;&#x4FDD;&#x8BC1;&#x3002;</p>
</blockquote>
<h2 id="&#x4E5D;&#x3001;&#x6570;&#x636E;&#x63A9;&#x7801;&#x7684;&#x4F5C;&#x7528;"><a href="#&#x4E5D;&#x3001;&#x6570;&#x636E;&#x63A9;&#x7801;&#x7684;&#x4F5C;&#x7528;" class="headerlink" title="&#x4E5D;&#x3001;&#x6570;&#x636E;&#x63A9;&#x7801;&#x7684;&#x4F5C;&#x7528;"></a>&#x4E5D;&#x3001;&#x6570;&#x636E;&#x63A9;&#x7801;&#x7684;&#x4F5C;&#x7528;</h2><p>WebSocket&#x534F;&#x8BAE;&#x4E2D;&#xFF0C;&#x6570;&#x636E;&#x63A9;&#x7801;&#x7684;&#x4F5C;&#x7528;&#x662F;&#x589E;&#x5F3A;&#x534F;&#x8BAE;&#x7684;&#x5B89;&#x5168;&#x6027;&#x3002;&#x4F46;&#x6570;&#x636E;&#x63A9;&#x7801;&#x5E76;&#x4E0D;&#x662F;&#x4E3A;&#x4E86;&#x4FDD;&#x62A4;&#x6570;&#x636E;&#x672C;&#x8EAB;&#xFF0C;&#x56E0;&#x4E3A;&#x7B97;&#x6CD5;&#x672C;&#x8EAB;&#x662F;&#x516C;&#x5F00;&#x7684;&#xFF0C;&#x8FD0;&#x7B97;&#x4E5F;&#x4E0D;&#x590D;&#x6742;&#x3002;&#x9664;&#x4E86;&#x52A0;&#x5BC6;&#x901A;&#x9053;&#x672C;&#x8EAB;&#xFF0C;&#x4F3C;&#x4E4E;&#x6CA1;&#x6709;&#x592A;&#x591A;&#x6709;&#x6548;&#x7684;&#x4FDD;&#x62A4;&#x901A;&#x4FE1;&#x5B89;&#x5168;&#x7684;&#x529E;&#x6CD5;&#x3002;</p>
<p>&#x90A3;&#x4E48;&#x4E3A;&#x4EC0;&#x4E48;&#x8FD8;&#x8981;&#x5F15;&#x5165;&#x63A9;&#x7801;&#x8BA1;&#x7B97;&#x5462;&#xFF0C;&#x9664;&#x4E86;&#x589E;&#x52A0;&#x8BA1;&#x7B97;&#x673A;&#x5668;&#x7684;&#x8FD0;&#x7B97;&#x91CF;&#x5916;&#x4F3C;&#x4E4E;&#x5E76;&#x6CA1;&#x6709;&#x592A;&#x591A;&#x7684;&#x6536;&#x76CA;&#xFF08;&#x8FD9;&#x4E5F;&#x662F;&#x4E0D;&#x5C11;&#x540C;&#x5B66;&#x7591;&#x60D1;&#x7684;&#x70B9;&#xFF09;&#x3002;</p>
<p>&#x7B54;&#x6848;&#x8FD8;&#x662F;&#x4E24;&#x4E2A;&#x5B57;&#xFF1A;<strong>&#x5B89;&#x5168;</strong>&#x3002;&#x4F46;&#x5E76;&#x4E0D;&#x662F;&#x4E3A;&#x4E86;&#x9632;&#x6B62;&#x6570;&#x636E;&#x6CC4;&#x5BC6;&#xFF0C;&#x800C;&#x662F;&#x4E3A;&#x4E86;&#x9632;&#x6B62;&#x65E9;&#x671F;&#x7248;&#x672C;&#x7684;&#x534F;&#x8BAE;&#x4E2D;&#x5B58;&#x5728;&#x7684;&#x4EE3;&#x7406;&#x7F13;&#x5B58;&#x6C61;&#x67D3;&#x653B;&#x51FB;&#xFF08;proxy cache poisoning attacks&#xFF09;&#x7B49;&#x95EE;&#x9898;&#x3002;</p>
<h3 id="1&#x3001;&#x4EE3;&#x7406;&#x7F13;&#x5B58;&#x6C61;&#x67D3;&#x653B;&#x51FB;"><a href="#1&#x3001;&#x4EE3;&#x7406;&#x7F13;&#x5B58;&#x6C61;&#x67D3;&#x653B;&#x51FB;" class="headerlink" title="1&#x3001;&#x4EE3;&#x7406;&#x7F13;&#x5B58;&#x6C61;&#x67D3;&#x653B;&#x51FB;"></a>1&#x3001;&#x4EE3;&#x7406;&#x7F13;&#x5B58;&#x6C61;&#x67D3;&#x653B;&#x51FB;</h3><p>&#x4E0B;&#x9762;&#x6458;&#x81EA;2010&#x5E74;&#x5173;&#x4E8E;&#x5B89;&#x5168;&#x7684;&#x4E00;&#x6BB5;&#x8BB2;&#x8BDD;&#x3002;&#x5176;&#x4E2D;&#x63D0;&#x5230;&#x4E86;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#x5728;&#x534F;&#x8BAE;&#x5B9E;&#x73B0;&#x4E0A;&#x7684;&#x7F3A;&#x9677;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x7684;&#x5B89;&#x5168;&#x95EE;&#x9898;&#x3002;<a href="/external_links/ad5ec83767c9605953cd8d0abb46a392.html" target="blank" rel="noopener">&#x731B;&#x51FB;&#x51FA;&#x5904;</a>&#x3002;</p>
<blockquote>
<p>&#x201C;We show, empirically, that the current version of the WebSocket consent mechanism is vulnerable to proxy cache poisoning attacks. Even though the WebSocket handshake is based on HTTP, which should be understood by most network intermediaries, the handshake uses the esoteric &#x201C;Upgrade&#x201D; mechanism of HTTP [5]. In our experiment, we find that many proxies do not implement the Upgrade mechanism properly, which causes the handshake to succeed even though subsequent traffic over the socket will be misinterpreted by the proxy.&#x201D;</p>
<p>[TALKING] Huang, L-S., Chen, E., Barth, A., Rescorla, E., and C.<br>Jackson, &#x201C;Talking to Yourself for Fun and Profit&#x201D;, 2010,</p>
</blockquote>
<p>&#x5728;&#x6B63;&#x5F0F;&#x63CF;&#x8FF0;&#x653B;&#x51FB;&#x6B65;&#x9AA4;&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x5047;&#x8BBE;&#x6709;&#x5982;&#x4E0B;&#x53C2;&#x4E0E;&#x8005;&#xFF1A;</p>
<ul>
<li>&#x653B;&#x51FB;&#x8005;&#x3001;&#x653B;&#x51FB;&#x8005;&#x81EA;&#x5DF1;&#x63A7;&#x5236;&#x7684;&#x670D;&#x52A1;&#x5668;&#xFF08;&#x7B80;&#x79F0;&#x201C;&#x90AA;&#x6076;&#x670D;&#x52A1;&#x5668;&#x201D;&#xFF09;&#x3001;&#x653B;&#x51FB;&#x8005;&#x4F2A;&#x9020;&#x7684;&#x8D44;&#x6E90;&#xFF08;&#x7B80;&#x79F0;&#x201C;&#x90AA;&#x6076;&#x8D44;&#x6E90;&#x201D;&#xFF09;</li>
<li>&#x53D7;&#x5BB3;&#x8005;&#x3001;&#x53D7;&#x5BB3;&#x8005;&#x60F3;&#x8981;&#x8BBF;&#x95EE;&#x7684;&#x8D44;&#x6E90;&#xFF08;&#x7B80;&#x79F0;&#x201C;&#x6B63;&#x4E49;&#x8D44;&#x6E90;&#x201D;&#xFF09;</li>
<li>&#x53D7;&#x5BB3;&#x8005;&#x5B9E;&#x9645;&#x60F3;&#x8981;&#x8BBF;&#x95EE;&#x7684;&#x670D;&#x52A1;&#x5668;&#xFF08;&#x7B80;&#x79F0;&#x201C;&#x6B63;&#x4E49;&#x670D;&#x52A1;&#x5668;&#x201D;&#xFF09;</li>
<li>&#x4E2D;&#x95F4;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;</li>
</ul>
<p>&#x653B;&#x51FB;&#x6B65;&#x9AA4;&#x4E00;&#xFF1A;</p>
<ol>
<li><strong>&#x653B;&#x51FB;&#x8005;</strong>&#x6D4F;&#x89C8;&#x5668; &#x5411; <strong>&#x90AA;&#x6076;&#x670D;&#x52A1;&#x5668;</strong> &#x53D1;&#x8D77;WebSocket&#x8FDE;&#x63A5;&#x3002;&#x6839;&#x636E;&#x524D;&#x6587;&#xFF0C;&#x9996;&#x5148;&#x662F;&#x4E00;&#x4E2A;&#x534F;&#x8BAE;&#x5347;&#x7EA7;&#x8BF7;&#x6C42;&#x3002;</li>
<li>&#x534F;&#x8BAE;&#x5347;&#x7EA7;&#x8BF7;&#x6C42; &#x5B9E;&#x9645;&#x5230;&#x8FBE; <strong>&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;</strong>&#x3002;</li>
<li><strong>&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;</strong> &#x5C06;&#x534F;&#x8BAE;&#x5347;&#x7EA7;&#x8BF7;&#x6C42;&#x8F6C;&#x53D1;&#x5230; <strong>&#x90AA;&#x6076;&#x670D;&#x52A1;&#x5668;</strong>&#x3002;</li>
<li><strong>&#x90AA;&#x6076;&#x670D;&#x52A1;&#x5668;</strong> &#x540C;&#x610F;&#x8FDE;&#x63A5;&#xFF0C;<strong>&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;</strong> &#x5C06;&#x54CD;&#x5E94;&#x8F6C;&#x53D1;&#x7ED9; <strong>&#x653B;&#x51FB;&#x8005;</strong>&#x3002;</li>
</ol>
<p>&#x7531;&#x4E8E; upgrade &#x7684;&#x5B9E;&#x73B0;&#x4E0A;&#x6709;&#x7F3A;&#x9677;&#xFF0C;<strong>&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;</strong> &#x4EE5;&#x4E3A;&#x4E4B;&#x524D;&#x8F6C;&#x53D1;&#x7684;&#x662F;&#x666E;&#x901A;&#x7684;HTTP&#x6D88;&#x606F;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5F53;<strong>&#x534F;&#x8BAE;&#x670D;&#x52A1;&#x5668;</strong> &#x540C;&#x610F;&#x8FDE;&#x63A5;&#xFF0C;<strong>&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;</strong> &#x4EE5;&#x4E3A;&#x672C;&#x6B21;&#x4F1A;&#x8BDD;&#x5DF2;&#x7ECF;&#x7ED3;&#x675F;&#x3002;</p>
<p>&#x653B;&#x51FB;&#x6B65;&#x9AA4;&#x4E8C;&#xFF1A;</p>
<ol>
<li><strong>&#x653B;&#x51FB;&#x8005;</strong> &#x5728;&#x4E4B;&#x524D;&#x5EFA;&#x7ACB;&#x7684;&#x8FDE;&#x63A5;&#x4E0A;&#xFF0C;&#x901A;&#x8FC7;WebSocket&#x7684;&#x63A5;&#x53E3;&#x5411; <strong>&#x90AA;&#x6076;&#x670D;&#x52A1;&#x5668;</strong> &#x53D1;&#x9001;&#x6570;&#x636E;&#xFF0C;&#x4E14;&#x6570;&#x636E;&#x662F;&#x7CBE;&#x5FC3;&#x6784;&#x9020;&#x7684;HTTP&#x683C;&#x5F0F;&#x7684;&#x6587;&#x672C;&#x3002;&#x5176;&#x4E2D;&#x5305;&#x542B;&#x4E86; <strong>&#x6B63;&#x4E49;&#x8D44;&#x6E90;</strong> &#x7684;&#x5730;&#x5740;&#xFF0C;&#x4EE5;&#x53CA;&#x4E00;&#x4E2A;&#x4F2A;&#x9020;&#x7684;host&#xFF08;&#x6307;&#x5411;<strong>&#x6B63;&#x4E49;&#x670D;&#x52A1;&#x5668;</strong>&#xFF09;&#x3002;&#xFF08;&#x89C1;&#x540E;&#x9762;&#x62A5;&#x6587;&#xFF09;</li>
<li>&#x8BF7;&#x6C42;&#x5230;&#x8FBE; <strong>&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;</strong> &#x3002;&#x867D;&#x7136;&#x590D;&#x7528;&#x4E86;&#x4E4B;&#x524D;&#x7684;TCP&#x8FDE;&#x63A5;&#xFF0C;&#x4F46; <strong>&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;</strong> &#x4EE5;&#x4E3A;&#x662F;&#x65B0;&#x7684;HTTP&#x8BF7;&#x6C42;&#x3002;</li>
<li><strong>&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;</strong> &#x5411; <strong>&#x90AA;&#x6076;&#x670D;&#x52A1;&#x5668;</strong> &#x8BF7;&#x6C42; <strong>&#x90AA;&#x6076;&#x8D44;&#x6E90;</strong>&#x3002;</li>
<li><strong>&#x90AA;&#x6076;&#x670D;&#x52A1;&#x5668;</strong> &#x8FD4;&#x56DE; <strong>&#x90AA;&#x6076;&#x8D44;&#x6E90;</strong>&#x3002;<strong>&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;</strong> &#x7F13;&#x5B58;&#x4F4F; <strong>&#x90AA;&#x6076;&#x8D44;&#x6E90;</strong>&#xFF08;url&#x662F;&#x5BF9;&#x7684;&#xFF0C;&#x4F46;host&#x662F; <strong>&#x6B63;&#x4E49;&#x670D;&#x52A1;&#x5668;</strong> &#x7684;&#x5730;&#x5740;&#xFF09;&#x3002;</li>
</ol>
<p>&#x5230;&#x8FD9;&#x91CC;&#xFF0C;&#x53D7;&#x5BB3;&#x8005;&#x53EF;&#x4EE5;&#x767B;&#x573A;&#x4E86;&#xFF1A;</p>
<ol>
<li><strong>&#x53D7;&#x5BB3;&#x8005;</strong> &#x901A;&#x8FC7; <strong>&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;</strong> &#x8BBF;&#x95EE; <strong>&#x6B63;&#x4E49;&#x670D;&#x52A1;&#x5668;</strong> &#x7684; <strong>&#x6B63;&#x4E49;&#x8D44;&#x6E90;</strong>&#x3002;</li>
<li><strong>&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;</strong> &#x68C0;&#x67E5;&#x8BE5;&#x8D44;&#x6E90;&#x7684;url&#x3001;host&#xFF0C;&#x53D1;&#x73B0;&#x672C;&#x5730;&#x6709;&#x4E00;&#x4EFD;&#x7F13;&#x5B58;&#xFF08;&#x4F2A;&#x9020;&#x7684;&#xFF09;&#x3002;</li>
<li><strong>&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;</strong> &#x5C06; <strong>&#x90AA;&#x6076;&#x8D44;&#x6E90;</strong> &#x8FD4;&#x56DE;&#x7ED9; <strong>&#x53D7;&#x5BB3;&#x8005;</strong>&#x3002;</li>
<li><strong>&#x53D7;&#x5BB3;&#x8005;</strong> &#x5352;&#x3002;</li>
</ol>
<p>&#x9644;&#xFF1A;&#x524D;&#x9762;&#x63D0;&#x5230;&#x7684;&#x7CBE;&#x5FC3;&#x6784;&#x9020;&#x7684;&#x201C;HTTP&#x8BF7;&#x6C42;&#x62A5;&#x6587;&#x201D;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">arduino&#x590D;&#x5236;&#x4EE3;&#x7801;Client &#x2192; Server:</span><br><span class="line">POST /path/of/attackers/choice HTTP/1.1 Host: host-of-attackers-choice.com Sec-WebSocket-Key: &lt;connection-key&gt;</span><br><span class="line">Server &#x2192; Client:</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Sec-WebSocket-Accept: &lt;connection-key&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2&#x3001;&#x5F53;&#x524D;&#x89E3;&#x51B3;&#x65B9;&#x6848;"><a href="#2&#x3001;&#x5F53;&#x524D;&#x89E3;&#x51B3;&#x65B9;&#x6848;" class="headerlink" title="2&#x3001;&#x5F53;&#x524D;&#x89E3;&#x51B3;&#x65B9;&#x6848;"></a>2&#x3001;&#x5F53;&#x524D;&#x89E3;&#x51B3;&#x65B9;&#x6848;</h3><p>&#x6700;&#x521D;&#x7684;&#x63D0;&#x6848;&#x662F;&#x5BF9;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x52A0;&#x5BC6;&#x5904;&#x7406;&#x3002;&#x57FA;&#x4E8E;&#x5B89;&#x5168;&#x3001;&#x6548;&#x7387;&#x7684;&#x8003;&#x8651;&#xFF0C;&#x6700;&#x7EC8;&#x91C7;&#x7528;&#x4E86;&#x6298;&#x4E2D;&#x7684;&#x65B9;&#x6848;&#xFF1A;&#x5BF9;&#x6570;&#x636E;&#x8F7D;&#x8377;&#x8FDB;&#x884C;&#x63A9;&#x7801;&#x5904;&#x7406;&#x3002;</p>
<p>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x8FD9;&#x91CC;&#x53EA;&#x662F;&#x9650;&#x5236;&#x4E86;&#x6D4F;&#x89C8;&#x5668;&#x5BF9;&#x6570;&#x636E;&#x8F7D;&#x8377;&#x8FDB;&#x884C;&#x63A9;&#x7801;&#x5904;&#x7406;&#xFF0C;&#x4F46;&#x662F;&#x574F;&#x4EBA;&#x5B8C;&#x5168;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x81EA;&#x5DF1;&#x7684;WebSocket&#x5BA2;&#x6237;&#x7AEF;&#x3001;&#x670D;&#x52A1;&#x7AEF;&#xFF0C;&#x4E0D;&#x6309;&#x89C4;&#x5219;&#x6765;&#xFF0C;&#x653B;&#x51FB;&#x53EF;&#x4EE5;&#x7167;&#x5E38;&#x8FDB;&#x884C;&#x3002;</p>
<p>&#x4F46;&#x662F;&#x5BF9;&#x6D4F;&#x89C8;&#x5668;&#x52A0;&#x4E0A;&#x8FD9;&#x4E2A;&#x9650;&#x5236;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x5927;&#x5927;&#x589E;&#x52A0;&#x653B;&#x51FB;&#x7684;&#x96BE;&#x5EA6;&#xFF0C;&#x4EE5;&#x53CA;&#x653B;&#x51FB;&#x7684;&#x5F71;&#x54CD;&#x8303;&#x56F4;&#x3002;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x8FD9;&#x4E2A;&#x9650;&#x5236;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x5728;&#x7F51;&#x4E0A;&#x653E;&#x4E2A;&#x9493;&#x9C7C;&#x7F51;&#x7AD9;&#x9A97;&#x4EBA;&#x53BB;&#x8BBF;&#x95EE;&#xFF0C;&#x4E00;&#x4E0B;&#x5B50;&#x5C31;&#x53EF;&#x4EE5;&#x5728;&#x77ED;&#x65F6;&#x95F4;&#x5185;&#x5C55;&#x5F00;&#x5927;&#x8303;&#x56F4;&#x7684;&#x653B;&#x51FB;&#x3002;</p>
<h2 id="&#x5341;&#x3001;&#x5199;&#x5728;&#x540E;&#x9762;"><a href="#&#x5341;&#x3001;&#x5199;&#x5728;&#x540E;&#x9762;" class="headerlink" title="&#x5341;&#x3001;&#x5199;&#x5728;&#x540E;&#x9762;"></a>&#x5341;&#x3001;&#x5199;&#x5728;&#x540E;&#x9762;</h2><p>WebSocket&#x53EF;&#x5199;&#x7684;&#x4E1C;&#x897F;&#x8FD8;&#x633A;&#x591A;&#xFF0C;&#x6BD4;&#x5982;WebSocket&#x6269;&#x5C55;&#x3002;&#x5BA2;&#x6237;&#x7AEF;&#x3001;&#x670D;&#x52A1;&#x7AEF;&#x4E4B;&#x95F4;&#x662F;&#x5982;&#x4F55;&#x534F;&#x5546;&#x3001;&#x4F7F;&#x7528;&#x6269;&#x5C55;&#x7684;&#x3002;WebSocket&#x6269;&#x5C55;&#x53EF;&#x4EE5;&#x7ED9;&#x534F;&#x8BAE;&#x672C;&#x8EAB;&#x589E;&#x52A0;&#x5F88;&#x591A;&#x80FD;&#x529B;&#x548C;&#x60F3;&#x8C61;&#x7A7A;&#x95F4;&#xFF0C;&#x6BD4;&#x5982;&#x6570;&#x636E;&#x7684;&#x538B;&#x7F29;&#x3001;&#x52A0;&#x5BC6;&#xFF0C;&#x4EE5;&#x53CA;&#x591A;&#x8DEF;&#x590D;&#x7528;&#x7B49;&#x3002;</p>
<p>&#x7BC7;&#x5E45;&#x6240;&#x9650;&#xFF0C;&#x8FD9;&#x91CC;&#x5148;&#x4E0D;&#x5C55;&#x5F00;&#xFF0C;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x540C;&#x5B66;&#x53EF;&#x4EE5;&#x7559;&#x8A00;&#x4EA4;&#x6D41;&#x3002;&#x6587;&#x7AE0;&#x5982;&#x6709;&#x9519;&#x6F0F;&#xFF0C;&#x656C;&#x8BF7;&#x6307;&#x51FA;&#x3002;</p>
<h2 id="&#x5341;&#x4E00;&#x3001;&#x76F8;&#x5173;&#x94FE;&#x63A5;"><a href="#&#x5341;&#x4E00;&#x3001;&#x76F8;&#x5173;&#x94FE;&#x63A5;" class="headerlink" title="&#x5341;&#x4E00;&#x3001;&#x76F8;&#x5173;&#x94FE;&#x63A5;"></a>&#x5341;&#x4E00;&#x3001;&#x76F8;&#x5173;&#x94FE;&#x63A5;</h2><p><a href="/external_links/8f23ec0857e45dc91c34807ab55e8659.html" target="blank" rel="noopener">RFC6455&#xFF1A;websocket&#x89C4;&#x8303;</a></p>
<p><a href="/external_links/8f23ec0857e45dc91c34807ab55e8659.html" target="blank" rel="noopener">&#x89C4;&#x8303;&#xFF1A;&#x6570;&#x636E;&#x5E27;&#x63A9;&#x7801;&#x7EC6;&#x8282;</a></p>
<p><a href="/external_links/8f23ec0857e45dc91c34807ab55e8659.html" target="blank" rel="noopener">&#x89C4;&#x8303;&#xFF1A;&#x6570;&#x636E;&#x5E27;&#x683C;&#x5F0F;</a></p>
<p><a href="/external_links/fbc09b1f25e3073a0fc7a18292148f3b.html" target="blank" rel="noopener">server-example</a></p>
<p><a href="/external_links/2bc9d59d048535cc186ef53462cf471e.html" target="blank" rel="noopener">&#x7F16;&#x5199;websocket&#x670D;&#x52A1;&#x5668;</a></p>
<p><a href="/external_links/8f23ec0857e45dc91c34807ab55e8659.html" target="blank" rel="noopener">&#x5BF9;&#x7F51;&#x7EDC;&#x57FA;&#x7840;&#x8BBE;&#x65BD;&#x7684;&#x653B;&#x51FB;&#xFF08;&#x6570;&#x636E;&#x63A9;&#x7801;&#x64CD;&#x4F5C;&#x6240;&#x8981;&#x9884;&#x9632;&#x7684;&#x4E8B;&#x60C5;&#xFF09;</a></p>
<p><a href="/external_links/ad5ec83767c9605953cd8d0abb46a392.html" target="blank" rel="noopener">Talking to Yourself for Fun and Profit&#xFF08;&#x542B;&#x6709;&#x653B;&#x51FB;&#x63CF;&#x8FF0;&#xFF09;</a></p>
<p><a href="/external_links/d8032f460f4bd51ebccd30f9f0537a2e.html" target="blank" rel="noopener">What is Sec-WebSocket-Key for?</a></p>
<p><a href="/external_links/8f23ec0857e45dc91c34807ab55e8659.html" target="blank" rel="noopener">10.3. Attacks On Infrastructure (Masking)</a></p>
<p><a href="/external_links/ad5ec83767c9605953cd8d0abb46a392.html" target="blank" rel="noopener">Talking to Yourself for Fun and Profit</a></p>
<p><a href="/external_links/d17b314e2cb10fda6d84405221bdf92f.html" target="blank" rel="noopener">Why are WebSockets masked?</a></p>
<p><a href="/external_links/ff5fa97a407a3285c11044ee25a43017.html" target="blank" rel="noopener">How does websocket frame masking protect against cache poisoning?</a></p>
<p><a href="/external_links/41477cd9611709db637de1a78ebdad1f.html" target="blank" rel="noopener">What is the mask in a WebSocket frame?</a></p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/25db856b31eb2e290cd9eeb3f98613b3.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="../250/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="../../">1</a><span class="space">&hellip;</span><a class="page-number" href="../250/">250</a><span class="page-number current">251</span><a class="page-number" href="../252/">252</a><span class="space">&hellip;</span><a class="page-number" href="../298/">298</a><a class="extend next" rel="next" href="../252/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">开发者博客</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="https://dev.newban.cn/archives/">
              
                  <span class="site-state-item-count">2975</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">1162</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="../../atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">开发者博客</span>
  <div>
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
  </div>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




  <script type="text/javascript" async src="js/src/mermaid.min.js"></script>
  <script>
  if (window.mermaid) {
        var mermaid_config = {
            startOnLoad: true,
            theme: 'default',
            flowchart:{
                useMaxWidth: false,
                htmlLabels: true
            }                
        }
        mermaid.initialize(mermaid_config);
  }
  </script>
  

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="../../lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="../../lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="../../lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="../../lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="../../lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="../../lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="../../js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="../../js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="../../js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
