<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">
<meta name="referrer" content="never">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="../../lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="../../lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="../../css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="../../images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="../../images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="../../images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="../../images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">





  <link rel="alternate" href="../../atom.xml" title="开发者博客 – IT技术 尽在开发者博客" type="application/atom+xml">






<meta property="og:type" content="website">
<meta property="og:title" content="开发者博客 – IT技术 尽在开发者博客">
<meta property="og:url" content="https://dev.newban.cn/page/206/index.html">
<meta property="og:site_name" content="开发者博客 – IT技术 尽在开发者博客">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="开发者博客 – IT技术 尽在开发者博客">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>
<!--谷歌广告验证代码-->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-2626449904708114",
          enable_page_level_ads: true
     });
</script>
<!--谷歌广告验证代码-->



  <link rel="canonical" href="https://dev.newban.cn/page/206/">





  <title>开发者博客 – IT技术 尽在开发者博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">开发者博客 – IT技术 尽在开发者博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">开发者博客 – 科技是第一生产力</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="http://dev.newban.cn/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="https://dev.newban.cn/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6947138732768100360.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6947138732768100360.html" itemprop="url">心路历程   关于记笔记的二次迷茫</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-04-04T11:29:23+08:00">
                2021-04-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>&#x603B;&#x6587;&#x6863; :<a href="https://dev.newban.cn/6941642435189538824">&#x6587;&#x7AE0;&#x76EE;&#x5F55;</a>  </p>
<p>Github : <a href="/external_links/f4c0695dd8cd8371c2f2fc9edde11029.html" target="blank" rel="noopener">github.com/black-ant</a></p>
</blockquote>
<p><strong>&#x524D;&#x8A00; :</strong> &#x65F6;&#x95F4;2021&#x5E74;4&#x6708; , &#x8BB0;&#x5F55;&#x5F53;&#x524D;&#x7684;&#x4E00;&#x4E9B;&#x60F3;&#x6CD5; , &#x4EE5;&#x5F85;&#x65E5;&#x540E;&#x81EA;&#x5BA1;.</p>
<p><strong>2021-04-01 &#x8BB0;&#x5F55;</strong>  </p>
<p>&#x6700;&#x5F00;&#x59CB;&#x5BF9;&#x5916;&#x53D1;&#x6587;&#x6863;&#x5927;&#x6982;&#x5728;4&#x5E74;&#x524D; , &#x5F53;&#x65F6;&#x662F;&#x5728;CSDN , &#x5F53;&#x65F6;&#x4E3A;&#x4E86;&#x907F;&#x514D; <strong>&#x70B9;&#x5F00;&#x7B49;&#x4E8E;&#x6211;&#x770B;&#x4E86; , &#x6536;&#x85CF;&#x7B49;&#x4E8E;&#x6211;&#x5B66;&#x4E86;</strong> , &#x6240;&#x4EE5;&#x8981;&#x628A;&#x5B66;&#x8FC7;&#x7684;&#x4E1C;&#x897F;&#x6574;&#x5408;&#x8D77;&#x6765;&#x53D1;&#x5E03; , &#x6765;&#x586B;&#x8865;&#x5FC3;&#x4E2D;&#x81EA;&#x6211;&#x8FF7;&#x832B;&#x7684;&#x7A98;&#x5883; .</p>
<p>&#x4F46;&#x662F;&#x53D1;&#x7740;&#x53D1;&#x7740; ,&#x9677;&#x5165;&#x4E86;&#x7B2C;&#x4E00;&#x6B21;&#x8FF7;&#x832B; , &#x4F5C;&#x4E3A;&#x4E00;&#x540D;&#x521D;&#x7EA7;&#x7A0B;&#x5E8F;&#x5458; , &#x8FD8;&#x662F;&#x4E00;&#x540D;&#x5C97;&#x4F4D;&#x662F;&#x5168;&#x6808;&#x7684;&#x521D;&#x7EA7;&#x7A0B;&#x5E8F;&#x5458; , &#x53D1;&#x7684;&#x4E1C;&#x897F;&#x548C;&#x5927;&#x6742;&#x70E9;&#x4E00;&#x6837; , &#x4EC0;&#x4E48;&#x4E1C;&#x897F;&#x90FD;&#x6709; ,&#x800C;&#x4EC0;&#x4E48;&#x90FD;&#x4E0D;&#x7CBE; .</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/ca1bf5e799d6708b54987cf39b6f135e89a07584d5d59f91d131fe6b92a2a125" alt="image.png"></p>
<p>&#x73B0;&#x5728;&#x770B;&#x6765;, &#x8FD8;&#x90FD;&#x6807;&#x7740;&#x539F;&#x521B; , &#x771F;&#x7684;&#x81CA;&#x5F97;&#x614C;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">&#x9646;&#x9646;&#x7EED;&#x7EED;&#x5199;&#x4E86;&#x4E00;&#x5E74;&#x591A; , &#x4E5F;&#x5C31;&#x505C;&#x4E0B;&#x6765;&#x4E86; , &#x8FD8;&#x8BB0;&#x5F97;&#x5F53;&#x65F6;&#x7684;&#x60F3;&#x6CD5;&#x6709;&#x597D;&#x51E0;&#x4E2A; :</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">* &#x6CA1;&#x5565;&#x6DF1;&#x5EA6; , &#x5199;&#x6765;&#x5199;&#x53BB;&#x5C31;&#x662F;&#x90A3;&#x4E9B;</span><br><span class="line">* &#x592A;&#x57FA;&#x7840; , &#x7F51;&#x4E0A;&#x4E00;&#x67E5;&#x4E00;&#x5927;&#x7247; , &#x5199;&#x7684;&#x8FD8;&#x6BD4;&#x81EA;&#x5DF1;&#x597D;</span><br><span class="line">* &#x5199;&#x5B8C;&#x9664;&#x4E86;&#x8BA9;&#x6211;&#x4EE5;&#x540E;&#x67E5;&#x627E;&#x65B9;&#x4FBF; , &#x6CA1;&#x5565;&#x5927;&#x7528;&#x5904;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x8FD8;&#x6709;&#x5176;&#x4ED6;&#x7684;&#x4E5F;&#x6CA1;&#x8BB0;&#x4E0B;&#x6765; , &#x8981;&#x662F;&#x8BB0;&#x4E0B;&#x6765; , &#x5E94;&#x8BE5;&#x5BF9;&#x6B64;&#x65F6;&#x7684;&#x8FF7;&#x832B;&#x80FD;&#x8D77;&#x4E00;&#x4E9B;&#x5E2E;&#x52A9;&#x5427; .</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**2021-04-03 &#x8BB0;&#x5F55;**   </span><br><span class="line"></span><br><span class="line">&#x4ECE;&#x5F00;&#x59CB;&#x5DE5;&#x4F5C;&#x4EE5;&#x6765; , &#x53CD;&#x800C;&#x6709;&#x4E86;&#x8BB0;&#x7B14;&#x8BB0;&#x7684;&#x4E60;&#x60EF; .&#x4E00;&#x76F4;&#x4EE5;&#x6765;&#x6211;&#x8BB0;&#x7B14;&#x8BB0;&#x7684;&#x539F;&#x5219;&#x90FD;&#x662F; :**&#x65E0;&#x8BBA;&#x591A;&#x4E45; , &#x6211;&#x90FD;&#x80FD;&#x901A;&#x8FC7;&#x7B14;&#x8BB0;&#x5728;&#x77ED;&#x65F6;&#x95F4;&#x5B9E;&#x73B0;&#x8FD9;&#x4E2A;&#x529F;&#x80FD; ,&#x4E86;&#x89E3;&#x8FD9;&#x4E2A;&#x8981;&#x70B9;** , &#x5C3D;&#x7BA1;&#x65E9;&#x671F;&#x7684;&#x6587;&#x7AE0;&#x5F88;&#x4E0D;&#x597D; , &#x4E0D;&#x8FC7;&#x5B83;&#x540C;&#x6837;&#x8FBE;&#x5230;&#x4E86;&#x8FD9;&#x4E2A;&#x6548;&#x679C; ,&#x5230;&#x73B0;&#x5728;&#x6211;&#x90FD;&#x80FD;&#x4ECE;&#x4E2D;&#x6361;&#x8D77;&#x4E00;&#x70B9;&#x4EC0;&#x4E48; ,&#x6240;&#x4EE5; ,&#x8FD9;&#x4E2A;&#x539F;&#x5219;&#x8FD8;&#x8981;&#x4FDD;&#x6301;.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x540E;&#x9762;&#x53D1;&#x5E03;&#x5C31;&#x505C;&#x4E86; , &#x56E0;&#x4E3A;&#x5F53;&#x65F6;&#x60F3;&#x7740;&#x6DF1;&#x5165;&#x6280;&#x672F; , &#x4E0D;&#x80FD;&#x6D6E;&#x4E8E;&#x7528;&#x6CD5; ,&#x5F00;&#x59CB;&#x7B14;&#x8BB0;&#x672C;&#x5730;&#x5316; , &#x5F00;&#x59CB;&#x5F80; Git &#x91CC;&#x9762;&#x585E;&#x4E1C;&#x897F; , &#x62FC;&#x547D;&#x7684;&#x585E; , &#x5B66;&#x5230;&#x4EC0;&#x4E48;&#x5C31;&#x585E;&#x4EC0;&#x4E48; , &#x540C;&#x65F6;&#x56E0;&#x4E3A;&#x4E00;&#x4E9B;&#x7075;&#x611F;&#x4E4D;&#x73B0;&#x7684;&#x60F3;&#x6CD5; , &#x5F00;&#x542F;&#x4E86;&#x4E00;&#x4E9B;&#x5F00;&#x6E90;&#x7684;&#x9879;&#x76EE; , &#x5C3D;&#x7BA1;&#x6CA1;&#x4EBA;&#x770B; , &#x81EA;&#x8BA4;&#x4E3A;&#x4E5F;&#x6CA1;&#x4F5C;&#x5B8C; , &#x4E0D;&#x8FC7;&#x786E;&#x5B9E;&#x662F;&#x6C89;&#x6DC0;&#x6280;&#x672F;&#x7684;&#x597D;&#x65B9;&#x5F0F; , &#x56E0;&#x6B64;&#x800C;&#x5EA6;&#x8FC7;&#x4E86;&#x5176;&#x4E2D;&#x6700;&#x8FF7;&#x832B;&#x7684;&#x4E00;&#x6BB5;&#x65F6;&#x671F; .</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x5230;&#x4E86;&#x4E00;&#x4E2A;&#x6708;&#x4EE5;&#x524D; , &#x51B3;&#x5B9A;&#x7EE7;&#x7EED;&#x53D1;&#x5E03;&#x6587;&#x6863; , &#x4E3B;&#x8981;&#x539F;&#x56E0;&#x662F; :**&#x6587;&#x6863;&#x592A;&#x591A;&#x4E86; ,&#x592A;&#x4E71;&#x4E86;** , typora &#x786E;&#x5B9E;&#x5F88;&#x9002;&#x5408;&#x5199;Markdown , &#x4F46;&#x662F;&#x4E1C;&#x897F;&#x591A;&#x4E86;&#x4E5F;&#x5C34;&#x5C2C; . &#x56E0;&#x6B64;&#x628A;&#x77E5;&#x8BC6;&#x7CFB;&#x7EDF;&#x5316; ,&#x6587;&#x6863;&#x5316; , &#x6211;&#x8BA4;&#x4E3A;&#x662F;&#x80FD;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x7684;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**&#x6587;&#x6863;&#x5E94;&#x8BE5;&#x6709;&#x4EC0;&#x4E48;&#x7279;&#x6027; ?**</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">* &#x670D;&#x52A1;&#x81EA;&#x5DF1; , &#x63D0;&#x5347;&#x81EA;&#x5DF1;</span><br><span class="line">* &#x603B;&#x7ED3;&#x77E5;&#x8BC6; , &#x5206;&#x4EAB;&#x77E5;&#x8BC6; , &#x8BB0;&#x5F55;&#x77E5;&#x8BC6;</span><br><span class="line">* &#x53EF;&#x4E8C;&#x6B21;&#x5B66;&#x4E60; , &#x51CF;&#x5C11;&#x5B66;&#x4E60;&#x6210;&#x672C;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x535A;&#x5BA2;&#x4E5F;&#x597D; , &#x6587;&#x6863;&#x4E5F;&#x597D; ,&#x5176;&#x6700;&#x5927;&#x7684;&#x670D;&#x52A1;&#x8005;&#x90FD;&#x662F;&#x81EA;&#x5DF1; . &#x53D1;&#x5E03;&#x51FA;&#x6765; ,&#x9664;&#x4E86;&#x8BB2;&#x77E5;&#x8BC6;&#x5171;&#x4EAB; , &#x5176;&#x76EE;&#x7684;&#x8FD8;&#x5728;&#x4E8E;&#x80FD;&#x5728;&#x5199;&#x7684;&#x65F6;&#x5019;&#x56DE;&#x5FC6;&#x68B3;&#x7406;&#x601D;&#x8DEF; ,&#x5728;&#x53D1;&#x5E03;&#x540E; , &#x5176;&#x4ED6;&#x4EBA;&#x53EF;&#x4EE5;&#x7ED9;&#x4F60;&#x6307;&#x6B63;&#x5176;&#x4E2D;&#x7684;&#x9519;&#x8BEF; , **&#x4E00;&#x4E2A;&#x80FD;&#x628A;&#x590D;&#x6742;&#x70B9;&#x8BB2;&#x7B80;&#x5355;&#x7684;&#x6587;&#x6863; ,&#x624D;&#x662F;&#x597D;&#x6587;&#x6863;**.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x8FD9;&#x4E24;&#x5E74;&#x4E00;&#x76F4;&#x5728;&#x8003;&#x8651;&#x4E00;&#x4E2A;&#x95EE;&#x9898; , **&#x5982;&#x4F55;&#x7528;&#x6587;&#x6863;&#x9A71;&#x52A8;&#x5F00;&#x53D1;?**</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x6211;&#x4E0D;&#x671F;&#x671B;&#x4E00;&#x4E2A;&#x5E38;&#x7528;&#x7684;&#x64CD;&#x4F5C;&#x4E5F;&#x597D; , &#x4E00;&#x4E2A;&#x6846;&#x67B6;&#x7684;&#x642D;&#x5EFA;&#x4E5F;&#x597D; ,&#x6D88;&#x8017;&#x4E8C;&#x6B21;&#x7684;&#x65F6;&#x95F4; , &#x6240;&#x4EE5;&#x6211;&#x7684;&#x7B14;&#x8BB0;&#x4E2D;&#x4F1A;&#x628A;&#x4E00;&#x4E2A;&#x4E1A;&#x52A1;&#x7684;&#x642D;&#x5EFA;&#x5B8C;&#x6574;&#x7684;&#x8BB0;&#x5F55;&#x4E0B;&#x6765; , &#x4F1A;&#x628A;&#x78B0;&#x5230;&#x7684;&#x95EE;&#x9898;&#x8BB0;&#x5F55;&#x4E0B;&#x6765; , &#x8FD9;&#x6837;&#x4E0B;&#x6B21;&#x6211;&#x4F7F;&#x7528; ,&#x5C31;&#x80FD;&#x518D;&#x6700;&#x77ED;&#x7684;&#x65F6;&#x95F4;&#x628A;&#x73AF;&#x5883;&#x642D;&#x5EFA;&#x597D; , &#x5728;&#x6211;&#x770B;&#x6765; , &#x642D;&#x73AF;&#x5883;&#x6700;&#x70E6;&#x4EBA;&#x4E86;....</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x4F46;&#x662F; , &#x8FD9;&#x4E5F;&#x5F15;&#x51FA;&#x4E86;&#x6211;&#x65B0;&#x5F97;&#x8FF7;&#x832B;...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x8FD9;&#x6BB5;&#x65F6;&#x95F4;&#x6587;&#x6863;&#x5F88;&#x9AD8;&#x4EA7; , &#x4E3B;&#x8981;&#x7684;&#x6D88;&#x8017;&#x6E90;&#x662F;&#x8FD9;2&#x5E74;&#x7684;&#x79EF;&#x7D2F; , &#x5199;&#x7740;&#x5199;&#x7740;&#x6211;&#x53D1;&#x73B0; , &#x8FD9;&#x4E9B;&#x79EF;&#x7D2F;**&#x53EA;&#x89E3;&#x51B3;&#x4E86;&#x6211;&#x8BE5;&#x600E;&#x4E48;&#x7528;** , &#x6E90;&#x7801;&#x4E5F;&#x597D; , &#x6B65;&#x9AA4;&#x4E5F;&#x597D; , &#x6211;&#x53EA;&#x80FD;&#x901A;&#x8FC7;&#x6587;&#x6863;&#x89E3;&#x51B3;&#x6211;&#x8BE5;&#x5982;&#x4F55;&#x7528;&#x5B83; , &#x5B83;&#x6216;&#x8BB8;&#x53EF;&#x4EE5;&#x5E2E;&#x6211;&#x89E3;&#x51B3;&#x6211;&#x8BE5;&#x600E;&#x4E48;&#x4F20;&#x53C2; , &#x6211;&#x54EA;&#x91CC;&#x662F;&#x4E0D;&#x662F;&#x641E;&#x9519;&#x4E86;....</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x4F46;&#x662F; ,&#x6211;&#x8BA4;&#x4E3A;&#x6587;&#x6863;&#x9A71;&#x52A8;&#x5F00;&#x53D1;&#x8FD8;&#x6709;&#x66F4;&#x591A;&#x7684;&#x6316;&#x6398;&#x7A7A;&#x95F4; , &#x6211;&#x671F;&#x671B;&#x6211;&#x7684;&#x6587;&#x6863;&#x80FD;&#x518D;&#x5F00;&#x53D1;&#x4E2D;&#x505A;&#x5230;&#x4EC0;&#x4E48;?</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">* &#x5FEB;&#x901F;&#x627E;&#x5230;&#x95EE;&#x9898;</span><br><span class="line">* &#x5FEB;&#x901F;&#x5B9E;&#x73B0;&#x529F;&#x80FD;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x6216;&#x8005;...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">* **&#x6211;&#x8BE5;&#x600E;&#x4E48;&#x53BB;&#x5B9A;&#x5236;&#x5316;&#x6211;&#x7684;&#x529F;&#x80FD;?**</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**2021-04-04 &#x8BB0;&#x5F55;**   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**&#x6211;&#x8BE5;&#x600E;&#x4E48;&#x53BB;&#x5B9A;&#x5236;&#x5316;&#x6211;&#x7684;&#x529F;&#x80FD;?**  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x5199; Security &#x7CFB;&#x5217;&#x7684;&#x65F6;&#x5019;&#x5C31;&#x5728;&#x60F3; , &#x6211;&#x90FD;&#x5DF2;&#x7ECF;&#x628A;&#x6E90;&#x7801;&#x7684;&#x6D41;&#x7A0B;&#x8BB0;&#x4E0B;&#x6765;&#x4E86; , &#x6211;&#x662F;&#x4E0D;&#x662F;&#x53EF;&#x4EE5;&#x628A;&#x5176;&#x4E2D;&#x53EF;&#x4EE5;&#x5B9A;&#x5236;&#x7684;&#x70B9;&#x8BB0;&#x4E0B;&#x6765; ? &#x8FD9;&#x4E9B;&#x8BB0;&#x4E0B;&#x6765;&#x4E86; , &#x90A3;&#x5C82;&#x4E0D;&#x662F;&#x4EE5;&#x540E;&#x723D;&#x7FFB;&#x5929; ? &#x60F3;&#x600E;&#x4E48;&#x4F5C;&#x5C31;&#x600E;&#x4E48;&#x4F5C; , &#x60F3;&#x600E;&#x4E48;&#x73A9;&#x5C31;&#x600E;&#x4E48;&#x73A9;?</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x53EF;&#x662F;&#x9762;&#x5BF9;&#x4E86;&#x4E00;&#x4E2A;&#x95EE;&#x9898; , &#x5199;&#x4E0D;&#x51FA;&#x6765; , &#x56E0;&#x4E3A;&#x5B83;**&#x4F1A;&#x6D88;&#x8017;&#x592A;&#x591A;&#x7684;&#x65F6;&#x95F4;&#x548C;&#x7CBE;&#x529B;** , &#x800C;&#x4E14;&#x4E0D;&#x4E00;&#x5B9A;&#x56DE;&#x6709;&#x56DE;&#x62A5; , &#x53EF;&#x80FD;100&#x4E2A;&#x4E1A;&#x52A1;&#x70B9;&#x91CC;&#x9762; , &#x4E5F;&#x5C31;&#x4F1A;&#x78B0;&#x5230;&#x4E00;&#x6B21; , **&#x6210;&#x672C;&#x592A;&#x9AD8;&#x4E86;**</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**&#x90A3;&#x4E48;&#x6211;&#x8BE5;&#x5982;&#x4F55;&#x53BB;&#x5B9E;&#x73B0;&#x9AD8;&#x6548;&#x7387;&#x7684;&#x5206;&#x6790;?**</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">* &#x57FA;&#x4E8E;&#x5B98;&#x65B9;&#x5F00;&#x53D1;&#x6587;&#x6863; -&gt; &#x8865;&#x5145;&#x6E90;&#x7801;&#x6587;&#x6863; -&gt; &#x6269;&#x5C55;&#x5B9A;&#x5236;&#x6587;&#x6863;</span><br><span class="line">	+ &#x6E90;&#x7801;&#x7684;&#x5206;&#x6790;&#x5E94;&#x8BE5;&#x662F;&#x548C;&#x5F00;&#x53D1;&#x6587;&#x6863;&#x8D70;, &#x7531;&#x5E38;&#x7528;&#x7684;&#x529F;&#x80FD; , &#x53BB;&#x5206;&#x6790;&#x5E38;&#x7528;&#x7684;&#x6269;&#x5C55;&#x5B9A;&#x5236;</span><br><span class="line">* &#x7528;&#x4F2A;&#x4EE3;&#x7801;&#x66FF;&#x6362;&#x771F;&#x5B9E;&#x4EE3;&#x7801; , &#x51CF;&#x5C11;&#x4EE3;&#x7801;&#x957F;&#x5EA6; , &#x4FBF;&#x4E8E;&#x4E8C;&#x6B21;&#x5B66;&#x4E60;</span><br><span class="line">	+ &#x4F46;&#x662F;&#x8FD9;&#x6837;&#x8BB0;&#x5F55;&#x7684;&#x6587;&#x6863;&#x4F1A;&#x9057;&#x6F0F;&#x7EC6;&#x8282; , &#x662F;&#x5426;&#x5408;&#x9002;?</span><br><span class="line">* &#x4F7F;&#x7528;&#x672C;&#x5730;&#x7684;&#x90A3;&#x4E00;&#x5957;&#x6807;&#x8BB0; ,&#x540C;&#x65F6;&#x914D;&#x5408;&#x6E90;&#x7801; ?</span><br><span class="line">	+ &#x6807;&#x8BB0;&#x65B9;&#x5F0F;&#x8868;&#x8FBE;&#x6D41;&#x7A0B; , &#x6E90;&#x7801;&#x5C55;&#x73B0;&#x7EC6;&#x8282;</span><br><span class="line">	+ **(&#x53EF;&#x4EE5;&#x8BD5;&#x8BD5;)**</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**&#x6587;&#x6863;&#x91CC;&#x9762;&#x8FD8;&#x8981;&#x4EC0;&#x4E48;?**</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">* &#x6D41;&#x7A0B;&#x56FE; : &#x63D2;&#x4EF6; Seqence Diagrams</span><br><span class="line">* UML &#x7C7B;&#x56FE; : IDEA -&gt; Diagrams -&gt; show</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**&#x603B;&#x7ED3; :**</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x57FA;&#x672C;&#x4E0A;&#x601D;&#x8DEF;&#x5C31;&#x6E05;&#x695A;&#x4E86; , &#x540E;&#x7EED;&#x8981;&#x8BD5;&#x8BD5;&#x8FD9;&#x4E9B;&#x6A21;&#x5F0F; , &#x770B;&#x770B;&#x80FD;&#x4E0D;&#x80FD;&#x8BA9;&#x81EA;&#x5DF1;&#x7684;&#x6587;&#x6863;&#x6C34;&#x5E73;&#x518D;&#x6B21;&#x63D0;&#x9AD8;.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**&#x7559;&#x6B64;&#x6587;&#x6863;&#x4F5C;&#x65E5;&#x540E;&#x70B9;&#x8BC4; , &#x5B66;&#x6D77;&#x65E0;&#x6DAF; , &#x52FF;&#x5FD8;&#x521D;&#x5FC3;.**</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**&#x81EA;&#x521B;&#x6807;&#x8BB0;&#x8BED;&#x8A00;&#x8BB0;&#x5F55;**</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">```</span><br><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;I &#x5B9E;&#x73B0;&#x63A5;&#x53E3;</span><br><span class="line">E &#x5B9E;&#x73B0;&#x62BD;&#x8C61;&#x7C7B;</span><br><span class="line"></span><br><span class="line">C &#x7C7B;</span><br><span class="line">SC &#x5185;&#x90E8;&#x9759;&#x6001;&#x7C7B;</span><br><span class="line">PC &#x666E;&#x901A;&#x5185;&#x90E8;&#x7C7B;</span><br><span class="line">PVC &#x79C1;&#x6709;&#x5185;&#x90E8;&#x7C7B;</span><br><span class="line">PUC &#x516C;&#x5171;&#x5185;&#x90E8;&#x7C7B;</span><br><span class="line">IC &#x5185;&#x90E8;&#x63A5;&#x53E3;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">F &#x5C5E;&#x6027;</span><br><span class="line">SF &#x9759;&#x6001;&#x5C5E;&#x6027;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MC &#x6784;&#x9020;&#x51FD;&#x6570;</span><br><span class="line">SM &#x9759;&#x6001;&#x65B9;&#x6CD5;</span><br><span class="line">M &#x65B9;&#x6CD5;</span><br><span class="line">P &#x53C2;&#x6570;</span><br><span class="line">S &#x9759;&#x6001;&#x4EE3;&#x7801;&#x5757;</span><br><span class="line"></span><br><span class="line">B- &#x903B;&#x8F91;boolean &#x5224;&#x65AD;(B-&gt;)</span><br><span class="line">FOR- </span><br><span class="line">Else- else &#x903B;&#x8F91;</span><br><span class="line">// ELSE-</span><br><span class="line">// E-</span><br><span class="line">- &#x6B63;&#x5E38;&#x903B;&#x8F91;</span><br><span class="line">- 1 &#x6709;&#x5E8F;&#x8FD0;&#x884C;&#x903B;&#x8F91;</span><br><span class="line">-&gt; &#x5185;&#x90E8;&#x8FD0;&#x884C;&#x903B;&#x8F91; (&#x65B9;&#x6CD5;&#x5185;)</span><br><span class="line">? &#x5BF9;&#x4E0A;&#x4E00;&#x53E5;&#x7684;&#x4F5C;&#x7528;&#x89E3;&#x91CA;</span><br><span class="line">= &#x8D4B;&#x503C;&#x64CD;&#x4F5C;</span><br><span class="line">(param) &#x4F7F;&#x7528;&#x64CD;&#x4F5C;</span><br><span class="line"></span><br><span class="line">// &#x6848;&#x4F8B; : </span><br><span class="line">C- DefaultResourceLoader</span><br><span class="line">    MC- DefaultResourceLoader</span><br><span class="line">        - ClassUtils.getDefaultClassLoader();</span><br><span class="line">    MC- DefaultResourceLoader(@Nullable ClassLoader classLoader)</span><br><span class="line">    M- addProtocolResolver(ProtocolResolver) : &#x81EA;&#x5B9A;&#x4E49;&#x7684; Resolver &#x52A0;&#x5165; Spring &#x4F53;&#x7CFB;</span><br><span class="line">    M- getResource(String location)</span><br><span class="line">        - &#x9996;&#x5148;&#xFF0C;&#x901A;&#x8FC7; ProtocolResolver &#x6765;&#x52A0;&#x8F7D;&#x8D44;&#x6E90; , &#x6210;&#x529F;&#x8FD4;&#x56DE; Resource </span><br><span class="line">        - &#x5176;&#x6B21;&#xFF0C;&#x4EE5; / &#x5F00;&#x5934;&#xFF0C;&#x8C03;&#x7528; #getResourceByPath() &#x65B9;&#x6CD5;, &#x8FD4;&#x56DE; ClassPathContextResource &#x7C7B;&#x578B;&#x7684;&#x8D44;&#x6E90;</span><br><span class="line">        - &#x518D;&#x6B21;&#xFF0C;&#x4EE5; classpath: &#x5F00;&#x5934;&#xFF0C;&#x8FD4;&#x56DE; ClassPathResource &#x7C7B;&#x578B;&#x7684;&#x8D44;&#x6E90;</span><br><span class="line">            - &#x901A;&#x8FC7;#getClassLoader() &#x83B7;&#x53D6;&#x5F53;&#x524D;&#x7684; ClassLoader</span><br><span class="line">        - &#x7136;&#x540E;&#xFF0C;&#x6839;&#x636E;&#x662F;&#x5426;&#x4E3A;&#x6587;&#x4EF6; URL &#xFF0C;&#x662F;&#x5219;&#x8FD4;&#x56DE; FileUrlResource &#x7C7B;&#x578B;&#x7684;&#x8D44;&#x6E90;&#xFF0C;&#x5426;&#x5219;&#x8FD4;&#x56DE; UrlResource &#x7C7B;&#x578B;&#x7684;&#x8D44;&#x6E90;</span><br><span class="line">            - &#x6700;&#x540E;&#xFF0C;&#x8FD4;&#x56DE; ClassPathContextResource &#x7C7B;&#x578B;&#x7684;&#x8D44;&#x6E90;</span><br><span class="line"></span><br><span class="line">// &#x8981;&#x662F;&#x6709;&#x4EBA;&#x80FD;&#x7ED9;&#x6211;&#x66F4;&#x591A;&#x7075;&#x611F;&#x5C31;&#x597D;&#x4E86;</span><br></pre></td></tr></table></figure></p>
<pre><code>

**&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:** [&#x6398;&#x91D1;](https://juejin.cn/post/6947138732768100360)

*[&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;](https://dev.newban.cn/)*</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6946938375324581902.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6946938375324581902.html" itemprop="url">nodeJs搭配mysql，同样可以玩的飞起</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-04-03T22:29:03+08:00">
                2021-04-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="&#x7BC7;&#x4E00;&#xFF1A;&#x8FDE;&#x63A5;mysql&#xFF0C;&#x5E38;&#x7528;&#x7684;&#x589E;&#x5220;&#x6539;&#x67E5;&#x64CD;&#x4F5C;"><a href="#&#x7BC7;&#x4E00;&#xFF1A;&#x8FDE;&#x63A5;mysql&#xFF0C;&#x5E38;&#x7528;&#x7684;&#x589E;&#x5220;&#x6539;&#x67E5;&#x64CD;&#x4F5C;" class="headerlink" title="&#x7BC7;&#x4E00;&#xFF1A;&#x8FDE;&#x63A5;mysql&#xFF0C;&#x5E38;&#x7528;&#x7684;&#x589E;&#x5220;&#x6539;&#x67E5;&#x64CD;&#x4F5C;"></a>&#x7BC7;&#x4E00;&#xFF1A;&#x8FDE;&#x63A5;mysql&#xFF0C;&#x5E38;&#x7528;&#x7684;&#x589E;&#x5220;&#x6539;&#x67E5;&#x64CD;&#x4F5C;</h2><p>1&#x3001;&#x6570;&#x636E;&#x7684;&#x8FDE;&#x63A5;</p>
<ul>
<li>&#x5728;node&#x4E2D;&#x8FDE;&#x63A5;mysql&#x6570;&#x636E;&#x5E93;&#x9700;&#x8981;&#x5B89;&#x88C5;&#x4E00;&#x4E2A;&#x7B2C;&#x4E09;&#x65B9;&#x63D2;&#x4EF6;&#x5305;<ul>
<li>&#x8FD0;&#x884C;&#x547D;&#x4EE4;&#xFF1A;<code>npm i mysql -S</code>,&#x7B49;&#x5F85;&#x5B8C;&#x6210;&#x5373;&#x53EF;</li>
</ul>
</li>
<li>&#x53EF;&#x4EE5;&#x4E0B;&#x8F7D;&#x4E00;&#x4E2A;phpStudy&#x6A21;&#x62DF;mysql&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x6253;&#x5F00;mysql&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x5EFA;&#x8868;&#xFF0C;&#x7136;&#x540E;&#x521B;&#x5EFA;http&#x670D;&#x52A1;&#xFF0C;&#x8FDE;&#x63A5;&#x6570;&#x636E;&#x5E93;<ul>
<li>&#x5BFC;&#x5165;mysql&#x6A21;&#x5757;&#xFF0C;&#x901A;&#x8FC7;createConnection&#x8FDE;&#x63A5;&#x6570;&#x636E;&#x5E93;</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">javascript&#x590D;&#x5236;&#x4EE3;&#x7801;//&#x5BFC;&#x5165;mysql&#x6A21;&#x5757;</span><br><span class="line">const mysql  = require(&quot;mysql&quot;);</span><br><span class="line"></span><br><span class="line">// &#x521B;&#x5EFA;mysql&#x7684;&#x8FDE;&#x63A5;&#x5BF9;&#x8C61;</span><br><span class="line">const conn=mysql.createConnection({</span><br><span class="line">  host:&apos;localhost&apos;,// &#x57DF;&#x540D;&#x6216;&#x8005;ip</span><br><span class="line">  user:&quot;root&quot;,//&#x521B;&#x5EFA;&#x7684;mysql&#x6570;&#x636E;&#x5E93;&#x7528;&#x6237;&#x540D;</span><br><span class="line">  password:&apos;root&apos;, //&#x521B;&#x5EFA;&#x7684;mysql&#x6570;&#x636E;&#x5E93;&#x5BC6;&#x7801;</span><br><span class="line">  database:&apos;mysql_001&apos;//&#x521B;&#x5EFA;&#x7684;mysql&#x6570;&#x636E;&#x5E93;&#x540D;&#x79F0;</span><br><span class="line">})</span><br></pre></td></tr></table></figure>

<p>2&#x3001;&#x6570;&#x636E;&#x7684;&#x589E;&#x5220;&#x6539;&#x67E5;&#xFF0C;node&#x4E2D;&#x7684;sql&#x8BED;&#x53E5;&#x548C;&#x522B;&#x7684;&#x8BED;&#x8A00;&#x7684;sql&#x8BED;&#x53E5;&#x53EF;&#x80FD;&#x4E2A;&#x522B;&#x7684;&#x5730;&#x65B9;&#x4F1A;&#x4E0D;&#x7528;&#x4E0D;&#x540C;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x7684;&#x65F6;&#x5019;&#x4E00;&#x5B9A;&#x8981;&#x591A;&#x67E5;&#x6587;&#x6863;</p>
<ul>
<li>&#x67E5;&#x8BE2;&#x8BED;&#x53E5;<ul>
<li>select&#x67E5;&#x8BE2; <code>select * from users</code> *&#x4EE3;&#x8868;&#x5168;&#x67E5;&#xFF0C;users&#x662F;&#x88AB;&#x67E5;&#x8BE2;&#x7684;&#x521B;&#x5EFA;&#x7684;&#x8868;&#x540D;</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">javascript&#x590D;&#x5236;&#x4EE3;&#x7801;// &#x76F4;&#x63A5;&#x8C03;&#x7528;conn.query(`&#x8981;&#x6267;&#x884C;&#x7684;sql&#x8BED;&#x53E5;`,(err,resule)=&gt;{}&#x65B9;&#x6CD5;&#x6267;&#x884C;sql&#x8BED;&#x53E5;&#x5C31;&#x884C;)</span><br><span class="line">const sqlStr=&apos;select * from users&apos;</span><br><span class="line">conn.query(sqlStr,(err,res)=&gt;{</span><br><span class="line">  if(err) return console.log(&apos;&#x83B7;&#x53D6;&#x6570;&#x636E;&#x5931;&#x8D25;&apos;+ err.message);</span><br><span class="line">  console.log(res);</span><br><span class="line">})</span><br></pre></td></tr></table></figure>

<ul>
<li>&#x65B0;&#x589E;&#x8BED;&#x53E5;<ul>
<li>insert&#x63D2;&#x5165; <code>insert into users set?</code> insert&#x662F;&#x63D2;&#x5165;&#xFF0C;users&#x662F;&#x88AB;&#x64CD;&#x4F5C;&#x7684;&#x8868;&#xFF0C;?&#x662F;&#x4E00;&#x4E2A;&#x5360;&#x4F4D;&#x7B26;&#xFF0C;&#x6267;&#x884C;&#x8BED;&#x53E5;&#x7684;&#x65F6;&#x5019;&#x9700;&#x8981;&#x63D2;&#x5165;&#x7684;&#x6570;&#x636E;&#x5C31;&#x4F1A;&#x66FF;&#x4EE3; ?</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">javascript&#x590D;&#x5236;&#x4EE3;&#x7801;// &#x65B0;&#x589E;</span><br><span class="line">const users={usename:&quot;&#x5C0F;&#x5A1F;&quot;,age:22,gender:&apos;&#x5973;&apos;}</span><br><span class="line">const sqlStr2=&apos;insert into users set?&apos;</span><br><span class="line">conn.query(sqlStr2,users,(err,res)=&gt;{</span><br><span class="line">  if(err) return console.log(&apos;&#x65B0;&#x589E;&#x6570;&#x636E;&#x51FA;&#x9519;&apos;+err.message);</span><br><span class="line">  console.log(res);</span><br><span class="line">})</span><br></pre></td></tr></table></figure>

<ul>
<li>&#x4FEE;&#x6539;&#x8BED;&#x53E5;<ul>
<li>update&#x66F4;&#x65B0; <code>update users set ? where id=?</code> &#x5728;node&#x4E2D;&#x53EA;&#x8981;&#x662F;&#x9700;&#x8981;&#x67E5;&#x8BE2;&#x6216;&#x8005;&#x66FF;&#x6362;&#x7684;&#x5730;&#x65B9;&#x90FD;&#x8981;&#x4F7F;&#x7528;?&#x4EE3;&#x66FF; where &#x540E;&#x9762;&#x7D27;&#x8DDF;&#x67E5;&#x8BE2;&#x6761;&#x4EF6;</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">javascript&#x590D;&#x5236;&#x4EE3;&#x7801;// &#x4FEE;&#x6539;</span><br><span class="line">const users={id:2,usename:&quot;&#x5C0F;&#x7F8E;&quot;,age:22,gender:&apos;&#x5973;&apos;}</span><br><span class="line">const sqlStr3=&apos;update users set ? where id=?&apos;</span><br><span class="line">// &#x6CE8;&#x610F;&#xFF0C;&#x5728;&#x6267;&#x884C;query&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5982;&#x679C;sql&#x8BED;&#x53E5;&#x4E2D;&#xFF0C;&#x5305;&#x542B;&#x4E86;&#x591A;&#x4E2A; ? &#x5360;&#x4F4D;&#x7B26;&#xFF0C;&#x5219;&#x7B2C;&#x4E8C;&#x4E2A;&#x5B9E;&#x53C2;&#x5FC5;&#x987B;</span><br><span class="line">// &#x4F20;&#x9012;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;&#xFF0C;&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x6BCF;&#x4E00;&#x9879;&#xFF0C;&#x90FD;&#x8981;&#x548C;sql&#x8BED;&#x53E5;&#x4E2D;&#x7684; ? &#x5BF9;&#x5E94;&#x4E0A;</span><br><span class="line">conn.query(sqlStr3,[users,users.id],(err,res)=&gt;{</span><br><span class="line">  if(err) return console.log(&apos;&#x4FEE;&#x6539;&#x6570;&#x636E;&#x51FA;&#x9519;&apos;+err.message);</span><br><span class="line">  console.log(res);</span><br><span class="line">})</span><br></pre></td></tr></table></figure>

<ul>
<li>&#x5220;&#x9664;&#x8BED;&#x53E5;<ul>
<li>delete&#x5220;&#x9664; <code>delete from users where id=?</code> delete&#x5220;&#x9664;&#xFF0C;users&#x662F;&#x88AB;&#x64CD;&#x4F5C;&#x7684;&#x8868;&#xFF0C;?&#x88AB;&#x5220;&#x9664;&#x7684;id&#x503C;</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">javascript&#x590D;&#x5236;&#x4EE3;&#x7801;// &#x5220;&#x9664;</span><br><span class="line">const sqlStr4=&apos;delete from users where id=?&apos;</span><br><span class="line">conn.query(sqlStr4,5,(err,res)=&gt;{</span><br><span class="line">  if(err) return console.log(&apos;&#x5220;&#x9664;&#x6570;&#x636E;&#x51FA;&#x9519;&apos;+err.message);</span><br><span class="line">  console.log(res);</span><br><span class="line">})</span><br></pre></td></tr></table></figure>

<h2 id="&#x7BC7;&#x4E8C;&#xFF1A;&#x6A21;&#x5757;&#x7684;&#x52A0;&#x8F7D;&#x673A;&#x5236;"><a href="#&#x7BC7;&#x4E8C;&#xFF1A;&#x6A21;&#x5757;&#x7684;&#x52A0;&#x8F7D;&#x673A;&#x5236;" class="headerlink" title="&#x7BC7;&#x4E8C;&#xFF1A;&#x6A21;&#x5757;&#x7684;&#x52A0;&#x8F7D;&#x673A;&#x5236;"></a>&#x7BC7;&#x4E8C;&#xFF1A;&#x6A21;&#x5757;&#x7684;&#x52A0;&#x8F7D;&#x673A;&#x5236;</h2><ul>
<li>&#x4F18;&#x5148;&#x4ECE;&#x7F13;&#x5B58;&#x4E2D;&#x52A0;&#x8F7D;<ul>
<li>&#x5F53;&#x4E00;&#x4E2A;&#x6A21;&#x5757;&#x521D;&#x6B21;&#x88AB; require &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x6267;&#x884C;&#x6A21;&#x5757;&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x5F53;&#x7B2C;&#x4E8C;&#x6B21;&#x52A0;&#x8F7D;&#x76F8;&#x540C;&#x6A21;&#x5757;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x4F18;&#x5148;&#x4ECE;&#x7F13;&#x5B58;&#x4E2D;&#x67E5;&#x627E;&#xFF0C;&#x770B;&#x6709;&#x6CA1;&#x6709;&#x8FD9;&#x6837;&#x7684;&#x4E00;&#x4E2A;&#x6A21;&#x5757;&#xFF01;</li>
<li>&#x597D;&#x5904;&#xFF1A;&#x63D0;&#x9AD8;&#x6A21;&#x5757;&#x7684;&#x52A0;&#x8F7D;&#x901F;&#x5EA6;&#xFF1B;&#x4E0D;&#x9700;&#x8981;&#x6BCF;&#x6B21;&#x90FD;&#x91CD;&#x65B0;&#x6267;&#x884C;&#x5E76;&#x52A0;&#x8F7D;&#x6A21;&#x5757;&#xFF01;</li>
</ul>
</li>
<li>&#x6838;&#x5FC3;&#x6A21;&#x5757;&#x7684;&#x52A0;&#x8F7D;&#x673A;&#x5236;<ul>
<li>&#x5148;&#x67E5;&#x627E;&#x7F13;&#x5B58;&#xFF1B;&#x5982;&#x679C;&#x7F13;&#x5B58;&#x4E2D;&#x6CA1;&#x6709;&#xFF0C;&#x518D;&#x53BB;&#x52A0;&#x8F7D;&#x6838;&#x5FC3;&#x6A21;&#x5757;&#xFF1B;</li>
</ul>
</li>
<li>&#x7528;&#x6237;&#x6A21;&#x5757;&#x7684;&#x52A0;&#x8F7D;&#x673A;&#x5236;<ul>
<li>&#x5148;&#x67E5;&#x627E;&#x7F13;&#x5B58;&#xFF1B;</li>
<li>&#x5982;&#x679C;&#x7F13;&#x5B58;&#x4E2D;&#x6CA1;&#x6709;&#x5219;&#x5C1D;&#x8BD5;&#x52A0;&#x8F7D;&#x7528;&#x6237;&#x6A21;&#x5757;&#xFF1B;</li>
<li>&#x5982;&#x679C;&#x5728;&#x52A0;&#x8F7D;&#x7528;&#x6237;&#x6A21;&#x5757;&#x65F6;&#x5019;&#x7701;&#x7565;&#x4E86;&#x540E;&#x7F00;&#x540D;&#xFF0C;&#x5219;&#xFF1A;<ul>
<li>&#x9996;&#x5148;&#xFF0C;&#x4E25;&#x683C;&#x6309;&#x7167;&#x6307;&#x5B9A;&#x7684;&#x540D;&#x79F0;&#x53BB;&#x67E5;&#x627E;</li>
<li>&#x5176;&#x6B21;&#xFF0C;&#x5C1D;&#x8BD5;&#x52A0;&#x8F7D;&#x540E;&#x7F00;&#x540D;&#x662F; .js &#x7684;&#x6587;&#x4EF6;</li>
<li>&#x5982;&#x679C;&#x6CA1;&#x6709;.js&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x5219;&#x5C1D;&#x8BD5;&#x52A0;&#x8F7D; .json &#x7ED3;&#x5C3E;&#x7684;&#x6587;&#x4EF6;</li>
<li>&#x5982;&#x679C;&#x6CA1;&#x6709; .json &#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x5219;&#x5C1D;&#x8BD5;&#x52A0;&#x8F7D; .node &#x7ED3;&#x5C3E;&#x7684;&#x6587;&#x4EF6;</li>
<li>&#x67E5;&#x627E;&#x89C4;&#x5219;&#xFF1A;index -&gt; index.js -&gt; index.json -&gt; index.node</li>
</ul>
</li>
</ul>
</li>
<li>&#x7B2C;&#x4E09;&#x65B9;&#x6A21;&#x5757;&#x7684;&#x52A0;&#x8F7D;&#x673A;&#x5236;<ul>
<li>&#x5148;&#x5728;&#x9879;&#x76EE;&#x6839;&#x76EE;&#x5F55;&#x4E2D;&#x67E5;&#x627E;node_modules&#x6587;&#x4EF6;&#x5939;</li>
<li>&#x5728;node_modules&#x6587;&#x4EF6;&#x5939;&#x4E0B;&#xFF0C;&#x67E5;&#x627E;&#x6A21;&#x5757;&#x76F8;&#x5173;&#x7684;&#x6587;&#x4EF6;&#x5939;</li>
<li>&#x5728;&#x5BF9;&#x5E94;&#x7684;&#x6587;&#x4EF6;&#x5939;&#x4E0B;&#xFF0C;&#x67E5;&#x627E;package.json&#x7684;&#x6587;&#x4EF6;</li>
<li>&#x67E5;&#x627E;package.json&#x6587;&#x4EF6;&#x4E2D;&#x7684;main&#x5C5E;&#x6027;&#xFF08;&#x6307;&#x5B9A;&#x4E86;&#x6A21;&#x5757;&#x7684;&#x5165;&#x53E3;&#x6587;&#x4EF6;&#xFF09;</li>
<li>&#x5982;&#x679C;&#x627E;&#x5230;&#x4E86;main&#x5C5E;&#x6027;&#xFF0C;&#x540C;&#x65F6;&#xFF0C;main&#x5C5E;&#x6027;&#x6307;&#x5B9A;&#x7684;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x5B58;&#x5728;&#xFF0C;&#x90A3;&#x4E48;&#x5C1D;&#x8BD5;&#x52A0;&#x8F7D;&#x6307;&#x5B9A;&#x7684;&#x6587;&#x4EF6;&#x6A21;&#x5757;</li>
<li>&#x52A0;&#x5165;&#x6CA1;&#x6709;main&#x5C5E;&#x6027;&#xFF0C;&#x6216;&#x8005;main&#x5C5E;&#x6027;&#x5BF9;&#x5E94;&#x7684;&#x6587;&#x4EF6;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x6216;&#x8005;&#x6CA1;&#x6709;package.json,&#x90A3;&#x4E48;&#x4F1A;&#x4F9D;&#x6B21;&#x5C1D;&#x8BD5;&#x52A0;&#x8F7D;index.js&#xFF0C;index.json,index.node;</li>
<li>&#x5982;&#x679C;&#x6CA1;&#x6709;index&#x76F8;&#x5173;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x6216;&#x8005;&#x6CA1;&#x6709;&#x6307;&#x5B9A;&#x6A21;&#x5757;&#x5BF9;&#x5E94;&#x6587;&#x4EF6;&#x5939;&#xFF0C;&#x6216;&#x8005;&#xFF0C;&#x5F53;&#x524D;&#x9879;&#x76EE;&#x6839;&#x76EE;&#x5F55;&#x4E2D;&#x6CA1;&#x6709;node_modules&#x6587;&#x4EF6;&#x5939;&#xFF0C;&#x5219;&#x5411;&#x4E0A;&#x4E00;&#x5C42;&#x76EE;&#x5F55;&#x4E2D;&#x67E5;&#x627E;node_modules&#xFF0C;&#x67E5;&#x627E;&#x89C4;&#x5219;&#x540C;&#x4E0A;&#xFF01;</li>
<li>&#x6700;&#x540E;&#xFF0C;&#x5982;&#x679C;&#x5728;&#x9879;&#x76EE;&#x6240;&#x5728;&#x78C1;&#x76D8;&#x7684;&#x76D8;&#x7B26;&#x6839;&#x76EE;&#x5F55;&#x4E2D;&#xFF0C;&#x8FD8;&#x627E;&#x4E0D;&#x5230;&#x5BF9;&#x5E94;&#x6A21;&#x5757;&#xFF0C;&#x5219;&#x62A5;&#x9519;&#xFF1A;cannot find module ***</li>
</ul>
</li>
</ul>
<h2 id="&#x7BC7;&#x4E09;&#xFF1A;express&#x4E2D;&#x83B7;&#x53D6;&#x53C2;&#x6570;&#x7684;&#x51E0;&#x79CD;&#x5F62;&#x5F0F;"><a href="#&#x7BC7;&#x4E09;&#xFF1A;express&#x4E2D;&#x83B7;&#x53D6;&#x53C2;&#x6570;&#x7684;&#x51E0;&#x79CD;&#x5F62;&#x5F0F;" class="headerlink" title="&#x7BC7;&#x4E09;&#xFF1A;express&#x4E2D;&#x83B7;&#x53D6;&#x53C2;&#x6570;&#x7684;&#x51E0;&#x79CD;&#x5F62;&#x5F0F;"></a>&#x7BC7;&#x4E09;&#xFF1A;express&#x4E2D;&#x83B7;&#x53D6;&#x53C2;&#x6570;&#x7684;&#x51E0;&#x79CD;&#x5F62;&#x5F0F;</h2><ul>
<li>&#x83B7;&#x53D6;<code>?id=10&amp;name=zs</code>&#x4E2D;&#x7684;&#x67E5;&#x8BE2;&#x53C2;&#x6570;&#xFF1A;<ul>
<li>&#x76F4;&#x63A5;&#x4F7F;&#x7528; <code>req.query</code> &#x83B7;&#x53D6;&#x53C2;&#x6570;&#x5373;&#x53EF;&#xFF1B;</li>
<li>&#x6CE8;&#x610F;&#xFF1A;URL &#x5730;&#x5740;&#x680F;&#x4E2D;&#x901A;&#x8FC7; &#x67E5;&#x8BE2;&#x5B57;&#x7B26;&#x4E32; &#x4F20;&#x9012;&#x7684;&#x53C2;&#x6570;&#xFF0C;express &#x6846;&#x67B6;&#x4F1A;&#x76F4;&#x63A5;&#x89E3;&#x6790;&#xFF0C;&#x5927;&#x5BB6;&#x53EA;&#x9700;&#x8981;&#x4F7F;&#x7528; <code>req.query</code> &#x76F4;&#x63A5;&#x83B7;&#x53D6; URL &#x4E2D; &#x67E5;&#x8BE2;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x53C2;&#x6570;&#xFF1B;</li>
</ul>
</li>
<li>&#x4ECE;URL&#x5730;&#x5740;&#x4E2D;&#x83B7;&#x53D6;&#x8DEF;&#x5F84;&#x53C2;&#x6570;&#xFF1A;<ul>
<li>&#x5047;&#x8BBE;&#x540E;&#x53F0;&#x7684;&#x8DEF;&#x7531;&#x662F; <code>app.get(&apos;/user/:id/:name&apos;, (req, res) =&gt; {})</code></li>
<li>&#x5047;&#x8BBE;&#x5BA2;&#x6237;&#x7AEF;&#x6D4F;&#x89C8;&#x5668;&#x8BF7;&#x6C42;&#x7684;URL&#x5730;&#x5740;&#x4E3A;&#xFF1A;<code>http://127.0.0.1:3001/user/10/zs</code></li>
<li>&#x76F4;&#x63A5;&#x4F7F;&#x7528;<code>req.params</code>&#x53EF;&#x4EE5;&#x83B7;&#x53D6;URL&#x5730;&#x5740;&#x4E2D;&#x4F20;&#x9012;&#x8FC7;&#x6765;&#x7684;&#x53C2;&#x6570;&#xFF1B;</li>
</ul>
</li>
<li>&#x4ECE;post&#x8868;&#x5355;&#x4E2D;&#x83B7;&#x53D6;&#x63D0;&#x4EA4;&#x7684;&#x6570;&#x636E;&#xFF1A;<ul>
<li>&#x501F;&#x52A9;&#x4E8E;<code>body-parser</code>&#x6765;&#x89E3;&#x6790;&#x8868;&#x5355;&#x6570;&#x636E;</li>
<li>&#x5B89;&#x88C5;&#xFF1A;<code>npm i body-parser -S</code></li>
<li>&#x5BFC;&#x5165;&#xFF1A;<code>const bodyParser = require(&apos;body-parser&apos;)</code></li>
<li>&#x6CE8;&#x518C;&#x4E2D;&#x95F4;&#x4EF6;&#xFF1A;<code>app.use(bodyParser.urlencoded({ extended: false }))</code></li>
<li>&#x4F7F;&#x7528;&#x89E3;&#x6790;&#x7684;&#x6570;&#x636E;&#xFF1A; <code>req.body</code> &#x6765;&#x8BBF;&#x95EE;&#x89E3;&#x6790;&#x51FA;&#x6765;&#x7684;&#x6570;&#x636E;</li>
</ul>
</li>
</ul>
<h2 id="&#x7BC7;&#x56DB;&#xFF1A;&#x5B9E;&#x73B0;&#x524D;&#x540E;&#x7AEF;&#x5206;&#x79BB;&#x9879;&#x76EE;&#x8DE8;&#x57DF;&#x7684;&#x89E3;&#x51B3;"><a href="#&#x7BC7;&#x56DB;&#xFF1A;&#x5B9E;&#x73B0;&#x524D;&#x540E;&#x7AEF;&#x5206;&#x79BB;&#x9879;&#x76EE;&#x8DE8;&#x57DF;&#x7684;&#x89E3;&#x51B3;" class="headerlink" title="&#x7BC7;&#x56DB;&#xFF1A;&#x5B9E;&#x73B0;&#x524D;&#x540E;&#x7AEF;&#x5206;&#x79BB;&#x9879;&#x76EE;&#x8DE8;&#x57DF;&#x7684;&#x89E3;&#x51B3;"></a>&#x7BC7;&#x56DB;&#xFF1A;&#x5B9E;&#x73B0;&#x524D;&#x540E;&#x7AEF;&#x5206;&#x79BB;&#x9879;&#x76EE;&#x8DE8;&#x57DF;&#x7684;&#x89E3;&#x51B3;</h2><ul>
<li>&#x524D;&#x7AEF;&#x548C;&#x540E;&#x7AEF;&#x8FD0;&#x884C;&#x7684;&#x7AEF;&#x53E3;&#x53F7;&#x4E0D;&#x540C;&#x9020;&#x6210;&#x8DE8;&#x57DF;<ul>
<li>jsonp&#x548C;COR&#x53EF;&#x4EE5;&#x5F88;&#x597D;&#x7684;&#x89E3;&#x51B3;&#x8DE8;&#x57DF;&#x95EE;&#x9898;<ul>
<li>jsonp&#xFF1A; &#x52A8;&#x6001;&#x521B;&#x5EFA;script&#x6807;&#x7B7E;&#xFF1B;<ul>
<li>JSONP&#x53D1;&#x9001;&#x7684;&#x4E0D;&#x662F;Ajax&#x8BF7;&#x6C42;</li>
<li>&#x4E0D;&#x652F;&#x6301; Post &#x8BF7;&#x6C42;&#xFF1B;</li>
</ul>
</li>
<li>CORS&#x4E2D;&#x6587;&#x610F;&#x601D;&#x662F;&#x8DE8;&#x57DF;&#x8D44;&#x6E90;&#x5171;&#x4EAB; ,&#x9700;&#x8981;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x8FDB;&#x884C; CORS &#x914D;&#x7F6E;&#xFF1B;<ul>
<li>CORS &#x53D1;&#x9001;&#x7684;&#x662F;&#x771F;&#x6B63;&#x7684;Ajax&#x8BF7;&#x6C42;</li>
<li>CORS &#x652F;&#x6301;Ajax&#x7684;&#x8DE8;&#x57DF;</li>
<li>&#x5982;&#x679C;&#x8981;&#x542F;&#x7528; CORS &#x8DE8;&#x57DF;&#x8D44;&#x6E90;&#x5171;&#x4EAB;&#xFF0C;&#x5173;&#x952E;&#x5728;&#x4E8E; &#x670D;&#x52A1;&#x5668;&#x7AEF;&#xFF0C;&#x53EA;&#x8981; &#x670D;&#x52A1;&#x5668;&#x652F;&#x6301;CORS&#x8DE8;&#x57DF;&#x8D44;&#x6E90;&#x5171;&#x4EAB;&#xFF0C;&#x5219; &#x6D4F;&#x89C8;&#x5668;&#x80AF;&#x5B9A;&#x80FD;&#x591F;&#x6B63;&#x5E38;&#x8BBF;&#x95EE; &#x8FD9;&#x79CD; CORS &#x63A5;&#x53E3;&#xFF1B;&#x800C;&#x4E14;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x5728; &#x53D1;&#x9001; Ajax&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x50CF;&#x53D1;&#x9001;&#x666E;&#x901A;AJax&#x4E00;&#x6837;&#xFF0C;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x4EE3;&#x7801;&#x4E0A;&#x7684;&#x53D8;&#x5316;&#xFF1B;</li>
</ul>
</li>
<li>&#x5BF9;&#x4E8E;Node&#x6765;&#x8BF4;&#xFF0C;&#x5982;&#x679C;&#x60F3;&#x8981;&#x5F00;&#x542F; CORS &#x8DE8;&#x57DF;&#x901A;&#x4FE1;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x5B89;&#x88C5;cors&#x7684;&#x6A21;&#x5757;&#x5373;&#x53EF;&#xFF1B;</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">php&#x590D;&#x5236;&#x4EE3;&#x7801;//&#x89E3;&#x51B3;&#x8DE8;&#x57DF;</span><br><span class="line">//1.&#x5B89;&#x88C5;cors&#xFF1A;npm install cors -S</span><br><span class="line">//2.&#x5F15;&#x5165;&#x4E2D;&#x95F4;&#x4EF6;</span><br><span class="line">const cors=require(&apos;cors&apos;)</span><br><span class="line">//3.&#x6CE8;&#x518C;&#x4E2D;&#x95F4;&#x4EF6;</span><br><span class="line">app.use(cors())</span><br></pre></td></tr></table></figure>

<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/fa7098ecf51c47b04339582957fcc5e6.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6946905410087419941.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6946905410087419941.html" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-04-03T20:21:15+08:00">
                2021-04-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Joi&#x662F;&#x4EC0;&#x4E48;&#xFF1F;"><a href="#Joi&#x662F;&#x4EC0;&#x4E48;&#xFF1F;" class="headerlink" title="Joi&#x662F;&#x4EC0;&#x4E48;&#xFF1F;"></a>Joi&#x662F;&#x4EC0;&#x4E48;&#xFF1F;</h3><p>&#x5B98;&#x65B9;&#x6587;&#x6863;&#x63CF;&#x8FF0;&#x662F;&#xFF1A;joi lets you describe your data using a simple, intuitive, and readable language.<br>&#x7B80;&#x5355;&#x7406;&#x89E3;&#x5C31;&#x662F;&#xFF1A;&#x53EF;&#x4EE5;&#x7B80;&#x5355;&#x76F4;&#x63A5;&#x63CF;&#x8FF0;&#x4F60;&#x7684;&#x6570;&#x636E;&#x6A21;&#x578B;&#x7684;&#x8BED;&#x8A00;&#x3002;<br>&#x6240;&#x4EE5;&#x91CD;&#x70B9;&#x662F;&#x63CF;&#x8FF0;&#xFF0C;&#x7136;&#x540E;&#x6821;&#x9A8C;&#x5F88;&#x7B80;&#x5355;&#x3002;<br>&#x5B98;&#x65B9;&#x6587;&#x6863;&#x5730;&#x5740;&#xFF1A;<a href="/external_links/abc470f70981dd122e3473ed41cffd1c.html" target="blank" rel="noopener">joi.dev/api/?v=17.4&#x2026;</a></p>
<h3 id="&#x5B89;&#x88C5;"><a href="#&#x5B89;&#x88C5;" class="headerlink" title="&#x5B89;&#x88C5;"></a>&#x5B89;&#x88C5;</h3><p>&#x5728;&#x9879;&#x76EE;&#x76EE;&#x5F55;&#x91CC;&#x6267;&#x884C; npm i joi</p>
<h3 id="&#x8BD5;&#x7528;&#x73AF;&#x5883;"><a href="#&#x8BD5;&#x7528;&#x73AF;&#x5883;" class="headerlink" title="&#x8BD5;&#x7528;&#x73AF;&#x5883;"></a>&#x8BD5;&#x7528;&#x73AF;&#x5883;</h3><p>@google-cloud/functions-framework</p>
<h3 id="&#x7B80;&#x5355;&#x8BD5;&#x7528;"><a href="#&#x7B80;&#x5355;&#x8BD5;&#x7528;" class="headerlink" title="&#x7B80;&#x5355;&#x8BD5;&#x7528;"></a>&#x7B80;&#x5355;&#x8BD5;&#x7528;</h3><p>&#x5BF9;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x578B;&#x53C2;&#x6570;&#x8FDB;&#x884C;&#x6821;&#x9A8C;<br>&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">vbnet&#x590D;&#x5236;&#x4EE3;&#x7801;const Joi = require(&apos;joi&apos;);</span><br><span class="line">const schema = Joi.object({</span><br><span class="line">username: Joi.string()</span><br><span class="line">  .alphanum()</span><br><span class="line">  .min(3)</span><br><span class="line">  .max(30)</span><br><span class="line">})</span><br><span class="line"></span><br><span class="line">exports.helloWorld = (req, res) =&gt; {</span><br><span class="line">  const { error, value } = schema.validate(req.query)</span><br><span class="line">  if (error) {</span><br><span class="line">    return res.status(422).json({ error: error })</span><br><span class="line">  }</span><br><span class="line">  res.send(&apos;Hello, World&apos;) </span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x6548;&#x679C;&#x5982;&#x4E0B;&#xFF1A;<br>&#x8BBF;&#x95EE; <a href="/external_links/9825c2a542dd888e55b9b0e06b04f672.html" target="blank" rel="noopener">http://localhost:8080/</a><br>&#x8FD4;&#x56DE; Hello, World<br>&#x8BBF;&#x95EE; <a href="/external_links/ded57fe34cf208517881e06a90f1748c.html" target="blank" rel="noopener">http://localhost:8080/?username=aaaa</a><br>&#x8FD4;&#x56DE; Hello, World<br>&#x8BBF;&#x95EE; <a href="/external_links/61fe95787d267565359d26c56a37ad45.html" target="blank" rel="noopener">http://localhost:8080/?username=aa</a><br>&#x8FD4;&#x56DE;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">swift&#x590D;&#x5236;&#x4EE3;&#x7801;{</span><br><span class="line">    &quot;error&quot;: {</span><br><span class="line">        &quot;_original&quot;: {</span><br><span class="line">            &quot;username&quot;: &quot;aa&quot;</span><br><span class="line">        },</span><br><span class="line">        &quot;details&quot;: [</span><br><span class="line">            {</span><br><span class="line">                &quot;message&quot;: &quot;\&quot;username\&quot; length must be at least 3 characters long&quot;,</span><br><span class="line">                &quot;path&quot;: [</span><br><span class="line">                    &quot;username&quot;</span><br><span class="line">                ],</span><br><span class="line">                &quot;type&quot;: &quot;string.min&quot;,</span><br><span class="line">                &quot;context&quot;: {</span><br><span class="line">                    &quot;limit&quot;: 3,</span><br><span class="line">                    &quot;value&quot;: &quot;aa&quot;,</span><br><span class="line">                    &quot;label&quot;: &quot;username&quot;,</span><br><span class="line">                    &quot;key&quot;: &quot;username&quot;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        ]</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8BBF;&#x95EE; <a href="/external_links/ae775ff684d7f3af1e7385c443fdc6ac.html" target="blank" rel="noopener">http://localhost:8080/?username=aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</a></p>
<p>&#x8FD4;&#x56DE;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">swift&#x590D;&#x5236;&#x4EE3;&#x7801;{</span><br><span class="line">    &quot;error&quot;: {</span><br><span class="line">        &quot;_original&quot;: {</span><br><span class="line">            &quot;username&quot;: &quot;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot;</span><br><span class="line">        },</span><br><span class="line">        &quot;details&quot;: [</span><br><span class="line">            {</span><br><span class="line">                &quot;message&quot;: &quot;\&quot;username\&quot; length must be less than or equal to 30 characters long&quot;,</span><br><span class="line">                &quot;path&quot;: [</span><br><span class="line">                    &quot;username&quot;</span><br><span class="line">                ],</span><br><span class="line">                &quot;type&quot;: &quot;string.max&quot;,</span><br><span class="line">                &quot;context&quot;: {</span><br><span class="line">                    &quot;limit&quot;: 30,</span><br><span class="line">                    &quot;value&quot;: &quot;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot;,</span><br><span class="line">                    &quot;label&quot;: &quot;username&quot;,</span><br><span class="line">                    &quot;key&quot;: &quot;username&quot;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        ]</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8BBF;&#x95EE; <a href="/external_links/d7655979374f74046419772a308abe6e.html" target="blank" rel="noopener">http://localhost:8080/?username=aaaa&amp;password=1234</a></p>
<p>&#x8FD4;&#x56DE;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">swift&#x590D;&#x5236;&#x4EE3;&#x7801;{</span><br><span class="line">    &quot;error&quot;: {</span><br><span class="line">        &quot;_original&quot;: {</span><br><span class="line">            &quot;username&quot;: &quot;aaaa&quot;,</span><br><span class="line">            &quot;password&quot;: &quot;1234&quot;</span><br><span class="line">        },</span><br><span class="line">        &quot;details&quot;: [</span><br><span class="line">            {</span><br><span class="line">                &quot;message&quot;: &quot;\&quot;password\&quot; is not allowed&quot;,</span><br><span class="line">                &quot;path&quot;: [</span><br><span class="line">                    &quot;password&quot;</span><br><span class="line">                ],</span><br><span class="line">                &quot;type&quot;: &quot;object.unknown&quot;,</span><br><span class="line">                &quot;context&quot;: {</span><br><span class="line">                    &quot;child&quot;: &quot;password&quot;,</span><br><span class="line">                    &quot;label&quot;: &quot;password&quot;,</span><br><span class="line">                    &quot;value&quot;: &quot;1234&quot;,</span><br><span class="line">                    &quot;key&quot;: &quot;password&quot;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        ]</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="&#x5BF9;body&#x8FDB;&#x884C;&#x6821;&#x9A8C;"><a href="#&#x5BF9;body&#x8FDB;&#x884C;&#x6821;&#x9A8C;" class="headerlink" title="&#x5BF9;body&#x8FDB;&#x884C;&#x6821;&#x9A8C;"></a>&#x5BF9;body&#x8FDB;&#x884C;&#x6821;&#x9A8C;</h3><p>&#x589E;&#x52A0;&#x5FC5;&#x586B;&#x6821;&#x9A8C;<br>&#x4EE3;&#x7801;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">scss&#x590D;&#x5236;&#x4EE3;&#x7801;const Joi = require(&apos;joi&apos;);</span><br><span class="line">const schema = Joi.object({</span><br><span class="line">    username: Joi.string()</span><br><span class="line">        .alphanum()</span><br><span class="line">        .min(3)</span><br><span class="line">        .max(30),</span><br><span class="line">    password: Joi.string()</span><br><span class="line">        .alphanum()</span><br><span class="line">        .min(6)</span><br><span class="line">        .max(12)</span><br><span class="line">})</span><br><span class="line"></span><br><span class="line">exports.helloWorld = (req, res) =&gt; {</span><br><span class="line">    const { error, value } = schema.validate(req.body)</span><br><span class="line">    if (error) {</span><br><span class="line">        return res.status(422).json({ error: error })</span><br><span class="line">    }</span><br><span class="line">    console.info(value)</span><br><span class="line">    res.send(value)</span><br><span class="line">};</span><br></pre></td></tr></table></figure>

<p>&#x7528;postman&#x8BBF;&#x95EE;<a href="/external_links/37d007a56d816107ce5b52c10342db37.html" target="blank" rel="noopener">http://localhost:8080</a><br>&#x8F93;&#x5165;&#x6570;&#x636E;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">json&#x590D;&#x5236;&#x4EE3;&#x7801;{</span><br><span class="line">    &quot;username&quot;: &quot;postman&quot;,</span><br><span class="line">    &quot;password&quot;: &quot;123456&quot;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8FD4;&#x56DE;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">json&#x590D;&#x5236;&#x4EE3;&#x7801;{</span><br><span class="line">    &quot;username&quot;: &quot;postman&quot;,</span><br><span class="line">    &quot;password&quot;: &quot;123456&quot;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8F93;&#x5165;&#x6570;&#x636E;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">json&#x590D;&#x5236;&#x4EE3;&#x7801;{</span><br><span class="line">    &quot;username&quot;: &quot;postman&quot;,</span><br><span class="line">    &quot;password&quot;: &quot;123456&quot;,</span><br><span class="line">		&quot;age&quot;:30</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8FD4;&#x56DE;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">swift&#x590D;&#x5236;&#x4EE3;&#x7801;{</span><br><span class="line">    &quot;error&quot;: {</span><br><span class="line">        &quot;_original&quot;: {</span><br><span class="line">            &quot;username&quot;: &quot;postman&quot;,</span><br><span class="line">            &quot;password&quot;: &quot;123456&quot;,</span><br><span class="line">            &quot;age&quot;: &quot;30&quot;</span><br><span class="line">        },</span><br><span class="line">        &quot;details&quot;: [</span><br><span class="line">            {</span><br><span class="line">                &quot;message&quot;: &quot;\&quot;age\&quot; is not allowed&quot;,</span><br><span class="line">                &quot;path&quot;: [</span><br><span class="line">                    &quot;age&quot;</span><br><span class="line">                ],</span><br><span class="line">                &quot;type&quot;: &quot;object.unknown&quot;,</span><br><span class="line">                &quot;context&quot;: {</span><br><span class="line">                    &quot;child&quot;: &quot;age&quot;,</span><br><span class="line">                    &quot;label&quot;: &quot;age&quot;,</span><br><span class="line">                    &quot;value&quot;: &quot;30&quot;,</span><br><span class="line">                    &quot;key&quot;: &quot;age&quot;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        ]</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8F93;&#x5165;&#x6570;&#x636E;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">json&#x590D;&#x5236;&#x4EE3;&#x7801;{</span><br><span class="line">    &quot;username&quot;: &quot;postman&quot;,</span><br><span class="line">    &quot;password&quot;: &quot;&quot;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8FD4;&#x56DE;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">css&#x590D;&#x5236;&#x4EE3;&#x7801;{</span><br><span class="line">    &quot;error&quot;: {</span><br><span class="line">        &quot;_original&quot;: {</span><br><span class="line">            &quot;username&quot;: &quot;postman&quot;,</span><br><span class="line">            &quot;password&quot;: &quot;&quot;</span><br><span class="line">        },</span><br><span class="line">        &quot;details&quot;: [</span><br><span class="line">            {</span><br><span class="line">                &quot;message&quot;: &quot;\&quot;password\&quot; is not allowed to be empty&quot;,</span><br><span class="line">                &quot;path&quot;: [</span><br><span class="line">                    &quot;password&quot;</span><br><span class="line">                ],</span><br><span class="line">                &quot;type&quot;: &quot;string.empty&quot;,</span><br><span class="line">                &quot;context&quot;: {</span><br><span class="line">                    &quot;label&quot;: &quot;password&quot;,</span><br><span class="line">                    &quot;value&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;key&quot;: &quot;password&quot;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        ]</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="&#x6821;&#x9A8C;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#x662F;&#x5426;&#x90FD;&#x8F93;&#x5165;"><a href="#&#x6821;&#x9A8C;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#x662F;&#x5426;&#x90FD;&#x8F93;&#x5165;" class="headerlink" title="&#x6821;&#x9A8C;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#x662F;&#x5426;&#x90FD;&#x8F93;&#x5165;"></a>&#x6821;&#x9A8C;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#x662F;&#x5426;&#x90FD;&#x8F93;&#x5165;</h3><p>&#x548C;required&#x662F;&#x6709;&#x5DEE;&#x522B;&#x7684;<br>&#x4EE3;&#x7801;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">scss&#x590D;&#x5236;&#x4EE3;&#x7801;const Joi = require(&apos;joi&apos;);</span><br><span class="line">const schema = Joi.object({</span><br><span class="line">    username: Joi.string()</span><br><span class="line">        .alphanum()</span><br><span class="line">        .min(3)</span><br><span class="line">        .max(30),</span><br><span class="line">    password: Joi.string()</span><br><span class="line">        .alphanum()</span><br><span class="line">        .min(6)</span><br><span class="line">        .max(12),</span><br><span class="line">    mobile: Joi.string()</span><br><span class="line">        .alphanum()</span><br><span class="line">}).and(&apos;username&apos;, &apos;password&apos;)</span><br><span class="line"></span><br><span class="line">exports.helloWorld = (req, res) =&gt; {</span><br><span class="line">    const { error, value } = schema.validate(req.query)</span><br><span class="line">    if (error) {</span><br><span class="line">        return res.status(422).json({ error: error })</span><br><span class="line">    }</span><br><span class="line">    console.info(value)</span><br><span class="line">    res.send(value)</span><br><span class="line">};</span><br></pre></td></tr></table></figure>

<p>&#x8F93;&#x5165;&#x6570;&#x636E;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;http://localhost:8080/?username=aaaaaaa&amp;password=123456</span><br></pre></td></tr></table></figure>

<p>&#x8FD4;&#x56DE;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">json&#x590D;&#x5236;&#x4EE3;&#x7801;{</span><br><span class="line">    &quot;username&quot;: &quot;aaaaaaa&quot;,</span><br><span class="line">    &quot;password&quot;: &quot;123456&quot;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8F93;&#x5165;&#x6570;&#x636E;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;http://localhost:8080/?username=aaaaaaa&amp;mobile=123456</span><br></pre></td></tr></table></figure>

<p>&#x8FD4;&#x56DE;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">swift&#x590D;&#x5236;&#x4EE3;&#x7801;{</span><br><span class="line">    &quot;error&quot;: {</span><br><span class="line">        &quot;_original&quot;: {</span><br><span class="line">            &quot;username&quot;: &quot;aaaaaaa&quot;,</span><br><span class="line">            &quot;mobile&quot;: &quot;123456&quot;</span><br><span class="line">        },</span><br><span class="line">        &quot;details&quot;: [</span><br><span class="line">            {</span><br><span class="line">                &quot;message&quot;: &quot;\&quot;value\&quot; contains [username] without its required peers [password]&quot;,</span><br><span class="line">                &quot;path&quot;: [],</span><br><span class="line">                &quot;type&quot;: &quot;object.and&quot;,</span><br><span class="line">                &quot;context&quot;: {</span><br><span class="line">                    &quot;present&quot;: [</span><br><span class="line">                        &quot;username&quot;</span><br><span class="line">                    ],</span><br><span class="line">                    &quot;presentWithLabels&quot;: [</span><br><span class="line">                        &quot;username&quot;</span><br><span class="line">                    ],</span><br><span class="line">                    &quot;missing&quot;: [</span><br><span class="line">                        &quot;password&quot;</span><br><span class="line">                    ],</span><br><span class="line">                    &quot;missingWithLabels&quot;: [</span><br><span class="line">                        &quot;password&quot;</span><br><span class="line">                    ],</span><br><span class="line">                    &quot;label&quot;: &quot;value&quot;,</span><br><span class="line">                    &quot;value&quot;: {</span><br><span class="line">                        &quot;username&quot;: &quot;aaaaaaa&quot;,</span><br><span class="line">                        &quot;mobile&quot;: &quot;123456&quot;</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        ]</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8F93;&#x5165;&#xFF1A;<a href="/external_links/7f27d62df5c9cd071399ee27af02b1a7.html" target="blank" rel="noopener">http://localhost:8080/?mobile=123456</a><br>&#x8FD4;&#x56DE;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">json&#x590D;&#x5236;&#x4EE3;&#x7801;{</span><br><span class="line">    &quot;mobile&quot;: &quot;123456&quot;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="&#x4E8C;&#x9009;&#x4E00;&#x53CA;&#x4F34;&#x968F;"><a href="#&#x4E8C;&#x9009;&#x4E00;&#x53CA;&#x4F34;&#x968F;" class="headerlink" title="&#x4E8C;&#x9009;&#x4E00;&#x53CA;&#x4F34;&#x968F;"></a>&#x4E8C;&#x9009;&#x4E00;&#x53CA;&#x4F34;&#x968F;</h3><p>&#x4EE3;&#x7801;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">scss&#x590D;&#x5236;&#x4EE3;&#x7801;const Joi = require(&apos;joi&apos;);</span><br><span class="line">const schema = Joi.object({</span><br><span class="line">    username: Joi.string()</span><br><span class="line">        .alphanum()</span><br><span class="line">        .min(3)</span><br><span class="line">        .max(30),</span><br><span class="line">    password: Joi.string()</span><br><span class="line">        .alphanum()</span><br><span class="line">        .min(6)</span><br><span class="line">        .max(12),</span><br><span class="line">    mobile: Joi.string()</span><br><span class="line">        .alphanum()</span><br><span class="line">}).xor(&apos;username&apos;, &apos;mobile&apos;)</span><br><span class="line">  .with(&apos;username&apos;, &apos;password&apos;)</span><br><span class="line">  .with(&apos;mobile&apos;,&apos;password&apos;)</span><br><span class="line"></span><br><span class="line">exports.helloWorld = (req, res) =&gt; {</span><br><span class="line">    const { error, value } = schema.validate(req.query)</span><br><span class="line">    if (error) {</span><br><span class="line">        return res.status(422).json({ error: error })</span><br><span class="line">    }</span><br><span class="line">    console.info(value)</span><br><span class="line">    res.send(value)</span><br><span class="line">};</span><br></pre></td></tr></table></figure>

<p>&#x8F93;&#x5165;&#xFF1A;<a href="/external_links/c291b8e0d0789f855bdf8836d07d9eb2.html" target="blank" rel="noopener">http://localhost:8080/?mobile=123456789&amp;password=654321</a><br>&#x8F93;&#x51FA;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">json&#x590D;&#x5236;&#x4EE3;&#x7801;{</span><br><span class="line">    &quot;mobile&quot;: &quot;123456789&quot;,</span><br><span class="line">    &quot;password&quot;: &quot;654321&quot;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8F93;&#x5165;&#xFF1A;<a href="/external_links/7f27d62df5c9cd071399ee27af02b1a7.html" target="blank" rel="noopener">http://localhost:8080/?mobile=123456</a><br>&#x8F93;&#x51FA;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">swift&#x590D;&#x5236;&#x4EE3;&#x7801;{</span><br><span class="line">    &quot;error&quot;: {</span><br><span class="line">        &quot;_original&quot;: {</span><br><span class="line">            &quot;mobile&quot;: &quot;123456&quot;</span><br><span class="line">        },</span><br><span class="line">        &quot;details&quot;: [</span><br><span class="line">            {</span><br><span class="line">                &quot;message&quot;: &quot;\&quot;mobile\&quot; missing required peer \&quot;password\&quot;&quot;,</span><br><span class="line">                &quot;path&quot;: [],</span><br><span class="line">                &quot;type&quot;: &quot;object.with&quot;,</span><br><span class="line">                &quot;context&quot;: {</span><br><span class="line">                    &quot;main&quot;: &quot;mobile&quot;,</span><br><span class="line">                    &quot;mainWithLabel&quot;: &quot;mobile&quot;,</span><br><span class="line">                    &quot;peer&quot;: &quot;password&quot;,</span><br><span class="line">                    &quot;peerWithLabel&quot;: &quot;password&quot;,</span><br><span class="line">                    &quot;label&quot;: &quot;value&quot;,</span><br><span class="line">                    &quot;value&quot;: {</span><br><span class="line">                        &quot;mobile&quot;: &quot;123456&quot;</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        ]</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8F93;&#x5165;&#xFF1A;<a href="/external_links/98515e1a22158d6c6b2ca16f26f8daa2.html" target="blank" rel="noopener">http://localhost:8080/?username=abcdfe&amp;password=654321</a><br>&#x8F93;&#x51FA;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">json&#x590D;&#x5236;&#x4EE3;&#x7801;{</span><br><span class="line">    &quot;username&quot;: &quot;abcdfe&quot;,</span><br><span class="line">    &quot;password&quot;: &quot;654321&quot;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8F93;&#x5165;&#xFF1A;<a href="/external_links/cd598b295f5db239ea91ae512abb0dab.html" target="blank" rel="noopener">http://localhost:8080/?username=abcdfe&amp;password=654321&amp;mobile=13999999999</a><br>&#x8F93;&#x51FA;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">swift&#x590D;&#x5236;&#x4EE3;&#x7801;{</span><br><span class="line">    &quot;error&quot;: {</span><br><span class="line">        &quot;_original&quot;: {</span><br><span class="line">            &quot;username&quot;: &quot;abcdfe&quot;,</span><br><span class="line">            &quot;password&quot;: &quot;654321&quot;,</span><br><span class="line">            &quot;mobile&quot;: &quot;13999999999&quot;</span><br><span class="line">        },</span><br><span class="line">        &quot;details&quot;: [</span><br><span class="line">            {</span><br><span class="line">                &quot;message&quot;: &quot;\&quot;value\&quot; contains a conflict between exclusive peers [username, mobile]&quot;,</span><br><span class="line">                &quot;path&quot;: [],</span><br><span class="line">                &quot;type&quot;: &quot;object.xor&quot;,</span><br><span class="line">                &quot;context&quot;: {</span><br><span class="line">                    &quot;peers&quot;: [</span><br><span class="line">                        &quot;username&quot;,</span><br><span class="line">                        &quot;mobile&quot;</span><br><span class="line">                    ],</span><br><span class="line">                    &quot;peersWithLabels&quot;: [</span><br><span class="line">                        &quot;username&quot;,</span><br><span class="line">                        &quot;mobile&quot;</span><br><span class="line">                    ],</span><br><span class="line">                    &quot;present&quot;: [</span><br><span class="line">                        &quot;username&quot;,</span><br><span class="line">                        &quot;mobile&quot;</span><br><span class="line">                    ],</span><br><span class="line">                    &quot;presentWithLabels&quot;: [</span><br><span class="line">                        &quot;username&quot;,</span><br><span class="line">                        &quot;mobile&quot;</span><br><span class="line">                    ],</span><br><span class="line">                    &quot;label&quot;: &quot;value&quot;,</span><br><span class="line">                    &quot;value&quot;: {</span><br><span class="line">                        &quot;username&quot;: &quot;abcdfe&quot;,</span><br><span class="line">                        &quot;password&quot;: &quot;654321&quot;,</span><br><span class="line">                        &quot;mobile&quot;: &quot;13999999999&quot;</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        ]</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="&#x5176;&#x4ED6;&#x5E38;&#x7528;&#x529F;&#x80FD;"><a href="#&#x5176;&#x4ED6;&#x5E38;&#x7528;&#x529F;&#x80FD;" class="headerlink" title="&#x5176;&#x4ED6;&#x5E38;&#x7528;&#x529F;&#x80FD;"></a>&#x5176;&#x4ED6;&#x5E38;&#x7528;&#x529F;&#x80FD;</h3><p>&#x76F4;&#x63A5;&#x9A8C;&#x8BC1;&#x67D0;&#x4E2A;&#x53D8;&#x91CF;&#x6216;&#x8005;&#x503C;&#xFF1A;Joi.attempt(&#x2018;x&#x2019;, Joi.number());<br>&#x5141;&#x8BB8;&#x5BF9;&#x8C61;&#x91CC;&#x542B;&#x6709;&#x672A;&#x5B9A;&#x4E49;&#x7684;key&#xFF1A;Joi.object({ a: Joi.any() }).unknown();<br>&#x5B9A;&#x4E49;&#x53C2;&#x6570;&#x4E0D;&#x80FD;&#x540C;&#x65F6;&#x51FA;&#x73B0;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">css&#x590D;&#x5236;&#x4EE3;&#x7801;const schema = Joi.object({</span><br><span class="line">    a: Joi.any(),</span><br><span class="line">    b: Joi.any()</span><br><span class="line">}).nand(&apos;a&apos;, &apos;b&apos;);</span><br></pre></td></tr></table></figure>

<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/dc3988e4a3e3af80d45c1461342c83fe.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6946821829180784671.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6946821829180784671.html" itemprop="url">盘点认证框架   SpringSecurity 认证流程篇</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-04-03T14:57:01+08:00">
                2021-04-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>&#x603B;&#x6587;&#x6863; :<a href="https://dev.newban.cn/6941642435189538824">&#x6587;&#x7AE0;&#x76EE;&#x5F55;</a>  </p>
<p>Github : <a href="/external_links/f4c0695dd8cd8371c2f2fc9edde11029.html" target="blank" rel="noopener">github.com/black-ant</a></p>
</blockquote>
<h2 id="&#x4E00;-&#x524D;&#x8A00;"><a href="#&#x4E00;-&#x524D;&#x8A00;" class="headerlink" title="&#x4E00; . &#x524D;&#x8A00;"></a>&#x4E00; . &#x524D;&#x8A00;</h2><p>&#x4E0A;&#x4E00;&#x7BC7;&#x8BB2;&#x4E86; Security &#x7684; Filter &#x662F;&#x600E;&#x4E48;&#x8FD0;&#x884C;&#x7684; , &#x8FD9;&#x4E00;&#x7BC7;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x770B; Security &#x7684;&#x8BA4;&#x8BC1;&#x6D41;&#x7A0B; .</p>
<h2 id="&#x4E8C;-&#x8BA4;&#x8BC1;&#x4FE1;&#x606F;&#x7684;&#x6D41;&#x8F6C;"><a href="#&#x4E8C;-&#x8BA4;&#x8BC1;&#x4FE1;&#x606F;&#x7684;&#x6D41;&#x8F6C;" class="headerlink" title="&#x4E8C; . &#x8BA4;&#x8BC1;&#x4FE1;&#x606F;&#x7684;&#x6D41;&#x8F6C;"></a>&#x4E8C; . &#x8BA4;&#x8BC1;&#x4FE1;&#x606F;&#x7684;&#x6D41;&#x8F6C;</h2><h3 id="2-1-SecurityContext-&#x57FA;&#x672C;&#x5BF9;&#x8C61;&#x4FE1;&#x606F;"><a href="#2-1-SecurityContext-&#x57FA;&#x672C;&#x5BF9;&#x8C61;&#x4FE1;&#x606F;" class="headerlink" title="2.1 SecurityContext &#x57FA;&#x672C;&#x5BF9;&#x8C61;&#x4FE1;&#x606F;"></a>2.1 SecurityContext &#x57FA;&#x672C;&#x5BF9;&#x8C61;&#x4FE1;&#x606F;</h3><p>Security &#x6838;&#x5FC3;&#x4FE1;&#x606F;&#x5C31;&#x662F; <strong>SecurityContext</strong> , &#x6211;&#x4EEC;&#x6765;&#x770B;&#x770B;&#x8BA4;&#x8BC1;&#x4FE1;&#x606F;&#x662F;&#x600E;&#x4E48;&#x786E;&#x5B9A;&#x548C;&#x6D41;&#x8F6C;&#x7684;</p>
<p><strong>SecurityContextHolder</strong> &#x662F; Spring Security &#x5B58;&#x50A8;&#x88AB;&#x9A8C;&#x8BC1;&#x8005;&#x7684;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#x7684;&#x5730;&#x65B9;&#x3002;Spring Security &#x4E0D;&#x5173;&#x5FC3; SecurityContextHolder &#x662F;&#x5982;&#x4F55;&#x586B;&#x5145;&#x7684;&#x3002;&#x5982;&#x679C;&#x5B83;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x503C;&#xFF0C;&#x5219;&#x5C06;&#x5176;&#x7528;&#x4F5C;&#x5F53;&#x524D;&#x7ECF;&#x8FC7;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x7684;&#x7528;&#x6237;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/85f0486e6aee577f612e1e460471196cc970b147e5f435879484db8bb0b42185" alt="SecurityContext.jpg"></p>
<blockquote>
<p>&#x751F;&#x6210;&#x4E00;&#x4E2A; SecurityContext</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;// &#x8868;&#x660E;&#x7528;&#x6237;&#x5DF2;&#x901A;&#x8FC7;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x7684;&#x6700;&#x7B80;&#x5355;&#x65B9;&#x6CD5;&#x662F;&#x76F4;&#x63A5;&#x8BBE;&#x7F6E; SecurityContextHolder</span><br><span class="line">SecurityContext context = SecurityContextHolder.createEmptyContext(); </span><br><span class="line">// &#x751F;&#x6210; Authentication &#x8BA4;&#x8BC1;&#x5BF9;&#x8C61;</span><br><span class="line">Authentication authentication =new TestingAuthenticationToken(&quot;username&quot;, &quot;password&quot;, &quot;ROLE_USER&quot;); </span><br><span class="line">context.setAuthentication(authentication);</span><br><span class="line">// SecurityContextHolder &#x4E2D;&#x8BBE;&#x7F6E; context</span><br><span class="line">SecurityContextHolder.setContext(context);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&#x83B7;&#x5F97;&#x5DF2;&#x7ECF;&#x8BA4;&#x8BC1;&#x7684;&#x7528;&#x6237;</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;// Step 1 : &#x83B7;&#x53D6; SecurityContext</span><br><span class="line">SecurityContext context = SecurityContextHolder.getContext();</span><br><span class="line">// Step 2 : &#x83B7;&#x53D6; Authentication &#x53CA;&#x5176;&#x76F8;&#x5173;&#x4FE1;&#x606F;</span><br><span class="line">Authentication authentication = context.getAuthentication();</span><br><span class="line">String username = authentication.getName();</span><br><span class="line">Object principal = authentication.getPrincipal();</span><br><span class="line">Collection&lt;? extends GrantedAuthority&gt; authorities = authentication.getAuthorities();</span><br></pre></td></tr></table></figure>

<blockquote>
<p>SecurityContextHolder &#x7684;&#x76F8;&#x5173;&#x903B;&#x8F91;</p>
</blockquote>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/340a3fe1d033b9a2e926e22aec4caf8d4c75b669b8ccef2f961130f09c93b7a8" alt="image.png"></p>
<ul>
<li>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B; SecurityContextHolder &#x4F7F;&#x7528; <strong>ThreadLocal</strong> &#x6765;&#x5B58;&#x50A8;&#x8FD9;&#x4E9B;&#x7EC6;&#x8282; (PS : &#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; SecurityContextHolder.MODE global &#x914D;&#x7F6E;)<ul>
<li>&#x7B2C;&#x4E00;&#x4E2A;&#x662F;&#x8BBE;&#x7F6E;&#x7CFB;&#x7EDF;&#x5C5E;&#x6027;</li>
<li>&#x7B2C;&#x4E8C;&#x4E2A;&#x662F;&#x8C03;&#x7528; SecurityContextHolder &#x4E0A;&#x7684;&#x9759;&#x6001;&#x65B9;&#x6CD5;</li>
</ul>
</li>
<li>Spring Security &#x7684; FilterChainProxy &#x786E;&#x4FDD; SecurityContext &#x603B;&#x662F;&#x88AB;&#x6E05;&#x9664;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;// SecurityContextHolder &#x63D0;&#x4F9B;&#x4E86;&#x4EE5;&#x4E0B;&#x7684;&#x53C2;&#x6570;</span><br><span class="line"></span><br><span class="line">// &#x63D0;&#x4F9B;&#x4E86;&#x4E09;&#x79CD;&#x4E0D;&#x540C;&#x7684;Mode</span><br><span class="line">public static final String MODE_THREADLOCAL = &quot;MODE_THREADLOCAL&quot;;</span><br><span class="line">public static final String MODE_INHERITABLETHREADLOCAL = &quot;MODE_INHERITABLETHREADLOCAL&quot;;</span><br><span class="line">public static final String MODE_GLOBAL = &quot;MODE_GLOBAL&quot;;</span><br><span class="line"></span><br><span class="line">public static final String SYSTEM_PROPERTY = &quot;spring.security.strategy&quot;;</span><br><span class="line">// &#x7B56;&#x7565;&#x7C7B;&#x578B;&#x540D;</span><br><span class="line">private static String strategyName = System.getProperty(SYSTEM_PROPERTY);</span><br><span class="line">private static SecurityContextHolderStrategy strategy;</span><br><span class="line">private static int initializeCount = 0;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// Node 1 : &#x7C7B;&#x521D;&#x59CB;&#x5316; , &#x8FD9;&#x91CC;&#x56E0;&#x4E3A;&#x6709;&#x9759;&#x6001;&#x521D;&#x59CB;&#x5316;&#x5757; , &#x6240;&#x4EE5;&#x4E0A;&#x9762;&#x4ECE;&#x624D;&#x53EF;&#x4EE5;&#x603B;&#x7ED3;&#x901A;&#x8FC7;&#x9759;&#x6001;&#x7C7B;&#x6765;&#x8BBE;&#x7F6E;</span><br><span class="line">static {</span><br><span class="line">    initialize();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// &#x8FDB;&#x884C;&#x4E86;&#x521D;&#x59CB;&#x5316;&#x64CD;&#x4F5C;</span><br><span class="line">private static void initialize() {</span><br><span class="line">    if (!StringUtils.hasText(strategyName)) {</span><br><span class="line">        strategyName = MODE_THREADLOCAL;</span><br><span class="line">    }</span><br><span class="line">    // &#x8FD9;&#x91CC;&#x53EF;&#x4EE5;&#x770B;&#x5230; , &#x6709;&#x4E09;&#x79CD;&#x4E0D;&#x540C;&#x7684;Mode , &#x5206;&#x522B;&#x5BF9;&#x5E94;&#x4E09;&#x79CD;&#x4E0D;&#x540C;&#x7684;&#x7B56;&#x7565;</span><br><span class="line">    if (strategyName.equals(MODE_THREADLOCAL)) {</span><br><span class="line">        strategy = new ThreadLocalSecurityContextHolderStrategy();</span><br><span class="line">    }else if (strategyName.equals(MODE_INHERITABLETHREADLOCAL)) {</span><br><span class="line">        strategy = new InheritableThreadLocalSecurityContextHolderStrategy();</span><br><span class="line">    }else if (strategyName.equals(MODE_GLOBAL)) {</span><br><span class="line">        strategy = new GlobalSecurityContextHolderStrategy();</span><br><span class="line">    }else {</span><br><span class="line">        try {</span><br><span class="line">            // &#x53CD;&#x8272;&#x83B7;&#x53D6;</span><br><span class="line">            Class&lt;?&gt; clazz = Class.forName(strategyName);</span><br><span class="line">            Constructor&lt;?&gt; customStrategy = clazz.getConstructor();</span><br><span class="line">            strategy = (SecurityContextHolderStrategy) customStrategy.newInstance();</span><br><span class="line">        } catch (Exception ex) {</span><br><span class="line">            ReflectionUtils.handleReflectionException(ex);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    initializeCount++;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// Node 2 : setContext &#x903B;&#x8F91; , &#x901A;&#x8FC7;&#x7B56;&#x7565;&#x8C03;&#x7528;</span><br><span class="line">public static void setContext(SecurityContext context) {</span><br><span class="line">    strategy.setContext(context);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><strong>GlobalSecurityContextHolderStrategy :</strong> &#x5176;&#x4E2D; SecurityContext &#x5C31;&#x662F;&#x4E2A;&#x9759;&#x6001;&#x53D8;&#x91CF;<br><strong>InheritableThreadLocalSecurityContextHolderStrategy :</strong> &#x5176;&#x4E2D;&#x5305;&#x542B;&#x4E00;&#x4E2A; <code>ThreadLocal&lt;SecurityContext&gt;</code><br><strong>ThreadLocalSecurityContextHolderStrategy :</strong> &#x548C;&#x4E0A;&#x4E00;&#x4E2A;&#x6CA1;&#x4EC0;&#x4E48;&#x533A;&#x522B;</p>
<h3 id="2-2-SecurityContext-&#x6D41;&#x7A0B;"><a href="#2-2-SecurityContext-&#x6D41;&#x7A0B;" class="headerlink" title="2.2 SecurityContext &#x6D41;&#x7A0B;"></a>2.2 SecurityContext &#x6D41;&#x7A0B;</h3><p>FilterChainProxyAbstractAuthenticationProcessingFilterDatabaseAuthenticationFilterAuthenticationManagerProvider&#x8FD9;&#x91CC;&#x4F1A;&#x8C03;&#x7528;&#x76F8;&#x5173;Handler &#x6700;&#x7EC8;&#x5904;&#x7406; Authentication&#x8C03;&#x7528; doFilter&#x8C03;&#x7528;attemptAuthentication&#x901A;&#x8FC7; Manager &#x8C03;&#x7528; provider&#x8C03;&#x7528; Provider &#x8BF7;&#x6C42; Authentication&#x7136;&#x4F1A; Authentication&#x8FD4;&#x56DE; Authentication&#x8FD4;&#x56DE; AuthenticationFilterChainProxyAbstractAuthenticationProcessingFilterDatabaseAuthenticationFilterAuthenticationManagerProvider</p>
<blockquote>
<p>Step 1 : &#x8C03;&#x7528; Provider &#x5904;&#x7406;&#x60C5;&#x51B5; , &#x8FD9;&#x91CC;&#x8BA4;&#x8BC1;&#x5B8C;&#x6210;&#x540E;&#x8FD4;&#x56DE;&#x4E86;&#x4E00;&#x4E2A; Authentication</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;// &#x56DE;&#x5FC6;&#x4E00;&#x4E0B; , &#x4E4B;&#x524D; Filter &#x4E2D; , &#x8C03;&#x7528; AuthenticationManager &#x5F00;&#x59CB;&#x4E86; Provider &#x7684;&#x6D41;&#x7A0B;</span><br><span class="line">DatabaseUserToken authRequest = new DatabaseUserToken(username, password);</span><br><span class="line">setDetails(request, authRequest);</span><br><span class="line">return this.getAuthenticationManager().authenticate(authRequest);</span><br><span class="line"></span><br><span class="line">// &#x5F80;&#x5916;&#x5C42;&#x8FFD;&#x6EAF;&#x4E00;&#x4E0B; , &#x53EF;&#x4EE5;&#x770B;&#x5230; , &#x5176;&#x6838;&#x5FC3;&#x88AB;&#x8C03;&#x7528;&#x7684;&#x662F;&#x62BD;&#x8C61;&#x7C7B; AbstractAuthenticationProcessingFilter</span><br><span class="line">public Authentication attemptAuthentication(HttpServletRequest request, HttpServletResponse response)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Step 2 : Provider &#x5904;&#x7406;</p>
</blockquote>
<p>&#x8FD9;&#x91CC;&#x7684; AuthenticationManager &#x4E3B;&#x8981;&#x662F; ProviderManager &#x4E3B;&#x8981;&#x662F;&#x8FD9;&#x4E9B; ,&#x6211;&#x4EEC;&#x4EC5;&#x4FDD;&#x7559;&#x5176;&#x4E2D;&#x6BD4;&#x8F83;&#x91CD;&#x8981;&#x7684;&#x903B;&#x8F91; :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;public Authentication authenticate(Authentication authentication)</span><br><span class="line">			throws AuthenticationException {</span><br><span class="line">    Class&lt;? extends Authentication&gt; toTest = authentication.getClass();</span><br><span class="line">    AuthenticationException lastException = null;</span><br><span class="line">    Authentication result = null;</span><br><span class="line">    Authentication parentResult = null;</span><br><span class="line">    boolean debug = logger.isDebugEnabled();</span><br><span class="line">    </span><br><span class="line">    for (AuthenticationProvider provider : getProviders()) {</span><br><span class="line">        // &#x6BCF;&#x4E2A; Provider &#x90FD;&#x4F1A;&#x91CD;&#x5199; supports , &#x6B64;&#x5904;&#x5224;&#x65AD;&#x662F;&#x5426;&#x652F;&#x6301;&#x8BE5; Provider</span><br><span class="line">        if (!provider.supports(toTest)) {</span><br><span class="line">            continue;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        try {</span><br><span class="line">            // &#x6B64;&#x5904;&#x8C03;&#x7528;&#x5177;&#x4F53;&#x7684; Provider &#x6267;&#x884C;</span><br><span class="line">            result = provider.authenticate(authentication);</span><br><span class="line">            if (result != null) {</span><br><span class="line">                copyDetails(authentication, result);</span><br><span class="line">                break;</span><br><span class="line">            }</span><br><span class="line">        }catch (AccountStatusException|InternalAuthenticationServiceException e) </span><br><span class="line">                prepareException(e, authentication);</span><br><span class="line">                throw e;</span><br><span class="line">        }catch (AuthenticationException e) {</span><br><span class="line">                lastException = e;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    // &#x8FD9;&#x91CC;&#x8FD8;&#x6709;&#x4E2A;&#x8865;&#x507F;&#x7B56;&#x7565; ,&#x5982;&#x679C;&#x5F53;&#x524D; AuthenticationManager &#x5904;&#x7406;&#x4E0D;&#x4E86; , &#x4F1A;&#x7531; &#x7236;&#x7C7B;&#x5904;&#x7406;</span><br><span class="line">    // &#x6682;&#x65F6;&#x6CA1;&#x60F3;&#x6E05;&#x695A;&#x5177;&#x4F53;&#x7684;&#x4F7F;&#x7528;&#x573A;&#x666F; , &#x53EF;&#x80FD;&#x9002;&#x7528;&#x4E8E;&#x7EC6;&#x7C92;&#x5EA6;&#x6743;&#x9650;&#x8FD9;&#x79CD;</span><br><span class="line">    if (result == null &amp;&amp; parent != null) {	</span><br><span class="line">        try {</span><br><span class="line">            result = parentResult = parent.authenticate(authentication);</span><br><span class="line">        }catch (AuthenticationException e) {</span><br><span class="line">            lastException = e;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    if (result != null) {</span><br><span class="line">        if (eraseCredentialsAfterAuthentication</span><br><span class="line">					&amp;&amp; (result instanceof CredentialsContainer)) {</span><br><span class="line">            ((CredentialsContainer) result).eraseCredentials();</span><br><span class="line">        }</span><br><span class="line">        // &#x53D1;&#x5E03;&#x8BA4;&#x8BC1;&#x6210;&#x529F;&#x7684;&#x65F6;&#x95F4;</span><br><span class="line">        if (parentResult == null) {</span><br><span class="line">            eventPublisher.publishAuthenticationSuccess(result);</span><br><span class="line">        }</span><br><span class="line">        return result;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    if (lastException == null) {</span><br><span class="line">        lastException = new ProviderNotFoundException(messages.getMessage(</span><br><span class="line">					&quot;ProviderManager.providerNotFound&quot;,</span><br><span class="line">					new Object[] { toTest.getName() },</span><br><span class="line">					&quot;No AuthenticationProvider found for {0}&quot;));</span><br><span class="line">    }</span><br><span class="line">    prepareException(lastException, authentication);</span><br><span class="line">    throw lastException;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><strong>&#x53EF;&#x4EE5;&#x770B;&#x5230; ,&#x5230;&#x8FD9;&#x4E00;&#x6B65; Provider &#x8FD4;&#x56DE;&#x4E86;&#x4E00;&#x4E2A; Authentication &#x56DE;&#x53BB;</strong></p>
<blockquote>
<p>Step 3 : AbstractAuthenticationProcessingFilter &#x5904;&#x7406;</p>
</blockquote>
<p><strong>&#x4ECE;&#x7B2C;&#x4E8C;&#x6B65; Prodiver &#x8FD4;&#x56DE;&#x4E86; Authentication , &#x4ED6;&#x6700;&#x7EC8;&#x88AB;&#x4F20;&#x9012;&#x5230; AbstractAuthenticationProcessingFilter &#x4E2D;</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;// AbstractAuthenticationProcessingFilter &#x4F2A;&#x4EE3;&#x7801; : </span><br><span class="line"></span><br><span class="line">// Step 1 : &#x8FDB;&#x884C;&#x9884;&#x8BA4;&#x8BC1;</span><br><span class="line">authResult = attemptAuthentication(request, response);</span><br><span class="line"></span><br><span class="line">// Step 2 : Session &#x7B56;&#x7565;&#x5904;&#x7406; , &#x8FD9;&#x91CC;&#x7684; sessionStrategy &#x662F; NullAuthenticatedSessionStrategy , &#x5176;&#x91CC;&#x9762;&#x662F;&#x7A7A;&#x5B9E;&#x73B0; </span><br><span class="line">sessionStrategy.onAuthentication(authResult, request, response) </span><br><span class="line"></span><br><span class="line">// Step 3 : &#x6210;&#x529F;&#x540E;&#x6267;&#x884C;&#x5BB9;&#x5668;&#x5904;&#x7406;</span><br><span class="line">successfulAuthentication(request, response, chain, authResult)    </span><br><span class="line">    |- SecurityContextHolder.getContext().setAuthentication(authResult) // &#x679C;&#x7136;&#x6765;&#x4E86; , &#x628A; authResult &#x653E;&#x5165; SecurityContext</span><br><span class="line">    |- rememberMeServices.loginSuccess(request, response, authResult) // &#x8BB0;&#x4F4F;&#x6211;&#x529F;&#x80FD;&#x7684;&#x5904;&#x7406; , RememberFilter &#x4F1A;&#x5BF9;&#x8FD9;&#x4E2A;&#x8FDB;&#x884C;&#x5904;&#x7406;</span><br><span class="line">    |- successHandler.onAuthenticationSuccess(request, response, authResult) // SavedRequestAwareAuthenticationSuccessHandler</span><br></pre></td></tr></table></figure>

<p><strong>&#x81F3;&#x6B64; , Provider &#x4EA7;&#x751F;&#x7684; Authentication &#x6210;&#x529F;&#x653E;&#x5165; &#x5BB9;&#x5668;&#x4E2D;</strong></p>
<blockquote>
<p>&#x6269;&#x5C55; SavedRequestAwareAuthenticationSuccessHandler &#x5904;&#x7406; Success &#x7ED3;&#x679C;</p>
</blockquote>
<p><strong>&#x603B;&#x7ED3;&#x4E00;&#x4E0B;&#x5C31;&#x662F;&#x5B9A;&#x5236;&#x7F13;&#x5B58;&#x548C;&#x8DF3;&#x8F6C;&#x5173;&#x7CFB; &gt;&gt;&gt;</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;C- SavedRequestAwareAuthenticationSuccessHandler</span><br><span class="line">    P- RequestCache requestCache : Request &#x7F13;&#x5B58;&#x5DE5;&#x5177; , &#x7528;&#x6237;&#x83B7;&#x53D6;&#x7F13;&#x5B58;&#x7684; Request &#x5BF9;&#x8C61;</span><br><span class="line">    M- onAuthenticationSuccess</span><br><span class="line">        - SavedRequest savedRequest = requestCache.getRequest(request, response) : &#x5148;&#x83B7;&#x53D6;&#x7F13;&#x5B58;&#x7684;&#x5BF9;&#x8C61;</span><br><span class="line">        - String targetUrlParameter = getTargetUrlParameter() : &#x8FD9;&#x91CC;&#x662F;&#x770B;&#x770B;&#x6709;&#x6CA1;&#x6709;&#x6210;&#x529F;&#x7684;&#x8DF3;&#x8F6C;&#x5730;&#x5740; </span><br><span class="line">        	?- &#x5982;&#x679C;&#x60F3;&#x5B9E;&#x73B0;&#x4E0D;&#x540C;&#x7528;&#x6237;&#x4E0D;&#x540C;&#x8DF3;&#x8F6C; ,&#x5B9A;&#x5236;&#x8FD9;&#x91CC;</span><br><span class="line">        - clearAuthenticationAttributes(request) : &#x5220;&#x9664;&#x4E0E;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x76F8;&#x5173;&#x7684;&#x4E34;&#x65F6;&#x6570;&#x636E;&#xFF0C;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#x53EF;&#x80FD;&#x5728;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x8FC7;&#x7A0B;&#x4E2D;&#x5B58;&#x50A8;&#x5728;&#x4F1A;&#x8BDD;&#x4E2D; , &#x907F;&#x514D;&#x654F;&#x611F;&#x4FE1;&#x606F;&#x6CC4;&#x9732;</span><br><span class="line">        - String targetUrl = savedRequest.getRedirectUrl();</span><br><span class="line">        - getRedirectStrategy().sendRedirect(request, response, targetUrl);</span><br><span class="line">			?- &#x91CD;&#x5B9A;&#x5411;&#x51FA;&#x53BB;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/6839a7393aad28cc06a5cebf06c8271657e2022d244b8108bb4cb51da3d4498e" alt="Authentication001.jpg"></p>
<p><strong>&#x4EE5;&#x4E0A;&#x662F;&#x8BA4;&#x8BC1;&#x4ECE;&#x548C;&#x8BA4;&#x8BC1;&#x5931;&#x8D25;&#x7684;&#x6D41;&#x7A0B;&#x56FE; , &#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5177;&#x4F53;&#x7684;&#x5904;&#x7406;&#x7C7B; :</strong></p>
<blockquote>
<p>&#x603B;&#x7ED3;&#x4E00;&#x4E0B;&#x8BA4;&#x8BC1;&#x6210;&#x529F;&#x548C;&#x8BA4;&#x8BC1;&#x5931;&#x8D25;&#x5206;&#x522B;&#x5E72;&#x4E86;&#x4EC0;&#x4E48; :</p>
</blockquote>
<p><strong>&#x5982;&#x679C;&#x8BA4;&#x8BC1;&#x5931;&#x8D25;:</strong></p>
<ul>
<li>Security contextholder &#x88AB;&#x6E05;&#x7A7A;&#x4E86;&#x3002;</li>
<li>&#x8C03;&#x7528; RememberMeServices.loginFail&#x3002;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x914D;&#x7F6E; rememberme&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x4E2A; no-op</li>
<li>&#x8C03;&#x7528; AuthenticationFailureHandler&#x3002;</li>
</ul>
<p><strong>&#x540C;&#x65F6;&#x5BF9;&#x6BD4;&#x4E00;&#x4E0B;&#x8BA4;&#x8BC1;&#x6210;&#x529F;:</strong></p>
<ul>
<li>&#x4F1A;&#x5728;&#x65B0;&#x767B;&#x5F55;&#x65F6;&#x901A;&#x77E5; SessionAuthenticationStrategy</li>
<li>&#x5728; SecurityContextHolder &#x4E0A;&#x8BBE;&#x7F6E;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF0C;&#x7136;&#x540E; SecurityContextPersistenceFilter &#x5C06; SecurityContext &#x4FDD;&#x5B58;&#x5230; HttpSession &#x4E2D;</li>
<li>&#x8C03;&#x7528; RememberMeServices.loginSuccess&#x3002;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x914D;&#x7F6E; remember me&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x4E2A; no-op</li>
<li>ApplicationEventPublisher &#x53D1;&#x5E03;&#x4EA4;&#x4E92;&#x5F0F;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x8FDE;&#x63A5;</li>
<li>&#x8C03;&#x7528; AuthenticationSuccessHandler</li>
</ul>
<h2 id="&#x4E09;-&#x518D;&#x6B21;&#x8BBF;&#x95EE;&#x548C;&#x9000;&#x51FA;"><a href="#&#x4E09;-&#x518D;&#x6B21;&#x8BBF;&#x95EE;&#x548C;&#x9000;&#x51FA;" class="headerlink" title="&#x4E09; . &#x518D;&#x6B21;&#x8BBF;&#x95EE;&#x548C;&#x9000;&#x51FA;"></a>&#x4E09; . &#x518D;&#x6B21;&#x8BBF;&#x95EE;&#x548C;&#x9000;&#x51FA;</h2><p><strong>&#x4E0A;&#x9762;&#x8BF4;&#x4E86;&#x4E00;&#x4E2A;&#x8BA4;&#x8BC1;&#x8FC7;&#x7A0B;&#x4E2D;&#x53D1;&#x751F;&#x4E86;&#x4EC0;&#x4E48; , &#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x770B;&#x4E0B;&#x8BA4;&#x8BC1;&#x5B8C;&#x6210;&#x540E;&#x518D;&#x6B21;&#x8BBF;&#x95EE;&gt;&gt;&gt;</strong></p>
<h3 id="3-1-&#x8BA4;&#x8BC1;&#x540E;&#x8BBF;&#x95EE;"><a href="#3-1-&#x8BA4;&#x8BC1;&#x540E;&#x8BBF;&#x95EE;" class="headerlink" title="3.1 &#x8BA4;&#x8BC1;&#x540E;&#x8BBF;&#x95EE;"></a>3.1 &#x8BA4;&#x8BC1;&#x540E;&#x8BBF;&#x95EE;</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;// &#x524D;&#x9762;&#x8BF4;&#x4E86; , &#x8BA4;&#x8BC1;&#x5B8C;&#x6210;&#x540E;&#x4F1A;&#x5199;&#x5165; SecurityContextHolder , Security &#x901A;&#x8FC7;&#x5224;&#x65AD; SecurityContext &#x6765;&#x6821;&#x9A8C;&#x7528;&#x6237;</span><br><span class="line">// &#x540C;&#x7406; , &#x4E0B;&#x6B21;&#x8BBF;&#x95EE;&#x7684;&#x65F6;&#x5019;&#x540C;&#x6837;&#x901A;&#x8FC7;&#x8BE5;&#x65B9;&#x5F0F; :</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// Step 1 : SecurityContextPersistenceFilter &#x62E6;&#x622A;&#x5230;&#x8BF7;&#x6C42;</span><br><span class="line"></span><br><span class="line">// Step 2 : &#x4ECE;&#x8BF7;&#x6C42;&#x4E2D;&#x83B7;&#x53D6; SecurityContext</span><br><span class="line">SecurityContext contextBeforeChainExecution = repo.loadContext(holder);</span><br><span class="line"></span><br><span class="line">// &#x4ECE; HttpSessionSecurityContextRepository &#x4E2D;&#x83B7;&#x53D6;</span><br><span class="line">C- HttpSessionSecurityContextRepository</span><br><span class="line">    SecurityContext context = readSecurityContextFromSession(httpSession);</span><br><span class="line"></span><br><span class="line">// &#x6B64;&#x5904;&#x65AD;&#x70B9;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8BA4;&#x8BC1;&#x4FE1;&#x606F; : </span><br><span class="line">org.springframework.security.core.context.SecurityContextImpl@45eed422: </span><br><span class="line">Authentication: com.security.demo.token.DatabaseUserToken@45eed422: </span><br><span class="line">Principal: gang; </span><br><span class="line">Credentials: [PROTECTED]; </span><br><span class="line">Authenticated: true; </span><br><span class="line">Details: org.springframework.security.web.authentication.WebAuthenticationDetails@fffdaa08: RemoteIpAddress: 127.0.0.1; </span><br><span class="line">SessionId: A58D946FBFCB17743E2E0A44DBAB7A76; </span><br><span class="line">Granted Authorities: ROLE_USER	</span><br><span class="line"></span><br><span class="line">// Step 3 : finally &#x6B64;&#x5904;&#x5C06; SecurityContext &#x8FDB;&#x884C;&#x4E86;&#x8BBE;&#x7F6E;</span><br><span class="line">SecurityContext contextAfterChainExecution = SecurityContextHolder.getContext();</span><br><span class="line">SecurityContextHolder.clearContext();</span><br><span class="line">repo.saveContext(contextAfterChainExecution, holder.getRequest(),holder.getResponse());</span><br></pre></td></tr></table></figure>

<p><strong>PS : &#x56E0;&#x4E3A;&#x662F;&#x57FA;&#x4E8E; Session &#x7BA1;&#x7406; , &#x6240;&#x4EE5;&#x8FC7;&#x4E00;&#x4F1A;&#x5C31;&#x8FC7;&#x671F;&#x4E86;</strong>  </p>
<p>&#x5F53;&#x7136;&#x8FD9;&#x662F;&#x57FA;&#x4E8E; Session &#x7684;&#x6A21;&#x5F0F; ,&#x751F;&#x547D;&#x5468;&#x671F;&#x548C; Session &#x7B49;&#x540C; ,&#x4F46;&#x662F;&#x901A;&#x5E38;&#x4F1A;&#x5E38;&#x7528;&#x66F4;&#x957F;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x65B9;&#x6848; ,&#x6BD4;&#x5982; <strong>AccessToken , Cookie</strong> &#x7B49;&#x7B49; ,&#x800C; Session &#x53EA;&#x662F;&#x4E3A;&#x4E86;&#x7EF4;&#x6301;&#x4E00;&#x4E2A;&#x8BA4;&#x8BC1;&#x7684;&#x4E34;&#x65F6;&#x72B6;&#x6001;</p>
<h3 id="3-2-Logout-&#x9000;&#x51FA;"><a href="#3-2-Logout-&#x9000;&#x51FA;" class="headerlink" title="3.2 Logout &#x9000;&#x51FA;"></a>3.2 Logout &#x9000;&#x51FA;</h3><blockquote>
<p>Logout &#x76F8;&#x5173;&#x7C7B; :</p>
</blockquote>
<ul>
<li>PersistentTokenBasedRememberMeServices</li>
<li>TokenBasedRememberMeServices</li>
<li>CookieClearingLogoutHandler</li>
<li>CsrfLogoutHandler</li>
<li>SecurityContextLogoutHandler</li>
<li>HeaderWriterLogoutHandler</li>
</ul>
<p><strong>&#x540C;&#x6837;&#x7684; , Logout &#x4E5F;&#x6709; Filter &#x548C; Handler</strong></p>
<ul>
<li>LogoutFilter</li>
<li>SimpleUrlLogoutSuccessHandler</li>
<li>HttpStatusReturningLogoutSuccessHandler</li>
</ul>
<p><strong>&#x548C;&#x524D;&#x9762;&#x5206;&#x6790; Filter &#x4E00;&#x6837; , &#x5176;&#x6838;&#x5FC3;&#x8FD8;&#x662F;&#x901A;&#x8FC7; LogoutFilter &#x6765;&#x8FDB;&#x884C; :</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;this.handler.logout(request, response, auth);</span><br><span class="line">logoutSuccessHandler.onLogoutSuccess(request, response, auth);</span><br><span class="line"></span><br><span class="line">C- SecurityContextLogoutHandler : &#x6838;&#x5FC3;&#x7C7B; , &#x5904;&#x7406; Context </span><br><span class="line">	public void logout(HttpServletRequest request, HttpServletResponse response,</span><br><span class="line">			Authentication authentication) {</span><br><span class="line">		Assert.notNull(request, &quot;HttpServletRequest required&quot;);</span><br><span class="line">		if (invalidateHttpSession) {</span><br><span class="line">			HttpSession session = request.getSession(false);</span><br><span class="line">			if (session != null) {</span><br><span class="line">				logger.debug(&quot;Invalidating session: &quot; + session.getId());</span><br><span class="line">				session.invalidate();</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line"></span><br><span class="line">		if (clearAuthentication) {</span><br><span class="line">             // &#x6B64;&#x5904;&#x5C06; SecurityContext &#x8BBE;&#x7F6E;&#x4E3A;&#x4E86; null</span><br><span class="line">			SecurityContext context = SecurityContextHolder.getContext();</span><br><span class="line">			context.setAuthentication(null);</span><br><span class="line">		}</span><br><span class="line"></span><br><span class="line">		SecurityContextHolder.clearContext();</span><br><span class="line">	}</span><br></pre></td></tr></table></figure>

<h2 id="&#x603B;&#x7ED3;"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3; :"></a>&#x603B;&#x7ED3; :</h2><p>&#x81F3;&#x6B64; , &#x4E00;&#x4E2A;&#x5B8C;&#x6574;&#x7684; Security &#x751F;&#x547D;&#x5468;&#x671F;&#x5C31;&#x770B;&#x5B8C;&#x4E86;, &#x5176;&#x5B9E;&#x5F88;&#x7B80;&#x5355; , &#x603B;&#x7ED3;&#x8D77;&#x6765;&#x5C31;&#x662F; :</p>
<ul>
<li>Filter &#x505A;&#x4E1A;&#x52A1;&#x51B3;&#x5B9A;</li>
<li>AuthenticationManager &#x51B3;&#x5B9A;&#x6821;&#x9A8C;&#x65B9;&#x5F0F;</li>
<li>Provider &#x8FDB;&#x884C;&#x8BA4;&#x8BC1;&#x6821;&#x9A8C;</li>
<li>Handler&#x505A;&#x7ED3;&#x679C;&#x5904;&#x7406;&#x5DF2;&#x7ECF;&#x5916;&#x90E8;&#x8DF3;&#x8F6C;</li>
</ul>
<p>&#x540E;&#x9762;&#x4E00;&#x7AE0;&#x6211;&#x4EEC;&#x6765;&#x8BE6;&#x7EC6;&#x770B;&#x770B;Security &#x7684;&#x914D;&#x7F6E;&#x903B;&#x8F91; ,&#x770B;&#x770B;&#x5E95;&#x5C42;&#x53D1;&#x751F;&#x4E86;&#x4EC0;&#x4E48;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/ac5693a1f44a5fe30a85a475ffad5578.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6946555149305249805.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6946555149305249805.html" itemprop="url">盘点认证框架   SpringSecurity Filter</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-04-02T21:42:16+08:00">
                2021-04-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>&#x603B;&#x6587;&#x6863; :<a href="https://dev.newban.cn/6941642435189538824">&#x6587;&#x7AE0;&#x76EE;&#x5F55;</a>  </p>
<p>Github : <a href="/external_links/f4c0695dd8cd8371c2f2fc9edde11029.html" target="blank" rel="noopener">github.com/black-ant</a></p>
</blockquote>
<h2 id="&#x4E00;-&#x524D;&#x8A00;"><a href="#&#x4E00;-&#x524D;&#x8A00;" class="headerlink" title="&#x4E00; . &#x524D;&#x8A00;"></a>&#x4E00; . &#x524D;&#x8A00;</h2><p>&#x4E0A;&#x4E00;&#x7BC7;&#x804A;&#x4E86;&#x804A; Secutity &#x7684;&#x57FA;&#x7840; , &#x8FD9;&#x4E00;&#x7BC7;&#x6211;&#x4EEC;&#x804A;&#x4E00;&#x804A; Securiy Filter , &#x57FA;&#x672C;&#x4E0A; Security &#x5E38;&#x89C1;&#x5F97;&#x529F;&#x80FD;&#x90FD;&#x80FD;&#x901A;&#x8FC7; Filter &#x627E;&#x5230;&#x76F8;&#x5173;&#x7684;&#x75D5;&#x8FF9; .</p>
<h2 id="&#x4E8C;-&#x4E00;&#x4E2A;&#x57FA;&#x672C;&#x7684;-Filter-&#x6848;&#x4F8B;"><a href="#&#x4E8C;-&#x4E00;&#x4E2A;&#x57FA;&#x672C;&#x7684;-Filter-&#x6848;&#x4F8B;" class="headerlink" title="&#x4E8C; . &#x4E00;&#x4E2A;&#x57FA;&#x672C;&#x7684; Filter &#x6848;&#x4F8B;"></a>&#x4E8C; . &#x4E00;&#x4E2A;&#x57FA;&#x672C;&#x7684; Filter &#x6848;&#x4F8B;</h2><p><strong>&#x5148;&#x6765;&#x770B;&#x770B;&#x6211;&#x4EEC;&#x4E4B;&#x524D;&#x8FD9;&#x4E48;&#x6CE8;&#x518C; Filter &#x7684; &gt;&gt;&gt;</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;AbstractAuthenticationProcessingFilter filter = new DatabaseAuthenticationFilter();</span><br><span class="line">filter.setAuthenticationManager(authenticationManagerBean());</span><br><span class="line">http.addFilterBefore(filter, UsernamePasswordAuthenticationFilter.class);</span><br></pre></td></tr></table></figure>

<p><strong>&#x6211;&#x4EEC;&#x6765;&#x8FFD;&#x6EAF;&#x4E00;&#x4E0B; Filter &#x600E;&#x4E48;&#x88AB;&#x52A0;&#x8F7D;&#x8FDB;&#x53BB;&#x7684; :</strong></p>
<blockquote>
<p>Step First : &#x5C06; Filter &#x52A0;&#x8F7D;&#x5230; Security &#x4F53;&#x7CFB;&#x4E2D;</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;// &#x6DFB;&#x52A0;&#x5230; HttpSecurity</span><br><span class="line">C- HttpSecurity</span><br><span class="line">    - this.filters.add(filter) : &#x8FD9;&#x91CC;&#x7684; filters &#x4EC5;&#x4EC5;&#x662F;&#x4E00;&#x4E2A; List &#x96C6;&#x5408;</span><br><span class="line">   </span><br><span class="line">// &#x8FFD;&#x6EAF;&#x4EE3;&#x7801;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8FD9;&#x4E2A;&#x96C6;&#x5408;&#x4F1A;&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; DefaultSecurityFilterChain    </span><br><span class="line">protected DefaultSecurityFilterChain performBuild() throws Exception {</span><br><span class="line">	Collections.sort(this.filters, this.comparator);</span><br><span class="line">	return new DefaultSecurityFilterChain(this.requestMatcher, this.filters);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><strong>HttpSecurity</strong> &#x8FD9;&#x4E2A;&#x7C7B;&#x6211;&#x4EEC;&#x540E;&#x9762;&#x4F1A;&#x8BE6;&#x7EC6;&#x8BF4;&#x8BF4; , &#x8FD9;&#x91CC;&#x4E86;&#x89E3;&#x5230;&#x4ED6;&#x5176;&#x4E2D;&#x7EF4;&#x62A4;&#x4E86;&#x4E00;&#x4E2A; Filter &#x96C6;&#x5408;&#x5373;&#x53EF; , &#x8FD9;&#x4E2A;&#x96C6;&#x5408;&#x4F1A;&#x88AB;&#x52A0;&#x8F7D;&#x5230; FilterChain &#x4E2D;</p>
<blockquote>
<p>Step 2 : Filter Chain &#x7684;&#x4F7F;&#x7528;&#x65B9;&#x5F0F;</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;// &#x6210;&#x529F;&#x6807;&#x6CE8;&#x65AD;&#x70B9;&#x540E; , &#x53EF;&#x4EE5;&#x8FFD;&#x6EAF;&#x5230;&#x6574;&#x4E2A;&#x7684;&#x52A0;&#x8F7D;&#x6D41;&#x7A0B; : </span><br><span class="line">// Step 1 : &#x8981;&#x6784;&#x5EFA;&#x4E00;&#x4E2A; springSecurityFilterChain</span><br><span class="line">@Bean(name = AbstractSecurityWebApplicationInitializer.DEFAULT_FILTER_NAME)</span><br><span class="line">public Filter springSecurityFilterChain()throws Exception {</span><br><span class="line">	boolean hasConfigurers = webSecurityConfigurers != null</span><br><span class="line">				&amp;&amp; !webSecurityConfigurers.isEmpty();</span><br><span class="line">	if (!hasConfigurers) {</span><br><span class="line">		WebSecurityConfigurerAdapter adapter = objectObjectPostProcessor.postProcess(new WebSecurityConfigurerAdapter() {});</span><br><span class="line">		webSecurity.apply(adapter);</span><br><span class="line">	}</span><br><span class="line">	return webSecurity.build();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// Step 2 : webSecurity.build() &#x6267;&#x884C;&#x6784;&#x5EFA;</span><br><span class="line">public final O build() throws Exception {</span><br><span class="line">    // &#x5C45;&#x7136;&#x8FD8;&#x53EF;&#x4EE5;&#x770B;&#x5230; CAS &#x64CD;&#x4F5C; , &#x8FD9;&#x91CC;&#x5E94;&#x8BE5;&#x662F;&#x8BBE;&#x7F6E;&#x7ED1;&#x5B9A;&#x72B6;&#x6001;</span><br><span class="line">	if (this.building.compareAndSet(false, true)) {</span><br><span class="line">        // &#x6267;&#x884C; Build</span><br><span class="line">		this.object = doBuild();</span><br><span class="line">		return this.object;</span><br><span class="line">	}</span><br><span class="line">	throw new AlreadyBuiltException(&quot;This object has already been built&quot;);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// Step 3 : AbstractConfiguredSecurityBuilder &#x4E2D;</span><br><span class="line">protected final O doBuild() throws Exception {</span><br><span class="line">	synchronized (configurers) {</span><br><span class="line">		buildState = BuildState.INITIALIZING;</span><br><span class="line">                // &#x4E3A;&#x5B50;&#x7C7B;&#x6302;&#x8F7D;&#x94A9;&#x5B50;</span><br><span class="line">		beforeInit();</span><br><span class="line">		init();</span><br><span class="line"></span><br><span class="line">		buildState = BuildState.CONFIGURING;</span><br><span class="line">                // &#x5728;&#x8C03;&#x7528;&#x6BCF;&#x4E2A;SecurityConfigurer#configure(SecurityBuilder)&#x65B9;&#x6CD5;&#x4E4B;&#x524D;&#x8C03;&#x7528;&#x3002;</span><br><span class="line">                // &#x5B50;&#x7C7B;&#x53EF;&#x4EE5;&#x5728;&#x4E0D;&#x9700;&#x8981;&#x4F7F;&#x7528;SecurityConfigurer&#x65F6; , &#x8986;&#x76D6;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x6765;&#x6302;&#x8F7D;&#x5230;&#x751F;&#x547D;&#x5468;&#x671F;&#x4E2D;</span><br><span class="line">		beforeConfigure();</span><br><span class="line">		configure();</span><br><span class="line"></span><br><span class="line">		buildState = BuildState.BUILDING;</span><br><span class="line">		// &#x5B9E;&#x9645;&#x6784;&#x5EFA;&#x5BF9;&#x8C61;</span><br><span class="line">		O result = performBuild();</span><br><span class="line"></span><br><span class="line">		buildState = BuildState.BUILT;</span><br><span class="line"></span><br><span class="line">		return result;</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// Step 4 : &#x81F3;&#x6B64;&#x53CD;&#x5C04;&#x83B7;&#x53D6;&#x5230; Filters &#x94FE;</span><br><span class="line">@Override</span><br><span class="line">protected DefaultSecurityFilterChain performBuild() throws Exception {</span><br><span class="line">	Collections.sort(filters, comparator);</span><br><span class="line">	return new DefaultSecurityFilterChain(requestMatcher, filters);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/78d57fc49fc652ece4f92f72c909416f804a47f61cb24d27e76d65690f164c0c" alt="image.png"></p>
<p>&#x53EF;&#x4EE5;&#x770B;&#x5230; , &#x6700;&#x5F00;&#x59CB;&#x6DFB;&#x52A0;&#x5230; Filter &#x96C6;&#x5408;&#x7684; Filter ,&#x6700;&#x7EC8;&#x4F1A;&#x7528;&#x4E8E;&#x6784;&#x5EFA; <strong>springSecurityFilterChain</strong> , &#x90A3;&#x4E48; springSecurityFilterChain &#x53C8;&#x662F;&#x5E72;&#x4EC0;&#x4E48;&#x7684;&#x5462;?</p>
<h2 id="&#x4E09;-Security-Filter-Chain"><a href="#&#x4E09;-Security-Filter-Chain" class="headerlink" title="&#x4E09; . Security Filter Chain"></a>&#x4E09; . Security Filter Chain</h2><p>Security &#x7684; Filter &#x548C; WebFilter &#x672C;&#x8D28;&#x662F;&#x4E00;&#x6837;&#x7684; , &#x53EA;&#x662F;&#x4E3A;&#x4E86;&#x5B9E;&#x73B0; Seccurity &#x7684;&#x529F;&#x80FD;</p>
<p><strong>&gt;&gt;&gt; &#x6765;&#x770B;&#x4E00;&#x4E0B; FilterChain &#x7684;&#x8C03;&#x7528;&#x94FE; :</strong>  </p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/1fbfeeec05cf786a785cf451a00afc547636ddc1648f25bc5bb3bf2aa9f651c6" alt="FilterChain001.jpg"></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/d64fb2ded25e0817e17ecb289b1ac6286be9ffb57f434173b624617a679d39ab" alt="image.png"></p>
<h3 id="3-1-FilterChain-&#x7684;&#x521B;&#x5EFA;&#x8FC7;&#x7A0B;"><a href="#3-1-FilterChain-&#x7684;&#x521B;&#x5EFA;&#x8FC7;&#x7A0B;" class="headerlink" title="3.1 FilterChain &#x7684;&#x521B;&#x5EFA;&#x8FC7;&#x7A0B;"></a>3.1 FilterChain &#x7684;&#x521B;&#x5EFA;&#x8FC7;&#x7A0B;</h3><p>FilterChain &#x7684;&#x6838;&#x5FC3;&#x662F;&#x4E00;&#x4E2A; <strong>VirtualFilterChain</strong> , &#x6BCF;&#x4E2A;&#x8BF7;&#x6C42;&#x8FC7;&#x6765;&#x90FD;&#x4F1A;&#x6709;&#x4E00;&#x4E2A;<strong>VirtualFilterChain</strong> &#x751F;&#x6210;</p>
<p>VirtualFilterChain &#x662F; <strong>FilterChainProxy</strong> &#x7684;&#x5185;&#x90E8;&#x7C7B;.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;// &#x8865;&#x5145; : VirtualFilterChain : &#x5185;&#x90E8;&#x8FC7;&#x6EE4;&#x5668;&#x94FE;&#x5B9E;&#x73B0;&#xFF0C;&#x7528;&#x4E8E;&#x901A;&#x8FC7;&#x4E0E;&#x8BF7;&#x6C42;&#x5339;&#x914D;&#x7684;&#x989D;&#x5916;&#x5185;&#x90E8;&#x8FC7;&#x6EE4;&#x5668;&#x5217;&#x8868;&#x4F20;&#x9012;&#x8BF7;&#x6C42;</span><br><span class="line">C- VirtualFilterChain</span><br><span class="line">    ?- &#x6BCF;&#x6B21;&#x8FD0;&#x884C;&#x7684;&#x65F6;&#x5019;&#x90FD;&#x4F1A;&#x521B;&#x5EFA; , &#x6765;&#x94FE;&#x8868;&#x8C03;&#x7528;&#x6240;&#x6709;&#x7684; Filter</span><br><span class="line">    P- currentPosition : &#x5F53;&#x524D;&#x8FD0;&#x884C; Filter &#x7684;&#x4E0B;&#x6807;</span><br><span class="line">    P- FirewalledRequest :  &#x53EF;&#x7528;&#x4E8E;&#x62D2;&#x7EDD;&#x6F5C;&#x5728;&#x5371;&#x9669;&#x7684;&#x8BF7;&#x6C42;&#x548C;/&#x6216;&#x5305;&#x88C5;&#x5B83;&#x4EEC;&#x6765;&#x63A7;&#x5236;&#x5B83;&#x4EEC;&#x7684;&#x884C;&#x4E3A;</span><br><span class="line">    P- List&lt;Filter&gt; additionalFilters : &#x5305;&#x542B;&#x6240;&#x6709;&#x7684; Filter &#x5BF9;&#x8C61;</span><br><span class="line">    M- doFilter(ServletRequest request, ServletResponse response)</span><br><span class="line">    ?- &#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4F1A;&#x4ECE;2&#x4E2A;&#x7EF4;&#x5EA6;&#x6765;&#x5904;&#x7406;</span><br><span class="line">        1- currentPosition == size : &#x5F53;&#x6267;&#x884C;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x7684;&#x65F6;&#x5019; , &#x5148;&#x91CD;&#x7F6E; FirewalledRequest , &#x518D;&#x8C03;&#x7528; originalChain</span><br><span class="line">        2- currentPosition != size  : &#x5728;&#x6B64;&#x4E4B;&#x524D;&#x4F9D;&#x6B21;&#x6267;&#x884C; Filter &#x96C6;&#x5408;&#x4E2D;&#x7684; doFilter</span><br></pre></td></tr></table></figure>

<blockquote>
<p>VirtualFilterChain &#x7684;&#x521B;&#x5EFA;&#x6D41;&#x7A0B; :</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">C- FilterChainProxy extends GenericFilterBean</span><br><span class="line">	?- GenericFilterBean &#x7EE7;&#x627F;&#x4E86; Filter &#x63A5;&#x53E3; , &#x5176;&#x6700;&#x7EC8;&#x4F1A;&#x7531; SpringWeb &#x7684; Filter &#x8FDB;&#x884C;&#x8C03;&#x7528;</span><br><span class="line">	M- doFilterInternal</span><br><span class="line">		- FirewalledRequest &#x7684;&#x76F8;&#x5173;&#x5904;&#x7406;</span><br><span class="line">		- &#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A; VirtualFilterChain ,&#x6267;&#x884C; Filter &#x94FE;</span><br><span class="line"></span><br><span class="line">// implements Filter</span><br><span class="line">@Override</span><br><span class="line">public void doFilter(ServletRequest request, ServletResponse response,</span><br><span class="line">			FilterChain chain) throws IOException, ServletException {</span><br><span class="line">	boolean clearContext = request.getAttribute(FILTER_APPLIED) == null;</span><br><span class="line">	if (clearContext) {</span><br><span class="line">		try {</span><br><span class="line">			request.setAttribute(FILTER_APPLIED, Boolean.TRUE);</span><br><span class="line">			doFilterInternal(request, response, chain);</span><br><span class="line">		}finally {</span><br><span class="line">			SecurityContextHolder.clearContext();</span><br><span class="line">			request.removeAttribute(FILTER_APPLIED);</span><br><span class="line">		}</span><br><span class="line">	}else {</span><br><span class="line">		doFilterInternal(request, response, chain);</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">private void doFilterInternal(ServletRequest request, ServletResponse response,</span><br><span class="line">			FilterChain chain) throws IOException, ServletException {</span><br><span class="line"></span><br><span class="line">	FirewalledRequest fwRequest = firewall.getFirewalledRequest((HttpServletRequest) request);</span><br><span class="line">	HttpServletResponse fwResponse = firewall.getFirewalledResponse((HttpServletResponse) response);</span><br><span class="line">    </span><br><span class="line">	List&lt;Filter&gt; filters = getFilters(fwRequest);</span><br><span class="line">	if (filters == null || filters.size() == 0) {</span><br><span class="line">			// &#x65E5;&#x5FD7;&#x7565;...	</span><br><span class="line">			fwRequest.reset();</span><br><span class="line">			chain.doFilter(fwRequest, fwResponse);</span><br><span class="line">			return;</span><br><span class="line">	}</span><br><span class="line">        // &#x8FD9;&#x91CC;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x5185;&#x90E8;&#x7C7B; VirtualFilterChain</span><br><span class="line">	VirtualFilterChain vfc = new VirtualFilterChain(fwRequest, chain, filters);</span><br><span class="line">        // &#x7C7B;&#x4F3C;&#x4E8E;&#x94FE;&#x8868;&#x7684;&#x65B9;&#x5F0F; , &#x4F9D;&#x6B21;&#x6765;&#x8C03;&#x7528;</span><br><span class="line">	vfc.doFilter(fwRequest, fwResponse);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// &#x6269;&#x5C55; : FirewalledRequest </span><br><span class="line">C- FirewalledRequest : </span><br><span class="line">	?- &#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x914D;&#x5408;&#x9632;&#x706B;&#x5899;&#x529F;&#x80FD;&#x7684;Request &#x5B9E;&#x73B0;&#x7C7B; , &#x5176;&#x901A;&#x5E38;&#x914D;&#x5408; HttpFirewall &#x6765;&#x5B9E;&#x73B0;</span><br><span class="line">	M- reset : &#x91CD;&#x7F6E;&#x65B9;&#x6CD5;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x5141;&#x8BB8;&#x5728;&#x8BF7;&#x6C42;&#x79BB;&#x5F00;&#x5B89;&#x5168;&#x8FC7;&#x6EE4;&#x5668;&#x94FE;&#x65F6;&#x7531;FilterChainProxy&#x91CD;&#x7F6E;&#x90E8;&#x5206;&#x6216;&#x5168;&#x90E8;&#x72B6;&#x6001;</span><br><span class="line">    </span><br><span class="line">C- StrictHttpFirewall</span><br><span class="line">    M- getFirewalledRequest</span><br><span class="line">        - rejectForbiddenHttpMethod(request) : &#x62D2;&#x7EDD;&#x7981;&#x6B62;&#x7684; HttpMethod</span><br><span class="line">        - rejectedBlacklistedUrls(request) : &#x62D2;&#x7EDD;&#x9ED1;&#x540D;&#x5355; URL </span><br><span class="line">        - return new FirewalledRequest(request) : &#x8FD9;&#x91CC;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A; FirewalledRequest , &#x4E0D;&#x8FC7; reset &#x662F;&#x7A7A;&#x5B9E;&#x73B0;</span><br></pre></td></tr></table></figure>

<p>&#x53EF;&#x4EE5;&#x770B;&#x5230; , &#x8FD9;&#x91CC;&#x6BCF;&#x6B21;&#x6267;&#x884C; doFilterInternal &#x65F6;&#x90FD;&#x4F1A;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; VirtualFilterChain .</p>
<blockquote>
<p>&#x4E3B;&#x8981;&#x62BD;&#x8C61;&#x7C7B; AbstractAuthenticationProcessingFilter</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;C- AbstractAuthenticationProcessingFilter </span><br><span class="line">	- !requiresAuthentication(request, response) : &#x786E;&#x5B9A;&#x662F;&#x5426;&#x5339;&#x914D;&#x8BE5;&#x8BF7;&#x6C42;</span><br><span class="line">		?- &#x6CE8;&#x610F; ,&#x6211;&#x4EEC;&#x6784;&#x5EFA; DatabaseAuthenticationFilter &#x7684;&#x65F6;&#x5019;&#x5176;&#x5B9E;&#x662F;&#x4F20;&#x5165;&#x4E86;&#x4E00;&#x4E2A;Matcher&#x5339;&#x914D;&#x5668;&#x7684;</span><br><span class="line">		- requiresAuthenticationRequestMatcher.matches(request);</span><br><span class="line">		- &#x4E0D;&#x5339;&#x914D;&#x5219;&#x7EE7;&#x7EED;&#x6267;&#x884C; FilterChain</span><br><span class="line">	- &#x5339;&#x914D;&#x540E;&#x7EE7;&#x7EED;&#x6267;&#x884C;</span><br><span class="line">	- Authentication authResult = attemptAuthentication(request, response);</span><br><span class="line">	// &#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x662F;&#x9700;&#x8981;&#x5B9E;&#x73B0;&#x7C7B;&#x590D;&#x5199;&#x7684; , &#x5728;&#x5B9E;&#x73B0;&#x7C7B;&#x4E2D;&#x6211;&#x4EEC;&#x505A;&#x4E86;&#x4E0B;&#x9762;&#x7684;&#x4E8B;&#x60C5;</span><br><span class="line">		- &#x5C06; Request &#x4E2D;&#x7684;&#x9A8C;&#x8BC1;&#x4FE1;&#x606F; (&#x8D26;&#x6237;&#x5BC6;&#x7801;, &#x5982;&#x679C;&#x9700;&#x8981;&#x6269;&#x5C55; ,&#x53EF;&#x4EE5;&#x662F;&#x66F4;&#x591A;&#x4FE1;&#x606F; , Cookie , Header &#x7B49;&#x7B49;) &#x53D6;&#x51FA;</span><br><span class="line">		- &#x6784;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A; Token (DatabaseUserToken) </span><br><span class="line">		- &#x5C06; Token &#x653E;&#x5165; Details &#x4E2D;</span><br><span class="line">		- &#x901A;&#x8FC7; AuthenticationManager &#x8C03;&#x7528; ProviderManager &#x5B8C;&#x6210;&#x8BA4;&#x8BC1;</span><br><span class="line">		// &#x5177;&#x4F53;&#x7684;&#x8BA4;&#x8BC1;&#x65B9;&#x5F0F;&#x6211;&#x4EEC;&#x540E;&#x7EED;&#x5728;&#x8BE6;&#x7EC6;&#x5206;&#x6790;</span><br></pre></td></tr></table></figure>

<p>&#x6211;&#x4E4B;&#x524D;&#x4EE5;&#x4E3A; Security &#x7684;&#x65B9;&#x5F0F;&#x662F;&#x628A; &#x6240;&#x6709;&#x7684; Filter &#x8D70;&#x4E00;&#x904D;&#x540E;&#x518D;&#x6267;&#x884C; Provider , &#x4ECE;&#x8FD9;&#x91CC;&#x770B;&#x6765;&#x4ED6;&#x91C7;&#x7528;&#x7684;&#x662F;Filter &#x9002;&#x914D;&#x540E;&#x5C31;&#x76F4;&#x63A5;&#x6267;&#x884C; Provider</p>
<h3 id="3-2-WebAsyncManagerIntegrationFilter"><a href="#3-2-WebAsyncManagerIntegrationFilter" class="headerlink" title="3.2 WebAsyncManagerIntegrationFilter"></a>3.2 WebAsyncManagerIntegrationFilter</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">C- WebAsyncManagerIntegrationFilter</span><br><span class="line">	?- &#x63D0;&#x4F9B;SecurityContext&#x548C;Spring Web&#x7684;webbasyncmanager&#x4E4B;&#x95F4;&#x7684;&#x96C6;&#x6210;            </span><br><span class="line">	?- SecurityContextCallableProcessingInterceptor#beforeConcurrentHandling &#x7528;&#x4E8E;&#x586B;&#x5145;SecurityContext</span><br><span class="line">        </span><br><span class="line">C- &#x521B;&#x5EFA;&#x4E00;&#x4E2A;WebAsyncManager  </span><br><span class="line">	?- &#x7528;&#x4E8E;&#x7BA1;&#x7406;&#x5F02;&#x6B65;&#x8BF7;&#x6C42;&#x5904;&#x7406;&#x7684;&#x4E2D;&#x5FC3;&#x7C7B;&#xFF0C;&#x4E3B;&#x8981;&#x7528;&#x4F5C;SPI&#xFF0C;&#x901A;&#x5E38;&#x4E0D;&#x76F4;&#x63A5;&#x7531;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7C7B;&#x4F7F;&#x7528;&#x3002;</span><br><span class="line">        </span><br><span class="line">@Override</span><br><span class="line">protected void doFilterInternal(HttpServletRequest request,HttpServletResponse response, FilterChain filterChain)throws ServletException, IOException {</span><br><span class="line">    // &#x521B;&#x5EFA;&#x4E00;&#x4E2A;WebAsyncManager</span><br><span class="line">    // &#x7528;&#x4E8E;&#x7BA1;&#x7406;&#x5F02;&#x6B65;&#x8BF7;&#x6C42;&#x5904;&#x7406;&#x7684;&#x4E2D;&#x5FC3;&#x7C7B;&#xFF0C;&#x4E3B;&#x8981;&#x7528;&#x4F5C;SPI&#xFF0C;&#x901A;&#x5E38;&#x4E0D;&#x76F4;&#x63A5;&#x7531;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7C7B;&#x4F7F;&#x7528;&#x3002; </span><br><span class="line">    WebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request);</span><br><span class="line">    </span><br><span class="line">    SecurityContextCallableProcessingInterceptor securityProcessingInterceptor = (SecurityContextCallableProcessingInterceptor) asyncManager</span><br><span class="line">				.getCallableInterceptor(CALLABLE_INTERCEPTOR_KEY);</span><br><span class="line">    // &#x5982;&#x679C;&#x6CA1;&#x6709; SecurityContextCallableProcessingInterceptor , &#x5219;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x6CE8;&#x5165; WebAsyncManager    </span><br><span class="line">    if (securityProcessingInterceptor == null) {</span><br><span class="line">        asyncManager.registerCallableInterceptor(CALLABLE_INTERCEPTOR_KEY,new SecurityContextCallableProcessingInterceptor());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    filterChain.doFilter(request, response);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="3-3-SecurityContextPersistenceFilter-&#x4F53;&#x7CFB;"><a href="#3-3-SecurityContextPersistenceFilter-&#x4F53;&#x7CFB;" class="headerlink" title="3.3 SecurityContextPersistenceFilter &#x4F53;&#x7CFB;"></a>3.3 SecurityContextPersistenceFilter &#x4F53;&#x7CFB;</h3><p>&#x6CE8;&#x610F; , SecurityContext &#x662F;&#x6574;&#x4E2A;&#x8BA4;&#x8BC1;&#x7684;&#x6838;&#x5FC3; , <strong>&#x62E5;&#x6709; SecurityContext &#x5373;&#x8868;&#x793A;&#x8BA4;&#x8BC1;&#x6210;&#x529F;</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;C- SecurityContextPersistenceFilter</span><br><span class="line">	?- &#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5FC5;&#x9009;&#x7684;Filter , &#x5176;&#x76EE;&#x7684;&#x662F;&#x4E3A;&#x4E86;&#x5F80; SecurityContextHolder &#x4E2D;&#x63D2;&#x5165;&#x4E00;&#x4E2A; SecurityContext , SecurityContext &#x662F;&#x6700;&#x6838;&#x5FC3;&#x7684;&#x8BA4;&#x8BC1;&#x5BB9;&#x5668;</span><br><span class="line">	- SecurityContext contextBeforeChainExecution = repo.loadContext(holder);</span><br><span class="line">            ?- &#x6CE8;&#x610F; , &#x8FD9;&#x91CC;&#x4F1A;&#x5C1D;&#x8BD5;&#x83B7;&#x53D6;Sesssion &#x7684; Context , &#x7528;&#x4E8E;&#x9A8C;&#x8BC1;</span><br><span class="line">	- SecurityContextHolder.setContext(contextBeforeChainExecution)</span><br><span class="line">            ?- &#x8BBE;&#x7F6E;&#x4E00;&#x4E2A; Context</span><br><span class="line">	- chain.doFilter(holder.getRequest(), holder.getResponse());</span><br><span class="line">	- finally &#x4E2D;&#x4F1A;&#x5728;&#x6240;&#x6709;filter &#x5B8C;&#x6210;&#x540E; , &#x5F80; SecurityContextHolder &#x63D2;&#x5165;&#x4E00;&#x4E2A; contextAfterChainExecution</span><br><span class="line">        ?- &#x6CE8;&#x610F;&#x524D;&#x9762;&#x662F; contextBeforeChainExecution </span><br><span class="line">        </span><br><span class="line">// finally &#x4EE3;&#x7801;&#x4E00;&#x89C8;</span><br><span class="line">finally {</span><br><span class="line">    SecurityContext contextAfterChainExecution = SecurityContextHolder.getContext();</span><br><span class="line">    // &#x6E05;&#x9664; Context</span><br><span class="line">    SecurityContextHolder.clearContext();</span><br><span class="line">    // &#x91CD;&#x65B0;&#x4FDD;&#x5B58;&#x65B0;&#x5F97; Context</span><br><span class="line">    repo.saveContext(contextAfterChainExecution, holder.getRequest(),holder.getResponse());</span><br><span class="line">    request.removeAttribute(FILTER_APPLIED);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="3-4-HeaderWriterFilter-&#x4F53;&#x7CFB;"><a href="#3-4-HeaderWriterFilter-&#x4F53;&#x7CFB;" class="headerlink" title="3.4 HeaderWriterFilter &#x4F53;&#x7CFB;"></a>3.4 HeaderWriterFilter &#x4F53;&#x7CFB;</h3><p><code>List&lt;HeaderWriter&gt; headerWriters</code> : &#x6784;&#x9020;&#x5BF9;&#x8C61;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x5199;&#x5165;&#x4E00;&#x4E2A;list</p>
<p><strong>&#x6838;&#x5FC3;&#x65B9;&#x6CD5; :</strong> <code>doFilterInternal</code></p>
<ul>
<li>&#x51C6;&#x5907;&#x4E86;2&#x4E2A; HeaderWriterResponse , HeaderWriterRequest , &#x4ED6;&#x4EEC;&#x652F;&#x6301;&#x5BF9;Header &#x7684;&#x4E8C;&#x6B21;&#x5C01;&#x88C5; (&#x539F;&#x672C;&#x7684; Servlet &#x662F;&#x4E0D;&#x652F;&#x6301;&#x7684;)</li>
<li>filterChain &#x5B8C;&#x6210;&#x540E;&#x4F1A;&#x6267;&#x884C; headerWriterResponse.writeHeaders();</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;// eaderWriterResponse.writeHeaders() &#x662F;&#x4ECE; HeadersConfigurer &#x4E2D;&#x83B7;&#x53D6;&#x7684;</span><br><span class="line">C- HeadersConfigurer        </span><br><span class="line">    M- private List&lt;HeaderWriter&gt; getHeaderWriters() {</span><br><span class="line">        List&lt;HeaderWriter&gt; writers = new ArrayList&lt;&gt;();</span><br><span class="line">        addIfNotNull(writers, contentTypeOptions.writer);</span><br><span class="line">        addIfNotNull(writers, xssProtection.writer);</span><br><span class="line">        addIfNotNull(writers, cacheControl.writer);</span><br><span class="line">        addIfNotNull(writers, hsts.writer);</span><br><span class="line">        addIfNotNull(writers, frameOptions.writer);</span><br><span class="line">        addIfNotNull(writers, hpkp.writer);</span><br><span class="line">        addIfNotNull(writers, contentSecurityPolicy.writer);</span><br><span class="line">        addIfNotNull(writers, referrerPolicy.writer);</span><br><span class="line">        addIfNotNull(writers, featurePolicy.writer);</span><br><span class="line">        writers.addAll(headerWriters);</span><br><span class="line">        return writers;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="3-5-LogoutFilter"><a href="#3-5-LogoutFilter" class="headerlink" title="3.5 LogoutFilter"></a>3.5 LogoutFilter</h3><p>LogoutFilter <strong>&#x5141;&#x8BB8;&#x5B9A;&#x5236;LogoutHandler</strong> , &#x8FD9;&#x4E00;&#x70B9;&#x5728;&#x6784;&#x9020;&#x51FD;&#x6570;&#x91CC;&#x9762;&#x5C31;&#x80FD;&#x770B;&#x5230;<br>&#x53EF;&#x4EE5;&#x770B;&#x5230; , &#x9ED8;&#x8BA4;&#x4F7F;&#x7528; logout &#x5730;&#x5740;&#x4F5C;&#x4E3A;&#x62E6;&#x622A;&#x8BF7;&#x6C42;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;public LogoutFilter(LogoutSuccessHandler logoutSuccessHandler,</span><br><span class="line">			LogoutHandler... handlers) {</span><br><span class="line">		this.handler = new CompositeLogoutHandler(handlers);</span><br><span class="line">		Assert.notNull(logoutSuccessHandler, &quot;logoutSuccessHandler cannot be null&quot;);</span><br><span class="line">		this.logoutSuccessHandler = logoutSuccessHandler;</span><br><span class="line">		setFilterProcessesUrl(&quot;/logout&quot;);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// LogoutFilter doFilter &#x903B;&#x8F91;</span><br><span class="line">M- doFilter </span><br><span class="line">    ?- &#x53EA;&#x8981;&#x7684;&#x64CD;&#x4F5C;&#x5C31;&#x662F;&#x8C03;&#x7528;handler &#x6267;&#x884C; logout &#x903B;&#x8F91; , &#x5E76;&#x4E14;&#x8C03;&#x7528; LogoutSuccess &#x903B;&#x8F91; </span><br><span class="line">    </span><br><span class="line">public void doFilter(ServletRequest req, ServletResponse res, FilterChain chain)</span><br><span class="line">			throws IOException, ServletException {</span><br><span class="line">    HttpServletRequest request = (HttpServletRequest) req;</span><br><span class="line">    HttpServletResponse response = (HttpServletResponse) res;</span><br><span class="line">    </span><br><span class="line">    if (requiresLogout(request, response)) {</span><br><span class="line">        Authentication auth = SecurityContextHolder.getContext().getAuthentication();</span><br><span class="line">        // &#x6267;&#x884C; LogoutHandler &#x7684;&#x5B9E;&#x73B0;&#x7C7B;</span><br><span class="line">        this.handler.logout(request, response, auth);</span><br><span class="line">        // &#x6267;&#x884C; LogoutSuccessHandler &#x7684;&#x5B9E;&#x73B0;&#x7C7B;</span><br><span class="line">        logoutSuccessHandler.onLogoutSuccess(request, response, auth);</span><br><span class="line">        return;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    chain.doFilter(request, response);</span><br><span class="line">}    </span><br><span class="line"></span><br><span class="line">// PS : &#x8FD9;&#x4E2A; Filter &#x6709;&#x4E00;&#x5B9A;&#x5C40;&#x9650;&#x6027; , &#x65E0;&#x6CD5;&#x5904;&#x7406;&#x591A;&#x4E2A; Handler , &#x53EF;&#x4EE5;&#x8003;&#x8651;&#x5B9A;&#x5236;&#x4E00;&#x4E2A; Filter</span><br><span class="line">// Handler &#x5B9E;&#x73B0;&#x7C7B;&#x6211;&#x4EEC;&#x540E;&#x7EED;&#x518D;&#x6DF1;&#x5165;</span><br></pre></td></tr></table></figure>

<h3 id="3-6-CsrfFilter"><a href="#3-6-CsrfFilter" class="headerlink" title="3.6 CsrfFilter"></a>3.6 CsrfFilter</h3><p>&#x4E4B;&#x524D;&#x4E86;&#x89E3;&#x5230; , &#x4E3A;&#x4E86;<strong>&#x4F7F;&#x540C;&#x6B65;&#x5668;&#x4EE4;&#x724C;&#x6A21;&#x5F0F;&#x80FD;&#x591F;&#x9632;&#x6B62; CSRF &#x653B;&#x51FB;</strong>&#xFF0C;&#x5FC5;&#x987B;&#x5728; HTTP &#x8BF7;&#x6C42;&#x4E2D;&#x5305;&#x542B;&#x5B9E;&#x9645;&#x7684; CSRF &#x4EE4;&#x724C;&#x3002;&#x8FD9;&#x5FC5;&#x987B;&#x5305;&#x542B;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x4E0D;&#x4F1A;&#x81EA;&#x52A8;&#x5305;&#x542B;&#x5728; HTTP &#x8BF7;&#x6C42;&#x4E2D;&#x7684;&#x8BF7;&#x6C42;&#x7684;&#x4E00;&#x90E8;&#x5206;(&#x5373;&#x8868;&#x5355;&#x53C2;&#x6570;&#x3001; HTTP &#x5934;&#x7B49;)&#x4E2D;&#x3002;</p>
<p><strong>Spring Security &#x7684; CsrfFilter &#x5C06;&#x4E00;&#x4E2A; CsrfToken &#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x540D;&#x4E3A; _csrf &#x7684; HttpServletRequest &#x516C;&#x5F00;&#x5C5E;&#x6027;</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">protected void doFilterInternal(HttpServletRequest request,</span><br><span class="line">			HttpServletResponse response, FilterChain filterChain)</span><br><span class="line">					throws ServletException, IOException {</span><br><span class="line">    request.setAttribute(HttpServletResponse.class.getName(), response);</span><br><span class="line">    // &#x52A0;&#x8F7D; CsrfToken</span><br><span class="line">    CsrfToken csrfToken = this.tokenRepository.loadToken(request);</span><br><span class="line">    final boolean missingToken = csrfToken == null;</span><br><span class="line">    if (missingToken) {</span><br><span class="line">        // &#x7F3A;&#x5931;&#x5219;&#x91CD;&#x65B0;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;</span><br><span class="line">        csrfToken = this.tokenRepository.generateToken(request);</span><br><span class="line">        this.tokenRepository.saveToken(csrfToken, request, response);</span><br><span class="line">    }</span><br><span class="line">    request.setAttribute(CsrfToken.class.getName(), csrfToken);</span><br><span class="line">    request.setAttribute(csrfToken.getParameterName(), csrfToken);</span><br><span class="line"></span><br><span class="line">    if (!this.requireCsrfProtectionMatcher.matches(request)) {</span><br><span class="line">        filterChain.doFilter(request, response);</span><br><span class="line">        return;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    // &#x8DE8;&#x57DF;&#x540E;&#x6BD4;&#x5BF9;&#x5B9E;&#x9645;Token</span><br><span class="line">    String actualToken = request.getHeader(csrfToken.getHeaderName());</span><br><span class="line">    if (actualToken == null) {</span><br><span class="line">        actualToken = request.getParameter(csrfToken.getParameterName());</span><br><span class="line">    }</span><br><span class="line">    if (!csrfToken.getToken().equals(actualToken)) {</span><br><span class="line">        if (missingToken) {</span><br><span class="line">            this.accessDeniedHandler.handle(request, response,new MissingCsrfTokenException(actualToken));</span><br><span class="line">        } else {</span><br><span class="line">            this.accessDeniedHandler.handle(request, response,new InvalidCsrfTokenException(csrfToken, actualToken));</span><br><span class="line">        }</span><br><span class="line">        return;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    filterChain.doFilter(request, response);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="3-9-&#x5176;&#x4ED6;&#x96F6;&#x6563;Token"><a href="#3-9-&#x5176;&#x4ED6;&#x96F6;&#x6563;Token" class="headerlink" title="3.9 &#x5176;&#x4ED6;&#x96F6;&#x6563;Token"></a>3.9 &#x5176;&#x4ED6;&#x96F6;&#x6563;Token</h3><p>&#x5982;&#x679C;&#x7F13;&#x5B58;&#x7684;&#x8BF7;&#x6C42;&#x4E0E;&#x5F53;&#x524D;&#x8BF7;&#x6C42;&#x5339;&#x914D;&#xFF0C;&#x5219;&#x8D1F;&#x8D23;&#x91CD;&#x65B0;&#x6784;&#x9020;&#x5DF2;&#x4FDD;&#x5B58;&#x7684;&#x8BF7;&#x6C42;</p>
<p><strong>&#x6574;&#x4E2A;&#x6838;&#x5FC3;&#x4EE3;&#x7801;&#x4E3B;&#x8981;&#x662F; 2&#x53E5;&#x8BDD;:&#x5176;&#x4E2D;&#x4E3B;&#x8981;&#x662F;&#x5C01;&#x88C5;&#x4E86;&#x4E00;&#x4E2A;&#x65B0;&#x5F97; wrappedSavedRequest</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;HttpServletRequest wrappedSavedRequest = requestCache.getMatchingRequest(</span><br><span class="line">    (HttpServletRequest) request, (HttpServletResponse) response);</span><br><span class="line">chain.doFilter(wrappedSavedRequest == null ? request : wrappedSavedRequest,response);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>SecurityContextHolderAwareRequestFilter<br>&#x4E00;&#x4E2A;&#x8FC7;&#x6EE4;&#x5668;&#xFF0C;&#x5B83;&#x4F7F;&#x7528;<strong>&#x5B9E;&#x73B0;servlet API&#x5B89;&#x5168;&#x65B9;&#x6CD5;&#x7684;&#x8BF7;&#x6C42;&#x5305;&#x88C5;&#x5668;&#x586B;&#x5145;ServletRequest</strong>  </p>
<p>&#x7B80;&#x5355;&#x70B9;&#x8BF4; , &#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x5C01;&#x88C5; Request &#x7684; Filter , &#x5C01;&#x88C5;&#x7684; HttpServletRequest <strong>&#x63D0;&#x4F9B;&#x4E86;</strong>&#x5F88;&#x591A;<strong>&#x989D;&#x5916;&#x7684;&#x529F;&#x80FD;</strong></p>
</blockquote>
<ul>
<li>HttpServletRequest.authenticate() - &#x5141;&#x8BB8;&#x7528;&#x6237;&#x786E;&#x5B9A;&#x4ED6;&#x4EEC;&#x662F;&#x5426;&#x88AB;&#x9A8C;&#x8BC1;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#xFF0C;&#x5219;&#x5C06;&#x7528;&#x6237;&#x53D1;&#x9001;&#x5230;&#x767B;&#x5F55;&#x9875;&#x9762;</li>
<li>HttpServletRequest.login() - &#x5141;&#x8BB8;&#x7528;&#x6237;&#x4F7F;&#x7528;AuthenticationManager&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;</li>
<li>HttpServletRequest.logout() - &#x5141;&#x8BB8;&#x7528;&#x6237;&#x4F7F;&#x7528;Spring Security&#x4E2D;&#x914D;&#x7F6E;&#x7684;LogoutHandlers&#x6CE8;&#x9500;</li>
</ul>
<blockquote>
<p>SessionManagementFilter<br>SessionManagementFilter &#x4E2D;&#x63D0;&#x4F9B;&#x4E86;&#x591A;&#x4E2A;&#x5BF9;&#x8C61;&#x7528;&#x4E8E;&#x5728;&#x7528;&#x6237;&#x5DF2;&#x7ECF;&#x8BA4;&#x8BC1;&#x540E;&#x8FDB;&#x884C; Session &#x4F1A;&#x8BDD;&#x6D3B;&#x52A8; ,** &#x6FC0;&#x6D3B;&#x4F1A;&#x8BDD;&#x56FA;&#x5B9A;&#x4FDD;&#x62A4;&#x673A;&#x5236;&#x6216;&#x68C0;&#x67E5;&#x591A;&#x4E2A;&#x5E76;&#x53D1;&#x767B;&#x5F55;**</p>
</blockquote>
<ul>
<li>SecurityContextRepository securityContextRepository;</li>
<li>SessionAuthenticationStrategy sessionAuthenticationStrategy;</li>
</ul>
<h3 id="3-8-ExceptionTranslationFilter"><a href="#3-8-ExceptionTranslationFilter" class="headerlink" title="3.8 ExceptionTranslationFilter"></a>3.8 ExceptionTranslationFilter</h3><p><strong>&#x4F5C;&#x7528; :</strong> &#x5904;&#x7406;&#x8FC7;&#x6EE4;&#x5668;&#x94FE;&#x4E2D;&#x629B;&#x51FA;&#x7684;&#x4EFB;&#x4F55;AccessDeniedException&#x548C;AuthenticationException&#x3002;</p>
<p>&#x5982;&#x679C;&#x68C0;&#x6D4B;&#x5230;AuthenticationException&#xFF0C;&#x8FC7;&#x6EE4;&#x5668;&#x5C06;<strong>&#x542F;&#x52A8;authenticationEntryPoint</strong>&#x3002;&#x8FD9;&#x5141;&#x8BB8;&#x901A;&#x7528;&#x5730;&#x5904;&#x7406;&#x6765;&#x81EA;AbstractSecurityInterceptor&#x7684;&#x4EFB;&#x4F55;&#x5B50;&#x7C7B;&#x7684;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x5931;&#x8D25;&#x3002;</p>
<p><code>sendStartAuthentication(request, response, chain,(AuthenticationException) exception);</code></p>
<p>&#x5982;&#x679C;&#x68C0;&#x6D4B;&#x5230;AccessDeniedException&#xFF0C;<strong>&#x7B5B;&#x9009;&#x5668;&#x5C06;&#x786E;&#x5B9A;&#x8BE5;&#x7528;&#x6237;&#x662F;&#x5426;&#x662F;&#x533F;&#x540D;&#x7528;&#x6237;</strong>&#x3002;</p>
<ul>
<li>&#x5982;&#x679C;&#x5B83;&#x4EEC;&#x662F;&#x533F;&#x540D;&#x7528;&#x6237;&#xFF0C;&#x5219;&#x5C06;&#x542F;&#x52A8;authenticationEntryPoint&#x3002;</li>
<li>&#x5982;&#x679C;&#x5B83;&#x4EEC;&#x4E0D;&#x662F;&#x533F;&#x540D;&#x7528;&#x6237;&#xFF0C;&#x5219;&#x7B5B;&#x9009;&#x5668;&#x5C06;&#x59D4;&#x6258;&#x7ED9;AccessDeniedHandler&#x3002;</li>
<li>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8FC7;&#x6EE4;&#x5668;&#x5C06;&#x4F7F;&#x7528;AccessDeniedHandlerImpl&#x3002;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;sendStartAuthentication(request,response,chain,new InsufficientAuthenticationException(</span><br><span class="line">    messages.getMessage(&quot;ExceptionTranslationFilter.insufficientAuthentication&quot;,&quot;Full authentication is required to access this resource&quot;)));</span><br></pre></td></tr></table></figure>

<p><strong>(PS : &#x56E0;&#x4E3A;&#x662F;&#x94FE;&#x5F0F;&#x7ED3;&#x6784; , &#x6240;&#x4EE5;&#x4ED6;&#x4F5C;&#x4E3A;&#x6700;&#x540E;&#x4E00;&#x4E2A; , &#x4E5F;&#x662F;&#x5904;&#x5728;&#x6700;&#x5916;&#x5C42;&#x7684;)</strong></p>
<blockquote>
<p>&#x6838;&#x5FC3;&#x662F;&#x901A;&#x8FC7;&#x4E00;&#x4E2A; catch &#x6765;&#x5904;&#x7406;</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;try {</span><br><span class="line">    chain.doFilter(request, response);</span><br><span class="line">}catch (Exception ex) {</span><br><span class="line">    Throwable[] causeChain = throwableAnalyzer.determineCauseChain(ex);</span><br><span class="line">    RuntimeException ase = (AuthenticationException) throwableAnalyzer.getFirstThrowableOfType(AuthenticationException.class, causeChain);</span><br><span class="line">    // &#x83B7;&#x53D6;&#x4F9D;&#x6B21;&#x7C7B;&#x578B;</span><br><span class="line">    if (ase == null) {</span><br><span class="line">        ase = (AccessDeniedException) throwableAnalyzer.getFirstThrowableOfType(</span><br><span class="line">            AccessDeniedException.class, causeChain);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    if (ase != null) {</span><br><span class="line">        if (response.isCommitted()) {</span><br><span class="line">            throw new ServletException(&quot;Unable to handle the Spring Security Exception because the response is already committed.&quot;, ex);</span><br><span class="line">        }</span><br><span class="line">        // &#x4E13;&#x5C5E;&#x5904;&#x7406; SpringSecurityException</span><br><span class="line">        handleSpringSecurityException(request, response, chain, ase);</span><br><span class="line">    }else {</span><br><span class="line">        if (ex instanceof ServletException) {</span><br><span class="line">            throw (ServletException) ex;</span><br><span class="line">        }else if (ex instanceof RuntimeException) {</span><br><span class="line">            throw (RuntimeException) ex;</span><br><span class="line">        }</span><br><span class="line">        throw new RuntimeException(ex);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<ul>
<li>&#x9996;&#x5148;&#xFF0C;ExceptionTranslationFilter &#x8C03;&#x7528; FilterChain.doFilter (&#x8BF7;&#x6C42;&#x3001;&#x54CD;&#x5E94;)&#x6765;&#x8C03;&#x7528;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x5176;&#x4F59;&#x90E8;&#x5206;&#x3002;</li>
<li>&#x5982;&#x679C;&#x7528;&#x6237;&#x6CA1;&#x6709;&#x7ECF;&#x8FC7;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF0C;&#x6216;&#x8005;&#x5B83;&#x662F; AuthenticationException&#xFF0C;&#x90A3;&#x4E48;&#x542F;&#x52A8;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x3002;<ul>
<li>&#x6E05;&#x7A7A; Security contextholder</li>
<li>&#x5C06; HttpServletRequest &#x4FDD;&#x5B58;&#x5728; RequestCache &#x4E2D;&#x3002;&#x5F53;&#x7528;&#x6237;&#x6210;&#x529F;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x65F6;&#xFF0C;&#x4F7F;&#x7528; RequestCache&#x83B7;&#x53D6;&#x539F;&#x59CB;&#x8BF7;&#x6C42;</li>
<li>AuthenticationEntryPoint &#x7528;&#x4E8E;&#x4ECE;&#x5BA2;&#x6237;&#x673A;&#x8BF7;&#x6C42;&#x51ED;&#x636E;&#x3002;<ul>
<li>&#x4F8B;&#x5982;&#xFF0C;&#x5B83;&#x53EF;&#x80FD;&#x4F1A;&#x91CD;&#x5B9A;&#x5411;&#x5230;&#x4E00;&#x4E2A;&#x767B;&#x5F55;&#x9875;&#x9762;&#xFF0C;&#x6216;&#x8005;&#x53D1;&#x9001;&#x4E00;&#x4E2A; WWW-Authenticate &#x6807;&#x5934;&#x3002;</li>
</ul>
</li>
</ul>
</li>
<li>&#x5426;&#x5219;&#xFF0C;&#x5982;&#x679C;&#x5B83;&#x662F;&#x4E00;&#x4E2A; AccessDeniedException&#xFF0C;&#x90A3;&#x4E48; Access Denied</li>
</ul>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/a42fdcae4d67a77456b018c4e1eb9e6a0e34994d7aa5a093462301bb7a625bfc" alt="image.png"></p>
<p><strong>&#x5982;&#x679C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6CA1;&#x6709;&#x629B;&#x51FA; AccessDeniedException &#x6216; AuthenticationException&#xFF0C;&#x90A3;&#x4E48; ExceptionTranslationFilter &#x4E0D;&#x4F1A;&#x505A;&#x4EFB;&#x4F55;&#x4E8B;&#x60C5;&#x3002;</strong></p>
<h2 id="&#x56DB;-&#x4E1A;&#x52A1;&#x6D41;"><a href="#&#x56DB;-&#x4E1A;&#x52A1;&#x6D41;" class="headerlink" title="&#x56DB; . &#x4E1A;&#x52A1;&#x6D41;"></a>&#x56DB; . &#x4E1A;&#x52A1;&#x6D41;</h2><p>&#x8C08;&#x5230;&#x4E86; Filter , &#x80AF;&#x5B9A;&#x5C31;&#x8981;&#x7EC6;&#x804A; Filter &#x5BF9;&#x5E94;&#x7684;&#x4E1A;&#x52A1; , &#x4E0A;&#x9762;&#x8BF4;&#x4E86;&#x4E00;&#x4E9B;&#x7B80;&#x5355;&#x7684; Filter &#x4E1A;&#x52A1; , &#x8FD9;&#x4E00;&#x6BB5;&#x6211;&#x4EEC;&#x6765;&#x8BF4;&#x4E00;&#x8BF4;&#x6BD4;&#x8F83;&#x5927;&#x7684;&#x4E1A;&#x52A1;&#x6D41;&#x7A0B; :</p>
<h3 id="4-1-HttpSecurity-&#x7684;&#x4E1A;&#x52A1;&#x5339;&#x914D;"><a href="#4-1-HttpSecurity-&#x7684;&#x4E1A;&#x52A1;&#x5339;&#x914D;" class="headerlink" title="4.1 HttpSecurity &#x7684;&#x4E1A;&#x52A1;&#x5339;&#x914D;"></a>4.1 HttpSecurity &#x7684;&#x4E1A;&#x52A1;&#x5339;&#x914D;</h3><p>&#x6211;&#x4EEC;&#x5728;&#x914D;&#x7F6E; Security &#x7684;&#x65F6;&#x5019; , &#x4E00;&#x822C;&#x90FD;&#x4F1A;&#x914D;&#x7F6E; Request Match &#x7B49;&#x53C2;&#x6570; , &#x4F8B;&#x5982; :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801; http.authorizeRequests()</span><br><span class="line">                .antMatchers(&quot;/test/**&quot;).permitAll()</span><br><span class="line">                .antMatchers(&quot;/before/**&quot;).permitAll()</span><br><span class="line">                .antMatchers(&quot;/index&quot;).permitAll()</span><br><span class="line">                .antMatchers(&quot;/&quot;).permitAll()</span><br><span class="line">                .anyRequest().authenticated()                      //&#x5176;&#x5B83;&#x8BF7;&#x6C42;&#x90FD;&#x9700;&#x8981;&#x6821;&#x9A8C;&#x624D;&#x80FD;&#x8BBF;&#x95EE;</span><br><span class="line">                .and()</span><br><span class="line">                .formLogin()</span><br><span class="line">                .loginPage(&quot;/login&quot;)                             //&#x5B9A;&#x4E49;&#x767B;&#x5F55;&#x7684;&#x9875;&#x9762;&quot;/login&quot;&#xFF0C;&#x5141;&#x8BB8;&#x8BBF;&#x95EE;</span><br><span class="line">                .defaultSuccessUrl(&quot;/home&quot;)  //&#x767B;&#x5F55;&#x6210;&#x529F;&#x540E;&#x9ED8;&#x8BA4;&#x8DF3;&#x8F6C;&#x5230;&quot;list&quot;</span><br><span class="line">                .successHandler(myAuthenticationSuccessHandler).failureHandler(myAuthenctiationFailureHandler).permitAll().and()</span><br><span class="line">                .logout()                                           //&#x9ED8;&#x8BA4;&#x7684;&quot;/logout&quot;, &#x5141;&#x8BB8;&#x8BBF;&#x95EE;</span><br><span class="line">                .logoutSuccessUrl(&quot;/index&quot;)</span><br><span class="line">                .permitAll();</span><br></pre></td></tr></table></figure>

<p><strong>&#x90A3;&#x4E48;&#x8FD9;&#x4E9B;&#x53C2;&#x6570;&#x662F;&#x600E;&#x4E48;&#x751F;&#x6548;&#x7684;&#x5462; ?</strong></p>
<blockquote>
<p>Step End : &#x6700;&#x7EC8;&#x5339;&#x914D;&#x5BF9;&#x8C61;</p>
</blockquote>
<p>&#x6211;&#x4EEC;&#x6765;&#x6839;&#x636E;&#x6574;&#x4E2A;&#x4E1A;&#x52A1;&#x6D41;&#x7A0B;&#x9006;&#x63A8; , &#x5176;&#x6700;&#x7EC8;&#x5BF9;&#x8C61;&#x662F;&#x4E00;&#x4E2A; RequestMatcher &#x5B9E;&#x73B0;&#x7C7B;</p>
<p><strong>&#x6CE8;&#x610F; , &#x6211;&#x4EEC;&#x5176;&#x4E0A;&#x7684; antMatchers &#x7C7B;&#x578B;&#x4F1A;&#x751F;&#x6210;&#x591A;&#x79CD;&#x4E0D;&#x540C;&#x7684;&#x5B9E;&#x73B0;&#x7C7B; :</strong></p>
<ul>
<li>AndRequestMatcher : &#x8BF7;&#x6C42;&#x8DEF;&#x5F84;</li>
<li>IpAddressMatcher : IP&#x5730;&#x5740;</li>
<li>MediaTypeRequestMatcher : &#x5A92;&#x4F53;&#x7C7B;&#x578B;</li>
</ul>
<p>&#x2026;. &#x7B49;&#x7B49;&#x5176;&#x4ED6;&#x7684;&#x5C31;&#x4E0D;&#x8BE6;&#x7EC6;&#x8BF4;&#x4E86;</p>
<p><strong>&#x62FF;&#x5230;&#x5B9E;&#x73B0;&#x7C7B;&#x540E; ,&#x8C03;&#x7528; &#x5B9E;&#x73B0;&#x7C7B;&#x7684;matches &#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x6700;&#x7EC8;&#x7ED3;&#x679C;</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;public boolean matches(HttpServletRequest request) {</span><br><span class="line">    return requestMatcher.matches(request);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Step Start : &#x770B;&#x770B;&#x8BF7;&#x6C42;&#x7684;&#x8D77;&#x70B9;</p>
</blockquote>
<p>&#x627E;&#x5230;&#x4E86;&#x6700;&#x7EC8;&#x7684;&#x5339;&#x914D;&#x70B9; , &#x540E;&#x9762;&#x5C31;&#x597D;&#x8BF4;&#x4E86; , &#x6253;&#x4E2A;&#x65AD;&#x70B9; , &#x6574;&#x4E2A;&#x8C03;&#x7528;&#x94FE;&#x5C31;&#x6E05;&#x6E05;&#x695A;&#x695A;&#x4E86;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line"></span><br><span class="line">// Step1 : FilterChainProxy</span><br><span class="line">private void doFilterInternal(ServletRequest request, ServletResponse response,</span><br><span class="line">			FilterChain chain) throws IOException, ServletException {</span><br><span class="line"></span><br><span class="line">    FirewalledRequest fwRequest = firewall.getFirewalledRequest((HttpServletRequest) request);</span><br><span class="line">    HttpServletResponse fwResponse = firewall.getFirewalledResponse((HttpServletResponse) response);</span><br><span class="line">    List&lt;Filter&gt; filters = getFilters(fwRequest);</span><br><span class="line">    </span><br><span class="line">    //...... &#x7701;&#x7565;</span><br><span class="line">    // &#x6267;&#x884C; Filter &#x94FE; , &#x5982;&#x679C;&#x6CA1;&#x6709;&#x76F8;&#x5F53;&#x4E8E;&#x76F4;&#x63A5;&#x8FDB;&#x53BB;</span><br><span class="line">    if (filters == null || filters.size() == 0) {</span><br><span class="line">        chain.doFilter(fwRequest, fwResponse);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">// Step2 : getFilters &#x8FC7;&#x6EE4; Filter Chain </span><br><span class="line">for (SecurityFilterChain chain : filterChains) {</span><br><span class="line">    // &#x5982;&#x679C;&#x5730;&#x5740;&#x5339;&#x914D; , &#x5219;&#x6267;&#x884C;&#x5BF9;&#x8C61; Filter &#x94FE;</span><br><span class="line">    if (chain.matches(request)) {</span><br><span class="line">        return chain.getFilters();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><strong>&#x8FD9;&#x91CC;&#x53EF;&#x4EE5;&#x770B;&#x5230; , &#x5982;&#x679C;&#x6CA1;&#x6709;&#x88AB;&#x62E6;&#x622A;&#x6210;&#x529F;&#x7684; ,&#x6700;&#x7EC8;&#x5E94;&#x8BE5;&#x5C31;&#x76F4;&#x63A5;&#x8FD0;&#x884C;&#x4E86; , &#x6240;&#x4EE5; Security &#x4E00;&#x5207;&#x7684;&#x8D77;&#x70B9;&#x90FD;&#x662F; Filter</strong></p>
<h2 id="&#x4E94;-&#x8865;&#x5145;"><a href="#&#x4E94;-&#x8865;&#x5145;" class="headerlink" title="&#x4E94;.&#x8865;&#x5145;"></a>&#x4E94;.&#x8865;&#x5145;</h2><h3 id="5-1-DelegatingFilterProxy-&#x8865;&#x5145;"><a href="#5-1-DelegatingFilterProxy-&#x8865;&#x5145;" class="headerlink" title="5.1 DelegatingFilterProxy &#x8865;&#x5145;"></a>5.1 DelegatingFilterProxy &#x8865;&#x5145;</h3><p>Security &#x901A;&#x8FC7; DelegatingFilterProxy &#x5C06; Security &#x878D;&#x5165;&#x5230; WebFilter &#x7684;&#x4F53;&#x7CFB;&#x4E2D; ,&#x5176;&#x4E3B;&#x8981;&#x6D41;&#x7A0B;&#x4E3A; :</p>
<ul>
<li>C- DelegatingFilterProxy # doFilter</li>
<li>C- DelegatingFilterProxy # invokeDelegate</li>
<li>C- FilterChainProxy # doFilter</li>
</ul>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/2aad279cd8baeb0eadc7563a61da8fd8d5d3df393c8fdbb2a9ba348ff8ba8e6b" alt="image.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">JAVA&#x590D;&#x5236;&#x4EE3;&#x7801;public void doFilter(ServletRequest request, ServletResponse response, FilterChain filterChain)</span><br><span class="line">			throws ServletException, IOException {</span><br><span class="line"></span><br><span class="line">    // -&gt;  PIC51001 : delegate &#x5BF9;&#x8C61;&#x7ED3;&#x6784;</span><br><span class="line">    Filter delegateToUse = this.delegate;</span><br><span class="line">    if (delegateToUse == null) {</span><br><span class="line">        synchronized (this.delegateMonitor) {</span><br><span class="line">            delegateToUse = this.delegate;</span><br><span class="line">            if (delegateToUse == null) {</span><br><span class="line">                WebApplicationContext wac = findWebApplicationContext();</span><br><span class="line">                if (wac == null) {</span><br><span class="line">                    throw new IllegalStateException(&quot;...&quot;);</span><br><span class="line">                }</span><br><span class="line">                delegateToUse = initDelegate(wac);</span><br><span class="line">            }</span><br><span class="line">            this.delegate = delegateToUse;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    // Let the delegate perform the actual doFilter operation.</span><br><span class="line">    invokeDelegate(delegateToUse, request, response, filterChain);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">protected void invokeDelegate(</span><br><span class="line">      Filter delegate, ServletRequest request, ServletResponse response, FilterChain filterChain)</span><br><span class="line">      throws ServletException, IOException {</span><br><span class="line">    </span><br><span class="line">   // &#x4F1A;&#x8C03;&#x7528;&#x5230; FilterChainProxy , &#x6B63;&#x5F0F;&#x8FDB;&#x5165; Security &#x4F53;&#x7CFB;</span><br><span class="line">   delegate.doFilter(request, response, filterChain);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<blockquote>
<p>PIC51001 : delegate &#x5BF9;&#x8C61;&#x7ED3;&#x6784;</p>
</blockquote>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/7eed961e06dfd520ab4165a0c307c5b621dccdc852336f0190feea26e4a2ccc9" alt="image.png"></p>
<blockquote>
<p>&#x7EE7;&#x7EED;&#x8865;&#x5145; : delegate &#x7684;&#x521D;&#x59CB;&#x5316; , &#x83B7;&#x53D6; FilterChain</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;protected Filter initDelegate(WebApplicationContext wac) throws ServletException {</span><br><span class="line">   String targetBeanName = getTargetBeanName();</span><br><span class="line">   // &#x8FD9;&#x91CC;&#x7684; TargetBeanName &#x4E3A; springSecurityFilterChain</span><br><span class="line">   Filter delegate = wac.getBean(targetBeanName, Filter.class);</span><br><span class="line">   if (isTargetFilterLifecycle()) {</span><br><span class="line">      delegate.init(getFilterConfig());</span><br><span class="line">   }</span><br><span class="line">   return delegate;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h2 id="&#x603B;&#x7ED3;"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3;</h2><p>Spring Security &#x7684;&#x8D77;&#x70B9;&#x5C31;&#x662F; Filter ,&#x5E38;&#x7528;&#x7684;&#x529F;&#x80FD;&#x90FD;&#x80FD;&#x901A;&#x8FC7; Filter &#x627E;&#x5230;&#x76F8;&#x5173;&#x7684;&#x75D5;&#x8FF9; , &#x540E;&#x7EED;&#x6211;&#x4EEC;&#x4F1A;&#x7EE7;&#x7EED;&#x5206;&#x6790;&#x66F4;&#x5E95;&#x5C42;&#x7684;&#x4E1C;&#x897F;, &#x6765;&#x5F00;&#x679D;&#x6563;&#x53F6;&#x7684;&#x770B;&#x770B;&#x5E95;&#x4E0B;&#x7ECF;&#x5386;&#x4E86;&#x4EC0;&#x4E48;</p>
<p>Security &#x7684; Filter &#x548C; WebFilter &#x7684;&#x672C;&#x8D28;&#x4E00;&#x6837; , Security &#x901A;&#x8FC7;&#x4E00;&#x4E2A; <strong>DelegatingFilterProxy</strong> &#x5C06; <strong>SecurityFilterChain</strong> &#x96C6;&#x4E2D;&#x5230; Filter &#x4F53;&#x7CFB;&#x4E2D;</p>
<p>FilterChain &#x7684;&#x6838;&#x5FC3;&#x662F;&#x4E00;&#x4E2A; <strong>VirtualFilterChain</strong> , &#x6BCF;&#x4E2A;&#x8BF7;&#x6C42;&#x8FC7;&#x6765;&#x90FD;&#x4F1A;&#x6709;&#x4E00;&#x4E2A;<strong>VirtualFilterChain</strong> &#x751F;&#x6210; ,&#x5176;&#x4E2D;&#x4F1A;&#x6DFB;&#x52A0;&#x6240;&#x6709;&#x7684; Filter &#x7C7B;</p>
<blockquote>
<p>&#x7684; Filter &#x5305;&#x62EC; :</p>
</blockquote>
<ul>
<li>SecurityContextPersistenceFilter : &#x5BF9; SecurityContext &#x8FDB;&#x884C;&#x6301;&#x4E45;&#x5316;&#x64CD;&#x4F5C;</li>
<li>HeaderWriterFilter : &#x5BF9; Header &#x8FDB;&#x884C;&#x4E8C;&#x6B21;&#x5904;&#x7406; , &#x56E0;&#x4E3A;&#x5F88;&#x591A;&#x8BA4;&#x8BC1;&#x4FE1;&#x606F;&#x4F1A;&#x653E;&#x5728; Header &#x4E2D; , &#x8FD9;&#x4E5F;&#x662F;&#x4E00;&#x4E2A;&#x6781;&#x5176;&#x91CD;&#x8981;&#x7684;&#x7C7B;</li>
<li>LogoutFilter : &#x62E6;&#x622A; logout &#x8BF7;&#x6C42; , &#x5E76;&#x4E14;&#x9000;&#x51FA;</li>
<li>ExceptionTranslationFilter : &#x5BF9;&#x6D41;&#x7A0B;&#x4E2D;&#x7684;&#x5F02;&#x5E38;&#x8FDB;&#x884C;&#x5904;&#x7406; (AccessDeniedException&#x548C;AuthenticationException)</li>
</ul>
<p><strong>Filter &#x4F1A;&#x901A;&#x8FC7; matches &#x8FDB;&#x884C;&#x62E6;&#x622A; , &#x5224;&#x65AD;&#x662F;&#x5426;&#x8981;&#x6267;&#x884C; Filters &#x903B;&#x8F91;</strong></p>
<h2 id="&#x66F4;&#x65B0;&#x65E5;&#x5FD7;"><a href="#&#x66F4;&#x65B0;&#x65E5;&#x5FD7;" class="headerlink" title="&#x66F4;&#x65B0;&#x65E5;&#x5FD7;"></a>&#x66F4;&#x65B0;&#x65E5;&#x5FD7;</h2><p>V20210803 : &#x8865;&#x5145; DelegatingFilterProxy &#x903B;&#x8F91;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/9c8efaf3651ba233f3485bd1e25efb62.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6946448002475098148.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6946448002475098148.html" itemprop="url">CentOS 7 下 RabbitMQ 安装与配置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-04-02T14:46:03+08:00">
                2021-04-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>RabbitMQ &#x670D;&#x52A1;&#x5668;&#x5728;&#x5B89;&#x88C5;&#x4E4B;&#x524D;&#x9700;&#x8981;&#x5B89;&#x88C5; erlang&#x3002;</p>
<p>&#x6700;&#x65B0;&#x7248;&#x672C;&#x7684; RabbitMQ 3.8.0 &#x9700;&#x8981; Erlang 21.3 &#x4EE5;&#x4E0A;&#x7684;&#x7248;&#x672C;&#x652F;&#x6301;&#x3002;</p>
<p>&#x5728;&#x8FD9;&#x91CC;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5728;&#x4F60;&#x7684; CentOS &#x4E2D;&#x5B89;&#x88C5; Erlang 21.3.8.8 &#x7248;&#x672C;&#x3002;</p>
<h4 id="&#x4E0B;&#x8F7D;&#x5730;&#x5740;&#x548C;&#x8F6F;&#x4EF6;&#x66F4;&#x65B0;"><a href="#&#x4E0B;&#x8F7D;&#x5730;&#x5740;&#x548C;&#x8F6F;&#x4EF6;&#x66F4;&#x65B0;" class="headerlink" title="&#x4E0B;&#x8F7D;&#x5730;&#x5740;&#x548C;&#x8F6F;&#x4EF6;&#x66F4;&#x65B0;"></a>&#x4E0B;&#x8F7D;&#x5730;&#x5740;&#x548C;&#x8F6F;&#x4EF6;&#x66F4;&#x65B0;</h4><p>Erlang 21.3.8.8 &#x7248;&#x672C;&#x7684;&#x4E0B;&#x8F7D;&#x5730;&#x5740;&#xFF0C;&#x8BF7;&#x53C2;&#x8003;&#x94FE;&#x63A5;&#xFF1A;</p>
<p><a href="/external_links/d87ce699bf69c7255fc1b8770be37bbd.html" target="blank" rel="noopener">packagecloud.io/rabbitmq/er&#x2026;</a></p>
<p>RabbitMQ 3.8.0 &#x7684;&#x4E0B;&#x8F7D;&#x5730;&#x5740;&#xFF0C;&#x8BF7;&#x53C2;&#x8003;&#x94FE;&#x63A5;&#xFF1A;</p>
<p><a href="/external_links/303b21ad1866d00a6d7baacbc8d4e6ba.html" target="blank" rel="noopener">www.rabbitmq.com/install-rpm&#x2026;</a></p>
<h5 id="&#x5B89;&#x88C5;wget"><a href="#&#x5B89;&#x88C5;wget" class="headerlink" title="&#x5B89;&#x88C5;wget"></a>&#x5B89;&#x88C5;wget</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;yum install wget</span><br></pre></td></tr></table></figure>

<h5 id="&#x66F4;&#x65B0;yum"><a href="#&#x66F4;&#x65B0;yum" class="headerlink" title="&#x66F4;&#x65B0;yum"></a>&#x66F4;&#x65B0;yum</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sql&#x590D;&#x5236;&#x4EE3;&#x7801;yum update</span><br></pre></td></tr></table></figure>

<h4 id="&#x5B89;&#x88C5;-Erlang"><a href="#&#x5B89;&#x88C5;-Erlang" class="headerlink" title="&#x5B89;&#x88C5; Erlang"></a>&#x5B89;&#x88C5; Erlang</h4><p>&#x9996;&#x5148;&#x4F60;&#x9700;&#x8981;&#x4E0B;&#x8F7D; Erlang &#xFF0C;&#x7136;&#x540E;&#x8FDB;&#x884C;&#x5B89;&#x88C5;&#xFF0C;&#x5728;&#x4E0A;&#x9762;&#x63D0;&#x5230;&#x7684;&#x5730;&#x5740; <a href="/external_links/d87ce699bf69c7255fc1b8770be37bbd.html" target="blank" rel="noopener">packagecloud.io/rabbitmq/er&#x2026;</a> &#x4E2D;&#x7684;&#x53F3;&#x4FA7;&#x6709;&#x4E00;&#x4E2A; wget &#x7684;&#x5730;&#x5740;&#x3002;</p>
<p>&#x8FD0;&#x884C;&#x4E0B;&#x5217;&#x547D;&#x4EE4;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ruby&#x590D;&#x5236;&#x4EE3;&#x7801;//&#x4E24;&#x6761;&#x547D;&#x4EE4;&#x4E8C;&#x9009;&#x4E00;</span><br><span class="line">sudo yum install erlang-21.3.8.21-1.el7.x86_64</span><br><span class="line"></span><br><span class="line">wget --content-disposition https://packagecloud.io/rabbitmq/erlang/packages/el/7/erlang-21.3.8.21-1.el7.x86_64.rpm/download.rpm</span><br></pre></td></tr></table></figure>

<p>&#x4E0B;&#x8F7D;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x8FD0;&#x884C;&#x547D;&#x4EE4;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vbscript&#x590D;&#x5236;&#x4EE3;&#x7801;yum localinstall rabbitmq-server-3.8.0-1.el7.noarch.rpm</span><br></pre></td></tr></table></figure>

<p>&#x5F53;&#x4F60;&#x5B89;&#x88C5;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x8FD0;&#x884C;&#x547D;&#x4EE4;&#x6765;&#x67E5;&#x770B;&#x4F60;&#x5B89;&#x88C5;&#x7684; erl &#x7248;&#x672C;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;erl -version</span><br></pre></td></tr></table></figure>

<h4 id="&#x5B89;&#x88C5;-RabbitMQ"><a href="#&#x5B89;&#x88C5;-RabbitMQ" class="headerlink" title="&#x5B89;&#x88C5; RabbitMQ"></a>&#x5B89;&#x88C5; RabbitMQ</h4><p>&#x8FD0;&#x884C;&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x5C06; RabbitMQ &#x4E0B;&#x8F7D;&#x5230;&#x4F60;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ruby&#x590D;&#x5236;&#x4EE3;&#x7801;wget https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.8.0/rabbitmq-server-3.8.0-1.el7.noarch.rpm</span><br></pre></td></tr></table></figure>

<p>&#x5F53;&#x4F60;&#x4E0B;&#x8F7D;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x4F60;&#x9700;&#x8981;&#x8FD0;&#x884C;&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;&#x6765;&#x5C06; Key &#x5BFC;&#x5165;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arduino&#x590D;&#x5236;&#x4EE3;&#x7801;rpm --import https://www.rabbitmq.com/rabbitmq-release-signing-key.asc</span><br></pre></td></tr></table></figure>

<p>&#x4F7F;&#x7528; yum &#x8FDB;&#x884C;&#x672C;&#x5730;&#x5B89;&#x88C5;&#xFF0C;&#x8FD0;&#x884C;&#x547D;&#x4EE4;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vbscript&#x590D;&#x5236;&#x4EE3;&#x7801;yum localinstall rabbitmq-server-3.8.0-1.el7.noarch.rpm</span><br></pre></td></tr></table></figure>

<p>&#x5F53;&#x5B89;&#x88C5;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x547D;&#x4EE4;&#x6765;&#x542F;&#x52A8; rabbitmq &#x670D;&#x52A1;&#x5668;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sql&#x590D;&#x5236;&#x4EE3;&#x7801;systemctl start rabbitmq-server</span><br></pre></td></tr></table></figure>

<h4 id="RabbitMQ-&#x9632;&#x706B;&#x5899;&#x914D;&#x7F6E;"><a href="#RabbitMQ-&#x9632;&#x706B;&#x5899;&#x914D;&#x7F6E;" class="headerlink" title="RabbitMQ &#x9632;&#x706B;&#x5899;&#x914D;&#x7F6E;"></a>RabbitMQ &#x9632;&#x706B;&#x5899;&#x914D;&#x7F6E;</h4><p>&#x5982;&#x679C;&#x4F60;&#x4F7F;&#x7528;&#x7684;&#x662F; firewalld&#xFF0C;&#x90A3;&#x4E48;&#x8BF7;&#x4F9D;&#x6B21;&#x6267;&#x884C;&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">css&#x590D;&#x5236;&#x4EE3;&#x7801;firewall-cmd --zone=public --permanent --add-port=4369/tcp</span><br><span class="line"></span><br><span class="line">firewall-cmd --zone=public --permanent --add-port=25672/tcp</span><br><span class="line"></span><br><span class="line">firewall-cmd --zone=public --permanent --add-port=5671-5672/tcp</span><br><span class="line"></span><br><span class="line">firewall-cmd --zone=public --permanent --add-port=15672/tcp</span><br><span class="line"></span><br><span class="line">firewall-cmd --zone=public --permanent --add-port=61613-61614/tcp</span><br><span class="line"></span><br><span class="line">firewall-cmd --zone=public --permanent --add-port=1883/tcp</span><br><span class="line"></span><br><span class="line">firewall-cmd --zone=public --permanent --add-port=8883/tcp</span><br><span class="line"></span><br><span class="line">firewall-cmd --reload #&#x91CD;&#x8F7D;&#x9632;&#x706B;&#x5899;&#x914D;&#x7F6E;</span><br></pre></td></tr></table></figure>

<h4 id="RabbitMQ-&#x8BBE;&#x7F6E;&#x81EA;&#x52A8;&#x542F;&#x52A8;"><a href="#RabbitMQ-&#x8BBE;&#x7F6E;&#x81EA;&#x52A8;&#x542F;&#x52A8;" class="headerlink" title="RabbitMQ &#x8BBE;&#x7F6E;&#x81EA;&#x52A8;&#x542F;&#x52A8;"></a>RabbitMQ &#x8BBE;&#x7F6E;&#x81EA;&#x52A8;&#x542F;&#x52A8;</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bash&#x590D;&#x5236;&#x4EE3;&#x7801;systemctl enable rabbitmq-server</span><br><span class="line"></span><br><span class="line">systemctl status rabbitmq-server #&#x67E5;&#x770B;rabbitMQ&#x8FD0;&#x884C;&#x60C5;&#x51B5;</span><br></pre></td></tr></table></figure>

<h4 id="RabbitMQ-&#x542F;&#x7528;-Web-&#x7BA1;&#x7406;&#x754C;&#x9762;"><a href="#RabbitMQ-&#x542F;&#x7528;-Web-&#x7BA1;&#x7406;&#x754C;&#x9762;" class="headerlink" title="RabbitMQ &#x542F;&#x7528; Web &#x7BA1;&#x7406;&#x754C;&#x9762;"></a>RabbitMQ &#x542F;&#x7528; Web &#x7BA1;&#x7406;&#x754C;&#x9762;</h4><p>&#x5B89;&#x88C5; Web &#x7BA1;&#x7406;&#x754C;&#x9762;&#x7684;&#x63D2;&#x4EF6;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash&#x590D;&#x5236;&#x4EE3;&#x7801;rabbitmq-plugins enable rabbitmq_management</span><br></pre></td></tr></table></figure>

<p>&#x63D0;&#x4F9B; RabbitMQ &#x7528;&#x6237;&#x548C;&#x5BF9;&#x7528;&#x6237;&#x4F7F;&#x7528;&#x7684;&#x6743;&#x9650;&#x8FDB;&#x884C;&#x8D4B;&#x6743;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash&#x590D;&#x5236;&#x4EE3;&#x7801;chown -R rabbitmq:rabbitmq /var/lib/rabbitmq/</span><br></pre></td></tr></table></figure>

<p>&#x5206;&#x522B;&#x6267;&#x884C;&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">bash&#x590D;&#x5236;&#x4EE3;&#x7801;rabbitmqctl add_user admin 123456   #&#x521B;&#x5EFA;admin&#x7528;&#x6237; &#x5BC6;&#x7801;&#x4E3A;123456</span><br><span class="line"></span><br><span class="line">rabbitmqctl set_user_tags admin administrator  #&#x9488;&#x5BF9;&#x8FD9;&#x4E2A;&#x7528;&#x6237;&#x8FDB;&#x884C;&#x8D4B;&#x6743;</span><br><span class="line"></span><br><span class="line">rabbitmqctl set_permissions -p / admin &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;   #</span><br><span class="line"></span><br><span class="line">systemctl restart rabbitmq-server  #&#x91CD;&#x542F;rabbitmq</span><br></pre></td></tr></table></figure>

<p>&#x5F53;&#x4E0A;&#x9762;&#x547D;&#x4EE4;&#x6267;&#x884C;&#x6210;&#x529F;&#x540E;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x91CD;&#x542F;&#x4F60;&#x7684; RabbitMQ&#xFF0C;&#x7136;&#x540E;&#x901A;&#x8FC7;&#x6D4F;&#x89C8;&#x5668;&#x8FDB;&#x884C;&#x767B;&#x5F55;&#x3002;UI &#x754C;&#x9762;&#x4F7F;&#x7528;&#x7684;&#x7AEF;&#x53E3;&#x662F; 15672&#x3002;&#x56E0;&#x6B64;&#x8BBF;&#x95EE;&#x7684; URL &#x4E3A;&#x4F60;&#x670D;&#x52A1;&#x5668;&#x7684;&#x5730;&#x5740; + 15672&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arduino&#x590D;&#x5236;&#x4EE3;&#x7801;http://Your_Server_IP:15672/</span><br></pre></td></tr></table></figure>

<h4 id="&#x53C2;&#x8003;&#x94FE;&#x63A5;"><a href="#&#x53C2;&#x8003;&#x94FE;&#x63A5;" class="headerlink" title="&#x53C2;&#x8003;&#x94FE;&#x63A5;"></a>&#x53C2;&#x8003;&#x94FE;&#x63A5;</h4><p><a href="/external_links/c0cba60e4b6a0a0bc29036db70909812.html" target="blank" rel="noopener">&#x5728; CentOS 7 &#x4E0A;&#x5B89;&#x88C5; RabbitMQ</a></p>
<p><a href="/external_links/3c0f8ff894a5796b6c22370aa3dcc773.html" target="blank" rel="noopener">Install RabbitMQ Server on CentOS 7</a></p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/35f57195f37606523396ddfc24cadf5d.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6946348432244080676.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6946348432244080676.html" itemprop="url">SpringBoot——Quartz定时框架的使用详解和总结</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-04-02T08:22:58+08:00">
                2021-04-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="&#x5173;&#x6CE8;&#x5FAE;&#x4FE1;&#x6280;&#x672F;&#x516C;&#x4F17;&#x53F7;&#xFF1A;CodingTechWork&#xFF0C;&#x4E00;&#x8D77;&#x5B66;&#x4E60;&#x8FDB;&#x6B65;&#x3002;"><a href="#&#x5173;&#x6CE8;&#x5FAE;&#x4FE1;&#x6280;&#x672F;&#x516C;&#x4F17;&#x53F7;&#xFF1A;CodingTechWork&#xFF0C;&#x4E00;&#x8D77;&#x5B66;&#x4E60;&#x8FDB;&#x6B65;&#x3002;" class="headerlink" title="&#x5173;&#x6CE8;&#x5FAE;&#x4FE1;&#x6280;&#x672F;&#x516C;&#x4F17;&#x53F7;&#xFF1A;CodingTechWork&#xFF0C;&#x4E00;&#x8D77;&#x5B66;&#x4E60;&#x8FDB;&#x6B65;&#x3002;"></a>&#x5173;&#x6CE8;&#x5FAE;&#x4FE1;&#x6280;&#x672F;&#x516C;&#x4F17;&#x53F7;&#xFF1A;<code>CodingTechWork</code>&#xFF0C;&#x4E00;&#x8D77;&#x5B66;&#x4E60;&#x8FDB;&#x6B65;&#x3002;</h1><h1 id="&#x5F15;&#x8A00;"><a href="#&#x5F15;&#x8A00;" class="headerlink" title="&#x5F15;&#x8A00;"></a>&#x5F15;&#x8A00;</h1><p>&#x2003;&#x2003;&#x4E00;&#x822C;&#x5728;&#x4F7F;&#x7528;&#x5B9A;&#x65F6;&#x4EFB;&#x52A1;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x9996;&#x5148;&#x4F1A;&#x60F3;&#x5230;&#x4F7F;&#x7528;<code>@Scheduled</code>&#x6CE8;&#x89E3;&#x53BB;&#x7ED9;&#x67D0;&#x4E2A;&#x4EFB;&#x52A1;&#x8BBE;&#x7F6E;&#x5B9A;&#x65F6;&#x65F6;&#x95F4;&#x8FDB;&#x884C;&#x5B9A;&#x65F6;&#x6267;&#x884C;&#x3002;&#x5F53;&#x5B9A;&#x65F6;&#x4EFB;&#x52A1;&#x8FC7;&#x591A;&#x65F6;&#xFF0C;&#x6216;&#x8005;&#x6709;&#x589E;&#x5220;&#x6539;&#x67E5;&#x9700;&#x6C42;&#x65F6;&#xFF0C;<code>@Scheduled</code>&#x6CE8;&#x89E3;&#x5C06;&#x65E0;&#x6CD5;&#x6EE1;&#x8DB3;&#x6211;&#x4EEC;&#x7684;&#x9700;&#x6C42;&#x3002;&#x672C;&#x6587;&#x4E00;&#x8D77;&#x5B66;&#x4E60;&#x603B;&#x7ED3;<code>Quartz&#x5B9A;&#x65F6;&#x6846;&#x67B6;</code>&#x7684;&#x4F7F;&#x7528;&#x3002;</p>
<h1 id="Quartz&#x4ECB;&#x7ECD;"><a href="#Quartz&#x4ECB;&#x7ECD;" class="headerlink" title="Quartz&#x4ECB;&#x7ECD;"></a>Quartz&#x4ECB;&#x7ECD;</h1><h2 id="&#x6982;&#x8FF0;"><a href="#&#x6982;&#x8FF0;" class="headerlink" title="&#x6982;&#x8FF0;"></a>&#x6982;&#x8FF0;</h2><blockquote>
<p>Quartz is a richly featured, open source job scheduling library that can be integrated within virtually any Java application - from the smallest stand-alone application to the largest e-commerce system. Quartz can be used to create simple or complex schedules for executing tens, hundreds, or even tens-of-thousands of jobs; jobs whose tasks are defined as standard Java components that may execute virtually anything you may program them to do. The Quartz Scheduler includes many enterprise-class features, such as support for JTA transactions and clustering.<br>Quartz is freely usable, licensed under the Apache 2.0 license.</p>
</blockquote>
<p>&#x2003;&#x2003;Quartz&#x662F;OpenSymphony&#x5F00;&#x6E90;&#x7684;&#x4E00;&#x4E2A;&#x9879;&#x76EE;&#xFF0C;&#x662F;&#x4E00;&#x4E2A;&#x7531;Java&#x7F16;&#x5199;&#x7684;&#x5F00;&#x6E90;&#x4F5C;&#x4E1A;&#x8C03;&#x5EA6;&#x6846;&#x67B6;&#x3002;</p>
<h2 id="&#x7279;&#x70B9;"><a href="#&#x7279;&#x70B9;" class="headerlink" title="&#x7279;&#x70B9;"></a>&#x7279;&#x70B9;</h2><ol>
<li><strong>&#x652F;&#x6301;&#x5206;&#x5E03;&#x5F0F;&#x9AD8;&#x53EF;&#x7528;</strong>&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x67D0;&#x4E2A;&#x5B9A;&#x65F6;&#x4EFB;&#x52A1;&#x5728;&#x591A;&#x4E2A;&#x8282;&#x70B9;&#x4E2D;&#x53EA;&#x6709;&#x67D0;&#x4E2A;&#x8282;&#x70B9;&#x53EF;&#x4EE5;&#x6267;&#x884C;&#x65F6;&#xFF0C;&#x5C31;&#x9700;&#x8981;Quartz&#x6765;&#x5B9E;&#x73B0;&#xFF0C;&#x5426;&#x5219;&#x4F7F;&#x7528;@Scheduled&#x7B49;&#x65B9;&#x5F0F;&#x4F1A;&#x9020;&#x6210;&#x6240;&#x6709;&#x8282;&#x70B9;&#x90FD;&#x6267;&#x884C;&#x4E00;&#x904D;&#x3002;</li>
<li><strong>&#x652F;&#x6301;&#x6301;&#x4E45;&#x5316;</strong>&#xFF0C;Quartz&#x6709;&#x4E13;&#x95E8;&#x7684;&#x6570;&#x636E;&#x8868;&#x6765;&#x5B9E;&#x73B0;&#x5B9A;&#x65F6;&#x4EFB;&#x52A1;&#x7684;&#x6301;&#x4E45;&#x5316;&#x3002;</li>
<li><strong>&#x652F;&#x6301;&#x591A;&#x4EFB;&#x52A1;&#x8C03;&#x5EA6;&#x548C;&#x7BA1;&#x7406;</strong>&#xFF0C;Quartz&#x53EF;&#x4EE5;&#x5728;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x5B58;&#x50A8;&#x591A;&#x4E2A;&#x5B9A;&#x65F6;&#x4EFB;&#x52A1;&#x8FDB;&#x884C;&#x4F5C;&#x4E1A;&#x8C03;&#x5EA6;&#xFF0C;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x5B9A;&#x65F6;&#x4EFB;&#x52A1;&#x7684;&#x589E;&#x5220;&#x6539;&#x67E5;&#x7B49;&#x7BA1;&#x7406;&#x3002;</li>
</ol>
<h2 id="&#x7EC4;&#x6210;"><a href="#&#x7EC4;&#x6210;" class="headerlink" title="&#x7EC4;&#x6210;"></a>&#x7EC4;&#x6210;</h2><p>&#x2003;&#x2003;Quartz&#x7531;&#x4E09;&#x90E8;&#x5206;&#x7EC4;&#x6210;&#xFF1A;</p>
<ol>
<li>&#x4EFB;&#x52A1;&#xFF1A;JobDetail</li>
<li>&#x89E6;&#x53D1;&#x5668;&#xFF1A;Trigger&#xFF08;&#x5206;&#x4E3A;SimpleTrigger&#x548C;CronTrigger&#xFF09;</li>
<li>&#x8C03;&#x5EA6;&#x5668;&#xFF1A;Scheduler</li>
</ol>
<h3 id="JobDetail"><a href="#JobDetail" class="headerlink" title="JobDetail"></a>JobDetail</h3><p>&#x2003;&#x2003;JobDetail&#x4E3B;&#x8981;&#x7531;JobKey&#xFF08;job&#x7684;&#x540D;&#x5B57;name&#x548C;&#x5206;&#x7EC4;group&#xFF09;&#x3001;JobClass&#x3001;JobDataMap&#xFF08;&#x4EFB;&#x52A1;&#x76F8;&#x5173;&#x7684;&#x6570;&#x636E;&#xFF09;&#x3001;JobBuilder&#x7EC4;&#x6210;&#x3002;&#x5E38;&#x7528;&#x7684;&#x662F;&#x524D;&#x51E0;&#x4E2A;&#x3002;</p>
<p><strong>JobDetail&#x6E90;&#x7801;</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;package org.quartz;</span><br><span class="line"></span><br><span class="line">import java.io.Serializable;</span><br><span class="line"></span><br><span class="line">public interface JobDetail extends Serializable, Cloneable {</span><br><span class="line">    JobKey getKey();</span><br><span class="line"></span><br><span class="line">    String getDescription();</span><br><span class="line"></span><br><span class="line">    Class&lt;? extends Job&gt; getJobClass();</span><br><span class="line"></span><br><span class="line">    JobDataMap getJobDataMap();</span><br><span class="line"></span><br><span class="line">    boolean isDurable();</span><br><span class="line"></span><br><span class="line">    boolean isPersistJobDataAfterExecution();</span><br><span class="line"></span><br><span class="line">    boolean isConcurrentExectionDisallowed();</span><br><span class="line"></span><br><span class="line">    boolean requestsRecovery();</span><br><span class="line"></span><br><span class="line">    Object clone();</span><br><span class="line"></span><br><span class="line">    JobBuilder getJobBuilder();</span><br><span class="line">}</span><br></pre></td></tr></table></figure>


<p><strong>JobDetail&#x793A;&#x4F8B;</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;		Map&lt;String,String&gt; jobData = new HashMap&lt;&gt;();</span><br><span class="line">		String jobName = &quot;schedulerJob&quot;;</span><br><span class="line">		String jobGroup = &quot;schedulerGroup&quot;;</span><br><span class="line">		jobData.put(&quot;key00&quot;, &quot;value00&quot;);</span><br><span class="line">        JobDetail jobDetail = JobBuilder.newJob(SchedulerJob.class)</span><br><span class="line">                .withIdentity(jobName, jobGroup)</span><br><span class="line">                .usingJobData(&quot;key01&quot;, &quot;value01&quot;)</span><br><span class="line">                .usingJobData(jobData)</span><br><span class="line">                .storeDurably()</span><br><span class="line">                .build();</span><br></pre></td></tr></table></figure>

<h3 id="Trigger"><a href="#Trigger" class="headerlink" title="Trigger"></a>Trigger</h3><p>&#x2003;&#x2003;Trigger&#x89C4;&#x5B9A;&#x89E6;&#x53D1;&#x6267;&#x884C;Job&#x5B9E;&#x73B0;&#x7C7B;&#xFF0C;&#x4E3B;&#x8981;&#x6709;SimpleTrigger&#x548C;CronTrigger&#x4E24;&#x4E2A;&#x5B9E;&#x73B0;&#x7C7B;&#x3002;Trigger&#x7531;&#x4EE5;&#x4E0B;&#x90E8;&#x5206;&#x7EC4;&#x6210;&#xFF1A;</p>
<ol>
<li>TriggerKey&#xFF08;job&#x7684;&#x540D;&#x5B57;name&#x548C;&#x5206;&#x7EC4;group&#xFF09;</li>
<li>JobDataMap&#xFF08;Trigger&#x76F8;&#x5173;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x540C;JobDetail&#x4E2D;JobDataMap&#xFF0C;&#x5B58;&#x76F8;&#x540C;key&#xFF0C;&#x82E5;value&#x4E0D;&#x540C;&#xFF0C;&#x4F1A;&#x8986;&#x76D6;&#x524D;&#x8005;&#x3002;&#xFF09;</li>
<li>ScheduleBuilder&#xFF08;&#x6709;CronScheduleBuilder&#x3001;SimpleScheduleBuilder&#x3001;CalendarIntervalScheduleBuilder&#x3001;DailyTimeIntervalScheduleBuilder&#x5E38;&#x7528;&#x524D;2&#x79CD;&#x3002;&#xFF09;</li>
</ol>
<p><strong>Trigger&#x793A;&#x4F8B;</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;	//SimpleScheduleBuilder</span><br><span class="line">	String triggerName = &quot;schedulerJob&quot;;</span><br><span class="line">	String triggerGroup = &quot;schedulerGroup&quot;;</span><br><span class="line">	Trigger trigger = TriggerBuilder</span><br><span class="line">	    .newTrigger()</span><br><span class="line">	    .withIdentity(triggerName, triggerGroup)</span><br><span class="line">	    .withSchedule(SimpleScheduleBuilder)</span><br><span class="line">	    .repeatSecondlyForever(1)</span><br><span class="line">	    .withIntervalInSeconds(0)</span><br><span class="line">	    .withRepeatCount(0))</span><br><span class="line">	    .startNow()</span><br><span class="line">	    .build();</span><br><span class="line">	</span><br><span class="line">	//CronScheduleBuilder</span><br><span class="line">	String triggerName2 = &quot;schedulerJob2&quot;;</span><br><span class="line">	String triggerGroup2 = &quot;schedulerGroup2&quot;;</span><br><span class="line">	String jobTime = &quot;0 0 * * * ?&quot;;</span><br><span class="line">	Trigger trigger2 = TriggerBuilder</span><br><span class="line">		.newTrigger()</span><br><span class="line">		.withIdentity(triggerName2, triggerGroup2)</span><br><span class="line">		.startAt(DateBuilder.futureDate(1, IntervalUnit.SECOND))</span><br><span class="line">		.withSchedule(CronScheduleBuilder.cronSchedule(jobTime))</span><br><span class="line">		.startNow()</span><br><span class="line">		.build();</span><br></pre></td></tr></table></figure>

<h3 id="Scheduler"><a href="#Scheduler" class="headerlink" title="Scheduler"></a>Scheduler</h3><p>&#x2003;&#x2003;&#x8C03;&#x5EA6;&#x5668;&#x5C31;&#x662F;&#x4E3A;&#x4E86;&#x8BFB;&#x53D6;&#x89E6;&#x53D1;&#x5668;Trigger&#x4ECE;&#x800C;&#x89E6;&#x53D1;&#x5B9A;&#x65F6;&#x4EFB;&#x52A1;JobDetail&#x3002;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;SchedulerFactory&#x8FDB;&#x884C;&#x521B;&#x5EFA;&#x8C03;&#x5EA6;&#x5668;&#xFF0C;&#x5206;&#x4E3A;<code>StdSchedulerFactory&#xFF08;&#x5E38;&#x7528;&#xFF09;&#x548C;DirectSchedulerFactory</code>&#x4E24;&#x79CD;&#x3002;</p>
<ol>
<li>StdSchedulerFactory&#x4F7F;&#x7528;&#x4E00;&#x7EC4;&#x5C5E;&#x6027;&#xFF08;&#x653E;&#x5728;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x4E2D;&#xFF09;&#x521B;&#x5EFA;&#x548C;&#x521D;&#x59CB;&#x5316;&#x8C03;&#x5EA6;&#x5668;&#xFF0C;&#x7136;&#x540E;&#x901A;&#x8FC7;<code>getScheduler()</code>&#x65B9;&#x6CD5;&#x751F;&#x6210;&#x8C03;&#x5EA6;&#x7A0B;&#x5E8F;&#x3002;</li>
<li>DirectSchedulerFactory&#x4E0D;&#x5E38;&#x7528;&#xFF0C;&#x5BB9;&#x6613;&#x786C;&#x7F16;&#x7801;&#x3002;</li>
</ol>
<p><strong>Scheduler&#x793A;&#x4F8B;</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;	//&#x5EFA;&#x597D;jobDetail,trigger</span><br><span class="line">	... ...</span><br><span class="line">	//StdSchedulerFactory&#x65B9;&#x5F0F;&#xFF0C;&#x7528;&#x7684;&#x591A;</span><br><span class="line">	SchedulerFactory schedulerFactory = new StdSchedulerFactory();</span><br><span class="line">	Scheduler schedulerStd = schedulerFactory.getScheduler();</span><br><span class="line">	</span><br><span class="line">	//DirectSchedulerFactory&#x65B9;&#x5F0F;</span><br><span class="line">	DirectSchedulerFactory directSchedulerFactory = DirectSchedulerFactory.getInstance();</span><br><span class="line">	Scheduler schedulerDir=directSchedulerFactory.getScheduler();</span><br><span class="line">	</span><br><span class="line">	//&#x6267;&#x884C;&#x8C03;&#x5EA6;</span><br><span class="line">	schedulerStd.scheduleJob(jobDetail, trigger);</span><br><span class="line">	schedulerStd.start();</span><br></pre></td></tr></table></figure>

<h2 id="Cron&#x8868;&#x8FBE;&#x5F0F;"><a href="#Cron&#x8868;&#x8FBE;&#x5F0F;" class="headerlink" title="Cron&#x8868;&#x8FBE;&#x5F0F;"></a>Cron&#x8868;&#x8FBE;&#x5F0F;</h2><p>&#x2003;&#x2003;&#x5B9A;&#x65F6;&#x4EFB;&#x52A1;&#x79BB;&#x4E0D;&#x5F00;Cron&#x8868;&#x8FBE;&#x5F0F;&#x8BBE;&#x7F6E;&#x5177;&#x4F53;&#x6267;&#x884C;&#x65F6;&#x95F4;&#x6216;&#x6267;&#x884C;&#x5468;&#x671F;&#xFF0C;Cron&#x8868;&#x8FBE;&#x5F0F;&#x662F;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x4E00;&#x822C;&#x6709;&#x4E24;&#x79CD;&#x8868;&#x8FBE;&#xFF1A;</p>
<ol>
<li><code>&#x79D2; &#x5206; &#x5C0F;&#x65F6; &#x65E5; &#x6708; &#x661F;&#x671F; &#x5E74;</code></li>
<li><code>&#x79D2; &#x5206; &#x5C0F;&#x65F6; &#x65E5; &#x6708; &#x661F;&#x671F;</code></li>
</ol>
<p>&#x5176;&#x4E2D;&#xFF0C;&#x5E74;&#x4EFD;&#x5373;&#x4E3A;&#x53EF;&#x9009;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x4E00;&#x822C;&#x8868;&#x8FBE;&#x5F0F;&#x4E3A;6-7&#x4E2A;&#x57DF;&#xFF0C;&#x6BCF;&#x4E2A;&#x57DF;&#x4EE5;&#x7A7A;&#x683C;&#x5206;&#x5F00;&#x3002;&#x5176;&#x4E2D;&#x7684;&#x661F;&#x671F;&#x9664;&#x4E86;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x82F1;&#x6587;&#x7F29;&#x5199;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x7528;&#x6570;&#x5B57;<code>1-7&#x6570;&#x5B57;</code>&#x6765;&#x8868;&#x793A;&#xFF0C;&#x6CE8;&#x610F;<code>1</code>&#x8868;&#x793A;&#x7684;&#x662F;<code>&#x661F;&#x671F;&#x65E5;</code>&#xFF0C;<code>7</code>&#x8868;&#x793A;&#x7684;<code>&#x661F;&#x671F;&#x516D;</code>&#x3002;<br><img src="https://gitee.com/songjianzaina/juejin_p6/raw/master/img/86c9a82d881236ce9c4ef9f1b51eda2a0b40098d6b1fd2285fe900f99a69c89f" alt="&#x5404;&#x4E2A;&#x57DF;&#x542B;&#x4E49;"></p>
<ul>
<li><code>*</code>&#xFF1A;&#x661F;&#x53F7;&#xFF0C;&#x8868;&#x793A;&#x6BCF;&#x4E2A;&#x5B57;&#x6BB5;&#x5BF9;&#x5E94;&#x7684;&#x65F6;&#x95F4;&#x57DF;&#x7684;<code>&#x6BCF;&#x4E00;&#x4E2A;</code>&#xFF0C;&#x5982;&#x5728;&#x65E5;&#x4E2D;&#xFF0C;&#x5C31;&#x662F;&#x8868;&#x793A;&#x6BCF;&#x5929;&#x3002;</li>
<li><code>?</code>&#xFF1A;&#x95EE;&#x53F7;&#xFF0C;&#x53EA;&#x80FD;&#x5728;&#x65E5;&#x671F;&#x548C;&#x661F;&#x671F;&#x5B57;&#x6BB5;&#x4E2D;&#x4F7F;&#x7528;&#xFF0C;&#x8868;&#x793A;<code>&#x65E0;&#x610F;&#x4E49;&#x7684;&#x503C;</code>&#xFF0C;&#x7B49;&#x4EF7;&#x4E8E;&#x70B9;&#x4F4D;&#x7B26;&#x3002;</li>
<li><code>-</code>&#xFF1A;&#x51CF;&#x53F7;&#xFF0C;&#x8868;&#x793A;&#x4E00;&#x4E2A;&#x8303;&#x56F4;&#xFF0C;&#x5982;&#x5728;&#x5206;&#x949F;&#x4E2D;&#x4F7F;&#x7528;<code>5-8</code>&#xFF0C;&#x5219;&#x8868;&#x793A;<code>5-8&#x5206;&#x949F;</code>&#xFF0C;&#x5373;5&#x3001;6&#x3001;7&#x3001;8&#x5206;&#x949F;&#x3002;</li>
<li><code>,</code>&#xFF1A;&#x9017;&#x53F7;&#xFF0C;&#x8868;&#x793A;&#x4E00;&#x4E2A;&#x5217;&#x8868;&#x503C;&#xFF0C;&#x5982;&#x5728;&#x661F;&#x671F;&#x4E2D;&#x661F;&#x671F;&#x4E00;&#x548C;&#x661F;&#x671F;&#x4E09;&#x4F7F;&#x7528;<code>MON,WED</code>&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x6570;&#x5B57;&#x6765;&#x8868;&#x793A;&#xFF1A;<code>1,3</code>&#x3002;</li>
<li><code>/</code>&#xFF1A;&#x659C;&#x6760;&#xFF0C;&#x4F7F;&#x7528;<code>x/y</code>&#x6765;&#x8868;&#x793A;&#x4E00;&#x4E2A;&#x7B49;&#x6B65;&#x957F;&#x5E8F;&#x5217;&#xFF0C;x&#x8868;&#x793A;&#x8D77;&#x59CB;&#x503C;&#xFF0C;y&#x8868;&#x793A;&#x6B65;&#x957F;&#x503C;&#x3002;&#x5982;&#x5728;&#x79D2;&#x5B57;&#x6BB5;&#x4E2D;&#x4F7F;&#x7528;<code>0/15</code>&#xFF0C;&#x8868;&#x793A;&#x4ECE;0&#x79D2;&#x5F00;&#x59CB;&#xFF0C;&#x6BCF;15&#x79D2;&#x589E;&#x91CF;&#xFF0C;&#x5373;0&#x79D2;,15&#x79D2;,30&#x79D2;,45&#x79D2;&#xFF0C;&#x8FD9;&#x79CD;&#x5C31;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;<code>&#x6BCF;15&#x79D2;</code>&#x6267;&#x884C;&#x4EFB;&#x52A1;&#x3002;</li>
<li><code>L</code>&#xFF1A;&#x53EA;&#x80FD;&#x5728;&#x65E5;&#x671F;&#x548C;&#x661F;&#x671F;&#x5B57;&#x6BB5;&#x4E2D;&#x4F7F;&#x7528;&#xFF0C;&#x8868;&#x793A;<code>Last</code>&#x3002;&#x5728;&#x65E5;&#x671F;&#x4E2D;&#xFF0C;<code>L</code>&#x8868;&#x793A;&#x6708;&#x4EFD;&#x7684;&#x6700;&#x540E;&#x4E00;&#x5929;&#xFF0C;&#x5982;1&#x6708;&#x4E2D;&#x7684;31&#x65E5;&#xFF1B;&#x5728;&#x661F;&#x671F;&#x4E2D;&#xFF0C;<code>L</code>&#x8868;&#x793A;&#x661F;&#x671F;&#x516D;&#xFF08;&#x6216;&#x6570;&#x5B57;7&#xFF09;&#x3002;</li>
<li><code>W</code>&#xFF1A;&#x53EA;&#x80FD;&#x5728;&#x65E5;&#x671F;&#x5B57;&#x6BB5;&#x4E2D;&#x4F7F;&#x7528;&#xFF0C;&#x8868;&#x793A;&#x79BB;&#x8BE5;&#x65E5;&#x671F;&#x6700;&#x8FD1;&#x7684;&#x5DE5;&#x4F5C;&#x671F;&#xFF0C;&#x4E0D;&#x53EF;&#x4EE5;&#x8DE8;&#x6708;&#x3002;&#x5982;<code>10W</code>&#xFF0C;&#x8868;&#x793A;&#x79BB;&#x8BE5;&#x6708;10&#x53F7;&#x6700;&#x8FD1;&#x7684;&#x5DE5;&#x4F5C;&#x65E5;&#xFF0C;&#x82E5;10&#x53F7;&#x4E3A;&#x661F;&#x671F;&#x516D;&#xFF0C;&#x5219;&#x5339;&#x914D;9&#x53F7;&#x661F;&#x671F;&#x4E94;&#xFF1B;&#x82E5;10&#x53F7;&#x4E3A;&#x661F;&#x671F;&#x65E5;&#xFF0C;&#x5219;&#x5339;&#x914D;11&#x53F7;&#x661F;&#x671F;&#x4E00;&#xFF1B;&#x82E5;10&#x53F7;&#x4E3A;&#x661F;&#x671F;&#x4E00;&#xFF0C;&#x5219;&#x5339;&#x914D;10&#x53F7;&#x661F;&#x671F;&#x4E00;&#x3002;<code>LW</code>&#x7EC4;&#x5408;&#x8868;&#x793A;&#x8BE5;&#x6708;&#x7684;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x5DE5;&#x4F5C;&#x65E5;&#x3002;</li>
<li><code>C</code>&#xFF1A;&#x53EA;&#x80FD;&#x5728;&#x65E5;&#x671F;&#x548C;&#x661F;&#x671F;&#x5B57;&#x6BB5;&#x4E2D;&#x4F7F;&#x7528;&#xFF0C;&#x8868;&#x793A;<code>Calendar</code>&#xFF0C;&#x5373;&#x8BA1;&#x5212;&#x6240;&#x5173;&#x8054;&#x7684;&#x65E5;&#x671F;&#xFF0C;&#x82E5;&#x65E5;&#x671F;&#x672A;&#x88AB;&#x5173;&#x8054;&#xFF0C;&#x5219;&#x7B49;&#x4EF7;&#x4E8E;&#x5173;&#x8054;&#x6240;&#x6709;&#x65E5;&#x671F;&#x3002;&#x5982;&#x65E5;&#x671F;&#x4E2D;&#x4F7F;&#x7528;<code>4C</code>&#xFF0C;&#x8868;&#x793A;&#x65E5;&#x671F;4&#x53F7;&#x4EE5;&#x540E;&#x7684;&#x7B2C;&#x4E00;&#x5929;&#xFF1B;&#x661F;&#x671F;&#x4E2D;&#x4F7F;&#x7528;<code>1C</code>&#xFF0C;&#x8868;&#x793A;&#x661F;&#x671F;&#x65E5;&#x540E;&#x7684;&#x7B2C;&#x4E00;&#x5929;&#x3002;</li>
<li><code>#</code>&#xFF1A;&#x4E95;&#x53F7;&#x53EA;&#x80FD;&#x5728;&#x661F;&#x671F;&#x5B57;&#x6BB5;&#x4E2D;&#x4F7F;&#x7528;&#xFF0C;&#x8868;&#x793A;&#x5F53;&#x6708;&#x67D0;&#x4E2A;&#x5DE5;&#x4F5C;&#x65E5;&#x3002;&#x5982;<code>6#2</code>&#x8868;&#x793A;&#x5F53;&#x6708;&#x7684;&#x7B2C;&#x4E8C;&#x4E2A;&#x661F;&#x671F;&#x4E94;&#xFF08;&#x5176;&#x4E2D;&#xFF0C;<code>6</code>&#x8868;&#x793A;&#x661F;&#x671F;&#x4E94;&#xFF0C;<code>#3</code>&#x8868;&#x793A;&#x5F53;&#x6708;&#x7684;&#x7B2C;&#x4E8C;&#x4E2A;&#xFF09;.</li>
</ul>
<p><strong>Cron&#x793A;&#x4F8B;</strong></p>
<table>
<thead>
<tr>
<th>Cron&#x8868;&#x8FBE;&#x5F0F;</th>
<th>&#x8BF4;&#x660E;</th>
</tr>
</thead>
<tbody><tr>
<td>0 0 * * * ?</td>
<td>&#x6BCF;&#x5C0F;&#x65F6;0&#x5206;0&#x79D2;&#x8FD0;&#x884C;</td>
</tr>
<tr>
<td>0 0 1 * * ?</td>
<td>&#x6BCF;&#x5929;01:00:00&#x8FD0;&#x884C;&#x8FD0;&#x884C;</td>
</tr>
<tr>
<td>0 0 1 * * ? *</td>
<td>&#x6BCF;&#x5929;01:00:00&#x8FD0;&#x884C;&#x8FD0;&#x884C;&#xFF0C;&#x540C;&#x4E0A;</td>
</tr>
<tr>
<td>0 0 1 * * ? 2021</td>
<td>2021&#x5E74;&#x6BCF;&#x5929;01:00:00&#x8FD0;&#x884C;</td>
</tr>
<tr>
<td>0 * 10 * * ?</td>
<td>&#x6BCF;&#x5929;10&#x70B9;-11&#x70B9;&#x4E4B;&#x95F4;&#x6BCF;&#x5206;&#x949F;&#x8FD0;&#x884C;&#x4E00;&#x6B21;&#xFF0C;&#x5F00;&#x59CB;&#x4E8E;10:00:00&#xFF0C;&#x7ED3;&#x675F;&#x4E8E;10:59:00</td>
</tr>
<tr>
<td>0 0/5 10 * * ?</td>
<td>&#x6BCF;&#x5929;10&#x70B9;-11&#x70B9;&#x4E4B;&#x95F4;&#x6BCF;5&#x5206;&#x949F;&#x8FD0;&#x884C;&#x4E00;&#x6B21;&#xFF0C;&#x5F00;&#x59CB;&#x4E8E;10:00:00&#xFF0C;&#x7ED3;&#x675F;&#x4E8E;10:59:00</td>
</tr>
<tr>
<td>0 0/5 10,15 * * ?</td>
<td>&#x6BCF;&#x5929;10&#x70B9;-11&#x70B9;&#x4E4B;&#x95F4;&#x6BCF;5&#x5206;&#x949F;&#x8FD0;&#x884C;&#x4E00;&#x6B21;&#xFF0C;&#x6BCF;&#x5929;15&#x70B9;-16&#x70B9;&#x4E4B;&#x95F4;&#x6BCF;5&#x5206;&#x949F;&#x8FD0;&#x884C;&#x4E00;&#x6B21;</td>
</tr>
<tr>
<td>0 0-10 10 * * ?</td>
<td>&#x6BCF;&#x5929;10:00-10:10&#x4E4B;&#x95F4;&#x6BCF;&#x5206;&#x949F;&#x8FD0;&#x884C;</td>
</tr>
<tr>
<td>0 10 1 ? * MON-FRI</td>
<td>&#x6BCF;&#x5468;&#x4E00;&#xFF0C;&#x4E8C;&#xFF0C;&#x4E09;&#xFF0C;&#x56DB;&#xFF0C;&#x4E94;&#x7684;1:10&#x5206;&#x8FD0;&#x884C;</td>
</tr>
<tr>
<td>0 10 1 1 * ?</td>
<td>&#x6BCF;&#x6708;1&#x65E5;&#x7684;1:10&#x5206;&#x8FD0;&#x884C;</td>
</tr>
<tr>
<td>0 10 1 L * ?</td>
<td>&#x6BCF;&#x6708;&#x6700;&#x540E;&#x4E00;&#x5929;1:10&#x5206;&#x8FD0;&#x884C;</td>
</tr>
<tr>
<td>0 10 1 ? * 6L</td>
<td>&#x6BCF;&#x6708;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x661F;&#x671F;&#x4E94;1:10&#x5206;&#x8FD0;&#x884C;</td>
</tr>
<tr>
<td>0 10 1 ? * 6#3</td>
<td>&#x6BCF;&#x6708;&#x7B2C;3&#x4E2A;&#x661F;&#x671F;&#x4E94;1:10&#x5206;&#x8FD0;&#x884C;</td>
</tr>
</tbody></table>
<h1 id="Quartz&#x589E;&#x5220;&#x6539;&#x67E5;&#x6A21;&#x677F;"><a href="#Quartz&#x589E;&#x5220;&#x6539;&#x67E5;&#x6A21;&#x677F;" class="headerlink" title="Quartz&#x589E;&#x5220;&#x6539;&#x67E5;&#x6A21;&#x677F;"></a>Quartz&#x589E;&#x5220;&#x6539;&#x67E5;&#x6A21;&#x677F;</h1><h2 id="QuartzService&#x63A5;&#x53E3;&#x7C7B;"><a href="#QuartzService&#x63A5;&#x53E3;&#x7C7B;" class="headerlink" title="QuartzService&#x63A5;&#x53E3;&#x7C7B;"></a>QuartzService&#x63A5;&#x53E3;&#x7C7B;</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;package com.andya.selfcode.quartzservice;</span><br><span class="line"></span><br><span class="line">import org.springframework.scheduling.quartz.QuartzJobBean;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author Andya</span><br><span class="line"> * @date 2021/4/01</span><br><span class="line"> */</span><br><span class="line">public interface QuartzService {</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x589E;&#x52A0;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;job</span><br><span class="line">     * @param jobClass  &#x4EFB;&#x52A1;job&#x5B9E;&#x73B0;&#x7C7B;</span><br><span class="line">     * @param jobName   &#x4EFB;&#x52A1;job&#x540D;&#x79F0;&#xFF08;&#x4FDD;&#x8BC1;&#x552F;&#x4E00;&#x6027;&#xFF09;</span><br><span class="line">     * @param jobGroupName  &#x4EFB;&#x52A1;job&#x7EC4;&#x540D;</span><br><span class="line">     * @param jobTime   &#x4EFB;&#x52A1;&#x65F6;&#x95F4;&#x95F4;&#x9694;&#xFF08;&#x79D2;&#xFF09;</span><br><span class="line">     * @param jobTimes  &#x4EFB;&#x52A1;&#x8FD0;&#x884C;&#x6B21;&#x6570;&#xFF08;&#x82E5;&lt;0&#xFF0C;&#x5219;&#x4E0D;&#x9650;&#x6B21;&#x6570;&#xFF09;</span><br><span class="line">     * @param jobData   &#x4EFB;&#x52A1;&#x53C2;&#x6570;</span><br><span class="line">     */</span><br><span class="line">    void addJob(Class&lt;? extends QuartzJobBean&gt; jobClass, String jobName, String jobGroupName, int jobTime,</span><br><span class="line">                int jobTimes, Map jobData);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x589E;&#x52A0;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;job</span><br><span class="line">     * @param jobClass  &#x4EFB;&#x52A1;job&#x5B9E;&#x73B0;&#x7C7B;</span><br><span class="line">     * @param jobName   &#x4EFB;&#x52A1;job&#x540D;&#x79F0;&#xFF08;&#x4FDD;&#x8BC1;&#x552F;&#x4E00;&#x6027;&#xFF09;</span><br><span class="line">     * @param jobGroupName  &#x4EFB;&#x52A1;job&#x7EC4;&#x540D;</span><br><span class="line">     * @param jobTime   &#x4EFB;&#x52A1;&#x65F6;&#x95F4;&#x8868;&#x8FBE;&#x5F0F;</span><br><span class="line">     * @param jobData   &#x4EFB;&#x52A1;&#x53C2;&#x6570;</span><br><span class="line">     */</span><br><span class="line">    void addJob(Class&lt;? extends QuartzJobBean&gt; jobClass, String jobName, String jobGroupName, String jobTime, Map jobData);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x4FEE;&#x6539;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;job</span><br><span class="line">     * @param jobName &#x4EFB;&#x52A1;&#x540D;&#x79F0;</span><br><span class="line">     * @param jobGroupName  &#x4EFB;&#x52A1;&#x7EC4;&#x540D;</span><br><span class="line">     * @param jobTime   cron&#x65F6;&#x95F4;&#x8868;&#x8FBE;&#x5F0F;</span><br><span class="line">     */</span><br><span class="line">    void updateJob(String jobName, String jobGroupName, String jobTime);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x5220;&#x9664;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;job</span><br><span class="line">     * @param jobName</span><br><span class="line">     * @param jobGroupName</span><br><span class="line">     */</span><br><span class="line">    void deleteJob(String jobName, String jobGroupName);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x6682;&#x505C;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;job</span><br><span class="line">     * @param jobName</span><br><span class="line">     * @param jobGroupName</span><br><span class="line">     */</span><br><span class="line">    void pauseJob(String jobName, String jobGroupName);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x6062;&#x590D;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;job</span><br><span class="line">     * @param jobName</span><br><span class="line">     * @param jobGroupName</span><br><span class="line">     */</span><br><span class="line">    void resumeJob(String jobName, String jobGroupName);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x7ACB;&#x5373;&#x6267;&#x884C;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;job</span><br><span class="line">     * @param jobName</span><br><span class="line">     * @param jobGroupName</span><br><span class="line">     */</span><br><span class="line">    void runAJobNow(String jobName, String jobGroupName);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x83B7;&#x53D6;&#x6240;&#x6709;&#x4EFB;&#x52A1;job</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    List&lt;Map&lt;String, Object&gt;&gt; queryAllJob();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x83B7;&#x53D6;&#x6B63;&#x5728;&#x8FD0;&#x884C;&#x7684;&#x4EFB;&#x52A1;job</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    List&lt;Map&lt;String, Object&gt;&gt; queryRunJob();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h2 id="QuartzServiceImpl&#x5B9E;&#x73B0;&#x7C7B;"><a href="#QuartzServiceImpl&#x5B9E;&#x73B0;&#x7C7B;" class="headerlink" title="QuartzServiceImpl&#x5B9E;&#x73B0;&#x7C7B;"></a>QuartzServiceImpl&#x5B9E;&#x73B0;&#x7C7B;</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;package com.andya.selfcode.quartz.service;</span><br><span class="line"></span><br><span class="line">import com.andya.selfcode.quartz.exception.BaseException;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.quartz.*;</span><br><span class="line">import org.quartz.DateBuilder.IntervalUnit;</span><br><span class="line">import org.quartz.impl.matchers.GroupMatcher;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.scheduling.quartz.QuartzJobBean;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line">import javax.annotation.PostConstruct;</span><br><span class="line">import java.util.*;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author Andya</span><br><span class="line"> * @date 2021/4/01</span><br><span class="line"> */</span><br><span class="line">@Slf4j</span><br><span class="line">@Service</span><br><span class="line">public class QuartzServiceImpl implements QuartzService {</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private Scheduler scheduler;</span><br><span class="line"></span><br><span class="line">    @PostConstruct</span><br><span class="line">    public void startScheduler() {</span><br><span class="line">        try {</span><br><span class="line">            scheduler.start();</span><br><span class="line">        } catch (SchedulerException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x589E;&#x52A0;&#x4E00;&#x4E2A;job</span><br><span class="line">     *</span><br><span class="line">     * @param jobClass</span><br><span class="line">     *            &#x4EFB;&#x52A1;&#x5B9E;&#x73B0;&#x7C7B;</span><br><span class="line">     * @param jobName</span><br><span class="line">     *            &#x4EFB;&#x52A1;&#x540D;&#x79F0;</span><br><span class="line">     * @param jobGroupName</span><br><span class="line">     *            &#x4EFB;&#x52A1;&#x7EC4;&#x540D;</span><br><span class="line">     * @param jobTime</span><br><span class="line">     *            &#x65F6;&#x95F4;&#x8868;&#x8FBE;&#x5F0F; (&#x8FD9;&#x662F;&#x6BCF;&#x9694;&#x591A;&#x5C11;&#x79D2;&#x4E3A;&#x4E00;&#x6B21;&#x4EFB;&#x52A1;)</span><br><span class="line">     * @param jobTimes</span><br><span class="line">     *            &#x8FD0;&#x884C;&#x7684;&#x6B21;&#x6570; &#xFF08;&lt;0:&#x8868;&#x793A;&#x4E0D;&#x9650;&#x6B21;&#x6570;&#xFF09;</span><br><span class="line">     * @param jobData</span><br><span class="line">     *            &#x53C2;&#x6570;</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public void addJob(Class&lt;? extends QuartzJobBean&gt; jobClass, String jobName, String jobGroupName, int jobTime,</span><br><span class="line">                       int jobTimes, Map jobData) {</span><br><span class="line">        try {</span><br><span class="line">            // &#x4EFB;&#x52A1;&#x540D;&#x79F0;&#x548C;&#x7EC4;&#x6784;&#x6210;&#x4EFB;&#x52A1;key</span><br><span class="line">            JobDetail jobDetail = JobBuilder.newJob(jobClass).withIdentity(jobName, jobGroupName)</span><br><span class="line">                    .build();</span><br><span class="line">            // &#x8BBE;&#x7F6E;job&#x53C2;&#x6570;</span><br><span class="line">            if(jobData!= null &amp;&amp; jobData.size()&gt;0){</span><br><span class="line">                jobDetail.getJobDataMap().putAll(jobData);</span><br><span class="line">            }</span><br><span class="line">            // &#x4F7F;&#x7528;simpleTrigger&#x89C4;&#x5219;</span><br><span class="line">            Trigger trigger = null;</span><br><span class="line">            if (jobTimes &lt; 0) {</span><br><span class="line">                trigger = TriggerBuilder.newTrigger().withIdentity(jobName, jobGroupName)</span><br><span class="line">                        .withSchedule(SimpleScheduleBuilder.repeatSecondlyForever(1).withIntervalInSeconds(jobTime))</span><br><span class="line">                        .startNow().build();</span><br><span class="line">            } else {</span><br><span class="line">                trigger = TriggerBuilder</span><br><span class="line">                        .newTrigger().withIdentity(jobName, jobGroupName).withSchedule(SimpleScheduleBuilder</span><br><span class="line">                                .repeatSecondlyForever(1).withIntervalInSeconds(jobTime).withRepeatCount(jobTimes))</span><br><span class="line">                        .startNow().build();</span><br><span class="line">            }</span><br><span class="line">            log.info(&quot;jobDataMap: {}&quot;, jobDetail.getJobDataMap().getWrappedMap());</span><br><span class="line">            scheduler.scheduleJob(jobDetail, trigger);</span><br><span class="line">        } catch (SchedulerException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            throw new BaseException(&quot;add job error!&quot;);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x589E;&#x52A0;&#x4E00;&#x4E2A;job</span><br><span class="line">     *</span><br><span class="line">     * @param jobClass</span><br><span class="line">     *            &#x4EFB;&#x52A1;&#x5B9E;&#x73B0;&#x7C7B;</span><br><span class="line">     * @param jobName</span><br><span class="line">     *            &#x4EFB;&#x52A1;&#x540D;&#x79F0;(&#x5EFA;&#x8BAE;&#x552F;&#x4E00;)</span><br><span class="line">     * @param jobGroupName</span><br><span class="line">     *            &#x4EFB;&#x52A1;&#x7EC4;&#x540D;</span><br><span class="line">     * @param jobTime</span><br><span class="line">     *            &#x65F6;&#x95F4;&#x8868;&#x8FBE;&#x5F0F; &#xFF08;&#x5982;&#xFF1A;0/5 * * * * ? &#xFF09;</span><br><span class="line">     * @param jobData</span><br><span class="line">     *            &#x53C2;&#x6570;</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public void addJob(Class&lt;? extends QuartzJobBean&gt; jobClass, String jobName, String jobGroupName, String jobTime, Map jobData) {</span><br><span class="line">        try {</span><br><span class="line">            // &#x521B;&#x5EFA;jobDetail&#x5B9E;&#x4F8B;&#xFF0C;&#x7ED1;&#x5B9A;Job&#x5B9E;&#x73B0;&#x7C7B;</span><br><span class="line">            // &#x6307;&#x660E;job&#x7684;&#x540D;&#x79F0;&#xFF0C;&#x6240;&#x5728;&#x7EC4;&#x7684;&#x540D;&#x79F0;&#xFF0C;&#x4EE5;&#x53CA;&#x7ED1;&#x5B9A;job&#x7C7B;</span><br><span class="line">            // &#x4EFB;&#x52A1;&#x540D;&#x79F0;&#x548C;&#x7EC4;&#x6784;&#x6210;&#x4EFB;&#x52A1;key</span><br><span class="line">            JobDetail jobDetail = JobBuilder.newJob(jobClass).withIdentity(jobName, jobGroupName)</span><br><span class="line">                    .build();</span><br><span class="line">            // &#x8BBE;&#x7F6E;job&#x53C2;&#x6570;</span><br><span class="line">            if(jobData!= null &amp;&amp; jobData.size()&gt;0){</span><br><span class="line">                jobDetail.getJobDataMap().putAll(jobData);</span><br><span class="line">            }</span><br><span class="line">            // &#x5B9A;&#x4E49;&#x8C03;&#x5EA6;&#x89E6;&#x53D1;&#x89C4;&#x5219;</span><br><span class="line">            // &#x4F7F;&#x7528;cornTrigger&#x89C4;&#x5219;</span><br><span class="line">            // &#x89E6;&#x53D1;&#x5668;key</span><br><span class="line">            Trigger trigger = TriggerBuilder.newTrigger().withIdentity(jobName, jobGroupName)</span><br><span class="line">                    .startAt(DateBuilder.futureDate(1, IntervalUnit.SECOND))</span><br><span class="line">                    .withSchedule(CronScheduleBuilder.cronSchedule(jobTime)).startNow().build();</span><br><span class="line">            // &#x628A;&#x4F5C;&#x4E1A;&#x548C;&#x89E6;&#x53D1;&#x5668;&#x6CE8;&#x518C;&#x5230;&#x4EFB;&#x52A1;&#x8C03;&#x5EA6;&#x4E2D;</span><br><span class="line">            scheduler.scheduleJob(jobDetail, trigger);</span><br><span class="line">            log.info(&quot;jobDataMap: {}&quot;, jobDetail.getJobDataMap());</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            throw new BaseException(&quot;add job error!&quot;);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x4FEE;&#x6539; &#x4E00;&#x4E2A;job&#x7684; &#x65F6;&#x95F4;&#x8868;&#x8FBE;&#x5F0F;</span><br><span class="line">     *</span><br><span class="line">     * @param jobName</span><br><span class="line">     * @param jobGroupName</span><br><span class="line">     * @param jobTime</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public void updateJob(String jobName, String jobGroupName, String jobTime) {</span><br><span class="line">        try {</span><br><span class="line">            TriggerKey triggerKey = TriggerKey.triggerKey(jobName, jobGroupName);</span><br><span class="line">            CronTrigger trigger = (CronTrigger) scheduler.getTrigger(triggerKey);</span><br><span class="line">            log.info(&quot;new jobTime: {}&quot;, jobTime);</span><br><span class="line">            trigger = trigger.getTriggerBuilder().withIdentity(triggerKey)</span><br><span class="line">                    .withSchedule(CronScheduleBuilder.cronSchedule(jobTime)).build();</span><br><span class="line">            // &#x91CD;&#x542F;&#x89E6;&#x53D1;&#x5668;</span><br><span class="line">            scheduler.rescheduleJob(triggerKey, trigger);</span><br><span class="line">        } catch (SchedulerException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            throw new BaseException(&quot;update job error!&quot;);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x5220;&#x9664;&#x4EFB;&#x52A1;&#x4E00;&#x4E2A;job</span><br><span class="line">     *</span><br><span class="line">     * @param jobName</span><br><span class="line">     *            &#x4EFB;&#x52A1;&#x540D;&#x79F0;</span><br><span class="line">     * @param jobGroupName</span><br><span class="line">     *            &#x4EFB;&#x52A1;&#x7EC4;&#x540D;</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public void deleteJob(String jobName, String jobGroupName) {</span><br><span class="line">        try {</span><br><span class="line">            scheduler.deleteJob(new JobKey(jobName, jobGroupName));</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            throw new BaseException(&quot;delete job error!&quot;);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x6682;&#x505C;&#x4E00;&#x4E2A;job</span><br><span class="line">     *</span><br><span class="line">     * @param jobName</span><br><span class="line">     * @param jobGroupName</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public void pauseJob(String jobName, String jobGroupName) {</span><br><span class="line">        try {</span><br><span class="line">            JobKey jobKey = JobKey.jobKey(jobName, jobGroupName);</span><br><span class="line">            scheduler.pauseJob(jobKey);</span><br><span class="line">        } catch (SchedulerException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            throw new BaseException(&quot;pause job error!&quot;);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x6062;&#x590D;&#x4E00;&#x4E2A;job</span><br><span class="line">     *</span><br><span class="line">     * @param jobName</span><br><span class="line">     * @param jobGroupName</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public void resumeJob(String jobName, String jobGroupName) {</span><br><span class="line">        try {</span><br><span class="line">            JobKey jobKey = JobKey.jobKey(jobName, jobGroupName);</span><br><span class="line">            scheduler.resumeJob(jobKey);</span><br><span class="line">        } catch (SchedulerException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            throw new BaseException(&quot;resume job error!&quot;);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x7ACB;&#x5373;&#x6267;&#x884C;&#x4E00;&#x4E2A;job</span><br><span class="line">     *</span><br><span class="line">     * @param jobName</span><br><span class="line">     * @param jobGroupName</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public void runAJobNow(String jobName, String jobGroupName) {</span><br><span class="line">        try {</span><br><span class="line">            JobKey jobKey = JobKey.jobKey(jobName, jobGroupName);</span><br><span class="line">            scheduler.triggerJob(jobKey);</span><br><span class="line">        } catch (SchedulerException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            throw new BaseException(&quot;run a job error!&quot;);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x83B7;&#x53D6;&#x6240;&#x6709;&#x8BA1;&#x5212;&#x4E2D;&#x7684;&#x4EFB;&#x52A1;&#x5217;&#x8868;</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public List&lt;Map&lt;String, Object&gt;&gt; queryAllJob() {</span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; jobList = null;</span><br><span class="line">        try {</span><br><span class="line">            GroupMatcher&lt;JobKey&gt; matcher = GroupMatcher.anyJobGroup();</span><br><span class="line">            Set&lt;JobKey&gt; jobKeys = scheduler.getJobKeys(matcher);</span><br><span class="line">            jobList = new ArrayList&lt;Map&lt;String, Object&gt;&gt;();</span><br><span class="line">            for (JobKey jobKey : jobKeys) {</span><br><span class="line">                log.info(&quot;maps: {}&quot;, scheduler.getJobDetail(jobKey).getJobDataMap().getWrappedMap());</span><br><span class="line">                List&lt;? extends Trigger&gt; triggers = scheduler.getTriggersOfJob(jobKey);</span><br><span class="line">                for (Trigger trigger : triggers) {</span><br><span class="line">                    Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();</span><br><span class="line">                    map.put(&quot;jobName&quot;, jobKey.getName());</span><br><span class="line">                    map.put(&quot;jobGroupName&quot;, jobKey.getGroup());</span><br><span class="line">                    map.put(&quot;description&quot;, &quot;&#x89E6;&#x53D1;&#x5668;:&quot; + trigger.getKey());</span><br><span class="line">                    Trigger.TriggerState triggerState = scheduler.getTriggerState(trigger.getKey());</span><br><span class="line">                    map.put(&quot;jobStatus&quot;, triggerState.name());</span><br><span class="line">                    if (trigger instanceof CronTrigger) {</span><br><span class="line">                        CronTrigger cronTrigger = (CronTrigger) trigger;</span><br><span class="line">                        String cronExpression = cronTrigger.getCronExpression();</span><br><span class="line">                        map.put(&quot;jobTime&quot;, cronExpression);</span><br><span class="line">                    }</span><br><span class="line">                    jobList.add(map);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        } catch (SchedulerException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            throw new BaseException(&quot;query all jobs error!&quot;);</span><br><span class="line">        }</span><br><span class="line">        return jobList;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x83B7;&#x53D6;&#x6240;&#x6709;&#x6B63;&#x5728;&#x8FD0;&#x884C;&#x7684;job</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public List&lt;Map&lt;String, Object&gt;&gt; queryRunJob() {</span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; jobList = null;</span><br><span class="line">        try {</span><br><span class="line">            List&lt;JobExecutionContext&gt; executingJobs = scheduler.getCurrentlyExecutingJobs();</span><br><span class="line">            jobList = new ArrayList&lt;Map&lt;String, Object&gt;&gt;(executingJobs.size());</span><br><span class="line">            for (JobExecutionContext executingJob : executingJobs) {</span><br><span class="line">                Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;();</span><br><span class="line">                JobDetail jobDetail = executingJob.getJobDetail();</span><br><span class="line">                JobKey jobKey = jobDetail.getKey();</span><br><span class="line">                Trigger trigger = executingJob.getTrigger();</span><br><span class="line">                map.put(&quot;jobName&quot;, jobKey.getName());</span><br><span class="line">                map.put(&quot;jobGroupName&quot;, jobKey.getGroup());</span><br><span class="line">                map.put(&quot;description&quot;, &quot;&#x89E6;&#x53D1;&#x5668;:&quot; + trigger.getKey());</span><br><span class="line">                Trigger.TriggerState triggerState = scheduler.getTriggerState(trigger.getKey());</span><br><span class="line">                map.put(&quot;jobStatus&quot;, triggerState.name());</span><br><span class="line">                if (trigger instanceof CronTrigger) {</span><br><span class="line">                    CronTrigger cronTrigger = (CronTrigger) trigger;</span><br><span class="line">                    String cronExpression = cronTrigger.getCronExpression();</span><br><span class="line">                    map.put(&quot;jobTime&quot;, cronExpression);</span><br><span class="line">                }</span><br><span class="line">                jobList.add(map);</span><br><span class="line">            }</span><br><span class="line">        } catch (SchedulerException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            throw new BaseException(&quot;query run jobs error!&quot;);</span><br><span class="line">        }</span><br><span class="line">        return jobList;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h1 id="Quartz&#x4F7F;&#x7528;&#x65B9;&#x5F0F;"><a href="#Quartz&#x4F7F;&#x7528;&#x65B9;&#x5F0F;" class="headerlink" title="Quartz&#x4F7F;&#x7528;&#x65B9;&#x5F0F;"></a>Quartz&#x4F7F;&#x7528;&#x65B9;&#x5F0F;</h1><h2 id="&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x81EA;&#x52A8;&#x8C03;&#x7528;"><a href="#&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x81EA;&#x52A8;&#x8C03;&#x7528;" class="headerlink" title="&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x81EA;&#x52A8;&#x8C03;&#x7528;"></a>&#x5E94;&#x7528;&#x542F;&#x52A8;&#x65F6;&#x81EA;&#x52A8;&#x8C03;&#x7528;</h2><p>&#x2003;&#x2003;&#x5199;&#x4E00;&#x4E2A;&#x914D;&#x7F6E;&#x7C7B;&#xFF0C;&#x4F7F;&#x7528;<code>@Bean&#x6CE8;&#x89E3;</code>&#x8FDB;&#x884C;&#x914D;&#x7F6E;&#x5B9E;&#x4F8B;&#x5316;&#x3002;</p>
<h3 id="QuartzConfig&#x914D;&#x7F6E;&#x7C7B;"><a href="#QuartzConfig&#x914D;&#x7F6E;&#x7C7B;" class="headerlink" title="QuartzConfig&#x914D;&#x7F6E;&#x7C7B;"></a>QuartzConfig&#x914D;&#x7F6E;&#x7C7B;</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;package com.andya.selfcode.quartz;</span><br><span class="line"></span><br><span class="line">import org.quartz.*;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author Andya</span><br><span class="line"> * @create 2021/04/01</span><br><span class="line"> */</span><br><span class="line">@Configuration</span><br><span class="line">@Service</span><br><span class="line">public class QuartzConfig {</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public JobDetail scheduleJobDetail() {</span><br><span class="line">        System.out.println(&quot;**************************************** scheduler job begin&quot;);</span><br><span class="line">        JobDetail jobDetail = JobBuilder.newJob(SchedulerJob.class)</span><br><span class="line">                .withIdentity(&quot;schedulerJob&quot;)</span><br><span class="line">                .storeDurably()</span><br><span class="line">                .build();</span><br><span class="line">        System.out.println(&quot;**************************************** scheduler job end&quot;);</span><br><span class="line">        return jobDetail;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public Trigger scheduleJobDetailTrigger() {</span><br><span class="line">        Trigger trigger = TriggerBuilder</span><br><span class="line">                .newTrigger()</span><br><span class="line">                .forJob(scheduleJobDetail())</span><br><span class="line">                .withIdentity(&quot;schedulerJob&quot;)</span><br><span class="line">                .withSchedule(SimpleScheduleBuilder.simpleSchedule().withRepeatCount(0))</span><br><span class="line">                .startNow()</span><br><span class="line">                .build();</span><br><span class="line">        System.out.println(&quot;schedulerJob trigger end&quot;);</span><br><span class="line">        return trigger;</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<h3 id="SchedulerJob&#x4EFB;&#x52A1;&#x7C7B;&#x589E;&#x5220;"><a href="#SchedulerJob&#x4EFB;&#x52A1;&#x7C7B;&#x589E;&#x5220;" class="headerlink" title="SchedulerJob&#x4EFB;&#x52A1;&#x7C7B;&#x589E;&#x5220;"></a>SchedulerJob&#x4EFB;&#x52A1;&#x7C7B;&#x589E;&#x5220;</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;package com.andya.selfcode.quartz;</span><br><span class="line"></span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.quartz.JobExecutionContext;</span><br><span class="line">import org.quartz.JobExecutionException;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.beans.factory.annotation.Value;</span><br><span class="line">import org.springframework.scheduling.quartz.QuartzJobBean;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author Andya</span><br><span class="line"> * @create 2021/04/01</span><br><span class="line"> */</span><br><span class="line">@Slf4j</span><br><span class="line">public class SchedulerJob extends QuartzJobBean {</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    QuartzService quartzService;</span><br><span class="line"></span><br><span class="line">    @Value(&quot;${schedule.cron.withJob1}&quot;)</span><br><span class="line">    private String cronTimeJob1;</span><br><span class="line"></span><br><span class="line">    public String getCronTimeJob1() {</span><br><span class="line">        return cronTimeJob1;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Value(&quot;${schedule.cron.withJob2}&quot;)</span><br><span class="line">    private String cronTimeJob2;</span><br><span class="line"></span><br><span class="line">    public String getCronTimeJob1() {</span><br><span class="line">        return cronTimeJob2;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void executeInternal(JobExecutionContext jobExecutionContext) throws JobExecutionException {</span><br><span class="line">        try{</span><br><span class="line">            //job1&#x5148;&#x5220;&#x540E;&#x589E;</span><br><span class="line">            log.info(&quot;job1: delete scheduleWithJob1&quot;);</span><br><span class="line">            quartzService.deleteJob(&quot;scheduleWithJob1&quot;, &quot;scheduleWithJob1_Group1&quot;);</span><br><span class="line"></span><br><span class="line">            log.info(&quot;job1: add scheduleWithJob1&quot;);</span><br><span class="line">            quartzService.addJob(ScheduleWithJob1.class, &quot;scheduleWithJob1&quot;,</span><br><span class="line">                    &quot;scheduleWithJob1_Group1&quot;, cronTimeJob1, null);</span><br><span class="line"></span><br><span class="line">            //&#x6309;&#x5C0F;&#x65F6;&#x5B9A;&#x65F6;&#x7684;job&#x5148;&#x5220;&#x540E;&#x589E;</span><br><span class="line">            log.info(&quot;job2: delete scheduleWithJob2&quot;);</span><br><span class="line">            quartzService.deleteJob(&quot;scheduleWithJob2&quot;, &quot;scheduleWithJob2_Group2&quot;);</span><br><span class="line"></span><br><span class="line">            log.info(&quot;job2: add scheduleWithJob2&quot;);</span><br><span class="line">            quartzService.addJob(ScheduleWithJob2.class, &quot;scheduleWithJob2&quot;,</span><br><span class="line">                    &quot;scheduleWithJob2_Group2&quot;, cronTimeJob2, null);</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            log.error(&quot;quartz service scheduler job failed!&quot;);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="&#x5177;&#x4F53;Job&#x4EFB;&#x52A1;&#x7C7B;"><a href="#&#x5177;&#x4F53;Job&#x4EFB;&#x52A1;&#x7C7B;" class="headerlink" title="&#x5177;&#x4F53;Job&#x4EFB;&#x52A1;&#x7C7B;"></a>&#x5177;&#x4F53;Job&#x4EFB;&#x52A1;&#x7C7B;</h3><h4 id="ScheduleWithJob1&#x7C7B;"><a href="#ScheduleWithJob1&#x7C7B;" class="headerlink" title="ScheduleWithJob1&#x7C7B;"></a>ScheduleWithJob1&#x7C7B;</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;package com.andya.selfcode.quartz;</span><br><span class="line"></span><br><span class="line">import com.andya.selfcode.service.ScheduleJobService;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.quartz.JobExecutionContext;</span><br><span class="line">import org.quartz.JobExecutionException;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.scheduling.quartz.QuartzJobBean;</span><br><span class="line"></span><br><span class="line">import java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author Andya</span><br><span class="line"> * @create 2021/04/01</span><br><span class="line"> */</span><br><span class="line">@Slf4j</span><br><span class="line">public class ScheduleWithJob1 extends QuartzJobBean {</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    ScheduleJobService scheduleJobService;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void executeInternal(JobExecutionContext jobExecutionContext) throws JobExecutionException{</span><br><span class="line">        System.out.println(&quot;start schedule job1: &quot; + LocalDateTime.now());</span><br><span class="line">        try {</span><br><span class="line">            scheduleJobService.scheduleWithJob1();</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="ScheduleWithJob2&#x7C7B;"><a href="#ScheduleWithJob2&#x7C7B;" class="headerlink" title="ScheduleWithJob2&#x7C7B;"></a>ScheduleWithJob2&#x7C7B;</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;package com.andya.selfcode.quartz;</span><br><span class="line"></span><br><span class="line">import com.andya.selfcode.service.ScheduleJobService;</span><br><span class="line">import org.quartz.JobExecutionContext;</span><br><span class="line">import org.quartz.JobExecutionException;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.scheduling.quartz.QuartzJobBean;</span><br><span class="line"></span><br><span class="line">import java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author Andya</span><br><span class="line"> * @create 2021/04/01</span><br><span class="line"> */</span><br><span class="line">public class ScheduleWithJob2 extends QuartzJobBean {</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    ScheduleJobService scheduleJobService;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void executeInternal(JobExecutionContext jobExecutionContext) throws JobExecutionException {</span><br><span class="line">        try {</span><br><span class="line">            System.out.println(&quot;start schedule with job2: &quot; + LocalDateTime.now());</span><br><span class="line">            scheduleJobService.scheduleJob2();</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="ScheduleJobService&#x63A5;&#x53E3;&#x7C7B;"><a href="#ScheduleJobService&#x63A5;&#x53E3;&#x7C7B;" class="headerlink" title="ScheduleJobService&#x63A5;&#x53E3;&#x7C7B;"></a>ScheduleJobService&#x63A5;&#x53E3;&#x7C7B;</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;package com.andya.selfcode.service;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author Andya</span><br><span class="line"> * @create 2021/04/01</span><br><span class="line"> */</span><br><span class="line">public interface ScheduleJobService {</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * job1&#x5B9A;&#x65F6;&#x4EFB;&#x52A1;</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    void scheduleJob1() throws Exception;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * job2&#x5B9A;&#x65F6;&#x4EFB;&#x52A1;</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    void scheduleJob2() throws Exception;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h2 id="HTTP&#x63A5;&#x53E3;&#x65B9;&#x5F0F;&#x8C03;&#x7528;"><a href="#HTTP&#x63A5;&#x53E3;&#x65B9;&#x5F0F;&#x8C03;&#x7528;" class="headerlink" title="HTTP&#x63A5;&#x53E3;&#x65B9;&#x5F0F;&#x8C03;&#x7528;"></a>HTTP&#x63A5;&#x53E3;&#x65B9;&#x5F0F;&#x8C03;&#x7528;</h2><p>&#x2003;&#x2003;&#x5199;&#x4E00;&#x4E2A;controller&#x5C42;&#x76F4;&#x63A5;&#x8C03;&#x7528;QuartzService&#x63A5;&#x53E3;&#x7C7B;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;package com.andya.selfcode.quartz.controller;</span><br><span class="line"></span><br><span class="line">import com.andya.selfcode.quartz.bean.UpdateJobBean;</span><br><span class="line">import com.andya.selfcode.quartz.bean.JobXXXBean;</span><br><span class="line">import com.andya.selfcode.quartz.exception.BadRequestException;</span><br><span class="line">import com.andya.selfcode.quartz.service.QuartzService;</span><br><span class="line">import com.andya.selfcode.quartz.service.jobs.Job1;</span><br><span class="line">import io.swagger.annotations.*;</span><br><span class="line">import org.quartz.JobDataMap;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author Andya</span><br><span class="line"> * @create 2021/04/01</span><br><span class="line"> */</span><br><span class="line">@RestController</span><br><span class="line">@Api(value = &quot;quartz&#x589E;&#x5220;&#x6539;&#x67E5;&#x76F8;&#x5173;API&quot;)</span><br><span class="line">@RequestMapping(value = &quot;/quartz&quot;)</span><br><span class="line">public class YarnFlexibleCapacityExpansionController {</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    QuartzService quartzService;</span><br><span class="line"></span><br><span class="line">    @ApiOperation(value = &quot;&#x4F7F;&#x7528;quartz&#x6DFB;&#x52A0;job&quot;)</span><br><span class="line">    @RequestMapping(value = &quot;/addJob/{jobUUID}&quot;, method = RequestMethod.POST)</span><br><span class="line">    public void addQuartzJob(</span><br><span class="line">            @ApiParam(name = &quot;jobUUID&quot;) @PathVariable(&quot;jobUUID&quot;) String jobUUID,</span><br><span class="line">            @ApiParam(name = &quot;JobXXXBean&quot;) @RequestBody JobXXXBean jobXXXBean) {</span><br><span class="line"></span><br><span class="line">        if (jobXXXBean.getOpenBean() != null) {</span><br><span class="line">            JobDataMap jobDataMap = new JobDataMap();</span><br><span class="line">            jobDataMap.put(&quot;key01&quot;, jobXXXBean.getKey01());</span><br><span class="line">            jobDataMap.put(&quot;key02&quot;, jobXXXBean.getKey02());</span><br><span class="line">            jobDataMap.put(&quot;key03&quot;, jobXXXBean.getKey03());</span><br><span class="line">            jobDataMap.put(&quot;jobTimeCron&quot;, jobXXXBean.getJobTimeCron());</span><br><span class="line">            jobDataMap.put(&quot;key04&quot;, jobXXXBean.getKey04());</span><br><span class="line">            quartzService.addJob(Job1.class,</span><br><span class="line">                    jobUUID,</span><br><span class="line">                    jobUUID,</span><br><span class="line">                    jobXXXBean.getJobTimeCron(),</span><br><span class="line">                    jobDataMap);</span><br><span class="line">        } else {</span><br><span class="line">            throw new BadRequestException(&quot;&#x53C2;&#x6570;&#x9519;&#x8BEF;&quot;);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @ApiOperation(value = &quot;&#x4F7F;&#x7528;quartz&#x67E5;&#x8BE2;&#x6240;&#x6709;job&quot;)</span><br><span class="line">    @RequestMapping(value = &quot;/queryAllJob&quot;, method = RequestMethod.GET)</span><br><span class="line">    public List&lt;Map&lt;String, Object&gt;&gt; queryAllQuartzJob() {</span><br><span class="line"></span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; list = quartzService.queryAllJob();</span><br><span class="line">        return list;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @ApiOperation(value = &quot;&#x4F7F;&#x7528;quartz&#x67E5;&#x8BE2;&#x6240;&#x6709;&#x8FD0;&#x884C;job&quot;)</span><br><span class="line">    @RequestMapping(value = &quot;/queryRunJob&quot;, method = RequestMethod.GET)</span><br><span class="line">    public List&lt;Map&lt;String, Object&gt;&gt; queryRunQuartzJob() {</span><br><span class="line"></span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; list = quartzService.queryRunJob();</span><br><span class="line">        return list;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @ApiOperation(value = &quot;&#x4F7F;&#x7528;quartz&#x5220;&#x9664;job&quot;)</span><br><span class="line">    @RequestMapping(value = &quot;/deleteJob/{jobUUID}&quot;, method = RequestMethod.DELETE)</span><br><span class="line">    public void deleteJob(</span><br><span class="line">            @ApiParam(name = &quot;jobUUID&quot;) @PathVariable(&quot;jobUUID&quot;) String jobUUID) {</span><br><span class="line"></span><br><span class="line">        quartzService.deleteJob(jobUUID, jobUUID);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @ApiOperation(value = &quot;&#x4F7F;&#x7528;quartz&#x4FEE;&#x6539;job&#x7684;cron&#x65F6;&#x95F4;&quot;)</span><br><span class="line">    @RequestMapping(value = &quot;/updateJob/{jobUUID}&quot;, method = RequestMethod.PUT)</span><br><span class="line">    public void deleteJob(</span><br><span class="line">            @ApiParam(name = &quot;jobUUID&quot;) @PathVariable(&quot;jobUUID&quot;) String jobUUID,</span><br><span class="line">            @ApiParam(name = &quot;jobCronTime&quot;) @RequestBody UpdateJobBean updateJobBean) {</span><br><span class="line"></span><br><span class="line">        quartzService.updateJob(jobUUID, jobUUID, updateJobBean.getJobCronTime());</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author Andya</span><br><span class="line"> * @create 2021/04/01</span><br><span class="line"> */</span><br><span class="line">@ApiModel(value = &quot;&#x66F4;&#x65B0;job cron&#x65F6;&#x95F4;&#x53C2;&#x6570;&quot;)</span><br><span class="line">@JsonInclude(JsonInclude.Include.NON_NULL)</span><br><span class="line">public class UpdateJobBean {</span><br><span class="line">    @ApiModelProperty(value = &quot;jobTime&#x7684;cron&#x8868;&#x8FBE;&#x5F0F;&quot;, example = &quot;0 0 1 * * ?&quot;)</span><br><span class="line">    String jobCronTime;</span><br><span class="line"></span><br><span class="line">    public String getJobCronTime() {</span><br><span class="line">        return jobCronTime;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void setJobCronTime(String jobCronTime) {</span><br><span class="line">        this.jobCronTime = jobCronTime;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h1 id="Quartz&#x6570;&#x636E;&#x8868;&#x811A;&#x672C;"><a href="#Quartz&#x6570;&#x636E;&#x8868;&#x811A;&#x672C;" class="headerlink" title="Quartz&#x6570;&#x636E;&#x8868;&#x811A;&#x672C;"></a>Quartz&#x6570;&#x636E;&#x8868;&#x811A;&#x672C;</h1><p>quartz&#x521D;&#x59CB;&#x5316;&#x6570;&#x636E;&#x8868;&#x7684;sql&#x811A;&#x672C;&#x5982;&#x4E0B;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br></pre></td><td class="code"><pre><span class="line">sql&#x590D;&#x5236;&#x4EE3;&#x7801;-- 1.1. qrtz_blob_triggers : &#x4EE5;Blob &#x7C7B;&#x578B;&#x5B58;&#x50A8;&#x7684;&#x89E6;&#x53D1;&#x5668;&#x3002;</span><br><span class="line">-- 1.2. qrtz_calendars&#xFF1A;&#x5B58;&#x653E;&#x65E5;&#x5386;&#x4FE1;&#x606F;&#xFF0C; quartz&#x53EF;&#x914D;&#x7F6E;&#x4E00;&#x4E2A;&#x65E5;&#x5386;&#x6765;&#x6307;&#x5B9A;&#x4E00;&#x4E2A;&#x65F6;&#x95F4;&#x8303;&#x56F4;&#x3002;</span><br><span class="line">-- 1.3. qrtz_cron_triggers&#xFF1A;&#x5B58;&#x653E;cron&#x7C7B;&#x578B;&#x7684;&#x89E6;&#x53D1;&#x5668;&#x3002;</span><br><span class="line">-- 1.4. qrtz_fired_triggers&#xFF1A;&#x5B58;&#x653E;&#x5DF2;&#x89E6;&#x53D1;&#x7684;&#x89E6;&#x53D1;&#x5668;&#x3002;</span><br><span class="line">-- 1.5. qrtz_job_details&#xFF1A;&#x5B58;&#x653E;&#x4E00;&#x4E2A;jobDetail&#x4FE1;&#x606F;&#x3002;</span><br><span class="line">-- 1.6. qrtz_job_listeners&#xFF1A;job&#x76D1;&#x542C;&#x5668;&#x3002;</span><br><span class="line">-- 1.7. qrtz_locks&#xFF1A; &#x5B58;&#x50A8;&#x7A0B;&#x5E8F;&#x7684;&#x60B2;&#x89C2;&#x9501;&#x7684;&#x4FE1;&#x606F;(&#x5047;&#x5982;&#x4F7F;&#x7528;&#x4E86;&#x60B2;&#x89C2;&#x9501;)&#x3002;</span><br><span class="line">-- 1.8. qrtz_paused_trigger_graps&#xFF1A;&#x5B58;&#x653E;&#x6682;&#x505C;&#x6389;&#x7684;&#x89E6;&#x53D1;&#x5668;&#x3002;</span><br><span class="line">-- 1.9. qrtz_scheduler_state&#xFF1A;&#x8C03;&#x5EA6;&#x5668;&#x72B6;&#x6001;&#x3002;</span><br><span class="line">-- 1.10. qrtz_simple_triggers&#xFF1A;&#x7B80;&#x5355;&#x89E6;&#x53D1;&#x5668;&#x7684;&#x4FE1;&#x606F;&#x3002;</span><br><span class="line">-- 1.11. qrtz_trigger_listeners&#xFF1A;&#x89E6;&#x53D1;&#x5668;&#x76D1;&#x542C;&#x5668;&#x3002;</span><br><span class="line">-- 1.12. qrtz_triggers&#xFF1A;&#x89E6;&#x53D1;&#x5668;&#x7684;&#x57FA;&#x672C;&#x4FE1;&#x606F;&#x3002;</span><br><span class="line"></span><br><span class="line">DROP TABLE IF EXISTS QRTZ_FIRED_TRIGGERS;</span><br><span class="line">DROP TABLE IF EXISTS QRTZ_PAUSED_TRIGGER_GRPS;</span><br><span class="line">DROP TABLE IF EXISTS QRTZ_SCHEDULER_STATE;</span><br><span class="line">DROP TABLE IF EXISTS QRTZ_LOCKS;</span><br><span class="line">DROP TABLE IF EXISTS QRTZ_SIMPLE_TRIGGERS;</span><br><span class="line">DROP TABLE IF EXISTS QRTZ_SIMPROP_TRIGGERS;</span><br><span class="line">DROP TABLE IF EXISTS QRTZ_CRON_TRIGGERS;</span><br><span class="line">DROP TABLE IF EXISTS QRTZ_BLOB_TRIGGERS;</span><br><span class="line">DROP TABLE IF EXISTS QRTZ_TRIGGERS;</span><br><span class="line">DROP TABLE IF EXISTS QRTZ_JOB_DETAILS;</span><br><span class="line">DROP TABLE IF EXISTS QRTZ_CALENDARS;</span><br><span class="line"></span><br><span class="line">CREATE TABLE QRTZ_JOB_DETAILS(</span><br><span class="line">SCHED_NAME VARCHAR(120) NOT NULL,</span><br><span class="line">JOB_NAME VARCHAR(190) NOT NULL,</span><br><span class="line">JOB_GROUP VARCHAR(190) NOT NULL,</span><br><span class="line">DESCRIPTION VARCHAR(250) NULL,</span><br><span class="line">JOB_CLASS_NAME VARCHAR(250) NOT NULL,</span><br><span class="line">IS_DURABLE VARCHAR(1) NOT NULL,</span><br><span class="line">IS_NONCONCURRENT VARCHAR(1) NOT NULL,</span><br><span class="line">IS_UPDATE_DATA VARCHAR(1) NOT NULL,</span><br><span class="line">REQUESTS_RECOVERY VARCHAR(1) NOT NULL,</span><br><span class="line">JOB_DATA BLOB NULL,</span><br><span class="line">PRIMARY KEY (SCHED_NAME,JOB_NAME,JOB_GROUP))</span><br><span class="line">ENGINE=InnoDB;</span><br><span class="line"></span><br><span class="line">CREATE TABLE QRTZ_TRIGGERS (</span><br><span class="line">SCHED_NAME VARCHAR(120) NOT NULL,</span><br><span class="line">TRIGGER_NAME VARCHAR(190) NOT NULL,</span><br><span class="line">TRIGGER_GROUP VARCHAR(190) NOT NULL,</span><br><span class="line">JOB_NAME VARCHAR(190) NOT NULL,</span><br><span class="line">JOB_GROUP VARCHAR(190) NOT NULL,</span><br><span class="line">DESCRIPTION VARCHAR(250) NULL,</span><br><span class="line">NEXT_FIRE_TIME BIGINT(13) NULL,</span><br><span class="line">PREV_FIRE_TIME BIGINT(13) NULL,</span><br><span class="line">PRIORITY INTEGER NULL,</span><br><span class="line">TRIGGER_STATE VARCHAR(16) NOT NULL,</span><br><span class="line">TRIGGER_TYPE VARCHAR(8) NOT NULL,</span><br><span class="line">START_TIME BIGINT(13) NOT NULL,</span><br><span class="line">END_TIME BIGINT(13) NULL,</span><br><span class="line">CALENDAR_NAME VARCHAR(190) NULL,</span><br><span class="line">MISFIRE_INSTR SMALLINT(2) NULL,</span><br><span class="line">JOB_DATA BLOB NULL,</span><br><span class="line">PRIMARY KEY (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP),</span><br><span class="line">FOREIGN KEY (SCHED_NAME,JOB_NAME,JOB_GROUP)</span><br><span class="line">REFERENCES QRTZ_JOB_DETAILS(SCHED_NAME,JOB_NAME,JOB_GROUP))</span><br><span class="line">ENGINE=InnoDB;</span><br><span class="line"></span><br><span class="line">CREATE TABLE QRTZ_SIMPLE_TRIGGERS (</span><br><span class="line">SCHED_NAME VARCHAR(120) NOT NULL,</span><br><span class="line">TRIGGER_NAME VARCHAR(190) NOT NULL,</span><br><span class="line">TRIGGER_GROUP VARCHAR(190) NOT NULL,</span><br><span class="line">REPEAT_COUNT BIGINT(7) NOT NULL,</span><br><span class="line">REPEAT_INTERVAL BIGINT(12) NOT NULL,</span><br><span class="line">TIMES_TRIGGERED BIGINT(10) NOT NULL,</span><br><span class="line">PRIMARY KEY (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP),</span><br><span class="line">FOREIGN KEY (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP)</span><br><span class="line">REFERENCES QRTZ_TRIGGERS(SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP))</span><br><span class="line">ENGINE=InnoDB;</span><br><span class="line"></span><br><span class="line">CREATE TABLE QRTZ_CRON_TRIGGERS (</span><br><span class="line">SCHED_NAME VARCHAR(120) NOT NULL,</span><br><span class="line">TRIGGER_NAME VARCHAR(190) NOT NULL,</span><br><span class="line">TRIGGER_GROUP VARCHAR(190) NOT NULL,</span><br><span class="line">CRON_EXPRESSION VARCHAR(120) NOT NULL,</span><br><span class="line">TIME_ZONE_ID VARCHAR(80),</span><br><span class="line">PRIMARY KEY (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP),</span><br><span class="line">FOREIGN KEY (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP)</span><br><span class="line">REFERENCES QRTZ_TRIGGERS(SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP))</span><br><span class="line">ENGINE=InnoDB;</span><br><span class="line"></span><br><span class="line">CREATE TABLE QRTZ_SIMPROP_TRIGGERS</span><br><span class="line">  (</span><br><span class="line">    SCHED_NAME VARCHAR(120) NOT NULL,</span><br><span class="line">    TRIGGER_NAME VARCHAR(190) NOT NULL,</span><br><span class="line">    TRIGGER_GROUP VARCHAR(190) NOT NULL,</span><br><span class="line">    STR_PROP_1 VARCHAR(512) NULL,</span><br><span class="line">    STR_PROP_2 VARCHAR(512) NULL,</span><br><span class="line">    STR_PROP_3 VARCHAR(512) NULL,</span><br><span class="line">    INT_PROP_1 INT NULL,</span><br><span class="line">    INT_PROP_2 INT NULL,</span><br><span class="line">    LONG_PROP_1 BIGINT NULL,</span><br><span class="line">    LONG_PROP_2 BIGINT NULL,</span><br><span class="line">    DEC_PROP_1 NUMERIC(13,4) NULL,</span><br><span class="line">    DEC_PROP_2 NUMERIC(13,4) NULL,</span><br><span class="line">    BOOL_PROP_1 VARCHAR(1) NULL,</span><br><span class="line">    BOOL_PROP_2 VARCHAR(1) NULL,</span><br><span class="line">    PRIMARY KEY (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP),</span><br><span class="line">    FOREIGN KEY (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP)</span><br><span class="line">    REFERENCES QRTZ_TRIGGERS(SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP))</span><br><span class="line">ENGINE=InnoDB;</span><br><span class="line"></span><br><span class="line">CREATE TABLE QRTZ_BLOB_TRIGGERS (</span><br><span class="line">SCHED_NAME VARCHAR(120) NOT NULL,</span><br><span class="line">TRIGGER_NAME VARCHAR(190) NOT NULL,</span><br><span class="line">TRIGGER_GROUP VARCHAR(190) NOT NULL,</span><br><span class="line">BLOB_DATA BLOB NULL,</span><br><span class="line">PRIMARY KEY (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP),</span><br><span class="line">INDEX (SCHED_NAME,TRIGGER_NAME, TRIGGER_GROUP),</span><br><span class="line">FOREIGN KEY (SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP)</span><br><span class="line">REFERENCES QRTZ_TRIGGERS(SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP))</span><br><span class="line">ENGINE=InnoDB;</span><br><span class="line"></span><br><span class="line">CREATE TABLE QRTZ_CALENDARS (</span><br><span class="line">SCHED_NAME VARCHAR(120) NOT NULL,</span><br><span class="line">CALENDAR_NAME VARCHAR(190) NOT NULL,</span><br><span class="line">CALENDAR BLOB NOT NULL,</span><br><span class="line">PRIMARY KEY (SCHED_NAME,CALENDAR_NAME))</span><br><span class="line">ENGINE=InnoDB;</span><br><span class="line"></span><br><span class="line">CREATE TABLE QRTZ_PAUSED_TRIGGER_GRPS (</span><br><span class="line">SCHED_NAME VARCHAR(120) NOT NULL,</span><br><span class="line">TRIGGER_GROUP VARCHAR(190) NOT NULL,</span><br><span class="line">PRIMARY KEY (SCHED_NAME,TRIGGER_GROUP))</span><br><span class="line">ENGINE=InnoDB;</span><br><span class="line"></span><br><span class="line">CREATE TABLE QRTZ_FIRED_TRIGGERS (</span><br><span class="line">SCHED_NAME VARCHAR(120) NOT NULL,</span><br><span class="line">ENTRY_ID VARCHAR(95) NOT NULL,</span><br><span class="line">TRIGGER_NAME VARCHAR(190) NOT NULL,</span><br><span class="line">TRIGGER_GROUP VARCHAR(190) NOT NULL,</span><br><span class="line">INSTANCE_NAME VARCHAR(190) NOT NULL,</span><br><span class="line">FIRED_TIME BIGINT(13) NOT NULL,</span><br><span class="line">SCHED_TIME BIGINT(13) NOT NULL,</span><br><span class="line">PRIORITY INTEGER NOT NULL,</span><br><span class="line">STATE VARCHAR(16) NOT NULL,</span><br><span class="line">JOB_NAME VARCHAR(190) NULL,</span><br><span class="line">JOB_GROUP VARCHAR(190) NULL,</span><br><span class="line">IS_NONCONCURRENT VARCHAR(1) NULL,</span><br><span class="line">REQUESTS_RECOVERY VARCHAR(1) NULL,</span><br><span class="line">PRIMARY KEY (SCHED_NAME,ENTRY_ID))</span><br><span class="line">ENGINE=InnoDB;</span><br><span class="line"></span><br><span class="line">CREATE TABLE QRTZ_SCHEDULER_STATE (</span><br><span class="line">SCHED_NAME VARCHAR(120) NOT NULL,</span><br><span class="line">INSTANCE_NAME VARCHAR(190) NOT NULL,</span><br><span class="line">LAST_CHECKIN_TIME BIGINT(13) NOT NULL,</span><br><span class="line">CHECKIN_INTERVAL BIGINT(13) NOT NULL,</span><br><span class="line">PRIMARY KEY (SCHED_NAME,INSTANCE_NAME))</span><br><span class="line">ENGINE=InnoDB;</span><br><span class="line"></span><br><span class="line">CREATE TABLE QRTZ_LOCKS (</span><br><span class="line">SCHED_NAME VARCHAR(120) NOT NULL,</span><br><span class="line">LOCK_NAME VARCHAR(40) NOT NULL,</span><br><span class="line">PRIMARY KEY (SCHED_NAME,LOCK_NAME))</span><br><span class="line">ENGINE=InnoDB;</span><br><span class="line"></span><br><span class="line">CREATE INDEX IDX_QRTZ_J_REQ_RECOVERY ON QRTZ_JOB_DETAILS(SCHED_NAME,REQUESTS_RECOVERY);</span><br><span class="line">CREATE INDEX IDX_QRTZ_J_GRP ON QRTZ_JOB_DETAILS(SCHED_NAME,JOB_GROUP);</span><br><span class="line"></span><br><span class="line">CREATE INDEX IDX_QRTZ_T_J ON QRTZ_TRIGGERS(SCHED_NAME,JOB_NAME,JOB_GROUP);</span><br><span class="line">CREATE INDEX IDX_QRTZ_T_JG ON QRTZ_TRIGGERS(SCHED_NAME,JOB_GROUP);</span><br><span class="line">CREATE INDEX IDX_QRTZ_T_C ON QRTZ_TRIGGERS(SCHED_NAME,CALENDAR_NAME);</span><br><span class="line">CREATE INDEX IDX_QRTZ_T_G ON QRTZ_TRIGGERS(SCHED_NAME,TRIGGER_GROUP);</span><br><span class="line">CREATE INDEX IDX_QRTZ_T_STATE ON QRTZ_TRIGGERS(SCHED_NAME,TRIGGER_STATE);</span><br><span class="line">CREATE INDEX IDX_QRTZ_T_N_STATE ON QRTZ_TRIGGERS(SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP,TRIGGER_STATE);</span><br><span class="line">CREATE INDEX IDX_QRTZ_T_N_G_STATE ON QRTZ_TRIGGERS(SCHED_NAME,TRIGGER_GROUP,TRIGGER_STATE);</span><br><span class="line">CREATE INDEX IDX_QRTZ_T_NEXT_FIRE_TIME ON QRTZ_TRIGGERS(SCHED_NAME,NEXT_FIRE_TIME);</span><br><span class="line">CREATE INDEX IDX_QRTZ_T_NFT_ST ON QRTZ_TRIGGERS(SCHED_NAME,TRIGGER_STATE,NEXT_FIRE_TIME);</span><br><span class="line">CREATE INDEX IDX_QRTZ_T_NFT_MISFIRE ON QRTZ_TRIGGERS(SCHED_NAME,MISFIRE_INSTR,NEXT_FIRE_TIME);</span><br><span class="line">CREATE INDEX IDX_QRTZ_T_NFT_ST_MISFIRE ON QRTZ_TRIGGERS(SCHED_NAME,MISFIRE_INSTR,NEXT_FIRE_TIME,TRIGGER_STATE);</span><br><span class="line">CREATE INDEX IDX_QRTZ_T_NFT_ST_MISFIRE_GRP ON QRTZ_TRIGGERS(SCHED_NAME,MISFIRE_INSTR,NEXT_FIRE_TIME,TRIGGER_GROUP,TRIGGER_STATE);</span><br><span class="line"></span><br><span class="line">CREATE INDEX IDX_QRTZ_FT_TRIG_INST_NAME ON QRTZ_FIRED_TRIGGERS(SCHED_NAME,INSTANCE_NAME);</span><br><span class="line">CREATE INDEX IDX_QRTZ_FT_INST_JOB_REQ_RCVRY ON QRTZ_FIRED_TRIGGERS(SCHED_NAME,INSTANCE_NAME,REQUESTS_RECOVERY);</span><br><span class="line">CREATE INDEX IDX_QRTZ_FT_J_G ON QRTZ_FIRED_TRIGGERS(SCHED_NAME,JOB_NAME,JOB_GROUP);</span><br><span class="line">CREATE INDEX IDX_QRTZ_FT_JG ON QRTZ_FIRED_TRIGGERS(SCHED_NAME,JOB_GROUP);</span><br><span class="line">CREATE INDEX IDX_QRTZ_FT_T_G ON QRTZ_FIRED_TRIGGERS(SCHED_NAME,TRIGGER_NAME,TRIGGER_GROUP);</span><br><span class="line">CREATE INDEX IDX_QRTZ_FT_TG ON QRTZ_FIRED_TRIGGERS(SCHED_NAME,TRIGGER_GROUP);</span><br><span class="line"></span><br><span class="line">commit;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>refer by<br><a href="/external_links/c02ca98a05d9e31b252b26098eeded5b.html" target="blank" rel="noopener">www.quartz-scheduler.org/</a></p>
</blockquote>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/374a6032001d9979239dff1230c242fd.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6946076522113400845.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6946076522113400845.html" itemprop="url">Redission分布式锁</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-04-01T14:45:18+08:00">
                2021-04-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Redission&#x662F;Redis&#x5B98;&#x65B9;&#x63A8;&#x8350;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;RLock&#x7684;&#x9501;&#xFF0C;RLock&#x7EE7;&#x627F;&#x81EA;juc&#x7684;Lock&#x63A5;&#x53E3;&#xFF0C;&#x63D0;&#x4F9B;&#x4E86;&#x4E2D;&#x65AD;&#xFF0C;&#x8D85;&#x65F6;&#xFF0C;&#x5C1D;&#x8BD5;&#x83B7;&#x53D6;&#x9501;&#x7B49;&#x64CD;&#x4F5C;&#xFF0C;&#x652F;&#x6301;&#x53EF;&#x91CD;&#x5165;&#xFF0C;&#x4E92;&#x65A5;&#x7B49;&#x7279;&#x6027;&#x3002;</p>
<h2 id="&#x57FA;&#x672C;&#x539F;&#x7406;"><a href="#&#x57FA;&#x672C;&#x539F;&#x7406;" class="headerlink" title="&#x57FA;&#x672C;&#x539F;&#x7406;"></a>&#x57FA;&#x672C;&#x539F;&#x7406;</h2><p>RLock&#x5E95;&#x5C42;&#x4F7F;&#x7528;Redis&#x7684;Hash&#x4F5C;&#x4E3A;&#x5B58;&#x50A8;&#x7ED3;&#x6784;&#xFF0C;&#x5176;&#x4E2D;Hash&#x7684;key&#x7528;&#x4E8E;&#x5B58;&#x50A8;&#x9501;&#x7684;&#x540D;&#x5B57;&#xFF0C;Hash&#x7684;filed&#x7528;&#x4E8E;&#x5B58;&#x50A8;&#x5BA2;&#x6237;&#x7AEF;id&#xFF0C;filed&#x5BF9;&#x5E94;&#x7684;value&#x662F;&#x7EBF;&#x7A0B;&#x91CD;&#x5165;&#x6B21;&#x6570;&#x3002;</p>
<h3 id="&#x5BA2;&#x6237;&#x7AEF;id"><a href="#&#x5BA2;&#x6237;&#x7AEF;id" class="headerlink" title="&#x5BA2;&#x6237;&#x7AEF;id"></a>&#x5BA2;&#x6237;&#x7AEF;id</h3><p>&#x5BA2;&#x6237;&#x7AEF;id&#x662F;&#x7528;&#x4E8E;&#x533A;&#x5206;&#x6BCF;&#x4E2A;&#x52A0;&#x9501;&#x7684;&#x7EBF;&#x7A0B;&#x7684;&#xFF0C;&#x7531;&#x4E24;&#x90E8;&#x5206;&#x7EC4;&#x6210;: RedissonLock&#x7684;&#x6210;&#x5458;&#x53D8;&#x91CF;id + &#x5F53;&#x524D;&#x7EBF;&#x7A0B;id Thread.currentThread().getId()&#x3002;<br>&#x5176;&#x4E2D;id&#x662F;&#x4E00;&#x4E2A;UUID&#xFF0C;&#x5728;&#x6BCF;&#x6B21;&#x5B9E;&#x4F8B;&#x5316;Redisson&#x5BF9;&#x8C61;&#x5B9E;&#x4F8B;&#x7684;&#x65F6;&#x5019;&#x90FD;&#x4F1A;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;ConnectionManager&#xFF0C;&#x8BE5;&#x7C7B;&#x4F1A;&#x5728;&#x5B9E;&#x4F8B;&#x5316;&#x65F6;&#x751F;&#x6210;&#x4E00;&#x4E2A;UUID(UUID.randomUUID()), &#x6240;&#x4EE5;&#x5BF9;&#x4E8E;&#x6BCF;&#x4E00;&#x4E2A;Redisson&#x5728;&#x5176;&#x751F;&#x547D;&#x5468;&#x671F;&#x4E2D;&#x8BE5;id&#x90FD;&#x662F;&#x76F8;&#x540C;&#x7684;&#xFF0C;&#x533A;&#x522B;&#x5728;&#x4E8E;threadId&#x7684;&#x4E0D;&#x540C;&#xFF1B;&#x800C;&#x4E0D;&#x540C;Redisson&#x5BF9;&#x8C61;&#x4E4B;&#x95F4;id&#x4E5F;&#x4E0D;&#x540C;&#xFF0C;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x5F88;&#x597D;&#x7684;&#x5BF9;&#x4E0D;&#x540C;&#x670D;&#x52A1;&#x4E2D;&#x7684;&#x7EBF;&#x7A0B;&#x8FDB;&#x884C;&#x533A;&#x5206;&#x3002;</p>
<h3 id="&#x7EBF;&#x7A0B;&#x91CD;&#x5165;&#x6B21;&#x6570;"><a href="#&#x7EBF;&#x7A0B;&#x91CD;&#x5165;&#x6B21;&#x6570;" class="headerlink" title="&#x7EBF;&#x7A0B;&#x91CD;&#x5165;&#x6B21;&#x6570;"></a>&#x7EBF;&#x7A0B;&#x91CD;&#x5165;&#x6B21;&#x6570;</h3><p>&#x53EF;&#x4EE5;&#x53C2;&#x8003;Java&#x7684;&#x91CD;&#x5165;&#x9501;&#xFF0C;&#x7528;&#x4E8E;&#x8868;&#x793A;&#x8BE5;&#x9501;&#x5F53;&#x524D;&#x88AB;&#x9012;&#x5F52;&#x7684;&#x6B21;&#x6570;&#xFF0C;&#x8BE5;&#x503C;&gt;=1&#xFF0C;&#x5982;&#x679C;&#x7B49;&#x4E8E;0&#x65F6;&#x8BE5;&#x9501;&#x4F1A;&#x88AB;&#x5220;&#x9664;&#x3002;</p>
<h2 id="&#x52A0;&#x9501;"><a href="#&#x52A0;&#x9501;" class="headerlink" title="&#x52A0;&#x9501;"></a>&#x52A0;&#x9501;</h2><h3 id="&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x53EF;&#x91CD;&#x5165;&#x52A0;&#x9501;"><a href="#&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x53EF;&#x91CD;&#x5165;&#x52A0;&#x9501;" class="headerlink" title="&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x53EF;&#x91CD;&#x5165;&#x52A0;&#x9501;"></a>&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x53EF;&#x91CD;&#x5165;&#x52A0;&#x9501;</h3><p>&#x4E3A;&#x4E86;&#x5B9E;&#x73B0;&#x52A0;&#x9501;&#x7684;&#x539F;&#x5B50;&#x6027;&#xFF0C;Redisson&#x4F7F;&#x7528;Lua&#x811A;&#x672C;&#x7684;&#x5F62;&#x5F0F;&#x8FDB;&#x884C;&#x52A0;&#x9501;&#x3002;<br>&#x8BE5;&#x811A;&#x672C;&#x4F4D;&#x4E8E;RedissonLock#tryLockInnerAsync&#x4E2D;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">lua&#x590D;&#x5236;&#x4EE3;&#x7801;if (redis.call(&apos;exists&apos;, KEYS[1]) == 0) then </span><br><span class="line">    redis.call(&apos;hset&apos;, KEYS[1], ARGV[2], 1); </span><br><span class="line">    redis.call(&apos;pexpire&apos;, KEYS[1], ARGV[1]); </span><br><span class="line">    return nil; </span><br><span class="line">    end; </span><br><span class="line">if (redis.call(&apos;hexists&apos;, KEYS[1], ARGV[2]) == 1) then</span><br><span class="line">    redis.call(&apos;hincrby&apos;, KEYS[1], ARGV[2], 1); </span><br><span class="line">    redis.call(&apos;pexpire&apos;, KEYS[1], ARGV[1]);</span><br><span class="line">    return nil;</span><br><span class="line">    end;</span><br><span class="line">return redis.call(&apos;pttl&apos;, KEYS[1]);</span><br></pre></td></tr></table></figure>

<p>&#x5176;&#x4E2D;KEYS[1]&#x662F;Hash&#x7684;key&#x4E5F;&#x5C31;&#x662F;RLock&#x7684;&#x540D;&#x5B57;&#xFF0C;ARGV[2]&#x662F;&#x5BA2;&#x6237;&#x7AEF;id&#xFF0C;ARGV[1]&#x662F;Hash&#x7684;&#x751F;&#x5B58;&#x65F6;&#x95F4;TTL&#x3002;<br>&#x9996;&#x5148;&#x5224;&#x65AD;KEYS[1]&#x5BF9;&#x5E94;&#x7684;Hash&#x662F;&#x5426;&#x5B58;&#x5728;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x5B58;&#x5728;&#x76F4;&#x63A5;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;Hash&#xFF0C;&#x5BF9;&#x5E94;&#x7684;filed&#x503C;&#x4E3A;1&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x7B2C;&#x4E00;&#x6B21;&#x91CD;&#x5165;&#x6B21;&#x6570;&#x4E3A;1&#xFF0C;&#x5E76;&#x4E14;&#x8BBE;&#x7F6E;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#xFF0C;&#x6700;&#x7EC8;&#x8FD4;&#x56DE;null&#xFF1B;<br>&#x5982;&#x679C;Hash&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x4E14;filed&#x4E3A;ARGV[2]&#x7684;&#x9879;&#x4E5F;&#x5B58;&#x5728;&#xFF0C;&#x8BF4;&#x660E;&#x662F;&#x8BE5;&#x7EBF;&#x7A0B;&#x9012;&#x5F52;&#x8FDB;&#x5165;&#x8BE5;&#x9501;&#xFF0C;&#x9700;&#x8981;&#x5BF9;&#x8BE5;filed&#x589E;&#x52A0;&#x4E00;&#x6B21;&#x91CD;&#x5165;&#x6B21;&#x6570;&#xFF0C;&#x5E76;&#x4E14;&#x66F4;&#x65B0;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#xFF0C;&#x6700;&#x7EC8;&#x8FD4;&#x56DE;null&#xFF1B;<br>&#x5982;&#x679C;&#x5F53;&#x524D;&#x9501;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#xFF0C;&#x4E14;&#x4E0D;&#x662F;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x6301;&#x6709;&#x7684;&#xFF0C;&#x5C31;&#x4F1A;&#x8FD4;&#x56DE;&#x5F53;&#x524D;&#x9501;&#x7684;TTL&#x3002;</p>
<h3 id="&#x4E92;&#x65A5;&#x6027;&#x5B9E;&#x73B0;"><a href="#&#x4E92;&#x65A5;&#x6027;&#x5B9E;&#x73B0;" class="headerlink" title="&#x4E92;&#x65A5;&#x6027;&#x5B9E;&#x73B0;"></a>&#x4E92;&#x65A5;&#x6027;&#x5B9E;&#x73B0;</h3><p>&#x6BCF;&#x6B21;&#x8FDB;&#x884C;&#x52A0;&#x9501;&#x65F6;&#x4F1A;&#x8FD4;&#x56DE;&#x9501;&#x7684;TTL&#xFF0C;&#x5982;&#x679C;TTL&#x4E3A;null&#x8BF4;&#x660E;&#x52A0;&#x9501;&#x6210;&#x529F;&#xFF0C;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x5373;&#x53EF;&#xFF0C;&#x5426;&#x5219;&#x8BF4;&#x660E;&#x5DF2;&#x6709;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x6301;&#x6709;&#x8BE5;&#x9501;&#x3002;&#x540E;&#x7EED;&#x8BE5;&#x7EBF;&#x7A0B;&#x4F1A;&#x8FDB;&#x884C;&#x5FAA;&#x73AF;&#x53BB;&#x5C1D;&#x8BD5;&#x83B7;&#x53D6;&#x9501;&#x76F4;&#x5230;&#x52A0;&#x9501;&#x6210;&#x529F;&#x3002;&#x5982;&#x679C;&#x4F7F;&#x7528;tryLock&#x5219;&#x53EF;&#x4EE5;&#x5728;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#x7ED3;&#x675F;&#x540E;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x3002;</p>
<h3 id="Lease&#x7EED;&#x7EA6;"><a href="#Lease&#x7EED;&#x7EA6;" class="headerlink" title="Lease&#x7EED;&#x7EA6;"></a>Lease&#x7EED;&#x7EA6;</h3><p>&#x5982;&#x679C;&#x9501;&#x8BBE;&#x7F6E;&#x4E86;&#x6301;&#x6709;&#x9501;&#x7684;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#xFF0C;&#x5728;&#x8D85;&#x65F6;&#x540E;&#x4F1A;&#x8FDB;&#x884C;&#x9501;&#x7684;&#x91CA;&#x653E;&#xFF0C;&#x5982;&#x679C;&#x83B7;&#x53D6;&#x9501;&#x7684;&#x65F6;&#x5019;&#x4E0D;&#x6307;&#x5B9A;&#x6301;&#x6709;&#x9501;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x90A3;&#x4E48;&#x9ED8;&#x8BA4;&#x83B7;&#x53D6;&#x9501;30s&#x540E;&#x8D85;&#x65F6;&#x3002;&#x4E3A;&#x4E86;&#x9632;&#x6B62;&#x4EFB;&#x52A1;&#x6CA1;&#x6709;&#x6267;&#x884C;&#x5B8C;&#x5C31;&#x91CA;&#x653E;&#x9501;&#xFF0C;Redisson&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x5B88;&#x62A4;&#x7EBF;&#x7A0B;(&#x770B;&#x95E8;&#x72D7;&#x4EFB;&#x52A1;)&#x5B9A;&#x65F6;&#x5237;&#x65B0;(&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#x7684; 1/3, &#x9ED8;&#x8BA4;&#x662F;10s&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6BCF;10s&#x7EED;&#x7EA6;30s&#xFF0C;&#x76F4;&#x5230;&#x7EBF;&#x7A0B;&#x81EA;&#x5DF1;&#x91CA;&#x653E;)&#x8FD9;&#x4E2A;&#x9501;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#x8FDB;&#x884C;&#x7EED;&#x7EA6;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x53EA;&#x8981;&#x8FD9;&#x4E2A;&#x9501;&#x88AB;&#x83B7;&#x53D6;&#x4E86;&#xFF0C;&#x5219;&#x529B;&#x4FDD;&#x8FD9;&#x4E2A;&#x9501;&#x4E00;&#x76F4;&#x4E0D;&#x8D85;&#x65F6;&#xFF0C;&#x9664;&#x975E;&#x83B7;&#x53D6;&#x9501;&#x7684;&#x7EBF;&#x7A0B;&#x4E3B;&#x52A8;&#x91CA;&#x653E;&#x3002;&#x7531;&#x4E8E;&#x83B7;&#x53D6;&#x5230;&#x9501;&#x548C;&#x8FD9;&#x4E2A;&#x7EED;&#x547D;&#x4EFB;&#x52A1;&#x7684;&#x5B88;&#x62A4;&#x7EBF;&#x7A0B;&#x662F;&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x7684;&#xFF0C;&#x5F53;&#x83B7;&#x53D6;&#x9501;&#x7684;&#x7EBF;&#x7A0B;&#x6302;&#x6389;&#x4E86;&#xFF0C;&#x610F;&#x5473;&#x7740;&#x5237;&#x65B0;&#x4EFB;&#x52A1;&#x7684;&#x7EBF;&#x7A0B;&#x4E5F;&#x4F1A;&#x505C;&#x6B62;&#x6267;&#x884C;&#xFF0C;&#x5C31;&#x4E0D;&#x4F1A;&#x518D;&#x5237;&#x65B0;&#x9501;&#x7684;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#x3002;</p>
<h2 id="&#x89E3;&#x9501;"><a href="#&#x89E3;&#x9501;" class="headerlink" title="&#x89E3;&#x9501;"></a>&#x89E3;&#x9501;</h2><p>&#x89E3;&#x9501;&#x540C;&#x6837;&#x4F7F;&#x7528;Lua&#x811A;&#x672C;&#x6267;&#x884C;&#xFF0C;&#x4EE3;&#x7801;&#x4E3A;&#x4E0E;#unlockInnerAsync&#x65B9;&#x6CD5;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">lua&#x590D;&#x5236;&#x4EE3;&#x7801;if (redis.call(&apos;exists&apos;, KEYS[1]) == 0) then </span><br><span class="line">    redis.call(&apos;publish&apos;, KEYS[2], ARGV[1]); </span><br><span class="line">    return 1; </span><br><span class="line">    end;</span><br><span class="line"> if (redis.call(&apos;hexists&apos;, KEYS[1], ARGV[3]) == 0) then </span><br><span class="line">    return nil;</span><br><span class="line">    end; </span><br><span class="line">local counter = redis.call(&apos;hincrby&apos;, KEYS[1], ARGV[3], -1); </span><br><span class="line">if (counter &gt; 0) then </span><br><span class="line">    redis.call(&apos;pexpire&apos;, KEYS[1], ARGV[2]); </span><br><span class="line">    return 0; </span><br><span class="line">else </span><br><span class="line">    redis.call(&apos;del&apos;, KEYS[1]); </span><br><span class="line">    redis.call(&apos;publish&apos;, KEYS[2], ARGV[1]); </span><br><span class="line">    return 1; </span><br><span class="line">    end; </span><br><span class="line">return nil;</span><br></pre></td></tr></table></figure>

<p>&#x9996;&#x5148;&#x5224;&#x65AD;&#x9501;&#x662F;&#x5426;&#x662F;&#x5B58;&#x5728;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x5B58;&#x5728;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;nil&#xFF1B;<br>&#x5982;&#x679C;&#x8BE5;&#x7EBF;&#x7A0B;&#x6301;&#x6709;&#x9501;&#xFF0C;&#x5219;&#x5BF9;&#x5F53;&#x524D;&#x7684;&#x91CD;&#x5165;&#x503C;-1&#xFF0C;&#x5982;&#x679C;&#x8BA1;&#x7B97;&#x5B8C;&#x540E;&#x5927;&#x4E8E;0&#xFF0C;&#x91CD;&#x65B0;&#x8BBE;&#x7F6E;&#x8D85;&#x65F6;&#x6301;&#x6709;&#x5B9E;&#x8DF5;&#x8FD4;&#x56DE;0&#xFF1B;<br>&#x5982;&#x679C;&#x7B97;&#x5B8C;&#x4E0D;&#x5927;&#x4E8E;0&#xFF0C;&#x5220;&#x9664;&#x8FD9;&#x4E2A;Hash&#xFF0C;&#x5E76;&#x4E14;&#x8FDB;&#x884C;&#x5E7F;&#x64AD;&#xFF0C;&#x901A;&#x77E5;watch dog&#x505C;&#x6B62;&#x8FDB;&#x884C;&#x5237;&#x65B0;&#xFF0C;&#x5E76;&#x4E14; &#x8FD4;&#x56DE;1.</p>
<h2 id="&#x4F18;&#x7F3A;&#x70B9;"><a href="#&#x4F18;&#x7F3A;&#x70B9;" class="headerlink" title="&#x4F18;&#x7F3A;&#x70B9;"></a>&#x4F18;&#x7F3A;&#x70B9;</h2><h3 id="&#x4F18;&#x70B9;"><a href="#&#x4F18;&#x70B9;" class="headerlink" title="&#x4F18;&#x70B9;"></a>&#x4F18;&#x70B9;</h3><ol>
<li>Redisson &#x901A;&#x8FC7; Watch Dog&#x673A;&#x5236;&#x53EF;&#x4EE5;&#x89E3;&#x51B3;&#x9501;&#x7684;&#x7EED;&#x671F;&#x95EE;&#x9898;&#xFF1B;</li>
<li>&#x548C;Zookeeper&#x76F8;&#x6BD4;&#x8F83;&#xFF0C;Redisson&#x57FA;&#x4E8E;Redis&#x6027;&#x80FD;&#x66F4;&#x9AD8;&#xFF0C;&#x9002;&#x5408;&#x5BF9;&#x6027;&#x80FD;&#x8981;&#x6C42;&#x9AD8;&#x7684;&#x573A;&#x666F;&#x3002;</li>
<li>Redisson &#x5B9E;&#x73B0;&#x5206;&#x5E03;&#x5F0F;&#x53EF;&#x91CD;&#x5165;&#x9501;&#xFF0C;&#x6BD4;&#x539F;&#x751F;&#x7684; SET mylock userId NX PX milliseconds + lua &#x5B9E;&#x73B0;&#x7684;&#x6548;&#x679C;&#x66F4;&#x597D;&#x4E9B;&#xFF0C;&#x867D;&#x7136;&#x57FA;&#x672C;&#x539F;&#x7406;&#x90FD;&#x4E00;&#x6837;&#xFF0C;&#x4F46;&#x662F;&#x5B83;&#x5E2E;&#x6211;&#x4EEC;&#x5C4F;&#x853D;&#x4E86;&#x5185;&#x90E8;&#x7684;&#x6267;&#x884C;&#x7EC6;&#x8282;&#x3002;&#x5728;&#x7B49;&#x5F85;&#x7533;&#x8BF7;&#x9501;&#x8D44;&#x6E90;&#x7684;&#x8FDB;&#x7A0B;&#x7B49;&#x5F85;&#x7533;&#x8BF7;&#x9501;&#x7684;&#x5B9E;&#x73B0;&#x4E0A;&#x4E5F;&#x505A;&#x4E86;&#x4E00;&#x4E9B;&#x4F18;&#x5316;&#xFF0C;&#x51CF;&#x5C11;&#x4E86;&#x65E0;&#x6548;&#x7684;&#x9501;&#x7533;&#x8BF7;&#xFF0C;&#x63D0;&#x5347;&#x4E86;&#x8D44;&#x6E90;&#x7684;&#x5229;&#x7528;&#x7387;&#xFF1B;</li>
<li>Redison&#x5B9E;&#x73B0;&#x4E86;jucLock&#x63A5;&#x53E3;&#xFF0C;&#x5B8C;&#x6574;&#x7684;&#x5B9E;&#x73B0;&#x4E86;&#x8D85;&#x65F6;&#xFF0C;&#x4E2D;&#x65AD;&#xFF0C;&#x53EF;&#x91CD;&#x5165;&#x7B49;&#x5404;&#x79CD;&#x7279;&#x6027;&#x3002;</li>
</ol>
<h3 id="&#x7F3A;&#x70B9;"><a href="#&#x7F3A;&#x70B9;" class="headerlink" title="&#x7F3A;&#x70B9;"></a>&#x7F3A;&#x70B9;</h3><ol>
<li>Redisson&#x6CA1;&#x6709;&#x529E;&#x6CD5;&#x89E3;&#x51B3;&#x8282;&#x70B9;&#x5B95;&#x673A;&#x95EE;&#x9898;&#xFF0C;&#x4E0D;&#x80FD;&#x8FBE;&#x5230;ZK&#x7684;&#x4E00;&#x81F4;&#x6027;&#xFF1B;</li>
<li>Redison&#x7684;&#x673A;&#x5236;&#x6BD4;&#x8F83;&#x590D;&#x6742;&#xFF0C;&#x5982;&#x679C;&#x5BF9;&#x5176;&#x5E95;&#x5C42;&#x5B9E;&#x73B0;&#x4E0D;&#x662F;&#x5F88;&#x719F;&#x6089;&#x4F1A;&#x51FA;&#x73B0;&#x5F88;&#x591A;&#x9884;&#x671F;&#x5916;&#x7684;</li>
</ol>
<h2 id="Redisson&#x7EA2;&#x9501;&#x5B9E;&#x73B0;"><a href="#Redisson&#x7EA2;&#x9501;&#x5B9E;&#x73B0;" class="headerlink" title="Redisson&#x7EA2;&#x9501;&#x5B9E;&#x73B0;"></a>Redisson&#x7EA2;&#x9501;&#x5B9E;&#x73B0;</h2><p>Redisson&#x9501;&#x5E76;&#x6CA1;&#x6709;&#x89E3;&#x51B3;&#x4E3B;&#x4ECE;&#x8282;&#x70B9;&#x5207;&#x6362;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x91CD;&#x590D;&#x52A0;&#x9501;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x5373;&#x67D0;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x5728;Master&#x8282;&#x70B9;&#x52A0;&#x9501;&#xFF0C;&#x6B64;&#x65F6;&#x4E3B;&#x8282;&#x70B9;&#x5B95;&#x673A;&#xFF0C;&#x7531;&#x4E8E;&#x4E3B;&#x4ECE;&#x4E4B;&#x95F4;&#x5F02;&#x6B65;&#x590D;&#x5236;&#xFF0C;&#x4ECE;&#x8282;&#x70B9;&#x6CA1;&#x6709;&#x6765;&#x5F97;&#x53CA;&#x590D;&#x5236;&#xFF0C;&#x6B64;&#x65F6;&#x9009;&#x4E3E;&#x51FA;&#x65B0;&#x7684;Master&#x540E;&#x5E76;&#x6CA1;&#x6709;&#x4E4B;&#x524D;&#x7684;&#x9501;&#xFF0C;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x8981;&#x5BF9;&#x540C;&#x4E00;&#x4E2A;&#x9501;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#x65F6;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x52A0;&#x9501;&#xFF0C;&#x90A3;&#x4E48;&#x6709;&#x4E24;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x540C;&#x65F6;&#x6301;&#x6709;&#x4E00;&#x628A;&#x9501;&#xFF0C;&#x8FD9;&#x6837;&#x9501;&#x4F4F;&#x7684;&#x5171;&#x4EAB;&#x8D44;&#x6E90;&#x4F1A;&#x88AB;&#x91CD;&#x590D;&#x8BFB;&#x53D6;&#xFF0C;&#x9020;&#x6210;&#x6DF7;&#x4E71;&#x3002;</p>
<p>Redisson&#x63D0;&#x4F9B;&#x4E86;RedissonRedLock&#x9501;&#x5B9E;&#x73B0;&#x4E86;RedLock&#xFF0C;&#x9700;&#x8981;&#x540C;&#x65F6;&#x4F7F;&#x7528;&#x591A;&#x4E2A;&#x72EC;&#x7ACB;&#x7684;Redis&#x5B9E;&#x4F8B;&#x5206;&#x522B;&#x8FDB;&#x884C;&#x52A0;&#x9501;&#xFF0C;&#x53EA;&#x6709;&#x8D85;&#x8FC7;&#x4E00;&#x534A;&#x7684;&#x9501;&#x52A0;&#x9501;&#x6210;&#x529F;&#xFF0C;&#x5219;&#x8BA4;&#x4E3A;&#x662F;&#x6210;&#x529F;&#x52A0;&#x9501;&#x3002;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/b7c09f29745e12b2865b68e22702de08.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6945813518893449247.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6945813518893449247.html" itemprop="url">盘点认证框架   SpringSecurity 基础篇</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-03-31T21:44:46+08:00">
                2021-03-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>&#x603B;&#x6587;&#x6863; :<a href="https://dev.newban.cn/6941642435189538824">&#x6587;&#x7AE0;&#x76EE;&#x5F55;</a>  </p>
<p>Github : <a href="/external_links/f4c0695dd8cd8371c2f2fc9edde11029.html" target="blank" rel="noopener">github.com/black-ant</a></p>
</blockquote>
<p><strong>&#x534F;&#x8BAE;&#x5DEE;&#x4E0D;&#x591A;&#x8BF4;&#x5B8C;&#x4E86; , &#x5269;&#x4E0B;&#x7684;&#x4E3B;&#x8981;&#x662F;&#x4E00;&#x4E9B;&#x9488;&#x5BF9;&#x6027;&#x5F88;&#x5F3A;&#x7684;&#x534F;&#x8BAE; , &#x4E2A;&#x4EBA;&#x4E5F;&#x6CA1;&#x6709;&#x5B8C;&#x5168;&#x8DD1;&#x901A;&#x8FC7; , &#x6682;&#x65F6;&#x5148;&#x4E0D;&#x5F55;&#x5165; , &#x8BA4;&#x8BC1;&#x7CFB;&#x5217;&#x5F00;&#x59CB;&#x5206;&#x6790;&#x4E0D;&#x540C;&#x7684;&#x8BA4;&#x8BC1;&#x6846;&#x67B6;&#x4EE5;&#x53CA;&#x5BF9;&#x76F8;&#x5173;&#x534F;&#x8BAE;&#x7684;&#x5B9E;&#x73B0;.</strong></p>
<h2 id="&#x4E00;-&#x524D;&#x8A00;"><a href="#&#x4E00;-&#x524D;&#x8A00;" class="headerlink" title="&#x4E00; . &#x524D;&#x8A00;"></a>&#x4E00; . &#x524D;&#x8A00;</h2><p>SpringSecurity &#x5E94;&#x8BE5;&#x662F;&#x6700;&#x5E38;&#x89C1;&#x7684;&#x8BA4;&#x8BC1;&#x6846;&#x67B6;&#x4E86; , &#x5904;&#x4E8E;Spring&#x4F53;&#x7CFB;&#x4E2D;&#x4F7F;&#x4ED6;&#x80FD;&#x5FEB;&#x901F;&#x7684;&#x4E0A;&#x624B; , &#x8FD9;&#x4E00;&#x7BC7;&#x5F00;&#x59CB;&#x4F5C;&#x4E3A;&#x5165;&#x95E8;&#x7EA7;&#x5F00;&#x7BC7;&#x4F5C; , &#x6765;&#x6D45;&#x6D45;&#x7684;&#x8BB2;&#x4E00;&#x4E0B;SpringSecurity &#x7684;&#x6574;&#x4F53;&#x7ED3;&#x6784;.</p>
<p><strong>&#x5173;&#x4E8E;Security &#x7684;&#x4F7F;&#x7528; , &#x5B98;&#x65B9;&#x6587;&#x6863;&#x5DF2;&#x7ECF;&#x592A;&#x8BE6;&#x7EC6;&#x4E86;, &#x5EFA;&#x8BAE;&#x76F4;&#x63A5;&#x67E5;&#x770B; <a href="/external_links/fb0512ebcc24be15a62a9caf86e6a197.html" target="blank" rel="noopener">&#x5B98;&#x65B9;&#x6587;&#x6863;</a> , &#x4F5C;&#x4E3A;&#x5F00;&#x7BC7; , &#x4E0D;&#x6DF1;&#x5165;&#x6E90;&#x7801; , &#x53EA;&#x505A;&#x4F53;&#x7CFB;&#x7684;&#x4ECB;&#x7ECD;~~</strong></p>
<p><strong>&#x540E;&#x7EED;&#x4F1A;&#x9646;&#x9646;&#x7EED;&#x7EED;&#x5C06;&#x7B14;&#x8BB0;&#x4E2D;&#x7684;&#x6E90;&#x7801;&#x68B3;&#x7406;&#x51FA;&#x6765; ,&#x7B14;&#x8BB0;&#x5F88;&#x4E71;, &#x4F46;&#x613F;&#x7B49;&#x6574;&#x7406;&#x51FA;&#x4F53;&#x7CFB;!</strong></p>
<h2 id="&#x4E8C;-Spring-Security-&#x77E5;&#x8BC6;&#x4F53;&#x7CFB;"><a href="#&#x4E8C;-Spring-Security-&#x77E5;&#x8BC6;&#x4F53;&#x7CFB;" class="headerlink" title="&#x4E8C; . Spring Security &#x77E5;&#x8BC6;&#x4F53;&#x7CFB;"></a>&#x4E8C; . Spring Security &#x77E5;&#x8BC6;&#x4F53;&#x7CFB;</h2><p><strong>Security&#x4E2D;&#x9700;&#x8981;&#x6211;&#x4EEC;&#x64CD;&#x4F5C;&#x7684;&#x6210;&#x5458;&#x5927;&#x6982;&#x53EF;&#x4EE5;&#x5206;&#x4E3A;&#x4EE5;&#x4E0B;&#x51E0;&#x79CD; , &#x4F46;&#x662F;&#x6D89;&#x53CA;&#x7684;&#x7C7B;&#x8FDC;&#x8FDC;&#x4E0D;&#x6B62;&#x4ED6;&#x4EEC;</strong></p>
<ul>
<li><strong>Filter</strong> : &#x5BF9;&#x8BF7;&#x6C42;&#x62E6;&#x622A;&#x5904;&#x7406;</li>
<li><strong>Provider</strong> : &#x5BF9;&#x7528;&#x6237;&#x8FDB;&#x884C;&#x8BA4;&#x8BC1;</li>
<li><strong>Token</strong> : &#x7528;&#x6237;&#x8BA4;&#x8BC1;&#x4E3B;&#x4F53;</li>
</ul>
<h3 id="2-1-Spring-Security-&#x4E3B;&#x8981;&#x5305;&#x7ED3;&#x6784;"><a href="#2-1-Spring-Security-&#x4E3B;&#x8981;&#x5305;&#x7ED3;&#x6784;" class="headerlink" title="2.1 Spring Security &#x4E3B;&#x8981;&#x5305;&#x7ED3;&#x6784;"></a>2.1 Spring Security &#x4E3B;&#x8981;&#x5305;&#x7ED3;&#x6784;</h3><ul>
<li><strong>spring-security-remoting :</strong> &#x63D0;&#x4F9B;&#x4E0E; Spring Remoting &#x7684;&#x96C6;&#x6210;</li>
<li><strong>spring-security-web :</strong> &#x5305;&#x542B;&#x8FC7;&#x6EE4;&#x5668;&#x548C;&#x76F8;&#x5173;&#x7684;&#x7F51;&#x7EDC;&#x5B89;&#x5168;&#x57FA;&#x7840;&#x8BBE;&#x65BD;&#x4EE3;&#x7801;&#x3002;</li>
<li><strong>spring-security-config :</strong> &#x5305;&#x542B;&#x5B89;&#x5168;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x89E3;&#x6790;&#x4EE3;&#x7801;&#x548C; Java &#x914D;&#x7F6E;&#x4EE3;&#x7801;<br>?- &#x4F7F;&#x7528; Spring Security xml &#x547D;&#x540D;&#x7A7A;&#x95F4;&#x8FDB;&#x884C;&#x914D;&#x7F6E;&#x6216; Srping Security &#x7684; Java Configuration &#x652F;&#x6301;</li>
<li><strong>spring-security-ldap :</strong> &#x8BE5;&#x6A21;&#x5757;&#x63D0;&#x4F9B; LDAP &#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x548C;&#x914D;&#x7F6E;&#x4EE3;&#x7801;</li>
<li><strong>spring-security-oauth2-core :</strong> &#x5305;&#x542B;&#x652F;&#x6301; OAuth 2.0&#x6388;&#x6743;&#x6846;&#x67B6;&#x548C; OpenID Connect Core 1.0&#x7684;&#x6838;&#x5FC3;&#x7C7B;&#x548C;&#x63A5;&#x53E3;</li>
<li><strong>spring-security-oauth2-client :</strong> &#x5305;&#x542B; Spring Security &#x5BF9; OAuth 2.0&#x6388;&#x6743;&#x6846;&#x67B6;&#x548C; OpenID Connect Core 1.0&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x652F;&#x6301;</li>
<li><strong>spring-security-oauth2-jose :</strong> &#x5305;&#x542B; Spring Security &#x5BF9; JOSE (Javascript &#x5BF9;&#x8C61;&#x7B7E;&#x540D;&#x548C;&#x52A0;&#x5BC6;)&#x6846;&#x67B6;&#x7684;&#x652F;&#x6301;<ul>
<li>JSON Web Token (JWT)</li>
<li>JSON Web Signature (JWS)</li>
<li>JSON Web Encryption (JWE)</li>
<li>JSON Web Key (JWK)</li>
</ul>
</li>
<li><strong>spring-security-oauth2-resource-server :</strong> &#x5305;&#x542B; Spring Security &#x5BF9; OAuth 2.0&#x8D44;&#x6E90;&#x670D;&#x52A1;&#x5668;&#x7684;&#x652F;&#x6301;&#x3002;&#x5B83;&#x901A;&#x8FC7; OAuth 2.0&#x627F;&#x8F7D;&#x4EE4;&#x724C;&#x6765;&#x4FDD;&#x62A4; api</li>
<li><strong>spring-security-acl :</strong> &#x6B64;&#x6A21;&#x5757;&#x5305;&#x542B;&#x4E13;&#x95E8;&#x7684;&#x57DF;&#x5BF9;&#x8C61; ACL &#x5B9E;&#x73B0;&#x3002;&#x5B83;&#x7528;&#x4E8E;&#x5BF9;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#x7684;&#x7279;&#x5B9A;&#x57DF;&#x5BF9;&#x8C61;&#x5B9E;&#x4F8B;&#x5E94;&#x7528;&#x5B89;&#x5168;&#x6027;</li>
<li><strong>spring-security-cas :</strong> &#x8BE5;&#x6A21;&#x5757;&#x5305;&#x542B; Spring Security &#x7684; CAS &#x5BA2;&#x6237;&#x7AEF;&#x96C6;&#x6210;</li>
<li><strong>spring-security-openid :</strong> &#x6B64;&#x6A21;&#x5757;&#x5305;&#x542B; OpenID web &#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x652F;&#x6301;&#x3002;&#x5B83;&#x7528;&#x4E8E;&#x6839;&#x636E;&#x5916;&#x90E8; OpenID &#x670D;&#x52A1;&#x5668;&#x5BF9;&#x7528;&#x6237;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x3002;</li>
<li><strong>spring-security-test</strong></li>
<li><strong>spring-secuity-taglibs</strong></li>
</ul>
<h3 id="2-2-Spring-Security-&#x6838;&#x5FC3;&#x4F53;&#x7CFB;-Filter"><a href="#2-2-Spring-Security-&#x6838;&#x5FC3;&#x4F53;&#x7CFB;-Filter" class="headerlink" title="2.2 Spring Security &#x6838;&#x5FC3;&#x4F53;&#x7CFB; Filter"></a>2.2 Spring Security &#x6838;&#x5FC3;&#x4F53;&#x7CFB; Filter</h3><p>SpringSecurity &#x4E2D;&#x5B58;&#x5728;&#x5F88;&#x591A;Filter , &#x629B;&#x5F00;&#x4E00;&#x4E9B;&#x5E95;&#x5C42;&#x7684; , &#x4E00;&#x822C;&#x4E1A;&#x52A1;&#x4E2D;&#x7684;Filter&#x4E3B;&#x8981;&#x662F;&#x4E3A;&#x4E86;&#x63A7;&#x5236;&#x4EE5;&#x4F55;&#x79CD;&#x65B9;&#x5F0F;&#x8FDB;&#x884C;&#x8BA4;&#x8BC1; . &#x4E00;&#x822C;&#x7684;&#x4F53;&#x7CFB;&#x7ED3;&#x6784;&#x91CC;&#x9762; , &#x90FD;&#x4F1A;<strong>&#x5FAA;&#x73AF;&#x5904;&#x7406;</strong> , &#x4F8B;&#x5982; CAS &#x4E2D; , &#x5C31;&#x662F;<strong>&#x901A;&#x8FC7; HandlerManager &#x8FDB;&#x884C; for each &#x5FAA;&#x73AF;</strong> , &#x800C; SpirngSecurity &#x4E2D; , &#x540C;&#x6837;&#x901A;&#x8FC7; SecurityFilterChain &#x8FDB;&#x884C;&#x5FAA;&#x73AF;.</p>
<p><strong>SecurityFilterChain &#x5728;&#x540E;&#x671F;&#x6E90;&#x7801;&#x68B3;&#x7406;&#x7684;&#x65F6;&#x5019;&#x5728;&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD; , &#x8FD9;&#x91CC;&#x5148;&#x770B;&#x5F20;&#x56FE; :</strong></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/e1d62f903271f92b24ab39758cf2e4d6bd35e84a7e5bf10de6ea7867a029649a" alt="securityfilterchain.png"></p>
<p>FilterChainProxy &#x4F7F;&#x7528; SecurityFilterChain &#x6765;&#x786E;&#x5B9A;&#x5E94;&#x8BE5;&#x4E3A;&#x6B64;&#x8BF7;&#x6C42;&#x8C03;&#x7528;&#x54EA;&#x4E2A; Spring &#x5B89;&#x5168;&#x8FC7;&#x6EE4;&#x5668; ,</p>
<p>FilterChainProxy &#x51B3;&#x5B9A;&#x5E94;&#x8BE5;&#x4F7F;&#x7528;&#x54EA;&#x4E2A; SecurityFilterChain&#x3002;&#x4F1A;&#x8C03;&#x7528;&#x7B2C;&#x4E00;&#x4E2A;&#x88AB;&#x5339;&#x914D;&#x7684;SecurityFilterChain ,<strong>&#x5373;&#x5339;&#x914D;&#x662F;&#x6709;&#x5E8F;&#x7684;</strong></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/0c917e5a2901bbe4824e661f8ae9b7e4cfd4ca5c07c41cfc361f26f17ace43b6" alt="Filter-&#x591A;&#x91CD;&#x5B89;&#x5168;&#x8FC7;&#x6EE4;&#x94FE;.jpg"></p>
<ul>
<li>&#x5982;&#x679C;&#x8BF7;&#x6C42;/api/messages/ &#x7684;URL&#xFF0C;&#x5B83;&#x5C06;&#x9996;&#x5148;&#x5339;&#x914D; <strong>SecurityFilterChain0</strong>&#x7684; /api/** &#x6A21;&#x5F0F;&#xFF0C;&#x56E0;&#x6B64;&#x53EA;&#x4F1A;&#x8C03;&#x7528; SecurityFilterChain0&#xFF0C;&#x5373;&#x4F7F;&#x5B83;&#x4E5F;&#x5339;&#x914D; SecurityFilterChainn&#x3002;</li>
<li>&#x5982;&#x679C;&#x8BF7;&#x6C42;/messages/ &#x7684;URL&#xFF0C;&#x5B83;&#x5C06;&#x4E0D;&#x5339;&#x914D; <strong>SecurityFilterChain0</strong>&#x7684; /api/** &#x6A21;&#x5F0F;&#xFF0C;&#x56E0;&#x6B64; FilterChainProxy <strong>&#x5C06;&#x7EE7;&#x7EED;&#x5C1D;&#x8BD5;&#x6BCF;&#x4E2A; SecurityFilterChain</strong>&#x3002;&#x5047;&#x8BBE;&#x6CA1;&#x6709;&#x5176;&#x4ED6;&#x7684; <strong>SecurityFilterChai n</strong>&#x5B9E;&#x4F8B;&#x5339;&#x914D; SecurityFilterChainn &#x5C06;&#x88AB;&#x8C03;&#x7528;&#x3002; <strong>(&#x5373;&#x65E0;&#x5339;&#x914D;&#x8C03;&#x7528;&#x6700;&#x540E;&#x4E00;&#x4E2A;)</strong></li>
</ul>
<blockquote>
<p><strong>&#x5DF2;&#x77E5;&#x7684; Filter &#x7C7B;</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;ChannelProcessingFilter</span><br><span class="line">WebAsyncManagerIntegrationFilter</span><br><span class="line">SecurityContextPersistenceFilter</span><br><span class="line">HeaderWriterFilter</span><br><span class="line">CorsFilter</span><br><span class="line">CsrfFilter</span><br><span class="line">LogoutFilter</span><br><span class="line">OAuth2AuthorizationRequestRedirectFilter</span><br><span class="line">Saml2WebSsoAuthenticationRequestFilter</span><br><span class="line">X509AuthenticationFilter</span><br><span class="line">AbstractPreAuthenticatedProcessingFilter</span><br><span class="line">CasAuthenticationFilter</span><br><span class="line">OAuth2LoginAuthenticationFilter</span><br><span class="line">Saml2WebSsoAuthenticationFilter</span><br><span class="line">UsernamePasswordAuthenticationFilter</span><br><span class="line">OpenIDAuthenticationFilter</span><br><span class="line">DefaultLoginPageGeneratingFilter</span><br><span class="line">DefaultLogoutPageGeneratingFilter</span><br><span class="line">ConcurrentSessionFilter</span><br><span class="line">DigestAuthenticationFilter</span><br><span class="line">BearerTokenAuthenticationFilter</span><br><span class="line">BasicAuthenticationFilter</span><br><span class="line">RequestCacheAwareFilter</span><br><span class="line">SecurityContextHolderAwareRequestFilter</span><br><span class="line">JaasApiIntegrationFilter</span><br><span class="line">RememberMeAuthenticationFilter</span><br><span class="line">AnonymousAuthenticationFilter</span><br><span class="line">OAuth2AuthorizationCodeGrantFilter</span><br><span class="line">SessionManagementFilter</span><br><span class="line">ExceptionTranslationFilter</span><br><span class="line">FilterSecurityInterceptor</span><br><span class="line">SwitchUserFilter</span><br></pre></td></tr></table></figure>

<h3 id="2-3-Authentication-&#x4F53;&#x7CFB;&#x7ED3;&#x6784;"><a href="#2-3-Authentication-&#x4F53;&#x7CFB;&#x7ED3;&#x6784;" class="headerlink" title="2.3 Authentication &#x4F53;&#x7CFB;&#x7ED3;&#x6784;"></a>2.3 Authentication &#x4F53;&#x7CFB;&#x7ED3;&#x6784;</h3><p><strong>&#x8BA4;&#x8BC1;&#x4F53;&#x7CFB;&#x662F;&#x6838;&#x5FC3;&#x7684;&#x5904;&#x7406;&#x4F53;&#x7CFB; , &#x5305;&#x542B;&#x4EE5;&#x4E0B;&#x4E3B;&#x8981;&#x7C7B; :</strong></p>
<p><strong>SecurityContextHolder :</strong> Spring Security &#x5B58;&#x50A8;&#x88AB;&#x9A8C;&#x8BC1;&#x8005;&#x7684;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#x7684;&#x5730;&#x65B9;&#x3002;  </p>
<p><strong>SecurityContext :</strong> &#x4ECE; SecurityContextHolder &#x83B7;&#x5F97;&#xFF0C;&#x5E76;&#x5305;&#x542B;&#x5F53;&#x524D;&#x7ECF;&#x8FC7;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x7684;&#x7528;&#x6237;&#x7684;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x3002;&#x3002;  </p>
<p><strong>Authentication :</strong> &#x53EF;&#x4EE5;&#x4F5C;&#x4E3A; AuthenticationManager &#x7684;&#x8F93;&#x5165;&#xFF0C;&#x4EE5;&#x63D0;&#x4F9B;&#x7528;&#x6237;&#x4E3A;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x6216;&#x6765;&#x81EA; SecurityContext &#x7684;&#x5F53;&#x524D;&#x7528;&#x6237;&#x63D0;&#x4F9B;&#x7684;&#x51ED;&#x636E;&#x3002;&#x3002;  </p>
<p><strong>GrantedAuthority :</strong> &#x5728;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x4E0A;&#x6388;&#x4E88;&#x4E3B;&#x4F53;&#x7684;&#x6743;&#x9650;(&#x5373;&#x89D2;&#x8272;&#x3001;&#x8303;&#x56F4;&#x7B49;)&#x3002;  </p>
<p><strong>AuthenticationManager :</strong> &#x5B9A;&#x4E49; Spring Security &#x7684;&#x8FC7;&#x6EE4;&#x5668;&#x5982;&#x4F55;&#x6267;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x7684; API&#x3002;&#x3002;  </p>
<p><strong>ProviderManager :</strong> AuthenticationManager &#x6700;&#x5E38;&#x7528;&#x7684;&#x5B9E;&#x73B0;&#x3002;&#x3002;  </p>
<p><strong>Providationprovider :</strong> &#x7531; ProviderManager &#x7528;&#x4E8E;&#x6267;&#x884C;&#x7279;&#x5B9A;&#x7C7B;&#x578B;&#x7684;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x3002;&#x3002;  </p>
<p><strong>AuthenticationEntryPoint :</strong> &#x7528;&#x4E8E;&#x4ECE;&#x5BA2;&#x6237;&#x673A;&#x8BF7;&#x6C42;&#x51ED;&#x8BC1;(&#x5373;&#x91CD;&#x5B9A;&#x5411;&#x5230;&#x767B;&#x5F55;&#x9875;&#x9762;&#xFF0C;&#x53D1;&#x9001; www &#x8BA4;&#x8BC1;&#x54CD;&#x5E94;&#x7B49;)&#x3002;  </p>
<p><strong>AbstractAuthenticationProcessingFilter :</strong> &#x7528;&#x4F5C;&#x9A8C;&#x8BC1;&#x7528;&#x6237;&#x51ED;&#x636E;&#x7684;&#x57FA;&#x672C;&#x7B5B;&#x9009;&#x5668;  </p>
<p><strong>AccessDecisionManager :</strong> &#x7531; AbstractSecurityInterceptor &#x8C03;&#x7528;&#xFF0C;&#x8D1F;&#x8D23;&#x505A;&#x51FA;&#x6700;&#x7EC8;&#x7684;&#x8BBF;&#x95EE;&#x63A7;&#x5236;&#x51B3;&#x7B56;</p>
<p><strong>&#x540E;&#x7EED;&#x6211;&#x4EEC;&#x4F1A;&#x56F4;&#x7ED5;&#x4EE5;&#x4E0A;&#x7C7B;&#x8FDB;&#x884C;&#x6E90;&#x7801;&#x68B3;&#x7406;:</strong></p>
<h2 id="&#x4E09;-SpringSeurity-&#x6848;&#x4F8B;"><a href="#&#x4E09;-SpringSeurity-&#x6848;&#x4F8B;" class="headerlink" title="&#x4E09; . SpringSeurity &#x6848;&#x4F8B;"></a>&#x4E09; . SpringSeurity &#x6848;&#x4F8B;</h2><p><strong>&#x4EE5;&#x4E0B;&#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x7B80;&#x5355;&#x7684; Security &#x6848;&#x4F8B; : <a href="/external_links/5bec8028ac871c19a7fc432cf9dd9eab.html" target="blank" rel="noopener">&gt;&gt;&gt;&gt;&#x9879;&#x76EE;&#x6E90;&#x7801;&lt;&lt;&lt;&lt;</a></strong></p>
<h3 id="3-1-SpringSecurity-&#x4F9D;&#x8D56;&#x548C;&#x914D;&#x7F6E;"><a href="#3-1-SpringSecurity-&#x4F9D;&#x8D56;&#x548C;&#x914D;&#x7F6E;" class="headerlink" title="3.1 SpringSecurity &#x4F9D;&#x8D56;&#x548C;&#x914D;&#x7F6E;"></a>3.1 SpringSecurity &#x4F9D;&#x8D56;&#x548C;&#x914D;&#x7F6E;</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;@Configuration</span><br><span class="line">@EnableWebSecurity</span><br><span class="line">public class WebSecurityConfig extends WebSecurityConfigurerAdapter {</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private AuthenticationSuccessHandler myAuthenticationSuccessHandler;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private AuthenticationFailureHandler myAuthenctiationFailureHandler;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public UserService CustomerUserService() {</span><br><span class="line">        System.out.print(&quot;step1============&quot;);</span><br><span class="line">        return new UserService();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void configure(AuthenticationManagerBuilder auth) throws Exception {</span><br><span class="line">        //BCryptPasswordEncoder().encode(&quot;123456&quot;)).roles(&quot;ADMIN&quot;);</span><br><span class="line">        auth.userDetailsService(CustomerUserService()).passwordEncoder(new BCryptPasswordEncoder());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void configure(HttpSecurity http) throws Exception {</span><br><span class="line">        //&#x6B64;&#x65B9;&#x6CD5;&#x4E2D;&#x8FDB;&#x884C;&#x4E86;&#x8BF7;&#x6C42;&#x6388;&#x6743;&#xFF0C;&#x7528;&#x6765;&#x89C4;&#x5B9A;&#x5BF9;&#x54EA;&#x4E9B;&#x8BF7;&#x6C42;&#x8FDB;&#x884C;&#x62E6;&#x622A;</span><br><span class="line">        //&#x5176;&#x4E2D;&#xFF1A;antMatchers--&#x4F7F;&#x7528;ant&#x98CE;&#x683C;&#x7684;&#x8DEF;&#x5F84;&#x5339;&#x914D;</span><br><span class="line">        //regexMatchers--&#x4F7F;&#x7528;&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;&#x5339;&#x914D;</span><br><span class="line">        http.authorizeRequests()</span><br><span class="line">                .antMatchers(&quot;/test/**&quot;).permitAll()</span><br><span class="line">                .antMatchers(&quot;/before/**&quot;).permitAll()</span><br><span class="line">                .antMatchers(&quot;/index&quot;).permitAll()</span><br><span class="line">                .antMatchers(&quot;/&quot;).permitAll()</span><br><span class="line">                .anyRequest().authenticated()                      //&#x5176;&#x5B83;&#x8BF7;&#x6C42;&#x90FD;&#x9700;&#x8981;&#x6821;&#x9A8C;&#x624D;&#x80FD;&#x8BBF;&#x95EE;</span><br><span class="line">                .and()</span><br><span class="line">                .formLogin()</span><br><span class="line">                .loginPage(&quot;/login&quot;)                             //&#x5B9A;&#x4E49;&#x767B;&#x5F55;&#x7684;&#x9875;&#x9762;&quot;/login&quot;&#xFF0C;&#x5141;&#x8BB8;&#x8BBF;&#x95EE;</span><br><span class="line">                .defaultSuccessUrl(&quot;/home&quot;)  //&#x767B;&#x5F55;&#x6210;&#x529F;&#x540E;&#x9ED8;&#x8BA4;&#x8DF3;&#x8F6C;&#x5230;&quot;list&quot;</span><br><span class="line">                .successHandler(myAuthenticationSuccessHandler).failureHandler(myAuthenctiationFailureHandler).permitAll().and()</span><br><span class="line">                .logout()                                           //&#x9ED8;&#x8BA4;&#x7684;&quot;/logout&quot;, &#x5141;&#x8BB8;&#x8BBF;&#x95EE;</span><br><span class="line">                .logoutSuccessUrl(&quot;/index&quot;)</span><br><span class="line">                .permitAll();</span><br><span class="line">        http.addFilterBefore(new BeforeFilter(), UsernamePasswordAuthenticationFilter.class);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void configure(WebSecurity web) throws Exception {</span><br><span class="line">        //&#x89E3;&#x51B3;&#x9759;&#x6001;&#x8D44;&#x6E90;&#x88AB;&#x62E6;&#x622A;&#x7684;&#x95EE;&#x9898;</span><br><span class="line">        web.ignoring().antMatchers(&quot;/**/*.js&quot;, &quot;/lang/*.json&quot;, &quot;/**/*.css&quot;, &quot;/**/*.js&quot;, &quot;/**/*.map&quot;, &quot;/**/*.html&quot;, &quot;/**/*.png&quot;);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><strong>&#x5176;&#x4E2D;&#x6709;&#x51E0;&#x4E2A;&#x4E3B;&#x8981;&#x7684;&#x5730;&#x65B9; :</strong></p>
<blockquote>
<p>@EnableWebSecurity &#x5E72;&#x4E86;&#x4EC0;&#x4E48; ?</p>
</blockquote>
<ul>
<li>&#x8BE5;&#x914D;&#x7F6E;&#x5C06;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; servlet Filter&#xFF0C;&#x4F5C;&#x4E3A;&#x540D;&#x4E3A; springSecurityFilterChain &#x7684; bean</li>
<li>&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5177;&#x6709;&#x7528;&#x6237;&#x7528;&#x6237;&#x540D;&#x548C;&#x968F;&#x673A;&#x751F;&#x6210;&#x7684;&#x767B;&#x5F55;&#x5230;&#x63A7;&#x5236;&#x53F0;&#x7684;&#x5BC6;&#x7801;&#x7684; UserDetailsService bean</li>
<li>&#x4E3A;&#x6BCF;&#x4E2A;&#x8BF7;&#x6C42;&#x5411; Servlet &#x5BB9;&#x5668;&#x6CE8;&#x518C;&#x540D;&#x4E3A; springSecurityFilterChain &#x7684; bean &#x7684; Filter</li>
</ul>
<blockquote>
<p>TODO</p>
</blockquote>
<h3 id="3-2-&#x51C6;&#x5907;&#x4E00;&#x4E2A;-UserDetailsService"><a href="#3-2-&#x51C6;&#x5907;&#x4E00;&#x4E2A;-UserDetailsService" class="headerlink" title="3.2 &#x51C6;&#x5907;&#x4E00;&#x4E2A; UserDetailsService"></a>3.2 &#x51C6;&#x5907;&#x4E00;&#x4E2A; UserDetailsService</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;public class UserService implements UserDetailsService {</span><br><span class="line"></span><br><span class="line">    //......</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {</span><br><span class="line">        Users user = userRepository.findByUsername(username);</span><br><span class="line">        // ....</span><br><span class="line">        return user;</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>&#x4E00;&#x4E2A;&#x57FA;&#x672C;&#x7684; Demo &#x5C31;&#x5B8C;&#x6210;&#x4E86; , &#x6848;&#x4F8B;&#x80FD;&#x600E;&#x4E48;&#x7B80;&#x5355; , &#x5176;&#x5B9E;&#x4E3B;&#x8981;&#x662F;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x590D;&#x7528;&#x4E86;&#x4EE5;&#x4E0B;&#x7684;&#x7C7B; :</strong></p>
</blockquote>
<ul>
<li>UsernamePasswordAuthenticationFilter</li>
<li>DaoAuthenticationProvider</li>
<li>UsernamePasswordAuthenticationToken</li>
</ul>
<h2 id="&#x56DB;-&#x5B9A;&#x5236;&#x6848;&#x4F8B;"><a href="#&#x56DB;-&#x5B9A;&#x5236;&#x6848;&#x4F8B;" class="headerlink" title="&#x56DB; . &#x5B9A;&#x5236;&#x6848;&#x4F8B;"></a>&#x56DB; . &#x5B9A;&#x5236;&#x6848;&#x4F8B;</h2><p><strong>&#x6211;&#x4EEC;&#x628A;&#x6574;&#x4E2A;&#x7ED3;&#x6784;&#x518D;&#x5B9A;&#x5236;&#x4E00;&#x4E0B; , &#x6EE1;&#x8DB3;&#x6211;&#x4EEC;&#x672C;&#x8EAB;&#x7684;&#x529F;&#x80FD; :</strong></p>
<h3 id="4-1-Step-1-&#x5B9A;&#x5236;&#x4E00;&#x4E2A;-Filter"><a href="#4-1-Step-1-&#x5B9A;&#x5236;&#x4E00;&#x4E2A;-Filter" class="headerlink" title="4.1 Step 1 : &#x5B9A;&#x5236;&#x4E00;&#x4E2A; Filter"></a>4.1 Step 1 : &#x5B9A;&#x5236;&#x4E00;&#x4E2A; Filter</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;// &#x6211;&#x4EEC;&#x590D;&#x7528; UsernamePasswordAuthenticationFilter , &#x5C06;&#x5176;&#x8FDB;&#x884C;&#x90E8;&#x5206;&#x5B9A;&#x5236;</span><br><span class="line">public class DatabaseAuthenticationFilter extends AbstractAuthenticationProcessingFilter {</span><br><span class="line"></span><br><span class="line">    // &#x4FEE;&#x6539;&#x7528;&#x6237;&#x540D;&#x4E3A; account</span><br><span class="line">    public static final String SPRING_SECURITY_FORM_USERNAME_KEY = &quot;account&quot;;</span><br><span class="line">    public static final String SPRING_SECURITY_FORM_PASSWORD_KEY = &quot;password&quot;;</span><br><span class="line"></span><br><span class="line">    private String usernameParameter = SPRING_SECURITY_FORM_USERNAME_KEY;</span><br><span class="line">    private String passwordParameter = SPRING_SECURITY_FORM_PASSWORD_KEY;</span><br><span class="line">    private boolean postOnly = true;</span><br><span class="line"></span><br><span class="line">    public DatabaseAuthenticationFilter() {</span><br><span class="line">        super(new AntPathRequestMatcher(&quot;/database/login&quot;, &quot;POST&quot;));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public Authentication attemptAuthentication(HttpServletRequest request,</span><br><span class="line">                                                HttpServletResponse response) throws AuthenticationException {</span><br><span class="line">        if (postOnly &amp;&amp; !request.getMethod().equals(&quot;POST&quot;)) {</span><br><span class="line">            throw new AuthenticationServiceException(</span><br><span class="line">                    &quot;Authentication method not supported: &quot; + request.getMethod());</span><br><span class="line">        }</span><br><span class="line">        // username &#x4ECE;&#x4E0B;&#x65B9;&#x65B9;&#x6CD5;&#x83B7;&#x53D6;</span><br><span class="line">        String username = obtainUsername(request);</span><br><span class="line">        String password = obtainPassword(request);</span><br><span class="line"></span><br><span class="line">        if (username == null) {</span><br><span class="line">            username = &quot;&quot;;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        if (password == null) {</span><br><span class="line">            password = &quot;&quot;;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        username = username.trim();</span><br><span class="line">        // &#x6838;&#x5FC3; : &#x8FD9;&#x91CC;&#x66FF;&#x6362;&#x4E86; DatabaseUserToken</span><br><span class="line">        DatabaseUserToken authRequest = new DatabaseUserToken(username, password);</span><br><span class="line"></span><br><span class="line">        // Allow subclasses to set the &quot;details&quot; property</span><br><span class="line">        setDetails(request, authRequest);</span><br><span class="line"></span><br><span class="line">        return this.getAuthenticationManager().authenticate(authRequest);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    protected String obtainPassword(HttpServletRequest request) {</span><br><span class="line">        return request.getParameter(passwordParameter);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    protected String obtainUsername(HttpServletRequest request) {</span><br><span class="line">        return request.getParameter(usernameParameter);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    protected void setDetails(HttpServletRequest request,</span><br><span class="line">                              DatabaseUserToken authRequest) {</span><br><span class="line">        authRequest.setDetails(authenticationDetailsSource.buildDetails(request));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void setUsernameParameter(String usernameParameter) {</span><br><span class="line">        Assert.hasText(usernameParameter, &quot;Username parameter must not be empty or null&quot;);</span><br><span class="line">        this.usernameParameter = usernameParameter;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void setPasswordParameter(String passwordParameter) {</span><br><span class="line">        Assert.hasText(passwordParameter, &quot;Password parameter must not be empty or null&quot;);</span><br><span class="line">        this.passwordParameter = passwordParameter;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void setPostOnly(boolean postOnly) {</span><br><span class="line">        this.postOnly = postOnly;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public final String getUsernameParameter() {</span><br><span class="line">        return usernameParameter;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public final String getPasswordParameter() {</span><br><span class="line">        return passwordParameter;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="4-2-Step-2-&#x51C6;&#x5907;&#x4E00;&#x4E2A;-Token"><a href="#4-2-Step-2-&#x51C6;&#x5907;&#x4E00;&#x4E2A;-Token" class="headerlink" title="4.2 Step 2 : &#x51C6;&#x5907;&#x4E00;&#x4E2A; Token"></a>4.2 Step 2 : &#x51C6;&#x5907;&#x4E00;&#x4E2A; Token</h3><p><strong>Token &#x662F;&#x5728;Authentication &#x4E2D;&#x4F20;&#x9012;&#x7684;&#x6838;&#x5FC3; , &#x5B83;&#x7528;&#x4E8E;&#x540E;&#x7EED;&#x8FDB;&#x884C;&#x7968;&#x636E;&#x7684;&#x8BA4;&#x8BC1;</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;public class DatabaseUserToken extends AbstractAuthenticationToken {</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private static final long serialVersionUID = SpringSecurityCoreVersion.SERIAL_VERSION_UID;</span><br><span class="line"></span><br><span class="line">    private final Object principal;</span><br><span class="line">    private String credentials;</span><br><span class="line">    private String type;</span><br><span class="line">    private Collection&lt;? extends GrantedAuthority&gt; authorities;</span><br><span class="line"></span><br><span class="line">    public DatabaseUserToken(Object principal, String credentials) {</span><br><span class="line">        super(null);</span><br><span class="line">        this.principal = principal;</span><br><span class="line">        this.credentials = credentials;</span><br><span class="line">        this.type = &quot;common&quot;;</span><br><span class="line">        setAuthenticated(false);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public DatabaseUserToken(Object principal, String credentials, String type) {</span><br><span class="line">        super(null);</span><br><span class="line">        this.principal = principal;</span><br><span class="line">        this.credentials = credentials;</span><br><span class="line">        this.type = StringUtils.isEmpty(type) ? &quot;common&quot; : type;</span><br><span class="line">        setAuthenticated(false);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public DatabaseUserToken(Object principal, String credentials, Collection&lt;? extends GrantedAuthority&gt; authorities) {</span><br><span class="line">        super(authorities);</span><br><span class="line">        this.principal = principal;</span><br><span class="line">        this.credentials = credentials;</span><br><span class="line">        setAuthenticated(false);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public DatabaseUserToken(Object principal, Collection&lt;? extends GrantedAuthority&gt; authorities) {</span><br><span class="line">        super(authorities);</span><br><span class="line">        this.principal = principal;</span><br><span class="line">        this.credentials = null;</span><br><span class="line">        super.setAuthenticated(true); // must use super, as we override</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public String getType() {</span><br><span class="line">        return type;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void setType(String type) {</span><br><span class="line">        this.type = type;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * @param isAuthenticated</span><br><span class="line">     * @throws IllegalArgumentException</span><br><span class="line">     */</span><br><span class="line">    public void setAuthenticated(boolean isAuthenticated) throws IllegalArgumentException {</span><br><span class="line">        super.setAuthenticated(true);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Object getCredentials() {</span><br><span class="line">        return credentials;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Object getPrincipal() {</span><br><span class="line">        return principal;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="4-3-Step-3-&#x51C6;&#x5907;&#x4E00;&#x4E2A;-Provider"><a href="#4-3-Step-3-&#x51C6;&#x5907;&#x4E00;&#x4E2A;-Provider" class="headerlink" title="4.3 Step 3 : &#x51C6;&#x5907;&#x4E00;&#x4E2A; Provider"></a>4.3 Step 3 : &#x51C6;&#x5907;&#x4E00;&#x4E2A; Provider</h3><p><strong>&#x8FD9;&#x91CC;&#x901A;&#x8FC7; supports &#x65B9;&#x6CD5;&#x5224;&#x65AD; token &#x662F;&#x5426;&#x7B26;&#x5408; ,&#x4ECE;&#x800C;&#x53D1;&#x8D77;&#x8BA4;&#x8BC1;&#x8FC7;&#x7A0B; (PS : &#x548C; CAS &#x7B80;&#x76F4;&#x4E00;&#x4E2A;&#x601D;&#x8DEF;)</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">public class DatabaseAuthenticationProvider implements AuthenticationProvider {</span><br><span class="line"></span><br><span class="line">    private Logger logger = LoggerFactory.getLogger(this.getClass());</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private UserInfoService userInfoService;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private AntSSOConfiguration antSSOConfiguration;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Authentication authenticate(Authentication authentication) throws AuthenticationException {</span><br><span class="line"></span><br><span class="line">        logger.info(&quot;------&gt; auth database &lt;-------&quot;);</span><br><span class="line">        String username = (authentication.getPrincipal() == null)</span><br><span class="line">                ? &quot;NONE_PROVIDED&quot; : String.valueOf(authentication.getPrincipal());</span><br><span class="line">        String password = (String) authentication.getCredentials();</span><br><span class="line"></span><br><span class="line">        if (StringUtils.isEmpty(password)) {</span><br><span class="line">            throw new BadCredentialsException(&quot;&#x5BC6;&#x7801;&#x4E0D;&#x80FD;&#x4E3A;&#x7A7A;&quot;);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        UserInfo user = userInfoService.searchUserInfo(new UserInfoSearchTO&lt;String&gt;(username));</span><br><span class="line">        logger.info(&quot;------&gt; this is [{}] user  :{}&lt;-------&quot;, username, String.valueOf(user));</span><br><span class="line">        if (null == user) {</span><br><span class="line">            logger.error(&quot;E----&gt; error :{} --user not fount &quot;, username);</span><br><span class="line">            throw new BadCredentialsException(&quot;&#x7528;&#x6237;&#x4E0D;&#x5B58;&#x5728;&quot;);</span><br><span class="line">        }</span><br><span class="line">        String encodePwd = &quot;&quot;;</span><br><span class="line">        if (password.length() != 32) {</span><br><span class="line">            encodePwd = PwdUtils.AESencode(password, AlgorithmConfig.getAlgorithmKey());</span><br><span class="line">            logger.info(&quot;------&gt; {} encode password is :{} &lt;-------&quot;, password, encodePwd);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        if (!encodePwd.equals(user.getPassword())) {</span><br><span class="line">            logger.error(&quot;E----&gt; user check error&quot;);</span><br><span class="line">            throw new BadCredentialsException(&quot;&#x7528;&#x6237;&#x540D;&#x6216;&#x5BC6;&#x7801;&#x4E0D;&#x6B63;&#x786E;&quot;);</span><br><span class="line">        } else {</span><br><span class="line">            logger.info(&quot;user check success&quot;);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        DatabaseUserToken result = new DatabaseUserToken(</span><br><span class="line">                username,</span><br><span class="line">                new BCryptPasswordEncoder().encode(password),</span><br><span class="line">                listUserGrantedAuthorities(user.getUserid()));</span><br><span class="line"></span><br><span class="line">        result.setDetails(authentication.getDetails());</span><br><span class="line">        logger.info(&quot;------&gt; auth database result :{} &lt;-------&quot;, JSONObject.toJSONString(result));</span><br><span class="line">        return result;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean supports(Class&lt;?&gt; authentication) {</span><br><span class="line">        return (DatabaseUserToken.class.isAssignableFrom(authentication));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private Set&lt;GrantedAuthority&gt; listUserGrantedAuthorities(String uid) {</span><br><span class="line">        Set&lt;GrantedAuthority&gt; authorities = new HashSet&lt;GrantedAuthority&gt;();</span><br><span class="line">        if (StringUtils.isEmpty(uid)) {</span><br><span class="line">            return authorities;</span><br><span class="line">        }</span><br><span class="line">        authorities.add(new SimpleGrantedAuthority(&quot;ROLE_USER&quot;));</span><br><span class="line">        return authorities;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="4-4-&#x9690;&#x85CF;&#x73AF;&#x8282;"><a href="#4-4-&#x9690;&#x85CF;&#x73AF;&#x8282;" class="headerlink" title="4.4 &#x9690;&#x85CF;&#x73AF;&#x8282;"></a>4.4 &#x9690;&#x85CF;&#x73AF;&#x8282;</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;// &#x5C06; Provider &#x6CE8;&#x5165;&#x4F53;&#x7CFB;</span><br><span class="line">auth.authenticationProvider(reflectionUtils.springClassLoad(item.getProvider()));</span><br><span class="line"></span><br><span class="line">// &#x5C06; Filter &#x6CE8;&#x5165;&#x4F53;&#x7CFB;</span><br><span class="line">AbstractAuthenticationProcessingFilter filter = reflectionUtils.classLoadReflect(item.getFilter());</span><br><span class="line">filter.setAuthenticationManager(authenticationManager);</span><br><span class="line">http.addFilterBefore(filter, UsernamePasswordAuthenticationFilter.class);</span><br></pre></td></tr></table></figure>

<p><strong>&#x4EE5;&#x4E0A;&#x7684;&#x6D41;&#x7A0B;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5DF2;&#x7ECF;&#x4E0D;&#x9700;&#x8981; &#x7EE7;&#x627F; UserService&#x7C7B;&#x4E86; . &#x91CD;&#x5199;&#x8FD9;&#x4E9B;&#x8DB3;&#x591F;&#x6211;&#x4EEC;&#x53BB;&#x5B9E;&#x73B0;&#x5927;&#x90E8;&#x5206;&#x4E1A;&#x52A1;&#x903B;&#x8F91; , &#x4F7F;&#x7528;&#x65F6;&#x5728;Provider &#x5B8C;&#x6210;&#x5BF9;&#x5E94;&#x7684;&#x8BA4;&#x8BC1;&#x65B9;&#x5F0F;&#x5373;&#x53EF;</strong></p>
<h2 id="&#x4E94;-&#x603B;&#x7ED3;"><a href="#&#x4E94;-&#x603B;&#x7ED3;" class="headerlink" title="&#x4E94; . &#x603B;&#x7ED3;"></a>&#x4E94; . &#x603B;&#x7ED3;</h2><p>Security &#x5F88;&#x597D;&#x7528;, &#x5728;&#x6211;&#x7684;&#x4E2A;&#x4EBA;&#x5B9E;&#x8DF5;&#x4E2D; , &#x6B63;&#x5728;&#x5C1D;&#x8BD5;&#x5C06;&#x5E38;&#x89C1;&#x7684;&#x534F;&#x8BAE;&#x8FDB;&#x884C;&#x6574;&#x5408; , &#x505A;&#x6210;&#x4E00;&#x4E2A;&#x5F00;&#x6E90;&#x811A;&#x624B;&#x67B6; , &#x4E2A;&#x4EBA;&#x611F;&#x89C9;SpringSecuity &#x4F53;&#x7CFB;&#x5E94;&#x8BE5;&#x53EF;&#x4EE5;&#x8F7B;&#x677E;&#x7684;&#x5B8C;&#x6210; .</p>
<p>&#x5F00;&#x7BC7;&#x6BD4;&#x8F83;&#x7B80;&#x5355; , &#x6B63;&#x5728;&#x6784;&#x601D;&#x600E;&#x6837;&#x624D;&#x80FD;&#x4ECE;&#x5B9E;&#x8DF5;&#x7684;&#x89D2;&#x5EA6;&#x5C06;&#x4ED6;&#x8BB2;&#x6E05;&#x695A; , &#x7B14;&#x8BB0;&#x4E5F;&#x5728;&#x9646;&#x9646;&#x7EED;&#x7EED;&#x6574;&#x7406; , &#x4E89;&#x53D6;&#x4E0B;&#x4E2A;&#x6708;&#x5C06;&#x6574;&#x5957;&#x6587;&#x7AE0;&#x53D1;&#x51FA;&#x6765; !</p>
<h2 id="&#x9644;&#x5F55;"><a href="#&#x9644;&#x5F55;" class="headerlink" title="&#x9644;&#x5F55;"></a>&#x9644;&#x5F55;</h2><blockquote>
<p><strong>HttpSecurity</strong> &#x5E38;&#x7528;&#x65B9;&#x6CD5;</p>
</blockquote>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/839f07cdf3c307af32fe3a235dcaeb71b6b626e4dc2cf1de564fb8b381b62c39" alt="image.png"></p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/c2ee2233b2f452a688a0ac460c80b97a.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6945435504905027598.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6945435504905027598.html" itemprop="url">盘点认证协议   普及篇之Kerberos</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-03-30T21:20:11+08:00">
                2021-03-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>&#x603B;&#x6587;&#x6863; :<a href="https://dev.newban.cn/6941642435189538824">&#x6587;&#x7AE0;&#x76EE;&#x5F55;</a>  </p>
<p>Github : <a href="/external_links/f4c0695dd8cd8371c2f2fc9edde11029.html" target="blank" rel="noopener">github.com/black-ant</a></p>
</blockquote>
<ul>
<li>&#x7EAF;&#x7EA6;&#x675F;&#x578B;&#x534F;&#x8BAE; : OAuth , SAML , OIDC , CAS ,LTPA</li>
<li>&#x670D;&#x52A1;&#x5668;&#x7C7B;&#x534F;&#x8BAE; : RADIUS , Kerberos , ADFS</li>
<li>&#x8BA4;&#x8BC1;&#x65B9;&#x5F0F;&#x7C7B; : OTP , &#x751F;&#x7269;&#x8BA4;&#x8BC1; (&#x4EBA;&#x8138; , &#x58F0;&#x7EB9; , &#x6307;&#x7EB9;)</li>
<li>&#x8BA4;&#x8BC1;&#x670D;&#x52A1;&#x5668;(&#x9644;&#x5E26;) : AD , LDAP , ADFS</li>
</ul>
<p><strong>&#x8FD9;&#x4E00;&#x7BC7;&#x6765;&#x804A;&#x4E00;&#x4E0B; Kerberos &#x534F;&#x8BAE; , &#x5DF2;&#x7ECF;&#x57FA;&#x4E8E;Kerberos&#x7684; AD &#x57DF;&#x5355;&#x70B9;</strong></p>
<h2 id="&#x4E00;-&#x524D;&#x8A00;"><a href="#&#x4E00;-&#x524D;&#x8A00;" class="headerlink" title="&#x4E00; . &#x524D;&#x8A00;"></a>&#x4E00; . &#x524D;&#x8A00;</h2><p>Kerberos &#x6700;&#x521D;&#x662F;&#x7531;&#x9EBB;&#x7701;&#x7406;&#x5DE5;&#x5B66;&#x9662;(MIT)&#x5F00;&#x53D1;&#x7684;&#xFF0C;&#x662F;&#x96C5;&#x5178;&#x5A1C;&#x8BA1;&#x5212;(projectathena)&#x7684;&#x4E00;&#x90E8;&#x5206; , Kerberos &#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x96C6;&#x4E2D;&#x7684;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x5176;&#x529F;&#x80FD;&#x662F;<strong>&#x5BF9;&#x7528;&#x6237;&#x5230;&#x670D;&#x52A1;&#x5668;&#x7684;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF0C;&#x4EE5;&#x53CA;&#x5BF9;&#x7528;&#x6237;&#x5230;&#x670D;&#x52A1;&#x5668;&#x7684;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;</strong>&#x3002;&#x5728; Kerberos &#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x4E2D;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x548C;&#x6570;&#x636E;&#x5E93;&#x7528;&#x4E8E;&#x5BA2;&#x6237;&#x7AEF;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x3002;<strong>Kerberos &#x4F5C;&#x4E3A;&#x7B2C;&#x4E09;&#x65B9;&#x53D7;&#x4FE1;&#x4EFB;&#x670D;&#x52A1;&#x5668;(&#x79F0;&#x4E3A;&#x5BC6;&#x94A5;&#x5206;&#x53D1;&#x4E2D;&#x5FC3;(KDC))&#x8FD0;&#x884C;</strong>&#x3002;&#x7F51;&#x7EDC;&#x4E0A;&#x7684;&#x6BCF;&#x4E2A;&#x7528;&#x6237;&#x548C;&#x670D;&#x52A1;&#x90FD;&#x662F;&#x4E00;&#x4E2A;&#x4E3B;&#x4F53;&#x3002;</p>
<blockquote>
<p><strong>Kerberos &#x4F18;&#x70B9;</strong></p>
</blockquote>
<ol>
<li>&#x5BC6;&#x7801;&#x4ECE;&#x4E0D;&#x901A;&#x8FC7;&#x7F51;&#x7EDC;&#x53D1;&#x9001;&#xFF0C;&#x56E0;&#x4E3A;&#x53EA;&#x6709;&#x5BC6;&#x94A5;&#x4EE5;&#x52A0;&#x5BC6;&#x5F62;&#x5F0F;&#x53D1;&#x9001;;</li>
<li>&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x662F;&#x76F8;&#x4E92;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x5668;&#x5728;&#x76F8;&#x540C;&#x7684;&#x6B65;&#x9AA4;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF0C;&#x5E76;&#x4E14;&#x5B83;&#x4EEC;&#x90FD;&#x786E;&#x4FE1;&#x81EA;&#x5DF1;&#x6B63;&#x5728;&#x4E0E;&#x6B63;&#x786E;&#x7684;&#x5BF9;&#x5E94;&#x65B9;&#x8FDB;&#x884C;&#x901A;&#x4FE1;;</li>
<li>&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x53EF;&#x91CD;&#x7528;&#x4E14;&#x4E0D;&#x4F1A;&#x8FC7;&#x671F;;</li>
<li>Kerberos &#x5B8C;&#x5168;&#x57FA;&#x4E8E;&#x5F00;&#x653E;&#x7684;&#x4E92;&#x8054;&#x7F51;&#x6807;&#x51C6;</li>
<li>Kerberos &#x88AB;&#x8BB8;&#x591A;&#x884C;&#x4E1A;&#x91C7;&#x7528;&#xFF0C;&#x56E0;&#x6B64;&#x5176;&#x5B89;&#x5168;&#x534F;&#x8BAE;&#x6216;&#x5E95;&#x5C42;&#x6A21;&#x5757;&#x4E2D;&#x7684;&#x4EFB;&#x4F55;&#x65B0;&#x7F3A;&#x9677;&#x90FD;&#x4F1A;&#x5F88;&#x5FEB;&#x5F97;&#x5230;&#x7EA0;&#x6B63;</li>
</ol>
<blockquote>
<p><strong>Kerberos &#x7F3A;&#x70B9;</strong></p>
</blockquote>
<ol>
<li>&#x5982;&#x679C;&#x672A;&#x7ECF;&#x6388;&#x6743;&#x7684;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x5BC6;&#x94A5;&#x5206;&#x53D1;&#x4E2D;&#x5FC3;&#xFF0C;&#x5219;&#x6574;&#x4E2A;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x7CFB;&#x7EDF;&#x5C06;&#x53D7;&#x5230;&#x5A01;&#x80C1;</li>
<li>Kerberos &#x53EA;&#x80FD;&#x88AB;&#x652F;&#x6301; Kerberos &#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x91C7;&#x7528;&#x3002;&#x4E3A;&#x4E86;&#x8BA9;&#x67D0;&#x4E9B;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x80FD;&#x591F;&#x8BC6;&#x522B; Kerberos&#xFF0C;&#x91CD;&#x5199;&#x8FD9;&#x4E9B;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x4EE3;&#x7801;&#x53EF;&#x80FD;&#x662F;&#x4E2A;&#x95EE;&#x9898;</li>
</ol>
<blockquote>
<p><strong>Kerberos &#x5173;&#x952E;&#x8BCD;</strong></p>
</blockquote>
<ul>
<li>&#x5B89;&#x5168;&#x8BA4;&#x8BC1;&#x534F;&#x8BAE;</li>
<li>tickets &#x9A8C;&#x8BC1;</li>
<li>&#x5BC6;&#x7801;&#x4FDD;&#x62A4;&#xFF08;&#x672C;&#x5730; &#x4E0D;&#x4FDD;&#x5B58;&#xFF0C;&#x94FE;&#x8DEF;&#x4E0D;&#x4F20;&#x8F93; &#xFF09;</li>
<li>&#x5BF9;&#x79F0;&#x52A0;&#x5BC6;</li>
<li>Server - client &#x53EF;&#x4EE5;&#x76F8;&#x4E92;&#x9A8C;&#x8BC1;</li>
<li>&#x6709;&#x53EF;&#x4FE1;&#x7B2C;&#x4E09;&#x65B9;</li>
</ul>
<h2 id="&#x4E8C;-Kerberos-&#x57FA;&#x7840;&#x8981;&#x70B9;"><a href="#&#x4E8C;-Kerberos-&#x57FA;&#x7840;&#x8981;&#x70B9;" class="headerlink" title="&#x4E8C; . Kerberos &#x57FA;&#x7840;&#x8981;&#x70B9;"></a>&#x4E8C; . Kerberos &#x57FA;&#x7840;&#x8981;&#x70B9;</h2><h3 id="2-1-Kerberos-&#x6210;&#x5458;"><a href="#2-1-Kerberos-&#x6210;&#x5458;" class="headerlink" title="2.1 Kerberos &#x6210;&#x5458;"></a>2.1 Kerberos &#x6210;&#x5458;</h3><blockquote>
<p><strong>&#x8BA4;&#x8BC1;&#x4F53;&#x7CFB;&#x6210;&#x5458;</strong></p>
</blockquote>
<ul>
<li>Client &#x6210;&#x5458;</li>
<li>&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x670D;&#x52A1;&#x5668; (AP , ApplicationServer , Resource)</li>
<li>&#x5BC6;&#x94A5;&#x5206;&#x914D;&#x4E2D;&#x5FC3; (KDC) : <strong>AS + TGS + DB</strong><ul>
<li>&#x53D1;&#x7968;&#x7684;&#x53EF;&#x4FE1;&#x7B2C;&#x4E09;&#x65B9;&#x3002;&#x5728;&#x6D3B;&#x52A8;&#x76EE;&#x5F55;&#x4E2D;&#xFF0C;&#x6BCF;&#x4E2A;&#x7F51;&#x57DF;&#x63A7;&#x5236;&#x5668;&#x90FD;&#x5145;&#x5F53;&#x4E00;&#x4E2A; KDC&#x3002;</li>
<li>KDC &#x63D0;&#x4F9B;&#x4E24;&#x4E2A;&#x6838;&#x5FC3;&#x670D;&#x52A1;:<ul>
<li>&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x670D;&#x52A1;(AS)&#x5BF9;&#x5BA2;&#x6237;&#x673A;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x5E76;&#x5411;&#x5176;&#x53D1;&#x51FA;&#x7968;&#x8BC1;;</li>
<li>&#x7968;&#x8BC1;&#x6388;&#x4E88;&#x670D;&#x52A1;(TGS)&#x63A5;&#x53D7;&#x7ECF;&#x8FC7;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x7684;&#x5BA2;&#x6237;&#x673A;&#x5E76;&#x5411;&#x5176;&#x53D1;&#x51FA;&#x7968;&#x8BC1;&#x4EE5;&#x8BBF;&#x95EE;&#x5176;&#x4ED6;&#x8D44;&#x6E90;</li>
</ul>
</li>
<li>KDC &#x5B58;&#x5728;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x4E2D;&#x5FC3; (Database , db)</li>
</ul>
</li>
</ul>
<h3 id="2-2-Kerberos-&#x67B6;&#x6784;"><a href="#2-2-Kerberos-&#x67B6;&#x6784;" class="headerlink" title="2.2 Kerberos &#x67B6;&#x6784;"></a>2.2 Kerberos &#x67B6;&#x6784;</h3><blockquote>
<p>&#x67B6;&#x6784;&#x7279;&#x70B9; :</p>
</blockquote>
<ul>
<li>&#x6D88;&#x606F; = &#x53EF;&#x89E3;&#x7801;&#x90E8;&#x5206; + &#x4E0D;&#x53EF;&#x89E3;&#x7801;&#x90E8;&#x5206;</li>
<li>&#x670D;&#x52A1;&#x7AEF; &#x4E0D;&#x4E0E; KDC &#x76F4;&#x63A5;&#x4EA4;&#x6D41;</li>
<li>KDC &#x4E2D;&#x62E5;&#x6709; &#x6240;&#x6709;&#x7528;&#x6237;&#x53CA;&#x5BC6;&#x7801;</li>
</ul>
<blockquote>
<p>&#x6D89;&#x53CA;&#x6982;&#x5FF5; :</p>
</blockquote>
<ul>
<li>principal : &#x8BA4;&#x8BC1;&#x4E3B;&#x4F53; &#xFF0C; &#x7C7B;&#x4F3C;&#x4E8E;&#x7528;&#x6237;&#x540D;</li>
<li>realm : &#x4F5C;&#x7528;&#x57DF; &#xFF0C;&#x4E00;&#x4E2A; principal &#x53EA;&#x5728; &#x6307;&#x5B9A;&#x7684; realm &#x4E2D;&#x8D77;&#x4F5C;&#x7528;</li>
<li>password : &#x7528;&#x6237;&#x5BC6;&#x7801; &#xFF0C;&#x5BF9;&#x5E94; &#x4E8E; kerberos &#x4E2D;&#x7684; master_key &#xFF0C;&#x53EF;&#x5B58;&#x5728;&#x4E8E; keytab&#x6587;&#x4EF6;&#x4E2D;</li>
<li>credential &#xFF1A; &#x51ED;&#x8BC1; &#xFF0C;&#x7528;&#x4E8E;&#x8BC1;&#x660E;&#x7528;&#x6237; / &#x884C;&#x4E3A;&#x7684;&#x6709;&#x6548;&#x6027; &#xFF08;password / ticket&#xFF09;</li>
<li>Long-term Key/Master Key &#xFF1A;&#x957F;&#x671F;&#x4E0D;&#x53D8;&#x7684; key , &#x4ED6;&#x7684;&#x539F;&#x5219;&#x662F; &#x4E0D;&#x80FD;&#x5728;&#x7F51;&#x7EDC;&#x4E0A;&#x4F20;&#x8F93;</li>
<li>Short-term Key/Session Key &#xFF1A; &#x53EF;&#x5728;&#x7F51;&#x7EDC;&#x4E0A;&#x8FDB;&#x884C;&#x4F20;&#x8F93;&#x7684;key , &#x8FD9;&#x79CD; key &#x6709;&#x65F6;&#x6548;&#x6027;</li>
</ul>
<blockquote>
<p>TGT &#x548C; TGS &#x7684;&#x533A;&#x522B;</p>
</blockquote>
<ul>
<li><strong>TGT KDC &#x52A0;&#x5BC6;&#x90E8;&#x5206;&#xFF08;&#x4E0D;&#x53EF;&#x89E3;&#x8BFB;&#xFF09;</strong> &#xFF1A; name/ID + TGS&#x7684; name /ID + &#x65F6;&#x95F4;&#x6233; + IP &#x5730;&#x5740; + TGT &#x751F;&#x547D;&#x5468;&#x671F; + TGS session key</li>
<li><strong>TGT &#x4E2A;&#x4EBA;&#x52A0;&#x5BC6;&#x90E8;&#x5206;&#xFF08;&#x53EF;&#x89E3;&#x8BFB;&#xFF09;</strong> &#xFF1A;TGS &#x7684; name / ID + &#x65F6;&#x95F4;&#x9519; + &#x751F;&#x547D;&#x5468;&#x671F; + TGS session key</li>
</ul>
<h3 id="2-3-Kerberos-&#x8BF7;&#x6C42;&#x6D41;&#x7A0B;"><a href="#2-3-Kerberos-&#x8BF7;&#x6C42;&#x6D41;&#x7A0B;" class="headerlink" title="2.3 Kerberos &#x8BF7;&#x6C42;&#x6D41;&#x7A0B;"></a>2.3 Kerberos &#x8BF7;&#x6C42;&#x6D41;&#x7A0B;</h3><p><strong>Kerberos &#x534F;&#x8BAE;&#x8FC7;&#x7A0B;&#x4E3B;&#x8981;&#x6709;&#x4E24;&#x4E2A;&#x9636;&#x6BB5;&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;&#x9636;&#x6BB5;&#x662F; KDC &#x5BF9; Client &#x8EAB;&#x4EFD;&#x8BA4;&#x8BC1;&#xFF0C;&#x7B2C;&#x4E8C;&#x4E2A;&#x9636;&#x6BB5;&#x662F;Service&#x5BF9;Client&#x8EAB;&#x4EFD;&#x8BA4;&#x8BC1;&#x3002;</strong></p>
<ul>
<li>&#x7B2C;&#x4E00;&#x6B21; &#xFF1A; &#x5BA2;&#x6237;&#x7AEF;&#x8F93;&#x5165;&#x767B;&#x5F55;&#x4FE1;&#x606F; , Kerberos &#x5BA2;&#x6237;&#x673A;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x52A0;&#x5BC6;&#x5BC6;&#x94A5;&#x5E76;&#x5411;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x670D;&#x52A1;&#x5668;(AS)&#x53D1;&#x9001;&#x4E00;&#x6761;&#x6D88;&#x606F;</li>
<li>&#x7B2C;&#x4E8C;&#x6B21; &#xFF1A; AS &#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x5BC6;&#x94A5;&#x521B;&#x5EFA;&#x4E34;&#x65F6;&#x4F1A;&#x8BDD;&#x5BC6;&#x94A5;&#xFF0C;&#x5E76;&#x5411;&#x7968;&#x636E;&#x6388;&#x4E88;&#x670D;&#x52A1;(TGS)&#x53D1;&#x9001;&#x6D88;&#x606F;</li>
<li>&#x7B2C;&#x4E09;&#x6B21; &#xFF1A; TGS &#x5411;&#x5BA2;&#x6237;&#x673A;&#x6388;&#x4E88;&#x7968;&#x636E;&#x548C;&#x670D;&#x52A1;&#x5668;&#x4F1A;&#x8BDD;&#x5BC6;&#x94A5; , &#x5BA2;&#x6237;&#x7AEF;&#x4F7F;&#x7528;&#x8FD9;&#x4E9B;&#x6765;&#x4E0E;&#x670D;&#x52A1;&#x5668;&#x8FDB;&#x884C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x5E76;&#x83B7;&#x5F97;&#x8BBF;&#x95EE;&#x6743;</li>
</ul>
<blockquote>
<p>&#x4EE5;&#x4E0B;&#x662F; Kerberos &#x8BBF;&#x95EE;&#x8BE6;&#x60C5; :</p>
</blockquote>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/72230d31dada7d2582f9d56b7296a59dc6d6425a6c29cbd108a723626ec1aeda" alt="kdc001.jpg"></p>
<ol>
<li><strong>KRB_AS_REQ: &#x4ECE;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x670D;&#x52A1;(AS)&#x8BF7;&#x6C42;TGT</strong><ul>
<li>&#x5BA2;&#x6237;&#x673A;&#x7684;&#x8BF7;&#x6C42;&#x5305;&#x62EC;&#x7528;&#x6237;&#x7684;&#x7528;&#x6237;&#x4E3B;&#x4F53;&#x540D;(UPN)&#x548C;&#x65F6;&#x95F4;&#x6233;&#x3002;&#x5B83;&#x4F7F;&#x7528;&#x7528;&#x6237;&#x7684;&#x5BC6;&#x7801;&#x6563;&#x5217;&#x8FDB;&#x884C;&#x52A0;&#x5BC6;</li>
</ul>
</li>
<li><strong>KRB_AS_REP : &#x4ECE;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x670D;&#x52A1;&#x63A5;&#x6536;TGT</strong><ul>
<li>KDC &#x4F7F;&#x7528; UPN &#x5728;&#x5176;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x67E5;&#x627E;&#x5BA2;&#x6237;&#x673A;&#xFF0C;&#x5E76;&#x4F7F;&#x7528;&#x7528;&#x6237;&#x7684;&#x5BC6;&#x7801; hashto &#x5C1D;&#x8BD5;&#x89E3;&#x5BC6;&#x6D88;&#x606F;</li>
<li>&#x5982;&#x679C; KDC &#x6210;&#x529F;&#x5730;&#x89E3;&#x5BC6; TGT &#x8BF7;&#x6C42;&#xFF0C;&#x5E76;&#x4E14;&#x65F6;&#x95F4;&#x6233;&#x4F4D;&#x4E8E; KDC &#x914D;&#x7F6E;&#x7684;&#x65F6;&#x95F4;&#x504F;&#x5DEE;&#x5185;&#xFF0C;&#x5219;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x6210;&#x529F;</li>
<li>&#x8EAB;&#x4EFD;&#x8BA4;&#x8BC1;&#x6210;&#x529F;&#x540E; , KDC&#x5C06;TGT &#x548C; <em>TGS&#x4F1A;&#x8BDD;&#x5BC6;&#x94A5;</em>&#x88AB;&#x53D1;&#x9001;&#x56DE;&#x5BA2;&#x6237;&#x7AEF;&#x3002;TGS &#x4F1A;&#x8BDD;&#x5BC6;&#x94A5;&#x7528;&#x4E8E;&#x52A0;&#x5BC6;&#x540E;&#x7EED;&#x8BF7;&#x6C42;</li>
</ul>
</li>
<li><strong>KRB_TGS_REQ : &#x53D1;&#x9001;&#x5F53;&#x524D;&#x7684; TGT &#x5E76;&#x8BF7;&#x6C42;TGS</strong><ul>
<li>&#x5BA2;&#x6237;&#x673A;&#x663E;&#x793A;&#x5B83;&#x7684; TGT &#x4EE5;&#x53CA;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#xFF0C;&#x5305;&#x62EC;&#x5B83;&#x60F3;&#x8981;&#x8BBF;&#x95EE;&#x7684;&#x670D;&#x52A1;&#x7684;&#x670D;&#x52A1;&#x4E3B;&#x4F53;&#x540D;&#x79F0;(Service Principal Name&#xFF0C;SPN)</li>
<li>TGS &#x8BF7;&#x6C42;&#x4F7F;&#x7528;TGS&#x4F1A;&#x8BDD;&#x5BC6;&#x94A5;&#x8FDB;&#x884C;&#x52A0;&#x5BC6;</li>
</ul>
</li>
<li><strong>KRB_TGS_REP : &#x4ECE; KDC &#x63A5;&#x6536; TGS</strong><ul>
<li>KDC &#x9A8C;&#x8BC1; TGT&#xFF0C;&#x5982;&#x679C;&#x6210;&#x529F;&#xFF0C;&#x5219;&#x751F;&#x6210; TGS&#x3002;TGS &#x5305;&#x542B;&#x6709;&#x5173;&#x8BF7;&#x6C42;&#x8005;&#x7684;&#x4FE1;&#x606F;(&#x5982;&#x8BF7;&#x6C42;&#x8005;&#x7684; SID &#x548C;&#x7EC4;&#x6210;&#x5458;&#x8EAB;&#x4EFD;) &#xFF0C;&#x5E76;&#x4F7F;&#x7528;&#x670D;&#x52A1;&#x7684;&#x5BC6;&#x7801;&#x6563;&#x5217;&#x8FDB;&#x884C;&#x52A0;&#x5BC6;</li>
<li>TGS &#x548C;&#x670D;&#x52A1;&#x4F1A;&#x8BDD;&#x5BC6;&#x94A5;&#x4F7F;&#x7528; TGS &#x4F1A;&#x8BDD;&#x5BC6;&#x94A5;&#x52A0;&#x5BC6;&#xFF0C;&#x7136;&#x540E;&#x53D1;&#x9001;&#x56DE;&#x5BA2;&#x6237;&#x673A;</li>
</ul>
</li>
<li><strong>KRB_TGS_REP : &#x5C06; TGS &#x63D0;&#x4EA4;&#x7ED9;&#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;&#x8FDB;&#x884C;&#x6388;&#x6743;</strong><ul>
<li>&#x5BA2;&#x6237;&#x673A;&#x5C06;&#x4ECE; KDC &#x63A5;&#x6536;&#x7684; TGS &#x8FDE;&#x540C;&#x9A8C;&#x8BC1;&#x8005;&#x6D88;&#x606F;&#x4E00;&#x8D77;&#x53D1;&#x9001;&#x5230;&#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x9A8C;&#x8BC1;&#x8005;&#x6D88;&#x606F;&#x4F7F;&#x7528;&#x670D;&#x52A1;&#x4F1A;&#x8BDD;&#x5BC6;&#x94A5;&#x8FDB;&#x884C;&#x52A0;&#x5BC6; (App &#x6B64;&#x65F6;&#x4F1A;&#x62FF;&#x7740; TGS &#x53BB; KDC &#x8BA4;&#x8BC1;)</li>
</ul>
</li>
<li><strong>KRB_AP_REP : &#x6388;&#x4E88;&#x5BA2;&#x6237;&#x7AEF;&#x8BBF;&#x95EE;&#x670D;&#x52A1;&#x7684;&#x6743;&#x9650;</strong><ul>
<li>&#x5BA2;&#x6237;&#x7AEF;&#x63A5;&#x6536;&#x6D88;&#x606F;&#x5E76;&#x7528;&#x670D;&#x52A1;&#x4F1A;&#x8BDD;&#x5BC6;&#x94A5;&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x89E3;&#x5BC6;</li>
<li>&#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;&#x4ECE;&#x670D;&#x52A1;&#x7968;&#x636E;&#x4E2D;&#x63D0;&#x53D6;&#x7279;&#x6743;&#x5C5E;&#x6027;&#x8BC1;&#x4E66;(PAC) &#xFF0C;&#x7528;&#x7F51;&#x57DF;&#x63A7;&#x5236;&#x5668;&#x9A8C;&#x8BC1;&#x5176;&#x5185;&#x5BB9;</li>
<li>&#x4EC5;&#x5F53;&#x7968;&#x636E;&#x6388;&#x4E88;&#x7968;&#x636E;(TGT)&#x8D85;&#x8FC7;20&#x5206;&#x949F;&#x65F6;&#xFF0C;&#x624D;&#x4F1A;&#x9A8C;&#x8BC1;&#x7968;&#x636E;/PAC</li>
</ul>
</li>
</ol>
<h3 id="2-5-KDC-&#x6D41;&#x7A0B;&#x8BE6;&#x60C5;"><a href="#2-5-KDC-&#x6D41;&#x7A0B;&#x8BE6;&#x60C5;" class="headerlink" title="2.5 KDC &#x6D41;&#x7A0B;&#x8BE6;&#x60C5;"></a>2.5 KDC &#x6D41;&#x7A0B;&#x8BE6;&#x60C5;</h3><blockquote>
<p>&#x57FA;&#x7840;&#x6210;&#x5458;&#x3000;&#xFF1A;</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;-&#x300B; &#x7EC4;&#x6210;&#x89D2;&#x8272;</span><br><span class="line">  &gt; KDC : key distributed center &#x5BC6;&#x94A5;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3; , &#x6574;&#x4E2A;&#x5B89;&#x5168;&#x8BA4;&#x8BC1;&#x8FC7;&#x7A0B;&#x7684;&#x7968;&#x636E;&#x751F;&#x6210;&#x7BA1;&#x7406;&#x670D;&#x52A1; , &#x5305;&#x542B; AS &#x548C; TGS</span><br><span class="line">  &gt; AD &#xFF1A;account database &#xFF0C;&#x5B58;&#x50A8;&#x6240;&#x6709;client&#x7684;&#x767D;&#x540D;&#x5355;</span><br><span class="line"></span><br><span class="line">-&#x300B; &#x4E3B;&#x8981;&#x89D2;&#x8272;</span><br><span class="line">  &gt; C : Client </span><br><span class="line">  &gt; AS :  Authentication Server &#x8BA4;&#x8BC1;&#x670D;&#x52A1;&#x5668; &#xFF0C;&#x5B8C;&#x6210;&#x7528;&#x6237;&#x8BA4;&#x8BC1;</span><br><span class="line">  &gt; TGS : Ticket Granting Server &#x51ED;&#x8BC1;&#x670D;&#x52A1;&#x5668; </span><br><span class="line">  &gt; ST : Http Service Ticket</span><br><span class="line">  &gt; SS : Service Server</span><br><span class="line">  &gt; RS : Resource server</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>Step 1 : KRB_AS_REQ &#x7B2C;&#x4E00;&#x6B21; &#x7533;&#x8BF7; TGT</strong></p>
</blockquote>
<ul>
<li><strong>&#x8BF7;&#x6C42; C-&gt;SS</strong> : &#x901A;&#x8FC7; &#x660E;&#x6587;&#xFF08;Name/&#x8EAB;&#x4EFD;&#x4FE1;&#x606F; , IP/client &#x6D88;&#x606F; , TGT &#x6709;&#x6548;&#x65F6;&#x95F4; &#xFF09;&#x8BBF;&#x95EE; &#xFF08;&#x4EA6;&#x53EF;&#x4F7F;&#x7528; Master key &#x8FDB;&#x884C;&#x52A0;&#x5BC6; &#xFF0C;AD &#x4E2D;&#x4FDD;&#x5B58;&#x6709; Master key&#xFF09;</li>
<li><strong>&#x5904;&#x7406; IN SS</strong> : SS &#x5224;&#x65AD; &#x8BE5; &#x5BF9;&#x8C61; &#x662F;&#x5426; &#x5728; AD &#x4E2D;&#x5B58;&#x5728; , &#x5E76;&#x4E14; &#x4EA7;&#x751F; Session Key &#x7528;&#x4E8E; TGS &#x4E4B;&#x95F4;&#x901A;&#x4FE1;</li>
<li><strong>&#x8FD4;&#x56DE; SS-&gt;C</strong>:&#x8FD4;&#x8FD8;TGT (TGT &#x670D;&#x52A1;&#x7AEF;&#x90E8;&#x5206; + TGT &#x4E2A;&#x4EBA;&#x90E8;&#x5206;)</li>
</ul>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/a36c408d9a1d13f027cc9be97369e7b5cc89f4f59c61fe3413cc7100482a7cc0" alt="image.png"></p>
<blockquote>
<p><strong>Step 2 : KRB_TGS_REQ &#x7B2C;&#x4E8C;&#x6B21;&#x751F;&#x6210; TGS</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">JAVA&#x590D;&#x5236;&#x4EE3;&#x7801;&gt; &#x8BF7;&#x6C42; C -&gt; TGS :  </span><br><span class="line">  -&gt; TGS Session key &#x52A0;&#x5BC6;&#x90E8;&#x5206;&#xFF08;Name/ID + &#x65F6;&#x95F4;&#x6233; + client Info&#xFF09;&#xFF0C;&#x660E;&#x6587; &#xFF08;&#x670D;&#x52A1;Name/ID+&#x751F;&#x547D;&#x5468;&#x671F;&#xFF09;&#xFF0C;TGT </span><br><span class="line">  </span><br><span class="line">&gt; &#x5904;&#x7406; IN TGS  &#xFF08;&#x5BF9;TGT &#x7B2C;&#x4E00;&#x90E8;&#x5206;&#x89E3;&#x5BC6; &#xFF09;:  </span><br><span class="line">  -&gt; 1. &#x7528;&#x6237;&#x540D;&#x5BF9;&#x6BD4; &#xFF08;TGT &lt;-&gt; &#x8BA4;&#x8BC1;&#x5668;&#xFF09;</span><br><span class="line">  -&gt; 2. &#x65F6;&#x95F4;&#x6233;&#x5BF9;&#x6BD4;</span><br><span class="line">  -&gt; 3. &#x662F;&#x5426;&#x8FC7;&#x671F;</span><br><span class="line">  -&gt; 4. IP&#x662F;&#x5426;&#x4E00;&#x81F4;</span><br><span class="line">  -&gt; 5. &#x8BA4;&#x8BC1;&#x5668;&#x662F;&#x5426;&#x5DF2;&#x5B58;&#x5728;&#x4E8E;&#x7F13;&#x5B58; </span><br><span class="line">  -&gt; 6. &#x6DFB;&#x52A0;&#x6743;&#x9650;&#x548C;&#x8BA4;&#x8BC1;&#x670D;&#x52A1;  </span><br><span class="line">  -&gt; 7. &#x4EA7;&#x751F; Http Service Session Key</span><br><span class="line">  -&gt; 8. &#x51C6;&#x5907; ST</span><br><span class="line">  </span><br><span class="line">&gt; &#x8FD4;&#x56DE;  TGS -&gt; C: </span><br><span class="line">  -&gt; ST  ( Http &#x670D;&#x52A1;&#x5BC6;&#x7801; &#x8FDB;&#x884C;&#x52A0;&#x5BC6; ) = &#x4E2A;&#x4EBA;name/id + Http &#x670D;&#x52A1;name /id + IP + &#x65F6;&#x95F4;&#x6233; + ST &#x751F;&#x547D;&#x5468;&#x671F; + Http Service Session Key</span><br><span class="line">  -&gt; TGS Session Key &#x52A0;&#x5BC6;&#x90E8;&#x5206; = Http &#x670D;&#x52A1;name /id + &#x65F6;&#x95F4;&#x6233; + ST &#x751F;&#x547D;&#x5468;&#x671F; + Http Service Session Key</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/f26604a0e1176a8b86efe29591d7bdcf9fbe5e23d13938be1749174fd002a4b7" alt="image.png"></p>
<blockquote>
<p><strong>Step 3 : &#x8D44;&#x6E90;&#x670D;&#x52A1;&#x5668;&#x5904;&#x7406;</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;&gt; &#x8BF7;&#x6C42; C -&gt; RS : </span><br><span class="line">   -&gt; Http Service Session Key&#x52A0;&#x5BC6;&#x90E8;&#x5206; : &#x4E2A;&#x4EBA; name / ID + &#x65F6;&#x95F4;&#x6233;</span><br><span class="line">   </span><br><span class="line">&gt; Resource &#x670D;&#x52A1;&#x5668; &#x4E2D; &#xFF1A;</span><br><span class="line">   -&gt; 1. &#x5BF9;&#x6BD4;&#x7528;&#x6237;&#x540D;</span><br><span class="line">   -&gt; 2. &#x6BD4;&#x8F83;&#x65F6;&#x95F4;&#x6233;</span><br><span class="line">   -&gt; 3. &#x68C0;&#x67E5;&#x662F;&#x5426;&#x8FC7;&#x671F;</span><br><span class="line">   -&gt; 4. &#x68C0;&#x67E5;IP&#x5730;&#x5740;</span><br><span class="line">   -&gt; 5. &#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x4E8E;&#x7F13;&#x5B58;</span><br></pre></td></tr></table></figure>

<h3 id="2-5-KDC-&#x7684;&#x4F7F;&#x7528;&#x524D;&#x63D0;"><a href="#2-5-KDC-&#x7684;&#x4F7F;&#x7528;&#x524D;&#x63D0;" class="headerlink" title="2.5 KDC &#x7684;&#x4F7F;&#x7528;&#x524D;&#x63D0;"></a>2.5 KDC &#x7684;&#x4F7F;&#x7528;&#x524D;&#x63D0;</h3><ol>
<li><strong>&#x57DF;&#x63A7;&#x5236;&#x5668;&#x4E4B;&#x95F4;&#x7684;&#x590D;&#x5236; :</strong>   </li>
</ol>
<pre><code>* &#x5982;&#x679C;&#x90E8;&#x7F72;&#x4E86;&#x591A;&#x4E2A;&#x57DF;&#x63A7;&#x5236;&#x5668;(&#x5373;&#x591A;&#x4E2A; KDC) &#xFF0C;&#x5219;&#x5FC5;&#x987B;&#x542F;&#x7528;&#x590D;&#x5236;&#x5E76;&#x53CA;&#x65F6;&#x56DE;&#x6536;&#x3002;
* &#x5982;&#x679C;&#x590D;&#x5236;&#x5931;&#x8D25;&#x6216;&#x56DE;&#x6536;&#x88AB;&#x5EF6;&#x8FDF;&#xFF0C;&#x5F53;&#x7528;&#x6237;&#x66F4;&#x6539;&#x5BC6;&#x7801;&#x65F6;&#xFF0C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x53EF;&#x80FD;</code></pre><ol start="2">
<li><strong>&#x5BA2;&#x6237;&#x7AEF;&#x548C; kdc &#x5FC5;&#x987B;&#x5C06;&#x4ED6;&#x4EEC;&#x7684;&#x65F6;&#x949F;&#x540C;&#x6B65;</strong>  </li>
</ol>
<pre><code>* &#x5728; Kerberos &#x4E2D;&#xFF0C;&#x65F6;&#x95F4;&#x7684;&#x51C6;&#x786E;&#x5EA6;&#x91CF;&#x5BF9;&#x4E8E;&#x9632;&#x6B62;&#x91CD;&#x653E;&#x653B;&#x51FB;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x3002;
* Kerberos &#x652F;&#x6301;&#x53EF;&#x914D;&#x7F6E;&#x7684;&#x65F6;&#x95F4;&#x504F;&#x79FB;(&#x9ED8;&#x8BA4;5&#x5206;&#x949F;) &#xFF0C;&#x8D85;&#x8FC7;&#x8FD9;&#x4E2A;&#x65F6;&#x95F4;&#xFF0C;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x5C06;&#x5931;&#x8D25;</code></pre><ol start="3">
<li><strong>&#x5BA2;&#x6237;&#x7AEF;&#x548C; kdc &#x5FC5;&#x987B;&#x80FD;&#x591F;&#x5728;&#x7F51;&#x7EDC;&#x4E0A;&#x8FDB;&#x884C;&#x901A;&#x4FE1;</strong>  </li>
</ol>
<pre><code>* Kerberos &#x6D41;&#x91CF;&#x53D1;&#x751F;&#x5728; TCP &#x548C; UDP &#x7AEF;&#x53E3;88&#x4E0A;&#xFF0C;&#x6240;&#x6709;&#x5BA2;&#x6237;&#x7AEF;&#x90FD;&#x5FC5;&#x987B;&#x80FD;&#x591F;&#x8BBF;&#x95EE;&#x81F3;&#x5C11;&#x4E00;&#x4E2A; KDC (&#x7F51;&#x57DF;&#x63A7;&#x5236;&#x5668;)</code></pre><ol start="4">
<li><strong>&#x5BA2;&#x6237;&#x7AEF;&#x3001;&#x7528;&#x6237;&#x548C;&#x670D;&#x52A1;&#x5FC5;&#x987B;&#x5177;&#x6709;&#x552F;&#x4E00;&#x7684;&#x540D;&#x79F0;</strong></li>
</ol>
<pre><code>* &#x8BA1;&#x7B97;&#x673A;&#x3001;&#x7528;&#x6237;&#x6216;&#x670D;&#x52A1;&#x4E3B;&#x4F53;&#x540D;&#x79F0;&#x7684;&#x91CD;&#x590D;&#x540D;&#x79F0;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x5931;&#x8D25;</code></pre><ol start="5">
<li><strong>&#x5BA2;&#x6237;&#x7AEF;&#x548C; kdc &#x5FC5;&#x987B;&#x4F7F;&#x7528; NETBIOS &#x548C; DNS &#x540D;&#x79F0;&#x89E3;&#x6790;</strong></li>
</ol>
<pre><code>* &#x5BA2;&#x6237;&#x7AEF;&#x548C; kdc &#x5FC5;&#x987B;&#x4F7F;&#x7528; NETBIOS &#x548C; DNS &#x540D;&#x79F0;&#x89E3;&#x6790;
* Kerberos &#x670D;&#x52A1;&#x4E3B;&#x4F53;&#x540D;&#x79F0;&#x901A;&#x5E38;&#x5305;&#x62EC; NETBIOS &#x548C; DNS &#x5730;&#x5740;&#xFF0C;&#x8FD9;&#x610F;&#x5473;&#x7740; KDC &#x548C; Client &#x5FC5;&#x987B;&#x80FD;&#x591F;&#x4EE5;&#x76F8;&#x540C;&#x7684;&#x65B9;&#x5F0F;&#x89E3;&#x6790;&#x8FD9;&#x4E9B;&#x540D;&#x79F0;
* &#x67D0;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B; , IP &#x5730;&#x5740;&#x4E5F;&#x53EF;&#x7528;&#x4E8E;&#x670D;&#x52A1;&#x4E3B;&#x4F53;&#x540D;&#x79F0;</code></pre><h2 id="&#x4E09;-Kerberos-AD&#x57DF;&#x914D;&#x7F6E;"><a href="#&#x4E09;-Kerberos-AD&#x57DF;&#x914D;&#x7F6E;" class="headerlink" title="&#x4E09; . Kerberos AD&#x57DF;&#x914D;&#x7F6E;"></a>&#x4E09; . Kerberos AD&#x57DF;&#x914D;&#x7F6E;</h2><h3 id="3-1-&#x914D;&#x7F6E;-KDC-DB-&#x90E8;&#x5206;"><a href="#3-1-&#x914D;&#x7F6E;-KDC-DB-&#x90E8;&#x5206;" class="headerlink" title="3.1 &#x914D;&#x7F6E; KDC DB &#x90E8;&#x5206;"></a>3.1 &#x914D;&#x7F6E; KDC DB &#x90E8;&#x5206;</h3><blockquote>
<p><strong>Step 1 : &#x521B;&#x5EFA;Kerberos SPN &#x7528;&#x6237;</strong><br><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/79cd9a073e9f752eaa665c541dcacfb78ee4e4d94f235f0814968be0b906141f" alt="kdc002.jpg"></p>
</blockquote>
<blockquote>
<p><strong>Step 2 : &#x914D;&#x7F6E;&#x7528;&#x6237;&#x5C5E;&#x6027; , &#x8BBE;&#x7F6E;&#x4E0D;&#x8981;&#x6C42;&#x9A8C;&#x8BC1; , &#x5BC6;&#x7801;&#x4E0D;&#x8FC7;&#x671F;</strong><br><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/75a5035e544b108ab7c35029aa61a041a2b172434a9031d65e56412a3f2152bf" alt="KDC003.jpg"></p>
</blockquote>
<blockquote>
<p><strong>Step 3 :&#x751F;&#x6210; kerberos.keytab</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;ktpass.exe /out c:\kerberos.keytab /princ HTTP/antblack.com@ADSERVER.COM.CN /pass zzy19950810 /mapuser kerberos@ADSERVER.COM.CN /ptype KRB5_NT_PRINCIPAL /crypto RC4-HMAC-NT</span><br><span class="line"></span><br><span class="line">ADSERVER.COM.CN </span><br><span class="line">    //- &#x5F53;&#x524D;&#x57DF;&#x540D;</span><br><span class="line">antblack.com </span><br><span class="line">    //- KDC Client &#x7AEF;&#x57DF;&#x540D; (&#x5373;&#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;&#x57DF;&#x540D;)</span><br><span class="line">kerberos@ADSERVER.COM.CN </span><br><span class="line">    //- &#x7ED1;&#x5B9A;&#x7684;&#x7528;&#x6237;</span><br><span class="line">zzy19950810</span><br><span class="line">    //- &#x7ED1;&#x5B9A;&#x7684;&#x5BC6;&#x7801;</span><br><span class="line">RC4-HMAC-NT</span><br><span class="line">    // -&#x52A0;&#x5BC6;&#x65B9;&#x5F0F;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/bf005c5e7be773900a6fa1d28cf10acd6e7eeaf8ecd9ff21bc1d95b5ac546f5d" alt="kdc004.jpg"></p>
<blockquote>
<p><strong>Step 4 :&#x751F;&#x6210; &#x540E;&#x7528;&#x6237;&#x4F1A;&#x591A;&#x59D4;&#x6D3E;&#x5C5E;&#x6027; ,&#x9009;&#x62E9;&#x4FE1;&#x4EFB;</strong></p>
</blockquote>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/366ea4b7ed9a2d4fa276cbdece7f5c5b6b5f5ab323b210b14cf2d993a3ed874d" alt="kdc005.jpg"></p>
<p><strong>&#x540C;&#x65F6;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x7528;&#x6237;&#x5DF2;&#x7ECF;&#x7ED1;&#x5B9A;&#x4E86;&#x591A;&#x4E2A;(PS : &#x8FD9;&#x91CC;&#x5B9E;&#x9645;&#x4E0A;&#x5E94;&#x8BE5;&#x662F;ADSERVER.COM.CN , &#x622A;&#x56FE;&#x95EE;&#x9898;)</strong><br><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/5eb39f9de74e3402ec8f3872ca71513c0e85e37a7e5895c479ec9b489b6dfca1" alt="kdc006.jpg"></p>
<h3 id="3-2-&#x914D;&#x7F6E;-KDC"><a href="#3-2-&#x914D;&#x7F6E;-KDC" class="headerlink" title="3.2 &#x914D;&#x7F6E; KDC"></a>3.2 &#x914D;&#x7F6E; KDC</h3><p><strong>CentOS 7 &#x53EF;&#x4EE5;&#x4E0D;&#x7528;&#x5B89;&#x88C5; ,&#x5982;&#x679C; klist &#x4E0D;&#x5B58;&#x5728; , &#x6267;&#x884C;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;</strong>  </p>
<p><code>yum install krb5-server krb5-libs krb5-auth-dialog</code> </p>
<blockquote>
<p><strong>&#x4FEE;&#x6539; /etc/krb5.conf</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">conf&#x590D;&#x5236;&#x4EE3;&#x7801;# Configuration snippets may be placed in this directory as well</span><br><span class="line">includedir /etc/krb5.conf.d/</span><br><span class="line"></span><br><span class="line">[logging]</span><br><span class="line"> default = FILE:/var/log/krb5libs.log</span><br><span class="line"> kdc = FILE:/var/log/krb5kdc.log</span><br><span class="line"> admin_server = FILE:/var/log/kadmind.log</span><br><span class="line"></span><br><span class="line">[libdefaults]</span><br><span class="line"> dns_lookup_realm = false</span><br><span class="line"> ticket_lifetime = 24h</span><br><span class="line"> default_realm = ADSERVER.COM.CN</span><br><span class="line"> default_keytab_name = /opt/kerberos.keytab</span><br><span class="line"> default_tkt_enctypes = rc4-hmac</span><br><span class="line"> default_tgs_enctypes = rc4-hmac</span><br><span class="line"></span><br><span class="line">[realms]</span><br><span class="line">ADSERVER.COM.CN= {</span><br><span class="line">  kdc = 192.168.158.9</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">[domain_realm]</span><br><span class="line">.adserver.com.cn = ADSERVER.COM.CN</span><br><span class="line">adserver.com.cn = ADSERVER.COM.CN</span><br></pre></td></tr></table></figure>

<ul>
<li>/opt/kerberos.keytab : windows AD &#x4E4B;&#x524D;&#x751F;&#x6210;&#x7684; , &#x62D6;&#x5165;&#x5E94;&#x7528;&#x670D;&#x52A1;&#x5668;</li>
<li>192.168.158.9 : KDC DB &#x5730;&#x5740;</li>
<li>ADSERVER.COM.CN : KDC AD &#x57DF;&#x4FE1;&#x606F;</li>
<li>rc4-hmac : &#x52A0;&#x5BC6;&#x65B9;&#x5F0F;</li>
</ul>
<blockquote>
<p>Step 3 : &#x6D4B;&#x8BD5; KDC</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;klist -k    </span><br><span class="line">[root@localhost ~]# klist -k</span><br><span class="line">Keytab name: FILE:/opt/kerberos.keytab</span><br><span class="line">KVNO Principal</span><br><span class="line">---- --------------------------------------------------------------------------</span><br><span class="line">	3 HTTP/antblack.com@ADSERVER.COM.CN</span><br><span class="line"></span><br><span class="line">// &#x6D4B;&#x8BD5; KeyTab &#x662F;&#x5426;&#x8FDE;&#x63A5;</span><br><span class="line">// &#x8FD9;&#x4E2A; ANTBLACK.CN &#x4F1A;&#x53BB;&#x67E5;&#x8BE2; kerb5.conf &#x4E2D;&#x7684; realm , &#x5E76;&#x4E14;&#x53BB;&#x5176;&#x914D;&#x7F6E;&#x7684; kdc &#x8FDB;&#x884C;&#x8BA4;&#x8BC1;</span><br><span class="line">kinit -k HTTP/antblack.cn@ANTBLACK.CN</span><br><span class="line">klist -k</span><br><span class="line">// &#x6267;&#x884C;&#x540E;&#x4F1A;&#x51FA;&#x73B0;&#x7968;&#x636E;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// PS : &#x6B64;&#x65F6; AD &#x4E2D;&#x8FD0;&#x884C; : klist tickets</span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">&#x5F53;&#x524D;&#x767B;&#x5F55; ID &#x662F; 0:0x12de650</span><br><span class="line">&#x7F13;&#x5B58;&#x7684;&#x7968;&#x8BC1;: (2)</span><br><span class="line">#0&gt;     &#x5BA2;&#x6237;&#x7AEF;: administrator @ WDHACPOC.COM.CN</span><br><span class="line">        &#x670D;&#x52A1;&#x5668;: krbtgt/WDHACPOC.COM.CN @ WDHACPOC.COM.CN</span><br><span class="line">        Kerberos &#x7968;&#x8BC1;&#x52A0;&#x5BC6;&#x7C7B;&#x578B;: AES-256-CTS-HMAC-SHA1-96</span><br><span class="line">        &#x7968;&#x8BC1;&#x6807;&#x5FD7; 0x40e10000 -&gt; forwardable renewable initial pre_authent name_canonicalize</span><br><span class="line">        &#x5F00;&#x59CB;&#x65F6;&#x95F4;: 3/30/2021 16:35:39 (&#x672C;&#x5730;)</span><br><span class="line">        &#x7ED3;&#x675F;&#x65F6;&#x95F4;:   3/31/2021 2:35:39 (&#x672C;&#x5730;)</span><br><span class="line">        &#x7EED;&#x8BA2;&#x65F6;&#x95F4;: 4/6/2021 16:35:39 (&#x672C;&#x5730;)</span><br><span class="line">        &#x4F1A;&#x8BDD;&#x5BC6;&#x94A5;&#x7C7B;&#x578B;: AES-256-CTS-HMAC-SHA1-96</span><br><span class="line">        &#x7F13;&#x5B58;&#x6807;&#x5FD7;: 0x1 -&gt; PRIMARY</span><br><span class="line">        &#x8C03;&#x7528;&#x7684; KDC: WIN-U76BKIQFGGJ</span><br><span class="line"></span><br><span class="line">#1&gt;     &#x5BA2;&#x6237;&#x7AEF;: administrator @ WDHACPOC.COM.CN</span><br><span class="line">        &#x670D;&#x52A1;&#x5668;: host/win-u76bkiqfggj.wdhacpoc.com.cn @ WDHACPOC.COM.CN</span><br><span class="line">        Kerberos &#x7968;&#x8BC1;&#x52A0;&#x5BC6;&#x7C7B;&#x578B;: AES-256-CTS-HMAC-SHA1-96</span><br><span class="line">        &#x7968;&#x8BC1;&#x6807;&#x5FD7; 0x40a50000 -&gt; forwardable renewable pre_authent ok_as_delegate name_canonicalize</span><br><span class="line">        &#x5F00;&#x59CB;&#x65F6;&#x95F4;: 3/30/2021 16:35:39 (&#x672C;&#x5730;)</span><br><span class="line">        &#x7ED3;&#x675F;&#x65F6;&#x95F4;:   3/31/2021 2:35:39 (&#x672C;&#x5730;)</span><br><span class="line">        &#x7EED;&#x8BA2;&#x65F6;&#x95F4;: 4/6/2021 16:35:39 (&#x672C;&#x5730;)</span><br><span class="line">        &#x4F1A;&#x8BDD;&#x5BC6;&#x94A5;&#x7C7B;&#x578B;: AES-256-CTS-HMAC-SHA1-96</span><br><span class="line">        &#x7F13;&#x5B58;&#x6807;&#x5FD7;: 0</span><br><span class="line">        &#x8C03;&#x7528;&#x7684; KDC: WIN-U76BKIQFGGJ</span><br></pre></td></tr></table></figure>

<h2 id="&#x56DB;-Java-&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;"><a href="#&#x56DB;-Java-&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;" class="headerlink" title="&#x56DB; . Java &#x5B9E;&#x73B0;&#x65B9;&#x5F0F;"></a>&#x56DB; . Java &#x5B9E;&#x73B0;&#x65B9;&#x5F0F;</h2><p>// TODO : &#x884C;&#x4E1A;&#x4EE3;&#x7801;&#x4E0D;&#x4FBF;&#x4E8E;&#x6574;&#x7406; , &#x540E;&#x7EED;&#x4F1A;&#x505A;&#x4E00;&#x4E2A;&#x7B80;&#x5316;&#x7684; demo &#x586B;&#x5751;</p>
<h2 id="&#x603B;&#x7ED3;"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3;</h2><p>Kerberos &#x5BF9;&#x5916;&#x4E3B;&#x63A8;&#x7684;&#x662F;&#x5B89;&#x5168;&#x6027; , &#x8FD9;&#x4E2A;&#x4E5F;&#x5C5E;&#x4E8E;&#x5E38;&#x89C1;&#x4F46;&#x662F;&#x7528;&#x7684;&#x4E0D;&#x591A;&#x7684;&#x534F;&#x8BAE; , &#x7ED3;&#x5408; AD &#x57DF;&#x5355;&#x70B9;&#x90E8;&#x5206;&#x5382;&#x5BB6;&#x8FD8;&#x662F;&#x6709;&#x6D89;&#x53CA;.</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/06403fac457d7edb3a42b531fa543b13.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="../205/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="../../">1</a><span class="space">&hellip;</span><a class="page-number" href="../205/">205</a><span class="page-number current">206</span><a class="page-number" href="../207/">207</a><span class="space">&hellip;</span><a class="page-number" href="../298/">298</a><a class="extend next" rel="next" href="../207/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">开发者博客</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="https://dev.newban.cn/archives/">
              
                  <span class="site-state-item-count">2975</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">1162</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="../../atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">开发者博客</span>
  <div>
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
  </div>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




  <script type="text/javascript" async src="js/src/mermaid.min.js"></script>
  <script>
  if (window.mermaid) {
        var mermaid_config = {
            startOnLoad: true,
            theme: 'default',
            flowchart:{
                useMaxWidth: false,
                htmlLabels: true
            }                
        }
        mermaid.initialize(mermaid_config);
  }
  </script>
  

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="../../lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="../../lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="../../lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="../../lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="../../lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="../../lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="../../js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="../../js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="../../js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
