<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">
<meta name="referrer" content="never">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="../../lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="../../lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="../../css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="../../images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="../../images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="../../images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="../../images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">





  <link rel="alternate" href="../../atom.xml" title="开发者博客 – IT技术 尽在开发者博客" type="application/atom+xml">






<meta property="og:type" content="website">
<meta property="og:title" content="开发者博客 – IT技术 尽在开发者博客">
<meta property="og:url" content="https://dev.newban.cn/page/94/index.html">
<meta property="og:site_name" content="开发者博客 – IT技术 尽在开发者博客">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="开发者博客 – IT技术 尽在开发者博客">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>
<!--谷歌广告验证代码-->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-2626449904708114",
          enable_page_level_ads: true
     });
</script>
<!--谷歌广告验证代码-->



  <link rel="canonical" href="https://dev.newban.cn/page/94/">





  <title>开发者博客 – IT技术 尽在开发者博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">开发者博客 – IT技术 尽在开发者博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">开发者博客 – 科技是第一生产力</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="http://dev.newban.cn/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="https://dev.newban.cn/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903955554648078.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903955554648078.html" itemprop="url">【译】 axios 是如何封装 HTTP 请求的</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-29T15:54:19+08:00">
                2019-09-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>&#x539F;&#x8F7D;&#x4E8E; TutorialDocs &#x7F51;&#x7AD9;&#x7684;&#x6587;&#x7AE0;<a href="/external_links/4c73e1a286400e6cd78cadf1a83fe126.html" target="blank" rel="noopener">&#x300A;How to Implement an HTTP Request Library with Axios&#x300B;</a>&#x3002;</p>
</blockquote>
<h2 id="&#x6982;&#x8FF0;"><a href="#&#x6982;&#x8FF0;" class="headerlink" title="&#x6982;&#x8FF0;"></a>&#x6982;&#x8FF0;</h2><p>&#x524D;&#x7AEF;&#x5F00;&#x53D1;&#x4E2D;&#xFF0C;&#x7ECF;&#x5E38;&#x4F1A;&#x9047;&#x5230;&#x53D1;&#x9001;&#x5F02;&#x6B65;&#x8BF7;&#x6C42;&#x7684;&#x573A;&#x666F;&#x3002;&#x4E00;&#x4E2A;&#x529F;&#x80FD;&#x9F50;&#x5168;&#x7684; HTTP &#x8BF7;&#x6C42;&#x5E93;&#x53EF;&#x4EE5;&#x5927;&#x5927;&#x964D;&#x4F4E;&#x6211;&#x4EEC;&#x7684;&#x5F00;&#x53D1;&#x6210;&#x672C;&#xFF0C;&#x63D0;&#x9AD8;&#x5F00;&#x53D1;&#x6548;&#x7387;&#x3002;</p>
<p>axios &#x5C31;&#x662F;&#x8FD9;&#x6837;&#x4E00;&#x4E2A; HTTP &#x8BF7;&#x6C42;&#x5E93;&#xFF0C;&#x8FD1;&#x5E74;&#x6765;&#x975E;&#x5E38;&#x70ED;&#x95E8;&#x3002;&#x76EE;&#x524D;&#xFF0C;&#x5B83;&#x5728; GitHub &#x4E0A;&#x62E5;&#x6709;&#x8D85;&#x8FC7; 40,000 &#x7684; Star&#xFF0C;&#x8BB8;&#x591A;&#x6743;&#x5A01;&#x4EBA;&#x58EB;&#x90FD;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x5B83;&#x3002;</p>
<p>&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x6709;&#x5FC5;&#x8981;&#x4E86;&#x89E3;&#x4E0B; axios &#x662F;&#x5982;&#x4F55;&#x8BBE;&#x8BA1;&#xFF0C;&#x4EE5;&#x53CA;&#x5982;&#x4F55;&#x5B9E;&#x73B0; HTTP &#x8BF7;&#x6C42;&#x5E93;&#x5C01;&#x88C5;&#x7684;&#x3002;&#x64B0;&#x5199;&#x672C;&#x6587;&#x65F6;&#xFF0C;axios &#x5F53;&#x524D;&#x7248;&#x672C;&#x4E3A; 0.18.0&#xFF0C;&#x6211;&#x4EEC;&#x4EE5;&#x8BE5;&#x7248;&#x672C;&#x4E3A;&#x4F8B;&#xFF0C;&#x6765;&#x9605;&#x8BFB;&#x548C;&#x5206;&#x6790;&#x90E8;&#x5206;&#x6838;&#x5FC3;&#x6E90;&#x4EE3;&#x7801;&#x3002;axios &#x7684;&#x6240;&#x6709;&#x6E90;&#x6587;&#x4EF6;&#x90FD;&#x4F4D;&#x4E8E; <code>lib</code> &#x6587;&#x4EF6;&#x5939;&#x4E2D;&#xFF0C;&#x4E0B;&#x6587;&#x4E2D;&#x63D0;&#x5230;&#x7684;&#x8DEF;&#x5F84;&#x90FD;&#x662F;&#x76F8;&#x5BF9;&#x4E8E; <code>lib</code> &#x6765;&#x8BF4;&#x7684;&#x3002;</p>
<p>&#x672C;&#x6587;&#x6211;&#x4EEC;&#x4E3B;&#x8981;&#x8BA8;&#x8BBA;&#xFF1A;</p>
<ul>
<li>&#x600E;&#x6837;&#x4F7F;&#x7528; axios&#x3002;</li>
<li>axios &#x7684;&#x6838;&#x5FC3;&#x6A21;&#x5757;&#xFF08;&#x8BF7;&#x6C42;&#x3001;&#x62E6;&#x622A;&#x5668;&#x3001;&#x64A4;&#x9500;&#xFF09;&#x662F;&#x5982;&#x4F55;&#x8BBE;&#x8BA1;&#x548C;&#x5B9E;&#x73B0;&#x7684;&#xFF1F;</li>
<li>axios &#x7684;&#x8BBE;&#x8BA1;&#x4F18;&#x70B9;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;</li>
</ul>
<h2 id="&#x5982;&#x4F55;&#x4F7F;&#x7528;-axios"><a href="#&#x5982;&#x4F55;&#x4F7F;&#x7528;-axios" class="headerlink" title="&#x5982;&#x4F55;&#x4F7F;&#x7528; axios"></a>&#x5982;&#x4F55;&#x4F7F;&#x7528; axios</h2><p>&#x8981;&#x7406;&#x89E3; axios &#x7684;&#x8BBE;&#x8BA1;&#xFF0C;&#x9996;&#x5148;&#x9700;&#x8981;&#x770B;&#x4E00;&#x4E0B;&#x5982;&#x4F55;&#x4F7F;&#x7528; axios&#x3002;&#x6211;&#x4EEC;&#x4E3E;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;&#x6765;&#x8BF4;&#x660E;&#x4E0B; axios API &#x7684;&#x4F7F;&#x7528;&#x3002;</p>
<h3 id="&#x53D1;&#x9001;&#x8BF7;&#x6C42;"><a href="#&#x53D1;&#x9001;&#x8BF7;&#x6C42;" class="headerlink" title="&#x53D1;&#x9001;&#x8BF7;&#x6C42;"></a>&#x53D1;&#x9001;&#x8BF7;&#x6C42;</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;axios({</span><br><span class="line">  method:&apos;get&apos;,</span><br><span class="line">  url:&apos;http://bit.ly/2mTM3nY&apos;,</span><br><span class="line">  responseType:&apos;stream&apos;</span><br><span class="line">})</span><br><span class="line">  .then(function(response) {</span><br><span class="line">  response.data.pipe(fs.createWriteStream(&apos;ada_lovelace.jpg&apos;))</span><br><span class="line">});</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5B98;&#x65B9;&#x793A;&#x4F8B;&#x3002;&#x4ECE;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;axios &#x7684;&#x7528;&#x6CD5;&#x4E0E; jQuery &#x7684; <code>ajax</code> &#x65B9;&#x6CD5;&#x975E;&#x5E38;&#x7C7B;&#x4F3C;&#xFF0C;&#x4E24;&#x8005;&#x90FD;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A; Promise &#x5BF9;&#x8C61;&#xFF08;&#x5728;&#x8FD9;&#x91CC;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x6210;&#x529F;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF0C;&#x4F46;&#x8FD8;&#x662F;&#x66F4;&#x63A8;&#x8350;&#x4F7F;&#x7528; <code>Promise</code> &#x6216; <code>await</code>&#xFF09;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x8FDB;&#x884C;&#x540E;&#x7EED;&#x64CD;&#x4F5C;&#x3002;</p>
<p>&#x8FD9;&#x4E2A;&#x5B9E;&#x4F8B;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x6211;&#x89E3;&#x91CA;&#x4E86;&#x3002;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;&#x770B;&#x5982;&#x4F55;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x62E6;&#x622A;&#x5668;&#x51FD;&#x6570;&#x3002;</p>
<h3 id="&#x6DFB;&#x52A0;&#x62E6;&#x622A;&#x5668;&#x51FD;&#x6570;"><a href="#&#x6DFB;&#x52A0;&#x62E6;&#x622A;&#x5668;&#x51FD;&#x6570;" class="headerlink" title="&#x6DFB;&#x52A0;&#x62E6;&#x622A;&#x5668;&#x51FD;&#x6570;"></a>&#x6DFB;&#x52A0;&#x62E6;&#x622A;&#x5668;&#x51FD;&#x6570;</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// &#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x62E6;&#x622A;&#x5668;&#x3002;&#x6CE8;&#x610F;&#xFF0C;&#x8FD9;&#x91CC;&#x9762;&#x6709; 2 &#x4E2A;&#x51FD;&#x6570;&#x2014;&#x2014;&#x5206;&#x522B;&#x662F;&#x6210;&#x529F;&#x548C;&#x5931;&#x8D25;&#x65F6;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF0C;&#x8FD9;&#x6837;&#x8BBE;&#x8BA1;&#x7684;&#x539F;&#x56E0;&#x4F1A;&#x5728;&#x4E4B;&#x540E;&#x4ECB;&#x7ECD;</span><br><span class="line">axios.interceptors.request.use(function (config) {</span><br><span class="line">    // &#x53D1;&#x8D77;&#x8BF7;&#x6C42;&#x524D;&#x6267;&#x884C;&#x4E00;&#x4E9B;&#x5904;&#x7406;&#x4EFB;&#x52A1;</span><br><span class="line">    return config; // &#x8FD4;&#x56DE;&#x914D;&#x7F6E;&#x4FE1;&#x606F;</span><br><span class="line">  }, function (error) {</span><br><span class="line">    // &#x8BF7;&#x6C42;&#x9519;&#x8BEF;&#x65F6;&#x7684;&#x5904;&#x7406;</span><br><span class="line">    return Promise.reject(error);</span><br><span class="line">  });</span><br><span class="line"></span><br><span class="line">// &#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x54CD;&#x5E94;&#x62E6;&#x622A;&#x5668;</span><br><span class="line">axios.interceptors.response.use(function (response) {</span><br><span class="line">    // &#x5904;&#x7406;&#x54CD;&#x5E94;&#x6570;&#x636E;</span><br><span class="line">    return response; // &#x8FD4;&#x56DE;&#x54CD;&#x5E94;&#x6570;&#x636E;</span><br><span class="line">  }, function (error) {</span><br><span class="line">    // &#x54CD;&#x5E94;&#x51FA;&#x9519;&#x540E;&#x6240;&#x505A;&#x7684;&#x5904;&#x7406;&#x5DE5;&#x4F5C;</span><br><span class="line">    return Promise.reject(error);</span><br><span class="line">  });</span><br></pre></td></tr></table></figure>

<p>&#x4ECE;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x77E5;&#x9053;&#xFF1A;&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5BF9;&#x8BF7;&#x6C42;&#x7684;&#x914D;&#x7F6E;&#x53C2;&#x6570;&#xFF08;<code>config</code>&#xFF09;&#x505A;&#x5904;&#x7406;&#xFF1B;&#x5728;&#x8BF7;&#x6C42;&#x5F97;&#x5230;&#x54CD;&#x5E94;&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5BF9;&#x8FD4;&#x56DE;&#x6570;&#x636E;&#x505A;&#x5904;&#x7406;&#x3002;&#x5F53;&#x8BF7;&#x6C42;&#x6216;&#x54CD;&#x5E94;&#x5931;&#x8D25;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x80FD;&#x6307;&#x5B9A;&#x5BF9;&#x5E94;&#x7684;&#x9519;&#x8BEF;&#x5904;&#x7406;&#x51FD;&#x6570;&#x3002;</p>
<h3 id="&#x64A4;&#x9500;-HTTP-&#x8BF7;&#x6C42;"><a href="#&#x64A4;&#x9500;-HTTP-&#x8BF7;&#x6C42;" class="headerlink" title="&#x64A4;&#x9500; HTTP &#x8BF7;&#x6C42;"></a>&#x64A4;&#x9500; HTTP &#x8BF7;&#x6C42;</h3><p>&#x5728;&#x5F00;&#x53D1;&#x4E0E;&#x641C;&#x7D22;&#x76F8;&#x5173;&#x7684;&#x6A21;&#x5757;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x7ECF;&#x5E38;&#x8981;&#x9891;&#x7E41;&#x5730;&#x53D1;&#x9001;&#x6570;&#x636E;&#x67E5;&#x8BE2;&#x8BF7;&#x6C42;&#x3002;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x53D1;&#x9001;&#x4E0B;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x64A4;&#x9500;&#x4E0A;&#x4E2A;&#x8BF7;&#x6C42;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x80FD;&#x64A4;&#x9500;&#x76F8;&#x5173;&#x8BF7;&#x6C42;&#x529F;&#x80FD;&#x975E;&#x5E38;&#x6709;&#x7528;&#x3002;axios &#x64A4;&#x9500;&#x8BF7;&#x6C42;&#x7684;&#x793A;&#x4F8B;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;const CancelToken = axios.CancelToken;</span><br><span class="line">const source = CancelToken.source();</span><br><span class="line"></span><br><span class="line">// &#x4F8B;&#x5B50;&#x4E00;</span><br><span class="line">axios.get(&apos;/user/12345&apos;, {</span><br><span class="line">  cancelToken: source.token</span><br><span class="line">}).catch(function(thrown) {</span><br><span class="line">  if (axios.isCancel(thrown)) {</span><br><span class="line">    console.log(&apos;&#x8BF7;&#x6C42;&#x64A4;&#x9500;&#x4E86;&apos;, thrown.message);</span><br><span class="line">  } else {</span><br><span class="line">    // &#x5904;&#x7406;&#x9519;&#x8BEF;</span><br><span class="line">  }</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">// &#x4F8B;&#x5B50;&#x4E8C;</span><br><span class="line">axios.post(&apos;/user/12345&apos;, {</span><br><span class="line">  name: &apos;&#x65B0;&#x540D;&#x5B57;&apos;</span><br><span class="line">}, {</span><br><span class="line">  cancelToken: source.token</span><br><span class="line">}).</span><br><span class="line"></span><br><span class="line">// &#x64A4;&#x9500;&#x8BF7;&#x6C42; (&#x4FE1;&#x606F;&#x53C2;&#x6570;&#x662F;&#x53EF;&#x9009;&#x7684;)</span><br><span class="line">source.cancel(&apos;&#x7528;&#x6237;&#x64A4;&#x9500;&#x4E86;&#x8BF7;&#x6C42;&apos;);</span><br></pre></td></tr></table></figure>

<p>&#x4ECE;&#x4E0A;&#x4F8B;&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x5728; axios &#x4E2D;&#xFF0C;&#x4F7F;&#x7528;&#x57FA;&#x4E8E; <code>CancelToken</code> &#x7684;&#x64A4;&#x9500;&#x8BF7;&#x6C42;&#x65B9;&#x6848;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x8BE5;&#x63D0;&#x6848;&#x73B0;&#x5DF2;&#x64A4;&#x56DE;&#xFF0C;&#x8BE6;&#x60C5;&#x5982; <a href="/external_links/0b5cc18eb2c8053f2f5005d7f6f55dfe.html" target="blank" rel="noopener">&#x70B9;&#x8FD9;&#x91CC;</a>&#x3002;&#x5177;&#x4F53;&#x7684;&#x64A4;&#x9500;&#x8BF7;&#x6C42;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x6CD5;&#xFF0C;&#x5C06;&#x5728;&#x540E;&#x9762;&#x7684;&#x6E90;&#x4EE3;&#x7801;&#x5206;&#x6790;&#x7684;&#x4E2D;&#x89E3;&#x91CA;&#x3002;</p>
<h2 id="axios-&#x6838;&#x5FC3;&#x6A21;&#x5757;&#x7684;&#x8BBE;&#x8BA1;&#x548C;&#x5B9E;&#x73B0;"><a href="#axios-&#x6838;&#x5FC3;&#x6A21;&#x5757;&#x7684;&#x8BBE;&#x8BA1;&#x548C;&#x5B9E;&#x73B0;" class="headerlink" title="axios &#x6838;&#x5FC3;&#x6A21;&#x5757;&#x7684;&#x8BBE;&#x8BA1;&#x548C;&#x5B9E;&#x73B0;"></a>axios &#x6838;&#x5FC3;&#x6A21;&#x5757;&#x7684;&#x8BBE;&#x8BA1;&#x548C;&#x5B9E;&#x73B0;</h2><p>&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x6211;&#x76F8;&#x4FE1;&#x6BCF;&#x4E2A;&#x4EBA;&#x90FD;&#x5BF9; axios &#x7684;&#x4F7F;&#x7528;&#x6709;&#x4E00;&#x4E2A;&#x5927;&#x81F4;&#x7684;&#x4E86;&#x89E3;&#x4E86;&#x3002;&#x4E0B;&#x9762;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x6839;&#x636E;&#x6A21;&#x5757;&#x5206;&#x6790; axios &#x7684;&#x8BBE;&#x8BA1;&#x548C;&#x5B9E;&#x73B0;&#x3002;&#x4E0B;&#x9762;&#x7684;&#x56FE;&#x7247;&#xFF0C;&#x662F;&#x6211;&#x5728;&#x672C;&#x6587;&#x4E2D;&#x4F1A;&#x4ECB;&#x7ECD;&#x5230;&#x7684;&#x6E90;&#x4EE3;&#x7801;&#x6587;&#x4EF6;&#x3002;&#x5982;&#x679C;&#x60A8;&#x611F;&#x5174;&#x8DA3;&#xFF0C;&#x6700;&#x597D;&#x5728;&#x9605;&#x8BFB;&#x65F6;&#x514B;&#x9686;&#x76F8;&#x5173;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x8FD9;&#x80FD;&#x52A0;&#x6DF1;&#x4F60;&#x5BF9;&#x76F8;&#x5173;&#x6A21;&#x5757;&#x7684;&#x7406;&#x89E3;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/0672db2b755c9a53fb4eb218b410ae1cbd9ce5b72aaa71dfbcfe7ceedd2fcb55" alt></p>
<h3 id="HTTP-&#x8BF7;&#x6C42;&#x6A21;&#x5757;"><a href="#HTTP-&#x8BF7;&#x6C42;&#x6A21;&#x5757;" class="headerlink" title="HTTP &#x8BF7;&#x6C42;&#x6A21;&#x5757;"></a>HTTP &#x8BF7;&#x6C42;&#x6A21;&#x5757;</h3><p>&#x8BF7;&#x6C42;&#x6A21;&#x5757;&#x7684;&#x4EE3;&#x7801;&#x653E;&#x5728;&#x4E86; <code>core/dispatchRequest.js</code> &#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x53EA;&#x5C55;&#x793A;&#x4E86;&#x4E00;&#x4E9B;&#x5173;&#x952E;&#x4EE3;&#x7801;&#x6765;&#x7B80;&#x5355;&#x8BF4;&#x660E;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;module.exports = function dispatchRequest(config) {</span><br><span class="line">    throwIfCancellationRequested(config);</span><br><span class="line"></span><br><span class="line">    // &#x5176;&#x4ED6;&#x6E90;&#x7801;</span><br><span class="line"></span><br><span class="line">    // &#x9ED8;&#x8BA4;&#x9002;&#x914D;&#x5668;&#x662F;&#x4E00;&#x4E2A;&#x6A21;&#x5757;&#xFF0C;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x5F53;&#x524D;&#x73AF;&#x5883;&#x9009;&#x62E9;&#x4F7F;&#x7528; Node &#x6216;&#x8005; XHR &#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x3002;</span><br><span class="line">    var adapter = config.adapter || defaults.adapter; </span><br><span class="line"></span><br><span class="line">    return adapter(config).then(function onAdapterResolution(response) {</span><br><span class="line">        throwIfCancellationRequested(config);</span><br><span class="line"></span><br><span class="line">        // &#x5176;&#x4ED6;&#x6E90;&#x7801;</span><br><span class="line"></span><br><span class="line">        return response;</span><br><span class="line">    }, function onAdapterRejection(reason) {</span><br><span class="line">        if (!isCancel(reason)) {</span><br><span class="line">            throwIfCancellationRequested(config);</span><br><span class="line"></span><br><span class="line">            // &#x5176;&#x4ED6;&#x6E90;&#x7801;</span><br><span class="line"></span><br><span class="line">            return Promise.reject(reason);</span><br><span class="line">        });</span><br><span class="line">};</span><br></pre></td></tr></table></figure>

<p>&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x80FD;&#x591F;&#x77E5;&#x9053; <code>dispatchRequest</code> &#x65B9;&#x6CD5;&#x662F;&#x901A;&#x8FC7; <code>config.adapter</code> &#xFF0C;&#x83B7;&#x5F97;&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x6A21;&#x5757;&#x7684;&#x3002;&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4F20;&#x9012;&#xFF0C;&#x7B26;&#x5408;&#x89C4;&#x8303;&#x7684;&#x9002;&#x914D;&#x5668;&#x51FD;&#x6570;&#x6765;&#x66FF;&#x4EE3;&#x539F;&#x6765;&#x7684;&#x6A21;&#x5757;&#xFF08;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x4F1A;&#x8FD9;&#x6837;&#x505A;&#xFF0C;&#x4F46;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x677E;&#x6563;&#x8026;&#x5408;&#x7684;&#x6269;&#x5C55;&#x70B9;&#xFF09;&#x3002;</p>
<p>&#x5728; <code>defaults.js</code> &#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x76F8;&#x5173;&#x9002;&#x914D;&#x5668;&#x7684;&#x9009;&#x62E9;&#x903B;&#x8F91;&#x2014;&#x2014;&#x6839;&#x636E;&#x5F53;&#x524D;&#x5BB9;&#x5668;&#x7684;&#x4E00;&#x4E9B;&#x72EC;&#x7279;&#x5C5E;&#x6027;&#x548C;&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;&#x6765;&#x786E;&#x5B9A;&#x4F7F;&#x7528;&#x54EA;&#x4E2A;&#x9002;&#x914D;&#x5668;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function getDefaultAdapter() {</span><br><span class="line">    var adapter;</span><br><span class="line">    // &#x53EA;&#x6709;&#x5728; Node.js &#x4E2D;&#x5305;&#x542B; process &#x7C7B;&#x578B;&#x5BF9;&#x8C61;&#x65F6;&#xFF0C;&#x624D;&#x4F7F;&#x7528;&#x5B83;&#x7684;&#x8BF7;&#x6C42;&#x6A21;&#x5757;</span><br><span class="line">    if (typeof process !== &apos;undefined&apos; &amp;&amp; Object.prototype.toString.call(process) === &apos;[object process]&apos;) {</span><br><span class="line">        // Node.js &#x8BF7;&#x6C42;&#x6A21;&#x5757;</span><br><span class="line">        adapter = require(&apos;./adapters/http&apos;);</span><br><span class="line">    } else if (typeof XMLHttpRequest !== &apos;undefined&apos;) {</span><br><span class="line">        // &#x6D4F;&#x89C8;&#x5668;&#x8BF7;&#x6C42;&#x6A21;&#x5757;</span><br><span class="line">        adapter = require(&apos;./adapters/xhr&apos;);</span><br><span class="line">    }</span><br><span class="line">    return adapter;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>axios &#x4E2D;&#x7684; XHR &#x6A21;&#x5757;&#x76F8;&#x5BF9;&#x7B80;&#x5355;&#xFF0C;&#x5B83;&#x662F;&#x5BF9; <code>XMLHTTPRequest</code> &#x5BF9;&#x8C61;&#x7684;&#x5C01;&#x88C5;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x5C31;&#x4E0D;&#x518D;&#x89E3;&#x91CA;&#x4E86;&#x3002;&#x6709;&#x5174;&#x8DA3;&#x7684;&#x540C;&#x5B66;&#xFF0C;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x9605;&#x8BFB;&#x6E90;&#x6E90;&#x7801;&#x770B;&#x770B;&#xFF0C;&#x6E90;&#x7801;&#x4F4D;&#x4E8E; <code>adapters/xhr.js</code> &#x6587;&#x4EF6;&#x4E2D;&#x3002;</p>
<h3 id="&#x62E6;&#x622A;&#x5668;&#x6A21;&#x5757;"><a href="#&#x62E6;&#x622A;&#x5668;&#x6A21;&#x5757;" class="headerlink" title="&#x62E6;&#x622A;&#x5668;&#x6A21;&#x5757;"></a>&#x62E6;&#x622A;&#x5668;&#x6A21;&#x5757;</h3><p>&#x73B0;&#x5728;&#x8BA9;&#x6211;&#x4EEC;&#x770B;&#x770B; axios &#x662F;&#x5982;&#x4F55;&#x5904;&#x7406;&#xFF0C;&#x8BF7;&#x6C42;&#x548C;&#x54CD;&#x5E94;&#x62E6;&#x622A;&#x5668;&#x51FD;&#x6570;&#x7684;&#x3002;&#x8FD9;&#x5C31;&#x6D89;&#x53CA;&#x5230;&#x4E86; axios &#x4E2D;&#x7684;&#x7EDF;&#x4E00;&#x63A5;&#x53E3; &#x2014;&#x2014;<code>request</code> &#x51FD;&#x6570;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;Axios.prototype.request = function request(config) {</span><br><span class="line"></span><br><span class="line">    // &#x5176;&#x4ED6;&#x6E90;&#x7801;</span><br><span class="line"></span><br><span class="line">    var chain = [dispatchRequest, undefined];</span><br><span class="line">    var promise = Promise.resolve(config);</span><br><span class="line"></span><br><span class="line">    this.interceptors.request.forEach(function unshiftRequestInterceptors(interceptor) {</span><br><span class="line">        chain.unshift(interceptor.fulfilled, interceptor.rejected);</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    this.interceptors.response.forEach(function pushResponseInterceptors(interceptor) {</span><br><span class="line">        chain.push(interceptor.fulfilled, interceptor.rejected);</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    while (chain.length) {</span><br><span class="line">        promise = promise.then(chain.shift(), chain.shift());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    return promise;</span><br><span class="line">};</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x662F; axios &#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x7684;&#x63A5;&#x53E3;&#x3002;&#x56E0;&#x4E3A;&#x51FD;&#x6570;&#x5B9E;&#x73B0;&#x4EE3;&#x7801;&#x76F8;&#x5F53;&#x957F;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x4F1A;&#x7B80;&#x5355;&#x5730;&#x8BA8;&#x8BBA;&#x76F8;&#x5173;&#x8BBE;&#x8BA1;&#x601D;&#x60F3;&#xFF1A;</p>
<ol>
<li><code>chain</code> &#x662F;&#x4E00;&#x4E2A;&#x6267;&#x884C;&#x961F;&#x5217;&#x3002;&#x961F;&#x5217;&#x7684;&#x521D;&#x59CB;&#x503C;&#x662F;&#x4E00;&#x4E2A;&#x643A;&#x5E26;&#x914D;&#x7F6E;&#xFF08;<code>config</code>&#xFF09;&#x53C2;&#x6570;&#x7684; Promise &#x5BF9;&#x8C61;&#x3002;</li>
<li>&#x5728;&#x6267;&#x884C;&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x521D;&#x59CB;&#x51FD;&#x6570; <code>dispatchRequest</code> &#x7528;&#x6765;&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#xFF0C;&#x4E3A;&#x4E86;&#x4E0E; <code>dispatchRequest</code>&#x5BF9;&#x5E94;&#xFF0C;&#x6211;&#x4EEC;&#x6DFB;&#x52A0;&#x4E86;&#x4E00;&#x4E2A; <code>undefined</code>&#x3002;&#x6DFB;&#x52A0; <code>undefined</code> &#x7684;&#x539F;&#x56E0;&#x662F;&#x9700;&#x8981;&#x7ED9; Promise &#x63D0;&#x4F9B;&#x6210;&#x529F;&#x548C;&#x5931;&#x8D25;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF0C;&#x4ECE;&#x4E0B;&#x9762;&#x4EE3;&#x7801;&#x91CC;&#x7684; <code>promise = promise.then(chain.shift(), chain.shift());</code> &#x6211;&#x4EEC;&#x5C31;&#x80FD;&#x770B;&#x51FA;&#x6765;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x51FD;&#x6570; <code>dispatchRequest</code> &#x548C; <code>undefiend</code> &#x53EF;&#x4EE5;&#x770B;&#x6210;&#x662F;&#x4E00;&#x5BF9;&#x51FD;&#x6570;&#x3002;</li>
<li>&#x5728;&#x6267;&#x884C;&#x961F;&#x5217; <code>chain</code> &#x4E2D;&#xFF0C;&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x7684; <code>dispatchReqeust</code> &#x51FD;&#x6570;&#x5904;&#x4E8E;&#x4E2D;&#x95F4;&#x4F4D;&#x7F6E;&#x3002;&#x5B83;&#x524D;&#x9762;&#x662F;&#x8BF7;&#x6C42;&#x62E6;&#x622A;&#x5668;&#xFF0C;&#x4F7F;&#x7528; <code>unshift</code> &#x65B9;&#x6CD5;&#x63D2;&#x5165;&#xFF1B;&#x5B83;&#x540E;&#x9762;&#x662F;&#x54CD;&#x5E94;&#x62E6;&#x622A;&#x5668;&#xFF0C;&#x4F7F;&#x7528; <code>push</code> &#x65B9;&#x6CD5;&#x63D2;&#x5165;&#xFF0C;&#x5728; <code>dispatchRequest</code> &#x4E4B;&#x540E;&#x3002;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x8FD9;&#x4E9B;&#x51FD;&#x6570;&#x90FD;&#x662F;&#x6210;&#x5BF9;&#x7684;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x4E00;&#x6B21;&#x4F1A;&#x63D2;&#x5165;&#x4E24;&#x4E2A;&#x3002;</li>
</ol>
<p>&#x6D4F;&#x89C8;&#x4E0A;&#x9762;&#x7684; <code>request</code> &#x51FD;&#x6570;&#x4EE3;&#x7801;&#xFF0C;&#x6211;&#x4EEC;&#x5927;&#x81F4;&#x77E5;&#x9053;&#x4E86;&#x600E;&#x6837;&#x4F7F;&#x7528;&#x62E6;&#x622A;&#x5668;&#x3002;&#x4E0B;&#x4E00;&#x6B65;&#xFF0C;&#x6765;&#x770B;&#x770B;&#x600E;&#x6837;&#x64A4;&#x9500;&#x4E00;&#x4E2A; HTTP &#x8BF7;&#x6C42;&#x3002;</p>
<h3 id="&#x64A4;&#x9500;&#x8BF7;&#x6C42;&#x6A21;&#x5757;"><a href="#&#x64A4;&#x9500;&#x8BF7;&#x6C42;&#x6A21;&#x5757;" class="headerlink" title="&#x64A4;&#x9500;&#x8BF7;&#x6C42;&#x6A21;&#x5757;"></a>&#x64A4;&#x9500;&#x8BF7;&#x6C42;&#x6A21;&#x5757;</h3><p>&#x4E0E;&#x64A4;&#x9500;&#x8BF7;&#x6C42;&#x76F8;&#x5173;&#x7684;&#x6A21;&#x5757;&#x4F4D;&#x4E8E; <code>Cancel/</code> &#x6587;&#x4EF6;&#x5939;&#x4E0B;&#xFF0C;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E0B;&#x76F8;&#x5173;&#x6838;&#x5FC3;&#x4EE3;&#x7801;&#x3002;</p>
<p>&#x9996;&#x5148;&#xFF0C;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E0B;&#x57FA;&#x7840; <code>Cancel</code> &#x7C7B;&#x3002;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x7528;&#x6765;&#x8BB0;&#x5F55;&#x64A4;&#x9500;&#x72B6;&#x6001;&#x7684;&#x7C7B;&#xFF0C;&#x5177;&#x4F53;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function Cancel(message) {</span><br><span class="line">  this.message = message;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">Cancel.prototype.toString = function toString() {</span><br><span class="line">  return &apos;Cancel&apos; + (this.message ? &apos;: &apos; + this.message : &apos;&apos;);</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">Cancel.prototype.__CANCEL__ = true;</span><br></pre></td></tr></table></figure>

<p>&#x4F7F;&#x7528; <code>CancelToken</code> &#x7C7B;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x5411;&#x5B83;&#x4F20;&#x9012;&#x4E00;&#x4E2A; Promise &#x65B9;&#x6CD5;&#xFF0C;&#x7528;&#x6765;&#x5B9E;&#x73B0; HTTP &#x8BF7;&#x6C42;&#x7684;&#x64A4;&#x9500;&#xFF0C;&#x5177;&#x4F53;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function CancelToken(executor) {</span><br><span class="line">    if (typeof executor !== &apos;function&apos;) {</span><br><span class="line">        throw new TypeError(&apos;executor must be a function.&apos;);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    var resolvePromise;</span><br><span class="line">    this.promise = new Promise(function promiseExecutor(resolve) {</span><br><span class="line">        resolvePromise = resolve;</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    var token = this;</span><br><span class="line">    executor(function cancel(message) {</span><br><span class="line">        if (token.reason) {</span><br><span class="line">            // &#x5DF2;&#x7ECF;&#x88AB;&#x64A4;&#x9500;&#x4E86;</span><br><span class="line">            return;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        token.reason = new Cancel(message);</span><br><span class="line">        resolvePromise(token.reason);</span><br><span class="line">    });</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">CancelToken.source = function source() {</span><br><span class="line">    var cancel;</span><br><span class="line">    var token = new CancelToken(function executor(c) {</span><br><span class="line">        cancel = c;</span><br><span class="line">    });</span><br><span class="line">    return {</span><br><span class="line">        token: token,</span><br><span class="line">        cancel: cancel</span><br><span class="line">    };</span><br><span class="line">};</span><br></pre></td></tr></table></figure>

<p><code>adapters/xhr.js</code> &#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x64A4;&#x9500;&#x8BF7;&#x6C42;&#x7684;&#x5730;&#x65B9;&#x662F;&#x8FD9;&#x6837;&#x5199;&#x7684;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;if (config.cancelToken) {</span><br><span class="line">    // &#x7B49;&#x5F85;&#x64A4;&#x9500;</span><br><span class="line">    config.cancelToken.promise.then(function onCanceled(cancel) {</span><br><span class="line">        if (!request) {</span><br><span class="line">            return;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        request.abort();</span><br><span class="line">        reject(cancel);</span><br><span class="line">        // &#x91CD;&#x7F6E;&#x8BF7;&#x6C42;</span><br><span class="line">        request = null;</span><br><span class="line">    });</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x64A4;&#x9500;  HTTP&#x8BF7;&#x6C42;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x7B80;&#x8981;&#x5730;&#x8BA8;&#x8BBA;&#x4E00;&#x4E0B;&#x76F8;&#x5173;&#x7684;&#x5B9E;&#x73B0;&#x903B;&#x8F91;&#xFF1A;</p>
<ol>
<li>&#x5728;&#x9700;&#x8981;&#x64A4;&#x9500;&#x7684;&#x8BF7;&#x6C42;&#x4E2D;&#xFF0C;&#x8C03;&#x7528; <code>CancelToken</code> &#x7C7B;&#x7684; <code>source</code> &#x65B9;&#x6CD5;&#x7C7B;&#x8FDB;&#x884C;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x4F1A;&#x5F97;&#x5230;&#x4E00;&#x4E2A;&#x5305;&#x542B; <code>CancelToken</code> &#x7C7B;&#x5B9E;&#x4F8B; A &#x548C; <code>cancel</code> &#x65B9;&#x6CD5;&#x7684;&#x5BF9;&#x8C61;&#x3002;</li>
<li>&#x5F53; source &#x65B9;&#x6CD5;&#x6B63;&#x5728;&#x8FD4;&#x56DE;&#x5B9E;&#x4F8B; A &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E00;&#x4E2A;&#x5904;&#x4E8E; pending &#x72B6;&#x6001;&#x7684; <code>promise</code> &#x5BF9;&#x8C61;&#x521D;&#x59CB;&#x5316;&#x5B8C;&#x6210;&#x3002;&#x5728;&#x5C06;&#x5B9E;&#x4F8B; A &#x4F20;&#x9012;&#x7ED9; axios &#x4E4B;&#x540E;&#xFF0C;<code>promise</code> &#x5C31;&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;&#x64A4;&#x9500;&#x8BF7;&#x6C42;&#x7684;&#x89E6;&#x53D1;&#x5668;&#x4F7F;&#x7528;&#x4E86;&#x3002;</li>
<li>&#x5F53;&#x8C03;&#x7528;&#x901A;&#x8FC7; <code>source</code> &#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x7684; <code>cancel</code> &#x65B9;&#x6CD5;&#x540E;&#xFF0C;&#x5B9E;&#x4F8B; A &#x4E2D; <code>promise</code> &#x72B6;&#x6001;&#x4ECE; pending &#x53D8;&#x6210; fulfilled&#xFF0C;&#x7136;&#x540E;&#x7ACB;&#x5373;&#x89E6;&#x53D1; <code>then</code> &#x56DE;&#x8C03;&#x51FD;&#x6570;&#x3002;&#x4E8E;&#x662F; axios &#x7684;&#x64A4;&#x9500;&#x65B9;&#x6CD5;&#x2014;&#x2014;<code>request.abort()</code> &#x88AB;&#x89E6;&#x53D1;&#x4E86;&#x3002;</li>
</ol>
<h2 id="axios-&#x8FD9;&#x6837;&#x8BBE;&#x8BA1;&#x7684;&#x597D;&#x5904;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;"><a href="#axios-&#x8FD9;&#x6837;&#x8BBE;&#x8BA1;&#x7684;&#x597D;&#x5904;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;" class="headerlink" title="axios &#x8FD9;&#x6837;&#x8BBE;&#x8BA1;&#x7684;&#x597D;&#x5904;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;"></a>axios &#x8FD9;&#x6837;&#x8BBE;&#x8BA1;&#x7684;&#x597D;&#x5904;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;</h2><h3 id="&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x51FD;&#x6570;&#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;"><a href="#&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x51FD;&#x6570;&#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;" class="headerlink" title="&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x51FD;&#x6570;&#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;"></a>&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x51FD;&#x6570;&#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;</h3><p>&#x5982;&#x524D;&#x51E0;&#x7AE0;&#x6240;&#x8FF0;&#xFF0C;axios &#x4E0D;&#x5C06;&#x7528;&#x6765;&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x7684; <code>dispatchRequest</code> &#x51FD;&#x6570;&#x770B;&#x505A;&#x4E00;&#x4E2A;&#x7279;&#x6B8A;&#x51FD;&#x6570;&#x3002;&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;<code>dispatchRequest</code> &#x4F1A;&#x88AB;&#x653E;&#x5728;&#x961F;&#x5217;&#x7684;&#x4E2D;&#x95F4;&#x4F4D;&#x7F6E;&#xFF0C;&#x4EE5;&#x4FBF;&#x4FDD;&#x8BC1;&#x961F;&#x5217;&#x5904;&#x7406;&#x7684;&#x4E00;&#x81F4;&#x6027;&#x548C;&#x4EE3;&#x7801;&#x7684;&#x53EF;&#x8BFB;&#x6027;&#x3002;</p>
<h3 id="&#x9002;&#x914D;&#x5668;&#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;"><a href="#&#x9002;&#x914D;&#x5668;&#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;" class="headerlink" title="&#x9002;&#x914D;&#x5668;&#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;"></a>&#x9002;&#x914D;&#x5668;&#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;</h3><p>&#x5728;&#x9002;&#x914D;&#x5668;&#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;&#x4E0A;&#xFF0C;<code>http</code> &#x548C; <code>xhr</code> &#x6A21;&#x5757;&#xFF08;&#x4E00;&#x4E2A;&#x662F;&#x5728; Node.js &#x4E2D;&#x7528;&#x6765;&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x7684;&#xFF0C;&#x4E00;&#x4E2A;&#x662F;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x91CC;&#x7528;&#x6765;&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x7684;&#xFF09;&#x5E76;&#x6CA1;&#x6709;&#x5728; <code>dispatchRequest</code> &#x51FD;&#x6570;&#x4E2D;&#x4F7F;&#x7528;&#xFF0C;&#x800C;&#x662F;&#x5404;&#x81EA;&#x4F5C;&#x4E3A;&#x5355;&#x72EC;&#x7684;&#x6A21;&#x5757;&#xFF0C;&#x9ED8;&#x8BA4;&#x901A;&#x8FC7; <code>defaults.js</code> &#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x914D;&#x7F6E;&#x65B9;&#x6CD5;&#x5F15;&#x5165;&#x7684;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5B83;&#x4E0D;&#x4EC5;&#x786E;&#x4FDD;&#x4E86;&#x4E24;&#x4E2A;&#x6A21;&#x5757;&#x4E4B;&#x95F4;&#x7684;&#x4F4E;&#x8026;&#x5408;&#xFF0C;&#x800C;&#x4E14;&#x8FD8;&#x4E3A;&#x5C06;&#x6765;&#x7684;&#x7528;&#x6237;&#x63D0;&#x4F9B;&#x4E86;&#x5B9A;&#x5236;&#x8BF7;&#x6C42;&#x53D1;&#x9001;&#x6A21;&#x5757;&#x7684;&#x7A7A;&#x95F4;&#x3002;</p>
<h3 id="&#x64A4;&#x9500;-HTTP-&#x8BF7;&#x6C42;&#x7684;&#x903B;&#x8F91;"><a href="#&#x64A4;&#x9500;-HTTP-&#x8BF7;&#x6C42;&#x7684;&#x903B;&#x8F91;" class="headerlink" title="&#x64A4;&#x9500; HTTP &#x8BF7;&#x6C42;&#x7684;&#x903B;&#x8F91;"></a>&#x64A4;&#x9500; HTTP &#x8BF7;&#x6C42;&#x7684;&#x903B;&#x8F91;</h3><p>&#x5728;&#x64A4;&#x9500; HTTP &#x8BF7;&#x6C42;&#x7684;&#x903B;&#x8F91;&#x4E2D;&#xFF0C;axios &#x8BBE;&#x8BA1;&#x4F7F;&#x7528; Promise &#x6765;&#x4F5C;&#x4E3A;&#x89E6;&#x53D1;&#x5668;&#xFF0C;&#x5C06; <code>resolve</code> &#x51FD;&#x6570;&#x66B4;&#x9732;&#x5728;&#x5916;&#x9762;&#xFF0C;&#x5E76;&#x5728;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x91CC;&#x4F7F;&#x7528;&#x3002;&#x5B83;&#x4E0D;&#x4EC5;&#x786E;&#x4FDD;&#x4E86;&#x5185;&#x90E8;&#x903B;&#x8F91;&#x7684;&#x4E00;&#x81F4;&#x6027;&#xFF0C;&#x800C;&#x4E14;&#x8FD8;&#x786E;&#x4FDD;&#x4E86;&#x5728;&#x9700;&#x8981;&#x64A4;&#x9500;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x76F4;&#x63A5;&#x66F4;&#x6539;&#x76F8;&#x5173;&#x7C7B;&#x7684;&#x6837;&#x4F8B;&#x6570;&#x636E;&#xFF0C;&#x4EE5;&#x907F;&#x514D;&#x5728;&#x5F88;&#x5927;&#x7A0B;&#x5EA6;&#x4E0A;&#x5165;&#x4FB5;&#x5176;&#x4ED6;&#x6A21;&#x5757;&#x3002;</p>
<h2 id="&#x603B;&#x7ED3;"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3;</h2><p>&#x672C;&#x6587;&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;&#x4E86; axios &#x7684;&#x7528;&#x6CD5;&#x3001;&#x8BBE;&#x8BA1;&#x601D;&#x60F3;&#x548C;&#x5B9E;&#x73B0;&#x65B9;&#x6CD5;&#x3002;&#x5728;&#x9605;&#x8BFB;&#x4E4B;&#x540E;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x4E86;&#x89E3; axios &#x7684;&#x8BBE;&#x8BA1;&#xFF0C;&#x5E76;&#x4E86;&#x89E3;&#x6A21;&#x5757;&#x7684;&#x5C01;&#x88C5;&#x548C;&#x4EA4;&#x4E92;&#x3002;</p>
<p>&#x672C;&#x6587;&#x53EA;&#x4ECB;&#x7ECD;&#x4E86; axios &#x7684;&#x6838;&#x5FC3;&#x6A21;&#x5757;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x5BF9;&#x5176;&#x4ED6;&#x6A21;&#x5757;&#x4EE3;&#x7801;&#x611F;&#x5174;&#x8DA3;&#xFF0C;&#x53EF;&#x4EE5;&#x5230; <a href="/external_links/8f344fe4707096c96d2ef5fa724e2176.html" target="blank" rel="noopener">GitHub</a> &#x4E0A;&#x67E5;&#x770B;&#x3002;</p>
<p>&#xFF08;&#x5B8C;&#xFF09;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/a8e88a0fd99673f745bb87c538b664ab.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903949686800392.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903949686800392.html" itemprop="url">【码上开学】Kotlin 的协程用力瞥一眼</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-23T17:27:34+08:00">
                2019-09-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>&#x672C;&#x671F;&#x4F5C;&#x8005;&#xFF1A;</p>
<p>&#x89C6;&#x9891;&#xFF1A;&#x6254;&#x7269;&#x7EBF;&#xFF08;&#x6731;&#x51EF;&#xFF09;</p>
<p>&#x6587;&#x7AE0;&#xFF1A;<a href="/external_links/310cffc8ed9f8538be06186cf5d988ce.html" target="blank" rel="noopener">LewisLuo&#xFF08;&#x7F57;&#x5B87;&#xFF09;</a></p>
</blockquote>
<p>&#x5927;&#x5BB6;&#x597D;&#xFF0C;&#x6211;&#x662F;&#x6254;&#x7269;&#x7EBF;&#x6731;&#x51EF;&#x3002;</p>
<p>&#x7EC8;&#x4E8E;&#x5230;&#x4E86;&#x534F;&#x7A0B;&#x7684;&#x4E00;&#x671F;&#x4E86;&#x3002;</p>
<p>Kotlin &#x7684;&#x534F;&#x7A0B;&#x662F;&#x5B83;&#x975E;&#x5E38;&#x7279;&#x522B;&#x7684;&#x4E00;&#x5757;&#x5730;&#x65B9;&#xFF1A;&#x5BA3;&#x626C;&#x5B83;&#x7684;&#x4EBA;&#x90FD;&#x5728;&#x8BF4;&#x534F;&#x7A0B;&#x591A;&#x4E48;&#x597D;&#x591A;&#x4E48;&#x68D2;&#xFF0C;&#x4F46;&#x591A;&#x6570;&#x4EBA;&#x4E0D;&#x7BA1;&#x662F;&#x770B;&#x4E86;&#x534F;&#x7A0B;&#x7684;&#x5B98;&#x65B9;&#x6587;&#x6863;&#x8FD8;&#x662F;&#x4E00;&#x4E9B;&#x7F51;&#x7EDC;&#x6587;&#x7AE0;&#x4E4B;&#x540E;&#x53C8;&#x90FD;&#x89C9;&#x5F97;&#x5B8C;&#x5168;&#x770B;&#x4E0D;&#x61C2;&#x3002;&#x800C;&#x4E14;&#x8FD9;&#x4E2A;&#x300C;&#x4E0D;&#x61C2;&#x300D;&#x548C; RxJava &#x662F;&#x5C5E;&#x4E8E;&#x4E00;&#x7C7B;&#x7684;&#xFF1A;&#x7531;&#x4E8E;&#x534F;&#x7A0B;&#x5728;&#x6982;&#x5FF5;&#x4E0A;&#x5BF9;&#x4E8E; Java &#x5F00;&#x53D1;&#x8005;&#x6765;&#x8BF4;&#x5C31;&#x662F;&#x4E2A;&#x65B0;&#x4E1C;&#x897F;&#xFF0C;&#x6240;&#x4EE5;&#x5BF9;&#x4E8E;&#x5927;&#x591A;&#x6570;&#x4EBA;&#x6765;&#x8BF4;&#xFF0C;&#x522B;&#x8BF4;&#x600E;&#x4E48;&#x7528;&#x4E86;&#xFF0C;&#x6211;&#x8FDE;&#x5B83;&#x662F;&#x4E2A;&#x4EC0;&#x4E48;&#x4E1C;&#x897F;&#x90FD;&#x6CA1;&#x770B;&#x660E;&#x767D;&#x3002;</p>
<p>&#x6240;&#x4EE5;&#x4ECA;&#x5929;&#xFF0C;&#x6211;&#x5C31;&#x5148;&#x4ECE;&#x300C;&#x534F;&#x7A0B;&#x662F;&#x4EC0;&#x4E48;&#x300D;&#x8BF4;&#x8D77;&#x3002;&#x9996;&#x5148;&#x8FD8;&#x662F;&#x770B;&#x89C6;&#x9891;&#x3002;<strong>&#x4E0D;&#x8FC7;&#x56E0;&#x4E3A;&#x6211;&#x4E00;&#x76F4;&#x4E0D;&#x77E5;&#x9053;&#x600E;&#x4E48;&#x5728;&#x6398;&#x91D1;&#x53D1;&#x89C6;&#x9891;&#xFF0C;&#x6240;&#x4EE5;&#x4F60;&#x53EF;&#x4EE5;&#x70B9;&#x51FB; <a href="/external_links/e5da25d6b9f9eba1690d92968bd6835e.html" target="blank" rel="noopener">&#x8FD9;&#x91CC;</a> &#x53BB;&#x54D4;&#x54E9;&#x54D4;&#x54E9;&#x770B;&#x89C6;&#x9891;&#xFF0C;&#x53EF;&#x4EE5;&#x70B9;&#x51FB; <a href="/external_links/565219f01d5ab814f3deb302fe7dffd5.html" target="blank" rel="noopener">&#x8FD9;&#x91CC;</a> &#x53BB; YouTube &#x770B;&#x3002;</strong></p>
<p>&#x8FD9;&#x671F;&#x5185;&#x5BB9;&#x4E3B;&#x8981;&#x662F;&#x8BB2;&#x4E00;&#x4E2A;&#x6982;&#x5FF5;&#xFF1A;&#x4EC0;&#x4E48;&#x662F;&#x534F;&#x7A0B;&#x3002;&#x56E0;&#x4E3A;&#x8FD9;&#x4E2A;&#x6982;&#x5FF5;&#x6709;&#x70B9;&#x96BE;&#xFF08;&#x5176;&#x5B9E;&#x770B;&#x5B8C;&#x89C6;&#x9891;&#x4F60;&#x4F1A;&#x53D1;&#x73B0;&#x5B83;&#x8D85;&#x7EA7;&#x7B80;&#x5355;&#xFF09;&#xFF0C;&#x6240;&#x4EE5;&#x4E13;&#x95E8;&#x82B1;&#x4E00;&#x671F;&#x6765;&#x8BB2;&#x89E3;&#x3002;&#x540E;&#x9762;&#x7684;&#x5185;&#x5BB9;&#x4F1A;&#x66F4;&#x52B2;&#x7206;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x559C;&#x6B22;&#x6211;&#x7684;&#x89C6;&#x9891;&#xFF0C;&#x522B;&#x5FD8;&#x4E86;&#x53BB; <a href="/external_links/2a46f7f96801b05a8085e694e1c56d50.html" target="blank" rel="noopener">&#x539F;&#x89C6;&#x9891;</a> &#x70B9;&#x4E2A;&#x8D5E;&#x6295;&#x4E2A;&#x5E01;&#xFF0C;&#x4EE5;&#x53CA;&#x5173;&#x6CE8;&#x8BA2;&#x9605;&#x4E00;&#x4E0B;&#xFF0C;&#x4E0D;&#x9519;&#x8FC7;&#x6211;&#x7684;&#x4EFB;&#x4F55;&#x65B0;&#x89C6;&#x9891;&#xFF01;</p>
<blockquote>
<p>&#x4EE5;&#x4E0B;&#x5185;&#x5BB9;&#x6765;&#x81EA;&#x6587;&#x7AE0;&#x4F5C;&#x8005; <a href="/external_links/310cffc8ed9f8538be06186cf5d988ce.html" target="blank" rel="noopener">LewisLuo</a>&#x3002;</p>
</blockquote>
<p>&#x7801;&#x4E0A;&#x5F00;&#x5B66; Kotlin &#x7CFB;&#x5217;&#x7684;&#x6587;&#x7AE0;&#xFF0C;&#x534F;&#x7A0B;&#x5DF2;&#x7ECF;&#x662F;&#x7B2C;&#x4E94;&#x671F;&#x4E86;&#xFF0C;&#x8FD9;&#x91CC;&#x7B80;&#x5355;&#x8BB2;&#x4E00;&#x4E0B;&#x6211;&#x4EEC;&#xFF08;&#x6254;&#x7269;&#x7EBF;&#x548C;&#x5373;&#x523B; Android &#x56E2;&#x961F;&#xFF09;&#x51FA;&#x54C1;&#x7684; Kotlin &#x4E0A;&#x624B;&#x6307;&#x5357;&#x7CFB;&#x5217;&#x6587;&#x7AE0;&#x7684;&#x4E00;&#x4E9B;&#x8003;&#x91CF;&#xFF1A;</p>
<ul>
<li>&#x5B98;&#x65B9;&#x6587;&#x6863;&#x6709;&#x6307;&#x5B9A;&#x7684;&#x683C;&#x5F0F;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x662F;&#x5B98;&#x65B9;&#x7684;&#xFF0C;&#x5FC5;&#x987B;&#x9762;&#x9762;&#x4FF1;&#x5230;&#xFF0C;&#x5199;&#x4F5C;&#x987A;&#x5E8F;&#x4E0D;&#x662F;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x4E0D;&#x7BA1;&#x4F60;&#x61C2;&#x4E0D;&#x61C2;&#xFF0C;&#x5B83;&#x90FD;&#x5F97;&#x8BB2;&#x3002;</li>
<li>&#x7F51;&#x4E0A;&#x7684;&#x6587;&#x7AE0;&#x5927;&#x90FD;&#x662F;&#x4ECE;&#x4F5C;&#x8005;&#x81EA;&#x8EAB;&#x7684;&#x89D2;&#x5EA6;&#x51FA;&#x53D1;&#xFF0C;&#x771F;&#x6B63;&#x4ECE;&#x8BFB;&#x8005;&#x7684;&#x9700;&#x6C42;&#x51FA;&#x53D1;&#x7684;&#x5C11;&#x4E4B;&#x53C8;&#x5C11;&#xFF0C;&#x65E0;&#x6CD5;&#x6293;&#x4F4F;&#x8BFB;&#x8005;&#x7684;&#x75DB;&#x70B9;&#xFF0C;&#x80FD;&#x591F;&#x8BFB;&#x5B8C;&#x5DF2;&#x5C5E;&#x4E0D;&#x6613;&#x3002;</li>
<li>&#x75B2;&#x52B3;&#x5EA6;&#x662F;&#x8FD9;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x4E00;&#x4E2A;&#x91CD;&#x8981;&#x7684;&#x8861;&#x91CF;&#x6307;&#x6807;&#xFF0C;&#x6587;&#x7AE0;&#x4E2D;&#x5982;&#x679C;&#x8FDE;&#x7EED;&#x51FA;&#x73B0;&#x5927;&#x6BB5;&#x4EE3;&#x7801;&#xFF0C;&#x75B2;&#x52B3;&#x5EA6;&#x4F1A;&#x6025;&#x5267;&#x4E0A;&#x5347;&#xFF0C;&#x4E0D;&#x5BB9;&#x6613;&#x96C6;&#x4E2D;&#x7CBE;&#x795E;&#xFF0C;&#x751A;&#x81F3;&#x4E2D;&#x9014;&#x653E;&#x5F03;&#x3002;</li>
</ul>
<p>&#x6211;&#x4EEC;&#x671F;&#x8BB8;&#x57FA;&#x4E8E;&#x4E0A;&#x8FF0;&#x7684;&#x8003;&#x91CF;&#x548C;&#x539F;&#x5219;&#xFF0C;&#x628A;&#x6280;&#x672F;&#x6587;&#x7AE0;&#x5199;&#x5F97;&#x66F4;&#x52A0;&#x8F7B;&#x677E;&#x6613;&#x8BFB;&#xFF0C;&#x6FC0;&#x53D1;&#x8BFB;&#x8005;&#x5B66;&#x4E60;&#x7684;&#x5174;&#x8DA3;&#xFF0C;&#x771F;&#x6B63;&#x5B9E;&#x73B0;&#x300C;&#x4E0A;&#x624B;&#x300D;&#x3002;</p>
<p>&#x534F;&#x7A0B;&#x5728; Kotlin &#x4E2D;&#x662F;&#x975E;&#x5E38;&#x7279;&#x522B;&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x548C; Java &#x76F8;&#x6BD4;&#xFF0C;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x65B0;&#x9896;&#x7684;&#x6982;&#x5FF5;&#x3002;&#x5BA3;&#x626C;&#x5B83;&#x7684;&#x4EBA;&#x90FD;&#x5728;&#x8BF4;&#x534F;&#x7A0B;&#x662F;&#x591A;&#x4E48;&#x597D;&#x7528;&#xFF0C;&#x4F46;&#x5C31;&#x76EE;&#x524D;&#x800C;&#x8A00;&#x4E0D;&#x7BA1;&#x662F;&#x5B98;&#x65B9;&#x6587;&#x6863;&#x8FD8;&#x662F;&#x7F51;&#x7EDC;&#x4E0A;&#x7684;&#x4E00;&#x4E9B;&#x6587;&#x7AE0;&#x90FD;&#x8BA9;&#x4EBA;&#x96BE;&#x4EE5;&#x8BFB;&#x61C2;&#x3002;</p>
<p>&#x9020;&#x6210;&#x8FD9;&#x79CD;&#x300C;&#x4E0D;&#x61C2;&#x300D;&#x7684;&#x539F;&#x56E0;&#x548C;&#x5927;&#x591A;&#x6570;&#x4EBA;&#x5728;&#x521D;&#x5B66; RxJava &#x65F6;&#x6240;&#x9047;&#x5230;&#x7684;&#x95EE;&#x9898;&#x5176;&#x5B9E;&#x662F;&#x4E00;&#x81F4;&#x7684;&#xFF1A;&#x5BF9;&#x4E8E; Java &#x5F00;&#x53D1;&#x8005;&#x6765;&#x8BF4;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x65B0;&#x4E1C;&#x897F;&#x3002;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x4ECE;&#x300C;&#x534F;&#x7A0B;&#x662F;&#x4EC0;&#x4E48;&#x300D;&#x5F00;&#x59CB;&#x8BF4;&#x8D77;&#x3002;</p>
<h3 id="&#x534F;&#x7A0B;&#x662F;&#x4EC0;&#x4E48;"><a href="#&#x534F;&#x7A0B;&#x662F;&#x4EC0;&#x4E48;" class="headerlink" title="&#x534F;&#x7A0B;&#x662F;&#x4EC0;&#x4E48;"></a>&#x534F;&#x7A0B;&#x662F;&#x4EC0;&#x4E48;</h3><p>&#x534F;&#x7A0B;&#x5E76;&#x4E0D;&#x662F; Kotlin &#x63D0;&#x51FA;&#x6765;&#x7684;&#x65B0;&#x6982;&#x5FF5;&#xFF0C;&#x5176;&#x4ED6;&#x7684;&#x4E00;&#x4E9B;&#x7F16;&#x7A0B;&#x8BED;&#x8A00;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;Go&#x3001;Python &#x7B49;&#x90FD;&#x53EF;&#x4EE5;&#x5728;&#x8BED;&#x8A00;&#x5C42;&#x9762;&#x4E0A;&#x5B9E;&#x73B0;&#x534F;&#x7A0B;&#xFF0C;&#x751A;&#x81F3;&#x662F; Java&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4F7F;&#x7528;&#x6269;&#x5C55;&#x5E93;&#x6765;&#x95F4;&#x63A5;&#x5730;&#x652F;&#x6301;&#x534F;&#x7A0B;&#x3002;</p>
<p>&#x5F53;&#x5728;&#x7F51;&#x4E0A;&#x641C;&#x7D22;&#x534F;&#x7A0B;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x770B;&#x5230;&#xFF1A;</p>
<ul>
<li>Kotlin &#x5B98;&#x65B9;&#x6587;&#x6863;&#x8BF4;&#x300C;&#x672C;&#x8D28;&#x4E0A;&#xFF0C;&#x534F;&#x7A0B;&#x662F;&#x8F7B;&#x91CF;&#x7EA7;&#x7684;&#x7EBF;&#x7A0B;&#x300D;&#x3002;</li>
<li>&#x5F88;&#x591A;&#x535A;&#x5BA2;&#x63D0;&#x5230;&#x300C;&#x4E0D;&#x9700;&#x8981;&#x4ECE;&#x7528;&#x6237;&#x6001;&#x5207;&#x6362;&#x5230;&#x5185;&#x6838;&#x6001;&#x300D;&#x3001;&#x300C;&#x662F;&#x534F;&#x4F5C;&#x5F0F;&#x7684;&#x300D;&#x7B49;&#x7B49;&#x3002;</li>
</ul>
<p>&#x4F5C;&#x4E3A; Kotlin &#x534F;&#x7A0B;&#x7684;&#x521D;&#x5B66;&#x8005;&#xFF0C;&#x8FD9;&#x4E9B;&#x6982;&#x5FF5;&#x5E76;&#x4E0D;&#x662F;&#x90A3;&#x4E48;&#x5BB9;&#x6613;&#x8BA9;&#x4EBA;&#x7406;&#x89E3;&#x3002;&#x8FD9;&#x4E9B;&#x5F80;&#x5F80;&#x662F;&#x4F5C;&#x8005;&#x6839;&#x636E;&#x81EA;&#x5DF1;&#x7684;&#x7ECF;&#x9A8C;&#x603B;&#x7ED3;&#x51FA;&#x6765;&#x7684;&#xFF0C;&#x53EA;&#x770B;&#x7ED3;&#x679C;&#xFF0C;&#x800C;<strong>&#x4E0D;&#x7BA1;&#x8FC7;&#x7A0B;&#x5C31;&#x4E0D;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#x534F;&#x7A0B;</strong>&#x3002;</p>
<p>&#x300C;&#x534F;&#x7A0B; Coroutines&#x300D;&#x6E90;&#x81EA; Simula &#x548C; Modula-2 &#x8BED;&#x8A00;&#xFF0C;&#x8FD9;&#x4E2A;&#x672F;&#x8BED;&#x65E9;&#x5728; 1958 &#x5E74;&#x5C31;&#x88AB; Melvin Edward Conway &#x53D1;&#x660E;&#x5E76;&#x7528;&#x4E8E;&#x6784;&#x5EFA;&#x6C47;&#x7F16;&#x7A0B;&#x5E8F;&#xFF0C;&#x8BF4;&#x660E;<strong>&#x534F;&#x7A0B;&#x662F;&#x4E00;&#x79CD;&#x7F16;&#x7A0B;&#x601D;&#x60F3;</strong>&#xFF0C;&#x5E76;&#x4E0D;&#x5C40;&#x9650;&#x4E8E;&#x7279;&#x5B9A;&#x7684;&#x8BED;&#x8A00;&#x3002;</p>
<p>Go &#x8BED;&#x8A00;&#x4E5F;&#x6709;&#x534F;&#x7A0B;&#xFF0C;&#x53EB; Goroutines&#xFF0C;&#x4ECE;&#x82F1;&#x6587;&#x62FC;&#x5199;&#x5C31;&#x77E5;&#x9053;&#x5B83;&#x548C; Coroutines &#x8FD8;&#x662F;&#x6709;&#x4E9B;&#x5DEE;&#x522B;&#x7684;&#xFF08;&#x8BBE;&#x8BA1;&#x601D;&#x60F3;&#x4E0A;&#x662F;&#x6709;&#x5173;&#x7CFB;&#x7684;&#xFF09;&#xFF0C;&#x5426;&#x5219; Kotlin &#x7684;&#x534F;&#x7A0B;&#x5B8C;&#x5168;&#x53EF;&#x4EE5;&#x53EB; Koroutines &#x4E86;&#x3002;</p>
<p>&#x56E0;&#x6B64;&#xFF0C;&#x5BF9;&#x4E00;&#x4E2A;&#x65B0;&#x672F;&#x8BED;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x77E5;&#x9053;&#x4EC0;&#x4E48;&#x662F;&#x300C;&#x6807;&#x51C6;&#x300D;&#x672F;&#x8BED;&#xFF0C;&#x4EC0;&#x4E48;&#x662F;&#x53D8;&#x79CD;&#x3002;</p>
<p>&#x5F53;&#x6211;&#x4EEC;&#x8BA8;&#x8BBA;&#x534F;&#x7A0B;&#x548C;&#x7EBF;&#x7A0B;&#x7684;&#x5173;&#x7CFB;&#x65F6;&#xFF0C;&#x5F88;&#x5BB9;&#x6613;<strong>&#x9677;&#x5165;&#x4E2D;&#x6587;&#x7684;&#x8BEF;&#x533A;</strong>&#xFF0C;&#x4E24;&#x8005;&#x90FD;&#x6709;&#x4E00;&#x4E2A;&#x300C;&#x7A0B;&#x300D;&#x5B57;&#xFF0C;&#x5C31;&#x89C9;&#x5F97;&#x6709;&#x5173;&#x7CFB;&#xFF0C;&#x5176;&#x5B9E;&#x5C31;&#x82F1;&#x6587;&#x800C;&#x8A00;&#xFF0C;Coroutines &#x548C; Threads &#x5C31;&#x662F;&#x4E24;&#x4E2A;&#x6982;&#x5FF5;&#x3002;</p>
<p>&#x4ECE; Android &#x5F00;&#x53D1;&#x8005;&#x7684;&#x89D2;&#x5EA6;&#x53BB;&#x7406;&#x89E3;&#x5B83;&#x4EEC;&#x7684;&#x5173;&#x7CFB;&#xFF1A;</p>
<ul>
<li>&#x6211;&#x4EEC;&#x6240;&#x6709;&#x7684;&#x4EE3;&#x7801;&#x90FD;&#x662F;&#x8DD1;&#x5728;&#x7EBF;&#x7A0B;&#x4E2D;&#x7684;&#xFF0C;&#x800C;&#x7EBF;&#x7A0B;&#x662F;&#x8DD1;&#x5728;&#x8FDB;&#x7A0B;&#x4E2D;&#x7684;&#x3002;</li>
<li>&#x534F;&#x7A0B;&#x6CA1;&#x6709;&#x76F4;&#x63A5;&#x548C;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5173;&#x8054;&#xFF0C;&#x4F46;&#x5B83;&#x4E0D;&#x662F;&#x7A7A;&#x4E2D;&#x697C;&#x9601;&#xFF0C;&#x5B83;&#x4E5F;&#x662F;&#x8DD1;&#x5728;&#x7EBF;&#x7A0B;&#x4E2D;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x662F;&#x5355;&#x7EBF;&#x7A0B;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x662F;&#x591A;&#x7EBF;&#x7A0B;&#x3002;</li>
<li>&#x5355;&#x7EBF;&#x7A0B;&#x4E2D;&#x7684;&#x534F;&#x7A0B;&#x603B;&#x7684;&#x6267;&#x884C;&#x65F6;&#x95F4;&#x5E76;&#x4E0D;&#x4F1A;&#x6BD4;&#x4E0D;&#x7528;&#x534F;&#x7A0B;&#x5C11;&#x3002;</li>
<li>Android &#x7CFB;&#x7EDF;&#x4E0A;&#xFF0C;&#x5982;&#x679C;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x8FDB;&#x884C;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#xFF0C;&#x4F1A;&#x629B;&#x51FA; <code>NetworkOnMainThreadException</code>&#xFF0C;&#x5BF9;&#x4E8E;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E0A;&#x7684;&#x534F;&#x7A0B;&#x4E5F;&#x4E0D;&#x4F8B;&#x5916;&#xFF0C;&#x8FD9;&#x79CD;&#x573A;&#x666F;&#x4F7F;&#x7528;&#x534F;&#x7A0B;&#x8FD8;&#x662F;&#x8981;&#x5207;&#x7EBF;&#x7A0B;&#x7684;&#x3002;</li>
</ul>
<p>&#x534F;&#x7A0B;&#x8BBE;&#x8BA1;&#x7684;&#x521D;&#x8877;&#x662F;&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x5E76;&#x53D1;&#x95EE;&#x9898;&#xFF0C;&#x8BA9; &#x300C;&#x534F;&#x4F5C;&#x5F0F;&#x591A;&#x4EFB;&#x52A1;&#x300D; &#x5B9E;&#x73B0;&#x8D77;&#x6765;&#x66F4;&#x52A0;&#x65B9;&#x4FBF;&#x3002;&#x8FD9;&#x91CC;&#x5C31;&#x5148;&#x4E0D;&#x5C55;&#x5F00;&#x300C;&#x534F;&#x4F5C;&#x5F0F;&#x591A;&#x4EFB;&#x52A1;&#x300D;&#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x7B49;&#x6211;&#x4EEC;&#x5B66;&#x4F1A;&#x4E86;&#x600E;&#x4E48;&#x7528;&#x518D;&#x8BB2;&#x3002;</p>
<p>&#x89C6;&#x9891;&#x91CC;&#x8BB2;&#x5230;&#xFF0C;&#x534F;&#x7A0B;&#x5C31;&#x662F; Kotlin &#x63D0;&#x4F9B;&#x7684;&#x4E00;&#x5957;&#x7EBF;&#x7A0B;&#x5C01;&#x88C5;&#x7684; API&#xFF0C;&#x4F46;&#x5E76;&#x4E0D;&#x662F;&#x8BF4;&#x534F;&#x7A0B;&#x5C31;&#x662F;&#x4E3A;&#x7EBF;&#x7A0B;&#x800C;&#x751F;&#x7684;&#x3002;</p>
<p>&#x4E0D;&#x8FC7;&#xFF0C;&#x6211;&#x4EEC;&#x5B66;&#x4E60; Kotlin &#x4E2D;&#x7684;&#x534F;&#x7A0B;&#xFF0C;&#x4E00;&#x5F00;&#x59CB;&#x786E;&#x5B9E;&#x53EF;&#x4EE5;&#x4ECE;&#x7EBF;&#x7A0B;&#x63A7;&#x5236;&#x7684;&#x89D2;&#x5EA6;&#x6765;&#x5207;&#x5165;&#x3002;&#x56E0;&#x4E3A;&#x5728; Kotlin &#x4E2D;&#xFF0C;&#x534F;&#x7A0B;&#x7684;&#x4E00;&#x4E2A;&#x5178;&#x578B;&#x7684;&#x4F7F;&#x7528;&#x573A;&#x666F;&#x5C31;&#x662F;&#x7EBF;&#x7A0B;&#x63A7;&#x5236;&#x3002;&#x5C31;&#x50CF; Java &#x4E2D;&#x7684; <code>Executor</code> &#x548C; Android &#x4E2D;&#x7684; <code>AsyncTask</code>&#xFF0C;Kotlin &#x4E2D;&#x7684;&#x534F;&#x7A0B;&#x4E5F;&#x6709;&#x5BF9; Thread API &#x7684;&#x5C01;&#x88C5;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x5199;&#x4EE3;&#x7801;&#x65F6;&#xFF0C;&#x4E0D;&#x7528;&#x5173;&#x6CE8;&#x591A;&#x7EBF;&#x7A0B;&#x5C31;&#x80FD;&#x591F;&#x5F88;&#x65B9;&#x4FBF;&#x5730;&#x5199;&#x51FA;&#x5E76;&#x53D1;&#x64CD;&#x4F5C;&#x3002;</p>
<p>&#x5728; Java &#x4E2D;&#x8981;&#x5B9E;&#x73B0;&#x5E76;&#x53D1;&#x64CD;&#x4F5C;&#x901A;&#x5E38;&#x9700;&#x8981;&#x5F00;&#x542F;&#x4E00;&#x4E2A; <code>Thread</code> &#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;&#x2615;&#xFE0F;</span><br><span class="line">new Thread(new Runnable() {</span><br><span class="line">    @Override</span><br><span class="line">    public void run() {</span><br><span class="line">        ...</span><br><span class="line">    }</span><br><span class="line">}).start();</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x91CC;&#x4EC5;&#x4EC5;&#x53EA;&#x662F;&#x5F00;&#x542F;&#x4E86;&#x4E00;&#x4E2A;&#x65B0;&#x7EBF;&#x7A0B;&#xFF0C;&#x81F3;&#x4E8E;&#x5B83;&#x4F55;&#x65F6;&#x7ED3;&#x675F;&#x3001;&#x6267;&#x884C;&#x7ED3;&#x679C;&#x600E;&#x4E48;&#x6837;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E2D;&#x662F;&#x65E0;&#x6CD5;&#x76F4;&#x63A5;&#x77E5;&#x9053;&#x7684;&#x3002;</p>
<p>Kotlin &#x4E2D;&#x540C;&#x6837;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x7EBF;&#x7A0B;&#x7684;&#x65B9;&#x5F0F;&#x53BB;&#x5199;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">Thread({</span><br><span class="line">    ...</span><br><span class="line">}).start()</span><br></pre></td></tr></table></figure>

<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x548C; Java &#x4E00;&#x6837;&#x4E5F;&#x6446;&#x8131;&#x4E0D;&#x4E86;&#x76F4;&#x63A5;&#x4F7F;&#x7528; <code>Thread</code> &#x7684;&#x90A3;&#x4E9B;&#x56F0;&#x96BE;&#x548C;&#x4E0D;&#x65B9;&#x4FBF;&#xFF1A;</p>
<ul>
<li>&#x7EBF;&#x7A0B;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x6267;&#x884C;&#x7ED3;&#x675F;</li>
<li>&#x7EBF;&#x7A0B;&#x95F4;&#x7684;&#x76F8;&#x4E92;&#x901A;&#x4FE1;</li>
<li>&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x7684;&#x7BA1;&#x7406;</li>
</ul>
<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528; Java &#x7684; <code>Executor</code> &#x7EBF;&#x7A0B;&#x6C60;&#x6765;&#x8FDB;&#x884C;&#x7EBF;&#x7A0B;&#x7BA1;&#x7406;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">val executor = Executors.newCachedThreadPool()</span><br><span class="line">executor.execute({</span><br><span class="line">    ...</span><br><span class="line">})</span><br></pre></td></tr></table></figure>

<p>&#x7528; Android &#x7684; <code>AsyncTask</code> &#x6765;&#x89E3;&#x51B3;&#x7EBF;&#x7A0B;&#x95F4;&#x901A;&#x4FE1;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">object : AsyncTask&lt;T0, T1, T2&gt; { </span><br><span class="line">    override fun doInBackground(vararg args: T0): String { ... }</span><br><span class="line">    override fun onProgressUpdate(vararg args: T1) { ... }</span><br><span class="line">    override fun onPostExecute(t3: T3) { ... }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><code>AsyncTask</code> &#x662F; Android &#x5BF9;&#x7EBF;&#x7A0B;&#x6C60; <code>Executor</code> &#x7684;&#x5C01;&#x88C5;&#xFF0C;&#x4F46;&#x5B83;&#x7684;&#x7F3A;&#x70B9;&#x4E5F;&#x5F88;&#x660E;&#x663E;&#xFF1A;</p>
<ul>
<li>&#x9700;&#x8981;&#x5904;&#x7406;&#x5F88;&#x591A;&#x56DE;&#x8C03;&#xFF0C;&#x5982;&#x679C;&#x4E1A;&#x52A1;&#x591A;&#x5219;&#x5BB9;&#x6613;&#x9677;&#x5165;&#x300C;&#x56DE;&#x8C03;&#x5730;&#x72F1;&#x300D;&#x3002;</li>
<li>&#x786C;&#x662F;&#x628A;&#x4E1A;&#x52A1;&#x62C6;&#x5206;&#x6210;&#x4E86;&#x524D;&#x53F0;&#x3001;&#x4E2D;&#x95F4;&#x66F4;&#x65B0;&#x3001;&#x540E;&#x53F0;&#x4E09;&#x4E2A;&#x51FD;&#x6570;&#x3002;</li>
</ul>
<p>&#x770B;&#x5230;&#x8FD9;&#x91CC;&#x4F60;&#x5F88;&#x81EA;&#x7136;&#x60F3;&#x5230;&#x4F7F;&#x7528; RxJava &#x89E3;&#x51B3;&#x56DE;&#x8C03;&#x5730;&#x72F1;&#xFF0C;&#x5B83;&#x786E;&#x5B9E;&#x53EF;&#x4EE5;&#x5F88;&#x65B9;&#x4FBF;&#x5730;&#x89E3;&#x51B3;&#x4E0A;&#x9762;&#x7684;&#x95EE;&#x9898;&#x3002;</p>
<p>RxJava&#xFF0C;&#x51C6;&#x786E;&#x6765;&#x8BB2;&#x662F; ReactiveX &#x5728; Java &#x4E0A;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x662F;&#x4E00;&#x79CD;&#x54CD;&#x5E94;&#x5F0F;&#x7A0B;&#x5E8F;&#x6846;&#x67B6;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x5B83;&#x63D0;&#x4F9B;&#x7684;&#x300C;Observable&#x300D;&#x7684;&#x7F16;&#x7A0B;&#x8303;&#x5F0F;&#x8FDB;&#x884C;&#x94FE;&#x5F0F;&#x8C03;&#x7528;&#xFF0C;&#x53EF;&#x4EE5;&#x5F88;&#x597D;&#x5730;&#x6D88;&#x9664;&#x56DE;&#x8C03;&#x3002;</p>
<p>&#x4F7F;&#x7528;&#x534F;&#x7A0B;&#xFF0C;&#x540C;&#x6837;&#x53EF;&#x4EE5;&#x50CF; Rx &#x90A3;&#x6837;&#x6709;&#x6548;&#x5730;&#x6D88;&#x9664;&#x56DE;&#x8C03;&#x5730;&#x72F1;&#xFF0C;&#x4E0D;&#x8FC7;&#x65E0;&#x8BBA;&#x662F;&#x8BBE;&#x8BA1;&#x7406;&#x5FF5;&#xFF0C;&#x8FD8;&#x662F;&#x4EE3;&#x7801;&#x98CE;&#x683C;&#xFF0C;&#x4E24;&#x8005;&#x662F;&#x6709;&#x5F88;&#x5927;&#x533A;&#x522B;&#x7684;&#xFF0C;&#x534F;&#x7A0B;&#x5728;&#x5199;&#x6CD5;&#x4E0A;&#x548C;&#x666E;&#x901A;&#x7684;&#x987A;&#x5E8F;&#x4EE3;&#x7801;&#x7C7B;&#x4F3C;&#x3002;</p>
<blockquote>
<p>&#x8FD9;&#x91CC;&#x5E76;&#x4E0D;&#x4F1A;&#x6BD4;&#x8F83; RxJava &#x548C;&#x534F;&#x7A0B;&#x54EA;&#x4E2A;&#x597D;&#xFF0C;&#x6216;&#x8005;&#x8BA8;&#x8BBA;&#x8C01;&#x53D6;&#x4EE3;&#x8C01;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x8FD9;&#x91CC;&#x53EA;&#x7ED9;&#x51FA;&#x4E00;&#x4E2A;&#x5EFA;&#x8BAE;&#xFF0C;&#x4F60;&#x6700;&#x597D;&#x90FD;&#x53BB;&#x4E86;&#x89E3;&#x4E0B;&#xFF0C;&#x56E0;&#x4E3A;&#x534F;&#x7A0B;&#x548C; Rx &#x7684;&#x8BBE;&#x8BA1;&#x601D;&#x60F3;&#x672C;&#x6765;&#x5C31;&#x4E0D;&#x540C;&#x3002;</p>
</blockquote>
<p>&#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x662F;&#x4F7F;&#x7528;&#x534F;&#x7A0B;&#x8FDB;&#x884C;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x83B7;&#x53D6;&#x7528;&#x6237;&#x4FE1;&#x606F;&#x5E76;&#x663E;&#x793A;&#x5230; UI &#x63A7;&#x4EF6;&#x4E0A;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">launch({</span><br><span class="line">    val user = api.getUser() // &#x1F448; &#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#xFF08;IO &#x7EBF;&#x7A0B;&#xFF09;</span><br><span class="line">    nameTv.text = user.name  // &#x1F448; &#x66F4;&#x65B0; UI&#xFF08;&#x4E3B;&#x7EBF;&#x7A0B;&#xFF09;</span><br><span class="line">})</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x91CC;&#x53EA;&#x662F;&#x5C55;&#x793A;&#x4E86;&#x4E00;&#x4E2A;&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#xFF0C;<code>launch</code> &#x5E76;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x9876;&#x5C42;&#x51FD;&#x6570;&#xFF0C;&#x5B83;&#x5FC5;&#x987B;&#x5728;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x4E2D;&#x4F7F;&#x7528;&#xFF0C;&#x6211;&#x4EEC;&#x4E4B;&#x540E;&#x518D;&#x8BB2;&#xFF0C;&#x8FD9;&#x91CC;&#x53EA;&#x5173;&#x5FC3;&#x5B83;&#x5185;&#x90E8;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x7684;&#x5199;&#x6CD5;&#x3002;</p>
<p><code>launch</code> &#x51FD;&#x6570;&#x52A0;&#x4E0A;&#x5B9E;&#x73B0;&#x5728; <code>{}</code> &#x4E2D;&#x5177;&#x4F53;&#x7684;&#x903B;&#x8F91;&#xFF0C;&#x5C31;&#x6784;&#x6210;&#x4E86;&#x4E00;&#x4E2A;&#x534F;&#x7A0B;&#x3002;</p>
<p>&#x901A;&#x5E38;&#x6211;&#x4EEC;&#x505A;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#xFF0C;&#x8981;&#x4E0D;&#x5C31;&#x4F20;&#x4E00;&#x4E2A; callback&#xFF0C;&#x8981;&#x4E0D;&#x5C31;&#x662F;&#x5728; IO &#x7EBF;&#x7A0B;&#x91CC;&#x8FDB;&#x884C;&#x963B;&#x585E;&#x5F0F;&#x7684;&#x540C;&#x6B65;&#x8C03;&#x7528;&#xFF0C;&#x800C;&#x5728;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x4E2D;&#xFF0C;&#x4E0A;&#x4E0B;&#x4E24;&#x4E2A;&#x8BED;&#x53E5;&#x5206;&#x522B;&#x5DE5;&#x4F5C;&#x5728;&#x4E24;&#x4E2A;&#x7EBF;&#x7A0B;&#x91CC;&#xFF0C;&#x4F46;&#x5199;&#x6CD5;&#x4E0A;&#x770B;&#x8D77;&#x6765;&#x548C;&#x666E;&#x901A;&#x7684;&#x5355;&#x7EBF;&#x7A0B;&#x4EE3;&#x7801;&#x4E00;&#x6837;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x7684; <code>api.getUser</code> &#x662F;&#x4E00;&#x4E2A;<strong>&#x6302;&#x8D77;&#x51FD;&#x6570;</strong>&#xFF0C;&#x6240;&#x4EE5;&#x80FD;&#x591F;&#x4FDD;&#x8BC1; <code>nameTv.text</code> &#x7684;&#x6B63;&#x786E;&#x8D4B;&#x503C;&#xFF0C;&#x8FD9;&#x5C31;&#x6D89;&#x53CA;&#x5230;&#x4E86;&#x534F;&#x7A0B;&#x4E2D;&#x6700;&#x8457;&#x540D;&#x7684;&#x300C;&#x975E;&#x963B;&#x585E;&#x5F0F;&#x6302;&#x8D77;&#x300D;&#x3002;&#x8FD9;&#x4E2A;&#x540D;&#x8BCD;&#x770B;&#x8D77;&#x6765;&#x4E0D;&#x662F;&#x90A3;&#x4E48;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#xFF0C;&#x6211;&#x4EEC;&#x540E;&#x7EED;&#x7684;&#x6587;&#x7AE0;&#x4F1A;&#x4E13;&#x95E8;&#x5BF9;&#x8FD9;&#x4E2A;&#x6982;&#x5FF5;&#x8FDB;&#x884C;&#x8BB2;&#x89E3;&#x3002;&#x73B0;&#x5728;&#x5148;&#x628A;&#x8FD9;&#x4E2A;&#x6982;&#x5FF5;&#x653E;&#x4E0B;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x8BB0;&#x4F4F;&#x534F;&#x7A0B;&#x5C31;&#x662F;&#x8FD9;&#x6837;&#x5199;&#x7684;&#x5C31;&#x884C;&#x4E86;&#x3002;</p>
<p>&#x8FD9;&#x79CD;&#x300C;&#x7528;&#x540C;&#x6B65;&#x7684;&#x65B9;&#x5F0F;&#x5199;&#x5F02;&#x6B65;&#x7684;&#x4EE3;&#x7801;&#x300D;&#x770B;&#x8D77;&#x6765;&#x5F88;&#x65B9;&#x4FBF;&#x5427;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x770B;&#x534F;&#x7A0B;&#x5177;&#x4F53;&#x597D;&#x5728;&#x54EA;&#x3002;</p>
<h3 id="&#x534F;&#x7A0B;&#x597D;&#x5728;&#x54EA;"><a href="#&#x534F;&#x7A0B;&#x597D;&#x5728;&#x54EA;" class="headerlink" title="&#x534F;&#x7A0B;&#x597D;&#x5728;&#x54EA;"></a>&#x534F;&#x7A0B;&#x597D;&#x5728;&#x54EA;</h3><h4 id="&#x5F00;&#x59CB;&#x4E4B;&#x524D;"><a href="#&#x5F00;&#x59CB;&#x4E4B;&#x524D;" class="headerlink" title="&#x5F00;&#x59CB;&#x4E4B;&#x524D;"></a>&#x5F00;&#x59CB;&#x4E4B;&#x524D;</h4><p>&#x5728;&#x8BB2;&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5148;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;&#x300C;&#x95ED;&#x5305;&#x300D;&#x8FD9;&#x4E2A;&#x6982;&#x5FF5;&#xFF0C;&#x8C03;&#x7528; Kotlin &#x534F;&#x7A0B;&#x4E2D;&#x7684; API&#xFF0C;&#x7ECF;&#x5E38;&#x4F1A;&#x7528;&#x5230;&#x95ED;&#x5305;&#x5199;&#x6CD5;&#x3002;</p>
<p>&#x5176;&#x5B9E;&#x95ED;&#x5305;&#x5E76;&#x4E0D;&#x662F; Kotlin &#x4E2D;&#x7684;&#x65B0;&#x6982;&#x5FF5;&#xFF0C;&#x5728; Java 8 &#x4E2D;&#x5C31;&#x5DF2;&#x7ECF;&#x652F;&#x6301;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x5148;&#x4EE5; <code>Thread</code> &#x4E3A;&#x4F8B;&#xFF0C;&#x6765;&#x770B;&#x770B;&#x4EC0;&#x4E48;&#x662F;&#x95ED;&#x5305;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">// &#x521B;&#x5EFA;&#x4E00;&#x4E2A; Thread &#x7684;&#x5B8C;&#x6574;&#x5199;&#x6CD5;</span><br><span class="line">Thread(object : Runnable {</span><br><span class="line">    override fun run() {</span><br><span class="line">        ...</span><br><span class="line">    }</span><br><span class="line">})</span><br><span class="line"></span><br><span class="line">// &#x6EE1;&#x8DB3; SAM&#xFF0C;&#x5148;&#x7B80;&#x5316;&#x4E3A;</span><br><span class="line">Thread({</span><br><span class="line">    ...</span><br><span class="line">})</span><br><span class="line"></span><br><span class="line">// &#x4F7F;&#x7528;&#x95ED;&#x5305;&#xFF0C;&#x518D;&#x7B80;&#x5316;&#x4E3A;</span><br><span class="line">Thread {</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5F62;&#x5982; <code>Thread {...}</code> &#x8FD9;&#x6837;&#x7684;&#x7ED3;&#x6784;&#x4E2D; <code>{}</code> &#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x95ED;&#x5305;&#x3002;</p>
<p>&#x5728; Kotlin &#x4E2D;&#x6709;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x8BED;&#x6CD5;&#x7CD6;&#xFF1A;&#x5F53;&#x51FD;&#x6570;&#x7684;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x662F; lambda &#x8868;&#x8FBE;&#x5F0F;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x5C06; lambda &#x5199;&#x5728;&#x62EC;&#x53F7;&#x5916;&#x3002;&#x8FD9;&#x5C31;&#x662F;&#x5B83;&#x7684;&#x95ED;&#x5305;&#x539F;&#x5219;&#x3002;</p>
<p>&#x5728;&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x7C7B;&#x578B;&#x4E3A; <code>Runnable</code> &#x7684;&#x53C2;&#x6570;&#xFF0C;&#x800C; <code>Runnable</code> &#x662F;&#x4E00;&#x4E2A;&#x63A5;&#x53E3;&#xFF0C;&#x4E14;&#x53EA;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E2A;&#x51FD;&#x6570; <code>run</code>&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x6EE1;&#x8DB3;&#x4E86; Kotlin &#x7684; <a href="/external_links/4ae6be8b119b736287a533d0306088db.html" target="blank" rel="noopener">SAM</a>&#xFF0C;&#x53EF;&#x4EE5;&#x8F6C;&#x6362;&#x6210;&#x4F20;&#x9012;&#x4E00;&#x4E2A; lambda &#x8868;&#x8FBE;&#x5F0F;&#xFF08;&#x7B2C;&#x4E8C;&#x6BB5;&#xFF09;&#xFF0C;&#x56E0;&#x4E3A;&#x662F;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x6839;&#x636E;&#x95ED;&#x5305;&#x539F;&#x5219;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5199;&#x6210; <code>Thread {...}</code>&#xFF08;&#x7B2C;&#x4E09;&#x6BB5;&#xFF09; &#x7684;&#x5F62;&#x5F0F;&#x3002;</p>
<p>&#x5BF9;&#x4E8E;&#x4E0A;&#x6587;&#x6240;&#x4F7F;&#x7528;&#x7684; <code>launch</code> &#x51FD;&#x6570;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x95ED;&#x5305;&#x6765;&#x8FDB;&#x884C;&#x7B80;&#x5316; &#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">launch {</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="&#x57FA;&#x672C;&#x4F7F;&#x7528;"><a href="#&#x57FA;&#x672C;&#x4F7F;&#x7528;" class="headerlink" title="&#x57FA;&#x672C;&#x4F7F;&#x7528;"></a>&#x57FA;&#x672C;&#x4F7F;&#x7528;</h4><p>&#x524D;&#x9762;&#x63D0;&#x5230;&#xFF0C;<code>launch</code> &#x51FD;&#x6570;&#x4E0D;&#x662F;&#x9876;&#x5C42;&#x51FD;&#x6570;&#xFF0C;&#x662F;&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x7528;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4E0B;&#x9762;&#x4E09;&#x79CD;&#x65B9;&#x6CD5;&#x6765;&#x521B;&#x5EFA;&#x534F;&#x7A0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">// &#x65B9;&#x6CD5;&#x4E00;&#xFF0C;&#x4F7F;&#x7528; runBlocking &#x9876;&#x5C42;&#x51FD;&#x6570;</span><br><span class="line">runBlocking {</span><br><span class="line">    getImage(imageId)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// &#x65B9;&#x6CD5;&#x4E8C;&#xFF0C;&#x4F7F;&#x7528; GlobalScope &#x5355;&#x4F8B;&#x5BF9;&#x8C61;</span><br><span class="line">//            &#x1F447; &#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8C03;&#x7528; launch &#x5F00;&#x542F;&#x534F;&#x7A0B;</span><br><span class="line">GlobalScope.launch {</span><br><span class="line">    getImage(imageId)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// &#x65B9;&#x6CD5;&#x4E09;&#xFF0C;&#x81EA;&#x884C;&#x901A;&#x8FC7; CoroutineContext &#x521B;&#x5EFA;&#x4E00;&#x4E2A; CoroutineScope &#x5BF9;&#x8C61;</span><br><span class="line">//                                    &#x1F447; &#x9700;&#x8981;&#x4E00;&#x4E2A;&#x7C7B;&#x578B;&#x4E3A; CoroutineContext &#x7684;&#x53C2;&#x6570;</span><br><span class="line">val coroutineScope = CoroutineScope(context)</span><br><span class="line">coroutineScope.launch {</span><br><span class="line">    getImage(imageId)</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<ul>
<li>&#x65B9;&#x6CD5;&#x4E00;&#x901A;&#x5E38;&#x9002;&#x7528;&#x4E8E;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x7684;&#x573A;&#x666F;&#xFF0C;&#x800C;&#x4E1A;&#x52A1;&#x5F00;&#x53D1;&#x4E2D;&#x4E0D;&#x4F1A;&#x7528;&#x5230;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x662F;&#x7EBF;&#x7A0B;&#x963B;&#x585E;&#x7684;&#x3002;</li>
<li>&#x65B9;&#x6CD5;&#x4E8C;&#x548C;&#x4F7F;&#x7528; <code>runBlocking</code> &#x7684;&#x533A;&#x522B;&#x5728;&#x4E8E;&#x4E0D;&#x4F1A;&#x963B;&#x585E;&#x7EBF;&#x7A0B;&#x3002;&#x4F46;&#x5728; Android &#x5F00;&#x53D1;&#x4E2D;&#x540C;&#x6837;&#x4E0D;&#x63A8;&#x8350;&#x8FD9;&#x79CD;&#x7528;&#x6CD5;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x4F1A;&#x548C; app &#x4E00;&#x81F4;&#xFF0C;&#x4E14;&#x4E0D;&#x80FD;&#x53D6;&#x6D88;&#xFF08;&#x4EC0;&#x4E48;&#x662F;&#x534F;&#x7A0B;&#x7684;&#x53D6;&#x6D88;&#x540E;&#x9762;&#x7684;&#x6587;&#x7AE0;&#x4F1A;&#x8BB2;&#xFF09;&#x3002;</li>
<li>&#x65B9;&#x6CD5;&#x4E09;&#x662F;&#x6BD4;&#x8F83;&#x63A8;&#x8350;&#x7684;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>context</code> &#x53C2;&#x6570;&#x53BB;&#x7BA1;&#x7406;&#x548C;&#x63A7;&#x5236;&#x534F;&#x7A0B;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#xFF08;&#x8FD9;&#x91CC;&#x7684; <code>context</code> &#x548C; Android &#x91CC;&#x7684;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x4E1C;&#x897F;&#xFF0C;&#x662F;&#x4E00;&#x4E2A;&#x66F4;&#x901A;&#x7528;&#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x4F1A;&#x6709;&#x4E00;&#x4E2A; Android &#x5E73;&#x53F0;&#x7684;&#x5C01;&#x88C5;&#x6765;&#x914D;&#x5408;&#x4F7F;&#x7528;&#xFF09;&#x3002;</li>
</ul>
<p>&#x5173;&#x4E8E; <code>CoroutineScope</code> &#x548C; <code>CoroutineContext</code> &#x7684;&#x66F4;&#x591A;&#x5185;&#x5BB9;&#x540E;&#x9762;&#x7684;&#x6587;&#x7AE0;&#x518D;&#x8BB2;&#x3002;</p>
<p>&#x534F;&#x7A0B;&#x6700;&#x5E38;&#x7528;&#x7684;&#x529F;&#x80FD;&#x662F;&#x5E76;&#x53D1;&#xFF0C;&#x800C;&#x5E76;&#x53D1;&#x7684;&#x5178;&#x578B;&#x573A;&#x666F;&#x5C31;&#x662F;&#x591A;&#x7EBF;&#x7A0B;&#x3002;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>Dispatchers.IO</code> &#x53C2;&#x6570;&#x628A;&#x4EFB;&#x52A1;&#x5207;&#x5230; IO &#x7EBF;&#x7A0B;&#x6267;&#x884C;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">coroutineScope.launch(Dispatchers.IO) {</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>Dispatchers.Main</code> &#x53C2;&#x6570;&#x5207;&#x6362;&#x5230;&#x4E3B;&#x7EBF;&#x7A0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">coroutineScope.launch(Dispatchers.Main) {</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x6240;&#x4EE5;&#x5728;&#x300C;&#x534F;&#x7A0B;&#x662F;&#x4EC0;&#x4E48;&#x300D;&#x4E00;&#x8282;&#x4E2D;&#x8BB2;&#x5230;&#x7684;&#x5F02;&#x6B65;&#x8BF7;&#x6C42;&#x7684;&#x4F8B;&#x5B50;&#x5B8C;&#x6574;&#x5199;&#x51FA;&#x6765;&#x662F;&#x8FD9;&#x6837;&#x7684;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">coroutineScope.launch(Dispatchers.Main) {   // &#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x5F00;&#x542F;&#x534F;&#x7A0B;</span><br><span class="line">    val user = api.getUser() // IO &#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;</span><br><span class="line">    nameTv.text = user.name  // &#x4E3B;&#x7EBF;&#x7A0B;&#x66F4;&#x65B0; UI</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x800C;&#x901A;&#x8FC7; Java &#x5B9E;&#x73B0;&#x4EE5;&#x4E0A;&#x903B;&#x8F91;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x5E38;&#x9700;&#x8981;&#x8FD9;&#x6837;&#x5199;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;&#x2615;&#xFE0F;</span><br><span class="line">api.getUser(new Callback&lt;User&gt;() {</span><br><span class="line">    @Override</span><br><span class="line">    public void success(User user) {</span><br><span class="line">        runOnUiThread(new Runnable() {</span><br><span class="line">            @Override</span><br><span class="line">            public void run() {</span><br><span class="line">                nameTv.setText(user.name);</span><br><span class="line">            }</span><br><span class="line">        })</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public void failure(Exception e) {</span><br><span class="line">        ...</span><br><span class="line">    }</span><br><span class="line">});</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x79CD;&#x56DE;&#x8C03;&#x5F0F;&#x7684;&#x5199;&#x6CD5;&#xFF0C;&#x6253;&#x7834;&#x4E86;&#x4EE3;&#x7801;&#x7684;&#x987A;&#x5E8F;&#x7ED3;&#x6784;&#x548C;&#x5B8C;&#x6574;&#x6027;&#xFF0C;&#x8BFB;&#x8D77;&#x6765;&#x76F8;&#x5F53;&#x96BE;&#x53D7;&#x3002;</p>
<h4 id="&#x534F;&#x7A0B;&#x7684;&#x300C;1-&#x5230;-0&#x300D;"><a href="#&#x534F;&#x7A0B;&#x7684;&#x300C;1-&#x5230;-0&#x300D;" class="headerlink" title="&#x534F;&#x7A0B;&#x7684;&#x300C;1 &#x5230; 0&#x300D;"></a>&#x534F;&#x7A0B;&#x7684;&#x300C;1 &#x5230; 0&#x300D;</h4><p>&#x5BF9;&#x4E8E;&#x56DE;&#x8C03;&#x5F0F;&#x7684;&#x5199;&#x6CD5;&#xFF0C;&#x5982;&#x679C;&#x5E76;&#x53D1;&#x573A;&#x666F;&#x518D;&#x590D;&#x6742;&#x4E00;&#x4E9B;&#xFF0C;&#x4EE3;&#x7801;&#x7684;&#x5D4C;&#x5957;&#x53EF;&#x80FD;&#x4F1A;&#x66F4;&#x591A;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#x7EF4;&#x62A4;&#x8D77;&#x6765;&#x5C31;&#x975E;&#x5E38;&#x9EBB;&#x70E6;&#x3002;&#x4F46;&#x5982;&#x679C;&#x4F60;&#x4F7F;&#x7528;&#x4E86; Kotlin &#x534F;&#x7A0B;&#xFF0C;&#x591A;&#x5C42;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x53EA;&#x9700;&#x8981;&#x8FD9;&#x4E48;&#x5199;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">coroutineScope.launch(Dispatchers.Main) {       // &#x5F00;&#x59CB;&#x534F;&#x7A0B;&#xFF1A;&#x4E3B;&#x7EBF;&#x7A0B;</span><br><span class="line">    val token = api.getToken()                  // &#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#xFF1A;IO &#x7EBF;&#x7A0B;</span><br><span class="line">    val user = api.getUser(token)               // &#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#xFF1A;IO &#x7EBF;&#x7A0B;</span><br><span class="line">    nameTv.text = user.name                     // &#x66F4;&#x65B0; UI&#xFF1A;&#x4E3B;&#x7EBF;&#x7A0B;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5982;&#x679C;&#x9047;&#x5230;&#x7684;&#x573A;&#x666F;&#x662F;&#x591A;&#x4E2A;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x9700;&#x8981;&#x7B49;&#x5F85;&#x6240;&#x6709;&#x8BF7;&#x6C42;&#x7ED3;&#x675F;&#x4E4B;&#x540E;&#x518D;&#x5BF9; UI &#x8FDB;&#x884C;&#x66F4;&#x65B0;&#x3002;&#x6BD4;&#x5982;&#x4EE5;&#x4E0B;&#x4E24;&#x4E2A;&#x8BF7;&#x6C42;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">api.getAvatar(user, callback)</span><br><span class="line">api.getCompanyLogo(user, callback)</span><br></pre></td></tr></table></figure>

<p>&#x5982;&#x679C;&#x4F7F;&#x7528;&#x56DE;&#x8C03;&#x5F0F;&#x7684;&#x5199;&#x6CD5;&#xFF0C;&#x90A3;&#x4E48;&#x4EE3;&#x7801;&#x53EF;&#x80FD;&#x5199;&#x8D77;&#x6765;&#x65E2;&#x56F0;&#x96BE;&#x53C8;&#x522B;&#x626D;&#x3002;&#x4E8E;&#x662F;&#x6211;&#x4EEC;&#x53EF;&#x80FD;&#x4F1A;&#x9009;&#x62E9;&#x59A5;&#x534F;&#xFF0C;&#x901A;&#x8FC7;&#x5148;&#x540E;&#x8BF7;&#x6C42;&#x4EE3;&#x66FF;&#x540C;&#x65F6;&#x8BF7;&#x6C42;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">api.getAvatar(user) { avatar -&gt;</span><br><span class="line">    api.getCompanyLogo(user) { logo -&gt;</span><br><span class="line">        show(merge(avatar, logo))</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5728;&#x5B9E;&#x9645;&#x5F00;&#x53D1;&#x4E2D;&#x5982;&#x679C;&#x8FD9;&#x6837;&#x5199;&#xFF0C;&#x672C;&#x6765;&#x80FD;&#x591F;&#x5E76;&#x884C;&#x5904;&#x7406;&#x7684;&#x8BF7;&#x6C42;&#x88AB;&#x5F3A;&#x5236;&#x901A;&#x8FC7;&#x4E32;&#x884C;&#x7684;&#x65B9;&#x5F0F;&#x53BB;&#x5B9E;&#x73B0;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x5BFC;&#x81F4;&#x7B49;&#x5F85;&#x65F6;&#x95F4;&#x957F;&#x4E86;&#x4E00;&#x500D;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6027;&#x80FD;&#x5DEE;&#x4E86;&#x4E00;&#x500D;&#x3002;</p>
<p>&#x800C;&#x5982;&#x679C;&#x4F7F;&#x7528;&#x534F;&#x7A0B;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x628A;&#x4E24;&#x4E2A;&#x5E76;&#x884C;&#x8BF7;&#x6C42;&#x5199;&#x6210;&#x4E0A;&#x4E0B;&#x4E24;&#x884C;&#xFF0C;&#x6700;&#x540E;&#x518D;&#x628A;&#x7ED3;&#x679C;&#x8FDB;&#x884C;&#x5408;&#x5E76;&#x5373;&#x53EF;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">coroutineScope.launch(Dispatchers.Main) {</span><br><span class="line">    //            &#x1F447;  async &#x51FD;&#x6570;&#x4E4B;&#x540E;&#x518D;&#x8BB2;</span><br><span class="line">    val avatar = async { api.getAvatar(user) }    // &#x83B7;&#x53D6;&#x7528;&#x6237;&#x5934;&#x50CF;</span><br><span class="line">    val logo = async { api.getCompanyLogo(user) } // &#x83B7;&#x53D6;&#x7528;&#x6237;&#x6240;&#x5728;&#x516C;&#x53F8;&#x7684; logo</span><br><span class="line">    val merged = suspendingMerge(avatar, logo)    // &#x5408;&#x5E76;&#x7ED3;&#x679C;</span><br><span class="line">    //                  &#x1F446;</span><br><span class="line">    show(merged) // &#x66F4;&#x65B0; UI</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x5373;&#x4FBF;&#x662F;&#x6BD4;&#x8F83;&#x590D;&#x6742;&#x7684;&#x5E76;&#x884C;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#xFF0C;&#x4E5F;&#x80FD;&#x591F;&#x901A;&#x8FC7;&#x534F;&#x7A0B;&#x5199;&#x51FA;&#x7ED3;&#x6784;&#x6E05;&#x6670;&#x7684;&#x4EE3;&#x7801;&#x3002;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F; <code>suspendingMerge</code> &#x5E76;&#x4E0D;&#x662F;&#x534F;&#x7A0B; API &#x4E2D;&#x63D0;&#x4F9B;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x800C;&#x662F;&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x4E00;&#x4E2A;&#x53EF;&#x300C;&#x6302;&#x8D77;&#x300D;&#x7684;&#x7ED3;&#x679C;&#x5408;&#x5E76;&#x65B9;&#x6CD5;&#x3002;&#x81F3;&#x4E8E;&#x6302;&#x8D77;&#x5177;&#x4F53;&#x662F;&#x4EC0;&#x4E48;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x4E0B;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;&#x3002;</p>
<p>&#x8BA9;&#x590D;&#x6742;&#x7684;&#x5E76;&#x53D1;&#x4EE3;&#x7801;&#xFF0C;&#x5199;&#x8D77;&#x6765;&#x53D8;&#x5F97;&#x7B80;&#x5355;&#x4E14;&#x6E05;&#x6670;&#xFF0C;&#x662F;&#x534F;&#x7A0B;&#x7684;&#x4F18;&#x52BF;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#xFF0C;&#x4E24;&#x4E2A;&#x6CA1;&#x6709;&#x76F8;&#x5173;&#x6027;&#x7684;&#x540E;&#x53F0;&#x4EFB;&#x52A1;&#xFF0C;&#x56E0;&#x4E3A;&#x7528;&#x4E86;&#x534F;&#x7A0B;&#xFF0C;&#x88AB;&#x5B89;&#x6392;&#x5F97;&#x660E;&#x660E;&#x767D;&#x767D;&#xFF0C;&#x4E92;&#x76F8;&#x4E4B;&#x95F4;&#x914D;&#x5408;&#x5F97;&#x5F88;&#x597D;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x4E4B;&#x524D;&#x8BF4;&#x7684;&#x300C;&#x534F;&#x4F5C;&#x5F0F;&#x4EFB;&#x52A1;&#x300D;&#x3002;</p>
<p>&#x672C;&#x6765;&#x9700;&#x8981;&#x56DE;&#x8C03;&#xFF0C;&#x73B0;&#x5728;&#x76F4;&#x63A5;&#x6CA1;&#x6709;&#x56DE;&#x8C03;&#x4E86;&#xFF0C;&#x8FD9;&#x79CD;&#x4ECE; 1 &#x5230; 0 &#x7684;&#x8BBE;&#x8BA1;&#x601D;&#x60F3;&#x771F;&#x7684;&#x5999;&#x54C9;&#x3002;</p>
<p>&#x5728;&#x4E86;&#x89E3;&#x4E86;&#x534F;&#x7A0B;&#x7684;&#x4F5C;&#x7528;&#x548C;&#x4F18;&#x52BF;&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x518D;&#x6765;&#x770B;&#x770B;&#x534F;&#x7A0B;&#x662F;&#x600E;&#x4E48;&#x4F7F;&#x7528;&#x7684;&#x3002;</p>
<h3 id="&#x534F;&#x7A0B;&#x600E;&#x4E48;&#x7528;"><a href="#&#x534F;&#x7A0B;&#x600E;&#x4E48;&#x7528;" class="headerlink" title="&#x534F;&#x7A0B;&#x600E;&#x4E48;&#x7528;"></a>&#x534F;&#x7A0B;&#x600E;&#x4E48;&#x7528;</h3><h4 id="&#x5728;&#x9879;&#x76EE;&#x4E2D;&#x914D;&#x7F6E;&#x5BF9;-Kotlin-&#x534F;&#x7A0B;&#x7684;&#x652F;&#x6301;"><a href="#&#x5728;&#x9879;&#x76EE;&#x4E2D;&#x914D;&#x7F6E;&#x5BF9;-Kotlin-&#x534F;&#x7A0B;&#x7684;&#x652F;&#x6301;" class="headerlink" title="&#x5728;&#x9879;&#x76EE;&#x4E2D;&#x914D;&#x7F6E;&#x5BF9; Kotlin &#x534F;&#x7A0B;&#x7684;&#x652F;&#x6301;"></a>&#x5728;&#x9879;&#x76EE;&#x4E2D;&#x914D;&#x7F6E;&#x5BF9; Kotlin &#x534F;&#x7A0B;&#x7684;&#x652F;&#x6301;</h4><p>&#x5728;&#x4F7F;&#x7528;&#x534F;&#x7A0B;&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5728; <code>build.gradle</code> &#x6587;&#x4EF6;&#x4E2D;&#x589E;&#x52A0;&#x5BF9; Kotlin &#x534F;&#x7A0B;&#x7684;&#x4F9D;&#x8D56;&#xFF1A;</p>
<ul>
<li>&#x9879;&#x76EE;&#x6839;&#x76EE;&#x5F55;&#x4E0B;&#x7684; <code>build.gradle</code> :</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">groovy&#x590D;&#x5236;&#x4EE3;&#x7801;buildscript {</span><br><span class="line">    ...</span><br><span class="line">    // &#x1F447;</span><br><span class="line">    ext.kotlin_coroutines = &apos;1.3.1&apos;</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<ul>
<li>Module &#x4E0B;&#x7684; <code>build.gradle</code> :</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">groovy&#x590D;&#x5236;&#x4EE3;&#x7801;dependencies {</span><br><span class="line">    ...</span><br><span class="line">    //                                       &#x1F447; &#x4F9D;&#x8D56;&#x534F;&#x7A0B;&#x6838;&#x5FC3;&#x5E93;</span><br><span class="line">    implementation &quot;org.jetbrains.kotlinx:kotlinx-coroutines-core:$kotlin_coroutines&quot;</span><br><span class="line">    //                                       &#x1F447; &#x4F9D;&#x8D56;&#x5F53;&#x524D;&#x5E73;&#x53F0;&#x6240;&#x5BF9;&#x5E94;&#x7684;&#x5E73;&#x53F0;&#x5E93;</span><br><span class="line">    implementation &quot;org.jetbrains.kotlinx:kotlinx-coroutines-android:$kotlin_coroutines&quot;</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>Kotlin &#x534F;&#x7A0B;&#x662F;&#x4EE5;&#x5B98;&#x65B9;&#x6269;&#x5C55;&#x5E93;&#x7684;&#x5F62;&#x5F0F;&#x8FDB;&#x884C;&#x652F;&#x6301;&#x7684;&#x3002;&#x800C;&#x4E14;&#xFF0C;&#x6211;&#x4EEC;&#x6240;&#x4F7F;&#x7528;&#x7684;&#x300C;&#x6838;&#x5FC3;&#x5E93;&#x300D;&#x548C; &#x300C;&#x5E73;&#x53F0;&#x5E93;&#x300D;&#x7684;&#x7248;&#x672C;&#x5E94;&#x8BE5;&#x4FDD;&#x6301;&#x4E00;&#x81F4;&#x3002;</p>
<ul>
<li>&#x6838;&#x5FC3;&#x5E93;&#x4E2D;&#x5305;&#x542B;&#x7684;&#x4EE3;&#x7801;&#x4E3B;&#x8981;&#x662F;&#x534F;&#x7A0B;&#x7684;&#x516C;&#x5171; API &#x90E8;&#x5206;&#x3002;&#x6709;&#x4E86;&#x8FD9;&#x4E00;&#x5C42;&#x516C;&#x5171;&#x4EE3;&#x7801;&#xFF0C;&#x624D;&#x4F7F;&#x5F97;&#x534F;&#x7A0B;&#x5728;&#x5404;&#x4E2A;&#x5E73;&#x53F0;&#x4E0A;&#x7684;&#x63A5;&#x53E3;&#x5F97;&#x5230;&#x7EDF;&#x4E00;&#x3002;</li>
<li>&#x5E73;&#x53F0;&#x5E93;&#x4E2D;&#x5305;&#x542B;&#x7684;&#x4EE3;&#x7801;&#x4E3B;&#x8981;&#x662F;&#x534F;&#x7A0B;&#x6846;&#x67B6;&#x5728;&#x5177;&#x4F53;&#x5E73;&#x53F0;&#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#x3002;&#x56E0;&#x4E3A;&#x591A;&#x7EBF;&#x7A0B;&#x5728;&#x5404;&#x4E2A;&#x5E73;&#x53F0;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#x662F;&#x6709;&#x6240;&#x5DEE;&#x5F02;&#x7684;&#x3002;</li>
</ul>
<p>&#x5B8C;&#x6210;&#x4E86;&#x4EE5;&#x4E0A;&#x7684;&#x51C6;&#x5907;&#x5DE5;&#x4F5C;&#x5C31;&#x53EF;&#x4EE5;&#x5F00;&#x59CB;&#x4F7F;&#x7528;&#x534F;&#x7A0B;&#x4E86;&#x3002;</p>
<h4 id="&#x5F00;&#x59CB;&#x4F7F;&#x7528;&#x534F;&#x7A0B;"><a href="#&#x5F00;&#x59CB;&#x4F7F;&#x7528;&#x534F;&#x7A0B;" class="headerlink" title="&#x5F00;&#x59CB;&#x4F7F;&#x7528;&#x534F;&#x7A0B;"></a>&#x5F00;&#x59CB;&#x4F7F;&#x7528;&#x534F;&#x7A0B;</h4><p>&#x534F;&#x7A0B;&#x6700;&#x7B80;&#x5355;&#x7684;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#xFF0C;&#x5176;&#x5B9E;&#x5728;&#x524D;&#x9762;&#x7AE0;&#x8282;&#x5C31;&#x5DF2;&#x7ECF;&#x770B;&#x5230;&#x4E86;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E00;&#x4E2A; <code>launch</code> &#x51FD;&#x6570;&#x5B9E;&#x73B0;&#x7EBF;&#x7A0B;&#x5207;&#x6362;&#x7684;&#x529F;&#x80FD;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">//               &#x1F447;</span><br><span class="line">coroutineScope.launch(Dispatchers.IO) {</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x4E2A; <code>launch</code> &#x51FD;&#x6570;&#xFF0C;&#x5B83;&#x5177;&#x4F53;&#x7684;&#x542B;&#x4E49;&#x662F;&#xFF1A;&#x6211;&#x8981;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x534F;&#x7A0B;&#xFF0C;&#x5E76;&#x5728;&#x6307;&#x5B9A;&#x7684;&#x7EBF;&#x7A0B;&#x4E0A;&#x8FD0;&#x884C;&#x5B83;&#x3002;&#x8FD9;&#x4E2A;&#x88AB;&#x521B;&#x5EFA;&#x3001;&#x88AB;&#x8FD0;&#x884C;&#x7684;&#x6240;&#x8C13;&#x300C;&#x534F;&#x7A0B;&#x300D;&#x662F;&#x8C01;&#xFF1F;&#x5C31;&#x662F;&#x4F60;&#x4F20;&#x7ED9; <code>launch</code> &#x7684;&#x90A3;&#x4E9B;&#x4EE3;&#x7801;&#xFF0C;&#x8FD9;&#x4E00;&#x6BB5;&#x8FDE;&#x7EED;&#x4EE3;&#x7801;&#x53EB;&#x505A;&#x4E00;&#x4E2A;&#x300C;&#x534F;&#x7A0B;&#x300D;&#x3002;</p>
<p>&#x6240;&#x4EE5;&#xFF0C;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x7528;&#x534F;&#x7A0B;&#xFF1F;&#x5F53;&#x4F60;&#x9700;&#x8981;&#x5207;&#x7EBF;&#x7A0B;&#x6216;&#x8005;&#x6307;&#x5B9A;&#x7EBF;&#x7A0B;&#x7684;&#x65F6;&#x5019;&#x3002;&#x4F60;&#x8981;&#x5728;&#x540E;&#x53F0;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#xFF1F;&#x5207;&#xFF01;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">launch(Dispatchers.IO) {</span><br><span class="line">    val image = getImage(imageId)</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x7136;&#x540E;&#x9700;&#x8981;&#x5728;&#x524D;&#x53F0;&#x66F4;&#x65B0;&#x754C;&#x9762;&#xFF1F;&#x518D;&#x5207;&#xFF01;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">coroutineScope.launch(Dispatchers.IO) {</span><br><span class="line">    val image = getImage(imageId)</span><br><span class="line">    launch(Dispatch.Main) {</span><br><span class="line">        avatarIv.setImageBitmap(image)</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x597D;&#x50CF;&#x6709;&#x70B9;&#x4E0D;&#x5BF9;&#x52B2;&#xFF1F;&#x8FD9;&#x4E0D;&#x8FD8;&#x662F;&#x6709;&#x5D4C;&#x5957;&#x561B;&#x3002;</p>
<p>&#x5982;&#x679C;&#x53EA;&#x662F;&#x4F7F;&#x7528; <code>launch</code> &#x51FD;&#x6570;&#xFF0C;&#x534F;&#x7A0B;&#x5E76;&#x4E0D;&#x80FD;&#x6BD4;&#x7EBF;&#x7A0B;&#x505A;&#x66F4;&#x591A;&#x7684;&#x4E8B;&#x3002;&#x4E0D;&#x8FC7;&#x534F;&#x7A0B;&#x4E2D;&#x5374;&#x6709;&#x4E00;&#x4E2A;&#x5F88;&#x5B9E;&#x7528;&#x7684;&#x51FD;&#x6570;&#xFF1A;<code>withContext</code> &#x3002;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x53EF;&#x4EE5;&#x5207;&#x6362;&#x5230;&#x6307;&#x5B9A;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x5E76;&#x5728;&#x95ED;&#x5305;&#x5185;&#x7684;&#x903B;&#x8F91;&#x6267;&#x884C;&#x7ED3;&#x675F;&#x4E4B;&#x540E;&#xFF0C;&#x81EA;&#x52A8;&#x628A;&#x7EBF;&#x7A0B;&#x5207;&#x56DE;&#x53BB;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#x3002;&#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x5C06;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x5199;&#x6210;&#x8FD9;&#x6837;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">coroutineScope.launch(Dispatchers.Main) {      // &#x1F448; &#x5728; UI &#x7EBF;&#x7A0B;&#x5F00;&#x59CB;</span><br><span class="line">    val image = withContext(Dispatchers.IO) {  // &#x1F448; &#x5207;&#x6362;&#x5230; IO &#x7EBF;&#x7A0B;&#xFF0C;&#x5E76;&#x5728;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x540E;&#x5207;&#x56DE; UI &#x7EBF;&#x7A0B;</span><br><span class="line">        getImage(imageId)                      // &#x1F448; &#x5C06;&#x4F1A;&#x8FD0;&#x884C;&#x5728; IO &#x7EBF;&#x7A0B;</span><br><span class="line">    }</span><br><span class="line">    avatarIv.setImageBitmap(image)             // &#x1F448; &#x56DE;&#x5230; UI &#x7EBF;&#x7A0B;&#x66F4;&#x65B0; UI</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x79CD;&#x5199;&#x6CD5;&#x770B;&#x4E0A;&#x53BB;&#x597D;&#x50CF;&#x548C;&#x521A;&#x624D;&#x90A3;&#x79CD;&#x533A;&#x522B;&#x4E0D;&#x5927;&#xFF0C;&#x4F46;&#x5982;&#x679C;&#x4F60;&#x9700;&#x8981;&#x9891;&#x7E41;&#x5730;&#x8FDB;&#x884C;&#x7EBF;&#x7A0B;&#x5207;&#x6362;&#xFF0C;&#x8FD9;&#x79CD;&#x5199;&#x6CD5;&#x7684;&#x4F18;&#x52BF;&#x5C31;&#x4F1A;&#x4F53;&#x73B0;&#x51FA;&#x6765;&#x3002;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x4E0B;&#x9762;&#x7684;&#x5BF9;&#x6BD4;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">// &#x7B2C;&#x4E00;&#x79CD;&#x5199;&#x6CD5;</span><br><span class="line">coroutineScope.launch(Dispachers.IO) {</span><br><span class="line">    ...</span><br><span class="line">    launch(Dispachers.Main){</span><br><span class="line">        ...</span><br><span class="line">        launch(Dispachers.IO) {</span><br><span class="line">            ...</span><br><span class="line">            launch(Dispacher.Main) {</span><br><span class="line">                ...</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// &#x901A;&#x8FC7;&#x7B2C;&#x4E8C;&#x79CD;&#x5199;&#x6CD5;&#x6765;&#x5B9E;&#x73B0;&#x76F8;&#x540C;&#x7684;&#x903B;&#x8F91;</span><br><span class="line">coroutineScope.launch(Dispachers.Main) {</span><br><span class="line">    ...</span><br><span class="line">    withContext(Dispachers.IO) {</span><br><span class="line">        ...</span><br><span class="line">    }</span><br><span class="line">    ...</span><br><span class="line">    withContext(Dispachers.IO) {</span><br><span class="line">        ...</span><br><span class="line">    }</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x7531;&#x4E8E;&#x53EF;&#x4EE5;&#x201D;&#x81EA;&#x52A8;&#x5207;&#x56DE;&#x6765;&#x201D;&#xFF0C;&#x6D88;&#x9664;&#x4E86;&#x5E76;&#x53D1;&#x4EE3;&#x7801;&#x5728;&#x534F;&#x4F5C;&#x65F6;&#x7684;&#x5D4C;&#x5957;&#x3002;&#x7531;&#x4E8E;&#x6D88;&#x9664;&#x4E86;&#x5D4C;&#x5957;&#x5173;&#x7CFB;&#xFF0C;&#x6211;&#x4EEC;&#x751A;&#x81F3;&#x53EF;&#x4EE5;&#x628A; <code>withContext</code> &#x653E;&#x8FDB;&#x4E00;&#x4E2A;&#x5355;&#x72EC;&#x7684;&#x51FD;&#x6570;&#x91CC;&#x9762;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">launch(Dispachers.Main) {              // &#x1F448; &#x5728; UI &#x7EBF;&#x7A0B;&#x5F00;&#x59CB;</span><br><span class="line">    val image = getImage(imageId)</span><br><span class="line">    avatarIv.setImageBitmap(image)     // &#x1F448; &#x6267;&#x884C;&#x7ED3;&#x675F;&#x540E;&#xFF0C;&#x81EA;&#x52A8;&#x5207;&#x6362;&#x56DE; UI &#x7EBF;&#x7A0B;</span><br><span class="line">}</span><br><span class="line">//                               &#x1F447;</span><br><span class="line">fun getImage(imageId: Int) = withContext(Dispatchers.IO) {</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x5C31;&#x662F;&#x4E4B;&#x524D;&#x8BF4;&#x7684;&#x300C;&#x7528;&#x540C;&#x6B65;&#x7684;&#x65B9;&#x5F0F;&#x5199;&#x5F02;&#x6B65;&#x7684;&#x4EE3;&#x7801;&#x300D;&#x4E86;&#x3002;</p>
<p>&#x4E0D;&#x8FC7;&#x5982;&#x679C;&#x53EA;&#x662F;&#x8FD9;&#x6837;&#x5199;&#xFF0C;&#x7F16;&#x8BD1;&#x5668;&#x662F;&#x4F1A;&#x62A5;&#x9519;&#x7684;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">fun getImage(imageId: Int) = withContext(Dispatchers.IO) {</span><br><span class="line">    // IDE &#x62A5;&#x9519; Suspend function&apos;withContext&apos; should be called only from a coroutine or another suspend funcion</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x610F;&#x601D;&#x662F;&#x8BF4;&#xFF0C;<code>withContext</code> &#x662F;&#x4E00;&#x4E2A; <code>suspend</code> &#x51FD;&#x6570;&#xFF0C;&#x5B83;&#x9700;&#x8981;&#x5728;&#x534F;&#x7A0B;&#x6216;&#x8005;&#x662F;&#x53E6;&#x4E00;&#x4E2A; <code>suspend</code> &#x51FD;&#x6570;&#x4E2D;&#x8C03;&#x7528;&#x3002;</p>
<h3 id="suspend"><a href="#suspend" class="headerlink" title="suspend"></a>suspend</h3><p><code>suspend</code> &#x662F; Kotlin &#x534F;&#x7A0B;&#x6700;&#x6838;&#x5FC3;&#x7684;&#x5173;&#x952E;&#x5B57;&#xFF0C;&#x51E0;&#x4E4E;&#x6240;&#x6709;&#x4ECB;&#x7ECD; Kotlin &#x534F;&#x7A0B;&#x7684;&#x6587;&#x7AE0;&#x548C;&#x6F14;&#x8BB2;&#x90FD;&#x4F1A;&#x63D0;&#x5230;&#x5B83;&#x3002;&#x5B83;&#x7684;&#x4E2D;&#x6587;&#x610F;&#x601D;&#x662F;&#x300C;&#x6682;&#x505C;&#x300D;&#x6216;&#x8005;&#x300C;&#x53EF;&#x6302;&#x8D77;&#x300D;&#x3002;&#x5982;&#x679C;&#x4F60;&#x53BB;&#x770B;&#x4E00;&#x4E9B;&#x6280;&#x672F;&#x535A;&#x5BA2;&#x6216;&#x5B98;&#x65B9;&#x6587;&#x6863;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5927;&#x6982;&#x53EF;&#x4EE5;&#x4E86;&#x89E3;&#x5230;&#xFF1A;&#x300C;&#x4EE3;&#x7801;&#x6267;&#x884C;&#x5230; <code>suspend</code> &#x51FD;&#x6570;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x300E;&#x6302;&#x8D77;&#x300F;&#xFF0C;&#x5E76;&#x4E14;&#x8FD9;&#x4E2A;&#x300E;&#x6302;&#x8D77;&#x300F;&#x662F;&#x975E;&#x963B;&#x585E;&#x5F0F;&#x7684;&#xFF0C;&#x5B83;&#x4E0D;&#x4F1A;&#x963B;&#x585E;&#x4F60;&#x5F53;&#x524D;&#x7684;&#x7EBF;&#x7A0B;&#x3002;&#x300D;</p>
<p>&#x4E0A;&#x9762;&#x62A5;&#x9519;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x5176;&#x5B9E;&#x53EA;&#x9700;&#x8981;&#x5728;&#x524D;&#x9762;&#x52A0;&#x4E00;&#x4E2A; <code>suspend</code> &#x5C31;&#x80FD;&#x591F;&#x7F16;&#x8BD1;&#x901A;&#x8FC7;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kotlin&#x590D;&#x5236;&#x4EE3;&#x7801;&#x1F3DD;&#xFE0F;</span><br><span class="line">//&#x1F447;</span><br><span class="line">suspend fun getImage(imageId: Int) = withContext(Dispatchers.IO) {</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x672C;&#x7BC7;&#x6587;&#x7AE0;&#x5230;&#x6B64;&#x7ED3;&#x675F;&#xFF0C;&#x800C; <code>suspend</code> &#x5177;&#x4F53;&#x662F;&#x4EC0;&#x4E48;&#xFF0C;&#x300C;&#x975E;&#x963B;&#x585E;&#x5F0F;&#x300D;&#x53C8;&#x662F;&#x600E;&#x4E48;&#x56DE;&#x4E8B;&#xFF0C;&#x51FD;&#x6570;&#x600E;&#x4E48;&#x88AB;&#x6302;&#x8D77;&#xFF0C;&#x8FD9;&#x4E9B;&#x7591;&#x95EE;&#x7684;&#x7B54;&#x6848;&#xFF0C;&#x5C06;&#x5728;&#x4E0B;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;&#x5168;&#x90E8;&#x63ED;&#x6653;&#x3002;</p>
<h2 id="&#x7EC3;&#x4E60;&#x9898;"><a href="#&#x7EC3;&#x4E60;&#x9898;" class="headerlink" title="&#x7EC3;&#x4E60;&#x9898;"></a>&#x7EC3;&#x4E60;&#x9898;</h2><ol>
<li>&#x5F00;&#x542F;&#x4E00;&#x4E2A;&#x534F;&#x7A0B;&#xFF0C;&#x5E76;&#x5728;&#x534F;&#x7A0B;&#x4E2D;&#x6253;&#x5370;&#x51FA;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x540D;&#x3002;</li>
<li>&#x901A;&#x8FC7;&#x534F;&#x7A0B;&#x4E0B;&#x8F7D;&#x4E00;&#x5F20;&#x7F51;&#x7EDC;&#x56FE;&#x7247;&#x5E76;&#x663E;&#x793A;&#x51FA;&#x6765;&#x3002;</li>
</ol>
<h3 id="&#x4F5C;&#x8005;&#x4ECB;&#x7ECD;"><a href="#&#x4F5C;&#x8005;&#x4ECB;&#x7ECD;" class="headerlink" title="&#x4F5C;&#x8005;&#x4ECB;&#x7ECD;"></a>&#x4F5C;&#x8005;&#x4ECB;&#x7ECD;</h3><h4 id="&#x89C6;&#x9891;&#x4F5C;&#x8005;"><a href="#&#x89C6;&#x9891;&#x4F5C;&#x8005;" class="headerlink" title="&#x89C6;&#x9891;&#x4F5C;&#x8005;"></a>&#x89C6;&#x9891;&#x4F5C;&#x8005;</h4><h5 id="&#x6254;&#x7269;&#x7EBF;&#xFF08;&#x6731;&#x51EF;&#xFF09;"><a href="#&#x6254;&#x7269;&#x7EBF;&#xFF08;&#x6731;&#x51EF;&#xFF09;" class="headerlink" title="&#x6254;&#x7269;&#x7EBF;&#xFF08;&#x6731;&#x51EF;&#xFF09;"></a>&#x6254;&#x7269;&#x7EBF;&#xFF08;&#x6731;&#x51EF;&#xFF09;</h5><ul>
<li>&#x7801;&#x4E0A;&#x5F00;&#x5B66;&#x521B;&#x59CB;&#x4EBA;&#x3001;&#x9879;&#x76EE;&#x7BA1;&#x7406;&#x4EBA;&#x3001;&#x5185;&#x5BB9;&#x6A21;&#x5757;&#x89C4;&#x5212;&#x8005;&#x548C;&#x89C6;&#x9891;&#x5185;&#x5BB9;&#x4F5C;&#x8005;&#x3002;</li>
<li><a href="/external_links/09af547ec83d3d2a77693a8c804380a5.html" target="blank" rel="noopener">Android GDE</a>&#xFF08; Google &#x8BA4;&#x8BC1; Android &#x5F00;&#x53D1;&#x4E13;&#x5BB6;&#xFF09;&#xFF0C;&#x524D; Flipboard Android &#x5DE5;&#x7A0B;&#x5E08;&#x3002;</li>
<li>GitHub &#x5168;&#x7403; Java &#x6392;&#x540D;&#x7B2C; 92 &#x4F4D;&#xFF0C;&#x5728; <a href="/external_links/0c109d3518e06b6e2f098f5e0323a506.html" target="blank" rel="noopener">GitHub</a> &#x4E0A;&#x6709; 6.6k followers &#x548C; 9.9k stars&#x3002;</li>
<li>&#x4E2A;&#x4EBA;&#x7684; Android &#x5F00;&#x6E90;&#x5E93; <a href="/external_links/3624b1fccb05bf165e23d141cd5bf0f8.html" target="blank" rel="noopener">MaterialEditText</a> &#x88AB;&#x5168;&#x7403;&#x591A;&#x4E2A;&#x9879;&#x76EE;&#x5F15;&#x7528;&#xFF0C;&#x5176;&#x4E2D;&#x5305;&#x62EC;&#x5728;&#x5168;&#x7403;&#x62E5;&#x6709; 5 &#x4EBF;&#x7528;&#x6237;&#x7684;&#x65B0;&#x95FB;&#x9605;&#x8BFB;&#x8F6F;&#x4EF6; Flipboard &#x3002;</li>
<li>&#x66FE;&#x591A;&#x6B21;&#x5728; Google Developer Group Beijing &#x7EBF;&#x4E0B;&#x5206;&#x4EAB;&#x4F1A;&#x4E2D;&#x62C5;&#x4EFB; Android &#x90E8;&#x5206;&#x7684;&#x8BB2;&#x5E08;&#x3002;</li>
<li>&#x4E2A;&#x4EBA;&#x6280;&#x672F;&#x6587;&#x7AE0;&#x300A;<a href="/external_links/f8df6755c9c5b31848185f8e608e9d6c.html" target="blank" rel="noopener">&#x7ED9; Android &#x5F00;&#x53D1;&#x8005;&#x7684; RxJava &#x8BE6;&#x89E3;</a>&#x300B;&#x53D1;&#x5E03;&#x540E;&#xFF0C;&#x5728;&#x56FD;&#x5185;&#x591A;&#x4E2A;&#x516C;&#x53F8;&#x548C;&#x56E2;&#x961F;&#x5185;&#x90E8;&#x88AB;&#x8F6C;&#x53D1;&#x5206;&#x4EAB;&#x548C;&#x4F5C;&#x4E3A;&#x56E2;&#x961F;&#x6280;&#x672F;&#x4F1A;&#x8BAE;&#x7684;&#x4E3B;&#x8981;&#x8D44;&#x6599;&#x6765;&#x6E90;&#xFF0C;&#x4EE5;&#x53CA;&#x9006;&#x5411;&#x4F20;&#x64AD;&#x5230;&#x4E86;&#x7F8E;&#x56FD;&#x4E00;&#x4E9B;&#x5982; Google &#x3001; Uber &#x7B49;&#x516C;&#x53F8;&#x7684;&#x90E8;&#x5206;&#x534E;&#x4EBA;&#x56E2;&#x961F;&#x3002;</li>
<li>&#x521B;&#x529E;&#x7684; Android &#x9AD8;&#x7EA7;&#x8FDB;&#x9636;&#x6559;&#x5B66;&#x7F51;&#x7AD9; <a href="/external_links/610bdefe7b4ce81503e9457cd986b5ea.html" target="blank" rel="noopener">HenCoder</a> &#x5728;&#x5168;&#x7403;&#x534E;&#x4EBA; Android &#x5F00;&#x53D1;&#x793E;&#x533A;&#x4EAB;&#x6709;&#x76F8;&#x5F53;&#x7684;&#x5F71;&#x54CD;&#x529B;&#x3002;</li>
<li>&#x4E4B;&#x540E;&#x521B;&#x529E; Android &#x9AD8;&#x7EA7;&#x5F00;&#x53D1;&#x6559;&#x5B66;&#x8BFE;&#x7A0B; <a href="/external_links/cd1ffcee34c8e249d2a89bbef6770416.html" target="blank" rel="noopener">HenCoder Plus</a> &#xFF0C;&#x5B66;&#x5458;&#x904D;&#x5E03;&#x5168;&#x7403;&#xFF0C;&#x6709;&#x6765;&#x81EA;&#x963F;&#x91CC;&#x3001;&#x5934;&#x6761;&#x3001;&#x534E;&#x4E3A;&#x3001;&#x817E;&#x8BAF;&#x7B49;&#x77E5;&#x540D;&#x4E00;&#x7EBF;&#x4E92;&#x8054;&#x7F51;&#x516C;&#x53F8;&#xFF0C;&#x4E5F;&#x6709;&#x6765;&#x81EA;&#x4E2D;&#x56FD;&#x53F0;&#x6E7E;&#x3001;&#x65E5;&#x672C;&#x3001;&#x7F8E;&#x56FD;&#x7B49;&#x5730;&#x533A;&#x7684;&#x8D44;&#x6DF1;&#x8F6F;&#x4EF6;&#x5DE5;&#x7A0B;&#x5E08;&#x3002;</li>
</ul>
<h4 id="&#x6587;&#x7AE0;&#x4F5C;&#x8005;"><a href="#&#x6587;&#x7AE0;&#x4F5C;&#x8005;" class="headerlink" title="&#x6587;&#x7AE0;&#x4F5C;&#x8005;"></a>&#x6587;&#x7AE0;&#x4F5C;&#x8005;</h4><h5 id="LewisLuo&#xFF08;&#x7F57;&#x5B87;&#xFF09;"><a href="#LewisLuo&#xFF08;&#x7F57;&#x5B87;&#xFF09;" class="headerlink" title="LewisLuo&#xFF08;&#x7F57;&#x5B87;&#xFF09;"></a>LewisLuo&#xFF08;&#x7F57;&#x5B87;&#xFF09;</h5><p><a href="/external_links/310cffc8ed9f8538be06186cf5d988ce.html" target="blank" rel="noopener">LewisLuo&#xFF08;&#x7F57;&#x5B87;&#xFF09;</a> &#xFF0C;&#x5373;&#x523B; Android &#x5DE5;&#x7A0B;&#x5E08;&#x3002;2019 &#x5E74;&#x52A0;&#x5165;&#x5373;&#x523B;&#xFF0C;&#x53C2;&#x4E0E;&#x5373;&#x523B;&#x65E5;&#x8BB0;&#x529F;&#x80FD;&#x7684;&#x5F00;&#x53D1;&#x548C;&#x8FED;&#x4EE3;&#x53CA;&#x4E2D;&#x53F0;&#x57FA;&#x7840;&#x5EFA;&#x8BBE;&#x3002;&#x66FE;&#x5C31;&#x804C;&#x4E8E; mobike&#xFF0C;&#x8D1F;&#x8D23;&#x56FD;&#x9645;&#x5316;&#x4E1A;&#x52A1;&#x5F00;&#x53D1;&#x3002;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/c73faa1ed22bd4e348d7d6b17751f942.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903939062628360.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903939062628360.html" itemprop="url">学习 lodash 源码整体架构，打造属于自己的函数式编程类</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-10T12:26:17+08:00">
                2019-09-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="&#x524D;&#x8A00;"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00;</h2><blockquote>
<p>&#x4F60;&#x597D;&#xFF0C;&#x6211;&#x662F;<a href="/external_links/b223b476cd448b456962ecaf8028b149.html" target="blank" rel="noopener">&#x82E5;&#x5DDD;</a>&#x3002;&#x8FD9;&#x662F;<code>&#x5B66;&#x4E60;&#x6E90;&#x7801;&#x6574;&#x4F53;&#x67B6;&#x6784;&#x7CFB;&#x5217;</code>&#x7B2C;&#x4E09;&#x7BC7;&#x3002;&#x6574;&#x4F53;&#x67B6;&#x6784;&#x8FD9;&#x8BCD;&#x8BED;&#x597D;&#x50CF;&#x6709;&#x70B9;&#x5927;&#xFF0C;&#x59D1;&#x4E14;&#x5C31;&#x7B97;&#x662F;&#x6E90;&#x7801;&#x6574;&#x4F53;&#x7ED3;&#x6784;&#x5427;&#xFF0C;&#x4E3B;&#x8981;&#x5C31;&#x662F;&#x5B66;&#x4E60;&#x662F;&#x4EE3;&#x7801;&#x6574;&#x4F53;&#x7ED3;&#x6784;&#xFF0C;&#x4E0D;&#x6DF1;&#x7A76;&#x5176;&#x4ED6;&#x4E0D;&#x662F;&#x4E3B;&#x7EBF;&#x7684;&#x5177;&#x4F53;&#x51FD;&#x6570;&#x7684;&#x5B9E;&#x73B0;&#x3002;&#x672C;&#x7BC7;&#x6587;&#x7AE0;&#x5B66;&#x4E60;&#x7684;&#x662F;&#x6253;&#x5305;&#x6574;&#x5408;&#x540E;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x4E0D;&#x662F;&#x5B9E;&#x9645;&#x4ED3;&#x5E93;&#x4E2D;&#x7684;&#x62C6;&#x5206;&#x7684;&#x4EE3;&#x7801;&#x3002;</p>
</blockquote>
<p><code>&#x5B66;&#x4E60;&#x6E90;&#x7801;&#x6574;&#x4F53;&#x67B6;&#x6784;&#x7CFB;&#x5217;</code>&#x6587;&#x7AE0;&#x5982;&#x4E0B;&#xFF1A;</p>
<blockquote>
<p>1.<a href="https://dev.newban.cn/6844903902077272071">&#x5B66;&#x4E60; jQuery &#x6E90;&#x7801;&#x6574;&#x4F53;&#x67B6;&#x6784;&#xFF0C;&#x6253;&#x9020;&#x5C5E;&#x4E8E;&#x81EA;&#x5DF1;&#x7684; js &#x7C7B;&#x5E93;</a>  </p>
<p>2.<a href="https://dev.newban.cn/6844903908972691469">&#x5B66;&#x4E60; underscore &#x6E90;&#x7801;&#x6574;&#x4F53;&#x67B6;&#x6784;&#xFF0C;&#x6253;&#x9020;&#x5C5E;&#x4E8E;&#x81EA;&#x5DF1;&#x7684;&#x51FD;&#x6570;&#x5F0F;&#x7F16;&#x7A0B;&#x7C7B;&#x5E93;</a>  </p>
<p>3.<a href="https://dev.newban.cn/6844903939062628360">&#x5B66;&#x4E60; lodash &#x6E90;&#x7801;&#x6574;&#x4F53;&#x67B6;&#x6784;&#xFF0C;&#x6253;&#x9020;&#x5C5E;&#x4E8E;&#x81EA;&#x5DF1;&#x7684;&#x51FD;&#x6570;&#x5F0F;&#x7F16;&#x7A0B;&#x7C7B;&#x5E93;</a>  </p>
<p>4.<a href="https://dev.newban.cn/6844903984457580551">&#x5B66;&#x4E60; sentry &#x6E90;&#x7801;&#x6574;&#x4F53;&#x67B6;&#x6784;&#xFF0C;&#x6253;&#x9020;&#x5C5E;&#x4E8E;&#x81EA;&#x5DF1;&#x7684;&#x524D;&#x7AEF;&#x5F02;&#x5E38;&#x76D1;&#x63A7;SDK</a>  </p>
<p>5.<a href="https://dev.newban.cn/6844904001192853511">&#x5B66;&#x4E60; vuex &#x6E90;&#x7801;&#x6574;&#x4F53;&#x67B6;&#x6784;&#xFF0C;&#x6253;&#x9020;&#x5C5E;&#x4E8E;&#x81EA;&#x5DF1;&#x7684;&#x72B6;&#x6001;&#x7BA1;&#x7406;&#x5E93;</a>  </p>
<p>6.<a href="https://dev.newban.cn/6844904019987529735">&#x5B66;&#x4E60; axios &#x6E90;&#x7801;&#x6574;&#x4F53;&#x67B6;&#x6784;&#xFF0C;&#x6253;&#x9020;&#x5C5E;&#x4E8E;&#x81EA;&#x5DF1;&#x7684;&#x8BF7;&#x6C42;&#x5E93;</a>  </p>
<p>7.<a href="https://dev.newban.cn/6844904088220467213">&#x5B66;&#x4E60; koa &#x6E90;&#x7801;&#x7684;&#x6574;&#x4F53;&#x67B6;&#x6784;&#xFF0C;&#x6D45;&#x6790;koa&#x6D0B;&#x8471;&#x6A21;&#x578B;&#x539F;&#x7406;&#x548C;co&#x539F;&#x7406;</a>  </p>
<p>8.<a href="https://dev.newban.cn/6844904191228411911">&#x5B66;&#x4E60; redux &#x6E90;&#x7801;&#x6574;&#x4F53;&#x67B6;&#x6784;&#xFF0C;&#x6DF1;&#x5165;&#x7406;&#x89E3; redux &#x53CA;&#x5176;&#x4E2D;&#x95F4;&#x4EF6;&#x539F;&#x7406;</a></p>
</blockquote>
<p>&#x611F;&#x5174;&#x8DA3;&#x7684;&#x8BFB;&#x8005;&#x53EF;&#x4EE5;&#x70B9;&#x51FB;&#x9605;&#x8BFB;&#x3002;</p>
<p><code>underscore</code>&#x6E90;&#x7801;&#x5206;&#x6790;&#x7684;&#x6587;&#x7AE0;&#x6BD4;&#x8F83;&#x591A;&#xFF0C;&#x800C;<code>lodash</code>&#x6E90;&#x7801;&#x5206;&#x6790;&#x7684;&#x6587;&#x7AE0;&#x6BD4;&#x8F83;&#x5C11;&#x3002;&#x539F;&#x56E0;&#x4E4B;&#x4E00;&#x53EF;&#x80FD;&#x662F;&#x7531;&#x4E8E;<code>lodash</code>&#x6E90;&#x7801;&#x884C;&#x6570;&#x592A;&#x591A;&#x3002;&#x6CE8;&#x91CA;&#x52A0;&#x8D77;&#x6765;&#x4E00;&#x4E07;&#x591A;&#x884C;&#x3002;</p>
<p>&#x5206;&#x6790;<code>lodash</code>&#x6574;&#x4F53;&#x4EE3;&#x7801;&#x7ED3;&#x6784;&#x7684;&#x6587;&#x7AE0;&#x6BD4;&#x8F83;&#x5C11;&#xFF0C;&#x7B14;&#x8005;&#x5229;&#x7528;&#x8C37;&#x6B4C;&#x3001;&#x5FC5;&#x5E94;&#x3001;<code>github</code>&#x7B49;&#x641C;&#x7D22;&#x90FD;&#x6CA1;&#x6709;&#x627E;&#x5230;&#xFF0C;&#x53EF;&#x80FD;&#x662F;&#x627E;&#x7684;&#x65B9;&#x5F0F;&#x4E0D;&#x5BF9;&#x3002;&#x4E8E;&#x662F;&#x6253;&#x7B97;&#x81EA;&#x5DF1;&#x5199;&#x4E00;&#x7BC7;&#x3002;&#x5E73;&#x5E38;&#x5F00;&#x53D1;&#x5927;&#x591A;&#x6570;&#x4EBA;&#x90FD;&#x4F1A;&#x4F7F;&#x7528;<code>lodash</code>&#xFF0C;&#x800C;&#x4E14;&#x90FD;&#x6216;&#x591A;&#x6216;&#x5C11;&#x77E5;&#x9053;&#xFF0C;<code>lodash</code>&#x6BD4;<code>underscore</code>&#x6027;&#x80FD;&#x597D;&#xFF0C;&#x6027;&#x80FD;&#x597D;&#x7684;&#x4E3B;&#x8981;&#x539F;&#x56E0;&#x662F;&#x4F7F;&#x7528;&#x4E86;&#x60F0;&#x6027;&#x6C42;&#x503C;&#x8FD9;&#x4E00;&#x7279;&#x6027;&#x3002;</p>
<p>&#x672C;&#x6587;&#x7AE0;&#x5B66;&#x4E60;&#x7684;<code>lodash</code>&#x7684;&#x7248;&#x672C;&#x662F;&#xFF1A;<code>v4.17.15</code>&#x3002;<code>unpkg.com</code>&#x5730;&#x5740; <a href="/external_links/dc70643c05ab331c5f357e26f0048072.html" target="blank" rel="noopener">https://unpkg.com/lodash@4.17.15/lodash.js</a></p>
<p>&#x6587;&#x7AE0;&#x7BC7;&#x5E45;&#x53EF;&#x80FD;&#x6BD4;&#x8F83;&#x957F;&#xFF0C;&#x53EF;&#x4EE5;&#x5148;&#x6536;&#x85CF;&#x518D;&#x770B;&#xFF0C;&#x6240;&#x4EE5;&#x7B14;&#x8005;&#x4F7F;&#x7528;&#x4E86;&#x5C55;&#x5F00;&#x6536;&#x7F29;&#x7684;&#x5F62;&#x5F0F;&#x3002;</p>
<p><strong>&#x5BFC;&#x8BFB;&#xFF1A;</strong></p>
<blockquote>
<p>&#x6587;&#x7AE0;&#x4E3B;&#x8981;&#x5B66;&#x4E60;&#x4E86;<code>runInContext()</code> &#x5BFC;&#x51FA;<code>_</code> <code>lodash</code>&#x51FD;&#x6570;&#x4F7F;&#x7528;<code>baseCreate</code>&#x65B9;&#x6CD5;&#x539F;&#x578B;&#x7EE7;&#x627F;<code>LodashWrapper</code>&#x548C;<code>LazyWrapper</code>&#xFF0C;<code>mixin</code>&#x6302;&#x8F7D;&#x65B9;&#x6CD5;&#x5230;<code>lodash.prototype</code>&#x3001;&#x540E;&#x6587;&#x7528;&#x7ED3;&#x5408;&#x4F8B;&#x5B50;&#x89E3;&#x91CA;<code>lodash.prototype.value(wrapperValue)</code>&#x548C;<code>Lazy.prototype.value(lazyValue)</code>&#x60F0;&#x6027;&#x6C42;&#x503C;&#x7684;&#x6E90;&#x7801;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x3002;</p>
</blockquote>
<h2 id="&#x533F;&#x540D;&#x51FD;&#x6570;&#x6267;&#x884C;"><a href="#&#x533F;&#x540D;&#x51FD;&#x6570;&#x6267;&#x884C;" class="headerlink" title="&#x533F;&#x540D;&#x51FD;&#x6570;&#x6267;&#x884C;"></a>&#x533F;&#x540D;&#x51FD;&#x6570;&#x6267;&#x884C;</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;;(function() {</span><br><span class="line"></span><br><span class="line">}.call(this));</span><br></pre></td></tr></table></figure>

<p>&#x66B4;&#x9732; lodash</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;var _ = runInContext();</span><br></pre></td></tr></table></figure>

<h2 id="runInContext-&#x51FD;&#x6570;"><a href="#runInContext-&#x51FD;&#x6570;" class="headerlink" title="runInContext &#x51FD;&#x6570;"></a>runInContext &#x51FD;&#x6570;</h2><p>&#x8FD9;&#x91CC;&#x7684;&#x7B80;&#x7248;&#x6E90;&#x7801;&#xFF0C;&#x53EA;&#x5173;&#x6CE8;&#x51FD;&#x6570;&#x5165;&#x53E3;&#x548C;&#x8FD4;&#x56DE;&#x503C;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;var runInContext = (function runInContext(context) {</span><br><span class="line"> // &#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x5904;&#x7406;context&#x4E3A;window</span><br><span class="line"> // ...</span><br><span class="line"> function lodash(value) {}{</span><br><span class="line">  // ...</span><br><span class="line">  return new LodashWrapper(value);</span><br><span class="line"> }</span><br><span class="line"> // ...</span><br><span class="line"> return lodash;</span><br><span class="line">});</span><br></pre></td></tr></table></figure>

<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x7533;&#x660E;&#x4E86;&#x4E00;&#x4E2A;<code>runInContext</code>&#x51FD;&#x6570;&#x3002;&#x91CC;&#x9762;&#x6709;&#x4E00;&#x4E2A;<code>lodash</code>&#x51FD;&#x6570;&#xFF0C;&#x6700;&#x540E;&#x5904;&#x7406;&#x8FD4;&#x56DE;&#x8FD9;&#x4E2A;<code>lodash</code>&#x51FD;&#x6570;&#x3002;</p>
<p>&#x518D;&#x770B;<code>lodash</code>&#x51FD;&#x6570;&#x4E2D;&#x7684;&#x8FD4;&#x56DE;&#x503C; <code>new LodashWrapper(value)</code>&#x3002;</p>
<h3 id="LodashWrapper-&#x51FD;&#x6570;"><a href="#LodashWrapper-&#x51FD;&#x6570;" class="headerlink" title="LodashWrapper &#x51FD;&#x6570;"></a>LodashWrapper &#x51FD;&#x6570;</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function LodashWrapper(value, chainAll) {</span><br><span class="line"> this.__wrapped__ = value;</span><br><span class="line"> this.__actions__ = [];</span><br><span class="line"> this.__chain__ = !!chainAll;</span><br><span class="line"> this.__index__ = 0;</span><br><span class="line"> this.__values__ = undefined;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8BBE;&#x7F6E;&#x4E86;&#x8FD9;&#x4E9B;&#x5C5E;&#x6027;&#xFF1A;</p>
<p><code>__wrapped__</code>&#xFF1A;&#x5B58;&#x653E;&#x53C2;&#x6570;<code>value</code>&#x3002;</p>
<p><code>__actions__</code>&#xFF1A;&#x5B58;&#x653E;&#x5F85;&#x6267;&#x884C;&#x7684;&#x51FD;&#x6570;&#x4F53;<code>func</code>&#xFF0C; &#x51FD;&#x6570;&#x53C2;&#x6570; <code>args</code>&#xFF0C;&#x51FD;&#x6570;&#x6267;&#x884C;&#x7684;<code>this</code> &#x6307;&#x5411; <code>thisArg</code>&#x3002;</p>
<p><code>__chain__</code>&#x3001;<code>undefined</code>&#x4E24;&#x6B21;&#x53D6;&#x53CD;&#x8F6C;&#x6210;&#x5E03;&#x5C14;&#x503C;<code>false</code>&#xFF0C;&#x4E0D;&#x652F;&#x6301;&#x94FE;&#x5F0F;&#x8C03;&#x7528;&#x3002;&#x548C;<code>underscore</code>&#x4E00;&#x6837;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F;&#x4E0D;&#x652F;&#x6301;&#x94FE;&#x5F0F;&#x8C03;&#x7528;&#x7684;&#x3002;</p>
<p><code>__index__</code>&#xFF1A;&#x7D22;&#x5F15;&#x503C; &#x9ED8;&#x8BA4; 0&#x3002;</p>
<p><code>__values__</code>&#xFF1A;&#x4E3B;&#x8981;<code>clone</code>&#x65F6;&#x4F7F;&#x7528;&#x3002;</p>
<p>&#x63A5;&#x7740;&#x5F80;&#x4E0B;&#x641C;&#x7D22;&#x6E90;&#x7801;&#xFF0C;<code>LodashWrapper</code>&#xFF0C;<br>&#x4F1A;&#x53D1;&#x73B0;&#x8FD9;&#x4E24;&#x884C;&#x4EE3;&#x7801;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;LodashWrapper.prototype = baseCreate(baseLodash.prototype);</span><br><span class="line">LodashWrapper.prototype.constructor = LodashWrapper;</span><br></pre></td></tr></table></figure>

<p>&#x63A5;&#x7740;&#x5F80;&#x4E0A;&#x627E;<code>baseCreate&#x3001;baseLodash</code>&#x8FD9;&#x4E24;&#x4E2A;&#x51FD;&#x6570;&#x3002;</p>
<h3 id="baseCreate-&#x539F;&#x578B;&#x7EE7;&#x627F;"><a href="#baseCreate-&#x539F;&#x578B;&#x7EE7;&#x627F;" class="headerlink" title="baseCreate &#x539F;&#x578B;&#x7EE7;&#x627F;"></a>baseCreate &#x539F;&#x578B;&#x7EE7;&#x627F;</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;//  &#x7ACB;&#x5373;&#x6267;&#x884C;&#x533F;&#x540D;&#x51FD;&#x6570;</span><br><span class="line">// &#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x7528;&#x4E8E;&#x8BBE;&#x7F6E;&#x539F;&#x578B; &#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;&#x662F; __proto__</span><br><span class="line">var baseCreate = (function() {</span><br><span class="line"> // &#x8FD9;&#x53E5;&#x653E;&#x5728;&#x51FD;&#x6570;&#x5916;&#xFF0C;&#x662F;&#x4E3A;&#x4E86;&#x4E0D;&#x7528;&#x6BCF;&#x6B21;&#x8C03;&#x7528;baseCreate&#x90FD;&#x91CD;&#x590D;&#x7533;&#x660E; object</span><br><span class="line"> // underscore &#x6E90;&#x7801;&#x4E2D;&#xFF0C;&#x628A;&#x8FD9;&#x53E5;&#x653E;&#x5728;&#x5F00;&#x5934;&#x5C31;&#x7533;&#x660E;&#x4E86;&#x4E00;&#x4E2A;&#x7A7A;&#x51FD;&#x6570; `Ctor`</span><br><span class="line"> function object() {}</span><br><span class="line"> return function(proto) {</span><br><span class="line">  // &#x5982;&#x679C;&#x4F20;&#x5165;&#x7684;&#x53C2;&#x6570;&#x4E0D;&#x662F;object&#x4E5F;&#x4E0D;&#x662F;function &#x662F;null</span><br><span class="line">  // &#x5219;&#x8FD4;&#x56DE;&#x7A7A;&#x5BF9;&#x8C61;&#x3002;</span><br><span class="line">  if (!isObject(proto)) {</span><br><span class="line">   return {};</span><br><span class="line">  }</span><br><span class="line">  // &#x5982;&#x679C;&#x652F;&#x6301;Object.create&#x65B9;&#x6CD5;&#xFF0C;&#x5219;&#x8FD4;&#x56DE; Object.create</span><br><span class="line">  if (objectCreate) {</span><br><span class="line">   // Object.create</span><br><span class="line">   return objectCreate(proto);</span><br><span class="line">  }</span><br><span class="line">  // &#x5982;&#x679C;&#x4E0D;&#x652F;&#x6301;Object.create &#x7528; ployfill new</span><br><span class="line">  object.prototype = proto;</span><br><span class="line">  var result = new object;</span><br><span class="line">  // &#x8FD8;&#x539F; prototype</span><br><span class="line">  object.prototype = undefined;</span><br><span class="line">  return result;</span><br><span class="line"> };</span><br><span class="line">}());</span><br><span class="line"></span><br><span class="line">// &#x7A7A;&#x51FD;&#x6570;</span><br><span class="line">function baseLodash() {</span><br><span class="line"> // No operation performed.</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// Ensure wrappers are instances of `baseLodash`.</span><br><span class="line">lodash.prototype = baseLodash.prototype;</span><br><span class="line">// &#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x6709;&#x8FD9;&#x4E00;&#x53E5;&#xFF1F;&#x56E0;&#x4E3A;&#x4E0A;&#x4E00;&#x53E5;&#x628A;lodash.prototype.construtor &#x8BBE;&#x7F6E;&#x4E3A;Object&#x4E86;&#x3002;&#x8FD9;&#x4E00;&#x53E5;&#x4FEE;&#x6B63;constructor</span><br><span class="line">lodash.prototype.constructor = lodash;</span><br><span class="line"></span><br><span class="line">LodashWrapper.prototype = baseCreate(baseLodash.prototype);</span><br><span class="line">LodashWrapper.prototype.constructor = LodashWrapper;</span><br></pre></td></tr></table></figure>

<p>&#x7B14;&#x8005;&#x753B;&#x4E86;&#x4E00;&#x5F20;&#x56FE;&#xFF0C;&#x8868;&#x793A;&#x8FD9;&#x4E2A;&#x5173;&#x7CFB;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/bea6b378f9862a2b08e738d1c23a2d46e565fb3c7d10c53c3b6519063cddea03" alt="lodash &#x539F;&#x578B;&#x5173;&#x7CFB;&#x56FE;"></p>
<p>lodash &#x539F;&#x578B;&#x5173;&#x7CFB;&#x56FE;</p>
<h4 id="&#x884D;&#x751F;&#x7684;-isObject-&#x51FD;&#x6570;"><a href="#&#x884D;&#x751F;&#x7684;-isObject-&#x51FD;&#x6570;" class="headerlink" title="&#x884D;&#x751F;&#x7684; isObject &#x51FD;&#x6570;"></a>&#x884D;&#x751F;&#x7684; isObject &#x51FD;&#x6570;</h4><p>&#x5224;&#x65AD;<code>typeof value</code>&#x4E0D;&#x7B49;&#x4E8E;<code>null</code>&#xFF0C;&#x5E76;&#x4E14;&#x662F;<code>object</code>&#x6216;&#x8005;<code>function</code>&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function isObject(value) {</span><br><span class="line"> var type = typeof value;</span><br><span class="line"> return value != null &amp;&amp; (type == &apos;object&apos; || type == &apos;function&apos;);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="Object-create-&#x7528;&#x6CD5;&#x4E3E;&#x4F8B;"><a href="#Object-create-&#x7528;&#x6CD5;&#x4E3E;&#x4F8B;" class="headerlink" title="Object.create() &#x7528;&#x6CD5;&#x4E3E;&#x4F8B;"></a>Object.create() &#x7528;&#x6CD5;&#x4E3E;&#x4F8B;</h3><p><a href="https://dev.newban.cn/6844903704663949325">&#x9762;&#x8BD5;&#x5B98;&#x95EE;&#xFF1A;&#x80FD;&#x5426;&#x6A21;&#x62DF;&#x5B9E;&#x73B0;JS&#x7684;new&#x64CD;&#x4F5C;&#x7B26;</a> &#x4E4B;&#x524D;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x5199;&#x8FC7;&#x7684;&#x4E00;&#x6BB5;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x6536;&#x7F29;&#x8D77;&#x6765;&#x4E86;&#x3002;</p>
<p> &#x70B9;&#x51FB; &#x67E5;&#x770B; Object.create() &#x7528;&#x6CD5;&#x4E3E;&#x4F8B;<br>&#x7B14;&#x8005;&#x4E4B;&#x524D;&#x6574;&#x7406;&#x7684;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;&#x4E2D;&#x4E5F;&#x6709;&#x8BB2;&#x8FC7;&#xFF0C;&#x53EF;&#x4EE5;&#x7FFB;&#x770B;<a href="/external_links/84711cef8960f5830459654ed5582f98.html" target="blank" rel="noopener">JavaScript &#x5BF9;&#x8C61;&#x6240;&#x6709;API&#x89E3;&#x6790;</a></p>
<p><a href="/external_links/5bd3fa02efcbbadcc1f3b7a5967b3330.html" target="blank" rel="noopener">MDN Object.create()</a></p>
<p><code>Object.create(proto, [propertiesObject])</code><br>&#x65B9;&#x6CD5;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x5BF9;&#x8C61;&#xFF0C;&#x4F7F;&#x7528;&#x73B0;&#x6709;&#x7684;&#x5BF9;&#x8C61;&#x6765;&#x63D0;&#x4F9B;&#x65B0;&#x521B;&#x5EFA;&#x7684;&#x5BF9;&#x8C61;&#x7684;__proto__&#x3002;<br>&#x5B83;&#x63A5;&#x6536;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x4E0D;&#x8FC7;&#x7B2C;&#x4E8C;&#x4E2A;&#x53EF;&#x9009;&#x53C2;&#x6570;&#x662F;&#x5C5E;&#x6027;&#x63CF;&#x8FF0;&#x7B26;&#xFF08;&#x4E0D;&#x5E38;&#x7528;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F;<code>undefined</code>&#xFF09;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;var anotherObject = {</span><br><span class="line">    name: &apos;&#x82E5;&#x5DDD;&apos;</span><br><span class="line">};</span><br><span class="line">var myObject = Object.create(anotherObject, {</span><br><span class="line">    age: {</span><br><span class="line">        value&#xFF1A;18,</span><br><span class="line">    },</span><br><span class="line">});</span><br><span class="line">// &#x83B7;&#x5F97;&#x5B83;&#x7684;&#x539F;&#x578B;</span><br><span class="line">Object.getPrototypeOf(anotherObject) === Object.prototype; // true &#x8BF4;&#x660E;anotherObject&#x7684;&#x539F;&#x578B;&#x662F;Object.prototype</span><br><span class="line">Object.getPrototypeOf(myObject); // {name: &quot;&#x82E5;&#x5DDD;&quot;} // &#x8BF4;&#x660E;myObject&#x7684;&#x539F;&#x578B;&#x662F;{name: &quot;&#x82E5;&#x5DDD;&quot;}</span><br><span class="line">myObject.hasOwnProperty(&apos;name&apos;); // false; &#x8BF4;&#x660E;name&#x662F;&#x539F;&#x578B;&#x4E0A;&#x7684;&#x3002;</span><br><span class="line">myObject.hasOwnProperty(&apos;age&apos;); // true &#x8BF4;&#x660E;age&#x662F;&#x81EA;&#x8EAB;&#x7684;</span><br><span class="line">myObject.name; // &apos;&#x82E5;&#x5DDD;&apos;</span><br><span class="line">myObject.age; // 18;</span><br></pre></td></tr></table></figure>

<p>&#x5BF9;&#x4E8E;&#x4E0D;&#x652F;&#x6301;<code>ES5</code>&#x7684;&#x6D4F;&#x89C8;&#x5668;&#xFF0C;<code>MDN</code>&#x4E0A;&#x63D0;&#x4F9B;&#x4E86;<code>ployfill</code>&#x65B9;&#x6848;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;if (typeof Object.create !== &quot;function&quot;) {</span><br><span class="line">    Object.create = function (proto, propertiesObject) {</span><br><span class="line">        if (typeof proto !== &apos;object&apos; &amp;&amp; typeof proto !== &apos;function&apos;) {</span><br><span class="line">            throw new TypeError(&apos;Object prototype may only be an Object: &apos; + proto);</span><br><span class="line">        } else if (proto === null) {</span><br><span class="line">            throw new Error(&quot;This browser&apos;s implementation of Object.create is a shim and doesn&apos;t support &apos;null&apos; as the first argument.&quot;);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        if (typeof propertiesObject != &apos;undefined&apos;) throw new Error(&quot;This browser&apos;s implementation of Object.create is a shim and doesn&apos;t support a second argument.&quot;);</span><br><span class="line"></span><br><span class="line">        function F() {}</span><br><span class="line">        F.prototype = proto;</span><br><span class="line">        return new F();</span><br><span class="line">    };</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><code>lodash</code>&#x4E0A;&#x6709;&#x5F88;&#x591A;&#x65B9;&#x6CD5;&#x548C;&#x5C5E;&#x6027;&#xFF0C;&#x4F46;&#x5728;<code>lodash.prototype</code>&#x4E5F;&#x6709;&#x5F88;&#x591A;&#x4E0E;<code>lodash</code>&#x4E0A;&#x76F8;&#x540C;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x80AF;&#x5B9A;&#x4E0D;&#x662F;&#x5728;<code>lodash.prototype</code>&#x4E0A;&#x91CD;&#x65B0;&#x5199;&#x4E00;&#x904D;&#x3002;&#x800C;&#x662F;&#x901A;&#x8FC7;<code>mixin</code>&#x6302;&#x8F7D;&#x7684;&#x3002;</p>
<h2 id="mixin"><a href="#mixin" class="headerlink" title="mixin"></a>mixin</h2><h3 id="mixin-&#x5177;&#x4F53;&#x7528;&#x6CD5;"><a href="#mixin-&#x5177;&#x4F53;&#x7528;&#x6CD5;" class="headerlink" title="mixin &#x5177;&#x4F53;&#x7528;&#x6CD5;"></a>mixin &#x5177;&#x4F53;&#x7528;&#x6CD5;</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;_.mixin([object=lodash], source, [options={}])</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&#x6DFB;&#x52A0;&#x6765;&#x6E90;&#x5BF9;&#x8C61;&#x81EA;&#x8EAB;&#x7684;&#x6240;&#x6709;&#x53EF;&#x679A;&#x4E3E;&#x51FD;&#x6570;&#x5C5E;&#x6027;&#x5230;&#x76EE;&#x6807;&#x5BF9;&#x8C61;&#x3002; &#x5982;&#x679C; object &#x662F;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x90A3;&#x4E48;&#x51FD;&#x6570;&#x65B9;&#x6CD5;&#x5C06;&#x88AB;&#x6DFB;&#x52A0;&#x5230;&#x539F;&#x578B;&#x94FE;&#x4E0A;&#x3002;</p>
</blockquote>
<blockquote>
<p>&#x6CE8;&#x610F;: &#x4F7F;&#x7528; _.runInContext &#x6765;&#x521B;&#x5EFA;&#x539F;&#x59CB;&#x7684; lodash &#x51FD;&#x6570;&#x6765;&#x907F;&#x514D;&#x4FEE;&#x6539;&#x9020;&#x6210;&#x7684;&#x51B2;&#x7A81;&#x3002;</p>
</blockquote>
<p><strong>&#x6DFB;&#x52A0;&#x7248;&#x672C;</strong></p>
<blockquote>
<p>0.1.0</p>
</blockquote>
<p><strong>&#x53C2;&#x6570;</strong></p>
<blockquote>
<p>[object=lodash] (Function|Object): &#x76EE;&#x6807;&#x5BF9;&#x8C61;&#x3002;</p>
</blockquote>
<blockquote>
<p>source (Object): &#x6765;&#x6E90;&#x5BF9;&#x8C61;&#x3002;</p>
</blockquote>
<blockquote>
<p>[options={}] (Object): &#x9009;&#x9879;&#x5BF9;&#x8C61;&#x3002;</p>
</blockquote>
<blockquote>
<p>[options.chain=true] (boolean): &#x662F;&#x5426;&#x5F00;&#x542F;&#x94FE;&#x5F0F;&#x64CD;&#x4F5C;&#x3002;</p>
</blockquote>
<p><strong>&#x8FD4;&#x56DE;</strong></p>
<blockquote>
<p>(*): &#x8FD4;&#x56DE; object.</p>
</blockquote>
<h3 id="mixin-&#x6E90;&#x7801;"><a href="#mixin-&#x6E90;&#x7801;" class="headerlink" title="mixin &#x6E90;&#x7801;"></a>mixin &#x6E90;&#x7801;</h3><p>&#x70B9;&#x51FB;&#x8FD9;&#x91CC;&#x5C55;&#x5F00;mixin&#x6E90;&#x7801;&#xFF0C;&#x540E;&#x6587;&#x6CE8;&#x91CA;&#x89E3;&#x6790;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function mixin(object, source, options) {</span><br><span class="line"> var props = keys(source),</span><br><span class="line">  methodNames = baseFunctions(source, props);</span><br><span class="line"></span><br><span class="line"> if (options == null &amp;&amp;</span><br><span class="line">  !(isObject(source) &amp;&amp; (methodNames.length || !props.length))) {</span><br><span class="line">  options = source;</span><br><span class="line">  source = object;</span><br><span class="line">  object = this;</span><br><span class="line">  methodNames = baseFunctions(source, keys(source));</span><br><span class="line"> }</span><br><span class="line"> var chain = !(isObject(options) &amp;&amp; &apos;chain&apos; in options) || !!options.chain,</span><br><span class="line">  isFunc = isFunction(object);</span><br><span class="line"></span><br><span class="line"> arrayEach(methodNames, function(methodName) {</span><br><span class="line">  var func = source[methodName];</span><br><span class="line">  object[methodName] = func;</span><br><span class="line">  if (isFunc) {</span><br><span class="line">   object.prototype[methodName] = function() {</span><br><span class="line">    var chainAll = this.__chain__;</span><br><span class="line">    if (chain || chainAll) {</span><br><span class="line">     var result = object(this.__wrapped__),</span><br><span class="line">      actions = result.__actions__ = copyArray(this.__actions__);</span><br><span class="line"></span><br><span class="line">     actions.push({ &apos;func&apos;: func, &apos;args&apos;: arguments, &apos;thisArg&apos;: object });</span><br><span class="line">     result.__chain__ = chainAll;</span><br><span class="line">     return result;</span><br><span class="line">    }</span><br><span class="line">    return func.apply(object, arrayPush([this.value()], arguments));</span><br><span class="line">   };</span><br><span class="line">  }</span><br><span class="line"> });</span><br><span class="line"></span><br><span class="line"> return object;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x63A5;&#x4E0B;&#x6765;&#x5148;&#x770B;&#x884D;&#x751F;&#x7684;&#x51FD;&#x6570;&#x3002;<br><strong>&#x5176;&#x5B9E;&#x770B;&#x5230;&#x5177;&#x4F53;&#x5B9A;&#x4E49;&#x7684;&#x51FD;&#x6570;&#x4EE3;&#x7801;&#x5C31;&#x5927;&#x6982;&#x77E5;&#x9053;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x529F;&#x80FD;&#x3002;&#x4E3A;&#x4E86;&#x4E0D;&#x5F71;&#x54CD;&#x4E3B;&#x7EBF;&#xFF0C;&#x5BFC;&#x81F4;&#x6587;&#x7AE0;&#x7BC7;&#x5E45;&#x8FC7;&#x957F;&#x3002;&#x5177;&#x4F53;&#x6E90;&#x7801;&#x5728;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x5C55;&#x5F00;&#x3002;</strong></p>
<p>&#x611F;&#x5174;&#x8DA3;&#x7684;&#x8BFB;&#x8005;&#x53EF;&#x4EE5;&#x81EA;&#x884C;&#x770B;&#x8FD9;&#x4E9B;&#x51FD;&#x6570;&#x884D;&#x751F;&#x7684;&#x5176;&#x4ED6;&#x51FD;&#x6570;&#x7684;&#x6E90;&#x7801;&#x3002;</p>
<h3 id="mixin-&#x884D;&#x751F;&#x7684;&#x51FD;&#x6570;-keys"><a href="#mixin-&#x884D;&#x751F;&#x7684;&#x51FD;&#x6570;-keys" class="headerlink" title="mixin &#x884D;&#x751F;&#x7684;&#x51FD;&#x6570; keys"></a>mixin &#x884D;&#x751F;&#x7684;&#x51FD;&#x6570; keys</h3><p>&#x5728; <code>mixin</code> &#x51FD;&#x6570;&#x4E2D; &#x5176;&#x5B9E;&#x6700;&#x7EC8;&#x8C03;&#x7528;&#x7684;&#x5C31;&#x662F; <code>Object.keys</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function keys(object) {</span><br><span class="line"> return isArrayLike(object) ? arrayLikeKeys(object) : baseKeys(object);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="mixin-&#x884D;&#x751F;&#x7684;&#x51FD;&#x6570;-baseFunctions"><a href="#mixin-&#x884D;&#x751F;&#x7684;&#x51FD;&#x6570;-baseFunctions" class="headerlink" title="mixin &#x884D;&#x751F;&#x7684;&#x51FD;&#x6570; baseFunctions"></a>mixin &#x884D;&#x751F;&#x7684;&#x51FD;&#x6570; baseFunctions</h3><p>&#x8FD4;&#x56DE;&#x51FD;&#x6570;&#x6570;&#x7EC4;&#x96C6;&#x5408;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function baseFunctions(object, props) {</span><br><span class="line"> return arrayFilter(props, function(key) {</span><br><span class="line">  return isFunction(object[key]);</span><br><span class="line"> });</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="mixin-&#x884D;&#x751F;&#x7684;&#x51FD;&#x6570;-isFunction"><a href="#mixin-&#x884D;&#x751F;&#x7684;&#x51FD;&#x6570;-isFunction" class="headerlink" title="mixin &#x884D;&#x751F;&#x7684;&#x51FD;&#x6570; isFunction"></a>mixin &#x884D;&#x751F;&#x7684;&#x51FD;&#x6570; isFunction</h3><p>&#x5224;&#x65AD;&#x53C2;&#x6570;&#x662F;&#x5426;&#x662F;&#x51FD;&#x6570;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function isFunction(value) {</span><br><span class="line"> if (!isObject(value)) {</span><br><span class="line">  return false;</span><br><span class="line"> }</span><br><span class="line"> // The use of `Object#toString` avoids issues with the `typeof` operator</span><br><span class="line"> // in Safari 9 which returns &apos;object&apos; for typed arrays and other constructors.</span><br><span class="line"> var tag = baseGetTag(value);</span><br><span class="line"> return tag == funcTag || tag == genTag || tag == asyncTag || tag == proxyTag;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="mixin-&#x884D;&#x751F;&#x7684;&#x51FD;&#x6570;-arrayEach"><a href="#mixin-&#x884D;&#x751F;&#x7684;&#x51FD;&#x6570;-arrayEach" class="headerlink" title="mixin &#x884D;&#x751F;&#x7684;&#x51FD;&#x6570; arrayEach"></a>mixin &#x884D;&#x751F;&#x7684;&#x51FD;&#x6570; arrayEach</h3><p>&#x7C7B;&#x4F3C; [].forEarch</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function arrayEach(array, iteratee) {</span><br><span class="line"> var index = -1,</span><br><span class="line">  length = array == null ? 0 : array.length;</span><br><span class="line"></span><br><span class="line"> while (++index &lt; length) {</span><br><span class="line">  if (iteratee(array[index], index, array) === false) {</span><br><span class="line">   break;</span><br><span class="line">  }</span><br><span class="line"> }</span><br><span class="line"> return array;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="mixin-&#x884D;&#x751F;&#x7684;&#x51FD;&#x6570;-arrayPush"><a href="#mixin-&#x884D;&#x751F;&#x7684;&#x51FD;&#x6570;-arrayPush" class="headerlink" title="mixin &#x884D;&#x751F;&#x7684;&#x51FD;&#x6570; arrayPush"></a>mixin &#x884D;&#x751F;&#x7684;&#x51FD;&#x6570; arrayPush</h3><p>&#x7C7B;&#x4F3C; [].push</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function arrayPush(array, values) {</span><br><span class="line"> var index = -1,</span><br><span class="line">  length = values.length,</span><br><span class="line">  offset = array.length;</span><br><span class="line"></span><br><span class="line"> while (++index &lt; length) {</span><br><span class="line"> array[offset + index] = values[index];</span><br><span class="line"> }</span><br><span class="line"> return array;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="mixin-&#x884D;&#x751F;&#x7684;&#x51FD;&#x6570;-copyArray"><a href="#mixin-&#x884D;&#x751F;&#x7684;&#x51FD;&#x6570;-copyArray" class="headerlink" title="mixin &#x884D;&#x751F;&#x7684;&#x51FD;&#x6570; copyArray"></a>mixin &#x884D;&#x751F;&#x7684;&#x51FD;&#x6570; copyArray</h3><p>&#x62F7;&#x8D1D;&#x6570;&#x7EC4;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function copyArray(source, array) {</span><br><span class="line"> var index = -1,</span><br><span class="line">  length = source.length;</span><br><span class="line"></span><br><span class="line"> array || (array = Array(length));</span><br><span class="line"> while (++index &lt; length) {</span><br><span class="line">  array[index] = source[index];</span><br><span class="line"> }</span><br><span class="line"> return array;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="mixin-&#x6E90;&#x7801;&#x89E3;&#x6790;"><a href="#mixin-&#x6E90;&#x7801;&#x89E3;&#x6790;" class="headerlink" title="mixin &#x6E90;&#x7801;&#x89E3;&#x6790;"></a>mixin &#x6E90;&#x7801;&#x89E3;&#x6790;</h3><p><code>lodash</code> &#x6E90;&#x7801;&#x4E2D;&#x4E24;&#x6B21;&#x8C03;&#x7528; <code>mixin</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// Add methods that return wrapped values in chain sequences.</span><br><span class="line">lodash.after = after;</span><br><span class="line">// code ... &#x7B49; 153 &#x4E2A;&#x652F;&#x6301;&#x94FE;&#x5F0F;&#x8C03;&#x7528;&#x7684;&#x65B9;&#x6CD5;</span><br><span class="line"></span><br><span class="line">// Add methods to `lodash.prototype`.</span><br><span class="line">// &#x628A;lodash&#x4E0A;&#x7684;&#x9759;&#x6001;&#x65B9;&#x6CD5;&#x8D4B;&#x503C;&#x5230; lodash.prototype &#x4E0A;</span><br><span class="line">mixin(lodash, lodash);</span><br><span class="line"></span><br><span class="line">// Add methods that return unwrapped values in chain sequences.</span><br><span class="line">lodash.add = add;</span><br><span class="line">// code ... &#x7B49; 152 &#x4E2A;&#x4E0D;&#x652F;&#x6301;&#x94FE;&#x5F0F;&#x8C03;&#x7528;&#x7684;&#x65B9;&#x6CD5;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// &#x8FD9;&#x91CC;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x8FC7;&#x6EE4; after &#x7B49;&#x652F;&#x6301;&#x94FE;&#x5F0F;&#x8C03;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x83B7;&#x53D6;&#x5230; lodash &#x4E0A;&#x7684; add &#x7B49; &#x6DFB;&#x52A0;&#x5230;lodash.prototype &#x4E0A;&#x3002;</span><br><span class="line">mixin(lodash, (function() {</span><br><span class="line"> var source = {};</span><br><span class="line"> // baseForOwn &#x8FD9;&#x91CC;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x904D;&#x5386;lodash&#x4E0A;&#x7684;&#x9759;&#x6001;&#x65B9;&#x6CD5;&#xFF0C;&#x6267;&#x884C;&#x56DE;&#x8C03;&#x51FD;&#x6570;</span><br><span class="line"> baseForOwn(lodash, function(func, methodName) {</span><br><span class="line">  // &#x7B2C;&#x4E00;&#x6B21; mixin &#x8C03;&#x7528;&#x4E86;&#x6240;&#x4EE5;&#x8D4B;&#x503C;&#x5230;&#x4E86;lodash.prototype</span><br><span class="line">  // &#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x7528; Object.hasOwnProperty &#x6392;&#x9664;&#x4E0D;&#x5728;lodash.prototype &#x4E0A;&#x7684;&#x65B9;&#x6CD5;&#x3002;&#x4E5F;&#x5C31;&#x662F; add &#x7B49; 152 &#x4E2A;&#x4E0D;&#x652F;&#x6301;&#x94FE;&#x5F0F;&#x8C03;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#x3002;</span><br><span class="line">  if (!hasOwnProperty.call(lodash.prototype, methodName)) {</span><br><span class="line">   source[methodName] = func;</span><br><span class="line">  }</span><br><span class="line"> });</span><br><span class="line"> return source;</span><br><span class="line">// &#x6700;&#x540E;&#x4E00;&#x4E2A;&#x53C2;&#x6570;options &#x7279;&#x610F;&#x6CE8;&#x660E;&#x4E0D;&#x652F;&#x6301;&#x94FE;&#x5F0F;&#x8C03;&#x7528;</span><br><span class="line">}()), { &apos;chain&apos;: false });</span><br></pre></td></tr></table></figure>

<p>&#x7ED3;&#x5408;&#x4E24;&#x6B21;&#x8C03;&#x7528;<code>mixin</code> &#x4EE3;&#x5165;&#x5230;&#x6E90;&#x7801;&#x89E3;&#x6790;&#x5982;&#x4E0B;</p>
<p>&#x70B9;&#x51FB;&#x8FD9;&#x91CC;&#x5C55;&#x5F00;mixin&#x6E90;&#x7801;&#x53CA;&#x6CE8;&#x91CA;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function mixin(object, source, options) {</span><br><span class="line"> // source &#x5BF9;&#x8C61;&#x4E2D;&#x53EF;&#x4EE5;&#x679A;&#x4E3E;&#x7684;&#x5C5E;&#x6027;</span><br><span class="line"> var props = keys(source),</span><br><span class="line">  // source &#x5BF9;&#x8C61;&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#x540D;&#x79F0;&#x6570;&#x7EC4;</span><br><span class="line">  methodNames = baseFunctions(source, props);</span><br><span class="line"></span><br><span class="line"> if (options == null &amp;&amp;</span><br><span class="line">  !(isObject(source) &amp;&amp; (methodNames.length || !props.length))) {</span><br><span class="line">  // &#x5982;&#x679C; options &#x6CA1;&#x4F20;&#x4E3A; undefined  undefined == null &#x4E3A;true</span><br><span class="line">  // &#x4E14; &#x5982;&#x679C;source &#x4E0D;&#x4E3A; &#x5BF9;&#x8C61;&#x6216;&#x8005;&#x4E0D;&#x662F;&#x51FD;&#x6570;</span><br><span class="line">  // &#x4E14; source&#x5BF9;&#x8C61;&#x7684;&#x51FD;&#x6570;&#x51FD;&#x6570;&#x957F;&#x5EA6; &#x6216;&#x8005; source &#x5BF9;&#x8C61;&#x7684;&#x5C5E;&#x6027;&#x957F;&#x5EA6;&#x4E0D;&#x4E3A;0</span><br><span class="line">  // &#x628A; options &#x8D4B;&#x503C;&#x4E3A; source</span><br><span class="line">  options = source;</span><br><span class="line">  // &#x628A; source &#x8D4B;&#x503C;&#x4E3A; object</span><br><span class="line">  source = object;</span><br><span class="line">  // &#x628A; object &#x8D4B;&#x503C;&#x4E3A; this &#x4E5F;&#x5C31;&#x662F; _ (lodash)</span><br><span class="line">  object = this;</span><br><span class="line">  // &#x83B7;&#x53D6;&#x5230;&#x6240;&#x6709;&#x7684;&#x65B9;&#x6CD5;&#x540D;&#x79F0;&#x6570;&#x7EC4;</span><br><span class="line">  methodNames = baseFunctions(source, keys(source));</span><br><span class="line"> }</span><br><span class="line"> // &#x662F;&#x5426;&#x652F;&#x6301; &#x94FE;&#x5F0F;&#x8C03;&#x7528;</span><br><span class="line"> // options  &#x4E0D;&#x662F;&#x5BF9;&#x8C61;&#x6216;&#x8005;&#x4E0D;&#x662F;&#x51FD;&#x6570;&#xFF0C;&#x662F;null&#x6216;&#x8005;&#x5176;&#x4ED6;&#x503C;</span><br><span class="line"> // &#x5224;&#x65AD;options&#x662F;&#x5426;&#x662F;&#x5BF9;&#x8C61;&#x6216;&#x8005;&#x51FD;&#x6570;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x662F;&#x6216;&#x8005;&#x51FD;&#x6570;&#x5219;&#x4E0D;&#x4F1A;&#x6267;&#x884C; &apos;chain&apos; in options &#x4E5F;&#x5C31;&#x4E0D;&#x4F1A;&#x62A5;&#x9519;</span><br><span class="line"> //  &#x4E14; chain &#x5728; options&#x7684;&#x5BF9;&#x8C61;&#x6216;&#x8005;&#x539F;&#x578B;&#x94FE;&#x4E2D;</span><br><span class="line"> // &#x77E5;&#x8BC6;&#x70B9; in [MDN in :  https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/in</span><br><span class="line"> // &#x5982;&#x679C;&#x6307;&#x5B9A;&#x7684;&#x5C5E;&#x6027;&#x5728;&#x6307;&#x5B9A;&#x7684;&#x5BF9;&#x8C61;&#x6216;&#x5176;&#x539F;&#x578B;&#x94FE;&#x4E2D;&#xFF0C;&#x5219;in &#x8FD0;&#x7B97;&#x7B26;&#x8FD4;&#x56DE;true&#x3002;</span><br><span class="line"></span><br><span class="line"> // &#x6216;&#x8005; options.chain &#x8F6C;&#x5E03;&#x5C14;&#x503C;</span><br><span class="line"> var chain = !(isObject(options) &amp;&amp; &apos;chain&apos; in options) || !!options.chain,</span><br><span class="line">  // object &#x662F;&#x51FD;&#x6570;</span><br><span class="line">  isFunc = isFunction(object);</span><br><span class="line"></span><br><span class="line"> // &#x5FAA;&#x73AF; &#x65B9;&#x6CD5;&#x540D;&#x79F0;&#x6570;&#x7EC4;</span><br><span class="line"> arrayEach(methodNames, function(methodName) {</span><br><span class="line">  // &#x51FD;&#x6570;&#x672C;&#x8EAB;</span><br><span class="line">  var func = source[methodName];</span><br><span class="line">  // object &#x901A;&#x5E38;&#x662F; lodash  &#x4E5F;&#x8D4B;&#x503C;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x3002;</span><br><span class="line">  object[methodName] = func;</span><br><span class="line">  if (isFunc) {</span><br><span class="line">   // &#x5982;&#x679C;object&#x662F;&#x51FD;&#x6570; &#x8D4B;&#x503C;&#x5230;  object prototype  &#x4E0A;&#xFF0C;&#x901A;&#x5E38;&#x662F;lodash</span><br><span class="line">   object.prototype[methodName] = function() {</span><br><span class="line">    // &#x5B9E;&#x4F8B;&#x4E0A;&#x7684;__chain__ &#x5C5E;&#x6027; &#x662F;&#x5426;&#x652F;&#x6301;&#x94FE;&#x5F0F;&#x8C03;&#x7528;</span><br><span class="line">    // &#x8FD9;&#x91CC;&#x7684; this &#x662F; new LodashWrapper &#x5B9E;&#x4F8B; &#x7C7B;&#x4F3C;&#x5982;&#x4E0B;</span><br><span class="line">    /**</span><br><span class="line">     {</span><br><span class="line">     __actions__: [],</span><br><span class="line">     __chain__: true</span><br><span class="line">     __index__: 0</span><br><span class="line">     __values__: undefined</span><br><span class="line">     __wrapped__: []</span><br><span class="line">     }</span><br><span class="line">     **/</span><br><span class="line"></span><br><span class="line">    var chainAll = this.__chain__;</span><br><span class="line">    // options &#x4E2D;&#x7684; chain &#x5C5E;&#x6027; &#x662F;&#x5426;&#x652F;&#x6301;&#x94FE;&#x5F0F;&#x8C03;&#x7528;</span><br><span class="line">    // &#x4E24;&#x8005;&#x6709;&#x4E00;&#x4E2A;&#x7B26;&#x5408;&#x94FE;&#x5F0F;&#x8C03;&#x7528;  &#x6267;&#x884C;&#x4E0B;&#x9762;&#x7684;&#x4EE3;&#x7801;</span><br><span class="line">    if (chain || chainAll) {</span><br><span class="line">     // &#x901A;&#x5E38;&#x662F; lodash</span><br><span class="line">     var result = object(this.__wrapped__),</span><br><span class="line">     // &#x590D;&#x5236; &#x5B9E;&#x4F8B;&#x4E0A;&#x7684; __action__ &#x5230; result.__action__ &#x548C; action &#x4E0A;</span><br><span class="line">     actions = result.__actions__ = copyArray(this.__actions__);</span><br><span class="line"></span><br><span class="line">     // action &#x6DFB;&#x52A0; &#x51FD;&#x6570; &#x548C; args &#x548C; this &#x6307;&#x5411;&#xFF0C;&#x5EF6;&#x8FDF;&#x8BA1;&#x7B97;&#x8C03;&#x7528;&#x3002;</span><br><span class="line">     actions.push({ &apos;func&apos;: func, &apos;args&apos;: arguments, &apos;thisArg&apos;: object });</span><br><span class="line">     //&#x5B9E;&#x4F8B;&#x4E0A;&#x7684;__chain__ &#x5C5E;&#x6027;  &#x8D4B;&#x503C;&#x7ED9; result &#x7684; &#x5C5E;&#x6027; __chain__</span><br><span class="line">     result.__chain__ = chainAll;</span><br><span class="line">     // &#x6700;&#x540E;&#x8FD4;&#x56DE;&#x8FD9;&#x4E2A;&#x5B9E;&#x4F8B;</span><br><span class="line">     return result;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    // &#x90FD;&#x4E0D;&#x652F;&#x6301;&#x94FE;&#x5F0F;&#x8C03;&#x7528;&#x3002;&#x76F4;&#x63A5;&#x8C03;&#x7528;</span><br><span class="line">    // &#x628A;&#x5F53;&#x524D;&#x5B9E;&#x4F8B;&#x7684; value &#x548C; arguments &#x5BF9;&#x8C61; &#x4F20;&#x9012;&#x7ED9; func &#x51FD;&#x6570;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x8C03;&#x7528;&#x3002;&#x8FD4;&#x56DE;&#x8C03;&#x7528;&#x7ED3;&#x679C;&#x3002;</span><br><span class="line">    return func.apply(object, arrayPush([this.value()], arguments));</span><br><span class="line">   };</span><br><span class="line">  }</span><br><span class="line"> });</span><br><span class="line"></span><br><span class="line"> // &#x6700;&#x540E;&#x8FD4;&#x56DE;&#x5BF9;&#x8C61; object</span><br><span class="line"> return object;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5C0F;&#x7ED3;&#xFF1A;&#x7B80;&#x5355;&#x8BF4;&#x5C31;&#x662F;&#x628A;<code>lodash</code>&#x4E0A;&#x7684;&#x9759;&#x6001;&#x65B9;&#x6CD5;&#x8D4B;&#x503C;&#x5230;<code>lodash.prototype</code>&#x4E0A;&#x3002;&#x5206;&#x4E24;&#x6B21;&#x7B2C;&#x4E00;&#x6B21;&#x662F;&#x652F;&#x6301;&#x94FE;&#x5F0F;&#x8C03;&#x7528;&#xFF08;<code>lodash.after</code>&#x7B49; <code>153</code>&#x4E2A;&#x652F;&#x6301;&#x94FE;&#x5F0F;&#x8C03;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#xFF09;&#xFF0C;&#x7B2C;&#x4E8C;&#x6B21;&#x662F;&#x4E0D;&#x652F;&#x6301;&#x94FE;&#x5F0F;&#x8C03;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#xFF08;<code>lodash.add</code>&#x7B49;<code>152</code>&#x4E2A;&#x4E0D;&#x652F;&#x6301;&#x94FE;&#x5F0F;&#x8C03;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#xFF09;&#x3002;</p>
<h2 id="lodash-&#x7A76;&#x7ADF;&#x5728;-&#x548C;-prototype&#x6302;&#x8F7D;&#x4E86;&#x591A;&#x5C11;&#x65B9;&#x6CD5;&#x548C;&#x5C5E;&#x6027;"><a href="#lodash-&#x7A76;&#x7ADF;&#x5728;-&#x548C;-prototype&#x6302;&#x8F7D;&#x4E86;&#x591A;&#x5C11;&#x65B9;&#x6CD5;&#x548C;&#x5C5E;&#x6027;" class="headerlink" title="lodash &#x7A76;&#x7ADF;&#x5728;_&#x548C;_.prototype&#x6302;&#x8F7D;&#x4E86;&#x591A;&#x5C11;&#x65B9;&#x6CD5;&#x548C;&#x5C5E;&#x6027;"></a>lodash &#x7A76;&#x7ADF;&#x5728;_&#x548C;_.prototype&#x6302;&#x8F7D;&#x4E86;&#x591A;&#x5C11;&#x65B9;&#x6CD5;&#x548C;&#x5C5E;&#x6027;</h2><p>&#x518D;&#x6765;&#x770B;&#x4E0B;<code>lodash</code>&#x7A76;&#x7ADF;&#x6302;&#x8F7D;&#x5728;<code>_</code>&#x51FD;&#x6570;&#x5BF9;&#x8C61;&#x4E0A;&#x6709;&#x591A;&#x5C11;&#x9759;&#x6001;&#x65B9;&#x6CD5;&#x548C;&#x5C5E;&#x6027;&#xFF0C;&#x548C;&#x6302;&#x8F7D;<code>_.prototype</code>&#x4E0A;&#x6709;&#x591A;&#x5C11;&#x65B9;&#x6CD5;&#x548C;&#x5C5E;&#x6027;&#x3002;</p>
<p>&#x4F7F;&#x7528;<code>for in</code>&#x5FAA;&#x73AF;&#x4E00;&#x8BD5;&#x4FBF;&#x77E5;&#x3002;&#x770B;&#x5982;&#x4E0B;&#x4EE3;&#x7801;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;var staticMethods = [];</span><br><span class="line">var staticProperty = [];</span><br><span class="line">for(var name in _){</span><br><span class="line"> if(typeof _[name] === &apos;function&apos;){</span><br><span class="line">  staticMethods.push(name);</span><br><span class="line"> }</span><br><span class="line"> else{</span><br><span class="line">  staticProperty.push(name);</span><br><span class="line"> }</span><br><span class="line">}</span><br><span class="line">console.log(staticProperty); // [&quot;templateSettings&quot;, &quot;VERSION&quot;] 2&#x4E2A;</span><br><span class="line">console.log(staticMethods); // [&quot;after&quot;, &quot;ary&quot;, &quot;assign&quot;, &quot;assignIn&quot;, &quot;assignInWith&quot;, ...] 305&#x4E2A;</span><br></pre></td></tr></table></figure>

<p>&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x4E0A;&#x6587;&#x63D0;&#x53CA;&#x7684; <code>lodash.after</code> &#x7B49;<code>153</code>&#x4E2A;&#x652F;&#x6301;&#x94FE;&#x5F0F;&#x8C03;&#x7528;&#x7684;&#x51FD;&#x6570; &#x3001;<code>lodash.add</code> &#x7B49; <code>152</code>&#x4E0D;&#x652F;&#x6301;&#x94FE;&#x5F0F;&#x8C03;&#x7528;&#x7684;&#x51FD;&#x6570;&#x8D4B;&#x503C;&#x800C;&#x6765;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;var prototypeMethods = [];</span><br><span class="line">var prototypeProperty = [];</span><br><span class="line">for(var name in _.prototype){</span><br><span class="line"> if(typeof _.prototype[name] === &apos;function&apos;){</span><br><span class="line">  prototypeMethods.push(name);</span><br><span class="line"> }</span><br><span class="line"> else{</span><br><span class="line">  prototypeProperty.push(name);</span><br><span class="line"> }</span><br><span class="line">}</span><br><span class="line">console.log(prototypeProperty); // []</span><br><span class="line">console.log(prototypeMethods); // [&quot;after&quot;, &quot;all&quot;, &quot;allKeys&quot;, &quot;any&quot;, &quot;assign&quot;, ...] 317&#x4E2A;</span><br></pre></td></tr></table></figure>

<p>&#x76F8;&#x6BD4;<code>lodash</code>&#x4E0A;&#x7684;&#x9759;&#x6001;&#x65B9;&#x6CD5;&#x591A;&#x4E86;<code>12</code>&#x4E2A;&#xFF0C;&#x8BF4;&#x660E;&#x9664;&#x4E86; <code>mixin</code> &#x5916;&#xFF0C;&#x8FD8;&#x6709;<code>12</code>&#x4E2A;&#x5176;&#x4ED6;&#x5F62;&#x5F0F;&#x8D4B;&#x503C;&#x800C;&#x6765;&#x3002;</p>
<p>&#x652F;&#x6301;&#x94FE;&#x5F0F;&#x8C03;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#x6700;&#x540E;&#x8FD4;&#x56DE;&#x662F;&#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;&#xFF0C;&#x83B7;&#x53D6;&#x6700;&#x540E;&#x7684;&#x5904;&#x7406;&#x7684;&#x7ED3;&#x679C;&#x503C;&#xFF0C;&#x6700;&#x540E;&#x9700;&#x8981;&#x8C03;&#x7528;<code>value</code>&#x65B9;&#x6CD5;&#x3002;</p>
<p>&#x7B14;&#x8005;&#x753B;&#x4E86;&#x4E00;&#x5F20;&#x8868;&#x793A;<code>lodash</code>&#x7684;&#x65B9;&#x6CD5;&#x548C;&#x5C5E;&#x6027;&#x6302;&#x8F7D;&#x5173;&#x7CFB;&#x56FE;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/263834b3df04d87e9c4b71138e1945febe9d739f836208608852b58185519fb3" alt="&#x7684;&#x65B9;&#x6CD5;&#x548C;&#x5C5E;&#x6027;&#x6302;&#x8F7D;&#x5173;&#x7CFB;"></p>
<p><code>lodash</code>&#x7684;&#x65B9;&#x6CD5;&#x548C;&#x5C5E;&#x6027;&#x6302;&#x8F7D;&#x5173;&#x7CFB;</p>
<h2 id="&#x8BF7;&#x51FA;&#x8D2F;&#x7A7F;&#x4E0B;&#x6587;&#x7684;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;"><a href="#&#x8BF7;&#x51FA;&#x8D2F;&#x7A7F;&#x4E0B;&#x6587;&#x7684;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;" class="headerlink" title="&#x8BF7;&#x51FA;&#x8D2F;&#x7A7F;&#x4E0B;&#x6587;&#x7684;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;"></a>&#x8BF7;&#x51FA;&#x8D2F;&#x7A7F;&#x4E0B;&#x6587;&#x7684;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;var result = _.chain([1, 2, 3, 4, 5])</span><br><span class="line">.map(el =&gt; {</span><br><span class="line"> console.log(el); // 1, 2, 3</span><br><span class="line"> return el + 1;</span><br><span class="line">})</span><br><span class="line">.take(3)</span><br><span class="line">.value();</span><br><span class="line">// lodash&#x4E2D;&#x8FD9;&#x91CC;&#x7684;`map`&#x4EC5;&#x6267;&#x884C;&#x4E86;`3`&#x6B21;&#x3002;</span><br><span class="line">// &#x5177;&#x4F53;&#x529F;&#x80FD;&#x4E5F;&#x5F88;&#x7B80;&#x5355; &#x6570;&#x7EC4; 1-5 &#x52A0;&#x4E00;&#xFF0C;&#x6700;&#x540E;&#x83B7;&#x53D6;&#x5176;&#x4E2D;&#x4E09;&#x4E2A;&#x503C;&#x3002;</span><br><span class="line">console.log(&apos;result:&apos;, result);</span><br></pre></td></tr></table></figure>

<p><strong>&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x8FD9;&#x91CC;<code>lodash</code>&#x806A;&#x660E;&#x7684;&#x77E5;&#x9053;&#x4E86;&#x6700;&#x540E;&#x9700;&#x8981;&#x51E0;&#x4E2A;&#x503C;&#xFF0C;&#x5C31;&#x6267;&#x884C;&#x51E0;&#x6B21;<code>map</code>&#x5FAA;&#x73AF;&#xFF0C;&#x5BF9;&#x4E8E;&#x5F88;&#x5927;&#x7684;&#x6570;&#x7EC4;&#xFF0C;&#x63D0;&#x5347;&#x6027;&#x80FD;&#x5F88;&#x6709;&#x5E2E;&#x52A9;&#x3002;</strong>  </p>
<p>&#x800C;<code>underscore</code>&#x6267;&#x884C;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x5176;&#x4E2D;<code>map</code>&#x6267;&#x884C;&#x4E86;5&#x6B21;&#x3002;<br>&#x5982;&#x679C;&#x662F;&#x5E73;&#x5E38;&#x5B9E;&#x73B0;&#x8BE5;&#x529F;&#x80FD;&#x4E5F;&#x7B80;&#x5355;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;var result = [1, 2, 3, 4, 5].map(el =&gt; el + 1).slice(0, 3);</span><br><span class="line">console.log(&apos;result:&apos;, result);</span><br></pre></td></tr></table></figure>

<p>&#x800C;&#x76F8;&#x6BD4;<code>lodash</code>&#x8FD9;&#x91CC;&#x7684;<code>map</code>&#x6267;&#x884C;&#x4E86;<code>5</code>&#x6B21;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// &#x4E0D;&#x4F7F;&#x7528; map&#x3001;slice</span><br><span class="line">var result = [];</span><br><span class="line">var arr = [1, 2, 3, 4, 5];</span><br><span class="line">for (var i = 0; i &lt; 3; i++){</span><br><span class="line"> result[i] = arr[i] + 1;</span><br><span class="line">}</span><br><span class="line">console.log(result, &apos;result&apos;);</span><br></pre></td></tr></table></figure>

<p>&#x7B80;&#x5355;&#x8BF4;&#x8FD9;&#x91CC;&#x7684;<code>map</code>&#x65B9;&#x6CD5;&#xFF0C;&#x6DFB;&#x52A0; <code>LazyWrapper</code> &#x7684;&#x65B9;&#x6CD5;&#x5230; <code>lodash.prototype</code>&#x5B58;&#x50A8;&#x4E0B;&#x6765;&#xFF0C;&#x6700;&#x540E;&#x8C03;&#x7528; <code>value</code>&#x65F6;&#x518D;&#x8C03;&#x7528;&#x3002;<br>&#x5177;&#x4F53;&#x770B;&#x4E0B;&#x6587;&#x6E90;&#x7801;&#x5B9E;&#x73B0;&#x3002;</p>
<h2 id="&#x6DFB;&#x52A0;-LazyWrapper-&#x7684;&#x65B9;&#x6CD5;&#x5230;-lodash-prototype"><a href="#&#x6DFB;&#x52A0;-LazyWrapper-&#x7684;&#x65B9;&#x6CD5;&#x5230;-lodash-prototype" class="headerlink" title="&#x6DFB;&#x52A0; LazyWrapper &#x7684;&#x65B9;&#x6CD5;&#x5230; lodash.prototype"></a>&#x6DFB;&#x52A0; <code>LazyWrapper</code> &#x7684;&#x65B9;&#x6CD5;&#x5230; <code>lodash.prototype</code></h2><p>&#x4E3B;&#x8981;&#x662F;&#x5982;&#x4E0B;&#x65B9;&#x6CD5;&#x6DFB;&#x52A0;&#x5230;&#x5230; <code>lodash.prototype</code> &#x539F;&#x578B;&#x4E0A;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// &quot;constructor&quot;</span><br><span class="line">[&quot;drop&quot;, &quot;dropRight&quot;, &quot;take&quot;, &quot;takeRight&quot;, &quot;filter&quot;, &quot;map&quot;, &quot;takeWhile&quot;, &quot;head&quot;, &quot;last&quot;, &quot;initial&quot;, &quot;tail&quot;, &quot;compact&quot;, &quot;find&quot;, &quot;findLast&quot;, &quot;invokeMap&quot;, &quot;reject&quot;, &quot;slice&quot;, &quot;takeRightWhile&quot;, &quot;toArray&quot;, &quot;clone&quot;, &quot;reverse&quot;, &quot;value&quot;]</span><br></pre></td></tr></table></figure>

<p>&#x70B9;&#x51FB;&#x8FD9;&#x91CC;&#x5C55;&#x5F00;&#x5177;&#x4F53;&#x6E90;&#x7801;&#x53CA;&#x6CE8;&#x91CA;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// Add `LazyWrapper` methods to `lodash.prototype`.</span><br><span class="line">// baseForOwn &#x8FD9;&#x91CC;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x904D;&#x5386;LazyWrapper.prototype&#x4E0A;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x6267;&#x884C;&#x56DE;&#x8C03;&#x51FD;&#x6570;</span><br><span class="line">baseForOwn(LazyWrapper.prototype, function(func, methodName) {</span><br><span class="line"> // &#x68C0;&#x6D4B;&#x51FD;&#x6570;&#x540D;&#x79F0;&#x662F;&#x5426;&#x662F;&#x8FED;&#x4EE3;&#x5668;&#x4E5F;&#x5C31;&#x662F;&#x5FAA;&#x73AF;</span><br><span class="line"> var checkIteratee = /^(?:filter|find|map|reject)|While$/.test(methodName),</span><br><span class="line">  // &#x68C0;&#x6D4B;&#x51FD;&#x6570;&#x540D;&#x79F0;&#x662F;&#x5426;head&#x548C;last</span><br><span class="line">  // &#x987A;&#x4FBF;&#x63D0;&#x4E00;&#x4E0B; ()&#x8FD9;&#x4E2A;&#x662F;&#x6355;&#x83B7;&#x5206;&#x7EC4; &#x800C;&#x52A0;&#x4E0A; ?:  &#x5219;&#x662F;&#x975E;&#x6355;&#x83B7;&#x5206;&#x7EC4; &#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x4E0D;&#x7528;&#x4E8E;&#x5176;&#x4ED6;&#x64CD;&#x4F5C;</span><br><span class="line">  isTaker = /^(?:head|last)$/.test(methodName),</span><br><span class="line">  // lodashFunc &#x662F; &#x6839;&#x636E; isTaker &#x7EC4;&#x5408; takeRight take methodName</span><br><span class="line">  lodashFunc = lodash[isTaker ? (&apos;take&apos; + (methodName == &apos;last&apos; ? &apos;Right&apos; : &apos;&apos;)) : methodName],</span><br><span class="line">  // &#x6839;&#x636E;isTaker &#x548C; &#x662F; find &#x5224;&#x65AD;&#x7ED3;&#x679C;&#x662F;&#x5426; &#x5305;&#x88C5;</span><br><span class="line">  retUnwrapped = isTaker || /^find/.test(methodName);</span><br><span class="line"></span><br><span class="line"> // &#x5982;&#x679C;&#x4E0D;&#x5B58;&#x5728;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x5C31;&#x4E0D;&#x5F80;&#x4E0B;&#x6267;&#x884C;</span><br><span class="line"> if (!lodashFunc) {</span><br><span class="line">  return;</span><br><span class="line"> }</span><br><span class="line"> // &#x628A; lodash.prototype &#x65B9;&#x6CD5;&#x8D4B;&#x503C;&#x5230;lodash.prototype</span><br><span class="line"> lodash.prototype[methodName] = function() {</span><br><span class="line">  // &#x53D6;&#x5B9E;&#x4F8B;&#x4E2D;&#x7684;__wrapped__ &#x503C; &#x4F8B;&#x5B50;&#x4E2D;&#x5219;&#x662F; [1,2,3,4,5]</span><br><span class="line">  var value = this.__wrapped__,</span><br><span class="line">   // &#x5982;&#x679C;&#x662F;head&#x548C;last &#x65B9;&#x6CD5; isTaker &#x8FD4;&#x56DE; [1], &#x5426;&#x5219;&#x662F;arguments&#x5BF9;&#x8C61;</span><br><span class="line">   args = isTaker ? [1] : arguments,</span><br><span class="line">   // &#x5982;&#x679C;value &#x662F;LayeWrapper&#x7684;&#x5B9E;&#x4F8B;</span><br><span class="line">   isLazy = value instanceof LazyWrapper,</span><br><span class="line">   // &#x8FED;&#x4EE3;&#x5668; &#x5FAA;&#x73AF;</span><br><span class="line">   iteratee = args[0],</span><br><span class="line">   // &#x4F7F;&#x7528;useLazy isLazy value&#x6216;&#x8005;&#x662F;&#x6570;&#x7EC4;</span><br><span class="line">   useLazy = isLazy || isArray(value);</span><br><span class="line"></span><br><span class="line">  var interceptor = function(value) {</span><br><span class="line">   // &#x51FD;&#x6570;&#x6267;&#x884C; value args &#x7EC4;&#x5408;&#x6210;&#x6570;&#x7EC4;&#x53C2;&#x6570;</span><br><span class="line">   var result = lodashFunc.apply(lodash, arrayPush([value], args));</span><br><span class="line">   // &#x5982;&#x679C;&#x662F; head &#x548C; last (isTaker) &#x652F;&#x6301;&#x94FE;&#x5F0F;&#x8C03;&#x7528; &#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570; &#x5426;&#x5219; &#x8FD4;&#x56DE;result</span><br><span class="line">   return (isTaker &amp;&amp; chainAll) ? result[0] : result;</span><br><span class="line">  };</span><br><span class="line"></span><br><span class="line">  // useLazy true &#x5E76;&#x4E14; &#x51FD;&#x6570;checkIteratee &#x4E14;&#x8FED;&#x4EE3;&#x5668;&#x662F;&#x51FD;&#x6570;&#xFF0C;&#x4E14;&#x8FED;&#x4EE3;&#x5668;&#x53C2;&#x6570;&#x4E2A;&#x6570;&#x4E0D;&#x7B49;&#x4E8E;1</span><br><span class="line">  if (useLazy &amp;&amp; checkIteratee &amp;&amp; typeof iteratee == &apos;function&apos; &amp;&amp; iteratee.length != 1) {</span><br><span class="line">   // Avoid lazy use if the iteratee has a &quot;length&quot; value other than `1`.</span><br><span class="line">   // useLazy &#x8D4B;&#x503C;&#x4E3A; false</span><br><span class="line">   // isLazy &#x8D4B;&#x503C;&#x4E3A; false</span><br><span class="line">   isLazy = useLazy = false;</span><br><span class="line">  }</span><br><span class="line">  // &#x53D6;&#x5B9E;&#x4F8B;&#x4E0A;&#x7684; __chain__</span><br><span class="line">  var chainAll = this.__chain__,</span><br><span class="line">   // &#x5B58;&#x50A8;&#x7684;&#x5F85;&#x6267;&#x884C;&#x7684;&#x51FD;&#x6570; __actions__ &#x4E8C;&#x6B21;&#x53D6;&#x53CD;&#x662F;&#x5E03;&#x5C14;&#x503C; &#x4E5F;&#x5C31;&#x662F;&#x7B49;&#x4E8E;0&#x6216;&#x8005;&#x5927;&#x4E8E;0&#x4E24;&#x79CD;&#x7ED3;&#x679C;</span><br><span class="line">   isHybrid = !!this.__actions__.length,</span><br><span class="line">   // &#x662F;&#x5426;&#x4E0D;&#x5305;&#x88C5; &#x7528;&#x7ED3;&#x679C;&#x662F;&#x5426;&#x4E0D;&#x5305;&#x88C5; &#x4E14; &#x4E0D;&#x652F;&#x6301;&#x94FE;&#x5F0F;&#x8C03;&#x7528;</span><br><span class="line">   isUnwrapped = retUnwrapped &amp;&amp; !chainAll,</span><br><span class="line">   // &#x662F;&#x5426;&#x4EC5;Lazy &#x7528;isLazy &#x548C; &#x5B58;&#x50A8;&#x7684;&#x51FD;&#x6570;</span><br><span class="line">   onlyLazy = isLazy &amp;&amp; !isHybrid;</span><br><span class="line"></span><br><span class="line">  // &#x7ED3;&#x679C;&#x4E0D;&#x5305;&#x88C5; &#x4E14; useLazy &#x4E3A; true</span><br><span class="line">  if (!retUnwrapped &amp;&amp; useLazy) {</span><br><span class="line">   // &#x5B9E;&#x4F8B; new LazyWrapper &#x8FD9;&#x91CC;&#x7684;this &#x662F; new LodashWrapper()</span><br><span class="line">   value = onlyLazy ? value : new LazyWrapper(this);</span><br><span class="line">   // result &#x6267;&#x884C;&#x51FD;&#x6570;&#x7ED3;&#x679C;</span><br><span class="line">   var result = func.apply(value, args);</span><br><span class="line"></span><br><span class="line">   /*</span><br><span class="line">   *</span><br><span class="line">   // _.thru(value, interceptor)</span><br><span class="line">   // &#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x7C7B;&#x4F3C; _.tap&#xFF0C; &#x9664;&#x4E86;&#x5B83;&#x8FD4;&#x56DE; interceptor &#x7684;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x3002;&#x8BE5;&#x65B9;&#x6CD5;&#x7684;&#x76EE;&#x7684;&#x662F;&quot;&#x4F20;&#x9012;&quot; &#x503C;&#x5230;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#x94FE;&#x5E8F;&#x5217;&#x4EE5;&#x53D6;&#x4EE3;&#x4E2D;&#x95F4;&#x7ED3;&#x679C;&#x3002;</span><br><span class="line">   _([1, 2, 3])</span><br><span class="line">   .tap(function(array) {</span><br><span class="line">    // &#x6539;&#x53D8;&#x4F20;&#x5165;&#x7684;&#x6570;&#x7EC4;</span><br><span class="line">    array.pop();</span><br><span class="line">   })</span><br><span class="line">   .reverse()</span><br><span class="line">   .value();</span><br><span class="line">   // =&gt; [2, 1]</span><br><span class="line">   */</span><br><span class="line"></span><br><span class="line">   // thisArg &#x6307;&#x5411;undefined &#x6216;&#x8005;null &#x975E;&#x4E25;&#x683C;&#x6A21;&#x5F0F;&#x4E0B;&#x662F;&#x6307;&#x5411;window&#xFF0C;&#x4E25;&#x683C;&#x6A21;&#x5F0F;&#x662F;undefined &#x6216;&#x8005;nll</span><br><span class="line">   result.__actions__.push({ &apos;func&apos;: thru, &apos;args&apos;: [interceptor], &apos;thisArg&apos;: undefined });</span><br><span class="line">   // &#x8FD4;&#x56DE;&#x5B9E;&#x4F8B; lodashWrapper</span><br><span class="line">   return new LodashWrapper(result, chainAll);</span><br><span class="line">  }</span><br><span class="line">  // &#x4E0D;&#x5305;&#x88C5; &#x4E14; onlyLazy &#x4E3A; true</span><br><span class="line">  if (isUnwrapped &amp;&amp; onlyLazy) {</span><br><span class="line">   // &#x6267;&#x884C;&#x51FD;&#x6570;</span><br><span class="line">   return func.apply(this, args);</span><br><span class="line">  }</span><br><span class="line">  // &#x4E0A;&#x9762;&#x90FD;&#x6CA1;&#x6709;&#x6267;&#x884C;&#xFF0C;&#x6267;&#x884C;&#x5230;&#x8FD9;&#x91CC;&#x4E86;</span><br><span class="line">  // &#x6267;&#x884C; thru &#x51FD;&#x6570;&#xFF0C;&#x56DE;&#x8C03;&#x51FD;&#x6570; &#x662F; interceptor</span><br><span class="line">  result = this.thru(interceptor);</span><br><span class="line">  return isUnwrapped ? (isTaker ? result.value()[0] : result.value()) : result;</span><br><span class="line"> };</span><br><span class="line">});</span><br></pre></td></tr></table></figure>

<p>&#x5C0F;&#x7ED3;&#x4E00;&#x4E0B;&#xFF0C;&#x5199;&#x4E86;&#x8FD9;&#x4E48;&#x591A;&#x6CE8;&#x91CA;&#xFF0C;&#x7B80;&#x5355;&#x8BF4;&#xFF1A;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x7528;<code>LazyWrapper.prototype</code> &#x6539;&#x5199;&#x539F;&#x5148;&#x5728;<code>lodash.prototype</code>&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x5224;&#x65AD;&#x51FD;&#x6570;&#x662F;&#x5426;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x60F0;&#x6027;&#x6C42;&#x503C;&#xFF0C;&#x9700;&#x8981;&#x65F6;&#x518D;&#x8C03;&#x7528;&#x3002;</p>
<p><strong>&#x8BFB;&#x8005;&#x53EF;&#x4EE5;&#x65AD;&#x70B9;&#x8C03;&#x8BD5;&#x4E00;&#x4E0B;&#xFF0C;&#x5584;&#x7528;&#x65AD;&#x70B9;&#x8FDB;&#x5165;&#x51FD;&#x6570;&#x529F;&#x80FD;&#xFF0C;&#x5BF9;&#x7740;&#x6CE8;&#x91CA;&#x770B;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x66F4;&#x52A0;&#x6E05;&#x6670;&#x3002;</strong></p>
<p>&#x70B9;&#x51FB;&#x67E5;&#x770B;&#x65AD;&#x70B9;&#x8C03;&#x8BD5;&#x7684;&#x90E8;&#x5206;&#x622A;&#x56FE;<br><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/d115547f954ef044e01e787af84558d70e635f9b47979e75b0ab21cf83d9de8e" alt="&#x4F8B;&#x5B50;&#x7684;chain&#x548C;map&#x6267;&#x884C;&#x540E;&#x7684;debugger&#x622A;&#x56FE;"></p>
<p>&#x4F8B;&#x5B50;&#x7684;chain&#x548C;map&#x6267;&#x884C;&#x540E;&#x7684;debugger&#x622A;&#x56FE;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/0ea3edf4a014bf64da54e1f7e6ed11417f00da5e7910686e3baf4b11db1d4d87" alt="&#x4F8B;&#x5B50;&#x7684;chain&#x548C;map&#x6267;&#x884C;&#x540E;&#x7684;&#x7ED3;&#x679C;&#x622A;&#x56FE;"></p>
<p>&#x4F8B;&#x5B50;&#x7684;chain&#x548C;map&#x6267;&#x884C;&#x540E;&#x7684;&#x7ED3;&#x679C;&#x622A;&#x56FE;</p>
<p>&#x94FE;&#x5F0F;&#x8C03;&#x7528;&#x6700;&#x540E;&#x90FD;&#x662F;&#x8FD4;&#x56DE;&#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;&#xFF0C;&#x5B9E;&#x9645;&#x7684;&#x5904;&#x7406;&#x6570;&#x636E;&#x7684;&#x51FD;&#x6570;&#x90FD;&#x6CA1;&#x6709;&#x8C03;&#x7528;&#xFF0C;&#x800C;&#x662F;&#x88AB;&#x5B58;&#x50A8;&#x5B58;&#x50A8;&#x4E0B;&#x6765;&#x4E86;&#xFF0C;&#x6700;&#x540E;&#x8C03;&#x7528;<code>value</code>&#x65B9;&#x6CD5;&#xFF0C;&#x624D;&#x6267;&#x884C;&#x8FD9;&#x4E9B;&#x51FD;&#x6570;&#x3002;</p>
<h2 id="lodash-prototype-value-&#x5373;-wrapperValue"><a href="#lodash-prototype-value-&#x5373;-wrapperValue" class="headerlink" title="lodash.prototype.value &#x5373; wrapperValue"></a>lodash.prototype.value &#x5373; wrapperValue</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function baseWrapperValue(value, actions) {</span><br><span class="line"> var result = value;</span><br><span class="line"> // &#x5982;&#x679C;&#x662F;lazyWrapper&#x7684;&#x5B9E;&#x4F8B;&#xFF0C;&#x5219;&#x8C03;&#x7528;LazyWrapper.prototype.value &#x65B9;&#x6CD5;&#xFF0C;&#x4E5F;&#x5C31;&#x662F; lazyValue &#x65B9;&#x6CD5;</span><br><span class="line"> if (result instanceof LazyWrapper) {</span><br><span class="line">  result = result.value();</span><br><span class="line"> }</span><br><span class="line"> // &#x7C7B;&#x4F3C; [].reduce()&#xFF0C;&#x628A;&#x4E0A;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x4F20;&#x9012;&#x7ED9;&#x4E0B;&#x4E00;&#x4E2A;&#x51FD;&#x6570;</span><br><span class="line"> return arrayReduce(actions, function(result, action) {</span><br><span class="line">  return action.func.apply(action.thisArg, arrayPush([result], action.args));</span><br><span class="line"> }, result);</span><br><span class="line">}</span><br><span class="line">function wrapperValue() {</span><br><span class="line"> return baseWrapperValue(this.__wrapped__, this.__actions__);</span><br><span class="line">}</span><br><span class="line">lodash.prototype.toJSON = lodash.prototype.valueOf = lodash.prototype.value = wrapperValue;</span><br></pre></td></tr></table></figure>

<p>&#x5982;&#x679C;&#x662F;&#x60F0;&#x6027;&#x6C42;&#x503C;&#xFF0C;&#x5219;&#x8C03;&#x7528;&#x7684;&#x662F; <code>LazyWrapper.prototype.value</code> &#x5373; <code>lazyValue</code>&#x3002;</p>
<h2 id="LazyWrapper-prototype-value-&#x5373;-lazyValue-&#x60F0;&#x6027;&#x6C42;&#x503C;"><a href="#LazyWrapper-prototype-value-&#x5373;-lazyValue-&#x60F0;&#x6027;&#x6C42;&#x503C;" class="headerlink" title="LazyWrapper.prototype.value &#x5373; lazyValue &#x60F0;&#x6027;&#x6C42;&#x503C;"></a>LazyWrapper.prototype.value &#x5373; lazyValue &#x60F0;&#x6027;&#x6C42;&#x503C;</h2><p>&#x70B9;&#x51FB;&#x8FD9;&#x91CC;&#x5C55;&#x5F00;lazyValue&#x6E90;&#x7801;&#x53CA;&#x6CE8;&#x91CA;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;function LazyWrapper(value) {</span><br><span class="line"> // &#x53C2;&#x6570; value</span><br><span class="line"> this.__wrapped__ = value;</span><br><span class="line"> // &#x6267;&#x884C;&#x7684;&#x51FD;&#x6570;</span><br><span class="line"> this.__actions__ = [];</span><br><span class="line"> this.__dir__ = 1;</span><br><span class="line"> // &#x8FC7;&#x6EE4;</span><br><span class="line"> this.__filtered__ = false;</span><br><span class="line"> // &#x5B58;&#x50A8;&#x8FED;&#x4EE3;&#x5668;&#x51FD;&#x6570;</span><br><span class="line"> this.__iteratees__ = [];</span><br><span class="line"> // &#x9ED8;&#x8BA4;&#x6700;&#x5927;&#x53D6;&#x503C;&#x4E2A;&#x6570;</span><br><span class="line"> this.__takeCount__ = MAX_ARRAY_LENGTH;</span><br><span class="line"> // &#x5177;&#x4F53;&#x53D6;&#x503C;&#x591A;&#x5C11;&#x4E2A;&#xFF0C;&#x5B58;&#x50A8;&#x51FD;&#x6570;&#x548C;&#x7C7B;&#x578B;</span><br><span class="line"> this.__views__ = [];</span><br><span class="line">}</span><br><span class="line">/**</span><br><span class="line">* Extracts the unwrapped value from its lazy wrapper.</span><br><span class="line">*</span><br><span class="line">* @private</span><br><span class="line">* @name value</span><br><span class="line">* @memberOf LazyWrapper</span><br><span class="line">* @returns {*} Returns the unwrapped value.</span><br><span class="line">*/</span><br><span class="line">function lazyValue() {</span><br><span class="line"> // this.__wrapped__ &#x662F; new LodashWrapper &#x5B9E;&#x4F8B; &#x6240;&#x4EE5;&#x6267;&#x884C;.value &#x83B7;&#x53D6;&#x539F;&#x59CB;&#x503C;</span><br><span class="line"> var array = this.__wrapped__.value(),</span><br><span class="line">  //</span><br><span class="line">  dir = this.__dir__,</span><br><span class="line">  // &#x662F;&#x5426;&#x662F;&#x51FD;&#x6570;</span><br><span class="line">  isArr = isArray(array),</span><br><span class="line">  // &#x662F;&#x5426;&#x4ECE;&#x53F3;&#x8FB9;&#x5F00;&#x59CB;</span><br><span class="line">  isRight = dir &lt; 0,</span><br><span class="line">  // &#x6570;&#x7EC4;&#x7684;&#x957F;&#x5EA6;&#x3002;&#x5982;&#x679C;&#x4E0D;&#x662F;&#x6570;&#x7EC4;&#xFF0C;&#x5219;&#x662F;0</span><br><span class="line">  arrLength = isArr ? array.length : 0,</span><br><span class="line">  // &#x83B7;&#x53D6; take(3) &#x4E0A;&#x8FF0;&#x4F8B;&#x5B50;&#x4E2D; &#x5219;&#x662F; start: 0&#xFF0C;end: 3</span><br><span class="line">  view = getView(0, arrLength, this.__views__),</span><br><span class="line">  start = view.start,</span><br><span class="line">  end = view.end,</span><br><span class="line">  // &#x957F;&#x5EA6; 3</span><br><span class="line">  length = end - start,</span><br><span class="line">  // &#x5982;&#x679C;&#x662F;&#x662F;&#x4ECE;&#x53F3;&#x5F00;&#x59CB;</span><br><span class="line">  index = isRight ? end : (start - 1),</span><br><span class="line">  // &#x5B58;&#x50A8;&#x7684;&#x8FED;&#x4EE3;&#x5668;&#x6570;&#x7EC4;</span><br><span class="line">  iteratees = this.__iteratees__,</span><br><span class="line">  // &#x8FED;&#x4EE3;&#x5668;&#x6570;&#x7EC4;&#x957F;&#x5EA6;</span><br><span class="line">  iterLength = iteratees.length,</span><br><span class="line">  // &#x7ED3;&#x679C;resIndex</span><br><span class="line">  resIndex = 0,</span><br><span class="line">  // &#x6700;&#x540E;&#x83B7;&#x53D6;&#x51E0;&#x4E2A;&#x503C;&#xFF0C;&#x4E5F;&#x5C31;&#x662F; 3</span><br><span class="line">  takeCount = nativeMin(length, this.__takeCount__);</span><br><span class="line"></span><br><span class="line"> // &#x5982;&#x679C;&#x4E0D;&#x662F;&#x6570;&#x7EC4;&#xFF0C;&#x6216;&#x8005; &#x4E0D;&#x662F;&#x4ECE;&#x53F3;&#x5F00;&#x59CB; &#x5E76;&#x4E14; &#x53C2;&#x6570;&#x6570;&#x7EC4;&#x957F;&#x5EA6;&#x7B49;&#x4E8E;take&#x7684;&#x957F;&#x5EA6; takeCount&#x7B49;&#x4E8E;&#x957F;&#x5EA6;</span><br><span class="line"> // &#x5219;&#x76F4;&#x63A5;&#x8C03;&#x7528; baseWrapperValue &#x4E0D;&#x9700;&#x8981;</span><br><span class="line"> if (!isArr || (!isRight &amp;&amp; arrLength == length &amp;&amp; takeCount == length)) {</span><br><span class="line">  return baseWrapperValue(array, this.__actions__);</span><br><span class="line"> }</span><br><span class="line"> var result = [];</span><br><span class="line"></span><br><span class="line"> // &#x6807;&#x7B7E;&#x8BED;&#x53E5; label</span><br><span class="line"> // MDN label &#x94FE;&#x63A5;</span><br><span class="line"> // https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/label</span><br><span class="line"> // &#x6807;&#x8BB0;&#x8BED;&#x53E5;&#x53EF;&#x4EE5;&#x548C; break &#x6216; continue &#x8BED;&#x53E5;&#x4E00;&#x8D77;&#x4F7F;&#x7528;&#x3002;&#x6807;&#x8BB0;&#x5C31;&#x662F;&#x5728;&#x4E00;&#x6761;&#x8BED;&#x53E5;&#x524D;&#x9762;&#x52A0;&#x4E2A;&#x53EF;&#x4EE5;&#x5F15;&#x7528;&#x7684;&#x6807;&#x8BC6;&#x7B26;&#xFF08;identifier&#xFF09;&#x3002;</span><br><span class="line"> outer:</span><br><span class="line"> while (length-- &amp;&amp; resIndex &lt; takeCount) {</span><br><span class="line">  index += dir;</span><br><span class="line"></span><br><span class="line">  var iterIndex = -1,</span><br><span class="line">   // &#x6570;&#x7EC4;&#x7B2C;&#x4E00;&#x9879;</span><br><span class="line">   value = array[index];</span><br><span class="line"></span><br><span class="line">  while (++iterIndex &lt; iterLength) {</span><br><span class="line">   // &#x8FED;&#x4EE3;&#x5668;&#x6570;&#x7EC4; {iteratee: function{}, typy: 2}</span><br><span class="line">   var data = iteratees[iterIndex],</span><br><span class="line">    iteratee = data.iteratee,</span><br><span class="line">    type = data.type,</span><br><span class="line">    // &#x7ED3;&#x679C; &#x8FED;&#x4EE3;&#x5668;&#x6267;&#x884C;&#x7ED3;&#x679C;</span><br><span class="line">    computed = iteratee(value);</span><br><span class="line"></span><br><span class="line">   if (type == LAZY_MAP_FLAG) {</span><br><span class="line">    // &#x5982;&#x679C; type &#x662F; map &#x7C7B;&#x578B;&#xFF0C;&#x7ED3;&#x679C; computed &#x8D4B;&#x503C;&#x7ED9;value</span><br><span class="line">    value = computed;</span><br><span class="line">   } else if (!computed) {</span><br><span class="line">    if (type == LAZY_FILTER_FLAG) {</span><br><span class="line">     // &#x9000;&#x51FA;&#x5F53;&#x524D;&#x8FD9;&#x6B21;&#x5FAA;&#x73AF;&#xFF0C;&#x8FDB;&#x884C;&#x4E0B;&#x4E00;&#x6B21;&#x5FAA;&#x73AF;</span><br><span class="line">     continue outer;</span><br><span class="line">    } else {</span><br><span class="line">     // &#x9000;&#x51FA;&#x6574;&#x4E2A;&#x5FAA;&#x73AF;</span><br><span class="line">     break outer;</span><br><span class="line">    }</span><br><span class="line">   }</span><br><span class="line">  }</span><br><span class="line">  // &#x6700;&#x7EC8;&#x6570;&#x7EC4;</span><br><span class="line">  result[resIndex++] = value;</span><br><span class="line"> }</span><br><span class="line"> // &#x8FD4;&#x56DE;&#x6570;&#x7EC4; &#x4F8B;&#x5B50;&#x4E2D;&#x5219;&#x662F; [2, 3, 4]</span><br><span class="line"> return result;</span><br><span class="line">}</span><br><span class="line">// Ensure `LazyWrapper` is an instance of `baseLodash`.</span><br><span class="line">LazyWrapper.prototype = baseCreate(baseLodash.prototype);</span><br><span class="line">LazyWrapper.prototype.constructor = LazyWrapper;</span><br><span class="line"></span><br><span class="line">LazyWrapper.prototype.value = lazyValue;</span><br></pre></td></tr></table></figure>

<p>&#x7B14;&#x8005;&#x753B;&#x4E86;&#x4E00;&#x5F20; <code>lodash</code>&#x548C;<code>LazyWrapper</code>&#x7684;&#x5173;&#x7CFB;&#x56FE;&#x6765;&#x8868;&#x793A;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/1bd6e3f9cf96117f468f606189a6c5597ffbcc25b9c75a1dd71a6a4a585f8f37" alt="&#x548C;&#x7684;&#x5173;&#x7CFB;&#x56FE;"></p>
<p><code>lodash</code>&#x548C;<code>LazyWrapper</code>&#x7684;&#x5173;&#x7CFB;&#x56FE;</p>
<p>&#x5C0F;&#x7ED3;&#xFF1A;<code>lazyValue</code>&#x7B80;&#x5355;&#x8BF4;&#x5B9E;&#x73B0;&#x7684;&#x529F;&#x80FD;&#x5C31;&#x662F;&#x628A;&#x4E4B;&#x524D;&#x8BB0;&#x5F55;&#x7684;&#x9700;&#x8981;&#x6267;&#x884C;&#x51E0;&#x6B21;&#xFF0C;&#x628A;&#x8BB0;&#x5F55;&#x5B58;&#x50A8;&#x7684;&#x51FD;&#x6570;&#x6267;&#x884C;&#x51E0;&#x6B21;&#xFF0C;&#x4E0D;&#x4F1A;&#x6709;&#x591A;&#x5C11;&#x9879;&#x6570;&#x636E;&#x5C31;&#x6267;&#x884C;&#x591A;&#x5C11;&#x6B21;&#xFF0C;&#x800C;&#x662F;&#x6839;&#x636E;&#x9700;&#x8981;&#x51E0;&#x9879;&#xFF0C;&#x6267;&#x884C;&#x51E0;&#x9879;&#x3002;<br>&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x4EE5;&#x4E0B;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;<code>map</code>&#x51FD;&#x6570;&#x53EA;&#x4F1A;&#x6267;&#x884C;<code>3</code>&#x6B21;&#x3002;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x7528;&#x60F0;&#x6027;&#x6C42;&#x503C;&#xFF0C;&#x90A3;&#x4E48;<code>map</code>&#x51FD;&#x6570;&#x4F1A;&#x6267;&#x884C;<code>5</code>&#x6B21;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;var result = _.chain([1, 2, 3, 4, 5])</span><br><span class="line">.map(el =&gt; el + 1)</span><br><span class="line">.take(3)</span><br><span class="line">.value();</span><br></pre></td></tr></table></figure>

<h2 id="&#x603B;&#x7ED3;"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3;</h2><p>&#x884C;&#x6587;&#x81F3;&#x6B64;&#xFF0C;&#x57FA;&#x672C;&#x63A5;&#x8FD1;&#x5C3E;&#x58F0;&#xFF0C;&#x6700;&#x540E;&#x603B;&#x7ED3;&#x4E00;&#x4E0B;&#x3002;</p>
<blockquote>
<p>&#x6587;&#x7AE0;&#x4E3B;&#x8981;&#x5B66;&#x4E60;&#x4E86;<code>runInContext()</code> &#x5BFC;&#x51FA;<code>_</code> <code>lodash</code>&#x51FD;&#x6570;&#x4F7F;&#x7528;<code>baseCreate</code>&#x65B9;&#x6CD5;&#x539F;&#x578B;&#x7EE7;&#x627F;<code>LodashWrapper</code>&#x548C;<code>LazyWrapper</code>&#xFF0C;<code>mixin</code>&#x6302;&#x8F7D;&#x65B9;&#x6CD5;&#x5230;<code>lodash.prototype</code>&#x3001;&#x540E;&#x6587;&#x7528;&#x7ED3;&#x5408;&#x4F8B;&#x5B50;&#x89E3;&#x91CA;<code>lodash.prototype.value(wrapperValue)</code>&#x548C;<code>Lazy.prototype.value(lazyValue)</code>&#x60F0;&#x6027;&#x6C42;&#x503C;&#x7684;&#x6E90;&#x7801;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x3002;</p>
</blockquote>
<p><strong>&#x5206;&#x4EAB;&#x4E00;&#x4E2A;&#x53EA;&#x77E5;&#x9053;&#x51FD;&#x6570;&#x540D;&#x627E;&#x6E90;&#x7801;&#x5B9A;&#x4F4D;&#x51FD;&#x6570;&#x7533;&#x660E;&#x4F4D;&#x7F6E;&#x7684;<code>VSCode</code> &#x6280;&#x5DE7;</strong>&#xFF1A;<code>Ctrl + p</code>&#x3002;&#x8F93;&#x5165; <code>@functionName</code> &#x5B9A;&#x4F4D;&#x51FD;&#x6570;<code>functionName</code>&#x5728;&#x6E90;&#x7801;&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x5177;&#x4F53;&#x4F4D;&#x7F6E;&#x3002;&#x5982;&#x679C;&#x77E5;&#x9053;&#x8C03;&#x7528;&#x4F4D;&#x7F6E;&#xFF0C;&#x90A3;&#x76F4;&#x63A5;&#x6309;<code>alt+&#x9F20;&#x6807;&#x5DE6;&#x952E;</code>&#x5373;&#x53EF;&#x8DF3;&#x8F6C;&#x5230;&#x51FD;&#x6570;&#x7533;&#x660E;&#x7684;&#x4F4D;&#x7F6E;&#x3002;</p>
<p>&#x5982;&#x679C;&#x8BFB;&#x8005;&#x53D1;&#x73B0;&#x6709;&#x4E0D;&#x59A5;&#x6216;&#x53EF;&#x6539;&#x5584;&#x4E4B;&#x5904;&#xFF0C;&#x518D;&#x6216;&#x8005;&#x54EA;&#x91CC;&#x6CA1;&#x5199;&#x660E;&#x767D;&#x7684;&#x5730;&#x65B9;&#xFF0C;&#x6B22;&#x8FCE;&#x8BC4;&#x8BBA;&#x6307;&#x51FA;&#x3002;&#x53E6;&#x5916;&#x89C9;&#x5F97;&#x5199;&#x5F97;&#x4E0D;&#x9519;&#xFF0C;&#x5BF9;&#x60A8;&#x6709;&#x4E9B;&#x8BB8;&#x5E2E;&#x52A9;&#xFF0C;&#x53EF;&#x4EE5;&#x70B9;&#x8D5E;&#x3001;&#x8BC4;&#x8BBA;&#x3001;&#x8F6C;&#x53D1;&#x5206;&#x4EAB;&#xFF0C;&#x4E5F;&#x662F;&#x5BF9;&#x7B14;&#x8005;&#x7684;&#x4E00;&#x79CD;&#x652F;&#x6301;&#x3002;&#x4E07;&#x5206;&#x611F;&#x8C22;&#x3002;</p>
<h2 id="&#x63A8;&#x8350;&#x9605;&#x8BFB;"><a href="#&#x63A8;&#x8350;&#x9605;&#x8BFB;" class="headerlink" title="&#x63A8;&#x8350;&#x9605;&#x8BFB;"></a>&#x63A8;&#x8350;&#x9605;&#x8BFB;</h2><p><a href="/external_links/6b6782b27cb1c8f20bcba48271cea0fc.html" target="blank" rel="noopener">lodash &#x4ED3;&#x5E93;</a> | <a href="/external_links/d1c9f89bcdd86b8b82ca2e2752935957.html" target="blank" rel="noopener">lodash &#x5B98;&#x65B9;&#x6587;&#x6863;</a> | <a href="/external_links/5cfe2cd3ec1e5ba55ca7a299d9dbde6d.html" target="blank" rel="noopener">lodash &#x4E2D;&#x6587;&#x6587;&#x6863;</a>  </p>
<p><a href="/external_links/bb088b63b51e58b6d58703a1115e97b7.html" target="blank" rel="noopener">&#x6253;&#x9020;&#x4E00;&#x4E2A;&#x7C7B;&#x4F3C;&#x4E8E;lodash&#x7684;&#x524D;&#x7AEF;&#x5DE5;&#x5177;&#x5E93;</a>  </p>
<p><a href="https://dev.newban.cn/6844903661450035207">&#x60F0;&#x6027;&#x6C42;&#x503C;&#x2014;&#x2014;lodash&#x6E90;&#x7801;&#x89E3;&#x8BFB;</a>  </p>
<p><a href="/external_links/f1f21c1600ce3a0cd56f88807fb595a6.html" target="blank" rel="noopener">luobo tang&#xFF1A;lazy.js &#x60F0;&#x6027;&#x6C42;&#x503C;&#x5B9E;&#x73B0;&#x5206;&#x6790;</a>  </p>
<p><a href="/external_links/d82d1bf1be41ba30feb3a2630b09aa7b.html" target="blank" rel="noopener">lazy.js github &#x4ED3;&#x5E93;</a>  </p>
<p><a href="/external_links/dc70643c05ab331c5f357e26f0048072.html" target="blank" rel="noopener">&#x672C;&#x6587;&#x7AE0;&#x5B66;&#x4E60;&#x7684;<code>lodash</code>&#x7684;&#x7248;&#x672C;<code>v4.17.15</code> <code>unpkg.com</code>&#x94FE;&#x63A5;</a>  </p>
<h2 id="&#x7B14;&#x8005;&#x5F80;&#x671F;&#x6587;&#x7AE0;"><a href="#&#x7B14;&#x8005;&#x5F80;&#x671F;&#x6587;&#x7AE0;" class="headerlink" title="&#x7B14;&#x8005;&#x5F80;&#x671F;&#x6587;&#x7AE0;"></a>&#x7B14;&#x8005;&#x5F80;&#x671F;&#x6587;&#x7AE0;</h2><p><a href="https://dev.newban.cn/6844903780035592205">&#x9762;&#x8BD5;&#x5B98;&#x95EE;&#xFF1A;JS&#x7684;&#x7EE7;&#x627F;</a>  </p>
<p><a href="https://dev.newban.cn/6844903746984476686">&#x9762;&#x8BD5;&#x5B98;&#x95EE;&#xFF1A;JS&#x7684;this&#x6307;&#x5411;</a>  </p>
<p><a href="https://dev.newban.cn/6844903728147857415">&#x9762;&#x8BD5;&#x5B98;&#x95EE;&#xFF1A;&#x80FD;&#x5426;&#x6A21;&#x62DF;&#x5B9E;&#x73B0;JS&#x7684;call&#x548C;apply&#x65B9;&#x6CD5;</a>  </p>
<p><a href="https://dev.newban.cn/6844903718089916429">&#x9762;&#x8BD5;&#x5B98;&#x95EE;&#xFF1A;&#x80FD;&#x5426;&#x6A21;&#x62DF;&#x5B9E;&#x73B0;JS&#x7684;bind&#x65B9;&#x6CD5;</a>  </p>
<p><a href="https://dev.newban.cn/6844903704663949325">&#x9762;&#x8BD5;&#x5B98;&#x95EE;&#xFF1A;&#x80FD;&#x5426;&#x6A21;&#x62DF;&#x5B9E;&#x73B0;JS&#x7684;new&#x64CD;&#x4F5C;&#x7B26;</a>  </p>
<p><a href="https://dev.newban.cn/6844903666860687373">&#x524D;&#x7AEF;&#x4F7F;&#x7528;puppeteer &#x722C;&#x866B;&#x751F;&#x6210;&#x300A;React.js &#x5C0F;&#x4E66;&#x300B;PDF&#x5E76;&#x5408;&#x5E76;</a></p>
<h2 id="&#x5173;&#x4E8E;"><a href="#&#x5173;&#x4E8E;" class="headerlink" title="&#x5173;&#x4E8E;"></a>&#x5173;&#x4E8E;</h2><p>&#x4F5C;&#x8005;&#xFF1A;&#x5E38;&#x4EE5;<strong>&#x82E5;&#x5DDD;</strong>&#x4E3A;&#x540D;&#x6DF7;&#x8FF9;&#x4E8E;&#x6C5F;&#x6E56;&#x3002;&#x524D;&#x7AEF;&#x8DEF;&#x4E0A; | PPT&#x7231;&#x597D;&#x8005; | &#x6240;&#x77E5;&#x751A;&#x5C11;&#xFF0C;&#x552F;&#x5584;&#x5B66;&#x3002;  </p>
<p><a href="/external_links/4986b16d5e3b10c7eb3e098161b1cb6c.html" target="blank" rel="noopener">&#x4E2A;&#x4EBA;&#x535A;&#x5BA2;-&#x82E5;&#x5DDD;</a>&#xFF0C;&#x4F7F;&#x7528;<code>vuepress</code>&#x91CD;&#x6784;&#x4E86;&#xFF0C;&#x9605;&#x8BFB;&#x4F53;&#x9A8C;&#x53EF;&#x80FD;&#x66F4;&#x597D;&#x4E9B;  </p>
<p><a href="/external_links/0eaae9aee67b3837a4608f6f57e3fe73.html" target="blank" rel="noopener">&#x6398;&#x91D1;&#x4E13;&#x680F;</a>&#xFF0C;&#x6B22;&#x8FCE;&#x5173;&#x6CE8;~  </p>
<p><a href="/external_links/aa57b6e4783432f5eb4cb3122c7c281d.html" target="blank" rel="noopener"><code>segmentfault</code>&#x524D;&#x7AEF;&#x89C6;&#x91CE;&#x4E13;&#x680F;</a>&#xFF0C;&#x6B22;&#x8FCE;&#x5173;&#x6CE8;~  </p>
<p><a href="/external_links/9d49889ba530cc743d4bc05726fd318e.html" target="blank" rel="noopener">&#x77E5;&#x4E4E;&#x524D;&#x7AEF;&#x89C6;&#x91CE;&#x4E13;&#x680F;</a>&#xFF0C;&#x6B22;&#x8FCE;&#x5173;&#x6CE8;~  </p>
<p><a href="/external_links/7a72f7afa742d06ac5ceb82d817c1bed.html" target="blank" rel="noopener">github blog</a>&#xFF0C;&#x76F8;&#x5173;&#x6E90;&#x7801;&#x548C;&#x8D44;&#x6E90;&#x90FD;&#x653E;&#x5728;&#x8FD9;&#x91CC;&#xFF0C;&#x6C42;&#x4E2A;<code>star</code>^_^~</p>
<h2 id="&#x6B22;&#x8FCE;&#x52A0;&#x5FAE;&#x4FE1;&#x4EA4;&#x6D41;-&#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x53F7;"><a href="#&#x6B22;&#x8FCE;&#x52A0;&#x5FAE;&#x4FE1;&#x4EA4;&#x6D41;-&#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x53F7;" class="headerlink" title="&#x6B22;&#x8FCE;&#x52A0;&#x5FAE;&#x4FE1;&#x4EA4;&#x6D41; &#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x53F7;"></a>&#x6B22;&#x8FCE;&#x52A0;&#x5FAE;&#x4FE1;&#x4EA4;&#x6D41; &#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x53F7;</h2><p>&#x53EF;&#x80FD;&#x6BD4;&#x8F83;&#x6709;&#x8DA3;&#x7684;&#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x53F7;&#xFF0C;&#x957F;&#x6309;&#x626B;&#x7801;&#x5173;&#x6CE8;&#x3002;&#x6B22;&#x8FCE;&#x52A0;&#x7B14;&#x8005;&#x5FAE;&#x4FE1;<code>ruochuan12</code>&#xFF08;&#x6CE8;&#x660E;&#x6765;&#x6E90;&#xFF0C;&#x57FA;&#x672C;&#x6765;&#x8005;&#x4E0D;&#x62D2;&#xFF09;&#xFF0C;&#x62C9;&#x60A8;&#x8FDB;&#x3010;&#x524D;&#x7AEF;&#x89C6;&#x91CE;&#x4EA4;&#x6D41;&#x7FA4;&#x3011;&#xFF0C;&#x957F;&#x671F;&#x4EA4;&#x6D41;&#x5B66;&#x4E60;~</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/aadeca165d32560f0a5f1eb50f8961e40e01bf2c41721a1f3af6e8acf87d67e9" alt="&#x82E5;&#x5DDD;&#x89C6;&#x91CE;"></p>
<p>&#x82E5;&#x5DDD;&#x89C6;&#x91CE;</p>
<p>&#x672C;&#x6587;&#x4F7F;&#x7528; <a href="/external_links/f4f051239b400ed0d04b60fef623174b.html" target="blank" rel="noopener">mdnice</a> &#x6392;&#x7248;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/60100d13f48a5de6463decad99fbc81f.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903930183286791.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903930183286791.html" itemprop="url">Flutter完整开发实战详解(十七、 实用技巧与填坑二)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-02T14:54:00+08:00">
                2019-09-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&#x4F5C;&#x4E3A;&#x7CFB;&#x5217;&#x6587;&#x7AE0;&#x7684;&#x7B2C;&#x5341;&#x4E03;&#x7BC7;&#xFF0C;&#x672C;&#x7BC7;&#x518D;&#x4E00;&#x6B21;&#x5E26;&#x6765; Flutter &#x5F00;&#x53D1;&#x8FC7;&#x7A0B;&#x4E2D;&#x7684;&#x5B9E;&#x7528;&#x6280;&#x5DE7;&#xFF0C;&#x8BA9;&#x4F60;&#x7EE7;&#x7EED;&#x5F2F;&#x9053;&#x8D85;&#x8F66;&#xFF0C;&#x5168;&#x7BC7;&#x5747;&#x4E3A;&#x4E2A;&#x4EBA;&#x7684;&#x65E5;&#x5E38;&#x5E72;&#x8D27;&#x603B;&#x7ED3;&#xFF0C;&#x4EE5;&#x5B9E;&#x7528;&#x586B;&#x5751;&#x4E3A;&#x4E3B;&#xFF0C;&#x8BA9;&#x4F60;&#x5C11;&#x8D70;&#x5F2F;&#x8DEF;&#x72C2;&#x98D9;&#x8F66;&#x3002;</p>
<h2 id="&#x6587;&#x7AE0;&#x6C47;&#x603B;&#x5730;&#x5740;&#xFF1A;"><a href="#&#x6587;&#x7AE0;&#x6C47;&#x603B;&#x5730;&#x5740;&#xFF1A;" class="headerlink" title="&#x6587;&#x7AE0;&#x6C47;&#x603B;&#x5730;&#x5740;&#xFF1A;"></a>&#x6587;&#x7AE0;&#x6C47;&#x603B;&#x5730;&#x5740;&#xFF1A;</h2><blockquote>
<p><a href="/external_links/0587d739d614eebe25e21ff5c954b7fa.html" target="blank" rel="noopener">Flutter &#x5B8C;&#x6574;&#x5B9E;&#x6218;&#x5B9E;&#x6218;&#x7CFB;&#x5217;&#x6587;&#x7AE0;&#x4E13;&#x680F;</a></p>
<p><a href="/external_links/1ba09be5bbc4739a8d663c9da52c73a9.html" target="blank" rel="noopener">Flutter &#x756A;&#x5916;&#x7684;&#x4E16;&#x754C;&#x7CFB;&#x5217;&#x6587;&#x7AE0;&#x4E13;&#x680F;</a></p>
</blockquote>
<p><a href="/external_links/c3658c5a7c3fd9ce8fbce9c1e57641fb.html" target="blank" rel="noopener"><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/c168636279ed753f4668a29fc023f2711d12456bd9556b7fe02c15a0870507c0" alt></a><br>1&#x3001;Package get git &#x5931;&#x8D25;</p>
<hr>
<p>Flutter &#x9879;&#x76EE;&#x5728;&#x5F15;&#x7528;&#x7B2C;&#x4E09;&#x5E93;&#x65F6;&#xFF0C;&#x4E00;&#x822C;&#x90FD;&#x662F;&#x76F4;&#x63A5;&#x5F15;&#x7528; <code>pub</code> &#x4E0A;&#x7684;&#x7B2C;&#x4E09;&#x65B9;&#x63D2;&#x4EF6;&#xFF0C;&#x4F46;&#x662F;&#x6709;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x4E3A;&#x4E86;&#x5B89;&#x5168;&#x548C;&#x79C1;&#x5BC6;&#xFF0C;&#x4F1A;&#x9009;&#x62E9;&#x4F7F;&#x7528; git &#x5F15;&#x7528;&#xFF0C;&#x5982;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;  photo_view:</span><br><span class="line">    git:</span><br><span class="line">      url: https://github.com/CarSmallGuo/photo_view.git</span><br><span class="line">      ref: master</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x65F6;&#x5019;&#x5728;&#x6267;&#x884C; <code>flutter packages get</code> &#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x51FA;&#x73B0;&#x5931;&#x8D25;&#x540E;&#xFF0C;&#x518D;&#x6B21;&#x6267;&#x884C; <code>flutter packages get</code> &#x53EF;&#x80FD;&#x4F1A;&#x9047;&#x5230;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#x7684;&#x95EE;&#x9898;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/ea2a0336d04990b45733fcb333dc10d2b7893832b300d8acb3eb4dfa7f92dfcd" alt></p>
<p>)<br>&#x800C; <code>flutter packages get</code> &#x63D0;&#x793A; <code>git</code> &#x5931;&#x8D25;&#x7684;&#x539F;&#x56E0;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#xFF1A;</p>
<p>&#x5728;&#x4E0B;&#x8F7D;&#x5305;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x51FA;&#x73B0;&#x95EE;&#x9898;&#xFF0C;&#x4E0B;&#x6B21;&#x518D;&#x62C9;&#x5305;&#x7684;&#x65F6;&#x5019;&#xFF0C;<strong>&#x5728; <code>.pub_cache</code> &#x5185;&#x7684; <code>git</code> &#x76EE;&#x5F55;&#x4E0B;&#x4F1A;&#x68C0;&#x6D4B;&#x5230;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x76EE;&#x5F55;&#xFF0C;&#x4F46;&#x662F;&#x53EF;&#x80FD;&#x662F;&#x7A7A;&#x76EE;&#x5F55;&#x7B49;&#x7B49;&#xFF0C;&#x5BFC;&#x81F4; <code>flutter packages get</code> &#x7684;&#x65F6;&#x5019;&#x5F02;&#x5E38;&#x3002;</strong></p>
<p><strong>&#x6240;&#x4EE5;&#x4F60;&#x9700;&#x8981;&#x6E05;&#x9664;&#x6389; <code>.pub_cache</code> &#x5185;&#x7684; <code>git</code> &#x7684;&#x5F02;&#x5E38;&#x76EE;&#x5F55;&#xFF0C;&#x7136;&#x540E;&#x6700;&#x597D;&#x6E05;&#x9664;&#x6389;&#x9879;&#x76EE;&#x4E0B;&#x7684; <code>pubspec.lock</code> &#xFF0C;&#x4E4B;&#x540E;&#x91CD;&#x65B0;&#x6267;&#x884C; <code>flutter packages get</code> &#x3002;</strong></p>
<blockquote>
<p><code>win</code> &#x4E00;&#x822C;&#x662F;&#x5728; <code>C:\Users\xxxxx\AppData\Roaming\Pub\Cache</code> &#x8DEF;&#x5F84;&#x4E0B;&#x6709; <code>git</code> &#x76EE;&#x5F55;&#x3002;</p>
<p><code>mac</code> &#x76EE;&#x5F55;&#x5728; <code>~/.pub-cache</code> &#x3002;</p>
</blockquote>
<h2 id="2&#x3001;TextEditingController"><a href="#2&#x3001;TextEditingController" class="headerlink" title="2&#x3001;TextEditingController"></a>2&#x3001;TextEditingController</h2><p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/ff261831328942f22a21841cb9af7da917ebccec0db39a6b1bef6687c6aa7b73" alt="image.png"></p>
<p>&#x5982;&#x4E0A;&#x4EE3;&#x7801;&#x6240;&#x793A;&#xFF0C;&#x7EA2;&#x7EBF;&#x90E8;&#x5206;&#x8868;&#x793A;&#xFF0C;&#x5982;&#x679C; <code>controller</code> &#x4E3A;&#x7A7A;&#xFF0C;&#x5C31;&#x8D4B;&#x503C;&#x4E00;&#x4E2A; <code>TextEditingController</code> &#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x5199;&#x6CD5;&#x4F1A;&#x5BFC;&#x81F4;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#x95EE;&#x9898;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/077d434327e1fcf5b8cde47a7ab0280fccaddd8ed718800059d086503cef3e01" alt></p>
<p><strong>&#x5F39;&#x51FA;&#x952E;&#x76D8;&#x65F6;&#x8F93;&#x5165;&#x6210;&#x529F;&#x540E;&#xFF0C;&#x6536;&#x8D77;&#x952E;&#x76D8;&#x65F6;&#x8F93;&#x5165;&#x7684;&#x5185;&#x5BB9;&#x6D88;&#x5931;&#x4E86;&#xFF01;</strong> &#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#x952E;&#x76D8;&#x7684;&#x5F39;&#x51FA;&#x548C;&#x6536;&#x8D77;&#x90FD;&#x4F1A;&#x89E6;&#x53D1;&#x9875;&#x9762; <code>build</code> &#xFF0C;&#x800C;&#x5728; <code>controller</code> &#x4E3A; <code>null</code> &#x65F6;&#xFF0C;&#x6BCF;&#x6B21;&#x8D4B;&#x503C;&#x7684; <code>TextEditingController</code> &#x4F1A;&#x5BFC;&#x81F4; <code>TextField</code> &#x7684; <code>TextEditingValue</code> &#x91CD;&#x7F6E;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/469a5a638a05f9438d60ee1d32644730f046bb489995cc15babb99c39e8aa32b" alt="image.png"></p>
<p>&#x5982;&#x4E0A;&#x56FE;&#x6240;&#x793A;&#xFF0C;&#x56E0;&#x4E3A;&#x5F53; <code>TextField</code> &#x7684; <code>controller</code> &#x4E0D;&#x4E3A;&#x7A7A;&#x65F6;&#xFF0C;update &#x65F6;&#x662F;&#x4E0D;&#x4F1A;&#x6267;&#x884C; <code>value</code> &#x7684;&#x62F7;&#x8D1D;&#xFF0C;&#x6240;&#x4EE5;&#x4E3A;&#x4E86;&#x907F;&#x514D;&#x8FD9;&#x7C7B;&#x95EE;&#x9898;&#xFF0C;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#xFF0C; <strong>&#x9700;&#x8981;&#x5148;&#x5728;&#x5168;&#x5C40;&#x6784;&#x5EFA; <code>TextEditingController</code> &#x518D;&#x8D4B;&#x503C;&#xFF0C;&#x5982;&#x679C; <code>controller</code> &#x4E3A;&#x7A7A;&#x76F4;&#x63A5;&#x7ED9; null &#x5373;&#x53EF;&#xFF0C;&#x907F;&#x514D; <code>build</code> &#x65F6;&#x6BCF;&#x6B21;&#x91CD;&#x6784; <code>TextEditingController</code> &#x3002;</strong></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/84c874c532e90e7127c41acc2bf9124e7e7814a73376271d18a025c0509ee166" alt></p>
<h2 id="3&#x3001;Scrollable"><a href="#3&#x3001;Scrollable" class="headerlink" title="3&#x3001;Scrollable"></a>3&#x3001;Scrollable</h2><p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/651a1457db98424b4a65ecaa9c33494486ccdbdeac3440232c4e68993827c87c" alt></p>
<p>&#x5982;&#x4E0A;&#x56FE;&#x6240;&#x793A;&#xFF0C;&#x5728;&#x4E4B;&#x524D;&#x7B2C;&#x4E03;&#x7BC7;&#x7684;&#x65F6;&#x5019;&#x5206;&#x6790;&#x8FC7;&#xFF0C;<strong>&#x6ED1;&#x52A8;&#x5217;&#x8868;&#x5185;&#x4E00;&#x822C;&#x90FD;&#x4F1A;&#x6709; <code>Scrollable</code> &#x7684;&#x5B58;&#x5728;&#xFF0C;&#x800C; <code>Scrollable</code> &#x6070;&#x597D;&#x662F;&#x4E00;&#x4E2A; <code>InheritedWidget</code></strong> &#xFF0C;&#x8FD9;&#x5C31;&#x7ED9;&#x6211;&#x4EEC;&#x5728; <code>children</code> &#x4E2D;&#x8C03;&#x7528; <code>Scrollable</code> &#x76F8;&#x5173;&#x65B9;&#x6CD5;&#x63D0;&#x4F9B;&#x4E86;&#x4FBF;&#x5229;&#x3002;</p>
<p>&#x5982;&#x4E0B;&#x4EE3;&#x7801;&#x6240;&#x4F9D;&#xFF0C;&#x901A;&#x8FC7; <code>Scrollable.of(context)</code> &#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x66F4;&#x89E3;&#x8026;&#x7684;&#x5728; <code>ListView/GridView</code> &#x7684; <code>children</code> &#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x63A7;&#x5236;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;ScrollableState state = Scrollable.of(context)</span><br><span class="line"></span><br><span class="line">///&#x83B7;&#x53D6; _scrollable &#x5185; viewport &#x7684; renderObject</span><br><span class="line">RenderObject renderObject = state.context.findRenderObject();</span><br><span class="line">///&#x76D1;&#x542C;&#x4F4D;&#x7F6E;&#x66F4;&#x65B0;</span><br><span class="line">state.position.addListener((){});</span><br><span class="line">///&#x901A;&#x77E5;&#x4F4D;&#x7F6E;&#x66F4;&#x65B0;</span><br><span class="line">state.position.notifyListeners();</span><br><span class="line">///&#x6EDA;&#x52A8;&#x5230;&#x6307;&#x5B9A;&#x4F4D;&#x7F6E;</span><br><span class="line">state.position.jumpTo(1000);</span><br><span class="line">&#xB7;&#xB7;&#xB7;&#xB7;</span><br></pre></td></tr></table></figure>

<h2 id="4&#x3001;&#x56FE;&#x7247;&#x9AD8;&#x65AF;&#x6A21;&#x7CCA;"><a href="#4&#x3001;&#x56FE;&#x7247;&#x9AD8;&#x65AF;&#x6A21;&#x7CCA;" class="headerlink" title="4&#x3001;&#x56FE;&#x7247;&#x9AD8;&#x65AF;&#x6A21;&#x7CCA;"></a>4&#x3001;&#x56FE;&#x7247;&#x9AD8;&#x65AF;&#x6A21;&#x7CCA;</h2><p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/656db3b7319f8cbfe6ec2290cd37b390bc0fa616f301e0164592ef99458bb59c" alt></p>
<p>&#x5728; Flutter &#x4E2D;&#xFF0C;&#x63D0;&#x4F9B;&#x4E86; <code>BackdropFilter</code> &#x548C; <code>ImageFilter</code> &#x5B9E;&#x73B0;&#x4E86;&#x9AD8;&#x65AF;&#x6A21;&#x7CCA;&#x7684;&#x652F;&#x6301;&#xFF0C;&#x5982;&#x4E0B;&#x4EE3;&#x7801;&#x6240;&#x793A;&#xFF0C;&#x53EF;&#x4EE5;&#x5FEB;&#x901F;&#x5B9E;&#x73B0;&#x4E0A;&#x56FE;&#x7684;&#x9AD8;&#x65AF;&#x6A21;&#x7CCA;&#x6548;&#x679C;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;class BlurDemoPage extends StatelessWidget {</span><br><span class="line">  @override</span><br><span class="line">  Widget build(BuildContext context) {</span><br><span class="line">    return Scaffold(</span><br><span class="line">      body: new Container(</span><br><span class="line">        child: Stack(</span><br><span class="line">          children: &lt;Widget&gt;[</span><br><span class="line">            Positioned(</span><br><span class="line">              top: 0,</span><br><span class="line">              bottom: 0,</span><br><span class="line">              left: 0,</span><br><span class="line">              right: 0,</span><br><span class="line">              child: new Image.asset(</span><br><span class="line">                &quot;static/gsy_cat.png&quot;,</span><br><span class="line">                fit: BoxFit.cover,</span><br><span class="line">                width: MediaQuery.of(context).size.width,</span><br><span class="line">                height: MediaQuery.of(context).size.height,</span><br><span class="line">              )),</span><br><span class="line">            new Center(</span><br><span class="line">              child: new Container(</span><br><span class="line">                width: 200,</span><br><span class="line">                height: 200,</span><br><span class="line">                child: ClipRRect(</span><br><span class="line">                  borderRadius: BorderRadius.circular(15.0),</span><br><span class="line">                  child: BackdropFilter(</span><br><span class="line">                    filter: ImageFilter.blur(sigmaX: 8.0, sigmaY: 8.0),</span><br><span class="line">                    child: new Row(</span><br><span class="line">                      mainAxisSize: MainAxisSize.max,</span><br><span class="line">                      crossAxisAlignment: CrossAxisAlignment.center,</span><br><span class="line">                      mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">                      children: &lt;Widget&gt;[</span><br><span class="line">                        new Icon(Icons.ac_unit),</span><br><span class="line">                        new Text(&quot;&#x54C7;&#xFF01;&#xFF01;&quot;)</span><br><span class="line">                      ],</span><br><span class="line">                    )))))</span><br><span class="line">          ],</span><br><span class="line">        )));</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h2 id="5&#x3001;&#x6EDA;&#x52A8;&#x5230;&#x6307;&#x5B9A;&#x4F4D;&#x7F6E;"><a href="#5&#x3001;&#x6EDA;&#x52A8;&#x5230;&#x6307;&#x5B9A;&#x4F4D;&#x7F6E;" class="headerlink" title="5&#x3001;&#x6EDA;&#x52A8;&#x5230;&#x6307;&#x5B9A;&#x4F4D;&#x7F6E;"></a>5&#x3001;&#x6EDA;&#x52A8;&#x5230;&#x6307;&#x5B9A;&#x4F4D;&#x7F6E;</h2><p>&#x56E0;&#x4E3A;&#x76EE;&#x524D; Flutter &#x5E76;&#x6CA1;&#x6709;&#x76F4;&#x63A5;&#x63D0;&#x4F9B;&#x6EDA;&#x52A8;&#x5230;&#x6307;&#x5B9A; <code>Item</code> &#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5728;&#x6BCF;&#x4E2A; <code>Item</code> &#x5927;&#x5C0F;&#x4E0D;&#x4E00;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x6298;&#x4E2D;&#x5229;&#x7528;&#x5982;&#x56FE;&#x4E0B;&#x6240;&#x793A;&#x4EE3;&#x7801;&#xFF0C;&#x53EF;&#x4EE5;&#x5FEB;&#x901F;&#x5B9E;&#x73B0;&#x6EDA;&#x52A8;&#x5230;&#x6307;&#x5B9A; <code>Item</code> &#x7684;&#x6548;&#x679C;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/bc7e7634b7f07a90856e4bae5e577b322b91c8edd29e232a31b61e0f7da36216" alt></p>
<p>&#x4E0A;&#x56FE;&#x4E3A;&#x90E8;&#x5206;&#x4EE3;&#x7801;&#xFF0C;&#x5B8C;&#x6574;&#x4EE3;&#x7801;&#x53EF;&#x89C1; <a href="/external_links/c6a35fa6fdaee581225b990af9895563.html" target="blank" rel="noopener">scroll_to_index_demo_page2.dart</a> &#xFF0C;&#x8FD9;&#x91CC;&#x4E3B;&#x8981;&#x662F;&#x7ED9;&#x6BCF;&#x4E2A; <code>item</code> &#x90FD;&#x8D4B;&#x4E88;&#x4E86;&#x4E00;&#x4E2A; <code>GlobalKey</code> , &#x5229;&#x7528; <code>findRenderObject</code> &#x627E;&#x5230;&#x6240;&#x9700; <code>item</code> &#x7684; <code>RenderBox</code> &#xFF0C;&#x7136;&#x540E;&#x4F7F;&#x7528; <code>localToGlobal</code> &#x83B7;&#x53D6; <code>item</code> &#x5728; <code>ViewPort</code> &#x8FD9;&#x4E2A; <code>ancestor</code> &#x4E2D;&#x7684;&#x504F;&#x79FB;&#x91CF;&#x8FDB;&#x884C;&#x6EDA;&#x52A8;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/b08261d757d0da511af4bb4441574a5bddbcd7577cfb9f4da1419988749677fb" alt></p>
<p>&#x5F53;&#x7136;&#x8FD8;&#x6709;&#x53E6;&#x5916;&#x4E00;&#x79CD;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#xFF0C;&#x5177;&#x4F53;&#x53EF;&#x89C1; <a href="/external_links/d965599c790539e88ce936ba561e0f8a.html" target="blank" rel="noopener">scroll_to_index_demo_page.dart</a></p>
<h2 id="6&#x3001;findRenderObject"><a href="#6&#x3001;findRenderObject" class="headerlink" title="6&#x3001;findRenderObject"></a>6&#x3001;findRenderObject</h2><p>&#x5728; Flutter &#x4E2D;&#x662F;&#x5B58;&#x5728; <strong>&#x5BB9;&#x5668; Widget</strong> &#x548C; <strong>&#x6E32;&#x67D3;Widget</strong> &#x7684;&#x533A;&#x522B;&#x7684;&#xFF0C;&#x4E00;&#x822C;&#x60C5;&#x51B5;&#x4E0B;:</p>
<ul>
<li><code>Text</code>&#x3001;<code>Sliver</code> &#x3001;<code>ListTile</code> &#x7B49;&#x90FD;&#x662F;&#x5C5E;&#x4E8E;&#x6E32;&#x67D3; Widget &#xFF0C;&#x5176;&#x5185;&#x90E8;&#x4E3B;&#x8981;&#x662F; <code>RenderObjectElement</code> &#x3002;</li>
<li><code>StatelessWidget</code> / <code>StatefulWidget</code> &#x7B49;&#x5C5E;&#x4E8E;&#x5BB9;&#x5668; Widget &#xFF0C;&#x5176;&#x5185;&#x90E8;&#x4F7F;&#x7528;&#x7684;&#x662F; <code>ComponentElement</code> &#xFF0C; <strong><code>ComponentElement</code> &#x672C;&#x8EAB;&#x662F;&#x4E0D;&#x5B58;&#x5728; <code>RenderObject</code> &#x7684;&#x3002;</strong></li>
</ul>
<p>&#x7ED3;&#x5408;&#x524D;&#x9762;&#x7BC7;&#x7AE0;&#x6211;&#x4EEC;&#x8BF4;&#x8FC7; <code>BuildContext</code> &#x7684;&#x5B9E;&#x73B0;&#x5C31;&#x662F; <code>Element</code>&#xFF0C;&#x6240;&#x4EE5; <code>context.findRenderObject()</code> &#x8FD9;&#x4E2A;&#x64CD;&#x4F5C;&#x5176;&#x5B9E;&#x5C31;&#x662F; <code>Element</code> &#x7684; <code>findRenderObject()</code> &#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/890ced29fbf33c625c0e315404d585e374a94e03d8536ff0fa7370bea67e3959" alt></p>
<p>&#x90A3;&#x4E48;&#x5982;&#x4E0A;&#x56FE;&#x6240;&#x793A;&#xFF0C;<code>findRenderObject</code> &#x7684;&#x5B9E;&#x73B0;&#x6700;&#x7EC8;&#x5C31;&#x662F;&#x83B7;&#x53D6; <code>renderObject</code>&#xFF0C;&#x5728; <code>Element</code> &#x4E2D; <code>renderObject</code> &#x7684;&#x83B7;&#x53D6;&#x903B;&#x8F91;&#x5C31;&#x5F88;&#x6E05;&#x6670;&#x4E86;&#xFF0C;<strong>&#x5728;&#x9047;&#x5230; <code>ComponentElement</code> &#x65F6;&#xFF0C;&#x6267;&#x884C;&#x7684;&#x662F; <code>element.visitChildren(visit);</code></strong> , &#x9012;&#x5F52;&#x76F4;&#x5230;&#x627E;&#x5230; <code>RenderObjectElement</code> &#x3002;</p>
<p>&#x6240;&#x4EE5;&#x5982;&#x4E0B;&#x4EE3;&#x7801;&#x6240;&#x793A;&#xFF0C;<code>print(&quot;${globalKey.currentContext.findRenderObject()}&quot;);</code> &#x6700;&#x7EC8;&#x8F93;&#x51FA;&#x4E86; <code>SizedBox</code> &#x7684; <code>RenderObject</code> &#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/ffbc61d90a13d4746f9096d60fbe11211ef9c6b474f5b6095878c7a7fa95bec1" alt></p>
<h2 id="7&#x3001;&#x884C;&#x95F4;&#x8DDD;"><a href="#7&#x3001;&#x884C;&#x95F4;&#x8DDD;" class="headerlink" title="7&#x3001;&#x884C;&#x95F4;&#x8DDD;"></a>7&#x3001;&#x884C;&#x95F4;&#x8DDD;</h2><p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/ddc2622caea24b00ad3583c23e80048783ab5ff1bb1bd2d4a7f67affea4c644e" alt></p>
<p>&#x5728; Flutter &#x4E2D;&#xFF0C;&#x662F;&#x6CA1;&#x6709;&#x76F4;&#x63A5;&#x8BBE;&#x7F6E; <code>Text</code> &#x884C;&#x95F4;&#x8DDD;&#x7684;&#x65B9;&#x6CD5;&#x7684;&#xFF0C; <code>Text</code> &#x663E;&#x793A;&#x7684;&#x6548;&#x679C;&#x662F;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#x7684;&#x903B;&#x8F91;&#x7EC4;&#x6210;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/b781a2fd041920de6f7cdb8092a2da4b9d89a2d029d4e84ba7f59acb0660306e" alt></p>
<p>&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x5E94;&#x8BE5;&#x5982;&#x4F55;&#x5904;&#x7406;&#x884C;&#x95F4;&#x8DDD;&#x5462;&#xFF1F;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#xFF0C;<strong>&#x901A;&#x8FC7;&#x8BBE;&#x7F6E; <code>StrutStyle</code> &#x7684; <code>leading</code> , &#x7136;&#x540E;&#x5229;&#x7528; <code>Transform</code> &#x505A;&#x8BA1;&#x7B97;&#x7FFB;&#x65B9;&#x5411;&#x4F4D;&#x7F6E;&#x504F;&#x79FB;&#xFF0C;&#x56E0;&#x4E3A; <code>leading</code> &#x662F;&#x4E0A;&#x4E0B;&#x5747;&#x8861;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x8BA1;&#x7B97;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x6211;&#x4EEC;&#x6240;&#x9700;&#x8981;&#x7684;&#x884C;&#x95F4;&#x8DDD;&#x5927;&#x5C0F;&#x3002;</strong> (&#x867D;&#x7136;&#x65E0;&#x6CD5;&#x4FDD;&#x8BC1;&#x4E00;&#x5B9A; 100%&#x50CF;&#x7D20;&#x51C6;&#x786E;&#xFF0C;&#x4F60;&#x662F;&#x5426;&#x8FD8;&#x77E5;&#x9053;&#x5176;&#x4ED6;&#x65B9;&#x6CD5;&#xFF1F;)</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/704e4bdc52585f4cfc608a61b6d2b908189a70620dc70aa599bd737f694b8ce1" alt></p>
<blockquote>
<p><strong>&#x8FD9;&#x91CC;&#x989D;&#x5916;&#x63D0;&#x4E00;&#x70B9;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x7236;&#x8282;&#x70B9;&#x4F7F;&#x7528; <code>DefaultTextStyle</code> &#x6765;&#x5B9E;&#x73B0;&#x5C40;&#x90E8;&#x6837;&#x5F0F;&#x7684;&#x5171;&#x4EAB;&#x54E6;&#x3002;</strong></p>
</blockquote>
<h2 id="8&#x3001;Builder"><a href="#8&#x3001;Builder" class="headerlink" title="8&#x3001;Builder"></a>8&#x3001;Builder</h2><p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/19c66df42c2a89883bcb6ebd2907323ed8bd666fdc4553da2ae9f5ab00a4f1b6" alt></p>
<p>&#x5728; Flutter &#x4E2D;&#x5B58;&#x5728; <code>Builder</code> &#x8FD9;&#x6837;&#x4E00;&#x4E2A; Widget&#xFF0C;&#x770B;&#x6E90;&#x7801;&#x53D1;&#x73B0;&#x5B83;&#x5176;&#x5B9E;&#x5C31;&#x662F; <code>StatelessWidget</code> &#x7684;&#x7B80;&#x5355;&#x5C01;&#x88C5;&#xFF0C;&#x90A3;&#x4E3A;&#x4EC0;&#x4E48;&#x8FD8;&#x9700;&#x8981;&#x5B83;&#x7684;&#x5B58;&#x5728;&#x5462;&#xFF1F;</p>
<p>&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#xFF0C;&#x76F8;&#x4FE1;&#x4E00;&#x4E9B; Flutter &#x5F00;&#x53D1;&#x8005;&#x5728;&#x4F7F;&#x7528; <code>Scaffold.of(context).showSnackBar(snackbar)</code> &#x65F6;&#xFF0C;&#x53EF;&#x80FD; &#x9047;&#x5230;&#x8FC7;&#x5982;&#x4E0B;&#x9519;&#x8BEF;&#xFF0C;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#x4F20;&#x5165;&#x7684; <code>context</code> &#x5C5E;&#x4E8E;&#x9519;&#x8BEF;&#x8282;&#x70B9;&#x5BFC;&#x81F4;&#x7684;&#xFF0C;<strong>&#x56E0;&#x4E3A;&#x6B64;&#x5904;&#x4F20;&#x5165;&#x7684; <code>context</code> &#x5E76;&#x4E0D;&#x80FD;&#x627E;&#x5230;&#x9875;&#x9762;&#x6240;&#x5728;&#x7684; <code>Scaffold</code> &#x8282;&#x70B9;&#x3002;</strong></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/c2015022675beaa9b36a09830173ef9f35a1fe45bdd821d5b8d865a16fcb3211" alt></p>
<p>&#x6240;&#x4EE5;&#x8FD9;&#x65F6;&#x5019; <code>Builder</code> &#x7684;&#x4F5C;&#x7528;&#x5C31;&#x4F53;&#x73B0;&#x4E86;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF0C;&#x901A;&#x8FC7; <code>builder</code> &#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x8D4B;&#x4E88;&#x7684; <code>context</code> &#xFF0C;&#x5728;&#x5411;&#x4E0A;&#x67E5;&#x627E; <code>Scaffold</code> &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x987A;&#x5229;&#x627E;&#x5230;&#x7236;&#x8282;&#x70B9;&#x7684; <code>Scaffold</code> &#x4E86;&#xFF0C;&#x8FD9;&#x4E5F;&#x4E00;&#x5B9A;&#x7A0B;&#x5EA6;&#x4E0A;&#x4F53;&#x73B0;&#x4E86; <code>ComponentElement</code> &#x7684;&#x4F5C;&#x7528;&#x4E4B;&#x4E00;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/738076095d06fb5f3c771289e542554009709a2c7573cd37fc41179d561254c5" alt></p>
<h2 id="9&#x3001;&#x5FEB;&#x901F;&#x5B9E;&#x73B0;&#x52A8;&#x753B;&#x5207;&#x6362;&#x6548;&#x679C;"><a href="#9&#x3001;&#x5FEB;&#x901F;&#x5B9E;&#x73B0;&#x52A8;&#x753B;&#x5207;&#x6362;&#x6548;&#x679C;" class="headerlink" title="9&#x3001;&#x5FEB;&#x901F;&#x5B9E;&#x73B0;&#x52A8;&#x753B;&#x5207;&#x6362;&#x6548;&#x679C;"></a>9&#x3001;&#x5FEB;&#x901F;&#x5B9E;&#x73B0;&#x52A8;&#x753B;&#x5207;&#x6362;&#x6548;&#x679C;</h2><p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/6c47341908aed205df0f556b8d75d56e54f4689e8c2a97bdcc841583b41e970c" alt></p>
<p>&#x8981;&#x5B9E;&#x73B0;&#x5982;&#x4E0A;&#x56FE;&#x6240;&#x793A;&#x52A8;&#x753B;&#x6548;&#x679C;&#xFF0C;&#x5728; Flutter &#x4E2D;&#x63D0;&#x4F9B;&#x4E86; <code>AnimatedSwitcher</code> &#x5C01;&#x88C5;&#x7B80;&#x6613;&#x5B9E;&#x73B0;&#x3002;</p>
<p>&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#xFF0C;<strong>&#x901A;&#x8FC7;&#x5D4C;&#x5957; <code>AnimatedSwitcher</code> &#xFF0C;&#x6307;&#x5B9A; <code>transitionBuilder</code> &#x52A8;&#x753B;&#x6548;&#x679C;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x6570;&#x636E;&#x6539;&#x53D8;&#x65F6;&#xFF0C;&#x540C;&#x65F6;&#x6539;&#x53D8;&#x9700;&#x8981;&#x6267;&#x884C;&#x52A8;&#x753B;&#x7684; <code>key</code> &#x503C;&#xFF0C;&#x5373;&#x53EF;&#x8FBE;&#x5230;&#x52A8;&#x753B;&#x5207;&#x6362;&#x7684;&#x6548;&#x679C;&#x3002;</strong></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/f6074b5f26ac6dbf9ce35f7dcafdc75954c6b8804ebf7ff15c80fa4b305e9d5f" alt></p>
<h2 id="10&#x3001;&#x591A;&#x8BED;&#x8A00;&#x663E;&#x793A;&#x5F02;&#x5E38;"><a href="#10&#x3001;&#x591A;&#x8BED;&#x8A00;&#x663E;&#x793A;&#x5F02;&#x5E38;" class="headerlink" title="10&#x3001;&#x591A;&#x8BED;&#x8A00;&#x663E;&#x793A;&#x5F02;&#x5E38;"></a>10&#x3001;&#x591A;&#x8BED;&#x8A00;&#x663E;&#x793A;&#x5F02;&#x5E38;</h2><p>&#x5728;&#x5B98;&#x65B9;&#x7684; <a href="/external_links/9e3dfcdf1dbf85b1fe6001b2875e78b5.html" target="blank" rel="noopener">github.com/flutter/flu&#x2026;</a> issue &#x4E2D;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#xFF0C;<strong>Flutter &#x5728;&#x97E9;&#x8BED;/&#x65E5;&#x8BED; &#x4E0E;&#x4E2D;&#x6587;&#x540C;&#x65F6;&#x663E;&#x793A;&#xFF0C;&#x4F1A;&#x5BFC;&#x81F4; iOS &#x4E0B;&#x51FA;&#x73B0;&#x6587;&#x5B57;&#x6E32;&#x67D3;&#x5F02;&#x5E38;&#x7684;&#x95EE;&#x9898;</strong> &#xFF0C;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#xFF0C;&#x5DE6;&#x8FB9;&#x4E3A;&#x5F02;&#x5E38;&#x60C5;&#x51B5;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/0993e5255dc7d97385fc90a0957e486e74f074a0cff8f0454713fd6e059c7da3" alt></p>
<p>&#x6539;&#x95EE;&#x9898;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x6682;&#x65F6;&#x6709;&#x4E24;&#x79CD;&#xFF1A;</p>
<ul>
<li><strong>&#x589E;&#x52A0;&#x5B57;&#x4F53; ttf &#xFF0C;&#x5168;&#x5C40;&#x6307;&#x5B9A;&#x6539;&#x5B57;&#x4F53;&#x663E;&#x793A;&#x3002;</strong></li>
<li><strong>&#x4FEE;&#x6539;&#x4E3B;&#x9898;&#x4E0B;&#x6240;&#x6709; <code>TextTheme</code> &#x7684; <code>fontFamilyFallback</code> &#xFF1A;</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;getThemeData() {</span><br><span class="line">  var themeData = ThemeData(</span><br><span class="line">        primarySwatch: primarySwatch</span><br><span class="line">   );</span><br><span class="line"></span><br><span class="line">    var result = themeData.copyWith(</span><br><span class="line">      textTheme: confirmTextTheme(themeData.textTheme),</span><br><span class="line">      accentTextTheme: confirmTextTheme(themeData.accentTextTheme),</span><br><span class="line">      primaryTextTheme: confirmTextTheme(themeData.primaryTextTheme),</span><br><span class="line">    );</span><br><span class="line">    return result;</span><br><span class="line">}</span><br><span class="line">/// &#x5904;&#x7406; ios &#x4E0A;&#xFF0C;&#x540C;&#x9875;&#x9762;&#x51FA;&#x73B0;&#x97E9;&#x6587;&#x548C;&#x7B80;&#x4F53;&#x4E2D;&#x6587;&#xFF0C;&#x5BFC;&#x81F4;&#x7684;&#x663E;&#x793A;&#x5B57;&#x4F53;&#x5F02;&#x5E38;</span><br><span class="line">confirmTextTheme(TextTheme textTheme) {</span><br><span class="line">  getCopyTextStyle(TextStyle textStyle) {</span><br><span class="line">    return textStyle.copyWith(fontFamilyFallback: [&quot;PingFang SC&quot;, &quot;Heiti SC&quot;]);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  return textTheme.copyWith(</span><br><span class="line">    display4: getCopyTextStyle(textTheme.display4),</span><br><span class="line">    display3: getCopyTextStyle(textTheme.display3),</span><br><span class="line">    display2: getCopyTextStyle(textTheme.display2),</span><br><span class="line">    display1: getCopyTextStyle(textTheme.display1),</span><br><span class="line">    headline: getCopyTextStyle(textTheme.headline),</span><br><span class="line">    title: getCopyTextStyle(textTheme.title),</span><br><span class="line">    subhead: getCopyTextStyle(textTheme.subhead),</span><br><span class="line">    body2: getCopyTextStyle(textTheme.body2),</span><br><span class="line">    body1: getCopyTextStyle(textTheme.body1),</span><br><span class="line">    caption: getCopyTextStyle(textTheme.caption),</span><br><span class="line">    button: getCopyTextStyle(textTheme.button),</span><br><span class="line">    subtitle: getCopyTextStyle(textTheme.subtitle),</span><br><span class="line">    overline: getCopyTextStyle(textTheme.overline),</span><br><span class="line">  );</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ps &#xFF1A;<strong>&#x901A;&#x8FC7;<code>WidgetsBinding.instance.window.locale;</code> &#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x5230;&#x624B;&#x673A;&#x5E73;&#x53F0;&#x672C;&#x8EAB;&#x7684;&#x5F53;&#x524D;&#x8BED;&#x8A00;&#x60C5;&#x51B5;&#xFF0C;&#x4E0D;&#x9700;&#x8981; <code>context</code> &#xFF0C;&#x4E5F;&#x4E0D;&#x662F;&#x4F60;&#x8BBE;&#x7F6E;&#x540E;&#x7684; <code>Locale</code> &#x3002;</strong></p>
</blockquote>
<h2 id="11&#x3001;&#x957F;&#x6309;&#x8F93;&#x5165;&#x6846;&#x5BFC;&#x81F4;&#x5F02;&#x5E38;&#x7684;&#x60C5;&#x51B5;"><a href="#11&#x3001;&#x957F;&#x6309;&#x8F93;&#x5165;&#x6846;&#x5BFC;&#x81F4;&#x5F02;&#x5E38;&#x7684;&#x60C5;&#x51B5;" class="headerlink" title="11&#x3001;&#x957F;&#x6309;&#x8F93;&#x5165;&#x6846;&#x5BFC;&#x81F4;&#x5F02;&#x5E38;&#x7684;&#x60C5;&#x51B5;"></a>11&#x3001;&#x957F;&#x6309;&#x8F93;&#x5165;&#x6846;&#x5BFC;&#x81F4;&#x5F02;&#x5E38;&#x7684;&#x60C5;&#x51B5;</h2><p>&#x5982;&#x679C;&#x9879;&#x76EE;&#x5B58;&#x5728;&#x591A;&#x8BED;&#x8A00;&#x548C;&#x4E3B;&#x9898;&#x5207;&#x6362;&#x7684;&#x573A;&#x666F;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x9047;&#x5230;&#x957F;&#x6309;&#x8F93;&#x5165;&#x6846;&#x5BFC;&#x81F4;&#x5F02;&#x5E38;&#x7684;&#x573A;&#x666F;&#xFF0C;&#x76EE;&#x524D;&#x53EF;&#x63A8;&#x8350;&#x4E24;&#x79CD;&#x89E3;&#x653E;&#x65B9;&#x6CD5;&#xFF1A;</p>
<ul>
<li>1&#x3001;&#x53EF;&#x4EE5;&#x7ED9;&#x4F60;&#x7684;&#x81EA;&#x5B9A;&#x4E49; <code>ThemeData</code> &#x5F3A;&#x5236;&#x6307;&#x5B9A;&#x56FA;&#x5B9A;&#x4E00;&#x4E2A;&#x5E73;&#x53F0;&#xFF0C;&#x4F46;&#x662F;&#x8BE5;&#x65B9;&#x5F0F;&#x4F1A;&#x5BFC;&#x81F4;&#x5E73;&#x53F0;&#x590D;&#x5236;&#x7C98;&#x8D34;&#x5F39;&#x51FA;&#x6846;&#x6CA1;&#x6709;&#x4E86;&#x5E73;&#x53F0;&#x7279;&#x6027;&#xFF1A;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801; ///&#x9632;&#x6B62;&#x8F93;&#x5165;&#x6846;&#x957F;&#x6309;&#x5D29;&#x6E83;&#x95EE;&#x9898;</span><br><span class="line">platform: TargetPlatform.android</span><br></pre></td></tr></table></figure>

<ul>
<li>2&#x3001;&#x589E;&#x52A0;&#x4E00;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x7684; <code>LocalizationsDelegate</code> , &#x5B9E;&#x73B0;&#x591A;&#x8BED;&#x8A00;&#x73AF;&#x5883;&#x4E0B;&#x7684;&#x81EA;&#x5B9A;&#x4E49;&#x652F;&#x6301;&#xFF1A;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">class FallbackCupertinoLocalisationsDelegate</span><br><span class="line">    extends LocalizationsDelegate&lt;CupertinoLocalizations&gt; {</span><br><span class="line">  const FallbackCupertinoLocalisationsDelegate();</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  bool isSupported(Locale locale) =&gt; true;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  Future&lt;CupertinoLocalizations&gt; load(Locale locale) =&gt; loadCupertinoLocalizations(locale);</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  bool shouldReload(FallbackCupertinoLocalisationsDelegate old) =&gt; false;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">class CustomZhCupertinoLocalizations extends DefaultCupertinoLocalizations {</span><br><span class="line">  const CustomZhCupertinoLocalizations();</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String datePickerMinuteSemanticsLabel(int minute) {</span><br><span class="line">    if (minute == 1) return &apos;1 &#x5206;&#x949F;&apos;;</span><br><span class="line">    return minute.toString() + &apos; &#x5206;&#x949F;&apos;;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String get anteMeridiemAbbreviation =&gt; &apos;&#x4E0A;&#x5348;&apos;;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String get postMeridiemAbbreviation =&gt; &apos;&#x4E0B;&#x5348;&apos;;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String get alertDialogLabel =&gt; &apos;&#x8B66;&#x544A;&apos;;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String timerPickerHourLabel(int hour) =&gt; &apos;&#x5C0F;&#x65F6;&apos;;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String timerPickerMinuteLabel(int minute) =&gt; &apos;&#x5206;&apos;;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String timerPickerSecond(int second) =&gt; &apos;&#x79D2;&apos;;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String get cutButtonLabel =&gt; &apos;&#x88C1;&#x526A;&apos;;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String get copyButtonLabel =&gt; &apos;&#x590D;&#x5236;&apos;;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String get pasteButtonLabel =&gt; &apos;&#x7C98;&#x8D34;&apos;;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String get selectAllButtonLabel =&gt; &apos;&#x5168;&#x9009;&apos;;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">class CustomTCCupertinoLocalizations extends DefaultCupertinoLocalizations {</span><br><span class="line">  const CustomTCCupertinoLocalizations();</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String datePickerMinuteSemanticsLabel(int minute) {</span><br><span class="line">    if (minute == 1) return &apos;1 &#x5206;&#x9418;&apos;;</span><br><span class="line">    return minute.toString() + &apos; &#x5206;&#x9418;&apos;;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String get anteMeridiemAbbreviation =&gt; &apos;&#x4E0A;&#x5348;&apos;;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String get postMeridiemAbbreviation =&gt; &apos;&#x4E0B;&#x5348;&apos;;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String get alertDialogLabel =&gt; &apos;&#x8B66;&#x544A;&apos;;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String timerPickerHourLabel(int hour) =&gt; &apos;&#x5C0F;&#x65F6;&apos;;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String timerPickerMinuteLabel(int minute) =&gt; &apos;&#x5206;&apos;;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String timerPickerSecond(int second) =&gt; &apos;&#x79D2;&apos;;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String get cutButtonLabel =&gt; &apos;&#x88C1;&#x526A;&apos;;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String get copyButtonLabel =&gt; &apos;&#x5FA9;&#x5236;&apos;;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String get pasteButtonLabel =&gt; &apos;&#x7C98;&#x8CBC;&apos;;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  String get selectAllButtonLabel =&gt; &apos;&#x5168;&#x9078;&apos;;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">Future&lt;CupertinoLocalizations&gt; loadCupertinoLocalizations(Locale locale) {</span><br><span class="line">  CupertinoLocalizations localizations;</span><br><span class="line">  if (locale.languageCode == &quot;zh&quot;) {</span><br><span class="line">    switch (locale.countryCode) {</span><br><span class="line">      case &apos;HK&apos;:</span><br><span class="line">      case &apos;TW&apos;:</span><br><span class="line">        localizations = CustomTCCupertinoLocalizations();</span><br><span class="line">        break;</span><br><span class="line">      default:</span><br><span class="line">        localizations = CustomZhCupertinoLocalizations();</span><br><span class="line">    }</span><br><span class="line">  } else {</span><br><span class="line">    localizations = DefaultCupertinoLocalizations();</span><br><span class="line">  }</span><br><span class="line">  return SynchronousFuture&lt;CupertinoLocalizations&gt;(localizations);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<blockquote>
<p>&#x81EA;&#x6B64;&#xFF0C;&#x7B2C;&#x5341;&#x4E03;&#x7BC7;&#x7EC8;&#x4E8E;&#x7ED3;&#x675F;&#x4E86;&#xFF01;(///&#x25BD;///)</p>
</blockquote>
<h3 id="&#x8D44;&#x6E90;&#x63A8;&#x8350;"><a href="#&#x8D44;&#x6E90;&#x63A8;&#x8350;" class="headerlink" title="&#x8D44;&#x6E90;&#x63A8;&#x8350;"></a>&#x8D44;&#x6E90;&#x63A8;&#x8350;</h3><ul>
<li>Github &#xFF1A; <a href="/external_links/bd7808078f5d6788f5c0bd5cbc28101b.html" target="blank" rel="noopener">github.com/CarGuo</a></li>
<li><strong>&#x5F00;&#x6E90; Flutter &#x5B8C;&#x6574;&#x9879;&#x76EE;&#xFF1A;<a href="/external_links/c3658c5a7c3fd9ce8fbce9c1e57641fb.html" target="blank" rel="noopener">github.com/CarGuo/GSYG&#x2026;</a></strong></li>
<li><strong>&#x5F00;&#x6E90; Flutter &#x591A;&#x6848;&#x4F8B;&#x5B66;&#x4E60;&#x578B;&#x9879;&#x76EE;: <a href="/external_links/726848483446b0f2a85c2a35da9d2c89.html" target="blank" rel="noopener">github.com/CarGuo/GSYF&#x2026;</a></strong></li>
<li><strong>&#x5F00;&#x6E90; Fluttre &#x5B9E;&#x6218;&#x7535;&#x5B50;&#x4E66;&#x9879;&#x76EE;&#xFF1A;<a href="/external_links/8a40a928cf868858ba750fb90c14ae13.html" target="blank" rel="noopener">github.com/CarGuo/GSYF&#x2026;</a></strong></li>
<li>&#x5F00;&#x6E90; React Native &#x9879;&#x76EE;&#xFF1A;<a href="/external_links/1b66db3a6d84807383b0065dbd1b5216.html" target="blank" rel="noopener">github.com/CarGuo/GSYG&#x2026;</a></li>
</ul>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/c2b194322c92b5d85c55dc45fdd2a54c4ad85fc20671d484c0463d069db34002" alt></p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/42ab628df6ba234af97272064c1423a9.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903924965572615.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903924965572615.html" itemprop="url">Android - 一种新奇的冷启动速度优化思路(Fragm</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-26T21:38:38+08:00">
                2019-08-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="&#x4E00;&#x3001;&#x80CC;&#x666F;"><a href="#&#x4E00;&#x3001;&#x80CC;&#x666F;" class="headerlink" title="&#x4E00;&#x3001;&#x80CC;&#x666F;"></a>&#x4E00;&#x3001;&#x80CC;&#x666F;</h3><p>&#x660E;&#x5929;&#x662F;&#x5468;&#x4E8C;&#xFF0C;&#x6B63;&#x597D;&#x662F;&#x6211;&#x4EEC;&#x56E2;&#x961F;&#x6BCF;&#x5468;&#x4E00;&#x6B21;&#x7684;&#x6280;&#x672F;&#x5206;&#x4EAB;&#xFF0C;&#x6211;&#x4F1A;&#x628A;&#x524D;&#x6BB5;&#x65F6;&#x95F4;&#x82B1;&#x4E86;&#x51E0;&#x5929;&#x5728;&#x5E72;&#x5176;&#x4ED6;&#x6D3B;&#x7684;&#x540C;&#x65F6;&#xFF0C;&#x6574;&#x7684;&#x4E00;&#x5957;&#x8BE1;&#x5F02;&#x7684;&#x51B7;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x4F18;&#x5316;&#x65B9;&#x6848;&#x5206;&#x4EAB;&#x4E00;&#x4E0B;&#x3002;</p>
<h3 id="&#x4E8C;&#x3001;&#x7279;&#x610F;&#x58F0;&#x660E;"><a href="#&#x4E8C;&#x3001;&#x7279;&#x610F;&#x58F0;&#x660E;" class="headerlink" title="&#x4E8C;&#x3001;&#x7279;&#x610F;&#x58F0;&#x660E;"></a>&#x4E8C;&#x3001;&#x7279;&#x610F;&#x58F0;&#x660E;</h3><p>&#x6211;&#x8FD9;&#x8FB9;&#x6587;&#x7AE0;&#x7684;&#x5185;&#x5BB9;&#x4E0D;&#x4F1A;&#x6D89;&#x53CA;&#x7F51;&#x4E0A;&#x53D8;&#x5730;&#x90FD;&#x662F;&#x7684;&#x5E38;&#x89C4;&#x7684;&#x4F18;&#x5316;&#x65B9;&#x6848;~ &#xFF0C;&#x540C;&#x65F6;&#xFF0C;&#x5E73;&#x65F6;&#x5DE5;&#x4F5C;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5DE5;&#x4F5C;&#x5185;&#x5BB9;&#x6742;&#x4E14;&#x591A;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x4E2A;&#x4F18;&#x5316;&#x65B9;&#x6848;&#x4E5F;&#x4E0D;&#x662F;&#x7279;&#x522B;&#x6210;&#x719F;&#xFF0C;&#x4EC5;&#x4F9B;&#x53C2;&#x8003;&#x5427;~</p>
<h3 id="&#x4E09;&#x3001;&#x6700;&#x5E38;&#x89C1;&#x7684;&#x4F18;&#x5316;&#x65B9;&#x6848;"><a href="#&#x4E09;&#x3001;&#x6700;&#x5E38;&#x89C1;&#x7684;&#x4F18;&#x5316;&#x65B9;&#x6848;" class="headerlink" title="&#x4E09;&#x3001;&#x6700;&#x5E38;&#x89C1;&#x7684;&#x4F18;&#x5316;&#x65B9;&#x6848;"></a>&#x4E09;&#x3001;&#x6700;&#x5E38;&#x89C1;&#x7684;&#x4F18;&#x5316;&#x65B9;&#x6848;</h3><ul>
<li>&#x6570;&#x636E;&#x61D2;&#x52A0;&#x8F7D;&#xFF0C;&#x6BD4;&#x5982;Fragment&#x7528;&#x6237;&#x4E0D;&#x53EF;&#x89C1;&#x65F6;&#x4E0D;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x7684;&#x83B7;&#x53D6;</li>
<li>&#x4F18;&#x5316;&#x5E03;&#x5C40;&#x5C42;&#x7EA7;&#xFF0C;&#x51CF;&#x5C11;&#x9996;&#x6B21;inflate layout&#x7684;&#x8017;&#x65F6;</li>
<li>&#x5C06;&#x7EDD;&#x5927;&#x90E8;&#x5206;sdk&#x7684;&#x521D;&#x59CB;&#x5316;&#x653E;&#x7EBF;&#x7A0B;&#x6C60;&#x4E2D;&#x8FD0;&#x884C;</li>
<li>&#x80FD;&#x7528;ViewStub&#x7684;&#x5C31;&#x7528;ViewStub&#xFF0C;&#x6309;&#x9700;&#x52A0;&#x8F7D;layout</li>
<li>&#x4E00;&#x5B9A;&#x8981;&#x5C3D;&#x91CF;&#x907F;&#x514D;&#x542F;&#x52A8;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x51FA;&#x73B0;&#x7684;&#x4E3B;&#x7EBF;&#x7A0B;&#x53BB;unpack&#x4E00;&#x4E9B;&#x5168;&#x5C40;&#x914D;&#x7F6E;&#x7684;&#x6570;&#x636E;</li>
<li>&#x4E0D;&#x4EC5;&#x4EC5;&#x662F;&#x4E09;&#x65B9;&#x5E93;&#x53EF;&#x4EE5;&#x653E;&#x5B50;&#x7EBF;&#x7A0B;&#x8FDB;&#x884C;&#xFF0C;&#x4E00;&#x4E9B;&#x65F6;&#x6548;&#x6027;&#x8981;&#x6C42;&#x6CA1;&#x90A3;&#x4E48;&#x9AD8;&#x7684;&#x903B;&#x8F91;&#x90FD;&#x53EF;&#x4EE5;&#x653E;&#x5B50;&#x7EBF;&#x7A0B;</li>
</ul>
<h3 id="&#x56DB;&#x3001;&#x9879;&#x76EE;&#x7ED3;&#x6784;"><a href="#&#x56DB;&#x3001;&#x9879;&#x76EE;&#x7ED3;&#x6784;" class="headerlink" title="&#x56DB;&#x3001;&#x9879;&#x76EE;&#x7ED3;&#x6784;"></a>&#x56DB;&#x3001;&#x9879;&#x76EE;&#x7ED3;&#x6784;</h3><p>&#x5728;&#x6211;&#x4EEC;&#x7684;Android&#x9879;&#x76EE;&#x4E2D;&#xFF0C;&#x5E94;&#x7528;&#x8FC7;&#x4E86;&#x95EA;&#x5C4F;&#x4E4B;&#x540E;&#x4F1A;&#x8FDB;&#x5165;&#x5230;&#x4E3B;&#x5C4F; - MainActivity&#xFF0C;&#x8FD9;&#x4E2A;&#x5730;&#x65B9;&#x6211;&#x5410;&#x69FD;&#x5F88;&#x591A;&#x6B21;&#x4E86;&#xFF0C;&#x5E7F;&#x544A;&#x95EA;&#x5C4F;&#x4F5C;&#x4E3A;launcher&#x771F;&#x7684;&#x4E0D;&#x662F;&#x7279;&#x522B;&#x9760;&#x8C31;&#xFF0C;&#x6700;&#x597D;&#x7684;&#x65B9;&#x5F0F;&#x5E94;&#x8BE5;&#x662F;&#x4ECE;MainActivity&#x91CC;&#x9762;&#x6765;&#x542F;&#x52A8;AdActivity&#xFF0C;&#x751A;&#x81F3;&#x662F;&#x4E0D;&#x7528;Activity&#xFF0C;&#x91C7;&#x7528;&#x4E00;&#x4E2A;&#x5168;&#x5C4F;&#x7684;AdView&#x90FD;&#x53EF;&#x4EE5;&#x3002;</p>
<p>&#x5148;&#x7B80;&#x5355;&#x4ECB;&#x7ECD;&#x4E00;&#x4E0B;&#x6211;&#x4EEC;&#x9879;&#x76EE;&#x4E2D;MainActivity&#x6D89;&#x53CA;&#x5230;&#x7684;&#x7ED3;&#x6784;&#xFF1A;</p>
<p>&#x7B80;&#x5355;&#x7684;&#x753B;&#x4E86;&#x4E2A;&#x56FE;&#xFF0C;<strong>&#x7B80;&#x76F4;&#x662F;&#x3002;&#x3002;&#x753B;&#x56FE;&#x754C;&#x7684;&#x803B;&#x8FB1;&#x3002;&#x3002;&#x3002;</strong></p>
<p>&#x5927;&#x6982;&#x770B;&#x770B;&#x610F;&#x601D;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#xFF0C;&#x6211;&#x5728;&#x7EC4;&#x5185;&#x5206;&#x4EAB;&#x5C31;&#x662F;&#x7528;&#x7684;&#x8FD9;&#x4E2A;&#x8349;&#x56FE;&#xFF0C;&#x6025;&#x7740;&#x4E0B;&#x73ED;&#xFF0C;&#x5C31;&#x4E0D;&#x91CD;&#x65B0;&#x753B;&#x4E86;&#x3002;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/bcc07a6a07fa78da8aa8ec3325b283d74a48139a9407ced1ba0af334be174e85" alt></p>
<p>&#x5F53;App&#x51B7;&#x542F;&#x52A8;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8089;&#x773C;&#x53EF;&#x89C1;&#x7684;&#x8981;&#x521D;&#x59CB;&#x5316;&#x7684;&#x4E1C;&#x897F;&#x592A;&#x591A;&#x4E86;&#xFF0C;&#x672C;&#x8EAB;<strong>Fragment&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x76F8;&#x5BF9;&#x91CD;&#x7684;&#x4E1C;&#x897F;&#x3002;&#x6BD4;Activity&#x8981;&#x8F7B;&#x91CF;&#x5F88;&#x591A;&#xFF0C;&#x4F46;&#x662F;&#x6BD4;View&#x53C8;&#x8981;&#x91CD;</strong></p>
<p>&#x6211;&#x4EEC;&#x9996;&#x9875;&#x5927;&#x6982;&#x662F; 4-5&#x4E2A;tab&#xFF0C;&#x6BCF;&#x4E2A;tab&#x90FD;&#x662F;&#x4E00;&#x4E2A;Fragment&#xFF0C;&#x4E14;&#x7B2C;&#x4E00;&#x4E2A;tab&#x5185;&#x5D4C;&#x4E86;4&#x4E2A;Fragment&#xFF0C;&#x6211;&#x8FD9;&#x4E00;&#x6B21;&#x7684;<strong>&#x4F18;&#x5316;&#x4E3B;&#x8981;&#x5C06;&#x76EE;&#x6807;&#x7784;&#x51C6;&#x4E86;&#x9996;&#x9875;&#x7684; tab1 &#x4EE5;&#x53CA;tab1&#x5185;&#x5D4C;&#x7684;&#x56DB;&#x4E2A;tab</strong></p>
<h2 id="&#x4E94;&#x3001;&#x6781;&#x81F4;&#x7684;&#x61D2;&#x52A0;&#x8F7D;"><a href="#&#x4E94;&#x3001;&#x6781;&#x81F4;&#x7684;&#x61D2;&#x52A0;&#x8F7D;" class="headerlink" title="&#x4E94;&#x3001;&#x6781;&#x81F4;&#x7684;&#x61D2;&#x52A0;&#x8F7D;"></a>&#x4E94;&#x3001;&#x6781;&#x81F4;&#x7684;&#x61D2;&#x52A0;&#x8F7D;</h2><h3 id="5-1-&#x6781;&#x81F4;&#x7684;&#x61D2;&#x52A0;&#x8F7D;"><a href="#5-1-&#x6781;&#x81F4;&#x7684;&#x61D2;&#x52A0;&#x8F7D;" class="headerlink" title="5.1 &#x6781;&#x81F4;&#x7684;&#x61D2;&#x52A0;&#x8F7D;"></a>5.1 &#x6781;&#x81F4;&#x7684;&#x61D2;&#x52A0;&#x8F7D;</h3><p>&#x5E73;&#x65F6;&#x89C1;&#x5230;&#x7684;&#x61D2;&#x52A0;&#x8F7D;&#xFF1A;</p>
<blockquote>
<p>&#x5C31;&#x662F;&#x521D;&#x59CB;&#x5316;fragment&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x8FDE;&#x540C;&#x6211;&#x4EEC;&#x5199;&#x7684;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x4E00;&#x8D77;&#x6267;&#x884C;&#xFF0C;&#x8FD9;&#x6837;&#x975E;&#x5E38;&#x6D88;&#x8017;&#x6027;&#x80FD;&#xFF0C;&#x6700;&#x7406;&#x60F3;&#x7684;&#x65B9;&#x5F0F;&#x662F;&#xFF0C;&#x53EA;&#x6709;&#x7528;&#x6237;&#x70B9;&#x5F00;&#x6216;&#x6ED1;&#x52A8;&#x5230;&#x5F53;&#x524D;fragment&#x65F6;&#xFF0C;&#x624D;&#x8FDB;&#x884C;&#x8BF7;&#x6C42;&#x7F51;&#x7EDC;&#x7684;&#x64CD;&#x4F5C;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x4EA7;&#x751F;&#x4E86;&#x61D2;&#x52A0;&#x8F7D;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x8BF4;&#x6CD5;&#x3002;</p>
</blockquote>
<p>&#x4F46;&#x662F;&#x3002;&#x3002;&#x3002;&#x3002;</p>
<p>&#x7531;&#x4E8E;&#x6211;&#x4EEC;&#x9996;&#x5C4F;4&#x4E2A;&#x5B50;Tab&#x90FD;&#x662F;&#x7EE7;&#x627F;&#x81EA;&#x4E00;&#x4E2A;&#x57FA;&#x7C7B;BaseLoadListFragment&#xFF0C;&#x6570;&#x636E;&#x52A0;&#x8F7D;&#x7684;&#x903B;&#x8F91;&#x975E;&#x5E38;&#x7684;&#x6B7B;&#xFF0C;&#x6309;&#x7167;&#x4E0A;&#x8FF0;&#x7684;&#x6539;&#x6CD5;&#xFF0C;&#x5F71;&#x54CD;&#x9762;&#x592A;&#x5927;&#x3002;&#x540E;&#x7EED;&#x53EF;&#x80FD;&#x4F1A;&#x5F92;&#x589E;&#x70E6;&#x607C;</p>
<h3 id="5-2-&#x61D2;&#x52A0;&#x8F7D;&#x65B9;&#x6848;"><a href="#5-2-&#x61D2;&#x52A0;&#x8F7D;&#x65B9;&#x6848;" class="headerlink" title="5.2 &#x61D2;&#x52A0;&#x8F7D;&#x65B9;&#x6848;"></a>5.2 &#x61D2;&#x52A0;&#x8F7D;&#x65B9;&#x6848;</h3><ol>
<li>&#x9996;&#x5C4F;&#x52A0;&#x8F7D;&#x65F6;&#xFF0C;&#x53EA;&#x5F80;ViewPager&#x4E2D;&#x585E;&#x5165;&#x9ED8;&#x8BA4;&#x8981;&#x5C55;&#x793A;&#x7684;tab&#xFF0C;&#x5269;&#x4F59;&#x7684;tab&#x7528;&#x7A7A;&#x7684;&#x5360;&#x4F4D;Fragment&#x4EE3;&#x66FF;</li>
<li>&#x5F53;&#x7528;&#x6237;&#x6ED1;&#x52A8;&#x5230;&#x5176;&#x4ED6;tab&#x65F6;&#xFF0C;&#x6BD4;&#x5982;&#x6ED1;&#x52A8;&#x5230;&#x597D;&#x53CB;&#x52A8;&#x6001;tab&#xFF0C;&#x5C31;&#x7528;FriendFragment&#x628A;&#x5F53;&#x524D;&#x7684;EmptyPlaceholderFragment&#x66FF;&#x6362;&#x6389;&#xFF0C;&#x7136;&#x540E;adapter.notifyDataSetChanged</li>
<li>&#x5F53;&#x56DB;&#x4E2A;Tab&#x5168;&#x90E8;&#x66FF;&#x6362;&#x4E3A;&#x6570;&#x636E;tab&#x65F6;&#xFF0C;&#x6E05;&#x9664;&#x6389;EmptyFragment&#x7684;&#x5F15;&#x7528;&#xFF0C;&#x91CA;&#x653E;&#x5185;&#x5B58;</li>
</ol>
<p>&#x8BF4;&#x5230;&#x8FD9;&#x91CC;&#xFF0C;&#x53C8;&#x4E0D;&#x5F97;&#x4E0D;&#x63D0;&#x4E00;&#x4E2A;&#x8001;&#x751F;&#x5E38;&#x8C08;&#x7684;&#x4E00;&#x4E2A;&#x5751;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x7684;&#x9996;&#x9875;&#x662F;&#x7528;&#x7684;ViewPager + FragmentPagerAdapter&#x6765;&#x8FDB;&#x884C;&#x5B9E;&#x73B0;&#x7684;&#x3002;&#x56E0;&#x6B64;&#x5C31;&#x51FA;&#x73B0;&#x4E86;&#x4E00;&#x4E2A;&#x5751;&#xFF1A;</p>
<blockquote>
<p>ViewPager + FragmentPagerAdapter&#x7EC4;&#x5408;&#x4F7F;&#x7528;&#xFF0C;&#x8C03;&#x7528;notifyDataSetChanged()&#x65B9;&#x6CD5;&#x65E0;&#x6548;&#xFF0C;&#x65E0;&#x6CD5;&#x5237;&#x65B0;Fragment&#x5217;&#x8868;</p>
</blockquote>
<p>&#x4E0B;&#x9762;&#x6211;&#x4F1A;&#x5BF9;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x8FDB;&#x884C;&#x4E00;&#x4E0B;&#x8BE6;&#x7EC6;&#x7684;&#x4ECB;&#x7ECD;</p>
<h3 id="5-3-FragmentPagerAdapter&#x4E0E;FragmentStatePagerAdapter"><a href="#5-3-FragmentPagerAdapter&#x4E0E;FragmentStatePagerAdapter" class="headerlink" title="5.3 FragmentPagerAdapter&#x4E0E;FragmentStatePagerAdapter"></a>5.3 FragmentPagerAdapter&#x4E0E;FragmentStatePagerAdapter</h3><p>&#x5F53;&#x6211;&#x4EEC;&#x8981;&#x4F7F;&#x7528;ViewPager&#x6765;&#x52A0;&#x8F7D;Fragment&#x65F6;&#xFF0C;&#x5B98;&#x65B9;&#x4E3A;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;&#x4E86;&#x8FD9;&#x4E24;&#x79CD;Adapter&#xFF0C;&#x90FD;&#x662F;&#x7EE7;&#x627F;&#x81EA;PagerAdapter&#x3002;</p>
<p>&#x533A;&#x522B;&#xFF0C;&#x4E0A;&#x5B98;&#x65B9;&#x63CF;&#x8FF0;&#xFF1A;</p>
<p>FragmentPagerAdapter</p>
<blockquote>
<p>This version of the pager is best for use when there are a handful of typically more static fragments to be paged through, such as a set of tabs. The fragment of each page the user visits will be kept in memory, though its view hierarchy may be destroyed when not visible. This can result in using a significant amount of memory since fragment instances can hold on to an arbitrary amount of state. For larger sets of pages, consider <code>[FragmentStatePagerAdapter](https://developer.android.com/reference/android/support/v4/app/FragmentStatePagerAdapter.html)</code>.</p>
</blockquote>
<p>FragmentStatePagerAdapter</p>
<blockquote>
<p>This version of the pager is more useful when there are a large number of pages, working more like a list view. When pages are not visible to the user, their entire fragment may be destroyed, only keeping the saved state of that fragment. This allows the pager to hold on to much less memory associated with each visited page as compared to<code>[FragmentPagerAdapter](https://developer.android.com/reference/android/support/v4/app/FragmentPagerAdapter.html)</code> at the cost of potentially more overhead when switching between pages</p>
</blockquote>
<p>&#x603B;&#x7ED3;&#xFF1A;</p>
<ul>
<li>&#x4F7F;&#x7528;FragmentStatePagerAdapter&#x65F6;&#xFF0C;&#x5982;&#x679C;tab&#x5BF9;&#x4E8E;&#x7528;&#x6237;&#x4E0D;&#x53EF;&#x89C1;&#x4E86;&#xFF0C;Fragment&#x5C31;&#x4F1A;&#x88AB;&#x9500;&#x6BC1;&#xFF0C;FragmentPagerAdapter&#x5219;&#x4E0D;&#x4F1A;&#xFF0C;&#x4F7F;&#x7528;FragmentPagerAdapter&#x65F6;&#xFF0C;&#x6240;&#x6709;&#x7684;tab&#x4E0A;&#x7684;Fragment&#x90FD;&#x4F1A;hold&#x5728;&#x5185;&#x5B58;&#x91CC;</li>
<li>&#x5F53;tab&#x975E;&#x5E38;&#x591A;&#x65F6;&#xFF0C;&#x63A8;&#x8350;&#x4F7F;&#x7528;FragmentStatePagerAdapter</li>
<li>&#x5F53;tab&#x4E0D;&#x591A;&#xFF0C;&#x4E14;&#x56FA;&#x5B9A;&#x65F6;&#xFF0C;&#x63A8;&#x8350;&#x7528;FragmentPagerAdapter</li>
</ul>
<p>&#x6211;&#x4EEC;&#x9879;&#x76EE;&#x4E2D;&#x5C31;&#x662F;&#x4F7F;&#x7528;&#x7684;ViewPager+FragmentPagerAdapter&#x3002;</p>
<h3 id="5-4-FragmentPagerAdapter&#x7684;&#x5237;&#x65B0;&#x95EE;&#x9898;"><a href="#5-4-FragmentPagerAdapter&#x7684;&#x5237;&#x65B0;&#x95EE;&#x9898;" class="headerlink" title="5.4 FragmentPagerAdapter&#x7684;&#x5237;&#x65B0;&#x95EE;&#x9898;"></a>5.4 FragmentPagerAdapter&#x7684;&#x5237;&#x65B0;&#x95EE;&#x9898;</h3><p>&#x6B63;&#x5E38;&#x60C5;&#x51B5;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;adapter&#x65F6;&#xFF0C;&#x60F3;&#x8981;&#x5237;&#x65B0;&#x6570;&#x636E;&#x53EA;&#x9700;&#x8981;&#xFF1A;</p>
<ol>
<li>&#x66F4;&#x65B0;dataSet</li>
<li>&#x8C03;&#x7528;notifyDataSetChanged()</li>
</ol>
<p>&#x4F46;&#x662F;&#xFF0C;&#x8FD9;&#x4E2A;&#x5728;&#x8FD9;&#x4E2A;Adapter&#x4E2D;&#x662F;&#x4E0D;&#x9002;&#x7528;&#x7684;&#x3002;&#x56E0;&#x4E3A;&#xFF08;&#x8FD9;&#x4E00;&#x6B65;&#x6CA1;&#x8010;&#x5FC3;&#x7684;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x770B;&#x540E;&#x9762;&#x7684;&#x603B;&#x7ED3;&#xFF09;&#xFF1A;</p>
<ol>
<li>&#x9ED8;&#x8BA4;&#x7684;PagerAdapter&#x7684;destoryItem&#x53EA;&#x4F1A;&#x628A;Fragment detach&#x6389;&#xFF0C;&#x800C;&#x4E0D;&#x4F1A;remove</li>
<li>&#x5F53;&#x518D;&#x6B21;&#x8C03;&#x7528;instantiateItem&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E4B;&#x524D;detach&#x6389;&#x7684;Fragment&#xFF0C;&#x53C8;&#x4F1A;&#x4ECE;mFragmentManager&#x4E2D;&#x53D6;&#x51FA;&#xFF0C;&#x53C8;&#x53EF;&#x4EE5;attach&#x4E86;</li>
</ol>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/6b6830401c6e32c6648167aecad7e92035bda771b0d969283c8adb59f2ba47d0" alt></p>
<p>3&#xFF0C;ViewPager&#x7684;dataSetChanged&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/6fac3f5d5b2d9514b10f05227f73f4346028bdd0edeb1a360bd18a9214a16461" alt></p>
<p>4&#xFF0C;&#x4E14;adapter&#x7684;&#x9ED8;&#x8BA4;&#x5B9E;&#x73B0;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/54dc5c401717a96ac26105371acc021ebf3a53adcc64e03c005f618884a82882" alt></p>
<p>&#x7B80;&#x5355;&#x603B;&#x7ED3;&#x4E00;&#x4E0B;&#xFF1A;</p>
<p>1&#xFF0C;ViewPager&#x7684;dataSetChanged()&#x4E2D;&#x4F1A;&#x53BB;&#x7528;adapter.getItemPosition&#x6765;&#x5224;&#x65AD;&#x662F;&#x5426;&#x8981;&#x79FB;&#x9664;&#x5F53;&#x524D;Item&#xFF08;position = POSITION_NONE&#x65F6;remove&#xFF09;</p>
<p>2&#xFF0C;PagerAdapter&#x7684;getItemPosition&#x9ED8;&#x8BA4;&#x5B9E;&#x73B0;&#x4E3A;POSITION_UNCHANGED</p>
<p>&#x4E0A;&#x8FF0;&#x4E24;&#x70B9;&#x5BFC;&#x81F4;ViewPager&#x6784;&#x5EFA;&#x5B8C;&#x6210;Adapter&#x4E4B;&#x540E;&#xFF0C;&#x4E0D;&#x4F1A;&#x6709;&#x673A;&#x4F1A;&#x8C03;&#x7528;&#x5230;Adapter&#x7684;instantiateItem&#x4E86;&#x3002;</p>
<p>&#x518D;&#x8005;&#xFF0C;&#x5373;&#x4F7F;&#x91CD;&#x5199;&#x4E86;getItemPosition&#x65B9;&#x6CD5;&#xFF0C;&#x6BCF;&#x6B21;&#x8FD4;&#x56DE;POSITION_NONE&#xFF0C;&#x8FD8;&#x662F;&#x4E0D;&#x4F1A;&#x66FF;&#x6362;&#x6389;Fragment&#xFF0C;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;instantiateItem&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x4F1A;&#x6839;&#x636E;getItemId()&#x53BB;&#x4ECE;FragmetnManager&#x4E2D;&#x627E;&#x5230;&#x5DF2;&#x7ECF;&#x521B;&#x5EFA;&#x597D;&#x7684;Fragment&#x8FD4;&#x56DE;&#x56DE;&#x53BB;&#xFF0C;&#x800C;getItemId()&#x7684;&#x9ED8;&#x8BA4;&#x5B9E;&#x73B0;&#x662F;return position&#x3002;</p>
<h3 id="5-5-FragmentPagerAdapter&#x5237;&#x65B0;&#x7684;&#x6B63;&#x786E;&#x59FF;&#x52BF;"><a href="#5-5-FragmentPagerAdapter&#x5237;&#x65B0;&#x7684;&#x6B63;&#x786E;&#x59FF;&#x52BF;" class="headerlink" title="5.5 FragmentPagerAdapter&#x5237;&#x65B0;&#x7684;&#x6B63;&#x786E;&#x59FF;&#x52BF;"></a>5.5 FragmentPagerAdapter&#x5237;&#x65B0;&#x7684;&#x6B63;&#x786E;&#x59FF;&#x52BF;</h3><p>&#x91CD;&#x5199;getItemId()&#x548C;getItemPosition()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">typescript&#x590D;&#x5236;&#x4EE3;&#x7801; class TabsAdapter extends FragmentPagerAdapter {</span><br><span class="line"></span><br><span class="line">        private ArrayList&lt;Fragment&gt; mFragmentList;</span><br><span class="line">        private ArrayList&lt;String&gt; mPageTitleList;</span><br><span class="line">        private int mCount;</span><br><span class="line"></span><br><span class="line">        TabsAdapter(FragmentManager fm, ArrayList&lt;Fragment&gt; fragmentList, ArrayList&lt;String&gt; pageTitleList) {</span><br><span class="line">            super(fm);</span><br><span class="line">            mFragmentList = fragmentList;</span><br><span class="line">            mCount = fragmentList.size();</span><br><span class="line">            mPageTitleList = pageTitleList;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public Fragment getItem(int position) {</span><br><span class="line">            return mFragmentList.get(position);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public CharSequence getPageTitle(int position) {</span><br><span class="line">            return mPageTitleList.get(position);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public int getCount() {</span><br><span class="line">            return mCount;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public long getItemId(int position) {</span><br><span class="line">            //&#x8FD9;&#x4E2A;&#x5730;&#x65B9;&#x7684;&#x91CD;&#x5199;&#x975E;&#x5E38;&#x5173;&#x952E;&#xFF0C;super&#x4E2D;&#x662F;&#x8FD4;&#x56DE;position&#xFF0C;</span><br><span class="line">            //&#x5982;&#x679C;&#x4E0D;&#x91CD;&#x5199;&#xFF0C;&#x8FD8;&#x662F;&#x4F1A;&#x7EE7;&#x7EED;&#x627E;&#x5230;FragmentManager&#x4E2D;&#x7F13;&#x5B58;&#x7684;Fragment</span><br><span class="line">            return mFragmentList.get(position).hashCode();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public int getItemPosition(@NonNull Object object) {</span><br><span class="line">            //&#x4E0D;&#x5728;&#x6570;&#x636E;&#x96C6;&#x5408;&#x91CC;&#x9762;&#x7684;&#x8BDD;&#xFF0C;return POSITION_NONE&#xFF0C;&#x8FDB;&#x884C;item&#x7684;&#x91CD;&#x5EFA;</span><br><span class="line">            int index = mFragmentList.indexOf(object);</span><br><span class="line">            if (index == -1) {</span><br><span class="line">                return POSITION_NONE;</span><br><span class="line">            } else {</span><br><span class="line">                return mFragmentList.indexOf(object);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        void refreshFragments(ArrayList&lt;Fragment&gt; fragmentList) {</span><br><span class="line">            mFragmentList = fragmentList;</span><br><span class="line">            notifyDataSetChanged();</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>&#x5176;&#x4ED6;&#x7684;&#x76F8;&#x5173;&#x4EE3;&#x7801;&#xFF1A;</p>
<p><strong>&#xFF08;1&#xFF09;&#x5B9E;&#x73B0;ViewPager.OnPageChangeListener</strong>&#xFF0C;&#x6765;&#x76D1;&#x63A7;ViewPager&#x7684;&#x6ED1;&#x52A8;&#x72B6;&#x6001;&#xFF0C;&#x624D;&#x53EF;&#x4EE5;&#x5728;&#x6ED1;&#x52A8;&#x5230;&#x4E0B;&#x4E00;&#x4E2A;tab&#x7684;&#x65F6;&#x5019;&#x8FDB;&#x884C;Fragment&#x66FF;&#x6362;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x5176;&#x4E2D;mDefaultTab&#x662F;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x63A5;&#x53E3;&#x8FD4;&#x56DE;&#x7684;&#x5F53;&#x524D;&#x542F;&#x52A8;&#x5C55;&#x793A;&#x7684;tab&#x5E8F;&#x53F7;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">arduino&#x590D;&#x5236;&#x4EE3;&#x7801;    @Override</span><br><span class="line">    public void onPageScrolled(int position, float positionOffset, int positionOffsetPixels) {</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onPageSelected(int position) {</span><br><span class="line">        mCurrentSelectedTab = position;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onPageScrollStateChanged(int state) {</span><br><span class="line">        if (!hasReplacedAllEmptyFragments &amp;&amp; mCurrentSelectedTab != mDefaultTab &amp;&amp; state == 0) {</span><br><span class="line">            //&#x5F53;&#x6EE1;&#x8DB3;&#xFF1A; 1. &#x6CA1;&#x6709;&#x5168;&#x90E8;&#x66FF;&#x6362;&#x5B8C; 2. &#x5F53;&#x524D;tab&#x4E0D;&#x662F;&#x521D;&#x59CB;&#x5316;&#x7684;&#x9ED8;&#x8BA4;tab&#xFF08;&#x9ED8;&#x8BA4;tab&#x4E0D;&#x4F1A;&#x7528;&#x7A7A;&#x7684;Fragment&#x53BB;&#x66FF;&#x6362;&#xFF09; 3. &#x6ED1;&#x52A8;&#x7ED3;&#x675F;&#x4E86;&#xFF0C;&#x5373;state = 0</span><br><span class="line">            replaceEmptyFragmentsIfNeed(mCurrentSelectedTab);</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>&#x5907;&#x6CE8;&#xFF1A;</p>
<blockquote>
<p>onPageScrollStateChanged&#x63A5;&#x6ED1;&#x52A8;&#x7684;&#x72B6;&#x6001;&#x503C;&#x3002;&#x4E00;&#x5171;&#x6709;&#x4E09;&#x4E2A;&#x53D6;&#x503C;&#xFF1A;</p>
<p>0&#xFF1A;&#x4EC0;&#x4E48;&#x90FD;&#x6CA1;&#x505A;  </p>
<p>1&#xFF1A;&#x5F00;&#x59CB;&#x6ED1;&#x52A8;  </p>
<p>2&#xFF1A;&#x6ED1;&#x52A8;&#x7ED3;&#x675F;</p>
<p>&#x4E00;&#x6B21;&#x5F15;&#x8D77;&#x9875;&#x9762;&#x5207;&#x6362;&#x7684;&#x6ED1;&#x52A8;&#xFF0C;state&#x7684;&#x987A;&#x5E8F;&#x5206;&#x522B;&#x662F;&#xFF1A; 1  -&gt;  2  -&gt;  0</p>
</blockquote>
<p>&#xFF08;<strong>2&#xFF09;&#x8FDB;&#x884C;Fragment&#x7684;&#x66FF;&#x6362;</strong>&#xFF0C;&#x8FD9;&#x91CC;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x7684;tab&#x6570;&#x91CF;&#x662F;&#x53EF;&#x80FD;&#x6839;&#x636E;&#x5168;&#x5C40;config&#x4FE1;&#x606F;&#x800C;&#x6539;&#x53D8;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x4E2A;&#x5730;&#x65B9;&#x5199;&#x7684;&#x7A0D;&#x5FAE;&#x7EA0;&#x7ED3;&#x4E86;&#x4E00;&#x4E9B;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;    /**</span><br><span class="line">     * &#x5982;&#x679C;&#x5168;&#x90E8;&#x66FF;&#x6362;&#x5B8C;&#x4E86;&#xFF0C;&#x76F4;&#x63A5;return</span><br><span class="line">     * &#x66FF;&#x6362;&#x8FC7;&#x7A0B;&#xFF1A;</span><br><span class="line">     * 1. &#x627E;&#x5230;&#x5F53;&#x524D;&#x7A7A;&#x7684;tab&#x5728;mEmptyFragmentList &#x4E2D;&#x7684;&#x5B9E;&#x9645;&#x4E0B;&#x6807;</span><br><span class="line">     *</span><br><span class="line">     * @param tabId &#x8981;&#x66FF;&#x6362;&#x7684;tab&#x7684;tabId - &#xFF08;&#x5F53;&#x524D;&#x7A7A;&#x7684;Fragment&#x5728;adapter&#x6570;&#x636E;&#x5217;&#x8868;mFragmentList&#x7684;&#x4E0B;&#x6807;&#xFF09;</span><br><span class="line">     */</span><br><span class="line">    private void replaceEmptyFragmentsIfNeed(int tabId) {</span><br><span class="line">        if (hasReplacedAllEmptyFragments) {</span><br><span class="line">            return;</span><br><span class="line">        }</span><br><span class="line">        int tabRealIndex = mEmptyFragmentList.indexOf(mFragmentList.get(tabId)); //&#x627E;&#x5230;&#x5F53;&#x524D;&#x7684;&#x7A7A;Fragment&#x5728; mEmptyFragmentList &#x662F;&#x7B2C;&#x51E0;&#x4E2A;</span><br><span class="line">        if (tabRealIndex &gt; -1) {</span><br><span class="line">            if (Collections.replaceAll(mFragmentList, mEmptyFragmentList.get(tabRealIndex), mDataFragmentList.get(tabRealIndex))) {</span><br><span class="line">                mTabsAdapter.refreshFragments(mFragmentList); //&#x5C06;mFragmentList&#x4E2D;&#x7684;&#x76F8;&#x5E94;empty fragment&#x66FF;&#x6362;&#x5B8C;&#x6210;&#x4E4B;&#x540E;&#x5237;&#x65B0;&#x6570;&#x636E;</span><br><span class="line">                boolean hasAllReplaced = true;</span><br><span class="line">                for (Fragment fragment : mFragmentList) {</span><br><span class="line">                    if (fragment instanceof EmptyPlaceHolderFragment) {</span><br><span class="line">                        hasAllReplaced = false;</span><br><span class="line">                        break;</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">                if (hasAllReplaced) {</span><br><span class="line">                    mEmptyFragmentList.clear(); //&#x5168;&#x90E8;&#x66FF;&#x6362;&#x5B8C;&#x6210;&#x7684;&#x8BDD;&#xFF0C;&#x91CA;&#x653E;&#x5F15;&#x7528;</span><br><span class="line">                }</span><br><span class="line">                hasReplacedAllEmptyFragments = hasAllReplaced;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<h2 id="&#x516D;&#x3001;&#x795E;&#x5947;&#x7684;&#x7684;&#x9884;&#x52A0;&#x8F7D;&#xFF08;&#x9884;&#x52A0;&#x8F7D;View&#xFF0C;&#x800C;&#x4E0D;&#x662F;data&#xFF09;"><a href="#&#x516D;&#x3001;&#x795E;&#x5947;&#x7684;&#x7684;&#x9884;&#x52A0;&#x8F7D;&#xFF08;&#x9884;&#x52A0;&#x8F7D;View&#xFF0C;&#x800C;&#x4E0D;&#x662F;data&#xFF09;" class="headerlink" title="&#x516D;&#x3001;&#x795E;&#x5947;&#x7684;&#x7684;&#x9884;&#x52A0;&#x8F7D;&#xFF08;&#x9884;&#x52A0;&#x8F7D;View&#xFF0C;&#x800C;&#x4E0D;&#x662F;data&#xFF09;"></a>&#x516D;&#x3001;&#x795E;&#x5947;&#x7684;&#x7684;&#x9884;&#x52A0;&#x8F7D;&#xFF08;&#x9884;&#x52A0;&#x8F7D;View&#xFF0C;&#x800C;&#x4E0D;&#x662F;data&#xFF09;</h2><p>Android&#x5728;&#x542F;&#x52A8;&#x8FC7;&#x7A0B;&#x4E2D;&#x53EF;&#x80FD;&#x6D89;&#x53CA;&#x5230;&#x7684;&#x4E00;&#x4E9B;View&#x7684;&#x9884;&#x52A0;&#x8F7D;&#x65B9;&#x6848;&#xFF1A;</p>
<ol>
<li>WebView&#x63D0;&#x524D;&#x521B;&#x5EFA;&#x597D;&#xFF0C;&#x56E0;&#x4E3A;webview&#x521B;&#x5EFA;&#x7684;&#x8017;&#x65F6;&#x8F83;&#x957F;&#xFF0C;&#x5982;&#x679C;&#x9996;&#x5C4F;&#x6709;h5&#x7684;&#x9875;&#x9762;&#xFF0C;&#x53EF;&#x4EE5;&#x63D0;&#x524D;&#x521B;&#x5EFA;&#x597D;&#x3002;</li>
<li>Application&#x7684;onCreate&#x65F6;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5F00;&#x59CB;&#x5728;&#x5B50;&#x7EBF;&#x7A0B;&#x4E2D;&#x8FDB;&#x884C;&#x540E;&#x9762;&#x8981;&#x7528;&#x5230;&#x7684;Layout&#x7684;inflate&#x5DE5;&#x4F5C;&#x4E86;&#xFF0C;&#x6700;&#x5148;&#x60F3;&#x5230;&#x7684;&#x5E94;&#x8BE5;&#x662F;&#x5B98;&#x65B9;&#x63D0;&#x4F9B;&#x7684;AsyncLayoutInflater</li>
<li>&#x586B;&#x5145;View&#x7684;&#x6570;&#x636E;&#x7684;&#x9884;&#x52A0;&#x8F7D;&#xFF0C;&#x4ECA;&#x5929;&#x7684;&#x5185;&#x5BB9;&#x4E0D;&#x6D89;&#x53CA;&#x8FD9;&#x4E00;&#x9879;</li>
</ol>
<h3 id="6-1-&#x9700;&#x8981;&#x9884;&#x52A0;&#x8F7D;&#x4EC0;&#x4E48;"><a href="#6-1-&#x9700;&#x8981;&#x9884;&#x52A0;&#x8F7D;&#x4EC0;&#x4E48;" class="headerlink" title="6.1 &#x9700;&#x8981;&#x9884;&#x52A0;&#x8F7D;&#x4EC0;&#x4E48;"></a>6.1 &#x9700;&#x8981;&#x9884;&#x52A0;&#x8F7D;&#x4EC0;&#x4E48;</h3><p>&#x76F4;&#x63A5;&#x770B;&#x56FE;&#xFF0C;&#x8FD9;&#x4E2A;&#x662F;&#x9996;&#x9875;&#x56DB;&#x4E2A;&#x5B50;Tab Fragment&#x7684;&#x57FA;&#x7C7B;&#x7684;layout&#xFF0C;&#x56E0;&#x4E3A;&#x67D0;&#x4E9B;&#x4E1C;&#x897F;&#x8BBE;&#x8BA1;&#x7684;&#x4E0D;&#x5408;&#x7406;&#xFF0C;&#x5BFC;&#x81F4;&#x5C42;&#x7EA7;&#x662F;&#x975E;&#x5E38;&#x7684;&#x6DF1;&#xFF0C;&#x76F4;&#x63A5;&#x5BFC;&#x81F4;&#x4E86;&#x9996;&#x9875;&#x4E0A;&#x7684;&#x4E09;&#x4E2A;tab&#x52A0;&#x4E0A;FeedMainFragment&#x81EA;&#x8EAB;&#xFF0C;&#x5149;&#x5C06;&#x8FD9;&#x4E2A;View inflate&#x51FA;&#x6765;&#x7684;&#x65F6;&#x95F4;&#x5C31;&#x975E;&#x5E38;&#x957F;&#x3002;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x8003;&#x8651;&#x5728;&#x5B50;&#x7EBF;&#x7A0B;&#x4E2D;&#x63D0;&#x524D;inflate layout</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/3a5d460119094182cda0858e8bab245704fa0278b52296a929ca8cfaddf5e137" alt></p>
<h3 id="6-2-&#x4FEE;&#x6539;AsyncLayoutInflater"><a href="#6-2-&#x4FEE;&#x6539;AsyncLayoutInflater" class="headerlink" title="6.2 &#x4FEE;&#x6539;AsyncLayoutInflater"></a>6.2 &#x4FEE;&#x6539;AsyncLayoutInflater</h3><p>&#x5B98;&#x65B9;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x7C7B;&#xFF0C;&#x53EF;&#x4EE5;&#x6765;&#x8FDB;&#x884C;&#x5F02;&#x6B65;&#x7684;inflate&#xFF0C;&#x4F46;&#x662F;&#x6709;&#x4E24;&#x4E2A;&#x7F3A;&#x70B9;&#xFF1A;</p>
<ol>
<li>&#x6BCF;&#x6B21;&#x90FD;&#x8981;&#x73B0;&#x573A;new&#x4E00;&#x4E2A;&#x51FA;&#x6765;</li>
<li>&#x5F02;&#x6B65;&#x52A0;&#x8F7D;&#x7684;view&#x53EA;&#x80FD;&#x901A;&#x8FC7;callback&#x56DE;&#x8C03;&#x624D;&#x80FD;&#x83B7;&#x5F97;&#xFF08;&#x6B7B;&#x7A74;&#xFF09;</li>
</ol>
<p>&#x56E0;&#x6B64;&#x51B3;&#x5B9A;&#x81EA;&#x5DF1;&#x5C01;&#x88C5;&#x4E00;&#x4E2A;AsyncInflateManager&#xFF0C;&#x5185;&#x90E8;&#x4F7F;&#x7528;&#x7EBF;&#x7A0B;&#x6C60;&#xFF0C;&#x4E14;&#x5BF9;&#x4E8E;inflate&#x5B8C;&#x6210;&#x7684;View&#x6709;&#x4E00;&#x5957;&#x7F13;&#x5B58;&#x673A;&#x5236;&#x3002;&#x800C;&#x5176;&#x4E2D;&#x6700;&#x6838;&#x5FC3;&#x7684;LayoutInflater&#x5219;&#x76F4;&#x63A5;copy&#x51FA;&#x6765;&#x5C31;&#x597D;&#x3002;</p>
<p>&#x5148;&#x770B;AsyncInflateManager&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x76F4;&#x63A5;&#x5C06;&#x4EE3;&#x7801;copy&#x8FDB;&#x6765;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x622A;&#x56FE;&#x4E86;&#xFF0C;&#x8FD9;&#x6837;&#x4F60;&#x4EEC;&#x5982;&#x679C;&#x60F3;&#x7528;&#x5176;&#x4E2D;&#x90E8;&#x5206;&#x4E1C;&#x897F;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;copy&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line">typescript&#x590D;&#x5236;&#x4EE3;&#x7801;/**</span><br><span class="line"> * @author zoutao</span><br><span class="line"> * &lt;p&gt;</span><br><span class="line"> * &#x7528;&#x6765;&#x63D0;&#x4F9B;&#x5B50;&#x7EBF;&#x7A0B;inflate view&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x907F;&#x514D;&#x67D0;&#x4E2A;view&#x5C42;&#x7EA7;&#x592A;&#x6DF1;&#x592A;&#x590D;&#x6742;&#xFF0C;&#x4E3B;&#x7EBF;&#x7A0B;inflate&#x4F1A;&#x8017;&#x65F6;&#x5F88;&#x957F;&#xFF0C;</span><br><span class="line"> * &#x5B9E;&#x5C31;&#x662F;&#x5BF9; AsyncLayoutInflater&#x8FDB;&#x884C;&#x4E86;&#x62BD;&#x53D6;&#x548C;&#x5C01;&#x88C5;</span><br><span class="line"> */</span><br><span class="line">public class AsyncInflateManager {</span><br><span class="line">    private static AsyncInflateManager sInstance;</span><br><span class="line">    private ConcurrentHashMap&lt;String, AsyncInflateItem&gt; mInflateMap; //&#x4FDD;&#x5B58;inflateKey&#x4EE5;&#x53CA;InflateItem&#xFF0C;&#x91CC;&#x9762;&#x5305;&#x542B;&#x6240;&#x6709;&#x8981;&#x8FDB;&#x884C;inflate&#x7684;&#x4EFB;&#x52A1;</span><br><span class="line">    private ConcurrentHashMap&lt;String, CountDownLatch&gt; mInflateLatchMap;</span><br><span class="line">    private ExecutorService mThreadPool; //&#x7528;&#x6765;&#x8FDB;&#x884C;inflate&#x5DE5;&#x4F5C;&#x7684;&#x7EBF;&#x7A0B;&#x6C60;</span><br><span class="line"></span><br><span class="line">    private AsyncInflateManager() {</span><br><span class="line">        mThreadPool = new ThreadPoolExecutor(4, 4, 0, TimeUnit.MILLISECONDS, new LinkedBlockingDeque&lt;Runnable&gt;());</span><br><span class="line">        mInflateMap = new ConcurrentHashMap&lt;&gt;();</span><br><span class="line">        mInflateLatchMap = new ConcurrentHashMap&lt;&gt;();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public static AsyncInflateManager getInstance() {</span><br><span class="line">        &#x5355;&#x4F8B;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x7528;&#x6765;&#x83B7;&#x5F97;&#x5F02;&#x6B65;inflate&#x51FA;&#x6765;&#x7684;view</span><br><span class="line">     *</span><br><span class="line">     * @param context</span><br><span class="line">     * @param layoutResId &#x9700;&#x8981;&#x62FF;&#x7684;layoutId</span><br><span class="line">     * @param parent      container</span><br><span class="line">     * @param inflateKey  &#x6BCF;&#x4E00;&#x4E2A;View&#x4F1A;&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;inflateKey&#xFF0C;&#x56E0;&#x4E3A;&#x53EF;&#x80FD;&#x8BB8;&#x591A;&#x5730;&#x65B9;&#x7528;&#x7684;&#x540C;&#x4E00;&#x4E2A; layout&#xFF0C;&#x4F46;&#x662F;&#x9700;&#x8981;inflate&#x591A;&#x4E2A;&#xFF0C;&#x7528;InflateKey&#x8FDB;&#x884C;&#x533A;&#x5206;</span><br><span class="line">     * @param inflater    &#x5916;&#x90E8;&#x4F20;&#x8FDB;&#x6765;&#x7684;inflater&#xFF0C;&#x5916;&#x9762;&#x5982;&#x679C;&#x6709;inflater&#xFF0C;&#x4F20;&#x8FDB;&#x6765;&#xFF0C;&#x7528;&#x6765;&#x8FDB;&#x884C;&#x53EF;&#x80FD;&#x7684;SyncInflate&#xFF0C;</span><br><span class="line">     * @return &#x6700;&#x540E;inflate&#x51FA;&#x6765;&#x7684;view</span><br><span class="line">     */</span><br><span class="line">    @UiThread</span><br><span class="line">    @NonNull</span><br><span class="line">    public View getInflatedView(Context context, int layoutResId, @Nullable ViewGroup parent, String inflateKey, @NonNull LayoutInflater inflater) {</span><br><span class="line">        if (!TextUtils.isEmpty(inflateKey) &amp;&amp; mInflateMap.containsKey(inflateKey)) {</span><br><span class="line">            AsyncInflateItem item = mInflateMap.get(inflateKey);</span><br><span class="line">            CountDownLatch latch = mInflateLatchMap.get(inflateKey);</span><br><span class="line">            if (item != null) {</span><br><span class="line">                View resultView = item.inflatedView;</span><br><span class="line">                if (resultView != null) {</span><br><span class="line">                    //&#x62FF;&#x5230;&#x4E86;view&#x76F4;&#x63A5;&#x8FD4;&#x56DE;</span><br><span class="line">                    removeInflateKey(inflateKey);</span><br><span class="line">                    replaceContextForView(resultView, context);</span><br><span class="line">                    return resultView;</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                if (item.isInflating() &amp;&amp; latch != null) {</span><br><span class="line">                    //&#x6CA1;&#x62FF;&#x5230;view&#xFF0C;&#x4F46;&#x662F;&#x5728;inflate&#x4E2D;&#xFF0C;&#x7B49;&#x5F85;&#x8FD4;&#x56DE;</span><br><span class="line">                    try {</span><br><span class="line">                        latch.wait();</span><br><span class="line">                    } catch (InterruptedException e) {</span><br><span class="line">                        Log.e(TAG, e.getMessage(), e);</span><br><span class="line">                    }</span><br><span class="line">                    removeInflateKey(inflateKey);</span><br><span class="line">                    if (resultView != null) {</span><br><span class="line">                        replaceContextForView(resultView, context);</span><br><span class="line">                        return resultView;</span><br><span class="line">                    }</span><br><span class="line"></span><br><span class="line">                }</span><br><span class="line">                //&#x5982;&#x679C;&#x8FD8;&#x6CA1;&#x5F00;&#x59CB;inflate&#xFF0C;&#x5219;&#x8BBE;&#x7F6E;&#x4E3A;false&#xFF0C;UI&#x7EBF;&#x7A0B;&#x8FDB;&#x884C;inflate</span><br><span class="line">                item.setCancelled(true);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        //&#x62FF;&#x5F02;&#x6B65;inflate&#x7684;View&#x5931;&#x8D25;&#xFF0C;UI&#x7EBF;&#x7A0B;inflate</span><br><span class="line">        return inflater.inflate(layoutResId, parent, false);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * inflater&#x521D;&#x59CB;&#x5316;&#x65F6;&#x662F;&#x4F20;&#x8FDB;&#x6765;&#x7684;application&#xFF0C;inflate&#x51FA;&#x6765;&#x7684;view&#x7684;context&#x6CA1;&#x6CD5;&#x7528;&#x6765;startActivity&#xFF0C;</span><br><span class="line">     * &#x56E0;&#x6B64;&#x7528;MutableContextWrapper&#x8FDB;&#x884C;&#x5305;&#x88C5;&#xFF0C;&#x540E;&#x7EED;&#x8FDB;&#x884C;&#x66FF;&#x6362;</span><br><span class="line">     */</span><br><span class="line">    private void replaceContextForView(View inflatedView, Context context) {</span><br><span class="line">        if (inflatedView == null || context == null) {</span><br><span class="line">            return;</span><br><span class="line">        }</span><br><span class="line">        Context cxt = inflatedView.getContext();</span><br><span class="line">        if (cxt instanceof MutableContextWrapper) {</span><br><span class="line">            ((MutableContextWrapper) cxt).setBaseContext(context);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @UiThread</span><br><span class="line">    private void asyncInflate(Context context, AsyncInflateItem item) {</span><br><span class="line">        if (item == null || item.layoutResId == 0 || mInflateMap.containsKey(item.inflateKey) || item.isCancelled() || item.isInflating()) {</span><br><span class="line">            return;</span><br><span class="line">        }</span><br><span class="line">        onAsyncInflateReady(item);</span><br><span class="line">        inflateWithThreadPool(context, item);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private void onAsyncInflateReady(AsyncInflateItem item) {</span><br><span class="line">       ...</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private void onAsyncInflateStart(AsyncInflateItem item) {</span><br><span class="line">        ...</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private void onAsyncInflateEnd(AsyncInflateItem item, boolean success) {</span><br><span class="line">        item.setInflating(false);</span><br><span class="line">        CountDownLatch latch = mInflateLatchMap.get(item.inflateKey);</span><br><span class="line">        if (latch != null) {</span><br><span class="line">            //&#x91CA;&#x653E;&#x9501;</span><br><span class="line">            latch.countDown();</span><br><span class="line">        }</span><br><span class="line">        ...</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private void removeInflateKey(String inflateKey) {</span><br><span class="line">        ...</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private void inflateWithThreadPool(Context context, AsyncInflateItem item) {</span><br><span class="line">        mThreadPool.execute(new Runnable() {</span><br><span class="line">            @Override</span><br><span class="line">            public void run() {</span><br><span class="line">                if (!item.isInflating() &amp;&amp; !item.isCancelled()) {</span><br><span class="line">                    try {</span><br><span class="line">                        onAsyncInflateStart(item);</span><br><span class="line">                        item.inflatedView = new BasicInflater(context).inflate(item.layoutResId, item.parent, false);</span><br><span class="line">                        onAsyncInflateEnd(item, true);</span><br><span class="line">                    } catch (RuntimeException e) {</span><br><span class="line">                        Log.e(TAG, &quot;Failed to inflate resource in the background! Retrying on the UI thread&quot;, e);</span><br><span class="line">                        onAsyncInflateEnd(item, false);</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * copy from AsyncLayoutInflater - actual inflater</span><br><span class="line">     */</span><br><span class="line">    private static class BasicInflater extends LayoutInflater {</span><br><span class="line">        private static final String[] sClassPrefixList = new String[]{&quot;android.widget.&quot;, &quot;android.webkit.&quot;, &quot;android.app.&quot;};</span><br><span class="line"></span><br><span class="line">        BasicInflater(Context context) {</span><br><span class="line">            super(context);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        public LayoutInflater cloneInContext(Context newContext) {</span><br><span class="line">            return new BasicInflater(newContext);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        protected View onCreateView(String name, AttributeSet attrs) throws ClassNotFoundException {</span><br><span class="line">            for (String prefix : sClassPrefixList) {</span><br><span class="line">                try {</span><br><span class="line">                    View view = this.createView(name, prefix, attrs);</span><br><span class="line">                    if (view != null) {</span><br><span class="line">                        return view;</span><br><span class="line">                    }</span><br><span class="line">                } catch (ClassNotFoundException ignored) {</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            return super.onCreateView(name, attrs);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x91CC;&#x6211;&#x7528;&#x4E00;&#x4E2A;AsyncInflateItem&#x6765;&#x7BA1;&#x7406;&#x4E00;&#x6B21;&#x8981;inflate&#x7684;&#x4E00;&#x4E2A;&#x5355;&#x4F4D;&#xFF0C;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">arduino&#x590D;&#x5236;&#x4EE3;&#x7801;/**</span><br><span class="line"> * @author zoutao</span><br><span class="line"> */</span><br><span class="line">public class AsyncInflateItem {</span><br><span class="line">    String inflateKey;</span><br><span class="line">    int layoutResId;</span><br><span class="line">    ViewGroup parent;</span><br><span class="line">    OnInflateFinishedCallback callback;</span><br><span class="line">    View inflatedView;</span><br><span class="line"></span><br><span class="line">    private boolean cancelled;</span><br><span class="line">    private boolean inflating;</span><br><span class="line"></span><br><span class="line">    //&#x8FD8;&#x6709;&#x4E00;&#x4E9B;set get&#x65B9;&#x6CD5;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4EE5;&#x53CA;&#x6700;&#x540E;inflate&#x7684;&#x56DE;&#x8C03;callback&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">csharp&#x590D;&#x5236;&#x4EE3;&#x7801;public interface OnInflateFinishedCallback {</span><br><span class="line">    void onInflateFinished(AsyncInflateItem result);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x7ECF;&#x8FC7;&#x8FD9;&#x6837;&#x7684;&#x5C01;&#x88C5;&#xFF0C;&#x5916;&#x9762;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5728;Application&#x7684;onCreate&#x4E2D;&#xFF0C;&#x5F00;&#x59CB;&#x5F02;&#x6B65;&#x7684;inflate view&#x7684;&#x4EFB;&#x52A1;&#x3002;&#x8C03;&#x7528;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;AsyncInflateUtil.startTask();</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author zoutao</span><br><span class="line"> */</span><br><span class="line">public class AsyncInflateUtil {</span><br><span class="line">    public static void startTask() {</span><br><span class="line">        Context context = new MutableContextWrapper(CommonContext.getApplication());</span><br><span class="line">        AsyncInflateManager.getInstance().asyncInflateViews(context,</span><br><span class="line">                new AsyncInflateItem(InflateKey.TAB_1_CONTAINER_FRAGMENT, R.layout.fragment_main),</span><br><span class="line">                new AsyncInflateItem(InflateKey.SUB_TAB_1_FRAGMENT, R.layout.fragment_load_list),</span><br><span class="line">                new AsyncInflateItem(InflateKey.SUB_TAB_2_FRAGMENT, R.layout.fragment_load_list),</span><br><span class="line">                new AsyncInflateItem(InflateKey.SUB_TAB_3_FRAGMENT, R.layout.fragment_load_list),</span><br><span class="line">                new AsyncInflateItem(InflateKey.SUB_TAB_4_FRAGMENT, R.layout.fragment_load_list));</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public class InflateKey {</span><br><span class="line">        public static final String TAB_1_CONTAINER_FRAGMENT = &quot;tab1&quot;;</span><br><span class="line">        public static final String SUB_TAB_1_FRAGMENT = &quot;sub1&quot;;</span><br><span class="line">        public static final String SUB_TAB_2_FRAGMENT = &quot;sub2&quot;;</span><br><span class="line">        public static final String SUB_TAB_3_FRAGMENT = &quot;sub3&quot;;</span><br><span class="line">        public static final String SUB_TAB_4_FRAGMENT = &quot;sub4&quot;;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><strong>&#x6CE8;&#x610F;&#xFF1A;&#x8FD9;&#x91CC;&#x4F1A;&#x6709;&#x4E00;&#x4E2A;&#x5751;&#x3002;&#x5C31;&#x662F;&#x5728;Application&#x7684;onCreate&#x4E2D;&#xFF0C;&#x80FD;&#x62FF;&#x5230;&#x7684;Context&#x53EA;&#x6709;Application&#xFF0C;&#x8FD9;&#x6837;inflate&#x7684;View&#xFF0C;View&#x6301;&#x6709;&#x7684;Context&#x5C31;&#x662F;Application&#xFF0C;&#x8FD9;&#x4F1A;&#x5BFC;&#x81F4;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#x3002;</strong></p>
<p>&#x5982;&#x679C;&#x7528;View.getContext()&#x8FD9;&#x4E2A;context&#x53BB;&#x8FDB;&#x884C;Activity&#x7684;&#x8DF3;&#x8F6C;&#x5C31;&#x4F1A;&#x3002;&#x3002;&#x629B;&#x5F02;&#x5E38;</p>
<blockquote>
<p>Calling startActivity() from outside of an Activity context requires the FLAG_ACTIVITY_NEW_TASK flag. Is this really what you want?</p>
</blockquote>
<p>&#x800C;&#x5982;&#x679C;&#x60F3;&#x8981;&#x4F20;&#x5165;Activity&#x6765;&#x521B;&#x5EFA;LayoutInflater&#xFF0C;&#x65F6;&#x673A;&#x53C8;&#x592A;&#x665A;&#x3002;&#x4F17;&#x6240;&#x5468;&#x77E5;&#xFF0C;Context&#x662F;&#x4E00;&#x4E2A;&#x62BD;&#x8C61;&#x7C7B;&#xFF0C;&#x5B9E;&#x73B0;&#x5B83;&#x7684;&#x5305;&#x88C5;&#x7C7B;&#x5C31;&#x662F;ContextWrapper&#xFF0C;&#x800C;Activity&#x3001;Appcation&#x7B49;&#x90FD;&#x662F;ContextWrapper&#x7684;&#x5B50;&#x7C7B;&#xFF0C;&#x7136;&#x800C;&#xFF0C;ContextWrapper&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x795E;&#x5947;&#x7684;&#x5B50;&#x7C7B;&#xFF0C;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">scala&#x590D;&#x5236;&#x4EE3;&#x7801;package android.content;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Special version of {@link ContextWrapper} that allows the base context to</span><br><span class="line"> * be modified after it is initially set.</span><br><span class="line"> */</span><br><span class="line">public class MutableContextWrapper extends ContextWrapper {</span><br><span class="line">    public MutableContextWrapper(Context base) {</span><br><span class="line">        super(base);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * Change the base context for this ContextWrapper. All calls will then be</span><br><span class="line">     * delegated to the base context.  Unlike ContextWrapper, the base context</span><br><span class="line">     * can be changed even after one is already set.</span><br><span class="line">     * </span><br><span class="line">     * @param base The new base context for this wrapper.</span><br><span class="line">     */</span><br><span class="line">    public void setBaseContext(Context base) {</span><br><span class="line">        mBase = base;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="6-3-&#x88C5;&#x9970;&#x5668;&#x6A21;&#x5F0F;"><a href="#6-3-&#x88C5;&#x9970;&#x5668;&#x6A21;&#x5F0F;" class="headerlink" title="6.3 &#x88C5;&#x9970;&#x5668;&#x6A21;&#x5F0F;"></a>6.3 &#x88C5;&#x9970;&#x5668;&#x6A21;&#x5F0F;</h3><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;Android&#x4E0A;Context&#x7684;&#x8BBE;&#x8BA1;&#x91C7;&#x7528;&#x4E86;&#x88C5;&#x9970;&#x5668;&#x6A21;&#x5F0F;&#xFF0C;&#x88C5;&#x9970;&#x5668;&#x6A21;&#x5F0F;&#x6781;&#x5927;&#x7A0B;&#x5EA6;&#x7684;&#x63D0;&#x9AD8;&#x4E86;&#x7075;&#x6D3B;&#x6027;&#x3002;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x5BF9;&#x6211;&#x6700;&#x5927;&#x7684;&#x611F;&#x53D7;&#x5C31;&#x662F;&#xFF0C;<strong>&#x5F53;&#x5B98;&#x65B9;&#x6CA1;&#x6709;&#x63D0;&#x4F9B;MutableContextWrapper&#x8FD9;&#x4E2A;&#x7C7B;&#x65F6;&#xFF0C;&#x5176;&#x5B9E;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x4E5F;&#x5B8C;&#x5168;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x540C;&#x6837;&#x7684;&#x65B9;&#x5F0F;&#x53BB;&#x8FDB;&#x884C;&#x5B9E;&#x73B0;&#x3002;&#x601D;&#x7EF4;&#x4E00;&#x5B9A;&#x8981;&#x7075;&#x6D3B;~</strong></p>
<h2 id="&#x4E03;&#x3001;&#x603B;&#x7ED3;"><a href="#&#x4E03;&#x3001;&#x603B;&#x7ED3;" class="headerlink" title="&#x4E03;&#x3001;&#x603B;&#x7ED3;"></a>&#x4E03;&#x3001;&#x603B;&#x7ED3;</h2><p>&#x5E38;&#x89C1;&#x7684;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x4F18;&#x5316;&#x7684;&#x65B9;&#x6848;&#x6709;&#xFF1A;</p>
<ul>
<li>&#x6570;&#x636E;&#x61D2;&#x52A0;&#x8F7D;&#xFF0C;&#x6BD4;&#x5982;Fragment&#x7528;&#x6237;&#x4E0D;&#x53EF;&#x89C1;&#x65F6;&#x4E0D;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x7684;&#x83B7;&#x53D6;</li>
<li>&#x4F18;&#x5316;&#x5E03;&#x5C40;&#x5C42;&#x7EA7;&#xFF0C;&#x51CF;&#x5C11;&#x9996;&#x6B21;inflate layout&#x7684;&#x8017;&#x65F6;</li>
<li>&#x5C06;&#x7EDD;&#x5927;&#x90E8;&#x5206;sdk&#x7684;&#x521D;&#x59CB;&#x5316;&#x653E;&#x7EBF;&#x7A0B;&#x6C60;&#x4E2D;&#x8FD0;&#x884C;</li>
<li>&#x80FD;&#x7528;ViewStub&#x7684;&#x5C31;&#x7528;ViewStub&#xFF0C;&#x6309;&#x9700;&#x52A0;&#x8F7D;layout</li>
<li>&#x4E00;&#x5B9A;&#x8981;&#x5C3D;&#x91CF;&#x907F;&#x514D;&#x542F;&#x52A8;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x51FA;&#x73B0;&#x7684;&#x4E3B;&#x7EBF;&#x7A0B;&#x53BB;unpack&#x4E00;&#x4E9B;&#x5168;&#x5C40;&#x914D;&#x7F6E;&#x7684;&#x6570;&#x636E;</li>
<li>&#x4E0D;&#x4EC5;&#x4EC5;&#x662F;&#x4E09;&#x65B9;&#x5E93;&#x53EF;&#x4EE5;&#x653E;&#x5B50;&#x7EBF;&#x7A0B;&#x8FDB;&#x884C;&#xFF0C;&#x4E00;&#x4E9B;&#x65F6;&#x6548;&#x6027;&#x8981;&#x6C42;&#x6CA1;&#x90A3;&#x4E48;&#x9AD8;&#x7684;&#x903B;&#x8F91;&#x90FD;&#x53EF;&#x4EE5;&#x653E;&#x5B50;&#x7EBF;&#x7A0B;</li>
</ul>
<p>&#x8FD9;&#x4E9B;&#x90FD;&#x53EF;&#x4EE5;&#x5728;&#x7F51;&#x4E0A;&#x627E;&#x5230;&#x5927;&#x91CF;&#x7684;&#x6587;&#x7AE0;&#x4EE5;&#x53CA;&#x5404;&#x4E2A;&#x5927;&#x4F6C;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x6848;&#x3002;</p>
<p>&#x9996;&#x5148;&#xFF0C;&#x4F18;&#x5316;&#x7684;&#x5927;&#x65B9;&#x5411;&#x80AF;&#x5B9A;&#x5148;&#x5B9A;&#x597D;&#xFF1A;</p>
<ol>
<li>&#x61D2;&#x52A0;&#x8F7D;</li>
<li>&#x9884;&#x52A0;&#x8F7D;</li>
</ol>
<p>&#x61D2;&#x52A0;&#x8F7D;&#xFF1A;</p>
<ul>
<li>&#x9996;&#x5C4F;&#x52A0;&#x8F7D;&#x65F6;&#xFF0C;&#x53EA;&#x5F80;ViewPager&#x4E2D;&#x585E;&#x5165;&#x9ED8;&#x8BA4;&#x8981;&#x5C55;&#x793A;&#x7684;tab&#xFF0C;&#x5269;&#x4F59;&#x7684;tab&#x7528;&#x7A7A;&#x7684;&#x5360;&#x4F4D;Fragment&#x4EE3;&#x66FF;</li>
<li>&#x5F53;&#x7528;&#x6237;&#x6ED1;&#x52A8;&#x5230;&#x5176;&#x4ED6;tab&#x65F6;&#xFF0C;&#x6BD4;&#x5982;&#x6ED1;&#x52A8;&#x5230;&#x597D;&#x53CB;&#x52A8;&#x6001;tab&#xFF0C;&#x5C31;&#x7528;FriendFragment&#x628A;&#x5F53;&#x524D;&#x7684;EmptyPlaceholderFragment&#x66FF;&#x6362;&#x6389;&#xFF0C;&#x7136;&#x540E;adapter.notifyDataSetChanged</li>
<li>&#x5F53;&#x56DB;&#x4E2A;Tab&#x5168;&#x90E8;&#x66FF;&#x6362;&#x4E3A;&#x6570;&#x636E;tab&#x65F6;&#xFF0C;&#x6E05;&#x9664;&#x6389;EmptyFragment&#x7684;&#x5F15;&#x7528;&#xFF0C;&#x91CA;&#x653E;&#x5185;&#x5B58;</li>
</ul>
<p>&#x9884;&#x52A0;&#x8F7D;&#xFF1A;</p>
<ul>
<li>Application onCreate&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x9488;&#x5BF9;&#x540E;&#x7EED;&#x6240;&#x6709;&#x7684;Fragment&#xFF0C;&#x5728;&#x5B50;&#x7EBF;&#x7A0B;&#x4E2D;&#x5C06;Layout&#x5148;&#x7ED9;inflate&#x51FA;&#x6765;</li>
<li>&#x9488;&#x5BF9;inflate&#x5B8C;&#x6210;&#x7684;View&#x52A0;&#x5165;&#x4E00;&#x5957;&#x7F13;&#x5B58;&#x7684;&#x5B58;&#x53D6;&#x673A;&#x5236;&#xFF0C;&#x4EE5;&#x53CA;&#x7B49;&#x5F85;&#x673A;&#x5236;</li>
<li>&#x5982;&#x679C;&#x6B63;&#x5728;inflate&#xFF0C;&#x5219;&#x8FDB;&#x884C;&#x963B;&#x585E;&#x7B49;&#x5F85;</li>
<li>&#x5982;&#x679C;&#x5DF2;&#x7ECF;inflate&#x5B8C;&#x6210;&#x4E86;&#xFF0C;&#x53D6;&#x51FA;view&#xFF0C;&#x5E76;&#x91CA;&#x653E;&#x7F13;&#x5B58;&#x5BF9;&#x4E8E;View&#x7684;&#x5F15;&#x7528;</li>
<li>&#x5982;&#x679C;&#x8FD8;&#x6CA1;&#x6709;&#x5F00;&#x59CB;Inflate&#xFF0C;&#x5219;&#x5728;UI&#x7EBF;&#x7A0B;&#x76F4;&#x63A5;&#x8FDB;&#x884C;inflate</li>
</ul>
<p><strong>&#x8FD9;&#x4E9B;&#x65B9;&#x6848;&#x4E0D;&#x4E00;&#x5B9A;&#x975E;&#x5E38;&#x597D;&#x4F7F;&#xFF0C;&#x6240;&#x4EE5;&#x4EC5;&#x4F9B;&#x53C2;&#x8003;<del>~</del></strong></p>
<p>&#x4ECE;ContextWrapper&#x3001;MutableContextWrapper&#x7C7B;&#x7684;&#x8BBE;&#x8BA1;&#x4E2D;&#x5B66;&#x5230;&#x4E86;  &#x2193;</p>
<h2 id="&#x5199;&#x4EE3;&#x7801;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x9996;&#x5148;&#x8981;&#x8FDB;&#x884C;&#x8BBE;&#x8BA1;&#xFF0C;&#x9009;&#x7528;&#x6700;&#x5408;&#x9002;&#x7684;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#xFF0C;&#x8FD9;&#x6837;&#x540E;&#x7EED;&#x8D5A;&#x5230;&#x7684;&#x8FDC;&#x8FDC;&#x5927;&#x4E8E;&#x5199;&#x4E00;&#x4E2A;&#x6587;&#x6863;&#x3001;&#x60F3;&#x4E00;&#x4E2A;&#x8BBE;&#x8BA1;&#x6240;&#x8017;&#x8D39;&#x7684;&#x65F6;&#x95F4;&#x548C;&#x8111;&#x529B;&#x6210;&#x672C;"><a href="#&#x5199;&#x4EE3;&#x7801;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x9996;&#x5148;&#x8981;&#x8FDB;&#x884C;&#x8BBE;&#x8BA1;&#xFF0C;&#x9009;&#x7528;&#x6700;&#x5408;&#x9002;&#x7684;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#xFF0C;&#x8FD9;&#x6837;&#x540E;&#x7EED;&#x8D5A;&#x5230;&#x7684;&#x8FDC;&#x8FDC;&#x5927;&#x4E8E;&#x5199;&#x4E00;&#x4E2A;&#x6587;&#x6863;&#x3001;&#x60F3;&#x4E00;&#x4E2A;&#x8BBE;&#x8BA1;&#x6240;&#x8017;&#x8D39;&#x7684;&#x65F6;&#x95F4;&#x548C;&#x8111;&#x529B;&#x6210;&#x672C;" class="headerlink" title="&#x5199;&#x4EE3;&#x7801;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x9996;&#x5148;&#x8981;&#x8FDB;&#x884C;&#x8BBE;&#x8BA1;&#xFF0C;&#x9009;&#x7528;&#x6700;&#x5408;&#x9002;&#x7684;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#xFF0C;&#x8FD9;&#x6837;&#x540E;&#x7EED;&#x8D5A;&#x5230;&#x7684;&#x8FDC;&#x8FDC;&#x5927;&#x4E8E;&#x5199;&#x4E00;&#x4E2A;&#x6587;&#x6863;&#x3001;&#x60F3;&#x4E00;&#x4E2A;&#x8BBE;&#x8BA1;&#x6240;&#x8017;&#x8D39;&#x7684;&#x65F6;&#x95F4;&#x548C;&#x8111;&#x529B;&#x6210;&#x672C;"></a>&#x5199;&#x4EE3;&#x7801;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x9996;&#x5148;&#x8981;&#x8FDB;&#x884C;&#x8BBE;&#x8BA1;&#xFF0C;&#x9009;&#x7528;&#x6700;&#x5408;&#x9002;&#x7684;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#xFF0C;&#x8FD9;&#x6837;&#x540E;&#x7EED;&#x8D5A;&#x5230;&#x7684;&#x8FDC;&#x8FDC;&#x5927;&#x4E8E;&#x5199;&#x4E00;&#x4E2A;&#x6587;&#x6863;&#x3001;&#x60F3;&#x4E00;&#x4E2A;&#x8BBE;&#x8BA1;&#x6240;&#x8017;&#x8D39;&#x7684;&#x65F6;&#x95F4;&#x548C;&#x8111;&#x529B;&#x6210;&#x672C;</h2><p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/905f443e925cc63f21af9e9cd48f947023bd31d929041aa34773936d347ad6c0" alt></p>
<p><strong>&#x6211;&#x7684;&#x7B80;&#x4E66; <a href="/external_links/f2aaac8b595386986ebb09814f5930be.html" target="blank" rel="noopener">&#x90B9;&#x554A;&#x6D9B;&#x6D9B;&#x6D9B;&#x7684;&#x7B80;&#x4E66;</a></strong></p>
<p><strong>&#x6211;&#x7684;CSDN</strong> <strong><a href="/external_links/3d7b9c9f5199f309316bc30af805c170.html" target="blank" rel="noopener">&#x90B9;&#x554A;&#x6D9B;&#x6D9B;&#x6D9B;&#x7684;CSDN</a></strong></p>
<p><strong>&#x6211;&#x7684;&#x6398;&#x91D1; <a href="/external_links/6e6ffa19872c648cc288f487cbf401dc.html" target="blank" rel="noopener">&#x90B9;&#x554A;&#x6D9B;&#x6D9B;&#x6D9B;&#x7684;&#x6398;&#x91D1;</a></strong></p>
<h2 id="&#x4F60;&#x53EF;&#x80FD;&#x611F;&#x5174;&#x8DA3;"><a href="#&#x4F60;&#x53EF;&#x80FD;&#x611F;&#x5174;&#x8DA3;" class="headerlink" title="&#x4F60;&#x53EF;&#x80FD;&#x611F;&#x5174;&#x8DA3;"></a>&#x4F60;&#x53EF;&#x80FD;&#x611F;&#x5174;&#x8DA3;</h2><p><a href="/external_links/b892305c27d5f122cffdeb3c944d003b.html" target="blank" rel="noopener">Android QUIC &#x5B9E;&#x8DF5; - &#x57FA;&#x4E8E; OKHttp &#x6269;&#x5C55;&#x51FA; Cronet &#x62E6;&#x622A;&#x5668; - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/7306692609497546752">Android&#x542F;&#x52A8;&#x4F18;&#x5316;&#x5B9E;&#x8DF5; - &#x79D2;&#x5F00;&#x7387;&#x4ECE;17%&#x63D0;&#x5347;&#x81F3;75% - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/7302982924987039796">&#x5982;&#x4F55;&#x79D1;&#x5B66;&#x7684;&#x8FDB;&#x884C;Android&#x5305;&#x4F53;&#x79EF;&#x4F18;&#x5316; - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/7297035708429598754">Android&#x7A33;&#x5B9A;&#x6027;&#xFF1A;Looper&#x515C;&#x5E95;&#x6846;&#x67B6;&#x5B9E;&#x73B0;&#x7EBF;&#x4E0A;&#x5BB9;&#x707E;&#xFF08;&#x4E8C;&#xFF09; - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/7288178532861755432">&#x57FA;&#x4E8E; Booster ASM API&#x7684;&#x914D;&#x7F6E;&#x5316; hook &#x65B9;&#x6848;&#x5C01;&#x88C5; - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/7287241480770076687">&#x8BB0; AndroidStudio Tracer&#x5DE5;&#x5177;&#x5BFC;&#x81F4;&#x7684;&#x7F16;&#x8BD1;&#x5931;&#x8D25; - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/7280864416555860003">Android &#x542F;&#x52A8;&#x4F18;&#x5316;&#x6848;&#x4F8B;-WebView&#x975E;&#x9884;&#x671F;&#x521D;&#x59CB;&#x5316;&#x6392;&#x67E5; - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/7274430147126280207">chromium-net - &#x8DDF;&#x968F; Cronet &#x7684;&#x811A;&#x6B65;&#x63A2;&#x7D22;&#x5927;&#x81F4;&#x6D41;&#x7A0B;&#xFF08;1&#xFF09; - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/7198466997288566842">Android&#x7A33;&#x5B9A;&#x6027;&#xFF1A;&#x53EF;&#x8FDC;&#x7A0B;&#x914D;&#x7F6E;&#x5316;&#x7684;Looper&#x515C;&#x5E95;&#x6846;&#x67B6; - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/7141301214523686926">&#x4E00;&#x7C7B;&#x6709;&#x8DA3;&#x7684;&#x65E0;&#x9650;&#x7F13;&#x5B58;OOM&#x73B0;&#x8C61; - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/6844903924965572615">Android - &#x4E00;&#x79CD;&#x65B0;&#x5947;&#x7684;&#x51B7;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x4F18;&#x5316;&#x601D;&#x8DEF;(Fragment&#x6781;&#x5EA6;&#x61D2;&#x52A0;&#x8F7D; + Layout&#x5B50;&#x7EBF;&#x7A0B;&#x9884;&#x52A0;&#x8F7D;) - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/6844903923745030158">Android - &#x5F7B;&#x5E95;&#x6D88;&#x706D;OOM&#x7684;&#x5B9E;&#x6218;&#x7ECF;&#x9A8C;&#x5206;&#x4EAB;&#xFF08;&#x5343;&#x5206;&#x4E4B;1.5 -&gt; &#x4E07;&#x5206;&#x4E4B;0.2&#xFF09; - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/13f852a7d40e5660b69e70945274d07f.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903923745030158.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903923745030158.html" itemprop="url">Android - 彻底消灭OOM的实战经验分享（千分之1</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-25T04:15:11+08:00">
                2019-08-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="&#x524D;&#x8A00;"><a href="#&#x524D;&#x8A00;" class="headerlink" title="&#x524D;&#x8A00;"></a>&#x524D;&#x8A00;</h3><p>&#x8FD9;&#x662F;&#x6211;&#x5728;&#x6398;&#x91D1;&#x7684;&#x7B2C;&#x4E00;&#x7BC7;&#x535A;&#x5BA2;&#x5206;&#x4EAB;&#xFF0C;&#x6700;&#x8FD1;&#x5728;&#x6398;&#x91D1;&#x4E0A;&#x770B;&#x4E86;&#x8BB8;&#x591A;&#x5927;&#x4F6C;&#x7684;&#x6587;&#x7AE0;&#xFF0C;&#x5B66;&#x5230;&#x4E86;&#x975E;&#x5E38;&#x591A;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x5B9E;&#x5728;&#x662F;&#x5FCD;&#x4E0D;&#x4F4F;&#x60F3;&#x8981;&#x628A;&#x6211;&#x4EEC;&#x5E73;&#x65F6;&#x5DE5;&#x4F5C;&#x4E2D;&#x7528;&#x5230;&#x7684;&#x4E00;&#x4E9B;&#x4F18;&#x5316;&#x65B9;&#x6848;&#x5206;&#x4EAB;&#x51FA;&#x6765;&#xFF0C;&#x5176;&#x5B9E;&#x4E5F;&#x662F;&#x4E00;&#x4E2A;&#x5927;&#x5BB6;&#x4E00;&#x8D77;&#x8BA8;&#x8BBA;&#x5B66;&#x4E60;&#x7684;&#x8FC7;&#x7A0B;&#xFF0C;&#x5E0C;&#x671B;&#x5927;&#x5BB6;&#x53EF;&#x4EE5;&#x591A;&#x591A;&#x4EA4;&#x6D41; ~ </p>
<h3 id="&#x81EA;&#x6211;&#x4ECB;&#x7ECD;"><a href="#&#x81EA;&#x6211;&#x4ECB;&#x7ECD;" class="headerlink" title="&#x81EA;&#x6211;&#x4ECB;&#x7ECD;"></a>&#x81EA;&#x6211;&#x4ECB;&#x7ECD;</h3><p>&#x7B2C;&#x4E00;&#x7BC7;&#x535A;&#x5BA2;&#xFF0C;&#x603B;&#x5F97;&#x4ECB;&#x7ECD;&#x4E0B;&#x81EA;&#x5DF1;~&#xFF0C;&#x6709;&#x6821;&#x53CB;&#x6216;&#x8005;&#x5176;&#x4ED6;&#x95F4;&#x63A5;&#x6328;&#x5F97;&#x7740;&#x8FB9;&#x7684;&#x8054;&#x7CFB;&#x7684;&#x53EF;&#x4EE5;&#x79C1;&#x804A;&#x4EA4;&#x6D41;&#xFF0C;&#x524D;1/4 -&gt; 1/3&#x4EBA;&#x751F;&#x5B9E;&#x5728;&#x6CA1;&#x5565;&#x4EA4;&#x96C6;&#x7684;&#x4E5F;&#x53EF;&#x4EE5;&#x773C;&#x719F;&#x4E00;&#x4E0B;&#x3002;&#x7956;&#x7C4D;&#x8D63;&#xFF0C;&#x5929;&#x5E9C;&#x78E8;&#x5B50;&#x6865;&#x6587;&#x7406;&#x5B66;&#x9662;&#x4E03;&#x5E74;&#x8BA1;&#x7B97;&#x673A;&#xFF0C;18&#x5E74;&#x590F;&#x5929;&#x6BD5;&#x4E1A;&#xFF0C;&#x76EE;&#x524D;&#x5728;&#x5317;&#x4EAC;&#x6D77;&#x6DC0;768&#x5DE5;&#x4F5C;&#xFF0C;&#x300C;&#x8109;&#x8109;&#x300D;&#x5E73;&#x53F0;&#x5BA2;&#x6237;&#x7AEF;&#x5F00;&#x53D1;&#x4E00;&#x679A;&#x3002;&#x559C;&#x6B22;&#x6253;&#x6E38;&#x620F;&#x5531;&#x6B4C;&#x64B8;&#x732B;&#x6B21;&#x597D;&#x6B21;&#x7684;&#xFF0C;&#x5176;&#x4ED6;&#x7684;&#x6CA1;&#x4E86;</p>
<h3 id="&#x80CC;&#x666F;"><a href="#&#x80CC;&#x666F;" class="headerlink" title="&#x80CC;&#x666F;"></a>&#x80CC;&#x666F;</h3><p>&#x5148;&#x7B80;&#x5355;&#x8BB2;&#x8BB2;&#x8DDF;oom&#x7EA0;&#x7ED3;&#x7684;&#x5386;&#x53F2;&#x5427;&#x3002;</p>
<p>&#x5728;18&#x5E74;&#x5E74;&#x5E95;&#xFF0C;&#x6211;&#x4EEC;app&#x8FDB;&#x884C;&#x4E86;&#x4E00;&#x6B21;&#x975E;&#x5E38;&#x5927;&#x7684;&#x7248;&#x672C;&#x66F4;&#x8FED;&#xFF0C;&#x56E0;&#x4E3A;&#x65F6;&#x95F4;&#x7D27;&#x6025;&#x3001;&#x4E1A;&#x52A1;&#x7E41;&#x5FD9;&#x3001;&#x4EBA;&#x6570;&#x4E5F;&#x6CA1;&#x8FBE;&#x5230;&#x53EF;&#x4EE5;&#x51D1;&#x4EBA;&#x6570;&#x53EF;&#x4EE5;&#x8BA9;&#x67D0;&#x4E9B;&#x4EBA;&#x51C6;&#x70B9;&#x4E0B;&#x73ED;&#x7684;&#x90A3;&#x79CD;&#x6570;&#x91CF;&#xFF08;&#x5404;&#x4E2A;&#x516C;&#x53F8;&#x7684;&#x5E38;&#x89C4;&#x539F;&#x56E0;&#xFF09;&#xFF0C;&#x4E1A;&#x52A1;&#x7EBF;&#x5728;&#x5BF9;&#x4E00;&#x4E9B;&#x6A21;&#x5757;&#x8FDB;&#x884C;&#x91CD;&#x6784;&#x548C;&#x5927;&#x91CF;&#x65B0;&#x9700;&#x6C42;&#x7684;&#x5F00;&#x53D1;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x8BB8;&#x8BB8;&#x591A;&#x591A;&#x7684;&#x7EC6;&#x8282;&#x6CA1;&#x6709;&#x6CE8;&#x610F;&#x5230;&#xFF0C;&#x76F4;&#x63A5;&#x5BFC;&#x81F4;&#x4E86;&#x540E;&#x9762;&#x4E00;&#x4E2A;&#x6708;&#x7684;&#x5D29;&#x6E83;&#x7387;&#x3001;OOM&#x7387;&#x731B;&#x589E;&#xFF0C; &#x4E14;&#x5C45;&#x9AD8;&#x4E0D;&#x4E0B;&#x3002;&#x5927;&#x6982;&#x5FEB;&#x5230;&#x4E86;&#x5343;&#x5206;&#x4E4B;2&#x7684;&#x8FD9;&#x4E2A;&#x6570;&#x91CF;&#x7EA7;&#xFF0C;&#x8FD9;&#x662F;&#x975E;&#x5E38;&#x975E;&#x5E38;&#x6050;&#x6016;&#x7684;&#x3002;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x82B1;&#x4E86;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#xFF0C;&#x96C6;&#x4E2D;&#x7684;fix&#x4E86;&#x4E00;&#x628A;OOM&#x7684;&#x76F8;&#x5173;&#x95EE;&#x9898;&#xFF0C;&#x4E00;&#x987F;&#x64CD;&#x4F5C;&#xFF0C;&#x76F4;&#x63A5;&#x8BA9;&#x4E3B;&#x7248;&#x672C;&#x7684;&#x5D29;&#x6E83;&#x7387;&#x6765;&#x5230;&#x4E86;&#x300C;&#x4E07;&#x5206;&#x4E4B;&#x4E00;&#x300D;&#xFF0C;OOM&#x7387;&#x6765;&#x5230;&#x4E86;&#x5341;&#x4E07;&#x5206;&#x4E4B;&#x4E00;&#x8FD9;&#x4E2A;&#x6570;&#x91CF;&#x7EA7;&#x3002;</p>
<h3 id="&#x5E72;&#x6389;OOM&#xFF0C;&#x6211;&#x4EEC;&#x5E72;&#x4E86;&#x4EC0;&#x4E48;&#xFF1F;"><a href="#&#x5E72;&#x6389;OOM&#xFF0C;&#x6211;&#x4EEC;&#x5E72;&#x4E86;&#x4EC0;&#x4E48;&#xFF1F;" class="headerlink" title="&#x5E72;&#x6389;OOM&#xFF0C;&#x6211;&#x4EEC;&#x5E72;&#x4E86;&#x4EC0;&#x4E48;&#xFF1F;"></a>&#x5E72;&#x6389;OOM&#xFF0C;&#x6211;&#x4EEC;&#x5E72;&#x4E86;&#x4EC0;&#x4E48;&#xFF1F;</h3><p>&#x4E0D;&#x8BB2;&#x5E9F;&#x8BDD;&#x4E86;&#xFF0C;&#x4E5F;&#x4E0D;&#x8BB2;&#x90A3;&#x4E9B;&#x7F51;&#x4E0A;&#x90FD;&#x53EF;&#x4EE5;&#x67E5;&#x5230;&#x7684;&#x4E00;&#x4E9B;&#x5E38;&#x89C4;&#x4F18;&#x5316;&#x65B9;&#x6CD5;&#x6765;&#x586B;&#x5B57;&#x6570;&#x4E86;&#xFF0C;&#x6211;&#x4F1A;&#x9488;&#x5BF9;&#x5982;&#x4F55;&#x53BB;fix OOM&#x8FD9;&#x4E2A;&#x76EE;&#x6807;&#xFF0C;&#x5C06;&#x601D;&#x8003;&#x7684;&#x5386;&#x7A0B;&#x4EE5;&#x53CA;&#x89E3;&#x51B3;&#x95EE;&#x9898;&#x7684;&#x529E;&#x6CD5;&#x5206;&#x4EAB;&#x51FA;&#x6765;&#xFF0C;&#x5E0C;&#x671B;&#x5176;&#x4E2D;&#x4F1A;&#x6709;&#x67D0;&#x4E00;&#x6761;&#x7ECF;&#x9A8C;&#x6B63;&#x597D;&#x51FB;&#x4E2D;&#x4F60;&#x4EEC;&#xFF0C;&#x80FD;&#x8D77;&#x5230;&#x4E00;&#x4E9B;&#x5E2E;&#x52A9;~~</p>
<p>&#x5F00;&#x5E72;&#xFF01;&#xFF01;&#x4E0B;&#x9762;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x6211;&#x4F1A;&#x7528;&#x4E00;&#x7EA7;&#x6807;&#x9898;&#x7684;&#x5B57;&#x4F53;~ &#x663E;&#x773C;&#x4E00;&#x4E9B;&#x54C8;&#x54C8;&#xFF0C;&#x6BD5;&#x7ADF;&#x524D;&#x9762;&#x90FD;&#x662F;&#x5570;&#x55E6;&#x7684;&#x5E9F;&#x8BDD;</p>
<p><img src alt></p>
<h2 id="&#x4E00;&#x3001;&#x6392;&#x67E5;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;"><a href="#&#x4E00;&#x3001;&#x6392;&#x67E5;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;" class="headerlink" title="&#x4E00;&#x3001;&#x6392;&#x67E5;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;"></a>&#x4E00;&#x3001;&#x6392;&#x67E5;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;</h2><p>&#x9996;&#x5148;fix OOM&#x7B2C;&#x4E00;&#x4EF6;&#x4E8B;&#x80AF;&#x5B9A;&#x662F;&#x6765;&#x6392;&#x67E5;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x3002;&#x60F3;&#x8981;&#x6392;&#x67E5;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#xFF0C;&#x90A3;&#x5C31;&#x7B2C;&#x4E00;&#x6B65;&#x8981;&#x5BF9;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x8FDB;&#x884C;&#x76D1;&#x63A7;&#x3001;&#x4E0A;&#x62A5;&#x3002;</p>
<h3 id="&#x6211;&#x4EEC;&#x91C7;&#x7528;&#x4E86;LeakCanary&#xFF0C;&#x5B9E;&#x73B0;&#x4E86;&#x4E00;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x7684;Service&#x7EE7;&#x627F;&#x81EA;DisplayLeakService&#xFF0C;&#x91CD;&#x5199;afterDefaultHandling&#x65B9;&#x6CD5;&#xFF0C;&#x5C06;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x4E0A;&#x62A5;&#x5230;Sentry&#x3002;"><a href="#&#x6211;&#x4EEC;&#x91C7;&#x7528;&#x4E86;LeakCanary&#xFF0C;&#x5B9E;&#x73B0;&#x4E86;&#x4E00;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x7684;Service&#x7EE7;&#x627F;&#x81EA;DisplayLeakService&#xFF0C;&#x91CD;&#x5199;afterDefaultHandling&#x65B9;&#x6CD5;&#xFF0C;&#x5C06;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x4E0A;&#x62A5;&#x5230;Sentry&#x3002;" class="headerlink" title="&#x6211;&#x4EEC;&#x91C7;&#x7528;&#x4E86;LeakCanary&#xFF0C;&#x5B9E;&#x73B0;&#x4E86;&#x4E00;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x7684;Service&#x7EE7;&#x627F;&#x81EA;DisplayLeakService&#xFF0C;&#x91CD;&#x5199;afterDefaultHandling&#x65B9;&#x6CD5;&#xFF0C;&#x5C06;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x4E0A;&#x62A5;&#x5230;Sentry&#x3002;"></a>&#x6211;&#x4EEC;&#x91C7;&#x7528;&#x4E86;LeakCanary&#xFF0C;&#x5B9E;&#x73B0;&#x4E86;&#x4E00;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x7684;Service&#x7EE7;&#x627F;&#x81EA;DisplayLeakService&#xFF0C;&#x91CD;&#x5199;afterDefaultHandling&#x65B9;&#x6CD5;&#xFF0C;&#x5C06;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x4E0A;&#x62A5;&#x5230;Sentry&#x3002;</h3><p>&#x6837;&#x4F8B;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">less&#x590D;&#x5236;&#x4EE3;&#x7801;public static class LeakReportService extends DisplayLeakService {   </span><br><span class="line">    @SuppressWarnings(&quot;ThrowableNotThrown&quot;)    </span><br><span class="line">    @Override    </span><br><span class="line">    protected void afterDefaultHandling(@NonNull HeapDump heapDump, @NonNull AnalysisResult result, @NonNull String leakInfo) {        </span><br><span class="line">        if (!result.leakFound || result.excludedLeak) {            </span><br><span class="line">            return;       </span><br><span class="line">        }        </span><br><span class="line">        try {            </span><br><span class="line">            Exception exception = new Exception(&quot;Memory Leak from LeakCanary&quot;);            </span><br><span class="line">            exception.setStackTrace(result.leakTraceAsFakeException().getStackTrace());            </span><br><span class="line">            Sentry.capture(exception);        </span><br><span class="line">        } catch (Exception e) {            </span><br><span class="line">            e.printStackTrace();        </span><br><span class="line">        }    </span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5F53;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x4E0A;&#x62A5;&#x5230;sentry&#x4E0A;&#x9762;&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x89C2;&#x5BDF;&#x662F;&#x54EA;&#x91CC;&#x6CC4;&#x6F0F;&#x7684;&#x5C31;&#x597D;&#x4E86;&#x3002;&#x901A;&#x8FC7;sentry&#x8FDB;&#x884C;&#x76D1;&#x63A7;&#x4E4B;&#x540E;&#xFF0C;&#x9879;&#x76EE;&#x91CC;&#x9762;&#x7684;&#x5927;&#x90E8;&#x5206;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x65E0;&#x5904;&#x53EF;&#x9003;~ &#xFF0C;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#xFF0C;&#x6211;&#x5C31;&#x4E0D;&#x82B1;&#x5927;&#x91CF;&#x7BC7;&#x5E45;&#x53BB;&#x8D58;&#x8FF0;&#x4E86;~&#xFF0C;&#x6211;&#x81EA;&#x5DF1;&#x770B;&#x6587;&#x7AE0;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x6700;&#x8BA8;&#x538C;&#x7BC7;&#x5E45;&#x592A;&#x957F;&#x3002;&#x3002;&#x3002;</p>
<h3 id="&#x9664;&#x4E86;LeakCanary&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x4F7F;&#x7528;&#x4E86;Android-Studio&#x81EA;&#x5E26;&#x7684;Profiler&#x5DE5;&#x5177;&#x5BF9;&#x5185;&#x5B58;&#x6709;&#x8FDB;&#x884C;&#x5206;&#x6790;&#xFF0C;&#x5305;&#x62EC;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x7684;&#x95EE;&#x9898;&#x548C;&#x5185;&#x5B58;&#x5CF0;&#x503C;&#x8FC7;&#x9AD8;&#x7684;&#x95EE;&#x9898;&#x3002;"><a href="#&#x9664;&#x4E86;LeakCanary&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x4F7F;&#x7528;&#x4E86;Android-Studio&#x81EA;&#x5E26;&#x7684;Profiler&#x5DE5;&#x5177;&#x5BF9;&#x5185;&#x5B58;&#x6709;&#x8FDB;&#x884C;&#x5206;&#x6790;&#xFF0C;&#x5305;&#x62EC;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x7684;&#x95EE;&#x9898;&#x548C;&#x5185;&#x5B58;&#x5CF0;&#x503C;&#x8FC7;&#x9AD8;&#x7684;&#x95EE;&#x9898;&#x3002;" class="headerlink" title="&#x9664;&#x4E86;LeakCanary&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x4F7F;&#x7528;&#x4E86;Android Studio&#x81EA;&#x5E26;&#x7684;Profiler&#x5DE5;&#x5177;&#x5BF9;&#x5185;&#x5B58;&#x6709;&#x8FDB;&#x884C;&#x5206;&#x6790;&#xFF0C;&#x5305;&#x62EC;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x7684;&#x95EE;&#x9898;&#x548C;&#x5185;&#x5B58;&#x5CF0;&#x503C;&#x8FC7;&#x9AD8;&#x7684;&#x95EE;&#x9898;&#x3002;"></a>&#x9664;&#x4E86;LeakCanary&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x4F7F;&#x7528;&#x4E86;Android Studio&#x81EA;&#x5E26;&#x7684;Profiler&#x5DE5;&#x5177;&#x5BF9;&#x5185;&#x5B58;&#x6709;&#x8FDB;&#x884C;&#x5206;&#x6790;&#xFF0C;&#x5305;&#x62EC;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x7684;&#x95EE;&#x9898;&#x548C;&#x5185;&#x5B58;&#x5CF0;&#x503C;&#x8FC7;&#x9AD8;&#x7684;&#x95EE;&#x9898;&#x3002;</h3><p>profiler&#x5DE5;&#x5177;&#x7684;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#x6211;&#x5C31;&#x4E0D;&#x8D58;&#x8FF0;&#x4E86;&#x5427;&#xFF0C;&#x8BB2;&#x4E00;&#x4E0B;&#x5C0F;&#x6280;&#x5DE7;&#x5427;&#x3002;</p>
<p>&#x5728;&#x6392;&#x67E5;bitmap&#x5BF9;&#x8C61;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528;Profiler&#x76F4;&#x63A5;&#x770B;java &#x5806;&#x4E2D;&#x7684;bitmap&#x5BF9;&#x8C61;&#x56FE;&#x7247;&#x7684;&#x9884;&#x89C8;~ &#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5B9A;&#x4F4D;&#x5230;&#x662F;&#x54EA;&#x91CC;&#x6CC4;&#x6F0F;&#x4E86;&#x4EE5;&#x53CA;&#x54EA;&#x91CC;bitmap&#x52A0;&#x8F7D;&#x8FC7;&#x5927;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&#x65B9;&#x6CD5;&#xFF1A;&#x627E;&#x5230;&#x5BF9;&#x5E94;&#x7684;Bitmap&#x5BF9;&#x8C61;&#xFF0C;&#x7136;&#x540E;~ &#xFF0C;&#x70B9;&#x51FB;&#x5B83;&#xFF0C;&#x7136;&#x540E;&#x5C31;&#x53EF;&#x4EE5;preview&#xFF0C;&#x5982;&#x4E0B;&#x56FE;&#xFF1A;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/adab31bc41efd6927ba7e11b252f705cbe2bc8a61cbcd38d434d7550b9be1d70" alt></p>
<h2 id="&#x4E8C;&#x3001;&#x515C;&#x5E95;&#x7B56;&#x7565;"><a href="#&#x4E8C;&#x3001;&#x515C;&#x5E95;&#x7B56;&#x7565;" class="headerlink" title="&#x4E8C;&#x3001;&#x515C;&#x5E95;&#x7B56;&#x7565;"></a>&#x4E8C;&#x3001;&#x515C;&#x5E95;&#x7B56;&#x7565;</h2><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x77E5;&#x9053;&#x7684;&#x662F;&#xFF0C;&#x5F53;&#x4E00;&#x4E2A;Activity&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x8981;&#x8D70;&#x5B8C;&#x4E86;&#xFF0C;&#x90A3;&#x5C31;&#x8BF4;&#x660E;&#x6211;&#x4EEC;&#x7EDD;&#x5927;&#x6982;&#x7387;&#x4E0D;&#x4F1A;&#x518D;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;Activity&#x5BF9;&#x8C61;&#x4E86;&#xFF0C;&#x56E0;&#x6B64;&#x5B8C;&#x5168;&#x53EF;&#x4EE5;&#x5BF9;&#x4ED6;&#x7684;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x6574;&#x4E2A;Activity&#x6CC4;&#x9732;&#x7684;&#x5F15;&#x7528;&#x8FDB;&#x884C;&#x6E05;&#x7A7A;&#xFF0C;&#x5C06;&#x5176;&#x4E2D;&#x7684;&#x4E00;&#x4E9B;&#x8D44;&#x6E90;&#x91CA;&#x653E;&#x5E72;&#x51C0;&#xFF0C;&#x6BD4;&#x5982;&#x6709;EditText&#x7684;TextWatcher&#xFF0C;&#x8FD9;&#x662F;&#x975E;&#x5E38;&#x5BB9;&#x6613;&#x6CC4;&#x9732;&#x4E14;&#x5728;&#x6211;&#x4EEC;&#x9879;&#x76EE;&#x4E2D;&#x5927;&#x91CF;&#x51FA;&#x73B0;&#x7684;&#x4E00;&#x4E2A;case&#xFF0C;&#x7136;&#x540E;&#xFF0C;&#x4E8E;&#x662F;&#x4E4E;&#x6211;&#x4EEC;&#x52A0;&#x4E0A;&#x4E86;&#x66F4;&#x52A0;&#x4E27;&#x5FC3;&#x75C5;&#x72C2;&#x7684;&#x515C;&#x5E95;&#x7B56;&#x7565;&#xFF0C;</p>
<p>&#x8BDD;&#x4E0D;&#x591A;&#x8BF4;&#xFF0C;&#x76F4;&#x63A5;&#x4E0A;&#x4EE3;&#x7801;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;private void traverse(ViewGroup root) {    </span><br><span class="line">    final int childCount = root.getChildCount();    </span><br><span class="line">    for (int i = 0; i &lt; childCount; ++i) {        </span><br><span class="line">        final View child = root.getChildAt(i);        </span><br><span class="line">        if (child instanceof ViewGroup) {            </span><br><span class="line">            child.setBackground(null);            </span><br><span class="line">            traverse((ViewGroup) child);        </span><br><span class="line">        } else {            </span><br><span class="line">            if (child != null) {                </span><br><span class="line">                child.setBackground(null);            </span><br><span class="line">            }            </span><br><span class="line">            if (child instanceof ImageView) {               </span><br><span class="line">                 ((ImageView) child).setImageDrawable(null);            </span><br><span class="line">            } else if (child instanceof EditText) {                </span><br><span class="line">                ((EditText) child).cleanWatchers();            </span><br><span class="line">            }        </span><br><span class="line">        }    </span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x6211;&#x4EEC;&#x5728;&#x57FA;&#x7C7B;BaseActivity&#x7684;onDestory()&#x65B9;&#x6CD5;&#x4E2D;&#x8FDB;&#x884C;&#x4E86;&#x4E00;&#x4E9B;&#x8D44;&#x6E90;&#x548C;&#x5F15;&#x7528;&#x7684;&#x6E05;&#x9664;</p>
<h2 id="&#x4E09;&#x3001;&#x5185;&#x5B58;&#x5CF0;&#x503C;&#x592A;&#x9AD8;"><a href="#&#x4E09;&#x3001;&#x5185;&#x5B58;&#x5CF0;&#x503C;&#x592A;&#x9AD8;" class="headerlink" title="&#x4E09;&#x3001;&#x5185;&#x5B58;&#x5CF0;&#x503C;&#x592A;&#x9AD8;"></a>&#x4E09;&#x3001;&#x5185;&#x5B58;&#x5CF0;&#x503C;&#x592A;&#x9AD8;</h2><p>&#x5728;&#x6211;&#x4EEC;&#x628A;&#x80FD;fix&#x7684;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x90FD;&#x76D8;&#x4E86;&#x4E00;&#x4FBF;&#x4E4B;&#x540E;&#xFF0C;&#x4E0A;&#x7EBF;&#x4E00;&#x5468;&#x5E76;&#x6CA1;&#x6709;&#x53D1;&#x73B0;&#x6570;&#x636E;&#x597D;&#x8F6C;&#xFF0C;OOM&#x7387;&#x8FD8;&#x662F;&#x9AD8;&#x5C45;&#x4E0D;&#x4E0B;&#xFF0C;&#x4E8E;&#x662F;&#x4E4E;&#xFF0C;&#x6211;&#x4EEC;&#x5F00;&#x59CB;&#x6000;&#x7591;&#x5185;&#x5B58;&#x5CF0;&#x503C;&#x592A;&#x9AD8;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x5728;&#x6211;&#x4EEC;&#x7684;&#x9879;&#x76EE;&#x4E2D;&#x4E0D;&#x4EC5;&#x4EC5;&#x53EA;&#x6709;native&#x7684;&#x90E8;&#x5206;&#x6A21;&#x5757;&#xFF0C;&#x8FD8;&#x6709;&#x6DF7;&#x5408;&#x7684;H5&#x3001;RN&#x6A21;&#x5757;&#xFF0C;&#x5F53;&#x8D77;&#x4E00;&#x4E2A;ReactActivity&#x7684;&#x5B9E;&#x4F8B;&#x65F6;&#xFF0C;&#x5185;&#x5B58;&#x5CF0;&#x503C;&#x603B;&#x662F;&#x6DA8;&#x7684;&#x7279;&#x522B;&#x7279;&#x522B;&#x5389;&#x5BB3;&#xFF0C;&#x540C;&#x65F6;&#x9879;&#x76EE;&#x4E2D;&#x6709;&#x6D88;&#x606F;&#x6D41;&#x7684;&#x5C55;&#x73B0;&#xFF0C;&#x5176;&#x4E2D;&#x4F1A;&#x5305;&#x542B;&#x7740;&#x5927;&#x91CF;&#x7684;&#x56FE;&#x7247;&#x5C55;&#x793A;&#xFF0C;&#x8FD9;&#x4E5F;&#x662F;&#x5BFC;&#x81F4;&#x5185;&#x5B58;&#x5CF0;&#x503C;&#x592A;&#x9AD8;&#x7684;&#x539F;&#x56E0;&#xFF08;Bitmap&#x5BF9;&#x8C61;&#x592A;&#x5927;&#x4EE5;&#x53CA;&#x592A;&#x591A;&#xFF09;</p>
<p>&#x6211;&#x4EEC;&#x53C8;&#x62FF;&#x51FA;&#x4E86;&#x8001;&#x4F19;&#x4F34; - Profiler&#xFF0C;&#x8FD9;&#x53EF;&#x662F;&#x5206;&#x6790;bitmap&#x5BF9;&#x8C61;&#x7684;&#x5229;&#x5668;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x770B;&#x5230;&#x5927;&#x5C0F;&#x3001;&#x56FE;&#x7247;&#x7684;&#x9884;&#x89C8;&#xFF0C;&#x4EE5;&#x53CA;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; go to instance&#x4E00;&#x5C42;&#x4E00;&#x5C42;&#x7684;&#x627E;&#x5230;&#x5230;&#x5E95;&#x662F;&#x8C01;&#x5728;&#x5F15;&#x7528;&#x5B83;&#x3002;&#x6BD4;&#x5982;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#xFF0C;&#x76F4;&#x63A5;&#x770B;&#x5F15;&#x7528;&#x5C31;&#x77E5;&#x9053;&#x662F;&#x88AB;Fresco&#x6240;&#x5F15;&#x7528;&#x4E86;~ &#x76F4;&#x63A5;&#x5C31;&#x5728;CountingMemoryCache&#x4E2D;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/6e90c509076c59114fce1b02067e1968c37d60b21384e6a05b1a07273d9b413f" alt></p>
<p>&#x5176;&#x5B9E;&#x6211;&#x4EEC;&#x4E3B;&#x8981;&#x8FD8;&#x662F;&#x9700;&#x8981;&#x53BB;&#x5173;&#x6CE8;Bitmap&#x5BF9;&#x8C61;&#x7684;&#x5206;&#x914D;&#x548C;&#x4E0D;&#x5408;&#x6CD5;&#x6301;&#x6709;&#x5BFC;&#x81F4;&#x7684;&#x5185;&#x5B58;&#x5CF0;&#x503C;&#x95EE;&#x9898;&#xFF0C;&#x5982;&#x679C;&#x4E00;&#x4E2A;bitmap&#x5BF9;&#x8C61;&#x6709;3M&#xFF0C;&#x7136;&#x540E;&#x6301;&#x6709;&#x4E00;&#x4E2A;&#x51E0;&#x5341;&#x4E0A;&#x767E;&#x4E2A;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#xFF0C;&#x8FD9;&#x8C01;&#x5403;&#x5F97;&#x6D88;&#xFF0C;&#x4F4E;&#x7AEF;&#x673A;&#x5668;&#x8001;&#x65E9;&#x76F4;&#x63A5;OOM&#x4E86;&#x3002;</p>
<h3 id="&#x67E5;Bitmap&#x5206;&#x914D;&#x67E5;&#x51FA;&#x6765;&#x7684;&#x95EE;&#x9898;"><a href="#&#x67E5;Bitmap&#x5206;&#x914D;&#x67E5;&#x51FA;&#x6765;&#x7684;&#x95EE;&#x9898;" class="headerlink" title="&#x67E5;Bitmap&#x5206;&#x914D;&#x67E5;&#x51FA;&#x6765;&#x7684;&#x95EE;&#x9898;"></a>&#x67E5;Bitmap&#x5206;&#x914D;&#x67E5;&#x51FA;&#x6765;&#x7684;&#x95EE;&#x9898;</h3><p>&#x76EE;&#x524D;&#x6211;&#x4EEC;&#x9879;&#x76EE;&#x4E2D;&#x7528;&#x7684;&#x56FE;&#x7247;&#x52A0;&#x8F7D;&#x6846;&#x67B6;&#x6709;&#x4E24;&#x4E2A;&#xFF0C;UIL&#x3001;Fresco&#xFF0C;UIL&#x6211;&#x5410;&#x69FD;&#x5F88;&#x4E45;&#x4E86;&#xFF0C;&#x8FD9;&#x4E48;&#x591A;&#x5E74;&#x6CA1;&#x66F4;&#x65B0;&#xFF0C;&#x8001;&#x65E9;&#x5C31;&#x8BE5;&#x6362;&#x4E86;~ </p>
<ol>
<li>UIL&#x52A0;&#x8F7D;&#x56FE;&#x7247;&#x5728;&#x6211;&#x4EEC;&#x9879;&#x76EE;&#x4E2D;&#x7684;&#x95EE;&#x9898;&#xFF1A;</li>
</ol>
<ul>
<li>&#x6CA1;&#x6709;&#x4F20;&#x5165;&#x5408;&#x9002;&#x7684;Config&#xFF0C;&#x7EDD;&#x5927;&#x591A;&#x6570;&#x5730;&#x65B9;&#x4F20;&#x7684;&#x90FD;&#x662F;ARGB_8888&#xFF0C;&#x5176;&#x5B9E;&#x6839;&#x672C;&#x6CA1;&#x5FC5;&#x8981;&#xFF0C;&#x6539;&#x6210;565&#x76F4;&#x63A5;&#x5C11;&#x4E00;&#x534A;&#x5185;&#x5B58;&#x5360;&#x7528;</li>
<li>&#x7528;UIL&#x8FDB;&#x884C;loadImage&#x65F6;&#xFF0C;&#x6CA1;&#x6709;&#x4F20;&#x5165;targetSize&#xFF0C;&#x8FD9;&#x5C31;&#x76F4;&#x63A5;&#x5BFC;&#x81F4;&#x4E86;UIL&#x5185;&#x90E8;&#x662F;&#x4EE5;&#x5C4F;&#x5E55;&#x7684;&#x5C3A;&#x5BF8;&#x53BB;Decode&#x7684;Bitmap&#x5BF9;&#x8C61;&#xFF0C;&#x60F3;&#x8C61;&#x4E00;&#x4E0B;&#xFF0C;&#x4E00;&#x4E2A;&#x7279;&#x522B;&#x5C0F;&#x7684;&#x5934;&#x50CF;View&#xFF0C;&#x6301;&#x6709;&#x7740;&#x4E00;&#x4E2A;&#x5C4F;&#x5E55;&#x5927;&#x5C0F;&#x5C3A;&#x5BF8;&#x7684;Bitmap&#x5BF9;&#x8C61;&#xFF0C;&#x8FD9;&#x8C01;&#x9876;&#x5F97;&#x4F4F;&#x3002;</li>
<li>&#x8BB8;&#x591A;&#x5730;&#x65B9;&#x4E0D;&#x9700;&#x8981;&#x5B58;&#x5185;&#x5B58;&#x7F13;&#x5B58;&#xFF0C;&#x6BD4;&#x5982;&#x95EA;&#x5C4F;&#x5E7F;&#x544A;&#x56FE;&#xFF0C;app&#x542F;&#x52A8;&#x4E4B;&#x540E;&#x5C31;&#x4E0D;&#x4F1A;&#x518D;&#x4F7F;&#x7528;&#x4E86;&#xFF0C;&#x53EF;&#x4EE5;&#x52A0;&#x8F7D;&#x7684;&#x65F6;&#x5019; memoryCache(false)</li>
<li>&#x8BB8;&#x591A;&#x5730;&#x65B9;&#x4E0D;&#x9700;&#x8981;&#x78C1;&#x76D8;&#x7F13;&#x5B58;&#xFF0C;&#x6BD4;&#x5982;&#x53D1;&#x5E03;&#x52A8;&#x6001;&#xFF0C;&#x4ECE;&#x56FE;&#x5E93;&#x4E2D;&#x9009;&#x56FE;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x518D;&#x5B58;&#x4E00;&#x4EFD;&#x78C1;&#x76D8;&#x7F13;&#x5B58;&#x4E86;&#xFF0C;&#x672C;&#x8EAB;&#x90A3;&#x4E9B;&#x56FE;&#x7247;&#x90FD;&#x662F;&#x672C;&#x5730;&#x56FE;&#x7247;&#x3002;&#x76F4;&#x63A5; diskCache(false)</li>
</ul>
<p>2.Fresco&#x5728;RN&#x9875;&#x9762;&#x4E2D;&#x4F7F;&#x7528;&#x7684;&#x95EE;&#x9898;&#xFF0C;</p>
<p>&#x901A;&#x8FC7;&#x770B;&#x4EE3;&#x7801;&#x53EF;&#x4EE5;&#x77E5;&#x9053;&#xFF0C;RN&#x9875;&#x9762;&#x9500;&#x6BC1;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8FDE;&#x5E26;&#x7740;Fresco&#x7684;&#x5185;&#x5B58;&#x7F13;&#x5B58;&#x90FD;&#x4F1A;&#x88AB;&#x6E05;&#x7A7A;&#xFF0C;</p>
<p>&#x76F4;&#x63A5;&#x4E0A;&#x4EE3;&#x7801;&#x56FE;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/d3d07ea0ca137a6da81eb768feb87c365cacadc1ff54d203e3a27b6139c2122d" alt></p>
<p>&#x4EE3;&#x7801;&#x770B;&#x5230;&#x8FD9;&#x91CC;&#xFF0C;&#x4F3C;&#x4E4E;Fresco&#x4E0D;&#x7528;&#x62C5;&#x5FC3;&#x4E86;&#xFF0C;&#x65E2;&#x7136;&#x4F1A;&#x6E05;&#x7A7A;Fresco&#x7684;&#x5185;&#x5B58;&#x7F13;&#x5B58;&#xFF0C;&#x4F55;&#x6101;&#x4F1A;&#x5F15;&#x8D77;&#x5185;&#x5B58;&#x5CF0;&#x503C;&#x8FC7;&#x9AD8;&#xFF0C;&#x5982;&#x679C;&#x8BFB;&#x8005;&#x770B;&#x5230;&#x8FD9;&#x91CC;&#xFF0C;&#x4E5F;&#x6709;&#x8FD9;&#x4E2A;&#x60F3;&#x6CD5;&#xFF0C;&#x90A3;&#x5C31;&#x5927;&#x9519;&#x7279;&#x9519;&#x4E86;&#x3002;&#x8BDD;&#x4E0D;&#x591A;&#x8BF4;&#xFF0C;&#x76F4;&#x63A5;&#x4E0A;&#x56FE;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/132f7d90c84ed7ec97b3d9b56497991b1382b4b88416a17dd4849e522421b471" alt></p>
<p>Fresco&#x76F8;&#x5173;&#x6E90;&#x7801;&#x7684;&#x903B;&#x8F91;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x5C31;&#x4E0D;&#x5206;&#x6790;&#x4E86;&#xFF0C;&#x4E3B;&#x8981;&#x8BB2;&#x601D;&#x8DEF;&#xFF0C;&#x5177;&#x4F53;&#x7684;&#x6E90;&#x7801;&#x5206;&#x6790;&#x540E;&#x9762;&#x6211;&#x4F1A;&#x7528;&#x5355;&#x72EC;&#x7684;&#x7BC7;&#x5E45;&#x53BB;&#x8BB2;~ </p>
<p>&#x4E3A;&#x4EC0;&#x4E48;&#x6211;&#x4F1A;&#x5BF9;Fresco&#x7684;&#x52A8;&#x56FE;&#x7F13;&#x5B58;&#x8FD9;&#x4E48;&#x654F;&#x611F;&#xFF0C;&#x90A3;&#x8FD8;&#x662F;Profiler&#x7684;&#x529F;&#x52B3;&#xFF0C;&#x6211;&#x5728;&#x7528;Profiler&#x67E5;&#x770B;&#x5185;&#x5B58;&#x4E2D;bitmap&#x7684;&#x5206;&#x914D;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53D1;&#x73B0;&#x6709;&#x4E0A;&#x767E;&#x5F20;&#x7684;Loading&#x56FE;&#x6CA1;&#x6709;&#x9500;&#x6BC1;&#xFF08;&#x6211;&#x4EEC;Loading&#x56FE;&#x662F;&#x52A8;&#x56FE;&#xFF0C;&#x5927;&#x6982;&#x6BCF;&#x5E27;&#x7684;Bitmap&#x5BF9;&#x8C61;&#x5728;360K&#x5DE6;&#x53F3;&#xFF09;&#xFF0C; &#x4E14;&#x6253;&#x5F00;&#x7684;&#x9875;&#x9762;&#x8D8A;&#x591A;&#xFF0C;Loading&#x7684;bitmap&#x5C31;&#x4F1A;&#x8D8A;&#x591A;&#x3002;&#xFF08;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x6BCF;&#x4E00;&#x4E2A;RN&#x9875;&#x9762;&#x90FD;&#x4F1A;&#x5E26;&#x4E00;&#x4E2A;Loading&#x52A8;&#x753B;&#xFF09;</p>
<p>0.3M * 100 = 30M&#xFF0C;&#x4E0D;&#x5C11;&#x4E86;&#x3002;&#x3002;&#x3002;&#xFF0C;&#x8BF4;&#x5B9E;&#x8BDD;&#x6709;&#x70B9;&#x6050;&#x6016;</p>
<p>&#x4E8E;&#x662F;&#x4E4E;&#xFF0C;&#x5E72;&#x6389;&#x4ED6;&#x4EEC;&#xFF0C;&#x8FD9;&#x91CC;&#x7528;&#x4E86;&#x53CD;&#x5C04;&#xFF0C;&#x6B63;&#x5E38;&#x60C5;&#x51B5;&#x4E0B;&#x4E0D;&#x9700;&#x8981;&#x53CD;&#x5C04;&#x3002;&#x76F4;&#x63A5;&#x62FF;ImagePipelineFactory&#x4E2D;&#x7684;&#x5BF9;&#x8C61;&#x6765;clear&#x5C31;&#x597D;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;public static void clearAnimationCache() {    </span><br><span class="line">if (frescoAnimationCache == null) {        </span><br><span class="line">    //&#x91C7;&#x7528;&#x53CD;&#x5C04;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5982;&#x679C;native&#x3001;rn&#x540C;&#x65F6;&#x521D;&#x59CB;&#x5316;Fresco&#xFF0C;&#x4F1A;&#x9020;&#x6210;Fresco&#x5185;&#x90E8;&#x5B58;&#x50A8;&#x52A8;&#x56FE;&#x7684;CountingMemoryCache&#x4E0D;&#x662F;Fresco.getImagePipelineFactory().getBitmapCountingMemoryCache()&#x4E86;        </span><br><span class="line">    //&#x6682;&#x65F6;&#x7528;&#x53CD;&#x5C04;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x62FF;&#x5230;&#x5B58;&#x50A8;&#x52A8;&#x56FE;&#x7F13;&#x5B58;&#x7684;cache&#xFF0C;&#x5E76;&#x6E05;&#x7A7A;        </span><br><span class="line">    try {            </span><br><span class="line">        Class imagePipelineFactoryClz = Class.forName(&quot;com.facebook.imagepipeline.core.ImagePipelineFactory&quot;);            </span><br><span class="line">        Field mAnimatedFactoryField = imagePipelineFactoryClz.getDeclaredField(&quot;mAnimatedFactory&quot;);            </span><br><span class="line">        mAnimatedFactoryField.setAccessible(true);            </span><br><span class="line">        AnimatedFactoryV2Impl animatedFactoryV2 = (AnimatedFactoryV2Impl) mAnimatedFactoryField.get(Fresco.getImagePipelineFactory());            </span><br><span class="line">        Class animatedFactoryV2ImplClz = Class.forName(&quot;com.facebook.fresco.animation.factory.AnimatedFactoryV2Impl&quot;);            </span><br><span class="line">        Field mBackingCacheField = animatedFactoryV2ImplClz.getDeclaredField(&quot;mBackingCache&quot;);            </span><br><span class="line">        mBackingCacheField.setAccessible(true);            </span><br><span class="line">        frescoAnimationCache = (CountingMemoryCache) mBackingCacheField.get(animatedFactoryV2);        </span><br><span class="line">    } catch (Exception e) {            </span><br><span class="line">        Log.e(&quot;FrescoUtil&quot;, e.getMessage(), e);        </span><br><span class="line">    }    </span><br><span class="line">}    </span><br><span class="line">if (frescoAnimationCache != null) {  </span><br><span class="line">    frescoAnimationCache.clear();   </span><br><span class="line">}    </span><br><span class="line">Fresco.getImagePipelineFactory().getBitmapCountingMemoryCache().clear(); </span><br><span class="line">Fresco.getImagePipelineFactory().getEncodedCountingMemoryCache().clear();</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="&#x53C8;&#x4E00;&#x4E2A;&#x515C;&#x5E95;&#x65B9;&#x6848;"><a href="#&#x53C8;&#x4E00;&#x4E2A;&#x515C;&#x5E95;&#x65B9;&#x6848;" class="headerlink" title="&#x53C8;&#x4E00;&#x4E2A;&#x515C;&#x5E95;&#x65B9;&#x6848;"></a>&#x53C8;&#x4E00;&#x4E2A;&#x515C;&#x5E95;&#x65B9;&#x6848;</h3><p>&#x4E3A;&#x4E86;&#x9632;&#x6B62;&#x5CF0;&#x503C;&#x8FC7;&#x9AD8;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x8D77;&#x4E86;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#xFF0C;&#x5B9A;&#x65F6;&#x7684;&#x53BB;&#x76D1;&#x63A7;&#x5B9E;&#x65F6;&#x7684;&#x5185;&#x5B58;&#x4F7F;&#x7528;&#x60C5;&#x51B5;&#xFF0C;&#x5982;&#x679C;&#x5185;&#x5B58;&#x7D27;&#x6025;&#x4E86;&#xFF0C;&#x76F4;&#x63A5;&#x6E05;&#x7A7A;UIL/Fresco&#x7684;&#x5185;&#x5B58;&#x7F13;&#x5B58;&#x6551;&#x6025;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">scss&#x590D;&#x5236;&#x4EE3;&#x7801;    private static Handler lowMemoryMonitorHandler;</span><br><span class="line">    private static final int MEMORY_MONITOR_INTERVAL = 1000 * 60;</span><br><span class="line">    /**</span><br><span class="line">     * &#x5F00;&#x542F;&#x4F4E;&#x5185;&#x5B58;&#x76D1;&#x6D4B;&#xFF0C;&#x5982;&#x679C;&#x4F4E;&#x5185;&#x5B58;&#x4E86;&#xFF0C;&#x4F5C;&#x51FA;&#x76F8;&#x5E94;&#x7684;&#x53CD;&#x5E94;</span><br><span class="line">     */</span><br><span class="line">    public static void startMonitorLowMemory() {</span><br><span class="line">        HandlerThread thread = new HandlerThread(&quot;thread_monitor_low_memory&quot;);</span><br><span class="line">        thread.start();</span><br><span class="line">        lowMemoryMonitorHandler = new Handler(thread.getLooper());</span><br><span class="line">        lowMemoryMonitorHandler.postDelayed(releaseMemoryCacheRunner, MEMORY_MONITOR_INTERVAL);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x4F4E;&#x5185;&#x5B58;&#x65F6;&#x6E05;&#x7A7A;Fresco&#x3001;UIL&#x7684;&#x5185;&#x5B58;&#x7F13;&#x5B58;</span><br><span class="line">     * &#x5982;&#x679C;&#x5DF2;&#x7528;&#x5185;&#x5B58;&#x8FBE;&#x5230;&#x4E86;&#x603B;&#x7684; 80%&#x65F6;&#xFF0C;&#x5C31;&#x6E05;&#x7A7A;&#x7F13;&#x5B58;</span><br><span class="line">     */</span><br><span class="line">    private static Runnable releaseMemoryCacheRunner = new Runnable() {</span><br><span class="line">        @Override</span><br><span class="line">        public void run() {</span><br><span class="line">            long alreadyUsedSize = Runtime.getRuntime().totalMemory() - Runtime.getRuntime().freeMemory();</span><br><span class="line">            long maxSize = Runtime.getRuntime().maxMemory();</span><br><span class="line">            if (Double.compare(alreadyUsedSize, maxSize * 0.8) == 1) {</span><br><span class="line">                BitmapUtil.clearMemoryCaches();</span><br><span class="line">            }</span><br><span class="line">            lowMemoryMonitorHandler.postDelayed(releaseMemoryCacheRunner, MEMORY_MONITOR_INTERVAL);</span><br><span class="line">        }</span><br><span class="line">    };</span><br></pre></td></tr></table></figure>

<h2 id="&#x4E94;&#x3001;&#x7279;&#x5927;&#x56FE;&#x6392;&#x67E5;&#x4F18;&#x5316;"><a href="#&#x4E94;&#x3001;&#x7279;&#x5927;&#x56FE;&#x6392;&#x67E5;&#x4F18;&#x5316;" class="headerlink" title="&#x4E94;&#x3001;&#x7279;&#x5927;&#x56FE;&#x6392;&#x67E5;&#x4F18;&#x5316;"></a>&#x4E94;&#x3001;&#x7279;&#x5927;&#x56FE;&#x6392;&#x67E5;&#x4F18;&#x5316;</h2><p>&#x6211;&#x60F3;&#x5927;&#x5BB6;&#x90FD;&#x4E0D;&#x4F1A;&#x60F3;&#x5230;&#xFF0C;&#x5728;&#x6211;&#x4EEC;app&#x7684;&#x767B;&#x5F55;&#x6CE8;&#x518C;&#x9875;&#xFF0C;&#x4F1A;&#x6709;&#x4E00;&#x4E2A;&#x56FE;&#x7247;&#x8F6E;&#x64AD;&#x63A7;&#x4EF6;&#xFF0C;&#x5B83;&#x8F6E;&#x64AD;&#x7740;&#x4E94;&#x516D;&#x5F20;&#x5355;&#x5F20;6M+&#x7684;Bitmap&#x3002;&#x3002;&#x3002;&#x5F53;&#x7136;&#xFF0C;&#x7279;&#x5927;&#x56FE;&#x4E0D;&#x4EC5;&#x9650;&#x4E8E;&#x6B64;&#xFF0C;&#x8FD8;&#x6709;&#x5176;&#x4ED6;&#x5730;&#x65B9;&#x4F1A;&#x6709;&#x76F8;&#x540C;&#x60C5;&#x51B5;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x8FC7;Profiler&#x627E;&#x51FA;&#x90A3;&#x4E9B;&#x5927;&#x7684;bitmap&#x5BF9;&#x8C61;&#xFF0C;&#x7136;&#x540E;&#x9884;&#x89C8;&#x4E4B;&#x540E;&#x786E;&#x5B9A;&#x662F;&#x54EA;&#x91CC;&#x5728;&#x7528;&#x7684;&#x3002;</p>
<p>&#x76F4;&#x63A5;&#x4F18;&#x5316;&#x6389;&#x3002;&#x6700;&#x4E0D;&#x6D4E; 8888 -&gt; 565&#x5C31;&#x5C11;&#x4E00;&#x534A;&#x5185;&#x5B58;&#x5360;&#x7528;</p>
<p><strong>&#x600E;&#x4E48;&#x8BB2;&#x5462;&#xFF0C;&#xFF0C;OOM&#x8FD9;&#x4E2A;&#x4E1C;&#x897F;&#xFF0C;&#x8FD8;&#x6CA1;&#x548B;&#x50F5;&#x6301;&#x5462;&#xFF0C;&#x5C31;&#x6CA1;&#x4E86;&#x3002;</strong>&#x3002;</p>
<h2 id="&#x516D;&#x3001;&#x603B;&#x7ED3;"><a href="#&#x516D;&#x3001;&#x603B;&#x7ED3;" class="headerlink" title="&#x516D;&#x3001;&#x603B;&#x7ED3;"></a>&#x516D;&#x3001;&#x603B;&#x7ED3;</h2><p>&#x6DF1;&#x591C;&#x4E00;&#x65F6;&#x5174;&#x8D77;&#x60F3;&#x5206;&#x4EAB;&#x548C;&#x8BB0;&#x5F55;&#x4E00;&#x4E9B;&#x4EC0;&#x4E48;&#xFF0C;&#x5C31;&#x968F;&#x4FBF;&#x5199;&#x4E86;&#x8FD9;&#x4E00;&#x7BC7;&#x535A;&#x5BA2;&#xFF0C;&#x5199;&#x7684;&#x4E0D;&#x8BE6;&#x7EC6;&#xFF0C;&#x6CA1;&#x6709;&#x6392;&#x7248;&#x548C;&#x826F;&#x597D;&#x7684;&#x8BED;&#x8A00;&#x7EC4;&#x7EC7;&#xFF0C;&#x5355;&#x7EAF;&#x7684;&#x5C31;&#x662F;&#x60F3;&#x5206;&#x4EAB;</p>
<p>&#x603B;&#x7ED3;&#x4E00;&#x4E0B;&#x5427;&#xFF0C;&#x6211;&#x4EEC;&#x4E3A;&#x4E86;fix OOM&#x6240;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#xFF1A;</p>
<ol>
<li>&#x68C0;&#x67E5;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#xFF0C;&#x5305;&#x62EC;&#x5E38;&#x89C1;&#x7684;Context&#x6CC4;&#x6F0F;&#x3001;&#x5355;&#x4F8B;&#x6CC4;&#x6F0F;&#x3001;EditText&#x7684;TextWatcher&#x6CC4;&#x6F0F;&#x7B49;&#x7B49;&#xFF0C;&#x627E;&#x5230;&#x5E76;fix&#x4ED6;&#x4EEC;&#xFF0C;&#x6700;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x80FD;&#x4F20;application&#x7684;&#x5730;&#x65B9;&#x5C31;&#x4E0D;&#x8981;&#x786C;&#x4F20;&#x4E2A;activity&#x8FC7;&#x53BB;</li>
<li>&#x515C;&#x5E95;&#x65B9;&#x6848;&#xFF1A;</li>
</ol>
<ul>
<li>&#x5728;Activity onDestory&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x904D;&#x5386;View&#x6811;&#xFF0C;&#x6E05;&#x7A7A;backGround&#x3001;Drawable&#x3001;EditText&#x7684;TextWatcher&#x7B49;</li>
</ul>
<ol start="4">
<li>&#x5185;&#x5B58;&#x5CF0;&#x503C;&#x7684;&#x4F18;&#x5316;&#x3002;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x4F1A;&#x5BFC;&#x81F4;&#x5185;&#x5B58;&#x5CF0;&#x503C;&#xFF0C;&#x5185;&#x5B58;&#x5CF0;&#x503C;&#x662F;OOM&#x7684;&#x5927;&#x9505;&#xFF0C;&#x4E3E;&#x4E2A;&#x4F8B;&#x5B50;&#x5F53;&#x53EF;&#x7528;&#x5185;&#x5B58;&#x4E0D;&#x591F;&#x5206;&#x914D;&#x4E00;&#x4E2A;Bitmap&#x5BF9;&#x8C61;&#x65F6;&#xFF0C;&#x5C31;&#x4F1A;OOM&#xFF0C;Android&#x4E0A;&#x5927;&#x591A;&#x6570;&#x7684;&#x5185;&#x5B58;&#x5CF0;&#x503C;&#x90FD;&#x662F;&#x56FE;&#x7247;&#x7684;&#x52A0;&#x8F7D;&#x5E26;&#x6765;&#x7684;&#x3002;&#x73B0;&#x5728;&#x8BB8;&#x591A;&#x7684;app&#x4E2D;&#x90FD;&#x6709;&#x4FE1;&#x606F;&#x6D41;&#x7684;&#x5C55;&#x73B0;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x8BB8;&#x591A;&#x7684;&#x4E5D;&#x5BAB;&#x683C;&#x5C55;&#x793A;&#x56FE;&#x7247;&#xFF0C;&#x4E14;Bitmap&#x5BF9;&#x8C61;&#x672C;&#x8EAB;&#x5C31;&#x53EF;&#x4EE5;&#x975E;&#x5E38;&#x5927;&#x3002;</li>
</ol>
<ul>
<li>&#x4F18;&#x5316;UIL&#x7684;&#x4F7F;&#x7528;</li>
<li>memoryCache&#x9009;&#x7528;&#xFF0C;&#x4E0D;&#x662F;&#x6240;&#x6709;&#x7684;&#x56FE;&#x7247;&#x52A0;&#x8F7D;&#x90FD;&#x9700;&#x8981;UIL&#x53BB;&#x585E;&#x4E00;&#x4EFD;&#x5185;&#x5B58;&#x7F13;&#x5B58;&#x7684;&#xFF0C;&#x6BD4;&#x5982;&#x95EA;&#x5C4F;&#x56FE;</li>
<li>ImageLoader.getInstance().displayImage()&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F20;&#x8FDB;&#x53BB;&#x7684;Option&#x4E0D;&#x8981;&#x65E0;&#x8111;ARGB_8888&#xFF0C;&#x8BB2;&#x9053;&#x7406;&#x6765;&#x8BF4;&#xFF0C;&#x65E0;&#x8111;RGB_565&#x90FD;&#x662F;&#x6CA1;&#x5565;&#x95EE;&#x9898;&#x7684;&#x3002;&#x3002;</li>
<li>&#x8C03;&#x7528;displayImage&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6700;&#x597D;&#x4F20;&#x4E00;&#x4E2A;ImageSize&#x4F5C;&#x4E3A;targetSize&#xFF0C;&#x8FD9;&#x4E2A;size&#x53EF;&#x4EE5;&#x662F;&#x4F60;&#x7684;ImageView&#x7684;&#x5C3A;&#x5BF8;&#xFF0C;&#x5F53;View&#x5C3A;&#x5BF8;&#x672C;&#x8EAB;&#x4E0D;&#x786E;&#x5B9A;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53EF;&#x4EE5;&#x4F20;&#x4E00;&#x4E2A;&#x5927;&#x6982;&#x503C;&#xFF0C;&#x6BD4;&#x5982;&#x6211;&#x4EEC;app&#x4E2D;&#x6709;&#x597D;&#x4E9B;&#x4E2A;&#x7684;&#x5934;&#x50CF;&#x6807;&#x51C6;&#x5C3A;&#x5BF8;&#xFF0C;&#x4E3A;&#x4E86;&#x5077;&#x61D2;&#xFF0C;&#x76F4;&#x63A5;&#x4F20;MaxAvatarSize&#x5C31;ok</li>
<li>Fresco&#x7684;&#x4F18;&#x5316;</li>
<li>RN&#x4E2D;&#x4F7F;&#x7528;Fresco&#x52A0;&#x8F7D;&#x56FE;&#x7247;&#xFF0C;&#x5728;RN Activity&#x9500;&#x6BC1;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x5C06;Fresco&#x9ED8;&#x8BA4;&#x7684;memory cache&#x6E05;&#x7A7A;&#xFF0C;&#x4F46;&#x662F;&#x52A8;&#x56FE;&#x7684;&#x7F13;&#x5B58;&#x6CA1;&#x6709;&#x6E05;&#x3002;&#x624B;&#x52A8;&#x6E05;&#x4E00;&#x4E0B;&#x3002;&#x6211;&#x4EEC;&#x9879;&#x76EE;&#x4E2D;&#x6BCF;&#x4E2A;RN&#x9875;&#x9762;&#x90FD;&#x4F1A;&#x5E26;&#x4E00;&#x4E2A;Loading&#x52A8;&#x56FE;&#xFF0C;&#x6240;&#x4EE5;&#x5403;&#x4E86;&#x5927;&#x4E8F;&#x3002;&#x3002;</li>
</ul>
<ol start="6">
<li>&#x6301;&#x7EED;&#x7684;&#x540E;&#x53F0;&#x76D1;&#x63A7;&#x5185;&#x5B58;&#xFF0C;&#x8D77;&#x4E00;&#x4E2A;HandlerThread&#xFF0C;&#x4E00;&#x76F4;&#x5728;&#x540E;&#x53F0;&#x62FF;&#x5185;&#x5B58;&#x4F7F;&#x7528;&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x8FBE;&#x5230;&#x4E86;&#x5371;&#x9669;&#x8B66;&#x6212;&#x7EBF;&#x5C31;&#x6E05;&#x7A7A;&#x4E00;&#x628A;UIL&#x3001;Fresco&#x7684;memory cache&#xFF0C;&#x5148;&#x8BA9;&#x4E16;&#x754C;&#x5B89;&#x9759;&#x4E00;&#x4E0B;</li>
<li>&#x9700;&#x8981;&#x5BF9;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x3001;OOM&#x3001;Crash&#x3001;ANR&#x8FDB;&#x884C;&#x76D1;&#x63A7;</li>
</ol>
<p>&#x4E00;&#x4E9B;&#x5176;&#x4ED6;&#x7684;&#x7EC6;&#x8282;&#x6682;&#x65F6;&#x60F3;&#x4E0D;&#x8D77;&#x6765;&#x4E86;&#xFF0C;&#x51CC;&#x6668;&#x56DB;&#x70B9;&#x8111;&#x5B50;&#x4E0D;&#x6E05;&#x9192;&#x4E86;</p>
<p>&#x540E;&#x7EED;&#x5173;&#x4E8E;&#x8FD9;&#x91CC;&#x9762;&#x6D89;&#x53CA;&#x5230;&#x7684;Fresco&#x7684;&#x90E8;&#x5206;&#x6E90;&#x7801;&#x5206;&#x6790;&#x3001;Profiler&#x7684;&#x6700;&#x4F73;&#x4F7F;&#x7528;&#x59FF;&#x52BF;&#xFF08;&#x7ECF;&#x8FC7;&#x8FD9;&#x4E00;&#x6B21;&#x7684;&#x6298;&#x817E;&#xFF0C;&#x603B;&#x7ED3;&#x51FA;&#x6765;&#x4E00;&#x53E5;&#x8BDD;&#xFF0C;Profiler&#x771F;&#x9999;&#xFF09;&#x3001;&#x4EE5;&#x53CA;&#x524D;&#x6BB5;&#x65F6;&#x95F4;&#x5728;&#x505A;&#x7684;App&#x7684;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x4F18;&#x5316;&#x7B49;&#x7B49;&#x7B49;&#x7B49;&#x7B49;&#x90FD;&#x4F1A;&#x5355;&#x72EC;&#x62CE;&#x6587;&#x7AE0;&#x53BB;&#x5206;&#x4EAB;&#xFF0C;&#x540E;&#x7EED;&#x4E5F;&#x4F1A;&#x5E26;&#x6765;&#x66F4;&#x591A;&#xFF0C;&#x6D89;&#x53CA;&#x7684;&#x5185;&#x5BB9;&#x5305;&#x62EC;&#x4F46;&#x4E0D;&#x9650;&#x4E8E;&#xFF1A;</p>
<ul>
<li>&#x4E3B;&#x6D41;&#x6846;&#x67B6;&#x7684;&#x4E00;&#x4E9B;&#x8BBE;&#x8BA1;&#x601D;&#x60F3;&#x7684;&#x5206;&#x4EAB;</li>
<li>&#x5DE5;&#x4F5C;&#x9879;&#x76EE;&#x4E2D;&#x9047;&#x5230;&#x7684;&#x9EBB;&#x70E6;&#x548C;&#x5751;</li>
<li>&#x5DE5;&#x4F5C;&#x4E2D;&#x8E5A;&#x5751;&#x7684;&#x4E00;&#x4E9B;&#x7ECF;&#x9A8C;</li>
<li>&#x597D;&#x4EE3;&#x7801;</li>
<li>&#x574F;&#x4EE3;&#x7801;</li>
<li>&#x574F;&#x7684;&#x8BBE;&#x8BA1;</li>
<li>&#x7A0B;&#x5E8F;&#x5458;&#x4ECE;&#x5934;&#x53D1;&#x6D53;&#x5BC6;&#x5230;&#x6210;&#x4E3A;&#x4E0B;&#x96E8;&#x5929;&#x62A5;&#x8B66;&#x5458;&#x7684;&#x5FC3;&#x8DEF;&#x5386;&#x7A0B;</li>
<li>&#x3002;&#x3002;&#x3002;</li>
</ul>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/30b5da38d17bdbcb8d7c959500a725969ae88d4e2682fd1f195aab3b96ec34da" alt></p>
<p><strong>&#x6211;&#x7684;&#x7B80;&#x4E66; <a href="/external_links/f2aaac8b595386986ebb09814f5930be.html" target="blank" rel="noopener">&#x90B9;&#x554A;&#x6D9B;&#x6D9B;&#x6D9B;&#x7684;&#x7B80;&#x4E66;</a></strong></p>
<p><strong>&#x6211;&#x7684;CSDN</strong> <strong><a href="/external_links/3d7b9c9f5199f309316bc30af805c170.html" target="blank" rel="noopener">&#x90B9;&#x554A;&#x6D9B;&#x6D9B;&#x6D9B;&#x7684;CSDN</a></strong></p>
<p><strong>&#x6211;&#x7684;&#x6398;&#x91D1; <a href="/external_links/6e6ffa19872c648cc288f487cbf401dc.html" target="blank" rel="noopener">&#x90B9;&#x554A;&#x6D9B;&#x6D9B;&#x6D9B;&#x7684;&#x6398;&#x91D1;</a></strong></p>
<h2 id="&#x4F60;&#x53EF;&#x80FD;&#x611F;&#x5174;&#x8DA3;"><a href="#&#x4F60;&#x53EF;&#x80FD;&#x611F;&#x5174;&#x8DA3;" class="headerlink" title="&#x4F60;&#x53EF;&#x80FD;&#x611F;&#x5174;&#x8DA3;"></a>&#x4F60;&#x53EF;&#x80FD;&#x611F;&#x5174;&#x8DA3;</h2><p><a href="/external_links/b892305c27d5f122cffdeb3c944d003b.html" target="blank" rel="noopener">Android QUIC &#x5B9E;&#x8DF5; - &#x57FA;&#x4E8E; OKHttp &#x6269;&#x5C55;&#x51FA; Cronet &#x62E6;&#x622A;&#x5668; - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/7306692609497546752">Android&#x542F;&#x52A8;&#x4F18;&#x5316;&#x5B9E;&#x8DF5; - &#x79D2;&#x5F00;&#x7387;&#x4ECE;17%&#x63D0;&#x5347;&#x81F3;75% - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/7302982924987039796">&#x5982;&#x4F55;&#x79D1;&#x5B66;&#x7684;&#x8FDB;&#x884C;Android&#x5305;&#x4F53;&#x79EF;&#x4F18;&#x5316; - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/7297035708429598754">Android&#x7A33;&#x5B9A;&#x6027;&#xFF1A;Looper&#x515C;&#x5E95;&#x6846;&#x67B6;&#x5B9E;&#x73B0;&#x7EBF;&#x4E0A;&#x5BB9;&#x707E;&#xFF08;&#x4E8C;&#xFF09; - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/7288178532861755432">&#x57FA;&#x4E8E; Booster ASM API&#x7684;&#x914D;&#x7F6E;&#x5316; hook &#x65B9;&#x6848;&#x5C01;&#x88C5; - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/7287241480770076687">&#x8BB0; AndroidStudio Tracer&#x5DE5;&#x5177;&#x5BFC;&#x81F4;&#x7684;&#x7F16;&#x8BD1;&#x5931;&#x8D25; - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/7280864416555860003">Android &#x542F;&#x52A8;&#x4F18;&#x5316;&#x6848;&#x4F8B;-WebView&#x975E;&#x9884;&#x671F;&#x521D;&#x59CB;&#x5316;&#x6392;&#x67E5; - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/7274430147126280207">chromium-net - &#x8DDF;&#x968F; Cronet &#x7684;&#x811A;&#x6B65;&#x63A2;&#x7D22;&#x5927;&#x81F4;&#x6D41;&#x7A0B;&#xFF08;1&#xFF09; - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/7198466997288566842">Android&#x7A33;&#x5B9A;&#x6027;&#xFF1A;&#x53EF;&#x8FDC;&#x7A0B;&#x914D;&#x7F6E;&#x5316;&#x7684;Looper&#x515C;&#x5E95;&#x6846;&#x67B6; - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/7141301214523686926">&#x4E00;&#x7C7B;&#x6709;&#x8DA3;&#x7684;&#x65E0;&#x9650;&#x7F13;&#x5B58;OOM&#x73B0;&#x8C61; - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/6844903924965572615">Android - &#x4E00;&#x79CD;&#x65B0;&#x5947;&#x7684;&#x51B7;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x4F18;&#x5316;&#x601D;&#x8DEF;(Fragment&#x6781;&#x5EA6;&#x61D2;&#x52A0;&#x8F7D; + Layout&#x5B50;&#x7EBF;&#x7A0B;&#x9884;&#x52A0;&#x8F7D;) - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/6844903923745030158">Android - &#x5F7B;&#x5E95;&#x6D88;&#x706D;OOM&#x7684;&#x5B9E;&#x6218;&#x7ECF;&#x9A8C;&#x5206;&#x4EAB;&#xFF08;&#x5343;&#x5206;&#x4E4B;1.5 -&gt; &#x4E07;&#x5206;&#x4E4B;0.2&#xFF09; - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/8ae33f2b82afce019355c33f668be71a.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903919580086280.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903919580086280.html" itemprop="url">探索 Android 启动优化方法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-19T21:26:23+08:00">
                2019-08-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/d051c487de68aa3fd11c1693aefb7b49e9e35804f18dd9d1979effbd7181ff35" alt="2004563-aa4ce37c339e22f2.webp"></p>
<ol>
<li>&#x542F;&#x52A8;&#x4F18;&#x5316;&#x65B9;&#x6CD5;&#x6982;&#x8FF0;</li>
</ol>
<hr>
<p>Android &#x542F;&#x52A8;&#x4F18;&#x5316;&#x4E3B;&#x8981;&#x8BB2;&#x7684;&#x662F; <code>App &#x51B7;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x7684;&#x4F18;&#x5316;</code>&#xFF0C;&#x5185;&#x5BB9;&#x5305;&#x62EC; Android &#x5E94;&#x7528;<code>&#x542F;&#x52A8;&#x76F8;&#x5173;&#x77E5;&#x8BC6;</code>&#x3001;<code>&#x542F;&#x52A8;&#x5206;&#x6790;&#x5DE5;&#x5177;</code>&#x4EE5;&#x53CA;<code>&#x542F;&#x52A8;&#x4F18;&#x5316;&#x65B9;&#x6848;</code>&#x3002;</p>
<p><code>&#x542F;&#x52A8;&#x4F18;&#x5316;&#x76F8;&#x5173;&#x77E5;&#x8BC6;</code>&#x6709; <code>App &#x542F;&#x52A8;&#x539F;&#x7406;</code>&#x3001;App &#x542F;&#x52A8;&#x7684;<code>&#x4E09;&#x79CD;&#x72B6;&#x6001;</code>&#x3001;&#x4EE5;&#x53CA;<code>&#x542F;&#x52A8;&#x95EE;&#x9898;&#x7684;&#x4E09;&#x79CD;&#x8868;&#x73B0;</code>&#x3002;</p>
<p><code>&#x542F;&#x52A8;&#x5206;&#x6790;&#x5DE5;&#x5177;</code>&#x53EF;&#x4EE5;&#x5206;&#x4E3A;<code>&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x6D4B;&#x91CF;&#x5DE5;&#x5177;</code>&#x548C;<code>&#x542F;&#x52A8;&#x8017;&#x65F6;&#x5206;&#x6790;&#x5DE5;&#x5177;</code>&#x3002;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x6D4B;&#x91CF;&#x5DE5;&#x5177;&#x6709;<code>ActivityManager &#x6D4B;&#x91CF;</code>&#x548C;<code>&#x57CB;&#x70B9;&#x6D4B;&#x91CF;</code>&#xFF0C;&#x542F;&#x52A8;&#x8017;&#x65F6;&#x5206;&#x6790;&#x5DE5;&#x5177;&#x6709;<code>Debug</code>&#x548C;<code>Trace</code>&#x3002;</p>
<p><code>&#x542F;&#x52A8;&#x4F18;&#x5316;&#x65B9;&#x6848;</code>&#x53EF;&#x4EE5;&#x5206;&#x4E3A;<code>&#x89C6;&#x89C9;&#x4F18;&#x5316;</code>&#x3001;<code>onCreate() &#x4F18;&#x5316;</code>&#x4EE5;&#x53CA;<code>MultiDex &#x4F18;&#x5316;</code>&#x3002;</p>
<p>App &#x542F;&#x52A8;&#x65F6;&#x53EF;&#x4EE5;&#x5206;&#x4E3A;<code>&#x70ED;&#x542F;&#x52A8;</code>&#x3001;<code>&#x6696;&#x542F;&#x52A8;</code>&#x548C;<code>&#x51B7;&#x542F;&#x52A8;</code>&#x4E09;&#x79CD;&#xFF0C;&#x70ED;&#x542F;&#x52A8;&#x662F;&#x4E09;&#x79CD;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x4E2D;<code>&#x6700;&#x5FEB;&#x7684;&#x4E00;&#x79CD;</code>&#xFF0C;&#x6696;&#x542F;&#x52A8;&#x53EA;&#x4F1A;<code>&#x91CD;&#x8D70; Activity &#x7684;&#x751F;&#x547D;&#x5468;&#x671F;</code>&#xFF0C;&#x800C;<code>&#x51B7;&#x542F;&#x52A8;</code>&#x8981;&#x7ECF;&#x5386;&#x521B;&#x5EFA;&#x8FDB;&#x7A0B;&#x3001;&#x542F;&#x52A8;&#x5E94;&#x7528;&#x548C;&#x7ED8;&#x5236;&#x754C;&#x9762;&#x7B49;&#x4E00;&#x7CFB;&#x5217;&#x64CD;&#x4F5C;&#xFF0C;&#x662F;&#x8017;&#x65F6;&#x6700;&#x591A;&#x4E00;&#x79CD;&#x542F;&#x52A8;&#x72B6;&#x6001;&#xFF0C;&#x4E5F;&#x662F;&#x5E38;&#x89C1;&#x7684;<code>&#x542F;&#x52A8;&#x4F18;&#x5316;&#x8861;&#x91CF;&#x6807;&#x51C6;</code>&#x3002;</p>
<p>&#x542F;&#x52A8;&#x95EE;&#x9898;&#x6709;<code>&#x70B9;&#x51FB;&#x684C;&#x9762;&#x56FE;&#x6807;&#x54CD;&#x5E94;&#x6162;</code>&#x3001;<code>&#x9996;&#x9875;&#x663E;&#x793A;&#x6162;</code>&#x4EE5;&#x53CA;<code>&#x9996;&#x9875;&#x663E;&#x793A;&#x540E;&#x65E0;&#x6CD5;&#x64CD;&#x4F5C;</code>&#x4E09;&#x4E2A;&#x3002;</p>
<p><code>&#x70B9;&#x51FB;&#x56FE;&#x6807;&#x54CD;&#x5E94;&#x6162;</code>&#x5728;&#x628A;&#x4E3B;&#x9898;&#x8BBE;&#x4E3A;&#x900F;&#x660E;&#x7684;&#x65F6;&#x5019;&#x624D;&#x4F1A;&#x53D1;&#x751F;&#xFF0C;&#x8FD9;&#x65F6;&#x5982;&#x679C;&#x542F;&#x52A8;&#x521D;&#x59CB;&#x5316;&#x6D41;&#x7A0B;&#x8981; 2 &#x79D2;&#xFF0C;&#x90A3;&#x7528;&#x6237;&#x5C31;&#x8981; 2 &#x79D2;&#x624D;&#x80FD;&#x770B;&#x5230;&#x754C;&#x9762;&#xFF0C;&#x5C31;&#x50CF;&#x662F;<code>&#x70B9;&#x51FB;&#x65E0;&#x6548;</code>&#x4E00;&#x6837;&#x3002;</p>
<p><code>&#x9996;&#x9875;&#x663E;&#x793A;&#x6162;</code>&#x6307;&#x7684;&#x662F;&#x95EA;&#x5C4F;&#x5E7F;&#x544A;&#x548C;&#x5404;&#x79CD; SDK &#x7684;&#x521D;&#x59CB;&#x5316;&#x5DE5;&#x4F5C;&#x8D8A;&#x6765;&#x8D8A;&#x590D;&#x6742;&#xFF0C;&#x5728;&#x4E2D;&#x4F4E;&#x7AEF;&#x673A;&#x4E0A;&#x53EF;&#x80FD;&#x8981;&#x5341;&#x51E0;&#x79D2;&#x624D;&#x80FD;&#x542F;&#x52A8;&#x3002;</p>
<p><code>&#x9996;&#x9875;&#x663E;&#x793A;&#x540E;&#x65E0;&#x6CD5;&#x64CD;&#x4F5C;</code>&#x6307;&#x7684;&#x662F;&#x628A;&#x521D;&#x59CB;&#x5316;&#x7684;&#x5DE5;&#x4F5C;&#x5EF6;&#x8FDF;&#x540E;&#xFF0C;&#x6709;&#x53EF;&#x80FD;&#x51FA;&#x73B0;&#x9996;&#x9875;&#x867D;&#x7136;&#x663E;&#x793A;&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x65E0;&#x6CD5;&#x64CD;&#x4F5C;&#xFF0C;&#x65E0;&#x6CD5;&#x6ED1;&#x52A8;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x8FD9;&#x6837;&#x4F18;&#x5316;&#x7684;&#x610F;&#x4E49;&#x5C31;&#x5F88;&#x5C0F;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x4ECE;&#x542F;&#x52A8;&#x5230;&#x9996;&#x9875;&#x53EF;&#x64CD;&#x4F5C;&#x8FD9;&#x6574;&#x4E2A;&#x8FC7;&#x7A0B;&#x90FD;&#x662F;&#x542F;&#x52A8;&#x4F18;&#x5316;&#x8981;&#x89E3;&#x51B3;&#x7684;&#x95EE;&#x9898;&#x3002;</p>
<p><code>ActivityManager &#x6D4B;&#x91CF;</code>&#x6307;&#x7684;&#x662F;&#x901A;&#x8FC7; <code>adb shell</code> &#x8BA9; ActivityManager &#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x8F93;&#x51FA;<code>&#x6700;&#x540E;&#x4E00;&#x4E2A; Activity &#x542F;&#x52A8;&#x7684;&#x8017;&#x65F6;</code>&#x3001;<code>&#x6240;&#x6709; Activity &#x542F;&#x52A8;&#x7684;&#x8017;&#x65F6;</code>&#x4EE5;&#x53CA;<code>AMS &#x542F;&#x52A8; Activity &#x7684;&#x8017;&#x65F6;</code>&#x3002;ActivityManager &#x6D4B;&#x91CF;<code>&#x53EA;&#x80FD;&#x5728;&#x7EBF;&#x4E0B;&#x4F7F;&#x7528;</code>&#x3002;</p>
<p><code>&#x57CB;&#x70B9;&#x6D4B;&#x91CF;</code>&#x6307;&#x7684;&#x662F;&#x5728; <code>attachBaseContext()</code> &#x65B9;&#x6CD5;&#x4E2D;&#x8BB0;&#x5F55;&#x542F;&#x52A8;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x7136;&#x540E;&#x5728;<code>&#x5217;&#x8868;&#x7B2C;&#x4E00;&#x9879;&#x5C55;&#x793A;</code>&#x6216;<code>&#x5176;&#x4ED6; View &#x7ED8;&#x5236;&#x5B8C;&#x6210;</code>&#x7684;&#x65F6;&#x5019;&#x8BB0;&#x5F55;&#x542F;&#x52A8;&#x7ED3;&#x675F;&#x7684;&#x65F6;&#x95F4;&#x3002;&#x8FD9;&#x91CC;&#x8981;&#x6CE8;&#x610F;&#x4E0D;&#x8981;&#x5728; onWindowFocusChanged() &#x65B9;&#x6CD5;&#x4E2D;&#x8BB0;&#x5F55;&#x542F;&#x52A8;&#x7ED3;&#x675F;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x4E2A;&#x53EA;&#x662F;&#x9996;&#x5E27;&#x65F6;&#x95F4;&#xFF0C;&#x754C;&#x9762;&#x8FD8;&#x672A;&#x5B8C;&#x6574;&#x663E;&#x793A;&#x51FA;&#x6765;&#x3002;&#x57CB;&#x70B9;&#x6D4B;&#x91CF;&#x53EF;&#x4EE5;<code>&#x7CBE;&#x786E;&#x8BB0;&#x5F55;&#x542F;&#x52A8;&#x8017;&#x65F6;&#xFF0C;&#x800C;&#x4E14;&#x80FD;&#x5E26;&#x5230;&#x7EBF;&#x4E0A;</code>&#x3002;</p>
<p><code>Debug</code>&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x5206;&#x6790;&#x4F7F;&#x7528;&#x7684;&#x662F; Android SDK &#x63D0;&#x4F9B;&#x7684;&#x4E00;&#x4E2A; <code>Debug &#x7C7B;</code>&#xFF0C;&#x8C03;&#x7528; Debug &#x7684; <code>startMethodTracing()</code> &#x53EF;&#x4EE5;&#x8DDF;&#x8E2A;&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x5185; <code>CPU &#x7684;&#x4F7F;&#x7528;&#x60C5;&#x51B5;</code>&#xFF0C;&#x5728;&#x8C03;&#x7528; <code>stopMethodTracing()</code> &#x65B9;&#x6CD5;&#x540E;&#xFF0C;&#x4F1A;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>CPU Profiler</code> &#x67E5;&#x770B;&#x8BE5;&#x6587;&#x4EF6;&#x4E2D;&#x8BB0;&#x5F55;&#x7684;&#x5728;&#x542F;&#x52A8;&#x8FC7;&#x7A0B;&#x4E2D;&#x90FD;<code>&#x6709;&#x54EA;&#x4E9B;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x4E86;&#x54EA;&#x4E9B;&#x65B9;&#x6CD5;</code>&#xFF0C;&#x5305;&#x62EC;<code>&#x5404;&#x4E2A;&#x65B9;&#x6CD5;&#x7684;&#x8017;&#x65F6;</code>&#x3002;Debug &#x7684;&#x7F3A;&#x70B9;&#x662F;<code>&#x5F00;&#x9500;&#x975E;&#x5E38;&#x5927;&#xFF0C;&#x6709;&#x53EF;&#x80FD;&#x5F71;&#x54CD;&#x542F;&#x52A8;&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;</code>&#x3002;</p>
<p><code>Trace</code> &#x4E5F;&#x662F; Android SDK &#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x7C7B;&#xFF0C;&#x4E0E; Debug &#x76F8;&#x6BD4;&#xFF0C;Trace &#x9664;&#x4E86;&#x80FD;&#x770B;&#x5230;&#x542F;&#x52A8;&#x8FC7;&#x7A0B;&#x4E2D;&#x5404;&#x4E2A;&#x65B9;&#x6CD5;&#x7684;&#x8017;&#x65F6;&#xFF0C;&#x8FD8;&#x80FD;&#x770B;&#x5230;<code>&#x5404;&#x4E2A; CPU &#x7684;&#x65F6;&#x95F4;&#x7247;&#x4F7F;&#x7528;&#x60C5;&#x51B5;</code>&#x3002;Trace &#x7684;&#x4F18;&#x70B9;&#x662F;<code>&#x5F00;&#x9500;&#x5C0F;&#xFF0C;&#x53EA;&#x4F1A;&#x5728;&#x57CB;&#x70B9;&#x533A;&#x95F4;&#x8BB0;&#x5F55;</code>&#xFF0C;&#x800C;&#x4E14;<code>&#x53EF;&#x4EE5;&#x76F4;&#x89C2;&#x5730;&#x770B;&#x5230; CPU &#x5229;&#x7528;&#x7387;</code>&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x62A5;&#x544A;&#x5206;&#x6790;&#x4E00;&#x4E0B;&#x8981;&#x4E0D;&#x8981;&#x5F00;&#x66F4;&#x591A;&#x7EBF;&#x7A0B;&#x63D0;&#x5347;&#x7A0B;&#x5E8F;&#x6267;&#x884C;&#x6027;&#x80FD;&#xFF0C;&#x63D0;&#x5347; CPU &#x5229;&#x7528;&#x7387;&#x3002;</p>
<p><code>&#x89C6;&#x89C9;&#x4F18;&#x5316;</code>&#x6307;&#x7684;&#x662F;<code>&#x7ED9;&#x95EA;&#x5C4F;&#x9875;&#x8BBE;&#x7F6E;&#x56FE;&#x7247;&#x80CC;&#x666F;</code>&#xFF0C;&#x8FD9;&#x6837;&#x80FD;&#x8BA9;&#x7528;&#x6237;&#x5728;&#x89C6;&#x89C9;&#x4E0A;&#x611F;&#x89C9;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x5F88;&#x5FEB;&#xFF0C;&#x51B7;&#x542F;&#x52A8;&#x8FC7;&#x7A0B;&#x4E2D;&#x7684;&#x7B2C;&#x4E00;&#x6B65;&#x662F;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;<code>&#x7A7A;&#x767D; Window</code> &#xFF0C;&#x901A;&#x8FC7;&#x81EA;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;<code>&#x4E3B;&#x9898; Theme</code> &#x5E76;&#x8BBE;&#x7F6E;&#x7ED9;&#x95EA;&#x5C4F;&#x9875;&#xFF0C;&#x5C31;&#x80FD;&#x8BA9;&#x8FD9;&#x4E2A;&#x7A7A;&#x767D; Window &#x663E;&#x793A;&#x5360;&#x4F4D;&#x56FE;&#x3002;</p>
<p><code>onCreate() &#x4F18;&#x5316;</code>&#x6709;<code>&#x5F02;&#x6B65;&#x521D;&#x59CB;&#x5316;</code>&#x3001;<code>&#x542F;&#x52A8;&#x5668;</code>&#x4EE5;&#x53CA;<code>&#x5EF6;&#x8FDF;&#x521D;&#x59CB;&#x5316;</code>&#x548C;<code>&#x5EF6;&#x8FDF;&#x542F;&#x52A8;&#x5668;</code>&#x8FD9; 4 &#x4E2A;&#x65B9;&#x6848;&#x3002;</p>
<p><code>&#x5F02;&#x6B65;&#x521D;&#x59CB;&#x5316;</code>&#x6307;&#x7684;&#x662F;&#x628A;&#x521D;&#x59CB;&#x5316;&#x5DE5;&#x4F5C;&#x7EC6;&#x5206;&#x4E3A;&#x51E0;&#x4E2A;&#x5B50;&#x4EFB;&#x52A1;&#x5E76;&#x653E;&#x5230;&#x5B50;&#x7EBF;&#x7A0B;&#x4E2D;&#xFF0C;&#x7136;&#x540E;&#x628A;&#x8FD9;&#x4E9B;&#x5B50;&#x7EBF;&#x7A0B;&#x63D0;&#x4EA4;&#x5230;&#x7EBF;&#x7A0B;&#x6C60;&#x4E2D;&#xFF0C;&#x51CF;&#x5C11;&#x4E3B;&#x7EBF;&#x7A0B;&#x7684;&#x5DE5;&#x4F5C;&#x3002;&#x6709;&#x7684;&#x521D;&#x59CB;&#x5316;&#x4EE3;&#x7801;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x5728; Application &#x7684; onCreate() &#x65B9;&#x6CD5;&#x7ED3;&#x675F;&#x524D;&#x6267;&#x884C;&#x5B8C;&#x6210;&#xFF0C;&#x8FD9;&#x65F6;&#x53EF;&#x4EE5;&#x8003;&#x8651;&#x7528; <code>CountDownLatch</code> &#x7B49;&#x5F85;&#x8BE5;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x3002;&#x5F02;&#x6B65;&#x521D;&#x59CB;&#x5316;&#x65B9;&#x6848;&#x7684;&#x7F3A;&#x70B9;&#x662F;<code>&#x65E0;&#x6CD5;&#x5EFA;&#x7ACB;&#x4EFB;&#x52A1;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;</code>&#xFF0C;&#x6BD4;&#x5982;&#x6781;&#x5149;&#x63A8;&#x9001;&#x9700;&#x8981;&#x7528;&#x5230;&#x8BBE;&#x5907; ID &#xFF0C;&#x800C;&#x8BBE;&#x5907; ID &#x521D;&#x59CB;&#x5316;&#x5728;&#x53E6;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x4E2D;&#x6267;&#x884C;&#x3002;</p>
<p><code>&#x542F;&#x52A8;&#x5668;</code>&#x4F18;&#x5316;&#x65B9;&#x6848;&#x5C31;&#x662F;&#xFF0C;&#x9996;&#x5148;&#x628A;&#x521D;&#x59CB;&#x5316;&#x4EE3;&#x7801;<code>&#x62C6;&#x5206;&#x4E3A;&#x4E0D;&#x540C;&#x7684;&#x4EFB;&#x52A1;</code>&#xFF0C;&#x7136;&#x540E;&#x6839;&#x636E;&#x4EFB;&#x52A1;&#x7684;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#x6392;&#x5E8F;<code>&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x6709;&#x5411;&#x65E0;&#x73AF;&#x56FE;</code>&#xFF0C;&#x8FD9;&#x4E2A;&#x56FE;&#x662F;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;&#xFF0C;&#x6700;&#x540E;<code>&#x6839;&#x636E;&#x6392;&#x5E8F;&#x540E;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x4F9D;&#x6B21;&#x6267;&#x884C;&#x4EFB;&#x52A1;</code>&#x3002;&#x4EFB;&#x52A1;&#x53EF;&#x4EE5;&#x5206;&#x4E3A; <code>&#x521D;&#x59CB;&#x5316;&#x524D;&#x6267;&#x884C;&#x7684;&#x4EFB;&#x52A1;</code>&#x3001;<code>&#x521D;&#x59CB;&#x5316;&#x540E;&#x6267;&#x884C;&#x7684;&#x4EFB;&#x52A1;</code>&#x3001;<code>&#x521D;&#x59CB;&#x5316;&#x4EFB;&#x52A1;</code>&#x4EE5;&#x53CA;<code>&#x7A7A;&#x95F2;&#x65F6;&#x6267;&#x884C;&#x7684;&#x4EFB;&#x52A1;</code>&#x3002;<code>&#x521D;&#x59CB;&#x5316;&#x4EFB;&#x52A1;</code>&#x53C8;&#x53EF;&#x5206;&#x4E3A;<code>&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x7684;&#x4EFB;&#x52A1;</code>&#x548C;<code>&#x5728;&#x5B50;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x7684;&#x4EFB;&#x52A1;</code>&#x3002;</p>
<p><code>&#x5EF6;&#x8FDF;&#x521D;&#x59CB;&#x5316;</code>&#x4F18;&#x5316;&#x65B9;&#x6848;&#xFF0C;&#x5C31;&#x662F;&#x628A;&#x4F18;&#x5148;&#x7EA7;&#x4E0D;&#x9AD8;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x542F;&#x52A8;&#x5B8C;&#x6210;&#x540E;&#x6267;&#x884C;&#x7684;&#x521D;&#x59CB;&#x5316;&#x4EFB;&#x52A1;&#x5EF6;&#x8FDF;&#x5230;&#x542F;&#x52A8;&#x5B8C;&#x6210;&#x540E;&#x6267;&#x884C;&#x3002;&#x6BD4;&#x5982;&#x653E;&#x5728;&#x5217;&#x8868;&#x7B2C;&#x4E00;&#x9879;&#x7684; View &#x7684; <code>ViewTreeObserver</code> &#x7684; <code>onPreDraw()</code> &#x56DE;&#x8C03;&#x6216;&#x7528; Handler &#x7684; <code>postDelayed()</code> &#x65B9;&#x6CD5;&#x63D0;&#x4EA4;&#x5230;&#x6D88;&#x606F;&#x961F;&#x5217;&#x4E2D;&#x5EF6;&#x8FDF;&#x6267;&#x884C;&#x3002;&#x5EF6;&#x8FDF;&#x542F;&#x52A8;&#x5668;&#x7684;&#x7F3A;&#x70B9;&#x662F;<code>&#x5EF6;&#x8FDF;&#x6267;&#x884C;&#x540E;&#x9875;&#x9762;&#x65E0;&#x6CD5;&#x6ED1;&#x52A8;</code>&#x3002;</p>
<p><code>&#x5EF6;&#x8FDF;&#x542F;&#x52A8;&#x5668;</code>&#x4F18;&#x5316;&#x65B9;&#x6848;&#x5C31;&#x662F;&#x5229;&#x7528; <code>IdleHandler</code> &#x5B9E;&#x73B0;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x7A7A;&#x95F2;&#x65F6;&#x518D;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#xFF0C;&#x8FD9;&#x6837;&#x4E00;&#x65B9;&#x9762;&#x4EFB;&#x52A1;&#x5EF6;&#x8FDF;&#x6267;&#x884C;&#x4E86;&#xFF0C;&#x53E6;&#x4E00;&#x65B9;&#x9762;&#x4E5F;&#x4E0D;&#x4F1A;&#x5F71;&#x54CD;&#x7528;&#x6237;&#x64CD;&#x4F5C;&#x3002;</p>
<p><code>MultiDex &#x4F18;&#x5316;</code>&#x6709; <code>BoostMultidex</code>&#x3002;</p>
<ol start="2">
<li>&#x79CD;&#x542F;&#x52A8;&#x72B6;&#x6001;</li>
</ol>
<hr>
<p>&#x8C37;&#x6B4C;&#x5B98;&#x65B9;&#x628A; App &#x7684;&#x542F;&#x52A8;&#x5206;&#x4E3A;&#x4E86;<code>&#x70ED;&#x542F;&#x52A8;</code>&#x3001;<code>&#x6696;&#x542F;&#x52A8;</code>&#x548C;<code>&#x51B7;&#x542F;&#x52A8;</code>&#x4E09;&#x79CD;&#x72B6;&#x6001;&#x3002;</p>
<p><code>&#x70ED;&#x542F;&#x52A8;&#x662F;&#x4E09;&#x79CD;&#x542F;&#x52A8;&#x72B6;&#x6001;&#x4E2D;&#x662F;&#x6700;&#x5FEB;&#x7684;&#x4E00;&#x79CD;</code>&#xFF0C;&#x56E0;&#x4E3A;&#x70ED;&#x542F;&#x52A8;&#x662F;&#x4ECE;&#x540E;&#x53F0;&#x5207;&#x5230;&#x4E86;&#x524D;&#x53F0;&#xFF0C;&#x5E94;&#x7528;&#x7684; Activity &#x8FD8;&#x9A7B;&#x7559;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#xFF0C;&#x5E94;&#x7528;&#x4E0D;&#x9700;&#x8981;&#x91CD;&#x590D;&#x6267;&#x884C;&#x5BF9;&#x8C61;&#x521D;&#x59CB;&#x5316;&#x64CD;&#x4F5C;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x518D;&#x521B;&#x5EFA; Applicaiton&#xFF0C;&#x4E5F;&#x4E0D;&#x9700;&#x8981;&#x518D;&#x8FDB;&#x884C;&#x6E32;&#x67D3;&#x5E03;&#x5C40;&#x7B49;&#x64CD;&#x4F5C;&#x3002;</p>
<p><code>&#x6696;&#x542F;&#x52A8;&#x53EA;&#x4F1A;&#x91CD;&#x8D70; Activity &#x7684;&#x751F;&#x547D;&#x5468;&#x671F;</code>&#xFF0C;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x4ECB;&#x4E8E;&#x51B7;&#x542F;&#x52A8;&#x548C;&#x70ED;&#x542F;&#x52A8;&#x4E4B;&#x95F4;&#xFF0C;&#x6696;&#x542F;&#x52A8;&#x53EA;&#x4F1A;&#x91CD;&#x8D70; Activity &#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x521B;&#x5EFA;&#x8FDB;&#x7A0B;&#x548C; Application&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/d51fbf9697bcbb81014b5e80b3e3e87808b8f5f09516b9ed13a1ef73400f41b1" alt="891626505188_.pic_hd.jpg"></p>
<p><code>&#x51B7;&#x542F;&#x52A8;&#x7ECF;&#x5386;&#x4E86;&#x521B;&#x5EFA;&#x8FDB;&#x7A0B;&#x3001;&#x542F;&#x52A8;&#x5E94;&#x7528;&#x548C;&#x7ED8;&#x5236;&#x754C;&#x9762;&#x4E00;&#x7CFB;&#x5217;&#x6D41;&#x7A0B;&#xFF0C;&#x662F;&#x8017;&#x65F6;&#x6700;&#x591A;&#x7684;&#xFF0C;&#x4E5F;&#x662F;&#x5E38;&#x89C1;&#x7684;&#x542F;&#x52A8;&#x4F18;&#x5316;&#x7684;&#x8861;&#x91CF;&#x6807;&#x51C6;</code>&#xFF0C;&#x4E00;&#x822C;&#x5728;&#x7EBF;&#x4E0A;&#x8FDB;&#x884C;&#x7684;&#x542F;&#x52A8;&#x4F18;&#x5316;&#x90FD;&#x662F;&#x4EE5;&#x51B7;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x4E3A;&#x6307;&#x6807;&#x7684;&#x3002;</p>
<p>&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x7684;&#x4F18;&#x5316;&#x65B9;&#x5411;&#x662F; Application &#x548C; Activity &#x751F;&#x547D;&#x5468;&#x671F;&#x9636;&#x6BB5;&#xFF0C;&#x6BD4;&#x5982; Application &#x7684; <code>onCreate()</code> &#x548C; <code>attachBaseContext()</code> &#x8FD9;&#x4E24;&#x4E2A;&#x751F;&#x547D;&#x5468;&#x671F;&#x56DE;&#x8C03;&#x65B9;&#x6CD5;&#x7684;&#x6267;&#x884C;&#x65F6;&#x95F4;&#xFF0C;&#x5728; Application &#x548C; Activity &#x7684;&#x56DE;&#x8C03;&#x65B9;&#x6CD5;&#x4E2D;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#x662F;&#x6211;&#x4EEC;&#x5F00;&#x53D1;&#x8005;&#x80FD;&#x63A7;&#x5236;&#xFF0C;&#x5176;&#x4ED6;&#x9636;&#x6BB5;&#x90FD;&#x662F;&#x7CFB;&#x7EDF;&#x505A;&#x7684;&#x3002;</p>
<p>&#x51B7;&#x542F;&#x52A8;&#x6D41;&#x7A0B;&#x53EF;&#x4EE5;&#x5206;&#x4E3A;&#x4E09;&#x6B65;&#xFF1A;<code>&#x521B;&#x5EFA;&#x8FDB;&#x7A0B;</code>&#x3001;<code>&#x542F;&#x52A8;&#x5E94;&#x7528;</code>&#x548C;<code>&#x7ED8;&#x5236;&#x754C;&#x9762;</code>&#xFF0C;&#x521B;&#x5EFA;&#x8FDB;&#x7A0B;&#x9636;&#x6BB5;&#x7684;&#x4E09;&#x4EF6;&#x4E8B;&#x90FD;&#x662F;&#x7CFB;&#x7EDF;&#x505A;&#x7684;&#xFF0C;&#x4ECE;&#x542F;&#x52A8;&#x5E94;&#x7528;&#x9636;&#x6BB5;&#x5F00;&#x59CB;&#xFF0C;&#x968F;&#x540E;&#x7684;&#x4EFB;&#x52A1;&#x548C;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x5199;&#x7684;&#x4EE3;&#x7801;&#x6709;&#x4E00;&#x5B9A;&#x7684;&#x5173;&#x7CFB;&#x3002;</p>
<ol start="3">
<li>&#x4E09;&#x4E2A;&#x542F;&#x52A8;&#x95EE;&#x9898;</li>
</ol>
<hr>
<p>&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x6162;&#x5177;&#x4F53;&#x7684;&#x8868;&#x73B0;&#x6709;<code>&#x70B9;&#x51FB;&#x56FE;&#x6807;&#x54CD;&#x5E94;&#x6162;</code>&#x3001;<code>&#x9996;&#x9875;&#x663E;&#x793A;&#x6162;</code>&#x548C;<code>&#x663E;&#x793A;&#x540E;&#x65E0;&#x6CD5;&#x64CD;&#x4F5C;</code>&#x4E09;&#x4E2A;&#x3002;</p>
<h5 id="1-&#x70B9;&#x51FB;&#x56FE;&#x6807;&#x54CD;&#x5E94;&#x6162;"><a href="#1-&#x70B9;&#x51FB;&#x56FE;&#x6807;&#x54CD;&#x5E94;&#x6162;" class="headerlink" title="1. &#x70B9;&#x51FB;&#x56FE;&#x6807;&#x54CD;&#x5E94;&#x6162;"></a>1. &#x70B9;&#x51FB;&#x56FE;&#x6807;&#x54CD;&#x5E94;&#x6162;</h5><p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x6307;&#x5B9A;&#x4E86;&#x900F;&#x660E;&#x7684;&#x4E3B;&#x9898;&#xFF0C;&#x90A3;&#x7528;&#x6237;&#x70B9;&#x51FB;&#x684C;&#x9762;&#x56FE;&#x6807;&#x540E;&#xFF0C;&#x9700;&#x8981;&#x5728; Application &#x521B;&#x5EFA;&#x548C;&#x95EA;&#x5C4F;&#x9875;&#x521B;&#x5EFA;&#x5B8C;&#x6210;&#x540E;&#x624D;&#x80FD;&#x770B;&#x5230;&#x5546;&#x54C1;&#xFF0C;&#x4ECE;&#x7528;&#x6237;&#x7684;&#x89D2;&#x5EA6;&#x6765;&#x770B;&#xFF0C;&#x5C31;&#x662F;&#x70B9;&#x51FB;&#x4E86;&#x56FE;&#x6807;&#xFF0C;&#x7ED3;&#x679C;&#x8FC7;&#x4E86;&#x51E0;&#x79D2;&#x8FD8;&#x662F;&#x505C;&#x5728;&#x684C;&#x9762;&#xFF0C;&#x5C31;&#x50CF;&#x662F;&#x70B9;&#x51FB;&#x65E0;&#x6548;&#x4E00;&#x6837;&#x3002;</p>
<h5 id="2-&#x9996;&#x9875;&#x663E;&#x793A;&#x6162;"><a href="#2-&#x9996;&#x9875;&#x663E;&#x793A;&#x6162;" class="headerlink" title="2. &#x9996;&#x9875;&#x663E;&#x793A;&#x6162;"></a>2. &#x9996;&#x9875;&#x663E;&#x793A;&#x6162;</h5><p>&#x73B0;&#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x6D41;&#x7A0B;&#x8D8A;&#x6765;&#x8D8A;&#x590D;&#x6742;&#xFF0C;&#x95EA;&#x5C4F;&#x5E7F;&#x544A;&#x3001;&#x70ED;&#x4FEE;&#x590D;&#x3001;&#x63D2;&#x4EF6;&#x5316;&#x6846;&#x67B6;&#x7B49;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x51C6;&#x5907;&#x5DE5;&#x4F5C;&#x90FD;&#x8981;&#x5728;&#x542F;&#x52A8;&#x9636;&#x6BB5;&#x5B8C;&#x6210;&#xFF0C;&#x5728;&#x4E2D;&#x4F4E;&#x7AEF;&#x673A;&#x4E0A;&#x53EF;&#x80FD;&#x8981;&#x5341;&#x51E0;&#x79D2;&#x624D;&#x80FD;&#x542F;&#x52A8;&#xFF0C;&#x96BE;&#x4EE5;&#x5FCD;&#x53D7;&#x3002;</p>
<h5 id="3-&#x9996;&#x9875;&#x663E;&#x793A;&#x540E;&#x65E0;&#x6CD5;&#x64CD;&#x4F5C;"><a href="#3-&#x9996;&#x9875;&#x663E;&#x793A;&#x540E;&#x65E0;&#x6CD5;&#x64CD;&#x4F5C;" class="headerlink" title="3. &#x9996;&#x9875;&#x663E;&#x793A;&#x540E;&#x65E0;&#x6CD5;&#x64CD;&#x4F5C;"></a>3. &#x9996;&#x9875;&#x663E;&#x793A;&#x540E;&#x65E0;&#x6CD5;&#x64CD;&#x4F5C;</h5><p>&#x5047;&#x5982;&#x628A;&#x521D;&#x59CB;&#x5316;&#x5DE5;&#x4F5C;&#x901A;&#x8FC7;&#x4E0D;&#x6070;&#x5F53;&#x7684;&#x65B9;&#x5F0F;&#x5EF6;&#x8FDF;&#x6267;&#x884C;&#xFF0C;&#x5C31;&#x6709;&#x53EF;&#x80FD;&#x51FA;&#x73B0;&#x9996;&#x9875;&#x51FA;&#x6765;&#x540E;&#x6839;&#x672C;&#x65E0;&#x6CD5;&#x64CD;&#x4F5C;&#xFF0C;&#x5047;&#x5982;&#x7528;&#x6237;&#x770B;&#x5230;&#x4E86;&#x9996;&#x9875;&#xFF0C;&#x4F46;&#x662F;&#x8981;&#x7B49;&#x8FC7;&#x5341;&#x51E0;&#x79D2;&#x540E;&#x624D;&#x80FD;&#x6ED1;&#x52A8;&#xFF0C;&#x90A3;&#x8FD9;&#x4E2A;&#x4F18;&#x5316;&#x7684;&#x610F;&#x4E49;&#x5C31;&#x975E;&#x5E38;&#x5C0F;&#x4E86;&#xFF0C;&#x542F;&#x52A8;&#x4F18;&#x5316;&#x4E0D;&#x80FD;&#x628A;&#x6CE8;&#x610F;&#x529B;&#x90FD;&#x653E;&#x5728;&#x9996;&#x5E27;&#x7ED8;&#x5236;&#x65F6;&#x95F4;&#x4E0A;&#xFF0C;&#x800C;&#x662F;&#x8981;&#x4ECE;&#x7528;&#x6237;&#x7684;&#x771F;&#x5B9E;&#x4F53;&#x9A8C;&#x89E6;&#x53D1;&#xFF0C;&#x4ECE;&#x7528;&#x6237;&#x70B9;&#x51FB;&#x56FE;&#x6807;&#x5230;&#x53EF;&#x64CD;&#x4F5C;&#x7684;&#x6574;&#x4E2A;&#x8FC7;&#x7A0B;&#x7684;&#x6267;&#x884C;&#x901F;&#x5EA6;&#xFF0C;&#x90FD;&#x662F;&#x542F;&#x52A8;&#x4F18;&#x5316;&#x8981;&#x89E3;&#x51B3;&#x7684;&#x95EE;&#x9898;&#x3002;</p>
<ol start="4">
<li>&#x4E24;&#x79CD;&#x6D4B;&#x91CF;&#x65B9;&#x6CD5;</li>
</ol>
<hr>
<p>&#x4E0B;&#x9762;&#x6765;&#x770B;&#x4E00;&#x4E0B;&#x5E38;&#x7528;&#x7684;&#x4E24;&#x79CD;&#x6D4B;&#x91CF;&#x542F;&#x52A8;&#x65F6;&#x95F4;&#x7684;&#x65B9;&#x6CD5;&#xFF1A;<code>&#x547D;&#x4EE4;&#x6D4B;&#x91CF;</code>&#x548C;<code>&#x57CB;&#x70B9;&#x6D4B;&#x91CF;</code>&#x3002;</p>
<h5 id="1-&#x547D;&#x4EE4;&#x6D4B;&#x91CF;"><a href="#1-&#x547D;&#x4EE4;&#x6D4B;&#x91CF;" class="headerlink" title="1. &#x547D;&#x4EE4;&#x6D4B;&#x91CF;"></a>1. &#x547D;&#x4EE4;&#x6D4B;&#x91CF;</h5><p>&#x547D;&#x4EE4;&#x6D4B;&#x91CF;&#x6307;&#x7684;&#x662F;&#x7528; adb &#x547D;&#x4EE4;&#x6D4B;&#x91CF;&#x542F;&#x52A8;&#x65F6;&#x95F4;&#xFF0C;&#x5728;&#x8F93;&#x5165;&#x6D4B;&#x91CF;&#x547D;&#x4EE4;&#x540E;&#x5C31;&#x80FD;&#x770B;&#x5230;&#x6D4B;&#x91CF;&#x7ED3;&#x679C;&#x3002;</p>
<p>&#x9996;&#x5148;&#x6253;&#x5F00;&#x7EC8;&#x7AEF;&#xFF0C;&#x8F93;&#x5165; <code>adb shell am start -W packagename/&#x9996;&#x5C4F; Activity</code> &#x6253;&#x5F00;&#x6211;&#x4EEC;&#x8981;&#x6D4B;&#x91CF;&#x7684;&#x5E94;&#x7528;&#xFF0C;&#x6253;&#x5F00;&#x540E;&#x7CFB;&#x7EDF;&#x4F1A;&#x8F93;&#x51FA;&#x5E94;&#x7528;&#x7684;&#x542F;&#x52A8;&#x65F6;&#x95F4;&#xFF0C;<code>-W</code> &#x9009;&#x9879;&#x8868;&#x793A;&#x7B49;&#x5F85;&#x542F;&#x52A8;&#x5B8C;&#x6210;&#x3002;</p>
<p>&#x9996;&#x5C4F; Activity &#x4E5F;&#x8981;&#x52A0;&#x4E0A;&#x5305;&#x540D;&#xFF0C;&#x6BD4;&#x5982;&#x4E0B;&#x9762;&#x8FD9;&#x6837;&#x7684;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/d86cc81c855c0fb23d17f89860718ff44ce9f23ad406366adba2ee394a4d5151" alt="adb &#x547D;&#x4EE4;2.png"></p>
<p>&#x5728;&#x8BE5;&#x547D;&#x4EE4;&#x6267;&#x884C;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x8F93;&#x51FA;&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x5230; <code>ThisTime</code>&#x3001;<code>TotalTime</code> &#x548C; <code>WaitTime</code>&#x4E09;&#x4E2A;&#x503C;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/52c2f887edcd707a220ae5fa139783fd117b9d4f804bce085853eb8558cf1971" alt="adb &#x8F93;&#x51FA;&#x7ED3;&#x679C;.png"></p>
<p><code>ThisTime &#x4EE3;&#x8868;&#x6700;&#x540E;&#x4E00;&#x4E2A; Activity &#x542F;&#x52A8;&#x6240;&#x9700;&#x8981;&#x7684;&#x65F6;&#x95F4;</code>&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6700;&#x540E;&#x4E00;&#x4E2A; Activity &#x7684;&#x542F;&#x52A8;&#x8017;&#x65F6;&#x3002;</p>
<p><code>TotalTime &#x4EE3;&#x8868;&#x6240;&#x6709; Activity &#x542F;&#x52A8;&#x8017;&#x65F6;</code>&#xFF0C;&#x5728;&#x4E0A;&#x9762;&#x7684;&#x8F93;&#x51FA;&#x4E2D;&#xFF0C;TotalTime &#x548C; ThisTime &#x662F;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x4E2A; Demo &#x6CA1;&#x6709;&#x5199; Splash &#x754C;&#x9762;&#x3002;</p>
<p>&#x4E5F;&#x5C31;&#x662F;&#x8FD9;&#x4E2A; App &#x6253;&#x5F00;&#x4E86; Application &#x540E;&#x5C31;&#x76F4;&#x63A5;&#x6253;&#x5F00;&#x4E86; MainActivity &#x754C;&#x9762;&#xFF0C;&#x6CA1;&#x6709;&#x542F;&#x52A8;&#x5176;&#x4ED6;&#x9875;&#x9762;&#x3002;</p>
<p><code>WaitTime &#x662F; AMS &#x542F;&#x52A8; Activity &#x7684;&#x603B;&#x8017;&#x65F6;&#x3002;</code></p>
<p>&#x8FD9;&#x4E09;&#x8005;&#x4E4B;&#x95F4;&#x7684;&#x5173;&#x7CFB;&#x4E3A; <code>ThisTime &lt;= TotalToime &lt; WaitTime</code>&#x3002;</p>
<p>&#x9664;&#x4E86; -W &#xFF0C;start &#x8FD8;&#x652F;&#x6301;&#x4E0B;&#x9762;&#x8FD9;&#x4E9B;&#x9009;&#x9879;&#x3002;</p>
<ul>
<li><code>-D</code>&#xFF0C; &#x542F;&#x52A8;&#x8C03;&#x8BD5;&#x529F;&#x80FD;</li>
<li><code>--start-profiler</code> <strong>file</strong>&#xFF0C;&#x542F;&#x52A8;&#x6027;&#x80FD;&#x5206;&#x6790;&#x5668;&#x5E76;&#x628A;&#x7ED3;&#x679C;&#x53D1;&#x9001;&#x5230;&#x6307;&#x5B9A;&#x6587;&#x4EF6;</li>
<li><code>-P</code> <strong>file</strong>&#xFF0C;&#x7C7B;&#x4F3C;&#x4E8E;&#x542F;&#x52A8;&#x6027;&#x80FD;&#x5206;&#x6790;&#x5668;&#xFF0C;&#x4F46;&#x662F;&#x4F1A;&#x5728;&#x5E94;&#x7528;&#x8FDB;&#x5165;&#x7A7A;&#x95F2;&#x72B6;&#x6001;&#x65F6;&#x505C;&#x6B62;&#x5206;&#x6790;</li>
<li><code>-R</code> <strong>count</strong>&#xFF0C;&#x91CD;&#x590D;&#x542F;&#x52A8; Activity <code>count</code> &#x6B21;&#x6570;&#xFF0C;&#x5728;&#x6BCF;&#x6B21;&#x91CD;&#x590D;&#x524D;&#xFF0C;&#x4F1A;&#x5B8C;&#x6210;&#x9876;&#x5C42; Activity</li>
<li><code>-S</code> &#xFF0C;&#x5728;&#x542F;&#x52A8; Activity &#x524D;&#xFF0C;&#x5F3A;&#x884C;&#x505C;&#x6B62;&#x76EE;&#x6807;&#x5E94;&#x7528;</li>
<li><code>--opengl-trace</code> &#xFF0C;&#x542F;&#x52A8; OpenGL &#x51FD;&#x6570;&#x7684;&#x8DDF;&#x8E2A;</li>
<li><code>--user</code> <strong>user_id | current</strong> &#xFF0C;&#x6307;&#x5B9A;&#x8981;&#x4E3A;&#x54EA;&#x4E2A;&#x7528;&#x6237;&#x8FD0;&#x884C;&#xFF0C;&#x5982;&#x679C;&#x672A;&#x6307;&#x5B9A;&#xFF0C;&#x5219;&#x4F5C;&#x4E3A;&#x5F53;&#x524D;&#x7528;&#x6237;&#x8FD0;&#x884C;</li>
</ul>
<h3 id="3-2-&#x57CB;&#x70B9;&#x6D4B;&#x91CF;"><a href="#3-2-&#x57CB;&#x70B9;&#x6D4B;&#x91CF;" class="headerlink" title="3.2 &#x57CB;&#x70B9;&#x6D4B;&#x91CF;"></a>3.2 &#x57CB;&#x70B9;&#x6D4B;&#x91CF;</h3><p>&#x57CB;&#x70B9;&#x6D4B;&#x91CF;&#x6307;&#x7684;&#x662F;&#x6211;&#x4EEC;&#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x9636;&#x6BB5;&#x57CB;&#x4E00;&#x4E2A;&#x70B9;&#xFF0C;&#x5728;&#x542F;&#x52A8;&#x7ED3;&#x675F;&#x65F6;&#x518D;&#x57CB;&#x4E00;&#x4E2A;&#x70B9;&#xFF0C;&#x4E24;&#x8005;&#x4E4B;&#x95F4;&#x7684;&#x5DEE;&#x503C;&#x5C31;&#x662F; App &#x7684;&#x542F;&#x52A8;&#x8017;&#x65F6;&#x3002;</p>
<p>&#x901A;&#x8FC7;&#x4E0B;&#x9762;<code>&#x5B9A;&#x4E49;&#x57CB;&#x70B9;&#x5DE5;&#x5177;&#x7C7B;</code>&#x3001;<code>&#x8BB0;&#x5F55;&#x542F;&#x52A8;&#x65F6;&#x95F4;</code>&#x548C;<code>&#x8BA1;&#x7B97;&#x542F;&#x52A8;&#x8017;&#x65F6;</code>&#x4E09;&#x6B65;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x57CB;&#x70B9;&#x6D4B;&#x91CF;&#x3002;</p>
<h5 id="1-&#x5B9A;&#x4E49;&#x57CB;&#x70B9;&#x5DE5;&#x5177;&#x7C7B;"><a href="#1-&#x5B9A;&#x4E49;&#x57CB;&#x70B9;&#x5DE5;&#x5177;&#x7C7B;" class="headerlink" title="1. &#x5B9A;&#x4E49;&#x57CB;&#x70B9;&#x5DE5;&#x5177;&#x7C7B;"></a>1. &#x5B9A;&#x4E49;&#x57CB;&#x70B9;&#x5DE5;&#x5177;&#x7C7B;</h5><p>&#x4F7F;&#x7528;&#x57CB;&#x70B9;&#x6D4B;&#x91CF;&#x7684;&#x7B2C;&#x4E00;&#x6B65;&#x662F;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x8BB0;&#x5F55;&#x57CB;&#x70B9;&#x5DE5;&#x5177;&#x7C7B;&#x3002;</p>
<p>&#x5728;&#x8FD9;&#x91CC;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x9664;&#x4E86; System.currentTimeMillis() &#x4EE5;&#x5916;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x7528; SystemClock.currentThreadTimeMillis() &#x8BB0;&#x5F55;&#x65F6;&#x95F4;&#x3002;</p>
<p>&#x901A;&#x8FC7; SystemClock &#x62FF;&#x5230;&#x7684;&#x662F; CPU &#x771F;&#x6B63;&#x6267;&#x884C;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x8FD9;&#x4E2A;&#x65F6;&#x95F4;&#x4E0E;&#x4E0B;&#x4E00;&#x5927;&#x8282;&#x8981;&#x8BB2;&#x7684; Systrace &#x4E0A;&#x8BB0;&#x5F55;&#x7684;&#x65F6;&#x95F4;&#x70B9;&#x662F;&#x4E00;&#x6837;&#x7684;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/9c5e60c3532df6bc545ff5d91aed948e9c83902ed67698ffe2bcd1cde7f0ec2b" alt="LaunchTimer.png"></p>
<h5 id="2-&#x8BB0;&#x5F55;&#x542F;&#x52A8;&#x65F6;&#x95F4;"><a href="#2-&#x8BB0;&#x5F55;&#x542F;&#x52A8;&#x65F6;&#x95F4;" class="headerlink" title="2. &#x8BB0;&#x5F55;&#x542F;&#x52A8;&#x65F6;&#x95F4;"></a>2. &#x8BB0;&#x5F55;&#x542F;&#x52A8;&#x65F6;&#x95F4;</h5><p>&#x4F7F;&#x7528;&#x57CB;&#x70B9;&#x6D4B;&#x91CF;&#x7684;&#x7B2C;&#x4E8C;&#x6B65;&#x662F;&#x8BB0;&#x5F55;&#x542F;&#x52A8;&#x65F6;&#x95F4;&#x3002;</p>
<p>&#x5F00;&#x59CB;&#x8BB0;&#x5F55;&#x7684;&#x4F4D;&#x7F6E;&#x653E;&#x5728; Application &#x7684; attachBaseContext &#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;attachBaseContext &#x662F;&#x6211;&#x4EEC;&#x5E94;&#x7528;&#x80FD;&#x63A5;&#x6536;&#x5230;&#x7684;&#x6700;&#x65E9;&#x7684;&#x4E00;&#x4E2A;&#x751F;&#x547D;&#x5468;&#x671F;&#x56DE;&#x8C03;&#x65B9;&#x6CD5;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/806a75fb358d6ab10329eaa41c974dadb55dd48a47efcd8d44fea464a951e5f8" alt="&#x8BB0;&#x5F55;&#x542F;&#x52A8;&#x65F6;&#x95F4;.png"></p>
<h5 id="3-&#x8BA1;&#x7B97;&#x542F;&#x52A8;&#x8017;&#x65F6;"><a href="#3-&#x8BA1;&#x7B97;&#x542F;&#x52A8;&#x8017;&#x65F6;" class="headerlink" title="3. &#x8BA1;&#x7B97;&#x542F;&#x52A8;&#x8017;&#x65F6;"></a>3. &#x8BA1;&#x7B97;&#x542F;&#x52A8;&#x8017;&#x65F6;</h5><p>&#x8BA1;&#x7B97;&#x542F;&#x52A8;&#x8017;&#x65F6;&#x7684;&#x4E00;&#x4E2A;&#x8BEF;&#x533A;&#x5C31;&#x662F;&#x5728; <code>onWindowFocusChanged()</code> &#x65B9;&#x6CD5;&#x4E2D;&#x8BA1;&#x7B97;&#x542F;&#x52A8;&#x8017;&#x65F6;&#x3002;</p>
<p><code>onWindowFocusChanged()</code> &#x65B9;&#x6CD5;&#x53EA;&#x662F; Activity &#x7684;&#x9996;&#x5E27;&#x65F6;&#x95F4;&#xFF0C;&#x662F; Activity &#x9996;&#x6B21;&#x8FDB;&#x884C;&#x7ED8;&#x5236;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x9996;&#x5E27;&#x65F6;&#x95F4;&#x548C;&#x754C;&#x9762;&#x5B8C;&#x6574;&#x5C55;&#x793A;&#x51FA;&#x6765;&#x8FD8;&#x6709;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x5DEE;&#xFF0C;&#x4E0D;&#x80FD;&#x771F;&#x6B63;&#x4EE3;&#x8868;&#x754C;&#x9762;&#x5DF2;&#x7ECF;&#x5C55;&#x73B0;&#x51FA;&#x6765;&#x4E86;&#x3002;</p>
<p>&#x6309;&#x9996;&#x5E27;&#x65F6;&#x95F4;&#x8BA1;&#x7B97;&#x542F;&#x52A8;&#x8017;&#x65F6;&#x5E76;&#x4E0D;&#x51C6;&#x786E;&#xFF0C;&#x6211;&#x4EEC;&#x8981;&#x7684;&#x662F;&#x7528;&#x6237;&#x771F;&#x6B63;&#x770B;&#x5230;&#x6211;&#x4EEC;&#x754C;&#x9762;&#x7684;&#x65F6;&#x95F4;&#x3002;</p>
<p>&#x6B63;&#x786E;&#x7684;&#x8BA1;&#x7B97;&#x542F;&#x52A8;&#x8017;&#x65F6;&#x7684;&#x65F6;&#x673A;&#x662F;&#x8981;&#x7B49;&#x771F;&#x5B9E;&#x7684;&#x6570;&#x636E;&#x5C55;&#x793A;&#x51FA;&#x6765;&#xFF0C;&#x6BD4;&#x5982;&#x5728;&#x5217;&#x8868;&#x7B2C;&#x4E00;&#x9879;&#x7684;&#x5C55;&#x793A;&#x65F6;&#x518D;&#x8BA1;&#x7B97;&#x542F;&#x52A8;&#x8017;&#x65F6;&#x3002;</p>
<p>&#x5728; Adapter &#x4E2D;&#x8BB0;&#x5F55;&#x542F;&#x52A8;&#x8017;&#x65F6;&#x8981;&#x52A0;&#x4E00;&#x4E2A;&#x5E03;&#x5C14;&#x503C;&#x53D8;&#x91CF;&#x8FDB;&#x884C;&#x5224;&#x65AD;&#xFF0C;&#x907F;&#x514D; onBindViewHolder &#x65B9;&#x6CD5;&#x88AB;&#x591A;&#x6B21;&#x8C03;&#x7528;&#x5BFC;&#x81F4;&#x4E0D;&#x5FC5;&#x8981;&#x7684;&#x8BA1;&#x7B97;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/eb7d2286e4f1549b073b10acb521717383d18a7dbbdb624011d560ef24e779f3" alt="&#x8BA1;&#x7B97;&#x542F;&#x52A8;&#x8017;&#x65F6;.png"></p>
<h3 id="3-3-&#x5C0F;&#x7ED3;"><a href="#3-3-&#x5C0F;&#x7ED3;" class="headerlink" title="3.3 &#x5C0F;&#x7ED3;"></a>3.3 &#x5C0F;&#x7ED3;</h3><h5 id="1-&#x547D;&#x4EE4;&#x6D4B;&#x91CF;-1"><a href="#1-&#x547D;&#x4EE4;&#x6D4B;&#x91CF;-1" class="headerlink" title="1. &#x547D;&#x4EE4;&#x6D4B;&#x91CF;"></a>1. &#x547D;&#x4EE4;&#x6D4B;&#x91CF;</h5><p><code>adb &#x547D;&#x4EE4;&#x6D4B;&#x91CF;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x7684;&#x65B9;&#x5F0F;&#x5728;&#x7EBF;&#x4E0B;&#x4F7F;&#x7528;&#x6BD4;&#x8F83;&#x65B9;&#x4FBF;&#xFF0C;&#x800C;&#x4E14;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x8FD8;&#x80FD;&#x7528;&#x4E8E;&#x6D4B;&#x91CF;&#x7ADE;&#x54C1;&#x3002;</code></p>
<p><code>adb &#x547D;&#x4EE4;&#x6D4B;&#x91CF;&#x7684;&#x7F3A;&#x70B9;&#x662F;&#x4E0D;&#x80FD;&#x5E26;&#x5230;&#x7EBF;&#x4E0A;&#x800C;&#x4E14;&#x4E0D;&#x80FD;&#x7CBE;&#x786E;&#x63A7;&#x5236;&#x542F;&#x52A8;&#x65F6;&#x95F4;&#x7684;&#x5F00;&#x59CB;&#x548C;&#x7ED3;&#x675F;</code>&#xFF0C;&#x5982;&#x679C;&#x4E00;&#x6761; adb &#x547D;&#x4EE4;&#x5E26;&#x5230;&#x7EBF;&#x4E0A;&#x53BB;&#xFF0C;&#x6CA1;&#x6709; app &#x4E5F;&#x6CA1;&#x6709;&#x7CFB;&#x7EDF;&#x5E2E;&#x6211;&#x4EEC;&#x6267;&#x884C;&#x8FD9;&#x4E00;&#x6761; adb &#x547D;&#x4EE4;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x62FF;&#x4E0D;&#x5230;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x80FD;&#x5E26;&#x5230;&#x7EBF;&#x4E0A;&#x3002;</p>
<h5 id="2-&#x57CB;&#x70B9;&#x6D4B;&#x91CF;"><a href="#2-&#x57CB;&#x70B9;&#x6D4B;&#x91CF;" class="headerlink" title="2. &#x57CB;&#x70B9;&#x6D4B;&#x91CF;"></a>2. &#x57CB;&#x70B9;&#x6D4B;&#x91CF;</h5><p><code>&#x57CB;&#x70B9;&#x6D4B;&#x91CF;&#x53EF;&#x4EE5;&#x7CBE;&#x786E;&#x63A7;&#x5236;&#x5F00;&#x59CB;&#x548C;&#x7ED3;&#x675F;&#x7684;&#x4F4D;&#x7F6E;&#x800C;&#x4E14;&#x53EF;&#x4EE5;&#x5E26;&#x5230;&#x7EBF;&#x4E0A;</code>&#xFF0C;&#x4F7F;&#x7528;&#x57CB;&#x70B9;&#x6D4B;&#x91CF;&#x8FDB;&#x884C;&#x7528;&#x6237;&#x6570;&#x636E;&#x7684;&#x91C7;&#x96C6;&#xFF0C;&#x53EF;&#x4EE5;&#x5F88;&#x65B9;&#x4FBF;&#x5730;&#x5E26;&#x5230;&#x7EBF;&#x4E0A;&#xFF0C;&#x628A;&#x6570;&#x636E;&#x4E0A;&#x62A5;&#x7ED9;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x53EF;&#x4EE5;&#x9488;&#x5BF9;&#x6240;&#x6709;&#x7528;&#x6237;&#x4E0A;&#x62A5;&#x7684;&#x542F;&#x52A8;&#x6570;&#x636E;&#xFF0C;&#x6BCF;&#x5929;&#x505A;&#x4E00;&#x4E2A;&#x6574;&#x5408;&#xFF0C;&#x8BA1;&#x7B97;&#x51FA;&#x4E00;&#x4E2A;&#x5E73;&#x5747;&#x503C;&#xFF0C;&#x7136;&#x540E;&#x5BF9;&#x6BD4;&#x4E0D;&#x540C;&#x7248;&#x672C;&#x7684;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x3002;</p>
<ol start="5">
<li>&#x4E24;&#x4E2A;&#x5206;&#x6790;&#x5DE5;&#x5177;</li>
</ol>
<hr>
<p>&#x5E38;&#x7528;&#x7684;&#x5206;&#x6790;&#x65B9;&#x6CD5;&#x8017;&#x65F6;&#x7684;&#x5DE5;&#x5177;&#x6709; <code>Debug</code> &#x548C; <code>Trace</code>&#xFF0C;&#x5B83;&#x4EEC;&#x4E24;&#x4E2A;&#x662F;&#x76F8;&#x4E92;&#x8865;&#x5145;&#x7684;&#x5173;&#x7CFB;&#xFF0C;&#x6211;&#x4EEC;&#x8981;&#x5728;&#x4E0D;&#x540C;&#x7684;&#x573A;&#x666F;&#x4E0B;&#x4F7F;&#x7528;&#x4E0D;&#x540C;&#x7684;&#x5DE5;&#x5177;&#xFF0C;&#x8FD9;&#x6837;&#x624D;&#x80FD;&#x53D1;&#x6325;&#x5DE5;&#x5177;&#x7684;&#x6700;&#x5927;&#x4F5C;&#x7528;&#xFF0C;&#x4E0B;&#x9762;&#x5C31;&#x6765;&#x770B;&#x4E0B;&#x8FD9;&#x4E24;&#x4E2A;&#x5DE5;&#x5177;&#x7684;&#x7528;&#x6CD5;&#x3002;</p>
<h3 id="5-1-Debug"><a href="#5-1-Debug" class="headerlink" title="5.1 Debug"></a>5.1 Debug</h3><p>CPU Profiler &#x80FD;&#x4EE5;&#x56FE;&#x5F62;&#x7684;&#x5F62;&#x5F0F;&#x5C55;&#x793A;&#x4EE3;&#x7801;&#x7684;&#x6267;&#x884C;&#x65F6;&#x95F4;&#x548C;&#x8C03;&#x7528;&#x6808;&#x4FE1;&#x606F;&#xFF0C;&#x800C;&#x4E14;&#x63D0;&#x4F9B;&#x7684;&#x4FE1;&#x606F;&#x975E;&#x5E38;&#x5168;&#x9762;&#xFF0C;&#x5305;&#x542B;&#x4E86;&#x542F;&#x52A8;&#x8FC7;&#x7A0B;&#x4E2D;&#x6D89;&#x53CA;&#x7684;&#x6240;&#x6709;&#x7EBF;&#x7A0B;&#x3002;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x770B;&#x5177;&#x4F53;&#x7528;&#x6CD5;&#x3002;</p>
<p>&#x9996;&#x5148;&#x901A;&#x8FC7; <code>Debug.startMethodTracing(&quot;&#x8F93;&#x51FA;&#x6587;&#x4EF6;&quot;)</code> &#x5F00;&#x59CB;&#x8DDF;&#x8E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x8BB0;&#x5F55;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x5185;&#x7684; CPU &#x4F7F;&#x7528;&#x60C5;&#x51B5;&#x3002;&#x5F53;&#x6211;&#x4EEC;&#x8C03;&#x7528;&#x4E86; <code>Debug.stopMethodTracing()</code> &#x505C;&#x6B62;&#x8DDF;&#x8E2A;&#x540E;&#xFF0C;&#x7CFB;&#x7EDF;&#x5C31;&#x4F1A;&#x4E3A;&#x6211;&#x4EEC;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; CPU Profiler &#x67E5;&#x770B;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x8BB0;&#x5F55;&#x7684;&#x5185;&#x5BB9;&#x3002;</p>
<p>&#x6587;&#x4EF6;&#x751F;&#x6210;&#x7684;&#x4F4D;&#x7F6E;&#x5728; <code>Android/data/&#x5305;&#x540D;/files</code> &#x4E0B;&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E00;&#x4E2A;&#x793A;&#x4F8B;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x5728; Application &#x7684; onCreate() &#x65B9;&#x6CD5;&#x7684;&#x5F00;&#x5934;&#x5F00;&#x59CB;&#x8FFD;&#x8E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x7ED3;&#x5C3E;&#x7ED3;&#x675F;&#x8FFD;&#x8E2A;&#xFF0C;&#x5728;&#x8FD9;&#x91CC;&#x53EA;&#x662F;&#x5BF9; <code>BlockCanary</code> &#x5361;&#x987F;&#x76D1;&#x6D4B;&#x6846;&#x67B6;&#x8FDB;&#x884C;&#x521D;&#x59CB;&#x5316;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/efde883e264c7cf9e2b1b2987b6e44ccf7beba6b7223043e49bfd10f211f68ff" alt="startMethodTracing.png"></p>
<p>startMethodTracing() &#x65B9;&#x6CD5;&#x771F;&#x6B63;&#x8C03;&#x7528;&#x7684;&#x5176;&#x5B9E;&#x662F;&#x53E6;&#x4E00;&#x4E2A;&#x91CD;&#x8F7D;&#x65B9;&#x6CD5;&#xFF0C;&#x5728;&#x8FD9;&#x4E2A;&#x91CD;&#x8F7D;&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x4F20;&#x5165; bufferSize&#x3002;</p>
<p>bufferSize &#x5C31;&#x662F;&#x5206;&#x6790;&#x7ED3;&#x679C;&#x6587;&#x4EF6;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F; <code>8m</code> &#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x6269;&#x5145;&#xFF0C;&#x6BD4;&#x5982;&#x6269;&#x5145;&#x4E3A; 16m&#x3001;32m &#x7B49;&#x3002;</p>
<p>&#x8FD9;&#x4E2A;&#x91CD;&#x8F7D;&#x65B9;&#x6CD5;&#x7684;&#x7B2C;&#x4E09;&#x4E2A;&#x53C2;&#x6570;&#x662F;&#x6807;&#x5FD7;&#x4F4D;&#xFF0C;&#x8FD9;&#x4E2A;&#x6807;&#x5FD7;&#x4F4D;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x9009;&#x9879;&#xFF0C;&#x5C31;&#x662F; <code>TRACE_COUNT_ALLOCS</code>&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/3292dc2aebceee346263d6b5bc832ff758bf2cf76698f02c676fafc5d3687765" alt="startMethodTracing2.png"></p>
<p>&#x8FD0;&#x884C;&#x7A0B;&#x5E8F;&#x540E;&#xFF0C;&#x6709;&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x5230;&#x8DDF;&#x8E2A;&#x7ED3;&#x679C;&#x6587;&#x4EF6;&#x3002;&#x7B2C;&#x4E00;&#x79CD;&#x65B9;&#x5F0F;&#x662F;&#x901A;&#x8FC7;&#x4E0B;&#x9762;&#x7684;&#x547D;&#x4EE4;&#x628A;&#x6587;&#x4EF6;&#x62C9;&#x5230;&#x9879;&#x76EE;&#x6839;&#x76EE;&#x5F55;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/88aed40b3f93e6690ff9212e58dd841602931a6b68b2b4ceeb74e118175cb13b" alt="pull &#x8DDF;&#x8E2A;&#x7ED3;&#x679C;.png"></p>
<p>&#x7B2C;&#x4E8C;&#x79CD;&#x65B9;&#x5F0F;&#x662F;&#x5728; AS &#x53F3;&#x4E0B;&#x65B9;&#x7684;&#x6587;&#x4EF6;&#x8D44;&#x6E90;&#x7BA1;&#x7406;&#x5668;&#x4E2D;&#x5B9A;&#x4F4D;&#x5230; <code>/sdcard/android/data/&#x5305;&#x540D;/files/</code> &#x76EE;&#x5F55;&#x4E0B;&#xFF0C;&#x7136;&#x540E;&#x81EA;&#x5DF1;&#x627E;&#x4E2A;&#x5730;&#x65B9;&#x4FDD;&#x5B58;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/ed174b7790ce5f78a185e9f7d73d3603dd159d50c4b13f55f3c8e8c51414d9e4" alt="&#x6587;&#x4EF6;&#x8D44;&#x6E90;&#x7BA1;&#x7406;&#x5668;.png"></p>
<p>&#x5728; Profiler &#x7684; CPU &#x677F;&#x5757;&#x7684;&#x5DE6;&#x4E0A;&#x89D2;&#x7684; Session &#x4E2D;&#x70B9;&#x51FB;&#x52A0;&#x53F7;&#xFF0C;&#x7136;&#x540E;&#x9009;&#x62E9; Load From File &#x540E;&#xFF0C;&#x5C31;&#x80FD;&#x770B;&#x5230;&#x542F;&#x52A8;&#x8FC7;&#x7A0B;&#x4E2D;&#x90FD;&#x505A;&#x4E86;&#x54EA;&#x4E9B;&#x4E8B;&#x60C5;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/b1ec09149cb14f6ab31197e7eb8654553859d2499086c6e348502f8b9497e189" alt="&#x67E5;&#x770B;&#x8DDF;&#x8E2A;&#x6587;&#x4EF6;.png"></p>
<p>&#x5728;&#x5206;&#x6790;&#x7ED3;&#x679C;&#x4E0A;&#x6BD4;&#x8F83;&#x91CD;&#x8981;&#x7684;&#x662F; 5 &#x79CD;&#x4FE1;&#x606F;&#x3002;</p>
<ul>
<li>&#x4EE3;&#x7801;&#x6307;&#x5B9A;&#x7684;&#x65F6;&#x95F4;&#x8303;&#x56F4;</li>
</ul>
<p>&#x8FD9;&#x4E2A;&#x65F6;&#x95F4;&#x8303;&#x56F4;&#x662F;&#x6211;&#x4EEC;&#x901A;&#x8FC7; Debug &#x7C7B;&#x7CBE;&#x786E;&#x6307;&#x5B9A;&#x7684;</p>
<ul>
<li>&#x9009;&#x4E2D;&#x7684;&#x65F6;&#x95F4;&#x8303;&#x56F4;</li>
</ul>
<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x62D6;&#x52A8;&#x65F6;&#x95F4;&#x7EBF;&#xFF0C;&#x9009;&#x62E9;&#x67E5;&#x770B;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x5185;&#x67D0;&#x6761;&#x7EBF;&#x7A0B;&#x7684;&#x8C03;&#x7528;&#x5806;&#x6808;</p>
<ul>
<li>&#x8FDB;&#x7A0B;&#x4E2D;&#x5B58;&#x5728;&#x7684;&#x7EBF;&#x7A0B;</li>
</ul>
<p>&#x5728;&#x8FD9;&#x91CC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5728;&#x6307;&#x5B9A;&#x65F6;&#x95F4;&#x8303;&#x56F4;&#x5185;&#x8FDB;&#x7A0B;&#x4E2D;&#x53EA;&#x6709;&#x4E3B;&#x7EBF;&#x7A0B;&#x548C; BlockCanary &#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x4E00;&#x5171;&#x6709; 4 &#x6761;&#x7EBF;&#x7A0B;&#x3002;</p>
<ul>
<li>&#x8C03;&#x7528;&#x5806;&#x6808;</li>
</ul>
<p>&#x5728;&#x4E0A;&#x9762;&#x7684;&#x8DDF;&#x8E2A;&#x4FE1;&#x606F;&#x4E2D;&#xFF0C;&#x6211;&#x9009;&#x4E2D;&#x4E86; main&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x4E3B;&#x7EBF;&#x7A0B;&#x3002;</p>
<p>&#x8FD8;&#x628A;&#x65F6;&#x95F4;&#x8303;&#x56F4;&#x7F29;&#x5C0F;&#x5230;&#x4E86;&#x7279;&#x5B9A;&#x65F6;&#x95F4;&#x533A;&#x57DF;&#x5185;&#xFF0C;&#x653E;&#x5927;&#x4E86;&#x8FD9;&#x4E2A;&#x65F6;&#x95F4;&#x8303;&#x56F4;&#x5185;&#x4E3B;&#x7EBF;&#x7A0B;&#x7684;&#x8C03;&#x7528;&#x5806;&#x6808;&#x4FE1;&#x606F;</p>
<ul>
<li>&#x65B9;&#x6CD5;&#x8017;&#x65F6;</li>
</ul>
<p>&#x5F53;&#x6211;&#x4EEC;&#x628A;&#x9F20;&#x6807;&#x653E;&#x5230;&#x67D0;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#x4E0A;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x7684;&#x8017;&#x65F6;&#xFF0C;&#x6BD4;&#x5982;&#x4E0A;&#x9762;&#x7684; initBlockCanary &#x7684;&#x8017;&#x65F6;&#x662F; 19 &#x6BEB;&#x79D2;&#x3002;</p>
<h3 id="5-2-Trace"><a href="#5-2-Trace" class="headerlink" title="5.2 Trace"></a>5.2 Trace</h3><p>Trace &#x7ED3;&#x5408;&#x4E86; Android &#x5185;&#x6838;&#x6570;&#x636E;&#xFF0C;&#x5206;&#x6790;&#x4E86;&#x7EBF;&#x7A0B;&#x6D3B;&#x52A8;&#x540E;&#x4F1A;&#x7ED9;&#x6211;&#x4EEC;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x7CBE;&#x786E; HTML &#x683C;&#x5F0F;&#x7684;&#x62A5;&#x544A;&#x3002;</p>
<p>Trace &#x5DE5;&#x5177;&#x7C7B;&#x9ED8;&#x8BA4;&#x53EA;&#x80FD; API 18 &#x4EE5;&#x4E0A;&#x7684;&#x9879;&#x76EE;&#x4E2D;&#x624D;&#x80FD;&#x4F7F;&#x7528;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x7684;&#x517C;&#x5BB9;&#x7248;&#x672C;&#x4F4E;&#x4E8E; API 18&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; TraceCompat&#x3002;&#x4E0B;&#x9762;&#x6765;&#x770B;&#x770B;&#x5177;&#x4F53;&#x7528;&#x6CD5;&#x3002;</p>
<p>&#x9996;&#x5148;&#x5728; Application &#x4E2D;&#x8C03;&#x7528; Trace &#x7684; <code>beginSection()</code> &#x65B9;&#x6CD5;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/e83a7a0b5ac90cd21fed0ea6372e9ec2b9549a454e728c960a1f0b68aa87b6d4" alt="beginSection.png"></p>
<p>&#x7136;&#x540E;&#x8FDE;&#x63A5;&#x8BBE;&#x5907;&#xFF0C;&#x5728;&#x7EC8;&#x7AEF;&#x4E2D;&#x5B9A;&#x4F4D;&#x5230; Android SDK &#x76EE;&#x5F55;&#x4E0B;&#xFF0C;&#x6BD4;&#x5982;&#x6211;&#x7684; Android SDK &#x76EE;&#x5F55;&#x5728; <code>/users/oushaoze/library/Android/sdk</code> &#x3002;</p>
<p>&#x7136;&#x540E;&#x6253;&#x5F00; SDK &#x76EE;&#x5F55;&#x4E0B;&#x7684; <code>platform-tools/systrace</code> &#x76EE;&#x5F55;&#xFF0C;&#x5C31;&#x80FD;&#x770B;&#x5230;&#x4E00;&#x4E2A;&#x53EB; <code>systrace.py</code> &#x7684; python &#x811A;&#x672C;&#xFF0C;&#x6267;&#x884C;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x547D;&#x4EE4;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5F00;&#x59CB;&#x8FFD;&#x8E2A;&#x7CFB;&#x7EDF;&#x4FE1;&#x606F;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/4da653439b630ddc9b2b0910ed72099a3a0eacbe13c6ee34a1288d62ba90ce94" alt="systrace&#x547D;&#x4EE4;.png"></p>
<p>&#x8FD9;&#x884C;&#x547D;&#x4EE4;&#x9644;&#x52A0;&#x4E86;&#x4E0B;&#x9762;&#x4E00;&#x4E9B;&#x9009;&#x9879;&#x3002;</p>
<ul>
<li>-t &#x2026;</li>
</ul>
<p>-t &#x540E;&#x9762;&#x8868;&#x793A;&#x7684;&#x662F;&#x8DDF;&#x8E2A;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x6BD4;&#x5982;&#x4E0A;&#x9762;&#x8BBE;&#x5B9A;&#x7684;&#x662F; 10 &#x79D2;&#x5C31;&#x7ED3;&#x675F;&#x3002;</p>
<ul>
<li>-o &#x2026;</li>
</ul>
<p>-o &#x540E;&#x9762;&#x8868;&#x793A;&#x628A;&#x6587;&#x4EF6;&#x8F93;&#x51FA;&#x5230;&#x6307;&#x5B9A;&#x76EE;&#x5F55;&#x4E0B;&#x3002;</p>
<ul>
<li>-a &#x2026;</li>
</ul>
<p>-a &#x540E;&#x9762;&#x8868;&#x793A;&#x7684;&#x662F;&#x8981;&#x542F;&#x52A8;&#x7684;&#x5E94;&#x7528;&#x5305;&#x540D;</p>
<p>&#x8F93;&#x5165;&#x5B8C;&#x8FD9;&#x884C;&#x547D;&#x4EE4;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5F00;&#x59CB;&#x8DDF;&#x8E2A;&#x7684;&#x63D0;&#x793A;&#x3002;&#x770B;&#x5230; Starting tracing &#x540E;&#x53EF;&#x4EE5;&#x6253;&#x5F00;&#x6253;&#x5F00;&#x6211;&#x4EEC;&#x7684;&#x5E94;&#x7528;&#x3002;</p>
<p>10 &#x79D2;&#x540E;&#xFF0C;&#x4F1A;&#x770B;&#x5230; <code>Wrote trace HTML file: ....</code>&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/16314c421762a44e0b17c0a845a3073176f23645695cea281801c00ba32af8d5" alt="systrace&#x8F93;&#x51FA;.png"></p>
<p>&#x4E0A;&#x9762;&#x8FD9;&#x6BB5;&#x8F93;&#x51FA;&#x5C31;&#x662F;&#x8BF4;&#x8FFD;&#x8E2A;&#x5B8C;&#x6BD5;&#xFF0C;&#x8FFD;&#x8E2A;&#x5230;&#x7684;&#x4FE1;&#x606F;&#x90FD;&#x5199;&#x5230; <code>trace.html</code> &#x6587;&#x4EF6;&#x4E2D;&#x4E86;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x6253;&#x5F00;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/4f1400cc2fb1a1d81431e39787b3da1b814131a35b9aa39d071513a986dce90a" alt="Systrace.png"></p>
<p>&#x6253;&#x5F00;&#x6587;&#x4EF6;&#x540E;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x4E0A;&#x9762;&#x8FD9;&#x6837;&#x7684;&#x4E00;&#x4E2A;&#x89C6;&#x56FE;&#xFF0C;&#x5728;&#x8FD9;&#x91CC;&#x6709;&#x51E0;&#x4E2A;&#x9700;&#x8981;&#x7279;&#x522B;&#x5173;&#x6CE8;&#x7684;&#x5730;&#x65B9;&#x3002;</p>
<ul>
<li>8 &#x6838;</li>
</ul>
<p>&#x6211;&#x8FD0;&#x884C; Systrace &#x7684;&#x8BBE;&#x5907;&#x662F; 8 &#x6838;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x7684; Kernel &#x4E0B;&#x9762;&#x662F; 8 &#x4E2A; CPU&#x3002;</p>
<ul>
<li>&#x7F29;&#x653E;</li>
</ul>
<p>&#x5F53;&#x6211;&#x4EEC;&#x9009;&#x4E2D;&#x7F29;&#x653E;&#x540E;&#xFF0C;&#x7F29;&#x653E;&#x7684;&#x65B9;&#x5F0F;&#x662F;&#x4E0A;&#x4E0B;&#x79FB;&#x52A8;&#xFF0C;&#x4E0D;&#x662F;&#x5DE6;&#x53F3;&#x79FB;&#x52A8;&#x3002;</p>
<ul>
<li>&#x79FB;&#x52A8;</li>
</ul>
<p>&#x9009;&#x62E9;&#x79FB;&#x52A8;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x62D6;&#x52A8;&#x6211;&#x4EEC;&#x5F80;&#x4E0B;&#x67E5;&#x770B;&#x5176;&#x5B83;&#x8FDB;&#x7A0B;&#x7684;&#x5206;&#x6790;&#x4FE1;&#x606F;&#x3002;</p>
<ul>
<li>&#x65F6;&#x95F4;&#x7247;&#x4F7F;&#x7528;&#x60C5;&#x51B5;</li>
</ul>
<p>&#x65F6;&#x95F4;&#x7247;&#x4F7F;&#x7528;&#x60C5;&#x51B5;&#x6307;&#x7684;&#x662F;&#x5404;&#x4E2A; CPU &#x5728;&#x7279;&#x5B9A;&#x65F6;&#x95F4;&#x5185;&#x7684;&#x65F6;&#x95F4;&#x7247;&#x4F7F;&#x7528;&#x60C5;&#x51B5;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x7528;&#x7F29;&#x653E;&#x628A;&#x7279;&#x5B9A;&#x65F6;&#x95F4;&#x6BB5;&#x5185;&#x7684;&#x65F6;&#x95F4;&#x7247;&#x4FE1;&#x606F;&#x653E;&#x5927;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x65F6;&#x95F4;&#x7247;&#x662F;&#x88AB;&#x54EA;&#x4E2A;&#x7EBF;&#x7A0B;&#x5360;&#x7528;&#x4E86;&#x3002;</p>
<ul>
<li>&#x8FD0;&#x884C;&#x4E2D;&#x7684;&#x8FDB;&#x7A0B;</li>
</ul>
<p>&#x5DE6;&#x4FA7;&#x4E00;&#x680F;&#x9664;&#x4E86;&#x5404;&#x4E2A;&#x5185;&#x6838;&#x5916;&#xFF0C;&#x8FD8;&#x4F1A;&#x663E;&#x793A;&#x8FD0;&#x884C;&#x4E2D;&#x7684;&#x8FDB;&#x7A0B;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x5F80;&#x4E0B;&#x79FB;&#x52A8;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230; MyAppplication &#x8FDB;&#x7A0B;&#x7684;&#x7EBF;&#x7A0B;&#x6D3B;&#x52A8;&#x60C5;&#x51B5;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/44e84467e13bf064a5bcbd77eb44bf03883409fd6b3dacecfd62612773257814" alt="Systrace_myapp.png"></p>
<p>&#x5728;&#x8FD9;&#x4E2A;&#x89C6;&#x56FE;&#x4E0A;&#x6211;&#x4EEC;&#x4E3B;&#x8981;&#x5173;&#x6CE8;&#x4E09;&#x4E2A;&#x70B9;&#x3002;</p>
<ul>
<li>&#x4E3B;&#x7EBF;&#x7A0B;</li>
</ul>
<p>&#x5728;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x4E3B;&#x8981;&#x5173;&#x6CE8;&#x4E3B;&#x7EBF;&#x7A0B;&#x7684;&#x8FD0;&#x884C;&#x4E86;&#x54EA;&#x4E9B;&#x65B9;&#x6CD5;</p>
<ul>
<li>&#x8DDF;&#x8E2A;&#x7684;&#x65F6;&#x95F4;&#x6BB5;</li>
</ul>
<p>&#x521A;&#x624D;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x8BBE;&#x7F6E;&#x7684;&#x6807;&#x7B7E;&#x662F; AppOnCreate&#xFF0C;&#x5728;&#x8FD9;&#x91CC;&#x5C31;&#x663E;&#x793A;&#x4E86;&#x8FD9;&#x4E2A;&#x8DDF;&#x8E2A;&#x65F6;&#x95F4;&#x6BB5;&#x7684;&#x6807;&#x7B7E;</p>
<ul>
<li>&#x8017;&#x65F6;</li>
</ul>
<p>&#x6211;&#x4EEC;&#x9009;&#x4E2D; AppOnCreate &#x6807;&#x7B7E;&#x540E;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x7684;&#x8017;&#x65F6;&#x3002;</p>
<p>&#x5728; Slice &#x6807;&#x7B7E;&#x4E0B;&#x7684;&#x8017;&#x65F6;&#x4FE1;&#x606F;&#x5305;&#x62EC; Wall Duration &#x548C; CPU Duration&#xFF0C;&#x4E0B;&#x9762;&#x662F;&#x5B83;&#x4EEC;&#x7684;&#x533A;&#x522B;&#x3002;</p>
<p><code>Wall Time &#x662F;&#x6267;&#x884C;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x8017;&#x8D39;&#x7684;&#x65F6;&#x95F4;</code>&#xFF0C;&#x4E0D;&#x80FD;&#x4F5C;&#x4E3A;&#x4F18;&#x5316;&#x6307;&#x6807;&#xFF0C;&#x5047;&#x5982;&#x6211;&#x4EEC;&#x7684;&#x4EE3;&#x7801;&#x8981;&#x8FDB;&#x5165;&#x9501;&#x7684;&#x4E34;&#x754C;&#x533A;&#xFF0C;&#x5982;&#x679C;&#x9501;&#x88AB;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x6301;&#x6709;&#xFF0C;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x5C31;&#x8FDB;&#x5165;&#x4E86;&#x963B;&#x585E;&#x72B6;&#x6001;&#xFF0C;&#x800C;&#x7B49;&#x5F85;&#x7684;&#x65F6;&#x95F4;&#x662F;&#x4F1A;&#x88AB;&#x8BA1;&#x7B97;&#x5230; Wall Time &#x4E2D;&#x7684;&#x3002;</p>
<p><code>CPU Duration &#x662F; CPU &#x771F;&#x6B63;&#x82B1;&#x5728;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x4E0A;&#x7684;&#x65F6;&#x95F4;</code>&#xFF0C;&#x662F;&#x6211;&#x4EEC;&#x5173;&#x5FC3;&#x7684;&#x4F18;&#x5316;&#x6307;&#x6807;&#x3002;</p>
<p>&#x5728;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x4E2D; Wall Duration &#x662F; 84 &#x6BEB;&#x79D2;&#xFF0C;CPU Duration &#x662F; 34 &#x6BEB;&#x79D2;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5728;&#x8FD9;&#x6BB5;&#x65F6;&#x95F4;&#x5185;&#x4E00;&#x5171;&#x6709; 50 &#x6BEB;&#x79D2; CPU &#x662F;&#x5904;&#x4E8E;&#x4F11;&#x606F;&#x72B6;&#x6001;&#x7684;&#xFF0C;&#x771F;&#x6B63;&#x6267;&#x884C;&#x4EE3;&#x7801;&#x7684;&#x65F6;&#x95F4;&#x53EA;&#x82B1;&#x4E86; 34 &#x6BEB;&#x79D2;&#x3002;</p>
<h3 id="5-3-&#x5C0F;&#x7ED3;"><a href="#5-3-&#x5C0F;&#x7ED3;" class="headerlink" title="5.3 &#x5C0F;&#x7ED3;"></a>5.3 &#x5C0F;&#x7ED3;</h3><h5 id="1-Debug"><a href="#1-Debug" class="headerlink" title="1. Debug"></a>1. Debug</h5><p><code>Debug &#x7684;&#x4F18;&#x70B9;&#x662F;&#x53EF;&#x4EE5;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x57CB;&#x70B9;</code>&#xFF0C;&#x57CB;&#x70B9;&#x540E;&#x53EF;&#x4EE5;&#x7528; CPU Profiler &#x8FDB;&#x884C;&#x5206;&#x6790;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x4F18;&#x5316;&#x7684;&#x662F;&#x542F;&#x52A8;&#x9636;&#x6BB5;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x6253;&#x5F00; App &#x540E;&#x76F4;&#x63A5;&#x901A;&#x8FC7; CPU Profiler &#x8FDB;&#x884C;&#x8BB0;&#x5F55;&#x7684;&#x8BDD;&#xFF0C;&#x5C31;&#x8981;&#x6C42;&#x4F60;&#x6709;&#x5355;&#x8EAB;&#x4E09;&#x5341;&#x5E74;&#x7684;&#x624B;&#x901F;&#xFF0C;&#x70B9;&#x51FB;&#x5F00;&#x59CB;&#x8BB0;&#x5F55;&#x7684;&#x65F6;&#x95F4;&#x8981;&#x548C;&#x5E94;&#x7528;&#x7684;&#x542F;&#x52A8;&#x65F6;&#x95F4;&#x5B8C;&#x5168;&#x4E00;&#x81F4;&#xFF0C;&#x800C;&#x6709;&#x4E86; Traceview&#xFF0C;&#x54EA;&#x6015;&#x4F60;&#x662F;&#x8001;&#x5E74;&#x4EBA;&#x624B;&#x901F;&#x4E5F;&#x53EF;&#x4EE5;&#x8BB0;&#x5F55;&#x542F;&#x52A8;&#x8FC7;&#x7A0B;&#x6D89;&#x53CA;&#x7684;&#x8C03;&#x7528;&#x6808;&#x4FE1;&#x606F;&#x3002;</p>
<p><code>Debug &#x7684;&#x7F3A;&#x70B9;&#x662F;&#x8FD0;&#x884C;&#x65F6;&#x5F00;&#x9500;&#x975E;&#x5E38;&#x5927;&#xFF0C;&#x5B83;&#x4F1A;&#x5BFC;&#x81F4;&#x6211;&#x4EEC;&#x7A0B;&#x5E8F;&#x7684;&#x8FD0;&#x884C;&#x53D8;&#x6162;</code>&#xFF0C;&#x4E4B;&#x6240;&#x4EE5;&#x4F1A;&#x53D8;&#x6162;&#xFF0C;&#x662F;&#x56E0;&#x4E3A;&#x5B83;&#x4F1A;&#x901A;&#x8FC7;&#x865A;&#x62DF;&#x673A;&#x7684; Profiler &#x6293;&#x53D6;&#x6211;&#x4EEC;&#x5F53;&#x524D;&#x6240;&#x6709;&#x7EBF;&#x7A0B;&#x7684;&#x6240;&#x6709;&#x8C03;&#x7528;&#x5806;&#x6808;&#x3002;</p>
<p>&#x56E0;&#x4E3A;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;Traceview &#x4E5F;&#x53EF;&#x80FD;&#x4F1A;&#x5E26;&#x504F;&#x6211;&#x4EEC;&#x7684;&#x4F18;&#x5316;&#x65B9;&#x5411;&#xFF0C;&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x6709;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x5728;&#x6B63;&#x5E38;&#x60C5;&#x51B5;&#x4E0B;&#x7684;&#x8017;&#x65F6;&#x4E0D;&#x5927;&#xFF0C;&#x4F46;&#x662F;&#x52A0;&#x4E0A;&#x4E86; Traceview &#x4E4B;&#x540E;&#x53EF;&#x80FD;&#x4F1A;&#x53D1;&#x73B0;&#x5B83;&#x7684;&#x8017;&#x65F6;&#x53D8;&#x6210;&#x4E86;&#x539F;&#x6765;&#x7684;&#x5341;&#x500D;&#x751A;&#x81F3;&#x66F4;&#x591A;&#x3002;</p>
<h5 id="2-Trace"><a href="#2-Trace" class="headerlink" title="2. Trace"></a>2. Trace</h5><p><code>Trace &#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x4F18;&#x70B9;&#x662F;&#x5F00;&#x9500;&#x975E;&#x5E38;&#x5C0F;</code>&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x53EA;&#x4F1A;&#x5728;&#x6211;&#x4EEC;&#x57CB;&#x70B9;&#x533A;&#x95F4;&#x8FDB;&#x884C;&#x8BB0;&#x5F55;&#xFF0C;&#x800C; Traceview &#x662F;&#x4F1A;&#x628A;&#x6240;&#x6709;&#x7684;&#x7EBF;&#x7A0B;&#x7684;&#x5806;&#x6808;&#x8C03;&#x7528;&#x60C5;&#x51B5;&#x90FD;&#x8BB0;&#x5F55;&#x4E0B;&#x6765;&#x3002;</p>
<p><code>Trace &#x7684;&#x7B2C;&#x4E8C;&#x4E2A;&#x4F18;&#x70B9;&#x662F;&#x76F4;&#x89C2;</code>&#xFF0C;&#x5728; Systrace &#x4E2D;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F88;&#x76F4;&#x89C2;&#x5730;&#x770B;&#x5230; CPU &#x5229;&#x7528;&#x7387;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x53D1;&#x73B0; CPU &#x5229;&#x7528;&#x7387;&#x4F4E;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8003;&#x8651;&#x8BA9;&#x66F4;&#x591A;&#x4EE3;&#x7801;&#x4EE5;&#x5F02;&#x6B65;&#x7684;&#x65B9;&#x5F0F;&#x6267;&#x884C;&#xFF0C;&#x4EE5;&#x63D0;&#x9AD8; CPU &#x5229;&#x7528;&#x7387;&#x3002;</p>
<h5 id="3-Debug-&#x4E0E;-Trace-&#x7684;&#x4E24;&#x4E2A;&#x533A;&#x522B;"><a href="#3-Debug-&#x4E0E;-Trace-&#x7684;&#x4E24;&#x4E2A;&#x533A;&#x522B;" class="headerlink" title="3. Debug &#x4E0E; Trace &#x7684;&#x4E24;&#x4E2A;&#x533A;&#x522B;"></a>3. Debug &#x4E0E; Trace &#x7684;&#x4E24;&#x4E2A;&#x533A;&#x522B;</h5><ul>
<li>&#x67E5;&#x770B;&#x5DE5;&#x5177;</li>
</ul>
<p>Debug &#x5206;&#x6790;&#x7ED3;&#x679C;&#x8981;&#x4F7F;&#x7528; Profiler &#x67E5;&#x770B;&#x3002;</p>
<p>Trace &#x5206;&#x6790;&#x7ED3;&#x679C;&#x662F;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x67E5;&#x770B; HTML &#x6587;&#x4EF6;&#x3002;</p>
<ul>
<li>&#x57CB;&#x70B9;&#x5DE5;&#x5177;&#x7C7B;</li>
</ul>
<p>Debug &#x4F7F;&#x7528;&#x7684;&#x662F; Debug.startMethodTracing()&#x3002;</p>
<p>Trace &#x7528;&#x7684;&#x662F; Trace.beginSection() &#x548C; TraceCompat.beginSection()&#x3002;</p>
<ol start="6">
<li>&#x4E24;&#x79CD;&#x4F18;&#x5316;&#x65B9;&#x6CD5;</li>
</ol>
<hr>
<p>&#x5E38;&#x7528;&#x7684;&#x4E24;&#x79CD;&#x4F18;&#x5316;&#x65B9;&#x6CD5;&#x6709;&#x4E24;&#x79CD;&#xFF0C;&#x8FD9;&#x4E24;&#x79CD;&#x662F;&#x53EF;&#x4EE5;&#x7ED3;&#x5408;&#x4F7F;&#x7528;&#x7684;&#x3002;</p>
<p>&#x7B2C;&#x4E00;&#x79CD;&#x662F;&#x95EA;&#x5C4F;&#x9875;&#xFF0C;&#x5728;&#x89C6;&#x89C9;&#x4E0A;&#x8BA9;&#x7528;&#x6237;&#x611F;&#x89C9;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x5FEB;&#xFF0C;&#x7B2C;&#x4E8C;&#x79CD;&#x662F;&#x5F02;&#x6B65;&#x521D;&#x59CB;&#x5316;&#x3002;</p>
<h3 id="6-1-&#x95EA;&#x5C4F;&#x9875;"><a href="#6-1-&#x95EA;&#x5C4F;&#x9875;" class="headerlink" title="6.1 &#x95EA;&#x5C4F;&#x9875;"></a>6.1 &#x95EA;&#x5C4F;&#x9875;</h3><p>&#x95EA;&#x5C4F;&#x9875;&#x662F;&#x4F18;&#x5316;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x7684;&#x4E00;&#x4E2A;&#x5C0F;&#x6280;&#x5DE7;&#xFF0C;&#x867D;&#x7136;&#x5BF9;&#x5B9E;&#x9645;&#x7684;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x5E2E;&#x52A9;&#xFF0C;&#x4F46;&#x662F;&#x80FD;&#x8BA9;&#x7528;&#x6237;&#x611F;&#x89C9;&#x6BD4;&#x542F;&#x52A8;&#x7684;&#x901F;&#x5EA6;&#x8981;&#x5FEB;&#x4E00;&#x4E9B;&#x3002;</p>
<p>&#x95EA;&#x5C4F;&#x9875;&#x5C31;&#x662F;&#x5728; App &#x6253;&#x5F00;&#x9996;&#x5C4F; Activity &#x524D;&#xFF0C;&#x9996;&#x5148;&#x663E;&#x793A;&#x4E00;&#x5F20;&#x56FE;&#x7247;&#xFF0C;&#x8FD9;&#x5F20;&#x56FE;&#x7247;&#x53EF;&#x4EE5;&#x662F; Logo &#x9875;&#xFF0C;&#x7B49; Activity &#x5C55;&#x793A;&#x51FA;&#x6765;&#x540E;&#xFF0C;&#x518D;&#x628A; Theme &#x53D8;&#x56DE;&#x6765;&#x3002;</p>
<p>&#x51B7;&#x542F;&#x52A8;&#x7684;&#x5176;&#x4E2D;&#x4E00;&#x6B65;&#x662F;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x7A7A;&#x767D; Window&#xFF0C;&#x95EA;&#x5C4F;&#x9875;&#x5C31;&#x662F;&#x5229;&#x7528;&#x8FD9;&#x4E2A;&#x7A7A;&#x767D; Window &#x663E;&#x793A;&#x5360;&#x4F4D;&#x56FE;&#x3002;</p>
<p>&#x7B2C;&#x4E00;&#x6B65;&#x662F;&#x5728; drawable &#x76EE;&#x5F55;&#x4E0B;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; splash.xml &#x6587;&#x4EF6;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/f7e6d6e13608efc848fe84556d10c60806fadba450ab6e3708166620fce1a5fc" alt="splash.xml.png"></p>
<p>&#x7B2C;&#x4E8C;&#x6B65;&#x662F;&#x5728; values/styles.xml &#x4E2D;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A; Splash &#x4E3B;&#x9898;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/2e31843f41fc1981cc85ea3e18b2687e38be08b9e8777ee8cdff62e85044d5ed" alt="SplashTheme.png"></p>
<p>&#x7B2C;&#x4E09;&#x6B65;&#x662F;&#x5728;&#x6E05;&#x5355;&#x6587;&#x4EF6;&#x4E2D;&#x8BBE;&#x7F6E; Theme&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/55dd8b8f2388379d3a6ac49019d0a8bfc7fe07e7c6dcbeab058db4fb9a7cde69" alt="ActivityTheme.png"></p>
<p>&#x7B2C;&#x56DB;&#x6B65;&#x662F;&#x5728;&#x8C03;&#x7528; super.onCreate &#x65B9;&#x6CD5;&#x524D;&#x5207;&#x6362;&#x56DE;&#x6765;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/5dfa07ead38683c5dedb900ab1d7fa00800c46216aca618f663a210026eae81c" alt="&#x6362;&#x56DE;&#x4E3B;&#x9898;.png"></p>
<h3 id="6-2-&#x5F02;&#x6B65;&#x521D;&#x59CB;&#x5316;"><a href="#6-2-&#x5F02;&#x6B65;&#x521D;&#x59CB;&#x5316;" class="headerlink" title="6.2 &#x5F02;&#x6B65;&#x521D;&#x59CB;&#x5316;"></a>6.2 &#x5F02;&#x6B65;&#x521D;&#x59CB;&#x5316;</h3><p>&#x6211;&#x4EEC;&#x8FD9;&#x4E00;&#x8282;&#x6765;&#x770B;&#x4E00;&#x4E0B;&#x600E;&#x4E48;&#x7528;&#x7EBF;&#x7A0B;&#x6C60;&#x8FDB;&#x884C;&#x5F02;&#x6B65;&#x521D;&#x59CB;&#x5316;&#x3002;</p>
<p>&#x672C;&#x8282;&#x5185;&#x5BB9;&#x5305;&#x62EC;&#x5982;&#x4E0B;&#x90E8;&#x5206;&#xFF0C;</p>
<ul>
<li>&#x5F02;&#x6B65;&#x521D;&#x59CB;&#x5316;&#x7B80;&#x4ECB;</li>
<li>&#x7EBF;&#x7A0B;&#x6C60;&#x5927;&#x5C0F;</li>
<li>&#x7EBF;&#x7A0B;&#x6C60;&#x57FA;&#x672C;&#x7528;&#x6CD5;</li>
</ul>
<h5 id="1-&#x5F02;&#x6B65;&#x521D;&#x59CB;&#x5316;&#x7B80;&#x4ECB;"><a href="#1-&#x5F02;&#x6B65;&#x521D;&#x59CB;&#x5316;&#x7B80;&#x4ECB;" class="headerlink" title="1. &#x5F02;&#x6B65;&#x521D;&#x59CB;&#x5316;&#x7B80;&#x4ECB;"></a>1. &#x5F02;&#x6B65;&#x521D;&#x59CB;&#x5316;&#x7B80;&#x4ECB;</h5><p>&#x5F02;&#x6B65;&#x4F18;&#x5316;&#x5C31;&#x662F;&#x628A;&#x521D;&#x59CB;&#x5316;&#x7684;&#x5DE5;&#x4F5C;&#x5206;&#x7EC6;&#x5206;&#x6210;&#x51E0;&#x4E2A;&#x5B50;&#x4EFB;&#x52A1;&#xFF0C;&#x7136;&#x540E;&#x8BA9;&#x5B50;&#x7EBF;&#x7A0B;&#x5206;&#x522B;&#x6267;&#x884C;&#x8FD9;&#x4E9B;&#x5B50;&#x4EFB;&#x52A1;&#xFF0C;&#x52A0;&#x5FEB;&#x521D;&#x59CB;&#x5316;&#x8FC7;&#x7A0B;&#x3002;</p>
<p>&#x5982;&#x679C;&#x4F60;&#x5BF9;&#x600E;&#x4E48;&#x5728; Android &#x4E2D;&#x5B9E;&#x73B0;&#x591A;&#x7EBF;&#x7A0B;&#x4E0D;&#x4E86;&#x89E3;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x4E00;&#x4E0B;&#x6211;&#x7684;&#x53E6;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;&#xFF1A;&#x63A2;&#x7D22; Android &#x591A;&#x7EBF;&#x7A0B;&#x4F18;&#x5316;&#xFF0C;&#x5728;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x4E2D;&#x6211;&#x5BF9;&#x5728; Android &#x4F7F;&#x7528;&#x591A;&#x7EBF;&#x7A0B;&#x7684;&#x65B9;&#x6CD5;&#x505A;&#x4E86;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4ECB;&#x7ECD;&#x3002;</p>
<p>&#x6709;&#x4E9B;&#x521D;&#x59CB;&#x5316;&#x4EE3;&#x7801;&#x5728;&#x5B50;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x7684;&#x65F6;&#x5019;&#x53EF;&#x80FD;&#x4F1A;&#x51FA;&#x73B0;&#x95EE;&#x9898;&#xFF0C;&#x6BD4;&#x5982;&#x8981;&#x6C42;&#x5728; onCreate() &#x7ED3;&#x675F;&#x524D;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x3002;</p>
<p>&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8003;&#x8651;&#x4F7F;&#x7528; <code>CountDownLatch</code> &#x5B9E;&#x73B0;&#xFF0C;&#x5B9E;&#x5728;&#x4E0D;&#x884C;&#x7684;&#x65F6;&#x5019;&#x5C31;&#x4FDD;&#x7559;&#x8FD9;&#x6BB5;&#x521D;&#x59CB;&#x5316;&#x4EE3;&#x7801;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E2D;&#x6267;&#x884C;&#x3002;</p>
<h5 id="2-&#x7EBF;&#x7A0B;&#x6C60;&#x5927;&#x5C0F;"><a href="#2-&#x7EBF;&#x7A0B;&#x6C60;&#x5927;&#x5C0F;" class="headerlink" title="2. &#x7EBF;&#x7A0B;&#x6C60;&#x5927;&#x5C0F;"></a>2. &#x7EBF;&#x7A0B;&#x6C60;&#x5927;&#x5C0F;</h5><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x7EBF;&#x7A0B;&#x6C60;&#x6765;&#x5B9E;&#x73B0;&#x5F02;&#x6B65;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x4F7F;&#x7528;&#x7EBF;&#x7A0B;&#x6C60;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#x7EBF;&#x7A0B;&#x6C60;&#x5927;&#x5C0F;&#x7684;&#x8BBE;&#x7F6E;&#x3002;</p>
<p>&#x7EBF;&#x7A0B;&#x6C60;&#x5927;&#x5C0F;&#x8981;&#x6839;&#x636E;&#x4E0D;&#x540C;&#x7684;&#x8BBE;&#x5907;&#x8BBE;&#x7F6E;&#x4E0D;&#x540C;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x6709;&#x7684;&#x624B;&#x673A;&#x662F; 4 &#x6838;&#x7684;&#xFF0C;&#x6709;&#x7684;&#x662F; 8 &#x6838;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x628A;&#x7EBF;&#x7A0B;&#x6C60;&#x5927;&#x5C0F;&#x8BBE;&#x4E3A;&#x56FA;&#x5B9A;&#x6570;&#x503C;&#x7684;&#x8BDD;&#x662F;&#x4E0D;&#x5408;&#x7406;&#x7684;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x53C2;&#x8003; AsyncTask &#x4E2D;&#x8BBE;&#x7F6E;&#x7684;&#x7EBF;&#x7A0B;&#x6C60;&#x5927;&#x5C0F;&#xFF0C;&#x5728; AsyncTask &#x4E2D;&#x6709; CPU_COUNT &#x548C; CORE_POOL_SIZE&#xFF0C;<code>CPU_COUNT &#x7684;&#x503C;&#x662F;&#x8BBE;&#x5907;&#x7684; CPU &#x6838;&#x6570;</code>&#xFF0C;<code>CORE_POOL_SIZE &#x662F;&#x7EBF;&#x7A0B;&#x6C60;&#x6838;&#x5FC3;&#x5927;&#x5C0F;</code>&#xFF0C;&#x8FD9;&#x4E2A;&#x503C;&#x7684;&#x6700;&#x5C0F;&#x503C;&#x662F; 2&#xFF0C;&#x6700;&#x5927;&#x503C;&#x662F; Math.min(CPU_COUNT - 1, 4)&#x3002;</p>
<p>&#x5F53;&#x8BBE;&#x5907;&#x7684;&#x6838;&#x6570;&#x4E3A; 8 &#x65F6;&#xFF0C;CORE_POOL_SIZE &#x7684;&#x503C;&#x4E3A; 4&#xFF0C;&#x5F53;&#x8BBE;&#x5907;&#x6838;&#x6570;&#x4E3A; 4 &#x65F6;&#xFF0C;&#x8FD9;&#x4E2A;&#x503C;&#x662F; 3&#xFF0C;&#x4E5F;&#x5C31;&#x662F; CORE_POOL_SIZE &#x7684;&#x6700;&#x5927;&#x503C;&#x662F; 4&#x3002;</p>
<h5 id="3-&#x7EBF;&#x7A0B;&#x6C60;&#x57FA;&#x672C;&#x7528;&#x6CD5;"><a href="#3-&#x7EBF;&#x7A0B;&#x6C60;&#x57FA;&#x672C;&#x7528;&#x6CD5;" class="headerlink" title="3. &#x7EBF;&#x7A0B;&#x6C60;&#x57FA;&#x672C;&#x7528;&#x6CD5;"></a>3. &#x7EBF;&#x7A0B;&#x6C60;&#x57FA;&#x672C;&#x7528;&#x6CD5;</h5><p>&#x5728;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x53C2;&#x8003; AsyncTask &#x7684;&#x505A;&#x6CD5;&#x6765;&#x8BBE;&#x7F6E;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x5E76;&#x628A;&#x521D;&#x59CB;&#x5316;&#x7684;&#x5DE5;&#x4F5C;&#x63D0;&#x4EA4;&#x5230;&#x7EBF;&#x7A0B;&#x6C60;&#x4E2D;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/462a13899a1ccd90700c06f2c3e1b1d3d76dcfef8165b037f0fc1184c3d6e9d2" alt="&#x7EBF;&#x7A0B;&#x6C60;.png"></p>
<ol start="7">
<li>&#x6539;&#x8FDB;&#x4F18;&#x5316;&#x65B9;&#x6848;</li>
</ol>
<hr>
<p>&#x4E0A;&#x4E00;&#x8282;&#x4ECB;&#x7ECD;&#x4E86;&#x600E;&#x4E48;&#x901A;&#x8FC7;&#x7EBF;&#x7A0B;&#x6C60;&#x5904;&#x7406;&#x521D;&#x59CB;&#x5316;&#x4EFB;&#x52A1;&#xFF0C;&#x8FD9;&#x4E00;&#x8282;&#x6211;&#x4EEC;&#x770B;&#x4E00;&#x4E0B;&#x6539;&#x8FDB;&#x7684;&#x5F02;&#x6B65;&#x521D;&#x59CB;&#x5316;&#x5DE5;&#x5177;&#xFF1A;&#x542F;&#x52A8;&#x5668;&#xFF08;LaunchStarter&#xFF09;&#x3002;</p>
<p>&#x901A;&#x8FC7;&#x7EBF;&#x7A0B;&#x6C60;&#x5904;&#x7406;&#x521D;&#x59CB;&#x5316;&#x4EFB;&#x52A1;&#x7684;&#x65B9;&#x5F0F;&#x5B58;&#x5728;&#x4E09;&#x4E2A;&#x95EE;&#x9898;&#x3002;</p>
<ul>
<li>&#x4EE3;&#x7801;&#x4E0D;&#x591F;&#x4F18;&#x96C5;</li>
</ul>
<p>&#x5047;&#x5982;&#x6211;&#x4EEC;&#x6709; 100 &#x4E2A;&#x521D;&#x59CB;&#x5316;&#x4EFB;&#x52A1;&#xFF0C;&#x90A3;&#x50CF;&#x4E0A;&#x9762;&#x8FD9;&#x6837;&#x7684;&#x4EE3;&#x7801;&#x5C31;&#x8981;&#x5199; 100 &#x904D;&#xFF0C;&#x63D0;&#x4EA4; 100 &#x6B21;&#x4EFB;&#x52A1;&#x3002;</p>
<ul>
<li>&#x65E0;&#x6CD5;&#x9650;&#x5236;&#x5728; onCreate() &#x4E2D;&#x5B8C;&#x6210;</li>
</ul>
<p>&#x6709;&#x7684;&#x7B2C;&#x4E09;&#x65B9;&#x5E93;&#x7684;&#x521D;&#x59CB;&#x5316;&#x4EFB;&#x52A1;&#x9700;&#x8981;&#x5728; Application &#x7684; <code>onCreate()</code> &#x65B9;&#x6CD5;&#x4E2D;&#x6267;&#x884C;&#x5B8C;&#x6210;&#xFF0C;&#x867D;&#x7136;&#x53EF;&#x4EE5;&#x7528; <code>CountDownLatch</code> &#x5B9E;&#x73B0;&#x7B49;&#x5F85;&#xFF0C;&#x4F46;&#x662F;&#x8FD8;&#x662F;&#x6709;&#x70B9;&#x7E41;&#x7410;&#x3002;</p>
<ul>
<li>&#x65E0;&#x6CD5;&#x5B9E;&#x73B0;&#x5B58;&#x5728;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;</li>
</ul>
<p>&#x6709;&#x7684;&#x521D;&#x59CB;&#x5316;&#x4EFB;&#x52A1;&#x4E4B;&#x95F4;&#x5B58;&#x5728;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#xFF0C;&#x6BD4;&#x5982;&#x6781;&#x5149;&#x63A8;&#x9001;&#x9700;&#x8981;&#x8BBE;&#x5907; ID&#xFF0C;&#x800C; initDeviceId() &#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4E5F;&#x662F;&#x4E00;&#x4E2A;&#x521D;&#x59CB;&#x5316;&#x4EFB;&#x52A1;&#x3002;</p>
<h3 id="7-1-&#x542F;&#x52A8;&#x5668;&#x7B80;&#x4ECB;"><a href="#7-1-&#x542F;&#x52A8;&#x5668;&#x7B80;&#x4ECB;" class="headerlink" title="7.1 &#x542F;&#x52A8;&#x5668;&#x7B80;&#x4ECB;"></a>7.1 &#x542F;&#x52A8;&#x5668;&#x7B80;&#x4ECB;</h3><p>&#x542F;&#x52A8;&#x5668;&#x7684;&#x6838;&#x5FC3;&#x601D;&#x60F3;&#x662F;&#x5145;&#x5206;&#x5229;&#x7528;&#x591A;&#x6838; CPU &#xFF0C;&#x81EA;&#x52A8;&#x68B3;&#x7406;&#x4EFB;&#x52A1;&#x987A;&#x5E8F;&#x3002;</p>
<p>&#x7B2C;&#x4E00;&#x6B65;&#x662F;&#x5BF9;&#x4EE3;&#x7801;&#x8FDB;&#x884C;&#x4EFB;&#x52A1;&#x5316;&#xFF0C;&#x4EFB;&#x52A1;&#x5316;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x79F0;&#xFF0C;&#x6BD4;&#x5982;&#x628A;&#x542F;&#x52A8;&#x903B;&#x8F91;&#x62BD;&#x8C61;&#x6210;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#x3002;</p>
<p>&#x7B2C;&#x4E8C;&#x6B65;&#x662F;&#x6839;&#x636E;&#x6240;&#x6709;&#x4EFB;&#x52A1;&#x7684;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#x6392;&#x5E8F;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x6709;&#x5411;&#x65E0;&#x73AF;&#x56FE;&#xFF0C;&#x8FD9;&#x4E2A;&#x56FE;&#x662F;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5BF9;&#x6240;&#x6709;&#x4EFB;&#x52A1;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#x3002;</p>
<p>&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x6709;&#x4E2A;&#x4EFB;&#x52A1; A &#x548C;&#x4EFB;&#x52A1; B&#xFF0C;&#x4EFB;&#x52A1; B &#x6267;&#x884C;&#x524D;&#x9700;&#x8981;&#x4EFB;&#x52A1; A &#x6267;&#x884C;&#x5B8C;&#xFF0C;&#x8FD9;&#x6837;&#x624D;&#x80FD;&#x62FF;&#x5230;&#x7279;&#x5B9A;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x6BD4;&#x5982;&#x4E0A;&#x9762;&#x63D0;&#x5230;&#x7684; <code>initDeviceId</code>&#x3002;</p>
<p>&#x7B2C;&#x4E09;&#x6B65;&#x662F;&#x591A;&#x7EBF;&#x7A0B;&#x6839;&#x636E;&#x6392;&#x5E8F;&#x540E;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x4F9D;&#x6B21;&#x6267;&#x884C;&#xFF0C;&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x6709;&#x4E09;&#x4E2A;&#x4EFB;&#x52A1; A&#x3001;B&#x3001;C&#x3002;</p>
<p>&#x5047;&#x5982;&#x4EFB;&#x52A1; B &#x4F9D;&#x8D56;&#x4E8E;&#x4EFB;&#x52A1; A&#xFF0C;&#x8FD9;&#x65F6;&#x5019;&#x751F;&#x6210;&#x7684;&#x6709;&#x5411;&#x65E0;&#x73AF;&#x56FE;&#x5C31;&#x662F; ACB&#xFF0C;A &#x548C; C &#x53EF;&#x4EE5;&#x63D0;&#x524D;&#x6267;&#x884C;&#xFF0C;B &#x4E00;&#x5B9A;&#x8981;&#x6392;&#x5728; A &#x4E4B;&#x540E;&#x6267;&#x884C;&#x3002;</p>
<h3 id="7-2-&#x542F;&#x52A8;&#x5668;&#x5DE5;&#x4F5C;&#x6D41;&#x7A0B;"><a href="#7-2-&#x542F;&#x52A8;&#x5668;&#x5DE5;&#x4F5C;&#x6D41;&#x7A0B;" class="headerlink" title="7.2 &#x542F;&#x52A8;&#x5668;&#x5DE5;&#x4F5C;&#x6D41;&#x7A0B;"></a>7.2 &#x542F;&#x52A8;&#x5668;&#x5DE5;&#x4F5C;&#x6D41;&#x7A0B;</h3><p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/14f8cecfd397738c191572afe907104178694328a75c29b0f09731fff14c258b" alt="&#x542F;&#x52A8;&#x5668;&#x6D41;&#x7A0B;&#x56FE;.png"></p>
<p><code>Head Task &#x5C31;&#x662F;&#x6240;&#x6709;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x524D;&#x8981;&#x505A;&#x7684;&#x4E8B;&#x60C5;</code>&#xFF0C;&#x5728;&#x8FD9;&#x91CC;&#x521D;&#x59CB;&#x5316;&#x4E00;&#x4E9B;&#x5176;&#x4ED6;&#x4EFB;&#x52A1;&#x4F9D;&#x8D56;&#x7684;&#x8D44;&#x6E90;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x53EA;&#x662F;&#x6253;&#x4E2A; Log&#x3002;</p>
<p><code>Tail Task &#x53EF;&#x7528;&#x4E8E;&#x6267;&#x884C;&#x6240;&#x6709;&#x4EFB;&#x52A1;&#x7ED3;&#x675F;&#x540E;&#x8981;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;</code>&#xFF0C;&#x6BD4;&#x5982;&#x6253;&#x5370;&#x67D0;&#x4E9B;&#x65E5;&#x5FD7;&#x6216;&#x4E0A;&#x62A5;&#x6570;&#x636E;&#x7B49;&#x4EFB;&#x52A1;&#x3002;</p>
<p><code>Idle Task &#x662F;&#x5728;&#x7A0B;&#x5E8F;&#x7A7A;&#x95F2;&#x65F6;&#x6267;&#x884C;&#x7684;&#x4EFB;&#x52A1;</code>&#x3002;</p>
<p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x4E0D;&#x4F7F;&#x7528;&#x5F02;&#x6B65;&#x7684;&#x65B9;&#x6848;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x4EFB;&#x52A1;&#x90FD;&#x4F1A;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#xFF0C;&#x4E3A;&#x4E86;&#x8BA9;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x5206;&#x62C5;&#x4E3B;&#x7EBF;&#x7A0B;&#x7684;&#x5DE5;&#x4F5C;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x628A;&#x521D;&#x59CB;&#x5316;&#x7684;&#x5DE5;&#x4F5C;&#x62C6;&#x5206;&#x6210;&#x4E00;&#x4E2A;&#x4E2A;&#x7684;&#x5B50;&#x4EFB;&#x52A1;&#xFF0C;&#x91C7;&#x7528;&#x5E76;&#x53D1;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x4F7F;&#x7528;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x540C;&#x65F6;&#x6267;&#x884C;&#x8FD9;&#x4E9B;&#x5B50;&#x4EFB;&#x52A1;&#x3002;</p>
<h3 id="7-3-&#x5B9E;&#x73B0;&#x4EFB;&#x52A1;&#x7B49;&#x5F85;&#x6267;&#x884C;"><a href="#7-3-&#x5B9E;&#x73B0;&#x4EFB;&#x52A1;&#x7B49;&#x5F85;&#x6267;&#x884C;" class="headerlink" title="7.3 &#x5B9E;&#x73B0;&#x4EFB;&#x52A1;&#x7B49;&#x5F85;&#x6267;&#x884C;"></a>7.3 &#x5B9E;&#x73B0;&#x4EFB;&#x52A1;&#x7B49;&#x5F85;&#x6267;&#x884C;</h3><p>&#x542F;&#x52A8;&#x5668;&#xFF08;LaunchStarter&#xFF09;&#x4F7F;&#x7528;&#x4E86;&#x6709;&#x5411;&#x65E0;&#x73AF;&#x56FE;&#x5B9E;&#x73B0;&#x4EFB;&#x52A1;&#x4E4B;&#x95F4;&#x7684;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#xFF0C;&#x5177;&#x4F53;&#x7684;&#x4EE3;&#x7801;&#x53EF;&#x4EE5;&#x5728;&#x672C;&#x6587;&#x6700;&#x4E0B;&#x65B9;&#x627E;&#x5230;&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E0B;&#x5177;&#x4F53;&#x64CD;&#x4F5C;&#x3002;</p>
<p>&#x9996;&#x5148;&#x5728;&#x9879;&#x76EE;&#x6839;&#x76EE;&#x5F55;&#x7684; build.gradle &#x4E2D;&#x6DFB;&#x52A0; jitpack &#x4ED3;&#x5E93;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">groovy&#x590D;&#x5236;&#x4EE3;&#x7801;allprojects {</span><br><span class="line">  repositories {</span><br><span class="line">    // ...</span><br><span class="line">    maven { url &apos;https://jitpack.io&apos; }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x7136;&#x540E;&#x5728; app &#x6A21;&#x5757;&#x7684; build.gradle &#x4E2D;&#x6DFB;&#x52A0;&#x4F9D;&#x8D56;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">groovy&#x590D;&#x5236;&#x4EE3;&#x7801;dependencies {</span><br><span class="line">  // &#x542F;&#x52A8;&#x5668;</span><br><span class="line">  implementation &apos;com.github.zeshaoaaa:LaunchStarter:0.0.1&apos;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x7136;&#x540E;&#x5B9A;&#x4E49;&#x521D;&#x59CB;&#x5316;&#x4EFB;&#x52A1;&#x8FD9;&#x4E2A;&#x6B65;&#x9AA4;&#x6D89;&#x53CA;&#x4E86;&#x51E0;&#x4E2A;&#x6982;&#x5FF5;&#xFF1A;MainTask&#x3001;Task&#x3001;needWait &#x548C; run&#x3002;</p>
<ul>
<li>MainTask</li>
</ul>
<p>MainTask &#x662F;&#x9700;&#x8981;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x7684;&#x4EFB;&#x52A1;</p>
<ul>
<li>Task</li>
</ul>
<p>Task &#x5C31;&#x662F;&#x5728;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x7684;&#x4EFB;&#x52A1;&#x3002;</p>
<ul>
<li>needWait</li>
</ul>
<p>InitWeexTask &#x4E2D;&#x91CD;&#x5199;&#x4E86; needWait &#x65B9;&#x6CD5;&#xFF0C;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x8FD4;&#x56DE; true &#x8868;&#x793A; onCreate &#x7684;&#x6267;&#x884C;&#x9700;&#x8981;&#x7B49;&#x5F85;&#x8FD9;&#x4E2A;&#x4EFB;&#x52A1;&#x5B8C;&#x6210;&#x3002;</p>
<ul>
<li>run</li>
</ul>
<p>run() &#x65B9;&#x6CD5;&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#x5C31;&#x662F;&#x9700;&#x8981;&#x505A;&#x7684;&#x521D;&#x59CB;&#x5316;&#x5DE5;&#x4F5C;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/d0535e7f3e6a445a3e32b5d2d5ab95e3a01446a02527ea397bfd01a74ac17a5d" alt="InitWeexTask.png"></p>
<p>&#x5B9A;&#x4E49;&#x597D;&#x4E86;&#x4EFB;&#x52A1;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x542F;&#x52A8;&#x4EFB;&#x52A1;&#x4E86;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x7684;&#x4EFB;&#x52A1;&#x4E2D;&#x6709;&#x9700;&#x8981;&#x7B49;&#x5F85;&#x5B8C;&#x6210;&#x7684;&#x4EFB;&#x52A1;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8C03;&#x7528; TaskDispatcher &#x7684; await() &#x65B9;&#x6CD5;&#x7B49;&#x5F85;&#x8FD9;&#x4E2A;&#x4EFB;&#x52A1;&#x5B8C;&#x6210;&#xFF0C;&#x6BD4;&#x5982; InitWeexTask&#x3002;</p>
<p>&#x4F7F;&#x7528; await() &#x65B9;&#x6CD5;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x8981;&#x5728; start() &#x65B9;&#x6CD5;&#x8C03;&#x7528;&#x540E;&#x624D;&#x80FD;&#x4F7F;&#x7528;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/f2e185d3a2bea5067c7495548f2f0bc598407a55c69d5a48d2801ab3bd582e55" alt="startDispatcher.png"></p>
<h3 id="7-4-&#x5B9E;&#x73B0;&#x4EFB;&#x52A1;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;"><a href="#7-4-&#x5B9E;&#x73B0;&#x4EFB;&#x52A1;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;" class="headerlink" title="7.4 &#x5B9E;&#x73B0;&#x4EFB;&#x52A1;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;"></a>7.4 &#x5B9E;&#x73B0;&#x4EFB;&#x52A1;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;</h3><p>&#x9664;&#x4E86;&#x4E0A;&#x9762;&#x63D0;&#x5230;&#x7684;&#x7B49;&#x5F85;&#x529F;&#x80FD;&#x4EE5;&#x5916;&#xFF0C;&#x542F;&#x52A8;&#x5668;&#x8FD8;&#x652F;&#x6301;&#x4EFB;&#x52A1;&#x4E4B;&#x95F4;&#x5B58;&#x5728;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E00;&#x4E2A;&#x6781;&#x5149;&#x63A8;&#x9001;&#x521D;&#x59CB;&#x5316;&#x4EFB;&#x52A1;&#x7684;&#x4F8B;&#x5B50;&#x3002;</p>
<p>&#x9996;&#x5148;&#x5B9A;&#x4E49; GetDeviceIdTask &#xFF0C;&#x8FD9;&#x4E2A;&#x4EFB;&#x52A1;&#x8D1F;&#x8D23;&#x521D;&#x59CB;&#x5316;&#x8BBE;&#x5907; ID &#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/1619811f4d1256fd6d2de9349a047047f5377f81d1295ac18cdbf326b5fcab51" alt="GetDeviceIdTask.png"></p>
<p>&#x7136;&#x540E;&#x5B9A;&#x4E49;InitJPushTask&#xFF0C;&#x8FD9;&#x4E2A;&#x4EFB;&#x52A1;&#x8D1F;&#x8D23;&#x521D;&#x59CB;&#x5316;&#x6781;&#x5149;&#x63A8;&#x9001; SDK&#xFF0C;InitJPushTask &#x5728;&#x542F;&#x52A8;&#x5668;&#x4E2D;&#x662F;&#x5C3E;&#x90E8;&#x4EFB;&#x52A1; Tail Task&#x3002;</p>
<p><code>InitJPushTask</code> &#x4F9D;&#x8D56;&#x4E8E; <code>GetDeviceIdTask</code>&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x91CD;&#x5199; <code>dependsOn()</code> &#x65B9;&#x6CD5;&#xFF0C;&#x5728; dependsOn &#x65B9;&#x6CD5;&#x4E2D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; Class &#x5217;&#x8868;&#xFF0C;&#x628A;&#x60F3;&#x4F9D;&#x8D56;&#x7684;&#x4EFB;&#x52A1;&#x7684; Class &#x6DFB;&#x52A0;&#x5230;&#x5217;&#x8868;&#x4E2D;&#x5E76;&#x8FD4;&#x56DE;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/6e679c13a03e3b5bbd33ee23abf4cbb6408b64bf5d4c6deb9e739dd05e6922cb" alt="InitJPushTask.png"></p>
<p>GetDeviceIdTask &#x548C; InitJPushTask &#x8FD9;&#x4E24;&#x4E2A;&#x4EFB;&#x52A1;&#x90FD;&#x4E0D;&#x9700;&#x8981;&#x7B49;&#x5F85; <code>Application</code> &#x7684; <code>onCreate()</code> &#x65B9;&#x6CD5;&#x6267;&#x884C;&#x5B8C;&#x6210;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x8FD9;&#x91CC;&#x4E0D;&#x9700;&#x8981;&#x8C03;&#x7528; <code>TaskDispatcher</code> &#x7684; <code>await()</code> &#x65B9;&#x6CD5;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/06365f6354108c02ea876efb304fb2ba26fad1f02b8d0abb2aeb1a16da0ca198" alt="startTask.png"></p>
<p>&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x8FD9;&#x4E24;&#x4E2A;&#x6B65;&#x9AA4;&#x5C31;&#x80FD;&#x5B9E;&#x73B0;&#x901A;&#x8FC7;&#x542F;&#x52A8;&#x5668;&#x5B9E;&#x73B0;&#x4EFB;&#x52A1;&#x4E4B;&#x95F4;&#x7684;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#x3002;</p>
<ol start="8">
<li>&#x5EF6;&#x8FDF;&#x6267;&#x884C;&#x4EFB;&#x52A1;</li>
</ol>
<hr>
<p>&#x5728;&#x6211;&#x4EEC;&#x5E94;&#x7528;&#x7684; <code>Application</code> &#x548C; <code>Activity</code> &#x4E2D;&#x53EF;&#x80FD;&#x5B58;&#x5728;&#x90E8;&#x5206;&#x4F18;&#x5148;&#x7EA7;&#x4E0D;&#x9AD8;&#x7684;&#x521D;&#x59CB;&#x5316;&#x4EFB;&#x52A1;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8003;&#x8651;&#x628A;&#x8FD9;&#x4E9B;&#x4EFB;&#x52A1;&#x8FDB;&#x884C;&#x5EF6;&#x8FDF;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x6BD4;&#x5982;&#x653E;&#x5728;&#x5217;&#x8868;&#x7684;&#x7B2C;&#x4E00;&#x9879;&#x663E;&#x793A;&#x51FA;&#x6765;&#x540E;&#x518D;&#x8FDB;&#x884C;&#x521D;&#x59CB;&#x5316;&#x3002;</p>
<p>&#x5728;&#x5217;&#x8868;&#x7B2C;&#x4E00;&#x9879;&#x663E;&#x793A;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x5728; onPreDraw() &#x56DE;&#x8C03;&#x4E2D;&#x6267;&#x884C;&#x521D;&#x59CB;&#x5316;&#x4EFB;&#x52A1;&#xFF0C;&#x6216;&#x8005;&#x662F;&#x901A;&#x8FC7; Handler &#x7684; postDelayed() &#x65B9;&#x6CD5;&#x5EF6;&#x8FDF;&#x6267;&#x884C;&#x521D;&#x59CB;&#x5316;&#x4EFB;&#x52A1;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x7528;&#x5EF6;&#x8FDF;&#x542F;&#x52A8;&#x5668;&#xFF0C;</p>
<h3 id="8-1-onPreDraw"><a href="#8-1-onPreDraw" class="headerlink" title="8.1 onPreDraw"></a>8.1 onPreDraw</h3><p>&#x8FD9;&#x4E00;&#x8282;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E0B;&#x600E;&#x4E48;&#x901A;&#x8FC7; OnPreDrawListener &#x628A;&#x4EFB;&#x52A1;&#x5EF6;&#x8FDF;&#x5230;&#x5217;&#x8868;&#x663E;&#x793A;&#x540E;&#x518D;&#x6267;&#x884C;&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x662F; onPreDraw &#x65B9;&#x5F0F;&#x5B9E;&#x73B0;&#x5EF6;&#x8FDF;&#x521D;&#x59CB;&#x5316;&#x7684; 3 &#x4E2A;&#x6B65;&#x9AA4;&#x3002;</p>
<ul>
<li>&#x58F0;&#x660E;&#x56DE;&#x8C03;&#x63A5;&#x53E3;</li>
<li>&#x8C03;&#x7528;&#x63A5;&#x53E3;&#x65B9;&#x6CD5;</li>
<li>&#x5728; Activity &#x4E2D;&#x76D1;&#x542C;</li>
</ul>
<p>&#x7B2C;&#x4E00;&#x6B65;&#x5148;&#x58F0;&#x660E;&#x4E00;&#x4E2A; <code>OnFeedShowCallback</code>&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/9aac47feb97bef2632f638be93aed01e98ae63943782160c4f9fd537532af87f" alt="OnFeedShowCallback.png"></p>
<p>&#x7B2C;&#x4E8C;&#x6B65;&#x662F;&#x5728; Adapter &#x4E2D;&#x7684;&#x7B2C;&#x4E00;&#x6761;&#x663E;&#x793A;&#x7684;&#x65F6;&#x5019;&#x8C03;&#x7528; onFeedShow() &#x65B9;&#x6CD5;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/376f2327a682447950638b6e99968645beeac8b41dc3bda1265c24308ab7b262" alt="AdapterOnFeedShow.png"></p>
<p>&#x7B2C;&#x4E09;&#x6B65;&#x662F;&#x5728; Activity &#x4E2D;&#x8C03;&#x7528; setOnFeedCallback &#x65B9;&#x6CD5;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/ee2d2838e6d5e5c3e345955af8b8cc5ade26c45348775e5e3900152e25e33284" alt="ActivityOnFeedShow.png"></p>
<p>&#x76F4;&#x63A5;&#x5728; onFeedShow &#x4E2D;&#x6267;&#x884C;&#x521D;&#x59CB;&#x5316;&#x4EFB;&#x52A1;&#x7684;&#x5F0A;&#x7AEF;&#x662F;&#x6709;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x6ED1;&#x52A8;&#x5361;&#x987F;&#x3002;</p>
<p>&#x5982;&#x679C;&#x6211;&#x4EEC; onPreDraw &#x7684;&#x65B9;&#x5F0F;&#x5EF6;&#x8FDF;&#x6267;&#x884C;&#x521D;&#x59CB;&#x5316;&#x4EFB;&#x52A1;&#xFF0C;&#x5047;&#x5982;&#x8FD9;&#x4E2A;&#x4EFB;&#x52A1;&#x8017;&#x65F6;&#x662F; 2 &#x79D2;&#xFF0C;&#x90A3;&#x5C31;&#x610F;&#x5473;&#x7740;&#x5728;&#x5217;&#x8868;&#x663E;&#x793A;&#x7B2C;&#x4E00;&#x6761;&#x540E;&#x7684; 2 &#x79D2;&#x5185;&#xFF0C;&#x5217;&#x8868;&#x662F;&#x65E0;&#x6CD5;&#x6ED1;&#x52A8;&#x7684;&#xFF0C;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#x5F88;&#x5DEE;&#x3002;</p>
<h3 id="8-2-postDelayed"><a href="#8-2-postDelayed" class="headerlink" title="8.2 postDelayed"></a>8.2 postDelayed</h3><p>&#x8FD8;&#x6709;&#x4E00;&#x79CD;&#x65B9;&#x5F0F;&#x5C31;&#x662F;&#x901A;&#x8FC7; Handler.postDelayed &#x65B9;&#x6CD5;&#x53D1;&#x9001;&#x4E00;&#x4E2A;&#x5EF6;&#x8FDF;&#x6D88;&#x606F;&#xFF0C;&#x6BD4;&#x5982;&#x5EF6;&#x8FDF;&#x5230; 100 &#x6BEB;&#x79D2;&#x540E;&#x6267;&#x884C;&#x3002;</p>
<p>&#x5047;&#x5982;&#x5728; Activity &#x4E2D;&#x6709; 1 &#x4E2A; 100 &#x884C;&#x7684;&#x521D;&#x59CB;&#x5316;&#x65B9;&#x6CD5;&#xFF0C;&#x6211;&#x4EEC;&#x628A;&#x524D; 10 &#x884C;&#x4EE3;&#x7801;&#x653E;&#x5728; postDelayed &#x4E2D;&#x5EF6;&#x8FDF; 100 &#x6BEB;&#x79D2;&#x6267;&#x884C;&#xFF0C;&#x628A;&#x524D; 20 &#x884C;&#x4EE3;&#x7801;&#x653E;&#x5728; postDelayed &#x4E2D;&#x5EF6;&#x8FDF; 200 &#x6BEB;&#x79D2;&#x6267;&#x884C;&#x3002;</p>
<p>&#x8FD9;&#x79CD;&#x5B9E;&#x73B0;&#x7684;&#x786E;&#x7F13;&#x89E3;&#x4E86;&#x5361;&#x987F;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x79CD;&#x5B9E;&#x73B0;&#x5B58;&#x5728;&#x4E24;&#x4E2A;&#x95EE;&#x9898;</p>
<ul>
<li>&#x4E0D;&#x591F;&#x4F18;&#x96C5;</li>
</ul>
<p>&#x5047;&#x5982;&#x6309;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x53EF;&#x4EE5;&#x5206;&#x51FA; 10 &#x4E2A;&#x521D;&#x59CB;&#x5316;&#x4EFB;&#x52A1;&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A;&#x90FD;&#x653E;&#x5728; &#x4E0D;&#x540C;&#x7684; postDelayed &#x4E2D;&#x6267;&#x884C;&#xFF0C;&#x8FD9;&#x6837;&#x5199;&#x51FA;&#x6765;&#x7684;&#x4EE3;&#x7801;&#x4E0D;&#x591F;&#x4F18;&#x96C5;&#x3002;</p>
<ul>
<li>&#x4F9D;&#x65E7;&#x5361;&#x987F;</li>
</ul>
<p>&#x5047;&#x5982;&#x628A;&#x4EFB;&#x52A1;&#x5EF6;&#x8FDF; 200 &#x6BEB;&#x79D2;&#x540E;&#x6267;&#x884C;&#xFF0C;&#x800C; 200 &#x540E;&#x7528;&#x6237;&#x8FD8;&#x5728;&#x6ED1;&#x52A8;&#x5217;&#x8868;&#xFF0C;&#x90A3;&#x8FD8;&#x662F;&#x4F1A;&#x53D1;&#x751F;&#x5361;&#x987F;&#x3002;</p>
<h3 id="8-3-&#x5EF6;&#x8FDF;&#x542F;&#x52A8;&#x5668;"><a href="#8-3-&#x5EF6;&#x8FDF;&#x542F;&#x52A8;&#x5668;" class="headerlink" title="8.3 &#x5EF6;&#x8FDF;&#x542F;&#x52A8;&#x5668;"></a>8.3 &#x5EF6;&#x8FDF;&#x542F;&#x52A8;&#x5668;</h3><p>&#x9664;&#x4E86;&#x4E0A;&#x9762;&#x8BF4;&#x5230;&#x7684;&#x65B9;&#x5F0F;&#x5916;&#xFF0C;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x6765;&#x8BF4;&#x4E00;&#x4E2A;&#x66F4;&#x597D;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF1A;<code>&#x5EF6;&#x8FDF;&#x542F;&#x52A8;&#x5668;</code>&#x3002;</p>
<p>&#x5EF6;&#x8FDF;&#x542F;&#x52A8;&#x5668;&#x5229;&#x7528;&#x4E86; IdleHandler &#x5B9E;&#x73B0;&#x4E3B;&#x7EBF;&#x7A0B;&#x7A7A;&#x95F2;&#x65F6;&#x624D;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#xFF0C;IdleHandler &#x662F; Android &#x63D0;&#x4F9B;&#x7684;&#x4E00;&#x4E2A;&#x7C7B;&#xFF0C;IdleHandler &#x4F1A;&#x5728;&#x5F53;&#x524D;&#x6D88;&#x606F;&#x961F;&#x5217;&#x7A7A;&#x95F2;&#x65F6;&#x624D;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x4E0D;&#x4F1A;&#x5F71;&#x54CD;&#x7528;&#x6237;&#x7684;&#x64CD;&#x4F5C;&#x4E86;&#x3002;</p>
<p>&#x5047;&#x5982;&#x73B0;&#x5728; MessageQueue &#x4E2D;&#x6709;&#x4E24;&#x6761;&#x6D88;&#x606F;&#xFF0C;&#x5728;&#x8FD9;&#x4E24;&#x6761;&#x6D88;&#x606F;&#x5904;&#x7406;&#x5B8C;&#x6210;&#x540E;&#xFF0C;MessageQueue &#x4F1A;&#x901A;&#x77E5; IdleHandler &#x73B0;&#x5728;&#x662F;&#x7A7A;&#x95F2;&#x72B6;&#x6001;&#xFF0C;&#x7136;&#x540E; IdleHandler &#x5C31;&#x4F1A;&#x5F00;&#x59CB;&#x5904;&#x7406;&#x5B83;&#x63A5;&#x6536;&#x5230;&#x7684;&#x4EFB;&#x52A1;&#x3002;</p>
<p><code>DelayInitDispatcher</code> &#x914D;&#x5408; onFeedShow &#x56DE;&#x8C03;&#x6765;&#x4F7F;&#x7528;&#x6548;&#x679C;&#x66F4;&#x597D;&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x6BB5;&#x4F7F;&#x7528;&#x5EF6;&#x8FDF;&#x542F;&#x52A8;&#x5668; <code>DelayInitDispatcher</code> &#x6267;&#x884C;&#x521D;&#x59CB;&#x5316;&#x4EFB;&#x52A1;&#x7684;&#x793A;&#x4F8B;&#x4EE3;&#x7801;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/9eab5f1e121f75d42506d93ead93dd340b17411322b30106e79b88da26cb4c8e" alt="DelayInitDispatcher.png"></p>
<h2 id="&#x53C2;&#x8003;&#x6587;&#x732E;"><a href="#&#x53C2;&#x8003;&#x6587;&#x732E;" class="headerlink" title="&#x53C2;&#x8003;&#x6587;&#x732E;"></a>&#x53C2;&#x8003;&#x6587;&#x732E;</h2><h3 id="1-&#x89C6;&#x9891;"><a href="#1-&#x89C6;&#x9891;" class="headerlink" title="1. &#x89C6;&#x9891;"></a>1. &#x89C6;&#x9891;</h3><ol>
<li>&#x300A;&#x56FD;&#x5185;Top&#x56E2;&#x961F;&#x5927;&#x725B;&#x5E26;&#x4F60;&#x73A9;&#x8F6C;Android&#x6027;&#x80FD;&#x5206;&#x6790;&#x4E0E;&#x4F18;&#x5316;&#x300B;</li>
<li>Android&#x5F00;&#x53D1;&#x9AD8;&#x624B;&#x8BFE;_Android_&#x79FB;&#x52A8;&#x5F00;&#x53D1;</li>
</ol>
<h3 id="2-&#x6587;&#x7AE0;"><a href="#2-&#x6587;&#x7AE0;" class="headerlink" title="2. &#x6587;&#x7AE0;"></a>2. &#x6587;&#x7AE0;</h3><ol>
<li><a href="/external_links/28ee5a8f495ff5b1b58dbe55c294c8e4.html" target="blank" rel="noopener">App startup time</a></li>
<li><a href="/external_links/4856c20a7e343f99079abed37e988966.html" target="blank" rel="noopener">Android App &#x51B7;&#x542F;&#x52A8;&#x4F18;&#x5316;&#x65B9;&#x6848;</a></li>
<li><a href="/external_links/a1e7463e46b33cb8de854004c337e27d.html" target="blank" rel="noopener">&#x4F7F;&#x7528; CPU Profiler &#x68C0;&#x67E5; CPU Activity &#x548C;&#x51FD;&#x6570;&#x8DDF;&#x8E2A;</a></li>
<li><a href="/external_links/32d0789d5aeee59afaf6bcba478945bd.html" target="blank" rel="noopener">Overview of Systrace</a></li>
</ol>
<h2 id="&#x5176;&#x4ED6;"><a href="#&#x5176;&#x4ED6;" class="headerlink" title="&#x5176;&#x4ED6;"></a>&#x5176;&#x4ED6;</h2><p><a href="/external_links/8365ea4fd7d915299ff27f91831876d9.html" target="blank" rel="noopener">&#x542F;&#x52A8;&#x5668;&#x6E90;&#x7801;</a></p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/e66f8849cf74736cfcf65a8084a5bf71.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903919064186888.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903919064186888.html" itemprop="url">Android ViewModel，再学不会你砍我</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-19T14:08:51+08:00">
                2019-08-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>&#x4E4B;&#x524D;&#x5DE5;&#x4F5C;&#x7528;&#x4E86;&#x5F88;&#x4E45;MVP&#x67B6;&#x6784;&#x4E86;&#xFF0C;&#x867D;&#x7136;&#x5F88;&#x597D;&#x7684;&#x89E3;&#x51B3;&#x4E86;M&#x5C42;&#x4E0E;V&#x5C42;&#x7684;&#x8026;&#x5408;&#x5173;&#x7CFB;&#xFF0C;&#x4F46;&#x5DE8;&#x591A;&#x7684;&#x63A5;&#x53E3;&#xFF0C;&#x96BE;&#x4EE5;&#x590D;&#x7528;&#x3001;&#x96BE;&#x4EE5;&#x5355;&#x6D4B;&#x7684;&#x95EE;&#x9898;&#x4E00;&#x76F4;&#x8426;&#x7ED5;&#x5FC3;&#x5934;&#xFF0C;&#x4E45;&#x4E45;&#x4E0D;&#x80FD;&#x5E73;&#x590D;<del>~</del>&#xFF0C;&#x4E8E;&#x662F;&#x6211;&#x5C06;&#x76EE;&#x5149;&#x8F6C;&#x5411;&#x4E86;MVVM&#x3002;</p>
</blockquote>
<p>&#x9996;&#x5148;&#x58F0;&#x660E;&#xFF0C;&#x672C;&#x7BC7;&#x4E0D;&#x662F;ViewModel&#x7684;&#x4F7F;&#x7528;&#x4ECB;&#x7ECD;&#xFF0C;&#x66F4;&#x504F;&#x5411;&#x5E95;&#x5C42;&#x539F;&#x7406;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x8FD8;&#x4E0D;&#x6E05;&#x695A;&#x5B83;&#x7684;&#x4F7F;&#x7528;&#xFF0C;&#x4E0D;&#x5EFA;&#x8BAE;&#x76F4;&#x63A5;&#x9605;&#x8BFB;~~</p>
<p>MVVM&#x4E0E;MVP&#x76F8;&#x6BD4;&#x6700;&#x5927;&#x7684;&#x533A;&#x522B;&#x5C31;&#x662F;&#x7528;ViewModel&#xFF08;&#x540E;&#x6587;&#x7B80;&#x79F0;VM&#xFF09;&#x4EE3;&#x66FF;&#x4E86;&#x539F;&#x6765;&#x7684;P&#x5C42;&#xFF0C;&#x8FD9;&#x91CC;&#x7684;VM&#x5C31;&#x662F;ViewModel&#x3002;&#x4E00;&#x53E5;&#x8BDD;&#x6982;&#x62EC;&#x5B83;&#x7684;&#x7279;&#x70B9;&#x2014;&#x5BF9;&#x6570;&#x636E;&#x72B6;&#x6001;&#x7684;&#x6301;&#x6709;&#x548C;&#x7EF4;&#x62A4;&#x3002;&#x6362;&#x8A00;&#x4E4B;&#xFF0C;&#x5B83;&#x5C06;&#x539F;&#x6765;P&#x5C42;&#x5173;&#x4E8E;&#x6570;&#x636E;&#x7684;&#x903B;&#x8F91;&#x8FD0;&#x7B97;&#x4E0E;&#x5904;&#x7406;&#x7EDF;&#x4E00;&#x653E;&#x5230;&#x4E86;VM&#x4E2D;&#xFF0C;&#x800C;&#x5269;&#x4F59;&#x7684;V&#x5C42;&#x7684;&#x64CD;&#x4F5C;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528;Databinding&#xFF0C;&#x4ECE;&#x800C;&#x5F62;&#x6210;&#x6700;&#x4E3A;&#x7B80;&#x6D01;&#x9AD8;&#x6548;&#x7684;MVVM&#x67B6;&#x6784;&#x3002;&#x8BF4;&#x5230;&#x8FD9;&#x5462;&#xFF0C;&#x63A8;&#x8350;&#x4E00;&#x7BC7;&#x65E7;&#x6587;<a href="https://dev.newban.cn/6844903917424214029">DataBinding&#xFF0C;&#x518D;&#x5B66;&#x4E0D;&#x4F1A;&#x4F60;&#x780D;&#x6211;</a>&#xFF08;&#x7CFB;&#x5144;&#x5F1F;&#x5C31;&#x780D;&#x5076;&#x7CFB;&#x5217;?&#xFF09;&#x3002;</p>
<p>&#x56DE;&#x5230;VM&#x7684;&#x7279;&#x70B9;&#x2014;&#x5BF9;&#x6570;&#x636E;&#x72B6;&#x6001;&#x7684;&#x6301;&#x6709;&#x548C;&#x7EF4;&#x62A4;&#x3002;&#x4E3A;&#x4EC0;&#x4E48;&#x9700;&#x8981;&#x505A;&#x8FD9;&#x4E9B;&#x5462;&#xFF1F;&#x4E8B;&#x5B9E;&#x4E0A;&#x5C31;&#x662F;&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x4E0B;&#x9762;&#x4E24;&#x4E2A;&#x5F00;&#x53D1;&#x4E2D;&#x5E38;&#x89C1;&#x7684;&#x95EE;&#x9898;&#x3002;</p>
<ul>
<li>Activity&#x914D;&#x7F6E;&#x66F4;&#x6539;&#x91CD;&#x5EFA;&#x65F6;(&#x6BD4;&#x5982;&#x5C4F;&#x5E55;&#x65CB;&#x8F6C;)&#x4FDD;&#x7559;&#x6570;&#x636E;</li>
<li>UI&#x7EC4;&#x4EF6;(Activity&#x4E0E;Fragment&#x3001;Fragment&#x4E0E;Fragment)&#x95F4;&#x5B9E;&#x73B0;&#x6570;&#x636E;&#x5171;&#x4EAB;&#x3002;</li>
</ul>
<p>&#x5BF9;&#x4E8E;&#x7B2C;&#x4E00;&#x6761;&#x4E0D;&#x7528;VM&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x53EA;&#x80FD;&#x901A;&#x8FC7;<code>onSaveInstanceState</code>&#x4FDD;&#x5B58;&#x6570;&#x636E;&#xFF0C;&#x5F53;activity&#x91CD;&#x5EFA;&#x540E;&#x518D;&#x901A;&#x8FC7;<code>onCreate</code>&#x6216;<code>onRestoreInstanceState</code>&#x65B9;&#x6CD5;&#x7684;bundle&#x4E2D;&#x53D6;&#x51FA;&#xFF0C;&#x4F46;&#x5982;&#x679C;&#x6570;&#x636E;&#x91CF;&#x8F83;&#x5927;&#xFF0C;&#x6570;&#x636E;&#x7684;&#x5E8F;&#x5217;&#x5316;&#x548C;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x5C06;&#x4EA7;&#x751F;&#x4E00;&#x5B9A;&#x7684;&#x6027;&#x80FD;&#x5F00;&#x9500;&#x3002;</p>
<p>&#x5BF9;&#x4E8E;&#x7B2C;&#x4E8C;&#x6761;&#x5982;&#x679C;&#x4E0D;&#x7528;VM&#xFF0C;&#x5404;&#x4E2A;UI&#x7EC4;&#x4EF6;&#x90FD;&#x8981;&#x6301;&#x6709;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x7684;&#x5F15;&#x7528;&#xFF0C;&#x8FD9;&#x4F1A;&#x5E26;&#x6765;&#x4E24;&#x4E2A;&#x9EBB;&#x70E6;&#xFF0C;&#x7B2C;&#x4E00;&#xFF0C;&#x5982;&#x679C;&#x65B0;&#x589E;&#x4E86;&#x5171;&#x4EAB;&#x6570;&#x636E;&#xFF0C;&#x5404;&#x4E2A;UI&#x7EC4;&#x4EF6;&#x9700;&#x8981;&#x518D;&#x6B21;&#x58F0;&#x660E;&#x5E76;&#x521D;&#x59CB;&#x5316;&#x65B0;&#x589E;&#x7684;&#x5171;&#x4EAB;&#x6570;&#x636E;&#xFF1B;&#x7B2C;&#x4E8C;&#xFF0C;&#x67D0;&#x4E2A;UI&#x7EC4;&#x4EF6;&#x5BF9;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x4FEE;&#x6539;&#xFF0C;&#x65E0;&#x6CD5;&#x76F4;&#x63A5;&#x901A;&#x77E5;&#x5176;&#x4ED6;UI&#x7EC4;&#x4EF6;&#xFF0C;&#x9700;&#x624B;&#x52A8;&#x5B9E;&#x73B0;&#x89C2;&#x5BDF;&#x8005;&#x6A21;&#x5F0F;&#x3002;&#x800C;VM&#x7ED3;&#x5408;LiveData&#x5C31;&#x53EF;&#x4EE5;&#x5F88;&#x8F7B;&#x677E;&#x7684;&#x5B9E;&#x73B0;&#x8FD9;&#x4E00;&#x70B9;&#x3002;</p>
<p>LiveData&#x4F5C;&#x4E3A;&#x6570;&#x636E;&#x53D8;&#x5316;&#x7684;&#x9A71;&#x52A8;&#x5668;&#xFF0C;VM&#x501F;&#x52A9;&#x5B83;&#x53EF;&#x4EE5;&#x5199;&#x51FA;&#x5341;&#x5206;&#x7B80;&#x6D01;&#x7684;MVVM&#x4EE3;&#x7801;&#x3002;</p>
<p>&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E00;&#x4E0B;VM&#x5230;&#x5E95;&#x662F;&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x4E0A;&#x8FF0;&#x9700;&#x6C42;&#x7684;&#xFF0C;&#x800C;&#x4E8B;&#x5B9E;&#x4E0A;&#x6838;&#x5FC3;&#x53EF;&#x4EE5;&#x8F6C;&#x5316;&#x4E3A;&#x4E0B;&#x9762;&#x4E24;&#x4E2A;&#x95EE;&#x9898;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/d57e1ec023d995cb4c1e4fc597b4cce0776429d624f1d3a888c9d9eef556612d" alt="&#x95EE;&#x4E2A;&#x6B63;&#x4E8B;.png"></p>
<h3 id="&#x95EE;&#x9898;"><a href="#&#x95EE;&#x9898;" class="headerlink" title="&#x95EE;&#x9898;"></a>&#x95EE;&#x9898;</h3><ol>
<li>VM&#x662F;&#x5982;&#x4F55;&#x89E3;&#x51B3;Activity&#x4E0E;Fragment&#x3001;Fragment&#x4E4B;&#x95F4;&#x6570;&#x636E;&#x5171;&#x4EAB;&#x7684;&#x95EE;&#x9898;&#xFF1F;</li>
<li>VM&#x662F;&#x5982;&#x4F55;&#x5728;Activity&#x53D1;&#x751F;&#x65CB;&#x8F6C;&#x65F6;&#x4FDD;&#x7559;&#x6570;&#x636E;&#x7684;&#xFF1F;&#x4E0D;&#x662F;&#x4E5F;&#x8D70;onDestroy&#x4E86;&#x5417;&#xFF1F;</li>
</ol>
<h3 id="ViewModel&#x662F;&#x4EC0;&#x4E48;&#xFF1F;"><a href="#ViewModel&#x662F;&#x4EC0;&#x4E48;&#xFF1F;" class="headerlink" title="ViewModel&#x662F;&#x4EC0;&#x4E48;&#xFF1F;"></a>ViewModel&#x662F;&#x4EC0;&#x4E48;&#xFF1F;</h3><p>&#x56DE;&#x7B54;&#x4E0A;&#x9762;&#x95EE;&#x9898;&#x4E4B;&#x524D;&#x6211;&#x4EEC;&#x8981;&#x5148;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;VM&#x5230;&#x5E95;&#x662F;&#x4E2A;&#x5565;&#x3002;</p>
<p><strong>&#x6587;&#x5185;&#x6E90;&#x7801;&#x6765;&#x81EA;&#xFF0C;Android Architect Component&#xFF08;AAC&#xFF09;ViewModel&#x7EC4;&#x4EF6;1.1.1&#x7248;&#x672C;&#x3002;</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public abstract class ViewModel {</span><br><span class="line">    protected void onCleared() {</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5C31;&#x662F;&#x4E2A;&#x62BD;&#x8C61;&#x7C7B;&#x751A;&#x81F3;&#x8FDE;&#x62BD;&#x8C61;&#x65B9;&#x6CD5;&#x90FD;&#x6CA1;&#x6709;&#xFF0C;&#x7B80;&#x5355;&#x7684;&#x4EE4;&#x4EBA;&#x53D1;&#x6307;&#x3002;onCleared&#x65B9;&#x6CD5;&#x63D0;&#x4F9B;&#x4E86;&#x91CA;&#x653E;VM&#x4E2D;&#x8D44;&#x6E90;&#x7684;&#x4E00;&#x4E2A;&#x673A;&#x4F1A;&#xFF0C;&#x5728;Activity/Fragment&#x7684;onDestroy&#x751F;&#x547D;&#x5468;&#x671F;&#x4E2D;&#x88AB;&#x8C03;&#x7528;&#x3002;&#x7C7B;&#x5E93;&#x5185;&#x90E8;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x5B9E;&#x73B0;&#x7C7B;AndroidViewModel&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public class AndroidViewModel extends ViewModel {</span><br><span class="line">    private Application mApplication;</span><br><span class="line"></span><br><span class="line">    public AndroidViewModel(@NonNull Application application) {</span><br><span class="line">        mApplication = application;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public &lt;T extends Application&gt; T getApplication() {</span><br><span class="line">        return (T) mApplication;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>AndroidViewModel&#x5185;&#x6301;&#x6709;Application&#x7684;&#x5F15;&#x7528;&#xFF0C;&#x6240;&#x4EE5;&#x901A;&#x5E38;&#x53EF;&#x4EE5;&#x505A;&#x4E00;&#x4E9B;&#x5168;&#x751F;&#x547D;&#x5468;&#x671F;&#x7684;&#x5DE5;&#x4F5C;&#x3002;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x80FD;&#x6301;&#x6709;&#x4E00;&#x4E2A;Activity&#x5462;&#xFF1F;&#x8FD9;&#x4E0E;ViewModel&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x6709;&#x5173;&#xFF0C;&#x6211;&#x4EEC;&#x7A0D;&#x540E;&#x89E3;&#x91CA;&#x3002;</p>
<h3 id="&#x521B;&#x5EFA;ViewModel"><a href="#&#x521B;&#x5EFA;ViewModel" class="headerlink" title="&#x521B;&#x5EFA;ViewModel"></a>&#x521B;&#x5EFA;ViewModel</h3><p>&#x63A5;&#x4E0B;&#x6765;&#x770B;&#x770B;VM&#x7684;&#x521B;&#x5EFA;&#xFF0C;&#x901A;&#x5E38;&#x6211;&#x4EEC;&#x662F;&#x8FD9;&#x6837;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;VM&#x7684;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;val viewModel = ViewModelProviders.of(this).get(AndroidViewModel::class.java)</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x91CC;&#x7684;this&#x53EF;&#x4EE5;&#x662F;FragmentActivity&#x6216;Fragment&#xFF0C;&#x4ED6;&#x4EEC;&#x90FD;&#x662F;support-v4&#x5305;&#x4E2D;&#x63A7;&#x4EF6;&#xFF0C;&#x4E3A;&#x7684;&#x662F;&#x5411;&#x4E0B;&#x517C;&#x5BB9;&#x3002;<br>&#x6211;&#x4EEC;&#x4EE5;FragmentActivity&#x4E3A;&#x4F8B;&#x770B;&#x770B;of&#x65B9;&#x6CD5;&#x505A;&#x4E86;&#x4EC0;&#x4E48;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;### 1.1 ViewModelProviders</span><br><span class="line">public static ViewModelProvider of(@NonNull FragmentActivity activity) {</span><br><span class="line">    return of(activity, null);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">public static ViewModelProvider of(@NonNull FragmentActivity activity,</span><br><span class="line">        @Nullable Factory factory) {</span><br><span class="line">    Application application = checkApplication(activity);</span><br><span class="line">    if (factory == null) {</span><br><span class="line">        factory = ViewModelProvider.AndroidViewModelFactory.getInstance(application);</span><br><span class="line">    }</span><br><span class="line">    //&#x8FD9;&#x91CC;&#x7528;&#x7684;&#x5DE5;&#x5382;&#x6A21;&#x5F0F;&#xFF0C;vm&#x7684;&#x521B;&#x5EFA;&#x4EA4;&#x7531;&#x5DE5;&#x5382;&#x5B8C;&#x6210;&#xFF0C;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;AndroidViewModelFactory</span><br><span class="line">    return new ViewModelProvider(ViewModelStores.of(activity), factory);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x4E24;&#x4E2A;&#x65B9;&#x6CD5;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x90FD;&#x662F;<code>ViewModelProvider</code>&#xFF0C;ViewModelProviders&#x662F;&#x64CD;&#x4F5C;ViewModelProvider&#x7684;&#x5DE5;&#x5177;&#x7C7B;&#xFF0C;&#x5185;&#x90E8;&#x90FD;&#x662F;&#x83B7;&#x53D6;ViewModelProvider&#x7684;&#x9759;&#x6001;&#x65B9;&#x6CD5;&#xFF0C;&#x800C;&#x771F;&#x6B63;&#x7684;VM&#x7684;&#x4E1A;&#x52A1;&#x5728;ViewModelProvider&#x4E2D;&#x3002;</p>
<p>&#x540C;&#x7406;ViewModelStores&#x548C;ViewModelStore&#x7684;&#x5173;&#x7CFB;&#x4EA6;&#x662F;&#x5982;&#x6B64;&#x3002;&#x65E2;&#x7136;&#x8981;&#x4FDD;&#x7559;VM&#x7684;&#x6570;&#x636E;&#xFF0C;&#x5FC5;&#x7136;&#x8981;&#x6709;&#x4E2A;&#x5B58;&#x50A8;&#x5355;&#x5143;&#x3002;ViewModelStore&#x5C31;&#x662F;&#x8FD9;&#x4E2A;&#x5B58;&#x50A8;&#x5355;&#x5143;&#xFF0C;&#x56E0;&#x4E3A;&#x4E00;&#x4E2A;Activity&#x4E2D;&#x53EF;&#x80FD;&#x6709;&#x591A;&#x4E2A;VM&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x4E00;&#x4E2A;Map&#x6765;&#x7EF4;&#x62A4;&#x5173;&#x7CFB;&#x8868;&#xFF0C;key&#x4E3A;VM&#x7684;&#x540D;&#x5B57;&#xFF0C;value&#x4E3A;VM&#x5BF9;&#x8C61;&#xFF0C;&#x7B80;&#x5355;&#x7684;&#x4EE4;&#x4EBA;&#x53D1;&#x6307;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public class ViewModelStore {</span><br><span class="line"></span><br><span class="line">    private final HashMap&lt;String, ViewModel&gt; mMap = new HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    final void put(String key, ViewModel viewModel) {</span><br><span class="line">        ViewModel oldViewModel = mMap.put(key, viewModel);</span><br><span class="line">        if (oldViewModel != null) {</span><br><span class="line">            oldViewModel.onCleared();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    final ViewModel get(String key) {</span><br><span class="line">        return mMap.get(key);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public final void clear() {</span><br><span class="line">        for (ViewModel vm : mMap.values()) {</span><br><span class="line">            vm.onCleared();</span><br><span class="line">        }</span><br><span class="line">        mMap.clear();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>ViewModelStores&#x4EC5;&#x8D1F;&#x8D23;&#x63D0;&#x4F9B;&#x5DE5;&#x5177;&#x65B9;&#x6CD5;&#x521B;&#x5EFA;ViewModelStore&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;### 1.2</span><br><span class="line">public class ViewModelStores {</span><br><span class="line">    private ViewModelStores() {</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public static ViewModelStore of(@NonNull FragmentActivity activity) {</span><br><span class="line">        if (activity instanceof ViewModelStoreOwner) {</span><br><span class="line">            return ((ViewModelStoreOwner) activity).getViewModelStore();</span><br><span class="line">        }</span><br><span class="line">        return holderFragmentFor(activity).getViewModelStore();</span><br><span class="line">    }</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>ViewModelStoreOwner&#x53C8;&#x662F;&#x4EC0;&#x4E48;&#x9B3C;&#xFF1F;&#x5B83;&#x662F;&#x62BD;&#x8C61;&#x4E86;&#x4E00;&#x4E2A;&#x83B7;&#x53D6;ViewModelStore&#x7684;&#x63A5;&#x53E3;&#x3002;&#x5E38;&#x89C1;&#x7684;&#x5B9E;&#x73B0;&#x7C7B;&#x6709;Fragment/FragmentActivity&#xFF0C;&#x8FD9;&#x4E5F;&#x4E0D;&#x96BE;&#x7406;&#x89E3;&#xFF0C;&#x56E0;&#x4E3A;&#x8981;&#x60F3;&#x5728;&#x914D;&#x7F6E;&#x6539;&#x53D8;&#x65F6;&#x4FDD;&#x7559;&#x6570;&#x636E;&#xFF0C;&#x9996;&#x5148;&#x5F97;&#x8981;&#x5C06;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x8D77;&#x6765;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public interface ViewModelStoreOwner {</span><br><span class="line">    ViewModelStore getViewModelStore();</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x611F;&#x89C9;&#x8FD9;&#x65F6;&#x9700;&#x8981;&#x4E00;&#x5F20;&#x7C7B;&#x56FE;&#x4E86;&#xFF0C;&#x4E0D;&#x7136;&#x4F60;&#x662F;&#x4E0D;&#x662F;&#x60F3;&#x780D;&#x6B7B;&#x6211;&#xFF1F;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/27a23578589242532c85aa4eab05fb3aeefea79499268cfff9ed80d7d4ccb351" alt="format.jpg"></p>
<p>&#x4E8B;&#x5B9E;&#x4E0A;&#x76EE;&#x524D;&#x63D0;&#x5230;&#x7684;&#x8FD9;&#x51E0;&#x4E2A;&#x7C7B;&#x5DF2;&#x7ECF;&#x51E0;&#x4E4E;&#x6DB5;&#x76D6;&#x4E86;viewmodel&#x5E93;&#x4E2D;&#x6240;&#x6709;&#x7684;&#x7C7B;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x56DE;&#x5230;1.1&#x4E2D;&#x521B;&#x5EFA;ViewModelProvider&#x7684;&#x4EE3;&#x7801;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;return new ViewModelProvider(ViewModelStores.of(activity), factory);</span><br></pre></td></tr></table></figure>

<p>&#x6211;&#x4EEC;&#x5C06;activity&#x4E2D;&#x7684;VM&#x5B58;&#x50A8;&#x5355;&#x5143;&#x548C;VM&#x7684;&#x521B;&#x5EFA;&#x5DE5;&#x5382;(AndroidViewModelFactory)&#x4F20;&#x5165;&#x5F97;&#x5230;&#x4E00;&#x4E2A;ViewModelProvider&#x5BF9;&#x8C61;&#xFF0C;&#x6700;&#x7EC8;&#x901A;&#x8FC7;&#x5176;get&#x65B9;&#x6CD5;&#x5F97;&#x5230;VM&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public &lt;T extends ViewModel&gt; T get(@NonNull Class&lt;T&gt; modelClass) {</span><br><span class="line">    String canonicalName = modelClass.getCanonicalName();</span><br><span class="line">    if (canonicalName == null) {</span><br><span class="line">        throw new IllegalArgumentException(&quot;Local and anonymous classes can not be ViewModels&quot;);</span><br><span class="line">    }</span><br><span class="line">    return get(DEFAULT_KEY + &quot;:&quot; + canonicalName, modelClass);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4EE5;Default_Key&#x4F5C;&#x4E3A;&#x524D;&#x7F00;&#x52A0;&#x4E0A;VM&#x7684;&#x5B8C;&#x6574;&#x7C7B;&#x540D;&#x4E3A;key&#xFF0C;&#x83B7;&#x53D6;VM&#x5BF9;&#x8C61;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public &lt;T extends ViewModel&gt; T get(@NonNull String key, @NonNull Class&lt;T&gt; modelClass) {</span><br><span class="line">    ViewModel viewModel = mViewModelStore.get(key);</span><br><span class="line"></span><br><span class="line">    //&#x5148;&#x770B;ViewModelStore&#x4E2D;&#x662F;&#x5426;&#x5B58;&#x5728;&#xFF0C;&#x5982;&#x679C;&#x5B58;&#x4E86;&#x5C31;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;</span><br><span class="line">    if (modelClass.isInstance(viewModel)) {</span><br><span class="line">        return (T) viewModel;</span><br><span class="line">    }</span><br><span class="line">    ...</span><br><span class="line">    //&#x5982;&#x679C;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;VM&#x5E76;&#x5B58;&#x5165;ViewModelStore</span><br><span class="line">    viewModel = mFactory.create(modelClass);</span><br><span class="line">    mViewModelStore.put(key, viewModel);</span><br><span class="line">    return (T) viewModel;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;mFactory&#x4E3A;AndroidViewModelFactory&#xFF0C;&#x6765;&#x770B;&#x4E0B;&#x5B83;&#x662F;&#x5982;&#x4F55;&#x521B;&#x5EFA;VM&#x7684;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public static class AndroidViewModelFactory extends ViewModelProvider.NewInstanceFactory {</span><br><span class="line">    ...</span><br><span class="line">    public &lt;T extends ViewModel&gt; T create(@NonNull Class&lt;T&gt; modelClass) {</span><br><span class="line">        if (AndroidViewModel.class.isAssignableFrom(modelClass)) {</span><br><span class="line">            try {</span><br><span class="line">                //&#x901A;&#x8FC7;&#x53CD;&#x5C04;&#x521B;&#x5EFA;AndroidViewModel&#x5BF9;&#x8C61;</span><br><span class="line">                return modelClass.getConstructor(Application.class).newInstance(mApplication);</span><br><span class="line">            } catch (NoSuchMethodException e) {</span><br><span class="line">                ...</span><br><span class="line">            } </span><br><span class="line">        }</span><br><span class="line">        return super.create(modelClass);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x81F3;&#x6B64;VM&#x7684;&#x521B;&#x5EFA;&#x6211;&#x4EEC;&#x5C31;&#x8BB2;&#x5B8C;&#x4E86;&#xFF0C;&#x53EF;&#x4EE5;&#x603B;&#x7ED3;&#x4E00;&#x4E0B;&#xFF1A;</p>
<ol>
<li>ViewModelStore&#x662F;&#x5B58;&#x50A8;VM&#x7684;&#x6570;&#x636E;&#x5355;&#x5143;&#xFF0C;&#x5B58;&#x50A8;&#x7ED3;&#x6784;&#x4E3A;Map&#xFF0C;Fragment/FragmentActivity&#x6301;&#x6709;&#x5176;&#x5F15;&#x7528;&#x3002;</li>
<li>ViewModelProvider&#x901A;&#x8FC7;get&#x65B9;&#x6CD5;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;VM&#xFF0C;&#x521B;&#x5EFA;&#x4E4B;&#x524D;&#x4F1A;&#x5148;&#x68C0;&#x67E5;ViewModelStore&#x4E2D;&#x662F;&#x5426;&#x5B58;&#x5728;&#xFF0C;&#x82E5;&#x4E0D;&#x5B58;&#x5728;&#x5219;&#x901A;&#x8FC7;&#x53CD;&#x5C04;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;VM&#x3002;</li>
</ol>
<h3 id="UI&#x7EC4;&#x4EF6;&#x95F4;&#x6570;&#x636E;&#x5171;&#x4EAB;"><a href="#UI&#x7EC4;&#x4EF6;&#x95F4;&#x6570;&#x636E;&#x5171;&#x4EAB;" class="headerlink" title="UI&#x7EC4;&#x4EF6;&#x95F4;&#x6570;&#x636E;&#x5171;&#x4EAB;"></a>UI&#x7EC4;&#x4EF6;&#x95F4;&#x6570;&#x636E;&#x5171;&#x4EAB;</h3><p>&#x8BB2;&#x5230;&#x8FD9;&#x6211;&#x4EEC;&#x56DE;&#x8FC7;&#x5934;&#x6765;&#x770B;&#x770B;&#x5F00;&#x7BC7;&#x63D0;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF1A;Activity&#x4E0E;Fragment&#xFF0C;Fragment&#x4E4B;&#x95F4;&#x662F;&#x5982;&#x4F55;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x7684;&#x3002;<br>&#x6570;&#x636E;&#x8981;&#x5B9E;&#x73B0;&#x5171;&#x4EAB;&#x6700;&#x7B80;&#x5355;&#x7684;&#x65B9;&#x5F0F;&#x5C31;&#x662F;&#x5927;&#x5BB6;&#x90FD;&#x8BFB;&#x53D6;&#x4E00;&#x4EFD;&#x6570;&#x636E;&#x6E90;&#x3002;<br>&#x6211;&#x4EEC;&#x6765;&#x770B;&#x770B;&#x6570;&#x636E;&#x6E90;ViewModelStore&#x5177;&#x4F53;&#x662F;&#x5728;&#x54EA;&#x91CC;&#x521B;&#x5EFA;&#x7684;&#x3002;</p>
<p>&#x4E0A;&#x9762;&#x8BB2;&#x7684;&#x4EE3;&#x7801;&#x7247;&#x6BB5;1.2&#x53EF;&#x77E5;&#xFF0C;&#x6709;&#x4E24;&#x6761;&#x8DEF;&#x5F84;&#x521B;&#x5EFA;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public static ViewModelStore of(@NonNull FragmentActivity activity) {</span><br><span class="line">    if (activity instanceof ViewModelStoreOwner) { &#x2460;</span><br><span class="line">        return ((ViewModelStoreOwner) activity).getViewModelStore();</span><br><span class="line">    }</span><br><span class="line">    return holderFragmentFor(activity).getViewModelStore();&#x2461;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x2460;&#x5982;&#x679C;FragmentActivity&#x662F;ViewModelStoreOwner&#x7C7B;&#x578B;&#x901A;&#x8FC7;activity&#x7684;getViewModelStore&#x65B9;&#x6CD5;&#x521B;&#x5EFA;&#x3002;</p>
<p>&#x2461;&#x5426;&#x5219;&#x901A;&#x8FC7;&#x4E00;&#x4E2A;HolderFragment&#x6765;&#x521B;&#x5EFA;&#x3002;</p>
<p>&#x5148;&#x6765;&#x770B;&#x2460;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;### FragmentActivity</span><br><span class="line">private ViewModelStore mViewModelStore;</span><br><span class="line">public ViewModelStore getViewModelStore() {</span><br><span class="line">    ...</span><br><span class="line">    if (mViewModelStore == null) {</span><br><span class="line">        mViewModelStore = new ViewModelStore();</span><br><span class="line">    }</span><br><span class="line">    return mViewModelStore;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x7B80;&#x5355;&#x7684;&#x4EE4;&#x4EBA;&#x53D1;ck&#xFF0C;&#x65E2;&#x7136;&#x662F;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x90A3;&#x6BCF;&#x6B21;&#x8C03;&#x7528;&#x5FC5;&#x5B9A;&#x8FD4;&#x56DE;&#x540C;&#x4E00;&#x4E2A;VM&#xFF0C;&#x53EA;&#x8981;&#x4FDD;&#x8BC1;&#x8C03;&#x7528;<code>ViewModelProviders.of(activity).get(AndroidViewModel::class.java)</code>&#x4F20;&#x9012;&#x7684;activity&#x662F;&#x540C;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x3002;</p>
<p>&#x518D;&#x6765;&#x770B;&#x2461;&#xFF0C;&#x6574;&#x4F53;&#x601D;&#x8DEF;&#x662F;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x4E0D;&#x53EF;&#x89C1;&#x7684;HolderFragment&#x5230;&#x5F53;&#x524D;Activity&#x4E2D;&#xFF0C;&#x518D;&#x5C06;&#x6570;&#x636E;&#x6E90;&#x8BB0;&#x5F55;&#x5728;&#x8FD9;&#x4E2A;fragment&#x4E2D;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;### HolderFragment extends Fragment implements ViewModelStoreOwner</span><br><span class="line">private ViewModelStore mViewModelStore = new ViewModelStore();</span><br><span class="line"></span><br><span class="line">public static HolderFragment holderFragmentFor(FragmentActivity activity) {</span><br><span class="line">    return sHolderFragmentManager.holderFragmentFor(activity);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">HolderFragment holderFragmentFor(FragmentActivity activity) {</span><br><span class="line">    FragmentManager fm = activity.getSupportFragmentManager();</span><br><span class="line">    //&#x5148;&#x67E5;&#x4E00;&#x4E0B;&#x5F53;&#x524D;&#x6709;&#x6CA1;&#x6709;&#x8FD9;&#x4E2A;HolderFragment</span><br><span class="line">    HolderFragment holder = findHolderFragment(fm);</span><br><span class="line">    if (holder != null) {</span><br><span class="line">        return holder;</span><br><span class="line">    }</span><br><span class="line">    ...</span><br><span class="line">    //&#x6CA1;&#x6709;&#x5C31;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;</span><br><span class="line">    holder = createHolderFragment(fm);</span><br><span class="line">    ...</span><br><span class="line">    return holder;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">private static HolderFragment createHolderFragment(FragmentManager fragmentManager) {</span><br><span class="line">    //&#x521B;&#x5EFA;&#x4E00;&#x4E2A;HolderFragment&#x3001;&#x6253;&#x4E0A;tag&#xFF0C;&#x518D;&#x6DFB;&#x52A0;&#x5230;&#x5F53;&#x524D;&#x754C;&#x9762;&#x3002;</span><br><span class="line">    HolderFragment holder = new HolderFragment();</span><br><span class="line">    fragmentManager.beginTransaction().add(holder, HOLDER_TAG).commitAllowingStateLoss();</span><br><span class="line">    return holder;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4E4B;&#x6240;&#x4EE5;&#x4E0D;&#x53EF;&#x89C1;&#xFF0C;&#x662F;&#x56E0;&#x4E3A;&#x8FD9;&#x4E2A;HolderFragment&#x5E76;&#x672A;&#x590D;&#x5199;onCreateView&#x3002;&#x8FD9;&#x4E48;&#x505A;&#x7684;&#x539F;&#x56E0;&#x662F;&#x65E9;&#x671F;&#x7684;&#x7248;&#x672C;&#x60F3;&#x5229;&#x7528;Fragment&#x7684;<code>setRetainInstance()</code>API&#x63A5;&#x53E3;&#xFF0C;&#x6765;&#x5B9E;&#x73B0;&#x5F53;Activity&#x56E0;&#x914D;&#x7F6E;&#x53D1;&#x751F;&#x6539;&#x53D8;&#x65F6;&#x4FDD;&#x7559;&#x8FD9;&#x4E2A;&#x4E0D;&#x53EF;&#x89C1;&#x7684;Fragment&#xFF0C;&#x751F;&#x547D;&#x5468;&#x671F;&#x53EA;&#x8D70;onDetach&#x548C;onAttach&#x3002;&#x65E2;&#x7136;&#x6CA1;&#x6709;&#x88AB;&#x91CD;&#x5EFA;&#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x6301;&#x6709;&#x7684;&#x6570;&#x636E;&#x81EA;&#x7136;&#x5C31;&#x4F1A;&#x88AB;&#x4FDD;&#x7559;&#xFF0C;&#x5176;&#x4ED6;&#x4E3B;&#x52A8;&#x9000;&#x51FA;&#x7684;&#x60C5;&#x51B5;&#x8D70;&#x5230;onDestroy&#x4F1A;&#x6E05;&#x7A7A;&#x6570;&#x636E;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;### HolderFragment</span><br><span class="line">public HolderFragment() {</span><br><span class="line">    setRetainInstance(true);</span><br><span class="line">}</span><br><span class="line">//&#x88AB;&#x9500;&#x6BC1;&#x65F6;&#x6E05;&#x9664;&#x6570;&#x636E;&#x6E90;</span><br><span class="line">public void onDestroy() {</span><br><span class="line">    super.onDestroy();</span><br><span class="line">    mViewModelStore.clear();</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x90A3;&#x4E48;&#x5728;&#x5B9E;&#x9645;&#x4F7F;&#x7528;&#x4E2D;&#x4F1A;&#x8D70;&#x54EA;&#x6761;&#x8DEF;&#x5F84;&#x5462;&#xFF1F;&#x6211;&#x4EEC;&#x53CD;&#x89C2;&#x6E90;&#x7801;FragmentActivity&#x662F;&#x5B9E;&#x73B0;&#x4E86;ViewModelStoreOwner&#x63A5;&#x53E3;&#x7684;&#xFF0C;&#x90A3;&#x6B64;&#x5904;&#x4EE3;&#x7801;&#x4E0D;&#x662F;&#x80AF;&#x5B9A;&#x8D70;&#x2460;&#x5417;&#xFF1F;&#x2461;&#x662F;&#x4E0D;&#x662F;&#x8D70;&#x9519;&#x7247;&#x573A;&#x4E86;&#xFF1F;&#x6B64;&#x65F6;&#x6211;&#x611F;&#x89C9;&#x6211;&#x7684;&#x667A;&#x5546;&#x53D7;&#x5230;&#x4E86;&#x4FAE;&#x8FB1;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/436417e491a642af36b106ab957b2daa90e7928a812d74c5342dae386d344700" alt="&#x667A;&#x5546;&#x4E0D;&#x8DB3;.jpeg"></p>
<p>&#x539F;&#x6765;&#x5728;appcompat-v7&#x7248;&#x672C;&#x5728;<code>27.1.0</code>&#x4E4B;&#x524D;FragmentActivity&#x5E76;&#x6CA1;&#x6709;&#x5B9E;&#x73B0;ViewModelStoreOwner&#x63A5;&#x53E3;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x7EDF;&#x4E00;&#x7528;HolderFragment&#x5B9E;&#x73B0;&#x3002;google&#x5927;&#x5927;&#x53EF;&#x80FD;&#x662F;&#x89C9;&#x5F97;&#x8FD9;&#x4E2A;HolderFragment&#x6709;&#x70B9;&#x592A;&#x9A9A;&#x64CD;&#x4F5C;&#x4E86;&#x5C31;&#x8BA9;&#x540E;&#x7EED;&#x7248;&#x672C;&#x7684;FragmentActivity&#x76F4;&#x63A5;&#x652F;&#x6301;&#x4E86;VM&#x5B58;&#x50A8;&#x3002;&#x56E0;&#x4E3A;&#x6DFB;&#x52A0;&#x7684;HolderFragment&#x4E5F;&#x662F;&#x6709;&#x7EF4;&#x62A4;&#x6210;&#x672C;&#x7684;&#xFF0C;&#x4E14;&#x4E0A;&#x5C42;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;FragmentManager&#x83B7;&#x53D6;&#x5230;&#x5B83;&#xFF0C;&#x7136;&#x540E;&#x5BF9;&#x5B83;&#x8FDB;&#x884C;&#x5176;&#x4ED6;&#x9A9A;&#x64CD;&#x4F5C;&#xFF0C;&#x60F3;&#x60F3;&#x90FD;&#x523A;&#x6FC0;&#x3002;&#x3002;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/f023976ef74b339c0f339c9c02efc789029d687e66d28a52c66c2d5de8ac3a32" alt="&#x6DF1;&#x4E95;&#x51B0;.jpg"></p>
<p>&#x4E0A;&#x9762;&#x6211;&#x4EEC;&#x5206;&#x6790;&#x4E86;&#x521B;&#x5EFA;VM&#x65F6;&#x4F20;&#x5165;FragmentActivity&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x90A3;&#x4F20;&#x5165;Fragment&#x7684;&#x60C5;&#x51B5;&#x5462;&#xFF1F;&#x5B9E;&#x9645;&#x4E0A;&#x8DDF;FragmentActivity&#x51E0;&#x4E4E;&#x4E00;&#x6837;&#xFF0C;<strong>&#x5728;Fragment&#x4E2D;&#x4E5F;&#x6709;&#x4E00;&#x4E2A;mViewModelStore&#x6210;&#x5458;&#x53D8;&#x91CF;</strong>&#xFF0C;&#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x54E6;&#xFF0C;&#x975E;&#x5E38;&#x5173;&#x952E;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x4E0B;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x521B;&#x5EFA;&#x7684;&#x662F;&#x4E24;&#x4E2A;VM&#xFF0C;&#x662F;&#x4E0D;&#x80FD;&#x5171;&#x4EAB;&#x6570;&#x636E;&#x7684;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;### MainActivity</span><br><span class="line">override fun onCreate(savedInstanceState: Bundle?) {</span><br><span class="line">    //&#x4F20;&#x9012;activity</span><br><span class="line">    val vm = ViewModelProviders.of(this).get(AndroidViewModel::class.java)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">### TestFragment</span><br><span class="line">override fun onCreate(savedInstanceState: Bundle?) {</span><br><span class="line">    super.onCreate(savedInstanceState)</span><br><span class="line">    //&#x4F20;&#x9012;fragment</span><br><span class="line">    val vm = ViewModelProviders.of(this).get(AndroidViewModel::class.java)</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x6B63;&#x786E;&#x7684;&#x5199;&#x6CD5;&#x5E94;&#x8BE5;&#x662F;&#x4E8C;&#x8005;&#x5728;of&#x65B9;&#x6CD5;&#x4E2D;&#x4F20;&#x5165;&#x76F8;&#x540C;&#x7684;&#x5BF9;&#x8C61;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;### TestFragment.onCreate(savedInstanceState: Bundle?)</span><br><span class="line">//&#x901A;&#x8FC7;getActivity&#x65B9;&#x6CD5;&#x53D6;&#x5F97;Fragment&#x6240;&#x5728;&#x7684;Activity</span><br><span class="line">val vm = activity?.run {</span><br><span class="line">    //run&#x51FD;&#x6570; &#x8FD9;&#x91CC;&#x7684;this&#x6307;&#x4EE3;activity</span><br><span class="line">    ViewModelProviders.of(this)[AndroidViewModel::class.java]</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>Fragment&#x4E4B;&#x95F4;&#x540C;&#x7406;&#xFF0C;&#x5982;&#x679C;Fragment&#x95F4;&#x540C;&#x5C42;&#x7EA7;&#xFF0C;&#x53EF;&#x4EE5;&#x7EDF;&#x4E00;&#x901A;&#x8FC7;Activity&#x6216;&#x5171;&#x540C;&#x7684;parentFragment(&#x5982;&#x679C;&#x6709;)&#x83B7;&#x53D6;VM&#xFF1B;&#x5982;&#x679C;&#x6709;&#x5D4C;&#x5957;&#x5173;&#x7CFB;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;parentFragment&#x5BF9;&#x8C61;&#x83B7;&#x53D6;VM&#x3002;</p>
<h3 id="Activity&#x914D;&#x7F6E;&#x53D1;&#x751F;&#x53D8;&#x5316;&#x65F6;&#x6570;&#x636E;&#x4FDD;&#x6301;"><a href="#Activity&#x914D;&#x7F6E;&#x53D1;&#x751F;&#x53D8;&#x5316;&#x65F6;&#x6570;&#x636E;&#x4FDD;&#x6301;" class="headerlink" title="Activity&#x914D;&#x7F6E;&#x53D1;&#x751F;&#x53D8;&#x5316;&#x65F6;&#x6570;&#x636E;&#x4FDD;&#x6301;"></a>Activity&#x914D;&#x7F6E;&#x53D1;&#x751F;&#x53D8;&#x5316;&#x65F6;&#x6570;&#x636E;&#x4FDD;&#x6301;</h3><p>&#x5176;&#x5B9E;&#x5728;&#x4E0A;&#x9762;&#x7684;&#x5185;&#x5BB9;&#x4E2D;&#x5DF2;&#x7ECF;&#x8BB2;&#x4E86;HolderFragment&#x662F;&#x5982;&#x4F55;&#x4FDD;&#x7559;&#x6570;&#x636E;&#x7684;&#xFF0C;&#x5C31;&#x662F;&#x5229;&#x7528;Fragment&#x7684;<code>setRetainInstance()</code>API&#x63A5;&#x53E3;&#x5B8C;&#x6210;&#x7684;&#x3002;</p>
<p>google&#x4E3A;&#x4E86;&#x4F18;&#x5316;&#x8FD9;&#x70B9;&#x5728;&#x65B0;&#x7248;&#x672C;&#x91CC;&#x76F4;&#x63A5;&#x8BA9;FragmentActivity&#x652F;&#x6301;&#x4E86;&#x6570;&#x636E;&#x7684;&#x4FDD;&#x6301;&#xFF0C;&#x5B98;&#x65B9;&#x7684;&#x914D;&#x56FE;&#x5F88;&#x597D;&#x7684;&#x9610;&#x91CA;&#x4E86;VM&#x5728;Activity&#x56E0;&#x914D;&#x7F6E;&#x53D8;&#x5316;&#x9500;&#x6BC1;&#x91CD;&#x5EFA;&#x65F6;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/b99c5d7c9f18f12e423e6cc2c53505bc6ee29776ab0cbfafcb88a3e10523e696" alt="viewmodel-lifecycle.png"></p>
<p>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x6765;&#x5206;&#x6790;&#x4E00;&#x4E0B;&#x662F;&#x5982;&#x4F55;&#x505A;&#x5230;&#x7684;&#xFF0C;&#x5148;&#x770B;onDestroy&#x7684;&#x9500;&#x6BC1;&#x903B;&#x8F91;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;### FragmentActivity</span><br><span class="line">protected void onDestroy() {</span><br><span class="line">    super.onDestroy();</span><br><span class="line">    ...</span><br><span class="line">    if (mViewModelStore != null &amp;&amp; !mRetaining) {</span><br><span class="line">        mViewModelStore.clear();</span><br><span class="line">    }</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>mRetaining&#x4E3A;true&#x65F6;&#x5C06;&#x4F1A;&#x4FDD;&#x7559;VM&#x6570;&#x636E;&#xFF0C;&#x90A3;&#x5B83;&#x4F55;&#x65F6;&#x4E3A;true&#x5462;&#xFF1F;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;### FragmentActivity</span><br><span class="line">public final Object onRetainNonConfigurationInstance() {</span><br><span class="line">    if (mStopped) {</span><br><span class="line">        //&#x65B9;&#x6CD5;&#x5185;&#x90E8;&#x4F1A;&#x5C06;mRetaining&#x8BBE;&#x7F6E;&#x4E3A;true</span><br><span class="line">        doReallyStop(true);</span><br><span class="line">    }</span><br><span class="line">    ...</span><br><span class="line">    NonConfigurationInstances nci = new NonConfigurationInstances();</span><br><span class="line">    nci.custom = custom;</span><br><span class="line">    //&#x4FDD;&#x5B58;VM&#x6570;&#x636E;</span><br><span class="line">    nci.viewModelStore = mViewModelStore;</span><br><span class="line">    nci.fragments = fragments;</span><br><span class="line">    return nci;//&#x6570;&#x636E;&#x8FD4;&#x56DE;&#x4F1A;&#x88AB;&#x8BB0;&#x5F55;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>onRetainNonConfigurationInstance&#x65B9;&#x6CD5;&#x88AB;retainNonConfigurationInstances&#x65B9;&#x6CD5;&#x8C03;&#x7528;&#xFF0C;&#x800C;&#x5B83;&#x4F1A;&#x88AB;ActivityThread&#x4E2D;performDestroyActivity&#x65B9;&#x6CD5;&#x8C03;&#x7528;&#xFF0C;&#x5B83;&#x6267;&#x884C;&#x5728;onDestroy&#x751F;&#x547D;&#x5468;&#x671F;&#x4E4B;&#x524D;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;### ActivityThread</span><br><span class="line">performDestroyActivity(...boolean getNonConfigInstance,...) {</span><br><span class="line">    ...</span><br><span class="line">	if (getNonConfigInstance) {</span><br><span class="line">	    //&#x5982;&#x679C;&#x914D;&#x7F6E;&#x53D1;&#x751F;&#x6539;&#x53D8;&#x8BB0;&#x5F55;&#x4E0B;&#x6765;</span><br><span class="line">        r.lastNonConfigurationInstances</span><br><span class="line">                = r.activity.retainNonConfigurationInstances();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x6837;VM&#x6570;&#x636E;&#x5C31;&#x88AB;&#x5C01;&#x88C5;&#x5230;&#x4E86;NonConfigurationInstances&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x4E2D;&#x4E86;&#x3002;</p>
<p>&#x90A3;&#x4F55;&#x65F6;&#x88AB;&#x8FD8;&#x539F;&#x5462;&#xFF1F;&#x7B54;&#x6848;&#x662F;Activity&#x7684;attach&#x65F6;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;### Activity</span><br><span class="line">final void attach(Context context, ... NonConfigurationInstances lastNonConfigurationInstances,...) {</span><br><span class="line">    ...</span><br><span class="line">	mLastNonConfigurationInstances = lastNonConfigurationInstances;</span><br><span class="line">	...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>VM&#x6570;&#x636E;&#x6E90;mViewModelStore&#x5728;onCreate&#x65F6;&#x88AB;&#x91CD;&#x65B0;&#x8D4B;&#x503C;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;### FragmentActivity</span><br><span class="line">protected void onCreate(@Nullable Bundle savedInstanceState) {</span><br><span class="line">    super.onCreate(savedInstanceState);</span><br><span class="line">    //&#x8FD8;&#x539F;&#x6570;&#x636E;</span><br><span class="line">    NonConfigurationInstances nc =</span><br><span class="line">            (NonConfigurationInstances) getLastNonConfigurationInstance();</span><br><span class="line">    if (nc != null) {</span><br><span class="line">        mViewModelStore = nc.viewModelStore;</span><br><span class="line">    }</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x6700;&#x540E;&#x6211;&#x4EEC;&#x6574;&#x7406;&#x4E00;&#x4E0B;&#x6574;&#x4F53;&#x6D41;&#x7A0B;&#x56FE;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/9609a21e410d73e21b6638a7c8cee065f643d6a00105f7419f260dd181f58adf" alt="&#x4EE3;&#x7801;&#x6D41;&#x7A0B;.png"></p>
<p>&#x4ECE;&#x4E0A;&#x9762;&#x7684;&#x6D41;&#x7A0B;&#x53EF;&#x4EE5;&#x770B;&#x51FA;VM&#x5728;Activity&#x56E0;&#x914D;&#x7F6E;&#x53D8;&#x5316;&#x5BFC;&#x81F4;&#x91CD;&#x5EFA;&#x65F6;&#x4F1A;&#x88AB;&#x4FDD;&#x7559;&#xFF0C;&#x4ECE;&#x751F;&#x547D;&#x5468;&#x671F;&#x7684;&#x89D2;&#x5EA6;&#x6765;&#x8BF4;&#xFF0C;ViewModel&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x53EF;&#x80FD;&#x4F1A;&#x957F;&#x4E8E;Activity&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x3002;</p>
<p><strong>&#x8FD9;&#x8BF4;&#x660E;&#x6211;&#x4EEC;&#x5728;&#x4F7F;&#x7528;ViewModel&#x65F6;&#x4E00;&#x5B9A;&#x8981;&#x6CE8;&#x610F;&#xFF0C;&#x4E0D;&#x80FD;&#x8BA9;&#x5176;&#x5F15;&#x7528;Activity&#x6216;View&#xFF0C;&#x5426;&#x5219;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x3002;</strong></p>
<p>&#x597D;&#x4E86;&#xFF0C;&#x6574;&#x4E2A;ViewModel&#x7684;&#x5206;&#x6790;&#x5C31;&#x7ED3;&#x675F;&#x4E86;&#xFF0C;&#x5E0C;&#x671B;&#x4F60;&#x5728;&#x4E86;&#x89E3;&#x5176;&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#x7684;&#x540C;&#x65F6;&#x5BF9;MVVM&#x6A21;&#x5F0F;&#x4E5F;&#x6709;&#x4E00;&#x4E9B;&#x65B0;&#x7684;&#x8BA4;&#x8BC6;&#x3002;&#x72EC;&#x7ACB;&#x7684;&#x770B;ViewModel&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x5B9E;&#x9645;&#x610F;&#x4E49;&#xFF0C;&#x66F4;&#x50CF;&#x662F;&#x6570;&#x636E;&#x5BB9;&#x5668;&#xFF0C;&#x7ED3;&#x5408;LiveData&#x4F7F;&#x7528;&#x66F4;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#xFF0C;&#x540E;&#x7EED;&#x7AE0;&#x8282;&#x4F1A;&#x7EE7;&#x7EED;&#x5206;&#x4EAB;LiveData&#x7684;&#x5185;&#x5BB9;&#x3002;</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/ca3f9f72091443afc281a34752ea799b.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903918112079885.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903918112079885.html" itemprop="url">关于 adb 命令你所需要知道的</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-17T19:13:48+08:00">
                2019-08-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/98a04e3373d26484e9254b0a76a2f683b2954ae83900264565e658171e255c32" alt></p>
<h2 id="&#x6982;&#x8FF0;"><a href="#&#x6982;&#x8FF0;" class="headerlink" title="&#x6982;&#x8FF0;"></a>&#x6982;&#x8FF0;</h2><p>Android Debug Bridge (adb) &#x662F;&#x4E00;&#x4E2A;&#x901A;&#x7528;&#x547D;&#x4EE4;&#x884C;&#x5DE5;&#x5177;&#xFF0C;&#x662F; Android &#x5F00;&#x53D1;/&#x6D4B;&#x8BD5;&#x4EBA;&#x5458;&#x5FC5;&#x5907;&#x5DE5;&#x5177;&#xFF0C;&#x5173;&#x4E8E;adb&#x7684;&#x8BE6;&#x7EC6;&#x4ECB;&#x7ECD;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x8C37;&#x6B4C; adb &#x5B98;&#x65B9;&#x4E2D;&#x6587;&#x6587;&#x6863;  <a href="/external_links/3e14473be52a05b67b35a3915c96311b.html" target="blank" rel="noopener">Android Debug Bridge</a>, &#x8FD9;&#x91CC;&#x53EA;&#x662F;&#x603B;&#x7ED3;&#x4E86;&#x4E00;&#x4E0B;&#x5E38;&#x7528;&#x7684;&#x547D;&#x4EE4;</p>
<p><strong>&#x6587;&#x7AE0;&#x4E2D;&#x6D89;&#x53CA;&#x7684;&#x547D;&#x4EE4;&#x8BF4;&#x660E;</strong></p>
<ul>
<li>&#x6587;&#x7AE0;&#x4E2D;&#x7684;&#x547D;&#x4EE4;&#x53EA;&#x9488;&#x5BF9;&#x4E8E;&#x8FDE;&#x63A5;&#x4E00;&#x4E2A;&#x8BBE;&#x5907;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5982;&#x679C;&#x8FDE;&#x63A5;&#x591A;&#x4E2A;&#x8BBE;&#x5907;&#xFF0C;&#x9700;&#x8981;&#x5728; adb shell -s &#x540E;&#x9762;&#x6307;&#x5B9A;&#x8BBE;&#x5907;&#x5E8F;&#x5217;&#x53F7;, &#x683C;&#x5F0F;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&#x683C;&#x5F0F;&#xFF1A;</span><br><span class="line">adb -s 225278f8 shell</span><br><span class="line"></span><br><span class="line">&#x83B7;&#x53D6;&#x8BBE;&#x5907;&#x5E8F;&#x5217;&#x53F7;:</span><br><span class="line">adb devices</span><br></pre></td></tr></table></figure>

<ul>
<li><code>&lt;serial number&gt;</code> : &#x8BBE;&#x5907;&#x5E8F;&#x5217;&#x53F7;</li>
<li><code>&lt;package_name&gt;</code> : Apk &#x7684;&#x5305;&#x540D;</li>
<li><code>&lt;local&gt;</code> : pc &#x7AEF;&#x8DEF;&#x5F84;</li>
<li><code>&lt;remote&gt;</code> : Android &#x8BBE;&#x5907;&#x4E0A;&#x7684;&#x8DEF;&#x5F84;</li>
<li><code>&lt;filepath_in_device&gt;</code> : Android &#x8BBE;&#x5907;&#x7684;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;</li>
<li><code>&lt;local_apk_path&gt;</code> : pc &#x7AEF; apk &#x7684;&#x8DEF;&#x5F84;</li>
<li><code>&lt;package_name&gt;/&lt;main_class&gt;</code> : Apk&#x5305;&#x540D; / &#x542F;&#x52A8;&#x7C7B;&#xFF0C;&#x683C;&#x5F0F;&#x5982;&#x4E0B;&#x6240;&#x793A;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&#x683C;&#x5F0F;&#xFF1A;</span><br><span class="line">google.architecture.universal/.ActivityMain</span><br><span class="line"></span><br><span class="line">&#x6253;&#x5F00;Apk&#xFF0C;&#x7136;&#x540E;&#x8F93;&#x5165;&#x4E0B;&#x9762;&#x547D;&#x4EE4;&#x67E5;&#x770B;&#xFF1A;</span><br><span class="line">adb shell dumpsys window | grep mCurrentFocus</span><br></pre></td></tr></table></figure>

<h2 id="&#x547D;&#x4EE4;&#x603B;&#x7ED3;"><a href="#&#x547D;&#x4EE4;&#x603B;&#x7ED3;" class="headerlink" title="&#x547D;&#x4EE4;&#x603B;&#x7ED3;"></a>&#x547D;&#x4EE4;&#x603B;&#x7ED3;</h2><p>&#x4EE5;&#x4E0B;&#x6240;&#x6709;&#x547D;&#x4EE4;&#x53C2;&#x8003;&#x8C37;&#x6B4C; adb &#x5B98;&#x65B9;&#x6587;&#x6863;  <a href="/external_links/3e14473be52a05b67b35a3915c96311b.html" target="blank" rel="noopener">Android Debug Bridge</a>&#xFF0C;&#x5217;&#x51FA;&#x4E86;&#x7ECF;&#x5E38;&#x7528;&#x547D;&#x4EE4;</p>
<h3 id="&#x5E38;&#x7528;&#x547D;&#x4EE4;"><a href="#&#x5E38;&#x7528;&#x547D;&#x4EE4;" class="headerlink" title="&#x5E38;&#x7528;&#x547D;&#x4EE4;"></a>&#x5E38;&#x7528;&#x547D;&#x4EE4;</h3><table>
<thead>
<tr>
<th>&#x5907;&#x6CE8;</th>
<th>&#x547D;&#x4EE4;</th>
</tr>
</thead>
<tbody><tr>
<td>&#x67E5;&#x770B;&#x8FDE;&#x63A5;&#x8BBE;&#x5907;</td>
<td><code>adb devices</code></td>
</tr>
<tr>
<td>&#x67E5;&#x770B;&#x8FDE;&#x63A5;&#x8BBE;&#x5907;&#x5217;&#x8868;&#x4FE1;&#x606F;</td>
<td><code>adb devices -l</code></td>
</tr>
<tr>
<td>&#x6307;&#x5B9A;&#x8BBE;&#x5907;</td>
<td><code>adb -s &lt;serial number&gt; shell</code></td>
</tr>
</tbody></table>
<h3 id="&#x4E0A;&#x4F20;&#x6587;&#x4EF6;&#x548C;&#x4E0B;&#x8F7D;&#x6587;&#x4EF6;"><a href="#&#x4E0A;&#x4F20;&#x6587;&#x4EF6;&#x548C;&#x4E0B;&#x8F7D;&#x6587;&#x4EF6;" class="headerlink" title="&#x4E0A;&#x4F20;&#x6587;&#x4EF6;&#x548C;&#x4E0B;&#x8F7D;&#x6587;&#x4EF6;"></a>&#x4E0A;&#x4F20;&#x6587;&#x4EF6;&#x548C;&#x4E0B;&#x8F7D;&#x6587;&#x4EF6;</h3><table>
<thead>
<tr>
<th>&#x5907;&#x6CE8;</th>
<th>&#x547D;&#x4EE4;</th>
</tr>
</thead>
<tbody><tr>
<td>&#x5C06;&#x7535;&#x8111;&#x4E0A;&#x7684;&#x6587;&#x4EF6;&#x4E0A;&#x4F20;&#x7684;&#x8BBE;&#x5907;</td>
<td><code>adb push &lt;local&gt; &lt;remote&gt;</code></td>
</tr>
<tr>
<td>&#x8BBE;&#x5907;&#x4E2D;&#x7684;&#x6587;&#x4EF6;&#x4E0B;&#x8F7D;&#x5230;&#x7535;&#x8111;</td>
<td><code>adb pull &lt;remote&gt; &lt;local&gt;</code></td>
</tr>
</tbody></table>
<h3 id="&#x5B89;&#x88C5;&#x548C;&#x5378;&#x8F7D;&#x5E94;&#x7528;"><a href="#&#x5B89;&#x88C5;&#x548C;&#x5378;&#x8F7D;&#x5E94;&#x7528;" class="headerlink" title="&#x5B89;&#x88C5;&#x548C;&#x5378;&#x8F7D;&#x5E94;&#x7528;"></a>&#x5B89;&#x88C5;&#x548C;&#x5378;&#x8F7D;&#x5E94;&#x7528;</h3><table>
<thead>
<tr>
<th>&#x5907;&#x6CE8;</th>
<th>&#x547D;&#x4EE4;</th>
</tr>
</thead>
<tbody><tr>
<td>&#x5B89;&#x88C5;Apk</td>
<td>&#x200B;<code>adb install &lt;local_apk_path&gt;</code></td>
</tr>
<tr>
<td>&#x5B89;&#x88C5;Apk &#x5E76;&#x4E14;&#x6388;&#x4E88;Apk&#x6240;&#x6709;&#x6743;&#x9650;</td>
<td>&#x200B;<code>adb install -g &lt;local_apk_path&gt;</code></td>
</tr>
<tr>
<td>&#x8986;&#x76D6;&#x5B89;&#x88C5;Apk&#x4E14;&#x4FDD;&#x7559;&#x6570;&#x636E;</td>
<td>&#x200B;<code>adb install &lt;local_apk_path&gt;</code></td>
</tr>
<tr>
<td>&#x964D;&#x7EA7;&#x5B89;&#x88C5;Apk</td>
<td>&#x200B;<code>adb install -d &lt;local_apk_path&gt;</code></td>
</tr>
<tr>
<td>&#x5378;&#x8F7D;Apk</td>
<td>&#x200B;<code>adb uninstall &lt;package_name&gt;</code></td>
</tr>
<tr>
<td>&#x5378;&#x8F7D;Apk&#x4E14;&#x4FDD;&#x7559;&#x6570;&#x636E;</td>
<td><code>adb shell pm uninstall -k &lt;package_name&gt;</code></td>
</tr>
<tr>
<td>&#x9759;&#x9ED8;&#x5B89;&#x88C5;&#x5E94;&#x7528;</td>
<td>&#x200B;<code>adb shell pm install -t -r &lt;local_apk_path&gt;</code></td>
</tr>
<tr>
<td>&#x5378;&#x8F7D;&#x6240;&#x6709;&#x5E94;&#x7528;(&#x5305;&#x62EC;&#x7CFB;&#x7EDF;&#x5E94;&#x7528;)</td>
<td>&#x200B;<code>adb shell pm uninstall -k --user 0 &lt;package_name&gt;</code></td>
</tr>
</tbody></table>
<h3 id="pm"><a href="#pm" class="headerlink" title="pm"></a>pm</h3><table>
<thead>
<tr>
<th>&#x5907;&#x6CE8;</th>
<th>&#x547D;&#x4EE4;</th>
</tr>
</thead>
<tbody><tr>
<td>&#x663E;&#x793A;&#x7B2C;&#x4E09;&#x653E;&#x5E94;&#x7528;</td>
<td><code>adb shell pm list package -3</code></td>
</tr>
<tr>
<td>&#x663E;&#x793A;&#x7CFB;&#x7EDF;&#x5E94;&#x7528;</td>
<td><code>adb shell pm list packages -s</code></td>
</tr>
<tr>
<td>&#x663E;&#x793A;apk&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x548C;&#x5305;&#x540D;&#x5217;&#x8868;</td>
<td><code>adb shell pm list packages -f</code></td>
</tr>
<tr>
<td>&#x67E5;&#x770B;apk&#x8DEF;&#x5F84;</td>
<td><code>adb shell pm path &lt;package_name&gt;</code></td>
</tr>
<tr>
<td>&#x6E05;&#x9664;&#x6570;&#x636E;&#x548C;&#x7F13;&#x5B58;</td>
<td><code>adb shell pm clear &lt;package_name&gt;</code></td>
</tr>
</tbody></table>
<h3 id="dumpsys"><a href="#dumpsys" class="headerlink" title="dumpsys"></a>dumpsys</h3><table>
<thead>
<tr>
<th>&#x5907;&#x6CE8;</th>
<th>&#x547D;&#x4EE4;</th>
</tr>
</thead>
<tbody><tr>
<td>&#x67E5;&#x770B;&#x8FD0;&#x884C;Apk&#x7684;&#x5305;&#x540D;</td>
<td>`adb shell dumpsys window</td>
</tr>
<tr>
<td>&#x67E5;&#x770B;Activity&#x4EFB;&#x52A1;&#x6808;</td>
<td><code>adb shell dumpsys activity activities</code></td>
</tr>
<tr>
<td>&#x67E5;&#x770B;&#x5806;&#x7684;&#x5206;&#x914D;&#x60C5;&#x51B5;</td>
<td><code>adb shell dumpsys meminfo &lt;package_name&gt;</code></td>
</tr>
<tr>
<td>&#x67E5;&#x770B;&#x5E94;&#x7528;&#x4FE1;&#x606F;</td>
<td><code>adb shell dumpsys package &lt;package_name&gt;</code></td>
</tr>
<tr>
<td>&#x83B7;&#x53D6;&#x8BBE;&#x5907;&#x663E;&#x793A;&#x5C4F;&#x53C2;&#x6570;&#x4FE1;&#x606F;</td>
<td><code>adb shell dumpsys window displays</code></td>
</tr>
<tr>
<td>&#x6E05;&#x9664;bugreport&#x4FE1;&#x606F;</td>
<td><code>adb shell dumpsys batterystats --reset</code></td>
</tr>
<tr>
<td>&#x4ECE;bugreport&#x4E2D;&#x8FC7;&#x6EE4;&#x5173;&#x952E;&#x5B57;&#x4FE1;&#x606F;</td>
<td>`adb shell dumpsys batterystats</td>
</tr>
<tr>
<td>&#x8FDB;&#x5165;dozeModel deep&#x72B6;&#x6001;</td>
<td><code>adb shell dumpsys deviceidle force-idle</code></td>
</tr>
<tr>
<td>&#x8FDB;&#x5165;dozeModel light&#x72B6;&#x6001;</td>
<td><code>adb shell dumpsys deviceidle force-idle light</code></td>
</tr>
<tr>
<td>&#x9000;&#x51FA;dozeModel</td>
<td><code>adb shell dumpsys deviceidle unforce</code></td>
</tr>
<tr>
<td>&#x91CD;&#x65B0;&#x6FC0;&#x6D3B;&#x8BBE;&#x5907;</td>
<td><code>adb shell dumpsys battery reset</code></td>
</tr>
<tr>
<td>&#x9000;&#x51FA;&#x5145;&#x7535;&#x72B6;&#x6001;</td>
<td><code>adb shell dumpsys battery unplug</code></td>
</tr>
<tr>
<td>&#x7981;&#x7528;doze mode</td>
<td><code>adb shell dumpsys deviceidle disable</code>  <code>adb shell dumpsys deviceidle whitelist</code></td>
</tr>
</tbody></table>
<h3 id="getprop"><a href="#getprop" class="headerlink" title="getprop"></a>getprop</h3><table>
<thead>
<tr>
<th>&#x5907;&#x6CE8;</th>
<th>&#x547D;&#x4EE4;</th>
</tr>
</thead>
<tbody><tr>
<td>&#x83B7;&#x53D6;&#x8BBE;&#x5907;&#x578B;&#x53F7;</td>
<td><code>adb shell getprop ro.product.model</code></td>
</tr>
<tr>
<td>&#x83B7;&#x53D6;&#x8BBE;&#x5907;&#x7684;Android&#x7CFB;&#x7EDF;&#x7248;&#x672C;</td>
<td><code>adb shell getprop ro.build.version.release</code></td>
</tr>
</tbody></table>
<h3 id="wm"><a href="#wm" class="headerlink" title="wm"></a>wm</h3><table>
<thead>
<tr>
<th>&#x5907;&#x6CE8;</th>
<th>&#x547D;&#x4EE4;</th>
</tr>
</thead>
<tbody><tr>
<td>&#x83B7;&#x53D6;&#x8BBE;&#x5907;&#x5C4F;&#x5E55;&#x5206;&#x8FA8;&#x7387;</td>
<td><code>adb shell wm size</code></td>
</tr>
<tr>
<td>&#x83B7;&#x53D6;&#x8BBE;&#x5907;&#x5C4F;&#x5E55;&#x5BC6;&#x5EA6;&#xFF08;&#x5355;&#x4F4D;&#xFF1A;dpi&#xFF09;</td>
<td><code>adb shell wm density</code></td>
</tr>
</tbody></table>
<h3 id="&#x8C03;&#x8BD5;&#x547D;&#x4EE4;"><a href="#&#x8C03;&#x8BD5;&#x547D;&#x4EE4;" class="headerlink" title="&#x8C03;&#x8BD5;&#x547D;&#x4EE4;"></a>&#x8C03;&#x8BD5;&#x547D;&#x4EE4;</h3><table>
<thead>
<tr>
<th>&#x5907;&#x6CE8;</th>
<th>&#x547D;&#x4EE4;</th>
</tr>
</thead>
<tbody><tr>
<td>&#x67E5;&#x770B;&#x5E94;&#x7528;&#x7684;&#x8FDB;&#x7A0B;</td>
<td>`adb shell ps -ef</td>
</tr>
<tr>
<td>&#x67E5;&#x770B;&#x5185;&#x5B58;&#x5360;&#x7528;&#x60C5;&#x51B5;</td>
<td>`adb shell ps</td>
</tr>
<tr>
<td>&#x67E5;&#x770B;Activity&#x7684;&#x542F;&#x52A8;&#x65F6;&#x95F4;</td>
<td><code>&#x200B;adb shell am start -W &lt;package_name&gt;/&lt;main_class&gt;</code></td>
</tr>
<tr>
<td>&#x5F3A;&#x5236;&#x5173;&#x95ED;&#x5E94;&#x7528;</td>
<td><code>&#x200B;adb shell am force-stop &lt;package_name&gt;</code></td>
</tr>
<tr>
<td>&#x5B9E;&#x65F6;&#x67E5;&#x770B;&#x8BBE;&#x5907;CPU&#x3001;&#x5185;&#x5B58;&#x5360;&#x7528;&#x7B49;&#x4FE1;&#x606F;</td>
<td><code>adb shell top</code></td>
</tr>
<tr>
<td>&#x5B9E;&#x65F6;&#x67E5;&#x770B;&#x5185;&#x5B58;&#x5360;&#x7528;&#x6392;&#x540D;&#x524D;number&#x7684;&#x5E94;&#x7528;</td>
<td><code>adb shell top -m &lt;number&gt;</code></td>
</tr>
<tr>
<td>&#x4E3A;Apk&#x8DD1;number&#x6B21;monkey&#x6D4B;&#x8BD5;</td>
<td><code>adb shell monkey -v -p &lt;package_name&gt; &lt;number&gt;</code></td>
</tr>
<tr>
<td>&#x83B7;&#x53D6;&#x8BBE;&#x5907;&#x7684;MAC&#x5730;&#x5740;</td>
<td><code>adb shell cat /sys/class/net/wlan0/address</code></td>
</tr>
<tr>
<td>&#x83B7;&#x53D6;&#x8BBE;&#x5907;&#x7684;&#x5185;&#x5B58;&#x5360;&#x7528;&#x4FE1;&#x606F;</td>
<td><code>adb shell cat /proc/meminfo</code></td>
</tr>
</tbody></table>
<h3 id="&#x5176;&#x4ED6;&#x547D;&#x4EE4;"><a href="#&#x5176;&#x4ED6;&#x547D;&#x4EE4;" class="headerlink" title="&#x5176;&#x4ED6;&#x547D;&#x4EE4;"></a>&#x5176;&#x4ED6;&#x547D;&#x4EE4;</h3><table>
<thead>
<tr>
<th>&#x5907;&#x6CE8;</th>
<th>&#x547D;&#x4EE4;</th>
</tr>
</thead>
<tbody><tr>
<td>&#x67E5;&#x770B;&#x65E5;&#x5FD7;</td>
<td>`adb shell logcat</td>
</tr>
<tr>
<td>&#x8F93;&#x51FA;&#x65E5;&#x5FD7;&#x5230;log.txt&#x6587;&#x4EF6;</td>
<td>`adb shell logcat</td>
</tr>
<tr>
<td>&#x622A;&#x53D6;&#x5C4F;&#x5E55;</td>
<td>&#x200B;<code>adb shell screencap -p &lt;filepath_in_device&gt;</code></td>
</tr>
<tr>
<td>&#x5F55;&#x5236;&#x5C4F;&#x5E55;</td>
<td><code>adb shell screenrecord -p &lt;filepath_in_device&gt;</code></td>
</tr>
</tbody></table>
<h2 id="&#x5E38;&#x89C1;&#x95EE;&#x9898;&#x6C47;&#x603B;"><a href="#&#x5E38;&#x89C1;&#x95EE;&#x9898;&#x6C47;&#x603B;" class="headerlink" title="&#x5E38;&#x89C1;&#x95EE;&#x9898;&#x6C47;&#x603B;"></a>&#x5E38;&#x89C1;&#x95EE;&#x9898;&#x6C47;&#x603B;</h2><p>&#x5217;&#x4E3E;&#x4E00;&#x4E9B;&#x5E38;&#x89C1;&#x95EE;&#x9898;&#xFF0C;&#x540E;&#x7EED;&#x4F1A;&#x4E0D;&#x65AD;&#x5B8C;&#x5584;</p>
<h3 id="1-ubuntu-&#x4E0B;&#x4F7F;&#x7528;-adb-&#x51FA;&#x73B0;-no-permissions-&#x95EE;&#x9898;&#x89E3;&#x51B3;&#x65B9;&#x6848;"><a href="#1-ubuntu-&#x4E0B;&#x4F7F;&#x7528;-adb-&#x51FA;&#x73B0;-no-permissions-&#x95EE;&#x9898;&#x89E3;&#x51B3;&#x65B9;&#x6848;" class="headerlink" title="1. ubuntu &#x4E0B;&#x4F7F;&#x7528; adb &#x51FA;&#x73B0; no permissions &#x95EE;&#x9898;&#x89E3;&#x51B3;&#x65B9;&#x6848;"></a>1. ubuntu &#x4E0B;&#x4F7F;&#x7528; adb &#x51FA;&#x73B0; no permissions &#x95EE;&#x9898;&#x89E3;&#x51B3;&#x65B9;&#x6848;</h3><p>&#x8FD0;&#x884C; sudo adb devices &#x51FA;&#x73B0;&#x4E0B;&#x5217;&#x60C5;&#x51B5;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;List of devices attached </span><br><span class="line">2aca417d	no permissions</span><br></pre></td></tr></table></figure>

<p><strong>&#x5982;&#x4F55;&#x89E3;&#x51B3; no permissions&#xFF1F;</strong></p>
<p>&#x5728;&#x672A;&#x8FDE;&#x63A5; Android &#x8BBE;&#x5907;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8FD0;&#x884C;&#x547D;&#x4EE4; lsusb, &#x67E5;&#x770B;&#x4E00;&#x4E0B; ubuntu &#x4E0B;&#x7684; usb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;Bus 002 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub</span><br><span class="line">Bus 001 Device 003: ID 413c:2113 Dell Computer Corp. </span><br><span class="line">Bus 001 Device 002: ID 413c:301a Dell Computer Corp. </span><br><span class="line">Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</span><br></pre></td></tr></table></figure>

<p>&#x8FDE;&#x63A5; Android &#x8BBE;&#x5907;, &#x6253;&#x5F00; usb &#x8C03;&#x8BD5;&#x6A21;&#x5F0F;&#xFF0C;&#x8FD0;&#x884C;&#x547D;&#x4EE4; lsusb, &#x67E5;&#x770B;&#x4E00;&#x4E0B; ubuntu &#x4E0B;&#x7684; usb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;Bus 002 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub</span><br><span class="line">Bus 001 Device 003: ID 413c:2113 Dell Computer Corp. </span><br><span class="line">Bus 001 Device 002: ID 413c:301a Dell Computer Corp. </span><br><span class="line">Bus 001 Device 055: ID 18d1:4ee7 Google Inc. </span><br><span class="line">Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</span><br></pre></td></tr></table></figure>

<p>&#x901A;&#x8FC7;&#x5BF9;&#x6BD4;&#x4E24;&#x4E2A;&#x7ED3;&#x679C;&#xFF0C;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x5230;&#x65B0;&#x8FDE;&#x63A5;&#x7684; Android &#x8BBE;&#x5907;&#x4FE1;&#x606F;&#xFF0C;&#x6CE8;&#x610F;&#x5176; ID &#x53F7;&#xFF0C;&#x8FD9;&#x91CC;&#x662F;<strong>18d1:4ee7</strong>   </p>
<p>&#x7136;&#x540E;&#x8FDB;&#x5165;&#x5230; /etc/udev/rules.d/ &#x76EE;&#x5F55;&#x4E0B;&#xFF0C;&#x67E5;&#x770B;&#x662F;&#x5426;&#x6709; .rules &#x6587;&#x4EF6;&#xFF0E;&#x6CA1;&#x6709;&#x5219;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;(&#x540D;&#x5B57;&#x53EF;&#x4EE5;&#x968F;&#x610F;&#x53D6;&#xFF0C;&#x4E0D;&#x80FD;&#x6709;&#x4E2D;&#x6587;)&#xFF0C;&#x6DFB;&#x52A0;&#x7AEF;&#x53E3;&#x4FE1;&#x606F;&#x5230;&#x6587;&#x4EF6;&#x4E2D;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;#&amp;emsp;&#x6253;&#x5F00;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;</span><br><span class="line">sudo vim 51-android.rules</span><br><span class="line"></span><br><span class="line"># &#x6DFB;&#x52A0;&#x7AEF;&#x53E3;&#x4FE1;&#x606F;&#x5230;51-android.rules</span><br><span class="line">SUBSYSTEM==&quot;usb&quot;,ATTRS{idVendor}==&quot;18d1&quot;,ATTRS{idProduct}==&quot;4ee7&quot;,MODE=&quot;0666&quot;</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x91CC; <strong>18d1</strong> &#x548C; <strong>4ee7</strong> &#x5219;&#x5206;&#x522B;&#x662F;&#x4E0A;&#x4E00;&#x6B65;&#x4E2D;&#x67E5;&#x770B;&#x5230;&#x7684; android &#x8BBE;&#x5907;&#x7684;&#x4FE1;&#x606F;&#xFF0C;MODE &#x8868;&#x793A;&#x6743;&#x9650;&#xFF0C;&#x5B8C;&#x6210;&#x4E4B;&#x540E;&#x6267;&#x884C;&#x4E0B;&#x9762;&#x547D;&#x4EE4;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;sudo chmod a+rx /etc/udev/rules.d/51-android.rules</span><br><span class="line">sudo service udev restart</span><br></pre></td></tr></table></figure>

<p>&#x6700;&#x540E;&#x62D4;&#x6389; usb &#x91CD;&#x65B0;&#x8FDE;&#x63A5;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x8FD0;&#x884C;&#x4E0B;&#x9762;&#x547D;&#x4EE4;&#x91CD;&#x542F; adb &#x670D;&#x52A1;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;sudo adb kill-server</span><br><span class="line">sudo adb start-server</span><br><span class="line">sudo adb devices</span><br></pre></td></tr></table></figure>

<p>&#x5982;&#x679C;&#x4E0A;&#x8FF0;&#x6B65;&#x9AA4;&#x90FD;&#x64CD;&#x4F5C;&#x6B63;&#x786E;&#xFF0C;&#x8FD0;&#x884C; sudo adb devices &#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; adb &#x64CD;&#x4F5C;&#x8BBE;&#x5907;&#x4E86;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;List of devices attached </span><br><span class="line">2aca417d  device</span><br></pre></td></tr></table></figure>

<h3 id="&#x53C2;&#x8003;&#x6587;&#x732E;"><a href="#&#x53C2;&#x8003;&#x6587;&#x732E;" class="headerlink" title="&#x53C2;&#x8003;&#x6587;&#x732E;"></a>&#x53C2;&#x8003;&#x6587;&#x732E;</h3><ul>
<li><a href="/external_links/3e14473be52a05b67b35a3915c96311b.html" target="blank" rel="noopener">&#x8C37;&#x6B4C;adb&#x5B98;&#x65B9;&#x4E2D;&#x6587;&#x6587;&#x6863;</a></li>
<li><a href="/external_links/c222a30b878702a228e3a2426c79fad9.html" target="blank" rel="noopener">adb&#x5E38;&#x7528;&#x547D;&#x4EE4;&#x6574;&#x7406;</a></li>
<li><a href="/external_links/30628f9488706807559c6a867cccf49d.html" target="blank" rel="noopener">awesome-adb</a></li>
<li><a href="/external_links/9a6d13c2773818306995d7d9ce342836.html" target="blank" rel="noopener">ADB-&#x5E38;&#x7528;&#x547D;&#x4EE4;</a></li>
<li><a href="/external_links/9dc17e6afda452a2fb2048ccf1fb2267.html" target="blank" rel="noopener">&#x9488;&#x5BF9;&#x4F4E;&#x7535;&#x8017;&#x6A21;&#x5F0F;&#x548C;&#x5E94;&#x7528;&#x5F85;&#x673A;&#x6A21;&#x5F0F;&#x8FDB;&#x884C;&#x4F18;&#x5316;</a></li>
</ul>
<h2 id="&#x7ED3;&#x8BED;"><a href="#&#x7ED3;&#x8BED;" class="headerlink" title="&#x7ED3;&#x8BED;"></a>&#x7ED3;&#x8BED;</h2><p>&#x81F4;&#x529B;&#x4E8E;&#x5206;&#x4EAB;&#x4E00;&#x7CFB;&#x5217; Android &#x7CFB;&#x7EDF;&#x6E90;&#x7801;&#x3001;&#x9006;&#x5411;&#x5206;&#x6790;&#x3001;&#x7B97;&#x6CD5;&#x76F8;&#x5173;&#x7684;&#x6587;&#x7AE0;&#xFF0C;&#x6BCF;&#x7BC7;&#x6587;&#x7AE0;&#x90FD;&#x4F1A;&#x53CD;&#x590D;&#x63A8;&#x6572;&#xFF0C;&#x7ED3;&#x5408;&#x65B0;&#x7684;&#x6280;&#x672F;&#xFF0C;&#x5E26;&#x6765;&#x4E00;&#x4E9B;&#x65B0;&#x7684;&#x601D;&#x8003;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x540C;&#x6211;&#x4E00;&#x6837;&#x559C;&#x6B22; coding&#xFF0C;&#x4E00;&#x8D77;&#x6765;&#x5B66;&#x4E60;&#xFF0C;&#x671F;&#x5F85;&#x4E0E;&#x4F60;&#x4E00;&#x8D77;&#x6210;&#x957F;</p>
<h3 id="&#x6587;&#x7AE0;&#x5217;&#x8868;"><a href="#&#x6587;&#x7AE0;&#x5217;&#x8868;" class="headerlink" title="&#x6587;&#x7AE0;&#x5217;&#x8868;"></a>&#x6587;&#x7AE0;&#x5217;&#x8868;</h3><h4 id="Android-10-&#x6E90;&#x7801;&#x7CFB;&#x5217;"><a href="#Android-10-&#x6E90;&#x7801;&#x7CFB;&#x5217;" class="headerlink" title="Android 10 &#x6E90;&#x7801;&#x7CFB;&#x5217;"></a>Android 10 &#x6E90;&#x7801;&#x7CFB;&#x5217;</h4><ul>
<li><a href="https://dev.newban.cn/6844904063155322887">0xA01 Android 10 &#x6E90;&#x7801;&#x5206;&#x6790;&#xFF1A;Apk &#x662F;&#x5982;&#x4F55;&#x751F;&#x6210;&#x7684;</a></li>
<li><a href="https://dev.newban.cn/6844904078015725576">0xA02 Android 10 &#x6E90;&#x7801;&#x5206;&#x6790;&#xFF1A;Apk &#x7684;&#x5B89;&#x88C5;&#x6D41;&#x7A0B;</a></li>
<li><a href="https://dev.newban.cn/6844904089696862221">0xA03 Android 10 &#x6E90;&#x7801;&#x5206;&#x6790;&#xFF1A;Apk &#x52A0;&#x8F7D;&#x6D41;&#x7A0B;&#x4E4B;&#x8D44;&#x6E90;&#x52A0;&#x8F7D;</a></li>
<li><a href="https://dev.newban.cn/6844904105433907207">0xA04 Android 10 &#x6E90;&#x7801;&#x5206;&#x6790;&#xFF1A;Apk &#x52A0;&#x8F7D;&#x6D41;&#x7A0B;&#x4E4B;&#x8D44;&#x6E90;&#x52A0;&#x8F7D;&#xFF08;&#x4E8C;&#xFF09;</a></li>
<li><a href="https://dev.newban.cn/6844904122467123214">0xA05 Android 10 &#x6E90;&#x7801;&#x5206;&#x6790;&#xFF1A;Dialog &#x52A0;&#x8F7D;&#x7ED8;&#x5236;&#x6D41;&#x7A0B;&#x4EE5;&#x53CA;&#x5728; Kotlin&#x3001;DataBinding &#x4E2D;&#x7684;&#x4F7F;&#x7528;</a></li>
</ul>
<h4 id="&#x5DE5;&#x5177;&#x7CFB;&#x5217;"><a href="#&#x5DE5;&#x5177;&#x7CFB;&#x5217;" class="headerlink" title="&#x5DE5;&#x5177;&#x7CFB;&#x5217;"></a>&#x5DE5;&#x5177;&#x7CFB;&#x5217;</h4><ul>
<li><a href="https://dev.newban.cn/6844904020511981581">&#x4E3A;&#x6570;&#x4E0D;&#x591A;&#x7684;&#x4EBA;&#x77E5;&#x9053;&#x7684; AndroidStudio &#x5FEB;&#x6377;&#x952E;(&#x4E00;)</a></li>
<li><a href="https://dev.newban.cn/6844904023082926087">&#x4E3A;&#x6570;&#x4E0D;&#x591A;&#x7684;&#x4EBA;&#x77E5;&#x9053;&#x7684; AndroidStudio &#x5FEB;&#x6377;&#x952E;(&#x4E8C;)</a></li>
<li><a href="https://dev.newban.cn/6844903918112079885">&#x5173;&#x4E8E; adb &#x547D;&#x4EE4;&#x4F60;&#x6240;&#x9700;&#x8981;&#x77E5;&#x9053;&#x7684;</a></li>
<li><a href="https://dev.newban.cn/6844903874361311239">&#x5982;&#x4F55;&#x9AD8;&#x6548;&#x83B7;&#x53D6;&#x89C6;&#x9891;&#x622A;&#x56FE;</a></li>
<li><a href="https://dev.newban.cn/6844903553119748109">10&#x5206;&#x949F;&#x5165;&#x95E8; Shell &#x811A;&#x672C;&#x7F16;&#x7A0B;</a></li>
<li><a href="https://dev.newban.cn/6844904131803480071">&#x5982;&#x4F55;&#x5728;&#x9879;&#x76EE;&#x4E2D;&#x5C01;&#x88C5; Kotlin + Android Databinding</a></li>
</ul>
<h4 id="&#x9006;&#x5411;&#x7CFB;&#x5217;"><a href="#&#x9006;&#x5411;&#x7CFB;&#x5217;" class="headerlink" title="&#x9006;&#x5411;&#x7CFB;&#x5217;"></a>&#x9006;&#x5411;&#x7CFB;&#x5217;</h4><ul>
<li><a href="https://dev.newban.cn/6844903798972891144">&#x57FA;&#x4E8E; Smali &#x6587;&#x4EF6; Android Studio &#x52A8;&#x6001;&#x8C03;&#x8BD5; APP</a></li>
<li><a href="https://dev.newban.cn/6844903773890936839">&#x89E3;&#x51B3;&#x5728; Android Studio 3.2 &#x627E;&#x4E0D;&#x5230; Android Device Monitor &#x5DE5;&#x5177;</a></li>
</ul>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/ccdfb0466b827a6c9794b031de2edac6c549564eb64b76627382a4c553a85a43" alt></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/0cd16e80bbcb02f1a30e2083b579388cc72a56a8f0d8ab47d84312b2186175e5" alt></p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/2aea0db0e0a457b0d5395377d4ae076c.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn../../6844903917424214029.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../6844903917424214029.html" itemprop="url">DataBinding，再学不会你砍我</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-16T16:07:16+08:00">
                2019-08-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>&#x9996;&#x5148;&#xFF0C;&#x8FD9;&#x4E0D;&#x662F;&#x4E00;&#x7BC7;&#x5173;&#x4E8E;DataBinding&#x4F7F;&#x7528;&#x4ECB;&#x7ECD;&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x4E0D;&#x662F;&#x4E00;&#x7BC7;&#x6E90;&#x7801;&#x5206;&#x6790;&#xFF0C;&#x4E0D;&#x6D89;&#x53CA;&#x6700;&#x5E95;&#x5C42;&#x7684;&#x5B9E;&#x73B0;&#x903B;&#x8F91;&#x3002;&#x66F4;&#x591A;&#x7684;&#x662F;&#x5B9E;&#x9645;&#x5F00;&#x53D1;&#x8FC7;&#x7A0B;&#x4E2D;&#x9762;&#x5BF9;&#x7684;&#x95EE;&#x9898;&#x53CA;&#x5176;&#x6D89;&#x53CA;&#x7684;&#x539F;&#x7406;&#xFF0C;&#x900F;&#x8FC7;&#x5B83;&#x4EEC;&#x53EF;&#x4EE5;&#x66F4;&#x5FEB;&#x7684;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x6392;&#x67E5;&#x95EE;&#x9898;&#xFF0C;&#x63D0;&#x5347;&#x5F00;&#x53D1;&#x6548;&#x7387;&#x3002;</p>
</blockquote>
<p>&#x5F00;&#x59CB;&#x4E4B;&#x524D;&#x54B1;&#x4EEC;&#x5148;&#x8003;&#x8651;&#x4E0B;&#x9762;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x89C9;&#x5F97;&#x6709;&#x4E9B;&#x4E86;&#x89E3;&#x4F46;&#x53C8;&#x4F3C;&#x662F;&#x800C;&#x975E;&#xFF0C;&#x90A3;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x80FD;&#x8BA9;&#x4F60;&#x5BF9;databinding&#x6709;&#x4E00;&#x4E2A;&#x5168;&#x9762;&#x7684;&#x8BA4;&#x8BC6;(&#x871C;&#x6C41;&#x81EA;&#x4FE1;)&#xFF1B;&#x5982;&#x679C;&#x4F60;&#x89C9;&#x5F97;&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#x90FD;&#x592A;&#x7B80;&#x5355;&#x4E86;&#xFF0C;&#x90A3;&#x4F60;&#x662F;&#x4E0D;&#x662F;&#x2026;&#x4E5F;&#x5E94;&#x8BE5;&#x590D;&#x4E60;&#x4E00;&#x4E0B;(&#x5F3A;&#x884C;&#x633D;&#x7559;)&#x3002;</p>
<ol>
<li><code>android:text=@{user.name}</code>&#x8FD9;&#x79CD;&#x5E38;&#x89C1;&#x7684;binding&#x65B9;&#x5F0F;&#x5F53;user&#x5BF9;&#x8C61;&#x4E3A;&#x7A7A;&#x65F6;&#xFF0C;&#x4F1A;&#x5F15;&#x8D77;&#x7A7A;&#x6307;&#x9488;&#x95EE;&#x9898;&#x5417;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#xFF1F;</li>
<li>View&#x7684;&#x5168;&#x90E8;&#x5C5E;&#x6027;&#x90FD;&#x652F;&#x6301;binding&#x5417;&#xFF1F;&#x6BD4;&#x5982;padding&#xFF1F;margin&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#xFF1F;</li>
<li>&#x53CC;&#x5411;&#x7ED1;&#x5B9A;&#x662F;&#x5982;&#x4F55;&#x5904;&#x7406;&#x65E0;&#x9650;&#x5FAA;&#x73AF;&#x8C03;&#x7528;&#x7684;&#xFF1F;</li>
</ol>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/6c28edfd6ff0947eac96b0e12b2613e9919a82d710c4149e138a21a377fff21b" alt="&#x7075;&#x9B42;&#x62F7;&#x95EE;.jpeg"></p>
<h3 id="&#x914D;&#x7F6E;"><a href="#&#x914D;&#x7F6E;" class="headerlink" title="&#x914D;&#x7F6E;"></a>&#x914D;&#x7F6E;</h3><p>Android Gradle &#x63D2;&#x4EF6;(&#x7248;&#x672C;&gt;=3.1.0-alpha06)&#x652F;&#x6301;&#x81EA;&#x52A8;&#x751F;&#x6210;binding&#x7C7B;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;android {</span><br><span class="line">    ...</span><br><span class="line">    dataBinding {</span><br><span class="line">        enabled = true</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><a href="/external_links/2f4b8e93ac557c977b029a60ece27656.html" target="blank" rel="noopener">&#x5B98;&#x65B9;&#x6587;&#x6863;</a>&#x6233;&#x8FD9;&#x91CC;&#xFF0C;&#x6587;&#x5185;&#x793A;&#x4F8B;&#x6765;&#x81EA;<a href="/external_links/c9229167c78c7301c8e97ee08fde37ae.html" target="blank" rel="noopener">&#x5B98;&#x65B9;sample</a>&#xFF0C;&#x66F4;&#x591A;&#x5185;&#x5BB9;&#x53C2;&#x8003;<a href="/external_links/dde2d175f15e9edbcb43b47154f114b9.html" target="blank" rel="noopener">&#x5B98;&#x65B9;&#x535A;&#x5BA2;</a>&#x3002;</p>
<h3 id="&#x57FA;&#x672C;&#x4F7F;&#x7528;"><a href="#&#x57FA;&#x672C;&#x4F7F;&#x7528;" class="headerlink" title="&#x57FA;&#x672C;&#x4F7F;&#x7528;"></a>&#x57FA;&#x672C;&#x4F7F;&#x7528;</h3><p>&#x4E3A;&#x5C5E;&#x6027;&#x8D4B;&#x503C;&#x4F7F;&#x7528;&#x8868;&#x8FBE;&#x5F0F;<code>@{}</code>&#xFF0C;&#x5185;&#x90E8;&#x53EF;&#x4F7F;&#x7528;java&#x4EE3;&#x7801;&#xFF0C;&#x4F46;&#x5E76;&#x4E0D;&#x5B8C;&#x5168;&#x662F;java&#x4EE3;&#x7801;&#x3002;<br>&#x6765;&#x770B;&#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;ImageView</span><br><span class="line">    android:id=&quot;@+id/imageView&quot;</span><br><span class="line">    android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">    android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">    android:tint=&quot;@{user.likes &amp;gt; 9 ? @color/star : @android:color/black}&quot;</span><br><span class="line">    app:srcCompat=&quot;@{user.likes &amp;lt; 4 ? R.drawable.ic_person_black_96dp : R.drawable.ic_whatshot_black_96dp }&quot; /&gt;</span><br></pre></td></tr></table></figure>

<p>&#x5176;&#x4E2D;user&#x5BF9;&#x8C61;&#x7C7B;&#x578B;&#x4E3A;&#x5B9E;&#x4F53;&#x7C7B;TestProfile&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public class TestProfile {</span><br><span class="line">    private String name;</span><br><span class="line">    private String lastName;</span><br><span class="line">    private int likes;</span><br><span class="line"></span><br><span class="line">    public TestProfile(String name, String lastName, int likes) {</span><br><span class="line">        this.name = name;</span><br><span class="line">        this.lastName = lastName;</span><br><span class="line">        this.likes = likes;</span><br><span class="line">    }</span><br><span class="line">    //&#x7701;&#x7565;getter/setter...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5728;databinding&#x8868;&#x8FBE;&#x5F0F;&#x4E2D;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x5173;&#x4E8E;user.likes&#x7684;&#x4E09;&#x76EE;&#x8FD0;&#x7B97;&#xFF0C;&#x4F46;TestProfile&#x4E2D;likes&#x5C5E;&#x6027;&#x88AB;private&#x4FEE;&#x9970;&#xFF0C;&#x90A3;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x4F1A;&#x7F16;&#x8BD1;&#x62A5;&#x9519;&#x5462;&#xFF1F;&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;databinding&#x7F16;&#x8BD1;&#x5668;&#x4E3A;&#x6211;&#x4EEC;&#x505A;&#x4E00;&#x6B21;&#x6620;&#x5C04;&#xFF0C;&#x5B83;&#x4F1A;&#x5728;user&#x5BF9;&#x8C61;&#x7684;&#x7C7B;&#x4E2D;&#x4F9D;&#x6B21;&#x5BFB;&#x627E;xxx&#x5C5E;&#x6027;&#x7684;getXxx()&#x65B9;&#x6CD5;&#x548C;xxx()&#x65B9;&#x6CD5;&#xFF0C;&#x5982;&#x679C;&#x4E8C;&#x8005;&#x90FD;&#x6CA1;&#x6709;&#x627E;&#x5230;&#x624D;&#x4F1A;&#x62A5;&#x51FA;&#x7F16;&#x8BD1;&#x95EE;&#x9898;&#x3002;</p>
<p>&#x53E6;&#x5916;&#xFF0C;databinding&#x8868;&#x8FBE;&#x5F0F;&#x8FD8;&#x652F;&#x6301;&#xFF0C;&#x76F4;&#x63A5;&#x8BBF;&#x95EE;ObservableInt&#x7B49;&#x7528;&#x4E8E;<a href="#%E5%8D%95%E5%90%91%E7%BB%91%E5%AE%9A">&#x5355;&#x5411;&#x7ED1;&#x5B9A;</a>&#x7684;Obserable&#x5BF9;&#x8C61;&#x7684;&#x5177;&#x4F53;&#x503C;&#xFF0C;&#x4E3E;&#x4E2A;&#x6817;&#x5B50;&#xFF0C;&#x6211;&#x4EEC;&#x628A;TestProfile&#x7A0D;&#x5FAE;&#x6539;&#x52A8;&#x4E00;&#x4E0B;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;public class TestProfile {</span><br><span class="line">    private String name;</span><br><span class="line">    private String lastName;</span><br><span class="line">    //&#x6539;&#x4E3A;&#x652F;&#x6301;&#x5355;&#x5411;&#x7ED1;&#x5B9A;&#x7684;ObservableInt</span><br><span class="line">    private ObservableInt likes;</span><br><span class="line"></span><br><span class="line">    public TestProfile(String name, String lastName, ObservableInt likes) {</span><br><span class="line">        this.name = name;</span><br><span class="line">        this.lastName = lastName;</span><br><span class="line">        this.likes = likes;</span><br><span class="line">    }</span><br><span class="line">    //&#x7701;&#x7565;getter/setter...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x6837;&#x6539;&#x5B8C;&#x540E;&#xFF0C;binding&#x8868;&#x8FBE;&#x5F0F;&#x4E0D;&#x7528;&#x505A;&#x4EFB;&#x4F55;&#x4FEE;&#x6539;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x7F16;&#x8BD1;&#x5668;&#x5E2E;&#x6211;&#x4EEC;&#x505A;&#x4E86;&#x8F6C;&#x6362;&#xFF0C;&#x5373;<code>user.likes == user.getLikes().get()</code>&#x3002;</p>
<h4 id="&#x9700;&#x8981;&#x9A8C;&#x7A7A;&#x5417;&#xFF1F;"><a href="#&#x9700;&#x8981;&#x9A8C;&#x7A7A;&#x5417;&#xFF1F;" class="headerlink" title="&#x9700;&#x8981;&#x9A8C;&#x7A7A;&#x5417;&#xFF1F;"></a>&#x9700;&#x8981;&#x9A8C;&#x7A7A;&#x5417;&#xFF1F;</h4><p>&#x5230;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x56DE;&#x5934;&#x770B;&#x770B;&#x6587;&#x7AE0;&#x5F00;&#x5934;&#x63D0;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x95EE;&#x9898;:<code>android:text=@{user.name}</code>&#x8FD9;&#x79CD;&#x5E38;&#x89C1;&#x7684;binding&#x65B9;&#x5F0F;&#x5F53;user&#x5BF9;&#x8C61;&#x4E3A;&#x7A7A;&#x65F6;&#xFF0C;&#x4F1A;&#x5F15;&#x8D77;&#x7A7A;&#x6307;&#x9488;&#x95EE;&#x9898;&#x5417;&#xFF1F;&#x5728;&#x6211;&#x4EEC;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#x5047;&#x8BBE;&#x4F20;&#x5165;&#x7684;user&#x5BF9;&#x8C61;&#x4E3A;&#x7A7A;&#x4F1A;&#x600E;&#x6837;&#x5462;&#xFF1F;</p>
<p>&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;DataBinding&#x7F16;&#x8BD1;&#x5668;&#x65E9;&#x5C31;&#x60F3;&#x5230;&#x4E86;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x5BF9;&#x57FA;&#x672C;&#x7684;&#x9A8C;&#x7A7A;&#x95EE;&#x9898;&#x505A;&#x5904;&#x7406;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x60F3;&#x8C61;xml&#x5E03;&#x5C40;&#x4E2D;&#x4FBF;&#x4F1A;&#x904D;&#x5E03;&#x5404;&#x79CD;&#x9A8C;&#x7A7A;&#x8BED;&#x53E5;&#xFF0C;&#x4E00;&#x6B21;&#x9A8C;&#x7A7A;&#x4F60;&#x8FD8;&#x80FD;&#x63A5;&#x53D7;&#xFF0C;&#x7C7B;&#x4F3C;&#x8FD9;&#x6837;&#x7684;&#x9A8C;&#x7A7A;a.b().c()&#x4F60;&#x5C06;&#x5982;&#x4F55;&#x5904;&#x7406;&#x5462;&#xFF1F;&#x6240;&#x4EE5;DataBinding&#x6846;&#x67B6;&#x5728;&#x4F7F;&#x7528;variable&#x4E4B;&#x524D;&#x4F1A;&#x5BF9;&#x5176;&#x503C;&#x8FDB;&#x884C;&#x9A8C;&#x7A7A;&#x64CD;&#x4F5C;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x7EA7;&#x8054;&#x8C03;&#x7528;&#x4F1A;&#x4F9D;&#x6B21;&#x9A8C;&#x7A7A;&#x540E;&#x518D;&#x4F7F;&#x7528;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/3f41d1724f714ce36d7af2349faea1da833e7fef734dacdba3ae2705f86fdd61" alt="goon.gif"></p>
<p>&#x7ED3;&#x5408;&#x4E0A;&#x9762;&#x7ED1;&#x5B9A;likes&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x6211;&#x4EEC;&#x770B;&#x4E00;&#x4E0B;DataBinding&#x7F16;&#x8BD1;&#x5668;&#x5230;&#x5E95;&#x662F;&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x9A8C;&#x7A7A;&#x64CD;&#x4F5C;&#x7684;&#x3002;&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x8865;&#x5145;&#x4E00;&#x4E0B;&#x77E5;&#x8BC6;&#xFF0C;&#x63A7;&#x4EF6;&#x771F;&#x6B63;&#x548C;&#x6570;&#x636E;&#x5B8C;&#x6210;&#x7ED1;&#x5B9A;&#x53D1;&#x751F;&#x5728;bindingImpl&#x7C7B;(&#x8FD9;&#x4E2A;&#x7C7B;&#x4E5F;&#x662F;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;)&#x7684;executeBindings&#x65B9;&#x6CD5;&#x4E2D;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;# ObservableFieldProfileBindingImpl</span><br><span class="line">protected void executeBindings() {</span><br><span class="line">    ...</span><br><span class="line">    //TestProfile&#x4E2D;&#x7684;ObservableInt&#x5BF9;&#x8C61;</span><br><span class="line">    androidx.databinding.ObservableInt userLikes = null;</span><br><span class="line">    //mUser&#x4E3A;&#x5B9E;&#x9645;binding&#x7684;&#x5BF9;&#x8C61;</span><br><span class="line">    com.example.android.databinding.basicsample.data.TestProfile user = mUser;</span><br><span class="line">    //ObservableInt&#x5C5E;&#x6027;&#x503C;</span><br><span class="line">    int userLikesGet = 0;</span><br><span class="line"></span><br><span class="line">    if ((dirtyFlags &amp; 0x7L) != 0) {</span><br><span class="line"></span><br><span class="line">		//&#x7B2C;&#x4E00;&#x6B65;&#x9A8C;&#x7A7A; user&#x9A8C;&#x7A7A;</span><br><span class="line">        if (user != null) {</span><br><span class="line">            // read user.likes</span><br><span class="line">            userLikes = user.getLikes();</span><br><span class="line">        }</span><br><span class="line">        updateRegistration(0, userLikes);</span><br><span class="line"></span><br><span class="line">        //&#x7B2C;&#x4E8C;&#x6B65;&#x9A8C;&#x7A7A; ObservableInt&#x9A8C;&#x7A7A;</span><br><span class="line">        if (userLikes != null) {</span><br><span class="line">            // read user.likes.get()</span><br><span class="line">            userLikesGet = userLikes.get();</span><br><span class="line">        }</span><br><span class="line">        ...</span><br><span class="line">    }    </span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h4 id="bind&#x662F;&#x5982;&#x4F55;&#x5B8C;&#x6210;&#x7684;&#xFF1F;"><a href="#bind&#x662F;&#x5982;&#x4F55;&#x5B8C;&#x6210;&#x7684;&#xFF1F;" class="headerlink" title="bind&#x662F;&#x5982;&#x4F55;&#x5B8C;&#x6210;&#x7684;&#xFF1F;"></a>bind&#x662F;&#x5982;&#x4F55;&#x5B8C;&#x6210;&#x7684;&#xFF1F;</h4><p>&#x5728;&#x56DE;&#x7B54;&#x7B2C;&#x4E8C;&#x4E2A;&#x95EE;&#x9898;&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x5148;&#x8003;&#x8651;&#x4E00;&#x4E0B;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF1A;&#x65E5;&#x5E38;&#x5DE5;&#x4F5C;&#x4E2D;&#x7ECF;&#x5E38;&#x9700;&#x8981;&#x5F00;&#x53D1;&#x81EA;&#x5B9A;&#x4E49;View&#xFF0C;&#x90A3;&#x5BF9;&#x4E8E;&#x81EA;&#x5B9A;&#x4E49;View&#x7684;&#x81EA;&#x5B9A;&#x4E49;&#x5C5E;&#x6027;&#x5982;&#x4F55;&#x624D;&#x80FD;&#x652F;&#x6301;DataBinding&#x5462;&#xFF1F;</p>
<p>&#x6765;&#x770B;&#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;class MyCustomView : View {</span><br><span class="line">    var mDrawable: Drawable? = null</span><br><span class="line"></span><br><span class="line">    constructor(context: Context?, attrs: AttributeSet?) : super(context, attrs) {</span><br><span class="line">        val typedArray = context!!.theme.obtainStyledAttributes(attrs,</span><br><span class="line">                R.styleable.MyCustomView, 0, 0)</span><br><span class="line">        mDrawable = typedArray.getDrawable(R.styleable.MyCustomView_img)</span><br><span class="line">        typedArray.recycle()</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    override fun onDraw(canvas: Canvas?) {</span><br><span class="line">        mDrawable?.run {</span><br><span class="line">            setBounds(0, 0, this.intrinsicWidth, this.intrinsicHeight)</span><br><span class="line">            draw(canvas!!)</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>MyCustomView&#x662F;&#x4E00;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;view&#xFF0C;&#x5176;&#x5185;&#x90E8;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x5C5E;&#x6027;img&#xFF0C;&#x7C7B;&#x578B;&#x4E3A;Drawable&#xFF0C;&#x7528;&#x4E8E;&#x7ED8;&#x5236;&#x5728;&#x753B;&#x5E03;&#x4E0A;&#x3002;</p>
<p>&#x4F7F;&#x7528;&#x7684;test_custom_view.xml&#x5E03;&#x5C40;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;layout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;&gt;</span><br><span class="line">    &lt;data&gt;</span><br><span class="line">        &lt;variable</span><br><span class="line">            name=&quot;myDrawable&quot;</span><br><span class="line">            type=&quot;android.graphics.drawable.Drawable&quot; /&gt;</span><br><span class="line">    &lt;/data&gt;</span><br><span class="line">    &lt;com.example.android.databinding.basicsample.ui.MyCustomView</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;match_parent&quot;</span><br><span class="line">        app:img=&quot;@{myDrawable}&quot; /&gt;</span><br><span class="line">&lt;/layout&gt;</span><br></pre></td></tr></table></figure>

<p>activity&#x4E2D;&#x7684;&#x7ED1;&#x5B9A;&#x4EE3;&#x7801;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;val binding: TestCustomViewBinding = DataBindingUtil.setContentView(this, R.layout.test_custom_view)</span><br><span class="line">binding.myDrawable = resources.getDrawable(R.mipmap.ic_launcher)</span><br></pre></td></tr></table></figure>

<p>&#x6B64;&#x65F6;&#x5982;&#x679C;&#x8FD0;&#x884C;&#x5C31;&#x4F1A;&#x62A5;&#x9519;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;****/ data binding error ****msg:Cannot find the setter for attribute &apos;app:img&apos; with parameter type android.graphics.drawable.Drawable on com.example.android.databinding.basicsample.ui.MyCustomView.</span><br><span class="line">file:/android-databinding/BasicSample/app/src/main/res/layout/test_custom_view.xml loc:14:19 - 14:28 ****\ data binding error ****</span><br></pre></td></tr></table></figure>

<p>&#x901A;&#x8FC7;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x80FD;&#x63A8;&#x65AD;&#x51FA;&#x7ED1;&#x5B9A;&#x662F;&#x901A;&#x8FC7;app:img&#x5C5E;&#x6027;&#x7684;setter&#x65B9;&#x6CD5;&#x5B8C;&#x6210;&#x7684;&#xFF0C;&#x4E8B;&#x5B9E;&#x4E0A;&#x8FD9;&#x4E2A;setter&#x65B9;&#x6CD5;&#x5339;&#x914D;&#x539F;&#x5219;&#x548C;&#x4E0A;&#x8FF0;&#x7ED1;&#x5B9A;&#x5B9E;&#x4F53;&#x7684;setter&#x65B9;&#x6CD5;&#x662F;&#x4E00;&#x81F4;&#x7684;&#xFF0C;&#x5373;img&#x5BF9;&#x5E94;&#x7684;setter&#x65B9;&#x6CD5;&#xFF0C;&#x5305;&#x62EC;img()&#x548C;setImg()&#x65B9;&#x6CD5;&#xFF0C;&#x82E5;&#x5728;&#x81EA;&#x5B9A;&#x4E49;view&#x4E2D;&#x6CA1;&#x6709;&#x627E;&#x5230;&#x6B64;setter&#x65B9;&#x6CD5;&#x5C31;&#x4F1A;&#x62A5;&#x9519;&#x3002;<br>&#x6211;&#x4EEC;&#x4E3A;MyCustomView&#x6DFB;&#x52A0;setImg&#x89E3;&#x51B3;&#x4E86;&#x95EE;&#x9898;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;class MyCustomView : View {</span><br><span class="line">    ...</span><br><span class="line">    fun setImg(d: Drawable) {</span><br><span class="line">        mDrawable = d</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4F46;&#x5F80;&#x5F80;&#x5B9E;&#x9645;&#x60C5;&#x51B5;&#x662F;&#x8FD9;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;view&#x4E0D;&#x662F;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x5199;&#x7684;&#xFF0C;&#x4E14;&#x6E90;&#x7801;&#x5185;&#x6CA1;&#x6709;&#x63A7;&#x4EF6;&#x5C5E;&#x6027;&#x5BF9;&#x5E94;&#x7684;setter&#x65B9;&#x6CD5;&#xFF0C;&#x6211;&#x4EEC;&#x53C8;&#x65E0;&#x6CD5;&#x76F4;&#x63A5;&#x4FEE;&#x6539;&#x5B83;&#x7684;&#x6E90;&#x7801;&#xFF0C;&#x6B64;&#x65F6;&#x8BE5;&#x5982;&#x4F55;&#x5904;&#x7406;&#x5462;&#xFF1F;</p>
<h4 id="BindAdapter&#x6CE8;&#x89E3;"><a href="#BindAdapter&#x6CE8;&#x89E3;" class="headerlink" title="@BindAdapter&#x6CE8;&#x89E3;"></a>@BindAdapter&#x6CE8;&#x89E3;</h4><p>@BindAdapter&#x6CE8;&#x89E3;&#x53EF;&#x4EE5;&#x5E2E;&#x6211;&#x4EEC;&#x5B8C;&#x6210;&#x8FD9;&#x9879;&#x5DE5;&#x4F5C;&#xFF0C;&#x5B83;&#x4F4D;&#x4E8E;databinding-common&#x5E93;&#x4E2D;&#xFF0C;&#x8FD9;&#x4E2A;&#x5E93;&#x5B9A;&#x4E49;&#x4E86;databinding&#x652F;&#x6301;&#x7684;&#x5168;&#x90E8;&#x6CE8;&#x89E3;&#x3002;&#x6B64;&#x65F6;&#x6211;&#x4EEC;&#x5047;&#x8BBE;<code>MyCustomView</code>&#x5185;img&#x7684;set&#x65B9;&#x6CD5;&#x7B7E;&#x540D;&#x4E3A;<code>setMyImg</code>&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x5728;&#x4EFB;&#x610F;&#x7684;&#x7C7B;&#x4E2D;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x58F0;&#x660E;&#x6B64;&#x6CE8;&#x89E3;&#x7684;&#x9759;&#x6001;&#x65B9;&#x6CD5;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;# BindingAdapters.kt</span><br><span class="line">...</span><br><span class="line">@BindingAdapter(&quot;img&quot;)</span><br><span class="line">@JvmStatic</span><br><span class="line">fun setImg(view: MyCustomView, drawable: Drawable) {</span><br><span class="line">    view.setMyImg(drawable)</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x6B64;&#x9759;&#x6001;&#x65B9;&#x6CD5;&#x540D;&#x53EF;&#x968F;&#x4FBF;&#x8D77;&#xFF0C;&#x6CE8;&#x89E3;&#x4E2D;img&#x5C5E;&#x6027;&#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x4E3A;&#x53EF;&#x9009;&#xFF0C;&#x4E0D;&#x5199;&#x5219;xml&#x4E2D;&#x58F0;&#x660E;&#x7684;&#x4EFB;&#x610F;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x901A;&#x914D;&#x3002;&#x91CD;&#x8981;&#x7684;&#x662F;&#x53C2;&#x6570;&#x7B7E;&#x540D;&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x9700;&#x4E3A;&#x7ED1;&#x5B9A;&#x63A7;&#x4EF6;&#x7684;&#x540D;&#x79F0;&#xFF0C;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#x5219;&#x662F;&#x7ED1;&#x5B9A;img&#x5C5E;&#x6027;&#x5BF9;&#x5E94;&#x7684;&#x7C7B;&#x578B;&#xFF0C;&#x53EA;&#x6709;&#x4E8C;&#x8005;&#x4E0E;xml&#x4E2D;&#x7684;&#x7ED1;&#x5B9A;&#x58F0;&#x660E;&#x4E00;&#x81F4;&#x65B9;&#x53EF;&#x751F;&#x6548;&#x3002;&#x5982;&#x679C;&#x60F3;&#x83B7;&#x5F97;&#x7ED1;&#x5B9A;&#x524D;&#x7684;&#x503C;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x58F0;&#x660E;&#x51FD;&#x6570;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;@BindingAdapter(&quot;img&quot;)</span><br><span class="line">@JvmStatic</span><br><span class="line">//old&#x4E3A;&#x7ED1;&#x5B9A;&#x53D1;&#x751F;&#x524D;img&#x7684;&#x5C5E;&#x6027;&#x503C;</span><br><span class="line">fun yyy(view: MyCustomView, old: Drawable?, drawable: Drawable) {</span><br><span class="line">    view.setMyImg(drawable)</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x591A;&#x4E2A;&#x5C5E;&#x6027;&#x652F;&#x6301;&#x540C;&#x65F6;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#x5B8C;&#x6210;&#x7ED1;&#x5B9A;&#xFF0C;&#x5199;&#x6CD5;&#x8FD9;&#x9171;&#x7D2B;&#x7684;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;@BindingAdapter(value = [&quot;property1&quot;, &quot;property2&quot;], requireAll = false)</span><br></pre></td></tr></table></figure>

<p>requireAll&#x8868;&#x793A;&#x662F;&#x5426;value&#x6570;&#x7EC4;&#x4E2D;&#x58F0;&#x660E;&#x7684;&#x6240;&#x6709;&#x5C5E;&#x6027;&#x90FD;&#x5B8C;&#x6210;&#x7ED1;&#x5B9A;&#x624D;&#x6267;&#x884C;&#x6B64;&#x9759;&#x6001;&#x65B9;&#x6CD5;&#xFF0C;&#x9ED8;&#x8BA4;true&#xFF0C;&#x6B64;&#x7EC6;&#x8282;&#x95EE;&#x9898;&#x8FD9;&#x91CC;&#x4E0D;&#x505A;&#x5C55;&#x5F00;&#x3002;</p>
<h4 id="BindingMethod&#x6CE8;&#x89E3;"><a href="#BindingMethod&#x6CE8;&#x89E3;" class="headerlink" title="@BindingMethod&#x6CE8;&#x89E3;"></a>@BindingMethod&#x6CE8;&#x89E3;</h4><p>&#x6CE8;&#x610F;&#x5230;&#x6211;&#x4EEC;&#x5728;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#x7ED1;&#x5B9A;&#x5B9E;&#x73B0;&#x4E5F;&#x4EC5;&#x4EC5;&#x53EA;&#x662F;&#x8C03;&#x7528;&#x4E86;&#x4E00;&#x4E0B;<code>view.setMyImg(drawable)</code>&#x65B9;&#x6CD5;&#x3002;&#x50CF;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528;&#x4E00;&#x4E2A;&#x66F4;&#x7B80;&#x6D01;&#x7684;&#x5F62;&#x5F0F;&#x5B9E;&#x73B0;&#xFF0C;@BindingMethod&#x6CE8;&#x89E3;&#xFF0C;&#x5B83;&#x672C;&#x8D28;&#x4E0A;&#x7528;&#x4E8E;&#x63CF;&#x8FF0;&#x4E00;&#x79CD;&#x6620;&#x5C04;&#x5173;&#x7CFB;&#x3002;&#x5728;&#x6211;&#x4EEC;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#x5C31;&#x662F;&#x5C06;img&#x5C5E;&#x6027;&#x6620;&#x5C04;&#x5230;setMyImg&#x65B9;&#x6CD5;&#x5373;&#x53EF;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;@BindingMethods(BindingMethod(type = MyCustomView::class, attribute = &quot;img&quot;, method = &quot;setMyImg&quot;))</span><br><span class="line">class MyCustomView : View {</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x5E76;&#x4E0D;&#x80FD;&#x4FEE;&#x6539;MyCustomView&#x6E90;&#x7801;&#xFF0C;&#x53EF;&#x5728;&#x521B;&#x5EFA;&#x4EFB;&#x610F;&#x7C7B;&#x5E76;&#x4E3A;&#x5176;&#x58F0;&#x660E;BindingMethods&#x6CE8;&#x89E3;&#x5B8C;&#x6210;&#x7ED1;&#x5B9A;&#x3002;</p>
<p>&#x8BB2;&#x5230;&#x8FD9;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x89E3;&#x7B54;&#x5F00;&#x7BC7;&#x7684;&#x7B2C;&#x4E8C;&#x4E2A;&#x95EE;&#x9898;&#xFF1A;View&#x7684;&#x5168;&#x90E8;&#x5C5E;&#x6027;&#x90FD;&#x652F;&#x6301;binding&#x5417;&#xFF1F;&#x6BD4;&#x5982;padding&#xFF1F;margin&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#xFF1F;</p>
<p>&#x6709;&#x4E86;&#x4E0A;&#x9762;&#x7684;&#x5206;&#x6790;&#xFF0C;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x7684;&#x56DE;&#x7B54;&#x53EF;&#x4EE5;&#x8F6C;&#x6362;&#x6210;&#x4E0B;&#x9762;&#x4E09;&#x4E2A;&#x5B50;&#x95EE;&#x9898;&#xFF1A;</p>
<ol>
<li>View&#x6E90;&#x7801;&#x4E2D;&#x662F;&#x5426;&#x6709;&#x7B7E;&#x540D;&#x7B26;&#x5408;&#x8981;&#x6C42;&#x7684;setPadding&#x3001;setMargin&#x65B9;&#x6CD5;&#x3002;</li>
<li>&#x5728;databinding&#x6846;&#x67B6;&#x5185;&#x662F;&#x5426;&#x6709;&#x58F0;&#x660E;@BindAdapter(&#x201C;android:padding&#x201D;)&#x6CE8;&#x89E3;&#x4E14;&#x7B7E;&#x540D;&#x7B26;&#x5408;&#x8981;&#x6C42;&#x7684;&#x9759;&#x6001;&#x65B9;&#x6CD5;&#x3002;</li>
<li>&#x5728;databinding&#x6846;&#x67B6;&#x5185;&#x662F;&#x5426;&#x6709;&#x58F0;&#x660E;@BindingMethod&#x6CE8;&#x89E3;&#x4E14;&#x8BE5;&#x6CE8;&#x89E3;&#x5728;View&#x6E90;&#x7801;&#x4E2D;&#x6709;&#x6620;&#x5C04;&#x5173;&#x7CFB;&#x5B9E;&#x73B0;setPadding/setMargin&#x3002;</li>
</ol>
<p>&#x67E5;&#x770B;View&#x6E90;&#x7801;&#x4F60;&#x4F1A;&#x53D1;&#x73B0;&#x5176;&#x4E2D;&#x6CA1;&#x6709;setMargin&#x65B9;&#x6CD5;&#xFF0C;&#x6709;setPadding&#x65B9;&#x6CD5;&#x4F46;&#x662F;&#x591A;&#x53C2;&#x7684;<code>setPadding(int left, int top, int right, int bottom)</code>&#x4E0D;&#x7B26;&#x5408;&#x65B9;&#x6CD5;&#x7B7E;&#x540D;&#x8981;&#x6C42;&#xFF0C;&#x6240;&#x4EE5;1&#x4E8C;&#x8005;&#x90FD;&#x4E0D;&#x6EE1;&#x8DB3;&#x3002;</p>
<p>&#x5728;databinding-adapters&#x5E93;&#x4E2D;&#x5B9A;&#x4E49;&#x4E86;&#x5E38;&#x7528;&#x7EC4;&#x4EF6;&#x7684;&#x6269;&#x5C55;&#x7ED1;&#x5B9A;&#x5173;&#x7CFB;&#xFF0C;&#x6BD4;&#x5982;View&#x5BF9;&#x5E94;&#x5176;ViewBindingAdapter&#xFF0C;TextView&#x5BF9;&#x5E94;&#x5176;TextViewBindingAdapter&#x7B49;&#x7B49;&#x3002;</p>
<p>&#x5176;&#x4E2D;ViewBindingAdapter&#x5B8C;&#x6210;&#x4E86;padding&#x5C5E;&#x6027;&#x7684;&#x7ED1;&#x5B9A;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;@BindingMethods({</span><br><span class="line">        @BindingMethod(type = View.class, attribute = &quot;android:backgroundTint&quot;, method = &quot;setBackgroundTintList&quot;),</span><br><span class="line">        @BindingMethod(type = View.class, attribute = &quot;android:nextFocusLeft&quot;, method = &quot;setNextFocusLeftId&quot;),</span><br><span class="line">        ...</span><br><span class="line">        @BindingMethod(type = View.class, attribute = &quot;android:onLongClick&quot;, method = &quot;setOnLongClickListener&quot;),</span><br><span class="line">        @BindingMethod(type = View.class, attribute = &quot;android:onTouch&quot;, method = &quot;setOnTouchListener&quot;),</span><br><span class="line">})</span><br><span class="line">public class ViewBindingAdapter {</span><br><span class="line">    @BindingAdapter({&quot;android:padding&quot;})</span><br><span class="line">    public static void setPadding(View view, float paddingFloat) {</span><br><span class="line">        final int padding = pixelsToDimensionPixelSize(paddingFloat);</span><br><span class="line">        view.setPadding(padding, padding, padding, padding);</span><br><span class="line">    }</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4F46;&#x5E76;&#x6CA1;&#x6709;margin&#x5C5E;&#x6027;&#xFF0C;&#x4E14;&#x5728;&#x5176;@BindingMethod&#x58F0;&#x660E;&#x4E2D;&#x4E5F;&#x6CA1;&#x6709;&#x6620;&#x5C04;&#x5B9E;&#x73B0;&#xFF0C;&#x56E0;&#x6B64;&#x5F97;&#x5230;&#x7ED3;&#x8BBA;&#xFF1A;android:padding&#x5C5E;&#x6027;&#x652F;&#x6301;&#x7ED1;&#x5B9A;&#xFF0C;&#x800C;margin&#x4E0D;&#x652F;&#x6301;&#x3002;&#x4EE5;layout_marginBottom&#x4E3A;&#x4F8B;&#xFF0C;&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x5B9E;&#x73B0;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;@BindingAdapter(&quot;android:layout_marginBottom&quot;)</span><br><span class="line">public static void setBottomMargin(View view, float bottomMargin) {</span><br><span class="line">    MarginLayoutParams layoutParams = (MarginLayoutParams) view.getLayoutParams();</span><br><span class="line">    layoutParams.setMargins(layoutParams.leftMargin, layoutParams.topMargin,</span><br><span class="line">        layoutParams.rightMargin, Math.round(bottomMargin));</span><br><span class="line">    view.setLayoutParams(layoutParams);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/b0dd5725caf73d511709dc998ec749d04e3bbf05dda401466d78ea6ac093b37f" alt="640.jpeg"></p>
<h3 id="&#x5355;&#x5411;&#x7ED1;&#x5B9A;"><a href="#&#x5355;&#x5411;&#x7ED1;&#x5B9A;" class="headerlink" title="&#x5355;&#x5411;&#x7ED1;&#x5B9A;"></a>&#x5355;&#x5411;&#x7ED1;&#x5B9A;</h3><p>&#x4E0A;&#x9762;&#x90E8;&#x5206;&#x89E3;&#x91CA;&#x4E86;&#x63A7;&#x4EF6;&#x548C;&#x6570;&#x636E;&#x4E4B;&#x95F4;&#x662F;&#x5982;&#x4F55;&#x8FDB;&#x884C;&#x7ED1;&#x5B9A;&#x7684;&#xFF0C;&#x4F46;&#x5B9E;&#x9645;&#x573A;&#x666F;&#x4E2D;&#x6570;&#x636E;&#x6301;&#x7EED;&#x53D1;&#x751F;&#x7740;&#x53D8;&#x5316;&#xFF0C;&#x90A3;&#x4E48;&#x600E;&#x4E48;&#x5C06;&#x6570;&#x636E;&#x7684;&#x53D8;&#x5316;&#x53CA;&#x65F6;&#x53CD;&#x6620;&#x5230;UI&#x4E0A;&#x5462;&#xFF1F;&#x8FD9;&#x5C31;&#x662F;&#x672C;&#x8282;&#x8981;&#x8BB2;&#x7684;&#x5355;&#x5411;&#x7ED1;&#x5B9A;&#x3002;</p>
<p>&#x5355;&#x5411;&#x7ED1;&#x5B9A;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#x5B9E;&#x73B0;</p>
<ul>
<li>&#x4F7F;&#x7528;ObservableXxx&#x7C7B;&#x578B;&#x66FF;&#x4EE3;&#x539F;&#x6709;&#x7C7B;&#x578B;</li>
<li>&#x5B9E;&#x4F53;&#x7EE7;&#x627F;BaseObservable&#x7C7B;&#xFF0C;&#x5E76;&#x7528;@Bindable&#x6CE8;&#x89E3;&#x58F0;&#x660E;&#x5C5E;&#x6027;&#x7684;getter&#x65B9;&#x6CD5;&#x3002;</li>
</ul>
<h4 id="ObservableXxx"><a href="#ObservableXxx" class="headerlink" title="ObservableXxx"></a>ObservableXxx</h4><p>&#x8FD9;&#x91CC;&#x7684;xxx&#x5305;&#x542B;&#x57FA;&#x672C;&#x7C7B;&#x578B;&#x548C;&#x96C6;&#x5408;&#x7C7B;&#x578B;&#xFF0C;&#x6BD4;&#x5982;int&#x5BF9;&#x5E94;ObservableInt&#xFF0C;boolean&#x5BF9;&#x5E94;ObservableBoolean&#x7B49;&#xFF0C;ArrayList&#x5BF9;&#x5E94;ObservableArrayList&#xFF0C;&#x5F15;&#x7528;&#x7C7B;&#x578B;&#x7EDF;&#x4E00;&#x4F7F;&#x7528;ObservableField&#xFF0C;&#x6BD4;&#x5982;String&#x5BF9;&#x5E94;ObservableField&#x3002;&#x4E3A;&#x65B9;&#x4FBF;&#x8D77;&#x89C1;&#xFF0C;&#x4E0B;&#x6587;&#x5C06;ObservableXxx&#x7EDF;&#x4E00;&#x7528;ObservableField&#x8868;&#x793A;&#x3002;</p>
<p>&#x4E3E;&#x4E2A;&#x6817;&#x5B50;&#xFF0C;&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x7684;&#x5B9E;&#x4F53;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;data class ObservableFieldProfile(</span><br><span class="line">        var likes: Int</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>observable_field_profile.xml&#x5E03;&#x5C40;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;layout</span><br><span class="line"></span><br><span class="line">    &lt;data&gt;</span><br><span class="line">        &lt;variable</span><br><span class="line">            name=&quot;user&quot;</span><br><span class="line">            type=&quot;com.example.android.databinding.basicsample.data.ObservableFieldProfile&quot; /&gt;</span><br><span class="line">    &lt;/data&gt;</span><br><span class="line"></span><br><span class="line">    &lt;ImageView</span><br><span class="line">        android:id=&quot;@+id/imageView&quot;</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        ...</span><br><span class="line">        android:src=&quot;@{user.likes &amp;lt; 4 ? R.drawable.ic1 : R.drawable.ic2 }&quot;/&gt;</span><br><span class="line">&lt;/layout&gt;</span><br></pre></td></tr></table></figure>

<p>&#x7ED1;&#x5B9A;&#x4EE3;&#x7801;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;val binding: ObservableFieldProfileBinding =</span><br><span class="line">        DataBindingUtil.setContentView(this, R.layout.observable_field_profile)</span><br><span class="line">val user = ObservableFieldProfile(0)</span><br><span class="line">binding.user = user</span><br></pre></td></tr></table></figure>

<p>&#x5F53;&#x6211;&#x4EEC;&#x6539;&#x53D8;&#x5176;&#x4E2D;&#x7684;&#x5C5E;&#x6027;&#x65F6;<code>user.likes=10</code>&#xFF0C;&#x5E76;&#x4E0D;&#x4F1A;&#x89E6;&#x53D1;UI&#x7684;&#x5237;&#x65B0;&#xFF0C;&#x8981;&#x60F3;&#x8FBE;&#x5230;&#x540C;&#x6B65;&#x5237;&#x65B0;&#x7684;&#x6548;&#x679C;&#xFF0C;&#x53EA;&#x9700;&#x5C06;likes&#x7684;&#x7C7B;&#x578B;&#x7531;Int&#x6362;&#x4E3A;ObservableInt&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;data class ObservableFieldProfile(</span><br><span class="line">        val likes: ObservableInt</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>&#x540C;&#x65F6;&#x6570;&#x636E;&#x53D8;&#x66F4;&#x4F7F;&#x7528;<code>user.likes.set(10)</code>&#x3002;</p>
<h4 id="BaseObservable-Bindable&#x6CE8;&#x89E3;"><a href="#BaseObservable-Bindable&#x6CE8;&#x89E3;" class="headerlink" title="BaseObservable + @Bindable&#x6CE8;&#x89E3;"></a>BaseObservable + @Bindable&#x6CE8;&#x89E3;</h4><p>&#x4E0A;&#x9762;&#x7684;&#x65B9;&#x5F0F;&#x6709;&#x4E00;&#x4E2A;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x5C31;&#x662F;&#x5B9E;&#x4F53;&#x7684;&#x7C7B;&#x578B;&#x53D1;&#x751F;&#x4E86;&#x53D8;&#x5316;&#xFF0C;&#x90A3;&#x5728;&#x771F;&#x5B9E;&#x9879;&#x76EE;&#x4E2D;&#x4F46;&#x51E1;&#x4F7F;&#x7528;&#x5230;&#x6B64;&#x5C5E;&#x6027;&#x7684;&#x5730;&#x65B9;&#x90FD;&#x8981;&#x8FDB;&#x884C;&#x4FEE;&#x6539;&#x3002;<br>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6362;&#x4E00;&#x79CD;&#x5199;&#x6CD5;&#x5B9E;&#x73B0;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;class ObservableFieldProfile(var name: String, val lastName: String) : BaseObservable() {</span><br><span class="line"></span><br><span class="line">    constructor(name: String, lastName: String, likes: Int) : this(name, lastName) {</span><br><span class="line">        this.likes = likes</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @get:Bindable</span><br><span class="line">    var likes: Int = 0</span><br><span class="line">        set(value) {</span><br><span class="line">            field = value</span><br><span class="line">            notifyPropertyChanged(BR.likes)</span><br><span class="line">        }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<ol>
<li>&#x8BA9;&#x5B9E;&#x4F53;&#x7C7B;&#x7EE7;&#x627F;BaseObservable&#x7C7B;&#x3002;</li>
<li>&#x4E3A;&#x5C5E;&#x6027;&#x7684;set&#x65B9;&#x6CD5;&#x6DFB;&#x52A0;Bindable&#x6CE8;&#x89E3;&#x3002;</li>
<li>&#x81EA;&#x5B9A;&#x4E49;set&#x65B9;&#x6CD5;&#x8C03;&#x7528;notifyPropertyChanged&#x89E6;&#x53D1;&#x5237;&#x65B0;&#x3002;</li>
</ol>
<p>notifyPropertyChanged&#x65B9;&#x6CD5;&#x7EE7;&#x627F;&#x81EA;BaseObservable&#xFF0C;&#x5176;&#x53C2;&#x6570;&#x4E3A;<code>BR.likes</code>&#x3002;&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x89E3;&#x91CA;&#x4E00;&#x4E0B;BR&#x7C7B;&#xFF0C;&#x5B83;&#x662F;databinding&#x7F16;&#x8BD1;&#x5668;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;&#xFF0C;&#x5176;&#x5185;&#x90E8;&#x4E3A;&#x6240;&#x6709;&#x53EF;&#x53D8;&#x5BF9;&#x8C61;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E2A;int&#x7C7B;&#x578B;&#x7684;&#x552F;&#x4E00;&#x6807;&#x8BC6;&#xFF0C;&#x8FD9;&#x91CC;&#x7684;&#x53EF;&#x53D8;&#x5BF9;&#x8C61;&#x5305;&#x542B;&#xFF1A;</p>
<ul>
<li>&#x5728;xml&#x5E03;&#x5C40;&#x4E2D;&#x58F0;&#x660E;&#x7684;variable&#x53D8;&#x91CF;</li>
<li>&#x4F7F;&#x7528;@Bindable&#x6CE8;&#x89E3;&#x6807;&#x8BC6;&#x7684;&#x65B9;&#x6CD5;&#x5BF9;&#x5E94;&#x7684;&#x5C5E;&#x6027;&#x540D;(&#x5C5E;&#x6027;&#x4E0D;&#x5FC5;&#x771F;&#x7684;&#x5B58;&#x5728;&#xFF0C;&#x542B;&#x6709;getter&#x5373;&#x53EF;)&#x3002;</li>
</ul>
<p>&#x8FD9;&#x4E5F;&#x5C31;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x4E00;&#x5B9A;&#x8981;&#x58F0;&#x660E;Bindable&#x6CE8;&#x89E3;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x80FD;&#x6307;&#x5B9A;&#x5237;&#x65B0;&#x7279;&#x5B9A;&#x7684;&#x5C5E;&#x6027;&#x4E86;&#xFF1B;&#x540C;&#x65F6;&#x7531;&#x4E8E;getter&#x5185;&#x53EF;&#x4EE5;&#x5199;&#x4EFB;&#x610F;&#x4EE3;&#x7801;&#xFF0C;&#x56E0;&#x6B64;&#x53EF;&#x64CD;&#x4F5C;&#x6027;&#x66F4;&#x5F3A;&#x3002;</p>
<p>&#x76F8;&#x6BD4;&#x4E8E;ObservableField&#x800C;&#x8A00;&#x867D;&#x7136;&#x4E0D;&#x5FC5;&#x6539;&#x53D8;&#x5C5E;&#x6027;&#x7684;&#x7C7B;&#x578B;&#x4E86;&#xFF0C;&#x4F46;&#x5BF9;&#x5E94;&#x5B9E;&#x4F53;&#x7C7B;&#x6765;&#x8BF4;&#x9762;&#x4E34;&#x4E86;&#x66F4;&#x591A;&#x7684;&#x95EE;&#x9898;&#xFF1A;</p>
<ol>
<li>&#x4F7F;&#x7528;&#x4E86;&#x7EE7;&#x627F;&#x800C;&#x4E0D;&#x662F;&#x5B9E;&#x73B0;&#xFF0C;&#x5982;&#x679C;&#x5B9E;&#x4F53;&#x7C7B;&#x672C;&#x8EAB;&#x6709;&#x7EE7;&#x627F;&#x5173;&#x7CFB;&#x6B64;&#x65B9;&#x6848;&#x4E0D;&#x53EF;&#x884C;(&#x5982;&#x679C;&#x4E00;&#x5B9A;&#x8981;&#x8FD9;&#x4E48;&#x505A;&#x53EA;&#x80FD;&#x5B9E;&#x73B0;Observable&#x63A5;&#x53E3;&#xFF0C;&#x5E76;&#x628A;BaseObservable&#x7684;&#x5185;&#x90E8;&#x5B9E;&#x73B0;&#x62F7;&#x8D1D;&#x5230;&#x73B0;&#x6709;&#x5B9E;&#x4F53;&#x4E2D;)&#x3002;</li>
<li>&#x9700;&#x91CD;&#x5199;set&#x65B9;&#x6CD5;&#xFF0C;&#x4F46;&#x5728;Kotlin&#x4E2D;&#x5BF9;data&#x7C7B;&#x578B;&#x5185;&#x90E8;&#x7684;&#x5C5E;&#x6027;&#x4F7F;&#x7528;set&#x592A;&#x4E0D;&#x53CB;&#x597D;&#xFF0C;&#x770B;&#x770B;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;data&#x7C7B;&#x6539;&#x6210;&#x5565;&#x6837;&#x4E86;&#x2026;&#x3002;</li>
</ol>
<h4 id="&#x4E8C;&#x8005;&#x7684;&#x5173;&#x7CFB;"><a href="#&#x4E8C;&#x8005;&#x7684;&#x5173;&#x7CFB;" class="headerlink" title="&#x4E8C;&#x8005;&#x7684;&#x5173;&#x7CFB;"></a>&#x4E8C;&#x8005;&#x7684;&#x5173;&#x7CFB;</h4><p>ObservableField&#x662F;&#x57FA;&#x4E8E;BaseObservable&#x5B9E;&#x73B0;&#x7684;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/04ec55842297852bbc2b11beeba3112c104adb355aeb5b7b09549a5458d57e30" alt="databinding_uml.png"></p>
<p>&#x8BB2;&#x5230;&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x63D2;&#x64AD;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x6570;&#x636E;&#x9A71;&#x52A8;UI&#x53D8;&#x5316;&#x65F6;&#xFF0C;databinding&#x6846;&#x67B6;&#x600E;&#x4E48;&#x77E5;&#x9053;&#x8981;&#x66F4;&#x65B0;&#x54EA;&#x4E9B;UI&#x63A7;&#x4EF6;&#xFF0C;&#x6362;&#x8A00;&#x4E4B;&#xFF0C;&#x5982;&#x4F55;&#x5C06;&#x53EF;&#x53D8;&#x5316;&#x7684;&#x6570;&#x636E;&#x548C;UI&#x63A7;&#x4EF6;&#x8FDB;&#x884C;&#x5173;&#x8054;&#x7684;&#xFF1F;</p>
<h4 id="&#x7ED1;&#x5B9A;&#x539F;&#x7406;"><a href="#&#x7ED1;&#x5B9A;&#x539F;&#x7406;" class="headerlink" title="&#x7ED1;&#x5B9A;&#x539F;&#x7406;"></a>&#x7ED1;&#x5B9A;&#x539F;&#x7406;</h4><p>&#x4E4B;&#x6240;&#x4EE5;&#x8981;&#x63D0;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x662F;&#x56E0;&#x4E3A;&#x5F00;&#x53D1;&#x4E2D;&#x7ECF;&#x5E38;&#x9047;&#x5230;&#x7684;&#x8FD9;&#x6837;&#x7684;&#x573A;&#x666F;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x4E00;&#x4E2A;TextView&#x9700;&#x8981;&#x4E0E;&#x4E00;&#x4E2A;ObservableInt&#x7ED1;&#x5B9A;&#xFF0C;&#x4F46;&#x5728;&#x7ED1;&#x5B9A;&#x4E4B;&#x524D;&#x9700;&#x8981;&#x505A;&#x4E00;&#x7CFB;&#x5217;&#x5224;&#x65AD;&#x3001;&#x8F6C;&#x6362;&#x5DE5;&#x4F5C;&#xFF0C;&#x5982;&#x679C;&#x7EDF;&#x7EDF;&#x90FD;&#x5C06;&#x8FD9;&#x4E9B;&#x903B;&#x8F91;&#x5199;&#x5728;bind&#x8868;&#x8FBE;&#x5F0F;&#x4E2D;&#x53EF;&#x8BFB;&#x6027;&#x4F1A;&#x53D8;&#x5F97;&#x5F88;&#x5DEE;&#xFF0C;&#x6240;&#x4EE5;&#x901A;&#x5E38;&#x7684;&#x505A;&#x6CD5;&#x662F;&#x5C06;&#x5224;&#x65AD;&#x3001;&#x8F6C;&#x6362;&#x5C01;&#x88C5;&#x6210;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x5728;bind&#x8868;&#x8FBE;&#x5F0F;&#x4E2D;&#x76F4;&#x63A5;&#x8C03;&#x7528;&#x65B9;&#x6CD5;&#x5373;&#x53EF;&#x3002;&#x770B;&#x8D77;&#x6765;&#x5408;&#x7406;&#x7684;&#x65B9;&#x6848;&#x5728;&#x5B9E;&#x9645;&#x4F7F;&#x7528;&#x4E2D;&#x7A0D;&#x6709;&#x4E0D;&#x614E;&#x5C31;&#x4F1A;&#x51FA;bug&#x3002;</p>
<p>&#x770B;&#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;ViewModel&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;class ProfileLiveDataViewModel : ViewModel() {</span><br><span class="line">    val likes: MutableLiveData&lt;Int&gt; = MutableLiveData(0)</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5E03;&#x5C40;&#x6587;&#x4EF6;&#x662F;&#x9171;&#x7D2B;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;&lt;layout</span><br><span class="line">    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;</span><br><span class="line">    &lt;data&gt;</span><br><span class="line">        &lt;variable</span><br><span class="line">            name=&quot;viewmodel&quot;</span><br><span class="line">            type=&quot;com.example.android.databinding.basicsample.data.ProfileLiveDataViewModel&quot;/&gt;</span><br><span class="line">    &lt;/data&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:id=&quot;@+id/likes&quot;</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:text=&quot;@{Integer.toString(viewmodel.likes+1)}&quot;</span><br><span class="line">        .../&gt;</span><br></pre></td></tr></table></figure>

<p>&#x901A;&#x8FC7;bind&#x8868;&#x8FBE;&#x5F0F;&#x5185;&#x5BB9;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6211;&#x4EEC;&#x7684;&#x9700;&#x6C42;&#x662F;&#x5C06;likes&#x52A0;1&#x5728;&#x8F6C;&#x6210;&#x4E00;&#x4E2A;String&#x7C7B;&#x578B;&#x4ED8;&#x7ED9;text&#x5C5E;&#x6027;&#x3002;&#x770B;&#x5230;&#x8FD9;&#x91CC;&#x4F60;&#x53EF;&#x80FD;&#x60F3;&#x5BF9;&#x8FD9;&#x4E2A;&#x8868;&#x8FBE;&#x5F0F;&#x505A;&#x4E00;&#x4E0B;&#x4F18;&#x5316;&#x6539;&#x6210;&#x8FD9;&#x6837;<code>android:text=&quot;@{viewmodel.testConvert(viewmodel.likes)}&quot;</code>&#xFF0C;&#x5176;&#x4E2D;&#x5728;viewmodel&#x4E2D;&#x65B0;&#x589E;testConvert&#x65B9;&#x6CD5;&#x7EDF;&#x4E00;&#x5C01;&#x88C5;&#x8F6C;&#x6362;&#x52A8;&#x4F5C;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;# viewmodel</span><br><span class="line">fun testConvert(likes: Int): String {</span><br><span class="line">    return Integer.toString(likes + 1)</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5230;&#x8FD9;&#x5462;&#xFF0C;&#x4F60;&#x53D1;&#x73B0;&#x8868;&#x8FBE;&#x5F0F;&#x8FD8;&#x662F;&#x6CA1;&#x600E;&#x4E48;&#x7B80;&#x5316;&#xFF0C;&#x4F60;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x8FDB;&#x4E00;&#x6B65;&#x4F18;&#x5316;(&#x6316;&#x5751;)&#xFF0C;&#x6539;&#x6210;&#x8FD9;&#x6837;<code>android:text=&quot;@{viewmodel.testConvert2()}&quot;</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;# viewmodel</span><br><span class="line">fun testConvert2(): String {</span><br><span class="line">    return Integer.toString(likes.value?.plus(1) ?: 0)</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x770B;&#x4F3C;&#x7B80;&#x5355;&#x7684;&#x6539;&#x52A8;&#x5176;&#x5B9E;&#x5DF2;&#x7ECF;&#x5F15;&#x53D1;&#x4E86;&#x4E00;&#x4E2A;bug&#x2014;&#x2014;&#x2014;&#x2014;&#x6B64;&#x65F6;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x66F4;&#x65B0;likes&#x7684;&#x503C;&#xFF0C;&#x5C06;&#x4E0D;&#x4F1A;&#x540C;&#x6B65;&#x66F4;&#x65B0;&#x5230;&#x8FD9;&#x4E2A;view&#x4E0A;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/da1c2be01f4275108575229a7ec851219b7cc5fad1e4da11a4987705bc232656" alt="wtf.jpg"></p>
<p>&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x8FD9;&#x6837;&#x5462;&#xFF1F;&#x6211;&#x4EEC;&#x7B80;&#x5355;&#x89E3;&#x91CA;&#x4E00;&#x4E0B;&#xFF0C;&#x8FD9;&#x4E0E;bind&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x89E3;&#x6790;&#x6709;&#x5173;&#xFF0C;&#x89E3;&#x6790;&#x8FC7;&#x7A0B;&#x4E2D;&#x4F1A;&#x67E5;&#x627E;&#x8868;&#x8FBE;&#x5F0F;&#x4E2D;&#x662F;&#x5426;&#x6709;&#x53EF;&#x53D8;&#x7684;&#x90E8;&#x5206;&#xFF0C;&#x53EF;&#x53D8;&#x90E8;&#x5206;&#x5305;&#x542B;variable&#x3001;ObservableField&#x3001;&#x6807;&#x6709;@Bindable&#x6CE8;&#x89E3;&#x7684;getter&#x3001;LiveData&#x90E8;&#x5206;&#xFF0C;&#x91CD;&#x590D;&#x9879;&#x5C06;&#x5408;&#x5E76;&#xFF0C;&#x6700;&#x7EC8;&#x4F1A;&#x5728;&#x751F;&#x6210;&#x7684;ViewBindingImpl&#x7C7B;&#x4E2D;&#x6253;&#x5370;&#x6CE8;&#x91CA;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// dirty flag</span><br><span class="line">private  long mDirtyFlags = 0xffffffffffffffffL;</span><br><span class="line">/* flag mapping</span><br><span class="line">    flag 0 (0x1L): viewmodel.likes</span><br><span class="line">    flag 1 (0x2L): viewmodel.lastName</span><br><span class="line">    flag 2 (0x3L): viewmodel.popularity</span><br><span class="line">    flag 3 (0x4L): viewmodel.name</span><br><span class="line">    flag 4 (0x5L): viewmodel</span><br><span class="line">    flag 5 (0x6L): null</span><br><span class="line">flag mapping end*/</span><br><span class="line">//end</span><br></pre></td></tr></table></figure>

<p>mDirtyFlags&#x662F;&#x4E00;&#x4E2A;&#x5237;&#x65B0;&#x6807;&#x8BB0;&#xFF0C;&#x7528;&#x4E8E;&#x5224;&#x65AD;&#x6570;&#x636E;&#x7684;&#x53D8;&#x5316;&#x5BF9;&#x5E94;&#x5237;&#x65B0;&#x54EA;&#x4E9B;view&#xFF0C;flag mapping&#x662F;&#x6BCF;&#x4E2A;&#x5237;&#x65B0;&#x9879;&#x7684;&#x6620;&#x5C04;&#x6807;&#x8BB0;&#xFF0C;&#x6240;&#x6709;&#x53EF;&#x53D8;&#x5316;&#x90E8;&#x5206;&#x90FD;&#x5C06;&#x5728;&#x8FD9;&#x91CC;&#x5C55;&#x793A;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;<code>android:text=&quot;@{viewmodel.testConvert2()}&quot;</code>&#x4EC5;&#x6620;&#x5C04;&#x5230;variable&#x2013;viewmodel&#xFF0C;&#x5373;&#x53EA;&#x6709;&#x5F53;viewmodel&#x53D8;&#x5316;&#x65F6;&#x624D;&#x4F1A;&#x5237;&#x65B0;&#x6B64;view&#xFF0C;&#x8C03;&#x7528;&#x7684;&#x65B9;&#x6CD5;testConvert2&#x5185;&#x90E8;&#x903B;&#x8F91;&#x5C06;&#x5FFD;&#x7565;&#xFF0C;&#x800C;<code>android:text=&quot;@{viewmodel.testConvert(viewmodel.likes)}&quot;</code>&#x5C06;&#x4F1A;&#x6620;&#x5C04;&#x5230;viewmodel&#x548C;viewmodel.likes&#xFF0C;&#x53EA;&#x8981;&#x4E8C;&#x8005;&#x4E4B;&#x4E00;&#x6709;&#x53D8;&#x5316;&#x90FD;&#x4F1A;&#x5237;&#x65B0;&#x6B64;view&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/68b40e29da3549ab7fef65cd540722a59bbce6e3ca720bb7990353e781efea0b" alt="interesting.png"></p>
<h3 id="&#x53CC;&#x5411;&#x7ED1;&#x5B9A;"><a href="#&#x53CC;&#x5411;&#x7ED1;&#x5B9A;" class="headerlink" title="&#x53CC;&#x5411;&#x7ED1;&#x5B9A;"></a>&#x53CC;&#x5411;&#x7ED1;&#x5B9A;</h3><p>&#x5982;&#x679C;&#x8BF4;&#x5355;&#x5411;&#x7ED1;&#x5B9A;&#x662F;&#x6570;&#x636E;&#x9A71;&#x52A8;&#xFF0C;&#x90A3;&#x4E48;&#x53CC;&#x5411;&#x7ED1;&#x5B9A;&#x5C31;&#x662F;&#x6570;&#x636E;&#x9A71;&#x52A8;+&#x4E8B;&#x4EF6;&#x9A71;&#x52A8;&#xFF0C;&#x7528;<code>@={}</code>&#x8868;&#x8FBE;&#x5F0F;&#x6807;&#x8BC6;&#x53CC;&#x5411;&#x7ED1;&#x5B9A;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/8cf55a3231d8218bca5f963f729a76d1930fcba7bc91d0455caf63e4eeef2635" alt="&#x53CC;&#x5411;&#x7ED1;&#x5B9A;&#x56FE;.png"></p>
<p>&#x6240;&#x4EE5;&#x8981;&#x5B9E;&#x73B0;&#x53CC;&#x5411;&#x7ED1;&#x5B9A;&#x4E5F;&#x5C31;&#x662F;&#x5728;&#x5355;&#x5411;&#x7ED1;&#x5B9A;&#x7684;&#x57FA;&#x7840;&#x4E0A;&#x52A0;&#x4E0A;&#x4E8B;&#x4EF6;&#x9A71;&#x52A8;&#x903B;&#x8F91;&#x5373;&#x53EF;&#x3002;&#x4E8B;&#x4EF6;&#x9A71;&#x52A8;&#x6700;&#x7EC8;&#x8981;&#x8868;&#x73B0;&#x5728;&#x6570;&#x636E;&#x53D8;&#x5316;&#x4E0A;&#xFF0C;&#x56E0;&#x6B64;&#x53EF;&#x4EE5;&#x603B;&#x7ED3;&#x5B8C;&#x6210;&#x4E8B;&#x4EF6;&#x9A71;&#x52A8;&#x7684;&#x4E09;&#x4E2A;&#x6B65;&#x9AA4;&#x3002;</p>
<ol>
<li>&#x76D1;&#x542C;&#x4E8B;&#x4EF6;&#x53D8;&#x5316;&#x5E76;&#x629B;&#x7ED9;&#x6846;&#x67B6;</li>
<li>&#x83B7;&#x53D6;&#x63A7;&#x4EF6;&#x5F53;&#x524D;&#x5C5E;&#x6027;&#x503C;</li>
<li>&#x7528;&#x5F53;&#x524D;&#x5C5E;&#x6027;&#x503C;&#x66F4;&#x65B0;&#x6570;&#x636E;</li>
</ol>
<p>&#x5B98;&#x65B9;&#x5DF2;&#x7ECF;&#x5C06;&#x5E38;&#x7528;&#x63A7;&#x4EF6;&#x7684;&#x90E8;&#x5206;&#x5C5E;&#x6027;&#x5B9E;&#x73B0;&#x4E86;&#x53CC;&#x5411;&#x7ED1;&#x5B9A;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p3/raw/master/img/9c4504cf2baea6e0a7defea087211ccff9bcf87af542b34b8a676e306feb9acc" alt="&#x53CC;&#x5411;&#x7ED1;&#x5B9A;&#x5B98;&#x65B9;&#x5B9E;&#x73B0;.png"></p>
<p>&#x56E0;&#x4E3A;EditText&#x7EE7;&#x627F;TextView&#xFF0C;&#x6211;&#x4EEC;&#x62FF;&#x5E38;&#x7528;&#x7684;EditText&#x7684;text&#x5C5E;&#x6027;&#x7ED3;&#x5408;TextViewBindingAdapter&#x6E90;&#x7801;&#x6765;&#x8BF4;&#x660E;&#x53CD;&#x5411;&#x7ED1;&#x5B9A;&#x7684;&#x8FC7;&#x7A0B;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;# TextViewBindingAdapter</span><br><span class="line">&#x2460;  //event&#x53EF;&#x7F3A;&#x7701;</span><br><span class="line">@InverseBindingAdapter(attribute = &quot;android:text&quot;, event = &quot;android:textAttrChanged&quot;)</span><br><span class="line">public static String getTextString(TextView view) {</span><br><span class="line">    return view.getText().toString();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">&#x2461;</span><br><span class="line">@BindingAdapter(value = { ..., &quot;android:textAttrChanged&quot;}, requireAll = false)</span><br><span class="line">public static void setTextWatcher(TextView view, ...,</span><br><span class="line">        final InverseBindingListener textAttrChanged) {</span><br><span class="line">    final TextWatcher newValue;</span><br><span class="line">    ...</span><br><span class="line">    newValue = new TextWatcher() {</span><br><span class="line">        @Override</span><br><span class="line">        public void beforeTextChanged(CharSequence s, int start, int count, int after) {</span><br><span class="line">            ...</span><br><span class="line">        }</span><br><span class="line">        @Override</span><br><span class="line">        public void onTextChanged(CharSequence s, int start, int before, int count) {</span><br><span class="line">            ...</span><br><span class="line">            //&#x6536;&#x5230;&#x4E8B;&#x4EF6; &#x901A;&#x77E5;&#x6846;&#x67B6;&#x53D1;&#x751F;&#x53D8;&#x5316;</span><br><span class="line">            if (textAttrChanged != null) {</span><br><span class="line">                textAttrChanged.onChange();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        @Override</span><br><span class="line">        public void afterTextChanged(Editable s) {</span><br><span class="line">            ...</span><br><span class="line">        }</span><br><span class="line">    };</span><br><span class="line">    ...</span><br><span class="line">    if (newValue != null) {</span><br><span class="line">        view.addTextChangedListener(newValue);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x5BF9;&#x4E8E;EditText&#x6765;&#x8BF4;&#x53EF;&#x9A71;&#x52A8;&#x6570;&#x636E;&#x53D8;&#x5316;&#x7684;&#x4E8B;&#x4EF6;&#x663E;&#x7136;&#x5C31;&#x662F;TextChangedListener&#xFF0C;&#x6BCF;&#x5F53;&#x8F93;&#x5165;&#x5B57;&#x7B26;&#x53D8;&#x5316;&#x65F6;&#x4F1A;&#x56DE;&#x8C03;<code>onTextChanged</code>&#x65B9;&#x6CD5;&#xFF0C;dataBinding&#x6846;&#x67B6;&#x4F7F;&#x7528;&#x4E86;&#x4E00;&#x4E2A;InverseBindingListener&#x63A5;&#x53E3;&#x4EE5;&#x4F9B;&#x7528;&#x6237;&#x5C06;&#x4E8B;&#x4EF6;&#x901A;&#x77E5;&#x629B;&#x51FA;&#x3002;&#x4E0E;InverseBindingListener&#x63A5;&#x53E3;&#x5BF9;&#x5E94;&#x9700;&#x8981;&#x5411;&#x6846;&#x67B6;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x7ED1;&#x5B9A;&#x5C5E;&#x6027;textAttrChanged&#xFF0C;&#x9ED8;&#x8BA4;&#x5B83;&#x662F;&#x7531;&#x5C5E;&#x6027;&#x540D;+AttrChanged&#x540E;&#x7F00;&#x7EC4;&#x6210;(&#x4E0A;&#x9762;&#x2461;&#x5904;&#x4EE3;&#x7801;)&#x3002;InverseBindingListener&#x63A5;&#x53E3;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x4EE3;&#x7801;&#x7531;&#x6846;&#x67B6;&#x751F;&#x6210;&#xFF0C;&#x603B;&#x5F97;&#x6765;&#x8BF4;&#x5C31;&#x662F;&#x83B7;&#x53D6;&#x63A7;&#x4EF6;&#x5C5E;&#x6027;&#x7684;&#x5F53;&#x524D;&#x503C;&#xFF0C;&#x7136;&#x540E;&#x7528;&#x6B64;&#x503C;&#x66F4;&#x65B0;&#x6570;&#x636E;&#x3002;</p>
<p>&#x83B7;&#x53D6;&#x5F53;&#x524D;&#x503C;&#x7684;&#x65B9;&#x6CD5;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x544A;&#x8BC9;&#x6846;&#x67B6;&#xFF0C;&#x901A;&#x5E38;&#x65B9;&#x6848;&#xFF1A;</p>
<ul>
<li>&#x4F7F;&#x7528;@InverseBindingAdapter&#x6CE8;&#x89E3;&#x4E00;&#x4E2A;&#x9759;&#x6001;&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x63A7;&#x4EF6;&#x5C5E;&#x6027;&#x5F53;&#x524D;&#x503C;&#x6BD4;&#x5982;&#x4E0A;&#x9762;&#x2460;&#x5904;&#x4EE3;&#x7801;&#x3002;</li>
<li>&#x4F7F;&#x7528;@InverseBindingMethod&#x6CE8;&#x89E3;&#x4E00;&#x4E2A;&#x7C7B;&#xFF0C;&#x58F0;&#x660E;&#x53CD;&#x5411;&#x7ED1;&#x5B9A;&#x9488;&#x5BF9;&#x7684;&#x63A7;&#x4EF6;&#x3001;&#x5C5E;&#x6027;&#x3001;inverse&#x4E8B;&#x4EF6;&#x540D;(&#x53EF;&#x7F3A;&#x7701;)&#x3001;&#x63A7;&#x4EF6;&#x5185;&#x83B7;&#x53D6;&#x5C5E;&#x6027;&#x5F53;&#x524D;&#x503C;(&#x53EF;&#x7F3A;&#x7701;)&#x3002;&#x4F8B;&#x5982;&#xFF1A;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;@InverseBindingMethods({@InverseBindingMethod(</span><br><span class="line">     type = android.widget.TextView.class,</span><br><span class="line">     attribute = &quot;android:text&quot;,</span><br><span class="line">     event = &quot;android:textAttrChanged&quot;,</span><br><span class="line">     method = &quot;getText&quot;)})</span><br><span class="line"> public class MyTextViewBindingAdapters</span><br></pre></td></tr></table></figure>

<h4 id="&#x907F;&#x514D;&#x65E0;&#x9650;&#x5FAA;&#x73AF;"><a href="#&#x907F;&#x514D;&#x65E0;&#x9650;&#x5FAA;&#x73AF;" class="headerlink" title="&#x907F;&#x514D;&#x65E0;&#x9650;&#x5FAA;&#x73AF;"></a>&#x907F;&#x514D;&#x65E0;&#x9650;&#x5FAA;&#x73AF;</h4><p>&#x901A;&#x8FC7;&#x56FE;&#x4F8B;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#xFF0C;&#x5982;&#x679C;&#x4E8B;&#x4EF6;&#x9A71;&#x52A8;&#x53CD;&#x5411;&#x7ED1;&#x5B9A;&#x6210;&#x529F;&#x540E;&#xFF0C;&#x6570;&#x636E;&#x4F1A;&#x53D1;&#x751F;&#x53D8;&#x5316;&#xFF0C;&#x6309;&#x6B63;&#x5E38;&#x903B;&#x8F91;&#x6765;&#x8BB2;&#xFF0C;&#x5C06;&#x7EE7;&#x7EED;&#x89E6;&#x53D1;&#x5355;&#x5411;&#x7ED1;&#x5B9A;&#xFF0C;&#x5982;&#x6B64;&#x4E00;&#x6765;&#x5C06;&#x9677;&#x5165;&#x65E0;&#x9650;&#x5FAA;&#x73AF;&#x4E2D;&#x3002;</p>
<p>&#x4E3A;&#x4E2D;&#x65AD;&#x8FD9;&#x79CD;&#x5FAA;&#x73AF;&#xFF0C;&#x901A;&#x5E38;&#x7684;&#x505A;&#x6CD5;&#x662F;&#x5728;&#x66F4;&#x65B0;UI&#x524D;&#xFF0C;&#x6821;&#x9A8C;&#x65B0;&#x65E7;&#x6570;&#x636E;&#x662F;&#x5426;&#x76F8;&#x540C;&#xFF0C;&#x5982;&#x679C;&#x76F8;&#x540C;&#x5219;&#x4E0D;&#x8FDB;&#x884C;&#x5237;&#x65B0;&#x52A8;&#x4F5C;&#x3002;&#x6BD4;&#x5982;TextView&#xFF0C;&#x5176;&#x5185;&#x90E8;&#x7684;setText&#x65B9;&#x6CD5;&#x5E76;&#x4E0D;&#x4F1A;&#x68C0;&#x9A8C;&#x65B0;&#x65E7;&#x6570;&#x636E;&#x7684;&#x4E00;&#x81F4;&#x6027;&#x95EE;&#x9898;&#xFF0C;&#x6240;&#x4EE5;&#x5728;TextViewBindingAdapter&#x5185;&#x91CD;&#x65B0;&#x7ED1;&#x5B9A;&#x4E86;android:text&#x5C5E;&#x6027;&#xFF0C;&#x6DFB;&#x52A0;&#x6821;&#x9A8C;&#x903B;&#x8F91;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;@BindingAdapter(&quot;android:text&quot;)</span><br><span class="line">public static void setText(TextView view, CharSequence text) {</span><br><span class="line">    //&#x6821;&#x9A8C;</span><br><span class="line">    final CharSequence oldText = view.getText();</span><br><span class="line">    if (text == oldText || (text == null &amp;&amp; oldText.length() == 0)) {</span><br><span class="line">        return;</span><br><span class="line">    }</span><br><span class="line">    ...</span><br><span class="line">    view.setText(text);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="&#x5E38;&#x7528;&#x6280;&#x5DE7;"><a href="#&#x5E38;&#x7528;&#x6280;&#x5DE7;" class="headerlink" title="&#x5E38;&#x7528;&#x6280;&#x5DE7;"></a>&#x5E38;&#x7528;&#x6280;&#x5DE7;</h3><ol>
<li>&#x9ED8;&#x8BA4;&#x503C; &#x5F53;&#x7ED1;&#x5B9A;&#x6570;&#x636E;&#x8FD8;&#x672A;&#x8D4B;&#x503C;&#x65F6;&#x53EF;&#x6307;&#x5B9A;&#x9ED8;&#x8BA4;&#x503C;<code>android:text=&apos;@{user.firstName, default=&quot;Placeholder text&quot;}&apos;</code>&#x3002;</li>
<li>&#x9A8C;&#x7A7A;&#x7684;&#x4E09;&#x76EE;&#x8FD0;&#x7B97;&#x53EF;&#x6362;&#x4E3A;&#x201D;??&#x201D;&#x64CD;&#x4F5C;&#x7B26;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;<code>android:text=&quot;@{user.displayName ?? user.lastName}&quot;</code>&#x7B49;&#x4EF7;&#x4E8E;<code>android:text=&quot;@{user.displayName != null ? user.displayName : user.lastName}&quot;</code>&#x3002;</li>
<li>String placeholder&#x53EF;&#x4EE5;&#x8FD9;&#x4E48;&#x7528;&#xFF0C;<code>android:text=&quot;@{@string/nameFormat(firstName, lastName)}&quot;</code>&#x3002;</li>
<li>binding&#x8868;&#x8FBE;&#x5F0F;&#x8F6C;&#x4E49;&#x5B57;&#x7B26;<ul>
<li>&#x201C;&lt;&#x201D;&#x7B26;&#x53F7; &#x7528;<code>&amp;lt;</code>&#x4EE3;&#x66FF;</li>
<li>&#x201C;&amp;&#x201D;&#x7B26;&#x53F7; &#x7528;<code>&amp;amp;</code>&#x4EE3;&#x66FF;</li>
</ul>
</li>
</ol>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/2499c49e6982fbb0b88dd15bdaf3e9f0.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="../93/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="../../">1</a><span class="space">&hellip;</span><a class="page-number" href="../93/">93</a><span class="page-number current">94</span><a class="page-number" href="../95/">95</a><span class="space">&hellip;</span><a class="page-number" href="../99/">99</a><a class="extend next" rel="next" href="../95/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">开发者博客</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="https://dev.newban.cn/archives/">
              
                  <span class="site-state-item-count">990</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">399</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="../../atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">开发者博客</span>
  <div>
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
  </div>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




  <script type="text/javascript" async src="js/src/mermaid.min.js"></script>
  <script>
  if (window.mermaid) {
        var mermaid_config = {
            startOnLoad: true,
            theme: 'default',
            flowchart:{
                useMaxWidth: false,
                htmlLabels: true
            }                
        }
        mermaid.initialize(mermaid_config);
  }
  </script>
  

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="../../lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="../../lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="../../lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="../../lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="../../lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="../../lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="../../js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="../../js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="../../js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
