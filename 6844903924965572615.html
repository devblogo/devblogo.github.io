<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">
<meta name="referrer" content="never">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="性能优化,">





  <link rel="alternate" href="atom.xml" title="开发者博客 – IT技术 尽在开发者博客" type="application/atom+xml">






<meta name="description" content="&amp;#x4E00;&amp;#x3001;&amp;#x80CC;&amp;#x666F;&amp;#x660E;&amp;#x5929;&amp;#x662F;&amp;#x5468;&amp;#x4E8C;&amp;#xFF0C;&amp;#x6B63;&amp;#x597D;&amp;#x662F;&amp;#x6211;&amp;#x4EEC;&amp;#x56E2;&amp;#x961F;&amp;#x6BCF;&amp;#x5468;&amp;#x4E00;&amp;#x6B21;&amp;#x7684;&amp;#x6280;&amp;#x672F;&amp;#x5206;">
<meta name="keywords" content="性能优化">
<meta property="og:type" content="article">
<meta property="og:title" content="Android - 一种新奇的冷启动速度优化思路(Fragm">
<meta property="og:url" content="https://dev.newban.cn/6844903924965572615.html">
<meta property="og:site_name" content="开发者博客 – IT技术 尽在开发者博客">
<meta property="og:description" content="&amp;#x4E00;&amp;#x3001;&amp;#x80CC;&amp;#x666F;&amp;#x660E;&amp;#x5929;&amp;#x662F;&amp;#x5468;&amp;#x4E8C;&amp;#xFF0C;&amp;#x6B63;&amp;#x597D;&amp;#x662F;&amp;#x6211;&amp;#x4EEC;&amp;#x56E2;&amp;#x961F;&amp;#x6BCF;&amp;#x5468;&amp;#x4E00;&amp;#x6B21;&amp;#x7684;&amp;#x6280;&amp;#x672F;&amp;#x5206;">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/bcc07a6a07fa78da8aa8ec3325b283d74a48139a9407ced1ba0af334be174e85">
<meta property="og:image" content="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/6b6830401c6e32c6648167aecad7e92035bda771b0d969283c8adb59f2ba47d0">
<meta property="og:image" content="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/6fac3f5d5b2d9514b10f05227f73f4346028bdd0edeb1a360bd18a9214a16461">
<meta property="og:image" content="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/54dc5c401717a96ac26105371acc021ebf3a53adcc64e03c005f618884a82882">
<meta property="og:image" content="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/3a5d460119094182cda0858e8bab245704fa0278b52296a929ca8cfaddf5e137">
<meta property="og:image" content="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/905f443e925cc63f21af9e9cd48f947023bd31d929041aa34773936d347ad6c0">
<meta property="og:updated_time" content="2024-04-22T09:20:44.971Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android - 一种新奇的冷启动速度优化思路(Fragm">
<meta name="twitter:description" content="&amp;#x4E00;&amp;#x3001;&amp;#x80CC;&amp;#x666F;&amp;#x660E;&amp;#x5929;&amp;#x662F;&amp;#x5468;&amp;#x4E8C;&amp;#xFF0C;&amp;#x6B63;&amp;#x597D;&amp;#x662F;&amp;#x6211;&amp;#x4EEC;&amp;#x56E2;&amp;#x961F;&amp;#x6BCF;&amp;#x5468;&amp;#x4E00;&amp;#x6B21;&amp;#x7684;&amp;#x6280;&amp;#x672F;&amp;#x5206;">
<meta name="twitter:image" content="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/bcc07a6a07fa78da8aa8ec3325b283d74a48139a9407ced1ba0af334be174e85">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>
<!--谷歌广告验证代码-->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-2626449904708114",
          enable_page_level_ads: true
     });
</script>
<!--谷歌广告验证代码-->



  <link rel="canonical" href="https://dev.newban.cn/6844903924965572615.html">





  <title>Android - 一种新奇的冷启动速度优化思路(Fragm | 开发者博客 – IT技术 尽在开发者博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">开发者博客 – IT技术 尽在开发者博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">开发者博客 – 科技是第一生产力</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="http://dev.newban.cn/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="https://dev.newban.cn/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Android - 一种新奇的冷启动速度优化思路(Fragm</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-26T21:38:38+08:00">
                2019-08-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="&#x4E00;&#x3001;&#x80CC;&#x666F;"><a href="#&#x4E00;&#x3001;&#x80CC;&#x666F;" class="headerlink" title="&#x4E00;&#x3001;&#x80CC;&#x666F;"></a>&#x4E00;&#x3001;&#x80CC;&#x666F;</h3><p>&#x660E;&#x5929;&#x662F;&#x5468;&#x4E8C;&#xFF0C;&#x6B63;&#x597D;&#x662F;&#x6211;&#x4EEC;&#x56E2;&#x961F;&#x6BCF;&#x5468;&#x4E00;&#x6B21;&#x7684;&#x6280;&#x672F;&#x5206;&#x4EAB;&#xFF0C;&#x6211;&#x4F1A;&#x628A;&#x524D;&#x6BB5;&#x65F6;&#x95F4;&#x82B1;&#x4E86;&#x51E0;&#x5929;&#x5728;&#x5E72;&#x5176;&#x4ED6;&#x6D3B;&#x7684;&#x540C;&#x65F6;&#xFF0C;&#x6574;&#x7684;&#x4E00;&#x5957;&#x8BE1;&#x5F02;&#x7684;&#x51B7;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x4F18;&#x5316;&#x65B9;&#x6848;&#x5206;&#x4EAB;&#x4E00;&#x4E0B;&#x3002;</p>
<h3 id="&#x4E8C;&#x3001;&#x7279;&#x610F;&#x58F0;&#x660E;"><a href="#&#x4E8C;&#x3001;&#x7279;&#x610F;&#x58F0;&#x660E;" class="headerlink" title="&#x4E8C;&#x3001;&#x7279;&#x610F;&#x58F0;&#x660E;"></a>&#x4E8C;&#x3001;&#x7279;&#x610F;&#x58F0;&#x660E;</h3><p>&#x6211;&#x8FD9;&#x8FB9;&#x6587;&#x7AE0;&#x7684;&#x5185;&#x5BB9;&#x4E0D;&#x4F1A;&#x6D89;&#x53CA;&#x7F51;&#x4E0A;&#x53D8;&#x5730;&#x90FD;&#x662F;&#x7684;&#x5E38;&#x89C4;&#x7684;&#x4F18;&#x5316;&#x65B9;&#x6848;~ &#xFF0C;&#x540C;&#x65F6;&#xFF0C;&#x5E73;&#x65F6;&#x5DE5;&#x4F5C;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5DE5;&#x4F5C;&#x5185;&#x5BB9;&#x6742;&#x4E14;&#x591A;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x4E2A;&#x4F18;&#x5316;&#x65B9;&#x6848;&#x4E5F;&#x4E0D;&#x662F;&#x7279;&#x522B;&#x6210;&#x719F;&#xFF0C;&#x4EC5;&#x4F9B;&#x53C2;&#x8003;&#x5427;~</p>
<h3 id="&#x4E09;&#x3001;&#x6700;&#x5E38;&#x89C1;&#x7684;&#x4F18;&#x5316;&#x65B9;&#x6848;"><a href="#&#x4E09;&#x3001;&#x6700;&#x5E38;&#x89C1;&#x7684;&#x4F18;&#x5316;&#x65B9;&#x6848;" class="headerlink" title="&#x4E09;&#x3001;&#x6700;&#x5E38;&#x89C1;&#x7684;&#x4F18;&#x5316;&#x65B9;&#x6848;"></a>&#x4E09;&#x3001;&#x6700;&#x5E38;&#x89C1;&#x7684;&#x4F18;&#x5316;&#x65B9;&#x6848;</h3><ul>
<li>&#x6570;&#x636E;&#x61D2;&#x52A0;&#x8F7D;&#xFF0C;&#x6BD4;&#x5982;Fragment&#x7528;&#x6237;&#x4E0D;&#x53EF;&#x89C1;&#x65F6;&#x4E0D;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x7684;&#x83B7;&#x53D6;</li>
<li>&#x4F18;&#x5316;&#x5E03;&#x5C40;&#x5C42;&#x7EA7;&#xFF0C;&#x51CF;&#x5C11;&#x9996;&#x6B21;inflate layout&#x7684;&#x8017;&#x65F6;</li>
<li>&#x5C06;&#x7EDD;&#x5927;&#x90E8;&#x5206;sdk&#x7684;&#x521D;&#x59CB;&#x5316;&#x653E;&#x7EBF;&#x7A0B;&#x6C60;&#x4E2D;&#x8FD0;&#x884C;</li>
<li>&#x80FD;&#x7528;ViewStub&#x7684;&#x5C31;&#x7528;ViewStub&#xFF0C;&#x6309;&#x9700;&#x52A0;&#x8F7D;layout</li>
<li>&#x4E00;&#x5B9A;&#x8981;&#x5C3D;&#x91CF;&#x907F;&#x514D;&#x542F;&#x52A8;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x51FA;&#x73B0;&#x7684;&#x4E3B;&#x7EBF;&#x7A0B;&#x53BB;unpack&#x4E00;&#x4E9B;&#x5168;&#x5C40;&#x914D;&#x7F6E;&#x7684;&#x6570;&#x636E;</li>
<li>&#x4E0D;&#x4EC5;&#x4EC5;&#x662F;&#x4E09;&#x65B9;&#x5E93;&#x53EF;&#x4EE5;&#x653E;&#x5B50;&#x7EBF;&#x7A0B;&#x8FDB;&#x884C;&#xFF0C;&#x4E00;&#x4E9B;&#x65F6;&#x6548;&#x6027;&#x8981;&#x6C42;&#x6CA1;&#x90A3;&#x4E48;&#x9AD8;&#x7684;&#x903B;&#x8F91;&#x90FD;&#x53EF;&#x4EE5;&#x653E;&#x5B50;&#x7EBF;&#x7A0B;</li>
</ul>
<h3 id="&#x56DB;&#x3001;&#x9879;&#x76EE;&#x7ED3;&#x6784;"><a href="#&#x56DB;&#x3001;&#x9879;&#x76EE;&#x7ED3;&#x6784;" class="headerlink" title="&#x56DB;&#x3001;&#x9879;&#x76EE;&#x7ED3;&#x6784;"></a>&#x56DB;&#x3001;&#x9879;&#x76EE;&#x7ED3;&#x6784;</h3><p>&#x5728;&#x6211;&#x4EEC;&#x7684;Android&#x9879;&#x76EE;&#x4E2D;&#xFF0C;&#x5E94;&#x7528;&#x8FC7;&#x4E86;&#x95EA;&#x5C4F;&#x4E4B;&#x540E;&#x4F1A;&#x8FDB;&#x5165;&#x5230;&#x4E3B;&#x5C4F; - MainActivity&#xFF0C;&#x8FD9;&#x4E2A;&#x5730;&#x65B9;&#x6211;&#x5410;&#x69FD;&#x5F88;&#x591A;&#x6B21;&#x4E86;&#xFF0C;&#x5E7F;&#x544A;&#x95EA;&#x5C4F;&#x4F5C;&#x4E3A;launcher&#x771F;&#x7684;&#x4E0D;&#x662F;&#x7279;&#x522B;&#x9760;&#x8C31;&#xFF0C;&#x6700;&#x597D;&#x7684;&#x65B9;&#x5F0F;&#x5E94;&#x8BE5;&#x662F;&#x4ECE;MainActivity&#x91CC;&#x9762;&#x6765;&#x542F;&#x52A8;AdActivity&#xFF0C;&#x751A;&#x81F3;&#x662F;&#x4E0D;&#x7528;Activity&#xFF0C;&#x91C7;&#x7528;&#x4E00;&#x4E2A;&#x5168;&#x5C4F;&#x7684;AdView&#x90FD;&#x53EF;&#x4EE5;&#x3002;</p>
<p>&#x5148;&#x7B80;&#x5355;&#x4ECB;&#x7ECD;&#x4E00;&#x4E0B;&#x6211;&#x4EEC;&#x9879;&#x76EE;&#x4E2D;MainActivity&#x6D89;&#x53CA;&#x5230;&#x7684;&#x7ED3;&#x6784;&#xFF1A;</p>
<p>&#x7B80;&#x5355;&#x7684;&#x753B;&#x4E86;&#x4E2A;&#x56FE;&#xFF0C;<strong>&#x7B80;&#x76F4;&#x662F;&#x3002;&#x3002;&#x753B;&#x56FE;&#x754C;&#x7684;&#x803B;&#x8FB1;&#x3002;&#x3002;&#x3002;</strong></p>
<p>&#x5927;&#x6982;&#x770B;&#x770B;&#x610F;&#x601D;&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#xFF0C;&#x6211;&#x5728;&#x7EC4;&#x5185;&#x5206;&#x4EAB;&#x5C31;&#x662F;&#x7528;&#x7684;&#x8FD9;&#x4E2A;&#x8349;&#x56FE;&#xFF0C;&#x6025;&#x7740;&#x4E0B;&#x73ED;&#xFF0C;&#x5C31;&#x4E0D;&#x91CD;&#x65B0;&#x753B;&#x4E86;&#x3002;&#x3002;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/bcc07a6a07fa78da8aa8ec3325b283d74a48139a9407ced1ba0af334be174e85" alt></p>
<p>&#x5F53;App&#x51B7;&#x542F;&#x52A8;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8089;&#x773C;&#x53EF;&#x89C1;&#x7684;&#x8981;&#x521D;&#x59CB;&#x5316;&#x7684;&#x4E1C;&#x897F;&#x592A;&#x591A;&#x4E86;&#xFF0C;&#x672C;&#x8EAB;<strong>Fragment&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x76F8;&#x5BF9;&#x91CD;&#x7684;&#x4E1C;&#x897F;&#x3002;&#x6BD4;Activity&#x8981;&#x8F7B;&#x91CF;&#x5F88;&#x591A;&#xFF0C;&#x4F46;&#x662F;&#x6BD4;View&#x53C8;&#x8981;&#x91CD;</strong></p>
<p>&#x6211;&#x4EEC;&#x9996;&#x9875;&#x5927;&#x6982;&#x662F; 4-5&#x4E2A;tab&#xFF0C;&#x6BCF;&#x4E2A;tab&#x90FD;&#x662F;&#x4E00;&#x4E2A;Fragment&#xFF0C;&#x4E14;&#x7B2C;&#x4E00;&#x4E2A;tab&#x5185;&#x5D4C;&#x4E86;4&#x4E2A;Fragment&#xFF0C;&#x6211;&#x8FD9;&#x4E00;&#x6B21;&#x7684;<strong>&#x4F18;&#x5316;&#x4E3B;&#x8981;&#x5C06;&#x76EE;&#x6807;&#x7784;&#x51C6;&#x4E86;&#x9996;&#x9875;&#x7684; tab1 &#x4EE5;&#x53CA;tab1&#x5185;&#x5D4C;&#x7684;&#x56DB;&#x4E2A;tab</strong></p>
<h2 id="&#x4E94;&#x3001;&#x6781;&#x81F4;&#x7684;&#x61D2;&#x52A0;&#x8F7D;"><a href="#&#x4E94;&#x3001;&#x6781;&#x81F4;&#x7684;&#x61D2;&#x52A0;&#x8F7D;" class="headerlink" title="&#x4E94;&#x3001;&#x6781;&#x81F4;&#x7684;&#x61D2;&#x52A0;&#x8F7D;"></a>&#x4E94;&#x3001;&#x6781;&#x81F4;&#x7684;&#x61D2;&#x52A0;&#x8F7D;</h2><h3 id="5-1-&#x6781;&#x81F4;&#x7684;&#x61D2;&#x52A0;&#x8F7D;"><a href="#5-1-&#x6781;&#x81F4;&#x7684;&#x61D2;&#x52A0;&#x8F7D;" class="headerlink" title="5.1 &#x6781;&#x81F4;&#x7684;&#x61D2;&#x52A0;&#x8F7D;"></a>5.1 &#x6781;&#x81F4;&#x7684;&#x61D2;&#x52A0;&#x8F7D;</h3><p>&#x5E73;&#x65F6;&#x89C1;&#x5230;&#x7684;&#x61D2;&#x52A0;&#x8F7D;&#xFF1A;</p>
<blockquote>
<p>&#x5C31;&#x662F;&#x521D;&#x59CB;&#x5316;fragment&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x8FDE;&#x540C;&#x6211;&#x4EEC;&#x5199;&#x7684;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x4E00;&#x8D77;&#x6267;&#x884C;&#xFF0C;&#x8FD9;&#x6837;&#x975E;&#x5E38;&#x6D88;&#x8017;&#x6027;&#x80FD;&#xFF0C;&#x6700;&#x7406;&#x60F3;&#x7684;&#x65B9;&#x5F0F;&#x662F;&#xFF0C;&#x53EA;&#x6709;&#x7528;&#x6237;&#x70B9;&#x5F00;&#x6216;&#x6ED1;&#x52A8;&#x5230;&#x5F53;&#x524D;fragment&#x65F6;&#xFF0C;&#x624D;&#x8FDB;&#x884C;&#x8BF7;&#x6C42;&#x7F51;&#x7EDC;&#x7684;&#x64CD;&#x4F5C;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x4EA7;&#x751F;&#x4E86;&#x61D2;&#x52A0;&#x8F7D;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x8BF4;&#x6CD5;&#x3002;</p>
</blockquote>
<p>&#x4F46;&#x662F;&#x3002;&#x3002;&#x3002;&#x3002;</p>
<p>&#x7531;&#x4E8E;&#x6211;&#x4EEC;&#x9996;&#x5C4F;4&#x4E2A;&#x5B50;Tab&#x90FD;&#x662F;&#x7EE7;&#x627F;&#x81EA;&#x4E00;&#x4E2A;&#x57FA;&#x7C7B;BaseLoadListFragment&#xFF0C;&#x6570;&#x636E;&#x52A0;&#x8F7D;&#x7684;&#x903B;&#x8F91;&#x975E;&#x5E38;&#x7684;&#x6B7B;&#xFF0C;&#x6309;&#x7167;&#x4E0A;&#x8FF0;&#x7684;&#x6539;&#x6CD5;&#xFF0C;&#x5F71;&#x54CD;&#x9762;&#x592A;&#x5927;&#x3002;&#x540E;&#x7EED;&#x53EF;&#x80FD;&#x4F1A;&#x5F92;&#x589E;&#x70E6;&#x607C;</p>
<h3 id="5-2-&#x61D2;&#x52A0;&#x8F7D;&#x65B9;&#x6848;"><a href="#5-2-&#x61D2;&#x52A0;&#x8F7D;&#x65B9;&#x6848;" class="headerlink" title="5.2 &#x61D2;&#x52A0;&#x8F7D;&#x65B9;&#x6848;"></a>5.2 &#x61D2;&#x52A0;&#x8F7D;&#x65B9;&#x6848;</h3><ol>
<li>&#x9996;&#x5C4F;&#x52A0;&#x8F7D;&#x65F6;&#xFF0C;&#x53EA;&#x5F80;ViewPager&#x4E2D;&#x585E;&#x5165;&#x9ED8;&#x8BA4;&#x8981;&#x5C55;&#x793A;&#x7684;tab&#xFF0C;&#x5269;&#x4F59;&#x7684;tab&#x7528;&#x7A7A;&#x7684;&#x5360;&#x4F4D;Fragment&#x4EE3;&#x66FF;</li>
<li>&#x5F53;&#x7528;&#x6237;&#x6ED1;&#x52A8;&#x5230;&#x5176;&#x4ED6;tab&#x65F6;&#xFF0C;&#x6BD4;&#x5982;&#x6ED1;&#x52A8;&#x5230;&#x597D;&#x53CB;&#x52A8;&#x6001;tab&#xFF0C;&#x5C31;&#x7528;FriendFragment&#x628A;&#x5F53;&#x524D;&#x7684;EmptyPlaceholderFragment&#x66FF;&#x6362;&#x6389;&#xFF0C;&#x7136;&#x540E;adapter.notifyDataSetChanged</li>
<li>&#x5F53;&#x56DB;&#x4E2A;Tab&#x5168;&#x90E8;&#x66FF;&#x6362;&#x4E3A;&#x6570;&#x636E;tab&#x65F6;&#xFF0C;&#x6E05;&#x9664;&#x6389;EmptyFragment&#x7684;&#x5F15;&#x7528;&#xFF0C;&#x91CA;&#x653E;&#x5185;&#x5B58;</li>
</ol>
<p>&#x8BF4;&#x5230;&#x8FD9;&#x91CC;&#xFF0C;&#x53C8;&#x4E0D;&#x5F97;&#x4E0D;&#x63D0;&#x4E00;&#x4E2A;&#x8001;&#x751F;&#x5E38;&#x8C08;&#x7684;&#x4E00;&#x4E2A;&#x5751;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x7684;&#x9996;&#x9875;&#x662F;&#x7528;&#x7684;ViewPager + FragmentPagerAdapter&#x6765;&#x8FDB;&#x884C;&#x5B9E;&#x73B0;&#x7684;&#x3002;&#x56E0;&#x6B64;&#x5C31;&#x51FA;&#x73B0;&#x4E86;&#x4E00;&#x4E2A;&#x5751;&#xFF1A;</p>
<blockquote>
<p>ViewPager + FragmentPagerAdapter&#x7EC4;&#x5408;&#x4F7F;&#x7528;&#xFF0C;&#x8C03;&#x7528;notifyDataSetChanged()&#x65B9;&#x6CD5;&#x65E0;&#x6548;&#xFF0C;&#x65E0;&#x6CD5;&#x5237;&#x65B0;Fragment&#x5217;&#x8868;</p>
</blockquote>
<p>&#x4E0B;&#x9762;&#x6211;&#x4F1A;&#x5BF9;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x8FDB;&#x884C;&#x4E00;&#x4E0B;&#x8BE6;&#x7EC6;&#x7684;&#x4ECB;&#x7ECD;</p>
<h3 id="5-3-FragmentPagerAdapter&#x4E0E;FragmentStatePagerAdapter"><a href="#5-3-FragmentPagerAdapter&#x4E0E;FragmentStatePagerAdapter" class="headerlink" title="5.3 FragmentPagerAdapter&#x4E0E;FragmentStatePagerAdapter"></a>5.3 FragmentPagerAdapter&#x4E0E;FragmentStatePagerAdapter</h3><p>&#x5F53;&#x6211;&#x4EEC;&#x8981;&#x4F7F;&#x7528;ViewPager&#x6765;&#x52A0;&#x8F7D;Fragment&#x65F6;&#xFF0C;&#x5B98;&#x65B9;&#x4E3A;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;&#x4E86;&#x8FD9;&#x4E24;&#x79CD;Adapter&#xFF0C;&#x90FD;&#x662F;&#x7EE7;&#x627F;&#x81EA;PagerAdapter&#x3002;</p>
<p>&#x533A;&#x522B;&#xFF0C;&#x4E0A;&#x5B98;&#x65B9;&#x63CF;&#x8FF0;&#xFF1A;</p>
<p>FragmentPagerAdapter</p>
<blockquote>
<p>This version of the pager is best for use when there are a handful of typically more static fragments to be paged through, such as a set of tabs. The fragment of each page the user visits will be kept in memory, though its view hierarchy may be destroyed when not visible. This can result in using a significant amount of memory since fragment instances can hold on to an arbitrary amount of state. For larger sets of pages, consider <code>[FragmentStatePagerAdapter](https://developer.android.com/reference/android/support/v4/app/FragmentStatePagerAdapter.html)</code>.</p>
</blockquote>
<p>FragmentStatePagerAdapter</p>
<blockquote>
<p>This version of the pager is more useful when there are a large number of pages, working more like a list view. When pages are not visible to the user, their entire fragment may be destroyed, only keeping the saved state of that fragment. This allows the pager to hold on to much less memory associated with each visited page as compared to<code>[FragmentPagerAdapter](https://developer.android.com/reference/android/support/v4/app/FragmentPagerAdapter.html)</code> at the cost of potentially more overhead when switching between pages</p>
</blockquote>
<p>&#x603B;&#x7ED3;&#xFF1A;</p>
<ul>
<li>&#x4F7F;&#x7528;FragmentStatePagerAdapter&#x65F6;&#xFF0C;&#x5982;&#x679C;tab&#x5BF9;&#x4E8E;&#x7528;&#x6237;&#x4E0D;&#x53EF;&#x89C1;&#x4E86;&#xFF0C;Fragment&#x5C31;&#x4F1A;&#x88AB;&#x9500;&#x6BC1;&#xFF0C;FragmentPagerAdapter&#x5219;&#x4E0D;&#x4F1A;&#xFF0C;&#x4F7F;&#x7528;FragmentPagerAdapter&#x65F6;&#xFF0C;&#x6240;&#x6709;&#x7684;tab&#x4E0A;&#x7684;Fragment&#x90FD;&#x4F1A;hold&#x5728;&#x5185;&#x5B58;&#x91CC;</li>
<li>&#x5F53;tab&#x975E;&#x5E38;&#x591A;&#x65F6;&#xFF0C;&#x63A8;&#x8350;&#x4F7F;&#x7528;FragmentStatePagerAdapter</li>
<li>&#x5F53;tab&#x4E0D;&#x591A;&#xFF0C;&#x4E14;&#x56FA;&#x5B9A;&#x65F6;&#xFF0C;&#x63A8;&#x8350;&#x7528;FragmentPagerAdapter</li>
</ul>
<p>&#x6211;&#x4EEC;&#x9879;&#x76EE;&#x4E2D;&#x5C31;&#x662F;&#x4F7F;&#x7528;&#x7684;ViewPager+FragmentPagerAdapter&#x3002;</p>
<h3 id="5-4-FragmentPagerAdapter&#x7684;&#x5237;&#x65B0;&#x95EE;&#x9898;"><a href="#5-4-FragmentPagerAdapter&#x7684;&#x5237;&#x65B0;&#x95EE;&#x9898;" class="headerlink" title="5.4 FragmentPagerAdapter&#x7684;&#x5237;&#x65B0;&#x95EE;&#x9898;"></a>5.4 FragmentPagerAdapter&#x7684;&#x5237;&#x65B0;&#x95EE;&#x9898;</h3><p>&#x6B63;&#x5E38;&#x60C5;&#x51B5;&#xFF0C;&#x6211;&#x4EEC;&#x4F7F;&#x7528;adapter&#x65F6;&#xFF0C;&#x60F3;&#x8981;&#x5237;&#x65B0;&#x6570;&#x636E;&#x53EA;&#x9700;&#x8981;&#xFF1A;</p>
<ol>
<li>&#x66F4;&#x65B0;dataSet</li>
<li>&#x8C03;&#x7528;notifyDataSetChanged()</li>
</ol>
<p>&#x4F46;&#x662F;&#xFF0C;&#x8FD9;&#x4E2A;&#x5728;&#x8FD9;&#x4E2A;Adapter&#x4E2D;&#x662F;&#x4E0D;&#x9002;&#x7528;&#x7684;&#x3002;&#x56E0;&#x4E3A;&#xFF08;&#x8FD9;&#x4E00;&#x6B65;&#x6CA1;&#x8010;&#x5FC3;&#x7684;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x770B;&#x540E;&#x9762;&#x7684;&#x603B;&#x7ED3;&#xFF09;&#xFF1A;</p>
<ol>
<li>&#x9ED8;&#x8BA4;&#x7684;PagerAdapter&#x7684;destoryItem&#x53EA;&#x4F1A;&#x628A;Fragment detach&#x6389;&#xFF0C;&#x800C;&#x4E0D;&#x4F1A;remove</li>
<li>&#x5F53;&#x518D;&#x6B21;&#x8C03;&#x7528;instantiateItem&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E4B;&#x524D;detach&#x6389;&#x7684;Fragment&#xFF0C;&#x53C8;&#x4F1A;&#x4ECE;mFragmentManager&#x4E2D;&#x53D6;&#x51FA;&#xFF0C;&#x53C8;&#x53EF;&#x4EE5;attach&#x4E86;</li>
</ol>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/6b6830401c6e32c6648167aecad7e92035bda771b0d969283c8adb59f2ba47d0" alt></p>
<p>3&#xFF0C;ViewPager&#x7684;dataSetChanged&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/6fac3f5d5b2d9514b10f05227f73f4346028bdd0edeb1a360bd18a9214a16461" alt></p>
<p>4&#xFF0C;&#x4E14;adapter&#x7684;&#x9ED8;&#x8BA4;&#x5B9E;&#x73B0;</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/54dc5c401717a96ac26105371acc021ebf3a53adcc64e03c005f618884a82882" alt></p>
<p>&#x7B80;&#x5355;&#x603B;&#x7ED3;&#x4E00;&#x4E0B;&#xFF1A;</p>
<p>1&#xFF0C;ViewPager&#x7684;dataSetChanged()&#x4E2D;&#x4F1A;&#x53BB;&#x7528;adapter.getItemPosition&#x6765;&#x5224;&#x65AD;&#x662F;&#x5426;&#x8981;&#x79FB;&#x9664;&#x5F53;&#x524D;Item&#xFF08;position = POSITION_NONE&#x65F6;remove&#xFF09;</p>
<p>2&#xFF0C;PagerAdapter&#x7684;getItemPosition&#x9ED8;&#x8BA4;&#x5B9E;&#x73B0;&#x4E3A;POSITION_UNCHANGED</p>
<p>&#x4E0A;&#x8FF0;&#x4E24;&#x70B9;&#x5BFC;&#x81F4;ViewPager&#x6784;&#x5EFA;&#x5B8C;&#x6210;Adapter&#x4E4B;&#x540E;&#xFF0C;&#x4E0D;&#x4F1A;&#x6709;&#x673A;&#x4F1A;&#x8C03;&#x7528;&#x5230;Adapter&#x7684;instantiateItem&#x4E86;&#x3002;</p>
<p>&#x518D;&#x8005;&#xFF0C;&#x5373;&#x4F7F;&#x91CD;&#x5199;&#x4E86;getItemPosition&#x65B9;&#x6CD5;&#xFF0C;&#x6BCF;&#x6B21;&#x8FD4;&#x56DE;POSITION_NONE&#xFF0C;&#x8FD8;&#x662F;&#x4E0D;&#x4F1A;&#x66FF;&#x6362;&#x6389;Fragment&#xFF0C;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;instantiateItem&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x4F1A;&#x6839;&#x636E;getItemId()&#x53BB;&#x4ECE;FragmetnManager&#x4E2D;&#x627E;&#x5230;&#x5DF2;&#x7ECF;&#x521B;&#x5EFA;&#x597D;&#x7684;Fragment&#x8FD4;&#x56DE;&#x56DE;&#x53BB;&#xFF0C;&#x800C;getItemId()&#x7684;&#x9ED8;&#x8BA4;&#x5B9E;&#x73B0;&#x662F;return position&#x3002;</p>
<h3 id="5-5-FragmentPagerAdapter&#x5237;&#x65B0;&#x7684;&#x6B63;&#x786E;&#x59FF;&#x52BF;"><a href="#5-5-FragmentPagerAdapter&#x5237;&#x65B0;&#x7684;&#x6B63;&#x786E;&#x59FF;&#x52BF;" class="headerlink" title="5.5 FragmentPagerAdapter&#x5237;&#x65B0;&#x7684;&#x6B63;&#x786E;&#x59FF;&#x52BF;"></a>5.5 FragmentPagerAdapter&#x5237;&#x65B0;&#x7684;&#x6B63;&#x786E;&#x59FF;&#x52BF;</h3><p>&#x91CD;&#x5199;getItemId()&#x548C;getItemPosition()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">typescript&#x590D;&#x5236;&#x4EE3;&#x7801; class TabsAdapter extends FragmentPagerAdapter {</span><br><span class="line"></span><br><span class="line">        private ArrayList&lt;Fragment&gt; mFragmentList;</span><br><span class="line">        private ArrayList&lt;String&gt; mPageTitleList;</span><br><span class="line">        private int mCount;</span><br><span class="line"></span><br><span class="line">        TabsAdapter(FragmentManager fm, ArrayList&lt;Fragment&gt; fragmentList, ArrayList&lt;String&gt; pageTitleList) {</span><br><span class="line">            super(fm);</span><br><span class="line">            mFragmentList = fragmentList;</span><br><span class="line">            mCount = fragmentList.size();</span><br><span class="line">            mPageTitleList = pageTitleList;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public Fragment getItem(int position) {</span><br><span class="line">            return mFragmentList.get(position);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public CharSequence getPageTitle(int position) {</span><br><span class="line">            return mPageTitleList.get(position);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public int getCount() {</span><br><span class="line">            return mCount;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public long getItemId(int position) {</span><br><span class="line">            //&#x8FD9;&#x4E2A;&#x5730;&#x65B9;&#x7684;&#x91CD;&#x5199;&#x975E;&#x5E38;&#x5173;&#x952E;&#xFF0C;super&#x4E2D;&#x662F;&#x8FD4;&#x56DE;position&#xFF0C;</span><br><span class="line">            //&#x5982;&#x679C;&#x4E0D;&#x91CD;&#x5199;&#xFF0C;&#x8FD8;&#x662F;&#x4F1A;&#x7EE7;&#x7EED;&#x627E;&#x5230;FragmentManager&#x4E2D;&#x7F13;&#x5B58;&#x7684;Fragment</span><br><span class="line">            return mFragmentList.get(position).hashCode();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public int getItemPosition(@NonNull Object object) {</span><br><span class="line">            //&#x4E0D;&#x5728;&#x6570;&#x636E;&#x96C6;&#x5408;&#x91CC;&#x9762;&#x7684;&#x8BDD;&#xFF0C;return POSITION_NONE&#xFF0C;&#x8FDB;&#x884C;item&#x7684;&#x91CD;&#x5EFA;</span><br><span class="line">            int index = mFragmentList.indexOf(object);</span><br><span class="line">            if (index == -1) {</span><br><span class="line">                return POSITION_NONE;</span><br><span class="line">            } else {</span><br><span class="line">                return mFragmentList.indexOf(object);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        void refreshFragments(ArrayList&lt;Fragment&gt; fragmentList) {</span><br><span class="line">            mFragmentList = fragmentList;</span><br><span class="line">            notifyDataSetChanged();</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>&#x5176;&#x4ED6;&#x7684;&#x76F8;&#x5173;&#x4EE3;&#x7801;&#xFF1A;</p>
<p><strong>&#xFF08;1&#xFF09;&#x5B9E;&#x73B0;ViewPager.OnPageChangeListener</strong>&#xFF0C;&#x6765;&#x76D1;&#x63A7;ViewPager&#x7684;&#x6ED1;&#x52A8;&#x72B6;&#x6001;&#xFF0C;&#x624D;&#x53EF;&#x4EE5;&#x5728;&#x6ED1;&#x52A8;&#x5230;&#x4E0B;&#x4E00;&#x4E2A;tab&#x7684;&#x65F6;&#x5019;&#x8FDB;&#x884C;Fragment&#x66FF;&#x6362;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x5176;&#x4E2D;mDefaultTab&#x662F;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x63A5;&#x53E3;&#x8FD4;&#x56DE;&#x7684;&#x5F53;&#x524D;&#x542F;&#x52A8;&#x5C55;&#x793A;&#x7684;tab&#x5E8F;&#x53F7;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">arduino&#x590D;&#x5236;&#x4EE3;&#x7801;    @Override</span><br><span class="line">    public void onPageScrolled(int position, float positionOffset, int positionOffsetPixels) {</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onPageSelected(int position) {</span><br><span class="line">        mCurrentSelectedTab = position;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onPageScrollStateChanged(int state) {</span><br><span class="line">        if (!hasReplacedAllEmptyFragments &amp;&amp; mCurrentSelectedTab != mDefaultTab &amp;&amp; state == 0) {</span><br><span class="line">            //&#x5F53;&#x6EE1;&#x8DB3;&#xFF1A; 1. &#x6CA1;&#x6709;&#x5168;&#x90E8;&#x66FF;&#x6362;&#x5B8C; 2. &#x5F53;&#x524D;tab&#x4E0D;&#x662F;&#x521D;&#x59CB;&#x5316;&#x7684;&#x9ED8;&#x8BA4;tab&#xFF08;&#x9ED8;&#x8BA4;tab&#x4E0D;&#x4F1A;&#x7528;&#x7A7A;&#x7684;Fragment&#x53BB;&#x66FF;&#x6362;&#xFF09; 3. &#x6ED1;&#x52A8;&#x7ED3;&#x675F;&#x4E86;&#xFF0C;&#x5373;state = 0</span><br><span class="line">            replaceEmptyFragmentsIfNeed(mCurrentSelectedTab);</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<p>&#x5907;&#x6CE8;&#xFF1A;</p>
<blockquote>
<p>onPageScrollStateChanged&#x63A5;&#x6ED1;&#x52A8;&#x7684;&#x72B6;&#x6001;&#x503C;&#x3002;&#x4E00;&#x5171;&#x6709;&#x4E09;&#x4E2A;&#x53D6;&#x503C;&#xFF1A;</p>
<p>0&#xFF1A;&#x4EC0;&#x4E48;&#x90FD;&#x6CA1;&#x505A;  </p>
<p>1&#xFF1A;&#x5F00;&#x59CB;&#x6ED1;&#x52A8;  </p>
<p>2&#xFF1A;&#x6ED1;&#x52A8;&#x7ED3;&#x675F;</p>
<p>&#x4E00;&#x6B21;&#x5F15;&#x8D77;&#x9875;&#x9762;&#x5207;&#x6362;&#x7684;&#x6ED1;&#x52A8;&#xFF0C;state&#x7684;&#x987A;&#x5E8F;&#x5206;&#x522B;&#x662F;&#xFF1A; 1  -&gt;  2  -&gt;  0</p>
</blockquote>
<p>&#xFF08;<strong>2&#xFF09;&#x8FDB;&#x884C;Fragment&#x7684;&#x66FF;&#x6362;</strong>&#xFF0C;&#x8FD9;&#x91CC;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x7684;tab&#x6570;&#x91CF;&#x662F;&#x53EF;&#x80FD;&#x6839;&#x636E;&#x5168;&#x5C40;config&#x4FE1;&#x606F;&#x800C;&#x6539;&#x53D8;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x4E2A;&#x5730;&#x65B9;&#x5199;&#x7684;&#x7A0D;&#x5FAE;&#x7EA0;&#x7ED3;&#x4E86;&#x4E00;&#x4E9B;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">ini&#x590D;&#x5236;&#x4EE3;&#x7801;    /**</span><br><span class="line">     * &#x5982;&#x679C;&#x5168;&#x90E8;&#x66FF;&#x6362;&#x5B8C;&#x4E86;&#xFF0C;&#x76F4;&#x63A5;return</span><br><span class="line">     * &#x66FF;&#x6362;&#x8FC7;&#x7A0B;&#xFF1A;</span><br><span class="line">     * 1. &#x627E;&#x5230;&#x5F53;&#x524D;&#x7A7A;&#x7684;tab&#x5728;mEmptyFragmentList &#x4E2D;&#x7684;&#x5B9E;&#x9645;&#x4E0B;&#x6807;</span><br><span class="line">     *</span><br><span class="line">     * @param tabId &#x8981;&#x66FF;&#x6362;&#x7684;tab&#x7684;tabId - &#xFF08;&#x5F53;&#x524D;&#x7A7A;&#x7684;Fragment&#x5728;adapter&#x6570;&#x636E;&#x5217;&#x8868;mFragmentList&#x7684;&#x4E0B;&#x6807;&#xFF09;</span><br><span class="line">     */</span><br><span class="line">    private void replaceEmptyFragmentsIfNeed(int tabId) {</span><br><span class="line">        if (hasReplacedAllEmptyFragments) {</span><br><span class="line">            return;</span><br><span class="line">        }</span><br><span class="line">        int tabRealIndex = mEmptyFragmentList.indexOf(mFragmentList.get(tabId)); //&#x627E;&#x5230;&#x5F53;&#x524D;&#x7684;&#x7A7A;Fragment&#x5728; mEmptyFragmentList &#x662F;&#x7B2C;&#x51E0;&#x4E2A;</span><br><span class="line">        if (tabRealIndex &gt; -1) {</span><br><span class="line">            if (Collections.replaceAll(mFragmentList, mEmptyFragmentList.get(tabRealIndex), mDataFragmentList.get(tabRealIndex))) {</span><br><span class="line">                mTabsAdapter.refreshFragments(mFragmentList); //&#x5C06;mFragmentList&#x4E2D;&#x7684;&#x76F8;&#x5E94;empty fragment&#x66FF;&#x6362;&#x5B8C;&#x6210;&#x4E4B;&#x540E;&#x5237;&#x65B0;&#x6570;&#x636E;</span><br><span class="line">                boolean hasAllReplaced = true;</span><br><span class="line">                for (Fragment fragment : mFragmentList) {</span><br><span class="line">                    if (fragment instanceof EmptyPlaceHolderFragment) {</span><br><span class="line">                        hasAllReplaced = false;</span><br><span class="line">                        break;</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">                if (hasAllReplaced) {</span><br><span class="line">                    mEmptyFragmentList.clear(); //&#x5168;&#x90E8;&#x66FF;&#x6362;&#x5B8C;&#x6210;&#x7684;&#x8BDD;&#xFF0C;&#x91CA;&#x653E;&#x5F15;&#x7528;</span><br><span class="line">                }</span><br><span class="line">                hasReplacedAllEmptyFragments = hasAllReplaced;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>

<h2 id="&#x516D;&#x3001;&#x795E;&#x5947;&#x7684;&#x7684;&#x9884;&#x52A0;&#x8F7D;&#xFF08;&#x9884;&#x52A0;&#x8F7D;View&#xFF0C;&#x800C;&#x4E0D;&#x662F;data&#xFF09;"><a href="#&#x516D;&#x3001;&#x795E;&#x5947;&#x7684;&#x7684;&#x9884;&#x52A0;&#x8F7D;&#xFF08;&#x9884;&#x52A0;&#x8F7D;View&#xFF0C;&#x800C;&#x4E0D;&#x662F;data&#xFF09;" class="headerlink" title="&#x516D;&#x3001;&#x795E;&#x5947;&#x7684;&#x7684;&#x9884;&#x52A0;&#x8F7D;&#xFF08;&#x9884;&#x52A0;&#x8F7D;View&#xFF0C;&#x800C;&#x4E0D;&#x662F;data&#xFF09;"></a>&#x516D;&#x3001;&#x795E;&#x5947;&#x7684;&#x7684;&#x9884;&#x52A0;&#x8F7D;&#xFF08;&#x9884;&#x52A0;&#x8F7D;View&#xFF0C;&#x800C;&#x4E0D;&#x662F;data&#xFF09;</h2><p>Android&#x5728;&#x542F;&#x52A8;&#x8FC7;&#x7A0B;&#x4E2D;&#x53EF;&#x80FD;&#x6D89;&#x53CA;&#x5230;&#x7684;&#x4E00;&#x4E9B;View&#x7684;&#x9884;&#x52A0;&#x8F7D;&#x65B9;&#x6848;&#xFF1A;</p>
<ol>
<li>WebView&#x63D0;&#x524D;&#x521B;&#x5EFA;&#x597D;&#xFF0C;&#x56E0;&#x4E3A;webview&#x521B;&#x5EFA;&#x7684;&#x8017;&#x65F6;&#x8F83;&#x957F;&#xFF0C;&#x5982;&#x679C;&#x9996;&#x5C4F;&#x6709;h5&#x7684;&#x9875;&#x9762;&#xFF0C;&#x53EF;&#x4EE5;&#x63D0;&#x524D;&#x521B;&#x5EFA;&#x597D;&#x3002;</li>
<li>Application&#x7684;onCreate&#x65F6;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5F00;&#x59CB;&#x5728;&#x5B50;&#x7EBF;&#x7A0B;&#x4E2D;&#x8FDB;&#x884C;&#x540E;&#x9762;&#x8981;&#x7528;&#x5230;&#x7684;Layout&#x7684;inflate&#x5DE5;&#x4F5C;&#x4E86;&#xFF0C;&#x6700;&#x5148;&#x60F3;&#x5230;&#x7684;&#x5E94;&#x8BE5;&#x662F;&#x5B98;&#x65B9;&#x63D0;&#x4F9B;&#x7684;AsyncLayoutInflater</li>
<li>&#x586B;&#x5145;View&#x7684;&#x6570;&#x636E;&#x7684;&#x9884;&#x52A0;&#x8F7D;&#xFF0C;&#x4ECA;&#x5929;&#x7684;&#x5185;&#x5BB9;&#x4E0D;&#x6D89;&#x53CA;&#x8FD9;&#x4E00;&#x9879;</li>
</ol>
<h3 id="6-1-&#x9700;&#x8981;&#x9884;&#x52A0;&#x8F7D;&#x4EC0;&#x4E48;"><a href="#6-1-&#x9700;&#x8981;&#x9884;&#x52A0;&#x8F7D;&#x4EC0;&#x4E48;" class="headerlink" title="6.1 &#x9700;&#x8981;&#x9884;&#x52A0;&#x8F7D;&#x4EC0;&#x4E48;"></a>6.1 &#x9700;&#x8981;&#x9884;&#x52A0;&#x8F7D;&#x4EC0;&#x4E48;</h3><p>&#x76F4;&#x63A5;&#x770B;&#x56FE;&#xFF0C;&#x8FD9;&#x4E2A;&#x662F;&#x9996;&#x9875;&#x56DB;&#x4E2A;&#x5B50;Tab Fragment&#x7684;&#x57FA;&#x7C7B;&#x7684;layout&#xFF0C;&#x56E0;&#x4E3A;&#x67D0;&#x4E9B;&#x4E1C;&#x897F;&#x8BBE;&#x8BA1;&#x7684;&#x4E0D;&#x5408;&#x7406;&#xFF0C;&#x5BFC;&#x81F4;&#x5C42;&#x7EA7;&#x662F;&#x975E;&#x5E38;&#x7684;&#x6DF1;&#xFF0C;&#x76F4;&#x63A5;&#x5BFC;&#x81F4;&#x4E86;&#x9996;&#x9875;&#x4E0A;&#x7684;&#x4E09;&#x4E2A;tab&#x52A0;&#x4E0A;FeedMainFragment&#x81EA;&#x8EAB;&#xFF0C;&#x5149;&#x5C06;&#x8FD9;&#x4E2A;View inflate&#x51FA;&#x6765;&#x7684;&#x65F6;&#x95F4;&#x5C31;&#x975E;&#x5E38;&#x957F;&#x3002;&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x8003;&#x8651;&#x5728;&#x5B50;&#x7EBF;&#x7A0B;&#x4E2D;&#x63D0;&#x524D;inflate layout</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/3a5d460119094182cda0858e8bab245704fa0278b52296a929ca8cfaddf5e137" alt></p>
<h3 id="6-2-&#x4FEE;&#x6539;AsyncLayoutInflater"><a href="#6-2-&#x4FEE;&#x6539;AsyncLayoutInflater" class="headerlink" title="6.2 &#x4FEE;&#x6539;AsyncLayoutInflater"></a>6.2 &#x4FEE;&#x6539;AsyncLayoutInflater</h3><p>&#x5B98;&#x65B9;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x7C7B;&#xFF0C;&#x53EF;&#x4EE5;&#x6765;&#x8FDB;&#x884C;&#x5F02;&#x6B65;&#x7684;inflate&#xFF0C;&#x4F46;&#x662F;&#x6709;&#x4E24;&#x4E2A;&#x7F3A;&#x70B9;&#xFF1A;</p>
<ol>
<li>&#x6BCF;&#x6B21;&#x90FD;&#x8981;&#x73B0;&#x573A;new&#x4E00;&#x4E2A;&#x51FA;&#x6765;</li>
<li>&#x5F02;&#x6B65;&#x52A0;&#x8F7D;&#x7684;view&#x53EA;&#x80FD;&#x901A;&#x8FC7;callback&#x56DE;&#x8C03;&#x624D;&#x80FD;&#x83B7;&#x5F97;&#xFF08;&#x6B7B;&#x7A74;&#xFF09;</li>
</ol>
<p>&#x56E0;&#x6B64;&#x51B3;&#x5B9A;&#x81EA;&#x5DF1;&#x5C01;&#x88C5;&#x4E00;&#x4E2A;AsyncInflateManager&#xFF0C;&#x5185;&#x90E8;&#x4F7F;&#x7528;&#x7EBF;&#x7A0B;&#x6C60;&#xFF0C;&#x4E14;&#x5BF9;&#x4E8E;inflate&#x5B8C;&#x6210;&#x7684;View&#x6709;&#x4E00;&#x5957;&#x7F13;&#x5B58;&#x673A;&#x5236;&#x3002;&#x800C;&#x5176;&#x4E2D;&#x6700;&#x6838;&#x5FC3;&#x7684;LayoutInflater&#x5219;&#x76F4;&#x63A5;copy&#x51FA;&#x6765;&#x5C31;&#x597D;&#x3002;</p>
<p>&#x5148;&#x770B;AsyncInflateManager&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x76F4;&#x63A5;&#x5C06;&#x4EE3;&#x7801;copy&#x8FDB;&#x6765;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x622A;&#x56FE;&#x4E86;&#xFF0C;&#x8FD9;&#x6837;&#x4F60;&#x4EEC;&#x5982;&#x679C;&#x60F3;&#x7528;&#x5176;&#x4E2D;&#x90E8;&#x5206;&#x4E1C;&#x897F;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;copy&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line">typescript&#x590D;&#x5236;&#x4EE3;&#x7801;/**</span><br><span class="line"> * @author zoutao</span><br><span class="line"> * &lt;p&gt;</span><br><span class="line"> * &#x7528;&#x6765;&#x63D0;&#x4F9B;&#x5B50;&#x7EBF;&#x7A0B;inflate view&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x907F;&#x514D;&#x67D0;&#x4E2A;view&#x5C42;&#x7EA7;&#x592A;&#x6DF1;&#x592A;&#x590D;&#x6742;&#xFF0C;&#x4E3B;&#x7EBF;&#x7A0B;inflate&#x4F1A;&#x8017;&#x65F6;&#x5F88;&#x957F;&#xFF0C;</span><br><span class="line"> * &#x5B9E;&#x5C31;&#x662F;&#x5BF9; AsyncLayoutInflater&#x8FDB;&#x884C;&#x4E86;&#x62BD;&#x53D6;&#x548C;&#x5C01;&#x88C5;</span><br><span class="line"> */</span><br><span class="line">public class AsyncInflateManager {</span><br><span class="line">    private static AsyncInflateManager sInstance;</span><br><span class="line">    private ConcurrentHashMap&lt;String, AsyncInflateItem&gt; mInflateMap; //&#x4FDD;&#x5B58;inflateKey&#x4EE5;&#x53CA;InflateItem&#xFF0C;&#x91CC;&#x9762;&#x5305;&#x542B;&#x6240;&#x6709;&#x8981;&#x8FDB;&#x884C;inflate&#x7684;&#x4EFB;&#x52A1;</span><br><span class="line">    private ConcurrentHashMap&lt;String, CountDownLatch&gt; mInflateLatchMap;</span><br><span class="line">    private ExecutorService mThreadPool; //&#x7528;&#x6765;&#x8FDB;&#x884C;inflate&#x5DE5;&#x4F5C;&#x7684;&#x7EBF;&#x7A0B;&#x6C60;</span><br><span class="line"></span><br><span class="line">    private AsyncInflateManager() {</span><br><span class="line">        mThreadPool = new ThreadPoolExecutor(4, 4, 0, TimeUnit.MILLISECONDS, new LinkedBlockingDeque&lt;Runnable&gt;());</span><br><span class="line">        mInflateMap = new ConcurrentHashMap&lt;&gt;();</span><br><span class="line">        mInflateLatchMap = new ConcurrentHashMap&lt;&gt;();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public static AsyncInflateManager getInstance() {</span><br><span class="line">        &#x5355;&#x4F8B;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &#x7528;&#x6765;&#x83B7;&#x5F97;&#x5F02;&#x6B65;inflate&#x51FA;&#x6765;&#x7684;view</span><br><span class="line">     *</span><br><span class="line">     * @param context</span><br><span class="line">     * @param layoutResId &#x9700;&#x8981;&#x62FF;&#x7684;layoutId</span><br><span class="line">     * @param parent      container</span><br><span class="line">     * @param inflateKey  &#x6BCF;&#x4E00;&#x4E2A;View&#x4F1A;&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;inflateKey&#xFF0C;&#x56E0;&#x4E3A;&#x53EF;&#x80FD;&#x8BB8;&#x591A;&#x5730;&#x65B9;&#x7528;&#x7684;&#x540C;&#x4E00;&#x4E2A; layout&#xFF0C;&#x4F46;&#x662F;&#x9700;&#x8981;inflate&#x591A;&#x4E2A;&#xFF0C;&#x7528;InflateKey&#x8FDB;&#x884C;&#x533A;&#x5206;</span><br><span class="line">     * @param inflater    &#x5916;&#x90E8;&#x4F20;&#x8FDB;&#x6765;&#x7684;inflater&#xFF0C;&#x5916;&#x9762;&#x5982;&#x679C;&#x6709;inflater&#xFF0C;&#x4F20;&#x8FDB;&#x6765;&#xFF0C;&#x7528;&#x6765;&#x8FDB;&#x884C;&#x53EF;&#x80FD;&#x7684;SyncInflate&#xFF0C;</span><br><span class="line">     * @return &#x6700;&#x540E;inflate&#x51FA;&#x6765;&#x7684;view</span><br><span class="line">     */</span><br><span class="line">    @UiThread</span><br><span class="line">    @NonNull</span><br><span class="line">    public View getInflatedView(Context context, int layoutResId, @Nullable ViewGroup parent, String inflateKey, @NonNull LayoutInflater inflater) {</span><br><span class="line">        if (!TextUtils.isEmpty(inflateKey) &amp;&amp; mInflateMap.containsKey(inflateKey)) {</span><br><span class="line">            AsyncInflateItem item = mInflateMap.get(inflateKey);</span><br><span class="line">            CountDownLatch latch = mInflateLatchMap.get(inflateKey);</span><br><span class="line">            if (item != null) {</span><br><span class="line">                View resultView = item.inflatedView;</span><br><span class="line">                if (resultView != null) {</span><br><span class="line">                    //&#x62FF;&#x5230;&#x4E86;view&#x76F4;&#x63A5;&#x8FD4;&#x56DE;</span><br><span class="line">                    removeInflateKey(inflateKey);</span><br><span class="line">                    replaceContextForView(resultView, context);</span><br><span class="line">                    return resultView;</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                if (item.isInflating() &amp;&amp; latch != null) {</span><br><span class="line">                    //&#x6CA1;&#x62FF;&#x5230;view&#xFF0C;&#x4F46;&#x662F;&#x5728;inflate&#x4E2D;&#xFF0C;&#x7B49;&#x5F85;&#x8FD4;&#x56DE;</span><br><span class="line">                    try {</span><br><span class="line">                        latch.wait();</span><br><span class="line">                    } catch (InterruptedException e) {</span><br><span class="line">                        Log.e(TAG, e.getMessage(), e);</span><br><span class="line">                    }</span><br><span class="line">                    removeInflateKey(inflateKey);</span><br><span class="line">                    if (resultView != null) {</span><br><span class="line">                        replaceContextForView(resultView, context);</span><br><span class="line">                        return resultView;</span><br><span class="line">                    }</span><br><span class="line"></span><br><span class="line">                }</span><br><span class="line">                //&#x5982;&#x679C;&#x8FD8;&#x6CA1;&#x5F00;&#x59CB;inflate&#xFF0C;&#x5219;&#x8BBE;&#x7F6E;&#x4E3A;false&#xFF0C;UI&#x7EBF;&#x7A0B;&#x8FDB;&#x884C;inflate</span><br><span class="line">                item.setCancelled(true);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        //&#x62FF;&#x5F02;&#x6B65;inflate&#x7684;View&#x5931;&#x8D25;&#xFF0C;UI&#x7EBF;&#x7A0B;inflate</span><br><span class="line">        return inflater.inflate(layoutResId, parent, false);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * inflater&#x521D;&#x59CB;&#x5316;&#x65F6;&#x662F;&#x4F20;&#x8FDB;&#x6765;&#x7684;application&#xFF0C;inflate&#x51FA;&#x6765;&#x7684;view&#x7684;context&#x6CA1;&#x6CD5;&#x7528;&#x6765;startActivity&#xFF0C;</span><br><span class="line">     * &#x56E0;&#x6B64;&#x7528;MutableContextWrapper&#x8FDB;&#x884C;&#x5305;&#x88C5;&#xFF0C;&#x540E;&#x7EED;&#x8FDB;&#x884C;&#x66FF;&#x6362;</span><br><span class="line">     */</span><br><span class="line">    private void replaceContextForView(View inflatedView, Context context) {</span><br><span class="line">        if (inflatedView == null || context == null) {</span><br><span class="line">            return;</span><br><span class="line">        }</span><br><span class="line">        Context cxt = inflatedView.getContext();</span><br><span class="line">        if (cxt instanceof MutableContextWrapper) {</span><br><span class="line">            ((MutableContextWrapper) cxt).setBaseContext(context);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @UiThread</span><br><span class="line">    private void asyncInflate(Context context, AsyncInflateItem item) {</span><br><span class="line">        if (item == null || item.layoutResId == 0 || mInflateMap.containsKey(item.inflateKey) || item.isCancelled() || item.isInflating()) {</span><br><span class="line">            return;</span><br><span class="line">        }</span><br><span class="line">        onAsyncInflateReady(item);</span><br><span class="line">        inflateWithThreadPool(context, item);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private void onAsyncInflateReady(AsyncInflateItem item) {</span><br><span class="line">       ...</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private void onAsyncInflateStart(AsyncInflateItem item) {</span><br><span class="line">        ...</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private void onAsyncInflateEnd(AsyncInflateItem item, boolean success) {</span><br><span class="line">        item.setInflating(false);</span><br><span class="line">        CountDownLatch latch = mInflateLatchMap.get(item.inflateKey);</span><br><span class="line">        if (latch != null) {</span><br><span class="line">            //&#x91CA;&#x653E;&#x9501;</span><br><span class="line">            latch.countDown();</span><br><span class="line">        }</span><br><span class="line">        ...</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private void removeInflateKey(String inflateKey) {</span><br><span class="line">        ...</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private void inflateWithThreadPool(Context context, AsyncInflateItem item) {</span><br><span class="line">        mThreadPool.execute(new Runnable() {</span><br><span class="line">            @Override</span><br><span class="line">            public void run() {</span><br><span class="line">                if (!item.isInflating() &amp;&amp; !item.isCancelled()) {</span><br><span class="line">                    try {</span><br><span class="line">                        onAsyncInflateStart(item);</span><br><span class="line">                        item.inflatedView = new BasicInflater(context).inflate(item.layoutResId, item.parent, false);</span><br><span class="line">                        onAsyncInflateEnd(item, true);</span><br><span class="line">                    } catch (RuntimeException e) {</span><br><span class="line">                        Log.e(TAG, &quot;Failed to inflate resource in the background! Retrying on the UI thread&quot;, e);</span><br><span class="line">                        onAsyncInflateEnd(item, false);</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * copy from AsyncLayoutInflater - actual inflater</span><br><span class="line">     */</span><br><span class="line">    private static class BasicInflater extends LayoutInflater {</span><br><span class="line">        private static final String[] sClassPrefixList = new String[]{&quot;android.widget.&quot;, &quot;android.webkit.&quot;, &quot;android.app.&quot;};</span><br><span class="line"></span><br><span class="line">        BasicInflater(Context context) {</span><br><span class="line">            super(context);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        public LayoutInflater cloneInContext(Context newContext) {</span><br><span class="line">            return new BasicInflater(newContext);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        protected View onCreateView(String name, AttributeSet attrs) throws ClassNotFoundException {</span><br><span class="line">            for (String prefix : sClassPrefixList) {</span><br><span class="line">                try {</span><br><span class="line">                    View view = this.createView(name, prefix, attrs);</span><br><span class="line">                    if (view != null) {</span><br><span class="line">                        return view;</span><br><span class="line">                    }</span><br><span class="line">                } catch (ClassNotFoundException ignored) {</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            return super.onCreateView(name, attrs);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x8FD9;&#x91CC;&#x6211;&#x7528;&#x4E00;&#x4E2A;AsyncInflateItem&#x6765;&#x7BA1;&#x7406;&#x4E00;&#x6B21;&#x8981;inflate&#x7684;&#x4E00;&#x4E2A;&#x5355;&#x4F4D;&#xFF0C;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">arduino&#x590D;&#x5236;&#x4EE3;&#x7801;/**</span><br><span class="line"> * @author zoutao</span><br><span class="line"> */</span><br><span class="line">public class AsyncInflateItem {</span><br><span class="line">    String inflateKey;</span><br><span class="line">    int layoutResId;</span><br><span class="line">    ViewGroup parent;</span><br><span class="line">    OnInflateFinishedCallback callback;</span><br><span class="line">    View inflatedView;</span><br><span class="line"></span><br><span class="line">    private boolean cancelled;</span><br><span class="line">    private boolean inflating;</span><br><span class="line"></span><br><span class="line">    //&#x8FD8;&#x6709;&#x4E00;&#x4E9B;set get&#x65B9;&#x6CD5;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x4EE5;&#x53CA;&#x6700;&#x540E;inflate&#x7684;&#x56DE;&#x8C03;callback&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">csharp&#x590D;&#x5236;&#x4EE3;&#x7801;public interface OnInflateFinishedCallback {</span><br><span class="line">    void onInflateFinished(AsyncInflateItem result);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x7ECF;&#x8FC7;&#x8FD9;&#x6837;&#x7684;&#x5C01;&#x88C5;&#xFF0C;&#x5916;&#x9762;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5728;Application&#x7684;onCreate&#x4E2D;&#xFF0C;&#x5F00;&#x59CB;&#x5F02;&#x6B65;&#x7684;inflate view&#x7684;&#x4EFB;&#x52A1;&#x3002;&#x8C03;&#x7528;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">java&#x590D;&#x5236;&#x4EE3;&#x7801;AsyncInflateUtil.startTask();</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author zoutao</span><br><span class="line"> */</span><br><span class="line">public class AsyncInflateUtil {</span><br><span class="line">    public static void startTask() {</span><br><span class="line">        Context context = new MutableContextWrapper(CommonContext.getApplication());</span><br><span class="line">        AsyncInflateManager.getInstance().asyncInflateViews(context,</span><br><span class="line">                new AsyncInflateItem(InflateKey.TAB_1_CONTAINER_FRAGMENT, R.layout.fragment_main),</span><br><span class="line">                new AsyncInflateItem(InflateKey.SUB_TAB_1_FRAGMENT, R.layout.fragment_load_list),</span><br><span class="line">                new AsyncInflateItem(InflateKey.SUB_TAB_2_FRAGMENT, R.layout.fragment_load_list),</span><br><span class="line">                new AsyncInflateItem(InflateKey.SUB_TAB_3_FRAGMENT, R.layout.fragment_load_list),</span><br><span class="line">                new AsyncInflateItem(InflateKey.SUB_TAB_4_FRAGMENT, R.layout.fragment_load_list));</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public class InflateKey {</span><br><span class="line">        public static final String TAB_1_CONTAINER_FRAGMENT = &quot;tab1&quot;;</span><br><span class="line">        public static final String SUB_TAB_1_FRAGMENT = &quot;sub1&quot;;</span><br><span class="line">        public static final String SUB_TAB_2_FRAGMENT = &quot;sub2&quot;;</span><br><span class="line">        public static final String SUB_TAB_3_FRAGMENT = &quot;sub3&quot;;</span><br><span class="line">        public static final String SUB_TAB_4_FRAGMENT = &quot;sub4&quot;;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p><strong>&#x6CE8;&#x610F;&#xFF1A;&#x8FD9;&#x91CC;&#x4F1A;&#x6709;&#x4E00;&#x4E2A;&#x5751;&#x3002;&#x5C31;&#x662F;&#x5728;Application&#x7684;onCreate&#x4E2D;&#xFF0C;&#x80FD;&#x62FF;&#x5230;&#x7684;Context&#x53EA;&#x6709;Application&#xFF0C;&#x8FD9;&#x6837;inflate&#x7684;View&#xFF0C;View&#x6301;&#x6709;&#x7684;Context&#x5C31;&#x662F;Application&#xFF0C;&#x8FD9;&#x4F1A;&#x5BFC;&#x81F4;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#x3002;</strong></p>
<p>&#x5982;&#x679C;&#x7528;View.getContext()&#x8FD9;&#x4E2A;context&#x53BB;&#x8FDB;&#x884C;Activity&#x7684;&#x8DF3;&#x8F6C;&#x5C31;&#x4F1A;&#x3002;&#x3002;&#x629B;&#x5F02;&#x5E38;</p>
<blockquote>
<p>Calling startActivity() from outside of an Activity context requires the FLAG_ACTIVITY_NEW_TASK flag. Is this really what you want?</p>
</blockquote>
<p>&#x800C;&#x5982;&#x679C;&#x60F3;&#x8981;&#x4F20;&#x5165;Activity&#x6765;&#x521B;&#x5EFA;LayoutInflater&#xFF0C;&#x65F6;&#x673A;&#x53C8;&#x592A;&#x665A;&#x3002;&#x4F17;&#x6240;&#x5468;&#x77E5;&#xFF0C;Context&#x662F;&#x4E00;&#x4E2A;&#x62BD;&#x8C61;&#x7C7B;&#xFF0C;&#x5B9E;&#x73B0;&#x5B83;&#x7684;&#x5305;&#x88C5;&#x7C7B;&#x5C31;&#x662F;ContextWrapper&#xFF0C;&#x800C;Activity&#x3001;Appcation&#x7B49;&#x90FD;&#x662F;ContextWrapper&#x7684;&#x5B50;&#x7C7B;&#xFF0C;&#x7136;&#x800C;&#xFF0C;ContextWrapper&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x795E;&#x5947;&#x7684;&#x5B50;&#x7C7B;&#xFF0C;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">scala&#x590D;&#x5236;&#x4EE3;&#x7801;package android.content;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Special version of {@link ContextWrapper} that allows the base context to</span><br><span class="line"> * be modified after it is initially set.</span><br><span class="line"> */</span><br><span class="line">public class MutableContextWrapper extends ContextWrapper {</span><br><span class="line">    public MutableContextWrapper(Context base) {</span><br><span class="line">        super(base);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * Change the base context for this ContextWrapper. All calls will then be</span><br><span class="line">     * delegated to the base context.  Unlike ContextWrapper, the base context</span><br><span class="line">     * can be changed even after one is already set.</span><br><span class="line">     * </span><br><span class="line">     * @param base The new base context for this wrapper.</span><br><span class="line">     */</span><br><span class="line">    public void setBaseContext(Context base) {</span><br><span class="line">        mBase = base;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<h3 id="6-3-&#x88C5;&#x9970;&#x5668;&#x6A21;&#x5F0F;"><a href="#6-3-&#x88C5;&#x9970;&#x5668;&#x6A21;&#x5F0F;" class="headerlink" title="6.3 &#x88C5;&#x9970;&#x5668;&#x6A21;&#x5F0F;"></a>6.3 &#x88C5;&#x9970;&#x5668;&#x6A21;&#x5F0F;</h3><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;Android&#x4E0A;Context&#x7684;&#x8BBE;&#x8BA1;&#x91C7;&#x7528;&#x4E86;&#x88C5;&#x9970;&#x5668;&#x6A21;&#x5F0F;&#xFF0C;&#x88C5;&#x9970;&#x5668;&#x6A21;&#x5F0F;&#x6781;&#x5927;&#x7A0B;&#x5EA6;&#x7684;&#x63D0;&#x9AD8;&#x4E86;&#x7075;&#x6D3B;&#x6027;&#x3002;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x5BF9;&#x6211;&#x6700;&#x5927;&#x7684;&#x611F;&#x53D7;&#x5C31;&#x662F;&#xFF0C;<strong>&#x5F53;&#x5B98;&#x65B9;&#x6CA1;&#x6709;&#x63D0;&#x4F9B;MutableContextWrapper&#x8FD9;&#x4E2A;&#x7C7B;&#x65F6;&#xFF0C;&#x5176;&#x5B9E;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x4E5F;&#x5B8C;&#x5168;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x540C;&#x6837;&#x7684;&#x65B9;&#x5F0F;&#x53BB;&#x8FDB;&#x884C;&#x5B9E;&#x73B0;&#x3002;&#x601D;&#x7EF4;&#x4E00;&#x5B9A;&#x8981;&#x7075;&#x6D3B;~</strong></p>
<h2 id="&#x4E03;&#x3001;&#x603B;&#x7ED3;"><a href="#&#x4E03;&#x3001;&#x603B;&#x7ED3;" class="headerlink" title="&#x4E03;&#x3001;&#x603B;&#x7ED3;"></a>&#x4E03;&#x3001;&#x603B;&#x7ED3;</h2><p>&#x5E38;&#x89C1;&#x7684;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x4F18;&#x5316;&#x7684;&#x65B9;&#x6848;&#x6709;&#xFF1A;</p>
<ul>
<li>&#x6570;&#x636E;&#x61D2;&#x52A0;&#x8F7D;&#xFF0C;&#x6BD4;&#x5982;Fragment&#x7528;&#x6237;&#x4E0D;&#x53EF;&#x89C1;&#x65F6;&#x4E0D;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x7684;&#x83B7;&#x53D6;</li>
<li>&#x4F18;&#x5316;&#x5E03;&#x5C40;&#x5C42;&#x7EA7;&#xFF0C;&#x51CF;&#x5C11;&#x9996;&#x6B21;inflate layout&#x7684;&#x8017;&#x65F6;</li>
<li>&#x5C06;&#x7EDD;&#x5927;&#x90E8;&#x5206;sdk&#x7684;&#x521D;&#x59CB;&#x5316;&#x653E;&#x7EBF;&#x7A0B;&#x6C60;&#x4E2D;&#x8FD0;&#x884C;</li>
<li>&#x80FD;&#x7528;ViewStub&#x7684;&#x5C31;&#x7528;ViewStub&#xFF0C;&#x6309;&#x9700;&#x52A0;&#x8F7D;layout</li>
<li>&#x4E00;&#x5B9A;&#x8981;&#x5C3D;&#x91CF;&#x907F;&#x514D;&#x542F;&#x52A8;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x51FA;&#x73B0;&#x7684;&#x4E3B;&#x7EBF;&#x7A0B;&#x53BB;unpack&#x4E00;&#x4E9B;&#x5168;&#x5C40;&#x914D;&#x7F6E;&#x7684;&#x6570;&#x636E;</li>
<li>&#x4E0D;&#x4EC5;&#x4EC5;&#x662F;&#x4E09;&#x65B9;&#x5E93;&#x53EF;&#x4EE5;&#x653E;&#x5B50;&#x7EBF;&#x7A0B;&#x8FDB;&#x884C;&#xFF0C;&#x4E00;&#x4E9B;&#x65F6;&#x6548;&#x6027;&#x8981;&#x6C42;&#x6CA1;&#x90A3;&#x4E48;&#x9AD8;&#x7684;&#x903B;&#x8F91;&#x90FD;&#x53EF;&#x4EE5;&#x653E;&#x5B50;&#x7EBF;&#x7A0B;</li>
</ul>
<p>&#x8FD9;&#x4E9B;&#x90FD;&#x53EF;&#x4EE5;&#x5728;&#x7F51;&#x4E0A;&#x627E;&#x5230;&#x5927;&#x91CF;&#x7684;&#x6587;&#x7AE0;&#x4EE5;&#x53CA;&#x5404;&#x4E2A;&#x5927;&#x4F6C;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x6848;&#x3002;</p>
<p>&#x9996;&#x5148;&#xFF0C;&#x4F18;&#x5316;&#x7684;&#x5927;&#x65B9;&#x5411;&#x80AF;&#x5B9A;&#x5148;&#x5B9A;&#x597D;&#xFF1A;</p>
<ol>
<li>&#x61D2;&#x52A0;&#x8F7D;</li>
<li>&#x9884;&#x52A0;&#x8F7D;</li>
</ol>
<p>&#x61D2;&#x52A0;&#x8F7D;&#xFF1A;</p>
<ul>
<li>&#x9996;&#x5C4F;&#x52A0;&#x8F7D;&#x65F6;&#xFF0C;&#x53EA;&#x5F80;ViewPager&#x4E2D;&#x585E;&#x5165;&#x9ED8;&#x8BA4;&#x8981;&#x5C55;&#x793A;&#x7684;tab&#xFF0C;&#x5269;&#x4F59;&#x7684;tab&#x7528;&#x7A7A;&#x7684;&#x5360;&#x4F4D;Fragment&#x4EE3;&#x66FF;</li>
<li>&#x5F53;&#x7528;&#x6237;&#x6ED1;&#x52A8;&#x5230;&#x5176;&#x4ED6;tab&#x65F6;&#xFF0C;&#x6BD4;&#x5982;&#x6ED1;&#x52A8;&#x5230;&#x597D;&#x53CB;&#x52A8;&#x6001;tab&#xFF0C;&#x5C31;&#x7528;FriendFragment&#x628A;&#x5F53;&#x524D;&#x7684;EmptyPlaceholderFragment&#x66FF;&#x6362;&#x6389;&#xFF0C;&#x7136;&#x540E;adapter.notifyDataSetChanged</li>
<li>&#x5F53;&#x56DB;&#x4E2A;Tab&#x5168;&#x90E8;&#x66FF;&#x6362;&#x4E3A;&#x6570;&#x636E;tab&#x65F6;&#xFF0C;&#x6E05;&#x9664;&#x6389;EmptyFragment&#x7684;&#x5F15;&#x7528;&#xFF0C;&#x91CA;&#x653E;&#x5185;&#x5B58;</li>
</ul>
<p>&#x9884;&#x52A0;&#x8F7D;&#xFF1A;</p>
<ul>
<li>Application onCreate&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x9488;&#x5BF9;&#x540E;&#x7EED;&#x6240;&#x6709;&#x7684;Fragment&#xFF0C;&#x5728;&#x5B50;&#x7EBF;&#x7A0B;&#x4E2D;&#x5C06;Layout&#x5148;&#x7ED9;inflate&#x51FA;&#x6765;</li>
<li>&#x9488;&#x5BF9;inflate&#x5B8C;&#x6210;&#x7684;View&#x52A0;&#x5165;&#x4E00;&#x5957;&#x7F13;&#x5B58;&#x7684;&#x5B58;&#x53D6;&#x673A;&#x5236;&#xFF0C;&#x4EE5;&#x53CA;&#x7B49;&#x5F85;&#x673A;&#x5236;</li>
<li>&#x5982;&#x679C;&#x6B63;&#x5728;inflate&#xFF0C;&#x5219;&#x8FDB;&#x884C;&#x963B;&#x585E;&#x7B49;&#x5F85;</li>
<li>&#x5982;&#x679C;&#x5DF2;&#x7ECF;inflate&#x5B8C;&#x6210;&#x4E86;&#xFF0C;&#x53D6;&#x51FA;view&#xFF0C;&#x5E76;&#x91CA;&#x653E;&#x7F13;&#x5B58;&#x5BF9;&#x4E8E;View&#x7684;&#x5F15;&#x7528;</li>
<li>&#x5982;&#x679C;&#x8FD8;&#x6CA1;&#x6709;&#x5F00;&#x59CB;Inflate&#xFF0C;&#x5219;&#x5728;UI&#x7EBF;&#x7A0B;&#x76F4;&#x63A5;&#x8FDB;&#x884C;inflate</li>
</ul>
<p><strong>&#x8FD9;&#x4E9B;&#x65B9;&#x6848;&#x4E0D;&#x4E00;&#x5B9A;&#x975E;&#x5E38;&#x597D;&#x4F7F;&#xFF0C;&#x6240;&#x4EE5;&#x4EC5;&#x4F9B;&#x53C2;&#x8003;<del>~</del></strong></p>
<p>&#x4ECE;ContextWrapper&#x3001;MutableContextWrapper&#x7C7B;&#x7684;&#x8BBE;&#x8BA1;&#x4E2D;&#x5B66;&#x5230;&#x4E86;  &#x2193;</p>
<h2 id="&#x5199;&#x4EE3;&#x7801;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x9996;&#x5148;&#x8981;&#x8FDB;&#x884C;&#x8BBE;&#x8BA1;&#xFF0C;&#x9009;&#x7528;&#x6700;&#x5408;&#x9002;&#x7684;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#xFF0C;&#x8FD9;&#x6837;&#x540E;&#x7EED;&#x8D5A;&#x5230;&#x7684;&#x8FDC;&#x8FDC;&#x5927;&#x4E8E;&#x5199;&#x4E00;&#x4E2A;&#x6587;&#x6863;&#x3001;&#x60F3;&#x4E00;&#x4E2A;&#x8BBE;&#x8BA1;&#x6240;&#x8017;&#x8D39;&#x7684;&#x65F6;&#x95F4;&#x548C;&#x8111;&#x529B;&#x6210;&#x672C;"><a href="#&#x5199;&#x4EE3;&#x7801;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x9996;&#x5148;&#x8981;&#x8FDB;&#x884C;&#x8BBE;&#x8BA1;&#xFF0C;&#x9009;&#x7528;&#x6700;&#x5408;&#x9002;&#x7684;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#xFF0C;&#x8FD9;&#x6837;&#x540E;&#x7EED;&#x8D5A;&#x5230;&#x7684;&#x8FDC;&#x8FDC;&#x5927;&#x4E8E;&#x5199;&#x4E00;&#x4E2A;&#x6587;&#x6863;&#x3001;&#x60F3;&#x4E00;&#x4E2A;&#x8BBE;&#x8BA1;&#x6240;&#x8017;&#x8D39;&#x7684;&#x65F6;&#x95F4;&#x548C;&#x8111;&#x529B;&#x6210;&#x672C;" class="headerlink" title="&#x5199;&#x4EE3;&#x7801;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x9996;&#x5148;&#x8981;&#x8FDB;&#x884C;&#x8BBE;&#x8BA1;&#xFF0C;&#x9009;&#x7528;&#x6700;&#x5408;&#x9002;&#x7684;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#xFF0C;&#x8FD9;&#x6837;&#x540E;&#x7EED;&#x8D5A;&#x5230;&#x7684;&#x8FDC;&#x8FDC;&#x5927;&#x4E8E;&#x5199;&#x4E00;&#x4E2A;&#x6587;&#x6863;&#x3001;&#x60F3;&#x4E00;&#x4E2A;&#x8BBE;&#x8BA1;&#x6240;&#x8017;&#x8D39;&#x7684;&#x65F6;&#x95F4;&#x548C;&#x8111;&#x529B;&#x6210;&#x672C;"></a>&#x5199;&#x4EE3;&#x7801;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x9996;&#x5148;&#x8981;&#x8FDB;&#x884C;&#x8BBE;&#x8BA1;&#xFF0C;&#x9009;&#x7528;&#x6700;&#x5408;&#x9002;&#x7684;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#xFF0C;&#x8FD9;&#x6837;&#x540E;&#x7EED;&#x8D5A;&#x5230;&#x7684;&#x8FDC;&#x8FDC;&#x5927;&#x4E8E;&#x5199;&#x4E00;&#x4E2A;&#x6587;&#x6863;&#x3001;&#x60F3;&#x4E00;&#x4E2A;&#x8BBE;&#x8BA1;&#x6240;&#x8017;&#x8D39;&#x7684;&#x65F6;&#x95F4;&#x548C;&#x8111;&#x529B;&#x6210;&#x672C;</h2><p><img src="https://gitee.com/songjianzaina/juejin_p2/raw/master/img/905f443e925cc63f21af9e9cd48f947023bd31d929041aa34773936d347ad6c0" alt></p>
<p><strong>&#x6211;&#x7684;&#x7B80;&#x4E66; <a href="/external_links/f2aaac8b595386986ebb09814f5930be.html" target="blank" rel="noopener">&#x90B9;&#x554A;&#x6D9B;&#x6D9B;&#x6D9B;&#x7684;&#x7B80;&#x4E66;</a></strong></p>
<p><strong>&#x6211;&#x7684;CSDN</strong> <strong><a href="/external_links/3d7b9c9f5199f309316bc30af805c170.html" target="blank" rel="noopener">&#x90B9;&#x554A;&#x6D9B;&#x6D9B;&#x6D9B;&#x7684;CSDN</a></strong></p>
<p><strong>&#x6211;&#x7684;&#x6398;&#x91D1; <a href="/external_links/6e6ffa19872c648cc288f487cbf401dc.html" target="blank" rel="noopener">&#x90B9;&#x554A;&#x6D9B;&#x6D9B;&#x6D9B;&#x7684;&#x6398;&#x91D1;</a></strong></p>
<h2 id="&#x4F60;&#x53EF;&#x80FD;&#x611F;&#x5174;&#x8DA3;"><a href="#&#x4F60;&#x53EF;&#x80FD;&#x611F;&#x5174;&#x8DA3;" class="headerlink" title="&#x4F60;&#x53EF;&#x80FD;&#x611F;&#x5174;&#x8DA3;"></a>&#x4F60;&#x53EF;&#x80FD;&#x611F;&#x5174;&#x8DA3;</h2><p><a href="/external_links/b892305c27d5f122cffdeb3c944d003b.html" target="blank" rel="noopener">Android QUIC &#x5B9E;&#x8DF5; - &#x57FA;&#x4E8E; OKHttp &#x6269;&#x5C55;&#x51FA; Cronet &#x62E6;&#x622A;&#x5668; - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/7306692609497546752">Android&#x542F;&#x52A8;&#x4F18;&#x5316;&#x5B9E;&#x8DF5; - &#x79D2;&#x5F00;&#x7387;&#x4ECE;17%&#x63D0;&#x5347;&#x81F3;75% - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/7302982924987039796">&#x5982;&#x4F55;&#x79D1;&#x5B66;&#x7684;&#x8FDB;&#x884C;Android&#x5305;&#x4F53;&#x79EF;&#x4F18;&#x5316; - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/7297035708429598754">Android&#x7A33;&#x5B9A;&#x6027;&#xFF1A;Looper&#x515C;&#x5E95;&#x6846;&#x67B6;&#x5B9E;&#x73B0;&#x7EBF;&#x4E0A;&#x5BB9;&#x707E;&#xFF08;&#x4E8C;&#xFF09; - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/7288178532861755432">&#x57FA;&#x4E8E; Booster ASM API&#x7684;&#x914D;&#x7F6E;&#x5316; hook &#x65B9;&#x6848;&#x5C01;&#x88C5; - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/7287241480770076687">&#x8BB0; AndroidStudio Tracer&#x5DE5;&#x5177;&#x5BFC;&#x81F4;&#x7684;&#x7F16;&#x8BD1;&#x5931;&#x8D25; - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/7280864416555860003">Android &#x542F;&#x52A8;&#x4F18;&#x5316;&#x6848;&#x4F8B;-WebView&#x975E;&#x9884;&#x671F;&#x521D;&#x59CB;&#x5316;&#x6392;&#x67E5; - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/7274430147126280207">chromium-net - &#x8DDF;&#x968F; Cronet &#x7684;&#x811A;&#x6B65;&#x63A2;&#x7D22;&#x5927;&#x81F4;&#x6D41;&#x7A0B;&#xFF08;1&#xFF09; - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/7198466997288566842">Android&#x7A33;&#x5B9A;&#x6027;&#xFF1A;&#x53EF;&#x8FDC;&#x7A0B;&#x914D;&#x7F6E;&#x5316;&#x7684;Looper&#x515C;&#x5E95;&#x6846;&#x67B6; - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/7141301214523686926">&#x4E00;&#x7C7B;&#x6709;&#x8DA3;&#x7684;&#x65E0;&#x9650;&#x7F13;&#x5B58;OOM&#x73B0;&#x8C61; - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/6844903924965572615">Android - &#x4E00;&#x79CD;&#x65B0;&#x5947;&#x7684;&#x51B7;&#x542F;&#x52A8;&#x901F;&#x5EA6;&#x4F18;&#x5316;&#x601D;&#x8DEF;(Fragment&#x6781;&#x5EA6;&#x61D2;&#x52A0;&#x8F7D; + Layout&#x5B50;&#x7EBF;&#x7A0B;&#x9884;&#x52A0;&#x8F7D;) - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><a href="https://dev.newban.cn/6844903923745030158">Android - &#x5F7B;&#x5E95;&#x6D88;&#x706D;OOM&#x7684;&#x5B9E;&#x6218;&#x7ECF;&#x9A8C;&#x5206;&#x4EAB;&#xFF08;&#x5343;&#x5206;&#x4E4B;1.5 -&gt; &#x4E07;&#x5206;&#x4E4B;0.2&#xFF09; - &#x6398;&#x91D1; (juejin.cn)</a></p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/13f852a7d40e5660b69e70945274d07f.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="tags/性能优化/" rel="tag"># 性能优化</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="6844903923745030158.html" rel="next" title="Android - 彻底消灭OOM的实战经验分享（千分之1">
                <i class="fa fa-chevron-left"></i> Android - 彻底消灭OOM的实战经验分享（千分之1
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="6844903930183286791.html" rel="prev" title="Flutter完整开发实战详解(十七、 实用技巧与填坑二)">
                Flutter完整开发实战详解(十七、 实用技巧与填坑二) <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


    <!-- 有瓣音频文章内嵌广告 -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-2626449904708114" data-ad-slot="6145016388"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

    <div class="post-spread">
      
    </div>
  </div>
  <!-- 有瓣音频信息流广告 -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle" style="display:block" data-ad-format="fluid" data-ad-layout-key="-6t+ed+2i-1n-4w" data-ad-client="ca-pub-2626449904708114" data-ad-slot="6455528644"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">开发者博客</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="https://dev.newban.cn/archives/">
              
                  <span class="site-state-item-count">990</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">399</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#一、背景"><span class="nav-number">1.</span> <span class="nav-text">一、背景</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#二、特意声明"><span class="nav-number">2.</span> <span class="nav-text">二、特意声明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#三、最常见的优化方案"><span class="nav-number">3.</span> <span class="nav-text">三、最常见的优化方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#四、项目结构"><span class="nav-number">4.</span> <span class="nav-text">四、项目结构</span></a></li></ol><li class="nav-item nav-level-2"><a class="nav-link" href="#五、极致的懒加载"><span class="nav-number"></span> <span class="nav-text">五、极致的懒加载</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-极致的懒加载"><span class="nav-number">1.</span> <span class="nav-text">5.1 极致的懒加载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-懒加载方案"><span class="nav-number">2.</span> <span class="nav-text">5.2 懒加载方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-FragmentPagerAdapter与FragmentStatePagerAdapter"><span class="nav-number">3.</span> <span class="nav-text">5.3 FragmentPagerAdapter与FragmentStatePagerAdapter</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-4-FragmentPagerAdapter的刷新问题"><span class="nav-number">4.</span> <span class="nav-text">5.4 FragmentPagerAdapter的刷新问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-5-FragmentPagerAdapter刷新的正确姿势"><span class="nav-number">5.</span> <span class="nav-text">5.5 FragmentPagerAdapter刷新的正确姿势</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#六、神奇的的预加载（预加载View，而不是data）"><span class="nav-number"></span> <span class="nav-text">六、神奇的的预加载（预加载View，而不是data）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-需要预加载什么"><span class="nav-number">1.</span> <span class="nav-text">6.1 需要预加载什么</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-修改AsyncLayoutInflater"><span class="nav-number">2.</span> <span class="nav-text">6.2 修改AsyncLayoutInflater</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3-装饰器模式"><span class="nav-number">3.</span> <span class="nav-text">6.3 装饰器模式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#七、总结"><span class="nav-number"></span> <span class="nav-text">七、总结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#写代码的时候，首先要进行设计，选用最合适的设计模式，这样后续赚到的远远大于写一个文档、想一个设计所耗费的时间和脑力成本"><span class="nav-number"></span> <span class="nav-text">写代码的时候，首先要进行设计，选用最合适的设计模式，这样后续赚到的远远大于写一个文档、想一个设计所耗费的时间和脑力成本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#你可能感兴趣"><span class="nav-number"></span> <span class="nav-text">你可能感兴趣</span></a></li></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">开发者博客</span>
  <div>
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
  </div>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




  <script type="text/javascript" async src="js/src/mermaid.min.js"></script>
  <script>
  if (window.mermaid) {
        var mermaid_config = {
            startOnLoad: true,
            theme: 'default',
            flowchart:{
                useMaxWidth: false,
                htmlLabels: true
            }                
        }
        mermaid.initialize(mermaid_config);
  }
  </script>
  

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
