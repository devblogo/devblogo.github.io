<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">
<meta name="referrer" content="never">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Python,">





  <link rel="alternate" href="atom.xml" title="开发者博客 – IT技术 尽在开发者博客" type="application/atom+xml">






<meta name="description" content="Scraping Russian Twitter Trolls With Python, Neo4j, and GraphQL 12 Nov 2017  Last week as a result of the House Intelligence Select Committee investigation, Twitter released the screen names of 2752 T">
<meta name="keywords" content="Python">
<meta property="og:type" content="article">
<meta property="og:title" content="使用Python、Neo4j和GraphQL，爬取俄罗斯Tw">
<meta property="og:url" content="https://dev.newban.cn/6844903512036343816.html">
<meta property="og:site_name" content="开发者博客 – IT技术 尽在开发者博客">
<meta property="og:description" content="Scraping Russian Twitter Trolls With Python, Neo4j, and GraphQL 12 Nov 2017  Last week as a result of the House Intelligence Select Committee investigation, Twitter released the screen names of 2752 T">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/f16b3e3a987d2088ebd7a86a648c415b164dd354b87f0d0397b0d1edfb7604b6">
<meta property="og:image" content="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/f645765ee732d37f61f572030e5ba9f1f901b789350e1c4e7c1966125f969f4b">
<meta property="og:image" content="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/8737f5b99decfa1e499c6a3aaa33d34f7adae721710a4e8a799fba7797d2bf5f">
<meta property="og:image" content="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/0835b6ce5c18215e2eca8ed64ca8e5741786219c53a0257a00972d74ffaea7f7">
<meta property="og:image" content="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/7aaa32edc57c456775db5a1100d55abe3b44cfdccdfa21b2eba7b4d484b3d18a">
<meta property="og:image" content="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/ad1d705468897d539d212b903116a3554031beb5bf2c05360006db959e03daee">
<meta property="og:image" content="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/0f80881882cd6f10336890f7e8d0621c9a029512bc1aee8c3165e9840e8e6c8c">
<meta property="og:updated_time" content="2024-04-28T05:28:43.439Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="使用Python、Neo4j和GraphQL，爬取俄罗斯Tw">
<meta name="twitter:description" content="Scraping Russian Twitter Trolls With Python, Neo4j, and GraphQL 12 Nov 2017  Last week as a result of the House Intelligence Select Committee investigation, Twitter released the screen names of 2752 T">
<meta name="twitter:image" content="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/f16b3e3a987d2088ebd7a86a648c415b164dd354b87f0d0397b0d1edfb7604b6">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>
<!--谷歌广告验证代码-->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-2626449904708114",
          enable_page_level_ads: true
     });
</script>
<!--谷歌广告验证代码-->



  <link rel="canonical" href="https://dev.newban.cn/6844903512036343816.html">





  <title>使用Python、Neo4j和GraphQL，爬取俄罗斯Tw | 开发者博客 – IT技术 尽在开发者博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">开发者博客 – IT技术 尽在开发者博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">开发者博客 – 科技是第一生产力</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="http://dev.newban.cn/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="https://dev.newban.cn/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dev.newban.cn">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者博客">
      <meta itemprop="description" content>
      <meta itemprop="image" content="images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客 – IT技术 尽在开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">使用Python、Neo4j和GraphQL，爬取俄罗斯Tw</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-17T14:54:14+08:00">
                2017-11-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Scraping-Russian-Twitter-Trolls-With-Python-Neo4j-and-GraphQL"><a href="#Scraping-Russian-Twitter-Trolls-With-Python-Neo4j-and-GraphQL" class="headerlink" title="Scraping Russian Twitter Trolls With Python, Neo4j, and GraphQL"></a>Scraping Russian Twitter Trolls With Python, Neo4j, and GraphQL</h1><p> 12 Nov 2017<br> <img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/f16b3e3a987d2088ebd7a86a648c415b164dd354b87f0d0397b0d1edfb7604b6" alt></p>
<p>Last week as a result of the House Intelligence Select Committee investigation, Twitter released the screen names of <a href="/external_links/0a09dff5f75609b82709588f7cc074a3.html" target="blank" rel="noopener">2752 Twitter accounts</a> tied to <a href="/external_links/7cafe0578b143ea76f08710c1c077bb2.html" target="blank" rel="noopener">Russia&#x2019;s Internet Research Agency</a> that were involved in spreading fake news, presumably with the goal of influencing the 2016 election. In this post we explore how to scrape tweets from the user pages of cached versions of these pages, import into Neo4j for analysis, and how to<br> build a simple GraphQL API exposing this data through GraphQL.</p>
<h1 id="Russian-Twitter-Trolls"><a href="#Russian-Twitter-Trolls" class="headerlink" title="Russian Twitter Trolls"></a>Russian Twitter Trolls</h1><p>While Twitter released the screen names and user ids of these accounts, they did not release any data (such as tweets or follower network information) associated with the accounts. In fact, Twitter has suspended these accounts which means their tweets<br> have been removed from Twitter.com and are no longer accessible through the Twitter API. Analyzing the tweets made by these accounts is the first step in understanding how social media accounts run by Russia may have been used to influence the<br> US Election. So our first step is simply to find potential sources for the data.</p>
<h1 id="Internet-Archive"><a href="#Internet-Archive" class="headerlink" title="Internet Archive"></a>Internet Archive</h1><p><a href="/external_links/8db2ad377756ccb2736884314f23c288.html" target="blank" rel="noopener">Internet Archive</a> is a non-profit library that provides cached version of some websites: a snapshot of a webpage at a given point in time that can be viewed later. One option for obtaining some of the Russian Troll<br> tweets is by using Internet Archive to find any Twitter user pages that may have been cached by Internet Archive.</p>
<p>For example, if you visit <a href="/external_links/9d7db5f135b6f3877243c23ce6e74256.html" target="blank" rel="noopener">web.archive.org/web/2017081&#x2026;</a> we can see the Twitter page for @TEN_GOP, one of the Russia Troll accounts<br> that was designed to look like an account associated with the Tennessee Republican party.</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/f645765ee732d37f61f572030e5ba9f1f901b789350e1c4e7c1966125f969f4b" alt></p>
<p>This snapshot page contains several of @TEN_GOP&#x2019;s most recent tweets (before the snapshot was taken by Internet Archive).</p>
<h2 id="Finding-Available-Cached-Pages"><a href="#Finding-Available-Cached-Pages" class="headerlink" title="Finding Available Cached Pages"></a>Finding Available Cached Pages</h2><p>Using the screen names provided by the House Intelligence Committee we can use Internet Archive&#x2019;s Wayback API to see if the user&#x2019;s Twitter profile page was cached by Internet Archive at any point in time. We&#x2019;ll write a simple Python script to iterate<br> through the list of Russian Troll twitter accounts, checking the Wayback API for any available cached pages.</p>
<p>We can do this by making a request to <code>http://archive.org/wayback/available?url=http://twitter.com/TWITTER_SCREEN_NAME_HERE</code>. This will return the url and timestamp of any caches made, if they exist. So we iterate through the list of twitter<br> screen names, checking the Wayback API for any available caches.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;import requests</span><br><span class="line">items = []</span><br><span class="line">initial = &quot;http://archive.org/wayback/available&quot;</span><br><span class="line"># iterate through list of flagged twitter screen names</span><br><span class="line">with open(&apos;./data/twitter_handle_urls.csv&apos;) as f:</span><br><span class="line">    for line in f:</span><br><span class="line">        params = {&apos;url&apos;: line}</span><br><span class="line">        r = requests.get(initial, params=params)</span><br><span class="line">        d = r.json()</span><br><span class="line">        #print(d)</span><br><span class="line">        items.append(d)</span><br><span class="line"># write URL of any available archives to file</span><br><span class="line">with open(&apos;./data/avail_urls.txt&apos;, &apos;w&apos;) as f:</span><br><span class="line">    for item in items:</span><br><span class="line">        if &apos;archived_snapshots&apos; in item:</span><br><span class="line">            if &apos;closest&apos; in item[&apos;archived_snapshots&apos;]:</span><br><span class="line">                f.write(item[&apos;archived_snapshots&apos;][&apos;closest&apos;][&apos;url&apos;] + &apos;\n&apos;)</span><br></pre></td></tr></table></figure>

<p>With this, we end up with a file <code>twitter_handle_urls.csv</code> that contains a list of Internet Archive urls for any of the Russian troll accounts that were archived by Internet Archive. Unfortunately, we only find just over 100 Russia Troll<br> accounts that were cached by Internet Archive. This is just a tiny sample of the overall accounts, but we should still be able to scrape tweets for these 100 users.</p>
<h2 id="Scraping-Twitter-Profile-Pages"><a href="#Scraping-Twitter-Profile-Pages" class="headerlink" title="Scraping Twitter Profile Pages"></a>Scraping Twitter Profile Pages</h2><p>Now, we&#x2019;re ready to scrape the HTML from the Internet Archive caches to extract all the tweet content that we can.</p>
<p>We&#x2019;ll make use of the <code>BeautifulSoup</code> Python package to help us extract the tweet data from the HTML. First, we&#x2019;ll use Chrome devtools to inspect the structure of the HTML, seeing what elements contain the data we&#x2019;re looking for:</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/8737f5b99decfa1e499c6a3aaa33d34f7adae721710a4e8a799fba7797d2bf5f" alt></p>
<p>Since the caches were taken at different times, the structure of the HTML may have changed. We&#x2019;ll need to write code that can handle parsing these different formats. We&#x2019;ve found two versions of the Twitter user pages in the caches. One from ~2015,<br> and one used around ~2016-2017.</p>
<p>Here is the code for scraping the data for one of the versions. The full code is available <a href="/external_links/10679067be3728726cc09aa18f62d183.html" target="blank" rel="noopener">here.</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;import urllib</span><br><span class="line">from bs4 import BeautifulSoup</span><br><span class="line">import csv</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line"># testing for new version</span><br><span class="line"></span><br><span class="line">url = &quot;http://web.archive.org/web/20150603004258/https://twitter.com/AlwaysHungryBae&quot;</span><br><span class="line">page = requests.get(url).text</span><br><span class="line">soup = BeautifulSoup(page, &apos;html.parser&apos;)</span><br><span class="line"></span><br><span class="line">tweets = soup.find_all(&apos;li&apos;, attrs={&apos;data-item-type&apos;: &apos;tweet&apos;})</span><br><span class="line"></span><br><span class="line">for t in tweets:</span><br><span class="line">    tweet_obj = {}</span><br><span class="line">    tweet_obj[&apos;tweet_id&apos;] = t.get(&quot;data-item-id&quot;)</span><br><span class="line">    tweet_container = t.find(&apos;div&apos;, attrs={&apos;class&apos;: &apos;tweet&apos;})</span><br><span class="line">    tweet_obj[&apos;screen_name&apos;] = tweet_container.get(&apos;data-screen-name&apos;)</span><br><span class="line">    tweet_obj[&apos;permalink&apos;] = tweet_container.get(&apos;data-permalink-path&apos;)</span><br><span class="line">    tweet_content = tweet_container.find(&apos;p&apos;, attrs={&apos;class&apos;: &apos;tweet-text&apos;})</span><br><span class="line">    tweet_obj[&apos;tweet_text&apos;] = tweet_content.text</span><br><span class="line">    tweet_obj[&apos;user_id&apos;] = tweet_container.get(&apos;data-user-id&apos;)</span><br><span class="line"></span><br><span class="line">    tweet_time = tweet_container.find(&apos;span&apos;, attrs={&apos;class&apos;: &apos;_timestamp&apos;})</span><br><span class="line">    tweet_obj[&apos;timestamp&apos;] = tweet_time.get(&apos;data-time-ms&apos;)</span><br><span class="line"></span><br><span class="line">    hashtags = tweet_container.find_all(&apos;a&apos;, attrs={&apos;class&apos;: &apos;twitter-hashtag&apos;})</span><br><span class="line">    tweet_obj[&apos;hashtags&apos;] = []</span><br><span class="line">    tweet_obj[&apos;links&apos;] = []</span><br><span class="line"></span><br><span class="line">    for ht in hashtags:</span><br><span class="line">        ht_obj = {}</span><br><span class="line">        ht_obj[&apos;tag&apos;] = ht.find(&apos;b&apos;).text</span><br><span class="line">        ht_obj[&apos;archived_url&apos;] = ht.get(&apos;href&apos;)</span><br><span class="line">        tweet_obj[&apos;hashtags&apos;].append(ht_obj)</span><br><span class="line"></span><br><span class="line">    links = tweet_container.find_all(&apos;a&apos;, attrs={&apos;class&apos;: &apos;twitter-timeline-link&apos;})</span><br><span class="line">    for li in links:</span><br><span class="line">        li_obj = {}</span><br><span class="line">        if li.get(&apos;data-expanded-url&apos;):</span><br><span class="line">            li_obj[&apos;url&apos;] = li.get(&apos;data-expanded-url&apos;)</span><br><span class="line">        elif li.get(&apos;data-resolved-url-large&apos;):</span><br><span class="line">            li_obj[&apos;url&apos;] = li.get(&apos;data-resolved-url-large&apos;)</span><br><span class="line">        else:</span><br><span class="line">            li_obj[&apos;url&apos;] = li.text</span><br><span class="line">        li_obj[&apos;archived_url&apos;] = li.get(&apos;href&apos;)</span><br><span class="line">        tweet_obj[&apos;links&apos;].append(li_obj)</span><br><span class="line"></span><br><span class="line">    print(tweet_obj)</span><br></pre></td></tr></table></figure>

<p>BeautifulSoup allows us to select HTML elements by specifying attributes to match against. By inspecting the structure of the HTML page we can see which bits of the tweets are stored in different HTML elements so we know which to grab with BeautifulSoup.<br> We build up an array of tweet objects as we parse all the tweets on the page.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;</span><br><span class="line">{</span><br><span class="line">  &apos;tweet_id&apos;: &apos;561931644785811457&apos;,</span><br><span class="line">  &apos;screen_name&apos;: &apos;AlwaysHungryBae&apos;,</span><br><span class="line">  &apos;permalink&apos;: &apos;/AlwaysHungryBae/status/561931644785811457&apos;,</span><br><span class="line">   &apos;tweet_text&apos;: &apos;Happy Super Bowl Sunday \n#superbowlfood pic.twitter.com/s6rwMtdLom&apos;,</span><br><span class="line">   &apos;user_id&apos;: &apos;2882130846&apos;,</span><br><span class="line">   &apos;timestamp&apos;: &apos;1422809918000&apos;,</span><br><span class="line">   &apos;hashtags&apos;: [</span><br><span class="line">     {&apos;tag&apos;: &apos;superbowlfood&apos;,</span><br><span class="line">      &apos;archived_url&apos;: &apos;/web/20150603004258/https://twitter.com/hashtag/superbowlfood?src=hash&apos;</span><br><span class="line">      }</span><br><span class="line">   ],</span><br><span class="line">   &apos;links&apos;: [</span><br><span class="line">     {&apos;url&apos;: &apos;pic.twitter.com/s6rwMtdLom&apos;,</span><br><span class="line">      &apos;archived_url&apos;: &apos;http://web.archive.org/web/20150603004258/http://t.co/s6rwMtdLom&apos;</span><br><span class="line">     },</span><br><span class="line">     {&apos;url&apos;: &apos;https://pbs.twimg.com/media/B8xh2fFCQAE-vxU.jpg:large&apos;, &apos;</span><br><span class="line">     archived_url&apos;: &apos;//web.archive.org/web/20150603004258/https://twitter.com/AlwaysHungryBae/status/561931644785811457/photo/1&apos;</span><br><span class="line">     }</span><br><span class="line">   ]</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>Once we&#x2019;ve extracted the tweets we write them to a json file:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;# write tweets to file</span><br><span class="line">import json</span><br><span class="line">with open(&apos;./data/tweets_full.json&apos;, &apos;w&apos;) as f:</span><br><span class="line">    json.dump(tweet_arr, f, ensure_ascii=False, sort_keys=True, indent=4)</span><br></pre></td></tr></table></figure>

<p>We end up finding about 1500 tweets from 187 Twitter accounts. This is only a fraction of the tweets sent by the Russian Trolls, but is still too much data for us to analyze by reading every tweet. We&#x2019;ll make use of the Neo4j graph database to help<br> us make sense of the data. Using Neo4j we&#x2019;ll be able to ask questions such as &#x201C;What hashtags are used together most frequently?&#x201D;, or &#x201C;What are the domains of URLs shared in tweets that mention Trump?&#x201D;.</p>
<h1 id="Importing-Into-Neo4j"><a href="#Importing-Into-Neo4j" class="headerlink" title="Importing Into Neo4j"></a>Importing Into Neo4j</h1><p>Now that we have our scraped tweet data we&#x2019;re ready to insert into Neo4j. We have <a href="/external_links/933a93bfc14aec66502ebcd987365319.html" target="blank" rel="noopener">several options for importing data into Neo4j</a>. We&#x2019;ll do our import by loading the JSON data and<br> passing it as a parameter to a Cypher query, using the Python driver for Neo4j.</p>
<p>We&#x2019;ll use a simple graph data model, treating Hashtags and Links as nodes in the graph, as well as the Tweet and User who posted the tweet.</p>
<p><em>Datamodel</em></p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/0835b6ce5c18215e2eca8ed64ca8e5741786219c53a0257a00972d74ffaea7f7" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;from neo4j.v1 import GraphDatabase</span><br><span class="line">import json</span><br><span class="line"></span><br><span class="line">driver = GraphDatabase.driver(&quot;bolt://localhost:7687&quot;)</span><br><span class="line">with open(&apos;./data/tweets_full.json&apos;) as json_data:</span><br><span class="line">    tweetArr = json.load(json_data)</span><br><span class="line"></span><br><span class="line">import_query = &apos;&apos;&apos;</span><br><span class="line">WITH $tweetArr AS tweets</span><br><span class="line">UNWIND tweets AS tweet</span><br><span class="line">MERGE (u:User {user_id: tweet.user_id})</span><br><span class="line">ON CREATE SET u.screen_name = tweet.screen_name</span><br><span class="line">MERGE (t:Tweet {tweet_id: tweet.tweet_id})</span><br><span class="line">ON CREATE SET t.text = tweet.tweet_text,</span><br><span class="line">              t.permalink = tweet.permalink</span><br><span class="line">MERGE (u)-[:POSTED]-&gt;(t)</span><br><span class="line"></span><br><span class="line">FOREACH (ht IN tweet.hashtags |</span><br><span class="line">  MERGE (h:Hashtag {tag: ht.tag })</span><br><span class="line">  ON CREATE SET h.archived_url = ht.archived_url</span><br><span class="line">  MERGE (t)-[:HAS_TAG]-&gt;(h)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">FOREACH (link IN tweet.links |</span><br><span class="line">  MERGE (l:Link {url: link.url})</span><br><span class="line">  ON CREATE SET l.archived_url = link.archived_url</span><br><span class="line">  MERGE (t)-[:HAS_LINK]-&gt;(l)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line"></span><br><span class="line">def add_tweets(tx):</span><br><span class="line">    tx.run(import_query, tweetArr=tweetArr)</span><br><span class="line"></span><br><span class="line">with driver.session() as session:</span><br><span class="line">    session.write_transaction(add_tweets)</span><br></pre></td></tr></table></figure>

<h2 id="Graph-Queries"><a href="#Graph-Queries" class="headerlink" title="Graph Queries"></a>Graph Queries</h2><p>Now that we have the data in Neo4j we can write queries to help make sense of what the Russian Trolls were tweeting about.</p>
<p><em>Interesting Queries</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// Tweets for @TEN_GOP</span><br><span class="line">MATCH (u:User)-[:POSTED]-&gt;(t:Tweet)-[:HAS_TAG]-&gt;(h:Hashtag)</span><br><span class="line">WHERE u.screen_name = &quot;TEN_GOP&quot;</span><br><span class="line">OPTIONAL MATCH (t)-[:HAS_LINK]-&gt;(l:Link)</span><br><span class="line">RETURN *</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/7aaa32edc57c456775db5a1100d55abe3b44cfdccdfa21b2eba7b4d484b3d18a" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// What are the most common hashtags</span><br><span class="line">MATCH (u:User)-[:POSTED]-&gt;(t:Tweet)-[:HAS_TAG]-&gt;(ht:Hashtag)</span><br><span class="line">RETURN ht.tag AS hashtag, COUNT(*) AS num</span><br><span class="line">ORDER BY num DESC LIMIT 10</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2552;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2564;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2555;</span><br><span class="line">&#x2502;&quot;hashtag&quot;             &#x2502;&quot;num&quot;&#x2502;</span><br><span class="line">&#x255E;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x256A;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2561;</span><br><span class="line">&#x2502;&quot;JugendmitMerkel&quot;     &#x2502;90         &#x2502;</span><br><span class="line">&#x251C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2524;</span><br><span class="line">&#x2502;&quot;TagderJugend&quot;        &#x2502;89         &#x2502;</span><br><span class="line">&#x251C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2524;</span><br><span class="line">&#x2502;&quot;politics&quot;            &#x2502;61         &#x2502;</span><br><span class="line">&#x251C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2524;</span><br><span class="line">&#x2502;&quot;news&quot;                &#x2502;30         &#x2502;</span><br><span class="line">&#x251C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2524;</span><br><span class="line">&#x2502;&quot;sports&quot;              &#x2502;28         &#x2502;</span><br><span class="line">&#x251C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2524;</span><br><span class="line">&#x2502;&quot;Merkel&quot;              &#x2502;26         &#x2502;</span><br><span class="line">&#x251C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2524;</span><br><span class="line">&#x2502;&quot;ColumbianChemicals&quot;  &#x2502;25         &#x2502;</span><br><span class="line">&#x251C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2524;</span><br><span class="line">&#x2502;&quot;WorldElephantDay&quot;    &#x2502;22         &#x2502;</span><br><span class="line">&#x251C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2524;</span><br><span class="line">&#x2502;&quot;crime&quot;               &#x2502;21         &#x2502;</span><br><span class="line">&#x251C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2524;</span><br><span class="line">&#x2502;&quot;UnitedStatesIn3Words&quot;&#x2502;21         &#x2502;</span><br><span class="line">&#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2534;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// What hashtags are used together most frequently</span><br><span class="line">MATCH (h1:Hashtag)&lt;-[:HAS_TAG]-(t:Tweet)-[:HAS_TAG]-&gt;(h2:Hashtag)</span><br><span class="line">WHERE id(h1) &lt; id(h2)</span><br><span class="line">RETURN h1.tag, h2.tag, COUNT(*) AS num ORDER BY num DESC LIMIT 15</span><br><span class="line"></span><br><span class="line">&#x2552;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2564;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2564;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2555;</span><br><span class="line">&#x2502;&quot;h1.tag&quot;         &#x2502;&quot;h2.tag&quot;          &#x2502;&quot;num&quot;&#x2502;</span><br><span class="line">&#x255E;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x256A;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x256A;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2561;</span><br><span class="line">&#x2502;&quot;JugendmitMerkel&quot;&#x2502;&quot;TagderJugend&quot;    &#x2502;89   &#x2502;</span><br><span class="line">&#x251C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2524;</span><br><span class="line">&#x2502;&quot;TagderJugend&quot;   &#x2502;&quot;WorldElephantDay&quot;&#x2502;22   &#x2502;</span><br><span class="line">&#x251C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2524;</span><br><span class="line">&#x2502;&quot;JugendmitMerkel&quot;&#x2502;&quot;WorldElephantDay&quot;&#x2502;22   &#x2502;</span><br><span class="line">&#x251C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2524;</span><br><span class="line">&#x2502;&quot;JugendmitMerkel&quot;&#x2502;&quot;Dschungelk&#xF6;nig&quot;  &#x2502;21   &#x2502;</span><br><span class="line">&#x251C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2524;</span><br><span class="line">&#x2502;&quot;TagderJugend&quot;   &#x2502;&quot;Dschungelk&#xF6;nig&quot;  &#x2502;21   &#x2502;</span><br><span class="line">&#x251C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2524;</span><br><span class="line">&#x2502;&quot;Merkel&quot;         &#x2502;&quot;JugendmitMerkel&quot; &#x2502;17   &#x2502;</span><br><span class="line">&#x251C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2524;</span><br><span class="line">&#x2502;&quot;Merkel&quot;         &#x2502;&quot;TagderJugend&quot;    &#x2502;17   &#x2502;</span><br><span class="line">&#x251C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2524;</span><br><span class="line">&#x2502;&quot;CDU&quot;            &#x2502;&quot;JugendmitMerkel&quot; &#x2502;12   &#x2502;</span><br><span class="line">&#x251C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2524;</span><br><span class="line">&#x2502;&quot;CDU&quot;            &#x2502;&quot;TagderJugend&quot;    &#x2502;12   &#x2502;</span><br><span class="line">&#x251C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2524;</span><br><span class="line">&#x2502;&quot;TagderJugend&quot;   &#x2502;&quot;Thailand&quot;        &#x2502;11   &#x2502;</span><br><span class="line">&#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2534;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2534;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;// Most common domains shared in tweets</span><br><span class="line">MATCH (t:Tweet)-[:HAS_LINK]-&gt;(u:Link)</span><br><span class="line">WITH t, replace(replace(u.url, &quot;http://&quot;, &apos;&apos; ), &quot;https://&quot;, &apos;&apos;) AS url</span><br><span class="line">RETURN COUNT(t) AS num, head(split(url, &quot;/&quot;)) ORDER BY num DESC LIMIT 10</span><br><span class="line"></span><br><span class="line">&#x2552;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2564;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2555;</span><br><span class="line">&#x2502;&quot;num&quot;&#x2502;&quot;head(split(url, \&quot;/\&quot;))&quot;&#x2502;</span><br><span class="line">&#x255E;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x256A;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2561;</span><br><span class="line">&#x2502;835  &#x2502;&quot;pic.twitter.com&quot;        &#x2502;</span><br><span class="line">&#x251C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2524;</span><br><span class="line">&#x2502;120  &#x2502;&quot;bit.ly&quot;                 &#x2502;</span><br><span class="line">&#x251C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2524;</span><br><span class="line">&#x2502;105  &#x2502;&quot;\n\n&quot;                   &#x2502;</span><br><span class="line">&#x251C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2524;</span><br><span class="line">&#x2502;100  &#x2502;&quot;pbs.twimg.com&quot;          &#x2502;</span><br><span class="line">&#x251C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2524;</span><br><span class="line">&#x2502;32   &#x2502;&quot;vk.com&quot;                 &#x2502;</span><br><span class="line">&#x251C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2524;</span><br><span class="line">&#x2502;21   &#x2502;&quot;riafan.ru&quot;              &#x2502;</span><br><span class="line">&#x251C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2524;</span><br><span class="line">&#x2502;21   &#x2502;&quot;inforeactor.ru&quot;         &#x2502;</span><br><span class="line">&#x251C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2524;</span><br><span class="line">&#x2502;20   &#x2502;&quot;nevnov.ru&quot;              &#x2502;</span><br><span class="line">&#x251C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2524;</span><br><span class="line">&#x2502;17   &#x2502;&quot;goodspb.livejournal.com&quot;&#x2502;</span><br><span class="line">&#x251C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2524;</span><br><span class="line">&#x2502;15   &#x2502;&quot;www.fox5atlanta.com&quot;    &#x2502;</span><br><span class="line">&#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2534;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;</span><br></pre></td></tr></table></figure>

<h1 id="GraphQL-API"><a href="#GraphQL-API" class="headerlink" title="GraphQL API"></a>GraphQL API</h1><p>In addition to querying Neo4j using Cypher directly, we can also take advantage of the <a href="/external_links/c768866399abde6ca078efa725bf25cc.html" target="blank" rel="noopener">neo4j-graphql</a> integrations to easily build a GraphQL API for our tweets.</p>
<p>First, we define a GraphQL schema</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;type Tweet {</span><br><span class="line">    tweet_id: ID!</span><br><span class="line">    text: String</span><br><span class="line">    permalink: String</span><br><span class="line">    author: User @relation(name: &quot;POSTED&quot;, direction: &quot;IN&quot;)</span><br><span class="line">    hashtags: [Hashtag] @relation(name: &quot;HAS_TAG&quot;, direction: &quot;OUT&quot;)</span><br><span class="line">    links: [Link] @relation(name: &quot;HAS_LINK&quot;, direction: &quot;OUT&quot;)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">type User {</span><br><span class="line">    user_id: ID!</span><br><span class="line">    screen_name: String</span><br><span class="line">    tweets: [Tweet] @relation(name: &quot;POSTED&quot;, direction: &quot;OUT&quot;)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">type Hashtag {</span><br><span class="line">    tag: ID!</span><br><span class="line">    archived_url: String</span><br><span class="line">    tweets(first: Int): [Tweet] @relation(name: &quot;HAS_TAG&quot;, direction: &quot;IN&quot;)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">type Link {</span><br><span class="line">    url: ID!</span><br><span class="line">    archived_url: String</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">type Query {</span><br><span class="line">	Hashtag(tag: ID, first: Int, offset: Int): [Hashtag]</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>Our GraphQL schema defines the types and fields available in the data, as well as the entry points for our GraphQL service. In this case we have a single entry point <code>Hashtag</code>, allowing us to search for tweets by hashtag.</p>
<p>With the <a href="/external_links/2e8703934041d5596c9e321e0ba41dd4.html" target="blank" rel="noopener">neo4j-graphql-js</a> integration, the GraphQL schema maps to the graph database model and translates any arbitrary GraphQL query to Cypher, allowing anyone to query the data through<br> the GraphQL API without writing Cypher.</p>
<p>Implementing the GraphQL server is simply a matter of passing the GraphQL query to the integration function in the resolver:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x590D;&#x5236;&#x4EE3;&#x7801;import {neo4jgraphql} from &apos;neo4j-graphql-js&apos;;</span><br><span class="line"></span><br><span class="line">const resolvers = {</span><br><span class="line">  // root entry point to GraphQL service</span><br><span class="line">  Query: {</span><br><span class="line">    // fetch movies by title substring</span><br><span class="line">    Hashtag(object, params, ctx, resolveInfo) {</span><br><span class="line">      // neo4jgraphql inspects the GraphQL query and schema to generate a single Cypher query</span><br><span class="line">      // to resolve the GraphQL query. Assuming a Neo4j driver instance exists in the context</span><br><span class="line">      // the query is executed against Neo4j</span><br><span class="line">      return neo4jgraphql(object, params, ctx, resolveInfo);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">};</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/ad1d705468897d539d212b903116a3554031beb5bf2c05360006db959e03daee" alt></p>
<h1 id="React-App"><a href="#React-App" class="headerlink" title="React App"></a>React App</h1><p>One of the advantages of having a GraphQL API is that makes it very easy to build web and mobile applications that consume the GraphQL service. To make the data easily searchable we&#x2019;ve make a simple React web app that allows for searching tweets in<br> Neo4j by hashtag.</p>
<p><img src="https://gitee.com/songjianzaina/juejin_p4/raw/master/img/0f80881882cd6f10336890f7e8d0621c9a029512bc1aee8c3165e9840e8e6c8c" alt></p>
<p>Here we&#x2019;re searching for tweets that contain the hashtag <code>#crime</code>. We can see that a Russia Troll account @OnlineCleveland is tweeting fake news about crimes in Ohio, making it seem that more crime is occurring in Cleveland. Why would a<br> Russia Troll account be tweeting about crime in Cleveland leading up to the election? Typically when voters want a &#x201C;tough on crime&#x201D; politician elected they vote Republican&#x2026;</p>
<p>In this post we&#x2019;ve scraped tweet data from Internet Archive, imported in Neo4j for analysis, built a GraphQL API for exposing the data, and a simple <a href="/external_links/ddd4276fd13f96f75548150d18eb2587.html" target="blank" rel="noopener">GRANDstack</a> app for allowing anyone to easily search the tweets<br> by hashtag.</p>
<p>While we were only able to find a small fraction of the tweets posted by the Russian Twitter Troll accounts, we will continue to explore options for finding more of the data ;-)</p>
<p>All code is available on Github at <a href="/external_links/549e80d8c37443b6c22b412576b7c665.html" target="blank" rel="noopener">github.com/johnymontan&#x2026;</a>.</p>
<p><strong>&#x672C;&#x6587;&#x8F6C;&#x8F7D;&#x81EA;:</strong> <a href="/external_links/58bafe8c7267337687fc5dbbf59c216a.html" target="blank" rel="noopener">&#x6398;&#x91D1;</a></p>
<p><em><a href="https://dev.newban.cn/">&#x5F00;&#x53D1;&#x8005;&#x535A;&#x5BA2; &#x2013; &#x548C;&#x5F00;&#x53D1;&#x76F8;&#x5173;&#x7684; &#x8FD9;&#x91CC;&#x5168;&#x90FD;&#x6709;</a></em></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="tags/Python/" rel="tag"># Python</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="6844903512027971598.html" rel="next" title="Java 形参与实参">
                <i class="fa fa-chevron-left"></i> Java 形参与实参
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="6844903512036360199.html" rel="prev" title="用普通的Python，从头开始编写一个基本的x86-64 J">
                用普通的Python，从头开始编写一个基本的x86-64 J <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


    <!-- 有瓣音频文章内嵌广告 -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-2626449904708114" data-ad-slot="6145016388"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

    <div class="post-spread">
      
    </div>
  </div>
  <!-- 有瓣音频信息流广告 -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle" style="display:block" data-ad-format="fluid" data-ad-layout-key="-6t+ed+2i-1n-4w" data-ad-client="ca-pub-2626449904708114" data-ad-slot="6455528644"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">开发者博客</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="https://dev.newban.cn/archives/">
              
                  <span class="site-state-item-count">3990</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">1304</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Scraping-Russian-Twitter-Trolls-With-Python-Neo4j-and-GraphQL"><span class="nav-number">1.</span> <span class="nav-text">Scraping Russian Twitter Trolls With Python, Neo4j, and GraphQL</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Russian-Twitter-Trolls"><span class="nav-number">2.</span> <span class="nav-text">Russian Twitter Trolls</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Internet-Archive"><span class="nav-number">3.</span> <span class="nav-text">Internet Archive</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Finding-Available-Cached-Pages"><span class="nav-number">3.1.</span> <span class="nav-text">Finding Available Cached Pages</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Scraping-Twitter-Profile-Pages"><span class="nav-number">3.2.</span> <span class="nav-text">Scraping Twitter Profile Pages</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Importing-Into-Neo4j"><span class="nav-number">4.</span> <span class="nav-text">Importing Into Neo4j</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Graph-Queries"><span class="nav-number">4.1.</span> <span class="nav-text">Graph Queries</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#GraphQL-API"><span class="nav-number">5.</span> <span class="nav-text">GraphQL API</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#React-App"><span class="nav-number">6.</span> <span class="nav-text">React App</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">开发者博客</span>
  <div>
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
  </div>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




  <script type="text/javascript" async src="js/src/mermaid.min.js"></script>
  <script>
  if (window.mermaid) {
        var mermaid_config = {
            startOnLoad: true,
            theme: 'default',
            flowchart:{
                useMaxWidth: false,
                htmlLabels: true
            }                
        }
        mermaid.initialize(mermaid_config);
  }
  </script>
  

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
